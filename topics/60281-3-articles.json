{"TopicId":60281,"ForumId":36,"TopicTitle":"[Hardware, Plugin] Arduino based physical display \u002B serial port io\u002B tutorial (24-11-19)","CreatedByName":"zitronen","CreatedById":11842,"CreatedDateTime":"2014-01-18T01:25:25Z","PageNum":3,"Articles":[{"CreatedByName":"cyoung_mi","CreatedById":92312,"CreatedDateTime":"2014-02-02T06:39:44Z","Content":"\n\u003Cp\u003EThis looks GREAT! but could someone add Mac OSX support to the plug in? it\u0027s the Serial port look up that needs an addition...\u003C/p\u003E\u003Cp\u003EMine is currently on /dev/cu.usbmodem14421.. should be able to search /dev/cu* for a list of ports.\u003C/p\u003E\n"},{"CreatedByName":"zitronen","CreatedById":11842,"CreatedDateTime":"2014-02-02T18:07:39Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Mulbin\u0022 data-cite=\u0022Mulbin\u0022\u003E\u003Cdiv\u003EOk some other general questions about your plugin!\u003Cp\u003EI\u0027m still in the very early stages of learning Arduino... but am I right in thinking the only bit I\u0027d really need to edit to add more lights / dials etc to run off the existing fields would be Utilities? - adding similar parameter to caution \u002B, warning \u002B etc. The rest (kspiodemo, handshake, serialcoms) looks like stuff I probably shouldn\u0027t touch or I\u0027ll break the plugin...\u003C/p\u003E\u003Cp\u003EAlso... I picked this up with the hope that I can eventually get it to run as a dial using the plugin, any advice on how to safely wire it up? Do I need to run this in series with a resistor on the gnd like with an LED?.. don\u0027t want to put it near the arduino until I\u0027m sure it won\u0027t fry my board!\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022http://i.imgur.com/ZhAbkQS.jpg\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://i.imgur.com/ZhAbkQS.jpg\u003C/a\u003E\u003C/p\u003E\u003Cp\u003ESorry for the noobish questions, you are the best source of info on ksp simulator panels I\u0027ve found!\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EWell I would make a new tab to put your own functions in. let\u0027s say you made a function that drives a gauge based on fuel level called \u0022drivefuelgauge()\u0022 and another one called \u0022LEDindicators()\u0022, you would put it in the main loop like this\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Evoid loop()\u003Cbr\u003E{\u003Cbr\u003E  now = millis();\u003Cbr\u003E\u003Cbr\u003E  if (KSPBoardReceiveData()){  //we got some data\u003Cbr\u003E    deadtimeOld = now;\u003Cbr\u003E    switch(id) {  //we check the packet id\u003Cbr\u003E    case 0: //data is handshake packet\u003Cbr\u003E      Handshake();\u003Cbr\u003E      break;\u003Cbr\u003E    case 1: //data is vessel data\u003Cbr\u003E      drivefuelgauge();   //Add it here \u0026lt;\u0026lt;=========\u003Cbr\u003E      LEDindicators();\u003Cbr\u003E      break;\u003Cbr\u003E    }\u003Cbr\u003E\u003Cbr\u003E    //We got some data, turn the green led on\u003Cbr\u003E    digitalWrite(GLED,HIGH);\u003Cbr\u003E  }\u003Cbr\u003E  else\u003Cbr\u003E  { //if no message received for a while, go idle\u003Cbr\u003E    deadtime = now - deadtimeOld; \u003Cbr\u003E    if (deadtime \u0026gt; IDLETIMER)\u003Cbr\u003E    {\u003Cbr\u003E      deadtimeOld = now;\u003Cbr\u003E      LEDSAllOff();\u003Cbr\u003E    }    \u003Cbr\u003E  }\u003Cbr\u003E\u003Cbr\u003E}\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EUnfortunately you got a 15V gauge, which is slightly more difficult to drive, since the arduino can only output 5V max. To drive a 15V gauge you will need to get a 15V power supply and some transistors/MOSFETs i.e. you will need some basic electronics skill. To drive a 5V gauge is easy just do \u0022analogWrite(pin, value)\u0022 where pin is a PWM pin and value = 0-255. You can connect your 15V gauge to the arduino but you will only be able to use the 0-5V part of it unless you do what I said earlier.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022cyoung_mi\u0022 data-cite=\u0022cyoung_mi\u0022\u003E\u003Cdiv\u003EThis looks GREAT! but could someone add Mac OSX support to the plug in? it\u0027s the Serial port look up that needs an addition...\u003Cp\u003EMine is currently on /dev/cu.usbmodem14421.. should be able to search /dev/cu* for a list of ports.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EUnfortunately that is unlikely to happen any time soon. I don\u0027t have a Mac so there would be no way for me to test it. But you are more than welcome to fork the plugin code and make it work. I don\u0027t think it will be very hard.\u003C/p\u003E\n"},{"CreatedByName":"sgt_flyer","CreatedById":57690,"CreatedDateTime":"2014-02-02T18:31:07Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003EUnfortunately you got a 15V gauge, which is slightly more difficult to drive, since the arduino can only output 5V max. To drive a 15V gauge you will need to get a 15V power supply and some transistors/MOSFETs i.e. you will need some basic electronics skill. To drive a 5V gauge is easy just do \u0022analogWrite(pin, value)\u0022 where pin is a PWM pin and value = 0-255. You can connect your 15V gauge to the arduino but you will only be able to use the 0-5V part of it unless you do what I said earlier.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003Emaybe with an operational amplifier in linear amplification non inverting mode ? although he will still need more than a 15v alimentation to power the amplifier. the formula (based on \u003Ca href=\u0022https://en.wikipedia.org/wiki/File:Op-Amp_Non-Inverting_Amplifier.svg\u0022 rel=\u0022external nofollow\u0022\u003Ethis drawing\u003C/a\u003E) would end up be : Vout = Vin*(1\u002BR2/R1) - this should give a x3 linear amplification with R2 = 2*R1, which gives Vout = Vin*(1\u002B2).\u003C/p\u003E\u003Cp\u003Ealthough for sure, 5V gauges would greatly simplify the system \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Mulbin","CreatedById":55562,"CreatedDateTime":"2014-02-02T19:09:48Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022zitronen\u0022 data-cite=\u0022zitronen\u0022\u003E\u003Cdiv\u003EWell I would make a new tab to put your own functions in....\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThanks, thats a great help \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022zitronen\u0022 data-cite=\u0022zitronen\u0022\u003E\u003Cdiv\u003ETo drive a 15V gauge you will need to get a 15V power supply and some transistors/MOSFETs i.e.....\u003C/div\u003E\u003C/blockquote\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022sgt_flyer\u0022 data-cite=\u0022sgt_flyer\u0022\u003E\u003Cdiv\u003Emaybe with an operational amplifier in linear amplification non inverting mode ?...\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EOne step ahead of you both \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E I pulled the gauge apart this morning, removed the 15k 1% resistor from inside and soldered in a 5k 1%... now it is a 0-5v gauge \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E Just need to make a new face for it.\u003C/p\u003E\n"},{"CreatedByName":"Chaosratt","CreatedById":71354,"CreatedDateTime":"2014-02-02T19:37:14Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022zitronen\u0022 data-cite=\u0022zitronen\u0022\u003E\u003Cdiv\u003EWell I would make a new tab to put your own functions in. let\u0027s say you made a function that drives a gauge based on fuel level called \u0022drivefuelgauge()\u0022 and another one called \u0022LEDindicators()\u0022, you would put it in the main loop like this\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EZitronen, it looks your using max7219\u0027s for the digit displays. Do mind sharing the functions you use to send the data to those displays? I\u0027ve ended up with massive long convoluted loop just to send 8 digit numbers to the display. I\u0027m sure there\u0027s a stupid simple way to do this, but I\u0027m not a programmer so it eludes me.\u003C/p\u003E\n"},{"CreatedByName":"cyoung_mi","CreatedById":92312,"CreatedDateTime":"2014-02-02T20:35:28Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022zitronen\u0022 data-cite=\u0022zitronen\u0022\u003E\u003Cdiv\u003E\u003Cp\u003EUnfortunately that is unlikely to happen any time soon. I don\u0027t have a Mac so there would be no way for me to test it. But you are more than welcome to fork the plugin code and make it work. I don\u0027t think it will be very hard.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EWell I don\u0027t know anything about writing / compiling Mods for KSP..\u003C/p\u003E\u003Cp\u003EI would be more than happy to be your beta tester! if you could compile the change I\u0027d be happy to run it, and add suggestions to code.\u003C/p\u003E\n"},{"CreatedByName":"Mulbin","CreatedById":55562,"CreatedDateTime":"2014-02-02T21:12:27Z","Content":"\n\u003Cp\u003ECan I make a request for the following to be added?\u003C/p\u003E\u003Cp\u003Ebattery level (or is this already public float e; ? )\u003C/p\u003E\u003Cp\u003Eelectric drain/charge\u003C/p\u003E\u003Cp\u003Emonopropellant\u003C/p\u003E\u003Cp\u003Eoxidizer\u003C/p\u003E\u003Cp\u003Epitch angle\u003C/p\u003E\u003Cp\u003Eroll angle\u003C/p\u003E\u003Cp\u003Eyaw angle\u003C/p\u003E\u003Cp\u003EOr... you could point me at the right software to open the DLLs myself and I can see if I can understand anything \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"katton","CreatedById":97529,"CreatedDateTime":"2014-02-02T21:52:53Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Chaosratt\u0022 data-cite=\u0022Chaosratt\u0022\u003E\u003Cdiv\u003EZitronen, it looks your using max7219\u0027s for the digit displays. Do mind sharing the functions you use to send the data to those displays? I\u0027ve ended up with massive long convoluted loop just to send 8 digit numbers to the display. I\u0027m sure there\u0027s a stupid simple way to do this, but I\u0027m not a programmer so it eludes me.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI\u0027ve been using MAX7219s to drive my displays, so my code might help. I have four digit displays, though (I figured that you\u0027re only really interested in four digits worth of information anyways), so my function outputs either the number, the number in thousands, millions or billions, and then lights up a separate LED to indicate the range that it\u0027s in. It relies pretty heavily on LedControl (found \u003Ca href=\u0022http://playground.arduino.cc/Main/LedControl\u0022 rel=\u0022external nofollow\u0022\u003Ehere\u003C/a\u003E), but hopefully it\u0027s of some help.\u003C/p\u003E\u003Cp\u003EThe selector part is probably not of any use to you, but it lights up another led to indicate which of three options is chosen for the display (as \u003Ca href=\u0022http://i.imgur.com/JYEeGEm.jpg\u0022 rel=\u0022external nofollow\u0022\u003Ehere\u003C/a\u003E)\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E/* We start by including the library */\u003Cbr\u003E#include \u0022LedControl.h\u0022\u003Cbr\u003E\u003Cbr\u003E/* \u003Cbr\u003E * Now we create a new LedControl. \u003Cbr\u003E * We use pins 12,11 and 10 on the Arduino for the SPI interface\u003Cbr\u003E * Pin 12 is connected to the DATA IN-pin of the first MAX7221\u003Cbr\u003E * Pin 11 is connected to the CLK-pin of the first MAX7221\u003Cbr\u003E * Pin 10 is connected to the LOAD(/CS)-pin of the first MAX7221 \t\u003Cbr\u003E * There will only be a single MAX7221 attached to the arduino \u003Cbr\u003E */\u003Cbr\u003ELedControl lc = LedControl(12,11,10,2); \u003Cbr\u003E\u003Cbr\u003Evoid setup() {\u003Cbr\u003E  //start up the various led readouts\u003Cbr\u003E  lc.setIntensity(0,8);\u003Cbr\u003E  lc.clearDisplay(0);\u003Cbr\u003E  lc.shutdown(0,false);\u003Cbr\u003E\u003Cbr\u003E  lc.setIntensity(1,8);\u003Cbr\u003E  lc.clearDisplay(1);\u003Cbr\u003E  lc.shutdown(1,false);\u003Cbr\u003E}\u003Cbr\u003E\u003Cbr\u003Evoid show4digit (float value, int displaynum, int selector) { //show the info on a 4 digit 7 segment display, with leds for kilo and mega prefixes, selector is 0,1,2 for switch position\u003Cbr\u003E  int prefix = 0;\u003Cbr\u003E  float tempnum = value;\u003Cbr\u003E  while (tempnum \u0026gt;= 1000) {\u003Cbr\u003E    tempnum = tempnum /1000;\u003Cbr\u003E    prefix \u002B\u002B; //make it so we have a value less than 1000 and the prefix shows if we\u0027re in the  range of ones, thousands, millions, billions, etc \u003Cbr\u003E  }\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E //if we\u0027re above a trillion max everything out\u003Cbr\u003E  int dec2spot = 9;\u003Cbr\u003E  int decspot = 9;\u003Cbr\u003E  int ones = 9;\u003Cbr\u003E  int tens = 9;\u003Cbr\u003E  int hundreds = 9;\u003Cbr\u003E\u003Cbr\u003Eif (prefix \u0026lt; 4 ) {\u003Cbr\u003E\u003Cbr\u003E      long tempint = (long)(tempnum*100); //if we\u0027re in a good range, get some ints that we can work with... actually need to use long, because int it only good up to 30k, and wee need up to 100k ... maybe get rid of the second decimal place and use int later to get better performance\u003Cbr\u003E\u003Cbr\u003E  dec2spot =(tempint%10);  //use two decimal places, because if the value is less than 100, we have hte room to show it\u003Cbr\u003E  decspot = ((tempint/10)%10);\u003Cbr\u003E  ones = (tempint/100%10);\u003Cbr\u003E  tens = ((tempint/1000)%10);\u003Cbr\u003E  hundreds = ((tempint/10000)%10);\u003Cbr\u003E  }\u003Cbr\u003E  if (hundreds == 0) {\u003Cbr\u003E    if (tens == 0) {    //if our value is less than ten, leave one digit dark, and show it to two decimal places\u003Cbr\u003E      lc.setChar(displaynum,0,\u0027 \u0027,false);\u003Cbr\u003E      lc.setDigit(displaynum,1,(byte)ones,true);\u003Cbr\u003E      lc.setDigit(displaynum,2,(byte)decspot,false);\u003Cbr\u003E      lc.setDigit(displaynum,3,(byte)dec2spot,false);\u003Cbr\u003E    }\u003Cbr\u003E    else {            //if our value is greater than ten but less than a hundred, show it to two decimal places\u003Cbr\u003E      lc.setDigit(displaynum,0,(byte)tens,false);\u003Cbr\u003E      lc.setDigit(displaynum,1,(byte)ones,true);\u003Cbr\u003E      lc.setDigit(displaynum,2,(byte)decspot,false);\u003Cbr\u003E      lc.setDigit(displaynum,3,(byte)dec2spot,false);      \u003Cbr\u003E    }\u003Cbr\u003E  }\u003Cbr\u003E  else {              //if our value is greater than a hundred, show it to one decimal place\u003Cbr\u003E    lc.setDigit(displaynum,0,(byte)hundreds,false);\u003Cbr\u003E    lc.setDigit(displaynum,1,(byte)tens,false);\u003Cbr\u003E    lc.setDigit(displaynum,2,(byte)ones,true);\u003Cbr\u003E    lc.setDigit(displaynum,3,(byte)decspot,false);\u003Cbr\u003E  }\u003Cbr\u003E\u003Cbr\u003E  switch (prefix) { //set the leds to show the multiplier applied to the value - leds are wired up as digit 4 leds 1 and 2 (led 0 is colon)\u003Cbr\u003E  case 0: // less than 1000, no multipliers lit up\u003Cbr\u003E    lc.setLed(displaynum,4,1,false);\u003Cbr\u003E    lc.setLed(displaynum,4,2,false);   \u003Cbr\u003E    break;\u003Cbr\u003E\u003Cbr\u003E  case 1: // between a thousand and a million, light up K multiplier\u003Cbr\u003E    lc.setLed(displaynum,4,1,true);\u003Cbr\u003E    lc.setLed(displaynum,4,2,false);\u003Cbr\u003E    break;\u003Cbr\u003E\u003Cbr\u003E  case 2: // between a million and a billion, light up M multiplier\u003Cbr\u003E    lc.setLed(displaynum,4,1,false);\u003Cbr\u003E    lc.setLed(displaynum,4,2,true);\u003Cbr\u003E    break;\u003Cbr\u003E\u003Cbr\u003E  default: // above a billion, light up both multipliers (oh god what\u0027s going on!)\u003Cbr\u003E    lc.setLed(displaynum,4,1,true);\u003Cbr\u003E    lc.setLed(displaynum,4,2,true);\u003Cbr\u003E  }\u003Cbr\u003E\u003Cbr\u003E//light up selector  \u003Cbr\u003E    lc.setLed(displaynum,4,3\u002Bselector,true);\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E}\u003Cbr\u003Evoid loop(){\u003Cbr\u003E\u003Cbr\u003E  show4digit(2.965874E6,0,1);\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E}\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n"},{"CreatedByName":"KvickFlygarn87","CreatedById":76314,"CreatedDateTime":"2014-02-03T07:34:43Z","Content":"\n\u003Cp\u003ESweet! Time to get goin\u0027 and build an autopilot with arduino :-)\u003C/p\u003E\n"},{"CreatedByName":"Deathsoul097","CreatedById":77396,"CreatedDateTime":"2014-02-03T08:57:24Z","Content":"\n\u003Cp\u003EApply cold water to Burn.\u003C/p\u003E\u003Cp\u003EMan. This is ridiculous. I wouldn\u0027t know where to begin on this kind of project, I know pretty much zilch on electronics and hardware. Still. Keep going, this looks like it will turn out awesome.\u003C/p\u003E\n"},{"CreatedByName":"stupid_chris","CreatedById":62017,"CreatedDateTime":"2014-02-03T17:15:45Z","Content":"\n\u003Cp\u003E\u003Cspan style=\u0022text-decoration:line-through;\u0022\u003EThread closed until we sort this out.\u003C/span\u003E\u003C/p\u003E\u003Cp\u003EAlright, opening this once more. I\u0027d like to ask you guys to be careful from now on. Any mud slinging like what was here before will be removed and awarded an infraction.\u003C/p\u003E\u003Cp\u003EThanks and carry on.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-02-03T23:37:48Z\u0022 title=\u002202/03/2014 11:37  PM\u0022 data-short=\u002210 yr\u0022\u003EFebruary 3, 2014\u003C/time\u003E by stupid_chris\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"katton","CreatedById":97529,"CreatedDateTime":"2014-02-04T00:44:12Z","Content":"\n\u003Cp\u003EHi Zitronen and Mulbin,\u003C/p\u003E\u003Cp\u003EI just tried the sample sketch on an (off-brand) Mega 2560, and it worked fine. So, I don\u0027t think it\u0027s the Mega2560 that\u0027s the problem.\u003C/p\u003E\u003Cp\u003EOn the other hand, I\u0027m trying to shoehorn my own display stuff in there too, and that\u0027s not going nearly as well \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Mulbin","CreatedById":55562,"CreatedDateTime":"2014-02-04T07:18:33Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022katton\u0022 data-cite=\u0022katton\u0022\u003E\u003Cdiv\u003EHi Zitronen and Mulbin,\u003Cp\u003EI just tried the sample sketch on an (off-brand) Mega 2560, and it worked fine. So, I don\u0027t think it\u0027s the Mega2560 that\u0027s the problem.\u003C/p\u003E\u003Cp\u003EOn the other hand, I\u0027m trying to shoehorn my own display stuff in there too, and that\u0027s not going nearly as well \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EMy Uno should be here in the next 24 hours so I can see if it works on that... otherwise I don\u0027t know whats going on. Still wondering if there is something else I need installed on my computer like some missing .net stuff or something...\u003C/p\u003E\n"},{"CreatedByName":"Mulbin","CreatedById":55562,"CreatedDateTime":"2014-02-04T14:13:23Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022katton\u0022 data-cite=\u0022katton\u0022\u003E\u003Cdiv\u003EI just tried the sample sketch on an (off-brand) Mega 2560\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ECan I just check which revision you are using? I\u0027m seeing a lot of posts via google with similar problems of the mega 2560 not coping well with software serial. Some people saying stuff works on their uno or older mega but not on the new one.\u003C/p\u003E\u003Cp\u003EMine is an R3\u003C/p\u003E\n"},{"CreatedByName":"AMirrodin","CreatedById":102604,"CreatedDateTime":"2014-02-04T14:25:31Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Mulbin\u0022 data-cite=\u0022Mulbin\u0022\u003E\u003Cdiv\u003EMine is an R3\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThe sample code works for me on my R3 mega, although I did notice that I have to launch my rockets from the VAB and not straight from the launch pad or my communication light wouldn\u0027t turn on... Might be something I/you/Zitronen/we should look into\u003C/p\u003E\u003Cp\u003EIf you are wondering about the communication light, I just added a new variable definition to the code and changed the handshake LED to my new one.\u003C/p\u003E\n"},{"CreatedByName":"Mulbin","CreatedById":55562,"CreatedDateTime":"2014-02-04T17:18:56Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022AMirrodin\u0022 data-cite=\u0022AMirrodin\u0022\u003E\u003Cdiv\u003EI did notice that I have to launch my rockets from the VAB and not straight from the launch pad or my communication light wouldn\u0027t turn on...\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003Eoh...my...god...\u003C/p\u003E\u003Cp\u003EI\u0027ve been launching from the launchpad to save time testing! IT WORKS!!! I know have three lights working perfectly when I launch from the VAB, but none if I launch from the pad.\u003C/p\u003E\u003Cp\u003EOk, so we\u0027ve got to the bottom of the mystery.... \u003C/p\u003E\u003Cp\u003EIs this bug only on megas then? If so we can bug report that the mod only works if you launch from the VAB with a mega.\u003C/p\u003E\u003Cp\u003EOf course me and Xitronen may have just bought another Arduino each for no reason \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Mulbin","CreatedById":55562,"CreatedDateTime":"2014-02-04T17:56:47Z","Content":"\n\u003Cp\u003Eok, now that I have the plugin working I can begine to try and work out how to make an analog guage work!\u003C/p\u003E\u003Cp\u003EIs it possible to adapt this bit of code by KK4TEE to work with the plugin? I\u0027m not sure what format the plugin sends the data in... as a percentage? OR a total figure fo fuel? (in which case arduino will need to convert it to a usable percentage figure!)...\u003C/p\u003E\u003Cp\u003EHere is the code, would be great if anyone can point out how to make this work...\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E//This program sets an analog meter to various levels.\u003Cbr\u003E// wire 11 goes to right dual gauge\u003Cbr\u003E// wire 12 goes to left dual gauge\u003Cbr\u003E// wire 10 goes to vertical gauge\u003Cbr\u003E\u003Cbr\u003Eint gaugeDualLeft = 12;\u003Cbr\u003Eint gaugeDualRight = 11;\u003Cbr\u003Eint gaugeVertical = 10;\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003Eint met = 0; //Mission Elapsed Time\u003Cbr\u003Eint valueDualLeft = 0;\u003Cbr\u003Eint valueDualRight = 0;\u003Cbr\u003Eint valueVertical = 0;\u003Cbr\u003E\u003Cbr\u003Evoid setup (){\u003Cbr\u003E pinMode(gaugeDualLeft, OUTPUT);\u003Cbr\u003E pinMode(gaugeDualRight, OUTPUT);\u003Cbr\u003E pinMode(gaugeVertical, OUTPUT);\u003Cbr\u003E\u003Cbr\u003E Serial.begin(9600); \u003Cbr\u003E\u003Cbr\u003E}\u003Cbr\u003E\u003Cbr\u003Evoid loop (){\u003Cbr\u003E  if (Serial.available()) {\u003Cbr\u003E  //met = Serial.parseInt();\u003Cbr\u003E  valueDualLeft = Serial.parseInt(); //Looks for the next valid integer in the serial stream\u003Cbr\u003E  valueDualRight = Serial.parseInt();\u003Cbr\u003E  valueVertical = Serial.parseInt();\u003Cbr\u003E  }  \u003Cbr\u003E      // look for the newline\u003Cbr\u003E    if (Serial.read() == \u0027\\n\u0027) {\u003Cbr\u003E      // constrain the values to 0 - 255\u003Cbr\u003E      valueDualLeft = constrain(valueDualLeft, 0, 255);\u003Cbr\u003E      valueDualRight = constrain(valueDualRight, 0, 255);\u003Cbr\u003E      valueVertical = constrain(valueVertical, 0, 255);\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E      //Configure LiquidFuel for the Weird Gauge I have\u003Cbr\u003E      valueDualLeft = valueDualLeft*8/255;      \u003Cbr\u003E      //Configure Oxidizer for the Weird Gauge I have\u003Cbr\u003E      valueDualRight = valueDualRight*8/255;\u003Cbr\u003E\u003Cbr\u003E      //Configure Rate of Climb for the Vertical Gauge I have\u003Cbr\u003E      valueVertical = valueVertical * 48/255 \u002B 12;\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E      // Write the values to the display \u003Cbr\u003E      analogWrite(gaugeDualLeft, valueDualLeft);\u003Cbr\u003E      analogWrite(gaugeDualRight, valueDualRight);\u003Cbr\u003E      analogWrite(gaugeVertical, valueVertical);\u003Cbr\u003E\u003Cbr\u003E      // print the three numbers in one string as hexadecimal:\u003Cbr\u003E      Serial.print(\u0022Gauges updated\u0022);\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E    }\u003Cbr\u003Edelay(20);\u003Cbr\u003E}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EHere is the awesome thread it came from! KK4TEE hasnt managed to make a plugin to send the data directly so I pointed him here.\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/60616-WIP-Custom-Hardware-Control-Panel?highlight=custom\u002Bgauges\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://forum.kerbalspaceprogram.com/threads/60616-WIP-Custom-Hardware-Control-Panel?highlight=custom\u002Bgauges\u003C/a\u003E\u003C/p\u003E\n"},{"CreatedByName":"zitronen","CreatedById":11842,"CreatedDateTime":"2014-02-04T18:00:14Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022AMirrodin\u0022 data-cite=\u0022AMirrodin\u0022\u003E\u003Cdiv\u003EThe sample code works for me on my R3 mega, although I did notice that I have to launch my rockets from the VAB and not straight from the launch pad or my communication light wouldn\u0027t turn on... Might be something I/you/Zitronen/we should look into\u003Cp\u003EIf you are wondering about the communication light, I just added a new variable definition to the code and changed the handshake LED to my new one.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EOh... This probably has something to do with how the plugin handles scene switching... I will add it to the bug list. An arduino mega is nice to have anyway I guess...\u003C/p\u003E\n"},{"CreatedByName":"zitronen","CreatedById":11842,"CreatedDateTime":"2014-02-04T18:11:44Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Chaosratt\u0022 data-cite=\u0022Chaosratt\u0022\u003E\u003Cdiv\u003EZitronen, it looks your using max7219\u0027s for the digit displays. Do mind sharing the functions you use to send the data to those displays? I\u0027ve ended up with massive long convoluted loop just to send 8 digit numbers to the display. I\u0027m sure there\u0027s a stupid simple way to do this, but I\u0027m not a programmer so it eludes me.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI am actually using AS1117s, which are equivalent to a MAX7219 but half the price. I also use the LEDControl library katton used. My code for displaying is really simple:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Evoid write7Segment(byte display, char value[7], byte decimal)\u003Cbr\u003E{\u003Cbr\u003E  for (byte j = 0; j\u0026lt;6; j\u002B\u002B) {\u003Cbr\u003E    lc.setChar(display,j,value[j],decimal==j);\u003Cbr\u003E  }\u003Cbr\u003E}\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EDisplay is the display number if you have daisy chained more\u003C/p\u003E\u003Cp\u003Evalue is what you want to display, it\u0027s char so you can write \u0022-BOOB-\u0022\u003C/p\u003E\u003Cp\u003Edecimal is which digit you want the decimal to show, set it to 10 or some hight number if you don\u0027t want it.\u003C/p\u003E\u003Cp\u003EThis is obviously only for 6 digits, just modify it for more or less digits.\u003C/p\u003E\u003Cp\u003EAnd if you want to display 3.14159 just do: write7Segment(0, \u0022314159\u0022, 1)\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Mulbin\u0022 data-cite=\u0022Mulbin\u0022\u003E\u003Cdiv\u003ECan I make a request for the following to be added?\u003Cp\u003Ebattery level (or is this already public float e; ? )\u003C/p\u003E\u003Cp\u003Eelectric drain/charge\u003C/p\u003E\u003Cp\u003Emonopropellant\u003C/p\u003E\u003Cp\u003Eoxidizer\u003C/p\u003E\u003Cp\u003Epitch angle\u003C/p\u003E\u003Cp\u003Eroll angle\u003C/p\u003E\u003Cp\u003Eyaw angle\u003C/p\u003E\u003Cp\u003EOr... you could point me at the right software to open the DLLs myself and I can see if I can understand anything \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYeah I can add whatever you want, but first I would like to figure out of config file saving so you guys can adjust things without me having to recompile the code every time.\u003C/p\u003E\u003Cp\u003EEdit: I have updated the first post to add some descriptions to the data packet!\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-02-04T18:32:07Z\u0022 title=\u002202/04/2014 06:32  PM\u0022 data-short=\u002210 yr\u0022\u003EFebruary 4, 2014\u003C/time\u003E by zitronen\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"zitronen","CreatedById":11842,"CreatedDateTime":"2014-02-04T18:30:36Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Mulbin\u0022 data-cite=\u0022Mulbin\u0022\u003E\u003Cdiv\u003Eok, now that I have the plugin working I can begine to try and work out how to make an analog guage work!\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ESince you have already changed it to work on 5V, all you need to do is analogWrite(PWMPin, map(VData.Fuelp, 0, 100, 0, 255)), and connect the gauge to whatever pin you choose (make sure the pin is able to output PWM, and set pinMode to output)\u003C/p\u003E\u003Cp\u003EEdit: before you try it with KSP, follow this example: \u003Ca href=\u0022http://arduino.cc/en/Tutorial/Fading\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://arduino.cc/en/Tutorial/Fading\u003C/a\u003E to make sure your gauge is working. Just replace the LED and resistor with your gauge.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-02-04T18:35:31Z\u0022 title=\u002202/04/2014 06:35  PM\u0022 data-short=\u002210 yr\u0022\u003EFebruary 4, 2014\u003C/time\u003E by zitronen\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Mulbin","CreatedById":55562,"CreatedDateTime":"2014-02-04T21:02:26Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022zitronen\u0022 data-cite=\u0022zitronen\u0022\u003E\u003Cdiv\u003ESince you have already changed it to work on 5V, all you need to do is analogWrite(PWMPin, map(VData.Fuelp, 0, 100, 0, 255)), and connect the gauge to whatever pin you choose (make sure the pin is able to output PWM, and set pinMode to output)\u003Cp\u003EEdit: before you try it with KSP, follow this example: \u003Ca href=\u0022http://arduino.cc/en/Tutorial/Fading\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://arduino.cc/en/Tutorial/Fading\u003C/a\u003E to make sure your gauge is working. Just replace the LED and resistor with your gauge.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EGreat thanks! I\u0027ll give this a go.\u003C/p\u003E\u003Cp\u003Eis public float e; the electric charge?\u003C/p\u003E\n"},{"CreatedByName":"Mulbin","CreatedById":55562,"CreatedDateTime":"2014-02-04T21:34:03Z","Content":"\n\u003Cp\u003EIt works! I have an analogue fuel gauge \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 alt=\u0022:D\u0022\u003E\u003C/p\u003E\u003Cp\u003EEdit - just noticed that the plugin also doesn\u0027t work if you revert to launch at the end of a flight, only if you go back through the VAB again.... I haven\u0027t tried buy I\u0027m guessing quick load\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-02-04T22:03:27Z\u0022 title=\u002202/04/2014 10:03  PM\u0022 data-short=\u002210 yr\u0022\u003EFebruary 4, 2014\u003C/time\u003E by Mulbin\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"zitronen","CreatedById":11842,"CreatedDateTime":"2014-02-04T21:55:36Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Mulbin\u0022 data-cite=\u0022Mulbin\u0022\u003E\u003Cdiv\u003EGreat thanks! I\u0027ll give this a go.\u003Cp\u003Eis public float e; the electric charge?\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI updated the descriptions, see first post!\u003C/p\u003E\n"},{"CreatedByName":"Mulbin","CreatedById":55562,"CreatedDateTime":"2014-02-04T22:51:48Z","Content":"\n\u003Cp\u003EI\u0027ve noticed that the gauge moves in steps, a bit like the second hand on a clock ticking. At first I thought it might be something in the loop causing it to pause every half second... but then I thought maybe it is because the plugin sends updated values in whole percents. Which would mean any gauge will be made up of 100 clicks rather than a smooth motion. If this is the cause is it possible to update the plugin with a decimal point or 2 added to the percentage? ie.. 99.9%, 99.8%, 99.7% etc effectively breaking the dial movement up into a thousand tiny movements rather than a hundred more obvious twitches.\u003C/p\u003E\u003Cp\u003EI know you didn\u0027t initially design the plugin for dials.. but It has huge potential for a wide range of displays including gauges!\u003C/p\u003E\n"},{"CreatedByName":"zitronen","CreatedById":11842,"CreatedDateTime":"2014-02-04T23:02:50Z","Content":"\n\u003Cp\u003EUnfortunately arduino only supports 8bit PWM, so you only get 255 steps. You can try smooth it out a bit by experimenting with adding a 0.01-1uF capacitor in parallel with the meter. It doesn\u0027t give you more steps, just fake smooth.\u003C/p\u003E\n"}]}