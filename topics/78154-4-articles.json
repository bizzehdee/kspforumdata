{"TopicId":78154,"ForumId":36,"TopicTitle":"Contract Modding Information for Mod Authors","CreatedByName":"MrHappyFace","CreatedById":76365,"CreatedDateTime":"2014-07-18T09:00:31Z","PageNum":4,"Articles":[{"CreatedByName":"FlowerChild","CreatedById":74289,"CreatedDateTime":"2014-08-08T22:58:55Z","Content":"\n\u003Cp\u003EWith regards to the following in the example code in the OP:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E        protected override string GetDescription ()\u003Cbr\u003E        {\u003Cbr\u003E            //those 3 strings appear to do nothing\u003Cbr\u003E            return TextGen.GenerateBackStories (Agent.Name, Agent.GetMindsetString (), \u0022docking\u0022, \u0022dock\u0022, \u0022kill all humans\u0022, new System.Random ().Next());\u003Cbr\u003E        }\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EI think that MissionSeed may actually be a more appropriate value for the last parameter of GenerateBackStories() like this\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E            return TextGen.GenerateBackStories (Agent.Name, Agent.GetMindsetString (), \u0022docking\u0022, \u0022dock\u0022, \u0022kill all humans\u0022, MissionSeed);\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EAs I believe that will generate a consistent back story that won\u0027t change when you load a new savegame or what have you. I believe the primary purpose of MissionSeed is to provide that kind of persistence for randomly generated data without having to store the extra data (like the full back story string) to the save file.\u003C/p\u003E\n"},{"CreatedByName":"DMagic","CreatedById":57416,"CreatedDateTime":"2014-08-09T00:10:43Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022FlowerChild\u0022 data-cite=\u0022FlowerChild\u0022\u003E\u003Cdiv\u003EAfter playing around with this some, I think it may be a little more complicated than the above, in that the multipliers seem to not be nice round numbers.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI believe the values can be found in GameVariables. I suppose you could just print out all of the floats in there to see their values, though I think the actual calculations are more complicated than that. \u003C/p\u003E\u003Cp\u003EIt looks like agency mentality (which I haven\u0027t really looked into at all) also plays a factor.\u003C/p\u003E\n"},{"CreatedByName":"MrHappyFace","CreatedById":76365,"CreatedDateTime":"2014-08-09T04:42:43Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022FlowerChild\u0022 data-cite=\u0022FlowerChild\u0022\u003E\u003Cdiv\u003EWith regards to the following in the example code in the OP]\u003Cp\u003EI think that MissionSeed may actually be better...\u003C/p\u003E\u003Cp\u003EAs I believe that will generate a consistent back story that won\u0027t change when you load a new savegame or what have you. I believe the primary purpose of MissionSeed is to provide that kind of persistence for randomly generated data without having to store the extra data (like the full back story string) to the save file.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThat was never meant to be good, just an example, I also threw it together in 30 minutes, so its probably one of the worst blocks of code I\u0027ve ever wrote (which is saying a lot)\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif\u0022 alt=\u0022:P\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"FlowerChild","CreatedById":74289,"CreatedDateTime":"2014-08-09T20:06:17Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022MrHappyFace\u0022 data-cite=\u0022MrHappyFace\u0022\u003E\u003Cdiv\u003EThat was never meant to be good, just an example, I also threw it together in 30 minutes, so its probably one of the worst blocks of code I\u0027ve ever wrote (which is saying a lot)\u003Cp\u003E\u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif\u0022 alt=\u0022:P\u0022\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EWasn\u0027t a critique or anything, as I really appreciate you putting together this thread and the example code. It\u0027s actually saved me a heck of a lot of time in terms of at least providing a base-line template of how the contract system works \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EJust trying to provide additional info for folks as I discover it myself, given something like the use of a persistent seed like that to generate consistent random results might not be immediately apparent to everyone.\u003C/p\u003E\n"},{"CreatedByName":"malkuth","CreatedById":57414,"CreatedDateTime":"2014-08-10T05:16:15Z","Content":"\n\u003Cp\u003ESo what is the seed actually generating a random number, sequence?\u003C/p\u003E\n"},{"CreatedByName":"FlowerChild","CreatedById":74289,"CreatedDateTime":"2014-08-10T19:34:32Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022malkuth\u0022 data-cite=\u0022malkuth\u0022\u003E\u003Cdiv\u003ESo what is the seed actually generating a random number, sequence?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYup, pretty much.\u003C/p\u003E\u003Cp\u003EAs far as I understand, it\u0027s just acting as a seed into the random number generator (if you pass it in as a parameter). As you probably know, computers can\u0027t produce random numbers, so any rand() type calls just generate a pseudorandom number based on a sequence of numbers determined by the seed value you pass in. Under most circumstances you pass in a seed based on the local computer\u0027s clock value or what have you so that you get a more random sequence out of it, but you can also pass in your own value if you want to generate the same sequence as in another instance.\u003C/p\u003E\u003Cp\u003EHence why in a game like Minecraft, you can get exactly the same world out of the same seed number input at creation without having to download a huge world file or something (the seed basically acts as the ultimate form of compression). In this case I suspect Squad has set things up so that a random seed is created on contract generation and saved with the contract, so that this value can then be used each time the random description is generated so that it is consistent each time the user views the same contract.\u003C/p\u003E\u003Cp\u003EYou can see the mission seed value attached to each of the contracts in persistent.sfs in lines like these:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E\t\t\t\tseed = 1817138329\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EThey seem to be automatically generated for custom contracts as well, as I haven\u0027t had to set the seed values for my own contracts.\u003C/p\u003E\u003Cp\u003ESorry if the above was more information than you desired \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-08-10T19:41:25Z\u0022 title=\u002208/10/2014 07:41  PM\u0022 data-short=\u00229 yr\u0022\u003EAugust 10, 2014\u003C/time\u003E by FlowerChild\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"FlowerChild","CreatedById":74289,"CreatedDateTime":"2014-08-12T21:19:49Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022malkuth\u0022 data-cite=\u0022malkuth\u0022\u003E\u003Cdiv\u003E\u003Cp\u003EThe problem is that if you want a repeating mission KSP looks at the arrchives and the Titles. If the titles match it will skip generation of that Contract again.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EJust a small addendum on this point:\u003C/p\u003E\u003Cp\u003EI don\u0027t *think* it\u0027s the actual titles that prevent repeating contracts, but rather the result of GetHashString(). I just created a repeating contract that has the same title over multiple instances (\u0022Conduct a weather survey\u0022), but which returns a different hash string for each (I based it on the GUID), and it appears I can generate as many instances of it as I would like.\u003C/p\u003E\n"},{"CreatedByName":"malkuth","CreatedById":57414,"CreatedDateTime":"2014-08-14T13:17:25Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022FlowerChild\u0022 data-cite=\u0022FlowerChild\u0022\u003E\u003Cdiv\u003EJust a small addendum on this point:\u003Cp\u003EI don\u0027t *think* it\u0027s the actual titles that prevent repeating contracts, but rather the result of GetHashString(). I just created a repeating contract that has the same title over multiple instances (\u0022Conduct a weather survey\u0022), but which returns a different hash string for each (I based it on the GUID), and it appears I can generate as many instances of it as I would like.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ESounds good. I started to notice this also.\u003C/p\u003E\n"},{"CreatedByName":"Dragonator","CreatedById":68845,"CreatedDateTime":"2014-08-17T22:46:13Z","Content":"\n\u003Cp\u003ECan a contract be created that provides a certain constant or reoccurring reward while a certain condition is met?\u003C/p\u003E\u003Cp\u003EFor example for a space station to be built for funding to be provided daily for each day the space station meets a certain criteria, such as a module being operational.\u003C/p\u003E\n"},{"CreatedByName":"malkuth","CreatedById":57414,"CreatedDateTime":"2014-08-17T23:42:43Z","Content":"\n\u003Cp\u003EYou can place a timer or countdown on it and when time is up contract ends.\u003C/p\u003E\u003Cp\u003EFor payment you would have set up outside source to add funds while conditions are met.\u003C/p\u003E\n"},{"CreatedByName":"FlowerChild","CreatedById":74289,"CreatedDateTime":"2014-08-18T17:50:53Z","Content":"\n\u003Cp\u003EIt might also be possible to do that through the contract system as contract parameters can have rewards for each individual one (see the \u0022Explore Body\u0022 contracts for reference). You could then have one parameter for setting up the station, which completes normally and pays a certain reward once, then another one which never completes but which pays out at the end of each day through its Update() function.\u003C/p\u003E\u003Cp\u003ENot sure how many advantages that would offer over Malkuth\u0027s approach, but might be a little more intuitive for the player to have the contract constantly on display, and might provide you with an easy save/load mechanism since the parameters for the contract (like the timer) could then be stored within the contract itself.\u003C/p\u003E\n"},{"CreatedByName":"FlowerChild","CreatedById":74289,"CreatedDateTime":"2014-08-18T20:49:59Z","Content":"\n\u003Cp\u003EAnother small discovery:\u003C/p\u003E\u003Cp\u003ETurns out penalties for failing contracts aren\u0027t automatically applied if a contract is cancelled by the player (which is a bit silly given it opens the door to exploits where a player can cancel a contract just before they fail it to avoid penalties). However, overriding PenalizeCancellation() and calling PenalizeFailure() within it resolves this.\u003C/p\u003E\u003Cp\u003EEDIT: Actually, if you are paying out an advance for a contract THAT (and only that) gets removed when the player cancels. I first noticed this on a contract where I was paying no advance but had penalties for failure attached, and just tried it out on one with an advanced payment. With no advance, nothing is deducted, with advance, only that is deducted. In both cases the failure penalties themselves are not applied.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-08-18T21:02:43Z\u0022 title=\u002208/18/2014 09:02  PM\u0022 data-short=\u00229 yr\u0022\u003EAugust 18, 2014\u003C/time\u003E by FlowerChild\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"malkuth","CreatedById":57414,"CreatedDateTime":"2014-08-18T21:28:18Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022FlowerChild\u0022 data-cite=\u0022FlowerChild\u0022\u003E\u003Cdiv\u003EIt might also be possible to do that through the contract system as contract parameters can have rewards for each individual one (see the \u0022Explore Body\u0022 contracts for reference). You could then have one parameter for setting up the station, which completes normally and pays a certain reward once, then another one which never completes but which pays out at the end of each day through its Update() function.\u003Cp\u003ENot sure how many advantages that would offer over Malkuth\u0027s approach, but might be a little more intuitive for the player to have the contract constantly on display, and might provide you with an easy save/load mechanism since the parameters for the contract (like the timer) could then be stored within the contract itself.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThat would work too, in fact if you have set amount of times set up, you could set up a parameter that follows some sort of countdown system you come up with. Each parameter you set up can be a certain time distance from the original Time when the countdown started.\u003C/p\u003E\u003Cp\u003ESo player puts station in orbit, you have a parameter that watches for this, when it finishes that parameter also starts a countdown based on 30 days each. Each 30 days you get a new payment.\u003C/p\u003E\u003Cp\u003EIf the contract is for 6 months you can have 6 more parameter set up each is 30 days from original time. So 0\u002B 30. 2nd 0 \u002B 60, 3rd 0 \u002B 90 (you will have to convert to seconds since thats what KSP follows).\u003C/p\u003E\u003Cp\u003EThat way each parameter you set up can be 30 days, and the player can keep tabs on where he is. The only downside is this will clutter up your Active contracts.\u003C/p\u003E\u003Cp\u003EYou could even keep it random if you wished. Set up the base contract for max 1 year, and make the amount of time random. So if random time is 3 months, only 3 months out of the year will generate for that contract.\u003C/p\u003E\u003Cp\u003EHave fun.\u003C/p\u003E\n"},{"CreatedByName":"FlowerChild","CreatedById":74289,"CreatedDateTime":"2014-08-18T21:36:34Z","Content":"\n\u003Cp\u003ETo avoid the contract-list clutter you *may* (I haven\u0027t tried this yet, but it looks like it\u0027s possible) be able to dynamically modify the parameters of the contract so that you only add the parameter for the next 30 days after the previous one is completed, and remove the previous one as well.\u003C/p\u003E\u003Cp\u003EThe contract list seems to be fairly robust in terms of updating to reflect changes in data. Like I have some contracts that are dependent on getting a specific Kerbal to specific places, which Kerbal it is determined on launch, and the list updates automatically to changes in title and such that reflect the Kerbal\u0027s name. Now, whether it would be able to handle parameters being added and removed on the fly is another story, but it\u0027s worth a shot.\u003C/p\u003E\u003Cp\u003EEDIT: Or, you may be able to create all the parameters at start and only display the titles of the ones that are active. I noticed the part test contracts actually has a hidden parameter that acts as the parent of the others, so I think making them invisible is possible. Again, doing so dynamically is another story and I haven\u0027t tested it myself, but might be safer and/or easier than dynamically creating and removing the parameters, to just hide or display them based on context.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-08-18T21:44:19Z\u0022 title=\u002208/18/2014 09:44  PM\u0022 data-short=\u00229 yr\u0022\u003EAugust 18, 2014\u003C/time\u003E by FlowerChild\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Arsonide","CreatedById":32604,"CreatedDateTime":"2014-08-18T21:52:14Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022FlowerChild\u0022 data-cite=\u0022FlowerChild\u0022\u003E\u003Cdiv\u003EJust a small addendum on this point:\u003Cp\u003EI don\u0027t *think* it\u0027s the actual titles that prevent repeating contracts, but rather the result of GetHashString(). I just created a repeating contract that has the same title over multiple instances (\u0022Conduct a weather survey\u0022), but which returns a different hash string for each (I based it on the GUID), and it appears I can generate as many instances of it as I would like.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EEven though I wasn\u0027t sure exactly what it did, I took no chances with this having overlap: return (this.Root.MissionSeed.ToString() \u002B this.Root.DateAccepted.ToString() \u002B this.ID);\u003C/p\u003E\u003Cp\u003EThis is for a parameter, a contract wouldn\u0027t need the third number there. I don\u0027t think there\u0027s much room for overlap there.\u003C/p\u003E\n"},{"CreatedByName":"DMagic","CreatedById":57416,"CreatedDateTime":"2014-08-19T01:44:22Z","Content":"\n\u003Cp\u003EI believe it\u0027s the Contract.ID (not the Guid, the long ID) field that gets checked. This doesn\u0027t get saved so I assume it is generated on load, but I think it takes into account both contract hash strings and child parameter hash strings.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022FlowerChild\u0022 data-cite=\u0022FlowerChild\u0022\u003E\u003Cdiv\u003EEDIT: Or, you may be able to create all the parameters at start and only display the titles of the ones that are active. I noticed the part test contracts actually has a hidden parameter that acts as the parent of the others, so I think making them invisible is possible.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EWhat do you mean by hidden? It has the PartTest parameter that is the parent of all the others, but that one is always visible in the contract window.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-08-19T01:46:48Z\u0022 title=\u002208/19/2014 01:46  AM\u0022 data-short=\u00229 yr\u0022\u003EAugust 19, 2014\u003C/time\u003E by DMagic\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"FlowerChild","CreatedById":74289,"CreatedDateTime":"2014-08-19T07:44:26Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022DMagic\u0022 data-cite=\u0022DMagic\u0022\u003E\u003Cdiv\u003EWhat do you mean by hidden? It has the PartTest parameter that is the parent of all the others, but that one is always visible in the contract window.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYeah, I mean the part test parameter. The part test contract itself is visible, but it looks like the parameter itself doesn\u0027t show up. There\u0027s an expandable list of notes instead, and I\u0027m not sure whether that\u0027s coming from the contract or the parameter. Looking at it again, you may be right though in that there\u0027s a \u0022test foo\u0022 item at the very top of the contract that may be associated with the parameter itself. On first look I think I had assumed that was associated with the contract.\u003C/p\u003E\u003Cp\u003EAnyways, just theorizing and throwing out ideas based on what I\u0027ve seen as I haven\u0027t tested it out myself.\u003C/p\u003E\n"},{"CreatedByName":"FlowerChild","CreatedById":74289,"CreatedDateTime":"2014-08-21T02:41:01Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022DMagic\u0022 data-cite=\u0022DMagic\u0022\u003E\u003Cdiv\u003EI believe the values can be found in GameVariables. I suppose you could just print out all of the floats in there to see their values, though I think the actual calculations are more complicated than that. \u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI started to dig into the GameVariables class today and just wanted to post emphasizing how much valuable info related to contracts is in there. I used it to zero out the reputation reward for recovering Kerbals (since that\u0027s so easily exploitable) for example in no time flat.\u003C/p\u003E\u003Cp\u003EI\u0027d highly recommend anyone modding contracts check it out.\u003C/p\u003E\n"},{"CreatedByName":"DMagic","CreatedById":57416,"CreatedDateTime":"2014-08-21T03:35:45Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022FlowerChild\u0022 data-cite=\u0022FlowerChild\u0022\u003E\u003Cdiv\u003EI started to dig into the GameVariables class today and just wanted to post emphasizing how much valuable info related to contracts is in there. I used it to zero out the reputation reward for recovering Kerbals (since that\u0027s so easily exploitable) for example in no time flat.\u003Cp\u003EI\u0027d highly recommend anyone modding contracts check it out.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI\u0027m not sure if I ever posted it here, but I\u0027ve mentioned it elsewhere. The GameVariable.GetContractDestinationWeight() method returns the CelestialBodyScienceParams RecoveryValue amount, the thing that determines how much science a vessel returned from a given planet is worth. The default values of which, along with all of the other ScienceParam values, can be found here: \u003Ca href=\u0022https://github.com/DMagic1/Science-Param-Loader/blob/master/ScienceParamLoader/ScienceParams.cfg\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/DMagic1/Science-Param-Loader/blob/master/ScienceParamLoader/ScienceParams.cfg\u003C/a\u003E\u003C/p\u003E\n"},{"CreatedByName":"Kulebron","CreatedById":80231,"CreatedDateTime":"2014-09-01T21:06:44Z","Content":"\n\u003Cp\u003E\u003Cspan style=\u0022text-decoration:line-through;\u0022\u003EI\u0027m reading the original post, and can\u0027t understand: how do you compile these cs files? Do you need MSVS or other IDE? Any chance to compile this on Linux?\u003C/span\u003E\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022text-decoration:line-through;\u0022\u003EGod, why there\u0027s no Python API yet...\u003C/span\u003E\u003C/p\u003E\u003Cp\u003Efound the monodevelop tutorial\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-09-02T17:24:37Z\u0022 title=\u002209/02/2014 05:24  PM\u0022 data-short=\u00229 yr\u0022\u003ESeptember 2, 2014\u003C/time\u003E by Kulebron\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"FlowerChild","CreatedById":74289,"CreatedDateTime":"2014-09-02T19:51:40Z","Content":"\n\u003Cp\u003EOk, I hope people are still following this thread as I just figured out something rather crucial about the contract system \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EI was noticing that as I was adding more and more contracts to the game, a lot of them were being generated only to be then removed by the contract system. There\u0027s a debug output that stock generates when this happens.\u003C/p\u003E\u003Cp\u003EPlaying around a bit, I figured out that the number of contracts *on offer* seems to be limited to a specific number per prestige level, that contracts above a certain prestige level are removed if the player\u0027s reputation is too low (I don\u0027t know the precise values involved as that would take a LOT of test cases to figure out), and that the number offered at a given prestige level seems to also be dependent on reputation.\u003C/p\u003E\u003Cp\u003ESo, with a bit of educated guess-work and a bunch of debugging output code, this is what I figured out:\u003C/p\u003E\u003Cp\u003EWhen a contract has its Generate() function called, it already has its prestige level set to the prestige level of contract the contract system wishes to generate. In other words, if a new trivial prestige contract would create a contract that would exceed the limit on the number of trivial contracts that should be present at any given time Generate() will NOT be called with the prestige level set to trivial.\u003C/p\u003E\u003Cp\u003EWhat this means is you should NOT return true from Generate() if you would be creating a contract at a prestige level other than the one specified. Either that, or you should tailor your contract generation so that it generates a contract only of the prestige level specified (i.e. you should NOT set it yourself).\u003C/p\u003E\u003Cp\u003EA simple example from my own code where I have a contract that I only want to generate at the trivial prestige level in case any of that wasn\u0027t clear:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E        protected override bool Generate()\u003Cbr\u003E        {\u003Cbr\u003E            if ( prestige != ContractPrestige.Trivial )\u003Cbr\u003E            {\u003Cbr\u003E                return false;\u003Cbr\u003E            }\u003Cbr\u003E\u003Cbr\u003E            // regular contract generation code here\u003Cbr\u003E        }\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EThis is probably also why when you create a bunch of custom contracts, certain stock ones stop being generated. The stock contracts are testing whether they should generate based on the prestige, while custom contracts that don\u0027t wind up saturating the system so that the stock ones no longer have room to generate in.\u003C/p\u003E\u003Cp\u003EAnyways, like I said, I really hope the other contract mod authors are still following this thread, as this seems to be a rather major thing about the way the system works, and I\u0027m still surprised I managed to figure it out given how less than obvious it is \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"DMagic","CreatedById":57416,"CreatedDateTime":"2014-09-02T20:40:54Z","Content":"\n\u003Cp\u003EIt seems like the mod contract glut is a problem that\u0027s not likely to go away. \u003C/p\u003E\u003Cp\u003EThere are a number of ways to generate fewer contracts of each type. One is to limit the number of each type as has been discussed before. Another is limiting the acceptable prestige rating as shown above (it would also be nice if the stock \u0022explore\u0022 contracts didn\u0027t permanently take up a 3 star slot...).\u003C/p\u003E\u003Cp\u003EI\u0027ve also been trying to delay the point when my contracts are given. Anyone playing a long career game will surely have plenty of opportunities to use any given contract type, so there\u0027s no reason to spam them with 5 or 6 DMagic contracts as soon as they complete the first launch.\u003C/p\u003E\u003Cp\u003EThe base Contract class has a some methods to determine which planets you\u0027ve been to, but they aren\u0027t very granular. GetBodies_Reached just returns all of the CelestialBodies you\u0027ve visited; entering their SOI is enough to mark them as \u0022reached\u0022. \u003C/p\u003E\u003Cp\u003EIf you want to get more specific you can use something like:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Epublic override bool MeetRequirements()\u003Cbr\u003E\t\t{\u003Cbr\u003E\t\t\treturn ProgressTracking.Instance.NodeComplete(new string[] { \u0022Minmus\u0022, \u0022ReturnFromOrbit\u0022 });\u003Cbr\u003E\t\t}\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EThis example is in the MeetRequirements() method, but I\u0027ve also been using them in Generate() too. This is the example from my asteroid contracts, you have to enter orbit around Minmus and return to Kerbin\u0027s surface before they will be generated (I figure this is a good demonstration of the ability to rendezvous with a relatively small target in a different orbit). \u003C/p\u003E\u003Cp\u003EYou can get really specific about the requirements for any contract type using these progressTracking nodes. You can use something like \u0022Jool\u0022, \u0022FlyBy\u0022 if you want to give contracts for Jool\u0027s moons. \u003C/p\u003E\u003Cp\u003EI\u0027m not sure what happens when other addons change the planet names, there might be a better way of specifying that (maybe use the flightglobals index to find the planet), but I think this is a good way to slow down contract generation, or just be more specific about what requirements you want before you start offering a contract.\u003C/p\u003E\n"},{"CreatedByName":"FlowerChild","CreatedById":74289,"CreatedDateTime":"2014-09-02T20:45:37Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022DMagic\u0022 data-cite=\u0022DMagic\u0022\u003E\u003Cdiv\u003E\u003Cp\u003EThere are a number of ways to generate fewer contracts of each type. One is to limit the number of each type as has been discussed before. Another is limiting the acceptable prestige rating as shown above (it would also be nice if the stock \u0022explore\u0022 contracts didn\u0027t permanently take up a 3 star slot...).\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThe thing is, from what I\u0027ve discovered, limiting the number of a type of contract isn\u0027t enough on its own.\u003C/p\u003E\u003Cp\u003EThe problem with doing this is that if it causes the contract system to exceed the number it wants at a particular prestige level, then *it will forcibly remove an existing contract on offer*.\u003C/p\u003E\u003Cp\u003EThis is obviously bad as it will force stock contracts out of the loop, and particularly bad for you guys that care about compatibility with other mods as it may force another mod\u0027s contract out of the game. Beyond that, it means the contract list will be in a constant state of flux from update to update as contracts get forced deleted then regenerated.\u003C/p\u003E\u003Cp\u003EIMO, we should probably NEVER be setting the prestige level of our own contracts for those reasons. Generate() isn\u0027t so much what the function name would imply, as it\u0027s more a request to generate a contract at a very specific prestige level. IMO, this would have been a heck of a lot clearer if prestige were passed in as a parameter, but it effectively functions as if it was.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022DMagic\u0022 data-cite=\u0022DMagic\u0022\u003E\u003Cdiv\u003E\u003Cp\u003EI\u0027ve also been trying to delay the point when my contracts are given. Anyone playing a long career game will surely have plenty of opportunities to use any given contract type, so there\u0027s no reason to spam them with 5 or 6 DMagic contracts as soon as they complete the first launch.\u003C/p\u003E\u003Cp\u003EThe base Contract class has a some methods to determine which planets you\u0027ve been to, but they aren\u0027t very granular. GetBodies_Reached just returns all of the CelestialBodies you\u0027ve visited; entering their SOI is enough to mark them as \u0022reached\u0022. \u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EFor this one, what I\u0027ve been doing is using the completion of \u0022Explore Body\u0022 contracts as an indication that the player has not only reached a particular body, but is also capable of performing basic operations around it.\u003C/p\u003E\u003Cp\u003EI have some commercial payload contracts which I only generate for particular bodies once the explore contract has been completed. In other cases, I have my own contracts whose completion I then make other contracts dependent upon.\u003C/p\u003E\u003Cp\u003ESo, you don\u0027t get a contract to attain orbit until you\u0027ve completed the one for reaching space or what have you. You can basically setup your own generation conditions through the other contracts you create.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-09-02T20:51:20Z\u0022 title=\u002209/02/2014 08:51  PM\u0022 data-short=\u00229 yr\u0022\u003ESeptember 2, 2014\u003C/time\u003E by FlowerChild\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Kulebron","CreatedById":80231,"CreatedDateTime":"2014-09-02T21:04:22Z","Content":"\n\u003Cp\u003EI managed to compile a dll with the code in the original post, then removed all the conditional closures returning false, etc, but still can\u0027t make this contract appear in the list.\u003C/p\u003E\u003Cp\u003EWhen is this Generate method called?\u003C/p\u003E\n"},{"CreatedByName":"FlowerChild","CreatedById":74289,"CreatedDateTime":"2014-09-26T20:50:53Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022DMagic\u0022 data-cite=\u0022DMagic\u0022\u003E\u003Cdiv\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003EPrestige: Trivial\t Significant\t  Exceptional\u003Cbr\u003ESun: \t    4\t\t\t5\t\t6\u003Cbr\u003EKerbin:     1\t\t\t1\t\t2\u003Cbr\u003EMun: \t    2\t\t\t2\t\t3\u003Cbr\u003EMinmus:     2\t\t\t3\t\t4\u003Cbr\u003EMoho: \t    7\t\t\t9\t\t10\u003Cbr\u003EEve: \t    5\t\t\t6\t\t8\u003Cbr\u003EDuna:       5\t\t\t6\t\t8\u003Cbr\u003EIke:\t    5\t\t\t6\t\t8\u003Cbr\u003EJool: \t    6\t\t\t8\t\t9\u003Cbr\u003ELaythe:     8\t\t\t10\t\t12\u003Cbr\u003EVall: \t    8\t\t\t10\t\t12\u003Cbr\u003EBop: \t    8\t\t\t10\t\t12\u003Cbr\u003ETylo:  \t    8\t\t\t10\t\t12\u003Cbr\u003EGilly: \t    6\t\t\t8\t\t9\u003Cbr\u003EPol: \t    8\t\t\t10\t\t12\u003Cbr\u003EDres: \t    6\t\t\t8\t\t9\u003Cbr\u003EEeloo: \t    10\t\t\t12\t\t15\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EA small discovery based on the above:\u003C/p\u003E\u003Cp\u003EThe mystery value that is governing all this is RecoveryValue in CelestialBodyScienceParams, which in turn can be accessed through any CelestialBody.\u003C/p\u003E\u003Cp\u003EAs DMagic pointed out, it is then modified both by contract prestige and the contract\u0027s agent with different agents having different multipliers to both funds and prestige.\u003C/p\u003E\u003Cp\u003EYou can directly modify contract payments per body through RecoveryValue, just keep in mind you will also be modifying the science payout for recovering a vessel after returning from that body at the same time. Bit messy, but at least there\u0027s a way to modify it.\u003C/p\u003E\n"}]}