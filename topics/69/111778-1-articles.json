{"TopicId":111778,"ForumId":69,"TopicTitle":"Help removing a bugged strut via the persistance file","CreatedByName":"WanderingKid","CreatedById":110855,"CreatedDateTime":"2015-06-02T21:21:27Z","PageNum":1,"Articles":[{"CreatedByName":"WanderingKid","CreatedById":110855,"CreatedDateTime":"2015-06-02T21:21:27Z","Content":"Hey guys,\n\nI\u0027m still running 0.90.0 but I\u0027m hoping someone can help me out here. I\u0027ve got a ship with a strut connector that\u0027s hanging off into the middle of nowhere. Might be a leftover from the original build, might be a problem with the undocking, but it\u0027s causing me all sorts of havoc.\n\nWhat I\u0027m hoping is instead of being handed a fish, someone can help me learn to do it... because the other ship (mirrored) has similar issues.\n\nI\u0027m in the persistence.sfs (backup copy made) and I can find the strut connector part. The problem is I only understand maybe a third of what I\u0027m looking at in here. Am I looking for a strut that\u0027s srfAttach = Parent? Can anyone help me out with what I need to locate in here? There are other struts on the craft I do need to keep, so I can\u0027t just rip them all off."},{"CreatedByName":"DuoDex","CreatedById":107061,"CreatedDateTime":"2015-06-02T21:35:45Z","Content":"Punted to Support (Stock).\n\nYou might have better luck ending the flight(s) from the Tracking Station, .sfs file editing is dangerous."},{"CreatedByName":"WanderingKid","CreatedById":110855,"CreatedDateTime":"2015-06-02T21:38:57Z","Content":"It\u0027s at Duna and is one of my main research vessels I just arrived with. It\u0027s worth the risk to me to try to keep coherency in my Let\u0027s Play. If the choice is detonate the ship, or try to fix it and if it fails miserably then detonate the ship, I\u0027m willing to put in the effort for the latter option."},{"CreatedByName":"Jason Patterson","CreatedById":44388,"CreatedDateTime":"2015-06-02T21:56:08Z","Content":"Editing a craft in a persistence file by hand is difficult at best. The problem comes from the way that parts are organized in the sfs file. The entire ship is just a list of parts with relationships identified by their placement in that list. The first is part 0, second is 1, and so on. Each part, except for the first, has a parent object to which it is connected (the first has itself as a parent.) \n\nFirst - if your ship is very large and has lots of parts, you may be out of luck as far as manual editing of the sfs file goes. Someone may have come up with a program to help do it in flight, but by hand it\u0027s just not going to happen.\n\nThe first challenge is identifying the problem part:\n\nYou would identify it by what it is (or is not) connected to. Struts are unusual in that their parent is the object that their second connection touches. If your vessel is relatively simple (i.e. few remaining parts) you can search through it for all of the struts and look for one that is attached in the way that your problem strut is. Your strut also might have some crazy number as its parent. Any properly placed strut is going to have **parent = (some number)** and **srfN = srfAttach, (same number as parent)**. \n\nIf none of the struts is obviously broken, you can see which parts are correctly connected by struts, find them in the list of parts, and identify the problem strut by process of elimination.\n\nThe second challenge is removing the problem part:\n\nIt may be that you get lucky and can simply delete the offending strut. If it happens to be near the bottom of the list in the vessel and none of the parts after it are connected, you can just delete it and all of the parts after that will be renumbered without effect. If there are connections among those parts though, you will have to identify their part numbers (by counting, one at a time, part by part through the vessel) and rebuild the ship\u0027s connections by hand. You\u0027ll need to change parent numbers and attachment numbers for any affected parts. It\u0027s a pain for a small ship and absolutely brutal for a large ship (honestly, you\u0027ll mess up and it just won\u0027t work if there are dozens of parts involved, save your time.)\n\nA much easier solution that may or may not suit your needs is to replace the offending strut with another part. Build a vessel with the same root object as in this ship (whatever the very first part in the vessel is.) Place a small object in an out of the way spot on its surface (like a thermometer) and launch it. Copy the entire PART section of the thermometer from that vessel and paste it over the entire PART section of the problem strut. Problem solved.\n\n**Edited \u003Ctime datetime=\u00222015-06-02T22:01:12Z\u0022 title=\u002206/02/2015 10:01  PM\u0022 data-short=\u00229 yr\u0022\u003EJune 2, 2015\u003C/time\u003E by Jason Patterson**"},{"CreatedByName":"WanderingKid","CreatedById":110855,"CreatedDateTime":"2015-06-02T22:10:34Z","Content":"\u003E \n\u003E Editing a craft in a persistence file by hand is difficult at best. The problem comes from the way that parts are organized in the sfs file. The entire ship is just a list of parts with relationships identified by their placement in that list. The first is part 0, second is 1, and so on. Each part, except for the first, has a parent object to which it is connected (the first has itself as a parent.)\n\nWell, that answers one of my major questions I was having trouble deciphering. For this alone, thank you. The rest, thank you a LOT. ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\n\u003E \n\u003E The first challenge is identifying the problem part:\n\u003E \n\u003E You would identify it by what it is (or is not) connected to. Struts are unusual in that their parent is the object that their second connection touches. If your vessel is relatively simple (i.e. few remaining parts) you can search through it for all of the struts and look for one that is attached in the way that your problem strut is. Your strut also might have some crazy number as its parent. Any properly placed strut is going to have **parent = (some number)** and **srfN = srfAttach, (same number as parent)**. \n\u003E \n\u003E If none of the struts is obviously broken, you can see which parts are correctly connected by struts, find them in the list of parts, and identify the problem strut by process of elimination.\n\nNone of them are obviously broken unfortunately.\n\n\u003E \n\u003E The second challenge is removing the problem part:\n\u003E \n\u003E It may be that you get lucky and can simply delete the offending strut. If it happens to be near the bottom of the list in the vessel and none of the parts after it are connected, you can just delete it and all of the parts after that will be renumbered without effect. If there are connections among those parts though, you will have to identify their part numbers (by counting, one at a time, part by part through the vessel) and rebuild the ship\u0027s connections by hand. You\u0027ll need to change parent numbers and attachment numbers for any affected parts. It\u0027s a pain for a small ship and absolutely brutal for a large ship (honestly, you\u0027ll mess up and it just won\u0027t work if there are dozens of parts involved, save your time.)\n\nI was afraid you\u0027d say this. I have a feeling I\u0027m going to have to bring it into a different save file just to locate the problem part.\n\n\u003E \n\u003E A much easier solution that may or may not suit your needs is to replace the offending strut with another part. Build a vessel with the same root object as in this ship (whatever the very first part in the vessel is.) Place a small object in an out of the way spot on its surface (like a thermometer) and launch it. Copy the entire PART section of the thermometer from that vessel and paste it over the entire PART section of the problem strut. Problem solved.\n\nMakes perfect sense.\n\nThank you VERY much for this. You\u0027ve given me enough to be able to root out the problem at least, and enough insight into how it\u0027s built to try to figure myself out."},{"CreatedByName":"WanderingKid","CreatedById":110855,"CreatedDateTime":"2015-06-02T22:50:44Z","Content":"\u003E First - if your ship is very large and has lots of parts, you may be out of luck as far as manual editing of the sfs file goes. Someone may have come up with a program to help do it in flight, but by hand it\u0027s just not going to happen.\n\n... I had REALLY hoped you were exaggerating on this. I\u0027ve got backups of the persistence file, but... yeah. Wow. Even part swaps are causing significant structural failures. I\u0027m not ready to give up but I\u0027m finally understanding why there\u0027s no good information on hacking this file out there other than for one-off values. There\u0027s no good way TO hack this file.\n\nI think I\u0027m going to have to start at the beginning. One object, determine what the settings mean (cid, uid, mid, istg, sgor, etc). Ho boy."},{"CreatedByName":"Jason Patterson","CreatedById":44388,"CreatedDateTime":"2015-06-02T23:20:15Z","Content":"\u003E \n\u003E ... I had REALLY hoped you were exaggerating on this. I\u0027ve got backups of the persistence file, but... yeah. Wow. Even part swaps are causing significant structural failures. I\u0027m not ready to give up but I\u0027m finally understanding why there\u0027s no good information on hacking this file out there other than for one-off values. There\u0027s no good way TO hack this file.\n\u003E I think I\u0027m going to have to start at the beginning. One object, determine what the settings mean (cid, uid, mid, istg, sgor, etc). Ho boy.\n\nIt\u0027s horrible, isn\u0027t it? I\u0027m surprised that a part swap is giving you issues though - typically if a part like a strut is replaced by another part at the same location in the save file, you\u0027ll lose the strut but it won\u0027t cause everything to go to pieces... If you\u0027d like to post a copy of your save file I can try to have a look at it. I don\u0027t know whether I\u0027d have any better luck than you have, honestly.\n\nOoooh, completely different option C here:\n\nReplace the entire vessel with a duplicate. I know you\u0027re working on a Let\u0027s Play with this save, so I can only assume you want to be honest with your save as much as is possible. Go through and record fuel, RCS, and oxidizer amounts in the tanks, and the identity of the crew in the vessel, then build a brand new copy of your ship and launch it. You shouldn\u0027t have to actually fly it, but make sure it\u0027s not clamped to the ground. To make your life easier, fill only the seats in the new vessel that are occupied in your broken vessel. Save the game and go into the sfs file. Find the new vessel and copy all of it from its first PART to the last brace of the last PART. Paste this over the corresponding section of the broken vessel. Do not delete the new vessel yet. Don\u0027t mess with either vessel\u0027s flight state information or ORBIT information at all. You would then go through and edit the new vessel\u0027s crew identities to match the original (Find all of the Kerman\u0027s and change their first names, basically.) Edit any fuel tanks to the correct amounts. At this point you should be able to load the game, end the new mission normally, and your existing mission *should* function as intended.\n\nETA: Or better, because I wasn\u0027t thinking clearly, build the new ship in a completely separate savegame, then it won\u0027t mess up your hiring/firing in your Let\u0027s Play. You\u0027ll still have to edit in the correct crew, of course.\n\n**Edited \u003Ctime datetime=\u00222015-06-02T23:29:05Z\u0022 title=\u002206/02/2015 11:29  PM\u0022 data-short=\u00229 yr\u0022\u003EJune 2, 2015\u003C/time\u003E by Jason Patterson**"},{"CreatedByName":"WanderingKid","CreatedById":110855,"CreatedDateTime":"2015-06-04T20:44:57Z","Content":"Following along with the idea of replacing the vessel, I pushed the vehicle into a unique save and located the problem struts. By hand. It was annoying. Also reset all the parents.\n\nHowever, I\u0027ve come to a very interesting result from that. The RCS and SAS control groups no longer function. Their values don\u0027t make sense to me offhand in the final section of the vessel info. Does anyone know if there\u0027s a reference for the control group values?\n\nIn particular, I\u0027m trying to figure out what these values mean/do:\n\n ACTIONGROUPS\n\n {\n\n Stage = False, 4902501.15629362\n\n Gear = True, 0\n\n Light = False, 0\n\n RCS = True, 9874925.55323911\n\n SAS = True, 4901838.39952709\n\nEdit: \n\nI am relatively sure these are timestamps, after exploring a new session. I shall expore that idea.\n\nEdit2: Hah hah! Yes, they are timestamps as to the time of activation and their state. It\u0027s done in # of seconds for the game length. If your timestamp is after the current gamelength (IE: you transported an old ship into a new file) you won\u0027t be able to adjust the state of the actiongroup.\n\none more oddity down. ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\n**Edited \u003Ctime datetime=\u00222015-06-04T22:14:25Z\u0022 title=\u002206/04/2015 10:14  PM\u0022 data-short=\u00229 yr\u0022\u003EJune 4, 2015\u003C/time\u003E by WanderingKid**"},{"CreatedByName":"WanderingKid","CreatedById":110855,"CreatedDateTime":"2015-06-09T07:21:47Z","Content":"Jason, wanted to thank you again for your help in this. You gave me enough information and ideas to resolve that I was able to eventually work out a solution and save a portion of my Let\u0027s Play. I won\u0027t say I flew them well after fixing them, but that\u0027s a WHOLE different problem. ![:blush:](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_embarrassed.gif)"}]}