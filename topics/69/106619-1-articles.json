{"TopicId":106619,"ForumId":69,"TopicTitle":"Graphical glitch on some two-sided parts","CreatedByName":"penduin","CreatedById":104440,"CreatedDateTime":"2015-05-01T17:37:39Z","PageNum":1,"Articles":[{"CreatedByName":"penduin","CreatedById":104440,"CreatedDateTime":"2015-05-01T17:37:39Z","Content":"KSP 1.0 and 1.0.1, Linux 64-bit non-Steam\n\nThe graphics glitch out when rendering some of the new parts:\n\n- Airstream Protective Shell (all sizes)\n\n- Service Bay (both sizes)\n\n![screenshot0.png](http://penduin.net/media/screenshot0.png)\n\nIt looks as though the meshes have incorrect normals or are not manifold. The error happens inconsistently per frame, leading to an odd shimmering effect. You can see such an effect here:\n\n[https://youtu.be/P01UvBOix3w?t=30m46s](https://youtu.be/P01UvBOix3w?t=30m46s)\n\n(That\u0027s not me, and it\u0027s an older KSP with mods, but the glitched-mesh effect on the clouds looks very similar.)\n\nThe glitched rendering does not happen on the mouseover thumbnail, only in the assembly area (attached or not).\n\nI run 64-bit Slackware 14.1 on an AMD64 with graphics on a Radeon HD 5450 using the stock open-source radeon driver.\n\nhardinfo output:\n\n[http://penduin.net/media/hardinfo_report.html](http://penduin.net/media/hardinfo_report.html)\n\nEDIT: This also happens with the fairings that get added when stacking a part below a heat shield.\n\n**Edited \u003Ctime datetime=\u00222015-05-01T21:45:15Z\u0022 title=\u002205/01/2015 09:45  PM\u0022 data-short=\u00229 yr\u0022\u003EMay 1, 2015\u003C/time\u003E by penduin**\n  \nadditional detail"},{"CreatedByName":"penduin","CreatedById":104440,"CreatedDateTime":"2015-05-01T18:18:41Z","Content":"Since these are all parts with both inside and outside surfaces, I wonder if the geometries are overlapping themselves. Rendering the \u0022back\u0022 of a surface would appear as transparent, and the glitched area which is visible/invisible could be floating point precision rounding where an inside surface is in the same location as an outside one.\n\nI\u0027ve seen this in other games too, where the meshes had duplicated vertices or other problems. Unity and my GL setup don\u0027t correct for such data, but I\u0027m guessing most newer/better video cards do. All other parts, including radial docking ports and other open-able bays, render correctly, so there seems to be something fishy going on specifically with these models.\n\nUnfortunately, that includes the custom-editable fairings, which are some of the most awesome new parts! :^) I\u0027m guessing those will be trickier to fix up than the static service bays..."},{"CreatedByName":"Claw","CreatedById":100668,"CreatedDateTime":"2015-05-02T01:56:10Z","Content":"What it actually looks like to me is that there are two copies overlaid on top of each other. There are some instances where 2x or higher symmetry modes will overlay two parts on the same node, instead of a single part.\n\nCan you confirm if you had symmetry 2x on or not? (it\u0027s on in the pic)\n\nCheers,\n\n~Claw"},{"CreatedByName":"Orion2020","CreatedById":142989,"CreatedDateTime":"2015-05-04T09:09:11Z","Content":"I confirm this glitch to appear in 1.0.2 on my Fedora 20 with radeon graphics drivers. 2x symmetry has nothing to do with that: it **was** disabled and aside of that the physics worked normally (i. e. the ship would explode if two parts were at the same place, but it didn\u0027t)."},{"CreatedByName":"penduin","CreatedById":104440,"CreatedDateTime":"2015-05-04T15:09:49Z","Content":"Thanks for the tip, Claw, but Orion2020 is right, symmetry or overlapping parts aren\u0027t the culprit. (Good catch seeing I had symmetry on in the screenshot, but I\u0027ve tried again making sure it was off and the effect is the same.)\n\nThis happens with some specific new-in-1.0 parts, and seems to be related to their mesh and/or texture data. My guess is that something \\_is\\_ overlapping to cause the bad rendering, but down at the normal or vertex level, not my part placement.\n\nI\u0027ve seen some other threads on what looks to be this same issue. Some have had success by switching to the binary blob driver, but I\u0027d love an actual fix instead. (My card\u0027s good enough to display every other model in the game without problems.) I\u0027d rather run with a few glitchy-looking parts than use the non-open driver."},{"CreatedByName":"sal_vager","CreatedById":16426,"CreatedDateTime":"2015-05-04T15:38:33Z","Content":"This has been reported several times now, AMD cards are having trouble with these and a few other parts, I don\u0027t know how to fix it yet.\n\nThis may be too low level to fix, or a fault in the driver as the open driver just does not have all the features of the proprietary driver."},{"CreatedByName":"penduin","CreatedById":104440,"CreatedDateTime":"2015-05-05T17:51:48Z","Content":"Some other drivers/cards don\u0027t exhibit this problem, but I still would bet there\u0027s something wrong (or at least different) with the specific models in question. Could be as simple as duplicate vertices (Blender has easy tools for removing those; I assume any other modeling software would too) or something a little more involved with normals or alignment, but I think it\u0027s more to do with that data than with any KSP code. The fact that many diver/card combinations render that data without artifacts doesn\u0027t mean there\u0027s not still something strange about it.\n\nAs I say, it\u0027s not a big deal - I can live with some flickering parts, but it\u0027s obnoxious since every other visual element of the game displays flawlessly. It\u0027s not as though these parts are meant to have some wild new shader or fancy effects. (Or am I wrong about that?)"},{"CreatedByName":"kolAflash","CreatedById":149953,"CreatedDateTime":"2015-08-19T17:44:18Z","Content":"Having this issue too. Everyone, let\u0027s report some system details so the Squad support can start fixing this.\n\nBy the way:\n\nAnyone from Squad reading this?\n\nIs there already a bug report here?\n\n[http://bugs.kerbalspaceprogram.com](http://bugs.kerbalspaceprogram.com)\n\nIf further information is needed, please tell me!\n\nI\u0027m experiencing the bug on the following system, running \u0022Launcher.x86\\_64\u0022.\n\nOS: Linux\n\n# uname -a\n\nLinux Trada 3.16.7-24-desktop #1 SMP PREEMPT Mon Aug 3 14:37:06 UTC 2015 (ec183cc) x86\\_64 x86\\_64 x86\\_64 GNU/Linux\n\n# cat /etc/issue\n\nWelcome to openSUSE 13.2 \u0022Harlequin\u0022 - Kernel \\r (\\l).\n\nCPU:\n\n# grep \u0027model name\u0027 /proc/cpuinfo | uniq -c\n\n 4 model name : AMD Phenom II X4 955 Processor\n\nGPU: \n\n# /sbin/lspci | grep VGA\n\n01:00.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Caicos [Radeon HD 6450/7450/8450 / R5 230 OEM]\n\nGPU drivers:\n\n# lsmod | grep drm\n\ndrm\\_kms\\_helper 65670 1 radeon\n\ndrm 335594 7 ttm,drm\\_kms\\_helper,radeon\n\n# glxinfo | grep -E \u0027direct rendering|OpenGL version string\u0027\n\ndirect rendering: Yes\n\nOpenGL version string: 3.0 Mesa 10.3.7\n\nRAM:\n\n# free -m\n\n total used free shared buffers cached\n\nMem: 12037 9530 2507 52 429 6214\n\n-/\u002B buffers/cache: 2886 9151\n\nSwap: 10239 20 10219"},{"CreatedByName":"sal_vager","CreatedById":16426,"CreatedDateTime":"2015-08-19T17:48:07Z","Content":"Hi kolAflash, do you also see this effect with the proprietary driver?"},{"CreatedByName":"kolAflash","CreatedById":149953,"CreatedDateTime":"2015-09-14T19:07:15Z","Content":"I don\u0027t use the proprietary driver and I really would like not to install it. Every time I had to use the proprietary driver since ever, it broke my X-Server configuration in some way.\n\nBut I tried to use the newest Mesa3D library. Sadly it didn\u0027t helped.\n\nOn the other hand, on my notebook (running same OS \u002B software) everything is fine. But the notebook has an Intel GPU instead of a Radeon GPU.\n\nFor details, please see this bug report:\n\n[http://bugs.kerbalspaceprogram.com/issues/4787#note-2](http://bugs.kerbalspaceprogram.com/issues/4787#note-2)\n\nP.S.\n\nIf it might help you to find the bug with the Opensource Radeon driver, I might give the proprietary driver a try and tell you if it shows the same bug. But I don\u0027t like to use the proprietary driver normally. Because usually the Opensource driver does a really fine job on my system.\n\n**Edited \u003Ctime datetime=\u00222015-09-14T19:29:55Z\u0022 title=\u002209/14/2015 07:29  PM\u0022 data-short=\u00228 yr\u0022\u003ESeptember 14, 2015\u003C/time\u003E by kolAflash**"},{"CreatedByName":"sal_vager","CreatedById":16426,"CreatedDateTime":"2015-09-14T19:12:23Z","Content":"Hi again KolAflash, can you please upload your KSP.log and Player.log to a file share site and post them here."},{"CreatedByName":"kolAflash","CreatedById":149953,"CreatedDateTime":"2015-09-18T15:03:05Z","Content":"Used a fresh KSP installation from Steam.\n\nstart command:\n\nenv LC\\_ALL=C LANG=C vblank\\_mode=0 force\\_s3tc\\_enable=true ./Launcher.x86\\_64\n\nBuild a Mk1-2 Command Pod with a small tank and 2,5m fairings,\n\nencapsulating the tank. Put the vehicle on the launch pad.\n\nBug appeared in the building facility and on the launch pad.\n\nKSP.log\n\n[http://pastebin.ca/3165019](http://pastebin.ca/3165019)\n\n~/.config/unity3d/Squad/Kerbal Space Program/Player.log\n\n[http://pastebin.ca/3165021](http://pastebin.ca/3165021)"},{"CreatedByName":"sal_vager","CreatedById":16426,"CreatedDateTime":"2015-09-18T15:55:37Z","Content":"Does this still happen when you run the KSP.x86\\_64 without additional commands?"},{"CreatedByName":"kolAflash","CreatedById":149953,"CreatedDateTime":"2015-09-18T18:53:07Z","Content":"I already tried starting Kerbal like this, but it didn\u0027t helped:\n\nenv LC\\_ALL=C LANG=C vblank\\_mode=0 force\\_s3tc\\_enable=true ./Launcher.x86\\_64\n\nenv LC\\_ALL=C LANG=C vblank\\_mode=1 force\\_s3tc\\_enable=false ./Launcher.x86\\_64\n\nenv LC\\_ALL=C LANG=C ./Launcher.x86\\_64\n\n./Launcher.x86\\_64\n\nI also tried setting the graphics (in the launcher) to maximum and to minimum.\n\nAnd I tried using KSP.x86 (my Launcher usually starts KSP.x86\\_64).\n\nAnd I tried enabling and disabling the 3D acceleration of my window manager (KDE - KWin).\n\nNevertheless, I think we have to search for the problem in 2 places:\n\n1. The graphics driver. At least about me I can say, that I have 2 computers with EXACTLY the same Linux installation. openSUSE 13.2, KDE, all updates/patches installed. But the bug only appears on the one with and AMD CPU and Radeon GPU. On the notebook with the Intel i7 CPU and GPU, everything is fine!\n\n2. The developers should have a look about what they did different when programming those \u0022modern\u0022 parts like \u0022Airstream Protective Shell\u0022. There must have been some difference in the development process (different tools used, different kind of texture format, ...) which causes those parts to graphically fail but all other parts to be displayed correctly.\n\nRegarding this post of you:\n\n[http://forum.kerbalspaceprogram.com/threads/117130-Service-bays-and-fairings-z-fighting?p=2202418\u0026viewfull=1#post2202418](https://forum.kerbalspaceprogram.com/threads/117130-Service-bays-and-fairings-z-fighting?p=2202418\u0026viewfull=1#post2202418)\n\nInstalling Mate would be pretty much effort. I got GNOME 3 installed and could use it for testing. But I really don\u0027t think that this would make a difference. Also, because my Intel-GPU notebook is using KDE and KWin too."},{"CreatedByName":"sal_vager","CreatedById":16426,"CreatedDateTime":"2015-09-18T19:02:50Z","Content":"Well it\u0027s pretty visibly clear that the fairings have an inner and an outer texture, the issue is that the driver is trying to draw them both which should not occur because usually the rear of a polygon is not rendered, the internal texture should not be drawn unless the camera is inside the fairing.\n\nBut because we can see it with some drivers and hardware suggests that the polygons of the model are being drawn incorrectly, so the texture is applied to the side facing the camera at all times, and because there is no appreciable gap in the meshes (no wall thickness) we see a Z order rendering conflict.\n\nCan you move your view inside the fairing and get a screenshot, I think it will be untextured."},{"CreatedByName":"kolAflash","CreatedById":149953,"CreatedDateTime":"2015-09-19T03:08:13Z","Content":"Here\u0027s a screenshot from inside a fairing, while standing on the launch-pad. It has textures, but it also has the bug.\n\n![screenshot212.png](http://s16.postimg.org/dcmy9s7k5/screenshot212.png)\n\n[http://postimg.org/image/4hm3z9irl/](http://postimg.org/image/4hm3z9irl/)\n\n[http://postimg.org/image/4hm3z9irl/91967292/](http://postimg.org/image/4hm3z9irl/91967292/)\n\nRegarding this other post of you (sal\\_vager).\n\n[http://forum.kerbalspaceprogram.com/threads/117130-Service-bays-and-fairings-z-fighting?p=2202294\u0026viewfull=1#post2202294](https://forum.kerbalspaceprogram.com/threads/117130-Service-bays-and-fairings-z-fighting?p=2202294\u0026viewfull=1#post2202294)\n\nI tried the new graphics drivers from:\n\n[http://download.opensuse.org/repositories/home:/pontostroy:/X11/openSUSE_13.2/](http://download.opensuse.org/repositories/home:/pontostroy:/X11/openSUSE_13.2/)\n\n(snapshot)\n\n[https://web.archive.org/web/20150919024231/http://download.opensuse.org/repositories/home:/pontostroy:/X11/openSUSE_13.2/x86_64/](https://web.archive.org/web/20150919024231/http://download.opensuse.org/repositories/home:/pontostroy:/X11/openSUSE_13.2/x86_64/)\n\nReplaced all installed system packages by the ones from that repo. Including:\n\nMesa-11.1~git20150917-1.1.x86\\_64.rpm\n\nlibX11-6-1.6.3-40.1.x86\\_64.rpm\n\nxf86-video-ati-7.99.99~git20150822-1.2.x86\\_64.rpm\n\nKSP.log\n\n[http://pastebin.ca/3165739](http://pastebin.ca/3165739)\n\n~/.config/unity3d/Squad/Kerbal Space Program/Player.log\n\n[http://pastebin.ca/3165740](http://pastebin.ca/3165740)\n\nSadly it didn\u0027t helped at all :-/\n\nRegarding this post of you.\n\n[http://forum.kerbalspaceprogram.com/threads/117130-Service-bays-and-fairings-z-fighting?p=2202418\u0026viewfull=1#post2202418](https://forum.kerbalspaceprogram.com/threads/117130-Service-bays-and-fairings-z-fighting?p=2202418\u0026viewfull=1#post2202418)\n\nI really don\u0027t think changing the display manager will help. But I tried logging in graphically with an empty session (without any desktop environment). Then I started metacity (the old Gnome2/Mate window manager) and tried KSP. Still the same bug :-/\n\nI also tested the AMD/Radeon proprietary drivers. They actually fixed the bug. But on the opposite they completely broke my display setup (luckily I back-upped it before) and actually gave me a worse performance than the open-source drivers. So I went back to the open-source drivers.\n\nBut: Now we know it\u0027s definitely the drivers!\n\nMaybe we should get in contact with the driver developers.\n\n[https://wiki.freedesktop.org/xorg/radeon/](https://wiki.freedesktop.org/xorg/radeon/)\n\n**Edited \u003Ctime datetime=\u00222015-09-19T05:04:54Z\u0022 title=\u002209/19/2015 05:04  AM\u0022 data-short=\u00228 yr\u0022\u003ESeptember 19, 2015\u003C/time\u003E by kolAflash**"},{"CreatedByName":"sal_vager","CreatedById":16426,"CreatedDateTime":"2015-09-19T11:06:50Z","Content":"We\u0027re getting closer to figuring this out I think.\n\nRather than displaying the mesh inside-out it looks to be drawing the back side of the mesh, these are untextured and they don\u0027t even have a material so they are just black.\n\nNormally any polygon facing away from the camera is not drawn, this is called [**back face culling**](https://en.wikipedia.org/wiki/Back-face_culling), but the Wikipedia page does say \u0022In scenes containing transparent polygons, rear facing polygons may become visible through the process of [**alpha composition**](https://en.wikipedia.org/wiki/Alpha_compositing)\u0022.\n\nI know all the KSP textures have an alpha channel, and fairings do use alpha blending to show semi-transparency in the editor."},{"CreatedByName":"kolAflash","CreatedById":149953,"CreatedDateTime":"2015-09-23T14:31:00Z","Content":"@sal\\_vager\n\nAny progress on this?\n\nMaybe \u0022Unity Technologies\u0022 can help.\n\nDid you try to make contact with the Xorg-Radeon driver developers? (I can do so if you wish)"},{"CreatedByName":"sal_vager","CreatedById":16426,"CreatedDateTime":"2015-09-23T18:24:12Z","Content":"Nothing yet unfortunately, but be my guest."},{"CreatedByName":"kolAflash","CreatedById":149953,"CreatedDateTime":"2015-09-24T12:11:30Z","Content":"I just opened a bug report for the Radeon open source Linux driver. Let\u0027s see what the Radeon driver developers say about this.\n\n[https://bugs.freedesktop.org/show_bug.cgi?id=92101](https://bugs.freedesktop.org/show_bug.cgi?id=92101)\n\nThey\u0027ll probably need some way to test this. Unfortunately the KSP demo doesn\u0027t seem to have fairings, so one of the driver developers may need a full version of KSP."}]}