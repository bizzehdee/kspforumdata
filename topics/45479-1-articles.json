{"TopicId":45479,"ForumId":29,"TopicTitle":"How do I use Events (that I can\u0026#039;t override)?","CreatedByName":"Tahvohck","CreatedById":82067,"CreatedDateTime":"2013-09-09T23:57:43Z","PageNum":1,"Articles":[{"CreatedByName":"Tahvohck","CreatedById":82067,"CreatedDateTime":"2013-09-09T23:57:43Z","Content":"\n\u003Cp\u003EI\u0027ve searched around a bit (probably not enough), but I can\u0027t find anything dealing with how to use events that aren\u0027t override-able based on the class you extend--that is, I can override, for example OnFixedUpdate on a PartModule just fine, but don\u0027t know how to get access to, say, OnVesselChange--so I\u0027ve given up searching for now and decided to just ask.\u003C/p\u003E\u003Cp\u003EI know that the GameEvents class has a \u003Cem\u003Elist\u003C/em\u003E of all the events, but I don\u0027t know how to register code to them. (I\u0027ll admit, I\u0027m new to C#, so this may be where I\u0027m going wrong.) I\u0027m currently extending MonoBehaviour and I want to access, among others, these events:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cul\u003E\u003Cli\u003EOnVesselChange\u003Cbr\u003EonCrewOnEva\u003Cbr\u003EonCrewBoardVessel\u003Cbr\u003EonHideUI\u003Cbr\u003EonJointBreak\u003Cbr\u003EonPartCouple\u003C/li\u003E\u003C/ul\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EShould I change what I\u0027m extending, or is there a way (delegates come to mind, but I don\u0027t see how to make those work) to register a method to the event so I don\u0027t have to override it?\u003C/p\u003E\n"},{"CreatedByName":"Faark","CreatedById":69775,"CreatedDateTime":"2013-09-10T00:22:04Z","Content":"\n\u003Cp\u003E*Sigh*, doing the research might would have taken a lot less time than writing this thread^^\u003C/p\u003E\u003Cp\u003EAssuming that you use visual studio: Type GameEvents.onHideUI into your function. Set the cursor into \u0022onHideUI\u0022 and press F12. You will see the generated class layout for where \u0022onHideUI\u0022 is defined. The interesting part is \u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E    public static EventVoid onHideUI;\u003C/pre\u003E\u003Cp\u003E You notice its type is EventVoid. Cursor into that term and F12, again. You now see the public methods of an EventVoid class. Most of them are not interesting, but Add(...) is. It takes an EventVoid.OnEvent, and F12 will turn out it is nothing an (imo) badly named empty delegate. So that is where to put your delegate.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003EGameEvents.onHideUI.Add( ()=\u0026gt;{\u003Cbr\u003E  /* my code */\u003Cbr\u003E});\u003Cbr\u003E/*or*/\u003Cbr\u003EGameEvents.onHideUI.Add(this.MyObjectsMethod);\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-09-10T00:25:12Z\u0022 title=\u002209/10/2013 12:25  AM\u0022 data-short=\u002210 yr\u0022\u003ESeptember 10, 2013\u003C/time\u003E by Faark\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Tahvohck","CreatedById":82067,"CreatedDateTime":"2013-09-10T09:49:13Z","Content":"\n\u003Cp\u003EHi, thanks for being condescending!\u003C/p\u003E\u003Cp\u003EThat was rude, but in fairness, so was your reply. I \u003Cem\u003Edid\u003C/em\u003E do research, and while I saw the Add() function, and did in fact assume it was for adding code, only onHideUI has the type EventVoid. OnVesselChange has type \u0026lt;Vessel\u0026gt;, on both its Add() and its definition, yet this code:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E//inside another function\u003Cbr\u003EGameEvents.onVesselChange.Add(HOOK_VesselChange);\u003Cbr\u003E\u003Cbr\u003Epublic static Vessel HOOK_VesselChange() { \u003Cbr\u003E\t\tprint(\u0022Vessel changed.\u0022);\u003Cbr\u003E\t\treturn FlightGlobals.ActiveVessel;\u003Cbr\u003E}\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003Erefuses to compile, with the error \u0022The best overloaded match for \u0027EventData\u0026lt;Vessel\u0026gt;.Add(EventData\u0026lt;Vessel\u0026gt;.OnEvent)\u0027 has some invalid arguments\u0022 and as someone relatively new to passing functions as variables, that doesn\u0027t help at all.\u003C/p\u003E\u003Cp\u003EThat\u0027s not even mentioning the more complex onCrewOnEva(), which has the type \u0026lt;GameEvents.FromToAction \u0026lt;Part, Part\u0026gt;\u0026gt; \u003Cem\u003Eor\u003C/em\u003E the fact that I don\u0027t want most of the code I\u0027ll be calling on these events to have to return the expected type just to get it to work, which is what the documentation is implying I\u0027d have to do (to me, at least).\u003C/p\u003E\u003Cp\u003E...\u003C/p\u003E\u003Cp\u003EOf course, after a bit more fiddling around, I realize that the event is passing said types \u003Cem\u003Eto\u003C/em\u003E the function, not expecting it of them; but still, while I\u0027m glad for the help you could have done it in a kinder way.\u003C/p\u003E\u003Cp\u003EFor anyone having the same problem I was having, and using the example above, this is what you\u0027d do:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E//inside another function\u003Cbr\u003EGameEvents.onVesselChange.Add(HOOK_VesselChange);\u003Cbr\u003E\u003Cbr\u003Epublic static void HOOK_VesselChange(Vessel v) { \u003Cbr\u003E\t\tprint(\u0022Vessel changed.\u0022);\u003Cbr\u003E}\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n"},{"CreatedByName":"Tahvohck","CreatedById":82067,"CreatedDateTime":"2013-09-10T09:54:34Z","Content":"\n\u003Cp\u003EAlso of note (here\u0027s expecting this to show up \u003Cem\u003Ebefore\u003C/em\u003E my other reply, but whatever) is that last time I tried to use Lambda functions, KSP wigged out and (I think? Don\u0027t remember the specific error) started throwing null references like crazy.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E//sumOxygen = connectedOxygen.Sum(res =\u0026gt; res.amount);\u003Cbr\u003E//sumCO2 = connectedCO2.Sum(res =\u0026gt; res.amount);\u003Cbr\u003E//sumWater = connectedWater.Sum(res =\u0026gt; res.amount);\u003Cbr\u003E//sumSnacks = connectedSnacks.Sum(res =\u0026gt; res.amount);\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003ECommented out because I want it in there as reference and am using a different (more expensive?) method instead. Supposedly Kethane used this method to sum the resources on the ship, but like I said it\u0027s not working for me.\u003C/p\u003E\n"},{"CreatedByName":"malkuth","CreatedById":57414,"CreatedDateTime":"2013-09-10T13:04:20Z","Content":"\n\u003Cp\u003EHm missionController uses some of these I will list there codes to maybe help you out if you need to use some of the other events.. To get an idea.. The docking one or couple might interest you later if you want to know when a vessel docks. There some others you can use.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003EGameEvents.onLaunch.Add(this.onLaunch);\u003Cbr\u003E            GameEvents.onVesselChange.Add(this.onVesselChange);\u003Cbr\u003E            GameEvents.onCrewKilled.Add(this.onCrewKilled);\u003Cbr\u003E            GameEvents.onVesselDestroy.Add(this.onVesselDestroy);\u003Cbr\u003E            GameEvents.onGameSceneLoadRequested.Add(this.onGameSceneLoadRequested);\u003Cbr\u003E            GameEvents.onCrash.Add(this.onCrash);\u003Cbr\u003E            GameEvents.onCollision.Add(this.onCollision);\u003Cbr\u003E            GameEvents.onPartCouple.Add(this.onPartCouple);\u003Cbr\u003E            GameEvents.onVesselRecovered.Add(this.onRecovered);\u003Cbr\u003E            GameEvents.onPlanetariumTargetChanged.Add(this.onTargeted);\u003Cbr\u003E            GameEvents.onVesselCreate.Add(this.onCreate);\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003Emight be iterested in knowing that when nobody originally wrote this code he put a \u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003EDontDestroyOnLoad(this);\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003Ewith these. And placed it under the Awake() to start these up on startup.\u003C/p\u003E\u003Cp\u003Ethere are a massive amount of gameEvents though. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif\u0022 alt=\u0022;)\u0022\u003E\u003C/p\u003E\u003Cp\u003EDon\u0027t know if this will help but oncouple has the same parameters as the EVA event.\u003C/p\u003E\u003Cp\u003Ethis is how it was written for MC. \u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E/// \u0026lt;summary\u0026gt;\u003Cbr\u003E        /// This event is fired when two vessels dock.\u003Cbr\u003E        /// \u0026lt;/summary\u0026gt;\u003Cbr\u003E        /// \u0026lt;param name=\u0022action\u0022\u0026gt;Action.\u0026lt;/param\u0026gt;\u003Cbr\u003E        private void onPartCouple(GameEvents.FromToAction\u0026lt;Part, Part\u0026gt; action) {\u003Cbr\u003E            if (HighLogic.LoadedSceneIsFlight) {\u003Cbr\u003E                eventFlags = eventFlags.Add (EventFlags.DOCKED);\u003Cbr\u003E                Debug.LogError (\u0022Docked FROM: \u0022 \u002B action.from.vessel.vesselName);\u003Cbr\u003E                Debug.LogError (\u0022Docked TO: \u0022 \u002B action.to.vessel.vesselName);\u003Cbr\u003E\u003Cbr\u003E                Debug.LogError (\u0022Docked FROM ID: \u0022 \u002B action.from.vessel.id.ToString());\u003Cbr\u003E                Debug.LogError (\u0022Docked TO ID: \u0022 \u002B action.to.vessel.id.ToString());\u003Cbr\u003E            }\u003Cbr\u003E        }\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003Ealso there is a eva from Vessel to you can use. its called isEVA.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-09-10T13:28:50Z\u0022 title=\u002209/10/2013 01:28  PM\u0022 data-short=\u002210 yr\u0022\u003ESeptember 10, 2013\u003C/time\u003E by malkuth\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Faark","CreatedById":69775,"CreatedDateTime":"2013-09-10T14:20:16Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Tahvohck\u0022 data-cite=\u0022Tahvohck\u0022\u003E\u003Cdiv\u003EAlso of note (here\u0027s expecting this to show up \u003Cem\u003Ebefore\u003C/em\u003E my other reply, but whatever) is that last time I tried to use Lambda functions, KSP wigged out and (I think? Don\u0027t remember the specific error) started throwing null references like crazy.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EDamn it, you are right... totally forgot about that. GameEvent can not handle static functions. I \u003Ca href=\u0022http://bugs.kerbalspaceprogram.com/issues/1265\u0022 rel=\u0022external nofollow\u0022\u003Efiled a bug\u003C/a\u003E about that a week ago, but you know... its just a mod-issue...\u003C/p\u003E\u003Cp\u003ELambdas are a little tricky, since the compiler converts it behind the scene to what it thinks is the best depending on your usage of variables... a static function, method of the current class or an entire new class.\u003C/p\u003E\n"},{"CreatedByName":"Tahvohck","CreatedById":82067,"CreatedDateTime":"2013-09-11T09:12:12Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022malkuth\u0022 data-cite=\u0022malkuth\u0022\u003E\u003Cdiv\u003E... And placed it under the Awake() to start these up on startup.\u003Cp\u003Ethere are a massive amount of gameEvents though. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif\u0022 alt=\u0022;)\u0022\u003E\u003C/p\u003E\u003Cp\u003EDon\u0027t know if this will help but oncouple has the same parameters as the EVA event.\u003C/p\u003E\u003Cp\u003Ethis is how it was written for MC. \u003C/p\u003E\u003Cp\u003E...\u003C/p\u003E\u003Cp\u003Ealso there is a eva from Vessel to you can use. its called isEVA.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EStart() is actually a better place to put it all, I\u0027d argue, because then you know for a fact everything else has at least initialized. And the massive amount of events is what I\u0027m counting on. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif\u0022 alt=\u0022:P\u0022\u003E\u003C/p\u003E\u003Cp\u003EThanks for the isEva note! That\u0027ll make my life all sorts of easier. Now I just need to figure out the proper syntax for dynamic resource adding.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Faark\u0022 data-cite=\u0022Faark\u0022\u003E\u003Cdiv\u003EDamn it, you are right... totally forgot about that. GameEvent can not handle static functions. I filed a bug about that a week ago, but you know... its just a mod-issue...\u003Cp\u003ELambdas are a little tricky, since the compiler converts it behind the scene to what it thinks is the best depending on your usage of variables... a static function, method of the current class or an entire new class. \u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EOh, so that was part of my problem... don\u0027t use static in GameEvent, noted. Alright then, now that I\u0027ve got it working... time to rewrite all my code! D:\u003C/p\u003E\u003Cp\u003EFigures that this\u0027d make me have to restructure it.\u003C/p\u003E\n"}]}