{"TopicId":43707,"ForumId":34,"TopicTitle":"kOS Scriptable Autopilot System 0.9","CreatedByName":"KevinLaity","CreatedById":68050,"CreatedDateTime":"2013-08-24T14:28:17Z","PageNum":78,"Articles":[{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2013-11-20T01:22:02Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Camacha\u0022 data-cite=\u0022Camacha\u0022\u003E\u003Cdiv\u003EI noticed that the aforementioned lag spikes happen pretty much every time when a script is repeatedly looping through an \u003Cem\u003Euntil\u003C/em\u003E loop. Every second or sometimes every two seconds, the game will freeze for a tenth of a second or so. The simulation does not seem affected, but when it gets intense it can be very annoying.\u003Cp\u003ELike I said, I have a fairly meaty CPU, so I can not imagine that being the cause of the problem.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ESo I\u0027m glad it\u0027s not just me. I get this too in an until loop. One symptom is that if the engines are thrusting you\u0027ll hear them go schhhhh...schhhhhh..schhhhh..schhhhh instead of just a steady ssssschhhhhhhhhhhhhhhhhhhhhhhhhh.\u003C/p\u003E\n"},{"CreatedByName":"Camacha","CreatedById":59088,"CreatedDateTime":"2013-11-20T03:01:51Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Steven Mading\u0022 data-cite=\u0022Steven Mading\u0022\u003E\u003Cdiv\u003ESo I\u0027m glad it\u0027s not just me. I get this too in an until loop. One symptom is that if the engines are thrusting you\u0027ll hear them go schhhhh...schhhhhh..schhhhh..schhhhh instead of just a steady ssssschhhhhhhhhhhhhhhhhhhhhhhhhh.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EHave you found any solutions? Like I said before, I find that adding a wait \u003Cem\u003E0.05\u003C/em\u003E or \u003Cem\u003E0.1\u003C/em\u003E to the loops alleviates the worst of it, but it still occurs and it slows the speed or resolution of the loop down. Sometimes that is fine, but at other times I really would like to have that calculative power.\u003C/p\u003E\u003Cp\u003EI have a feeling that it sometimes gets progressively worse. Have you noticed this?\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022font-size:8px;\u0022\u003EI have not noticed the sound yet, as I am currently playing on a system with no sound. That will change soon, but for now it is quiet at KSC.\u003C/span\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-11-20T03:07:47Z\u0022 title=\u002211/20/2013 03:07  AM\u0022 data-short=\u002210 yr\u0022\u003ENovember 20, 2013\u003C/time\u003E by Camacha\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2013-11-20T03:55:54Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Camacha\u0022 data-cite=\u0022Camacha\u0022\u003E\u003Cdiv\u003EHave you found any solutions? Like I said before, I find that adding a wait \u003Cem\u003E0.05\u003C/em\u003E or \u003Cem\u003E0.1\u003C/em\u003E to the loops alleviates the worst of it, but it still occurs and it slows the speed or resolution of the loop down. Sometimes that is fine, but at other times I really would like to have that calculative power.\u003Cp\u003EI have a feeling that it sometimes gets progressively worse. Have you noticed this?\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYes. But once I make the UNTIL loop \u0022let go\u0022 the progression stops getting worse. I\u0027ve tried doing all the work I can in lock expressions just so I can make the loops wait slowly without it hurting anything.\u003C/p\u003E\n"},{"CreatedByName":"Camacha","CreatedById":59088,"CreatedDateTime":"2013-11-20T05:29:06Z","Content":"\n\u003Cp\u003EOkay, this is weird. I have seen for a number of times now that two kOS units interact somehow. \u003C/p\u003E\u003Cp\u003E- I have two seperate craft on the ground next to each other. I take off with one and leave it hovering via kOS dead steady at a certain height. I switch to the next craft, and a couple of times the second one with the same program would just start oscillating while a single craft never oscillates unprovoked. The first craft then joins in, spontaneously . The really weird thing is that when I switch back to the first craft, it is rock steady again, while the first one seems to oscillate more. Switching back and forth shows the same thing again and again.\u003C/p\u003E\u003Cp\u003E- I do the same thing with hovering and switching. Now the first craft takes off at full speed as soon as I start the program of the second, heading off into the distance. Even is kOS would stop working, the throttle would be 0 instead of 1.\u003C/p\u003E\u003Cp\u003E- My craft start crashing randomly right at the start. They did not do this before with the same script. Upon a menu exit and reload the problem is gone.\u003C/p\u003E\u003Cp\u003E- One craft hovers, the other crashes, first craft crashes too.\u003C/p\u003E\u003Cp\u003EThe weird thing is that this does not happen consistently. I have hovered two craft together without a problem on multiple occasions. As long as you make sure not too stray to far from the other craft it should be fine. I have a feeling that variables or certain circumstances persist that should not - until a game restart or something similar. I have had incidents before where craft performance was inexplicitly down, which resolved itself magically later.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Steven Mading\u0022 data-cite=\u0022Steven Mading\u0022\u003E\u003Cdiv\u003EYes. But once I make the UNTIL loop \u0022let go\u0022 the progression stops getting worse. I\u0027ve tried doing all the work I can in lock expressions just so I can make the loops wait slowly without it hurting anything.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EHuh, funny. I was actually avoiding \u003Cem\u003Elock\u003C/em\u003E expressions as they run every cycle. Do you mean you use them to avoid the \u003Cem\u003Euntil\u003C/em\u003E loop, or so that you can use a cycle-slowing \u003Cem\u003Ewait\u003C/em\u003E without too much damage? I guess either is a valid strategy, although I think the first one is a safer way to go as I am not sure whether \u003Cem\u003Ewait\u003C/em\u003E eliminates the slowdown or simply extends the time before it becomes a problem.\u003C/p\u003E\u003Cp\u003EUnfortunately breaking the loop is not enough on its own for me; not even reverting the flight or going back to the start menu means a clean slate. The problem seems less severe after a revert, but still persists.\u003C/p\u003E\u003Cp\u003EEdit: or you could use \u003Cem\u003Ewait until\u003C/em\u003E in combination with \u003Cem\u003Elock\u003C/em\u003E, but I am unsure whether that causes the same problems or not. Using seperate programs instead of \u003Cem\u003Euntil\u003C/em\u003E loops would also work, I guess.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-11-20T06:06:50Z\u0022 title=\u002211/20/2013 06:06  AM\u0022 data-short=\u002210 yr\u0022\u003ENovember 20, 2013\u003C/time\u003E by Camacha\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2013-11-20T05:39:40Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Camacha\u0022 data-cite=\u0022Camacha\u0022\u003E\u003Cdiv\u003E\u003Cp\u003EHuh, funny. I was actually avoiding \u003Cem\u003Elock\u003C/em\u003E expressions as they run every cycle.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThey used to but they don\u0027t anymore. Now they\u0027re implemented much more efficiently. Now they run each time they\u0027re mentioned in an expression, but NOT run when they aren\u0027t mentioned. If you say \u0022lock x to (big math expression here).\u0022 on line 1, and then only use \u0027x\u0027 in an expression in two places - on line 10 and on line 20, then the \u0022big math expression here\u0022 is only executing at line 10 and line 20. (not at line 2,3,4,5,6,7,8,9,11,12,13,14,15,16,17,18, or 19).\u003C/p\u003E\n"},{"CreatedByName":"adammada","CreatedById":29884,"CreatedDateTime":"2013-11-20T08:54:08Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003E\u003Cp\u003EThey used to but they don\u0027t anymore. Now they\u0027re implemented much more efficiently. Now they run each time they\u0027re mentioned in an expression, but NOT run when they aren\u0027t mentioned.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EAHA so its a feature, not a bug.\u003C/p\u003E\u003Cp\u003EI wanted do do something like that (basically Interrupt ReQuest):\u003C/p\u003E\u003Cp\u003ESET doautostage TO false.\u003C/p\u003E\u003Cp\u003ELOCK doautostage TO stage:liquidfuel \u0026lt; 0.1.\u003C/p\u003E\u003Cp\u003EON doautostage RUN autostage.\u003C/p\u003E\u003Cp\u003Eand noticed that it don\u0027t work, unless i keep using doautostage like PRINT doautostage. Which denied whole concept, because if i need to use it everywhere i can just run program which will check it by IF, not LOCK.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-11-20T08:56:36Z\u0022 title=\u002211/20/2013 08:56  AM\u0022 data-short=\u002210 yr\u0022\u003ENovember 20, 2013\u003C/time\u003E by adammada\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"aNewHope","CreatedById":76088,"CreatedDateTime":"2013-11-20T14:32:51Z","Content":"\n\u003Cp\u003EI have a question: \u003C/p\u003E\u003Cp\u003EIs there any easy way of locking a vector to your up-direction? maybe the unit vector or your vertical speed as vector.\u003C/p\u003E\u003Cp\u003EThis would solve a lot of problems right now, as it would bring an easy way of getting your 6 orbital directions with it. \u003C/p\u003E\u003Cp\u003ECrossproduct of up and prograde --\u0026gt; normal vector.\u003C/p\u003E\u003Cp\u003ECrossproduct of normal vector and retrograde --\u0026gt; radial out.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-11-20T14:36:40Z\u0022 title=\u002211/20/2013 02:36  PM\u0022 data-short=\u002210 yr\u0022\u003ENovember 20, 2013\u003C/time\u003E by aNewHope\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"wingnut","CreatedById":57702,"CreatedDateTime":"2013-11-20T15:15:15Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022baloan\u0022 data-cite=\u0022baloan\u0022\u003E\u003Cdiv\u003EI\u0027ve uploaded the maneuvering scripts to the \u003Ca href=\u0022http://kos.wikia.com/wiki/Maneuvering_modules\u0022 rel=\u0022external nofollow\u0022\u003EkOS wiki\u003C/a\u003E. Features:\u003Cp\u003E1. add maneuver node at periapsis for changing apopsis altitude (more fuel efficient) \u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Erun per1(mun:altitude). \u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EBaloan, which formula did you use to calculate the deltav for the periapsis node to raise apoapsis?\u003C/p\u003E\u003Cp\u003EI\u0027m trying to create a node at periapsis with the \u003Ca href=\u0022https://en.wikipedia.org/wiki/Hohmann_transfer_orbit#Calculation\u0022 rel=\u0022external nofollow\u0022\u003EHohmann transfer orbit formula\u003C/a\u003E but the projected apoapsis always turns out to be higher than specified in the parameter, this is my script launched from a low Kerbin orbit with an eccentricity of roughly 0.03:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003EDECLARE PARAMETER x.\u003Cbr\u003ESET r TO 600000.\u003Cbr\u003ESET sma TO (APOAPSIS\u002B2*r\u002BPERIAPSIS)/2.\u003Cbr\u003ESET gm TO 3531600000000.\u003Cbr\u003ESET dv1 TO SQRT(gm/sma)*(SQRT(2*(x\u002Br)/(sma\u002Bx\u002Br))-1).\u003Cbr\u003EADD NODE(TIME:SECONDS \u002B ETA:PERIAPSIS,0,0,dv1).\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022https://upload.wikimedia.org/math/b/4/0/b409dfcc61805f4410dc95562fe5bc92.png\u0022 alt=\u0022b409dfcc61805f4410dc95562fe5bc92.png\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2013-11-20T16:25:01Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022aNewHope\u0022 data-cite=\u0022aNewHope\u0022\u003E\u003Cdiv\u003EI have a question: \u003Cp\u003EIs there any easy way of locking a vector to your up-direction? maybe the unit vector or your vertical speed as vector.\u003C/p\u003E\u003Cp\u003EThis would solve a lot of problems right now, as it would bring an easy way of getting your 6 orbital directions with it. \u003C/p\u003E\u003Cp\u003ECrossproduct of up and prograde --\u0026gt; normal vector.\u003C/p\u003E\u003Cp\u003ECrossproduct of normal vector and retrograde --\u0026gt; radial out.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI\u0027ve needed this in my scripts too. So when I worked out a way I wrote it down here:\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022http://kos.wikia.com/wiki/Tutorial_with_example_-_Conversion_from_Directions_to_XYZs\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://kos.wikia.com/wiki/Tutorial_with_example_-_Conversion_from_Directions_to_XYZs\u003C/a\u003E\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022http://kos.wikia.com/wiki/Tutorial_-_getting_normal_vector\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://kos.wikia.com/wiki/Tutorial_-_getting_normal_vector\u003C/a\u003E\u003C/p\u003E\n"},{"CreatedByName":"CrAzY GeNiUs","CreatedById":93837,"CreatedDateTime":"2013-11-20T20:46:09Z","Content":"\n\u003Cp\u003ENeed help ! ! ! \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cry.gif\u0022 alt=\u0022;.;\u0022\u003E\u003C/p\u003E\u003Cp\u003Eset p to 0.\u003C/p\u003E\u003Cp\u003Eprint p.\u003C/p\u003E\u003Cp\u003E0\u003C/p\u003E\u003Cp\u003Eif altitude \u0026gt; 1000 {set p to 1.}. // I\u0027m on ALTITUDE 1358 m.\u003C/p\u003E\u003Cp\u003Eprint p.\u003C/p\u003E\u003Cp\u003E1\u003C/p\u003E\u003Cp\u003Eif altitude \u0026lt; 1000 {set p to 2.}. // I\u0027m on ALTITUDE 589 m.\u003C/p\u003E\u003Cp\u003Eprint p.\u003C/p\u003E\u003Cp\u003E1\u003C/p\u003E\u003Cp\u003EWTF ! ! ! ! ! ! ! ! ! ! ! !\u003C/p\u003E\u003Cp\u003E HELP\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-11-21T12:34:00Z\u0022 title=\u002211/21/2013 12:34  PM\u0022 data-short=\u002210 yr\u0022\u003ENovember 21, 2013\u003C/time\u003E by CrAzY GeNiUs\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2013-11-20T21:06:54Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022CrAzY GeNiUs\u0022 data-cite=\u0022CrAzY GeNiUs\u0022\u003E\u003Cdiv\u003ENeed help ! ! ! \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cry.gif\u0022 alt=\u0022;.;\u0022\u003E\u003Cimg src=\u0022screenshot10.png.\u0022 alt=\u0022screenshot10.png.\u0022\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003E?\u003C/p\u003E\u003Cp\u003ENeed help with.... what?\u003C/p\u003E\u003Cp\u003E(help with how to post a screenshot?)\u003C/p\u003E\n"},{"CreatedByName":"baloan","CreatedById":91670,"CreatedDateTime":"2013-11-20T21:50:04Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022wingnut\u0022 data-cite=\u0022wingnut\u0022\u003E\u003Cdiv\u003EBaloan, which formula did you use to calculate the deltav for the periapsis node to raise apoapsis?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EHi wingnut, I ran your script on one of my ships in an almost circular orbit.\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://ksp.baldev.de/kos/screenshots/elliptic-correction.gif\u0022 alt=\u0022elliptic-correction.gif\u0022\u003E\u003C/p\u003E\u003Cp\u003EThe difference in apoapsis is visible. The Hohmann transfer orbit formula having apoapsis at 600198km while my script has apoapsis at 599998km. \u003C/p\u003E\u003Cp\u003EThe difference in the scripts is that perinode.txt (or the deprecated per1.txt) works with elliptical orbits to start with. In a first step\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Eset vom to velocity:orbit:mag.  // actual velocity\u003Cbr\u003Eset r to rb \u002B altitude.         // actual distance to body\u003Cbr\u003Eset ra to rb \u002B periapsis.        // radius in periapsis\u003Cbr\u003Eset va to sqrt( vom^2 \u002B 2*mu*(1/ra - 1/r) ). // velocity in periapsis\u003Cbr\u003Eset a to (periapsis \u002B 2*rb \u002B apoapsis)/2. // semi major axis present orbit\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EI calculate the ship\u0027s velocity va in periapsis from the current velocity vom and the distance r. In a second step the periapsis velocity is used for calculating burn deltav. For easier debugging I calculate after-burn periapsis velocity v2.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E// future orbit properties\u003Cbr\u003Eset r2 to rb \u002B periapsis.    // distance after burn at periapsis\u003Cbr\u003Eset a2 to (apoapsis2 \u002B 2*rb \u002B periapsis)/2. // semi major axis target orbit\u003Cbr\u003Eset v2 to sqrt( vom^2 \u002B (mu * (2/r2 - 2/r \u002B 1/a - 1/a2 ) ) ).\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EThis first step, correcting for the slight eccentricity, makes the difference. I derived the solutions from the energy formula \u003Ca href=\u0022https://en.wikipedia.org/wiki/Elliptic_orbit\u0022 rel=\u0022external nofollow\u0022\u003Ehere\u003C/a\u003E.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-11-20T22:02:37Z\u0022 title=\u002211/20/2013 10:02  PM\u0022 data-short=\u002210 yr\u0022\u003ENovember 20, 2013\u003C/time\u003E by baloan\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2013-11-21T06:22:12Z","Content":"\n\u003Cp\u003EIf you get the common ship-comes-off-rails-and-half-of-it-is-gone bug and want to rescue your save file and still be able to use the broken vessel, there is a workaround you can do that will ressurrect it and bring it back alive fully formed without having to revert to an earlier save to do it.\u003C/p\u003E\u003Cp\u003EFIRST: If you get the bug and see the ship half missing, do NOT ALLOW KSP to write to the persistence file. It will write out its broken idea of what\u0027s in the vessel and then it\u0027s stuck that way. Instead force KSP to quit without saving to the persistence file You do this by NOT using the menus to exit. Don\u0027t quit nicely or it might save as you back out to the space center and then to the main menu. Instead do a forced hard quit externally (i.e. using the Task Manager in Windows or a \u0022kill -9\u0022 in Linux or Mac.) \u003C/p\u003E\u003Cp\u003ESECOND: Just get rid of the entire memory context of the vessel in the save file.\\\u003C/p\u003E\u003Cp\u003EThis will have the effect of making the vessel \u0022forget\u0022 all its variables, although it will still have all the files on its hard drive. But in so doing it will also avoid the bug that\u0027s been preventing the ship from loading properly.\u003C/p\u003E\u003Cp\u003EHere\u0027s how: In your persistence save file there is a section for the vessel that has the KOS part on it. It will look like this:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E\t\t\t\tMODULE\u003Cbr\u003E\t\t\t\t{\u003Cbr\u003E\t\t\t\t\tname = kOSProcessor\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EYou will have one of these for each KOS SCS part in your universe.\u003C/p\u003E\u003Cp\u003EIn that section, if you scroll down a ways you\u0027ll see a section looking something like this:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E\t\t\t\t\tcontext\u003Cbr\u003E\t\t\t\t\t{\u003Cbr\u003E\t\t\t\t\t\tvariables\u003Cbr\u003E\t\t\t\t\t\t{\u003Cbr\u003E\t\t\t\t\t\t\tvariable1 = value1\u003Cbr\u003E\t\t\t\t\t\t\tvariable2 = value2\u003Cbr\u003E\t\t\t\t\t\t\tvariable3 = value3\u003Cbr\u003E\t\t\t\t\t\t\tvariable4 = value4\u003Cbr\u003E\t\t\t\t\t\t\tvariable5 = value5\u003Cbr\u003E\t\t\t\t\t\t}\u003Cbr\u003E\t\t\t\t\t\tcontext\u003Cbr\u003E\t\t\t\t\t\t{\u003Cbr\u003E\t\t\t\t\t\t\tcontext-type = kOS.ImmediateMode\u003Cbr\u003E\t\t\t\t\t\t}\u003Cbr\u003E\t\t\t\t\t}\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EAll the variables you ever set on that KOS computer will be there in that variable section. The bug happens when trying to re-load those variables into the module, some of them it doesn\u0027t understand how to parse back in correctly. To make it re-loadable, just get rid of the variable context entirely (presumably you don\u0027t need it to remember the old values), by removing all the variable = value lines leaving just empty braces behind like so:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E\t\t\t\t\tcontext\u003Cbr\u003E\t\t\t\t\t{\u003Cbr\u003E\t\t\t\t\t\tvariables\u003Cbr\u003E\t\t\t\t\t\t{\u003Cbr\u003E\t\t\t\t\t\t}\u003Cbr\u003E\t\t\t\t\t\tcontext\u003Cbr\u003E\t\t\t\t\t\t{\u003Cbr\u003E\t\t\t\t\t\t\tcontext-type = kOS.ImmediateMode\u003Cbr\u003E\t\t\t\t\t\t}\u003Cbr\u003E\t\t\t\t\t}\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EThis means that SCS part will have forgotten all its variables in memory, but will now load properly.\u003C/p\u003E\u003Cp\u003EObviously, don\u0027t edit the persistence file while the game is running a campaign. Make sure you\u0027ve gotten out of KSP first, as explained above.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-11-21T06:27:41Z\u0022 title=\u002211/21/2013 06:27  AM\u0022 data-short=\u002210 yr\u0022\u003ENovember 21, 2013\u003C/time\u003E by Steven Mading\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"wingnut","CreatedById":57702,"CreatedDateTime":"2013-11-21T06:53:01Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022baloan\u0022 data-cite=\u0022baloan\u0022\u003E\u003Cdiv\u003EThe difference in the scripts is that perinode.txt (or the deprecated per1.txt) works with elliptical orbits to start with. In a first step\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Eset vom to velocity:orbit:mag.  // actual velocity\u003Cbr\u003Eset r to rb \u002B altitude.         // actual distance to body\u003Cbr\u003Eset ra to rb \u002B periapsis.        // radius in periapsis\u003Cbr\u003Eset va to sqrt( vom^2 \u002B 2*mu*(1/ra - 1/r) ). // velocity in periapsis\u003Cbr\u003Eset a to (periapsis \u002B 2*rb \u002B apoapsis)/2. // semi major axis present orbit\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EI calculate the ship\u0027s velocity va in periapsis from the current velocity vom and the distance r. In a second step the periapsis velocity is used for calculating burn deltav. For easier debugging I calculate after-burn periapsis velocity v2.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E// future orbit properties\u003Cbr\u003Eset r2 to rb \u002B periapsis.    // distance after burn at periapsis\u003Cbr\u003Eset a2 to (apoapsis2 \u002B 2*rb \u002B periapsis)/2. // semi major axis target orbit\u003Cbr\u003Eset v2 to sqrt( vom^2 \u002B (mu * (2/r2 - 2/r \u002B 1/a - 1/a2 ) ) ).\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThank you baloan for your explanation. I have follow-up questions please as I am still not able to identify which formula on the \u003Ca href=\u0022https://en.wikipedia.org/wiki/Elliptic_orbit\u0022 rel=\u0022external nofollow\u0022\u003EElliptic orbit page\u003C/a\u003E you used as basis for your velocity calculations, namely those two lines:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Eset va to sqrt( vom^2 \u002B 2*mu*(1/ra - 1/r) ).\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Eset v2 to sqrt( vom^2 \u002B (mu * (2/r2 - 2/r \u002B 1/a - 1/a2 ) ) ).\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EDid you use thie \u003Ca href=\u0022https://en.wikipedia.org/wiki/Elliptic_orbit#Velocity\u0022 rel=\u0022external nofollow\u0022\u003Evelocity\u003C/a\u003E or the \u003Ca href=\u0022https://en.wikipedia.org/wiki/Elliptic_orbit#Energy\u0022 rel=\u0022external nofollow\u0022\u003Eenergy\u003C/a\u003E formula as basis and what did you change to get the tow equations from above?\u003C/p\u003E\n"},{"CreatedByName":"Garek","CreatedById":73214,"CreatedDateTime":"2013-11-21T13:15:48Z","Content":"\n\u003Cp\u003EDoes kerboscript have functions, i.e.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Ebegin surface_retro().\u003Cbr\u003Eset result to velocity:surface \u002B R(180,0,0).\u003Cbr\u003Ereturn result.\u003Cbr\u003Eend.\u003Cbr\u003E//...\u003Cbr\u003Eset x to surface_retro().\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EIs there something like that, or is it at least planned?\u003C/p\u003E\u003Cp\u003E(didn\u0027t read all the thread, sorry, it\u0027s too long)\u003C/p\u003E\n"},{"CreatedByName":"Camacha","CreatedById":59088,"CreatedDateTime":"2013-11-21T13:19:53Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Garek\u0022 data-cite=\u0022Garek\u0022\u003E\u003Cdiv\u003EDoes kerboscript have functions, i.e.\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Ebegin surface_retro().\u003Cbr\u003Eset result to velocity:surface \u002B R(180,0,0).\u003Cbr\u003Ereturn result.\u003Cbr\u003Eend.\u003Cbr\u003E//...\u003Cbr\u003Eset x to surface_retro().\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EIs there something like that, or is it at least planned?\u003C/p\u003E\u003Cp\u003E(didn\u0027t read all the thread, sorry, it\u0027s too long)\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI am not sure what you mean, but you can do math with vectors and stuff like that. Just read the Github manual for more details.\u003C/p\u003E\n"},{"CreatedByName":"Garek","CreatedById":73214,"CreatedDateTime":"2013-11-21T13:33:17Z","Content":"\n\u003Cp\u003EI read the github manual, I think I understood how to do math in kOS. What I want to know is if I can define my own functions for (possibly complicated) stuff I use on multiple places in the same script. The Code above was just the first simple example of such a user-defined function I cound think of. It\u0027s something you\u0027re used to if you ever coded using a professional programming language. It\u0027s pretty much required for complex programs to not become a horrible mess and helps with the size limit.\u003C/p\u003E\n"},{"CreatedByName":"Camacha","CreatedById":59088,"CreatedDateTime":"2013-11-21T13:46:15Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Garek\u0022 data-cite=\u0022Garek\u0022\u003E\u003Cdiv\u003EI read the github manual, I think I understood how to do math in kOS. What I want to know is if I can define my own functions for (possibly complicated) stuff I use on multiple places in the same script. The Code above was just the first simple example of such a user-defined function I cound think of. It\u0027s something you\u0027re used to if you ever coded using a professional programming language. It\u0027s pretty much required for complex programs to not become a horrible mess and helps with the size limit.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI do not think kOS features them officially, but there are things that can be used in a similar way. You can put stuff into \u003Cem\u003Elock to\u003C/em\u003E commands, which only get executed when a variable in them is changed/used (see Steven\u0027s story in one of the previous pages). You could also use \u003Cem\u003Erun\u003C/em\u003E in combination with a seperate script that represents your function. \u003Cem\u003EWhen\u003C/em\u003E could also be exploited, depending on the situation.\u003C/p\u003E\u003Cp\u003EThere are few commands in kOS, but with some creativity they are pretty versatile. If you are used to full scale fully featured languages kOS is pretty sparse \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 alt=\u0022:D\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Garek","CreatedById":73214,"CreatedDateTime":"2013-11-21T14:00:59Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Camacha\u0022 data-cite=\u0022Camacha\u0022\u003E\u003Cdiv\u003EYou could also use \u003Cem\u003Erun\u003C/em\u003E in combination with a seperate script that represents your function.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ESo I found \u003Ca href=\u0022http://kos.wikia.com/wiki/Example_-_Descend_Lander/Skycrane\u0022 rel=\u0022external nofollow\u0022\u003Ethis\u003C/a\u003E. Am I right to assume that all scripts executed without restarting kOS share the same set of (user-defined!) variables? This would mean that one could use files pretty much like functions with all variables being \u0022global\u0022.\u003C/p\u003E\u003Cp\u003EAlso, lock will be useful for shortcut stuff like surface_retrograde, thank you.\u003C/p\u003E\n"},{"CreatedByName":"Camacha","CreatedById":59088,"CreatedDateTime":"2013-11-21T15:03:51Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Garek\u0022 data-cite=\u0022Garek\u0022\u003E\u003Cdiv\u003ESo I found \u003Ca href=\u0022http://kos.wikia.com/wiki/Example_-_Descend_Lander/Skycrane\u0022 rel=\u0022external nofollow\u0022\u003Ethis\u003C/a\u003E. Am I right to assume that all scripts executed without restarting kOS share the same set of (user-defined!) variables? This would mean that one could use files pretty much like functions with all variables being \u0022global\u0022.\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYes, all variables persist between scripts on the same kOS unit. Be careful with variable names, but it can be quite useful. Splitting up your program in different scripts also helps keeping things organised, making it easier to update/upgrade a script or function without affecting the rest of the program.\u003C/p\u003E\u003Cp\u003EBe careful with locking the program in \u003Cem\u003Euntil[i/] loops, they can cause KSP to lag.\u003C/em\u003E\u003C/p\u003E\n"},{"CreatedByName":"a1270","CreatedById":92031,"CreatedDateTime":"2013-11-21T15:06:58Z","Content":"\n\u003Cp\u003EYes, all user-defined variables are global unless declared with DECLARE. Rebooting a kOS module does not clear locks or global variables.\u003C/p\u003E\n"},{"CreatedByName":"Sma","CreatedById":67377,"CreatedDateTime":"2013-11-21T15:17:54Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Garek\u0022 data-cite=\u0022Garek\u0022\u003E\u003Cdiv\u003ESo I found \u003Ca href=\u0022http://kos.wikia.com/wiki/Example_-_Descend_Lander/Skycrane\u0022 rel=\u0022external nofollow\u0022\u003Ethis\u003C/a\u003E. Am I right to assume that all scripts executed without restarting kOS share the same set of (user-defined!) variables? This would mean that one could use files pretty much like functions with all variables being \u0022global\u0022.\u003Cp\u003EAlso, lock will be useful for shortcut stuff like surface_retrograde, thank you.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI didn\u0027t check the link you found but no, KSP does not currently have functions, but you can run seperate programs and treat them as functions as all the variables are global. A simple example (I might have left something out as it\u0027s just off the top of my head but the basic idea for faux functions is there):\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E//launch program\u003Cbr\u003Eprint \u00223\u0022. wait 1.\u003Cbr\u003Elock steering to heading 90 by 90.\u003Cbr\u003Eprint \u00222\u0022. wait 1.\u003Cbr\u003Elock throttle to 0.2. stage.\u003Cbr\u003Eprint \u00221\u0022. wait 1.\u003Cbr\u003Eprint \u00220 - Allonz-y! \u0022.\u003Cbr\u003Elock throttle to 1. stage.\u003Cbr\u003E\u003Cbr\u003Erun ascend(100000, 80000, 10000). //Being as that variables are global they could be declared as parameters at the top and then wouldn\u0027t need to be input as a parameter here but I did this just as an example.\u003Cbr\u003E\u003Cbr\u003Erun circ.\u003Cbr\u003E\u003Cbr\u003E//In orbit now, deploy solar panels and turn on sas\u003Cbr\u003E\u003Cbr\u003Epanels on.\u003Cbr\u003Esas on.\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E//ascend\u003Cbr\u003Edeclare parameter ap. //Apoapsis\u003Cbr\u003Edeclare parameter pe. //Periapsis\u003Cbr\u003Edeclare parameter gravtAlt. // Gravity turn Altitude\u003Cbr\u003E\u003Cbr\u003Euntil apoapsis \u0026gt; ap {\u003Cbr\u003E\u003Cbr\u003E   if altitude \u0026gt; gravtAlt { lock steering to  heading 90 by 45. }\u003Cbr\u003E   if stage:liquidfuel \u0026lt; 1 { stage. }\u003Cbr\u003E   if eta:apoapsis \u0026lt; 45 { lock steering to prograde. lock throttle to 0.4. }\u003Cbr\u003E\u003Cbr\u003E}\u003Cbr\u003E\u003Cbr\u003Elock throttle to 0.\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E//circ\u003Cbr\u003Ewait until eta:apoapsis \u0026lt; 20.\u003Cbr\u003Elock throttle to 1.\u003Cbr\u003Ewait until periapsis \u0026lt;  (pe - 10000).\u003Cbr\u003Elock throttle to 0.5.\u003Cbr\u003Ewait until periapsis \u0026lt; (pe - 2000).\u003Cbr\u003Elock throttle to 0.2.\u003Cbr\u003Ewait until periapsis \u0026lt; (pe - 10).\u003Cbr\u003Elock throttle to 0.\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n"},{"CreatedByName":"Garek","CreatedById":73214,"CreatedDateTime":"2013-11-21T15:22:41Z","Content":"\n\u003Cp\u003EThis is nice. I already have some ideas floating around for a land-at-target program, which will work really well with such faux-functions. Sadly, I don\u0027t have any time to play until at least next thursday, and even then it will take some time to set stuff up.\u003C/p\u003E\n"},{"CreatedByName":"Camacha","CreatedById":59088,"CreatedDateTime":"2013-11-21T15:49:37Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Garek\u0022 data-cite=\u0022Garek\u0022\u003E\u003Cdiv\u003EThis is nice. I already have some ideas floating around for a land-at-target program, which will work really well with such faux-functions. Sadly, I don\u0027t have any time to play until at least next thursday, and even then it will take some time to set stuff up.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI am working on the same thing \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Camacha","CreatedById":59088,"CreatedDateTime":"2013-11-21T16:00:12Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022a1270\u0022 data-cite=\u0022a1270\u0022\u003E\u003Cdiv\u003EYes, all user-defined variables are global unless declared with DECLARE.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EAre you sure? I just did a little test and it seems that declared variables are also shared globally. I do not think kOS is capable of confining variables to a single script.\u003C/p\u003E\u003Cp\u003ENote that global means the local system/single kOS unit. Other kOS units will not recognize declared variables, even though they sometimes interact in weird ways (see my earlier post).\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003ERebooting a kOS module does not clear locks or global variables.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EIt depends. Lock steering dus unlock, variables and other locks do not seem to be reset.\u003C/p\u003E\n"}]}