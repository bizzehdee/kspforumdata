{"TopicId":142213,"ForumId":34,"TopicTitle":"PEGAS - Powered Explicit Guidance Ascent System - devlog","CreatedByName":"Reddy","CreatedById":124298,"CreatedDateTime":"2016-06-22T01:03:11Z","PageNum":5,"Articles":[{"CreatedByName":"Reddy","CreatedById":124298,"CreatedDateTime":"2017-10-08T19:07:22Z","Content":"\n\u003Cp\u003E\nFirst of all, I have tried following your discussion from pages 3 and 4 but I\u0027m not really sure whether the problems you\u0027re discussing are a matter of PEGAS code, that is: does it do something wrong or fail in some case? If so, please make it clear what happens and when, and if you have a suggested solution - go ahead \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u00A0I also welcome github issues or pull requests.\n\u003C/p\u003E\n\u003Cp\u003E\nNow, to answer some of your posts:\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223156048\u0022 data-ipsquote-contentid=\u0022142213\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221503565965\u0022 data-ipsquote-userid=\u0022172084\u0022 data-ipsquote-username=\u0022Pand5461\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nOn 24.08.2017 at 11:12 AM, Pand5461 said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/124298-reddy/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022124298\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/124298-reddy/\u0022 rel=\u0022\u0022\u003E@Reddy\u003C/a\u003E can you explain your logic of control loop convergence?\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/172084-pand5461/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022172084\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/172084-pand5461/\u0022 rel=\u0022\u0022\u003E@Pand5461\u003C/a\u003E\u00A0This is a bit tricky\u00A0and very very empirical. I have tried approaches basing on steering vector and Tgo, trying to measure differences between the values calculated in consecutive iterations.\u00A0The main problem that I was having was that UPFG sometimes converged (measured either way) on very wrong results (i.e. pointing 30\u002B degrees\u00A0\u003Cem\u003Ebelow\u003C/em\u003E\u00A0the horizon and crashing) - especially on later stages. The basic logic is that I measure Tgo and see how it\u0027s changing. You have to be aware that kOS takes a good while to run through the entire UPFG routine, so some considerable time passes between the calls. What I\u0027m doing is I measure that time and adjust the expected Tgo before \u003Ca href=\u0022https://github.com/Noiredd/PEGAS/blob/12bd15b4dc80d3b02ddda98777b94860882c94d7/kOS/pegas_util.ks#L746-L748\u0022 rel=\u0022external nofollow\u0022\u003Ecomparing it\u003C/a\u003E with the algorithm\u0027s prediction. If the difference is small enough, I count that as a hit and run again. The point is to get 2-3 such hits in a row - this means that predicted Tgo is steadily decreasing with time.\n\u003C/p\u003E\n\u003Cp\u003E\nNow comes the trick part. Sometimes after staging, UPFG would converge (that is, pass said verification algorithm), but the result would be rubbish (pointing down). I admit I have failed to find the cause of that, but I located the issue to be somewhere in the internal state of UPFG that has to be preserved between iterations. Simply reseting it in those situations would make things run smoothly. The very idea was to check whether the steering vector is\u00A0\u003Cem\u003Esimilar\u003C/em\u003E\u00A0to the \u0022good\u0022 vector that the previous stage had. If they were very different (above 15 degrees), the UPFG state would be reset and reconverged with brand new state - for some reason, it would always (to the extent I tested) converge on a good solution (good = one that got it into orbit instead of \u003Cabbr title=\u0022Rapid unplanned disassembly\u0022\u003ERUD\u003C/abbr\u003E on reentry).\n\u003C/p\u003E\n\u003Cp\u003E\nThe reset mode would print a PRIORITY_CRITICAL message in the GUI upon being called. However, I haven\u0027t seen this message in a good while when flying my rockets - it might very well be the case that this behavior is not an issue anymore.\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223158067\u0022 data-ipsquote-contentid=\u0022142213\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221503781387\u0022 data-ipsquote-userid=\u002292465\u0022 data-ipsquote-username=\u0022Jim DiGriz\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nOn 26.08.2017 at 11:03 PM, Jim DiGriz said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/124298-reddy/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022124298\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/124298-reddy/\u0022 rel=\u0022\u0022\u003E@Reddy\u003C/a\u003E\u00A0is this a bug in your CSE routine?\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/92465-jim-digriz/\u0026amp;do=hovercard\u0022 data-mentionid=\u002292465\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/92465-jim-digriz/\u0022 rel=\u0022\u0022\u003E@Jim DiGriz\u003C/a\u003E\u00A0It appears so, yes. I will fix this the next time I sit down to code.\n\u003C/p\u003E\n\u003Cp\u003E\nThe reason this was never a problem is that this branch of code is executed only when the alpha\u003Csub\u003Es\u003C/sub\u003E\u00A0parameter is less than zero - and IIRC this can only happen when the vehicle is in a hyperbolic trajectory.\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223160374\u0022 data-ipsquote-contentid=\u0022142213\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221504045913\u0022 data-ipsquote-userid=\u002298639\u0022 data-ipsquote-username=\u0022gsarducci\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nOn 30.08.2017 at 12:31 AM, gsarducci said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nFirst, I am curious if there is a way to impart a spin on a stage prior to stage/ignition.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/98639-gsarducci/\u0026amp;do=hovercard\u0022 data-mentionid=\u002298639\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/98639-gsarducci/\u0022 rel=\u0022\u0022\u003E@gsarducci\u003C/a\u003E\u00A0Currently there is no such option. This is kind of counterproductive, since the whole point of PEGAS is to\u00A0\u003Cem\u003Enot\u003C/em\u003E\u00A0have the vehicle locked at one attitude, but continuously change it in order to maintain an optimal trajectory. Wait, haven\u0027t I replied you in issues? \u003Cimg alt=\u0022:wink:\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif\u0022 title=\u0022;)\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nAnyway, I\u0027m considering implementing a more general event type - including one in which you could pass a function delegate into an event. This would basically let you do\u00A0\u003Cem\u003Eanything\u003C/em\u003E. Still, making the vehicle spin when PEGAS tries to change attitude (to a new steering vector calculated at every iteration) is not a good idea, because you would be effectively fighting against what it\u0027s trying to do.\n\u003C/p\u003E\n"},{"CreatedByName":"gsarducci","CreatedById":98639,"CreatedDateTime":"2017-10-08T20:41:53Z","Content":"\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/124298-reddy/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022124298\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/124298-reddy/\u0022 rel=\u0022\u0022\u003E@Reddy\u003C/a\u003E\u00A0You replied to my posting in Github on several subjects, and it was extremely helpful, thank you! For purposes of context on this forum, the question was related to early missions like on Able-Thor where the third stage was an unguided, spin stabilized solid rocket kick. Anyway, in many cases these launches involved a coast period anyway which PEGAS isn\u0027t set up for.\n\u003C/p\u003E\n\u003Cp\u003E\nVery much looking forward to your continued improvements! Thanks, again!\n\u003C/p\u003E\n"},{"CreatedByName":"Jim DiGriz","CreatedById":92465,"CreatedDateTime":"2017-10-13T17:36:38Z","Content":"\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/124298-reddy/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022124298\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/124298-reddy/\u0022 rel=\u0022\u0022\u003E@Reddy\u003C/a\u003E\u00A0I\u0027ve been working through the derivation of the predictor in UPFG and might have found a sign error (which may exist in the original paper, or might be due to some \u002B signs getting scanned in as - signs, but starting intently at the PDF suggests that they seem to really be - signs):\n\u003C/p\u003E\n\u003Cp\u003E\nFirst of all L*phi \u002B J*phidot should always be zero.\u00A0 This isn\u0027t an accident and is\u00A0because lambda is aligned with the vgo direction so vthrust should always point that way.\u00A0\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nOn this line phidot = - L/J * phi:\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://github.com/Noiredd/PEGAS-MATLAB/blob/master/MATLAB/unifiedPoweredFlightGuidance.m#L202\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/Noiredd/PEGAS-MATLAB/blob/master/MATLAB/unifiedPoweredFlightGuidance.m#L202\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nAlgebraic rearrangement gives L * phi \u002B J * phidot = 0, so two lines down can just be deleted:\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://github.com/Noiredd/PEGAS-MATLAB/blob/master/MATLAB/unifiedPoweredFlightGuidance.m#L204\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/Noiredd/PEGAS-MATLAB/blob/master/MATLAB/unifiedPoweredFlightGuidance.m#L204\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nvthrust =\u00A0(L - 0.5*L*phi^2 - J*phi*phidot - 0.5*H*phidot^2)*lambda;\n\u003C/p\u003E\n\u003Cp\u003E\nThat\u0027s all you need for vthrust.\u00A0 And setting the coefficient of lambdadot in the vthrust expression to zero is actually how the phidot = - L/J phi relationship is determined.\u00A0 By the linear tangent steering law that is also equivalent to phidot = - phi / t_lambda where t_lambda is the time of the centroid of the burn, which is how the centroid of the burn is derived (t_lambda = J/L).\u00A0 I think this is general for all/most implementations of PEG.\n\u003C/p\u003E\n\u003Cp\u003E\nNow the weird thing is that I think the proper expression for rthrust is:\n\u003C/p\u003E\n\u003Cp\u003E\nrthrust = (S - 0.5*S*phi^2 - Q*phi*phidot - 0.5*P*phidot^2)*lambda;\n\u003C/p\u003E\n\u003Cp\u003E\nrthrust = rthrust \u002B\u00A0(S*phi \u002B Q*phidot)*unit(lambdadot);\n\u003C/p\u003E\n\u003Cp\u003E\nThat second line there has a minus signed converted into a plus sign.\u00A0 I cannot figure out where that minus sign comes from in the original paper.\u00A0 IDK if that makes rockets fly better or worse yet and haven\u0027t implemented it yet.\u00A0 Would love to know if you could whip that up in MATLAB and see if it was better or worse.\n\u003C/p\u003E\n\u003Cp\u003E\nEDIT:\u00A0 nope, very obviously bad without that minus sign.\u00A0 \u00A0So my guess is that it comes from interchanging ds dt / dt ds in the thrust integrals and probably dropping out of integration by parts or something like that.\u00A0 Still the lambdadot term in vthrust is zero just algebraically.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222017-10-15T17:52:52Z\u0022 title=\u002210/15/2017 05:52  PM\u0022 data-short=\u00226 yr\u0022\u003EOctober 15, 2017\u003C/time\u003E by Jim DiGriz\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"windystig","CreatedById":170953,"CreatedDateTime":"2017-10-27T17:46:54Z","Content":"\n\u003Cp\u003E\nhey,\n\u003C/p\u003E\n\u003Cp\u003E\nMaybe i\u0027m being dim but i am not sure what you mean in your instructions by defining vehicle and mission and sequence so i just get the immediate crash and the \u0022No boot file loaded. Crashing...\u0022 message.\n\u003C/p\u003E\n\u003Cp\u003E\nWhat am i doing wrong?\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"Reddy","CreatedById":124298,"CreatedDateTime":"2017-10-29T00:51:02Z","Content":"\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/170953-windystig/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022170953\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/170953-windystig/\u0022 rel=\u0022\u0022\u003E@windystig\u003C/a\u003E\u00A0The \u003Ca href=\u0022https://github.com/Noiredd/PEGAS/blob/master/docs/tutorial.md\u0022 rel=\u0022external nofollow\u0022\u003Etutorial\u003C/a\u003E is what you\u0027re looking for.\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/92465-jim-digriz/\u0026amp;do=hovercard\u0022 data-mentionid=\u002292465\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/92465-jim-digriz/\u0022 rel=\u0022\u0022\u003E@Jim DiGriz\u003C/a\u003E\u00A0I\u0027ve just tried it. After changing this to \u002B, it failed spectacularly. Although it\u0027s a nice find on the phidot identity - nothing should change and indeed nothing changes if this line\u00A0is removed. It is very strange, why is this term even there (I\u0027m thinking about figure 5-6 in the block diagram for block 5 in the original UPFG paper). In the current form it introduces nothing - vehicles fly perfectly with and without it. Changing it to anything else just makes things crash in all sorts of ways. It\u0027s just hard to believe that they would burden the GN\u0026amp;C computer with such a heavy line if it does exactly nothing...\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222017-10-29T01:45:07Z\u0022 title=\u002210/29/2017 01:45  AM\u0022 data-short=\u00226 yr\u0022\u003EOctober 29, 2017\u003C/time\u003E by Reddy\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Jim DiGriz","CreatedById":92465,"CreatedDateTime":"2017-11-03T19:09:35Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223206003\u0022 data-ipsquote-contentid=\u0022142213\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221509238262\u0022 data-ipsquote-userid=\u0022124298\u0022 data-ipsquote-username=\u0022Reddy\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nOn 10/28/2017 at 5:51 PM, Reddy said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/170953-windystig/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022170953\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/170953-windystig/\u0022 rel=\u0022\u0022\u003E@windystig\u003C/a\u003E\u00A0The \u003Ca href=\u0022https://github.com/Noiredd/PEGAS/blob/master/docs/tutorial.md\u0022 rel=\u0022external nofollow\u0022\u003Etutorial\u003C/a\u003E is what you\u0027re looking for.\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/92465-jim-digriz/\u0026amp;do=hovercard\u0022 data-mentionid=\u002292465\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/92465-jim-digriz/\u0022 rel=\u0022\u0022\u003E@Jim DiGriz\u003C/a\u003E\u00A0I\u0027ve just tried it. After changing this to \u002B, it failed spectacularly. Although it\u0027s a nice find on the phidot identity - nothing should change and indeed nothing changes if this line\u00A0is removed. It is very strange, why is this term even there (I\u0027m thinking about figure 5-6 in the block diagram for block 5 in the original UPFG paper). In the current form it introduces nothing - vehicles fly perfectly with and without it. Changing it to anything else just makes things crash in all sorts of ways. It\u0027s just hard to believe that they would burden the GN\u0026amp;C computer with such a heavy line if it does exactly nothing...\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nPretty certain this algorithm never actually flew in the GN\u0026amp;C computer, this was just the first rough draft...\n\u003C/p\u003E\n\u003Cp\u003E\nAlso the vthrust\u00A0lambdadot term being zero more precisely falls out of the requirement that the dot product of lambda and lambdaDot is zero.\u00A0 Its not so much a choice as a requirement of how the linear tangent law is constructed (although I guess technically that\u0027s a choice there, but its a bit more fundamental of a choice).\u00A0 Still don\u0027t know where that minus sign comes from...\n\u003C/p\u003E\n"},{"CreatedByName":"Reddy","CreatedById":124298,"CreatedDateTime":"2017-11-05T18:47:30Z","Content":"\n\u003Cp\u003E\n\u003Ca href=\u0022https://github.com/Noiredd/PEGAS/releases/tag/v1.1\u0022 rel=\u0022external nofollow\u0022\u003EPEGAS v1.1 is out now!\u003C/a\u003E Get it while it\u0027s still hot! \u003Cimg alt=\u0022:wink:\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif\u0022 title=\u0022;)\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nList of new features includes:\n\u003C/p\u003E\n\u003Cul\u003E\u003Cli\u003E\ninter-CPU communication system by\u00A0\u003Ca href=\u0022https://github.com/Patrykz94\u0022 rel=\u0022external nofollow\u0022\u003EPatrykz94\u003C/a\u003E,\n\u003C/li\u003E\n\u003Cli\u003E\nroll control via user events,\n\u003C/li\u003E\n\u003Cli\u003E\nbetter throttle control via user events,\n\u003C/li\u003E\n\u003Cli\u003E\nnew user event type (\u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003Ejettison\u003C/span\u003E) to account for the amount of jettisoned mass,\n\u003C/li\u003E\n\u003Cli\u003E\nstages can explicitly shut down engines (useful for Falcon 9 style missions),\n\u003C/li\u003E\n\u003Cli\u003E\nLAN and inclination as optional parameters (default inclination will be equal to launch site latitude, defualt LAN will be set for the launch to occur in 30 seconds from \u0022now\u0022),\n\u003C/li\u003E\n\u003Cli\u003E\nlaunch direction (northerly and southerly, as well as \u0022nearest opportunity\u0022),\n\u003C/li\u003E\n\u003Cli\u003E\nautomatic seizing control from the kOS CPU part,\n\u003C/li\u003E\n\u003C/ul\u003E\u003Cp\u003E\nas well as a few bugfixes:\n\u003C/p\u003E\n\u003Cul\u003E\u003Cli\u003E\nthrottling now obeys the way Realism Overhaul works,\n\u003C/li\u003E\n\u003Cli\u003E\nsustainer-type stages are now handled properly,\n\u003C/li\u003E\n\u003Cli\u003E\nminor code clean-ups, GUI and documentation fixes.\n\u003C/li\u003E\n\u003C/ul\u003E\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/92465-jim-digriz/\u0026amp;do=hovercard\u0022 data-mentionid=\u002292465\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/92465-jim-digriz/\u0022 rel=\u0022\u0022\u003E@Jim DiGriz\u003C/a\u003E\u00A0I am tempted to shamelessly say that plus or minus, what matters is that it flies \u003Cimg alt=\u0022:P\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif\u0022 title=\u0022:P\u0022\u003E\u00A0To be honest, I just don\u0027t have as much time as I used to, certainly not enough to research the intricacies of the algorithm again. I have already\u00A0limited\u00A0my activity to maintenance, bugfixes and features related mostly to KSP-side infrastructure (like events, stage handling, action group support etc.). For anything that touches the UPFG itself: I will review pull requests, perhaps assist in testing, but digging deep into it like I did in mid 2016 -\u00A0unlikely. Though I am curious to read about your findings!\n\u003C/p\u003E\n\u003Cp\u003E\nYou know, I started fiddling around with kOS in early 2015 because I pretty much mastered the game and flying a hundred ascents to build\u0026amp;resupply my orbital station became boring. This was when I wrote my first autopilot. Soon, in search of a bigger challenge,\u00A0I tried \u003Cabbr title=\u0022Realism Overhaul (mod)\u0022\u003ERO\u003C/abbr\u003E, but found that my toy-level script was no longer sufficient.\u00A0Later I found Orbiter forums and PEG,\u00A0and this was about the last time I\u0027ve really played KSP. Ever since it was only pencil\u0026amp;paper, MATLAB and if I ever launched the game, it was just to test/debug PEGAS. Rendesvouz launches were always on the horizon of what I wanted to do (orbital station servicing, right?) and initially I thought this could be done with the basic PEG the Orbiter wiki describes (or some extensions of it). Realization that it\u0027s not was what pushed me to research further,\u00A0to come across UPFG and subsequently to spend another year working on this project. Implementing the\u00A0algorithm\u00A0made PEGAS everything that I ever wanted it to be. It might not do everything, there might be things that it could do better, and sure I do have more ideas to add - but for most practical purposes it\u0027s more than enough. To me it\u0027s at its pinnacle as a tool. Of course it\u0027s not over yet:\u00A0there will be more bugs and fixes, requests and features - bigger and smaller, but for now I am happy with how it turned out.\n\u003C/p\u003E\n\u003Cp\u003E\nI feel kind of like the South Park guys at the end of the \u0022Make Love Not Warcraft\u0022 episode.\u003Cem\u003E I can finally play the game\u003C/em\u003E \u003Cimg alt=\u0022:D\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 title=\u0022:D\u0022\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222017-11-05T20:10:58Z\u0022 title=\u002211/05/2017 08:10  PM\u0022 data-short=\u00226 yr\u0022\u003ENovember 5, 2017\u003C/time\u003E by Reddy\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"AbhChallenger","CreatedById":106911,"CreatedDateTime":"2017-11-06T20:56:09Z","Content":"\n\u003Cp\u003E\nPersonally I find the potential of this tool to be awesome! I had been waiting for \u003Cabbr title=\u0022Real Solar System (mod)\u0022\u003ERSS\u003C/abbr\u003E and \u003Cabbr title=\u0022Realism Overhaul (mod)\u0022\u003ERO\u003C/abbr\u003E to update to the latest KSP versions but this makes we want to just scale Galileo up and use SMURFF. Most autopilots for KSP can take inclination into account but struggles with LAN and especially upper stages with far less \u003Cabbr title=\u0022Thrust-to-weight ratio\u0022\u003ETWR\u003C/abbr\u003E. I want to be able to do 14 minute Centaur style burns to LEO so I cant wait to try this.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nIf you are taking requests about missions you can use this for. I would like to see the Soviet N1 launcher use this. A lunar mission if possible but even just using it to add something to your station would be fun to watch. Or perhaps one of the classic Atlas rockets that used SRBs and the 1.5 staging. It would be fun to see this adapting to those odd launchers. Like you showed in your last video with the Atlas V.\n\u003C/p\u003E\n"},{"CreatedByName":"JohnMcLane","CreatedById":153773,"CreatedDateTime":"2017-11-14T15:34:55Z","Content":"\n\u003Cp\u003E\nNice mod you developed!\n\u003C/p\u003E\n\u003Cp\u003E\nI just tried to get behind the numbers of your \u0022tutorial\u0022-vehicle, the AtlasV-532.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nAtlasV-532.ks:\n\u003C/p\u003E\n\u003Cp\u003E\nGLOBAL vehicle IS LIST(\u003Cbr\u003E\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0LEXICON(\u003Cbr\u003E\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0//\u00A0\u00A0 \u00A0This is a sustainer-type stage. It ignites on the pad, but UPFG takes control over it mid-flight.\u003Cbr\u003E\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0//\u00A0\u00A0 \u00A0Therefore, no ignition or separation happens, and the actual mass of the stage at activation is\u003Cbr\u003E\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0//\u00A0\u00A0 \u00A0inferred automatically.\u003Cbr\u003E\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u0022name\u0022, \u0022Common Core Booster\u0022,\u003Cbr\u003E\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u0022massTotal\u0022, 334872,\u003Cbr\u003E\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u0022massFuel\u0022, 207720\u002B76367,\n\u003C/p\u003E\n\u003Cp\u003E\nMy version of the RSB AtlasV-532 common core booster has a wet mass of 299200 kg, what do i have to add to get to 334872?\n\u003C/p\u003E\n\u003Cp\u003E\nThe rest of the numbers are clear.\n\u003C/p\u003E\n\u003Cp\u003E\nThanks\n\u003C/p\u003E\n"},{"CreatedByName":"Reddy","CreatedById":124298,"CreatedDateTime":"2017-11-15T22:02:57Z","Content":"\n\u003Cp\u003E\nThanks,\u00A0\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/153773-johnmclane/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022153773\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/153773-johnmclane/\u0022 rel=\u0022\u0022\u003E@JohnMcLane\u003C/a\u003E!\n\u003C/p\u003E\n\u003Cp\u003E\nOne thing you must be aware of is that masses are not for the individual stages, but for the entire vehicle\u00A0\u003Cem\u003Eat this stage\u003C/em\u003E. So the CCB mass in PEGAS must also include the Centaur upper stage. I will make this more clear in the next update of the tutorial \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"JohnMcLane","CreatedById":153773,"CreatedDateTime":"2017-11-16T09:51:12Z","Content":"\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/124298-reddy/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022124298\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/124298-reddy/\u0022 rel=\u0022\u0022\u003E@Reddy\u003C/a\u003E\u00A0\u00A0 Thanks for the response\n\u003C/p\u003E\n\u003Cp\u003E\nI read the tutorial again, maybe i overread it the last time or i forgot it.\n\u003C/p\u003E\n\u003Cp\u003E\n\u0022total mass of the \u003Cstrong\u003Eentire vehicle\u003C/strong\u003E at the moment of ignition of each stage,\u0022 is stated under vehicle. So its should be clear....\n\u003C/p\u003E\n\u003Cp\u003E\nmaybe, in the example AtlasV-532 file put something like this:\u00A0\u0022massTotal\u0022, 334872,\u00A0\u00A0 //the massTotal is common booster core \u002B engine\u002B centaur upper stage.. that would help people like me a lot \u003Cimg alt=\u0022:D\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 title=\u0022:D\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\n\u003Cs\u003EEDIT: For my AtlasV-532 with a 5t payload, i get a massTotal of 343899kg without clamps, launch tower, \u003Cabbr title=\u0022Solid fuel Rocket Booster\u0022\u003Esrb\u003C/abbr\u003E\u0027s. Its ~10t difference to your number.\u003C/s\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nEDIT2: Forget Edit, the RSB craft files have liquid fuel and oxidizer plus lqdoxygen and kerosene in the tanks, somehow \u003Cabbr title=\u0022Realism Overhaul (mod)\u0022\u003ERO\u003C/abbr\u003E doesnt get rid of that. Without the unnecessary fuel load and payload i have the same Totalmass.\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cstrong\u003EOne question remains\u003C/strong\u003E: why does PEGAS stage my payload (its the last stage), in the mission.ks there is my payload weight listet and in the sequence list is no additional command, there are only the standard commands of the example AtlasV-532.ks file.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nThe more launches i made, with different launchers, the happier i get. Man, nice program. WOW!!!\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222017-11-16T11:03:24Z\u0022 title=\u002211/16/2017 11:03  AM\u0022 data-short=\u00226 yr\u0022\u003ENovember 16, 2017\u003C/time\u003E by JohnMcLane\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Reddy","CreatedById":124298,"CreatedDateTime":"2017-12-05T20:43:12Z","Content":"\n\u003Cp\u003E\n\u003Cspan\u003E\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/153773-johnmclane/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022153773\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/153773-johnmclane/\u0022 rel=\u0022\u0022\u003E@JohnMcLane\u003C/a\u003E \u003C/span\u003EThank you =)\n\u003C/p\u003E\n\u003Cp\u003E\nStaging a payload can only occur if you have a sequence event set up... or if there is stage in vehicle but no corresponding physical stage to be dropped. PM me with the details of this issue as it sounds weird.\n\u003C/p\u003E\n"},{"CreatedByName":"JohnMcLane","CreatedById":153773,"CreatedDateTime":"2017-12-05T21:12:08Z","Content":"\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/124298-reddy/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022124298\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/124298-reddy/\u0022 rel=\u0022\u0022\u003E@Reddy\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nI will take a look at my problem again tomorrow and message you then. Thank you for the reply!\n\u003C/p\u003E\n"},{"CreatedByName":"Pand5461","CreatedById":172084,"CreatedDateTime":"2017-12-09T17:29:00Z","Content":"\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/124298-reddy/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022124298\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/124298-reddy/\u0022 rel=\u0022\u0022\u003E@Reddy\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027ve tested my own implementation of UPFG in 3.2x system. It works, although I found that analytical CSE routine is imprecise in the sense it does not give results coherent with the internal trajectory prediction.\n\u003C/p\u003E\n\u003Cp\u003E\nI found that simple Verlet integration gives much more accurate results.\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027m now wondering if that 5 km error in apses in your video is due to CSE and can be eliminated by using more precise trajectory prediction.\n\u003C/p\u003E\n"},{"CreatedByName":"Pand5461","CreatedById":172084,"CreatedDateTime":"2017-12-12T18:36:23Z","Content":"\n\u003Cp\u003E\nI take back my words. CSE is reasonably accurate on the time span needed for UPFG. The apses difference is due to cutoff velocity errors. Not much to do with this in \u003Cabbr title=\u0022Realism Overhaul (mod)\u0022\u003ERO\u003C/abbr\u003E, given limited (or no at all) engine throttleability.\n\u003C/p\u003E\n\u003Cp\u003E\nThe performance of CSE routine is not very good, however. I\u0027ve rewritten the routine according to (H.D. Curtis, Orbital Mechanics for Engineering Students) and it needs 80 ms to converge at 200 IPU as opposed to 0.56 s for your implementation.\n\u003C/p\u003E\n\u003Cp\u003E\nDo you mind if I add a PR to replace the CSER?\n\u003C/p\u003E\n"},{"CreatedByName":"Reddy","CreatedById":124298,"CreatedDateTime":"2017-12-14T20:04:17Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223242606\u0022 data-ipsquote-contentid=\u0022142213\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221513103783\u0022 data-ipsquote-userid=\u0022172084\u0022 data-ipsquote-username=\u0022Pand5461\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nOn 12.12.2017 at 7:36 PM, Pand5461 said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nDo you mind if I add a PR to replace the CSER?\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nNot at all, this is what the PRs are for - all improvements are very welcome, thank you \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/172084-pand5461/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022172084\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/172084-pand5461/\u0022 rel=\u0022\u0022\u003E@Pand5461\u003C/a\u003E!\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027ve researched the apses difference thing back during the prototyping days - it\u0027s interesting, but the error is always there, even in a MATLAB simulation running at 1ms precision. Something tells me that this is just how the UPFG is and nothing that can be done about it\u00A0\u003Cem\u003Eat all\u003C/em\u003E. As Jim DiGriz said a few posts above,\u00A0this implementation most likely never really flew the Shuttle - it was a good first draft, but likely received many improvements before actually being used in the GN\u0026amp;C. And there had to be something to improve on, right? \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222017-12-14T20:04:30Z\u0022 title=\u002212/14/2017 08:04  PM\u0022 data-short=\u00226 yr\u0022\u003EDecember 14, 2017\u003C/time\u003E by Reddy\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Pand5461","CreatedById":172084,"CreatedDateTime":"2017-12-14T22:23:04Z","Content":"\n\u003Cp\u003E\nThat\u0027s strange because in my tests with 3.2x GPP I managed to get apses within 1 km difference, 0.5 m/s velocity vector difference from horizontal circular speed.\n\u003C/p\u003E\n\u003Cp\u003E\nBut I needed a bit more sophisticated logic than just locking orientation in one direction and waiting for cutoff.\n\u003C/p\u003E\n\u003Cp\u003E\nSikharulidze says, in the last seconds before cutoff turning rate was frozen and the predicted final position is used as the desired final position. I instead stopped recomputing desired final position and used the last computed r\u003Csub\u003Ed\u003C/sub\u003E and lambdadot to update Vgo and Vt in the last ten seconds. Last second is just finalizing burn with the last computed Vgo.\n\u003C/p\u003E\n"},{"CreatedByName":"Jim DiGriz","CreatedById":92465,"CreatedDateTime":"2017-12-16T23:48:28Z","Content":"\n\u003Cp\u003E\nActually that\u0027s a bit odd because the CSER routine in that paper you\u0027ve (reddy) implemented\u00A0I believe is a Goodyear\u0027s Universal Variables implementation with Battin\u0027s normalized units, and my C# implementation of that handily beats KSPs Orbit class even though I haven\u0027t done the work to feed the prior solution back into the next solution as a hint.\u00A0 I think the code that ran in the Shuttle was more complicated due to needing to handle J^2 oblateness, but the CSER you\u0027ve got should be pretty industrial strength (and fast because it had to run on the potatoputer in the Shuttle).\u00A0 At the same time, though, simplicity of code and validation of accuracy probably trumps everything else.\u00A0 If I could tame the inverse rotation / Krankensbane issues and just use the Orbit class, I would.\n\u003C/p\u003E\n\u003Cp\u003E\nAnd for terminal guidance, what I\u0027ve found you need to do in the corrector is:\n\u003C/p\u003E\n\u003Cp\u003E\n- project rp into the iy plane\n\u003C/p\u003E\n\u003Cp\u003E\n- compute rd and vd from your targetting\n\u003C/p\u003E\n\u003Cp\u003E\n- if you are at tgo \u0026lt; 40 seconds you must release the target constraints with \u0060rd = rp\u0060\n\u003C/p\u003E\n\u003Cp\u003E\n- then do the normal vmiss and updating of vgo calcs\n\u003C/p\u003E\n\u003Cp\u003E\nThe other trick then (from McHenry 1979) is that lambdaDot calculations are frozen at tgo \u0026lt; 40 seconds, so you DO NOT run the TURNR code:\n\u003C/p\u003E\n\u003Cp\u003E\n-\u00A0rgo = rd - ( r \u002B v * tgo \u002B rgrav ) \u002B rbias\n\u003C/p\u003E\n\u003Cp\u003E\n-\u00A0rgo = rgo \u002B ( S - Vector3d.Dot(lambda, rgo) ) * lambda;\n\u003C/p\u003E\n\u003Cp\u003E\n-\u00A0 lambdaDot = ( rgo - S * lambda ) / QP;\n\u003C/p\u003E\n\u003Cp\u003E\nLooks like rgrav estimate\u00A0doesn\u0027t need updating in the early block either, etc.\u00A0 I suppose technically if you\u0027re not computing and using rgo in the TURNR code it doesn\u0027t matter what you do in the corrector with rd, but setting rd = rp keeps the meaning correct.\n\u003C/p\u003E\n\u003Cp\u003E\nThen during the last 10 seconds of guidance you should completely stop updating PEG and fly on the last computation of lambda, lambdaDot and K / t_lambda.\n\u003C/p\u003E\n\u003Cp\u003E\nAlso during the last 10 seconds of guidance you should be counting down tgo and vgo based only on elapsed time and sensed acceleration.\u00A0 You can terminate the burn when tgo \u0026lt;\u00A0TimeWarp.fixedDeltaTime.\u00A0 When you do, vgo should be 0.1 or 0.2 or some other very close to zero value.\u00A0 If it is not then there\u0027s either a bug in your vessel parameters, or there\u0027s a bug in your sensed acceleration, and those need to get fixed.\n\u003C/p\u003E\n\u003Cp\u003E\nThe terminal guidance of PEG actually gets dramatically worse if your sensed acceleration adjustment to vgo is not fairly precise.\u00A0 I was seeing issues at 50-60-ish seconds out due to having botched the sensed \u003Cabbr title=\u0022Delta-V\u0022\u003EdV\u003C/abbr\u003E.\u00A0 This is a known issue/feature of PEG (I think one of the two references below mentions it)\n\u003C/p\u003E\n\u003Cp\u003E\nI also had one kind of derpy issue due to incorrectly rooting my rocket to the payload decoupler on the injection stage and not having the root in the payload, which threw off the mass, threw off the acceleration and threw off the delta V calc of the stage, and i was winding up with vgo of 12-ish m/s and wasn\u0027t reaching the right orbit (and even if I\u0027d burned to a condition like meeting the angular momentum requirements of the target orbit, or vgo nearly being zero, then the final calculations of lambda and K / t_lambda and vgo for the frozen value of lambdaDot at 10 seconds would have been off because the thrust integral calculations would have been off).\n\u003C/p\u003E\n\u003Cp\u003E\nI also included a phiMax / lambdaDot.mag * K clamp like:\n\u003C/p\u003E\n\u003Cp\u003E\ndouble clamp = 4.5 * Math.Pow(10, ( tgo - 40 ) / 40 ) * UtilMath.Deg2Rad;\n\u003C/p\u003E\n\u003Cp\u003E\nThat is just because KSP users may do burns of less than 10 seconds or may do stuff like only use 10 seconds of a TLI stage upper to finish up orbital insertion.\u00A0 With the former you need at least one run through PEG to converge with a sensible clamped lambdaDot and with the latter its just going to give PEG fits in the terminal guidance period.\u00A0 So the clamp starts at 45 degrees at 80 seconds out (allowing rd position constraints to be fully satisfied until then) and the exponentially decays to 4.5 degrees at 40 seconds and 0.8 degrees at 10 seconds.\u00A0 Basically forcing it to progressively just burn towards\u00A0vgo and not worry about turning rate -- but a very kerballed up solution to possible kerbal issues.\u00A0 The problem with clamping lambdaDot, though, is that when you do it, you\u0027re implicitly releasing the position constraint and creating a non-zero rbias term.\n\u003C/p\u003E\n\u003Cp\u003E\nSome light reading on PEG thrust integral stability analysis:\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://arc.aiaa.org/doi/abs/10.2514/6.1982-1555\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://arc.aiaa.org/doi/abs/10.2514/6.1982-1555\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022http://www.sciencedirect.com/science/article/pii/S0273117711001426\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://www.sciencedirect.com/science/article/pii/S0273117711001426\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nI did a build of the most recent / most stable \u003Cabbr title=\u0022Mechjeb (mod)\u0022\u003EMJ\u003C/abbr\u003E code I have earlier today:\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://github.com/lamont-granquist/MechJeb2/releases/tag/mchenry8\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/lamont-granquist/MechJeb2/releases/tag/mchenry8\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nThat also wires up PEG to the node executor and I managed to get one of the worst rockets I have into a 185.2x185.4 orbit and then it successfully executed an ~9 minute burn from parking orbit that nearly hit Mars dead center.\u00A0 It is, however, using the CSESimple calc-101-based debugging routine right now so it might run slow on slower computers.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222017-12-16T23:48:58Z\u0022 title=\u002212/16/2017 11:48  PM\u0022 data-short=\u00226 yr\u0022\u003EDecember 16, 2017\u003C/time\u003E by Jim DiGriz\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Jim DiGriz","CreatedById":92465,"CreatedDateTime":"2017-12-17T00:08:38Z","Content":"\n\u003Cp\u003E\nIf you want a really up-to-date CSE routine along with some interesting historical background:\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://ntrs.nasa.gov/archive/nasa/casi.ntrs.nasa.gov/20160001446.pdf\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://ntrs.nasa.gov/archive/nasa/casi.ntrs.nasa.gov/20160001446.pdf\u003C/a\u003E\n\u003C/p\u003E\n"},{"CreatedByName":"Pand5461","CreatedById":172084,"CreatedDateTime":"2017-12-17T09:30:41Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223246117\u0022 data-ipsquote-contentid=\u0022142213\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221513468108\u0022 data-ipsquote-userid=\u002292465\u0022 data-ipsquote-username=\u0022Jim DiGriz\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n8 hours ago, Jim DiGriz said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nActually that\u0027s a bit odd because the CSER routine in that paper you\u0027ve (reddy) implemented\u00A0I believe is a Goodyear\u0027s Universal Variables implementation with Battin\u0027s normalized units, and my C# implementation of that handily beats KSPs Orbit class even though I haven\u0027t done the work to feed the prior solution back into the next solution as a hint.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nI would guess it\u0027s peculiarity of kOS\u0027s virtual machine. On a real machine, trig functions are far from being a single instruction.\n\u003C/p\u003E\n\u003Cp\u003E\nMaybe when Steven Mading will introduce concept of \u0022flops\u0022 to kOS, breaking down complex expression with trig functions to series summation will make sense in kOS. Now there isn\u0027t much incentive to it.\n\u003C/p\u003E\n\u003Cp\u003E\nAnd AFAIK Shuttle computer used numerical integration instead of analytical CSE at ascent, so the code was in fact much simpler and easily adaptable for oblateness effects, residual aero drag and reactive force from tank venting.\n\u003C/p\u003E\n"},{"CreatedByName":"Jim DiGriz","CreatedById":92465,"CreatedDateTime":"2017-12-17T17:53:43Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223246332\u0022 data-ipsquote-contentid=\u0022142213\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221513503041\u0022 data-ipsquote-userid=\u0022172084\u0022 data-ipsquote-username=\u0022Pand5461\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n8 hours ago, Pand5461 said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nI would guess it\u0027s peculiarity of kOS\u0027s virtual machine. On a real machine, trig functions are far from being a single instruction.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nAh yeah, on kOS if you can trade continued fractions for single trig functions you\u0027ll come out way ahead, that makes total sense...\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223246332\u0022 data-ipsquote-contentid=\u0022142213\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221513503041\u0022 data-ipsquote-userid=\u0022172084\u0022 data-ipsquote-username=\u0022Pand5461\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n8 hours ago, Pand5461 said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nAnd AFAIK Shuttle computer used numerical integration instead of analytical CSE at ascent, so the code was in fact much simpler and easily adaptable for oblateness effects, residual aero drag and reactive force from tank venting.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nAlso yes you\u0027re correct about all of the above.\n\u003C/p\u003E\n"},{"CreatedByName":"JohnMcLane","CreatedById":153773,"CreatedDateTime":"2017-12-25T15:41:44Z","Content":"\n\u003Cp\u003E\nHey,\n\u003C/p\u003E\n\u003Cp\u003E\ngot a problem with my \u003Cabbr title=\u0022Reaction Control System\u0022\u003Ercs\u003C/abbr\u003E and PEGAS:\n\u003C/p\u003E\n\u003Cp\u003E\n-\u00A0 If i activate \u003Cabbr title=\u0022Reaction Control System\u0022\u003ERCS\u003C/abbr\u003E via \u0027R\u0027 during active Pegas, \u003Cabbr title=\u0022Reaction Control System\u0022\u003Ercs\u003C/abbr\u003E is coming out of every \u003Cabbr title=\u0022Reaction Control System\u0022\u003Ercs\u003C/abbr\u003E engine nozzle....\n\u003C/p\u003E\n\u003Cp\u003E\n-\u00A0 If pegas completes his mission and i/or smart a.s.s (mechjeb) try to use \u003Cabbr title=\u0022Reaction Control System\u0022\u003Ercs\u003C/abbr\u003E to change attitude of the craft also the \u003Cabbr title=\u0022Reaction Control System\u0022\u003Ercs\u003C/abbr\u003E comes out of each nozzle and it seams a invisible force (like \u003Cabbr title=\u0022Stability Augmentation System\u0022\u003ESAS\u003C/abbr\u003E, but \u003Cabbr title=\u0022Stability Augmentation System\u0022\u003ESAS\u003C/abbr\u003E is deactivated) tries to keep the ship in the same direction (with quicksave and quickload the problem is gone)....\n\u003C/p\u003E\n\u003Cp\u003E\nThanks!\n\u003C/p\u003E\n"},{"CreatedByName":"LAND ASAP","CreatedById":184612,"CreatedDateTime":"2018-02-14T08:37:52Z","Content":"\n\u003Cp\u003E\nHello!\n\u003C/p\u003E\n\u003Cp\u003E\nI have written a boot config by myself, but I just get a \u0022converging\u0022 all the time. I\u0027m wondering if I have done something wrong. Tried many times but still failed.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nHere is the code. I use\u00A0the\u00A0Real scale booster to built the Delta.\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode\u0022\u003E\nGLOBAL vehicle IS LIST(\n\t\t\t\t\tLEXICON(\n\t\t\t\t\t\t\u0022name\u0022, \u0022Delta IV Common Booster Core\u0022,\n\t\t\t\t\t\t\u0022massTotal\u0022, 399238,\n\t\t\t\t\t\t\u0022massDry\u0022, 61362,\n\t\t\t\t\t\t\u0022gLim\u0022, 4.5,\n\t\t\t\t\t\t\u0022minThrottle\u0022, 0.56,\n\t\t\t\t\t\t\u0022engines\u0022, LIST(LEXICON(\u0022isp\u0022, 409, \u0022thrust\u0022, 3370000)),\n\t\t\t\t\t\t\u0022staging\u0022, LEXICON(\n\t\t\t\t\t\t\t\t\t\t\u0022jettison\u0022, FALSE,\n\t\t\t\t\t\t\t\t\t\t\u0022ignition\u0022, FALSE\n\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t),\n\t\t\t\t\tLEXICON(\n\t\t\t\t\t\t\u0022name\u0022, \u0022DCSS\u0022,\n\t\t\t\t\t\t\u0022massTotal\u0022, 34645,\n\t\t\t\t\t\t\u0022massDry\u0022, 7444,\n\t\t\t\t\t\t\u0022engines\u0022, LIST(LEXICON(\u0022isp\u0022, 465.0, \u0022thrust\u0022, 110100)),\n\t\t\t\t\t\t\u0022staging\u0022, LEXICON(\n\t\t\t\t\t\t\t\t\t\t\u0022jettison\u0022, TRUE,\n\t\t\t\t\t\t\t\t\t\t\u0022waitBeforeJettison\u0022, 5,\n\t\t\t\t\t\t\t\t\t\t\u0022ignition\u0022, TRUE,\n\t\t\t\t\t\t\t\t\t\t\u0022waitBeforeIgnition\u0022, 2,\n\t\t\t\t\t\t\t\t\t\t\u0022ullage\u0022, \u0022rcs\u0022,\n\t\t\t\t\t\t\t\t\t\t\u0022ullageBurnDuration\u0022, 3,\n\t\t\t\t\t\t\t\t\t\t\u0022postUllageBurn\u0022, 2\n\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t)\n).\nGLOBAL sequence IS LIST(\n\t\t\t\t\tLEXICON(\u0022time\u0022, -4, \u0022type\u0022, \u0022stage\u0022, \u0022message\u0022, \u0022RS-68 ignition\u0022),\n\t\t\t\t\tLEXICON(\u0022time\u0022, 0, \u0022type\u0022, \u0022stage\u0022, \u0022message\u0022, \u0022LIFT OFF\u0022),\n\t\t\t\t\tLEXICON(\u0022time\u0022, 90, \u0022type\u0022, \u0022stage\u0022, \u0022message\u0022, \u0022GEM 60 jettison\u0022),\n\t\t\t\t\tLEXICON(\u0022time\u0022, 300, \u0022type\u0022, \u0022jettison\u0022, \u0022message\u0022, \u0022Fairing jettison\u0022, \u0022massLost\u0022, 1760*2)\n).\nGLOBAL controls IS LEXICON(\n\t\t\t\t\t\u0022launchTimeAdvance\u0022, 150,\n\t\t\t\t\t\u0022verticalAscentTime\u0022, 7,\n\t\t\t\t\t\u0022pitchOverAngle\u0022, 13,\n\t\t\t\t\t\u0022upfgActivation\u0022, 110\n).\nGLOBAL mission IS LEXICON(\n\t\t\t\t\t\u0022payload\u0022, 496,\n\t\t\t\t\t\u0022periapsis\u0022, 200,\n\t\t\t\t\t\u0022apoapsis\u0022, 200,\n\t\t\t\t\t\u0022inclination\u0022, 0\n).\nSWITCH TO 0.\nCLEARSCREEN.\nPRINT \u0022Loaded boot file: DeltaIV_M\u002B_(5,4)\u0022.\u003C/pre\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"Reddy","CreatedById":124298,"CreatedDateTime":"2018-02-17T19:52:01Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223252490\u0022 data-ipsquote-contentid=\u0022142213\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221514216504\u0022 data-ipsquote-userid=\u0022153773\u0022 data-ipsquote-username=\u0022JohnMcLane\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nOn 25.12.2017 at 4:41 PM, JohnMcLane said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nHey,\n\u003C/p\u003E\n\u003Cp\u003E\ngot a problem with my \u003Cabbr title=\u0022Reaction Control System\u0022\u003Ercs\u003C/abbr\u003E and PEGAS:\n\u003C/p\u003E\n\u003Cp\u003E\n-\u00A0 If i activate \u003Cabbr title=\u0022Reaction Control System\u0022\u003ERCS\u003C/abbr\u003E via \u0027R\u0027 during active Pegas, \u003Cabbr title=\u0022Reaction Control System\u0022\u003Ercs\u003C/abbr\u003E is coming out of every \u003Cabbr title=\u0022Reaction Control System\u0022\u003Ercs\u003C/abbr\u003E engine nozzle....\n\u003C/p\u003E\n\u003Cp\u003E\n-\u00A0 If pegas completes his mission and i/or smart a.s.s (mechjeb) try to use \u003Cabbr title=\u0022Reaction Control System\u0022\u003Ercs\u003C/abbr\u003E to change attitude of the craft also the \u003Cabbr title=\u0022Reaction Control System\u0022\u003Ercs\u003C/abbr\u003E comes out of each nozzle and it seams a invisible force (like \u003Cabbr title=\u0022Stability Augmentation System\u0022\u003ESAS\u003C/abbr\u003E, but \u003Cabbr title=\u0022Stability Augmentation System\u0022\u003ESAS\u003C/abbr\u003E is deactivated) tries to keep the ship in the same direction (with quicksave and quickload the problem is gone)....\n\u003C/p\u003E\n\u003Cp\u003E\nThanks!\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nIt sounds like a common problem with kOS and \u003Cabbr title=\u0022Reaction Control System\u0022\u003ERCS\u003C/abbr\u003E steering. Try to run something like this:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003ELOCK STEERING TO RETROGRADE.\nWAIT 20.\nUNLOCK STEERING.\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nand see what happens. If you observe the same symptoms, it\u0027s the kOS fault (or your vehicle, but I\u0027m not sure).\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/184612-land-asap/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022184612\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/184612-land-asap/\u0022 rel=\u0022\u0022\u003E@LAND ASAP\u003C/a\u003E\u00A0I see you\u0027re trying to launch to zero inclination orbit. Where\u00A0is your launch site located?\n\u003C/p\u003E\n"},{"CreatedByName":"JohnMcLane","CreatedById":153773,"CreatedDateTime":"2018-02-17T22:04:49Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223297658\u0022 data-ipsquote-contentid=\u0022142213\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221518897121\u0022 data-ipsquote-userid=\u0022124298\u0022 data-ipsquote-username=\u0022Reddy\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n2 hours ago, Reddy said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\n\u003Cspan class=\u0022pln\u0022\u003ELOCK STEERING TO RETROGRADE.\nWAIT 20.\nUNLOCK STEERING.\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThanks!\n\u003C/p\u003E\n\u003Cp\u003E\nto my shame i have to say i use mechjeb right now and stopped with kos, because \u003Cabbr title=\u0022Mechjeb (mod)\u0022\u003EMJ\u003C/abbr\u003E has PEG for \u003Cabbr title=\u0022Realism Overhaul (mod)\u0022\u003ERO\u003C/abbr\u003E now and its very easy to use \u003Cimg alt=\u0022:D\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 title=\u0022:D\u0022\u003E\u003C/p\u003E\n"}]}