{"TopicId":43707,"ForumId":34,"TopicTitle":"kOS Scriptable Autopilot System 0.9","CreatedByName":"KevinLaity","CreatedById":68050,"CreatedDateTime":"2013-08-24T14:28:17Z","PageNum":77,"Articles":[{"CreatedByName":"Jasmir","CreatedById":76744,"CreatedDateTime":"2013-11-17T18:22:15Z","Content":"\n\u003Cp\u003EHi there, i have still a problem:\u003C/p\u003E\u003Cp\u003EThe \u003Cem\u003E\u0022lock steering to up * V(...)\u0022\u003C/em\u003E still touch the roll-axis, and i don\u0027t understand why:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Eclearscreen.\u003Cbr\u003Eset mOrbit to 30000.\u003Cbr\u003Eset mAtmoHight to 20000.\u003Cbr\u003Eset vMinSpeed to 20.\u003Cbr\u003E\u003Cbr\u003Eif BODY = \u0022Laythe\u0022 {\u003Cbr\u003E set mOrbit to 80000.\u003Cbr\u003E set mAtmoHight to 51000.\u003Cbr\u003E}.\u003Cbr\u003E\u003Cbr\u003Eif BODY = \u0022Duna\u0022 {\u003Cbr\u003E set mOrbit to 70000.\u003Cbr\u003E set mAtmoHight to 41000.\u003Cbr\u003E}.\u003Cbr\u003E\u003Cbr\u003Eif BODY = \u0022Kerbin\u0022 {\u003Cbr\u003E set mOrbit to 100000.\u003Cbr\u003E set mAtmoHight to 71000.\u003Cbr\u003E}.\u003Cbr\u003E\u003Cbr\u003Eif BODY = \u0022Mun\u0022 {\u003Cbr\u003E set mOrbit to 25000.\u003Cbr\u003E set mAtmoHight to 7100.\u003Cbr\u003E}.\u003Cbr\u003E\u003Cbr\u003Eif BODY = \u0022Minmus\u0022 {\u003Cbr\u003E set mOrbit to 24000.\u003Cbr\u003E set mAtmoHight to 5800.\u003Cbr\u003E set vMinSpeed to 5.\u003Cbr\u003E}.\u003Cbr\u003E\u003Cbr\u003Eif BODY = \u0022Pol\u0022 {\u003Cbr\u003E set mOrbit to 15000.\u003Cbr\u003E set mAtmoHight to 4500.\u003Cbr\u003E set vMinSpeed to 5.\u003Cbr\u003E}.\u003Cbr\u003E\u003Cbr\u003Eif BODY = \u0022Ike\u0022 {\u003Cbr\u003E set mOrbit to 25000.\u003Cbr\u003E set mAtmoHight to 12750.\u003Cbr\u003E set vMinSpeed to 5.\u003Cbr\u003E}.\u003Cbr\u003E\u003Cbr\u003Eif BODY = \u0022Eve\u0022 {\u003Cbr\u003E set mOrbit to 121000.\u003Cbr\u003E set mAtmoHight to 97000.\u003Cbr\u003E}.\u003Cbr\u003E\u003Cbr\u003Eif BODY = \u0022Gilly\u0022 {\u003Cbr\u003E set mOrbit to 25000.\u003Cbr\u003E set mAtmoHight to 12750.\u003Cbr\u003E set vMinSpeed to 2.\u003Cbr\u003E}.\u003Cbr\u003E\u003Cbr\u003Eset pVal to 0.\u003Cbr\u003Eset sVal to 0.\u003Cbr\u003Eset hVal to 90.\u003Cbr\u003Eset pThr to 0.\u003Cbr\u003E\u003Cbr\u003ESAS OFF.\u003Cbr\u003Elock steering to up.\u003Cbr\u003Elock throttle to pThr.\u003Cbr\u003E\u003Cbr\u003Eprint \u0022Launching on \u0022 \u002B BODY.\u003Cbr\u003Eset pThr to 1.\u003Cbr\u003E\u003Cbr\u003Ewait until verticalspeed \u0026gt; vMinSpeed.\u003Cbr\u003Elock steering to up * V(0 - sVal, 0, hVal).\u003Cbr\u003E\u003Cbr\u003Euntil apoapsis \u0026gt; mOrbit {\u003Cbr\u003E set pVal to apoapsis / mAtmoHight.\u003Cbr\u003E set pVal to pVal * 90.\u003Cbr\u003E if pVal \u0026gt; 89 { break. }.\u003Cbr\u003E set sVal to pVal.\u003Cbr\u003E set hVal to 90 - sVal.\u003Cbr\u003E wait 0.2.\u003Cbr\u003E print \u0022Pitch \u0022 \u002B hVal at (0, 2).\u003Cbr\u003E print \u0022Current Apoapsis \u0022 \u002B apoapsis at (0, 3).\u003Cbr\u003E}.\u003Cbr\u003E\u003Cbr\u003Eprint \u0022Burning for apoapsis\u0022.\u003Cbr\u003Eunlock steering.\u003Cbr\u003ESAS ON.\u003Cbr\u003Ewait until apoapsis \u0026gt; mOrbit.\u003Cbr\u003E\u003Cbr\u003Eset pThr to 0.\u003Cbr\u003Eprint \u0022Please circulize by yourself\u0022.\u003Cbr\u003Ewait 10.\u003C/pre\u003E\u003Cp\u003EHas someone a hint for me?\u003C/p\u003E\n"},{"CreatedByName":"Camacha","CreatedById":59088,"CreatedDateTime":"2013-11-18T01:06:15Z","Content":"\n\u003Cp\u003EI have noticed a small problem with declaring variables. When you already ran a script with a similar variable, it does not get reset. This might mess produce unexpected results and calculations up.\u003C/p\u003E\u003Cp\u003EIt is probably how it is actually supposed to work, but I feel that just setting the variables to a number (even if it is just temporarily a placeholder) is safer. I do not use declare anymore, except for parameters.\u003C/p\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2013-11-18T01:11:06Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Camacha\u0022 data-cite=\u0022Camacha\u0022\u003E\u003Cdiv\u003EI have noticed a small problem with declaring variables. When you already ran a script with a similar variable, it does not get reset. This might mess produce unexpected results and calculations up.\u003Cp\u003EIt is probably how it is actually supposed to work, but I feel that just setting the variables to a number (even if it is just temporarily a placeholder) is safer. I do not use declare anymore, except for parameters.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EAll variables are global and if they didn\u0027t last after a program exited then it would be impossible for a subprogram to calculate values meant to be used by the calling program.\u003C/p\u003E\u003Cp\u003EWhat there probably should be is a way to classify variables as local or global explicitly, such that you can pick and choose which ones remain after the program ends, but right now everything is global and everything remains.\u003C/p\u003E\n"},{"CreatedByName":"Camacha","CreatedById":59088,"CreatedDateTime":"2013-11-18T02:18:44Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Steven Mading\u0022 data-cite=\u0022Steven Mading\u0022\u003E\u003Cdiv\u003EAll variables are global and if they didn\u0027t last after a program exited then it would be impossible for a subprogram to calculate values meant to be used by the calling program.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI understand, that is why I said that it is probably how it is supposed to work, but it caught me out testing the same script for the second time. As other people might run into to same problem, I thought I would share my findings here. I see no reason to declare a variable instead of setting it.\u003C/p\u003E\u003Cp\u003EIn other news, I just reworked my code library into modular segments, so that working on them is a lot cleaner and assembling an operational script should be easier too. The only downside is that running the scripts manages to lock up KSP pretty solid now in a way that I have not seen before, so I will have to figure out what is going on. The commands should be the same as before, so it should be in the loading or switching of programs.\u003C/p\u003E\u003Cp\u003EEdit: apparently the phrase:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Eprint \u0022Hoverscript engaged for \u0022 \u002B hovertime1 \u002B \u0022 seconds \u002B \u0022 to hover at \u0022 \u002B altset1 \u002B \u0022meter.\u0022.\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003Elocks up KSP completely.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-11-18T04:09:55Z\u0022 title=\u002211/18/2013 04:09  AM\u0022 data-short=\u002210 yr\u0022\u003ENovember 18, 2013\u003C/time\u003E by Camacha\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"SirJodelstein","CreatedById":62251,"CreatedDateTime":"2013-11-18T08:05:28Z","Content":"\n\u003Cp\u003EIs it possible to create/edit/read maneuver nodes with KOS?\u003C/p\u003E\n"},{"CreatedByName":"Camacha","CreatedById":59088,"CreatedDateTime":"2013-11-18T08:46:07Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022SirJodelstein\u0022 data-cite=\u0022SirJodelstein\u0022\u003E\u003Cdiv\u003EIs it possible to create/edit/read maneuver nodes with KOS?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYes.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003ENODE                // Direction of next maneuver node, can be used with LOCK STEERING\u003Cbr\u003EMAG:NODE            // Delta-v magnitude of maneuver node\u003Cbr\u003EETA:NODE            // ETA to active maneuver node\u003Cbr\u003EENCOUNTER           // Returns celestial body of encounter\u003Cbr\u003ENEXTNODE            // Next node in flight plan.\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n"},{"CreatedByName":"Sacred Aardvark","CreatedById":85856,"CreatedDateTime":"2013-11-18T11:53:08Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Camacha\u0022 data-cite=\u0022Camacha\u0022\u003E\u003Cdiv\u003EEdit: apparently the phrase:\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Eprint \u0022Hoverscript engaged for \u0022 \u002B hovertime1 \u002B \u0022 seconds \u002B \u0022 to hover at \u0022 \u002B altset1 \u002B \u0022meter.\u0022.\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003Elocks up KSP completely.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EFTFY\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Eprint \u0022Hoverscript engaged for \u0022 \u002B hovertime1 \u002B \u0022 seconds, to hover at \u0022 \u002B altset1 \u002B \u0022meters.\u0022.\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EHere\u0027s your problem(\u0022):\u003C/p\u003E\u003Cp\u003Ehovertime1 \u002B \u0022 seconds \u003Cstrong\u003E\u002B \u0022 \u003C/strong\u003Eto hover at \u0022 \u002B altset1\u003C/p\u003E\u003Cp\u003ECould do this as well: hovertime1 \u002B \u0022 seconds \u0022 \u002B \u0022 to hover at \u0022 \u002B altset1\u003C/p\u003E\u003Cp\u003EWeird that it locks up though, I usually get a syntax error on missing/extra quotation marks.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-11-18T11:58:13Z\u0022 title=\u002211/18/2013 11:58  AM\u0022 data-short=\u002210 yr\u0022\u003ENovember 18, 2013\u003C/time\u003E by Sacred Aardvark\u003C/strong\u003E\n\u003Cbr\u003E42!\n\u003C/span\u003E\n"},{"CreatedByName":"dimmy","CreatedById":88416,"CreatedDateTime":"2013-11-18T12:24:54Z","Content":"\n\u003Cp\u003Ei think its better to add the kOS2 mod with following:\u003C/p\u003E\u003Cp\u003Eyou wrote what youwant.\u003C/p\u003E\u003Cp\u003Eand it compiles in the CSharp script in runtime in this mod, also you can connect toanything in the system (names, etc).\u003C/p\u003E\n"},{"CreatedByName":"Camacha","CreatedById":59088,"CreatedDateTime":"2013-11-18T12:38:26Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Sacred Aardvark\u0022 data-cite=\u0022Sacred Aardvark\u0022\u003E\u003Cdiv\u003EFTFY\u003Cp\u003E[...]\u003C/p\u003E\u003Cp\u003EWeird that it locks up though, I usually get a syntax error on missing/extra quotation marks.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EOnce I knew which line it was it was not hard to fix. It is just that a hard lockup instead of a \u0027flagrant error\u0027 is unusual like you say, so maybe Kevin wants to investigate.\u003C/p\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2013-11-18T13:59:52Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Camacha\u0022 data-cite=\u0022Camacha\u0022\u003E\u003Cdiv\u003EOnce I knew which line it was it was not hard to fix. It is just that a hard lockup instead of a \u0027flagrant error\u0027 is unusual like you say, so maybe Kevin wants to investigate.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI\u0027ve seen several cases where when KOS can\u0027t comprehend the syntax it gets stuck in a neverending loop (which is what locks up all of KSP. All a mod has to do to lock KSP is just: \u0022while true {}.\u0022 and KSP doesn\u0027t have a safety mechanism to grab control from the mod back again. Granted, detecting infinite loops is one of the classic computer science problems that is mathematically proven to be impossible) But KSP could theoretically mandate a maximum timeslice based on the user setting for physics update timeframes (that number that defaults to 0.1 in the settings screen) and only allow a mod that much time to finish its response to a callout before slapping the mod with a newspaper and saying \u0022NO. I have a physics engine here to keep track of, bad mod, bad.\u0022 and then suspending the mod. But it doesn\u0027t, so a mod that\u0027s not responding brings all of KSP down.\u003C/p\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2013-11-18T14:01:33Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022dimmy\u0022 data-cite=\u0022dimmy\u0022\u003E\u003Cdiv\u003Ei think its better to add the kOS2 mod with following:\u003Cp\u003Eyou wrote what youwant.\u003C/p\u003E\u003Cp\u003Eand it compiles in the CSharp script in runtime in this mod, also you can connect toanything in the system (names, etc).\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EOkay, start writing it then.\u003C/p\u003E\u003Cp\u003EGood Luck.\u003C/p\u003E\n"},{"CreatedByName":"erbmur","CreatedById":57112,"CreatedDateTime":"2013-11-18T14:30:03Z","Content":"\n\u003Cp\u003EHi All,\u003C/p\u003E\u003Cp\u003EDoes anybody have a simple-ish script that would calculate terminal velocity? For use with throttle control during takeoff?\u003C/p\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2013-11-18T15:29:36Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022erbmur\u0022 data-cite=\u0022erbmur\u0022\u003E\u003Cdiv\u003EHi All,\u003Cp\u003EDoes anybody have a simple-ish script that would calculate terminal velocity? For use with throttle control during takeoff?\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E// You need these values in order to do the calculation:\u003Cbr\u003Eset gConst to 6.67384*10^(0-11). // The Gravitational constant\u003Cbr\u003Eset e to 2.718281828459 .  // natural log base.\u003Cbr\u003Eset atmToPres to 1.2230948554874 . // presure at 1.0 Atm\u0027s.\u003Cbr\u003Eset bodyMass to Body(body):mass. // Kerbin\u0027s mass.\u003Cbr\u003Eset bodyRadius to 600000. // Hardcoded For Kerbin, radius not available in BODY struct yet.\u003Cbr\u003Eset bodyAtmSea to 1.0 // For Kerbin.  use wiki for other worlds.  Not avail in BODY struct yet.\u003Cbr\u003Eset bodyAtmScale to 5000. // For kerbin.  Use wiki for other worlds.  Not avail in BODY struct yet.\u003Cbr\u003Eset vdrag to 0.2 // If you have no parachutes on.\u003Cbr\u003E\u003Cbr\u003E// grav acceleration at your current location (i.e. 9.8 m/s^2 for sea level on Kerbin):\u003Cbr\u003E// Recalculates to take into account the lessening of gravity as your altitude rises, which matters more for small planets.\u003Cbr\u003Elock gravhere to gConst*bodyMass/((usepe\u002BbodyRadius)^2).\u003Cbr\u003E\u003Cbr\u003E// air pressure here:\u003Cbr\u003Elock herepress to (atmToPres*bodyAtmSea) * e ^ ( (0-altitude)/bodyAtmScale) .\u003Cbr\u003E\u003Cbr\u003E// Terminal velocity at current altitude:\u003Cbr\u003Elock termv to sqrt( (250*heregrav)/( herepress * vdrag ) ).\u003Cbr\u003E\u003Cbr\u003E// Force of drag the air causes depending on your current speed and altitude.\u003Cbr\u003E// Not necessary for term vel, but I thought you might like to know it:\u003Cbr\u003Elock fdrag to 0.5*( (atmToPres*bodyAtmSea) * e^( (0-altitude)/bodyAtmScale) )*(velocity:surface:mag)^2*vdrag*0.008*mass.\u003Cbr\u003E\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003Eit may have errors because I just re-edited it from a version where I was getting term v at periapsis rather than at current altitude, so beware.\u003C/p\u003E\u003Cp\u003EAlso beware that case matters. Some of those variables are all lowercase because they had to be to avoid a bug in KOS with lock expressions.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-11-18T15:33:10Z\u0022 title=\u002211/18/2013 03:33  PM\u0022 data-short=\u002210 yr\u0022\u003ENovember 18, 2013\u003C/time\u003E by Steven Mading\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Sma","CreatedById":67377,"CreatedDateTime":"2013-11-19T00:28:28Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022SirJodelstein\u0022 data-cite=\u0022SirJodelstein\u0022\u003E\u003Cdiv\u003EIs it possible to create/edit/read maneuver nodes with KOS?\u003C/div\u003E\u003C/blockquote\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Camacha\u0022 data-cite=\u0022Camacha\u0022\u003E\u003Cdiv\u003EYes.\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003ENODE                // Direction of next maneuver node, can be used with LOCK STEERING\u003Cbr\u003EMAG:NODE            // Delta-v magnitude of maneuver node\u003Cbr\u003EETA:NODE            // ETA to active maneuver node\u003Cbr\u003EENCOUNTER           // Returns celestial body of encounter\u003Cbr\u003ENEXTNODE            // Next node in flight plan.\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EAlso, to add/create a node (hopefully I remember this correctly)...\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Eset x to node (time:seconds \u002B eta:apoapsis, 0,0,0). //To add a node at Ap. The last zero is prograde, the other two are normal and radial, but I don\u0027t remember which order.\u003Cbr\u003Eadd x.\u003Cbr\u003E\u003Cbr\u003Eset x:prograde to x:prograde \u002B 10. // Add a deltav of 10m/s \u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EYou could also just add the deltav amounts at the time of creation.\u003C/p\u003E\u003Cp\u003EAlso to remove it, you can simply use \u0022remove x.\u0022, or whatever variable name you used.\u003C/p\u003E\n"},{"CreatedByName":"Camacha","CreatedById":59088,"CreatedDateTime":"2013-11-19T01:18:50Z","Content":"\n\u003Cp\u003EHas anyone had trouble with loops eating up processor time? I noticed considerable lagspikes when running a script that would freely run its calculations, mainly around KSC. As the spikes always occured during that particular script, I first tried editing out things like every \u003Cem\u003Elock ... to\u003C/em\u003E I could miss, as those run every cycle, as well as any excess readout prints, but that did not seem to help much. When I finally tried a simple \u003Cem\u003Ewait 0.1.\u003C/em\u003E to slow the loop iteration speed down, the lag became a lot less pronounced and the Task Manager also showed barely any maxed out CPU spikes. Still severe spikes, but not capped by the capabilities of the CPU (or actually, core).\u003C/p\u003E\u003Cp\u003EI must admit that I am a bit suprised that two scripts can differ that much in CPU workload, especially since my hardware is pretty much up to date. Of course, running multiple mods like FAR and kOS is not helping, as they add a noticable workload.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Steven Mading\u0022 data-cite=\u0022Steven Mading\u0022\u003E\u003Cdiv\u003EI\u0027ve seen several cases where when KOS can\u0027t comprehend the syntax it gets stuck in a neverending loop (which is what locks up all of KSP. All a mod has to do to lock KSP is just: \u0022while true {}.\u0022 and KSP doesn\u0027t have a safety mechanism to grab control from the mod back again. [...] But it doesn\u0027t, so a mod that\u0027s not responding brings all of KSP down.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EGood background info, interesting!\u003C/p\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2013-11-19T02:04:08Z","Content":"\n\u003Cp\u003EAfter a bit of googling I\u0027ve come to the conclusion that there isn\u0027t a good webpage out there that tells me the answer to this math problem:\u003C/p\u003E\u003Cp\u003EI want to perform a transfer from my orbit to intercept another orbit. Both orbits are ellipses (obviously) but you are NOT safe to make the assumption that they are circular. Your starting orbit can be any arbitrary ellipse, and the target can be any arbitrary ellipse. The intercept has to be timed so me and the target are there at the same time.\u003C/p\u003E\u003Cp\u003EYou can assume the two orbits have the same inclination plane, so you can treat it like a problem in 2-D space to make it easier. (Solving the inclination problem can be done separately.)\u003C/p\u003E\u003Cp\u003EAll the help I can find on it keeps containing the assumption the starting orbits are circularized.\u003C/p\u003E\u003Cp\u003ESO this is my plan of attack. I\u0027m done for tonight working on KSP but I plan to attack this tomorrow. For now check my logic and tell me if this seems right:\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022text-decoration:underline;\u0022\u003EThe givens I have or can calculate quickly from what I have are these:\u003C/span\u003E\u003C/p\u003E\u003Cp\u003ELet v1 be my initial velocity vector right now. I know my speed and my direction relative to the body both me and the target are orbiting (i.e. the sun).\u003C/p\u003E\u003Cp\u003ELet p1 be my initial position right now, which I could express in XYZ form or in polar coords as (r,theta), where theta is my angle from some arbitrary point I pick).\u003C/p\u003E\u003Cp\u003ELet o1 be the set of orbital parameters I can derive that describe my current orbital shape. All the elliptical parameters should be easily derivable: the semi-major axis, my current angle from periapsis, etc.\u003C/p\u003E\u003Cp\u003EWhat matters is that the new ellipse I make when I burn \u003C/p\u003E\u003Cp\u003ELet v2, p2, and o2 be the same thing, but for where my target body is right now. Note if I use polar coords I need to use the same reference zero point for both (I can\u0027t measure my theta from my periapsis and my target\u0027s from its periapsis since our perapsi (is that a word?) aren\u0027t at the same angle.)\u003C/p\u003E\u003Cp\u003EGiven all of that as starting constraints, here\u0027s my math steps to try to cone up with the answer:\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022text-decoration:underline;\u0022\u003EStep 1 - Get where my intercept would be if I burned now.\u003C/span\u003E\u003C/p\u003E\u003Cp\u003EIf we assume I will burn prograde (or retrograde, which mathematically should just be representable as a negative number in the prograde direction) ONLY, then presumably I can recalculate a new set of orbital parameters, call them o3, that represent my new ellipse I get after applying the delta V. at that point my old ellipse, o1, becomes irrelevant. What matters is the new one, o3. Given nothing but my starting position and that my new velocity must be some vector pointing along the same direction as my current one, presumably that\u0027s enough to constrain all the possible new ellipses I could end up with to just the ones possible with differing speeds in that direction.\u003C/p\u003E\u003Cp\u003ESo I need to find the intercept point between that new ellipse, o3, and the target one, o2.\u003C/p\u003E\u003Cp\u003EI imagine there will be one of three possible results depending on what my new speed is:\u003C/p\u003E\u003Cp\u003E- Zero solutions: If my new speed is too slow, then the math to find the intercept of o2 and o3 will have zero solutions, or at least no real-number solutions, as there will be no intercept points.\u003C/p\u003E\u003Cp\u003E- Two solutions: If my new speed is too high, then the equations to find the intercept of o2 and o3 will have two solutions, crossing higher above the target, then falling back in again later.\u003C/p\u003E\u003Cp\u003E- One solution: If my new speed is just right, then the equations to find the intercept of o2 and o3 will have exactly one solution, barely touching.\u003C/p\u003E\u003Cp\u003ETherefore, what I\u0027m looking for is the speed at which I only get exactly one solution to the question \u0022where do 02 and 03 intercept?\u0022. Because I see there could be 0,1, or 2 solutions, I\u0027m predicting a term involving a square root will be involved somewhere in the math, in which I\u0027ll be solving for where that term is zero. (square root of a negative will be the case where there is no intercept, and square root of a positive will be the case where there\u0027s two).\u003C/p\u003E\u003Cp\u003EI predict I\u0027ll be able to do this, and therefore come up with a new position, p3, which is the position along the target ellipse o3 where I would barely kiss against it and neither miss below it, nor cross above it, if I tried my prograde burn now. In the case of circular starting orbits this is dead simple - it\u0027s always 180 degrees from where I am now, and that simplicity is the reason those equations work out so nicely. But for any arbitrary ellipses that doesn\u0027t hold true.\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022text-decoration:underline;\u0022\u003E Step 2: How many seconds will it take me to get to p3? \u003C/span\u003E\u003C/p\u003E\u003Cp\u003EThis should be simple based just on knowing that i\u0027ll get there along the path of o3, and I know my current position on o3 and I know the position p3 on o3.\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022text-decoration:underline;\u0022\u003E Step 3: How many seconds will my target take to get to p3 \u003C/span\u003E\u003C/p\u003E\u003Cp\u003EP3 is also a position along the target\u0027s ellipse, o2. How many seconds will it take to get there along its o2 path? \u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022text-decoration:underline;\u0022\u003E Step 4: Solve for which starting position would cause step 2 and step 3 to be the same number of seconds.\u003C/span\u003E\u003C/p\u003E\u003Cp\u003EThat\u0027s the position at which to do the burn.\u003C/p\u003E\u003Cp\u003EI THINK this is solvable, and probably a lot of the messy terms will fall out along the way.\u003C/p\u003E\u003Cp\u003ECan anyone find a flaw in my logic? I\u0027ll probably tackle actually doing this tomorrow. I want to be able to get to the more difficult planets in the automated pilot challenge and getting this bit right is crucial.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-11-19T02:08:23Z\u0022 title=\u002211/19/2013 02:08  AM\u0022 data-short=\u002210 yr\u0022\u003ENovember 19, 2013\u003C/time\u003E by Steven Mading\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"cfds","CreatedById":82109,"CreatedDateTime":"2013-11-19T06:45:02Z","Content":"\n\u003Cp\u003EGetting the parameters of the new ellipse from distance from the focal point and your momentary velocity is doable. But the problem with ellipses is that calculations of segments of arc or area have no analytical solutions. So you are restricted to numerical methods to find flight times and similar things.\u003C/p\u003E\n"},{"CreatedByName":"erbmur","CreatedById":57112,"CreatedDateTime":"2013-11-19T09:57:17Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003ECode:\u003Cp\u003E// You need these values in order to do the calculation:\u003C/p\u003E\u003Cp\u003Eset gConst to 6.67384*10^(0-11). // The Gravitational constant\u003C/p\u003E\u003Cp\u003Eset e to 2.718281828459 . // natural log base.\u003C/p\u003E\u003Cp\u003Eset atmToPres to 1.2230948554874 . // presure at 1.0 Atm\u0027s.\u003C/p\u003E\u003Cp\u003Eset bodyMass to Body(body):mass. // Kerbin\u0027s mass.\u003C/p\u003E\u003Cp\u003Eset bodyRadius to 600000. // Hardcoded For Kerbin, radius not available in BODY struct yet.\u003C/p\u003E\u003Cp\u003Eset bodyAtmSea to 1.0 // For Kerbin. use wiki for other worlds. Not avail in BODY struct yet.\u003C/p\u003E\u003Cp\u003Eset bodyAtmScale to 5000. // For kerbin. Use wiki for other worlds. Not avail in BODY struct yet.\u003C/p\u003E\u003Cp\u003Eset vdrag to 0.2 // If you have no parachutes on.\u003C/p\u003E\u003Cp\u003E// grav acceleration at your current location (i.e. 9.8 m/s^2 for sea level on Kerbin):\u003C/p\u003E\u003Cp\u003E// Recalculates to take into account the lessening of gravity as your altitude rises, which matters more for small planets.\u003C/p\u003E\u003Cp\u003Elock gravhere to gConst*bodyMass/((usepe\u002BbodyRadius)^2).\u003C/p\u003E\u003Cp\u003E// air pressure here:\u003C/p\u003E\u003Cp\u003Elock herepress to (atmToPres*bodyAtmSea) * e ^ ( (0-altitude)/bodyAtmScale) .\u003C/p\u003E\u003Cp\u003E// Terminal velocity at current altitude:\u003C/p\u003E\u003Cp\u003Elock termv to sqrt( (250*heregrav)/( herepress * vdrag ) ).\u003C/p\u003E\u003Cp\u003E// Force of drag the air causes depending on your current speed and altitude.\u003C/p\u003E\u003Cp\u003E// Not necessary for term vel, but I thought you might like to know it:\u003C/p\u003E\u003Cp\u003Elock fdrag to 0.5*( (atmToPres*bodyAtmSea) * e^( (0-altitude)/bodyAtmScale) )*(velocity:surface:mag)^2*vdrag*0.008*mass.\u003C/p\u003E\u003Cp\u003Eit may have errors because I just re-edited it from a version where I was getting term v at periapsis rather than at current altitude, so beware.\u003C/p\u003E\u003Cp\u003EAlso beware that case matters. Some of those variables are all lowercase because they had to be to avoid a bug in KOS with lock expressions.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ERockstar baby!\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-11-19T10:00:47Z\u0022 title=\u002211/19/2013 10:00  AM\u0022 data-short=\u002210 yr\u0022\u003ENovember 19, 2013\u003C/time\u003E by erbmur\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"erbmur","CreatedById":57112,"CreatedDateTime":"2013-11-19T10:31:26Z","Content":"\n\u003Cp\u003EHi Steven Mading,\u003C/p\u003E\u003Cp\u003EI have a quick question about your final equation.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003Elock termv to sqrt( (250*heregrav)/( herepress * vdrag ) ).\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EWhere does the 250 derive from, and what is your reasoning for setting vdrag to 0.2 further up the code? I\u0027m assuming this as something to do with the drag of the individual parts? Which i think would be different when using FAR (which i do)?\u003C/p\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2013-11-19T12:25:43Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022erbmur\u0022 data-cite=\u0022erbmur\u0022\u003E\u003Cdiv\u003EHi Steven Mading,\u003Cp\u003EI have a quick question about your final equation.\u003C/p\u003E\u003Cp\u003EWhere does the 250 derive from, and what is your reasoning for setting vdrag to 0.2 further up the code? I\u0027m assuming this as something to do with the drag of the individual parts? Which i think would be different when using FAR (which i do)?\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThe 250 is the result of some constants in kip\u0027s calculations.\u003C/p\u003E\u003Cp\u003EThe 0.2 is the stock parts default for all non parachutes. To respond to differing part drag requires a feature KOS does not have yet - the ability to query the craft\u0027s parts and their properties.\u003C/p\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2013-11-19T12:34:14Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022cfds\u0022 data-cite=\u0022cfds\u0022\u003E\u003Cdiv\u003EBut the problem with ellipses is that calculations of segments of arc or area have no analytical solutions. So you are restricted to numerical methods to find flight times and similar things.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EIf that was true then calculating when to do simplified circular-to-circular Hohmann transfers wouldn\u0027t work because you couldn\u0027t get the elliptical transfer time elapsed.\u003C/p\u003E\u003Cp\u003E(EDIT, oh, no you\u0027re right. Hohmann transfers use the trick of just knowing that it\u0027s half the orbital period, which is a special case that only works for circular orbits.)\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-11-19T17:18:55Z\u0022 title=\u002211/19/2013 05:18  PM\u0022 data-short=\u002210 yr\u0022\u003ENovember 19, 2013\u003C/time\u003E by Steven Mading\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Javster","CreatedById":74613,"CreatedDateTime":"2013-11-19T21:04:15Z","Content":"\n\u003Cp\u003EWow! I wanted something like this from mechJeb, such as activating soft landing rockets that activate at a low altitude, but this is even better!!\u003C/p\u003E\n"},{"CreatedByName":"adammada","CreatedById":29884,"CreatedDateTime":"2013-11-19T23:33:40Z","Content":"\n\u003Cp\u003EHow to set steering to kill horizontal(surface) velocity.\u003C/p\u003E\u003Cp\u003EI want to do something like that:\u003C/p\u003E\u003Cp\u003ESET x TO -1 * velocity:surface:horizontal \u003C/p\u003E\u003Cp\u003ELOCK steering To x.\u003C/p\u003E\u003Cp\u003EThere is lock steering to Heading and lock steering to velocity surface, but how to set steering only to horizontal component of velocity?\u003C/p\u003E\n"},{"CreatedByName":"Camacha","CreatedById":59088,"CreatedDateTime":"2013-11-20T00:21:03Z","Content":"\n\u003Cp\u003EI noticed that the aforementioned lag spikes happen pretty much every time when a script is repeatedly looping through an \u003Cem\u003Euntil\u003C/em\u003E loop. Every second, or sometimes every two seconds, the game will freeze for a tenth of a second or so. The simulation does not seem affected, but when it gets intense it can be very annoying.\u003C/p\u003E\u003Cp\u003ELike I said, I have a fairly meaty CPU, so I can not imagine that being the cause of the problem.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-11-20T02:24:52Z\u0022 title=\u002211/20/2013 02:24  AM\u0022 data-short=\u002210 yr\u0022\u003ENovember 20, 2013\u003C/time\u003E by Camacha\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Camacha","CreatedById":59088,"CreatedDateTime":"2013-11-20T00:27:30Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022adammada\u0022 data-cite=\u0022adammada\u0022\u003E\u003Cdiv\u003EThere is lock steering to Heading and lock steering to velocity surface, but how to set steering only to horizontal component of velocity?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EAre you on a planet? You could use latitude and longitude to figure out how fast you are going in which direction \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"}]}