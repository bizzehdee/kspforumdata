{"TopicId":205209,"ForumId":34,"TopicTitle":"[DEPRECIATED] Stuck on \u0026quot;Loading Part Upgrades\u0026quot; bugfix","CreatedByName":"Gotmachine","CreatedById":163039,"CreatedDateTime":"2021-10-10T19:37:14Z","PageNum":1,"Articles":[{"CreatedByName":"Gotmachine","CreatedById":163039,"CreatedDateTime":"2021-10-10T19:37:14Z","Content":"\n\u003Ch1\u003E\n\u003Ca href=\u0022https://github.com/gotmachine/StuckOnLoadingPartUpgradesFix#this-mod-is-depreciated-and-the-ksp-issue-it-targeted-was-fixed-in-ksp-1123\u0022 rel=\u0022external nofollow\u0022\u003ETHIS MOD IS DEPRECIATED AND THE KSP ISSUE IT TARGETED WAS FIXED IN KSP 1.12.3\u003C/a\u003E\n\u003C/h1\u003E\n\u003Cp\u003E\n\u003Cstrong\u003EJust update KSP to the latest version. Moreover, this mod conflicts with other mods using KSPHarmony, \u003Cu\u003Einstalling it will cause issues\u003C/u\u003E.\u003C/strong\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cabbr title=\u00221. Original Post(er). The first post in a thread, or the person who posted it. 2. Overpowered. A part or mechanic that upsets game balance by being too powerful.\u0022\u003EOP\u003C/abbr\u003E for reference \u003Cspan\u003E:\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nThis is a fix for the KSP 1.12.2 bug that cause the game to be stuck on \u003Ccode\u003ELoading Part Upgrades\u003C/code\u003E on a modded install.\n\u003C/p\u003E\n\u003Cp\u003E\nThis bug happens when you have a duplicated \u003Ccode\u003E*.dll\u003C/code\u003E file in you \u003Ccode\u003EGameData\u003C/code\u003E folder/subfolders. In KSP 1.12, the code that is supposed to be handling that (perfectly normal, mod authors aren\u0027t doing anything wrong) situation is either :\n\u003C/p\u003E\n\u003Cul\u003E\n\u003Cli\u003E\nCrashing with an ArgumentOutOfRangeException, causing the whole loading process to stop.\n\u003C/li\u003E\n\u003Cli\u003E\nSilently removing random assemblies from the list of assemblies to be loaded, causing random issues.\n\u003C/li\u003E\n\u003C/ul\u003E\n\u003Cp\u003E\nIf that is happening to you, you will see the following error near the beginning of your \u003Ccode\u003EKSP.log\u003C/code\u003E file :\n\u003C/p\u003E\n\u003Cdiv\u003E\n\u003Cpre\u003E\u003Ccode\u003EArgumentOutOfRangeException: Index was out of range. Must be non-negative and less than the size of the collection.\nParameter name: index\n\tSystem.ThrowHelper.ThrowArgumentOutOfRangeException (System.ExceptionArgument argument, System.ExceptionResource resource)\n\tSystem.ThrowHelper.ThrowArgumentOutOfRangeException ()\n\tSystem.Collections.Generic.List\u00601[T].RemoveAt (System.Int32 index)\n\tAssemblyLoader.FlagDuplicatedPlugins ()\n\u003C/code\u003E\u003C/pre\u003E\n\u003C/div\u003E\n\u003Cp\u003E\nThis also fix two other issues that have the same effect (but are less likely to happen, as most mod authors have already implemented workarounds)\n\u003C/p\u003E\n\u003Cul\u003E\n\u003Cli\u003E\nAssemblyLoader crashing on attempting to load a \u003Ccode\u003E*.dll\u003C/code\u003E file with an absent or non-parseable \u003Ccode\u003EFileVersion\u003C/code\u003E attribute : \u003Ca href=\u0022https://bugs.kerbalspaceprogram.com/issues/28289\u0022 rel=\u0022external nofollow\u0022\u003Ebugtracker issue\u003C/a\u003E\n\u003C/li\u003E\n\u003Cli\u003E\nAssemblyLoader crashing when an unmanaged \u003Ccode\u003E*.dll\u003C/code\u003E file exists : \u003Ca href=\u0022https://bugs.kerbalspaceprogram.com/issues/28489\u0022 rel=\u0022external nofollow\u0022\u003Ebugtracker issue\u003C/a\u003E\n\u003C/li\u003E\n\u003C/ul\u003E\n\u003Ch3\u003E\nHow to fix ?\n\u003C/h3\u003E\n\u003Cul\u003E\n\u003Cli\u003E\nDownload the \u003Ccode\u003EKSP1.12.2-StuckOnLoadingPartUpgradesFix.zip\u003C/code\u003E file from the \u003Cstrong\u003E\u003Ca href=\u0022https://github.com/gotmachine/StuckOnLoadingPartUpgradesFix/releases\u0022 rel=\u0022external nofollow\u0022\u003EGitHub releases page\u003C/a\u003E\u003C/strong\u003E.\n\u003C/li\u003E\n\u003Cli\u003E\nExtract that zip content \u003Cstrong\u003Eto the root KSP folder\u003C/strong\u003E (\u003Cstrong\u003ENOT GameData\u003C/strong\u003E) :\n\u003Cul\u003E\n\u003Cli\u003E\nOn Windows, this is the folder containing the \u003Ccode\u003EKSP_x64.exe\u003C/code\u003E file\n\u003C/li\u003E\n\u003Cli\u003E\nOn Linux, this is the folder containing the \u003Ccode\u003EKSP.x86_64\u003C/code\u003E file\n\u003C/li\u003E\n\u003Cli\u003E\nOn MacOS, this is the folder containing the \u003Ccode\u003EKSP.app\u003C/code\u003E file\n\u003C/li\u003E\n\u003C/ul\u003E\n\u003C/li\u003E\n\u003Cli\u003E\nDone !\n\u003C/li\u003E\n\u003C/ul\u003E\n\u003Ch3\u003E\nDetails\n\u003C/h3\u003E\n\u003Cp\u003E\nSee corresponding \u003Ca href=\u0022https://bugs.kerbalspaceprogram.com/issues/28036\u0022 rel=\u0022external nofollow\u0022\u003EKSP bugtracker issue\u003C/a\u003E.\n\u003C/p\u003E\n\u003Cp\u003E\nNote that there is a manual workaround to this bug : search your \u003Ccode\u003EGameData\u003C/code\u003E and subfolders contents for \u003Ccode\u003E*.dll\u003C/code\u003E files with the exact same name, and rename the duplicates to something like \u003Ccode\u003E*.dll.duplicate\u003C/code\u003E (or just delete it).\n\u003C/p\u003E\n\u003Cp\u003E\nHowever, this is quite unpractical, so while we wait for a proper fix in an hypothetical KSP 1.12.3 release, I\u0027ve attempted to to provide an easier solution. Fixing this bug can\u0027t be done from a KSP plugin, since it cause the whole KSP plugin loader to crash before any plugin has a chance to execute.\n\u003C/p\u003E\n\u003Cp\u003E\nSo the fix is implemented through \u003Ca href=\u0022https://github.com/BepInEx/BepInEx\u0022 rel=\u0022external nofollow\u0022\u003EBepInEx\u003C/a\u003E, a popular Unity/XNA runtime patcher and plugin framework used for many games (Valheim, Outwards, WorldBox...).\n\u003C/p\u003E\n\u003Ch3\u003E\nNote to modders : workaround\n\u003C/h3\u003E\n\u003Cp\u003E\nIf you are redistributing a \u003Ccode\u003E*.dll\u003C/code\u003E file that is likely to be also redistributed by another mod, you can prevent the issue by renaming that \u003Ccode\u003E*.dll\u003C/code\u003E to something unique. For example rename \u003Ccode\u003ESomeLibrary.dll\u003C/code\u003E to \u003Ccode\u003ESomeLibrary_MyMod.dll\u003C/code\u003E. Due to the fact that mono will only load a single instance of the same assembly by internal name, this is safe to do.\n\u003C/p\u003E\n\u003Cp\u003E\nThe only caveat is that there will be multiple \u003Ccode\u003ELoadedAssembly\u003C/code\u003E entries in \u003Ccode\u003EPluginLoader.loadedAssemblies\u003C/code\u003E for the same assembly, so keep that in mind in the very unlikely case you are iterating on it.\n\u003C/p\u003E\n\u003Cp\u003E\nCommon cases :\n\u003C/p\u003E\n\u003Cul\u003E\n\u003Cli\u003E\nMiniAVC (depreciated and shouldn\u0027t be used)\n\u003C/li\u003E\n\u003Cli\u003E\n\u003Ccode\u003E\u003Cabbr title=\u0022Kerbal Attachment System (mod)\u0022\u003E\u003Cabbr title=\u0022Kerbal Attachment System (mod)\u0022\u003EKAS\u003C/abbr\u003E\u003C/abbr\u003E-API-v2.dll\u003C/code\u003E (Kerbal Attachement System API)\n\u003C/li\u003E\n\u003Cli\u003E\n\u003Ccode\u003ECLSInterfaces.dll\u003C/code\u003E (Connected Living Spaces API)\n\u003C/li\u003E\n\u003Cli\u003E\nUnity Mono/.NET libraries missing from the KSP distribution, like \u003Ccode\u003ESystem.IO.Compression.dll\u003C/code\u003E\n\u003C/li\u003E\n\u003Cli\u003E\nAny nuget package\n\u003C/li\u003E\n\u003C/ul\u003E\n\u003Ch3\u003E\nChangelog\n\u003C/h3\u003E\n\u003Cul\u003E\n\u003Cli\u003E\nV1.1 : Added fixes for AssemblyLoader crashes on dlls containing no \u003Ccode\u003EFileVersion\u003C/code\u003E attribute, or non-managed dlls.\n\u003C/li\u003E\n\u003Cli\u003E\nV1.0 : Initial release\n\u003C/li\u003E\n\u003C/ul\u003E\n\u003Ch3\u003E\nLicensing\n\u003C/h3\u003E\n\u003Cp\u003E\nThe provided download contains :\n\u003C/p\u003E\n\u003Cul\u003E\n\u003Cli\u003E\nBepInEx 5.4.17 : \u003Cstrong\u003E\u003Ccode\u003ELGPL-2.1\u003C/code\u003E\u003C/strong\u003E license\n\u003C/li\u003E\n\u003Cli\u003E\nA BepInEx plugin (\u003Ca href=\u0022https://github.com/gotmachine/StuckOnLoadingPartUpgradesFix\u0022 rel=\u0022external nofollow\u0022\u003Esource\u003C/a\u003E) named \u003Ccode\u003EAssemblyLoaderFixBepInEx.dll\u003C/code\u003E that patch the faulty KSP 1.12.2 method : \u003Cstrong\u003E\u003Ccode\u003EMIT\u003C/code\u003E\u003C/strong\u003E license\n\u003C/li\u003E\n\u003C/ul\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222023-10-16T07:21:54Z\u0022 title=\u002210/16/2023 07:21  AM\u0022 data-short=\u0022Oct 16\u0022\u003EOctober 16, 2023\u003C/time\u003E by Gotmachine\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"petrisha","CreatedById":212964,"CreatedDateTime":"2021-10-16T14:36:42Z","Content":"\n\u003Cp\u003E\nanyone who\u0027s wondering what exactly it fixes here\u0027s my problem with KSP that this magic trick fixed in under 10min\n\u003C/p\u003E\n\u003Ciframe allowfullscreen=\u0022\u0022 data-controller=\u0022core.front.core.autosizeiframe\u0022 data-embedauthorid=\u0022212964\u0022 data-embedcontent=\u0022\u0022 data-embedid=\u0022embed6754395297\u0022 scrolling=\u0022no\u0022 src=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/205268-mods-working-separately-but-not-together/\u0026amp;do=embed\u0022 style=\u0022height:191px;max-width:502px;\u0022\u003E\u003C/iframe\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nyou are god among men\n\u003C/p\u003E\n"},{"CreatedByName":"theonegalen","CreatedById":71012,"CreatedDateTime":"2021-10-18T00:57:31Z","Content":"\n\u003Cp\u003E\naha!\n\u003C/p\u003E\n\u003Cp\u003E\nThank you for this!\n\u003C/p\u003E\n"}]}