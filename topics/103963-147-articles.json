{"TopicId":103963,"ForumId":36,"TopicTitle":"[WIP][1.9.x-1.12.x] Scatterer-atmospheric scattering (0.0838 - 14/08/2022) Scattering improvements, in-game atmo generation and multi-sun support","CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-04-12T08:37:35Z","PageNum":147,"Articles":[{"CreatedByName":"Nhawks17","CreatedById":32999,"CreatedDateTime":"2016-03-08T14:31:07Z","Content":"I like it! It really doesn\u0027t look like much of a big difference that it would effect anything (at least from your pictures). I really like that it fixes the eclipse shadow on clouds. When I was testing the Laythe-Jool interaction yesterday I noticed the eclipse looked really weird given it was making the planet dark but the bright white clouds were still there. I\u0027m in favor of it!"},{"CreatedByName":"Starwaster","CreatedById":71262,"CreatedDateTime":"2016-03-08T16:08:16Z","Content":"\u003E \n\u003E \n\u003E 5 hours ago, blackrack said:\n\u003E \n\u003E \n\u003E Alright, another advantage I have found to this is that eclipses will also work on clouds this way, at least from an orbital viewpoint:\n\u003E \n\nNuh uh! Nowai!!! *Whut sorcery is this???*\n\nOoooooo how does it interact with the god rays? Someone needs to get a shot of an eclipse on the horizon (as in during sunrise). That would look awesome\n\n**Edited \u003Ctime datetime=\u00222016-03-08T16:10:09Z\u0022 title=\u002203/08/2016 04:10  PM\u0022 data-short=\u00228 yr\u0022\u003EMarch 8, 2016\u003C/time\u003E by Starwaster**"},{"CreatedByName":"Elthy","CreatedById":63317,"CreatedDateTime":"2016-03-08T16:41:24Z","Content":"Those strange terminators where allways the biggest flaw of scatterer for me. Great you managed to fix them, now it looks very good!"},{"CreatedByName":"sashan","CreatedById":98897,"CreatedDateTime":"2016-03-08T17:07:33Z","Content":"\u003E \n\u003E \n\u003E 7 hours ago, blackrack said:\n\u003E \n\u003E \n\u003E In a way this is wrong as it treats the clouds as if they were at the ground level, but I find the end results looks pleasing and more homegeneous.\n\u003E \n\nI think that you can actually assume clouds to be at the ground level - at least in RSS. They are quite low actually IRL - most of the atmo is above them."},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2016-03-08T17:09:42Z","Content":"\u003E \n\u003E \n\u003E Just now, sashan said:\n\u003E \n\u003E \n\u003E I think that you can actually assume clouds to be at the ground level - at least in RSS. They are quite low actually IRL - most of the atmo is above them.\n\u003E \n\nWhile it\u0027s true that they are rather low altitude-wise, I would think the thickest part of the atmosphere is beneath them."},{"CreatedByName":"rbray89","CreatedById":48847,"CreatedDateTime":"2016-03-08T17:10:58Z","Content":"\u003E \n\u003E \n\u003E 7 hours ago, blackrack said:\n\u003E \n\u003E \n\u003E Have you checked your memory usage in the windows task manager when this happens?\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E You\u0027re the second person to report this and the guy before didn\u0027t give enough info to know what\u0027s going on. So yeah, poke around more, play with the settings, play with the features, play with your driver, check the debug log etc etc until you find something that affects it at all because at the moment I have no idea what this is. Also try forcing dx11 or opengl.\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E Same as above, try to find some sort of clue and do a more detailed report.\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E  \n\u003E \n\u003E \n\u003E \n\u003E \n\u003E The shadows don\u0027t disappear either, they\u0027re there, but subtler, can mostly be seen to the left, in the brightest area:\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E [![TJdZwmd.jpg](http://i.imgur.com/TJdZwmd.jpg)](http://i.imgur.com/TJdZwmd.jpg \u0022Enlarge image\u0022)\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E [![GVP3mDc.jpg](http://i.imgur.com/GVP3mDc.jpg)](http://i.imgur.com/GVP3mDc.jpg \u0022Enlarge image\u0022)\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E In a way this is wrong as it treats the clouds as if they were at the ground level, but I find the end results looks pleasing and more homegeneous.\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E Thoughts on this? [@Proot](https://forum.kerbalspaceprogram.com/index.php?/profile/98932-proot/) [@Nhawks17](https://forum.kerbalspaceprogram.com/index.php?/profile/32999-nhawks17/) [@pingopete](https://forum.kerbalspaceprogram.com/index.php?/profile/74168-pingopete/)\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E Also, if I go through with this, the transition from PQS to scaledSpace may be even more problematic, may have to work something out with [@rbray89](https://forum.kerbalspaceprogram.com/index.php?/profile/48847-rbray89/)\n\u003E \n\nLooks lovely! One thing I could do is lower the intensity of cloud shadows near the terminator. Another thing we could talk about would be to write a value to alpha in the screen buffer to control how much the scatterer overlays blend."},{"CreatedByName":"sashan","CreatedById":98897,"CreatedDateTime":"2016-03-08T17:13:07Z","Content":"\u003E \n\u003E \n\u003E 3 minutes ago, blackrack said:\n\u003E \n\u003E \n\u003E While it\u0027s true that they are rather low altitude-wise, I would think the thickest part of the atmosphere is beneath them.\n\u003E \n\nOkay, I\u0027ll make a quick check of that. At which altitude are RSS clouds at?"},{"CreatedByName":"sashan","CreatedById":98897,"CreatedDateTime":"2016-03-08T17:58:43Z","Content":"\u003E \n\u003E \n\u003E 1 hour ago, blackrack said:\n\u003E \n\u003E \n\u003E hile it\u0027s true that they are rather low altitude-wise, I would think the thickest part of the atmosphere is beneath them.\n\u003E \n\nWell, I quickly did this graph.   \n![DVnVQTR.png](http://i.imgur.com/DVnVQTR.png)  \n\nHalf of the atmosphere mass-wise is below 5 km ![:P](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif \u0022:P\u0022) \n\n**Edited \u003Ctime datetime=\u00222016-03-08T18:14:48Z\u0022 title=\u002203/08/2016 06:14  PM\u0022 data-short=\u00228 yr\u0022\u003EMarch 8, 2016\u003C/time\u003E by sashan**"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2016-03-08T18:27:14Z","Content":"\u003E \n\u003E \n\u003E 29 minutes ago, sashan said:\n\u003E \n\u003E \n\u003E Well, I quickly did this graph.   \n\u003E \n\u003E Half of the atmosphere mass-wise is below 5 km ![:P](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif \u0022:P\u0022)\n\u003E \n\nIt seems most of the clouds are below 5 km though, so you were right ![:P](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif \u0022:P\u0022)\n\n\u003E \n\u003E \n\u003E 1 hour ago, rbray89 said:\n\u003E \n\u003E \n\u003E Looks lovely! One thing I could do is lower the intensity of cloud shadows near the terminator. Another thing we could talk about would be to write a value to alpha in the screen buffer to control how much the scatterer overlays blend.\n\u003E \n\nYeah, that would be cool. One quick question though, I noticed that your clouds are composed of the \u0022texture\u0022 layer mapped onto a sphere that you see from orbit and the particle-like volumes that you see from the ground or when flying through the cloud layer. Is there a reason you switch the sphere layer between local space and scaled space and not keep it in scaled space all the time? I would\u0027ve thought it\u0027s so craft can fly through it but you seem to \u0022create a hole\u0022 in that layer when the craft get through it.\n\n**Edited \u003Ctime datetime=\u00222016-03-08T18:27:53Z\u0022 title=\u002203/08/2016 06:27  PM\u0022 data-short=\u00228 yr\u0022\u003EMarch 8, 2016\u003C/time\u003E by blackrack**"},{"CreatedByName":"rbray89","CreatedById":48847,"CreatedDateTime":"2016-03-08T19:15:54Z","Content":"\u003E \n\u003E \n\u003E 45 minutes ago, blackrack said:\n\u003E \n\u003E \n\u003E Is there a reason you switch the sphere layer between local space and scaled space and not keep it in scaled space all the time? I would\u0027ve thought it\u0027s so craft can fly through it but you seem to \u0022create a hole\u0022 in that layer when the craft get through it.\n\u003E \n\nOtherwise you\u0027d get a situation where clouds are behind terrain all the time when looking down at the body. It\u0027d be fine when looking from ground to sky though, aside from when the cloud layer should go through mountains."},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2016-03-08T19:22:47Z","Content":"\u003E \n\u003E \n\u003E Just now, rbray89 said:\n\u003E \n\u003E \n\u003E Otherwise you\u0027d get a situation where clouds are behind terrain all the time when looking down at the body. It\u0027d be fine when looking from ground to sky though, aside from when the cloud layer should go through mountains.\n\u003E \n\nYeah, that went right over my head, I\u0027ve been thinking about this too much today ![:P](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif \u0022:P\u0022) . I\u0027m going to have to move my orbital shader into local space and fade it in and then switch to scaledspace I guess."},{"CreatedByName":"Arditan427","CreatedById":96857,"CreatedDateTime":"2016-03-08T23:00:26Z","Content":"\u003E \n\u003E \n\u003E 13 hours ago, blackrack said:\n\u003E \n\u003E \n\u003E You\u0027re the second person to report this and the guy before didn\u0027t give enough info to know what\u0027s going on. So yeah, poke around more, play with the settings, play with the features, play with your driver, check the debug log etc etc until you find something that affects it at all because at the moment I have no idea what this is. Also try forcing dx11 or opengl.\n\u003E \n\nI\u0027m not really sure what I would be looking for though, should I post my output log or something like that?"},{"CreatedByName":"selfish_meme","CreatedById":125899,"CreatedDateTime":"2016-03-08T23:07:22Z","Content":"\u003E \n\u003E \n\u003E On 6 March 2016 at 9:05 PM, blackrack said:\n\u003E \n\u003E \n\u003E Does anybody else feel the stock re-entry/mach effects are big performance hogs?\n\u003E \n\nYes, plus they come in ridiculously early, I actually adjusted them to come in much later, over Mach 4, so now if I have flames something is going to blow up soon"},{"CreatedByName":"theonegalen","CreatedById":71012,"CreatedDateTime":"2016-03-09T00:41:12Z","Content":"\u003E \n\u003E \n\u003E 15 hours ago, blackrack said:\n\u003E \n\u003E \n\u003E Have you checked your memory usage in the windows task manager when this happens?\n\u003E \n\nYes, the KSP memory usage at the time was ~3,200,000b. I played again, and even though I got up to ~3,550,000b, I didn\u0027t have the same problem. Both times, I still had at least a GB of my RAM free."},{"CreatedByName":"Azimech","CreatedById":50750,"CreatedDateTime":"2016-03-09T08:50:35Z","Content":"\u003E \n\u003E \n\u003E 9 hours ago, selfish\\_meme said:\n\u003E \n\u003E \n\u003E Yes, plus they come in ridiculously early, I actually adjusted them to come in much later, over Mach 4, so now if I have flames something is going to blow up soon\n\u003E \n\nOh I\u0027d like to know how you did that.\n\n**No, forum editor. Don\u0027t just merge posts like that. At least put a divider in between!** \n\nInteresting loop ... loop ... loop ... loop.\n\nMaybe because of the ~20 units having a party at the KSC. Interface still works though. Don\u0027t know what will happen when I switch to simulation yet.  \n  \n![Rl2Bita.png](http://i.imgur.com/Rl2Bita.png)\n\n**Edited \u003Ctime datetime=\u00222016-03-09T08:56:01Z\u0022 title=\u002203/09/2016 08:56  AM\u0022 data-short=\u00228 yr\u0022\u003EMarch 9, 2016\u003C/time\u003E by Azimech**"},{"CreatedByName":"selfish_meme","CreatedById":125899,"CreatedDateTime":"2016-03-09T08:55:57Z","Content":"\u003E \n\u003E \n\u003E 5 minutes ago, Azimech said:\n\u003E \n\u003E \n\u003E Oh I\u0027d like to know how you did that.\n\u003E \n\n    aeroFXVelocityExponent = 3.5\n    aeroFXDensityExponent1 = 0.5\n\nIn physics.cfg, I think I chose 4.0 and 1.0 instead, I can\u0027t check ATM\n\n**Edited \u003Ctime datetime=\u00222016-03-09T08:56:20Z\u0022 title=\u002203/09/2016 08:56  AM\u0022 data-short=\u00228 yr\u0022\u003EMarch 9, 2016\u003C/time\u003E by selfish\\_meme**"},{"CreatedByName":"Azimech","CreatedById":50750,"CreatedDateTime":"2016-03-09T08:57:44Z","Content":"\u003E \n\u003E \n\u003E Just now, selfish\\_meme said:\n\u003E \n\u003E \n\u003E aeroFXVelocityExponent = 3.5\n\u003E     aeroFXDensityExponent1 = 0.5\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E In physics.cfg, I think I chose 4.0 and 1.0 instead\n\u003E \n\nThank you very much! I see a lot of possibilities here!"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2016-03-09T09:54:24Z","Content":"\u003E \n\u003E \n\u003E 1 hour ago, Azimech said:\n\u003E \n\u003E \n\u003E Interesting loop ... loop ... loop ... loop.\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E Maybe because of the ~20 units having a party at the KSC. Interface still works though. Don\u0027t know what will happen when I switch to simulation yet.\n\u003E \n\nYour game is behaving like it\u0027s switching between fullscreen and windowed mode permanently, try a different video mode or switch to windowed, perhaps try borderless fullscreen?\n\n\u003E \n\u003E \n\u003E 9 hours ago, theonegalen said:\n\u003E \n\u003E \n\u003E Yes, the KSP memory usage at the time was ~3,200,000b. I played again, and even though I got up to ~3,550,000b, I didn\u0027t have the same problem. Both times, I still had at least a GB of my RAM free.\n\u003E \n\nIf you\u0027re not using the 64bit workaround you\u0027ve reached the limit of how much memory 32-bit KSP can use. It doesn\u0027t matter how much RAM you have free.\n\n\u003E \n\u003E \n\u003E 10 hours ago, Arditan427 said:\n\u003E \n\u003E \n\u003E I\u0027m not really sure what I would be looking for though, should I post my output log or something like that?\n\u003E \n\nPost the log but I doubt there will be anything in it. Really just play with the settings and see if anything affects it."},{"CreatedByName":"Azimech","CreatedById":50750,"CreatedDateTime":"2016-03-09T12:27:30Z","Content":"\u003E \n\u003E \n\u003E 2 hours ago, blackrack said:\n\u003E \n\u003E \n\u003E Your game is behaving like it\u0027s switching between fullscreen and windowed mode permanently, try a different video mode or switch to windowed, perhaps try borderless fullscreen?\n\u003E \n\nI went to the SPH, when I went back to KSC scene it was gone. Don\u0027t consider it a problem but thanks for the tip."},{"CreatedByName":"pingopete","CreatedById":74168,"CreatedDateTime":"2016-03-09T14:03:19Z","Content":"Just a quick question:\n\n    eclipseCasters\t{\t\tItem = Moon\t}\n\nFor this is the item the CB name or the transform name?"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2016-03-09T14:27:48Z","Content":"\u003E \n\u003E \n\u003E 23 minutes ago, pingopete said:\n\u003E \n\u003E \n\u003E Just a quick question:\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E For this is the item the CB name or the transform name?\n\u003E \n\nIt doesn\u0027t handle differing CB/transform names so it\u0027s CB name. I thought the differing names were only needed for Kerbin/Earth?"},{"CreatedByName":"pingopete","CreatedById":74168,"CreatedDateTime":"2016-03-09T14:30:24Z","Content":"\u003E \n\u003E \n\u003E 1 minute ago, blackrack said:\n\u003E \n\u003E \n\u003E It doesn\u0027t handle differing CB/transform names so it\u0027s CB name. I thought the differing names were only needed for Kerbin/Earth?\n\u003E \n\nAh right ok. Yeah just trying out the latest release, really nice to see even more frames back in opengl, among other fixes ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif \u0022:)\u0022) One big issue I noticed though is there\u0027s no ocean shader what so ever in RSS PQS? Fine in SS but nothing not even at higher levels in PQS?"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2016-03-09T14:41:48Z","Content":"\u003E \n\u003E \n\u003E 10 minutes ago, pingopete said:\n\u003E \n\u003E \n\u003E Ah right ok. Yeah just trying out the latest release, really nice to see even more frames back in opengl, among other fixes ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif \u0022:)\u0022) One big issue I noticed though is there\u0027s no ocean shader what so ever in RSS PQS? Fine in SS but nothing not even at higher levels in PQS?\n\u003E \n\nThere\u0027s a new variable in the config points \u0022\\_GlobalOceanAlpha\u0022 if you\u0027re using an older config it\u0027s value will be 0 at all config points"},{"CreatedByName":"pingopete","CreatedById":74168,"CreatedDateTime":"2016-03-09T15:03:24Z","Content":"\u003E \n\u003E \n\u003E 20 minutes ago, blackrack said:\n\u003E \n\u003E \n\u003E There\u0027s a new variable in the config points \u0022\\_GlobalOceanAlpha\u0022 if you\u0027re using an older config it\u0027s value will be 0 at all config points\n\u003E \n\nAhh I see thank you! Man the fading extinction looks so sweet!\n\n![XxwXWjw.png](http://i.imgur.com/XxwXWjw.png)"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2016-03-09T15:05:00Z","Content":"\u003E \n\u003E \n\u003E 1 minute ago, pingopete said:\n\u003E \n\u003E \n\u003E Ahh I see thank you! Man the fading extinction looks so sweet!\n\u003E \n\nWait, what fading extinction?"}]}