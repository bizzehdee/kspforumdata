{"TopicId":12076,"ForumId":29,"TopicTitle":"create vessel in-game","CreatedByName":"nadvornm","CreatedById":6613,"CreatedDateTime":"2012-06-04T13:13:27Z","PageNum":1,"Articles":[{"CreatedByName":"nadvornm","CreatedById":6613,"CreatedDateTime":"2012-06-04T13:13:27Z","Content":"\n\u003Cp\u003EHi,\u003C/p\u003E\u003Cp\u003Eis it possible to create a plugin that creates a vessel in-game?\u003C/p\u003E\u003Cp\u003EIf so, how can I do this?\u003C/p\u003E\n"},{"CreatedByName":"Romfarer","CreatedById":20387,"CreatedDateTime":"2012-06-07T07:48:22Z","Content":"\n\u003Cp\u003EYou would probably have to manually assemble the vessel by building a part hierarchy with the methods available in the Part class, then at some point \u0027finish it all off\u0027 by calling Initialize on the vessel. :-X I believe there already is a plugin for an orbital VAB, you might want to look that up.\u003C/p\u003E\n"},{"CreatedByName":"Vlad. Just Vlad.","CreatedById":12169,"CreatedDateTime":"2012-07-07T09:07:20Z","Content":"\n\u003Cp\u003EBut if I need to spawn only one part? It should be possible, Orbital construction works.\u003C/p\u003E\n"},{"CreatedByName":"maltesh","CreatedById":17144,"CreatedDateTime":"2012-07-07T10:02:30Z","Content":"\n\u003Cp\u003EThe Orbital Constuction mod works by teleporting a spacecraft you made in the VAB from the launchpad to near the shipyard if the shipyard\\\u0027s inventory contains sufficient parts to build it.\u003C/p\u003E\n"},{"CreatedByName":"Vlad. Just Vlad.","CreatedById":12169,"CreatedDateTime":"2012-07-07T10:12:55Z","Content":"\n\u003Cp\u003EOkay. But I\\\u0027ll continue search for solving.\u003C/p\u003E\n"},{"CreatedByName":"Romfarer","CreatedById":20387,"CreatedDateTime":"2012-07-07T11:20:53Z","Content":"\n\u003Cp\u003ESometimes i\\\u0027ll spend days looking through the codebase, searching on google and making test code to figure things out.\u003C/p\u003E\u003Cp\u003EI\\\u0027d start with looking into how KSP brings the parts into the game. I know you can access all the assets in the game at runtime, perhaps you can do it that way and convert a game object into a part. \u003C/p\u003E\n"},{"CreatedByName":"Vlad. Just Vlad.","CreatedById":12169,"CreatedDateTime":"2012-07-08T12:15:38Z","Content":"\n\u003Cp\u003EI think it\\\u0027s much more harder than just convert object into a part. It must be spawned:\u003C/p\u003E\u003Cp\u003E1. Near the ship\u003C/p\u003E\u003Cp\u003E2. With ship\\\u0027s velocity\u003C/p\u003E\u003Cp\u003E3. With velocity vector which is copy of ship\\\u0027s vector\u003C/p\u003E\n"},{"CreatedByName":"Katratszi","CreatedById":26024,"CreatedDateTime":"2012-07-09T02:25:46Z","Content":"\n\u003Cp\u003EI\\\u0027ve been working on this for the last day or so. I\\\u0027m taking a stab at docking.\u003C/p\u003E\u003Cp\u003EJust had my first bit of success:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E//Target is the target Vessel to clone\u003Cbr\u003EProtoVessel vesselClone = new ProtoVessel(target);\u003Cbr\u003E\u003Cbr\u003E/*\u003Cbr\u003E *Note: It appears to create a snapshot of the target\\\u0027s orbital parameters,\u003Cbr\u003E *and since it takes a non-zero amount of time to load the new vessel, it\u003Cbr\u003E *always ends trailing the target if you\\\u0027re in orbit.\u003Cbr\u003E*/\u003Cbr\u003EvesselClone.Load();\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cblockquote\u003E\u003Cp\u003E\u003Cimg src=\u0022https://dl.dropbox.com/u/86310799/KaAerospace/Screenshots/screenshot23.png\u0022 alt=\u0022screenshot23.png\u0022\u003E\u003C/p\u003E\u003Cp\u003EThe target is the vessel to the far right, the center vessel is the one with my test part, and the clones (and their debris) are to the left.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/blockquote\u003E\u003Cp\u003ENow to figure out how to modify the parts on the vessel. I imagine the secret lies somewhere ProtoVessel\\\u0027s description of the target Vessel.\u003C/p\u003E\n"},{"CreatedByName":"Vlad. Just Vlad.","CreatedById":12169,"CreatedDateTime":"2012-07-09T07:59:04Z","Content":"\n\u003Cp\u003EAnd it works? Now, I can make working EVA!\u003C/p\u003E\u003Cp\u003EAlchemist gave me code for decoupling and controlling kerbonaut. I worked on it and made kerbonaut destroying for return to ship, but then it become impossible to perform the second EVA. Now, I can make working EVA with Kerbonaut spawn.\u003C/p\u003E\u003Cp\u003EHow It works? It creates game object and converts it to game vessel with vesselClone.Load(); function? I think the code should have the next view:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003EOrbit orbitk = new Orbit();\u003Cbr\u003EVessel kerbonaut = new Vessel();\u003Cbr\u003Ekerbonaut.orbit = orbitk; //Create clone of ProtoVessel orbit;\u003Cbr\u003Ekerbonaut.orbit = orbitk; //Applies ProtoVessel\\\u0027s orbit to Kerbonaut\u003Cbr\u003Ekerbonaut.Load();\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EUPD: OH SHIT, kerbonaut.orbit is read only! How to bypass it?\u003C/p\u003E\n"},{"CreatedByName":"Katratszi","CreatedById":26024,"CreatedDateTime":"2012-07-09T12:30:05Z","Content":"\n\u003Cp\u003EYou\\\u0027ll probably need to change the orbit before loading the new vessel, check ProtoVessel.orbitSnapShot\u003C/p\u003E\u003Cp\u003EYou may want to look at Vessel.orbitDriver as well.\u003C/p\u003E\u003Cp\u003EAlso, just in case you didn\\\u0027t know, EVA\\\u0027s look to be the main feature of 0.16 which will probably be out in another 4-6 weeks.\u003C/p\u003E\n"},{"CreatedByName":"Vlad. Just Vlad.","CreatedById":12169,"CreatedDateTime":"2012-07-09T13:14:49Z","Content":"\n\u003Cp\u003E...and I can spend this weeks with EVA plugin.\u003C/p\u003E\u003Cp\u003ECode will be work if we\\\u0027ll find the way to bypass read-only propety.\u003C/p\u003E\n"},{"CreatedByName":"Katratszi","CreatedById":26024,"CreatedDateTime":"2012-07-09T15:01:45Z","Content":"\n\u003Cp\u003EWell, there\\\u0027s no way to \\\u0027bypass\\\u0027 a readonly property per say. Once a field/property has been marked readonly the CLR will enforce that restriction. \u003C/p\u003E\u003Cp\u003EYou will need to find another class/object to modify to get the same end result. \u003C/p\u003E\n"},{"CreatedByName":"Katratszi","CreatedById":26024,"CreatedDateTime":"2012-07-10T04:26:54Z","Content":"\n\u003Cp\u003EWell I figured out how to add parts and move parts relative to the ship in flight.\u003C/p\u003E\u003Cp\u003EBut I have one huge bug that I can\\\u0027t seem to figure out. For whatever reason the current stage of the cloned vessel doesn\\\u0027t work -- as in all the parts are in the idle state. If you activate the next stage everything is fine. If you force_activate() the parts in the current stage, they all switch to deactivated for some reason.\u003C/p\u003E\u003Cp\u003ELooking at the persistent.sfs file, the cloned ship\\\u0027s last stage\\\u0027s parts all have a state value of 0 (idle). But the ProtoPart\\\u0027s all have the correct state values. I also tried running the vessel\\\u0027s ClearStaging() and ResumeStaging() methods, those did not help. I can confirm that manually editing the persistent file so the state = 1 (active) switches those parts back on when switching to the vessel. So now its a matter of figuring out why vessel\\\u0027s part\\\u0027s serialize with the idle state...\u003C/p\u003E\u003Cp\u003EAnyone have any ideas?\u003C/p\u003E\u003Cp\u003EAlso, anyone know how to programatically switch vessels?\u003C/p\u003E\n"}]}