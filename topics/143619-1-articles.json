{"TopicId":143619,"ForumId":29,"TopicTitle":"[SOLVED] Cancel unintantional vertical speed change","CreatedByName":"Big-IN","CreatedById":75211,"CreatedDateTime":"2016-07-12T15:05:14Z","PageNum":1,"Articles":[{"CreatedByName":"Big-IN","CreatedById":75211,"CreatedDateTime":"2016-07-12T15:05:14Z","Content":"\n\u003Cp\u003E\nHello,\n\u003C/p\u003E\n\u003Cp\u003E\ni am trying to script an engine, that will (partially) cancel the unintentional change of vertical speed (like pull of gravity) and leave the v-speed added by engines as it is/was. The closest i did come to this goal is:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003EVector3d forceneut = FlightGlobals.getGeeForceAtPosition(vessel.GetWorldPos3D());\nforceneut = forceneut.normalized * -((forceneut.magnitude*2/10)*Time.fixedDeltaTime);\nforeach(Part p in vessel.parts)\n{\n\tp.rigidbody.AddForce(forceneut,ForceMode.Acceleration);\n}\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nUnfortunately the v-speed is still decreasing.\n\u003C/p\u003E\n\u003Cp\u003E\nWhat i want to accomplish:\n\u003C/p\u003E\n\u003Cp\u003E\n- Flying in any direction, any location, at any horizontal speed, vertical speed (v-Speed) = 0 m/s and pointing up/down = 0\u00B0 \u00A0\u00A0 =\u0026gt; v-Speed should remain 0 m/s\n\u003C/p\u003E\n\u003Cp\u003E\n- Speed changes by engines, lift force, ... should not be influenced\n\u003C/p\u003E\n\u003Cp\u003E\nWhat am i missing?\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nThx\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-08-02T12:06:24Z\u0022 title=\u002208/02/2016 12:06  PM\u0022 data-short=\u00227 yr\u0022\u003EAugust 2, 2016\u003C/time\u003E by Big-IN\u003C/strong\u003E\n\u003Cbr\u003ESOLVED\n\u003C/span\u003E\n"},{"CreatedByName":"Boris-Barboris","CreatedById":133181,"CreatedDateTime":"2016-07-12T17:00:19Z","Content":"\n\u003Cp\u003E\nWhat is the second line of code even supposed to achieve?\n\u003C/p\u003E\n"},{"CreatedByName":"Big-IN","CreatedById":75211,"CreatedDateTime":"2016-07-12T18:41:52Z","Content":"\n\u003Cp\u003E\nWith that line i hope to calculate how much speed and vector pointing away from the MainCelestialBody has to be added, to maintain the current vertical velocity and still orbit the MainCelestialBody.\n\u003C/p\u003E\n\u003Cp\u003E\nThere was (at least) one mistake in the calculation:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003Eforceneut = forceneut.normalized * -((forceneut.magnitude*2/10)*Time.fixedDeltaTime);\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nchanged to\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html\u0022\u003E\nforceneut = forceneut.normalized * -((forceneut.magnitude*forceneut.magnitude/10)*Time.fixedDeltaTime);\u003C/pre\u003E\n\u003Cp\u003E\nNow it works mostly. Am also not entirely sure why. With that calculation the v-Speed is decreasing.\n\u003C/p\u003E\n\u003Cp\u003E\nUnfortunately if i use \u0022forceneut.magnitute * Time.fixedDeltaTime\u0022, the v-Speed start to increase.\n\u003C/p\u003E\n"},{"CreatedByName":"Boris-Barboris","CreatedById":133181,"CreatedDateTime":"2016-07-13T08:08:31Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222672994\u0022 data-ipsquote-contentid=\u0022143619\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221468348912\u0022 data-ipsquote-userid=\u002275211\u0022 data-ipsquote-username=\u0022Big-IN\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n13 hours ago, Big-IN said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nchanged to\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nyou normalize some vector, then multiply it on negative of it\u0027s magnitude squared (?), divided by 10 (??) and multiplied on delta time (???). Is there an idea behind it, or you just combine opeartions and literals in random order?\n\u003C/p\u003E\n\u003Cp\u003E\nAnswer two questions for yourself:\n\u003C/p\u003E\n\u003Cp\u003E\nWhat does v-speed = const mean for v-acceleration?\u003Cbr\u003E\nWhat does\u00A0FlightGlobals.getGeeForceAtPosition(vessel.GetWorldPos3D()); return?\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-07-13T08:09:24Z\u0022 title=\u002207/13/2016 08:09  AM\u0022 data-short=\u00227 yr\u0022\u003EJuly 13, 2016\u003C/time\u003E by Boris-Barboris\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Big-IN","CreatedById":75211,"CreatedDateTime":"2016-07-13T10:23:23Z","Content":"\n\u003Cp\u003E\nYes, my calculation before is a bit random.\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222673919\u0022 data-ipsquote-contentid=\u0022143619\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221468397311\u0022 data-ipsquote-userid=\u0022133181\u0022 data-ipsquote-username=\u0022Boris-Barboris\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n10 hours ago, Boris-Barboris said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nAnswer two questions for yourself:\n\u003C/p\u003E\n\u003Cp\u003E\nWhat does v-speed = const mean for v-acceleration?\u003Cbr\u003E\nWhat does\u00A0FlightGlobals.getGeeForceAtPosition(vessel.GetWorldPos3D()); return?\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nv-speed = should be magnitude of v-velocity (v) in m/s.\n\u003C/p\u003E\n\u003Cp\u003E\nThe FilightGlobals.getGeeForceAtPosition(vessel.GetWorldPos3d()) does return the gravitational acceleration (a) in m/s/s at the position of the vessel. To convert the acceleration (m/s/s) to velocity (m/s), the acceleration has to be multiplyed by a time delta. (Found that after a long search.) In case of calculation in onFixedUpdate, the Time.fixedDeltaTime() (fdt) should be used.\n\u003C/p\u003E\n\u003Cp\u003E\nAfter reconsidering the calculation i came up with this formula to cancel gravity:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003Ev(-g) = a(g) * -fdt =\u0026gt; v(g) - v(-g) = 0 =\u0026gt; gravitational acceleration canceled\n(-fdt = fdt * -1)\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nWithout gravity, the vessel does drift away because of centrifugal force (did not think about that one before). For completeness: the formula for centrifugal acceleration is a(c) = v^2/r .\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003Ev(c) = a(c) * fdt = v(vessel)^2 / r * fdt\nv(c) - v(c) = 0 =\u0026gt; centrifugal acceleration canceled\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nMy curren code looks like this:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003E//*****************************************************************************\n// Copyright (c) 2016 by Big-IN\n// This code is Licensed under the Apache License, Version 2.0 (the \u0022License\u0022);\n// http://www.apache.org/licenses/LICENSE-2.0\n/*****************************************************************************\n\n// geeacc = acceleration down at vessel position in m/s/s\nVector3d geeacc = FlightGlobals.getGeeForceAtPosition(vessel.GetWorldPos3D());\n\n// radius = distance between vessel and center of mainBody\ndouble radius = vessel.altitude\u002Bvessel.mainBody.Radius;\n\n// centacc = acceleration up by centrifugal forces in m/s/s\nVector3d centacc = Math.Pow(FlightGlobals.ship_obtSpeed,2.0) / radius;\n\n// vneut = speed up in m/s required to conter gravitational - and centrifugal acceleration\nVector3d vneut = geeacc.normalized * -(geeacc.magnitude - centacc.magnitude);\n\n// apply vneut to every part\nforeach(Part p in vessel.parts)\n{\n\tp.rigidbody.AddForce(forceneut,ForceMode.Acceleration);\n}\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nI believe only air resistance is not canceled. The centrifugal forces are canceled in the up and down direction. Will have to find a way to cancel centrifugal force only when it is in the outward direction.\n\u003C/p\u003E\n\u003Cp\u003E\nThank you for your help.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-07-13T18:20:32Z\u0022 title=\u002207/13/2016 06:20  PM\u0022 data-short=\u00227 yr\u0022\u003EJuly 13, 2016\u003C/time\u003E by Big-IN\u003C/strong\u003E\n\u003Cbr\u003Etime delta Removed, RevealAltitude changed to Radius\n\u003C/span\u003E\n"},{"CreatedByName":"Boris-Barboris","CreatedById":133181,"CreatedDateTime":"2016-07-13T11:10:01Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222674019\u0022 data-ipsquote-contentid=\u0022143619\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221468405403\u0022 data-ipsquote-userid=\u002275211\u0022 data-ipsquote-username=\u0022Big-IN\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n47 minutes ago, Big-IN said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nFound that after a long search\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nOh, I understand now, you don\u0027t really feel comfortable with kinematics.\n\u003C/p\u003E\n\u003Cp\u003E\nPosition is a vector. When position of a body changes, we can divide that change (also a vector) by the time interval - we get velocity with this. Velocity describes, how fast the position is changing. Same with acceleration - it describes how fast the velocity is changing.\n\u003C/p\u003E\n\u003Cp\u003E\nWikipedia articles on velocity and acceleration can give you very good insight.\n\u003C/p\u003E\n\u003Cp\u003E\nYou want your engine to cancel out \u0022unwanted changes in v-speed\u0022. That means, that you may want to cancel out gravity-like forces in vertical projection. Let\u0027s leave aero forces out of scope, it\u0027s actually much harder to do.\n\u003C/p\u003E\n\u003Cp\u003E\nThose forces you want to cancel consist of three components - gravity itself, centrifugal and coriolis acceleration. Their vector sum can be found in \u003Cem\u003Evessel.graviticAcceleration\u003C/em\u003E field. It\u0027s acceleration, vector.\n\u003C/p\u003E\n\u003Cp\u003E\nIf you want to cancel only it\u0027s vertical component, you need to do:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003EVector3d planet2ves = (vessel.position - vessel.MainBody.position).normalized;   // unity vector, directed towards zenith\nVector3d counterAcceleration = -planet2ves * Vector3d.Dot(planet2ves, vessel.graviticAcceleration);  // project on it\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nand then apply \u003Cem\u003EcounterAcceleration\u003C/em\u003E to every part the same way you do (addForce). You apply acceleration, not changes in velocity. Acceleration is not a velocity change.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-07-13T11:11:24Z\u0022 title=\u002207/13/2016 11:11  AM\u0022 data-short=\u00227 yr\u0022\u003EJuly 13, 2016\u003C/time\u003E by Boris-Barboris\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Big-IN","CreatedById":75211,"CreatedDateTime":"2016-07-13T21:07:11Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222674058\u0022 data-ipsquote-contentid=\u0022143619\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221468408201\u0022 data-ipsquote-userid=\u0022133181\u0022 data-ipsquote-username=\u0022Boris-Barboris\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n12 hours ago, Boris-Barboris said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nOh, I understand now, you don\u0027t really feel comfortable with kinematics.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nYes, usually i do programming, not physics.\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222674058\u0022 data-ipsquote-contentid=\u0022143619\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221468408201\u0022 data-ipsquote-userid=\u0022133181\u0022 data-ipsquote-username=\u0022Boris-Barboris\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n12 hours ago, Boris-Barboris said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nThose forces you want to cancel consist of three components - gravity itself, centrifugal and coriolis acceleration. Their vector sum can be found in \u003Cem\u003Evessel.graviticAcceleration\u003C/em\u003E field. It\u0027s acceleration, vector.\n\u003C/p\u003E\n\u003Cp\u003E\nIf you want to cancel only it\u0027s vertical component, you need to do:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\n\u003Cspan class=\u0022pln\u0022\u003EVector3d planet2ves = (vessel.position - vessel.MainBody.position).normalized;   // unity vector, directed towards zenith\nVector3d counterAcceleration = -planet2ves * Vector3d.Dot(planet2ves, vessel.graviticAcceleration);  // project on it\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nand then apply \u003Cem\u003EcounterAcceleration\u003C/em\u003E to every part the same way you do (addForce). You apply acceleration, not changes in velocity. Acceleration is not a velocity change.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nUnfortunately i could not find any graviticAcceleration property in a vessel object. Are you sure, it is called like that?\n\u003C/p\u003E\n\u003Cp\u003E\nAlso \u0027am not sure, why the coriolis acceleration has also to be canceled. By what i understand, coriolis acceleration is the change in surface velocity occurring when a vessel is moving to or from the center of orbit.\n\u003C/p\u003E\n\u003Cp\u003E\nI have done some changes in the calculation.\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003E*** Code Removed: No longer needed. ***\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nThere is the wrong assumption, the centre of centrifugal force is the mainBody. That is not necessarily the case. Unfortunately i don\u0027t know how it should be calculated. How can it be done?\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nEDIT:\n\u003C/p\u003E\n\u003Cp\u003E\nChecked the vessel properties again. Could it be the case, that all required forces are avaliable in \u0022vessel.\u003Cspan style=\u0022font-style:italic;\u0022\u003EgForce\u003C/span\u003E \u0022, \u0022vessel.\u003Cspan style=\u0022font-style:italic;\u0022\u003ECentrifugalAcc\u003C/span\u003E\u0022 and \u0022vessel.\u003Cspan style=\u0022font-style:italic;\u0022\u003ECoriolisAcc\u003C/span\u003E\u0022? If that is true, they only have to be added up and multiplied by -1. The result can be applied by AddForce with ForceMode.Acceleration .\n\u003C/p\u003E\n\u003Cp\u003E\nEDIT:\n\u003C/p\u003E\n\u003Cp\u003E\nEasy calculation:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003EVector3d forecancel = -(vessel.gForce\u002Bvessel.CentrifugalAcc\u002Bvessel.CoriolisAcc);\nforeach (Part p in vessel.parts)\n{\n\tp.rigidbody.AddForce(forcecancel, Force.Acceleration);\n}\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nMany thanks to Boris-Barboris.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-07-13T23:21:43Z\u0022 title=\u002207/13/2016 11:21  PM\u0022 data-short=\u00227 yr\u0022\u003EJuly 13, 2016\u003C/time\u003E by Big-IN\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Boris-Barboris","CreatedById":133181,"CreatedDateTime":"2016-07-13T23:02:51Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222674814\u0022 data-ipsquote-contentid=\u0022143619\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221468444031\u0022 data-ipsquote-userid=\u002275211\u0022 data-ipsquote-username=\u0022Big-IN\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n1 hour ago, Big-IN said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nIf that is true, they only have to be added up and multiplied by -1. The result can be applied by AddForce with ForceMode.Acceleration .\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThat is true for KSP 1.1.2 and previous, API has changed recently afaik.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-07-13T23:05:20Z\u0022 title=\u002207/13/2016 11:05  PM\u0022 data-short=\u00227 yr\u0022\u003EJuly 13, 2016\u003C/time\u003E by Boris-Barboris\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Boris-Barboris","CreatedById":133181,"CreatedDateTime":"2016-07-13T23:47:00Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222674814\u0022 data-ipsquote-contentid=\u0022143619\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221468444031\u0022 data-ipsquote-userid=\u002275211\u0022 data-ipsquote-username=\u0022Big-IN\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n2 hours ago, Big-IN said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nEasy calculation:\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nNow, you might notice, that if you fly horizontally you\u0027ll still have your v-speed increased. Depending on what you want from your mod, you may want to create your own centrifugal acceleration to keep v-speed, not only the reference frame one (the one in vessel properties, wich accounts for\u00A0planet rotation). You can easily get it from vessel.horizontalSrfSpeed squared, divided by\u00A0distance from vessel to planet center. Direct it down, to the planet core.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-07-13T23:50:33Z\u0022 title=\u002207/13/2016 11:50  PM\u0022 data-short=\u00227 yr\u0022\u003EJuly 13, 2016\u003C/time\u003E by Boris-Barboris\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Big-IN","CreatedById":75211,"CreatedDateTime":"2016-07-13T23:58:26Z","Content":"\n\u003Cp\u003E\nDistance from vessel to planet is also known as orbit radius. Unfortunately a vessel permanently hovering closer to the poles would not have it\u0027s orbit around the celestial body. Instead the calculation must account for the axis of rotation. Any idea how that one can be calculated?\n\u003C/p\u003E\n"},{"CreatedByName":"Boris-Barboris","CreatedById":133181,"CreatedDateTime":"2016-07-14T08:44:09Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222675010\u0022 data-ipsquote-contentid=\u0022143619\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221468454306\u0022 data-ipsquote-userid=\u002275211\u0022 data-ipsquote-username=\u0022Big-IN\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n8 hours ago, Big-IN said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nDistance from vessel to planet is also known as orbit radius\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nIt is not orbit radius. Orbit radius is orbit radius (besides, only circular orbits have radii, others have semi-major and semi-minor axes).\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027m talking about vessel.position - vessel.MainBody.position. Just use the thing from my previous post, I\u0027ll explain it later if still needed.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-07-14T08:50:56Z\u0022 title=\u002207/14/2016 08:50  AM\u0022 data-short=\u00227 yr\u0022\u003EJuly 14, 2016\u003C/time\u003E by Boris-Barboris\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Big-IN","CreatedById":75211,"CreatedDateTime":"2016-07-28T00:09:00Z","Content":"\n\u003Cp\u003E\nIt has been some time (few weeks) since my programming for KSP. In the mean time i did rethink my approach at the problem.\n\u003C/p\u003E\n\u003Cp\u003E\nNow i do believe it\u0027s better to start with a vessel without any orbital speed. In such a case only the \u0022True\u0022 gravity has to be canceled. The formula for gravitational acceleration formula is:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003Eg = GM/r^2\n\ng = gravitational acceleration (toward the CelestialBody) (m/s^2)\nG = Gravitational Constant\nM = Mass of main CelestialBody\nr = distance between CelestialBoty and the vessel\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nIn case of KSP the\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003E gravmag = FlightGlobals.getGeeForceAtPosition(vessel.GetWorldPos3D()).magnitude;\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\ndoes give the right value.\n\u003C/p\u003E\n\u003Cp\u003E\nWithout gravity the vessel would continue movement in a straight line. To counter this, some additional centripetal acceleration is required. The formula for Centripetal\u00A0acceleration is:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003Ea = v^2/r\n\na = acceleration (away from the main CelestialBody) (m/s^2)\nv = orbital speed of the vessel (in any horizontal direction)\nr = distance between the vessel and main CelestialBody\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nThe resulting function looks like this:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003Eprivate void GravityNeutralisation()\n{\n  if(dNPower) return;\t\t//dNPower \u0026gt; 0\n\n  double radius = (vessel.GetWorldPos3D()-vessel.mainBody.position).magnitude;\n\n  double horvel = (vessel.obt_velocity-vessel.upAxis*Vector3d.Dot(vessel.upAxis,vessel.obt_velocity)).magnitude;\n  double centacc = (horvel*horvel)/radius;\n  double gravmag = FlightGlobals.getGeeForceAtPosition(vessel.GetWorldPos3D()).magnitude;\n\n  if (gravmag\u0026gt;centacc)\n  {\n    // geeneut = vessel.upAxis*gravmag \u002B (-vessel.upAxis*centacc);\n    // geeneut = vessel.upAxis*gravmag - vessel.upAxis*centacc);\n    geeneut = vessel.upAxis * (gravmag - centacc);\n    geeneut = geeneut * dNPower;\t\t// dNPower is for percentage of neutralisation (0.0 = Off, 1.0 = Max)\n    foreach (Part p in this.vessel.parts)\n    {\n      if ((p.physicalSignificance == Part.PhysicalSignificance.FULL) \u0026amp;\u0026amp; (p.rigidbody != null))\n      {\n      \tp.rigidbody.AddForce(geeneut, ForceMode.Acceleration);\n      }\n    }\n  }\n}\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nStill don\u0027t see, where the Coriolis Acceleration is applied.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-07-28T11:45:22Z\u0022 title=\u002207/28/2016 11:45  AM\u0022 data-short=\u00227 yr\u0022\u003EJuly 28, 2016\u003C/time\u003E by Big-IN\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Boris-Barboris","CreatedById":133181,"CreatedDateTime":"2016-07-28T00:31:07Z","Content":"\n\u003Cp\u003E\nWhat do you mean where? Vessel, moving from equator towards pole will experience coriolis acceleration in surface reference frame. You\u00A0can ignore it, it\u0027s small and barely noticible, but it is already precalculated in vessel fields\u00A0and there is no price for using it.\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode\u0022\u003E\nif (gravmag\u0026gt;centacc)\u003C/pre\u003E\n\u003Cp\u003E\nwhy?\n\u003C/p\u003E\n\u003Cp\u003E\nOther than that, looks fine.\n\u003C/p\u003E\n"},{"CreatedByName":"Big-IN","CreatedById":75211,"CreatedDateTime":"2016-07-29T11:16:35Z","Content":"\n\u003Cp\u003E\nThe neutralisation is only ment as \u0022hovering\u0022 support. By comparing gravmag and cntacc\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode\u0022\u003E\nif (gravmag\u0026gt;centacc)\u003C/pre\u003E\n\u003Cp\u003E\nthe result should be limited to this purpose only.\n\u003C/p\u003E\n\u003Cp\u003E\nWhen the orbital velocity is increasing, centacc is also increasing. When the gravmag == centacc, that means, the vessel is moving at orbital velocity. No further support is required. If the vessel accelerate further ( centacc \u0026gt; gravmag ), the vessel is speeding away from the celestial body, by it\u0027s own velocity. At least that\u0027s the theory. Did not have the chance to test this.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-07-29T11:18:32Z\u0022 title=\u002207/29/2016 11:18  AM\u0022 data-short=\u00227 yr\u0022\u003EJuly 29, 2016\u003C/time\u003E by Big-IN\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Boris-Barboris","CreatedById":133181,"CreatedDateTime":"2016-07-29T11:20:01Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222695870\u0022 data-ipsquote-contentid=\u0022143619\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221469790995\u0022 data-ipsquote-userid=\u002275211\u0022 data-ipsquote-username=\u0022Big-IN\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n2 minutes ago, Big-IN said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nDid not have the chance to test this.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nOh, so you want to let the ship go free on very large speeds, sounds legit, that will do.\n\u003C/p\u003E\n"},{"CreatedByName":"Big-IN","CreatedById":75211,"CreatedDateTime":"2016-07-29T11:52:59Z","Content":"\n\u003Cp\u003E\nWhile for development and test purposes there is no ressource usage, neutralisation will affect the consumption in the end. No need wasting ressources if not (really) necessary.\n\u003C/p\u003E\n\u003Cp\u003E\nThank you for your help.\n\u003C/p\u003E\n"}]}