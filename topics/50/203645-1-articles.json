{"TopicId":203645,"ForumId":50,"TopicTitle":"How to play KSP with Unity 2019 on Old Potatoes!!","CreatedByName":"Lisias","CreatedById":187168,"CreatedDateTime":"2021-07-06T07:16:20Z","PageNum":1,"Articles":[{"CreatedByName":"Lisias","CreatedById":187168,"CreatedDateTime":"2021-07-06T07:16:20Z","Content":"\n\u003Cp\u003E\nThat\u0027s the History.\n\u003C/p\u003E\n\u003Cp\u003E\nWhen KSP 1.8. came, using Unity 2019, my old Mac Mini 5.1 (i5, 2 cores, 4 HyperThreads)\u00A0didn\u0027t handled it. I just could not fire up KSP and keep the machine useable - the whole thing started to stutter. Facebook, Youtube, command line terminals, you name it. Everything were stuttering, it was impossible to watch a video!\n\u003C/p\u003E\n\u003Cp\u003E\nSince I was going to buy a new old rig anyway (that by pure chance ended up being an Mac mini 6.2 - 4 Cores, 8 HTs), I didn\u0027t gave it to much attention. The new old Potato ended up handling KSP \u0026gt;= 1.8.0 and that\u00A0allowed me to keep using it for development\u00A0(besides KSP 1.7.3 still being way more performatic, being the reason my main playing is still 1.7).\n\u003C/p\u003E\n\u003Cp\u003E\nAnd so KSP 1.12 came, and screwed everything again:\u00A0KSP 1.12 did to my Mac Mini 6.2 what KSP 1.8 did on the 5.1 . \u003Cem\u003EKrap\u003C/em\u003E.\n\u003C/p\u003E\n\u003Cp\u003E\nOh, well. Life goes on. I still can run KSP 1.12 for some \u0022quick\u0022\u00A0and small tests and use 1.11 for the main workload until I figure out a way to buy yet another new old potato. \u003Cspan\u003E\u003Cimg alt=\u0022:P\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif\u0022 title=\u0022:P\u0022\u003E\u00A0\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nBut then I realized I made a less than ideal decision making on a thingy called \u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003ERefunding\u003C/span\u003E from \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/192048-18/\u0022 rel=\u0022\u0022\u003EKSP-Recall\u003C/a\u003E. At that time, I had pretty little time to fool around and made things the fast as I could in order to work around the problem under my nose, rushed the thingy into the Mainstream and gone back to day job, and by doing this \u003Ca href=\u0022https://github.com/net-lisias-ksp/KSP-Recall/issues/21\u0022 rel=\u0022external nofollow\u0022\u003EI ended up bullying the GC\u003C/a\u003E. I then optimised a bit the memory usage, but the bulling just would not stop. It ended up being (another) bug on KSP that was causing a memory leak, that was triggering the GC a lot, that was being \u003Ca href=\u0022https://github.com/net-lisias-ksp/KSP-Recall/issues/23\u0022 rel=\u0022external nofollow\u0022\u003Esabotaged by \u003Cem\u003E\u003Cstrong\u003Espinlocks\u003C/strong\u003E\u003C/em\u003E on the waiting threads\u003C/a\u003E!\n\u003C/p\u003E\n\u003Cp\u003E\nChecking the worst processor hogs on the KSP\u0027s process, it came to my attention that almost 100% of the CPU time was being used on a system \u00A0call related to Semaphores inside an\u00A0Unity thread, the \u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003Edispatch_semaphore_wait_slow\u003C/span\u003E that by itself was spinning around \u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003Eos_semaphore_wait\u003C/span\u003E that by its turn was calling \u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003Esemaphore_wait_trap\u003C/span\u003E.\n\u003C/p\u003E\n\u003Cp style=\u0022text-align:center;\u0022\u003E\n\u003Cimg alt=\u0022Process-Thread-View.png\u0022 class=\u0022ipsImage\u0022 data-ratio=\u002261.51\u0022 height=\u0022553\u0022 width=\u0022899\u0022 src=\u0022https://ksp.lisias.net/blogs/rants/on-Unity/content/Unitys-spinlocks-against-the-World/Process-Thread-View.png\u0022\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nInteresting. Checking the other threads of the KSP\u0027s process, I got horrified!\n\u003C/p\u003E\n\u003Cp style=\u0022text-align:center;\u0022\u003E\n\u003Cimg alt=\u0022Process-ManyThread-View.png\u0022 class=\u0022ipsImage\u0022 data-ratio=\u002276.52\u0022 height=\u0022616\u0022 width=\u0022805\u0022 src=\u0022https://ksp.lisias.net/blogs/rants/on-Unity/content/Unitys-spinlocks-against-the-World/Process-ManyThread-View.png\u0022\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cstrong\u003ELOTS AND LOTS OF THREADS hogging up 100% of the CPU\u003C/strong\u003E, a clear indication of busy waits!\n\u003C/p\u003E\n\u003Cp\u003E\nIt\u0027s not a surprise\u00A0\u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003ERefunding\u003C/span\u003E\u00A0was provoking a memory leak - there\u0027re so\u00A0many threads busy waiting for the GC that there\u0027s no CPU left for the GC itself, and so we have a dead lock!!!\n\u003C/p\u003E\n\u003Cp style=\u0022text-align:center;\u0022\u003E\n\u003Cimg alt=\u0022Process-All-Threads-Screwed.png\u0022 class=\u0022ipsImage\u0022 data-ratio=\u002272.06\u0022 height=\u0022606\u0022 width=\u0022841\u0022 src=\u0022https://ksp.lisias.net/blogs/rants/on-Unity/content/Unitys-spinlocks-against-the-World/Process-All-Threads-Screwed.png\u0022\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nEvery single thread, including\u00A0\u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003EOSX HID Input\u003C/span\u003E\u00A0(Human Interface Devices) are boggling the CPU at 100%! It\u0027s evident now why the input is so sluggish when your crafts gets to big for your rig!!!!\n\u003C/p\u003E\n\u003Cp\u003E\nDigging a bit more on the subject around the Internet, I came to a Swift code like this one:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\u003Cspan class=\u0022pln\u0022\u003E        if (mutex_sem != 0)\n            kr = semaphore_wait_signal_trap(cond_sem, mutex_sem);\n        else\n            kr = semaphore_wait_trap(cond_sem);\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nWhat explains a lot -\u00A0\u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003Esemaphore_wait_trap\u003C/span\u003E\u00A0is used\u00A0\u003Cstrong\u003Ewithout\u003C/strong\u003E\u00A0a mutex, and so somebody somewhere is using a\u00A0\u003Cem\u003E\u003Cstrong\u003Espinlock\u003C/strong\u003E\u003C/em\u003E\u00A0to do the job - you know, we need to synchronize things between threads, right?\n\u003C/p\u003E\n\u003Cp\u003E\nRemembering a very productive exchange with \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/204885-darthgently/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022204885\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/204885-darthgently/\u0022 rel=\u0022\u0022\u003E@darthgently\u003C/a\u003E, I decided to use one of the tricks he taught me, the\u00A0\u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003EMONO_THREADS_PER_CPU\u003C/span\u003E environment variable. It tells mono to, well, limit the number of threads per CPU. \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nBy limiting this number, we would have\u00A0\u003Cstrong\u003Eless\u003C/strong\u003E\u00A0\u003Cem\u003E\u003Cstrong\u003Espinlocks\u003C/strong\u003E\u003C/em\u003E on the process, and so the poor CPU would have a better chance to do its job instead of spinning around the same code waiting for something that will never happens because the CPU is being completely screwed up by the waiting threads.\n\u003C/p\u003E\n\u003Cp\u003E\nSince I\u0027m on a UNIX machine, this is what I did:\n\u003C/p\u003E\n\u003Cp style=\u0022text-align:center;\u0022\u003E\n\u003Cimg alt=\u0022KSP-with-MONO-THREADS-PER-CPU.png\u0022 class=\u0022ipsImage\u0022 data-ratio=\u002242.54\u0022 height=\u0022442\u0022 width=\u00221039\u0022 src=\u0022https://ksp.lisias.net/blogs/rants/on-Unity/content/Unitys-spinlocks-against-the-World/KSP-with-MONO-THREADS-PER-CPU.png\u0022\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nThe command\u00A0\u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003EMONO_THREADS_PER_CPU=1 ./KSP.app/Contents/MacOS/KSP\u003C/span\u003E\u00A0will set the environment variable and then call the executable \u0060KSP\u0060. On exit, the environment variable will be lost, so no chance for it to linger and end up screwing up some other process you call later.\n\u003C/p\u003E\n\u003Cp\u003E\nAnd that, my friends, solved the problem for me. My old Mac Potato 5.1 is now able to run KSP 1.8.1 . Barely, the game is still slugish but the rest of the machine is useable! I can even watch Youtube videos while running KSP 1.8.1, something that was impossible for this machine 17 months ago!\n\u003C/p\u003E\n\u003Cp\u003E\nMy less old Mac Potato 6.2 managed to withhold some more abuse from KSP 1.8.0 to KSP 1.11.2 because it have\u00A0\u003Cstrong\u003Etwice\u003C/strong\u003E\u00A0the cores of my previous rig, but now on KSP 1.12.0 \u003Cs\u003Esomeone increased the default number of threads per CPU again (or something similar)\u003C/s\u003E\u00A0\u003Cem\u003E[edit: see note below]\u003C/em\u003E, and it screwed up my i7: there\u0027s no point on increasing the working threads with \u003Cem\u003E\u003Cstrong\u003Espinlocks\u003C/strong\u003E\u003C/em\u003E, all you will get is more threads waiting for something that will never happens because your threads are preventing everything else to run!\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cstrong\u003ENote\u003C/strong\u003E: Since the last time I revisited this article, I managed to diagnose the reason KSP 1.12.x screwed up so badly my punny Mac Potato 6.2: \u003Cstrong\u003ETHE TEXTURES\u003C/strong\u003E. Squad essentially quadrupled the VRAM footprint and this completely wrecked my GPU, as it has a maximum of 1536MB of VRAM. By manually shrinking the textures sizes to a quarter of the original size (more or less the sizes on the KSP 1.5 era) KSP 1.12.x behave nicely on my rig! More info on this \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/207971-how-to-play-ksp-with-unity-2019-on-old-potatoes-part-ii/\u0022 rel=\u0022\u0022\u003Ethread\u003C/a\u003E.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cstrong\u003E\u003Cspan style=\u0022font-size:24px;\u0022\u003EAftermath\u003C/span\u003E\u003C/strong\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nRight now, I\u0027m being able to run KSP \u0026gt;= 1.8 on my oldest rig by using this trick. I\u0027m trying now to figure out the best compromise of threads for my rig (2 appears to be acceptable, I will try 4 on my next time window for this). I\u0027m pretty confident that a similar trick will \u0022solve\u0022 the issue for my less older Mac Potato, so soon I\u0027m be able to test drive things (and diagnose problems) on KSP 1.12.x, something that until now I was not able to do properly.\n\u003C/p\u003E\n\u003Cp\u003E\nThese hacks are not solving the bad performance of KSP itself, besides it is getting slightly better (or less worse)\u00A0too. What will solve the problem\u00A0\u003Cstrong\u003Efor good\u003C/strong\u003E is using\u00A0\u003Cstrong\u003EMUTEXES\u003C/strong\u003E\u00A0instead of \u003Cem\u003E\u003Cstrong\u003Espinlocks\u003C/strong\u003E\u003C/em\u003E, and this is something I do not currently know if it\u0027s doable by options or environment variables.\n\u003C/p\u003E\n\u003Cp\u003E\nI will update this article with my findings as they happen.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cstrong\u003E\u003Cspan style=\u0022font-size:24px;\u0022\u003EAddenda\u003C/span\u003E\u003C/strong\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cspan style=\u0022font-size:18px;\u0022\u003E\u003Cstrong\u003EOn KSP 1.7.3\u003C/strong\u003E\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nOut of curiosity, I fired up KSP 1.7.3 (Unity 2017) and inspected the process the same way I did on KSP 1.8.1:\n\u003C/p\u003E\n\u003Cp style=\u0022text-align:center;\u0022\u003E\n\u003Cspan style=\u0022background-color:#ffffff;color:#000000;font-size:16px;text-align:justify;\u0022\u003E\u003Cimg alt=\u0022KSP173-Process-ManyThread-View.png\u0022 class=\u0022ipsImage\u0022 data-ratio=\u002267.88\u0022 height=\u0022674\u0022 width=\u0022993\u0022 src=\u0022https://ksp.lisias.net/blogs/rants/on-Unity/content/Unitys-spinlocks-against-the-World/KSP173-Process-ManyThread-View.png\u0022\u003E\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nWe still have lots of threads screwing up the cores with\u00A0\u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003Esemaphore_wait_trap\u003C/span\u003E, but we also have some others that don\u0027t!\n\u003C/p\u003E\n\u003Cp\u003E\nSome unnamed threads are using\u00A0\u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003Enanosleep\u003C/span\u003E, and the\u00A0\u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003EOSX HID Input\u003C/span\u003E\u00A0one is using\u00A0\u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003Emach_msg_trap\u003C/span\u003E.\n\u003C/p\u003E\n\u003Cp\u003E\nWe have now good evidences that my thesis have teeth.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cspan style=\u0022font-size:18px;\u0022\u003E\u003Cstrong\u003EOn KSP 1.3.1\u003C/strong\u003E\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nOn KSP 1.3.1 (Unity 5) I got similar results!\n\u003C/p\u003E\n\u003Cp style=\u0022text-align:center;\u0022\u003E\n\u003Cimg alt=\u0022KSP131-Process-ManyThread-View.png\u0022 class=\u0022ipsImage\u0022 data-ratio=\u002265.04\u0022 height=\u0022679\u0022 width=\u00221044\u0022 src=\u0022https://ksp.lisias.net/blogs/rants/on-Unity/content/Unitys-spinlocks-against-the-World/KSP131-Process-ManyThread-View.png\u0022\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nIt worths to mention that KSP 1.3.1 and older are simply the best performatic KSP versions on my i5. Point.\n\u003C/p\u003E\n\u003Cp\u003E\nI think we have a pattern here. Unity is (ab)using\u00A0\u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003Edispatch_semaphore_wait_slow\u003C/span\u003E\u00A0on Version 2019, and this is royally screwing KSP on anything not top notch (and probably hindering top notch machines as they would probably perform better without this mess).\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cstrong\u003E\u003Cspan style=\u0022font-size:24px;\u0022\u003EConclusions\u003C/span\u003E\u003C/strong\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nBesides being a Bad Move\u2122 (and Unity would have better results on the field without using that kind of stunt), what\u0027s really screwing up things is not necessarily the\u00A0\u003Cem\u003E\u003Cstrong\u003Espinlocks\u003C/strong\u003E\u003C/em\u003E, but using them where a proper\u00A0\u003Cstrong\u003EMUTEX\u003C/strong\u003E\u00A0is really mandatory. The HID Input thread appears to be one of them, at least.\n\u003C/p\u003E\n\u003Cp\u003E\nI think it\u0027s more than due time for Unity to start getting their excrements together and do things right. For a change.\n\u003C/p\u003E\n\u003Cp style=\u0022text-align:right;\u0022\u003E\n\u003Cspan style=\u0022font-size:10px;\u0022\u003EThis article is also \u003Ca href=\u0022https://ksp.lisias.net/blogs/rants/on-Unity/Unitys-spinlocks-against-the-World\u0022 rel=\u0022external nofollow\u0022\u003Epublished on my site.\u003C/a\u003E\u003C/span\u003E\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222022-10-05T22:59:05Z\u0022 title=\u002210/05/2022 10:59  PM\u0022 data-short=\u00221 yr\u0022\u003EOctober 5, 2022\u003C/time\u003E by Lisias\u003C/strong\u003E\n\u003Cbr\u003ENotes.\n\u003C/span\u003E\n"},{"CreatedByName":"Lisias","CreatedById":187168,"CreatedDateTime":"2021-07-06T13:56:10Z","Content":"\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/69272-steve_v/\u0026amp;do=hovercard\u0022 data-mentionid=\u002269272\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/69272-steve_v/\u0022 rel=\u0022\u0022\u003E@steve_v\u003C/a\u003E, if you are still around, I think you will like this one.\n\u003C/p\u003E\n"},{"CreatedByName":"Commodore_32","CreatedById":200414,"CreatedDateTime":"2021-07-06T14:03:21Z","Content":"\n\u003Cp\u003E\nhi there\n\u003C/p\u003E\n\u003Cp\u003E\nSo, this will very likely reduce the CPU overload and very posibly remove my TLA issue from my other thread\n\u003C/p\u003E\n\u003Cp\u003E\nBut the question is, how do i run this code and where?, I\u0027m very unfamiliar with C\u002B\u002B or MS DOS so yeah\n\u003C/p\u003E\n"},{"CreatedByName":"Lisias","CreatedById":187168,"CreatedDateTime":"2021-07-06T14:14:11Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00224000460\u0022 data-ipsquote-contentid=\u0022203645\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221625580201\u0022 data-ipsquote-userid=\u0022200414\u0022 data-ipsquote-username=\u0022Commodore_32\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nJust now, Commodore_32 said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nhi there\n\u003C/p\u003E\n\u003Cp\u003E\nSo, this will very likely reduce the CPU overload and very posibly remove my TLA issue from my other thread\n\u003C/p\u003E\n\u003Cp\u003E\nBut the question is, how do i run this code and where?, I\u0027m very unfamiliar with C\u002B\u002B or MS DOS so yeah\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nYou are running on Windows, right? Well, on Windows I only remember how to set\u00A0\u003Cstrong\u003Esystem wide\u003C/strong\u003E\u00A0Environment Variables. Whats not exactly optimal, because we want a way to set it up only for KSP 1.8.0 and newer.\n\u003C/p\u003E\n\u003Cp\u003E\nAnyway, this link explains how to do it:\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://www.twilio.com/blog/2017/01/how-to-set-environment-variables.html\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://www.twilio.com/blog/2017/01/how-to-set-environment-variables.html\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nYou want to create a new ENVVAR called \u003Cspan style=\u0022background-color:#f9f9f9;color:#2d3134;font-size:15px;\u0022\u003EMONO_THREADS_PER_CPU\u003C/span\u003E\u00A0and set it to 1, and see what happens. If your problem persists, it will not help you - so redo the steps above and\u00A0\u003Cstrong\u003Eremove\u003C/strong\u003E\u00A0this variable, as it will hinder your Unity games for sure.\n\u003C/p\u003E\n\u003Cp\u003E\nOn the other hand, if the stunt sticks, you will want to change 1 to a bigger value, the bigger you can set it up without screwing up your computer (neither triggering the TLA again). It\u0027s a trial and error process.\n\u003C/p\u003E\n\u003Cp\u003E\nLet me know if it works for you! This appears to be important.\n\u003C/p\u003E\n"},{"CreatedByName":"Commodore_32","CreatedById":200414,"CreatedDateTime":"2021-07-06T14:22:16Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00224000463\u0022 data-ipsquote-contentid=\u0022203645\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221625580851\u0022 data-ipsquote-userid=\u0022187168\u0022 data-ipsquote-username=\u0022Lisias\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n6 minutes ago, Lisias said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nYou are running on Windows, right? Well, on Windows I only remember how to set\u00A0\u003Cstrong\u003Esystem wide\u003C/strong\u003E\u00A0Environment Variables. Whats not exactly optimal, because we want a way to set it up only for KSP 1.8.0 and newer.\n\u003C/p\u003E\n\u003Cp\u003E\nAnyway, this link explains how to do it:\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://www.twilio.com/blog/2017/01/how-to-set-environment-variables.html\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://www.twilio.com/blog/2017/01/how-to-set-environment-variables.html\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nYou want to create a new ENVVAR called \u003Cspan style=\u0022background-color:#f9f9f9;color:#2d3134;font-size:15px;\u0022\u003EMONO_THREADS_PER_CPU\u003C/span\u003E\u00A0and set it to 1, and see what happens. If your problem persists, it will not help you - so redo the steps above and\u00A0\u003Cstrong\u003Eremove\u003C/strong\u003E\u00A0this variable, as it will hinder your Unity games for sure.\n\u003C/p\u003E\n\u003Cp\u003E\nOn the other hand, if the stunt sticks, you will want to change 1 to a bigger value, the bigger you can set it up without screwing up your computer (neither triggering the TLA again). It\u0027s a trial and error process.\n\u003C/p\u003E\n\u003Cp\u003E\nLet me know if it works for you! This appears to be important.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nAlright, I did the steps and made the \u003Cspan style=\u0022background-color:#f9f9f9;color:#2d3134;font-size:15px;\u0022\u003E\u0022MONO_THREADS_PER_CPU\u0022 Enviroment Variable with a value of 1, I will restart and test later to see if it helps, thanks for the information.\u003C/span\u003E\n\u003C/p\u003E\n"},{"CreatedByName":"Curveball Anders","CreatedById":107529,"CreatedDateTime":"2021-07-06T17:50:29Z","Content":"\n\u003Cp\u003E\nExcellent analysis!\u003Cbr\u003E\u003Cbr\u003E\nJust two questions:\n\u003C/p\u003E\n\u003Cp\u003E\n1. What\u0027s the default value?\n\u003C/p\u003E\n\u003Cp\u003E\n2. Does it matter how many cores and threads you have?\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"darthgently","CreatedById":204885,"CreatedDateTime":"2021-07-06T18:03:46Z","Content":"\n\u003Cp\u003E\nOne thing to note is that the environment variable will only affect mono processes run from the shell/cli/terminal it is set within. If you set up a shortcut to launch a terminal to run KSP from a script, with the env var setting in the script, the env var will effectively be in a sandbox unless you run another mono app from within that same shell/cli/terminal\n\u003C/p\u003E\n"},{"CreatedByName":"darthgently","CreatedById":204885,"CreatedDateTime":"2021-07-06T18:13:47Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00224000590\u0022 data-ipsquote-contentid=\u0022203645\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221625593829\u0022 data-ipsquote-userid=\u0022107529\u0022 data-ipsquote-username=\u0022Curveball Anders\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n20 minutes ago, Curveball Anders said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nExcellent analysis!\u003Cbr\u003E\u003Cbr\u003E\nJust two questions:\n\u003C/p\u003E\n\u003Cp\u003E\n1. What\u0027s the default value?\n\u003C/p\u003E\n\u003Cp\u003E\n2. Does it matter how many cores and threads you have?\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nI don\u0027t know what the default is.\u00A0 KSP reportedly only uses one core ever, which is why this setting can help.\u00A0 By limiting to a single thread it apparently prevents multiple threads from fighting/waiting for resources via spinlocks.\u00A0 This is a great find Lisias.\u00A0 I was just dinking around with the var but it never occurred to me to set it 1.\u00A0 I\u0027ve been trying values between 5 and 20, lol\n\u003C/p\u003E\n"},{"CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2021-07-06T18:26:21Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00224000463\u0022 data-ipsquote-contentid=\u0022203645\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221625580851\u0022 data-ipsquote-userid=\u0022187168\u0022 data-ipsquote-username=\u0022Lisias\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n4 hours ago, Lisias said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nYou are running on Windows, right? Well, on Windows I only remember how to set\u00A0\u003Cstrong\u003Esystem wide\u003C/strong\u003E\u00A0Environment Variables. Whats not exactly optimal, because we want a way to set it up only for KSP 1.8.0 and newer.\n\u003C/p\u003E\n\u003Cp\u003E\nAnyway, this link explains how to do it:\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://www.twilio.com/blog/2017/01/how-to-set-environment-variables.html\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://www.twilio.com/blog/2017/01/how-to-set-environment-variables.html\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nYou want to create a new ENVVAR called \u003Cspan style=\u0022background-color:#f9f9f9;color:#2d3134;font-size:15px;\u0022\u003EMONO_THREADS_PER_CPU\u003C/span\u003E\u00A0and set it to 1, and see what happens. If your problem persists, it will not help you - so redo the steps above and\u00A0\u003Cstrong\u003Eremove\u003C/strong\u003E\u00A0this variable, as it will hinder your Unity games for sure.\n\u003C/p\u003E\n\u003Cp\u003E\nOn the other hand, if the stunt sticks, you will want to change 1 to a bigger value, the bigger you can set it up without screwing up your computer (neither triggering the TLA again). It\u0027s a trial and error process.\n\u003C/p\u003E\n\u003Cp\u003E\nLet me know if it works for you! This appears to be important.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nWould it make any difference to use this on a higher-end system?\u00A0 and if so, any suggested values for it?\n\u003C/p\u003E\n"},{"CreatedByName":"darthgently","CreatedById":204885,"CreatedDateTime":"2021-07-06T18:28:32Z","Content":"\n\u003Cp\u003E\nSo far, on a 12 core i7, I\u0027m getting about ~30% (guesstimate) faster scene switching with it set to 1.\u00A0 Actual ascent of a small craft is about the same from what I can tell, but will check with a larger craft later\n\u003C/p\u003E\n"},{"CreatedByName":"Lisias","CreatedById":187168,"CreatedDateTime":"2021-07-06T18:56:18Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00224000607\u0022 data-ipsquote-contentid=\u0022203645\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221625595981\u0022 data-ipsquote-userid=\u0022129964\u0022 data-ipsquote-username=\u0022linuxgurugamer\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n52 minutes ago, linuxgurugamer said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nWould it make any difference to use this on a higher-end system?\u00A0 and if so, any suggested values for it?\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nDon\u0027t have a clue, it can shoot backwards easily.\n\u003C/p\u003E\n\u003Cp\u003E\nAs a rule of thumb, you should not have more threads on spinlocks than the available CPUs (or hyper threads). But by doing so, you sabotage paralelism on your rig.\n\u003C/p\u003E\n\u003Cp\u003E\nSo there\u0027s a sweat spot where you don\u0027t screw up too much your cores to the point of saturation and still have decent parallelism.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nApparently this sweat spot is 2 for i5 mobile - more than this and the whole machine start to stutter without any benefit for the game.\n\u003C/p\u003E\n\u003Cp\u003E\nXeon cores will probably withhold more abuse.\n\u003C/p\u003E\n\u003Cp\u003E\nBut you will need to try and err your way on your rig.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00224000609\u0022 data-ipsquote-contentid=\u0022203645\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221625596112\u0022 data-ipsquote-userid=\u0022204885\u0022 data-ipsquote-username=\u0022darthgently\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n49 minutes ago, darthgently said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nSo far, on a 12 core i7, I\u0027m getting about ~30% (guesstimate) faster scene switching with it set to 1.\u00A0 Actual ascent of a small craft is about the same from what I can tell, but will check with a larger craft later\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nGeez!!! That much?\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222021-07-06T19:19:02Z\u0022 title=\u002207/06/2021 07:19  PM\u0022 data-short=\u00223 yr\u0022\u003EJuly 6, 2021\u003C/time\u003E by Lisias\u003C/strong\u003E\n\u003Cbr\u003Etyop! Surprised?\n\u003C/span\u003E\n"},{"CreatedByName":"darthgently","CreatedById":204885,"CreatedDateTime":"2021-07-06T19:08:05Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00224000623\u0022 data-ipsquote-contentid=\u0022203645\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221625597778\u0022 data-ipsquote-userid=\u0022187168\u0022 data-ipsquote-username=\u0022Lisias\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n10 minutes ago, Lisias said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nDon\u0027t have a clue, it can shoot backwards easily.\n\u003C/p\u003E\n\u003Cp\u003E\nAs a rule of thumb, you should not have more threads on spinloxks than the available CPUs (or hyper threads). But by doing so, you sabotage paralelism on your rig.\n\u003C/p\u003E\n\u003Cp\u003E\nSo there\u0027s a sweat spot where you don\u0027t screw up too much your cores to the point of saturation and still have decent parallelism.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nApparently this sweat spot is 2 for i5 mobile - more than this and the whole machine start to stutter without any benefit for the game.\n\u003C/p\u003E\n\u003Cp\u003E\nXeon cores will probably withhold more abuse.\n\u003C/p\u003E\n\u003Cp\u003E\nBut you will need to try and err your way on your rig.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nGeez!!! That much?\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nA guess.\u00A0 And I\u0027d just restarted the game.\u00A0 I do have a lot of mods that generate a lot of usage during scene changes.\u00A0 I dunno.\u00A0 I\u0027ll be more rigorous later\n\u003C/p\u003E\n"},{"CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2021-07-06T19:14:37Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00224000623\u0022 data-ipsquote-contentid=\u0022203645\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221625597778\u0022 data-ipsquote-userid=\u0022187168\u0022 data-ipsquote-username=\u0022Lisias\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n17 minutes ago, Lisias said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nDon\u0027t have a clue, it can shoot backwards easily.\n\u003C/p\u003E\n\u003Cp\u003E\nAs a rule of thumb, you should not have more threads on spinloxks than the available CPUs (or hyper threads). But by doing so, you sabotage paralelism on your rig.\n\u003C/p\u003E\n\u003Cp\u003E\nSo there\u0027s a sweat spot where you don\u0027t screw up too much your cores to the point of saturation and still have decent parallelism.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nApparently this sweat spot is 2 for i5 mobile - more than this and the whole machine start to stutter without any benefit for the game.\n\u003C/p\u003E\n\u003Cp\u003E\nXeon cores will probably withhold more abuse.\n\u003C/p\u003E\n\u003Cp\u003E\nBut you will need to try and err your way on your rig.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nGeez!!! That much?\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nI have an i9900, will have to test later\n\u003C/p\u003E\n"},{"CreatedByName":"Lisias","CreatedById":187168,"CreatedDateTime":"2021-07-07T15:03:02Z","Content":"\n\u003Cp\u003E\nI did some timings on a Mac Mini 5.1 (i5-2415M 2.3 / 16GB RAM) and KSP 1.8.1.\n\u003C/p\u003E\n\u003Cp\u003E\nI just fired it up and stop the chronometer on the first chord of the intro music:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003Edefault                 5:48\nMONO_THREADS_PER_CPU=1  5:10\nMONO_THREADS_PER_CPU=2  4:48 (!!!)\nMONO_THREADS_PER_CPU=3  5:02\nMONO_THREADS_PER_CPU=4  5:03\nMONO_THREADS_PER_CPU=5  5:00\nMONO_THREADS_PER_CPU=6  5:04\nMONO_THREADS_PER_CPU=2  5:00\ndefault                 5:33\nMONO_THREADS_PER_CPU=2  5:22 (???)\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nThe values are inconclusive. Apparently, the best loading times are get with 2 threads per CPU on my rig, but the schizophrenic cache mechanism used by MacOS may be screwing up these values greatly. (The use of a spinning disk is also a factor, for sure)\n\u003C/p\u003E\n\u003Cp\u003E\n(the tests were made one after the another in a row, with the first test not counted).\n\u003C/p\u003E\n\u003Cp\u003E\nI will redo this test \u00A0by night, with the machine rebooted (\u003Ca href=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/50533-18x-110x-module-manager-414-july-7th-2020-locked-inside-edition/\u0026amp;do=findComment\u0026amp;comment=3945798\u0022 rel=\u0022\u0022\u003Esomething on Unity appears to need it sometimes\u003C/a\u003E) and without anything else running to see what I get.\n\u003C/p\u003E\n"},{"CreatedByName":"Lisias","CreatedById":187168,"CreatedDateTime":"2021-07-08T04:31:15Z","Content":"\n\u003Cp\u003E\nGeez\u2026. Things are worse than I thought. Use of spinlocks on user-space was already chewed down by Linus Torvalds!\n\u003C/p\u003E\n\u003Cp\u003E\nIt\u0027s a trend, a nasty and naught trend. To the point that sooner or later this need to be addressed by the anti programmed obsolescence guys. These developers are deprecating hardware by no reason. \u003Cspan\u003E\u003Cimg alt=\u0022:(\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_sad.gif\u0022 title=\u0022:(\u0022\u003E\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://linux.slashdot.org/story/20/01/06/012251/linus-torvalds-calls-bloggers-linux-scheduler-tests-pure-garbage\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://linux.slashdot.org/story/20/01/06/012251/linus-torvalds-calls-bloggers-linux-scheduler-tests-pure-garbage\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00224000609\u0022 data-ipsquote-contentid=\u0022203645\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221625596112\u0022 data-ipsquote-userid=\u0022204885\u0022 data-ipsquote-username=\u0022darthgently\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nOn 7/6/2021 at 3:28 PM, darthgently said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nSo far, on a 12 core i7, I\u0027m getting about ~30% (guesstimate) faster scene switching with it set to 1.\u00A0 Actual ascent of a small craft is about the same from what I can tell, but will check with a larger craft later\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nI didn\u0027t had too much improvements, other on the loading time - and even that, as long as I don\u0027t reload the game more than 2 or 3 times in a row.\n\u003C/p\u003E\n\u003Cp\u003E\nObviously, I\u0027m already bottlenecking something else on the MacCrap 5.1. However, by using mono threads as 2, I feel the thing is slightly less sluggish, and the\u00A0\u003Cstrong\u003Ewhole machine\u003C/strong\u003E\u00A0is now performing better. And 8oC (to 10!!)\u00A0\u00A0\u003Cstrong\u003Ecooler\u003C/strong\u003E\u00A0that using default. I\u0027m serious, my machine is running\u00A0\u003Cstrong\u003Ecooler\u003C/strong\u003E\u00A0this way.\n\u003C/p\u003E\n\u003Cp\u003E\nWhat, again, pinpoints a bottleneck somewhere else on the rig - almost surely on the GPU (that, frankly, is terrible - Intel HD 3000).\n\u003C/p\u003E\n\u003Cp\u003E\nAnother noticeable enhancement is the Main Menu animation - way smoother. What again suggests I\u0027m bottlenecking the GPU - the Main Menu animation is somewhat spartan compared to the Flight Scene.\n\u003C/p\u003E\n\u003Cp\u003E\n\u2014\u2014 POST EDIT ----\n\u003C/p\u003E\n\u003Cp\u003E\nI removed some GPU intensive add\u0027ons (as Waterfall, that I was testing successfully on 1.8.1) and it improved the framerate\u00A0\u003Cstrong\u003Ea lot\u003C/strong\u003E\u00A0(almost to the level of 1.7.3 on the same machine!!!). The CPU temperature raised a degree too, so I was right about bottlenecking the GPU. \u003Cspan\u003E\u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u003C/span\u003E\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222021-07-08T06:52:57Z\u0022 title=\u002207/08/2021 06:52  AM\u0022 data-short=\u00223 yr\u0022\u003EJuly 8, 2021\u003C/time\u003E by Lisias\u003C/strong\u003E\n\u003Cbr\u003EBrute force post edit.\n\u003C/span\u003E\n"},{"CreatedByName":"darthgently","CreatedById":204885,"CreatedDateTime":"2021-07-08T15:16:46Z","Content":"\n\u003Cp\u003E\nI don\u0027t know what changed in the last few days of \u003Cabbr title=\u0022Comprehensive Kerbal Archive Network (a KSP mod manager)\u0022\u003E\u003Cabbr title=\u0022Comprehensive Kerbal Archive Network (a KSP mod manager)\u0022\u003ECKAN\u003C/abbr\u003E\u003C/abbr\u003E updates or what but now about every time I try to launch a craft it gets hung up on endless messages like the following.\u00A0 I\u0027ve had these before, as we previously msgd about, but now they never end and the craft never loads.\u00A0 What a mess.\u00A0 It would fill up my drive if I didn\u0027t kill KSP.\u00A0 I\u0027ve said it before: the main challenge in KSP isn\u0027t rocket science.\u00A0 It is KSP (\u002Bmods)\n\u003C/p\u003E\n\u003Cp\u003E\n[LOG 10:57:57.284] [PartSet]: Failed to add Resource 1566956177 to Simulation PartSet:54008 as corresponding Part Mk0 Liquid Fuel Fuselage-1825441388 SimulationResource was not found.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222021-07-08T15:21:31Z\u0022 title=\u002207/08/2021 03:21  PM\u0022 data-short=\u00223 yr\u0022\u003EJuly 8, 2021\u003C/time\u003E by darthgently\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Lisias","CreatedById":187168,"CreatedDateTime":"2021-07-09T06:08:50Z","Content":"\n\u003Cp\u003E\nFound this, it appears to be related to the problem when it happens on MacOS:\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://developer.apple.com/forums/thread/124155\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://developer.apple.com/forums/thread/124155\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nApparently, it describes the situation I think we are having on KSP: a main, high prioritized thread being screwed up by waiting for lower prioritized threads. What should be nonsense on a sane World, as high priority threads \u0022don\u0027t call\u0022, they are \u0022called\u0022.\n\u003C/p\u003E\n\u003Cp\u003E\nThe \u0022Busy Wait\u0022 (or SpinLock) I detected may be an undesired and unexpected side effect of the priority inversion of a main thread, being so\u00A0\u003Cstrong\u003Ethis\u003C/strong\u003E\u00A0the problem. What suggests a less then ideal overall design of the process. On an educated (but somewhat blind) guess, a inversion of control should be applied here instead, where the low priority thread would \u0022call\u0022 the high priority thread when the job is done, instead of having the high priority thread asking the lower\u00A0priority\u00A0one \u0022are we there yet?\u0022 all the time...\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222021-07-09T11:59:03Z\u0022 title=\u002207/09/2021 11:59  AM\u0022 data-short=\u00223 yr\u0022\u003EJuly 9, 2021\u003C/time\u003E by Lisias\u003C/strong\u003E\n\u003Cbr\u003Ebetter phrasing\n\u003C/span\u003E\n"},{"CreatedByName":"Lisias","CreatedById":187168,"CreatedDateTime":"2021-07-18T00:57:28Z","Content":"\n\u003Cp\u003E\nRL hit me in the balls badly on the last 10 days, and so just now I could (minimally) restore core functionalities on my (recently murdered by Apple\u0027s \u003Cem\u003E\u0026lt;insert your non forum compliant favourite expletive here about how to call people that does less than smart decisions\u0026gt;\u003C/em\u003E) MacMini 6.2 .\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nOn a first stance, yeah - KSP 1.12.x just screwed my MacMini 6.2 performance the same way KSP 1.8 did on my MacMini 5.1.\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cspan style=\u0022font-size:26px;\u0022\u003E\u003Cstrong\u003EHOWEVER.\u003C/strong\u003E\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nAt least for KSP 1.12.1 (as I essentially missed the 1.12.0 due \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/179030-144/\u0026amp;do=findComment\u0026amp;comment=3999911\u0022 rel=\u0022\u0022\u003Ethe hard disk recovery problems\u003C/a\u003E), I realised that setting the\u00A0\u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003EMONO_THREADS_PER_CPU=1\u003C/span\u003E\u00A0\u003Cstrong\u003Edid not helped\u003C/strong\u003E\u00A0at all. At least, initially.\n\u003C/p\u003E\n\u003Cp\u003E\nThe stutter on the rest of the machine was slightly less worst with the\u00A0\u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003EMONO_THREADS_PER_CPU\u003C/span\u003E stunt, indeed, but still stuttered a bit (moving the Windows around, \u00A0playing\u00A0Youtube videos, etc). And the Main Menu animation was simply horrible - less than 1 frame\u00A0per second I guess, as the animation was \u0022jumpy\u0022 with the kerbals freezing 2 or 3 seconds sometimes.\n\u003C/p\u003E\n\u003Cp\u003E\nThat was unexpected. I was pretty convinced that the \u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003EMONO_THREADS_PER_CPU\u003C/span\u003E\u00A0stunt\u00A0would solve the issue again.\n\u003C/p\u003E\n\u003Cp\u003E\nThen I noticed that apparently the performance of the CPU was not being exactly crippled by KSP, but the video updates. The apparent performance of small programs on the terminal apparently was\u0027t affected, only the terminal updates. (\u003Cstrong\u003Ewith\u003C/strong\u003E\u00A0the\u00A0\u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003EMONO_THREADS_PER_CPU\u003C/span\u003E\u00A0stunt active, just to made it clear).\n\u003C/p\u003E\n\u003Cp\u003E\nSo apparently I have another problem with similar effects - two different lighting bolts hitting me at the same spot, if you prefer.\n\u003C/p\u003E\n\u003Cp\u003E\nThinking about, checked the KSP change log to see what had changed from 1.11.2 to 1.12.0 and 1.12.1 to see if a light bulb sparkles somewhere inside my dull head when I got an insight: a lot of visual\u0027s enhancements were deployed on KSP 1.12.\u00A0Well, it makes sense, this rig uses a shared memory GPU up to 1.5G of VRAM, 3 times better than the previous rig but still less than the 2G that it\u0027s usually the minimal recommended for gaming nowadays (I will ignore the fact that Steam recommends 1GB of VRAM, and states 512MB as the minimum).\n\u003C/p\u003E\n\u003Cp\u003E\nSo I played a bit, or better,\u00A0\u003Cstrong\u003EA LOT\u003C/strong\u003E\u00A0with \u00A0the Settings always starting with the default ones in order to reach the less amount of changes from the default values that would make my rig useable again - at least, on a vanilla (no Mods) installation. And I managed to do that.\n\u003C/p\u003E\n\u003Cp\u003E\nSo, if you are running KSP 1.12.x on a old rig and/or are facing some serious performance issues, this is what worked for me:\n\u003C/p\u003E\n\u003Col\u003E\u003Cli\u003E\nGo to Settings, click Graphics, click Reset Settings, click Accept\n\u003C/li\u003E\n\u003Cli\u003E\nSet Render Quality to \u003Cstrong\u003EGood\u003C/strong\u003E.\n\u003C/li\u003E\n\u003Cli\u003E\nSet Texture Quality to \u003Cstrong\u003EQuarter Res\u003C/strong\u003E.\n\u003C/li\u003E\n\u003Cli\u003E\nSet V-Sync to \u003Cstrong\u003EEvery Second V-Blank\u003C/strong\u003E.\n\u003C/li\u003E\n\u003Cli\u003E\nSet Frame Limit to \u003Cstrong\u003EDefault\u003C/strong\u003E.\n\u003C/li\u003E\n\u003Cli\u003E\nClick Accept\n\u003C/li\u003E\n\u003C/ol\u003E\u003Cp\u003E\nAnd this solved the second performance issue for me (because, yeah, I still need to use the\u00A0\u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003EMONO_THREADS_PER_CPU\u003C/span\u003E\u00A0stunt in order to avoid stuttering too much the rest of the rig).\n\u003C/p\u003E\n\u003Cp\u003E\nI still didn\u0027t installed any Add\u0027Ons on this thingy, probably I will be forced to reduce somewhat the quantity of add\u0027ons installed for the tests, what will be an annoyance to say the least.\n\u003C/p\u003E\n\u003Cp\u003E\nBut at least I\u0027m back to business\u2026. (sort of)\n\u003C/p\u003E\n\u003Cp\u003E\n\u2014 \u2014 \u2014 POST EDIT \u2014 \u2014 \u2014\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nInstalled TweakScale and the mininum set of Add\u0027Ons I use for toying it, and I had to reduce the Texture Quality to Eighth...\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222021-07-18T14:13:43Z\u0022 title=\u002207/18/2021 02:13  PM\u0022 data-short=\u00223 yr\u0022\u003EJuly 18, 2021\u003C/time\u003E by Lisias\u003C/strong\u003E\n\u003Cbr\u003Epost edit\n\u003C/span\u003E\n"},{"CreatedByName":"steve_v","CreatedById":69272,"CreatedDateTime":"2021-08-18T10:14:30Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00224000459\u0022 data-ipsquote-contentid=\u0022203645\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221625579770\u0022 data-ipsquote-userid=\u0022187168\u0022 data-ipsquote-username=\u0022Lisias\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nOn 7/7/2021 at 1:56 AM, Lisias said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/69272-steve_v/\u0026amp;do=hovercard\u0022 data-mentionid=\u002269272\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/69272-steve_v/\u0022 rel=\u0022\u0022\u003E@steve_v\u003C/a\u003E, if you are still around, I think you will like this one.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nI\u0027m not, not really. This is just an echo.\u003Cbr\u003E\u003Cbr\u003E\nWith the end of updates and all the bugs and performance problems it left unsolved I kinda lost interest TBH.\u003Cbr\u003E\nBut seriously, \u003Cem\u003Espinlocks\u003C/em\u003E for thread synchronisation? What is this, 1995?\n\u003C/p\u003E\n"},{"CreatedByName":"Lisias","CreatedById":187168,"CreatedDateTime":"2021-08-18T10:43:46Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00224021410\u0022 data-ipsquote-contentid=\u0022203645\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221629281670\u0022 data-ipsquote-userid=\u002269272\u0022 data-ipsquote-username=\u0022steve_v\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n18 hours ago, steve_v said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nBut seriously, \u003Cem\u003Espinlocks\u003C/em\u003E for thread synchronisation? What is this, 1995?\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nTo tell you the true, the last time I had read about people resorting to stunts like this it was the 80\u0027s when 8 bits computers were still a thing.\n\u003C/p\u003E\n\u003Cp\u003E\nThe 6502 has a pretty fast and nice instruction to minimize delays while waiting for some hardware to be ready. When you need to react really fast - but really, really fast to the point that a NMI would be too slow (due the internal states to save the PC into the stack and jp into the handler), you would hook the signal to the SOB (pun not intended) pin, and then spinlock waiting it to change a bit on\u00A0the P register using a TestAndBranch instruction (only 3\u00A0CPU cycles, against the 7 cycles needed by NMI, and even that if the CPU was\u0027nt on a SYNC state).\n\u003C/p\u003E\n\u003Cp\u003E\nThe x86 have the WAIT instruction for similar results: a spinlock implemented internally in micro-code, you can\u0027t beat this on software.\n\u003C/p\u003E\n\u003Cp\u003E\nAnd even\u00A0the venerable IBM-XT already used interrupts for reading the keyboard instead of a busy-wait checking the keyboard I/O pins as it was done on Apple2 and similar machines. And we are talking 1981 and 1982 here.\n\u003C/p\u003E\n\u003Cp\u003E\nIf you are not working with micro-controllers (single-task, single thread), if you even think on spinlocks you should have your commit privileges revoked and be sent back to a BASIC programming school.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222021-08-19T04:44:42Z\u0022 title=\u002208/19/2021 04:44  AM\u0022 data-short=\u00222 yr\u0022\u003EAugust 19, 2021\u003C/time\u003E by Lisias\u003C/strong\u003E\n\u003Cbr\u003EGrammars. Don\u0026#039;t you hate this thing?\n\u003C/span\u003E\n"},{"CreatedByName":"Lisias","CreatedById":187168,"CreatedDateTime":"2023-06-23T23:31:46Z","Content":"\n\u003Cp\u003E\nNow we have hard evidence that this trick also works for more modern computers, it\u0027s not an Old Potato only one! \u003Cspan\u003E\u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Ciframe allowfullscreen=\u0022\u0022 data-controller=\u0022core.front.core.autosizeiframe\u0022 data-embedauthorid=\u0022221143\u0022 data-embedcontent=\u0022\u0022 data-embedid=\u0022embed8328066476\u0022 src=\u0022https://forum.kerbalspaceprogram.com/topic/217809-how-can-i-make-ksp-run-better/?do=embed\u0026amp;comment=4296618\u0026amp;embedComment=4296618\u0026amp;embedDo=findComment\u0022 style=\u0022height:272px;max-width:502px;\u0022\u003E\u003C/iframe\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n"}]}