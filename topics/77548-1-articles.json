{"TopicId":77548,"ForumId":29,"TopicTitle":"Can I store a persistent variable on a part?","CreatedByName":"Agathorn","CreatedById":99662,"CreatedDateTime":"2014-07-14T01:58:11Z","PageNum":1,"Articles":[{"CreatedByName":"Agathorn","CreatedById":99662,"CreatedDateTime":"2014-07-14T01:58:11Z","Content":"\n\u003Cp\u003EI want to store some variables on parts, and have those variables saved in the save game. \u003C/p\u003E\u003Cp\u003EBut what is tricky - and forgive me i\u0027m finding it hard to explain this -- is I want to interact with an instance of the part on a vessel, doing various calcs and what not, but I then want to store data on the BASE of that part, so that it isn\u0027t just on that instance, but is on the part permanently in the VAB and on any OTHER vessels the part gets put on. \u003C/p\u003E\u003Cp\u003E1) You go into the VAB and make a Vessel123. You place Fuel Tank SuperB onto your vessel.\u003C/p\u003E\u003Cp\u003E2) You go fly Vessel123 and my KSPAddon/PartModule is doing shady things in the background to Fuel Tank SuperB on Vessel123, and is saving data back on the root Fuel Tank SuperB.\u003C/p\u003E\u003Cp\u003E3) You crash, or retrieve, or ignore, Vessel123\u003C/p\u003E\u003Cp\u003E4) You go into the VAB and make Vessel456. You place Fuel Tank SuperB onto your vessel.\u003C/p\u003E\u003Cp\u003E5) You go fly Vessel456 and my KSPAddon can see the previously recorded values from your Vessel123 flight.\u003C/p\u003E\u003Cp\u003EDoes that make sense? \u003C/p\u003E\u003Cp\u003EBasically I need to store persistent data on every part in the game and I really don\u0027t want to have to do that on my own in my own Addon. It would be ideal if I could just store it on the parts themselves.\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-07-14T02:17:16Z","Content":"\n\u003Cp\u003EAs you are trying to save data across different parts and vessels, I would actually recommend you look at a scenario module instead.\u003C/p\u003E\u003Cp\u003EHere\u0027s a quick example that loads a scenario in flight mode:\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Eusing System;\u003Cbr\u003Eusing System.Collections.Generic;\u003Cbr\u003Eusing System.Linq;\u003Cbr\u003Eusing System.Text;\u003Cbr\u003Eusing System.Reflection;\u003Cbr\u003Eusing UnityEngine;\u003Cbr\u003E\u003Cbr\u003Enamespace OnScreenJoyStick\u003Cbr\u003E{\u003Cbr\u003E    [KSPAddon(KSPAddon.Startup.SpaceCentre, false)] //install our scenario module. is a partmodule so all calculations can be done in it, no need for a seperate plugin class in the scene\u003Cbr\u003E    class OSJMainMenu : MonoBehaviour\u003Cbr\u003E    {\u003Cbr\u003E        public void Start()\u003Cbr\u003E        {\u003Cbr\u003E            var game = HighLogic.CurrentGame;\u003Cbr\u003E            ProtoScenarioModule psm = game.scenarios.Find(s =\u0026gt; s.moduleName == typeof(OSJFlight).Name);\u003Cbr\u003E            if (psm == null)\u003Cbr\u003E            {\u003Cbr\u003E                psm = game.AddProtoScenarioModule(typeof(OSJFlight), GameScenes.FLIGHT);\u003Cbr\u003E            }\u003Cbr\u003E        }\u003Cbr\u003E    }\u003Cbr\u003E   public class OSJFlight : ScenarioModule //this runs on flight scene start, no need for the KSPAddon as it is already loaded by the code in the SpaceCenter screen.\u003Cbr\u003E    {\u003Cbr\u003E//All your plug in code here. Start, Update, FixedUpdate, OnSave, OnLoad, etc. all work as they do in a partmodule.\u003Cbr\u003E    }\u003Cbr\u003E   }\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EThen make a list of Parts -\u0026gt; Data you want to save in the scenario module and save the data in there.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n"},{"CreatedByName":"Agathorn","CreatedById":99662,"CreatedDateTime":"2014-07-14T02:26:56Z","Content":"\n\u003Cp\u003EYes I want to store data across all parts. I\u0027m basically making a custom career system and need to store information about parts so that it affects the gameplay. \u003C/p\u003E\u003Cp\u003EI thought scenarios were the tutorials system, IE outside of the standard \u0022Sandbox\u0022 or \u0022Career Mode\u0022?\u003C/p\u003E\u003Cp\u003EMy point still stands though. I\u0027m tryign to avoid having to maintain an internal list of all parts and the data on them. I was really hoping I could let the part store it for me?\u003C/p\u003E\n"},{"CreatedByName":"Agathorn","CreatedById":99662,"CreatedDateTime":"2014-07-14T02:39:17Z","Content":"\n\u003Cp\u003EMaybe i\u0027m overcomplicating things. If I make a PartModule, that gets attached to a part and it has data in its ConfigNode. It has default values that obviously take effect when you create the part by putting it on a vessel. Can\u0027t I just store dynamic data into that same confignode?\u003C/p\u003E\n"},{"CreatedByName":"DMagic","CreatedById":57416,"CreatedDateTime":"2014-07-14T02:52:29Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Agathorn\u0022 data-cite=\u0022Agathorn\u0022\u003E\u003Cdiv\u003EMaybe i\u0027m overcomplicating things. If I make a PartModule, that gets attached to a part and it has data in its ConfigNode. It has default values that obviously take effect when you create the part by putting it on a vessel. Can\u0027t I just store dynamic data into that same confignode?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThe config node is unique to each part with that part module. Every time you add another instance of that part it will start-over with its initial settings. \u003C/p\u003E\u003Cp\u003EDiazo\u0027s probably right. Scenario modules are used for the tutorials but they can be used for much more. They save data for the entire save file (the R\u0026amp;D center is a scenario module, you can look at its entry in the persistent file and see things like which tech nodes have been researched and which science experiments have been conducted) so you can store your data in there and tell your part module to get whatever it needs out of the scenario module. You\u0027ll only need to store one copy of every variable that you\u0027re interested in, then each part module should be able to use the most updated value for that variable.\u003C/p\u003E\n"},{"CreatedByName":"Agathorn","CreatedById":99662,"CreatedDateTime":"2014-07-14T02:57:21Z","Content":"\n\u003Cp\u003EOk thanks guys. I\u0027ll do some digging in that direction. I thought Scenarios were just for the Tutorials/Scenarios stuff, not actual games. So I was wrong \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-07-14T03:42:17Z","Content":"\n\u003Cp\u003EThe shortcut I use in thinking about ScenarioModules is that they are essentially a partModule. But where a partModule is assigned to a part, a scenarioModule is assigned to a game (on a per save, not per installation, basis).\u003C/p\u003E\u003Cp\u003EThen everything, including OnLoad and OnSave, work pretty much the same.\u003C/p\u003E\u003Cp\u003EOn your thought about assigning stuff to the \u0022base\u0022 part, that will not work because the base part you are talking about does not exist.\u003C/p\u003E\u003Cp\u003EHow parts work is that every time KSP loads, it reads all the part.cfg files in the GameData folder and creates a library of protoParts. Then when that part is loaded in game, a copy of the part is created and then the Load pass is run to restore data from the persistence file for that copy of the part only.\u003C/p\u003E\u003Cp\u003ESo in essence, the \u0022default config node\u0022 you are asking about in your previous post is in actuality the part.cfg file attached to that part in the gamedata directory.\u003C/p\u003E\u003Cp\u003EHope that helps.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n"},{"CreatedByName":"NathanKell","CreatedById":75006,"CreatedDateTime":"2014-07-14T03:42:47Z","Content":"\n\u003Cp\u003EEPL and Kethane store their persistent settings that way, for example.\u003C/p\u003E\n"},{"CreatedByName":"Agathorn","CreatedById":99662,"CreatedDateTime":"2014-07-14T04:01:48Z","Content":"\n\u003Cp\u003EHow would I make the Scenario be loaded in all the scenes? SpaceCentre, Editor, Flight, Tracking, etc?\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-07-14T04:08:49Z","Content":"\n\u003Cp\u003EThis line here:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E psm = game.AddProtoScenarioModule(typeof(OSJFlight), GameScenes.FLIGHT);\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EYou would have to check the object browser for the syntax, but the GameScenes.FLIGHT variable is what gets changed.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n"},{"CreatedByName":"Agathorn","CreatedById":99662,"CreatedDateTime":"2014-07-14T04:29:51Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Diazo\u0022 data-cite=\u0022Diazo\u0022\u003E\u003Cdiv\u003EThis line here:\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E psm = game.AddProtoScenarioModule(typeof(OSJFlight), GameScenes.FLIGHT);\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EYou would have to check the object browser for the syntax, but the GameScenes.FLIGHT variable is what gets changed.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYeah I figured that. I thought it was a bitfield or something of that type, but nothing I do seems to make it load in multiple scenes. Hmmm.\u003C/p\u003E\n"},{"CreatedByName":"Agathorn","CreatedById":99662,"CreatedDateTime":"2014-07-14T04:34:18Z","Content":"\n\u003Cp\u003EAhh its an array.\u003C/p\u003E\u003Cp\u003EOoh object browser. I didn\u0027t know about that!\u003C/p\u003E\n"},{"CreatedByName":"DMagic","CreatedById":57416,"CreatedDateTime":"2014-07-14T04:57:47Z","Content":"\n\u003Cp\u003EYou just put something like this in when you first initialize the scenario module. One problem to be aware of is that you might not be able to add extra target gamescenes once the scenario module has been created for the first time, at least not using the methods common in other mods. \u003C/p\u003E\u003Cp\u003ESo when you\u0027re still tinkering around you might want to start a new save file or come up with a method to add more scenes target scenes to the module. Or you could just manually add them in the persistent file, I don\u0027t think I\u0027ve ever tried that, but it should work (it should be the first line after the name of the scenario module, though I\u0027m not sure which numbers correlate to which game scenes).\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E        Game g = HighLogic.CurrentGame;\u003Cbr\u003E        var p = g.AddProtoScenarioModule(typeof(DMScienceScenario), GameScenes.FLIGHT, GameScenes.SPACECENTER, GameScenes.TRACKSTATION);\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EEdit: Here are the game scene numbers:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E        LOADING = 0,\u003Cbr\u003E\tLOADINGBUFFER = 1,\u003Cbr\u003E\tMAINMENU = 2,\u003Cbr\u003E\tSETTINGS = 3,\u003Cbr\u003E\tCREDITS = 4,\u003Cbr\u003E\tSPACECENTER = 5,\u003Cbr\u003E\tEDITOR = 6,\u003Cbr\u003E\tFLIGHT = 7,\u003Cbr\u003E\tTRACKSTATION = 8,\u003Cbr\u003E\tSPH = 9,\u003Cbr\u003E\tPSYSTEM = 10,\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-07-14T04:59:48Z\u0022 title=\u002207/14/2014 04:59  AM\u0022 data-short=\u00229 yr\u0022\u003EJuly 14, 2014\u003C/time\u003E by DMagic\u003C/strong\u003E\n\u003C/span\u003E\n"}]}