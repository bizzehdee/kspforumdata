{"TopicId":107647,"ForumId":44,"TopicTitle":"Calculating The Speed Of A Moon?","CreatedByName":"Beale","CreatedById":70533,"CreatedDateTime":"2015-05-05T13:48:18Z","PageNum":1,"Articles":[{"CreatedByName":"Beale","CreatedById":70533,"CreatedDateTime":"2015-05-05T13:48:18Z","Content":"Hello!\n\nSomewhat of a follow up to [my last thread.](https://forum.kerbalspaceprogram.com/threads/115108-Calculating-The-Required-Speed-For-Circular-Orbit)\n\nIs there a general method for finding the velocity needed for a moon to enter circular orbit around a planet?\n\nMy English isn\u0027t always so great when it comes to technical stuff, so here is an image:\n\n![10d85eecce.png](http://puu.sh/hChGc/10d85eecce.png)\n\nThis is for a 2D N-body sim.\n\nAll Planets and moons are initialized on a 1-dimensional straight line distance from the sun along the Y axis, so when started V can assumed to be only speed along the X axis.\n\nOr, more specifically:\n\nFor the moon, am I just setting VX (As in only sideways initial velocity like a planet) or do I need a VY component?\n\n![6247eb7f32.png](http://puu.sh/hChLK/6247eb7f32.png)\n\nSorry, I hope I make myself clear what I\u0027m asking! ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\nCurrently I\u0027ve basically attempted to \u0027guess\u0027 the needed velocity. You can imagine how that has resulted, at best the moon is a temporary satellite before either drifting or being violently gravity-assisted outwards.\n\n**Edited \u003Ctime datetime=\u00222015-05-05T13:56:12Z\u0022 title=\u002205/05/2015 01:56  PM\u0022 data-short=\u00229 yr\u0022\u003EMay 5, 2015\u003C/time\u003E by Beale**"},{"CreatedByName":"ZetaX","CreatedById":60692,"CreatedDateTime":"2015-05-05T13:59:46Z","Content":"The VY component is 0. If it were not your moon would, at least initially, move towards or away from the planet, which is contradicting it being a circle (which means that the distance to the planet is always the same).\n\nBut note that this is just \u0022close to a circle\u0022 anyway, because the sun will have an effect on the orbit.\n\n**Edited \u003Ctime datetime=\u00222015-05-05T14:01:49Z\u0022 title=\u002205/05/2015 02:01  PM\u0022 data-short=\u00229 yr\u0022\u003EMay 5, 2015\u003C/time\u003E by ZetaX**"},{"CreatedByName":"LordFerret","CreatedById":111598,"CreatedDateTime":"2015-05-05T15:33:26Z","Content":"[https://www.shodor.org/succeedhi/succeedhi/orbits/Notes-content.html](https://www.shodor.org/succeedhi/succeedhi/orbits/Notes-content.html)\n\nand\n\n[http://www.dummies.com/how-to/content/how-to-calculate-centripetal-acceleration-of-an-or.html](http://www.dummies.com/how-to/content/how-to-calculate-centripetal-acceleration-of-an-or.html)"},{"CreatedByName":"Beale","CreatedById":70533,"CreatedDateTime":"2015-05-05T15:54:03Z","Content":"\u003E \n\u003E The VY component is 0. If it were not your moon would, at least initially, move towards or away from the planet, which is contradicting it being a circle (which means that the distance to the planet is always the same).\n\u003E But note that this is just \u0022close to a circle\u0022 anyway, because the sun will have an effect on the orbit.\n\nGood to know, thanks for the info.\n\n\u003E \n\u003E [https://www.shodor.org/succeedhi/succeedhi/orbits/Notes-content.html](https://www.shodor.org/succeedhi/succeedhi/orbits/Notes-content.html)\n\u003E and\n\u003E \n\u003E [http://www.dummies.com/how-to/content/how-to-calculate-centripetal-acceleration-of-an-or.html](http://www.dummies.com/how-to/content/how-to-calculate-centripetal-acceleration-of-an-or.html)\n\nGreat thanks for the links!\n\nI\u0027ll give them a read through, though... They look a bit intimidating!\n\nAny particular part of the pages I should put my attention for a method?\n\n**Edited \u003Ctime datetime=\u00222015-05-05T15:56:46Z\u0022 title=\u002205/05/2015 03:56  PM\u0022 data-short=\u00229 yr\u0022\u003EMay 5, 2015\u003C/time\u003E by Beale**"},{"CreatedByName":"Beale","CreatedById":70533,"CreatedDateTime":"2015-05-05T20:29:45Z","Content":"Hi!\n\nNope, neither of the links offer quite what I\u0027m after.\n\nThey are based on orbital periods which I don\u0027t have, but rather do have position, masses and distances.\n\nIf I make sense.\n\nMore phrasing: what X velocity needed so that moon is naturally \u0022captured\u0022 into orbit."},{"CreatedByName":"Brotoro","CreatedById":57674,"CreatedDateTime":"2015-05-05T20:32:56Z","Content":"Need to know the mass of the planet."},{"CreatedByName":"Beale","CreatedById":70533,"CreatedDateTime":"2015-05-05T20:35:48Z","Content":"\u003E \n\u003E Need to know the mass of the planet.\n\nIt\u0027s 1 Earth mass, but what I\u0027m after is a general method, rather than calculating a specific instance. ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)"},{"CreatedByName":"UmbralRaptor","CreatedById":2767,"CreatedDateTime":"2015-05-05T20:40:32Z","Content":"I\u0027d lean towards conservation of energy or Vis-Viva, using either to generate an ellipse with a semi-major axis inside the [Hill sphere](https://en.wikipedia.org/wiki/Hill_sphere), or better still inside the [sphere of influence](https://en.wikipedia.org/wiki/Sphere_of_influence_%28astrodynamics%29) of the planet.\n\nIt\u0027s not completely guarenteed in the long run (because N-body), but should be stable for a while."},{"CreatedByName":"Brotoro","CreatedById":57674,"CreatedDateTime":"2015-05-05T20:42:30Z","Content":"If the planet mass is m, and the moon is a distance r away from the planet (center to center), then the circular orbit speed of the moon will be SQRT(Gm/r) around the planet. Add that to the planet\u0027s orbital speed around the star, SQRT(GM/R), and you\u0027ll have the moon\u0027s velocity relative to the star at the point shown in your diagram."},{"CreatedByName":"Beale","CreatedById":70533,"CreatedDateTime":"2015-05-05T20:46:47Z","Content":"\u003E \n\u003E I\u0027d lean towards conservation of energy or Vis-Viva, using either to generate an ellipse with a semi-major axis inside the [Hill sphere](https://en.wikipedia.org/wiki/Hill_sphere), or better still inside the [sphere of influence](https://en.wikipedia.org/wiki/Sphere_of_influence_%28astrodynamics%29) of the planet.\n\u003E It\u0027s not completely guarenteed in the long run (because N-body), but should be stable for a while.\n\nThanks for the links.\n\nWith the info, I can add SOI rendering, which will be quite nifty! ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\nI was a little worried about SOIs, they seem to be rather small (because things are probably closer to the sun than they should be).\n\nStill, this may be fixed by reducing the suns mass.\n\nStability: Long term not absolutely needed.\n\nCheers! ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\n\u003E \n\u003E If the planet mass is m, and the moon is a distance r away from the planet (center to center), then the circular orbit speed of the moon will be SQRT(Gm/r) around the planet. Add that to the planet\u0027s orbital speed around the star, SQRT(GM/R), and you\u0027ll have the moon\u0027s velocity relative to the star at the point shown in your diagram.\n\nAh!\n\nA nice solution, many thanks for this Brotoro, much!\n\nKind regards.\n\n**Edited \u003Ctime datetime=\u00222015-05-05T20:50:27Z\u0022 title=\u002205/05/2015 08:50  PM\u0022 data-short=\u00229 yr\u0022\u003EMay 5, 2015\u003C/time\u003E by Beale**"},{"CreatedByName":"Bill Phil","CreatedById":127797,"CreatedDateTime":"2015-05-05T20:56:39Z","Content":"Orbital speed required at the \u0022moon\u0022\u0027s distance to the planet, and the current speed of the \u0022moon\u0022 relative to the planet. Get the difference of the two and that should be it...."},{"CreatedByName":"arkie87","CreatedById":103434,"CreatedDateTime":"2015-05-05T22:37:33Z","Content":"\u003E \n\u003E Hi!\n\u003E Nope, neither of the links offer quite what I\u0027m after.\n\u003E \n\u003E They are based on orbital periods which I don\u0027t have, but rather do have position, masses and distances.\n\u003E \n\u003E If I make sense.\n\u003E \n\u003E More phrasing: what X velocity needed so that moon is naturally \u0022captured\u0022 into orbit.\n\nYou have the formula right there in your picture: V=sqrt(G\\*M/R)=sqrt(g\\*R)"},{"CreatedByName":"YNM","CreatedById":98447,"CreatedDateTime":"2015-05-05T23:39:25Z","Content":"You can use the relative velocity. As lomg as it\u0027s less than escape velocity it should be in orbit. Except it\u0027s very far, that is. To determine how far until it escapes (even when the relative velocity is small enough), Hill sphere would be the best way to do it, or the closest (to the planet) lagrange point of the planet."},{"CreatedByName":"K^2","CreatedById":57710,"CreatedDateTime":"2015-05-06T04:33:14Z","Content":"\u003E \n\u003E If the planet mass is m, and the moon is a distance r away from the planet (center to center), then the circular orbit speed of the moon will be SQRT(Gm/r) around the planet. Add that to the planet\u0027s orbital speed around the star, SQRT(GM/R), and you\u0027ll have the moon\u0027s velocity relative to the star at the point shown in your diagram.\n\nIt might be worth pointing out that this isn\u0027t an exact answer. It\u0027s a good starting point, and might be all you need for a sim, but it won\u0027t be quite right. For starters, reduced mass is giong to be a factor here. Even if the star is taken to be stationary, planet is clearly being simulated. So planet\u0027s-to-moon\u0027s mass ratio is going to be important.\n\nBut even outside of that, you\u0027re firmly in the 3-body world here. Even with a stationary star, the planet-moon system experiences a periodic perturbation. If they are close to resonance, big trouble. If not, it will still cause a slight change in moon\u0027s period. So even with reduced masses in place, the orbital velocity will be slightly off.\n\n\u003E \n\u003E You can imagine how that has resulted, at best the moon is a temporary satellite before either drifting or being violently gravity-assisted outwards.\n\nAnd that\u0027s likely to keep happening.\n\na) I\u0027m pretty sure your simulation will have significant errors.\n\n![B)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_cool.png) At that scale, there is going to be significant interaction between the two orbits.\n\nEither one of these might have been alright, but toghether, you\u0027re pretty much guaranteed an ejected moon."},{"CreatedByName":"Beale","CreatedById":70533,"CreatedDateTime":"2015-05-07T11:36:27Z","Content":"\u003E \n\u003E Orbital speed required at the \u0022moon\u0022\u0027s distance to the planet, and the current speed of the \u0022moon\u0022 relative to the planet. Get the difference of the two and that should be it....\n\n\u003E \n\u003E You can use the relative velocity. As lomg as it\u0027s less than escape velocity it should be in orbit. Except it\u0027s very far, that is. To determine how far until it escapes (even when the relative velocity is small enough), Hill sphere would be the best way to do it, or the closest (to the planet) lagrange point of the planet.\n\nSo the Moon\u0027s X velocity should have add to it the relative velocity between the two bodies? Sorry I don\u0027t follow quite completely.\n\n[I\u0027m trying to calculate the hill sphere](https://en.wikipedia.org/wiki/Hill_sphere), but don\u0027t quite understand the mathematic notation (Specifically the Square root with a power of 3 on it?).\n\nThanks for the help ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\n\u003E \n\u003E You have the formula right there in your picture: V=sqrt(G\\*M/R)=sqrt(g\\*R)\n\nYes, this works if the earth was standing still and I was calculating the speed of the Moon alone, but relative to the sun is what is needed.\n\nIf I understand you right.\n\n\u003E \n\u003E It might be worth pointing out that this isn\u0027t an exact answer. It\u0027s a good starting point, and might be all you need for a sim, but it won\u0027t be quite right. For starters, reduced mass is giong to be a factor here. Even if the star is taken to be stationary, planet is clearly being simulated. So planet\u0027s-to-moon\u0027s mass ratio is going to be important.\n\u003E But even outside of that, you\u0027re firmly in the 3-body world here. Even with a stationary star, the planet-moon system experiences a periodic perturbation. If they are close to resonance, big trouble. If not, it will still cause a slight change in moon\u0027s period. So even with reduced masses in place, the orbital velocity will be slightly off.\n\u003E \n\u003E And that\u0027s likely to keep happening.\n\u003E \n\u003E a) I\u0027m pretty sure your simulation will have significant errors.\n\u003E \n\u003E ![B)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_cool.png) At that scale, there is going to be significant interaction between the two orbits.\n\u003E \n\u003E Either one of these might have been alright, but toghether, you\u0027re pretty much guaranteed an ejected moon.\n\nI\u0027ve applied Brotoro\u0027s methods and reproduce the problems you describe unfortunately.\n\n![766ce8945e.png](http://puu.sh/hEBDe/766ce8945e.png)\n\nThe Moon typically makes one, two or even three (unpredictable!) orbits around the Earth before drifting away.\n\nI think perhaps the Earth does not provide much at all influence (hill sphere?) to hold it correctly, even in very close orbits.\n\nStrangely, reducing the mass of the sun, even drastically does not seem to increase the Earth\u0027s influence...\n\nI\u0027m a little confused about your point A, that seems a little abrasive... Unless I\u0027m reading you wrong.\n\n**Edited \u003Ctime datetime=\u00222015-05-07T11:40:36Z\u0022 title=\u002205/07/2015 11:40  AM\u0022 data-short=\u00229 yr\u0022\u003EMay 7, 2015\u003C/time\u003E by Beale**"},{"CreatedByName":"K^2","CreatedById":57710,"CreatedDateTime":"2015-05-07T12:03:02Z","Content":"Gravity is notoriously difficult to deal with numerically. Even if you have prior experience with numerical methods in differential equations, unless you studied numerical methods in gravity extensively, it is very unlikely that your simulation is up to the task. Don\u0027t take it the wrong way. It is a deceptively hard problem.\n\nYour description makes it sound even more unstable than it needs be, though. How do you update position and velocity in your simulation?"},{"CreatedByName":"Beale","CreatedById":70533,"CreatedDateTime":"2015-05-07T12:07:51Z","Content":"\u003E \n\u003E Gravity is notoriously difficult to deal with numerically. Even if you have prior experience with numerical methods in differential equations, unless you studied numerical methods in gravity extensively, it is very unlikely that your simulation is up to the task. Don\u0027t take it the wrong way. It is a deceptively hard problem.\n\u003E Your description makes it sound even more unstable than it needs be, though. How do you update position and velocity in your simulation?\n\nOkay, no worries. Is a more than fair point, I am very much an amateur here.\n\nI\u0027m using a Barnes-Hut approximation to update the forces acting on the body (But since there are no largely clustered objects, might just consider it a direct approach).\n\nThe force calculation:\n\n    \tpublic void addForce(SimBody _bodyTwo)\t{\t\tSimBody _bodyOne = this;\t\tdouble dx = _bodyTwo._rx - _bodyOne._rx;\t\tdouble dy = _bodyTwo._ry - _bodyOne._ry;\t\tdouble dist = Math.sqrt(dx*dx \u002B dy*dy);\t\tdouble F = (G * _bodyOne._mass * _bodyTwo._mass) / (dist*dist);\t\t_bodyOne._fx \u002B= F * dx / dist;\t\t_bodyOne._fy \u002B= F * dy / dist;\t}\n\nAfter the force is calculated, the position is updated via the force \\* delta time.\n\n    \tpublic void update(double _deltaTime) \t{\t\t_vx \u002B= _deltaTime * _fx / _mass;\t\t_vy \u002B= _deltaTime * _fy / _mass;\t\t_rx \u002B= _deltaTime * _vx;\t\t_ry \u002B= _deltaTime * _vy;\t\tupdateTrail();\t}\n\n\\_vx \u0026 \\_vy = Velocity values\n\n\\_rx \u0026 \\_ry = position values\n\nI think the delta-time will lose accuracy as the simulation is \u0022speed up\u0022, but the unpredictable orbit of the moon is noticed in (painstakingly) observing it at a much lower delta tick.\n\nI decide potentially to just set the Moon and other Moons \u0022on-rails\u0022. It\u0027s a less elegant solution, but I\u0027m focusing more on aesthetics and education (Can\u0027t teach the Moon takes 28 days to orbit if it is flying away ![:D](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif) ).\n\n**Edited \u003Ctime datetime=\u00222015-05-07T12:22:51Z\u0022 title=\u002205/07/2015 12:22  PM\u0022 data-short=\u00229 yr\u0022\u003EMay 7, 2015\u003C/time\u003E by Beale**"},{"CreatedByName":"K^2","CreatedById":57710,"CreatedDateTime":"2015-05-07T12:25:14Z","Content":"Ok, this is called Forward Euler method, and it is the cause of it being as bad as it is. Try applying Velocity Verlet. The standard description is a bit confusing because of velocity update, but basically, you want following scheme.\n\na\\_new = F/m\n\nv = v \u002B dt \\* (a\\_old \u002B a\\_new)/2\n\nx = x \u002B dt \\* v \u002B dt \\* dt \\* a\\_new/2\n\na\\_old = a\\_new\n\nDo this for x and y for each time step. a\\_old can start out as 0, but then you need to maintain it from step to step.\n\nThe beauty of this method is how simple it is, yet, it makes a huge improvement. I would still expect the moon to drift off, but it should take much longer. An even better improvement can be gained by going to 4th order Runge-Kutta (RK4) method, but it is also significantly harder.\n\nReal NASA-grade simulations usually use relatively low order implicit methods specifically designed for this. They involve some crazy math."},{"CreatedByName":"Beale","CreatedById":70533,"CreatedDateTime":"2015-05-07T12:47:51Z","Content":"\u003E \n\u003E Ok, this is called Forward Euler method, and it is the cause of it being as bad as it is. Try applying Velocity Verlet. The standard description is a bit confusing because of velocity update, but basically, you want following scheme.\n\u003E a\\_new = F/m\n\u003E \n\u003E v = v \u002B dt \\* (a\\_old \u002B a\\_new)/2\n\u003E \n\u003E x = x \u002B dt \\* v \u002B dt \\* dt \\* a\\_new/2\n\u003E \n\u003E a\\_old = a\\_new\n\u003E \n\u003E Do this for x and y for each time step. a\\_old can start out as 0, but then you need to maintain it from step to step.\n\u003E \n\u003E The beauty of this method is how simple it is, yet, it makes a huge improvement. I would still expect the moon to drift off, but it should take much longer. An even better improvement can be gained by going to 4th order Runge-Kutta (RK4) method, but it is also significantly harder.\n\u003E \n\u003E Real NASA-grade simulations usually use relatively low order implicit methods specifically designed for this. They involve some crazy math.\n\nThis is wonderful, thank you most kindly for info and method, I\u0027ll give this a try.\n\nThe further methods, though I doubt I will go near implementing them, will be excellent topics to bring up in the report on simulation I write ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif).\n\nThanks \u0026 Kind regards.\n\nEdit: Small clarification,\n\n\u0022v\u0022 is vx for X and vy for Y, or should be a product of vx and vy?\n\nI.E.\n\n    a_new = F/mvx = vx \u002B dt * (a_old \u002B a_new)/2x = x \u002B dt * vx \u002B dt * dt * a_new/2a_old = a_new\n\n**Edited \u003Ctime datetime=\u00222015-05-07T13:29:41Z\u0022 title=\u002205/07/2015 01:29  PM\u0022 data-short=\u00229 yr\u0022\u003EMay 7, 2015\u003C/time\u003E by Beale**"},{"CreatedByName":"Meithan","CreatedById":76123,"CreatedDateTime":"2015-05-07T13:43:38Z","Content":"I came to this thread too late because K^2 has already provided great info. Just two things:\n\n1) If you\u0027re simulating a small number of bodies, efficient algorithms like Barnes-Hut are unnecessary: you can just directly calculate the forces using Newton\u0027s law of gravitation. You can save somw work by avoiding doing double calculations: if you already calculated the force caused by A on B, don\u0027t compute the force by B on A, just use the previous result with a negative sign.\n\n2) As K^2 pointed out, the Euler algorithm is a bad idea for N-body simulations. The velocity-verlet, on the other hand, is pretty good for simple simulations. I\u0027ve done toy simulations of our solar system for 10,000 years using the velocity-verlet, and it\u0027s pretty stable. The first image shows the Sun, the inner planets and Jupiter. The second image shows the relative error in the total mechanical energy of the system after 1000 years. As you can see, it\u0027s tiny (no larger than 1 part in 10^9).\n\n[![ToBNJRIt.png](http://i.imgur.com/ToBNJRIt.png)](http://i.imgur.com/ToBNJRI.png) [![NN8SlT7t.png](http://i.imgur.com/NN8SlT7t.png)](http://i.imgur.com/NN8SlT7.png)\n\nNow, as K^2 mentioned, your simulation has three bodies, two of which are big, in close proximity, so the system might be both inherently unstable and hard to simulate accurately. Beware.\n\nKeep us posted on your results."},{"CreatedByName":"Beale","CreatedById":70533,"CreatedDateTime":"2015-05-07T13:52:50Z","Content":"\u003E \n\u003E I came to this thread too late because K^2 has already provided great info. Just two things:\n\u003E 1) If you\u0027re simulating a small number of bodies, efficient algorithms like Barnes-Hut are unnecessary: you can just directly calculate the forces using Newton\u0027s law of gravitation. You can save somw work by avoiding doing double calculations: if you already calculated the force caused by A on B, don\u0027t compute the force by B on A, just use the previous result with a negative sign.\n\u003E \n\u003E 2) As K^2 pointed out, the Euler algorithm is a bad idea for N-body simulations. The velocity-verlet, on the other hand, is pretty good for simple simulations. I\u0027ve done toy simulations of our solar system for 10,000 years using the velocity-verlet, and it\u0027s pretty stable. The first image shows the Sun, the inner planets and Jupiter. The second image shows the relative error in the total mechanical energy of the system after 1000 years. As you can see, it\u0027s tiny (no larger than 1 part in 10^9).\n\u003E \n\u003E http://i.imgur.com/ToBNJRI.png[http://i.imgur.com/ToBNJRIt.png](http://i.imgur.com/ToBNJRIt.png) http://i.imgur.com/NN8SlT7.png[http://i.imgur.com/NN8SlT7t.png](http://i.imgur.com/NN8SlT7t.png)\n\u003E \n\u003E Now, as K^2 mentioned, your simulation has three bodies, two of which are big, in close proximity, so the system might be both inherently unstable and hard to simulate accurately. Beware.\n\u003E \n\u003E Keep us posted on your results.\n\nHi!\n\nNo, all input is appreciated regardless of chronological order, many thanks ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\nOn 1: Yep, I learned this a little too late - begin this project a little naive, and research I found gave me the impression that Barnes-Hut was better for performance (I\u0027m developing cross-platform, so was considering lower-spec phones and tablets). At the end, now I am simulating maybe 20 bodies maximum (Planets \u002B The Moon \u002B Asteroid and Kuiper belt objects), though the user has opportunity to add up to 300 extra bodies to the sim during run-time.\n\nOn 2: Very nice to see this, it is encouraging. This is MatLab? My major hope is \u0022stability\u0022 for maybe only ~10 orbits or so, to see this produce 10,000 years ( I\u0027m not aiming for this though ![:wink:](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif) ) of stability is nice.\n\nOn distance, Ideally I would make things at a larger scale, it is unfortunate that my graphics rendering API only supports float values for rendering and approximation errors mean vertex distortion when meshes are a long distance away, take example of Pluto: (This video is out of date, ignore silly UI).\n\n\u003Ciframe width=\u0022480\u0022 height=\u0022270\u0022 src=\u0022https://www.youtube.com/embed/ZBdFcA60vf8?feature=oembed\u0022 frameborder=\u00220\u0022 allowfullscreen=\u0022true\u0022\u003E\u003C/iframe\u003E\n\nHave I the time, this could be adapted to a \u0022local-space\u0022 type system to avoid such issues, and move to a larger scale, but it\u0027s unfortunate.\n\n**Edited \u003Ctime datetime=\u00222015-05-07T13:56:38Z\u0022 title=\u002205/07/2015 01:56  PM\u0022 data-short=\u00229 yr\u0022\u003EMay 7, 2015\u003C/time\u003E by Beale**"},{"CreatedByName":"Meithan","CreatedById":76123,"CreatedDateTime":"2015-05-07T14:11:28Z","Content":"\u003E \n\u003E On 1: Yep, I learned this a little too late - begin this project a little naive, and research I found gave me the impression that Barnes-Hut was better for performance (I\u0027m developing cross-platform, so was considering lower-spec phones and tablets). At the end, now I am simulating maybe 20 bodies maximum (Planets \u002B The Moon \u002B Asteroid and Kuiper belt objects), though the user has opportunity to add up to 300 extra bodies to the sim during run-time.\n\n20 bodies is definitely doable by direct force calculation; 300 I\u0027d say so too, depending on what system it\u0027s running on, what programming language and how small you want the timesteps to be.\n\n\u003E \n\u003E On 2: Very nice to see this, it is encouraging. This is MatLab? My major hope is \u0022stability\u0022 for maybe only ~10 orbits or so, to see this produce 10,000 years ( I\u0027m not aiming for this though ![:wink:](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif) ) of stability is nice.\n\nNo, it\u0027s a Fortran code I wrote plotted with gnuplot.\n\nKeep in mind the solar system is pretty stable: the orbits are nearly circular and they\u0027re pretty far apart. Close encounters are the bane of numerical N-body simulations: they\u0027ll quickly make the numerical error really bad. \n\nIf you\u0027re getting close encounters you\u0027ll probably need to make the timestep (how much each step of the calculation advances time) smaller, or even \u0027adaptive\u0027 (automatically adapt to be small when bodies are close and large when they are far away). But that\u0027s another story, I\u0027d get the basic velocity verlet working first.\n\n\u003E \n\u003E On distance, Ideally I would make things at a larger scale, it is unfortunate that my graphics rendering API only supports float values for rendering and approximation errors mean vertex distortion when meshes are a long distance away, take example of Pluto: (This video is out of date, ignore silly UI).\n\nThe KSP devs ran precisely into this problem. An adaptive resolution mesh for the planets and movable coordinate origin are ingredients of the solution."},{"CreatedByName":"K^2","CreatedById":57710,"CreatedDateTime":"2015-05-07T19:20:51Z","Content":"I\u0027ve found that there are energy gains even with nice circular orbits over rime, but yeah, it is nowhere near as bad as elliptic ones. Maybe it is good enough.\n\nYes, v is vx for x and vy for y. Same with acceleration and force."},{"CreatedByName":"Meithan","CreatedById":76123,"CreatedDateTime":"2015-05-07T20:09:05Z","Content":"\u003E \n\u003E I\u0027ve found that there are energy gains even with nice circular orbits over rime, but yeah, it is nowhere near as bad as elliptic ones. Maybe it is good enough.\n\nIf the integrator is *symplectic*, and the velocity verlet is an example of one, then by design the energy errors should be bounded and quasi-periodic, and not add up over time -- that\u0027s the beauty of symplectic integrators. See the [energy error graph](http://i.imgur.com/NN8SlT7.png) I posted earlier: the energy fluctuates almost periodically (the \u0022main\u0022 oscillation seems to have a period very similar to that of Mercury, about 1/4th of year) but the error never becomes greater than 10^-9 -- and in principle this would hold for indefinitely long periods of time.\n\nWith Runge-Kutta integrators, which are not symplectic, the story is different, and the energy error *will* build up over time, which is why they\u0027re not preferred to study the long-term stability of gravitational systems. In practice, though, a fourth-order Runge-Kutta integrator with its gradually accumulating error should still yield better results than the second-order velocity verlet if the integrated time is not too long, simply because the error is considerably smaller in the first place (due to the method being of higher order).\n\n**Edited \u003Ctime datetime=\u00222015-05-07T20:16:32Z\u0022 title=\u002205/07/2015 08:16  PM\u0022 data-short=\u00229 yr\u0022\u003EMay 7, 2015\u003C/time\u003E by Meithan**"},{"CreatedByName":"K^2","CreatedById":57710,"CreatedDateTime":"2015-05-07T20:32:51Z","Content":"\u003E \n\u003E If the integrator is *symplectic*, and the velocity verlet is an example of one, then by design the energy errors should be bounded and quasi-periodic, and not add up over time -- that\u0027s the beauty of symplectic integrators. See the [energy error graph](http://i.imgur.com/NN8SlT7.png) I posted earlier: the energy fluctuates almost periodically (the \u0022main\u0022 oscillation seems to have a period very similar to that of Mercury, about 1/4th of year) but the error never becomes greater than 10^-9 -- and in principle this would hold for indefinitely long periods of time.\n\nVerlet is *not* symplectic with 1/r potential. No known method is. Verlet is symplectic with r\u00C3\u201A\u00C2\u00B2 potential, such as Hooke\u0027s law used in collisions, which is why it\u0027s a favorite in game dev. But no method is symplectic for all potential types."}]}