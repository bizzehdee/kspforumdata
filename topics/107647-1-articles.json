{"TopicId":107647,"ForumId":44,"TopicTitle":"Calculating The Speed Of A Moon?","CreatedByName":"Beale","CreatedById":70533,"CreatedDateTime":"2015-05-05T13:48:18Z","PageNum":1,"Articles":[{"CreatedByName":"Beale","CreatedById":70533,"CreatedDateTime":"2015-05-05T13:48:18Z","Content":"\n\u003Cp\u003EHello!\u003C/p\u003E\u003Cp\u003ESomewhat of a follow up to \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/115108-Calculating-The-Required-Speed-For-Circular-Orbit\u0022 rel=\u0022external nofollow\u0022\u003Emy last thread.\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EIs there a general method for finding the velocity needed for a moon to enter circular orbit around a planet?\u003C/p\u003E\u003Cp\u003EMy English isn\u0027t always so great when it comes to technical stuff, so here is an image:\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://puu.sh/hChGc/10d85eecce.png\u0022 alt=\u002210d85eecce.png\u0022\u003E\u003C/p\u003E\u003Cp\u003EThis is for a 2D N-body sim.\u003C/p\u003E\u003Cp\u003EAll Planets and moons are initialized on a 1-dimensional straight line distance from the sun along the Y axis, so when started V can assumed to be only speed along the X axis.\u003C/p\u003E\u003Cp\u003EOr, more specifically:\u003C/p\u003E\u003Cp\u003EFor the moon, am I just setting VX (As in only sideways initial velocity like a planet) or do I need a VY component?\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://puu.sh/hChLK/6247eb7f32.png\u0022 alt=\u00226247eb7f32.png\u0022\u003E\u003C/p\u003E\u003Cp\u003ESorry, I hope I make myself clear what I\u0027m asking! \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003ECurrently I\u0027ve basically attempted to \u0027guess\u0027 the needed velocity. You can imagine how that has resulted, at best the moon is a temporary satellite before either drifting or being violently gravity-assisted outwards.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-05-05T13:56:12Z\u0022 title=\u002205/05/2015 01:56  PM\u0022 data-short=\u00229 yr\u0022\u003EMay 5, 2015\u003C/time\u003E by Beale\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"ZetaX","CreatedById":60692,"CreatedDateTime":"2015-05-05T13:59:46Z","Content":"\n\u003Cp\u003EThe VY component is 0. If it were not your moon would, at least initially, move towards or away from the planet, which is contradicting it being a circle (which means that the distance to the planet is always the same).\u003C/p\u003E\u003Cp\u003EBut note that this is just \u0022close to a circle\u0022 anyway, because the sun will have an effect on the orbit.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-05-05T14:01:49Z\u0022 title=\u002205/05/2015 02:01  PM\u0022 data-short=\u00229 yr\u0022\u003EMay 5, 2015\u003C/time\u003E by ZetaX\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"LordFerret","CreatedById":111598,"CreatedDateTime":"2015-05-05T15:33:26Z","Content":"\n\u003Cp\u003E\u003Ca href=\u0022https://www.shodor.org/succeedhi/succeedhi/orbits/Notes-content.html\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://www.shodor.org/succeedhi/succeedhi/orbits/Notes-content.html\u003C/a\u003E\u003C/p\u003E\u003Cp\u003Eand\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022http://www.dummies.com/how-to/content/how-to-calculate-centripetal-acceleration-of-an-or.html\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://www.dummies.com/how-to/content/how-to-calculate-centripetal-acceleration-of-an-or.html\u003C/a\u003E\u003C/p\u003E\n"},{"CreatedByName":"Beale","CreatedById":70533,"CreatedDateTime":"2015-05-05T15:54:03Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022ZetaX\u0022 data-cite=\u0022ZetaX\u0022\u003E\u003Cdiv\u003EThe VY component is 0. If it were not your moon would, at least initially, move towards or away from the planet, which is contradicting it being a circle (which means that the distance to the planet is always the same).\u003Cp\u003EBut note that this is just \u0022close to a circle\u0022 anyway, because the sun will have an effect on the orbit.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EGood to know, thanks for the info.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022LordFerret\u0022 data-cite=\u0022LordFerret\u0022\u003E\u003Cdiv\u003E\u003Ca href=\u0022https://www.shodor.org/succeedhi/succeedhi/orbits/Notes-content.html\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://www.shodor.org/succeedhi/succeedhi/orbits/Notes-content.html\u003C/a\u003E\u003Cp\u003Eand\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022http://www.dummies.com/how-to/content/how-to-calculate-centripetal-acceleration-of-an-or.html\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://www.dummies.com/how-to/content/how-to-calculate-centripetal-acceleration-of-an-or.html\u003C/a\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EGreat thanks for the links!\u003C/p\u003E\u003Cp\u003EI\u0027ll give them a read through, though... They look a bit intimidating!\u003C/p\u003E\u003Cp\u003EAny particular part of the pages I should put my attention for a method?\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-05-05T15:56:46Z\u0022 title=\u002205/05/2015 03:56  PM\u0022 data-short=\u00229 yr\u0022\u003EMay 5, 2015\u003C/time\u003E by Beale\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Beale","CreatedById":70533,"CreatedDateTime":"2015-05-05T20:29:45Z","Content":"\n\u003Cp\u003EHi!\u003C/p\u003E\u003Cp\u003ENope, neither of the links offer quite what I\u0027m after.\u003C/p\u003E\u003Cp\u003EThey are based on orbital periods which I don\u0027t have, but rather do have position, masses and distances.\u003C/p\u003E\u003Cp\u003EIf I make sense.\u003C/p\u003E\u003Cp\u003EMore phrasing: what X velocity needed so that moon is naturally \u0022captured\u0022 into orbit.\u003C/p\u003E\n"},{"CreatedByName":"Brotoro","CreatedById":57674,"CreatedDateTime":"2015-05-05T20:32:56Z","Content":"\n\u003Cp\u003ENeed to know the mass of the planet.\u003C/p\u003E\n"},{"CreatedByName":"Beale","CreatedById":70533,"CreatedDateTime":"2015-05-05T20:35:48Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Brotoro\u0022 data-cite=\u0022Brotoro\u0022\u003E\u003Cdiv\u003ENeed to know the mass of the planet.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EIt\u0027s 1 Earth mass, but what I\u0027m after is a general method, rather than calculating a specific instance. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"UmbralRaptor","CreatedById":2767,"CreatedDateTime":"2015-05-05T20:40:32Z","Content":"\n\u003Cp\u003EI\u0027d lean towards conservation of energy or Vis-Viva, using either to generate an ellipse with a semi-major axis inside the \u003Ca href=\u0022https://en.wikipedia.org/wiki/Hill_sphere\u0022 rel=\u0022external nofollow\u0022\u003EHill sphere\u003C/a\u003E, or better still inside the \u003Ca href=\u0022https://en.wikipedia.org/wiki/Sphere_of_influence_%28astrodynamics%29\u0022 rel=\u0022external nofollow\u0022\u003Esphere of influence\u003C/a\u003E of the planet.\u003C/p\u003E\u003Cp\u003EIt\u0027s not completely guarenteed in the long run (because N-body), but should be stable for a while.\u003C/p\u003E\n"},{"CreatedByName":"Brotoro","CreatedById":57674,"CreatedDateTime":"2015-05-05T20:42:30Z","Content":"\n\u003Cp\u003EIf the planet mass is m, and the moon is a distance r away from the planet (center to center), then the circular orbit speed of the moon will be SQRT(Gm/r) around the planet. Add that to the planet\u0027s orbital speed around the star, SQRT(GM/R), and you\u0027ll have the moon\u0027s velocity relative to the star at the point shown in your diagram.\u003C/p\u003E\n"},{"CreatedByName":"Beale","CreatedById":70533,"CreatedDateTime":"2015-05-05T20:46:47Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022UmbralRaptor\u0022 data-cite=\u0022UmbralRaptor\u0022\u003E\u003Cdiv\u003EI\u0027d lean towards conservation of energy or Vis-Viva, using either to generate an ellipse with a semi-major axis inside the \u003Ca href=\u0022https://en.wikipedia.org/wiki/Hill_sphere\u0022 rel=\u0022external nofollow\u0022\u003EHill sphere\u003C/a\u003E, or better still inside the \u003Ca href=\u0022https://en.wikipedia.org/wiki/Sphere_of_influence_%28astrodynamics%29\u0022 rel=\u0022external nofollow\u0022\u003Esphere of influence\u003C/a\u003E of the planet.\u003Cp\u003EIt\u0027s not completely guarenteed in the long run (because N-body), but should be stable for a while.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThanks for the links.\u003C/p\u003E\u003Cp\u003EWith the info, I can add SOI rendering, which will be quite nifty! \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EI was a little worried about SOIs, they seem to be rather small (because things are probably closer to the sun than they should be).\u003C/p\u003E\u003Cp\u003EStill, this may be fixed by reducing the suns mass.\u003C/p\u003E\u003Cp\u003EStability: Long term not absolutely needed.\u003C/p\u003E\u003Cp\u003ECheers! \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Brotoro\u0022 data-cite=\u0022Brotoro\u0022\u003E\u003Cdiv\u003EIf the planet mass is m, and the moon is a distance r away from the planet (center to center), then the circular orbit speed of the moon will be SQRT(Gm/r) around the planet. Add that to the planet\u0027s orbital speed around the star, SQRT(GM/R), and you\u0027ll have the moon\u0027s velocity relative to the star at the point shown in your diagram.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EAh!\u003C/p\u003E\u003Cp\u003EA nice solution, many thanks for this Brotoro, much!\u003C/p\u003E\u003Cp\u003EKind regards.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-05-05T20:50:27Z\u0022 title=\u002205/05/2015 08:50  PM\u0022 data-short=\u00229 yr\u0022\u003EMay 5, 2015\u003C/time\u003E by Beale\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Bill Phil","CreatedById":127797,"CreatedDateTime":"2015-05-05T20:56:39Z","Content":"\n\u003Cp\u003EOrbital speed required at the \u0022moon\u0022\u0027s distance to the planet, and the current speed of the \u0022moon\u0022 relative to the planet. Get the difference of the two and that should be it....\u003C/p\u003E\n"},{"CreatedByName":"arkie87","CreatedById":103434,"CreatedDateTime":"2015-05-05T22:37:33Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Beale\u0022 data-cite=\u0022Beale\u0022\u003E\u003Cdiv\u003EHi!\u003Cp\u003ENope, neither of the links offer quite what I\u0027m after.\u003C/p\u003E\u003Cp\u003EThey are based on orbital periods which I don\u0027t have, but rather do have position, masses and distances.\u003C/p\u003E\u003Cp\u003EIf I make sense.\u003C/p\u003E\u003Cp\u003EMore phrasing: what X velocity needed so that moon is naturally \u0022captured\u0022 into orbit.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYou have the formula right there in your picture: V=sqrt(G*M/R)=sqrt(g*R)\u003C/p\u003E\n"},{"CreatedByName":"YNM","CreatedById":98447,"CreatedDateTime":"2015-05-05T23:39:25Z","Content":"\n\u003Cp\u003EYou can use the relative velocity. As lomg as it\u0027s less than escape velocity it should be in orbit. Except it\u0027s very far, that is. To determine how far until it escapes (even when the relative velocity is small enough), Hill sphere would be the best way to do it, or the closest (to the planet) lagrange point of the planet.\u003C/p\u003E\n"},{"CreatedByName":"K^2","CreatedById":57710,"CreatedDateTime":"2015-05-06T04:33:14Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Brotoro\u0022 data-cite=\u0022Brotoro\u0022\u003E\u003Cdiv\u003EIf the planet mass is m, and the moon is a distance r away from the planet (center to center), then the circular orbit speed of the moon will be SQRT(Gm/r) around the planet. Add that to the planet\u0027s orbital speed around the star, SQRT(GM/R), and you\u0027ll have the moon\u0027s velocity relative to the star at the point shown in your diagram.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EIt might be worth pointing out that this isn\u0027t an exact answer. It\u0027s a good starting point, and might be all you need for a sim, but it won\u0027t be quite right. For starters, reduced mass is giong to be a factor here. Even if the star is taken to be stationary, planet is clearly being simulated. So planet\u0027s-to-moon\u0027s mass ratio is going to be important.\u003C/p\u003E\u003Cp\u003EBut even outside of that, you\u0027re firmly in the 3-body world here. Even with a stationary star, the planet-moon system experiences a periodic perturbation. If they are close to resonance, big trouble. If not, it will still cause a slight change in moon\u0027s period. So even with reduced masses in place, the orbital velocity will be slightly off.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Beale\u0022 data-cite=\u0022Beale\u0022\u003E\u003Cdiv\u003EYou can imagine how that has resulted, at best the moon is a temporary satellite before either drifting or being violently gravity-assisted outwards.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EAnd that\u0027s likely to keep happening.\u003C/p\u003E\u003Cp\u003Ea) I\u0027m pretty sure your simulation will have significant errors.\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_cool.png\u0022 alt=\u0022B)\u0022\u003E At that scale, there is going to be significant interaction between the two orbits.\u003C/p\u003E\u003Cp\u003EEither one of these might have been alright, but toghether, you\u0027re pretty much guaranteed an ejected moon.\u003C/p\u003E\n"},{"CreatedByName":"Beale","CreatedById":70533,"CreatedDateTime":"2015-05-07T11:36:27Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Bill Phil\u0022 data-cite=\u0022Bill Phil\u0022\u003E\u003Cdiv\u003EOrbital speed required at the \u0022moon\u0022\u0027s distance to the planet, and the current speed of the \u0022moon\u0022 relative to the planet. Get the difference of the two and that should be it....\u003C/div\u003E\u003C/blockquote\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022YNM\u0022 data-cite=\u0022YNM\u0022\u003E\u003Cdiv\u003EYou can use the relative velocity. As lomg as it\u0027s less than escape velocity it should be in orbit. Except it\u0027s very far, that is. To determine how far until it escapes (even when the relative velocity is small enough), Hill sphere would be the best way to do it, or the closest (to the planet) lagrange point of the planet.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ESo the Moon\u0027s X velocity should have add to it the relative velocity between the two bodies? Sorry I don\u0027t follow quite completely.\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022https://en.wikipedia.org/wiki/Hill_sphere\u0022 rel=\u0022external nofollow\u0022\u003EI\u0027m trying to calculate the hill sphere\u003C/a\u003E, but don\u0027t quite understand the mathematic notation (Specifically the Square root with a power of 3 on it?).\u003C/p\u003E\u003Cp\u003EThanks for the help \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022arkie87\u0022 data-cite=\u0022arkie87\u0022\u003E\u003Cdiv\u003EYou have the formula right there in your picture: V=sqrt(G*M/R)=sqrt(g*R)\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYes, this works if the earth was standing still and I was calculating the speed of the Moon alone, but relative to the sun is what is needed.\u003C/p\u003E\u003Cp\u003EIf I understand you right.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022K^2\u0022 data-cite=\u0022K^2\u0022\u003E\u003Cdiv\u003EIt might be worth pointing out that this isn\u0027t an exact answer. It\u0027s a good starting point, and might be all you need for a sim, but it won\u0027t be quite right. For starters, reduced mass is giong to be a factor here. Even if the star is taken to be stationary, planet is clearly being simulated. So planet\u0027s-to-moon\u0027s mass ratio is going to be important.\u003Cp\u003EBut even outside of that, you\u0027re firmly in the 3-body world here. Even with a stationary star, the planet-moon system experiences a periodic perturbation. If they are close to resonance, big trouble. If not, it will still cause a slight change in moon\u0027s period. So even with reduced masses in place, the orbital velocity will be slightly off.\u003C/p\u003E\u003Cp\u003EAnd that\u0027s likely to keep happening.\u003C/p\u003E\u003Cp\u003Ea) I\u0027m pretty sure your simulation will have significant errors.\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_cool.png\u0022 alt=\u0022B)\u0022\u003E At that scale, there is going to be significant interaction between the two orbits.\u003C/p\u003E\u003Cp\u003EEither one of these might have been alright, but toghether, you\u0027re pretty much guaranteed an ejected moon.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI\u0027ve applied Brotoro\u0027s methods and reproduce the problems you describe unfortunately.\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://puu.sh/hEBDe/766ce8945e.png\u0022 alt=\u0022766ce8945e.png\u0022\u003E\u003C/p\u003E\u003Cp\u003EThe Moon typically makes one, two or even three (unpredictable!) orbits around the Earth before drifting away.\u003C/p\u003E\u003Cp\u003EI think perhaps the Earth does not provide much at all influence (hill sphere?) to hold it correctly, even in very close orbits.\u003C/p\u003E\u003Cp\u003EStrangely, reducing the mass of the sun, even drastically does not seem to increase the Earth\u0027s influence...\u003C/p\u003E\u003Cp\u003EI\u0027m a little confused about your point A, that seems a little abrasive... Unless I\u0027m reading you wrong.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-05-07T11:40:36Z\u0022 title=\u002205/07/2015 11:40  AM\u0022 data-short=\u00229 yr\u0022\u003EMay 7, 2015\u003C/time\u003E by Beale\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"K^2","CreatedById":57710,"CreatedDateTime":"2015-05-07T12:03:02Z","Content":"\n\u003Cp\u003EGravity is notoriously difficult to deal with numerically. Even if you have prior experience with numerical methods in differential equations, unless you studied numerical methods in gravity extensively, it is very unlikely that your simulation is up to the task. Don\u0027t take it the wrong way. It is a deceptively hard problem.\u003C/p\u003E\u003Cp\u003EYour description makes it sound even more unstable than it needs be, though. How do you update position and velocity in your simulation?\u003C/p\u003E\n"},{"CreatedByName":"Beale","CreatedById":70533,"CreatedDateTime":"2015-05-07T12:07:51Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022K^2\u0022 data-cite=\u0022K^2\u0022\u003E\u003Cdiv\u003EGravity is notoriously difficult to deal with numerically. Even if you have prior experience with numerical methods in differential equations, unless you studied numerical methods in gravity extensively, it is very unlikely that your simulation is up to the task. Don\u0027t take it the wrong way. It is a deceptively hard problem.\u003Cp\u003EYour description makes it sound even more unstable than it needs be, though. How do you update position and velocity in your simulation?\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EOkay, no worries. Is a more than fair point, I am very much an amateur here.\u003C/p\u003E\u003Cp\u003EI\u0027m using a Barnes-Hut approximation to update the forces acting on the body (But since there are no largely clustered objects, might just consider it a direct approach).\u003C/p\u003E\u003Cp\u003EThe force calculation:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\t\u003Cbr\u003Epublic void addForce(SimBody _bodyTwo)\u003Cbr\u003E\t{\u003Cbr\u003E\t\tSimBody _bodyOne = this;\u003Cbr\u003E\t\tdouble dx = _bodyTwo._rx - _bodyOne._rx;\u003Cbr\u003E\t\tdouble dy = _bodyTwo._ry - _bodyOne._ry;\u003Cbr\u003E\t\tdouble dist = Math.sqrt(dx*dx \u002B dy*dy);\u003Cbr\u003E\t\tdouble F = (G * _bodyOne._mass * _bodyTwo._mass) / (dist*dist);\u003Cbr\u003E\t\t_bodyOne._fx \u002B= F * dx / dist;\u003Cbr\u003E\t\t_bodyOne._fy \u002B= F * dy / dist;\u003Cbr\u003E\t}\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EAfter the force is calculated, the position is updated via the force * delta time.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\t\u003Cbr\u003Epublic void update(double _deltaTime) \u003Cbr\u003E\t{\u003Cbr\u003E\t\t_vx \u002B= _deltaTime * _fx / _mass;\u003Cbr\u003E\t\t_vy \u002B= _deltaTime * _fy / _mass;\u003Cbr\u003E\t\t_rx \u002B= _deltaTime * _vx;\u003Cbr\u003E\t\t_ry \u002B= _deltaTime * _vy;\u003Cbr\u003E\u003Cbr\u003E\t\tupdateTrail();\u003Cbr\u003E\t}\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E_vx \u0026amp; _vy = Velocity values\u003C/p\u003E\u003Cp\u003E_rx \u0026amp; _ry = position values\u003C/p\u003E\u003Cp\u003EI think the delta-time will lose accuracy as the simulation is \u0022speed up\u0022, but the unpredictable orbit of the moon is noticed in (painstakingly) observing it at a much lower delta tick.\u003C/p\u003E\u003Cp\u003EI decide potentially to just set the Moon and other Moons \u0022on-rails\u0022. It\u0027s a less elegant solution, but I\u0027m focusing more on aesthetics and education (Can\u0027t teach the Moon takes 28 days to orbit if it is flying away \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 alt=\u0022:D\u0022\u003E ).\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-05-07T12:22:51Z\u0022 title=\u002205/07/2015 12:22  PM\u0022 data-short=\u00229 yr\u0022\u003EMay 7, 2015\u003C/time\u003E by Beale\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"K^2","CreatedById":57710,"CreatedDateTime":"2015-05-07T12:25:14Z","Content":"\n\u003Cp\u003EOk, this is called Forward Euler method, and it is the cause of it being as bad as it is. Try applying Velocity Verlet. The standard description is a bit confusing because of velocity update, but basically, you want following scheme.\u003C/p\u003E\u003Cp\u003Ea_new = F/m\u003C/p\u003E\u003Cp\u003Ev = v \u002B dt * (a_old \u002B a_new)/2\u003C/p\u003E\u003Cp\u003Ex = x \u002B dt * v \u002B dt * dt * a_new/2\u003C/p\u003E\u003Cp\u003Ea_old = a_new\u003C/p\u003E\u003Cp\u003EDo this for x and y for each time step. a_old can start out as 0, but then you need to maintain it from step to step.\u003C/p\u003E\u003Cp\u003EThe beauty of this method is how simple it is, yet, it makes a huge improvement. I would still expect the moon to drift off, but it should take much longer. An even better improvement can be gained by going to 4th order Runge-Kutta (RK4) method, but it is also significantly harder.\u003C/p\u003E\u003Cp\u003EReal NASA-grade simulations usually use relatively low order implicit methods specifically designed for this. They involve some crazy math.\u003C/p\u003E\n"},{"CreatedByName":"Beale","CreatedById":70533,"CreatedDateTime":"2015-05-07T12:47:51Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022K^2\u0022 data-cite=\u0022K^2\u0022\u003E\u003Cdiv\u003EOk, this is called Forward Euler method, and it is the cause of it being as bad as it is. Try applying Velocity Verlet. The standard description is a bit confusing because of velocity update, but basically, you want following scheme.\u003Cp\u003Ea_new = F/m\u003C/p\u003E\u003Cp\u003Ev = v \u002B dt * (a_old \u002B a_new)/2\u003C/p\u003E\u003Cp\u003Ex = x \u002B dt * v \u002B dt * dt * a_new/2\u003C/p\u003E\u003Cp\u003Ea_old = a_new\u003C/p\u003E\u003Cp\u003EDo this for x and y for each time step. a_old can start out as 0, but then you need to maintain it from step to step.\u003C/p\u003E\u003Cp\u003EThe beauty of this method is how simple it is, yet, it makes a huge improvement. I would still expect the moon to drift off, but it should take much longer. An even better improvement can be gained by going to 4th order Runge-Kutta (RK4) method, but it is also significantly harder.\u003C/p\u003E\u003Cp\u003EReal NASA-grade simulations usually use relatively low order implicit methods specifically designed for this. They involve some crazy math.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThis is wonderful, thank you most kindly for info and method, I\u0027ll give this a try.\u003C/p\u003E\u003Cp\u003EThe further methods, though I doubt I will go near implementing them, will be excellent topics to bring up in the report on simulation I write \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E.\u003C/p\u003E\u003Cp\u003EThanks \u0026amp; Kind regards.\u003C/p\u003E\u003Cp\u003EEdit: Small clarification,\u003C/p\u003E\u003Cp\u003E\u0022v\u0022 is vx for X and vy for Y, or should be a product of vx and vy?\u003C/p\u003E\u003Cp\u003EI.E.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Ea_new = F/m\u003Cbr\u003Evx = vx \u002B dt * (a_old \u002B a_new)/2\u003Cbr\u003Ex = x \u002B dt * vx \u002B dt * dt * a_new/2\u003Cbr\u003Ea_old = a_new\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-05-07T13:29:41Z\u0022 title=\u002205/07/2015 01:29  PM\u0022 data-short=\u00229 yr\u0022\u003EMay 7, 2015\u003C/time\u003E by Beale\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Meithan","CreatedById":76123,"CreatedDateTime":"2015-05-07T13:43:38Z","Content":"\n\u003Cp\u003EI came to this thread too late because K^2 has already provided great info. Just two things:\u003C/p\u003E\u003Cp\u003E1) If you\u0027re simulating a small number of bodies, efficient algorithms like Barnes-Hut are unnecessary: you can just directly calculate the forces using Newton\u0027s law of gravitation. You can save somw work by avoiding doing double calculations: if you already calculated the force caused by A on B, don\u0027t compute the force by B on A, just use the previous result with a negative sign.\u003C/p\u003E\u003Cp\u003E2) As K^2 pointed out, the Euler algorithm is a bad idea for N-body simulations. The velocity-verlet, on the other hand, is pretty good for simple simulations. I\u0027ve done toy simulations of our solar system for 10,000 years using the velocity-verlet, and it\u0027s pretty stable. The first image shows the Sun, the inner planets and Jupiter. The second image shows the relative error in the total mechanical energy of the system after 1000 years. As you can see, it\u0027s tiny (no larger than 1 part in 10^9).\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022http://i.imgur.com/ToBNJRI.png\u0022 rel=\u0022external nofollow\u0022\u003E\u003Cimg src=\u0022http://i.imgur.com/ToBNJRIt.png\u0022 alt=\u0022ToBNJRIt.png\u0022\u003E\u003C/a\u003E \u003Ca href=\u0022http://i.imgur.com/NN8SlT7.png\u0022 rel=\u0022external nofollow\u0022\u003E\u003Cimg src=\u0022http://i.imgur.com/NN8SlT7t.png\u0022 alt=\u0022NN8SlT7t.png\u0022\u003E\u003C/a\u003E\u003C/p\u003E\u003Cp\u003ENow, as K^2 mentioned, your simulation has three bodies, two of which are big, in close proximity, so the system might be both inherently unstable and hard to simulate accurately. Beware.\u003C/p\u003E\u003Cp\u003EKeep us posted on your results.\u003C/p\u003E\n"},{"CreatedByName":"Beale","CreatedById":70533,"CreatedDateTime":"2015-05-07T13:52:50Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Meithan\u0022 data-cite=\u0022Meithan\u0022\u003E\u003Cdiv\u003EI came to this thread too late because K^2 has already provided great info. Just two things:\u003Cp\u003E1) If you\u0027re simulating a small number of bodies, efficient algorithms like Barnes-Hut are unnecessary: you can just directly calculate the forces using Newton\u0027s law of gravitation. You can save somw work by avoiding doing double calculations: if you already calculated the force caused by A on B, don\u0027t compute the force by B on A, just use the previous result with a negative sign.\u003C/p\u003E\u003Cp\u003E2) As K^2 pointed out, the Euler algorithm is a bad idea for N-body simulations. The velocity-verlet, on the other hand, is pretty good for simple simulations. I\u0027ve done toy simulations of our solar system for 10,000 years using the velocity-verlet, and it\u0027s pretty stable. The first image shows the Sun, the inner planets and Jupiter. The second image shows the relative error in the total mechanical energy of the system after 1000 years. As you can see, it\u0027s tiny (no larger than 1 part in 10^9).\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022http://i.imgur.com/ToBNJRI.png\u0022 rel=\u0022external nofollow\u0022\u003E\u003C/a\u003E\u003Ca href=\u0022http://i.imgur.com/ToBNJRIt.png\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://i.imgur.com/ToBNJRIt.png\u003C/a\u003E \u003Ca href=\u0022http://i.imgur.com/NN8SlT7.png\u0022 rel=\u0022external nofollow\u0022\u003E\u003C/a\u003E\u003Ca href=\u0022http://i.imgur.com/NN8SlT7t.png\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://i.imgur.com/NN8SlT7t.png\u003C/a\u003E\u003C/p\u003E\u003Cp\u003ENow, as K^2 mentioned, your simulation has three bodies, two of which are big, in close proximity, so the system might be both inherently unstable and hard to simulate accurately. Beware.\u003C/p\u003E\u003Cp\u003EKeep us posted on your results.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EHi!\u003C/p\u003E\u003Cp\u003ENo, all input is appreciated regardless of chronological order, many thanks \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EOn 1: Yep, I learned this a little too late - begin this project a little naive, and research I found gave me the impression that Barnes-Hut was better for performance (I\u0027m developing cross-platform, so was considering lower-spec phones and tablets). At the end, now I am simulating maybe 20 bodies maximum (Planets \u002B The Moon \u002B Asteroid and Kuiper belt objects), though the user has opportunity to add up to 300 extra bodies to the sim during run-time.\u003C/p\u003E\u003Cp\u003EOn 2: Very nice to see this, it is encouraging. This is MatLab? My major hope is \u0022stability\u0022 for maybe only ~10 orbits or so, to see this produce 10,000 years ( I\u0027m not aiming for this though \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif\u0022 alt=\u0022:wink:\u0022\u003E ) of stability is nice.\u003C/p\u003E\u003Cp\u003EOn distance, Ideally I would make things at a larger scale, it is unfortunate that my graphics rendering API only supports float values for rendering and approximation errors mean vertex distortion when meshes are a long distance away, take example of Pluto: (This video is out of date, ignore silly UI).\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E\n\u003C/p\u003E\u003Cdiv class=\u0022ipsEmbeddedVideo\u0022 contenteditable=\u0022false\u0022\u003E\u003Cdiv\u003E\u003Ciframe width=\u0022480\u0022 height=\u0022270\u0022 src=\u0022https://www.youtube.com/embed/ZBdFcA60vf8?feature=oembed\u0022 frameborder=\u00220\u0022 allowfullscreen=\u0022true\u0022\u003E\u003C/iframe\u003E\u003C/div\u003E\u003C/div\u003E\u003Cp\u003EHave I the time, this could be adapted to a \u0022local-space\u0022 type system to avoid such issues, and move to a larger scale, but it\u0027s unfortunate.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-05-07T13:56:38Z\u0022 title=\u002205/07/2015 01:56  PM\u0022 data-short=\u00229 yr\u0022\u003EMay 7, 2015\u003C/time\u003E by Beale\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Meithan","CreatedById":76123,"CreatedDateTime":"2015-05-07T14:11:28Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Beale\u0022 data-cite=\u0022Beale\u0022\u003E\u003Cdiv\u003EOn 1: Yep, I learned this a little too late - begin this project a little naive, and research I found gave me the impression that Barnes-Hut was better for performance (I\u0027m developing cross-platform, so was considering lower-spec phones and tablets). At the end, now I am simulating maybe 20 bodies maximum (Planets \u002B The Moon \u002B Asteroid and Kuiper belt objects), though the user has opportunity to add up to 300 extra bodies to the sim during run-time.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003E20 bodies is definitely doable by direct force calculation; 300 I\u0027d say so too, depending on what system it\u0027s running on, what programming language and how small you want the timesteps to be.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Beale\u0022 data-cite=\u0022Beale\u0022\u003E\u003Cdiv\u003EOn 2: Very nice to see this, it is encouraging. This is MatLab? My major hope is \u0022stability\u0022 for maybe only ~10 orbits or so, to see this produce 10,000 years ( I\u0027m not aiming for this though \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif\u0022 alt=\u0022:wink:\u0022\u003E ) of stability is nice.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ENo, it\u0027s a Fortran code I wrote plotted with gnuplot.\u003C/p\u003E\u003Cp\u003EKeep in mind the solar system is pretty stable: the orbits are nearly circular and they\u0027re pretty far apart. Close encounters are the bane of numerical N-body simulations: they\u0027ll quickly make the numerical error really bad. \u003C/p\u003E\u003Cp\u003EIf you\u0027re getting close encounters you\u0027ll probably need to make the timestep (how much each step of the calculation advances time) smaller, or even \u0027adaptive\u0027 (automatically adapt to be small when bodies are close and large when they are far away). But that\u0027s another story, I\u0027d get the basic velocity verlet working first.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Beale\u0022 data-cite=\u0022Beale\u0022\u003E\u003Cdiv\u003E\u003Cp\u003EOn distance, Ideally I would make things at a larger scale, it is unfortunate that my graphics rendering API only supports float values for rendering and approximation errors mean vertex distortion when meshes are a long distance away, take example of Pluto: (This video is out of date, ignore silly UI).\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThe KSP devs ran precisely into this problem. An adaptive resolution mesh for the planets and movable coordinate origin are ingredients of the solution.\u003C/p\u003E\n"},{"CreatedByName":"K^2","CreatedById":57710,"CreatedDateTime":"2015-05-07T19:20:51Z","Content":"\n\u003Cp\u003EI\u0027ve found that there are energy gains even with nice circular orbits over rime, but yeah, it is nowhere near as bad as elliptic ones. Maybe it is good enough.\u003C/p\u003E\u003Cp\u003EYes, v is vx for x and vy for y. Same with acceleration and force.\u003C/p\u003E\n"},{"CreatedByName":"Meithan","CreatedById":76123,"CreatedDateTime":"2015-05-07T20:09:05Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022K^2\u0022 data-cite=\u0022K^2\u0022\u003E\u003Cdiv\u003EI\u0027ve found that there are energy gains even with nice circular orbits over rime, but yeah, it is nowhere near as bad as elliptic ones. Maybe it is good enough.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EIf the integrator is \u003Cem\u003Esymplectic\u003C/em\u003E, and the velocity verlet is an example of one, then by design the energy errors should be bounded and quasi-periodic, and not add up over time -- that\u0027s the beauty of symplectic integrators. See the \u003Ca href=\u0022http://i.imgur.com/NN8SlT7.png\u0022 rel=\u0022external nofollow\u0022\u003Eenergy error graph\u003C/a\u003E I posted earlier: the energy fluctuates almost periodically (the \u0022main\u0022 oscillation seems to have a period very similar to that of Mercury, about 1/4th of year) but the error never becomes greater than 10^-9 -- and in principle this would hold for indefinitely long periods of time.\u003C/p\u003E\u003Cp\u003EWith Runge-Kutta integrators, which are not symplectic, the story is different, and the energy error \u003Cem\u003Ewill\u003C/em\u003E build up over time, which is why they\u0027re not preferred to study the long-term stability of gravitational systems. In practice, though, a fourth-order Runge-Kutta integrator with its gradually accumulating error should still yield better results than the second-order velocity verlet if the integrated time is not too long, simply because the error is considerably smaller in the first place (due to the method being of higher order).\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-05-07T20:16:32Z\u0022 title=\u002205/07/2015 08:16  PM\u0022 data-short=\u00229 yr\u0022\u003EMay 7, 2015\u003C/time\u003E by Meithan\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"K^2","CreatedById":57710,"CreatedDateTime":"2015-05-07T20:32:51Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Meithan\u0022 data-cite=\u0022Meithan\u0022\u003E\u003Cdiv\u003EIf the integrator is \u003Cem\u003Esymplectic\u003C/em\u003E, and the velocity verlet is an example of one, then by design the energy errors should be bounded and quasi-periodic, and not add up over time -- that\u0027s the beauty of symplectic integrators. See the \u003Ca href=\u0022http://i.imgur.com/NN8SlT7.png\u0022 rel=\u0022external nofollow\u0022\u003Eenergy error graph\u003C/a\u003E I posted earlier: the energy fluctuates almost periodically (the \u0022main\u0022 oscillation seems to have a period very similar to that of Mercury, about 1/4th of year) but the error never becomes greater than 10^-9 -- and in principle this would hold for indefinitely long periods of time.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EVerlet is \u003Cem\u003Enot\u003C/em\u003E symplectic with 1/r potential. No known method is. Verlet is symplectic with r\u00C3\u201A\u00C2\u00B2 potential, such as Hooke\u0027s law used in collisions, which is why it\u0027s a favorite in game dev. But no method is symplectic for all potential types.\u003C/p\u003E\n"}]}