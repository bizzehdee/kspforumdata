{"TopicId":81327,"ForumId":29,"TopicTitle":"Editing persistent.sfs","CreatedByName":"Jetwave","CreatedById":97965,"CreatedDateTime":"2014-08-10T16:19:08Z","PageNum":1,"Articles":[{"CreatedByName":"Jetwave","CreatedById":97965,"CreatedDateTime":"2014-08-10T16:19:08Z","Content":"\n\u003Cp\u003EHi all,\u003C/p\u003E\u003Cp\u003EI am currently working on a mod which (in theory) should allow players to create a kerbal from within the game, then let them add him to their crew. In order to do this, I need to be able to access the persistent.sfs file found in the save that the player is currently using, and then add in the kerbal. Problem is, I don\u0027t know how to access and edit the persistent.sfs file using my plugin. I have this code which works, but how would I be able to make it take the values and add them to persistent.sfs?\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E              if (GUI.Button(new Rect(7, 125, 150, 30), \u0022Kreate Kustom Kerbal\u0022))\u003Cbr\u003E              {\u003Cbr\u003E                  Debug.Log(\u0022Kustom Kerbal Kreated.\u0022);\u003Cbr\u003E                  Debug.Log(\u0022Name: \u0022 \u002B stringToEdit);\u003Cbr\u003E                  Debug.Log(\u0022Courage: \u0022 \u002B sliderValue);\u003Cbr\u003E                  Debug.Log(\u0022Stupidity: \u0022 \u002B sliderValue2);\u003Cbr\u003E                  Debug.Log(\u0022Badass: \u0022 \u002B buttonState);\u003Cbr\u003E                //KERBAL\u003Cbr\u003E\t\t        //{\u003Cbr\u003E\t\t        //\tname = stringToEdit\u003Cbr\u003E\t\t        //\ttype = Crew\u003Cbr\u003E\t\t        //\tbrave = sliderValue\u003Cbr\u003E\t\t        //\tdumb = sliderValue2\u003Cbr\u003E\t\t        //\tbadS = buttonState\u003Cbr\u003E\t\t        //\tstate = Available\u003Cbr\u003E\t\t        //\tToD = 0\u003Cbr\u003E\t\t        //\tidx = -1\u003Cbr\u003E                //      }\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EAlso, is there any way to make it so that the player can\u0027t click buildings that are under the window? The way I have it now, you have to grab a corner then move it away from the buildings to be able to edit the fields.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-08-10T17:55:27Z\u0022 title=\u002208/10/2014 05:55  PM\u0022 data-short=\u00229 yr\u0022\u003EAugust 10, 2014\u003C/time\u003E by Jetwave\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"stupid_chris","CreatedById":62017,"CreatedDateTime":"2014-08-10T21:24:42Z","Content":"\n\u003Cp\u003EJust get the full URL of the persistence file and load it with ConfigNode.Load(node). You can find the current name of the save folder in HighLogic.currentGame iirc, and the rest can be done with System.IO. As for not clicking through, I don\u0027T think you can. The editor has this feature, but I don\u0027t think it\u0027s implemented in the space center, and you might have to do GUI shennanigans for it to work.\u003C/p\u003E\n"},{"CreatedByName":"Mr Shifty","CreatedById":68146,"CreatedDateTime":"2014-08-10T21:29:59Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Jetwave\u0022 data-cite=\u0022Jetwave\u0022\u003E\u003Cdiv\u003EAlso, is there any way to make it so that the player can\u0027t click buildings that are under the window? The way I have it now, you have to grab a corner then move it away from the buildings to be able to edit the fields.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI think [thread=69310]KCT[/thread] manages this. You could look at that code.\u003C/p\u003E\n"},{"CreatedByName":"Jetwave","CreatedById":97965,"CreatedDateTime":"2014-08-10T23:41:05Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022stupid_chris\u0022 data-cite=\u0022stupid_chris\u0022\u003E\u003Cdiv\u003EJust get the full URL of the persistence file and load it with ConfigNode.Load(node). You can find the current name of the save folder in HighLogic.currentGame iirc, and the rest can be done with System.IO. As for not clicking through, I don\u0027T think you can. The editor has this feature, but I don\u0027t think it\u0027s implemented in the space center, and you might have to do GUI shennanigans for it to work.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ESo I would do ConfigNode.Load(HighLogic.currentGame*persistence file*)? If so what do I put to make it load the persistence file?\u003C/p\u003E\u003Cp\u003EAlso, would something similar to this work?\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Eusing System.IO;\u003Cbr\u003Eusing UnityEngine;\u003Cbr\u003E\u003Cbr\u003Epublic static class File\u003Cbr\u003E\u003Cbr\u003Epublic static StreamWriter AppendText(ConfigNode.Load(HighLogic.CurrentGame*persistence file*))\u003Cbr\u003E{\u003Cbr\u003E        if (createKerbal == true) //boolean set to true when player clicks create\u003Cbr\u003E        {\u003Cbr\u003E            StreamWriter\u003Cbr\u003E            {\u003Cbr\u003E               KERBAL\u003Cbr\u003E               {\u003Cbr\u003E           \tname = stringToEdit\u003Cbr\u003E            \ttype = Crew\u003Cbr\u003E           \tbrave = sliderValue\u003Cbr\u003E            \tdumb = sliderValue2\u003Cbr\u003E            \tbadS = buttonState\u003Cbr\u003E             \tstate = Available\u003Cbr\u003E             \tToD = 0\u003Cbr\u003E              \tidx = -1\u003Cbr\u003E                }\u003Cbr\u003E            }\u003Cbr\u003E        createKerbal = false;\u003Cbr\u003E        }\u003Cbr\u003E}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EWhat I\u0027m thinking with this is that it\u0027ll go in the extensions folder of my plugin as a new class, and whenever the player hits the create button, the createKerbal bool will be set to true, thus activating the code. Then once it\u0027s done copying to persistence.sfs, it\u0027ll set the bool to false again, until the player clicks create. Is that what will actually happen?\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-08-10T23:45:36Z\u0022 title=\u002208/10/2014 11:45  PM\u0022 data-short=\u00229 yr\u0022\u003EAugust 10, 2014\u003C/time\u003E by Jetwave\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"stupid_chris","CreatedById":62017,"CreatedDateTime":"2014-08-11T00:01:20Z","Content":"\n\u003Cp\u003ENo that wouldn\u0027t work.\u003C/p\u003E\u003Cp\u003EFirst off, as I said you need the /full/ path. Not the local path.\u003C/p\u003E\u003Cp\u003ESecond, you\u0027ll want to add stuff to confignodes, and I recommend you learn how they work to start with. I reccomend a trip to #kspmodders for that, though I might be too asleep to be able to guide you around correctly. Someone might be able to help though.\u003C/p\u003E\n"},{"CreatedByName":"Jetwave","CreatedById":97965,"CreatedDateTime":"2014-08-11T00:17:15Z","Content":"\n\u003Cp\u003EWouldn\u0027t the path be different for different people though? Like wouldn\u0027t using steam vs using the launcher have different paths, and different OSes, whether the OS is x64 or x86, if the player uses a custom path.. etc.?\u003C/p\u003E\n"},{"CreatedByName":"stupid_chris","CreatedById":62017,"CreatedDateTime":"2014-08-11T01:28:19Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Jetwave\u0022 data-cite=\u0022Jetwave\u0022\u003E\u003Cdiv\u003EWouldn\u0027t the path be different for different people though? Like wouldn\u0027t using steam vs using the launcher have different paths, and different OSes, whether the OS is x64 or x86, if the player uses a custom path.. etc.?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThat\u0027s why you should fetch the path, and don\u0027t try to guess it? \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif\u0022 alt=\u0022:P\u0022\u003E\u003C/p\u003E\u003Cp\u003EKSPUtil.ApplicationRootPath will return the full path to the KSP folder, but there\u0027s many ways to do it. You can do Assembly.GetExecutingAssembly().Location to get the path directly to your plugin folder, etc. C# is very well documented, googling any question not related to KSP will usually give you a nice answer easily.\u003C/p\u003E\n"},{"CreatedByName":"Jetwave","CreatedById":97965,"CreatedDateTime":"2014-08-11T02:11:45Z","Content":"\n\u003Cp\u003EEDIT: nvm, figured it out. I was thinking you meant the website ksp modders, but I found the IRC\u003C/p\u003E\u003Cp\u003EAlso was I using AppendText correctly in my earlier post?\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-08-11T02:16:18Z\u0022 title=\u002208/11/2014 02:16  AM\u0022 data-short=\u00229 yr\u0022\u003EAugust 11, 2014\u003C/time\u003E by Jetwave\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"stupid_chris","CreatedById":62017,"CreatedDateTime":"2014-08-11T02:14:56Z","Content":"\n\u003Cp\u003EI did mean IRC. And yeah, because that would append it to the bottom of the file which is not what you want. As I said, you\u0027ll want to use ConfigNodes, not streamwriter.\u003C/p\u003E\n"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2014-08-12T09:18:27Z","Content":"\n\u003Cp\u003EWhy editing the save ? There are API call to edit the Crew roster. Looks into Crew Manifest code it does exactly what you want to do.\u003C/p\u003E\n"}]}