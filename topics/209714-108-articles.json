{"TopicId":209714,"ForumId":34,"TopicTitle":"[1.12.x] Parallax - PBR Terrain and Surface Objects [2.0.7]","CreatedByName":"Gameslinx","CreatedById":144828,"CreatedDateTime":"2020-09-20T17:22:22Z","PageNum":108,"Articles":[{"CreatedByName":"NaviG","CreatedById":225537,"CreatedDateTime":"2023-03-25T21:39:32Z","Content":"\n\u003Cp\u003E\n\u003Cu\u003E\u003Cstrong\u003ERequest:\u003C/strong\u003E\u003C/u\u003E Add rings to some planets with generated scatterers. I think it achievable with this mod?\u003Cbr\u003E\n\u003Cimg alt=\u002200ac3d29467ec946ab3cb8e6471127d3.jpg\u0022 class=\u0022ipsImage\u0022 data-ratio=\u002256.14\u0022 height=\u0022393\u0022 width=\u0022700\u0022 src=\u0022https://i.pinimg.com/736x/00/ac/3d/00ac3d29467ec946ab3cb8e6471127d3.jpg\u0022\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u0022Planet Satur with meteorite ring Digital Art by Viktoria Ruban - Fine Art  America\u0022 data-ratio=\u002252.78\u0022 width=\u0022900\u0022 src=\u0022https://images.fineartamerica.com/images/artworkimages/mediumlarge/3/planet-satur-with-meteorite-ring-viktoria-ruban.jpg\u0022\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u00224584061 planet, asteroid, space, digital art, planetary rings, space art -  Rare Gallery HD Wallpapers\u0022 data-ratio=\u002287.50\u0022 width=\u00221200\u0022 src=\u0022https://rare-gallery.com/uploads/posts/4595605-joeyjazz-spacescapes-space-moon-world-asteroid-space-art-planetary-rings-digital-art.jpg\u0022\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"Invaderdave","CreatedById":167495,"CreatedDateTime":"2023-03-26T05:27:58Z","Content":"\n\u003Cp\u003E\nNow that I\u0027m back on windows (I suck @ linux) and can install mods correctly again, I can\u0027t say enough about how incredible this mod is. But I\u0027m currently experiencing a thing where only a large circle of the surface of the Mun is visible from low orbit (under 40km).\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cbr\u003E\n\u003Ca href=\u0022https://youtu.be/EHG3z73m3Yc\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://youtu.be/EHG3z73m3Yc\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cs\u003EAs far as I can tell it only is happening on the Mun\u003C/s\u003E.\u00A0 Something similar is happening on Kerbin, where the \u003Ca href=\u0022https://youtu.be/KmCpj7DclfU\u0022 rel=\u0022external nofollow\u0022\u003Etextures dissapear beyond a certain radius, but the planet is still visible\u003C/a\u003E.\n\u003C/p\u003E\n\u003Cp\u003E\nAny ideas?\n\u003C/p\u003E\n\u003Cp\u003E\nlog file:\u00A0\u003Ca href=\u0022https://www.dropbox.com/s/j05p12fnk2m7p6p/KSPlog326.txt?dl=0\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://www.dropbox.com/s/j05p12fnk2m7p6p/KSPlog326.txt?dl=0\u003C/a\u003E\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222023-03-26T19:50:01Z\u0022 title=\u002203/26/2023 07:50  PM\u0022 data-short=\u00221 yr\u0022\u003EMarch 26, 2023\u003C/time\u003E by Invaderdave\u003C/strong\u003E\n\u003Cbr\u003Etrying to figure out how to embed video \u0026amp; added Kerbin footage \u0026amp; added log file link\n\u003C/span\u003E\n"},{"CreatedByName":"Czejenesku","CreatedById":227280,"CreatedDateTime":"2023-03-27T14:59:43Z","Content":"\n\u003Cp\u003E\nIs there a way to turn off collision just for grass on Kerbin? All my experiment sounding rockets I send over biomes explode on hit.\n\u003C/p\u003E\n"},{"CreatedByName":"Gameslinx","CreatedById":144828,"CreatedDateTime":"2023-03-30T01:29:44Z","Content":"\n\u003Cp\u003E\n\u003Cstrong\u003E\u003Cspan style=\u0022font-size:18px;\u0022\u003EDevelopment Update - Performance\u003C/span\u003E\u003C/strong\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cspan style=\u0022font-size:18px;\u0022\u003E\u003Cstrong\u003EVRAM\u003C/strong\u003E\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nHey all, I\u0027ve been spending some time working on the features I outlined in the last update (\u003Ca href=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/209714-112x-parallax-pbr-terrain-and-surface-objects-202/\u0026amp;do=findComment\u0026amp;comment=4257019\u0022 rel=\u0022\u0022\u003Ehttps://forum.kerbalspaceprogram.com/index.php?/topic/209714-112x-parallax-pbr-terrain-and-surface-objects-202/\u0026amp;do=findComment\u0026amp;comment=4257019\u003C/a\u003E).\n\u003C/p\u003E\n\u003Cp\u003E\nEssentially I am rewriting a core portion of the mod responsible for object placement in order to switch from world space to local space in order to fix many key positioning issues that can arise in the mod, such as the floating trees. I have also made an estimated reduction in VRAM usage of 56%. At least, this is the VRAM usage of the generated objects on all built quads within range before they are evaluated by the culling compute shader.\n\u003C/p\u003E\n\u003Cp\u003E\nBefore, I would compute the localToWorld matrix immediately and store these ready for the culling shader to process them and output the objects in range. This matrix is 16* 4 bytes. Now that the system works in local space, I only need to store the local position, rotation and scale as a float3, float and float3 (7 * 4 bytes). The culling shader now does a little extra work to construct the localToWorld matrix every frame, but this isn\u0027t too expensive to do. More testing - and in-game - will tell me more. But for now, this is looking promising.\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cspan style=\u0022font-size:18px;\u0022\u003E\u003Cstrong\u003EFPS\u003C/strong\u003E\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cstrong\u003EI am able to make an approx 4x reduction in performance impact with shadows enabled.\u00A0\u003C/strong\u003EA fun drawback of Unity\u0027s DrawMeshInstancedIndirect function is that it draws the mesh in all shader passes in\u00A0\u003Cstrong\u003Eall shadow cascades\u003C/strong\u003E. A shadow cascade is a region of shadow based on distance from the camera of varying quality. Further away objects will use a lower quality shadow map - a higher shadow cascade. With 4 shadow cascades, each object is rendered once for the scene and one additional time for each shadow cascade. This leads to rendering the object 4 times when it only lies in one shadow cascade.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nI have some preliminary but not perfect code in place to differentiate Parallax objects into 4 regions based on which shadow cascade those objects lie in. Each set of objects are drawn using a command buffer before each relevant shadow cascade renders. This means that most objects will be drawn just once for the shadow pass, and very few will be drawn twice if it lies within two cascades.\n\u003C/p\u003E\n\u003Cp\u003E\nQuick note - This technique will reduce the number of vertices rendered by around 75%.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cstrong\u003EIn a unity test scene with this code and a lot of objects, frame time changed from 17ms (58fps) to 4.4ms (227 fps) which is roughly a 4x increase in performance.\u003C/strong\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nI am looking forward to sharing more with you all soon!\n\u003C/p\u003E\n"},{"CreatedByName":"ShadowDr","CreatedById":227130,"CreatedDateTime":"2023-03-30T14:26:06Z","Content":"\n\u003Cp\u003E\nHuh, does it mean that Unity\u0027s own code is somewhat cheeks shaped?\n\u003C/p\u003E\n"},{"CreatedByName":"Gameslinx","CreatedById":144828,"CreatedDateTime":"2023-03-30T16:14:05Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00224267359\u0022 data-ipsquote-contentid=\u0022209714\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221680186366\u0022 data-ipsquote-userid=\u0022227130\u0022 data-ipsquote-username=\u0022ShadowDr\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n1 hour ago, ShadowDr said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nHuh, does it mean that Unity\u0027s own code is somewhat cheeks shaped?\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nIt could be. But DrawMeshInstancedIndirect appears to be a much lower-level command in that it\u0027s very specific and very direct \u0022draw this here now\u0022.\n\u003C/p\u003E\n\u003Cp\u003E\nI am really struggling to figure out how to correctly identify which shadow cascade an object is. I assumed it was camera distance based, but it\u0027s not in world space coordinates. Anyone with the know-how would be much appreciated, lol\n\u003C/p\u003E\n"},{"CreatedByName":"Miza","CreatedById":26784,"CreatedDateTime":"2023-03-30T23:48:14Z","Content":"\n\u003Cp\u003E\n[snip]\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222023-03-31T00:34:28Z\u0022 title=\u002203/31/2023 12:34  AM\u0022 data-short=\u00221 yr\u0022\u003EMarch 31, 2023\u003C/time\u003E by Miza\u003C/strong\u003E\n\u003Cbr\u003EMay have solved problem.\n\u003C/span\u003E\n"},{"CreatedByName":"UltraJohn","CreatedById":15008,"CreatedDateTime":"2023-03-31T23:26:01Z","Content":"\n\u003Cp\u003E\nI am curious if this new update will improve the performance and density on rescaled systems?\n\u003C/p\u003E\n\u003Cp\u003E\nRight now on a 10x rescale, I\u0027m having to increase the densityMultiplier to 100 (according to other posts) to get the same density as normal. Though any value higher than 40 or so will just crash my game, presumably because of running out of ram. Also increases load times by a large factor and seems to cause microstutters.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222023-03-31T23:26:39Z\u0022 title=\u002203/31/2023 11:26  PM\u0022 data-short=\u00221 yr\u0022\u003EMarch 31, 2023\u003C/time\u003E by UltraJohn\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Gameslinx","CreatedById":144828,"CreatedDateTime":"2023-04-01T00:13:17Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00224267832\u0022 data-ipsquote-contentid=\u0022209714\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221680305161\u0022 data-ipsquote-userid=\u002215008\u0022 data-ipsquote-username=\u0022UltraJohn\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n45 minutes ago, UltraJohn said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nI am curious if this new update will improve the performance and density on rescaled systems?\n\u003C/p\u003E\n\u003Cp\u003E\nRight now on a 10x rescale, I\u0027m having to increase the densityMultiplier to 100 (according to other posts) to get the same density as normal. Though any value higher than 40 or so will just crash my game, presumably because of running out of ram. Also increases load times by a large factor and seems to cause microstutters.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nAbsolutely. Although I haven\u0027t yet to test ingame, the on-paper benefits are pretty big.\n\u003C/p\u003E\n\u003Cp\u003E\nSome things may be unavoidable. KSP wasn\u0027t designed to work well at large scales and I am trying to add cool new tech to a very old and technically inefficient game. I\u0027ll see what I can do but no promises! I imagine you will realistically be able to achieve a higher density before running out of memory, but who knows.\n\u003C/p\u003E\n"},{"CreatedByName":"UltraJohn","CreatedById":15008,"CreatedDateTime":"2023-04-01T00:21:26Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00224267844\u0022 data-ipsquote-contentid=\u0022209714\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221680307997\u0022 data-ipsquote-userid=\u0022144828\u0022 data-ipsquote-username=\u0022Gameslinx\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n1 minute ago, Gameslinx said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nAbsolutely. Although I haven\u0027t yet to test ingame, the on-paper benefits are pretty big.\n\u003C/p\u003E\n\u003Cp\u003E\nSome things may be unavoidable. KSP wasn\u0027t designed to work well at large scales and I am trying to add cool new tech to a very old and technically inefficient game. I\u0027ll see what I can do but no promises! I imagine you will realistically be able to achieve a higher density before running out of memory, but who knows.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nSounds great and I can\u0027t wait to try it out. Thanks for the work you\u0027re doing!\n\u003C/p\u003E\n"},{"CreatedByName":"ShadowDr","CreatedById":227130,"CreatedDateTime":"2023-04-01T04:52:27Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00224267832\u0022 data-ipsquote-contentid=\u0022209714\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221680305161\u0022 data-ipsquote-userid=\u002215008\u0022 data-ipsquote-username=\u0022UltraJohn\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n5 hours ago, UltraJohn said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nI am curious if this new update will improve the performance and density on rescaled systems?\n\u003C/p\u003E\n\u003Cp\u003E\nRight now on a 10x rescale, I\u0027m having to increase the densityMultiplier to 100 (according to other posts) to get the same density as normal. Though any value higher than 40 or so will just crash my game, presumably because of running out of ram. Also increases load times by a large factor and seems to cause microstutters.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nHelo there.\u003Cbr\u003E\nOther posts did a derp. Try decreasing rangeMultiplier instead, and leave the rest alone.\u003Cbr\u003E\nRange defines how far from you scatters appear, Density - how many of them appear in that range. In rescaled systems, range stretches with the planet and becomes gigantic. By increasing density, you fill all that gigantic range with dense scatters and it dies. What you want is to scale the range back down to intended level. Works and looks just as stock then.\u003Cbr\u003E\nBut there\u0027s a caviat, apparently \u003Cabbr title=\u0022Kerbal Space Center\u0022\u003EKSC\u003C/abbr\u003E area is meant to not have any trees in it, and on rescale it remains tree-free, so you\u0027ll only see the forests way out on horison\u003Cbr\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222023-04-01T04:54:38Z\u0022 title=\u002204/01/2023 04:54  AM\u0022 data-short=\u00221 yr\u0022\u003EApril 1, 2023\u003C/time\u003E by ShadowDr\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"UltraJohn","CreatedById":15008,"CreatedDateTime":"2023-04-01T13:18:50Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00224267886\u0022 data-ipsquote-contentid=\u0022209714\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221680324747\u0022 data-ipsquote-userid=\u0022227130\u0022 data-ipsquote-username=\u0022ShadowDr\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n8 hours ago, ShadowDr said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nHelo there.\u003Cbr\u003E\nOther posts did a derp. Try decreasing rangeMultiplier instead, and leave the rest alone.\u003Cbr\u003E\nRange defines how far from you scatters appear, Density - how many of them appear in that range. In rescaled systems, range stretches with the planet and becomes gigantic. By increasing density, you fill all that gigantic range with dense scatters and it dies. What you want is to scale the range back down to intended level. Works and looks just as stock then.\u003Cbr\u003E\nBut there\u0027s a caviat, apparently \u003Cabbr title=\u0022Kerbal Space Center\u0022\u003E\u003Cabbr title=\u0022Kerbal Space Center\u0022\u003EKSC\u003C/abbr\u003E\u003C/abbr\u003E area is meant to not have any trees in it, and on rescale it remains tree-free, so you\u0027ll only see the forests way out on horison\u003Cbr\u003E\n\u00A0\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nAh, I was wondering if that was the case about stretching further out, but seeing as they didn\u0027t mention it I thought it wasn\u0027t the case. Although I feel like the scatter range still looks normal at 10x rescale. I tried 0.1x range multiplier and trees literally spawn right in front of me, so I don\u0027t think that was the right value.\n\u003C/p\u003E\n\u003Cp\u003E\nWhat would I need to set the values to for a normal range and density at 10x rescaled planets?\n\u003C/p\u003E\n"},{"CreatedByName":"ShadowDr","CreatedById":227130,"CreatedDateTime":"2023-04-01T16:44:22Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00224267949\u0022 data-ipsquote-contentid=\u0022209714\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221680355130\u0022 data-ipsquote-userid=\u002215008\u0022 data-ipsquote-username=\u0022UltraJohn\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n3 hours ago, UltraJohn said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nAh, I was wondering if that was the case about stretching further out, but seeing as they didn\u0027t mention it I thought it wasn\u0027t the case. Although I feel like the scatter range still looks normal at 10x rescale. I tried 0.1x range multiplier and trees literally spawn right in front of me, so I don\u0027t think that was the right value.\n\u003C/p\u003E\n\u003Cp\u003E\nWhat would I need to set the values to for a normal range and density at 10x rescaled planets?\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nErrr i would say just experiment with range, density and your framerate and find whatever works well for you.\u003Cbr\u003E\nFirst find a range that satisfies you, then tweak density until it looks as you wish. If runs like crap, decrease range further.\u003Cbr\u003E\nI personally try to decrease the default density significantly, as on default every moon\u0027s surface is impassable rubble field - not good for playability. Makes Kerbin trees scarce as a drawback.\u003Cbr\u003E\nCurrently tweaking it for ~3.5 scale, so can\u0027t offer nice numbers\u003Cbr\u003E\n\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"NaviG","CreatedById":225537,"CreatedDateTime":"2023-04-02T10:36:08Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00224267207\u0022 data-ipsquote-contentid=\u0022209714\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221680139784\u0022 data-ipsquote-userid=\u0022144828\u0022 data-ipsquote-username=\u0022Gameslinx\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nOn 3/30/2023 at 3:29 AM, Gameslinx said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\n\u003Cstrong\u003E\u003Cspan style=\u0022font-size:18px;\u0022\u003EDevelopment Update - Performance\u003C/span\u003E\u003C/strong\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cspan style=\u0022font-size:18px;\u0022\u003E\u003Cstrong\u003EVRAM\u003C/strong\u003E\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nHey all, I\u0027ve been spending some time working on the features I outlined in the last update (\u003Ca href=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/209714-112x-parallax-pbr-terrain-and-surface-objects-202/\u0026amp;do=findComment\u0026amp;comment=4257019\u0022 rel=\u0022\u0022\u003Ehttps://forum.kerbalspaceprogram.com/index.php?/topic/209714-112x-parallax-pbr-terrain-and-surface-objects-202/\u0026amp;do=findComment\u0026amp;comment=4257019\u003C/a\u003E).\n\u003C/p\u003E\n\u003Cp\u003E\nEssentially I am rewriting a core portion of the mod responsible for object placement in order to switch from world space to local space in order to fix many key positioning issues that can arise in the mod, such as the floating trees. I have also made an estimated reduction in VRAM usage of 56%. At least, this is the VRAM usage of the generated objects on all built quads within range before they are evaluated by the culling compute shader.\n\u003C/p\u003E\n\u003Cp\u003E\nBefore, I would compute the localToWorld matrix immediately and store these ready for the culling shader to process them and output the objects in range. This matrix is 16* 4 bytes. Now that the system works in local space, I only need to store the local position, rotation and scale as a float3, float and float3 (7 * 4 bytes). The culling shader now does a little extra work to construct the localToWorld matrix every frame, but this isn\u0027t too expensive to do. More testing - and in-game - will tell me more. But for now, this is looking promising.\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cspan style=\u0022font-size:18px;\u0022\u003E\u003Cstrong\u003EFPS\u003C/strong\u003E\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cstrong\u003EI am able to make an approx 4x reduction in performance impact with shadows enabled.\u00A0\u003C/strong\u003EA fun drawback of Unity\u0027s DrawMeshInstancedIndirect function is that it draws the mesh in all shader passes in\u00A0\u003Cstrong\u003Eall shadow cascades\u003C/strong\u003E. A shadow cascade is a region of shadow based on distance from the camera of varying quality. Further away objects will use a lower quality shadow map - a higher shadow cascade. With 4 shadow cascades, each object is rendered once for the scene and one additional time for each shadow cascade. This leads to rendering the object 4 times when it only lies in one shadow cascade.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nI have some preliminary but not perfect code in place to differentiate Parallax objects into 4 regions based on which shadow cascade those objects lie in. Each set of objects are drawn using a command buffer before each relevant shadow cascade renders. This means that most objects will be drawn just once for the shadow pass, and very few will be drawn twice if it lies within two cascades.\n\u003C/p\u003E\n\u003Cp\u003E\nQuick note - This technique will reduce the number of vertices rendered by around 75%.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cstrong\u003EIn a unity test scene with this code and a lot of objects, frame time changed from 17ms (58fps) to 4.4ms (227 fps) which is roughly a 4x increase in performance.\u003C/strong\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nI am looking forward to sharing more with you all soon!\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nwow, can\u0027t wait!!\n\u003C/p\u003E\n"},{"CreatedByName":"kowkillar","CreatedById":100238,"CreatedDateTime":"2023-04-04T08:05:56Z","Content":"\n\u003Cp\u003E\nHow long should it take to load ksp with this? I\u0027ve been loading for a while now.\n\u003C/p\u003E\n"},{"CreatedByName":"Dafni","CreatedById":149636,"CreatedDateTime":"2023-04-04T08:40:12Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00224268804\u0022 data-ipsquote-contentid=\u0022209714\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221680595556\u0022 data-ipsquote-userid=\u0022100238\u0022 data-ipsquote-username=\u0022kowkillar\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n30 minutes ago, kowkillar said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nHow long should it take to load ksp with this? I\u0027ve been loading for a while now.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nDepends on your hardware. But for what it\u0027s worth, on my system (which is a 5yr old rig now) Parallax does not really make a noticeable difference in load-up times. You can see how much it takes to load up all the different parts and textures, and the Parallax files flash through in a snap on my dated system here. (not running the colliders though, never tried them yet)\n\u003C/p\u003E\n"},{"CreatedByName":"cosekantphi","CreatedById":191755,"CreatedDateTime":"2023-04-05T06:06:29Z","Content":"\n\u003Cp\u003E\nI tried parallax on an \u003Cabbr title=\u0022Real Solar System (mod)\u0022\u003E\u003Cabbr title=\u0022Real Solar System (mod)\u0022\u003ERSS\u003C/abbr\u003E\u003C/abbr\u003E install on my low to mid end laptop with an igpu just to get a feel for the performance impact, fully expecting it to either run at\u00A0 5fps or immediately crash. I was extremely pleasantly surprised!\n\u003C/p\u003E\n\u003Cp\u003E\nI didn\u0027t try it with ground scatters, I only had the terrain shader quality setting on high, not ultra. After taking a quick peek at the moon and Mars, I found they looked much better without too bad of a performance hit. Running the game at 720p, I went from maybe 40 to 45 fps down to around 35-ish.\n\u003C/p\u003E\n\u003Cp\u003E\nBut the most important thing I noticed is that somehow parallax enables craft shadows even with the render quality set to fastest. In the stock game, shadows are locked to simple or above. And despite the shadows looking like trash on simple, the setting absolutely obliterates my FPS. I thought this was specific to shadows specifically since not much else seems to change when I increase the render quality.\n\u003C/p\u003E\n\u003Cp\u003E\nBut with Parallax, I have decent shadows enabled on the fastest render setting without any noticeable drop in performance at all. Had no idea that my machine was capable of it. I went from thinking I\u0027d be giving parallax a quick try just messing around with it to making it a mainstay of my modded install just for the sake of shadows alone. I think the \u003Cabbr title=\u00221. Original Post(er). The first post in a thread, or the person who posted it. 2. Overpowered. A part or mechanic that upsets game balance by being too powerful.\u0022\u003E\u003Cabbr title=\u00221. Original Post(er). The first post in a thread, or the person who posted it. 2. Overpowered. A part or mechanic that upsets game balance by being too powerful.\u0022\u003EOP\u003C/abbr\u003E\u003C/abbr\u003E should probably mention this for the sake of people with lower end systems, I wish I had given it a try a lot sooner. This was a nigh magical experience, and I\u0027d like to thank Gameslinx for the massive amount of effort put into this mod.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222023-04-05T06:10:41Z\u0022 title=\u002204/05/2023 06:10  AM\u0022 data-short=\u00221 yr\u0022\u003EApril 5, 2023\u003C/time\u003E by cosekantphi\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"kowkillar","CreatedById":100238,"CreatedDateTime":"2023-04-05T07:11:36Z","Content":"\n\u003Cp\u003E\nI cant seem to get this to run. No crash or error popups the game just never loads.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nlog\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://drive.google.com/file/d/1FFXdMKl2ffJld32KdMfjMZhmSxKKOBmf/view?usp=share_link\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://drive.google.com/file/d/1FFXdMKl2ffJld32KdMfjMZhmSxKKOBmf/view?usp=share_link\u003C/a\u003E\n\u003C/p\u003E\n"},{"CreatedByName":"kowkillar","CreatedById":100238,"CreatedDateTime":"2023-04-07T00:13:53Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00224269117\u0022 data-ipsquote-contentid=\u0022209714\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221680678696\u0022 data-ipsquote-userid=\u0022100238\u0022 data-ipsquote-username=\u0022kowkillar\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nOn 4/5/2023 at 2:11 AM, kowkillar said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nI cant seem to get this to run. No crash or error popups the game just never loads.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nlog\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://drive.google.com/file/d/1FFXdMKl2ffJld32KdMfjMZhmSxKKOBmf/view?usp=share_link\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://drive.google.com/file/d/1FFXdMKl2ffJld32KdMfjMZhmSxKKOBmf/view?usp=share_link\u003C/a\u003E\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nAny help would be appreciated\n\u003C/p\u003E\n"},{"CreatedByName":"ShadowDr","CreatedById":227130,"CreatedDateTime":"2023-04-07T00:21:01Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00224269733\u0022 data-ipsquote-contentid=\u0022209714\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221680826433\u0022 data-ipsquote-userid=\u0022100238\u0022 data-ipsquote-username=\u0022kowkillar\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n7 minutes ago, kowkillar said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nAny help would be appreciated\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nAm not professional by any means, but..\u003Cbr\u003E\nSeems to have gajilions of new planets on top of stock ones. And it dies off after failing to process landscape features for several last of them. Can it be that you simply run out of RAM on load?\n\u003C/p\u003E\n\u003Cp\u003E\nAlso says there\u0027s no Parallax config for a bunch of them, perhaps some of those packs aren\u0027t compatible with Parallax.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222023-04-07T00:22:26Z\u0022 title=\u002204/07/2023 12:22  AM\u0022 data-short=\u00221 yr\u0022\u003EApril 7, 2023\u003C/time\u003E by ShadowDr\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"kowkillar","CreatedById":100238,"CreatedDateTime":"2023-04-07T02:54:59Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00224269735\u0022 data-ipsquote-contentid=\u0022209714\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221680826861\u0022 data-ipsquote-userid=\u0022227130\u0022 data-ipsquote-username=\u0022ShadowDr\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n2 hours ago, ShadowDr said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nAm not professional by any means, but..\u003Cbr\u003E\nSeems to have gajilions of new planets on top of stock ones. And it dies off after failing to process landscape features for several last of them. Can it be that you simply run out of RAM on load?\n\u003C/p\u003E\n\u003Cp\u003E\nAlso says there\u0027s no Parallax config for a bunch of them, perhaps some of those packs aren\u0027t compatible with Parallax.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nI\u0027m using grannus pack, but I tried without it and it still wouldn\u0027t load. Thanks for responding though.\n\u003C/p\u003E\n"},{"CreatedByName":"ShadowDr","CreatedById":227130,"CreatedDateTime":"2023-04-07T07:00:44Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00224269765\u0022 data-ipsquote-contentid=\u0022209714\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221680836099\u0022 data-ipsquote-userid=\u0022100238\u0022 data-ipsquote-username=\u0022kowkillar\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n4 hours ago, kowkillar said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nI\u0027m using grannus pack, but I tried without it and it still wouldn\u0027t load. Thanks for responding though.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nLet\u0027s try to dig. Will it load on completely bare install, only Parallax and dependencies? Can install via \u003Cabbr title=\u0022Comprehensive Kerbal Archive Network (a KSP mod manager)\u0022\u003ECKAN\u003C/abbr\u003E to be sure to not miss anything. That works, even though not mentioned here by author, thanks good people who did it\u003Cbr\u003E\nAlso what\u0027s your system specs, RAM and vRAM in particular?\u003Cbr\u003E\n\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"kowkillar","CreatedById":100238,"CreatedDateTime":"2023-04-07T09:23:06Z","Content":"\n\u003Cp\u003E\nI figured it out. Apparently having multiple versions of module manager are bad I removed all but the latest and now it works.\n\u003C/p\u003E\n"},{"CreatedByName":"suskey","CreatedById":228485,"CreatedDateTime":"2023-04-07T19:44:59Z","Content":"\n\u003Cp\u003E\ni always get the warning that i should put terrain quality to high/ultra, but i already have it set to high. how can i fix this?\n\u003C/p\u003E\n"},{"CreatedByName":"Czejenesku","CreatedById":227280,"CreatedDateTime":"2023-04-08T14:05:50Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00224270043\u0022 data-ipsquote-contentid=\u0022209714\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221680896699\u0022 data-ipsquote-userid=\u0022228485\u0022 data-ipsquote-username=\u0022suskey\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n18 hours ago, suskey said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\ni always get the warning that i should put terrain quality to high/ultra, but i already have it set to high. how can i fix this?\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nIt need to be on Ultra to use Tesselation. If not on Ultra it will always give you the warning.\u00A0\n\u003C/p\u003E\n"}]}