{"TopicId":102909,"ForumId":29,"TopicTitle":"KSP Plugin debugging and profiling for Visual Studio and Monodevelop on all OS","CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2015-03-29T11:09:00Z","PageNum":1,"Articles":[{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2015-03-29T11:09:00Z","Content":"Edit: Those instruction are partially outdated for KSP 1.8. Have a look at the post following [this one](https://forum.kerbalspaceprogram.com/index.php?/topic/102909-ksp-plugin-debugging-and-profiling-for-visual-studio-and-monodevelop-on-all-os/\u0026do=findComment\u0026comment=3688332) and specifically [this one](https://forum.kerbalspaceprogram.com/index.php?/topic/102909-ksp-plugin-debugging-and-profiling-for-visual-studio-and-monodevelop-on-all-os/\u0026do=findComment\u0026comment=3703964) if you are on Windows.\n\nAs we all know debugging plugin in KSP is mostly done with endless spam of Debug.Log or a bunch of custom windows we have to build. We also have [angavrilov method](https://forum.kerbalspaceprogram.com/threads/73586) but it require to recompile the whole mono and is a bit scary. So here is the result of a couple of days of experiment on my side to get a simple method working.\n\nSo how do we get debugging to work for KSP ? Simply by using the tool that unity provides us. Unity has a debugging system for games that runs in development mode, which is not the case of KSP by default.\n\nSo here is how to get that (Linux users read that part and I will explain the difference for you further down. OSX user read [this post](https://forum.kerbalspaceprogram.com/index.php?/topic/102909-ksp-plugin-debugging-and-profiling-for-visual-studio-and-monodevelop-on-all-os/\u0026do=findComment\u0026comment=3628143))\n\n**KSP**\n\n- First you need a [Unity installation](http://unity3d.com/get-unity/download/archive) (or [here](https://unity3d.com/fr/unity/qa/patch-releases) if the version ends with px) using the exact same version as your current KSP (For 1.1 you need Unity 5.2.4f1). That version is in the first line of the output\\_log.txt/Player.log.\n- Go to your Unity install for that version ( \u0022C:\\Program Files\\Unity\\Editor\u0022 most likely) and then go in the \u0022Data\\PlaybackEngines\\windowsstandalonesupport\\Variations\\win64\\_development\\_mono\u0022 sub-directory. Copy the \u0022player\\_win.exe\u0022 file to your KSP dev install (next to KSP.exe)\n- Rename that \u0022player\\_win.exe\u0022 to \u0022KSP\\_x64\\_Dbg.exe\u0022\n- Open a command prompt in that directory (shift right clic in the empty space of the explorer and select \u0022open command window here\u0022. In it enter the command \u0022mklink /J KSP\\_x64\\_Dbg\\_Data KSP\\_x64\\_Data\u0022. You will now have a KSP\\_x64\\_Dbg\\_Data that points to the stock KSP\\_x64\\_Data.\n- Get this [file](https://www.sarbian.com/sarbian/PlayerConnectionConfigFile) and put it in the KSP\\_x64\\_Data directory (it makes the mono debugger starts its listening port)\n\n- Launch KSP with the KSP\\_x64\\_Dbg.exe and check that you have \u0022Development Build\u0022 in your lower right corner\n- Get this [zip](https://www.sarbian.com/sarbian/pdb2mdb.zip) and put its content somewhere. For me it will be \u0022C:\\Games\\Tools\\pdb2mdb\u0022\n- If you compile with VS you have to generate the mono debug information. To generate them I add some command in the project post-build event command line. Here is what mine looks like for \u003Cabbr title=\u0022Mechjeb (mod)\u0022\u003EMJ\u003C/abbr\u003E\n\n    \u0022C:\\Games\\Tools\\pdb2mdb\\pdb2mdb.exe\u0022 \u0022$(TargetFileName)\u0022\n    xcopy /Y \u0022$(TargetPath)\u0022 \u0022C:\\Games\\ksp-win_dev\\GameData\\MechJeb2\\Plugins\\\u0022\n    xcopy /Y \u0022$(TargetDir)$(TargetName).pdb\u0022 \u0022C:\\Games\\ksp-win_dev\\GameData\\MechJeb2\\Plugins\\\u0022\n    xcopy /Y \u0022$(TargetDir)$(TargetName).dll.mdb\u0022 \u0022C:\\Games\\ksp-win_dev\\GameData\\MechJeb2\\Plugins\\\u0022\n\n- Compile your plugin in \u0022Debug\u0022 configuration to get the \u0022MyPlugin.dll\u0022 **AND** the \u0022MyPlugin.dll.mdb\u0022 (Generated with pdb2mdb from \u0022MyPlugin.pdb\u0022 if you use VS. Or by mono if you use MonoDevelop or mono cmd line). Copy them in your usual GameData dir if your post build command does not already do it\n\nWe are now ready on KSP side.\n\n**Visual Studio** \n\nYou need a version that allows plugin. So either a VS Pro\u002B or [Visual Studio Community](https://www.visualstudio.com/en-us/products/visual-studio-community-vs.aspx) (it is free and Unity most likely already installed it). Make sure you check the [Tools for Unity](https://www.visualstudio.com/features/unitytools-vs) and NET 3.5 options in the install.\n\nOnce you have that you will have a \u0022Attach Unity Debugger\u0022 in the Debug menu. So launch KSP and use that menu to attach VS to it. You should get an orange bar at the bottom of VS and the context should switch to debugging. You now have all the usual debugging tools (breakpoints, step by step, watches). You may want to activate \u0022exception support\u0022 to have a the debugger break on exception (Tools =\u003E Options =\u003E \u0022Tools for Unity\u0022 =\u003E \u0022Exception Support\u0022)\n\n**MonoDevelop**\n\nIn the \u0022Run\u0022 menu you have \u0022Attach to Process\u0022. It opens a windows where you should have \u0022Unity Debugger\u0022 selected on the lower part and you can select your KSP process to attach to. It should switch to the debugging context\n\n**Profiling**\n\nNow that KSP use Unity 5 we can use the Unity Profiler for free. Launch KSP in d\u00E9velopper mode and launch an empty Unity project. In the \u0022Window\u0022 menu select Profiler. The profiler opens and in the \u0022Active Profiler\u0022 at the top of the window you can select your running KSP instance. \n\nBy default you will only see the MonoBehavior methods (Update, FixedUpdate, ...) but you can add calls in your code to profile anything. First make sure your code is compiled with the \u0022ENABLE\\_PROFILER\u0022 conditional (add it in the build config). Then in your code add pairs of \u0022Profiler.BeginSample(\u0022MyLabel\u0022);\u0022 and \u0022Profiler.EndSample();\u0022. Be aware that if a frame take too long the profiler skip it, so you can\u0027t profile really slow method that last a single frame.An example from \u003Cabbr title=\u0022Mechjeb (mod)\u0022\u003EMJ\u003C/abbr\u003E : \n\n    Profiler.BeginSample(\u0022vesselState\u0022);\n    ready = vesselState.Update(vessel);\n    Profiler.EndSample();\n\nThe profiler will now show you info for this exact call somewhere in its hierarchy. (there is a search field to find it). \n\n![Profiler.png](https://www.sarbian.com/sarbian/Profiler.png)\n\nA warning : profiling is complex and result are often more complex to interpret than you may think.\n\n**Linux and OSX**\n\nThe steps are the same. The only difference is the directory where you get the executable. If you are on Linux you will just need to copy some files, so use a VM to install Unity or ask a friend.\n\n- OSX :  \u003Cunity.app\u003E/Contents/PlaybackEngines/MacStandaloneSupport/Variations/universal_development_mono/UnityPlayer.app\n\u003C/unity.app\u003E\n\n- Linux : \u003Cunity\u003E/Data/PlaybackEngines/linuxstandalonesupport/linux32_withgfx_development or linux64_withgfx_development. Get the LinuxPlayer file, copy it to your KSP install and rename it KSP.x86 or KSP.x86_64 depending on the directory you got it from and make sure you set it \u002Bx\n\u003C/unity\u003E\n\n**Missing Unity debugger for MonoDevelop (Custom install or Linux)**\n\nIf you installed MonoDevelop yourself you most likely do not have the Unity Debugger installed.\n\nGo in Tools-\u003EAddin Manager and install the Unity Soft Debugger addon\n\n(I did not test those steps so I would like some feedback)\n\n**Edited \u003Ctime datetime=\u00222019-11-18T21:02:21Z\u0022 title=\u002211/18/2019 09:02  PM\u0022 data-short=\u00224 yr\u0022\u003ENovember 18, 2019\u003C/time\u003E by sarbian**"},{"CreatedByName":"godarklight","CreatedById":92588,"CreatedDateTime":"2015-03-29T11:14:18Z","Content":"I for one welcome our new debugging overlord.\n\nThanks, may this type of code be gone forever!\n\n\u003E \n\u003E  private void ProcessNewVesselMessages()\n\u003E \n\u003E  {\n\u003E \n\u003E  int throwLine = 0;\n\u003E \n\u003E  try\n\u003E \n\u003E  {\n\u003E \n\u003E  throwLine = 1;\n\u003E \n\u003E  Dictionary\u003Cguid, double=\u0022\u0022\u003E removeList = new Dictionary\u003Cguid, double=\u0022\u0022\u003E();\u003C/guid,\u003E\u003C/guid,\u003E\n\u003E \n\u003E  throwLine = 2;\n\u003E \n\u003E  lock (vesselRemoveQueue)\n\u003E \n\u003E  {\n\u003E \n\u003E  throwLine = 3;\n\u003E \n\u003E  foreach (KeyValuePair\u003CGuid, Queue\u003Cvesselremoveentry\u003E\u003E vesselRemoveSubspace in vesselRemoveQueue)\u003C/vesselremoveentry\u003E\n\u003E \n\u003E  {\n\u003E \n\u003E  throwLine = 4;\n\u003E \n\u003E  while (vesselRemoveSubspace.Value.Count \u003E 0 ? (vesselRemoveSubspace.Value.Peek().planetTime \u003C Planetarium.GetUniversalTime()) : false)\n\u003E \n\u003E  {\n\u003E \n\u003E  throwLine = 5;\n\u003E \n\u003E  VesselRemoveEntry removeVessel = vesselRemoveSubspace.Value.Dequeue();\n\u003E \n\u003E  throwLine = 6;\n\u003E \n\u003E  RemoveVessel(removeVessel.vesselID, removeVessel.isDockingUpdate, removeVessel.dockingPlayer);\n\u003E \n\u003E  throwLine = 7;\n\u003E \n\u003E  removeList[removeVessel.vesselID] = removeVessel.planetTime;\n\u003E \n\u003E  throwLine = 8;\n\u003E \n\u003E  }\n\u003E \n\u003E  }\n\u003E \n\u003E  }\n\u003E \n\u003E  throwLine = 9;\n\u003E \n\u003E  foreach (KeyValuePair\u003Cstring, Queue\u003Ckerbalentry\u003E\u003E kerbalProtoSubspace in kerbalProtoQueue)\u003C/kerbalentry\u003E\n\u003E \n\u003E  {\n\u003E \n\u003E  throwLine = 10;\n\u003E \n\u003E  while (kerbalProtoSubspace.Value.Count \u003E 0 ? (kerbalProtoSubspace.Value.Peek().planetTime \u003C Planetarium.GetUniversalTime()) : false)\n\u003E \n\u003E  {\n\u003E \n\u003E  throwLine = 11;\n\u003E \n\u003E  KerbalEntry kerbalEntry = kerbalProtoSubspace.Value.Dequeue();\n\u003E \n\u003E  throwLine = 12;\n\u003E \n\u003E  LoadKerbal(kerbalEntry.kerbalNode);\n\u003E \n\u003E  throwLine = 13;\n\u003E \n\u003E  }\n\u003E \n\u003E  }\n\u003E \n\u003E  throwLine = 14;\n\u003E \n\u003E  foreach (KeyValuePair\u003CGuid, Queue\u003Cvesselprotoupdate\u003E\u003E vesselQueue in vesselProtoQueue)\u003C/vesselprotoupdate\u003E\n\u003E \n\u003E  {\n\u003E \n\u003E  throwLine = 15;\n\u003E \n\u003E  VesselProtoUpdate vpu = null;\n\u003E \n\u003E  throwLine = 16;\n\u003E \n\u003E  //Get the latest proto update\n\u003E \n\u003E  while (vesselQueue.Value.Count \u003E 0 ? (vesselQueue.Value.Peek().planetTime \u003C Planetarium.GetUniversalTime()) : false)\n\u003E \n\u003E  {\n\u003E \n\u003E  throwLine = 17;\n\u003E \n\u003E  VesselProtoUpdate newVpu = vesselQueue.Value.Dequeue();\n\u003E \n\u003E  throwLine = 18;\n\u003E \n\u003E  if (newVpu != null)\n\u003E \n\u003E  {\n\u003E \n\u003E  throwLine = 19;\n\u003E \n\u003E  //Skip any protovessels that have been removed in the future\n\u003E \n\u003E  if (removeList.ContainsKey(vesselQueue.Key) ? removeList[vesselQueue.Key] \u003C vpu.planetTime : true)\n\u003E \n\u003E  {\n\u003E \n\u003E  throwLine = 20;\n\u003E \n\u003E  vpu = newVpu;\n\u003E \n\u003E  throwLine = 21;\n\u003E \n\u003E  }\n\u003E \n\u003E  }\n\u003E \n\u003E  }\n\u003E \n\u003E  throwLine = 22;\n\u003E \n\u003E  //Apply it if there is any\n\u003E \n\u003E  if (vpu != null ? vpu.vesselNode != null : false)\n\u003E \n\u003E  {\n\u003E \n\u003E  throwLine = 23;\n\u003E \n\u003E  LoadVessel(vpu.vesselNode, vpu.vesselID);\n\u003E \n\u003E  throwLine = 24;\n\u003E \n\u003E  }\n\u003E \n\u003E  }\n\u003E \n\u003E  throwLine = 25;\n\u003E \n\u003E  foreach (KeyValuePair\u003CGuid, Queue\u003Cvesselupdate\u003E\u003E vesselQueue in vesselUpdateQueue)\u003C/vesselupdate\u003E\n\u003E \n\u003E  {\n\u003E \n\u003E  throwLine = 26;\n\u003E \n\u003E  VesselUpdate vu = null;\n\u003E \n\u003E  throwLine = 27;\n\u003E \n\u003E  if (vesselQueue.Value == null)\n\u003E \n\u003E  {\n\u003E \n\u003E  Debug.Log(\u0022LINE27THROW vesselQueue.Value is null!\u0022);\n\u003E \n\u003E  }\n\u003E \n\u003E  if (vesselQueue.Value.Count \u003E 0)\n\u003E \n\u003E  {\n\u003E \n\u003E  if (vesselQueue.Value.Peek() == null)\n\u003E \n\u003E  {\n\u003E \n\u003E  Debug.Log(\u0022LINE27THROW vesselQueue.Value.Peek() is null!\u0022);\n\u003E \n\u003E  continue;\n\u003E \n\u003E  }\n\u003E \n\u003E  }\n\u003E \n\u003E  //Get the latest position update\n\u003E \n\u003E  while (vesselQueue.Value.Count \u003E 0 ? (vesselQueue.Value.Peek().planetTime \u003C Planetarium.GetUniversalTime()) : false)\n\u003E \n\u003E  {\n\u003E \n\u003E  throwLine = 28;\n\u003E \n\u003E  vu = vesselQueue.Value.Dequeue();\n\u003E \n\u003E  throwLine = 29;\n\u003E \n\u003E  }\n\u003E \n\u003E  throwLine = 30;\n\u003E \n\u003E  //Apply it if there is any\n\u003E \n\u003E  if (vu != null)\n\u003E \n\u003E  {\n\u003E \n\u003E  throwLine = 31;\n\u003E \n\u003E  HackyInAtmoLoader.fetch.SetVesselUpdate(vesselQueue.Key, vu);\n\u003E \n\u003E  throwLine = 32;\n\u003E \n\u003E  vu.Apply();\n\u003E \n\u003E  throwLine = 33;\n\u003E \n\u003E  }\n\u003E \n\u003E  }\n\u003E \n\u003E  }\n\u003E \n\u003E  catch (Exception e)\n\u003E \n\u003E  {\n\u003E \n\u003E  DarkLog.Debug(\u0022VESSEL UPDATE THROW: Threw on line \u0022 \u002B throwLine \u002B \u0022, exception: \u0022 \u002B e);\n\u003E \n\u003E  }\n\u003E \n\u003E  }\n\u003E \n\u003E"},{"CreatedByName":"taniwha","CreatedById":57176,"CreatedDateTime":"2015-03-29T11:18:42Z","Content":"heh, I do similar with Debug.Log(\u0022a\u0022) b c d...\n\nbtw, for those compiling using gmcs (usually using Makefiles: just add -debug to the gmcs command line)."},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2015-03-29T13:14:02Z","Content":"Edited to show that the command line for the mdb generation must be launched from the dll dir (thanks ilo)"},{"CreatedByName":"ilo","CreatedById":130783,"CreatedDateTime":"2015-03-29T13:21:20Z","Content":"This will definitelly change and improve the addon development a lot! thank you Sarbian"},{"CreatedByName":"NathanKell","CreatedById":75006,"CreatedDateTime":"2015-03-29T18:46:32Z","Content":"Well dang, that\u0027s pretty awesome indeed! Kudos sarbian!"},{"CreatedByName":"Teknoman117","CreatedById":53200,"CreatedDateTime":"2015-03-29T22:15:06Z","Content":"Oh wow. This will be absolutely fantastic. So much better than that old project where you had to build a modified version of the Mono libraries. \n\nEdit: I\u0027m stupid. You linked the archives.\n\n- - - Updated - - -\n\nActually, could you email me the linux executables? I\u0027m in the middle of a project with Unity 4.6 and don\u0027t particularly want to risk breaking my dev environment by reverting Unity and then going back"},{"CreatedByName":"Teknoman117","CreatedById":53200,"CreatedDateTime":"2015-03-29T23:01:10Z","Content":"Okay, so, just my luck it doesn\u0027t work for me...\n\nDid everything you said, got the \u0022development version\u0022 watermark in the KSP window and everything. However, nothing happens when I try to attach to the process (I\u0027m guessing it failed to attach). However, it sometimes opens the developer console with a long list of the same message about failing to wait on a semaphore (something which seemed to be mentioned in angavrilov\u0027s commit log for his debugger. If i try to set a breakpoint anywhere, a couple seconds later mono pops up a dialog with \u0022Debug operation failed.\u0022 I verfied that in this case I hit attach before the connection timed out.\n\nThis is what the executable spits out for me as well.\n\n    Set current directory to /home/nathaniel/Projects/ksp/0.90.0Found path: /home/nathaniel/Projects/ksp/0.90.0/KSP.x86_64Mono path[0] = \u0027/home/nathaniel/Projects/ksp/0.90.0/KSP_Data/Managed\u0027Mono path[1] = \u0027/home/nathaniel/Projects/ksp/0.90.0/KSP_Data/Mono\u0027Mono config path = \u0027/home/nathaniel/Projects/ksp/0.90.0/KSP_Data/Mono/etc\u0027PlayerConnection initialized from /home/nathaniel/Projects/ksp/0.90.0/KSP_Data (debug = 0)PlayerConnection initialized network socket : 0.0.0.0 55502Multi-casting \u0022[IP] 192.168.1.69 [Port] 55502 [Flags] 3 [Guid] 661409256 [EditorId] 803286173 [Version] 1048832 [Id] LinuxPlayer(192.168.1.69) [Debug] 1\u0022 to [225.0.0.222:54997]...Waiting for connection from host on [192.168.1.69:55502]...Timed out. Continuing without host connection.Using monoOptions --debugger-agent=transport=dt_socket,embedding=1,defer=y,address=0.0.0.0:56256PlayerConnection already initialized - listening to [192.168.1.69:55502]\n\n**Edited \u003Ctime datetime=\u00222015-03-29T23:03:33Z\u0022 title=\u002203/29/2015 11:03  PM\u0022 data-short=\u00229 yr\u0022\u003EMarch 29, 2015\u003C/time\u003E by Teknoman117**"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2015-03-30T12:10:54Z","Content":"I am afraid I can\u0027t help much here. Others reported that it works for them on Linux. Try switching the mono lib for the one that angavrilov built, his fix may help and you should still get the easier debugging."},{"CreatedByName":"TriggerAu","CreatedById":57838,"CreatedDateTime":"2015-04-06T07:19:54Z","Content":"Excellent stuff Sarbian, worked first time for me - after I got the right Unity version (facepalm). Thanks heaps"},{"CreatedByName":"FreeThinker","CreatedById":117389,"CreatedDateTime":"2015-04-29T09:04:18Z","Content":"This should be a sticky"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2015-04-29T10:36:51Z","Content":"No point to sticky it since it does not seems to work with 1.0 (at least it did not in exp, I did not test with the release). I\u0027ll have a go at making it work again soonish since it is hard to got back to printing stuff once you had better.\n\n**Edited \u003Ctime datetime=\u00222015-04-29T10:43:57Z\u0022 title=\u002204/29/2015 10:43  AM\u0022 data-short=\u00229 yr\u0022\u003EApril 29, 2015\u003C/time\u003E by sarbian**"},{"CreatedByName":"Slother","CreatedById":142925,"CreatedDateTime":"2015-05-03T18:48:19Z","Content":"Has someone managed to get it working again?\n\nUsing the development version of the unity player causes a bunch of errors on startup and prevents ksp from starting up.\n\nI tried it on KSP version 1.0.2.842 with Unity version 4.6.4f1.\n\nError messages:\n\nSerialization depth limit exceeded at \u0027ThermalLink\u0027. There may be an object composition cycle in one or more of your serialized classes.\n\nSerialization depth limit exceeded at \u0027OcclusionData\u0027. There may be an object composition cycle in one or more of your serialized classes.\n\nand lots of these:\n\nArgumentException: PropertyToID can only be called from the main thread.\n\nConstructors and field initializers will be executed from the loading thread when loading a scene.\n\nDon\u0027t use this function in the constructor or field initializers, instead move initialization code to the Awake or Start function.\n\n at (wrapper managed-to-native) UnityEngine.Shader:PropertyToID (string)\n\n at HighLogic..cctor () [0x00000] in \u003Cfilename unknown=\u0022\u0022\u003E:0 \u003C/filename\u003E\n\nRethrow as TypeInitializationException: An exception was thrown by the type initializer for HighLogic"},{"CreatedByName":"TAz00","CreatedById":41667,"CreatedDateTime":"2015-05-06T09:39:52Z","Content":"Anyone get this to work with 1.0 yet?"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2015-05-06T12:29:52Z","Content":"No. I will post if I make it work, don\u0027t worry."},{"CreatedByName":"parachutingturtle","CreatedById":113739,"CreatedDateTime":"2015-05-06T13:03:43Z","Content":"I\u0027m getting the same kinds of errors as Slother ![:(](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_sad.gif)\n\nI was so excited when I saw this thread, what a bummer."},{"CreatedByName":"FW Industries","CreatedById":76529,"CreatedDateTime":"2015-05-07T22:29:21Z","Content":"Holy crap, I got it to work. I used Cecil to patch the assembly and fix the exceptions. Removed the static initializers and moved them to Awake() like the exceptions suggested. I still can\u0027t quite believe that actually worked.\n\nRun this in KSP\\_Data\\Managed, it will patch Assembly-CSharp.dll: [https://dl.dropboxusercontent.com/u/7121093/ksp-mods/KSP%5B1.0.2%5DKspDevModePatcher%5BMay07%5D.zip](https://dl.dropboxusercontent.com/u/7121093/ksp-mods/KSP%5B1.0.2%5DKspDevModePatcher%5BMay07%5D.zip)\n\nSource and license included.\n\nAfter that it just works as described in OP. The errors about deserialization with ThermalLink and OcclusionData are probably just red herrings. I get those even in release mode.\n\nThere were a few more exceptions that only popped up later in-game. So there might be a few more I didn\u0027t run into yet, but they can probably be fixed the same way."},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2015-05-07T22:50:17Z","Content":"I was just looking into doing that ! Great to see that it works. I know where the other change are needed and I ll have an other look tomorrow ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\nThanks !\n\nEdit : You missed MapView ModuleAblator PQSMod\\_MaterialQuadRelative SkySphereControl. I ll fix that ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\nThe deserialization errors are real problems but as you said they are in release too.\n\nEdit2 : I could not go to sleep with so near. Get the updated full [tool to patch the dll](https://www.sarbian.com/sarbian/KspDevModePatcher.zip).\n\nAgain many thanks to FW Industries ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\n**Edited \u003Ctime datetime=\u00222015-05-08T00:00:57Z\u0022 title=\u002205/08/2015 12:00  AM\u0022 data-short=\u00229 yr\u0022\u003EMay 8, 2015\u003C/time\u003E by sarbian**"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2015-05-08T11:27:10Z","Content":"I updated the patching exe again and it seems to work fine on my end now."},{"CreatedByName":"TAz00","CreatedById":41667,"CreatedDateTime":"2015-05-08T12:17:19Z","Content":"Amazing, testing asap. \n\nKSP loads into development build now on 1.0. \n\nCan\u0027t wait to test out when i get home. Attach unity debugger atleast connects in VSS.\n\n\\*Edit, my god, it\u0027s full of breakpoints ![:D](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif)\n\n**Edited \u003Ctime datetime=\u00222015-05-08T14:13:39Z\u0022 title=\u002205/08/2015 02:13  PM\u0022 data-short=\u00229 yr\u0022\u003EMay 8, 2015\u003C/time\u003E by TAz00**\n  \nTested it"},{"CreatedByName":"TAz00","CreatedById":41667,"CreatedDateTime":"2015-05-08T15:36:55Z","Content":"It sort of works alright. I did get an error whenever i try to step into this piece of code. I can break on the function call, but it errors out in the debug log as soon as you step into it. And code just continues without input. Until function breakpoint is triggered again.\n\n      private void CloneCurrentVessel()            {                Vessel original = FlightGlobals.ActiveVessel;                ProtoVessel pv = new ProtoVessel(original);                Guid vesselId = pv.vesselID;                //Offending line                 Vessel newVessel = FlightGlobals.Vessels.Where(i =\u003E i.protoVessel.vesselID.Equals(vesselId)).First();            }\n\n**[Exception]: TypeLoadException: Could not load type \u0027System.Func\u00602\u0027 from assembly \u0027mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089\u0027.**\n\nI\u0027ve tried compiling with the modified assembly and using the regular one. All in Visual Studio 2013 sp4.\n\n**Edited \u003Ctime datetime=\u00222015-05-08T15:56:20Z\u0022 title=\u002205/08/2015 03:56  PM\u0022 data-short=\u00229 yr\u0022\u003EMay 8, 2015\u003C/time\u003E by TAz00**\n  \nProcess of elimination found 1 line of code"},{"CreatedByName":"parachutingturtle","CreatedById":113739,"CreatedDateTime":"2015-05-08T16:19:51Z","Content":"hmmm, is this fix targeted at .NET 4.0 by any chance?\n\nI\u0027m getting this in my .NET 3.5 project:\n\n    warning MSB3258: The primary reference \u0022Assembly-CSharp, Version=1.0.0.0, Culture=neutral, processorArchitecture=MSIL\u0022 could not be resolved because it has an indirect dependency on the .NET Framework assembly \u0022mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089\u0022 which has a higher version \u00224.0.0.0\u0022 than the version \u00222.0.0.0\u0022 in the current target framework.\n\nand then a bunch of KSP types won\u0027t load\n\n    error CS0246: The type or namespace name \u0027PartModule\u0027 could not be found (are you missing a using directive or an assembly reference?)\n\n(etc etc.)\n\nIf I target .NET 4.0, it builds fine, but then KSP won\u0027t load my plugin.\n\nEDIT: recompiled the patcher for .net3.5 and it works like a charm ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\n**Edited \u003Ctime datetime=\u00222015-05-08T16:41:45Z\u0022 title=\u002205/08/2015 04:41  PM\u0022 data-short=\u00229 yr\u0022\u003EMay 8, 2015\u003C/time\u003E by parachutingturtle**\n  \nadded details"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2015-05-08T17:07:10Z","Content":"Strange I did not have that. But I rebuilt it for 3.5 and uploaded a new version anyway."},{"CreatedByName":"TAz00","CreatedById":41667,"CreatedDateTime":"2015-05-08T20:42:11Z","Content":"Seems to have fixed it. I was compiling for 4.0"},{"CreatedByName":"Slother","CreatedById":142925,"CreatedDateTime":"2015-05-09T02:16:27Z","Content":"I can confirm that the patch is working for me too, awesome stuff!"}]}