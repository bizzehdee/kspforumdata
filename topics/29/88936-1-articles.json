{"TopicId":88936,"ForumId":29,"TopicTitle":"Make code execute on new game start \u0026amp; on game loads","CreatedByName":"paul23","CreatedById":120544,"CreatedDateTime":"2014-10-30T12:59:29Z","PageNum":1,"Articles":[{"CreatedByName":"paul23","CreatedById":120544,"CreatedDateTime":"2014-10-30T12:59:29Z","Content":"\n\u003Cp\u003EWell simply as explained above: how can I make code execute when starting up a new (sandbox/science/carreer) game. And secondly: how to perform the code upon save game loading?\u003C/p\u003E\n"},{"CreatedByName":"MoreUmpf","CreatedById":117868,"CreatedDateTime":"2014-10-30T16:14:32Z","Content":"\n\u003Cp\u003EYou can assign your methods to \u003Ca href=\u0022http://anatid.github.io/XML-Documentation-for-the-KSP-API/class_game_events.html\u0022 rel=\u0022external nofollow\u0022\u003EGameEvents \u003C/a\u003Eto do this.\u003C/p\u003E\u003Cp\u003ETo add your mehtods to the GameEvents use this in your Start or Awake method:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003EGameEvents.onGameStateCreated.Add(new EventData\u0026lt;Game\u0026gt;.OnEvent(yourMethod1));\u003Cbr\u003EGameEvents.onGameStateLoad.Add(new EventData\u0026lt;ConfigNode\u0026gt;.OnEvent(yourMethod2));\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EYou should remove the methods in your OnDestroy method like this:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003EGameEvents.onGameStateCreated.Remove(new EventData\u0026lt;Game\u0026gt;.OnEvent(yourMethod1));\u003Cbr\u003EGameEvents.onGameStateLoad.Remove(new EventData\u0026lt;ConfigNode\u0026gt;.OnEvent(yourMethod2));\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EAt last you have to create the two methods yourMethod1(Game game) and yourMethod2(ConfigNode node), where \u0022game\u0022 and \u0022node\u0022 are the objects that the GameEvent returns.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-10-30T16:18:01Z\u0022 title=\u002210/30/2014 04:18  PM\u0022 data-short=\u00229 yr\u0022\u003EOctober 30, 2014\u003C/time\u003E by MoreUmpf\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Starwaster","CreatedById":71262,"CreatedDateTime":"2014-10-30T19:24:30Z","Content":"\n\u003Cp\u003EThat\u0027s some good information but I don\u0027t think it entirely answers his question. Unless I\u0027m misinterpreting, he also wants to detect when a new game was actually created for the first time. onGameStateCreated triggers when a game is loaded and nothing identifies it as \u003Cem\u003Ea new game\u003C/em\u003E.\u003C/p\u003E\u003Cp\u003Epaul23, if that\u0027s what you\u0027re looking for or need one-time code execution for a new game you should look into the Scenario class. Give it a flag to be set when you\u0027ve initialized anything needing initializing so it knows not to do it again. Bind the events that MoreUmpf mentioned and any other events you need.\u003C/p\u003E\u003Cp\u003EHere\u0027s some example usage of the Scenario class that I\u0027ve coded\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022https://github.com/Starwaster/Ioncross-Crew-Support/blob/Dev/Source/IoncrossCrewSupport/IonLifeSupportScenario.cs\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/Starwaster/Ioncross-Crew-Support/blob/Dev/Source/IoncrossCrewSupport/IonLifeSupportScenario.cs\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EHere\u0027s another that I did for enneract\u0027s Real Roster to implement crew rotation per save game.\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022https://github.com/Starwaster/KSPRealRoster/blob/master/RRScenario.cs\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/Starwaster/KSPRealRoster/blob/master/RRScenario.cs\u003C/a\u003E\u003C/p\u003E\n"},{"CreatedByName":"paul23","CreatedById":120544,"CreatedDateTime":"2014-10-30T19:32:55Z","Content":"\n\u003Cp\u003EDoes the state of those scenarios save/load when loading/saving? I change quite a few settings of the game - which are normally not in the save file, and I wish those settings to remain when saving/loading. (IE: location of the KSC on kerbin).\u003C/p\u003E\u003Cp\u003EI tried the \u0022onGameStateCreated\u0022events but they actually also execute the moment you \u0022Resume game\u0022 -before actually loading the save game, and also for each save game in the list. How to prevent this?\u003C/p\u003E\u003Cp\u003EOk to show what I wrote so far, (and an addon that triggers once you return to the main menu to set i back to 0).\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E    [KSPScenario(ScenarioCreationOptions.AddToNewGames, new GameScenes[]{\u003Cbr\u003E        GameScenes.LOADINGBUFFER, \u003Cbr\u003E            GameScenes.SPACECENTER,\u003Cbr\u003E            GameScenes.FLIGHT,\u003Cbr\u003E            GameScenes.EDITOR,\u003Cbr\u003E            GameScenes.SPH,\u003Cbr\u003E            GameScenes.TRACKSTATION\u003Cbr\u003E    })]\u003Cbr\u003E    class WSGameScenarioSpawn : ScenarioModule\u003Cbr\u003E    {\u003Cbr\u003E        public static int i = 0;\u003Cbr\u003E        public override void OnLoad(ConfigNode node)\u003Cbr\u003E        {\u003Cbr\u003E            Debug.LogWarning(\u0022scenario onload\u0022 \u002B i\u002B\u002B);\u003Cbr\u003E            if (i == 0) {\u003Cbr\u003E                if (node.HasValue(\u0022omg omg\u0022)) {\u003Cbr\u003E                    Debug.Log(\u0022node has already the value: \u0022 \u002B node.GetValue(\u0022omg omg\u0022));\u003Cbr\u003E                    Debug.Log(\u0022Current main body: \u0022 \u002B FlightGlobals.getMainBody().name);\u003Cbr\u003E                } else {\u003Cbr\u003E                    Debug.Log(\u0022node value not found\u0022);\u003Cbr\u003E                }\u003Cbr\u003E            }\u003Cbr\u003E        }\u003Cbr\u003E        public override void OnSave(ConfigNode node)\u003Cbr\u003E        {\u003Cbr\u003E            Debug.LogWarning(\u0022scenario onsave\u0022 \u002B i\u002B\u002B);\u003Cbr\u003E            node.AddValue(\u0022omg omg\u0022, \u0022will it work?\u0022);\u003Cbr\u003E        }\u003Cbr\u003E    }\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EThe problem I see is that OnSave doesn\u0027t trigger at saving? What to do so it will actually trigger?\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-10-30T21:59:26Z\u0022 title=\u002210/30/2014 09:59  PM\u0022 data-short=\u00229 yr\u0022\u003EOctober 30, 2014\u003C/time\u003E by paul23\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2014-10-31T02:34:34Z","Content":"\n\u003Cp\u003EWhy not just use the Addon attributes to have it run on entering the space center scene and then check something in the save file if you only need it to run once per save.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E[KSPAddon(KSPAddon.Startup.SpaceCentre, true)]\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n"},{"CreatedByName":"paul23","CreatedById":120544,"CreatedDateTime":"2014-10-31T15:14:11Z","Content":"\n\u003Cp\u003EWhich won\u0027t be run if you quickload...\u003C/p\u003E\n"},{"CreatedByName":"Starwaster","CreatedById":71262,"CreatedDateTime":"2014-10-31T19:02:30Z","Content":"\n\u003Cp\u003EI haven\u0027t seen any problems with it not saving.\u003C/p\u003E\u003Cp\u003EOnLoad / OnSave fire anytime the game loads or saves.\u003C/p\u003E\u003Cp\u003EI\u0027ve used it in three mods now and it works in all three. They all depend on it for various functionality. Deadly Reentry for difficulty settings that have to be stored on a per savegame basis. Ioncross to enable/disable the mod per save game and in enneract\u0027s Real Roster to store and manipulate the Kerbal roster. It\u0027s very dependable. Check output_log.txt for errors.\u003C/p\u003E\u003Cp\u003EActually, looking at your code... is that ACTUAL code? You can\u0027t put spaces in node names. It causes problems.\u003C/p\u003E\n"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2014-10-31T22:11:12Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Starwaster\u0022 data-cite=\u0022Starwaster\u0022\u003E\u003Cdiv\u003EActually, looking at your code... is that ACTUAL code? You can\u0027t put spaces in node names. It causes problems.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EIt kills kittens too. Never do that.\u003C/p\u003E\n"}]}