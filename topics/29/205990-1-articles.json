{"TopicId":205990,"ForumId":29,"TopicTitle":"A different tank question: Is PartResource.flowMode broken?","CreatedByName":"Pehvbot","CreatedById":182810,"CreatedDateTime":"2021-12-15T16:46:14Z","PageNum":1,"Articles":[{"CreatedByName":"Pehvbot","CreatedById":182810,"CreatedDateTime":"2021-12-15T16:46:14Z","Content":"\n\u003Cp\u003E\nI\u0027ve also been playing with a failure mod and I am trying to \u0027lock\u0027 a resource (think pump failure).\u00A0 \u00A0PartResource.flowMode looks like it does this since you can set the resource to FlowMode.None and the resource is still there but can\u0027t be accessed.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cb\u003EHowever\u003C/b\u003E\u00A0this does not stop other parts from seeing the resource for transfers.\u00A0 Other tanks can fill or drain infinitely via transfer without changing the failed resource.\u00A0 \u00A0I haven\u0027t found a good way to stop this from happening.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nThings I\u0027ve tried:\n\u003C/p\u003E\n\u003Cul\u003E\u003Cli\u003E\nUse PartResource.flowState (the start/stop button in the \u003Cabbr title=\u0022Part Action Window\u0022\u003Epaw\u003C/abbr\u003E).\u00A0 This works for using the resource (i.e. it can\u0027t be used) although it still allows resource transfers, just without the magic infinite resource.\u00A0 I also haven\u0027t found a good way to lock the stop button so it can\u0027t just be turned on again.\u00A0 I think I can hide button but haven\u0027t gone any further.\n\u003C/li\u003E\n\u003Cli\u003E\nUse PartResource.isVisible.\u00A0 This works but it of course removes the resource from the \u003Cabbr title=\u0022Part Action Window\u0022\u003EPAW\u003C/abbr\u003E.\u00A0 \u00A0I do put a\u00A0failure message in the \u003Cabbr title=\u0022Part Action Window\u0022\u003EPAW\u003C/abbr\u003E, but this is not ideal.\n\u003C/li\u003E\n\u003C/ul\u003E\u003Cp\u003E\nThings I think\u00A0\u003Cem\u003Emight\u003C/em\u003E\u00A0work:\n\u003C/p\u003E\n\u003Cul\u003E\u003Cli\u003E\nSwap the resource for a dummy resource.\u00A0 I\u0027m not sure how to do this and I don\u0027t think it will play well with other mods.\n\u003C/li\u003E\n\u003Cli\u003E\nDisable crossfeed.\u00A0 I don\u0027t know if this can be done with a single resource though and I have no idea how to do this either.\n\u003C/li\u003E\n\u003Cli\u003E\nRemove the resource while broken and add it back in after it\u0027s repaired.\u00A0 I assume I can create a hidden \u0027Mass\u0027 resource via \u003Cabbr title=\u0022Module Manager (mod)\u0022\u003EMM\u003C/abbr\u003E and add or remove the right amount of mass to balance the removed resource, but this seems clunky.\n\u003C/li\u003E\n\u003C/ul\u003E\u003Cp\u003E\nRight now I\u0027m just locking and hiding the resource.\u00A0 Something like:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\u003Cspan class=\u0022pln\u0022\u003Eresource.flowMode = PartResource.FlowMode.None;\nresource.isVisible = false;\n\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nDoes anyone know if there\u0027s something I\u0027m missing about this \u0027broken\u0027\u00A0resource transfer behavior or have any better ideas?\n\u003C/p\u003E\n"},{"CreatedByName":"Gotmachine","CreatedById":163039,"CreatedDateTime":"2021-12-28T10:33:23Z","Content":"\n\u003Cp\u003E\nThere is a PartResource.hideFlow bool. If set to true, it will hide the button that allow the user from toggling PartResource.flowState.\u003Cbr\u003E\nSo setting the following should completely lock the resource :\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-c prettyprinted\u0022\u003E\u003Cspan class=\u0022pln\u0022\u003Eresource\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003EflowMode \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E=\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022typ\u0022\u003EPartResource\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan class=\u0022typ\u0022\u003EFlowMode\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan class=\u0022typ\u0022\u003ENone\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\nresource\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003EflowState \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E=\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Efalse\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\nresource\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003EhideFlow \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E=\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Etrue\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E;\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nEdit : you will likely run into the issue that when setting hideFlow, if the \u003Cabbr title=\u0022Part Action Window\u0022\u003EPAW\u003C/abbr\u003E is already opened (or has been opened previously), the flow toggle button will still stay visible or hidden.\u003Cbr\u003E\nYou will likely need to manually trigger a \u003Cabbr title=\u0022Part Action Window\u0022\u003EPAW\u003C/abbr\u003E rebuild when your \u0022resource locking\u0022 event is triggered \u003Cspan\u003E:\u003C/span\u003E\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode\u0022\u003Eif (resource.part.PartActionWindow != null)\n  resource.part.PartActionWindow.displayDirty = true;\u003C/pre\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222021-12-28T10:47:24Z\u0022 title=\u002212/28/2021 10:47  AM\u0022 data-short=\u00222 yr\u0022\u003EDecember 28, 2021\u003C/time\u003E by Gotmachine\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Pehvbot","CreatedById":182810,"CreatedDateTime":"2021-12-28T17:23:11Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00224070061\u0022 data-ipsquote-contentid=\u0022205990\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221640687603\u0022 data-ipsquote-userid=\u0022163039\u0022 data-ipsquote-username=\u0022Gotmachine\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n6 hours ago, Gotmachine said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nThere is a PartResource.hideFlow bool. If set to true, it will hide the button that allow the user from toggling PartResource.flowState.\u003Cbr\u003E\nSo setting the following should completely lock the resource :\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-c prettyprinted\u0022\u003E\u003Cspan class=\u0022pln\u0022\u003Eresource\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003EflowMode \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E=\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022typ\u0022\u003EPartResource\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan class=\u0022typ\u0022\u003EFlowMode\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan class=\u0022typ\u0022\u003ENone\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\nresource\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003EflowState \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E=\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Efalse\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\nresource\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003EhideFlow \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E=\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Etrue\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E;\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nEdit : you will likely run into the issue that when setting hideFlow, if the \u003Cabbr title=\u0022Part Action Window\u0022\u003E\u003Cabbr title=\u0022Part Action Window\u0022\u003EPAW\u003C/abbr\u003E\u003C/abbr\u003E is already opened (or has been opened previously), the flow toggle button will still stay visible or hidden.\u003Cbr\u003E\nYou will likely need to manually trigger a \u003Cabbr title=\u0022Part Action Window\u0022\u003E\u003Cabbr title=\u0022Part Action Window\u0022\u003EPAW\u003C/abbr\u003E\u003C/abbr\u003E rebuild when your \u0022resource locking\u0022 event is triggered \u003Cspan\u003E:\u003C/span\u003E\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode\u0022\u003Eif (resource.part.PartActionWindow != null)\n  resource.part.PartActionWindow.displayDirty = true;\u003C/pre\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nI was never able to stop PartResource.FlowMode.None from allowing magical resource transfers.\u00A0 Other parts seem to still see it as a source/destination for transfers regardless of flowState or flowMode.\n\u003C/p\u003E\n\u003Cp\u003E\nI finally just went with just flowState = false and hideFlow = true.\u00A0 This still allows manual resource transfers, but since the mod is really intended as an \u0027in flight\u0027 failure mod, it seems like a reasonable compromise.\u00A0 Hey, if players can manage to transfer fuel while in flight (or have a craft that can survive a tank pressurization failure and transfer it later) good!\n\u003C/p\u003E\n\u003Cp\u003E\nYeah, I ran into the \u003Cabbr title=\u0022Part Action Window\u0022\u003EPAW\u003C/abbr\u003E update problem.\u00A0 I went with\u00A0MonoUtilities.RefreshPartContextWindow(part); but this looks like a better option.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027m still very much at the \u0027monkey pounding the keyboard until something good happens\u0027 stage here so I really appreciate your help.\n\u003C/p\u003E\n"}]}