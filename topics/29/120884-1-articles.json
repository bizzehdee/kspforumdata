{"TopicId":120884,"ForumId":29,"TopicTitle":"Vessel Rotations and Planetary Location","CreatedByName":"Whitecat106","CreatedById":140086,"CreatedDateTime":"2015-09-14T17:46:49Z","PageNum":1,"Articles":[{"CreatedByName":"Whitecat106","CreatedById":140086,"CreatedDateTime":"2015-09-14T17:46:49Z","Content":"\n\u003Cp\u003EHello everyone! \u003C/p\u003E\u003Cp\u003EWhitecat again and I am having some small issues with my new \u0027sea launch\u0027 system part of the BoatNavigation plugin \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/132913-1-0-4-Contract-Pack-Maritime-Missions-and-Boat-Navigation-Plugin-V1-3-2-14-09-2015\u0022 rel=\u0022external nofollow\u0022\u003Ehere\u003C/a\u003E. \u003C/p\u003E\u003Cp\u003EThe system its self works fine, teleporting a vessel to a water based location upon launch (with a momentary pause at the KSC Runway) based on a UI from the SPH, derived from Hyperedit code, the only issue is that a teleported vessel retains its original rotation relative to Kerbins surface..\u003C/p\u003E\u003Cp\u003EFor instance, a vessel launched from the Runway with an upward (vertical) facing command pod would spawn upside-down/ at a different angle when teleported to a latitude and longitude say on the other side of Kerbin. \u003C/p\u003E\u003Cp\u003EMy question is, how would one go about determining a necessary rotation transformation to correct this and how would I go about doing so? or even better, how could one set the rotation to the original (Runway/SPH) orientation whilst still being at a different point on the body?\u003C/p\u003E\u003Cp\u003EI am sure the answer lies within Quaternions but this is a very new area for me so I have no idea what I am doing! \u003C/p\u003E\u003Cp\u003EThanks in advance for any help! \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"NathanKell","CreatedById":75006,"CreatedDateTime":"2015-09-14T21:25:22Z","Content":"\n\u003Cp\u003EThere\u0027s a quaternion operation that will return the rotation from one vector to another; feed it the original normal vector and the desired normal vector, then apply that rotation to the vessel.\u003C/p\u003E\n"},{"CreatedByName":"EladDv","CreatedById":118368,"CreatedDateTime":"2015-09-14T22:03:18Z","Content":"\n\u003Cp\u003Edoes the celestialbody.getNvector(lat,lon) actually returns the normal vector?(it name suggests so but i am not familiar with PQS and celestial bodies) if so he could just apply that to the euler angles as the up direction\u003C/p\u003E\n"},{"CreatedByName":"Whitecat106","CreatedById":140086,"CreatedDateTime":"2015-09-14T23:10:05Z","Content":"\n\u003Cp\u003EThanks for the replies, I have the following code at the moment: \u003C/p\u003E\u003Cp\u003E Vector3 oldVect = vessel.mainBody.GetSurfaceNVector(vessel.latitude, vessel.longitude);\u003C/p\u003E\u003Cp\u003E Vector3 newVect = vessel.mainBody.GetSurfaceNVector(newLatitude, newLongitude);\u003C/p\u003E\u003Cp\u003E Quaternion correctionRotation = Quaternion.FromToRotation(oldVect, newVect);\u003C/p\u003E\u003Cp\u003E vessel.SetRotation(correctionRotation);\u003C/p\u003E\u003Cp\u003EI might be being really dumb, but the SetRotation is only giving the vessel a fixed rotation (regardless of the position on the surface) of around 60 degrees from the horizontal plane... \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_undecided.gif\u0022 alt=\u0022:huh:\u0022\u003E Oh by the way the vessel is set OnRails() just in case that messes with any rotation setting stuff...\u003C/p\u003E\n"},{"CreatedByName":"NathanKell","CreatedById":75006,"CreatedDateTime":"2015-09-14T23:36:35Z","Content":"\n\u003Cp\u003EI think you want to apply the rotation to the vessel, rather than setting it, i.e. new rotation = vessel.transfrom.rotation * correctionRotation\u003C/p\u003E\n"},{"CreatedByName":"Whitecat106","CreatedById":140086,"CreatedDateTime":"2015-09-15T13:52:42Z","Content":"\n\u003Cp\u003EI apologize but I still do not quite understand, how would I go about applying this rotation to the vessel? Quaternions are confusing \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_sad.gif\u0022 alt=\u0022:(\u0022\u003E As for euler angles.... I understand these just as little \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_undecided.gif\u0022 alt=\u0022:huh:\u0022\u003E I have looked through the source code of PersistentRotation as I thought this might help but honestly I am lost...\u003C/p\u003E\n"},{"CreatedByName":"NathanKell","CreatedById":75006,"CreatedDateTime":"2015-09-15T16:09:11Z","Content":"\n\u003Cp\u003EThe nice thing about quaternions is that you can just multiply them together. So rotation A combined with rotation B is just A*B. So to apply the new rotation on top of the existing vessel orientation, you can do vessel.transform.rotation = vessel.transform.rotation * newRotation.\u003C/p\u003E\n"},{"CreatedByName":"Whitecat106","CreatedById":140086,"CreatedDateTime":"2015-09-15T16:41:16Z","Content":"\n\u003Cp\u003EOh I see, thanks! So something like this? \u003C/p\u003E\u003Cp\u003EVector3 oldVect = vessel.mainBody.GetSurfaceNVector(vessel.latitude, vessel.longitude);\u003C/p\u003E\u003Cp\u003E Vector3 newVect = vessel.mainBody.GetSurfaceNVector(Latitude, Longitude);\u003C/p\u003E\u003Cp\u003E Quaternion correctionRotation = Quaternion.FromToRotation(vessel.transform.rotation.eulerAngles, newVect);\u003C/p\u003E\u003Cp\u003E vessel.transform.rotation = vessel.transform.rotation * correctionRotation;\u003C/p\u003E\u003Cp\u003EEDIT 17:41 \u003C/p\u003E\u003Cp\u003EOkay actually this causes the vessel to separate into parts and break apart when it is teleported....\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022\u0022 alt=\u0022\u0026lt;a  href=\u0022\u003E\u003Cimg src=\u0022%7Boption%7D\u0022 class=\u0022ipsImage\u0022 alt=\u0022%7Boption%7D\u0022\u003Ehttp://i.imgur.com/5nYWRhh.png\u0027 alt=\u00275nYWRhh.png\u0027\u0026gt;\u003C/p\u003E\u003Cp\u003EIts a neat effect... but to quote Galaxy Quest... \u0022Its inside out... and then it exploded\u0022...\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-09-15T16:47:59Z\u0022 title=\u002209/15/2015 04:47  PM\u0022 data-short=\u00228 yr\u0022\u003ESeptember 15, 2015\u003C/time\u003E by Whitecat106\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"NathanKell","CreatedById":75006,"CreatedDateTime":"2015-09-15T20:29:10Z","Content":"\n\u003Cp\u003EUh, yeah, that\u0027s what I meant...certainly didn\u0027t expect that outcome though. :]\u003C/p\u003E\u003Cp\u003ESorry, that\u0027s the limit of my theoretical knowledge here, maybe someone else knows better?\u003C/p\u003E\n"},{"CreatedByName":"Whitecat106","CreatedById":140086,"CreatedDateTime":"2015-09-15T20:42:18Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022NathanKell\u0022 data-cite=\u0022NathanKell\u0022\u003E\u003Cdiv\u003EUh, yeah, that\u0027s what I meant...certainly didn\u0027t expect that outcome though. :]\u003Cp\u003ESorry, that\u0027s the limit of my theoretical knowledge here, maybe someone else knows better?\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EHaha! Thanks for your help anyway! It looks like some parts of the vessel rotated correctly and some did not... The Flaps (used as pretty guard rails) on the left side of the ship seem to have been rotated to the same point but the same flaps on the other side seem not rotated and staggered even though they were originally placed with symmetry... everything is just a bit off... This disturbs me... I don\u0027t even know how to debug this! \u003C/p\u003E\u003Cp\u003EIts bizarre that this turned out like that... I was expecting either upside-down or no change... not inverted and Picasso-esque... \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_huh.gif\u0022 alt=\u0022:confused:\u0022\u003E Actually looking closer it looks as though the root part (the hull next to the paddlewheels) has been rotated to around 90 degrees from the x, and \u003Cstrong\u003E..most\u003C/strong\u003E.. of the rest of the ship has not... Weird! \u003C/p\u003E\u003Cp\u003EWell I\u0027m open to any other suggestions! Preferably a Van-Gogh effect this time.. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue2.gif\u0022 alt=\u0022:sticktongue:\u0022\u003E\u003C/p\u003E\u003Cp\u003EEDIT 21:43\u003C/p\u003E\u003Cp\u003EWait! I have an idea, Kerbin Side creates new launchsites and vessels are spawned at these with \u0027normal\u0027 normal vectors, maybe the ship is rotated upon transfer from the VAB to the other site? - I am going to look into this now and I will post my results here! \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EEDIT 21:55\u003C/p\u003E\u003Cp\u003ENope no clues here, the closest thing was using the PQS of a static object being re-orientated - Sadly; incredibly unhelpful. I have tested out the Picasso Code again and with the camera rotated to face the front, the vessel looks more like a cross section with each part at a different altitude but will relatively consistent rotations.... I\u0027m stumped.\u003C/p\u003E\u003Cp\u003EEDIT 14:52 \u003C/p\u003E\u003Cp\u003EOkay so I also tried this method but with rotating every part of the vessel rather than the vessel its self.. - The same explosive results, it looks like x.transform.rotation or x.transform.rotate just causes issues with part attachment rules? This is frustrating...\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-09-16T13:55:17Z\u0022 title=\u002209/16/2015 01:55  PM\u0022 data-short=\u00228 yr\u0022\u003ESeptember 16, 2015\u003C/time\u003E by Whitecat106\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Boris-Barboris","CreatedById":133181,"CreatedDateTime":"2015-09-21T09:15:14Z","Content":"\n\u003Cp\u003Evessel.transform is referencing current \u0022control from\u0022 part transform. If you\u0027re rotating each part, you should also move it. Choose some vessel-local point, for example CoM of the vessel, and think about your teleportation as moving this point. For each part you need to rotate it\u0027s transform.rotation and apply also the same rotation to it\u0027s position vector around chosen reference point (CoM). Vector rotation is also done by * operator. Quaternion * vector.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-09-21T09:17:34Z\u0022 title=\u002209/21/2015 09:17  AM\u0022 data-short=\u00228 yr\u0022\u003ESeptember 21, 2015\u003C/time\u003E by Boris-Barboris\u003C/strong\u003E\n\u003Cbr\u003Egrammar\n\u003C/span\u003E\n"},{"CreatedByName":"MrHappyFace","CreatedById":76365,"CreatedDateTime":"2015-09-21T14:31:27Z","Content":"\n\u003Cp\u003EI would just do this after the ship gets teleported, you may need to use the FlightGlobals.getUpAxis() function though, I\u0027m not sure:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E//get the up axis\u003Cbr\u003Evar upAxis = FlightGlobals.upAxis;\u003Cbr\u003E\u003Cbr\u003E//set the vessel\u0027s up vector\u003Cbr\u003Evessel.rootPart.partTransform.up = upAxis;\u003Cbr\u003E\u003Cbr\u003E//get the rotation that resulted from setting the up vector\u003Cbr\u003Evar newRot = vessel.rootPart.partTransform.rotation;\u003Cbr\u003E\u003Cbr\u003E//set the rotation\u003Cbr\u003Evessel.SetRotation(newRot);\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n"},{"CreatedByName":"Whitecat106","CreatedById":140086,"CreatedDateTime":"2015-10-09T14:11:26Z","Content":"\n\u003Cp\u003EHello everyone, thank you for your replies but I still have had no luck, if I try to rotate the ship after teleportation the vessel is already positioned and loaded in the scene (as an active vessel) and will not rotate with SetRotation, attempts to rotate the vessel using the above methods before teleportation either have no effect or rotate certain parts individually causing the vessel to be destroyed. I see it that since the teleport itself occours with only one function there is no way to adjust a rotation while the vessel is \u0027in transit\u0027.\u003C/p\u003E\u003Cp\u003E Boris-Barboris, could you explain further how I could impliment your suggestion? Would this surely not be what KSP already does \u0027behind the scenes\u0027 when rotating a vessel?\u003C/p\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2015-10-09T19:31:16Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Whitecat106\u0022 data-cite=\u0022Whitecat106\u0022\u003E\u003Cdiv\u003EHello everyone, thank you for your replies but I still have had no luck, if I try to rotate the ship after teleportation the vessel is already positioned and loaded in the scene (as an active vessel) and will not rotate with SetRotation\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYou seem to pack (rails) and hold unpack in your TeleportToLocation method so it should work.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Eprivate void DoTeleport()\u003Cbr\u003E{\u003Cbr\u003E    var vessel = FlightGlobals.ActiveVessel;\u003Cbr\u003E\u003Cbr\u003E    var originalUp = FlightGlobals.getUpAxis();\u003Cbr\u003E\u003Cbr\u003E    ActiveSeaLaunch.TeleportToLocation(89f, 0f, vessel);\u003Cbr\u003E\u003Cbr\u003E    var newUp = FlightGlobals.getUpAxis();\u003Cbr\u003E\u003Cbr\u003E    // adjust vessel rotation based on how much the up direction changed\u003Cbr\u003E    var diff = Quaternion.FromToRotation(originalUp, newUp);\u003Cbr\u003E\u003Cbr\u003E    vessel.SetRotation(diff * vessel.transform.rotation);\u003Cbr\u003E}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EI don\u0027t know if you\u0027re using a different teleport method for this. You could write an equivalent method (of Vessel.SetRotation) that manipulates the part rigidbody locations as Boris suggested if packing the vessel isn\u0027t feasible for some reason\u003C/p\u003E\n"},{"CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2016-03-10T13:49:00Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222220456\u0022 data-ipsquote-contentid=\u0022120884\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221444419076\u0022 data-ipsquote-userid=\u002275857\u0022 data-ipsquote-username=\u0022xEvilReeperx\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nOn 10/9/2015 at 3:31 PM, xEvilReeperx said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nYou seem to pack (rails) and hold unpack in your TeleportToLocation method so it should work.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cdiv\u003E\n\u00A0\n\u003C/div\u003E\n\u003Cpre class=\u0022ipsCode\u0022\u003E\n\nprivate void DoTeleport()\n{\n    var vessel = FlightGlobals.ActiveVessel;\n\n    var originalUp = FlightGlobals.getUpAxis();\n\n    ActiveSeaLaunch.TeleportToLocation(89f, 0f, vessel);\n\n    var newUp = FlightGlobals.getUpAxis();\n\n    // adjust vessel rotation based on how much the up direction changed\n    var diff = Quaternion.FromToRotation(originalUp, newUp);\n\n    vessel.SetRotation(diff * vessel.transform.rotation);\n}\u003C/pre\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nI don\u0027t know if you\u0027re using a different teleport method for this. You could write an equivalent method (of Vessel.SetRotation) that manipulates the part rigidbody locations as Boris suggested if packing the vessel isn\u0027t feasible for some reason\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\n\u003Cspan\u003E\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022http://forum.kerbalspaceprogram.com/index.php?/profile/75857-xevilreeperx/\u0026amp;do=hovercard\u0022 data-mentionid=\u002275857\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/75857-xevilreeperx/\u0022\u003E@xEvilReeperx\u003C/a\u003E\u00A0I\u0027m trying to use this code in KRASH, but it\u0027s not working.\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nI set originalUp at the launchpad:\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cspan\u003EoriginalUp: [0, 0, 0]\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cspan\u003EnewUp after the teleport:\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cspan\u003EnewUp: [-0.988477635301813, -5.83846358332169E-09, -0.151366986189645]\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cspan\u003Eand diff is:\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cspan\u003Ediff: (0.0, 0.0, 0.0, 1.0)\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cspan\u003E\u00A0I even added an additional HoldVesselunpack (what does it do?)\u00A0before the setrotation (although the SetOrbit function already had it):\u003C/span\u003E\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode\u0022\u003E\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0vessel.SetOrbit(orbit);\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0try\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0{\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0Log.Info (\u0022FixedUpdate HoldVesselUnpack\u0022);\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0OrbitPhysicsManager.HoldVesselUnpack(60);\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0}\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0catch (NullReferenceException)\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0{\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0Log.Info(\u0022OrbitPhysicsManager.HoldVesselUnpack threw NullReferenceException\u0022);\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0}\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0// rotation code\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0var newUp = FlightGlobals.getUpAxis();\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0// adjust vessel rotation based on how much the up direction changed\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0var diff = Quaternion.FromToRotation(KRASHShelter.originalUp, newUp);\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0vessel.SetRotation(diff * vessel.transform.rotation);\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0// rotation code\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0Log.Info(\u0022originalUp: \u0022 \u002B KRASHShelter.originalUp.ToString());\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0Log.Info (\u0022newUp: \u0022 \u002B newUp.ToString ());\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0Log.Info (\u0022diff: \u0022 \u002B diff.ToString ());\u003C/pre\u003E\n\u003Cp\u003E\nand this is the setOrbit function:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode\u0022\u003E\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0public static void SetOrbit(this Vessel vessel, Orbit newOrbit)\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0{\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0Log.Info (\u0022vessel.SetOrbit\u0022);\n\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0//var originalUp = FlightGlobals.getUpAxis ();\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0//Log.Info (\u0022originalUp: \u0022 \u002B originalUp.ToString ());\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0var destinationMagnitude = newOrbit.getRelativePositionAtUT(Planetarium.GetUniversalTime()).magnitude;\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0if (destinationMagnitude \u0026gt; newOrbit.referenceBody.sphereOfInfluence)\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0{\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0Extensions.ErrorPopup(\u0022Destination position was above the sphere of influence\u0022);\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0return;\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0}\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0if (destinationMagnitude \u0026lt; newOrbit.referenceBody.Radius)\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0{\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0Extensions.ErrorPopup(\u0022Destination position was below the surface\u0022);\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0return;\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0}\n\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0vessel.PrepVesselTeleport();\n\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0try\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0{\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0Log.Info (\u0022vessel.SetOrbit 2\u0022);\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0OrbitPhysicsManager.HoldVesselUnpack(60);\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0}\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0catch (NullReferenceException)\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0{\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0Log.Info(\u0022OrbitPhysicsManager.HoldVesselUnpack threw NullReferenceException\u0022);\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0}\n\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0var allVessels = FlightGlobals.fetch == null ? (IEnumerable\u0026lt;Vessel\u0026gt;)new[] { vessel } : FlightGlobals.Vessels;\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0foreach (var v in allVessels.Where(v =\u0026gt; v.packed == false))\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0v.GoOnRails();\n\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0var oldBody = vessel.orbitDriver.orbit.referenceBody;\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0Log.Info (\u0022oldBody: \u0022 \u002B oldBody.ToString ());\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0HardsetOrbit(vessel.orbitDriver, newOrbit);\n\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0vessel.orbitDriver.pos = vessel.orbit.pos.xzy;\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0vessel.orbitDriver.vel = vessel.orbit.vel;\n\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0var newBody = vessel.orbitDriver.orbit.referenceBody;\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0Log.Info (\u0022newBody: \u0022 \u002B newBody.ToString ());\n\n\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0if (newBody != oldBody)\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0{\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0var evnt = new GameEvents.HostedFromToAction\u0026lt;Vessel, CelestialBody\u0026gt;(vessel, oldBody, newBody);\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0GameEvents.onVesselSOIChanged.Fire(evnt);\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0}\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0}\u003C/pre\u003E\n\u003Cp\u003E\n\u003Cbr\u003E\nSo I was wondering if you would have any idea why the vessel isn\u0027t rotating?\n\u003C/p\u003E\n\u003Cp\u003E\nThanks in advance\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nLGG\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2016-03-10T14:37:16Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222450653\u0022 data-ipsquote-contentid=\u0022120884\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221457617740\u0022 data-ipsquote-userid=\u0022129964\u0022 data-ipsquote-username=\u0022linuxgurugamer\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n5 minutes ago, linuxgurugamer said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nI set originalUp at the launchpad:\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cspan\u003EoriginalUp: [0, 0, 0]\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nIs that the actual vector you supplied? You should be getting a unit length vector, either using the up axis from FlightGlobals if you\u0027re only teleporting the active vessel, or else by calculating the normal at the departure/arrival locations yourself\n\u003C/p\u003E\n"},{"CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2016-03-10T15:32:29Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222450720\u0022 data-ipsquote-contentid=\u0022120884\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221457620636\u0022 data-ipsquote-userid=\u002275857\u0022 data-ipsquote-username=\u0022xEvilReeperx\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n52 minutes ago, xEvilReeperx said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nIs that the actual vector you supplied? You should be getting a unit length vector, either using the up axis from FlightGlobals if you\u0027re only teleporting the active vessel, or else by calculating the normal at the departure/arrival locations yourself\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nI got that from FlightGlobals.getUpAxis right after the vessel isvstable at the launchpad. \u00A0Regardless, even if it was wrong, I would expect the ship to rotate in some manner, but is doesn\u0027t\n\u003C/p\u003E\n"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2016-03-10T16:03:59Z","Content":"\n\u003Cp\u003E\nHow do you expect the call to return the rotation between a point ([0,0,0])\u00A0and a vector ?\n\u003C/p\u003E\n"},{"CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2016-03-10T17:35:22Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222450850\u0022 data-ipsquote-contentid=\u0022120884\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221457625839\u0022 data-ipsquote-userid=\u002257146\u0022 data-ipsquote-username=\u0022sarbian\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n1 hour ago, sarbian said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nHow do you expect the call to return the rotation between a point ([0,0,0])\u00A0and a vector ?\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nUmmm, I have no idea? \u00A0 I was copying code as listed above, and obviously am not doing it right.\n\u003C/p\u003E\n\u003Cp\u003E\npublic static Vector3d originalUp;\n\u003C/p\u003E\n\u003Cp\u003E\nLog.Info(\u0022originalUp: \u0022 \u002B originalUp.ToString());\n\u003C/p\u003E\n\u003Cp\u003E\nwas returning:\n\u003C/p\u003E\n\u003Cp style=\u0022color:rgb(39,42,52);font-family:\u0027Helvetica Neue\u0027, Helvetica, Arial, sans-serif;font-size:14px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:22.4px;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(251,251,251);\u0022\u003E\n\u003Cspan\u003EoriginalUp: [0, 0, 0]\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nThe original code earlier had:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode\u0022 style=\u0022font-family:monospace, monospace;font-size:14px;clear:both;white-space:pre-wrap;padding:15px;border-width:0px 0px 0px 4px;border-left-style:solid;border-left-color:rgb(224,224,224);color:rgb(39,42,52);font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:22.4px;text-indent:0px;text-transform:none;word-spacing:0px;background:rgb(250,250,250);\u0022\u003E\nvar originalUp = FlightGlobals.getUpAxis();\n\n    ActiveSeaLaunch.TeleportToLocation(89f, 0f, vessel);\n\n    var newUp = FlightGlobals.getUpAxis();\u003C/pre\u003E\n\u003Cp\u003E\nMaybe I\u0027m totally wrong (has happened before). \u00A0Which is why I\u0027m asking for help.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2016-03-10T18:12:16Z","Content":"\n\u003Cp\u003E\nUh ... you\u0027re assigning something to originalUp right? Maybe you forgot to put a \u0027originalUp = FlightGlobals.getUpAxis()\u0027 in your method somewhere?\n\u003C/p\u003E\n"},{"CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2016-03-10T18:51:40Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222451054\u0022 data-ipsquote-contentid=\u0022120884\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221457633536\u0022 data-ipsquote-userid=\u002275857\u0022 data-ipsquote-username=\u0022xEvilReeperx\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n40 minutes ago, xEvilReeperx said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nUh ... you\u0027re assigning something to originalUp right? Maybe you forgot to put a \u0027originalUp = FlightGlobals.getUpAxis()\u0027 in your method somewhere?\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nBlast!\n\u003C/p\u003E\n\u003Cp\u003E\nNo, it wasn\u0027t, it was in the wrong location.\n\u003C/p\u003E\n\u003Cp\u003E\nSo I fixed it, now originalup seems to be correct:\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cbr\u003E\nKRASH: originalUp: [-0.823562378226326, -0.00169659515293149, 0.567223175421355]\u003Cbr\u003E\nKRASH: newUp: [-0.975128585895769, -5.87685244420722E-09, -0.221639890292606]\u003Cbr\u003E\nKRASH: diff: (0.0, -0.4, 0.0, 0.9)\n\u003C/p\u003E\n\u003Cp\u003E\nbut it still isn\u0027t working.\n\u003C/p\u003E\n\u003Cp\u003E\n============================================================================================\n\u003C/p\u003E\n\u003Cp\u003E\nWell, I\u0027ve made some progress. \u00A0The following code:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode\u0022\u003E\n\u00A0Quaternion normal = Quaternion.LookRotation (vessel.GetWorldPos3D ());\n\n\u00A0vessel.SetRotation (normal);\u003C/pre\u003E\n\u003Cp\u003E\nseems to always make the vessel arrive horizontal on the equator. \u00A0Interestingly enough, the further away from the equator, the more towards vertical, but it isn\u0027t the same everywhere.\n\u003C/p\u003E\n\u003Cp\u003E\nSo,\u00A0I\u0027m wondering if I need something like the following logic (in pseudocode):\n\u003C/p\u003E\n\u003Cp\u003E\nAt launch:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode\u0022\u003E\ncurWorldPos = Quaternion.LookRotation (vessel.GetWorldPos3D ());\nheading = angle ship is pointing (at launchpad, should be 90 degrees)\u003C/pre\u003E\n\u003Cp\u003E\nAfter teleport:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode\u0022\u003E\nnewWorldPos = Quaternion.LookRotation (vessel.GetWorldPos3D ());\n\nQuaternion normal = Quaternion.LookRotation (vessel.GetWorldPos3D ());\n\n\nAdjust normal by heading\n\nvessel.SetRotation (normal);\u003C/pre\u003E\n\u003Cp\u003E\n\u003Cbr\u003E\nI have no idea what a Quaternion is, other than a point in space and a direction.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-03-10T18:53:04Z\u0022 title=\u002203/10/2016 06:53  PM\u0022 data-short=\u00228 yr\u0022\u003EMarch 10, 2016\u003C/time\u003E by linuxgurugamer\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Padishar","CreatedById":97386,"CreatedDateTime":"2016-03-10T19:30:41Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222451103\u0022 data-ipsquote-contentid=\u0022120884\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221457635900\u0022 data-ipsquote-userid=\u0022129964\u0022 data-ipsquote-username=\u0022linuxgurugamer\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n30 minutes ago, linuxgurugamer said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nI have no idea what a Quaternion is, other than a point in space and a direction.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThat isn\u0027t what a \u003Ca href=\u0022https://en.wikipedia.org/wiki/Quaternion\u0022 rel=\u0022external nofollow\u0022\u003Equaternion\u003C/a\u003E is, you can\u0027t specify both a point and a direction with only 4 numbers.\u00A0 A quaternion is a 4d analogue of a \u003Ca href=\u0022https://en.wikipedia.org/wiki/Complex_number\u0022 rel=\u0022external nofollow\u0022\u003Ecomplex number\u003C/a\u003E that just happens to be very useful when \u003Ca href=\u0022https://en.wikipedia.org/wiki/Quaternions_and_spatial_rotation\u0022 rel=\u0022external nofollow\u0022\u003Edealing with rotations\u003C/a\u003E.\u00A0 It basically specifies an axis about which the rotation happens and the angle of the rotation about that axis\u00A0though there isn\u0027t a direct correspondence with the w, x, y and\u00A0z component values.\n\u003C/p\u003E\n\u003Cp\u003E\nYou may be confusing it with a Unity Transform which is a point in space and a rotation (specified by a Vector3 and a Quaternion).\n\u003C/p\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2016-03-10T19:33:50Z","Content":"\n\u003Cp\u003E\nCan you be more specific when you say \u0022not working\u0022? The orientation doesn\u0027t change at all? Does it work teleporting around Kerbin? What are you expecting and what are you seeing?\n\u003C/p\u003E\n"},{"CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2016-03-10T20:33:41Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222451167\u0022 data-ipsquote-contentid=\u0022120884\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221457638430\u0022 data-ipsquote-userid=\u002275857\u0022 data-ipsquote-username=\u0022xEvilReeperx\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n30 minutes ago, xEvilReeperx said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nCan you be more specific when you say \u0022not working\u0022? The orientation doesn\u0027t change at all? Does it work teleporting around Kerbin? What are you expecting and what are you seeing?\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nSure. \u00A0Using the original code I posted:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode\u0022 style=\u0022font-family:monospace, monospace;font-size:14px;clear:both;white-space:pre-wrap;padding:15px;border-width:0px 0px 0px 4px;border-left-style:solid;border-left-color:rgb(224,224,224);color:rgb(39,42,52);font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:22.4px;text-indent:0px;text-transform:none;word-spacing:0px;background:rgb(250,250,250);\u0022\u003E\n\u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0vessel.SetOrbit(orbit);\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0try\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0{\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0Log.Info (\u0022FixedUpdate HoldVesselUnpack\u0022);\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0OrbitPhysicsManager.HoldVesselUnpack(60);\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0}\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0catch (NullReferenceException)\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0{\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0Log.Info(\u0022OrbitPhysicsManager.HoldVesselUnpack threw NullReferenceException\u0022);\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0}\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0// rotation code\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0var newUp = FlightGlobals.getUpAxis();\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0// adjust vessel rotation based on how much the up direction changed\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0var diff = Quaternion.FromToRotation(KRASHShelter.originalUp, newUp);\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0vessel.SetRotation(diff * vessel.transform.rotation);\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0// rotation code\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0Log.Info(\u0022originalUp: \u0022 \u002B KRASHShelter.originalUp.ToString());\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0Log.Info (\u0022newUp: \u0022 \u002B newUp.ToString ());\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0Log.Info (\u0022diff: \u0022 \u002B diff.ToString ());\u003C/pre\u003E\n\u003Cp\u003E\nLatitude: 0\u003Cbr\u003E\nLongitude: 0\u003Cbr\u003E\nAfter teleport: about 7 degrees from horizontal, nose up\n\u003C/p\u003E\n\u003Cp\u003E\nLatitude: 0\u003Cbr\u003E\nLongitude: 30\u003Cbr\u003E\nAfter Teleport: \u00A025 degrees from horizontal, nose down\n\u003C/p\u003E\n\u003Cp\u003E\nLatitude 0\u003Cbr\u003E\nLongitude: 60\u003Cbr\u003E\nAfter teleport: 55 degrees from horizontal, nose down\n\u003C/p\u003E\n\u003Cp\u003E\nAnd I also tried at KSP itself:\n\u003C/p\u003E\n\u003Cp\u003E\nLatitude: -0.1\u003Cbr\u003E\nLongitude: -74.56\u003Cbr\u003E\nAfter teleport: 85 degrees from horizontal, nose up\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nSo it looks like it isn\u0027t doing anything, from what I can tell, the craft is always pointing in the same direction.\n\u003C/p\u003E\n"},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2016-03-11T08:32:25Z","Content":"\n\u003Cp\u003E\nYou may want to check that the order of quaternion multiplication is the one you actually want. I remember having a difficult to identify issue that came down to having the order wrong.\u003Cbr\u003E\nWhat does your Quaternion \u0022diff\u0022 look like in Euler coordinates (log: Quat.eulerAngles)? Which axes is it trying to rotate on (from memory, x is pitch, y is roll, z is yaw wrt to your reference frame)?\n\u003C/p\u003E\n\u003Cp\u003E\nWhat is the vessel rotation prior to using vessel.SetRotation vs. after (logging, not visual)? Is there any change there? Is there a change at the part level (since vessel transform is just the root part it should be, but...)?\n\u003C/p\u003E\n\u003Cp\u003E\nDoes the ship rotate at all during the teleport relative to the planety? Does the reference frame rotate at all during the teleport relative to the planet? It may be more reliable to try and match up the difference between the rotations from the normal vector, instead of a vector that is quite possibly no longer accurate.\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint prettyprinted\u0022\u003E\n\u003Cspan\u003E// rotation relative to the upVec\u003C/span\u003E\u003Cspan\u003E\n\u003C/span\u003E\u003Cspan\u003EQuaternion\u003C/span\u003E\u003Cspan\u003E originalRot \u003C/span\u003E\u003Cspan\u003E=\u003C/span\u003E\u003Cspan\u003E \u003C/span\u003E\u003Cspan\u003EQuaternion\u003C/span\u003E\u003Cspan\u003E.\u003C/span\u003E\u003Cspan\u003EFromToRotation\u003C/span\u003E\u003Cspan\u003E(\u003C/span\u003E\u003Cspan\u003EupVec\u003C/span\u003E\u003Cspan\u003E,\u003C/span\u003E\u003Cspan\u003E vessel\u003C/span\u003E\u003Cspan\u003E.\u003C/span\u003E\u003Cspan\u003Eup\u003C/span\u003E\u003Cspan\u003E);\u003C/span\u003E\u003Cspan\u003E\n\u003C/span\u003E\u003Cspan\u003E// teleport stuff...\u003C/span\u003E\u003Cspan\u003E\n\n\u003C/span\u003E\u003Cspan\u003E// new rotation relative to the upVec\u003C/span\u003E\u003Cspan\u003E\n\u003C/span\u003E\u003Cspan\u003EQuaternion\u003C/span\u003E\u003Cspan\u003E newRot \u003C/span\u003E\u003Cspan\u003E=\u003C/span\u003E\u003Cspan\u003E \u003C/span\u003E\u003Cspan\u003EQuaternion\u003C/span\u003E\u003Cspan\u003E.\u003C/span\u003E\u003Cspan\u003EFromToRotation\u003C/span\u003E\u003Cspan\u003E(\u003C/span\u003E\u003Cspan\u003EnewUpVec\u003C/span\u003E\u003Cspan\u003E,\u003C/span\u003E\u003Cspan\u003E vessel\u003C/span\u003E\u003Cspan\u003E.\u003C/span\u003E\u003Cspan\u003Eup\u003C/span\u003E\u003Cspan\u003E);\u003C/span\u003E\u003Cspan\u003E\n\u003C/span\u003E\u003Cspan\u003E// B - A...\u003C/span\u003E\u003Cspan\u003E\n\u003C/span\u003E\u003Cspan\u003EQuaternion\u003C/span\u003E\u003Cspan\u003E diff \u003C/span\u003E\u003Cspan\u003E=\u003C/span\u003E\u003Cspan\u003E newRot \u003C/span\u003E\u003Cspan\u003E*\u003C/span\u003E\u003Cspan\u003E originalRot\u003C/span\u003E\u003Cspan\u003E.\u003C/span\u003E\u003Cspan\u003EInverse\u003C/span\u003E\u003Cspan\u003E();\u003C/span\u003E\u003Cspan\u003E\n\u003C/span\u003E\u003Cspan\u003E// rotate vessel by the difference\u003C/span\u003E\u003Cspan\u003E\nvessel\u003C/span\u003E\u003Cspan\u003E.\u003C/span\u003E\u003Cspan\u003ESetRotation\u003C/span\u003E\u003Cspan\u003E(\u003C/span\u003E\u003Cspan\u003Evessel\u003C/span\u003E\u003Cspan\u003E.\u003C/span\u003E\u003Cspan\u003Etransform\u003C/span\u003E\u003Cspan\u003E.\u003C/span\u003E\u003Cspan\u003Erotation \u003C/span\u003E\u003Cspan\u003E*\u003C/span\u003E\u003Cspan\u003E diff\u003C/span\u003E\u003Cspan\u003E);\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-03-11T09:32:28Z\u0022 title=\u002203/11/2016 09:32  AM\u0022 data-short=\u00228 yr\u0022\u003EMarch 11, 2016\u003C/time\u003E by Crzyrndm\u003C/strong\u003E\n\u003C/span\u003E\n"}]}