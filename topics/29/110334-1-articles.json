{"TopicId":110334,"ForumId":29,"TopicTitle":"No method override for Astronaut Complex?","CreatedByName":"TheReadPanda","CreatedById":142617,"CreatedDateTime":"2015-05-22T03:28:54Z","PageNum":1,"Articles":[{"CreatedByName":"TheReadPanda","CreatedById":142617,"CreatedDateTime":"2015-05-22T03:28:54Z","Content":"I noticed that the GUI for several of the buildings seems to prevent override methods. So I can\u0027t re-do part of the astronaut complex for my hiring kerbals mod I am working on. I\u0027m working from the C# angle from the limited documentation from the assembly-CSharp.dll, as best as I can. Perhaps I am not finding the right hook? I can\u0027t see much about the astronaut complex at all to be honest. Is there a better place for looking for such information that does not involve trying to decompile things? (edit to clarify this last part).\n\nAnyone know if I am missing something? Or if there is any chance that Squad might remove that so that one might use an override method on some of the methods for the sub-buildings?\n\nI suspect the answer (From my search so far) is no to at least the first part. I think I will stick with just a button to pull up my new hiring interface but I thought it best to ask here before I gave up entirely on the idea.\n\nThanks in advance for any answers any of you may have, even if it is just to say \u0027no there isn\u0027t a way\u0027. ![:D](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif)\n\n-OakTree42\n\n[http://www.twitch.tv/oaktree42/](http://www.twitch.tv/oaktree42/)\n\n**Edited \u003Ctime datetime=\u00222015-05-22T03:45:20Z\u0022 title=\u002205/22/2015 03:45  AM\u0022 data-short=\u00229 yr\u0022\u003EMay 22, 2015\u003C/time\u003E by OakTree42**\n  \nClarify first part of the question"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2015-05-22T08:06:48Z","Content":"Can you be more specific as to what you\u0027re trying to do?\n\n1. Prevent player from opening astronaut complex? (and/or open your custom window instead)\n2. Detect when the player is viewing (has entered) the AC?\n3. Edit text on AC building description when left/right-clicked?\n4. Modify GUI of AC itself (change button conditions etc)?\n\nThe first three are straightforward, the last item can be done but is somewhat tedious"},{"CreatedByName":"TheReadPanda","CreatedById":142617,"CreatedDateTime":"2015-05-22T20:19:26Z","Content":"Sorry if I wasn\u0027t clear enough! My first attempt on this forum to ask questions about my mod efforts. I want to do 4. I want to take the left hand area where it shows kerbals you can hire and replace it with a hiring API that allows you to hire kerbals based on career, gender, courage, stupidity, fearless attribute and level. I would then have level limited on both the max level of kerbal of that career who is available currently on kerban at minus one to their level. And limited by the level of the building, meaning a hard limit of level 3. It would dynamically display how much said kerbal would cost and when you hit \u0027hire\u0027 it would randomly generate a name for that career type and create the kerbal, deduct the money and put him in your roster.\n\nAnd that\u0027s pretty much all of it. So the goal would be to take the left hand side of the AC interface and remove the current window and replace it with one of my own design.\n\n-OakTree42\n\n[http://www.twitch.tv/oaktree42/](http://www.twitch.tv/oaktree42/)\n\nIs this doable? I can handle tedious if it is doable and you can point me in the right direction.\n\nMuch appreciated for your speedy reply by the way! Thanks!!\n\n-"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2015-05-23T02:06:28Z","Content":"Replacing the panel with your own is a lot easier than trying to modify the existing one, which I can tell you from experience is a maintenance nightmare. Here\u0027s a rough mockup that should get you started:\n\n    [KSPAddon(KSPAddon.Startup.SpaceCentre, false)]public class ReprogramAstronautComplex : MonoBehaviour{    private readonly ILog _log = new DebugLog(\u0022Reprogrammer\u0022);    private Rect _windowRect = default(Rect);    private AstronautComplexApplicantPanel _applicantPanel;    private void Start()    {        try        {            SetupSkin();            var complex = UIManager.instance.transform.Find(\u0022panel_AstronautComplex\u0022);#if DEBUG            //DumpAssetBaseTextures();            //complex.gameObject.PrintComponents(new DebugLog(\u0022Complex\u0022));#endif            _applicantPanel = new AstronautComplexApplicantPanel(complex);            _windowRect = _applicantPanel.PanelArea;            _applicantPanel.Hide();            GameEvents.onGUIAstronautComplexSpawn.Add(AstronautComplexShown);            GameEvents.onGUIAstronautComplexDespawn.Add(AstronautComplexHidden);            enabled = false;        }        catch (Exception e)        {            _log.Error(\u0022Error: Encountered unhandled exception: \u0022 \u002B e);            Destroy(this);        }    }    private void AstronautComplexShown()    {        enabled = true;    }    private void AstronautComplexHidden()    {        enabled = false;    }    private void OnDestroy()    {        GameEvents.onGUIAstronautComplexDespawn.Remove(AstronautComplexHidden);        GameEvents.onGUIAstronautComplexSpawn.Remove(AstronautComplexShown);    }    private void SetupSkin()    {        _customWindowSkin = new GUIStyle(HighLogic.Skin.window)        {            contentOffset = Vector2.zero,            padding = new RectOffset() { left = 0, right = HighLogic.Skin.window.padding.right, top = 0, bottom = 0}        };    }    private void DumpAssetBaseTextures()    {        // note: there are apparently null entries in this list for some reason, hence the check        FindObjectOfType().textures.Where(t =\u003E t != null).ToList().ForEach(t =\u003E _log.Debug(\u0022AssetBase: \u0022 \u002B t.name));    }    private Vector2 _scroll = default(Vector2);    private GUIStyle _customWindowSkin;    private readonly Texture2D _portraitMale = AssetBase.GetTexture(\u0022kerbalicon_recruit\u0022);    private readonly Texture2D _portraitFemale = AssetBase.GetTexture(\u0022kerbalicon_recruit_female\u0022);    private void OnGUI()    {        GUI.skin = HighLogic.Skin;        var roster = HighLogic.CurrentGame.CrewRoster;        GUILayout.BeginArea(_windowRect, _customWindowSkin);        {            GUILayout.Label(\u0022Candidates\u0022);            _scroll = GUILayout.BeginScrollView(_scroll, _customWindowSkin);            {                foreach (var applicant in roster.Applicants)                    DrawListItem(applicant);            }            GUILayout.EndScrollView();        }        GUILayout.EndArea();    }    private void DrawListItem(ProtoCrewMember crew)    {        GUILayout.BeginVertical(_customWindowSkin, GUILayout.ExpandHeight(false));        {            GUILayout.BeginHorizontal(GUILayout.ExpandHeight(true), GUILayout.MaxHeight(_portraitMale.height),                GUILayout.ExpandWidth(true));            {                GUILayout.Label(crew.gender == ProtoCrewMember.Gender.Male ? _portraitMale : _portraitFemale);                GUILayout.BeginVertical(GUILayout.ExpandHeight(false), GUILayout.ExpandWidth(true));                {                    GUILayout.BeginHorizontal();                    GUILayout.Label(crew.name);                    GUILayout.FlexibleSpace();                    GUILayout.Label(\u0022Trained \u0022 \u002B crew.experienceTrait.Title);                    GUILayout.EndHorizontal();                    GUILayout.Label(\u0022More info here\u0022);                    GUILayout.BeginHorizontal();                    GUILayout.FlexibleSpace();                    GUILayout.Button(\u0022Hire Applicant\u0022, GUILayout.MaxWidth(100f)); // todo: hire logic                     GUILayout.EndHorizontal();                }                GUILayout.EndVertical();            }            GUILayout.EndHorizontal();        }        GUILayout.EndVertical();    }}public class AstronautComplexApplicantPanel{    private readonly Transform _applicantPanel;    public AstronautComplexApplicantPanel(Transform astronautComplex)    {        if (astronautComplex == null) throw new ArgumentNullException(\u0022astronautComplex\u0022);        _applicantPanel = astronautComplex.Find(\u0022CrewPanels/panel_applicants\u0022);        if (_applicantPanel == null)            throw new ArgumentException(\u0022No applicant panel found on \u0022 \u002B astronautComplex.name);    }    public void Hide(bool tf = true)    {        _applicantPanel.gameObject.SetActive(!tf);    }    public Rect PanelArea    {        get        {            // whole panel is an EzGUI BTButton and we\u0027ll be needing to know about its renderer to come up            // with screen coordinates            var button = _applicantPanel.GetComponent() as SpriteRoot;            if (button == null)                throw new Exception(\u0022AstronautComplexApplicantPanel: Couldn\u0027t find BTButton on \u0022 \u002B                                    _applicantPanel.name);            var uiCam = UIManager.instance.uiCameras.FirstOrDefault(uic =\u003E (uic.mask \u0026 (1 \u003C\u003C _applicantPanel.gameObject.layer)) != 0);            if (uiCam == null)                throw new Exception(\u0022AstronautComplexApplicantPanel: Couldn\u0027t find a UICamera for panel\u0022);            var screenPos = uiCam.camera.WorldToScreenPoint(_applicantPanel.position);            return new Rect(screenPos.x, Screen.height - screenPos.y, button.PixelSize.x, button.PixelSize.y);        }    }}\n\n\u003E ![8fa0f47e1d.png](http://puu.sh/hX5Lb/8fa0f47e1d.png)"},{"CreatedByName":"TheReadPanda","CreatedById":142617,"CreatedDateTime":"2015-05-29T21:08:17Z","Content":"I have used this code to great effect but have a sort of problem here. My hire system works now, but I have to leave and return to the complex to get the right side to refresh. Is there something here that I could call upon hiring? I tried the game event for onhire but that just seems to deduct cash and not actually do what I want.\n\nI thought I had a hiring code issue but when I found it was working by leaving after I checked the save game file...\n\nAlso this does not seem to over-write the astronaut complex if it is entered via the vab/sph crew option. Is there a way to make that work?\n\nYour help has been EXTREMELY helpful and I can not thank you enough for the help you have already given!"},{"CreatedByName":"TheReadPanda","CreatedById":142617,"CreatedDateTime":"2015-05-29T22:24:51Z","Content":"By Firing the \n\n GameEvents.onGUIAstronautComplexSpawn.Fire();\n\nI was able to get the screen to refresh upon hiring a kerbal!\n\nYAY!"}]}