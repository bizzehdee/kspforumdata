{"TopicId":195997,"ForumId":29,"TopicTitle":"Shader Model 4.0 and above not working in-game","CreatedByName":"Gameslinx","CreatedById":144828,"CreatedDateTime":"2020-07-31T15:00:36Z","PageNum":1,"Articles":[{"CreatedByName":"Gameslinx","CreatedById":144828,"CreatedDateTime":"2020-07-31T15:00:36Z","Content":"\n\u003Cp\u003E\nHello, I\u0027m developing a shader that requires the use of double precision values. To do this, I must use at least Shader Model (SM) 4.6.\n\u003C/p\u003E\n\u003Cp\u003E\nSM 4.6 is supported by DX11, which is what KSP uses by default now.\n\u003C/p\u003E\n\u003Cp\u003E\nMoving from SM 3.0 to SM 4.x was causing the shader to appear pink in-game, so I tested this on a completely default, fresh surface shader. I also tested it on a vert-frag shader to be sure. The results were the same - It wasn\u0027t working, even when I forced DX11. The shader works fine on SM 3.0. The line I\u0027m referring to is #pragma target 4.6.\n\u003C/p\u003E\n\u003Cp\u003E\nIt\u0027s worth keeping in mind that SM 4.6 works fine in the Unity editor.\n\u003C/p\u003E\n\u003Cp\u003E\nThe code for the very basic shader is here:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003EShader \u0022Custom/Shader\u0022\n{\n    Properties\n    {\n        _Color(\u0022Color\u0022, Color) = (1,1,1,1)\n        _MainTex(\u0022Albedo (RGB)\u0022, 2D) = \u0022white\u0022 {}\n        _Glossiness(\u0022Smoothness\u0022, Range(0,1)) = 0.5\n        _Metallic(\u0022Metallic\u0022, Range(0,1)) = 0.0\n    }\n    SubShader\n    {\n        Tags { \u0022RenderType\u0022 = \u0022Opaque\u0022 }\n        LOD 200\n        CGPROGRAM\n        #pragma surface surf Standard fullforwardshadows\n        #pragma target 4.6\n        sampler2D _MainTex;\n        struct Input\n        {\n            float2 uv_MainTex;\n        };\n        half _Glossiness;\n        half _Metallic;\n        fixed4 _Color;\n        void surf(Input IN, inout SurfaceOutputStandard o)\n        {\n            fixed4 c = tex2D(_MainTex, IN.uv_MainTex) * _Color;\n            o.Albedo = c.rgb;\n        }\n        ENDCG\n    }\n}\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nThe code for the shader that I\u0027ll actually be moving over to SM 4.6 is here:\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://github.com/Gameslinx/Parallax-Occlusion/blob/master/Shaders/ParallaxOcclusion.shader\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/Gameslinx/Parallax-Occlusion/blob/master/Shaders/ParallaxOcclusion.shader\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nHow come using SM 4.0 and above just doesn\u0027t work, even though it should be supported by KSP? Am I doing something wrong?\n\u003C/p\u003E\n"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2020-08-06T21:19:33Z","Content":"\n\u003Cp\u003E\nPosting this here for future reference:\n\u003C/p\u003E\n\u003Cdiv style=\u0022border:0px;color:#000000;font-size:16px;vertical-align:baseline;\u0022\u003E\n\u003Cdiv style=\u0022border:0px;font-size:16px;padding:0px;vertical-align:baseline;\u0022\u003E\n\u003Cdiv style=\u0022border:0px;font-size:1rem;padding:0px 0px 0px 72px;vertical-align:baseline;\u0022\u003E\nI managed to load a SM 4.0 shader in KSP, only I removed the #pragma target 4.0 line from the shader and used a SM 4.0 feature (in my case a geometry shader) and that gets the shader to load in KSP and force SM 4.0\n\u003C/div\u003E\n\u003Cdiv style=\u0022border:0px;font-size:1rem;padding:0px 0px 0px 72px;vertical-align:baseline;\u0022\u003E\nThe documentation seems to corroborate this:\u00A0\u003Ca href=\u0022https://docs.unity.cn/560/Documentation/Manual/SL-ShaderCompileTargets.html\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://docs.unity.cn/560/Documentation/Manual/SL-ShaderCompileTargets.html\u003C/a\u003E\n\u003C/div\u003E\n\u003Cdiv style=\u0022border:0px;font-size:1rem;padding:0px 0px 0px 72px;vertical-align:baseline;\u0022\u003E\nFor forcing SM 4.6 use a tesselation shader anf make sure there is no #pragma target defined.\n\u003C/div\u003E\n\u003C/div\u003E\n\u003C/div\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222020-08-06T21:20:20Z\u0022 title=\u002208/06/2020 09:20  PM\u0022 data-short=\u00223 yr\u0022\u003EAugust 6, 2020\u003C/time\u003E by blackrack\u003C/strong\u003E\n\u003C/span\u003E\n"}]}