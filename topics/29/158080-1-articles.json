{"TopicId":158080,"ForumId":29,"TopicTitle":"Memory leak - don\u0026#039;t know why (Solved)","CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2017-03-22T22:59:05Z","PageNum":1,"Articles":[{"CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2017-03-22T22:59:05Z","Content":"\n\u003Cp\u003E\nThe following code, which is called at leat 30-40 times\u00A0a second, causes a memory leak of 1-2 meg a second. \u00A0Essentially, it was being called 2-4 times every time through the OnGUI function:\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003E        static Color32[] pixelBlock = null;\n        static RenderTexture rt, origrt;\n        public  Texture2D GetButtonTexture(Texture2D img)\n        {\n            Texture2D img2;\n\n            // see: https://docs.unity3d.com/ScriptReference/Texture2D.GetPixels.html\n            try\n            {\n                pixelBlock = img.GetPixels32();\n                img2 = new Texture2D(img.width, img.height, TextureFormat.ARGB32, false);\n                img2.SetPixels32(pixelBlock);\n                Log.Info(\u0022GetPixels32 loaded image\u0022);\n            }\n            catch (UnityException _e)\n            {\n\n                img.filterMode = FilterMode.Point;\n                rt = RenderTexture.GetTemporary(img.width, img.height);\n                rt.filterMode = FilterMode.Point;\n                origrt = RenderTexture.active;\n                RenderTexture.active = rt;\n                Graphics.Blit(img, rt);\n                img2 = new Texture2D(img.width, img.height, TextureFormat.ARGB32, false);\n                img2.ReadPixels(new Rect(0, 0, img.width, img.height), 0, 0);\n                Log.Info(\u0022GetPixels32 had Exception, img name: \u0022 \u002B img.name);\n                RenderTexture.ReleaseTemporary(rt);\n                RenderTexture.active = origrt;\n            }\n            img2.Apply();\n            return img2;\n        }\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nI don\u0027t know why, can someone who knows more than I do about Unity explain it? \u00A0and maybe how to fix it?\n\u003C/p\u003E\n\u003Cp\u003E\nThis is from The Janitor\u0027s Closet, in the JanitorsToolbar.cs file\n\u003C/p\u003E\n\u003Cp\u003E\nI can say that the no exception is thrown, it\u0027s always in the try block.\n\u003C/p\u003E\n\u003Cp\u003E\nThanks in advance.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222017-03-24T11:21:26Z\u0022 title=\u002203/24/2017 11:21  AM\u0022 data-short=\u00227 yr\u0022\u003EMarch 24, 2017\u003C/time\u003E by linuxgurugamer\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2017-03-23T03:11:49Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222994182\u0022 data-ipsquote-contentid=\u0022158080\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221490223545\u0022 data-ipsquote-userid=\u0022129964\u0022 data-ipsquote-username=\u0022linuxgurugamer\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n4 hours ago, linuxgurugamer said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nimg2 = new Texture2D(img.width, img.height, TextureFormat.ARGB32, false);\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThis is the worst one. GetPixels32() as well. This code will also potentially be very costly to run, potentially framerate-killing, because it\u0027ll stall the graphics pipeline every time you ReadPixels. I assume the error catch here is a fallback for unreadable textures\n\u003C/p\u003E\n\u003Cp\u003E\nAs a final punch in the pants, it\u0027ll quickly consume all available heap mem because you never destroy the Texture2D. Eventually Unity will force a cleanup and the unreferenced ones will be destroyed.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nWhat is the purpose of this code? You seem to know that you can just read a texture directly from one of the components used in ApplicationLauncher buttons. If you want to copy the texture to manipulate it, instantiate a copy instead. I don\u0027t see where it\u0027s ultimately manipulated on a first glance though\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222017-03-23T03:17:07Z\u0022 title=\u002203/23/2017 03:17  AM\u0022 data-short=\u00227 yr\u0022\u003EMarch 23, 2017\u003C/time\u003E by xEvilReeperx\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2017-03-23T06:08:17Z","Content":"\n\u003Cp\u003E\nAnd to add to what \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/75857-xevilreeperx/\u0026amp;do=hovercard\u0022 data-mentionid=\u002275857\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/75857-xevilreeperx/\u0022 rel=\u0022\u0022\u003E@xEvilReeperx\u003C/a\u003E\u00A0said : Do not do non GUI code in onGUI. You do not know how many time per frame the method will be called. If you need to do something once per frame do in in an Update.\n\u003C/p\u003E\n\u003Cp\u003E\nAnd yes, for the love of whatever you want DO NOT \u0022new texture\u0022.\n\u003C/p\u003E\n"},{"CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2017-03-23T11:27:43Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222994381\u0022 data-ipsquote-contentid=\u0022158080\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221490238709\u0022 data-ipsquote-userid=\u002275857\u0022 data-ipsquote-username=\u0022xEvilReeperx\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n7 hours ago, xEvilReeperx said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nThis is the worst one. GetPixels32() as well. This code will also potentially be very costly to run, potentially framerate-killing, because it\u0027ll stall the graphics pipeline every time you ReadPixels. I assume the error catch here is a fallback for unreadable textures\n\u003C/p\u003E\n\u003Cp\u003E\nAs a final punch in the pants, it\u0027ll quickly consume all available heap mem because you never destroy the Texture2D. Eventually Unity will force a cleanup and the unreferenced ones will be destroyed.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nWhat is the purpose of this code? You seem to know that you can just read a texture directly from one of the components used in ApplicationLauncher buttons. If you want to copy the texture to manipulate it, instantiate a copy instead. I don\u0027t see where it\u0027s ultimately manipulated on a first glance though\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nJanitor\u0027s Closet uses a hash of the button texture to uniquely identify a\u00A0ApplicationLauncherButton. \u00A0I found that there was no other way to do it, since some mods seem to load the button texture in a way which doesn\u0027t give a name to the button. \u00A0So what happens is that I first get the texture, and then create a hash from it. \u00A0I still store the whole texture, since I use it to display the toolbar button.\n\u003C/p\u003E\n\u003Cp\u003E\nI found this code online, at the referenced link.\n\u003C/p\u003E\n\u003Cp\u003E\nyes, the error catch is a fallback, but ever since a minor change was made to TextureReplacer at my request, it hasn\u0027t been needed. \u00A0I leave it there in case someone, somewhere, creates an unreadable texture.\n\u003C/p\u003E\n\u003Cp\u003E\nBased on @sarbian\u0027s comment, I\u0027ve moved the code into a FixedUpdate function.\n\u003C/p\u003E\n\u003Cp\u003E\nRe. reading the texture from the button, while I see that the sprite has a texture, it\u0027s not accessible directly, when I do, I get:\n\u003C/p\u003E\n\u003Cp\u003E\nNullReferenceException: Object reference not set to an instance of an object\u003Cbr\u003E\n\u00A0 at JanitorsCloset.JanitorsCloset.FixedUpdate () [0x00000] in \u0026lt;filename unknown\u0026gt;:0\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027ve added calls to Destory() to get rid of the textures I done with. \u00A0And that seemed to fix the problem.\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027ve also added some code to limit the times the buttonlist is updated to once every half second, and it\u0027s all now in the FixedUpdate() function.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222994467\u0022 data-ipsquote-contentid=\u0022158080\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221490249297\u0022 data-ipsquote-userid=\u002257146\u0022 data-ipsquote-username=\u0022sarbian\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n5 hours ago, sarbian said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nAnd to add to what \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/75857-xevilreeperx/\u0026amp;do=hovercard\u0022 data-mentionid=\u002275857\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/75857-xevilreeperx/\u0022 rel=\u0022\u0022\u003E@xEvilReeperx\u003C/a\u003E\u00A0said : Do not do non GUI code in onGUI. You do not know how many time per frame the method will be called. If you need to do something once per frame do in in an Update.\n\u003C/p\u003E\n\u003Cp\u003E\nAnd yes, for the love of whatever you want DO NOT \u0022new texture\u0022.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nFirst line implemented, thanks\n\u003C/p\u003E\n\u003Cp\u003E\nCan you explain why the \u0022new texture\u0027 is bad? \u00A0When I remove the \u0022new\u0022, I get a compile error:\u003Cbr\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003EError\u00A0\u00A0 \u00A0CS1955\u00A0\u00A0 \u00A0Non-invocable member \u0027Texture2D\u0027 cannot be used like a method.\u00A0\u00A0 \u00A0JanitorsCloset\u00A0\u00A0 \u00A0D:\\Users\\jbb\\github\\JanitorsCloset\\JanitorsCloset\\JanitorsToolbar.cs\u00A0\u00A0 \u00A0728\u00A0\u00A0 \u00A0Active\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2017-03-23T12:04:23Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222994628\u0022 data-ipsquote-contentid=\u0022158080\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221490268463\u0022 data-ipsquote-userid=\u0022129964\u0022 data-ipsquote-username=\u0022linuxgurugamer\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n35 minutes ago, linuxgurugamer said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nRe. reading the texture from the button, while I see that the sprite has a texture, it\u0027s not accessible directly, when I do, I get:\n\u003C/p\u003E\n\u003Cp\u003E\nNullReferenceException: Object reference not set to an instance of an object\u003Cbr\u003E\n\u00A0 at JanitorsCloset.JanitorsCloset.FixedUpdate () [0x00000] in \u0026lt;filename unknown\u0026gt;:0\u00A0\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nIgnore this null ref, it wasn\u0027t related.\n\u003C/p\u003E\n\u003Cp\u003E\nI may now be able to access the sprite texture directly. \u00A0I don\u0027t have time to test, but a very quick test showed that it was now working. \u00A0Maybe this is all a holdover back from when the textures were being modified by Texturereplacer?\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027ll get back to this later this evening and post my results\n\u003C/p\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2017-03-23T13:41:30Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222994628\u0022 data-ipsquote-contentid=\u0022158080\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221490268463\u0022 data-ipsquote-userid=\u0022129964\u0022 data-ipsquote-username=\u0022linuxgurugamer\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n1 hour ago, linuxgurugamer said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\n\u00A0I found that there was no other way to do it, since some mods seem to load the button texture in a way which doesn\u0027t give a name to the button.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nEvery UnityEngine.Object has a unique identifier you can get with GetInstanceID(). One simple fix is to look at the instance IDs of the buttons themselves.\n\u003C/p\u003E\n\u003Cp\u003E\nIf you want max efficiency, you could eliminate the constant rechecking and comparisons entirely by setting up a little tracking MonoBehaviour that sets off an event whenever a button is created or destroyed (or whatever else you\u0027d like)\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode\u0022\u003E\npublic static class ToolbarEvents\n{\n    public enum ChangeType { Added, Removed }\n\n    // just like GameEvents\n    public static readonly EventData\u0026lt;ApplicationLauncherButton, ChangeType\u0026gt; ButtonChange =\n        new EventData\u0026lt;ApplicationLauncherButton, ChangeType\u0026gt;(\u0022AppLauncher_ButtonEvent\u0022);\n\n\n    [KSPAddon(KSPAddon.Startup.MainMenu, true)]\n    private class Install : MonoBehaviour\n    {\n        private IEnumerator Start()\n        {\n            while (ApplicationLauncher.Instance == null) yield return null;\n\n            var al = ApplicationLauncher.Instance;\n\n            ButtonEventDispatcher.AddToPrefab(al.listItemPrefab);\n\n            foreach (var b in al.GetComponentsInChildren\u0026lt;ApplicationLauncherButton\u0026gt;(true))\n                ButtonChange.Fire(b, ChangeType.Added);\n                \n            Destroy(gameObject);\n        }\n    }\n\n    private class ButtonEventDispatcher : MonoBehaviour\n    {\n        [SerializeField] private ApplicationLauncherButton _ourButton; // Unity instantiation serialization will make sure this points\n                                                                        // to the live button when created\n\n        private static ApplicationLauncherButton _buttonPrefab; // this used to prevent Unity from unloading prefab from memory\n                                                                // should it stop being referenced at some point\n\n        public static void AddToPrefab(ApplicationLauncherButton prefab)\n        {\n            var ourPrefab = prefab.gameObject.AddComponent\u0026lt;ButtonEventDispatcher\u0026gt;();\n            ourPrefab._ourButton = prefab;\n\n            _buttonPrefab = prefab;\n        }\n\n        private void Start()\n        {\n            ButtonChange.Fire(_ourButton, ChangeType.Added);\n        }\n\n        private void OnDestroy()\n        {\n            ButtonChange.Fire(_ourButton, ChangeType.Removed);\n        }\n\n        // can also do events for hiding/showing if desired\n    }\n}\u003C/pre\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2017-03-23T13:45:48Z","Content":"\n\u003Cp\u003E\nThe problem is that some mods update the button textures of an existing button, so the id won\u0027t change. \u00A0Could this detect that?\n\u003C/p\u003E\n\u003Cp\u003E\nIf there would be a way to detect this, then it would help.\n\u003C/p\u003E\n\u003Cp\u003E\nThe problem is that the sprite\u0027s texture is a plain texture, and I haven\u0027t yet figured out how to get a byteAR of the underlying texture; \u00A0I can do it with Texture2D, however.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222017-03-23T13:58:27Z\u0022 title=\u002203/23/2017 01:58  PM\u0022 data-short=\u00227 yr\u0022\u003EMarch 23, 2017\u003C/time\u003E by linuxgurugamer\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2017-03-23T14:01:15Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222994381\u0022 data-ipsquote-contentid=\u0022158080\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221490238709\u0022 data-ipsquote-userid=\u002275857\u0022 data-ipsquote-username=\u0022xEvilReeperx\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n10 hours ago, xEvilReeperx said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nThis is the worst one. GetPixels32() as well\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nI\u0027m assuming that this call is expensive, in terms of locking the pipe? \u00A0How can I replace it?\n\u003C/p\u003E\n"},{"CreatedByName":"DMagic","CreatedById":57416,"CreatedDateTime":"2017-03-23T15:21:03Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222994628\u0022 data-ipsquote-contentid=\u0022158080\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221490268463\u0022 data-ipsquote-userid=\u0022129964\u0022 data-ipsquote-username=\u0022linuxgurugamer\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n3 hours ago, linuxgurugamer said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nCan you explain why the \u0022new texture\u0027 is bad? \u00A0When I remove the \u0022new\u0022, I get a compile error:\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nIt\u0027s creating a new texture every time it\u0027s called. Even with small textures this adds up quickly over time. If the textures are always the same size then just create a texture once and reuse it.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nIs the code in the first post meant to test if the texture is readable? Because the try block is just reading the texture\u0027s pixels then setting them again. If you want to test if it\u0027s readable you can just try a single GetPixel, since Get, Set and Apply are all somewhat expensive calls to be made so often.\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222994739\u0022 data-ipsquote-contentid=\u0022158080\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221490276748\u0022 data-ipsquote-userid=\u0022129964\u0022 data-ipsquote-username=\u0022linuxgurugamer\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n1 hour ago, linuxgurugamer said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nThe problem is that some mods update the button textures of an existing button, so the id won\u0027t change. \u00A0Could this detect that?\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nDo you mean like mods that replace the stock icons, Alternate Resource Panel, or Contracts Window \u002B (which doesn\u0027t actually change the icon)? Those are the only two that I know of. If so maybe you can just wait for a scene change to do anything with those. It\u0027s not exactly common for a user to be toggling them on and off, and if it\u0027s the only thing preventing you from using the Object listener method (which is almost certainly a far more efficient and more reliable method) I would reconsider.\n\u003C/p\u003E\n"},{"CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2017-03-23T16:02:11Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222994815\u0022 data-ipsquote-contentid=\u0022158080\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221490282463\u0022 data-ipsquote-userid=\u002257416\u0022 data-ipsquote-username=\u0022DMagic\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n33 minutes ago, DMagic said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nIt\u0027s creating a new texture every time it\u0027s called. Even with small textures this adds up quickly over time. If the textures are always the same size then just create a texture once and reuse it.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nAh, the light dawns.\n\u003C/p\u003E\n\u003Cp\u003E\nOk, that\u0027s easy enough to do, thanks.\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222994815\u0022 data-ipsquote-contentid=\u0022158080\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221490282463\u0022 data-ipsquote-userid=\u002257416\u0022 data-ipsquote-username=\u0022DMagic\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n37 minutes ago, DMagic said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nIs the code in the first post meant to test if the texture is readable? Because the try block is just reading the texture\u0027s pixels then setting them again. If you want to test if it\u0027s readable you can just try a single GetPixel, since Get, Set and Apply are all somewhat expensive calls to be made so often.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThis code:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003Estatic Color32[] pixelBlock = null;\n.\n.\n.\n\npixelBlock = img.GetPixels32();\nimg2 = new Texture2D(img.width, img.height, TextureFormat.ARGB32, false);\nimg2.SetPixels32(pixelBlock);\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nwas copied from the link (a Unity page). \u00A0 It is getting the texture into a Texture2D class (img2). \u00A0I don\u0027t thing the \u0022catch\u0022 has been used lately, it\u0027s there for safety.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222994815\u0022 data-ipsquote-contentid=\u0022158080\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221490282463\u0022 data-ipsquote-userid=\u002257416\u0022 data-ipsquote-username=\u0022DMagic\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n39 minutes ago, DMagic said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nDo you mean like mods that replace the stock icons, Alternate Resource Panel, or Contracts Window \u002B (which doesn\u0027t actually change the icon)?\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nFusebox, Ampyear, and some others also change it on the fly to show current status. \u00A0Not stock icons, their own icons on the toolbar\n\u003C/p\u003E\n"},{"CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2017-03-23T21:22:31Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222994864\u0022 data-ipsquote-contentid=\u0022158080\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221490284931\u0022 data-ipsquote-userid=\u0022129964\u0022 data-ipsquote-username=\u0022linuxgurugamer\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n5 hours ago, linuxgurugamer said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222994815\u0022 data-ipsquote-contentid=\u0022158080\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221490282463\u0022 data-ipsquote-userid=\u002257416\u0022 data-ipsquote-username=\u0022DMagic\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n6 hours ago, DMagic said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nIt\u0027s creating a new texture every time it\u0027s called. Even with small textures this adds up quickly over time. If the textures are always the same size then just create a texture once and reuse it.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nAh, the light dawns.\n\u003C/p\u003E\n\u003Cp\u003E\nOk, that\u0027s easy enough to do, thanks.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nActually, I have to create a new one, because it is being stored. \u00A0But I\u0027ve added code to destroy it when not being used.\n\u003C/p\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2017-03-23T21:25:56Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222994739\u0022 data-ipsquote-contentid=\u0022158080\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221490276748\u0022 data-ipsquote-userid=\u0022129964\u0022 data-ipsquote-username=\u0022linuxgurugamer\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n7 hours ago, linuxgurugamer said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nThe problem is that some mods update the button textures of an existing button, so the id won\u0027t change. \u00A0Could this detect that?\n\u003C/p\u003E\n\u003Cp\u003E\nIf there would be a way to detect this, then it would help.\n\u003C/p\u003E\n\u003Cp\u003E\nThe problem is that the sprite\u0027s texture is a plain texture, and I haven\u0027t yet figured out how to get a byteAR of the underlying texture; \u00A0I can do it with Texture2D, however.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nYou could get the instance IDs of textures, too. This would fail if they update their image by changing UVs. But why copy the texture? You can just grab a reference to it and use it directly. I thought you were only interested in the buttons themselves, which contain everything you need to render a duplicate version (if I understand what you\u0027re attempting to do correctly) by themselves.\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222994749\u0022 data-ipsquote-contentid=\u0022158080\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221490277675\u0022 data-ipsquote-userid=\u0022129964\u0022 data-ipsquote-username=\u0022linuxgurugamer\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n7 hours ago, linuxgurugamer said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nI\u0027m assuming that this call is expensive, in terms of locking the pipe? \u00A0How can I replace it?\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThat\u0027s not the expensive call. If the texture is readable, a copy of it exists in system memory so Unity won\u0027t stall the GPU to read pixels back from it. It\u0027s ReadPixels that\u0027s terribly slow (if you haven\u0027t got any unreadable textures, this isn\u0027t hurting you so far).\n\u003C/p\u003E\n\u003Cp\u003E\nThe problem with that one is simply that every time you call it, an array allocation will be made. Why do you need a clone of the texture? Are you modifying it later?\n\u003C/p\u003E\n"},{"CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2017-03-23T21:34:41Z","Content":"\n\u003Cp\u003E\nSo, my final solution is this:\n\u003C/p\u003E\n\u003Cp\u003E\nTurns out that I can access the sprite.texture, so I don\u0027t need to get the texture using that above code every frame. So, the only time I do that call is when setting up the button the first time, and that\u0027s needed to get the hash number.\n\u003C/p\u003E\n\u003Cp\u003E\nSo all I need to do now is this in the FixedUpdate():\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003E if (curButton.Value.origButton.sprite.texture != curButton.Value.buttonTexture2)\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nwhich is better both from a performance issue and memory usage issue.\n\u003C/p\u003E\n\u003Cp\u003E\nThe only issue I have now, is that the texture is being displayed a little smaller than the 38x38.\n\u003C/p\u003E\n\u003Cp\u003E\nThe code doing this is:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003E Rect brect = new Rect(0, 41 * cnt, 41, 41);\n\n if (GUI.Button(brect, curButton.Value.buttonTexture2))\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2017-03-24T00:57:48Z","Content":"\n\u003Cp\u003E\nI had to do a little more with Unity than I like, but I now have the buttons displaying correctly\n\u003C/p\u003E\n"}]}