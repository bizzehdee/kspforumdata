{"TopicId":159285,"ForumId":29,"TopicTitle":"How to replace override or callback for Fill button on Crew Assignment screen","CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2017-04-16T15:56:49Z","PageNum":1,"Articles":[{"CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2017-04-16T15:56:49Z","Content":"\n\u003Cp\u003E\nI\u0027m updating the CrewQueue mod, and I need to have the mod\u0027s functions be used instead of the stock actions.\n\u003C/p\u003E\n\u003Cp\u003E\nSpecifically, there is a button on the Crew Assignment which I see is defined as:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003Epublic void ButtonFill();\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nHow can I replace the stock code with the code in this mod?\n\u003C/p\u003E\n\u003Cp\u003E\nThe old code used the old EZGui, which obviously can\u0027t be used.\n\u003C/p\u003E\n\u003Cp\u003E\nI know that the launch button has ways to do this using \u0022fetch\u0022, but the crew assignment dialog doesn\u0027t have a fetch, only a static Instance. \u00A0And while the EditorLogic has a public Button for launchBtn which I use in other mods, there is no public button for the CrewAssignmentDialog.\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027m guessing that reflection may come into play, but I haven\u0027t any idea of what the button is actually called internally.\n\u003C/p\u003E\n\u003Cp\u003E\nThanks in advance\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"Warezcrawler","CreatedById":145377,"CreatedDateTime":"2017-04-16T16:07:46Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223023074\u0022 data-ipsquote-contentid=\u0022159285\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221492358209\u0022 data-ipsquote-userid=\u0022129964\u0022 data-ipsquote-username=\u0022linuxgurugamer\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n32 minutes ago, linuxgurugamer said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nI\u0027m updating the CrewQueue mod, and I need to have the mod\u0027s functions be used instead of the stock actions.\n\u003C/p\u003E\n\u003Cp\u003E\nSpecifically, there is a button on the Crew Assignment which I see is defined as:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\n\u003Cspan class=\u0022pln\u0022\u003Epublic void ButtonFill();\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nHow can I replace the stock code with the code in this mod?\n\u003C/p\u003E\n\u003Cp\u003E\nThe old code used the old EZGui, which obviously can\u0027t be used.\n\u003C/p\u003E\n\u003Cp\u003E\nI know that the launch button has ways to do this using \u0022fetch\u0022, but the crew assignment dialog doesn\u0027t have a fetch, only a static Instance. \u00A0And while the EditorLogic has a public Button for launchBtn which I use in other mods, there is no public button for the CrewAssignmentDialog.\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027m guessing that reflection may come into play, but I haven\u0027t any idea of what the button is actually called internally.\n\u003C/p\u003E\n\u003Cp\u003E\nThanks in advance\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nI\u0027m not pretending to have the answer, but maybe this can help. The ButtonFill() seems to be using scrollListAvail and\u00A0scrollListCrew which are both public. But since it is not virtual, I have no idea if there is any way to override it.\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003E        public UIList scrollListCrew;\n        public UIList scrollListAvail;\n\n        public void ButtonFill()\n        {\n        }\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222017-04-16T16:29:43Z\u0022 title=\u002204/16/2017 04:29  PM\u0022 data-short=\u00227 yr\u0022\u003EApril 16, 2017\u003C/time\u003E by Warezcrawler\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2017-04-16T16:10:05Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223023083\u0022 data-ipsquote-contentid=\u0022159285\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221492358866\u0022 data-ipsquote-userid=\u0022145377\u0022 data-ipsquote-username=\u0022Warezcrawler\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n1 minute ago, Warezcrawler said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nI\u0027m not pretending to have the answer, but maybe this can help. The ButtonFill() seems to be using scrollListAvail and\u00A0scrollListCrew which are both public. But since it is not virtual, I have no idea if there is any way to override it.\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\n\u003Cspan class=\u0022pln\u0022\u003E        public UIList scrollListCrew;\n        public UIList scrollListAvail;\n\n        public void ButtonFill()\n        {\n            int num = 0;\n            while (true)\n            {\n                UIListItem uilistItemAt = this.scrollListAvail.GetUilistItemAt(0);\n                if (uilistItemAt == null)\n                {\n                    break;\n                }\n                int num1 = num \u002B 1;\n                num = num1;\n                UIListItem uIListItem = this.scrollListCrew.GetUilistItemAt(num1);\n                if (uIListItem == null)\n                {\n                    return;\n                }\n                CrewListItem component = uIListItem.GetComponent\u003C/span\u003E\u003Cspan class=\u0022tag\u0022\u003E\u0026lt;CrewListItem\u0026gt;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E();\n                if (component != null \u0026amp;\u0026amp; component.isEmpty)\n                {\n                    this.MoveCrewToEmptySeat(this.scrollListAvail, this.scrollListCrew, uilistItemAt, num);\n                }\n            }\n        }\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nNot really, that looks like what is being called when the buttonfill is called.\n\u003C/p\u003E\n"},{"CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2017-04-16T16:44:35Z","Content":"\n\u003Cp\u003E\nprogress:\n\u003C/p\u003E\n\u003Cp\u003E\nThis code:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003EButton b1 = GameObject.Find(\u0022Button Fill\u0022).GetComponent\u003C/span\u003E\u003Cspan class=\u0022tag\u0022\u003E\u0026lt;Button\u0026gt;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E();\nb1.onClick.RemoveAllListeners();\nb1.onClick.AddListener(OnFillButton);\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nis working to add my listener, but for some reason, the original listener is still being called.\n\u003C/p\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2017-04-16T17:44:30Z","Content":"\n\u003Cp\u003E\nYou\u0027re almost there. RemoveAllListeners only removes non-persistent listeners. You can disable the persistent ones with onClick.SetPersistentListenerState. You might also want to be more discerning with your GameObject.Find call. You can just grab the right transform directly:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode\u0022\u003E\nCrewAssignmentDialog.Instance.transform.Find(\u0022VL/Buttons/Button Fill\u0022); // \u0026lt;-- GetComponent\u0026lt;Button\u0026gt; on this if found\u003C/pre\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2017-04-16T17:44:53Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223023163\u0022 data-ipsquote-contentid=\u0022159285\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221492364670\u0022 data-ipsquote-userid=\u002275857\u0022 data-ipsquote-username=\u0022xEvilReeperx\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nJust now, xEvilReeperx said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nYou\u0027re almost there. RemoveAllListeners only removes non-persistent listeners. You can disable the persistent ones with onClick.SetPersistentListenerState. You might also want to be more discerning with your GameObject.Find call. You can just grab the right transform directly:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode\u0022\u003E\n\nCrewAssignmentDialog.Instance.transform.Find(\u0022VL/Buttons/Button Fill\u0022); // \u0026lt;-- GetComponent\u0026lt;Button\u0026gt; on this if found\u003C/pre\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThank you!!!\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2017-04-16T18:28:53Z","Content":"\n\u003Cp\u003E\nFor anyone who wants to see the final code for this:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003Epublic void RemapFillButton()\n{\n\tvar buttonFillBtn = CrewAssignmentDialog.Instance.transform.Find(\u0022VL/Buttons/Button Fill\u0022); // \u0026lt;-- GetComponent\u003C/span\u003E\u003Cspan class=\u0022tag\u0022\u003E\u0026lt;Button\u0026gt;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E on this if found\n\tif (buttonFillBtn == null)\n\t\treturn;\n\tButton b1 = buttonFillBtn.GetComponent\u003C/span\u003E\u003Cspan class=\u0022tag\u0022\u003E\u0026lt;Button\u0026gt;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E();\n           \n\tif (b1 != null)\n\t{\n\t\tb1.onClick.RemoveAllListeners();                \n\t\tb1.onClick.SetPersistentListenerState(0, UnityEventCallState.Off);\n\t\tb1.onClick.AddListener(OnFillButton);\n\t}\n}\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n"}]}