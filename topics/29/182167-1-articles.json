{"TopicId":182167,"ForumId":29,"TopicTitle":"Creating a camera causes transparency","CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2019-02-14T13:08:30Z","PageNum":1,"Articles":[{"CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2019-02-14T13:08:30Z","Content":"\n\u003Cp\u003E\nA problem has been reported to me on the PWB Fuel Balancer, and apparently the NavHud mod, where things become a bit transparent.\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027ve isolated it to the following code, which is run upon entry to the Flight scene in the Start method.\u00A0 I\u0027m at a loss, this is an area outside my experience, and any help would be appreciated:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003E[KSPAddon(KSPAddon.Startup.Flight, false)]\npublic class InFlightMarkerCam : MonoBehaviour\n{\n\tprivate GameObject _markerCamObject;\n\tinternal static Camera MarkerCam;\n\n\n\tpublic void Start()\n\t{\n\t\t// When the following line is commented out, no transparency\n\t\tCreateMarkerCam();\n\t}\n\n\tprivate void CreateMarkerCam()\n\t{\n\t\tif (null != _markerCamObject) return;\n\t\t// print(\u0022Setting up the inflight MarkerCamObject\u0022);\n\t\t_markerCamObject = new GameObject(\u0022MarkerCamObject\u0022);\n\t\t_markerCamObject.transform.parent = FlightCamera.fetch.cameras[0].gameObject.transform;//Camera.mainCamera.gameObject.transform; // Set the new camera to be a child of the main camera  \n\t\tMarkerCam = _markerCamObject.AddComponent\u003C/span\u003E\u003Cspan class=\u0022tag\u0022\u003E\u0026lt;Camera\u0026gt;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E();\n\n\t\t// Change a few things - the depth needs to be higher so it renders over the top\n\t\tMarkerCam.name = \u0022markerCam\u0022;\n\t\tMarkerCam.depth = Camera.main.depth \u002B 10;\n\t\tMarkerCam.clearFlags = CameraClearFlags.Depth;\n\t\t// Add a behaviour so we can get the MarkerCam to come around and change itself when the main camera changes\n\t\t_markerCamObject.AddComponent\u003C/span\u003E\u003Cspan class=\u0022tag\u0022\u003E\u0026lt;MarkerCamBehaviour\u0026gt;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E(); // TODO can this be removed?\n\n\t\t// Set the culling mask. \n\t\tMarkerCam.cullingMask = 1 \u0026lt;\u0026lt; 17;\n\t}\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nHere is an example of the problem:\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u0022IyqtpTy.jpg\u0022 class=\u0022ipsImage\u0022 height=\u0022562\u0022 src=\u0022https://i.imgur.com/IyqtpTy.jpg\u0022 width=\u00221024\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Zah","CreatedById":186900,"CreatedDateTime":"2019-02-14T14:21:51Z","Content":"\n\u003Cp\u003E\nAdding to this, the transparency only shows up for me on surfaces that reflect sunlight. I didn\u0027t do elaborate tests with different light sources, it was more of a coincidence that I noticed this. Two screenshots from the same game. Other parts e.g. the stock fairings, have the same problem.\u003Cbr\u003E\u003Ca href=\u0022https://imgur.com/a/0aJBfZS\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://imgur.com/a/0aJBfZS\u003C/a\u003E\n\u003C/p\u003E\n"},{"CreatedByName":"DMagic","CreatedById":57416,"CreatedDateTime":"2019-02-14T16:39:05Z","Content":"\n\u003Cp\u003E\nIt\u0027s clearing the depth texture before rendering, so it no longer knows what is in front of what (that\u0027s a simplification, it likely only applies to some aspects of what it is rendering) so you get transparency.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nIs there any reason why the clear flag is set to Depth instead of Don\u0027t Clear?\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222019-02-14T16:44:44Z\u0022 title=\u002202/14/2019 04:44  PM\u0022 data-short=\u00225 yr\u0022\u003EFebruary 14, 2019\u003C/time\u003E by DMagic\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Shadowmage","CreatedById":138730,"CreatedDateTime":"2019-02-14T18:48:35Z","Content":"\n\u003Cp\u003E\nAdding a bit of potentially relevant information -- I have noticed similar occurrences whenever I enable HDR for KSP cameras (for...reasons.....).\u00A0 Something in the KSP shaders doesn\u0027t play nicely with HDR, and any surfaces hit by sunlight become partially transparent.\n\u003C/p\u003E\n\u003Cp\u003E\nDisabling of HDR, or replacing all Stock shaders with Unity Standard shader fixes the transparency issues (but of course presents other shader related problems...).\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027m not seeing your camera as being set to HDR... but perhaps that is the default behaviour of newly instantiated cameras?\u00A0 IDK;\u00A0 might not hurt to try explicitly setting it to false in the method that creates the camera object.\n\u003C/p\u003E\n"},{"CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2019-02-14T19:52:36Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223540631\u0022 data-ipsquote-contentid=\u0022182167\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221550162345\u0022 data-ipsquote-userid=\u002257416\u0022 data-ipsquote-username=\u0022DMagic\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n3 hours ago, DMagic said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nIt\u0027s clearing the depth texture before rendering, so it no longer knows what is in front of what (that\u0027s a simplification, it likely only applies to some aspects of what it is rendering) so you get transparency.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nIs there any reason why the clear flag is set to Depth instead of Don\u0027t Clear?\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nNo idea, this is old code.\n\u003C/p\u003E\n\u003Cp\u003E\nI assume I should change that to DontClear. ?\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223540676\u0022 data-ipsquote-contentid=\u0022182167\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221550170115\u0022 data-ipsquote-userid=\u0022138730\u0022 data-ipsquote-username=\u0022Shadowmage\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n1 hour ago, Shadowmage said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nnot seeing your camera as being set to HDR... but perhaps that is the default\u003Cspan\u003E\uFEFF\u003C/span\u003E behaviour of newly instantiated cameras?\u00A0 IDK;\u00A0 \u003Cspan\u003E\uFEFF\u003C/span\u003Emight not hurt to try explicitly setting it to false in the method\u003Cspan\u003E\uFEFF\u003C/span\u003E \u003Cspan\u003E\uFEFF\u003C/span\u003Ethat \u003Cspan\u003E\uFEFF\u003Cspan\u003E\uFEFF\u003Cspan\u003E\uFEFF\u003C/span\u003E\u003C/span\u003E\u003C/span\u003Ecreates the camera object.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nWhat is HDR?\n\u003C/p\u003E\n"},{"CreatedByName":"Zah","CreatedById":186900,"CreatedDateTime":"2019-02-14T20:26:06Z","Content":"\n\u003Cp\u003E\nBTW,\u00A0\u003Ca href=\u0022https://github.com/PapaJoesSoup/KerbalFlightIndicators\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/PapaJoesSoup/KerbalFlightIndicators\u003C/a\u003E\u00A0shows the same issue.\u003Cbr\u003E\u003Cbr\u003E\u003Cspan style=\u0022background-color:rgb(255,255,255);\u0022\u003EIt has \u0027\u003C/span\u003E.clearFlags = CameraClearFlags.Nothing;\u0027\u00A0 in KerbalFlightIndicators.cs\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222019-02-14T20:30:52Z\u0022 title=\u002202/14/2019 08:30  PM\u0022 data-short=\u00225 yr\u0022\u003EFebruary 14, 2019\u003C/time\u003E by Zah\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2019-02-14T20:36:18Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223540740\u0022 data-ipsquote-contentid=\u0022182167\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221550175966\u0022 data-ipsquote-userid=\u0022186900\u0022 data-ipsquote-username=\u0022Zah\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n9 minutes ago, Zah said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nBTW,\u00A0\u003Ca href=\u0022https://github.com/PapaJoesSoup/KerbalFlightIndicators\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/PapaJoesSoup/KerbalFlightIndicators\u003C/a\u003E\u00A0shows the same issue.\u003Cbr\u003E\u003Cbr\u003E\u003Cspan style=\u0022background-color:rgb(255,255,255);\u0022\u003EIt has \u0027\u003C/span\u003E.clearFlags = CameraClearFlags.Nothing;\u0027\u00A0 in KerbalFlightIndicators.cs\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nOnce I have this fixed, I\u0027ll take a look at Navhud\n\u003C/p\u003E\n"},{"CreatedByName":"Loskene","CreatedById":141778,"CreatedDateTime":"2019-02-14T20:57:15Z","Content":"\n\u003Cp\u003E\nI didn\u0027t notice transparency in navhud, though I didn\u0027t look very closely, but one thing I did notice is that it seemed to crank up the brightness of \u003Cabbr title=\u0022Environmental Visual Enhancement (mod)\u0022\u003EEVE\u003C/abbr\u003E clouds dramatically when switched on. Like some part of the post-processing to even out the image brightness was being overridden or disabled (or possibly multiplied, who knows), but only on atmospheres. Once in space, and not looking at Kerbin, it was fine. Been like that as long as I can remember.\n\u003C/p\u003E\n"},{"CreatedByName":"Shadowmage","CreatedById":138730,"CreatedDateTime":"2019-02-14T21:44:06Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223540719\u0022 data-ipsquote-contentid=\u0022182167\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221550173956\u0022 data-ipsquote-userid=\u0022129964\u0022 data-ipsquote-username=\u0022linuxgurugamer\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n1 hour ago, linuxgurugamer said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nWhat is HDR?\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nHDR = High Dynamic Range coloring.\u00A0 Uses floating-point buffers for rendered color data rather than byte/fixed based (very basic over-simplification of its description).\u00A0 I\u0027ve no idea why it \u003Cem\u003Eactually\u003C/em\u003E messes with KSP rendering shaders, I only know that it does and that its effect was very similar to what you had reported.\n\u003C/p\u003E\n"},{"CreatedByName":"Zah","CreatedById":186900,"CreatedDateTime":"2019-02-14T21:44:47Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223540749\u0022 data-ipsquote-contentid=\u0022182167\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221550176578\u0022 data-ipsquote-userid=\u0022129964\u0022 data-ipsquote-username=\u0022linuxgurugamer\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n1 hour ago, linuxgurugamer said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nOnce I have this fixed, I\u0027ll take a look at Navhud\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nKerbal Flight Indicators is a sort of alternative NavHud, I just pointed it out because it seems to have a different \u003Cspan style=\u0022background-color:#fbfbfb;color:#353c41;font-size:14px;\u0022\u003E\u003Cspan\u003E\u00A0\u003C/span\u003ECameraClearFlags\u00A0\u003C/span\u003Emode (\u0022Nothing\u0022 instead of \u0022Depth\u0022) but still has the transparency.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222019-02-14T21:45:06Z\u0022 title=\u002202/14/2019 09:45  PM\u0022 data-short=\u00225 yr\u0022\u003EFebruary 14, 2019\u003C/time\u003E by Zah\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2019-02-15T00:55:42Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223540631\u0022 data-ipsquote-contentid=\u0022182167\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221550162345\u0022 data-ipsquote-userid=\u002257416\u0022 data-ipsquote-username=\u0022DMagic\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n8 hours ago, DMagic said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nIs there any reason why the clear flag is set to Depth instead of Don\u0027t Clear?\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThe enum for the clear flag is:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003E    public enum CameraClearFlags\n    {\n        Skybox = 1,\n        Color = 2,\n        SolidColor = 2,\n        Depth = 3,\n        Nothing = 4\n    }\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nSo, I set it to Nothing, and there was no change\n\u003C/p\u003E\n\u003Cp\u003E\nNext, I set hdr = false\n\u003C/p\u003E\n\u003Cp\u003E\nand That fixed it\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223540676\u0022 data-ipsquote-contentid=\u0022182167\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221550170115\u0022 data-ipsquote-userid=\u0022138730\u0022 data-ipsquote-username=\u0022Shadowmage\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n6 hours ago, Shadowmage said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nDisabling\u003Cspan\u003E\uFEFF\u003Cspan\u003E\uFEFF\u003C/span\u003E\u003C/span\u003E \u003Cspan\u003E\uFEFF\u003C/span\u003Eof HDR, or replacing all Stock shaders with Unity Standard shader fixes the transparency issues (but of course presents other shader related problems...).\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThank\u00A0 you \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/138730-shadowmage/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022138730\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/138730-shadowmage/\u0022 rel=\u0022\u0022\u003E@Shadowmage\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nHowever, hdr is obsolete, the following has replaced it:\n\u003C/p\u003E\n\u003Cp\u003E\nMarkerCam.allowHDR = false;\n\u003C/p\u003E\n"},{"CreatedByName":"Shadowmage","CreatedById":138730,"CreatedDateTime":"2019-02-15T01:33:14Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223540934\u0022 data-ipsquote-contentid=\u0022182167\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221550192142\u0022 data-ipsquote-userid=\u0022129964\u0022 data-ipsquote-username=\u0022linuxgurugamer\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n37 minutes ago, linuxgurugamer said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nNext, I set hdr = false\n\u003C/p\u003E\n\u003Cp\u003E\nand That fixed it\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nWeird random solutions wins again!\u00A0 \u003Cspan\u003E\u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cspan\u003ESeriously, some of the odd stuff that goes on in KSP/Unity...\u003C/span\u003E\n\u003C/p\u003E\n"},{"CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2019-02-15T02:11:40Z","Content":"\n\u003Cp\u003E\nSame problem was in NavHud and Kerbal Flight Indicators, same fix worked for both\n\u003C/p\u003E\n"},{"CreatedByName":"Zah","CreatedById":186900,"CreatedDateTime":"2019-02-15T18:39:03Z","Content":"\n\u003Cp\u003E\nCan confirm, fixed in all three mods.\n\u003C/p\u003E\n"}]}