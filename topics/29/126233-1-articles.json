{"TopicId":126233,"ForumId":29,"TopicTitle":"How can I find the amount of \u0026#039;lab data points\u0026#039; an experiment will produce?","CreatedByName":"SixHourDays","CreatedById":140711,"CreatedDateTime":"2015-11-23T03:39:35Z","PageNum":1,"Articles":[{"CreatedByName":"SixHourDays","CreatedById":140711,"CreatedDateTime":"2015-11-23T03:39:35Z","Content":"\nAh ModuleScienceLab, how you torment me so.\u003Cbr\u003E\n\u003Cbr\u003E\nI\u0026#39;d like to get the \u0026#39;lab data points\u0026#39; for a particular ScienceData, but neither the ScienceData nor the ModuleScienceLab will provide it to me.\u003Cbr\u003E\n\u003Cbr\u003E\n[LIST]\u003Cbr\u003E\n[*]KSP 1.0.4\u003Cbr\u003E\n[*]ship is a lab in orbit of Kerbin\u003Cbr\u003E\n[*]1 scientist in the lab\u003Cbr\u003E\n[*]we have a low-space goo Science Data\u003Cbr\u003E\n[*]that data is in the Goo, and [I]has not[/I] been copied to the lab\u003Cbr\u003E\n[*]there are no resource concerns: adequate power, lab has room to accept data, etc.\u003Cbr\u003E\n[/LIST]\u003Cbr\u003E\n\u003Cbr\u003E\nThe data is worth 20 pts of science, and 25 pts of \u0026#39;lab copy data\u0026#39;. I\u0026#39;d like to programmatically get that 25.\u003Cbr\u003E\nI checked the ScienceData.labValue (this seems like a relatively new member), but it\u0026#39;s zero.\u003Cbr\u003E\nI checked ModuleScienceLab.GetBoostForData(ScienceData d), but it\u0026#39;s also zero.\u003Cbr\u003E\n\u003Cbr\u003E\nHow can I retrieve the lab data points for a Science Data \u0026 Lab?\u003Cbr\u003E\n\u003Cbr\u003E\nPS - paging xEvilReeperx\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-11-23T23:43:03Z\u0022 title=\u002211/23/2015 11:43  PM\u0022 data-short=\u00228 yr\u0022\u003ENovember 23, 2015\u003C/time\u003E by SixHourDays\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2015-11-23T11:44:29Z","Content":"\nYou know, funny thing is that I haven\u0026#39;t really messed with the mobile lab since before 1.0 and didn\u0026#39;t even notice they changed things around on me. I don\u0026#39;t know why those methods were left in, they seem to be returning placeholder values now\u003Cbr\u003E\n\u003Cbr\u003E\nThis should do the trick (written for 1.0.5 but should work for 1.0.4):\u003Cbr\u003E\n[code]private static float CalculateLabData(Vessel vessel, ScienceData data)\u003Cbr\u003E\n{\u003Cbr\u003E\nif (vessel == null) throw new ArgumentNullException(\u0022vessel\u0022);\u003Cbr\u003E\nif (data == null) throw new ArgumentNullException(\u0022data\u0022);\u003Cbr\u003E\n\u003Cbr\u003E\n// note to self: apparently every lab returns same score, so I \u003Cbr\u003E\n// guess it doesn\u0026#39;t matter which we use?\u003Cbr\u003E\n//\u003Cbr\u003E\n// ps: the various multipliers are KSPFields so there\u0026#39;s a potential for a best\u003Cbr\u003E\n// candidate still if somebody tweaks them. Not going to deal with that now\u003Cbr\u003E\nvar lab = vessel.FindPartModulesImplementing\u0026lt;ModuleScienceLab\u0026gt;()\u003Cbr\u003E\n.FirstOrDefault();\u003Cbr\u003E\nvar subject = ResearchAndDevelopment.GetSubjectByID(data.subjectID);\u003Cbr\u003E\n\u003Cbr\u003E\nif (lab == null || subject == null) return 0f;\u003Cbr\u003E\n\u003Cbr\u003E\nvar refValue = ResearchAndDevelopment.GetReferenceDataValue(data.dataAmount, subject) * HighLogic.CurrentGame.Parameters.Career.ScienceGainMultiplier;\u003Cbr\u003E\n\u003Cbr\u003E\nreturn Mathf.Round(GetScienceLabMultiplier(lab, subject) * refValue);\u003Cbr\u003E\n}\u003Cbr\u003E\n\u003Cbr\u003E\nprivate static float GetScienceLabMultiplier(ModuleScienceLab lab, ScienceSubject subject)\u003Cbr\u003E\n{\u003Cbr\u003E\nvar multiplier = 1f;\u003Cbr\u003E\n\u003Cbr\u003E\n// lab can\u0026#39;t process data twice\u003Cbr\u003E\nif (lab.ExperimentData.Any(storedId =\u0026gt; storedId == subject.id)) return 0f;\u003Cbr\u003E\n\u003Cbr\u003E\nif (lab.vessel.Landed)\u003Cbr\u003E\nmultiplier *= 1f \u002B lab.SurfaceBonus;\u003Cbr\u003E\n\u003Cbr\u003E\nif (subject.id.Contains(lab.vessel.mainBody.bodyName))\u003Cbr\u003E\nmultiplier *= 1f \u002B lab.ContextBonus;\u003Cbr\u003E\n\u003Cbr\u003E\nif ((lab.vessel.Landed || lab.vessel.Splashed) \u0026\u0026\u003Cbr\u003E\nReferenceEquals(FlightGlobals.GetHomeBody(), lab.vessel.mainBody))\u003Cbr\u003E\nmultiplier *= lab.homeworldMultiplier; // lack of addition intended\u003Cbr\u003E\n\u003Cbr\u003E\nreturn multiplier;\u003Cbr\u003E\n}[/code]\u003Cbr\u003E\nLet me know if you find a bug in there, it looks eyeball right but I haven\u0026#39;t tested it extensively yet\n"},{"CreatedByName":"SixHourDays","CreatedById":140711,"CreatedDateTime":"2015-11-23T23:40:29Z","Content":"\nThanks so much! I didn\u0026#39;t think Squad would make me put this in explicitly...foolish me.\u003Cbr\u003E\n\u003Cbr\u003E\nYour code looks about right, except the \u0026#39;grounded\u0026#39; case should be Landed || Splashed for both if statements.\u003Cbr\u003E\n\u003Cbr\u003E\nAlso, can I hug you? HighLogic.CurrentGame.Parameters.Career.ScienceGainMultiplier has been sitting in my code as \u0022float m_hackICantFind = 2f;\u0022 for about 3 months now! It feels SOOOO good to know where the blazes that number comes from, finally!\u003Cbr\u003E\n\u003Cbr\u003E\nThanks so much for your help.\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2015-11-24T00:36:00Z","Content":"\nI did a double-take on that line too, but I used my binoculars to write that method and that\u0026#39;s how the game calculates it for some reason\n"}]}