{"TopicId":179878,"ForumId":29,"TopicTitle":"How To Update Part Appearance?","CreatedByName":"Electrocutor","CreatedById":109593,"CreatedDateTime":"2018-11-18T00:04:37Z","PageNum":1,"Articles":[{"CreatedByName":"Electrocutor","CreatedById":109593,"CreatedDateTime":"2018-11-18T00:04:37Z","Content":"\n\u003Cp\u003E\nSo... in a PartModule during the flight scene, the onLoad is the first method that fires that includes the config data for the PartModule; before this event, the KSPFields are newly initialized. However, the onLoad method fires after the part\u0027s models and textures have\u00A0already been drawn.\n\u003C/p\u003E\n\u003Cp\u003E\nOn the other hand, the first time onAwake fires is before the part is drawn, but there is no config data or fields available during the first fire because they have not loaded yet.\n\u003C/p\u003E\n\u003Cp\u003E\n----\n\u003C/p\u003E\n\u003Cp\u003E\nDoes anyone know a way around this issue or if there is another method somewhere to force the part to redraw?\n\u003C/p\u003E\n"},{"CreatedByName":"Benjamin Kerman","CreatedById":172792,"CreatedDateTime":"2018-11-18T00:48:17Z","Content":"\n\u003Cp\u003E\nMaybe try checking out some of the code of Kerbal Crash System?\u00A0\n\u003C/p\u003E\n\u003Ciframe allowfullscreen=\u0022\u0022 data-controller=\u0022core.front.core.autosizeiframe\u0022 data-embedcontent=\u0022\u0022 data-embedid=\u0022embed1832000287\u0022 scrolling=\u0022no\u0022 src=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/129410-13-kerbal-krash-system-042-2017-07-20/\u0026amp;do=embed\u0022 style=\u0022height:225px;max-width:502px;\u0022\u003E\u003C/iframe\u003E\n\u003Cp\u003E\nIt does part deformation and probably model changing as well.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nEDIT: Reading through the code, it looks like Enzo used\u00A0\u003Ca href=\u0022https://github.com/EnzoMeertens/KerbalKrashSystem/blob/master/Source/KerbalKrashSystem/KerbalKrashSystem/KerbalKrashSystem.cs#L401\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/EnzoMeertens/KerbalKrashSystem/blob/master/Source/KerbalKrashSystem/KerbalKrashSystem/KerbalKrashSystem.cs#L401\u003C/a\u003E\u00A0to change the shape of the part, and a similar function (called a couple lines above) to change the collider.\u00A0\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222018-11-18T01:01:51Z\u0022 title=\u002211/18/2018 01:01  AM\u0022 data-short=\u00225 yr\u0022\u003ENovember 18, 2018\u003C/time\u003E by Benjamin Kerman\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Electrocutor","CreatedById":109593,"CreatedDateTime":"2018-11-20T18:19:09Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223489232\u0022 data-ipsquote-contentid=\u0022179878\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221542502097\u0022 data-ipsquote-userid=\u0022172792\u0022 data-ipsquote-username=\u0022Benjamin Kerman\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nOn 11/17/2018 at 6:48 PM, Benjamin Kerman said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nMaybe try checking out some of the code of Kerbal Crash System?\u00A0\n\u003C/p\u003E\n\u003Ciframe allowfullscreen=\u0022\u0022 data-controller=\u0022core.front.core.autosizeiframe\u0022 data-embedcontent=\u0022\u0022 data-embedid=\u0022embed9384333182\u0022 scrolling=\u0022no\u0022 src=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/129410-13-kerbal-krash-system-042-2017-07-20/\u0026amp;do=embed\u0022 style=\u0022height:227px;max-width:502px;\u0022\u003E\u003C/iframe\u003E\n\u003Cp\u003E\nIt does part deformation and probably model changing as well.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nEDIT: Reading through the code, it looks like Enzo used\u00A0\u003Ca href=\u0022https://github.com/EnzoMeertens/KerbalKrashSystem/blob/master/Source/KerbalKrashSystem/KerbalKrashSystem/KerbalKrashSystem.cs#L401\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/EnzoMeertens/KerbalKrashSystem/blob/master/Source/KerbalKrashSystem/KerbalKrashSystem/KerbalKrashSystem.cs#L401\u003C/a\u003E\u00A0to change the shape of the part, and a similar function (called a couple lines above) to change the collider.\u00A0\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThanks, but I\u0027m aware that you can directly mess with meshes and transforms; what\u00A0I need is to actually run through the default stock code as if it were in the part\u0027s config from the beginning.\n\u003C/p\u003E\n\u003Cp\u003E\nOddly enough this works fine when you revert to the Editor, but the flight mode runs PartModule methods in a different order.\n\u003C/p\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2018-11-21T02:46:47Z","Content":"\n\u003Cp\u003E\nCan you be more specific about what you\u0027re trying to do? There isn\u0027t any code related to the part\u0027s appearance itself before PartModules start getting loaded. The part prefab is instantiated as is and then PartModules do the thing, one of which may be to modify the part\u0027s appearance.\n\u003C/p\u003E\n\u003Cp\u003E\nWhy can\u0027t you modify the part inside OnLoad? I\u0027m fairly sure that fires in the same frame as when the part itself is created, so changing part appearance there is fine and the user will never notice\n\u003C/p\u003E\n"},{"CreatedByName":"Shadowmage","CreatedById":138730,"CreatedDateTime":"2018-11-21T17:29:23Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223490761\u0022 data-ipsquote-contentid=\u0022179878\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221542737949\u0022 data-ipsquote-userid=\u0022109593\u0022 data-ipsquote-username=\u0022Electrocutor\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n23 hours ago, Electrocutor said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nOddly enough this works fine when you revert to the Editor, but the flight mode runs PartModule methods in a different order.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nIn all of my texture-set manipulation code, I have to run it both during OnStart, and OnLoad (usually with a quick \u0027isInitialized\u0027 to only run it once, from whichever method is actually called first).\n\u003C/p\u003E\n\u003Cp\u003E\nSometimes one is called, but not the other.\u00A0 Good luck figuring out when each one is called -- its a big mixed up mess depending on how the part is instantiated (and if is a revert, or a reload).\n\u003C/p\u003E\n"},{"CreatedByName":"Electrocutor","CreatedById":109593,"CreatedDateTime":"2018-11-21T17:39:32Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223491074\u0022 data-ipsquote-contentid=\u0022179878\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221542768407\u0022 data-ipsquote-userid=\u002275857\u0022 data-ipsquote-username=\u0022xEvilReeperx\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n14 hours ago, xEvilReeperx said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nCan you be more specific about what you\u0027re trying to do? There isn\u0027t any code related to the part\u0027s appearance itself before PartModules start getting loaded. The part prefab is instantiated as is and then PartModules do the thing, one of which may be to modify the part\u0027s appearance.\n\u003C/p\u003E\n\u003Cp\u003E\nWhy can\u0027t you modify the part inside OnLoad? I\u0027m fairly sure that fires in the same frame as when the part itself is created, so changing part appearance there is fine and the user will never notice\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nDuring flight, onLoad fires AFTER the part has already been read-in and drawn (reading in mesh, model, rescaleFactor, scale, attach nodes, etc). I need to adjust things before it has been created and set. The reason is because modifying something after the fact by forcibly changing transform sizes, positions,\u00A0or other things (like Tweakscale) is very prone to breaking between version when they change something and unexpected behavior. If you modify those things before it is loaded, then the game just sees it having been that way from the start and everything works normally no matter what was changed.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223491459\u0022 data-ipsquote-contentid=\u0022179878\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221542821363\u0022 data-ipsquote-userid=\u0022138730\u0022 data-ipsquote-username=\u0022Shadowmage\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n7 minutes ago, Shadowmage said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nIn all of my texture-set manipulation code, I have to run it both during OnStart, and OnLoad (usually with a quick \u0027isInitialized\u0027 to only run it once, from whichever method is actually called first).\n\u003C/p\u003E\n\u003Cp\u003E\nSometimes one is called, but not the other.\u00A0 Good luck figuring out when each one is called -- its a big mixed up mess depending on how the part is instantiated (and if is a revert, or a reload).\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nonStart fires long after onLoad. Oddly enough, onInitialize also fire after onLoad. The only option I can think is to manually pull data out from the persistence file myself during onAwake: which is horribly nasty/ugly.\n\u003C/p\u003E\n"},{"CreatedByName":"Shadowmage","CreatedById":138730,"CreatedDateTime":"2018-11-21T19:12:34Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223491462\u0022 data-ipsquote-contentid=\u0022179878\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221542821972\u0022 data-ipsquote-userid=\u0022109593\u0022 data-ipsquote-username=\u0022Electrocutor\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n1 hour ago, Electrocutor said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nDuring flight, onLoad fires AFTER the part has already been read-in and drawn\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nI have no problem applying textures/etc in flight scene using the OnLoad method.\u00A0 It does not result in any flickering/etc; everything appears to be applied before the first Update is called / before the first frame is rendered.\u00A0 This is how I restore persistent textures/user settings/etc in TexturesUnlimited.\n\u003C/p\u003E\n\u003Cp\u003E\nWhat precisely are you trying to change that isn\u0027t working / what issues are you running into when using OnLoad/OnStart?\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"Electrocutor","CreatedById":109593,"CreatedDateTime":"2018-11-21T19:19:22Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223491505\u0022 data-ipsquote-contentid=\u0022179878\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221542827554\u0022 data-ipsquote-userid=\u0022138730\u0022 data-ipsquote-username=\u0022Shadowmage\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n4 minutes ago, Shadowmage said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nI have no problem applying textures/etc in flight scene using the OnLoad method.\u00A0 It does not result in any flickering/etc; everything appears to be applied before the first Update is called / before the first frame is rendered.\u00A0 This is how I restore persistent textures/user settings/etc in TexturesUnlimited.\n\u003C/p\u003E\n\u003Cp\u003E\nWhat precisely are you trying to change that isn\u0027t working / what issues are you running into when using OnLoad/OnStart?\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nMany things: the current is to set rescaleFactor and scaleFactor. These both work onLoad when reverting to the editor, but not when starting flight. If I force set them to some number in onAwake (before KSP has set the PartModule fields), it works in all scenarios, but this means I would have to find and load my persistent values myself because KSP hasn\u0027t set them yet.\n\u003C/p\u003E\n"},{"CreatedByName":"Shadowmage","CreatedById":138730,"CreatedDateTime":"2018-11-21T19:31:53Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223491509\u0022 data-ipsquote-contentid=\u0022179878\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221542827962\u0022 data-ipsquote-userid=\u0022109593\u0022 data-ipsquote-username=\u0022Electrocutor\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n4 minutes ago, Electrocutor said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nMany things: the current is to set rescaleFactor and scaleFactor. These both work onLoad when reverting to the editor, but not when starting flight. If I force set them to some number in onAwake (before KSP has set the PartModule fields), it works in all scenarios, but this means I would have to find and load my persistent values myself because KSP hasn\u0027t set them yet.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nAhh, yep, that kind of stuff.\u00A0 Can certainly see the problem there.\u00A0 I think the issues is less that \u0027things have already been rendered\u0027 (as they have \u003Cem\u003Enot \u003C/em\u003Eyet been rendered, until at least after Update() has been called), and more that \u0027stock code will not update model scales after model is loaded into the part, which happens prior to any PartModule code running\u0027 combined with \u0027rescaleFactor is not a persistent value and has to be set prior to stock code loading the model so can\u0027t fix it in the prefab or persistent data for a craft\u0027.\n\u003C/p\u003E\n\u003Cp\u003E\nHmmm... definitely a problem there.\n\u003C/p\u003E\n\u003Cp\u003E\nIIRC the way that Tweakscale/etc works around this issue is to go back in and manually adjust the model scale and node positions during the OnLoad/OnStart calls, by manipulating the \u0027localScale\u0027 of the model transforms directly.\u00A0 This is basically what the stock code does as it loads the models for the part.\u00A0 Might be a solution for your immediate problem, but isn\u0027t really a general answer on how to work around stock code order-of-loading quirks.\n\u003C/p\u003E\n"},{"CreatedByName":"Electrocutor","CreatedById":109593,"CreatedDateTime":"2018-11-21T19:36:47Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223491517\u0022 data-ipsquote-contentid=\u0022179878\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221542828713\u0022 data-ipsquote-userid=\u0022138730\u0022 data-ipsquote-username=\u0022Shadowmage\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n3 minutes ago, Shadowmage said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nAhh, yep, that kind of stuff.\u00A0 Can certainly see the problem there.\u00A0 I think the issues is less that \u0027things have already been rendered\u0027 (as they have \u003Cem\u003Enot \u003C/em\u003Eyet been rendered, until at least after Update() has been called), and more that \u0027stock code will not update model scales after model is loaded into the part, which happens prior to any PartModule code running\u0027 combined with \u0027rescaleFactor is not a persistent value and has to be set prior to stock code loading the model so can\u0027t fix it in the prefab or persistent data for a craft\u0027.\n\u003C/p\u003E\n\u003Cp\u003E\nHmmm... definitely a problem there.\n\u003C/p\u003E\n\u003Cp\u003E\nIIRC the way that Tweakscale/etc works around this issue is to go back in and manually adjust the model scale and node positions during the OnLoad/OnStart calls, by manipulating the \u0027localScale\u0027 of the model transforms directly.\u00A0 This is basically what the stock code does as it loads the models for the part.\u00A0 Might be a solution for your immediate problem, but isn\u0027t really a general answer on how to work around stock code order-of-loading quirks.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nLike I said, setting rescaleFactor and scaleFactor during the onAwake of the PartModule works fine. So it just becomes a matter of me going out to get my persistent values myself. I had just wondered if there was universal \u0022re-make this part\u0027 method call: as obviously it is re-read when you revert from flight to editor.\n\u003C/p\u003E\n"}]}