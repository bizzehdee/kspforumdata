{"TopicId":77708,"ForumId":29,"TopicTitle":"Setting SAS lock direction (How does VesselSAS work))","CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-07-15T13:41:45Z","PageNum":1,"Articles":[{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-07-15T13:41:45Z","Content":"\n\u003Cp\u003EOkay. I\u0027m pretty sure this is really a question about quanterions, but for the record what I am doing is trying to set the SAS lock vector.\u003C/p\u003E\u003Cp\u003EI am working in the VesselSAS class and there are 2 things of note in the object brower:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003ELockHeading(quanterion); \u0026lt;- Method to set the direction of the SAS lock direction\u003Cbr\u003EreferenceHeading \u0026lt;-quanterion property that is the SAS \u0027zero\u0027\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EWhen I do a referenceHeading.euler it returns 0,90,0 and when I set the LockHeading to a zero\u0027d quanterion (0,0,0,0), my vessel locks heading to due east when on the KSC pad so I believe the referenceHeading.euler I can turn into a world co-ordinate vector.\u003C/p\u003E\u003Cp\u003EI then have a world direction Vector3 with an origin at my vessel.transform.position that is the direction I want to set the SAS heading too, but I can\u0027t get this to work.\u003C/p\u003E\u003Cp\u003EI\u0027m pretty sure I need to get the rotation between the SAS reference position (a quanterion) and my desired heading, then apply it to a new, zero\u0027d quanterion, then set my lock heading to that quanterion after I rotate it.\u003C/p\u003E\u003Cp\u003EMy problem is how do I get the rotation I need from the Vector 3 as a quanterion?\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-07-16T04:17:13Z\u0022 title=\u002207/16/2014 04:17  AM\u0022 data-short=\u00229 yr\u0022\u003EJuly 16, 2014\u003C/time\u003E by Diazo\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"NathanKell","CreatedById":75006,"CreatedDateTime":"2014-07-15T20:36:10Z","Content":"\n\u003Cp\u003EYou should be able to construct a quaternion from a vector direction and a rotation around the axis. See what constructors the Quaternion class offers.\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-07-16T02:36:46Z","Content":"\n\u003Cp\u003EAlright, this is absolutely stonewalling me.\u003C/p\u003E\u003Cp\u003EDoes anyone know of a mod that has worked with the VesselSAS class that I could use for pointers? A quick glance at both MechJeb and kOS\u0027s source code makes it look like they don\u0027t use it, they point the vessel with their own code.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n"},{"CreatedByName":"Phooge","CreatedById":116212,"CreatedDateTime":"2014-07-21T09:04:31Z","Content":"\n\u003Cp\u003EHi Diazo,\u003C/p\u003E\u003Cp\u003EI\u0027ve been looking at SAS aswell. You can create the quaternation in the direction of the vector using: quaternation.lookRotation(vector3). \u003C/p\u003E\u003Cp\u003EYou can also look at the source of Mechjeb, MechJebModuleAttitudeController.cs. It has a bit with the stock SAS. I don\u0027t exactly get what they are doing, but maby you can figure it out:)\u003C/p\u003E\u003Cp\u003ERegards,\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-07-21T13:47:40Z","Content":"\n\u003Cp\u003EI ended up getting this working, but it was more trial and error then anything.\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022https://github.com/SirDiazo/RCSLandAid/blob/master/RCSLandAid/RCSLandAid.cs#L193\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/SirDiazo/RCSLandAid/blob/master/RCSLandAid/RCSLandAid.cs#L193\u003C/a\u003E is my code for reference but I ended up using:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003EFlightGlobals.ActiveVessel.VesselSAS.LockHeading(refQuant, true);\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EThe true is a boolean meaning I am using Manual Lock, whatever that is. It works so I\u0027m not arguing.\u003C/p\u003E\u003Cp\u003ErefQuant is a quaterion, but the up direction matters. I also could not figure out how the direction works.\u003C/p\u003E\u003Cp\u003ETo lock the SAS straight up for a typical rocket, refQuant is \u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003EQuaternion.LookRotation(worldUp, vslUpRef) * vslRefQuant;\u003C/pre\u003E\u003Cp\u003E where worldUp is a Vector3 from the planet\u0027s CoM through the vessel\u0027s CoM, vslUpRef is FlightGlobal.ActiveVessel.transform.up and vslRefQuant is Quaternion.Euler(90, 0, 0).\u003C/p\u003E\u003Cp\u003EIt took a lot of guess and test to reach that and I don\u0027t really get what is all means.\u003C/p\u003E\u003Cp\u003EI was able to shortcut because using only the 90\u00C3\u201A\u00C2\u00B0 axis angles makes things simple, but this was still a big headache to figure out.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n"},{"CreatedByName":"Phooge","CreatedById":116212,"CreatedDateTime":"2014-07-21T16:04:00Z","Content":"\n\u003Cp\u003EAfter playing around with it some more today, I came up with pretty much the same solution. And I also haven\u0027t got a clue what the manual lock is:) \u003C/p\u003E\u003Cp\u003EThe mechjeb code also uses the Quaternation.Euler(90,0,0), so i gues that is the right way.\u003C/p\u003E\u003Cp\u003E I did find a way prevent the SAS to go mad when you set it:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003EcurrentHeading = Quaternion.LookRotation(vessel.transform.up) * Quaternion.Euler(90,0,0);\u003Cbr\u003EtargetHeading = Quaternion.LookRotation(targetVector) * Quaternion.Euler(90,0,0);\u003Cbr\u003E\u003Cbr\u003Eif (Quaternion.Angle(currentHeading, targetHeading) \u0026gt; 10)\u003Cbr\u003E            {\u003Cbr\u003E                target = Quaternion.RotateTowards(currentHeading, targetHeading, 2f); \u003Cbr\u003E            }\u003Cbr\u003E            else\u003Cbr\u003E{\u003Cbr\u003E            target = Quaternion.LookRotation(targetHeading);\u003Cbr\u003E            }\u003Cbr\u003E\u003Cbr\u003Epart.vessel.VesselSAS.LockHeading(target, true);\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EHope this makes sense.\u003C/p\u003E\n"},{"CreatedByName":"pixartist","CreatedById":67922,"CreatedDateTime":"2014-10-18T23:08:36Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Phooge\u0022 data-cite=\u0022Phooge\u0022\u003E\u003Cdiv\u003EAfter playing around with it some more today, I came up with pretty much the same solution. And I also haven\u0027t got a clue what the manual lock is:) \u003Cp\u003EThe mechjeb code also uses the Quaternation.Euler(90,0,0), so i gues that is the right way.\u003C/p\u003E\u003Cp\u003E I did find a way prevent the SAS to go mad when you set it:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003EcurrentHeading = Quaternion.LookRotation(vessel.transform.up) * Quaternion.Euler(90,0,0);\u003Cbr\u003EtargetHeading = Quaternion.LookRotation(targetVector) * Quaternion.Euler(90,0,0);\u003Cbr\u003E\u003Cbr\u003Eif (Quaternion.Angle(currentHeading, targetHeading) \u0026gt; 10)\u003Cbr\u003E            {\u003Cbr\u003E                target = Quaternion.RotateTowards(currentHeading, targetHeading, 2f); \u003Cbr\u003E            }\u003Cbr\u003E            else\u003Cbr\u003E{\u003Cbr\u003E            target = Quaternion.LookRotation(targetHeading);\u003Cbr\u003E            }\u003Cbr\u003E\u003Cbr\u003Epart.vessel.VesselSAS.LockHeading(target, true);\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EHope this makes sense.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EHi, what kind of values does your \u0022targetVector\u0022 take ? Are they basically navball values ?\u003C/p\u003E\n"}]}