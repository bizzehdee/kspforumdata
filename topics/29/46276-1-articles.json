{"TopicId":46276,"ForumId":29,"TopicTitle":"Read .cfg file value from Vessel.Parts list","CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2013-09-18T02:55:27Z","PageNum":1,"Articles":[{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2013-09-18T02:55:27Z","Content":"\n\u003Cp\u003EAlright.\u003C/p\u003E\u003Cp\u003EThis is probably about as simple as you can get, but it has stymied me for 3 hours now so here we go.\u003C/p\u003E\u003Cp\u003EI have my current vessel and it\u0027s list of parts from Vessel.Parts\u003C/p\u003E\u003Cp\u003EI am able to find which parts have a ModuleEngines node, but I\u0027m trying to tell apart Solid Rocket Boosters which requires looking at the throttleLocked value in the ModuleEngines config node and am absolutely stuck.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Enamespace TWR1\u003Cbr\u003E{\u003Cbr\u003E    [KSPAddon(KSPAddon.Startup.Flight, false)]\u003Cbr\u003E    public class TWR1 : PartModule\u003Cbr\u003E    {\u003Cbr\u003E        private static Vessel TWR1Vessel; //Our active vessel\u003Cbr\u003E\u003Cbr\u003E        public void Update()\u003Cbr\u003E        {\u003Cbr\u003E            TWR1Vessel = FlightGlobals.ActiveVessel; //Set vessel to active vessel\u003Cbr\u003E            foreach (Part part in TWR1Vessel.Parts)\u003Cbr\u003E            { \u003Cbr\u003E               print(part.Modules.Contains(\u0022ModuleEngines\u0022)); //will print \u0022True\u0022 to debug log if a part\u0027s .cfg file has a module named \u0022ModuleEngines\u0022\u003Cbr\u003E               //unknown code here to tell Solid Rocket Boosts apart\u003Cbr\u003E        }\u003Cbr\u003E   }\u003Cbr\u003E}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EI\u0027ve left out a bunch of code to keep focused on my question, as is this will spam your debug log every update with a true/false message for every part on your vessel.\u003C/p\u003E\u003Cp\u003ENow, how do I look at the throttleLocked key if Contains(ModuleEngines) evaluates to true? I think I need to use part.Fields.GetValue or part.Fields.ReadValue but I\u0027ve been trying variations of that for 3 hours now and am out of ideas.\u003C/p\u003E\u003Cp\u003EAnyone know what those methods are expecting? Passing \u0022ModuleEngines\u0022 or \u0022throttleLocked\u0022 returns a not found error.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\u003Cp\u003Eedit: Actually it looks like I need to use the part.Module. class somehow to do this. \u003C/p\u003E\u003Cp\u003EAll I\u0027m after is the throttleLocked = true for solid rocket boosters if someone knows a better way to check this.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-09-18T04:15:35Z\u0022 title=\u002209/18/2013 04:15  AM\u0022 data-short=\u002210 yr\u0022\u003ESeptember 18, 2013\u003C/time\u003E by Diazo\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2013-09-18T04:38:13Z","Content":"\n\u003Cp\u003EHere\u0027s what I came up with, it should get you there\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Eforeach (Part part in FlightGlobals.ActiveVessel.parts)\u003Cbr\u003E    foreach (PartModule module in part.Modules.OfType\u0026lt;ModuleEngines\u0026gt;())\u003Cbr\u003E    {\u003Cbr\u003E        ModuleEngines engine = module as ModuleEngines;\u003Cbr\u003E\u003Cbr\u003E        // propellant type\u003Cbr\u003E        foreach (ModuleEngines.Propellant propellant in engine.propellants)\u003Cbr\u003E            UnityEngine.Debug.Log(\u0022Engine \u0027\u0022 \u002B part.name \u002B \u0022\u0027 uses \u0022 \u002B propellant.name);\u003Cbr\u003E\u003Cbr\u003E        UnityEngine.Debug.Log(\u0022Can you shut it down? \u0022 \u002B (engine.allowShutdown ? \u0022yes\u0022 : \u0022no\u0022));\u003Cbr\u003E        UnityEngine.Debug.Log(\u0022Can you change its throttle? \u0022 \u002B (engine.throttleLocked ? \u0022yes\u0022 : \u0022no\u0022));\u003Cbr\u003E    }\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n"},{"CreatedByName":"JDP","CreatedById":30775,"CreatedDateTime":"2013-09-18T08:18:48Z","Content":"\n\u003Cp\u003Eif you are solely working with loaded vessels/parts, you could just use typecasting (like suggested above). If the part isn\u0027t loaded, you\u0027ll need to access the ConfigNode generated from the part config file. If memory serves, you\u0027ll need to do something like this:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E        if (vessel.loaded) {\u003Cbr\u003E            foreach (Part p in vessel.parts)\u003Cbr\u003E                if (p.Modules.Contains(\u0022ModuleEngines\u0022) \u0026amp;\u0026amp; (p.Modules[\u0022ModuleEngines\u0022] as ModuleEngines).throttleLocked) {\u003Cbr\u003E                    //do stuff.\u003Cbr\u003E                }\u003Cbr\u003E        } else {\u003Cbr\u003E            foreach (ProtoPartSnapshot p in vessel.protoVessel.protoPartSnapshots) {\u003Cbr\u003E                if (p.partInfo.internalConfig.HasNode(\u0022ModuleEngines\u0022) \u0026amp;\u0026amp;\u003Cbr\u003E                    bool.Parse(p.partInfo.internalConfig.GetNode(\u0022ModuleEngines\u0022).GetValue(\u0022throttleLocked\u0022))) {\u003Cbr\u003E                    //do stuff.\u003Cbr\u003E                }\u003Cbr\u003E            }\u003Cbr\u003E        }\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EYou cannot simply look through the persistence data (look into RT1 source \u003Ca href=\u0022https://github.com/JDPKSP/RemoteTech/blob/master/RelayNode.cs#L21-72\u0022 rel=\u0022external nofollow\u0022\u003Ehere \u003C/a\u003E for example) since throttleLocked is not a persistant field.\u003C/p\u003E\u003Cp\u003EI\u0027m not entirely certain that p.partInfo.internalConfig is in fact the configNode you\u0027ll need, since I\u0027ve never had use of it. Neither have I checked under which circumstances it is loaded. It is however an informed guess. Play around with it a bit and see what works.\u003C/p\u003E\u003Cp\u003EIn the case that you are only working with loaded vessels (ie.: FlightGlobals.ActiveVessel), you won\u0027t need anything more than the simple typecast.\u003C/p\u003E\n"},{"CreatedByName":"Michael Kim","CreatedById":38782,"CreatedDateTime":"2013-09-18T08:42:28Z","Content":"\n\u003Cp\u003EFirst of all, since you are dealing with a loaded vessel, there is nothing to do with the .cfg file, so make sure you understand that first.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Eforeach (Part p in FlightGlobals.ActiveVessel.Parts)\u003Cbr\u003E    foreach (PartModule pm in p.Modules)\u003Cbr\u003E        if (pm is ModuleEngines)\u003Cbr\u003E        {\u003Cbr\u003E            bool locked = ((ModuleEngines)pm).throttleLocked;\u003Cbr\u003E            // stuff\u003Cbr\u003E        }\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2013-09-18T13:48:33Z","Content":"\n\u003Cp\u003EWow, thanks for the replies everyone.\u003C/p\u003E\u003Cp\u003EAll 3 examples look promising and they all have something new for me to learn.\u003C/p\u003E\u003Cp\u003EI\u0027ll try them out tonight and see which fits with what I\u0027m trying to do. (I\u0027m cheating and posting from work so no access to KSP until later for me.)\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n"},{"CreatedByName":"pinkdragon","CreatedById":87691,"CreatedDateTime":"2013-12-04T16:14:56Z","Content":"\n\u003Cp\u003EI\u0027d still be interested if anyone can help tell me how to read the part\u0027s .cfg file. There\u0027s some valuable info there.\u003C/p\u003E\n"},{"CreatedByName":"UbioZur","CreatedById":72946,"CreatedDateTime":"2013-12-04T17:43:01Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022pinkdragon\u0022 data-cite=\u0022pinkdragon\u0022\u003E\u003Cdiv\u003EI\u0027d still be interested if anyone can help tell me how to read the part\u0027s .cfg file. There\u0027s some valuable info there.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EHave a look at my \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/38577-0-22-UbioZur-Welding-Ltd-2-0-Playtest-4-Now-In-Game-Tool\u0022 rel=\u0022external nofollow\u0022\u003Eweld tool\u003C/a\u003E code (source in the download), It\u0027s not the most efficient, but it works (most of the time).\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2013-12-09T16:43:32Z","Content":"\n\u003Cp\u003EHere\u0027s the code I ended up running with.\u003C/p\u003E\u003Cp\u003EThis code does two checks, first seeing if the part has a \u0022ModuleEngines\u0022, and if it does, it checks to see if the value \u0022throttleLocked\u0022 is true.\u003C/p\u003E\u003Cp\u003EI then get add the min and max thrust of the engine to the available thrust of the craft for later calculations.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Eforeach (Part part in TWR1Vessel.Parts) //go through each part on vessel. Part is of type Parts, part is the list container\u003Cbr\u003E{\u003Cbr\u003E   if (part.Modules.Contains(\u0022ModuleEngines\u0022)) //does this Part have a ModuleEngine, meaning it is an engine?\u003Cbr\u003E   {\u003Cbr\u003E      foreach (PartModule TWR1PartModule in part.Modules) //this Part has a ModuleEngines, move from the Part to the PartModules level\u003Cbr\u003E      {\u003Cbr\u003E         if (TWR1PartModule.moduleName == \u0022ModuleEngines\u0022) //find the ModuleEngine PartModule\u003Cbr\u003E         {\u003Cbr\u003E            TWR1EngineModule = (ModuleEngines)TWR1PartModule; //change from the PartModules level to the ModuleEngines level\u003Cbr\u003E            if ((bool)TWR1PartModule.Fields.GetValue(\u0022throttleLocked\u0022) \u0026amp;\u0026amp; TWR1EngineModule.isOperational) //if throttlelocked is true, this is solid rocket booster. then check engine is operational. if the engine is flamedout, disabled via-right click or not yet activated via stage control, isOperational returns false. This will return false if throttleLocked does not exist.\u003Cbr\u003E            {\u003Cbr\u003E               TWR1MaxThrust \u002B= (float)(TWR1PartModule.Fields.GetValue(\u0022maxThrust\u0022)); //add engine thrust to MaxThrust\u003Cbr\u003E               TWR1MinThrust \u002B= (float)(TWR1PartModule.Fields.GetValue(\u0022maxThrust\u0022)); //add engine thrust to MinThrust since this is an SRB and is always at Max thrust\u003Cbr\u003E             }\u003Cbr\u003E             else if (TWR1EngineModule.isOperational)//we know it is an engine and not a solid rocket booster so:\u003Cbr\u003E             {\u003Cbr\u003E                TWR1MaxThrust \u002B= (float)(TWR1PartModule.Fields.GetValue(\u0022maxThrust\u0022)); //add engine thrust to MaxThrust\u003Cbr\u003E                TWR1MinThrust \u002B= (float)(TWR1PartModule.Fields.GetValue(\u0022minThrust\u0022)); //add engine thrust to MinThrust, stock engines all have min thrust of zero, but mods may not be 0\u003Cbr\u003E                }\u003Cbr\u003E             }\u003Cbr\u003E        }\u003Cbr\u003E    }\u003Cbr\u003E}\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EThe big limitation here is I\u0027ve hardcoded the stuff I\u0027m looking for as I\u0027m very specific in what I\u0027m looking for.\u003C/p\u003E\u003Cp\u003EDepending on what you end up wanting, you may be looking at going through a part multiple times for different values, or chaining IFs together to get the info you want.\u003C/p\u003E\u003Cp\u003EHope that helps,\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n"},{"CreatedByName":"udk_lethal_d0se","CreatedById":62149,"CreatedDateTime":"2013-12-09T16:53:44Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022pinkdragon\u0022 data-cite=\u0022pinkdragon\u0022\u003E\u003Cdiv\u003EI\u0027d still be interested if anyone can help tell me how to read the part\u0027s .cfg file. There\u0027s some valuable info there.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI\u0027m sure someone will let me know if this is wrong, but if you want to read certain info from the config file, I\u0027d suggest looking at: part.partInfo...\u003C/p\u003E\n"},{"CreatedByName":"NathanKell","CreatedById":75006,"CreatedDateTime":"2013-12-09T22:46:23Z","Content":"\n\u003Cp\u003ESeems like there\u0027s two questions here:\u003C/p\u003E\u003Cp\u003E1. How do I read part info\u003C/p\u003E\u003Cp\u003E2. How do I read from the cfg itself, rather than what\u0027s loaded into the game.\u003C/p\u003E\u003Cp\u003EEvery recognized line in a part.cfg file is loaded into the part object or its various modules or PartInfo object or whatever. The above code examples talk about how to get that. But if you actually want to read the cfg file you need to first find the confignode that is that part (i.e. find all PART confignodes, then find one with the value name where name == the part\u0027s id). Then you can getvalue for whatever property you want, and/or getnode if you want a subnode (like MODULE or INTERNAL or whatever).\u003C/p\u003E\n"},{"CreatedByName":"toadicus","CreatedById":67745,"CreatedDateTime":"2013-12-09T22:48:04Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Diazo\u0022 data-cite=\u0022Diazo\u0022\u003E\u003Cdiv\u003EHere\u0027s the code I ended up running with.\u003Cp\u003EThis code does two checks, first seeing if the part has a \u0022ModuleEngines\u0022, and if it does, it checks to see if the value \u0022throttleLocked\u0022 is true.\u003C/p\u003E\u003Cp\u003EI then get add the min and max thrust of the engine to the available thrust of the craft for later calculations.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Eforeach (Part part in TWR1Vessel.Parts) //go through each part on vessel. Part is of type Parts, part is the list container\u003Cbr\u003E{\u003Cbr\u003E   if (part.Modules.Contains(\u0022ModuleEngines\u0022)) //does this Part have a ModuleEngine, meaning it is an engine?\u003Cbr\u003E   {\u003Cbr\u003E      foreach (PartModule TWR1PartModule in part.Modules) //this Part has a ModuleEngines, move from the Part to the PartModules level\u003Cbr\u003E      {\u003Cbr\u003E         if (TWR1PartModule.moduleName == \u0022ModuleEngines\u0022) //find the ModuleEngine PartModule\u003Cbr\u003E         {\u003Cbr\u003E            TWR1EngineModule = (ModuleEngines)TWR1PartModule; //change from the PartModules level to the ModuleEngines level\u003Cbr\u003E            if ((bool)TWR1PartModule.Fields.GetValue(\u0022throttleLocked\u0022) \u0026amp;\u0026amp; TWR1EngineModule.isOperational) //if throttlelocked is true, this is solid rocket booster. then check engine is operational. if the engine is flamedout, disabled via-right click or not yet activated via stage control, isOperational returns false. This will return false if throttleLocked does not exist.\u003Cbr\u003E            {\u003Cbr\u003E               TWR1MaxThrust \u002B= (float)(TWR1PartModule.Fields.GetValue(\u0022maxThrust\u0022)); //add engine thrust to MaxThrust\u003Cbr\u003E               TWR1MinThrust \u002B= (float)(TWR1PartModule.Fields.GetValue(\u0022maxThrust\u0022)); //add engine thrust to MinThrust since this is an SRB and is always at Max thrust\u003Cbr\u003E             }\u003Cbr\u003E             else if (TWR1EngineModule.isOperational)//we know it is an engine and not a solid rocket booster so:\u003Cbr\u003E             {\u003Cbr\u003E                TWR1MaxThrust \u002B= (float)(TWR1PartModule.Fields.GetValue(\u0022maxThrust\u0022)); //add engine thrust to MaxThrust\u003Cbr\u003E                TWR1MinThrust \u002B= (float)(TWR1PartModule.Fields.GetValue(\u0022minThrust\u0022)); //add engine thrust to MinThrust, stock engines all have min thrust of zero, but mods may not be 0\u003Cbr\u003E                }\u003Cbr\u003E             }\u003Cbr\u003E        }\u003Cbr\u003E    }\u003Cbr\u003E}\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EThe big limitation here is I\u0027ve hardcoded the stuff I\u0027m looking for as I\u0027m very specific in what I\u0027m looking for.\u003C/p\u003E\u003Cp\u003EDepending on what you end up wanting, you may be looking at going through a part multiple times for different values, or chaining IFs together to get the info you want.\u003C/p\u003E\u003Cp\u003EHope that helps,\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EHere\u0027s a cleaner (looking) way to do that with LINQ. I don\u0027t know enough about LINQ to know if it\u0027s actually any better or faster. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif\u0022 alt=\u0022:wink:\u0022\u003E\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Efloat maxThrust;\u003Cbr\u003Efloat minThrust;\u003Cbr\u003E\u003Cbr\u003Eforeach (ModuleEngines EngineModule in TWR1Vessel.Parts\u003Cbr\u003E\t.SelectMany(p =\u0026gt; p.Modules.Cast\u0026lt;PartModule\u0026gt;())\u003Cbr\u003E\t.Where(m =\u0026gt; m.moduleName == \u0022ModuleEngines\u0022)\u003Cbr\u003E\t.Select(m =\u0026gt; m as ModuleEngines)\u003Cbr\u003E\t.Where(m =\u0026gt; m.isOperational))\u003Cbr\u003E{\u003Cbr\u003E\tmaxThrust = EngineModule.maxThrust;\u003Cbr\u003E\u003Cbr\u003E\tif (EngineModule.throttleLocked)\u003Cbr\u003E\t{\u003Cbr\u003E\t\t// This is an SRB; its minThrust is the same as its maxThrust\u003Cbr\u003E\t\tminThrust = EngineModule.maxThrust;\u003Cbr\u003E\t}\u003Cbr\u003E\telse\u003Cbr\u003E\t{\u003Cbr\u003E\t\t// This is not an SRB; get its minThrust\u003Cbr\u003E\t\tminThrust = EngineModule.minThrust;\u003Cbr\u003E\t}\u003Cbr\u003E\u003Cbr\u003E\tTWR1MaxThrust \u002B= maxThrust; //add engine thrust to MaxThrust\u003Cbr\u003E\tTWR1MinThrust \u002B= minThrust; //add engine thrust to MinThrust, stock engines all have min thrust of zero, but mods may not be 0\u003Cbr\u003E}\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EIf you\u0027re really wanting to get at the config files, you will need to know their file path (or be willing to search for it), at which point you can get the ConfigNode through ConfigNode.Load() or GameDatabase.GetConfigNode(). If there\u0027s a better way to do that, I\u0027m not sure; I\u0027ve never dealt much with part classes. What do you want from the config file that the part object doesn\u0027t have?\u003C/p\u003E\n"}]}