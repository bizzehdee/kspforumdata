{"TopicId":136944,"ForumId":29,"TopicTitle":"Get a list of all ActionGroups that have actions in them","CreatedByName":"FauserneEist","CreatedById":161819,"CreatedDateTime":"2016-04-14T14:57:27Z","PageNum":1,"Articles":[{"CreatedByName":"FauserneEist","CreatedById":161819,"CreatedDateTime":"2016-04-14T14:57:27Z","Content":"\n\u003Cp\u003E\nI\u0027m writing a small mod that exports the current state of the vessel to json. I\u0027ve been searching this forum and the API for about three hours now without finding any hints on how to compile a list of ActionGroups that actually do stuff with the ship. The ActionGroups-Array on the ship only tells me, if they are toggled or not. Is there an easy way to get all ActionGroups that affect at least one part in the vessel?\n\u003C/p\u003E\n\u003Cp\u003E\nAlso I\u0027m having trouble finding a oneliner to figure out whether RCS is switched on or off. SAS was easy via Vessel.Autopilot.Enabled.\n\u003C/p\u003E\n"},{"CreatedByName":"Warezcrawler","CreatedById":145377,"CreatedDateTime":"2016-04-14T15:12:30Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222513637\u0022 data-ipsquote-contentid=\u0022136944\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221460645847\u0022 data-ipsquote-userid=\u0022161819\u0022 data-ipsquote-username=\u0022FauserneEist\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n14 minutes ago, FauserneEist said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nI\u0027m writing a small mod that exports the current state of the vessel to json. I\u0027ve been searching this forum and the API for about three hours now without finding any hints on how to compile a list of ActionGroups that actually do stuff with the ship. The ActionGroups-Array on the ship only tells me, if they are toggled or not. Is there an easy way to get all ActionGroups that affect at least one part in the vessel?\n\u003C/p\u003E\n\u003Cp\u003E\nAlso I\u0027m having trouble finding a oneliner to figure out whether RCS is switched on or off. SAS was easy via Vessel.Autopilot.Enabled.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nTry \u0022FlightInputHandler.RCSLock\u0022. I think that\u0027s it.\n\u003C/p\u003E\n"},{"CreatedByName":"FauserneEist","CreatedById":161819,"CreatedDateTime":"2016-04-14T15:15:00Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222513657\u0022 data-ipsquote-contentid=\u0022136944\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221460646750\u0022 data-ipsquote-userid=\u0022145377\u0022 data-ipsquote-username=\u0022Warezcrawler\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n2 minutes ago, Warezcrawler said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nTry \u0022FlightInputHandler.RCSLock\u0022. I think that\u0027s it.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThat did the trick, thanks.\n\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2016-04-14T16:30:57Z","Content":"\n\u003Cp\u003E\nI have gone through finding all actions myself and the only way to do it is to cycle through every partModule on every Part and check it\u0027s ActionGroups array to see if that Action is assigned or not.\n\u003C/p\u003E\n\u003Cp\u003E\nGet all actions on a vessel:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan\u003EdefaultActionsListAll.Clear(); //a List\u003C/span\u003E\u003Cspan\u003E\u0026lt;BaseAction\u0026gt;\u003C/span\u003E\u003Cspan\u003E obejct\n                        {\n                            foreach (Part p in FlightGlobals.ActiveVessel.parts)\n                            {\n                                defaultActionsListAll.AddRange(p.Actions);\n                                foreach (PartModule pm in p.Modules)\n                                {\n                                    defaultActionsListAll.AddRange(pm.Actions);\n                                }\n                            }\n                        }\n  //defaultActionsListAll now holds every action on the vessel across all partModules/Parts\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nCheck for assigned actions:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan\u003Epublic void RefreshDefaultActionsListType()\n        {\n            defaultActionsListThisType.Clear(); //another List\u003C/span\u003E\u003Cspan\u003E\u0026lt;BaseAction\u0026gt;\u003C/span\u003E\u003Cspan\u003E object, note defaultActionsListAll and defaultActionsListThisType are different\n            foreach (BaseAction act in defaultActionsListAll)\n            {\n                if ((act.actionGroup \u0026amp; defaultGroupToShow) == defaultGroupToShow) //defaultGroupToShow the KSP action enum, replace with KSPActionGroup.Light to find all actions assigned to the Lights action group.\n                {\n                    defaultActionsListThisType.Add(act);\n                }\n            }\n        }\n              //defaultActionslistThisType now contains all actions assigned to the specified action group\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nActions are something of a pain to work with, it\u0027s just a matter of working the issue until it cooperates.\n\u003C/p\u003E\n\u003Cp\u003E\nD.\n\u003C/p\u003E\n"},{"CreatedByName":"FauserneEist","CreatedById":161819,"CreatedDateTime":"2016-04-14T20:36:43Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222513756\u0022 data-ipsquote-contentid=\u0022136944\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221460651457\u0022 data-ipsquote-userid=\u002281549\u0022 data-ipsquote-username=\u0022Diazo\u0022\u003E\n\u003Cdiv\u003E\n\u00A0\n\u003C/div\u003E\n\u003Cdiv\u003E\n\u003Cp\u003E\nI managed to figure it out thanks to you. I ended up with the following function:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode\u0022\u003E\n        private void findUsableActionGroups()\n        {\n            List\u0026lt;BaseAction\u0026gt; allActionsList = new List\u0026lt;BaseAction\u0026gt;();\n\n            foreach (KSPActionGroup group in Enum.GetValues(typeof(KSPActionGroup)).Cast\u0026lt;KSPActionGroup\u0026gt;())\n                this.actionGroups.Add(group, false);\n\n            foreach(Part p in currentVessel.parts)\n            {\n                allActionsList.AddRange(p.Actions);\n                foreach(PartModule pm in p.Modules)\n                    allActionsList.AddRange(pm.Actions);\n            }\n\n            foreach (BaseAction action in allActionsList)\n                foreach (KSPActionGroup group in Enum.GetValues(typeof(KSPActionGroup)).Cast\u0026lt;KSPActionGroup\u0026gt;())\n                    actionGroups[group] = actionGroups[group] || ((action.actionGroup \u0026amp; group) == group);\n\n        }\u003C/pre\u003E\n\u003Cp\u003E\nI end up with the following dictionary:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint prettyprinted\u0022\u003E\n\u003Cspan\u003EDictionary\u003C/span\u003E\u003Cspan\u003E\u0026lt;\u003C/span\u003E\u003Cspan\u003EKSPActionGroup\u003C/span\u003E\u003Cspan\u003E,\u003C/span\u003E\u003Cspan\u003E \u003C/span\u003E\u003Cspan\u003EBoolean\u003C/span\u003E\u003Cspan\u003E\u0026gt;\u003C/span\u003E\u003Cspan\u003E actionGroups\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\n... which contains a nice list of all action groups in the game with the Boolean value indicating, whether they are actually in use or not. Thanks a lot for the help.\n\u003C/p\u003E\n\u003Cp\u003E\nAdvice to anyone who might be interested in copying the listed functions: use them only on vessel changes, since they are\u00A0quite expensive, runtime-wise.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n"}]}