{"TopicId":201189,"ForumId":29,"TopicTitle":"Question on GUILayout Repaint Event","CreatedByName":"MaverickWoe","CreatedById":152650,"CreatedDateTime":"2021-03-23T16:21:58Z","PageNum":1,"Articles":[{"CreatedByName":"MaverickWoe","CreatedById":152650,"CreatedDateTime":"2021-03-23T16:21:58Z","Content":"\n\u003Cp\u003E\nHi all.\u003Cbr\u003E\nI\u0027m new in the KSP modding and Unity hooks too and I was hoping you could help on something I cannot understand.\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027m trying to build a layout window using GUILayout class on which I want to draw a simple graph / curve.\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003E        public void OnGUI()\n        {\n            // Register the window. Notice the 3rd parameter\n            logWindowPos = GUILayout.Window(GetType().FullName.GetHashCode(), logWindowPos, WindowGUI, \u0022Landing Control\u0022, GUILayout.Width(logWindowPos.width), GUILayout.Height(logWindowPos.height));\n        }\u003C/span\u003E\u003C/pre\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003E        protected void WindowGUI(int windowID)\n        {\n\n            GUILayout.BeginVertical();\n            GUILayout.Box(Texture2D.blackTexture, GUILayout.Width(200), GUILayout.Height(200));\n            Rect graphBoxRect = GUILayoutUtility.GetLastRect();\n            GUILayout.EndVertical();\n            GUI.DragWindow();\n\n            if (Event.current.type == EventType.Repaint)\n            {\n                if (graphData.Length \u0026gt; 1)\n                    for (int i = 0; i \u0026lt; graphData.Length - 1; i\u002B\u002B)\n                    {\n                        Drawing.DrawLine(\n                            new Vector2(graphBoxRect.xMin \u002B graphData[i].x , graphBoxRect.yMax - graphData[i].y ),\n                            new Vector2(graphBoxRect.xMin \u002B graphData[i \u002B 1].x , graphBoxRect.yMax - graphData[i \u002B 1].y ), \t\t\tColor.white, 2, true);\n                    }\n            }\n        }\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nIt draws what I want and I can see the white lines as expected.\u003Cbr\u003E\nThe window is dragable etc.\u003Cbr\u003E\nThough the thing that eludes me is that I don\u0027t know how to force a redraw / repaint of the window when I add a dot to the curve.\u003Cbr\u003E\u003Cbr\u003E\nHow do you force a redraw of a GUILayout window ?\u003Cbr\u003E\nI suppose clicking on a toggle button in it may call a repaint but what if there is no control and you want it to refresh from outside ?\u003Cbr\u003E\nI\u0027ve been unable to find a method or a variable to set to let the engine know.\n\u003C/p\u003E\n\u003Cp\u003E\nSupport greatly appreciated, thanks.\n\u003C/p\u003E\n"},{"CreatedByName":"HebaruSan","CreatedById":156657,"CreatedDateTime":"2021-03-23T16:44:10Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223944107\u0022 data-ipsquote-contentid=\u0022201189\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221616516518\u0022 data-ipsquote-userid=\u0022152650\u0022 data-ipsquote-username=\u0022MaverickWoe\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n16 minutes ago, MaverickWoe said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nHow do you force a redraw of a GUILayout window ?\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nUsually you don\u0027t need to; OnGUI is called every frame to redraw the whole window from scratch. That\u0027s why it\u0027s considered a performance hog (and is semi-deprecated) and updating to DialogGUI is recommended where possible:\n\u003C/p\u003E\n\u003Ciframe allowfullscreen=\u0022\u0022 data-controller=\u0022core.front.core.autosizeiframe\u0022 data-embedauthorid=\u002257416\u0022 data-embedcontent=\u0022\u0022 data-embedid=\u0022embed1291256921\u0022 scrolling=\u0022no\u0022 src=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/149324-popupdialog-and-the-dialoggui-classes/\u0026amp;do=embed\u0022 style=\u0022height:196px;max-width:502px;\u0022\u003E\u003C/iframe\u003E\n\u003Cp\u003E\nSo in theory, if you update your graphData array, the latest lines should always be drawn. If you\u0027re already trying to update graphData, I would guess that those efforts are not succeeding due to some problem in code we cannot see here.\n\u003C/p\u003E\n"},{"CreatedByName":"MaverickWoe","CreatedById":152650,"CreatedDateTime":"2021-03-23T17:29:24Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223944115\u0022 data-ipsquote-contentid=\u0022201189\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221616517850\u0022 data-ipsquote-userid=\u0022156657\u0022 data-ipsquote-username=\u0022HebaruSan\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n34 minutes ago, HebaruSan said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nSo in theory, if you update your graphData array, the latest lines should always be drawn. If you\u0027re already trying to update graphData, I would guess that those efforts are not succeeding due to some problem in code we cannot see here.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThanks Hebaru\n\u003C/p\u003E\n\u003Cp\u003E\nYou were right, I was focusing on the wrong problem, the update of the array was broken. My bad\u003Cbr\u003E\nI\u0027ll also look into the DialogGUI if its easier on the CPU, thanks for pointing it out.\n\u003C/p\u003E\n"}]}