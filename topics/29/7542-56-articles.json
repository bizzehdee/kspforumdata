{"TopicId":7542,"ForumId":29,"TopicTitle":"The official unoffical \u0026quot;help a fellow plugin developer\u0026quot; thread","CreatedByName":"Cephei","CreatedById":2555,"CreatedDateTime":"2012-03-04T10:02:40Z","PageNum":56,"Articles":[{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2014-11-10T18:42:07Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022*Aqua*\u0022 data-cite=\u0022*Aqua*\u0022\u003E\u003Cdiv\u003EI\u0027m trying to load some music into the game database. I have no idea what goes wrong here (it even worked at some time before I refactored the code).\u003Cp\u003EThe path is right: C:\\Kerbal Space Program\\GameData\\Akustik\\Music\\Moho.mp3\u003C/p\u003E\u003Cp\u003EClass extends MonoBehaviourExtended (KSPPluginFramework by TriggerAu), code is inside Start() (tried Awake() before - same error).\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003EFile = \u0022[B][U]Music/Moho.mp3[/U][/B]\u0022;\u003Cbr\u003E...\u003Cbr\u003EAssetLoader.LogFormatted_DebugOnly(\u0022Adding \u0022 \u002B KSPUtil.ApplicationRootPath \u002B \u0022GameData/Akustik/\u0022 \u002B File \u002B \u0022 to database.\u0022);\u003Cbr\u003EAsset = GameDatabase.Instance.GetAudioClip(KSPUtil.ApplicationRootPath \u002B\u0022GameData/Akustik/\u0022 \u002B File); // this fails and I don\u0027t know why.\u003Cbr\u003E\u003Cbr\u003EAssetLoader.LogFormatted_DebugOnly(\u0022AudioClip is \u0022 \u002B ((Asset == null) ? \u0022null.\u0022 : \u0022loaded.\u0022));\u003Cbr\u003EAsset.name = File; // exception because Asset == null\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EGetAudioClip just searches the GameDatabase of already-loaded audio clips. Your first problem is that your file won\u0027t be in GameDatabase; it only loads ogg and wav. The second is that GetAudioClip wants a path relative to GameData, so if your file is in \u0022(KSPROOT)/GameData/Akustik/MyFile.ogg\u0022, you should pass \u0022Akustik/MyFile\u0022 in to get it\u003C/p\u003E\n"},{"CreatedByName":"*Aqua*","CreatedById":103926,"CreatedDateTime":"2014-11-10T19:47:43Z","Content":"\n\u003Cp\u003EThank you very much! \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Robotengineer","CreatedById":104525,"CreatedDateTime":"2014-11-11T17:57:30Z","Content":"\n\u003Cp\u003EI am having a GUI problem, the .log is saying I am pushing more GUIClips than I am popping, but I don\u0027t see how that is possible. Here is the log snippet and the GUI Methods.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003EUnityEngine.TextEditor.ClampPos ()\u003Cbr\u003E\tUnityEngine.GUI.DoTextField (Rect position, Int32 id, UnityEngine.GUIContent content, Boolean multiline, Int32 maxLength, UnityEngine.GUIStyle style)\u003Cbr\u003E\tUnityEngine.GUILayout.DoTextField (System.String text, Int32 maxLength, Boolean multiline, UnityEngine.GUIStyle style, UnityEngine.GUILayoutOption[] options)\u003Cbr\u003E\tUnityEngine.GUILayout.TextArea (System.String text, UnityEngine.GUILayoutOption[] options)\u003Cbr\u003E\tKerbLog.KlGUI.AutomaticLayoutGUI (Int32 winID)\u003Cbr\u003E\tUnityEngine.GUI.CallWindowDelegate (UnityEngine.WindowFunction func, Int32 id, UnityEngine.GUISkin _skin, Int32 forceRect, Single width, Single height, UnityEngine.GUIStyle style)\u003Cbr\u003E[ERR 11:53:22.035] GUI Error: You are pushing more GUIClips than you are popping. Make sure they are balanced\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EHere are the two GUI functions.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Epublic void AutomaticLayoutGUI(int winID)\u003Cbr\u003E\t\t{\u003Cbr\u003E\t\t\t// begin area\u003Cbr\u003E\t\t\tGUILayout.BeginArea (new Rect (0, 0, 400, 800));\u003Cbr\u003E\t\t\t// horizontal 1\u003Cbr\u003E\t\t\tGUILayout.BeginHorizontal ();\u003Cbr\u003E\t\t\t// The bezel space.\u003Cbr\u003E\t\t\tGUILayout.Space (10);\u003Cbr\u003E\t\t\t// vertical 1\u003Cbr\u003E\t\t\tGUILayout.BeginVertical ();\u003Cbr\u003E\t\t\t// H2\u003Cbr\u003E\t\t\tGUILayout.BeginHorizontal ();\u003Cbr\u003E\t\t\tGUILayout.FlexibleSpace ();\u003Cbr\u003E\t\t\tGUILayout.Label (\u0022Folder name\u0022);\u003Cbr\u003E\t\t\tGUILayout.FlexibleSpace ();\u003Cbr\u003E\t\t\t// end H2\u003Cbr\u003E\t\t\tGUILayout.EndHorizontal();\u003Cbr\u003E\t\t\tfileName = GUILayout.TextField (fileName);\u003Cbr\u003E\t\t\t// H3\u003Cbr\u003E\t\t\tGUILayout.BeginHorizontal();\u003Cbr\u003E\t\t\tGUILayout.FlexibleSpace ();\u003Cbr\u003E\t\t\tGUILayout.Label (\u0022Log name\u0022);\u003Cbr\u003E\t\t\tGUILayout.FlexibleSpace ();\u003Cbr\u003E\t\t\t// end H3\u003Cbr\u003E\t\t\tGUILayout.EndHorizontal();\u003Cbr\u003E\t\t\tLogName = GUILayout.TextField (LogName);\u003Cbr\u003E\t\t\t// H4\u003Cbr\u003E\t\t\tGUILayout.BeginHorizontal();\u003Cbr\u003E\t\t\tGUILayout.FlexibleSpace ();\u003Cbr\u003E\t\t\tGUILayout.Label (\u0022Log\u0022);\u003Cbr\u003E\t\t\tGUILayout.FlexibleSpace ();\u003Cbr\u003E\t\t\t// end H4\u003Cbr\u003E\t\t\tGUILayout.EndHorizontal();\u003Cbr\u003E\t\t\t// S1\u003Cbr\u003E\t\t\tScrollPos = GUILayout.BeginScrollView(ScrollPos);\u003Cbr\u003E\t\t\tKerbLogtxt = GUILayout.TextArea (KerbLogtxt, GUILayout.ExpandHeight(true));\u003Cbr\u003E\t\t\t// end S1\u003Cbr\u003E\t\t\tGUILayout.EndScrollView ();\u003Cbr\u003E\t\t\tGUILayout.Space (5);\u003Cbr\u003E\t\t\tif (GUILayout.Button (\u0022Save\u0022))\u003Cbr\u003E\t\t\t{\u003Cbr\u003E\t\t\t\tSaveToFile();\u003Cbr\u003E\t\t\t}\u003Cbr\u003E\t\t\tif(GUILayout.Button(\u0022Reset\u0022))\u003Cbr\u003E\t\t\t{\u003Cbr\u003E\t\t\t\tSetTimeRun = false;\u003Cbr\u003E\t\t\t\tLogName = \u0022Log: \u0022;\u003Cbr\u003E\t\t\t\tKerbLogtxt = \u0022Log:\u0022;\u003Cbr\u003E\t\t\t\tfileName = \u0022\u0022;\u003Cbr\u003E\t\t\t}\u003Cbr\u003E\t\t\tif (GUILayout.Button (\u0022Load\u0022))\u003Cbr\u003E\t\t\t{\u003Cbr\u003E\t\t\t\tShowLoadGUI = !ShowLoadGUI;\u003Cbr\u003E\t\t\t}\u003Cbr\u003E\t\t\tGUILayout.Space (10);\u003Cbr\u003E\t\t\t// end V1\u003Cbr\u003E\t\t\tGUILayout.EndVertical ();\u003Cbr\u003E\t\t\tGUILayout.Space (10);\u003Cbr\u003E\t\t\t// end H1\u003Cbr\u003E\t\t\tGUILayout.EndHorizontal ();\u003Cbr\u003E\t\t\t// end area\u003Cbr\u003E\t\t\tGUILayout.EndArea ();\u003Cbr\u003E\t\t\tGUI.DragWindow ();\u003Cbr\u003E\t\t}\u003Cbr\u003E\t\tpublic void LoadGUI(int winID)\u003Cbr\u003E\t\t{\u003Cbr\u003E\t\t\tbool showloadtxt = false;\u003Cbr\u003E\t\t\t// start area\u003Cbr\u003E\t\t\tGUILayout.BeginArea (new Rect (0, 0, 400, 600));\u003Cbr\u003E\t\t\t// start horizontal 1\u003Cbr\u003E\t\t\tGUILayout.BeginHorizontal ();\u003Cbr\u003E\t\t\tGUILayout.Space (10);\u003Cbr\u003E\t\t\t//begin vertical 1\u003Cbr\u003E\t\t\tGUILayout.BeginVertical ();\u003Cbr\u003E\t\t\t//begin horizontal 2\u003Cbr\u003E\t\t\tGUILayout.BeginHorizontal ();\u003Cbr\u003E\t\t\tShowFolder = GUILayout.Toggle (ShowFolder, \u0022Use Folder\u0022);\u003Cbr\u003E\t\t\tfileName = GUILayout.TextField (fileName);\u003Cbr\u003E\t\t\tGUILayout.Space (10);\u003Cbr\u003E\t\t\t// end horizontal 2\u003Cbr\u003E\t\t\tGUILayout.EndHorizontal ();\u003Cbr\u003E\t\t\t// begin scroll view\u003Cbr\u003E\t\t\tScrollPos2 = GUILayout.BeginScrollView (ScrollPos2, GUILayout.ExpandHeight(true));\u003Cbr\u003E\t\t\tforeach(string txtfile in LoadName())\u003Cbr\u003E\t\t\t{\u003Cbr\u003E\t\t\t\tstring returntxt = txtfile.Replace(getPath(), \u0022\u0022);\u003Cbr\u003E\t\t\t\treturntxt = returntxt.Replace(\u0022.txt\u0022, \u0022\u0022);\u003Cbr\u003E\t\t\t\tshowloadtxt = GUILayout.Button(returntxt);\u003Cbr\u003E\t\t\t\tif(showloadtxt)\u003Cbr\u003E\t\t\t\t{\u003Cbr\u003E\t\t\t\t\tLogName = returntxt;\u003Cbr\u003E\t\t\t\t\tKerbLogtxt = LoadFromtxt();\u003Cbr\u003E\t\t\t\t}\u003Cbr\u003E\t\t\t}\u003Cbr\u003E\t\t\t// end scroll view\u003Cbr\u003E\t\t\tGUILayout.EndScrollView ();\u003Cbr\u003E\t\t\tGUILayout.Space (10);\u003Cbr\u003E\t\t\t// end vertical 1\u003Cbr\u003E\t\t\tGUILayout.EndVertical ();\u003Cbr\u003E\t\t\tGUILayout.Space (10);\u003Cbr\u003E\t\t\t// end horiontal 1\u003Cbr\u003E\t\t\tGUILayout.EndHorizontal ();\u003Cbr\u003E\t\t\t// end area\u003Cbr\u003E\t\t\tGUILayout.EndArea ();\u003Cbr\u003E\t\t\tGUI.DragWindow ();\u003Cbr\u003E\t\t}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n"},{"CreatedByName":"DMagic","CreatedById":57416,"CreatedDateTime":"2014-11-12T01:15:26Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Robotengineer\u0022 data-cite=\u0022Robotengineer\u0022\u003E\u003Cdiv\u003EI am having a GUI problem, the .log is saying I am pushing more GUIClips than I am popping, but I don\u0027t see how that is possible. Here is the log snippet and the GUI Methods.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI\u0027m guessing that the GUILayout.TextArea method is choking on something, which prevents all of the following GUILayout.EndSomethings from being run. Try to comment out the TextArea, or figure out why it\u0027s broken.\u003C/p\u003E\n"},{"CreatedByName":"AlphaAsh","CreatedById":105348,"CreatedDateTime":"2014-11-12T15:07:06Z","Content":"\n\u003Cp\u003EAnyone got any ideas on where to look in the API for a way to temporarily modify the cost to launch/rollout a vessel? Such that the little indicator in the VAB/SPH for the vessel cost actually changes?\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-11-12T15:26:41Z","Content":"\n\u003Cp\u003EI would suggest looking at the LateUpdate() method.\u003C/p\u003E\u003Cp\u003ERather then having to dig into the code to modify costs, that method allows you to hook into the screen display and change what is displayed without actually changing anything underneath.\u003C/p\u003E\u003Cp\u003EI used in \u003Ca href=\u0022https://github.com/SirDiazo/LandingHeight/blob/master/LandingHeight/LHFlight.cs#L13\u0022 rel=\u0022external nofollow\u0022\u003Ehere in my Landing Height mode\u003C/a\u003E to override the altitude display at the top of the screen without actually changing any of the altitude variables on the vessel.\u003C/p\u003E\u003Cp\u003EI would think this trick would also work in the editor. (Also you would have to track down what that widget is named to override it.)\u003C/p\u003E\u003Cp\u003EHope that helps,\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n"},{"CreatedByName":"AlphaAsh","CreatedById":105348,"CreatedDateTime":"2014-11-12T15:30:56Z","Content":"\n\u003Cp\u003EI\u0027ll look at that. Still going to need to get the total craft value one way or another though and I\u0027m starting to worry I may have to calculate it myself by iterating through parts. Be much nicer if I could just re-use the code that already does that but I suspect there\u0027s no API exposure of that.\u003C/p\u003E\u003Cp\u003EEDIT - Nevermind, I can catch it with OnFundsChanged - just won\u0027t be updating the widget. Meh.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-11-12T15:46:43Z\u0022 title=\u002211/12/2014 03:46  PM\u0022 data-short=\u00229 yr\u0022\u003ENovember 12, 2014\u003C/time\u003E by AlphaAsh\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Robotengineer","CreatedById":104525,"CreatedDateTime":"2014-11-12T16:10:58Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022DMagic\u0022 data-cite=\u0022DMagic\u0022\u003E\u003Cdiv\u003EI\u0027m guessing that the GUILayout.TextArea method is choking on something, which prevents all of the following GUILayout.EndSomethings from being run. Try to comment out the TextArea, or figure out why it\u0027s broken.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThanks, I checked my other functions and it was a problem with them.\u003C/p\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2014-11-12T16:51:21Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022AlphaAsh\u0022 data-cite=\u0022AlphaAsh\u0022\u003E\u003Cdiv\u003EStill going to need to get the total craft value one way or another though and I\u0027m starting to worry I may have to calculate it myself by iterating through parts. Be much nicer if I could just re-use the code that already does that but I suspect there\u0027s no API exposure of that.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThere is, it\u0027s just been slightly complicated with the addition of strategies. Here\u0027s what \u003Ca href=\u0022https://bitbucket.org/xEvilReeperx/ksp_alignedcurrencyindicator/src\u0022 rel=\u0022external nofollow\u0022\u003EAlignedCurrencyFormatter \u003C/a\u003Euses:\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Efloat dryCost = 0f;\u003Cbr\u003E            float fuelCost = 0f;\u003Cbr\u003E            float total = EditorLogic.fetch.ship.GetShipCosts(out dryCost, out fuelCost);\u003Cbr\u003E\u003Cbr\u003E            // player might have a strategy active which increases/decreases total ship cost\u003Cbr\u003E            var cm = CurrencyModifierQuery.RunQuery(TransactionReasons.VesselRollout, total, 0f, 0f);\u003Cbr\u003E            total \u002B= cm.GetEffectDelta(Currency.Funds); // it\u0027s not a multiplier, it\u0027s the difference between current and modified total\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EAnother clever option might be to create your own strategy that\u0027s temporarily applied in the editor. I have zero experience with that, though\u003C/p\u003E\n"},{"CreatedByName":"AlphaAsh","CreatedById":105348,"CreatedDateTime":"2014-11-12T18:04:40Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022xEvilReeperx\u0022 data-cite=\u0022xEvilReeperx\u0022\u003E\u003Cdiv\u003EThere is, it\u0027s just been slightly complicated with the addition of strategies.... Another clever option might be to create your own strategy that\u0027s temporarily applied in the editor. I have zero experience with that, though\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI like the second idea a lot because it\u0027s already tied in everywhere it needs to be. Still, if it\u0027s easy enough to pass back and the widget catches that, then idea one will do. Cheers chap.\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-11-13T02:09:23Z","Content":"\n\u003Cp\u003EIs there any way to find all partModules in the game, as in every module that is loaded?\u003C/p\u003E\u003Cp\u003EPartModule[] allPMs = FindObjectsOfType\u0026lt;PartModule\u0026gt;(); only returns ACTIVE modules, not all modules.\u003C/p\u003E\u003Cp\u003EI was hoping there would be something in protoParts DB, but it either is not there or my search skills are failing me. I\u0027m after the equivalent of the protoParts DB actually as I want to make edits to partModules that will globally affect all parts with that partModule. (Add BaseActions to the partModule.Actions list.)\u003C/p\u003E\u003Cp\u003EAny thoughts?\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-11-13T02:25:38Z\u0022 title=\u002211/13/2014 02:25  AM\u0022 data-short=\u00229 yr\u0022\u003ENovember 13, 2014\u003C/time\u003E by Diazo\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"jamespicone","CreatedById":125714,"CreatedDateTime":"2014-11-13T03:47:23Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Diazo\u0022 data-cite=\u0022Diazo\u0022\u003E\u003Cdiv\u003EIs there any way to find all partModules in the game, as in every module that is loaded?\u003Cp\u003EPartModule[] allPMs = FindObjectsOfType\u0026lt;PartModule\u0026gt;(); only returns ACTIVE modules, not all modules.\u003C/p\u003E\u003Cp\u003EI was hoping there would be something in protoParts DB, but it either is not there or my search skills are failing me. I\u0027m after the equivalent of the protoParts DB actually as I want to make edits to partModules that will globally affect all parts with that partModule. (Add BaseActions to the partModule.Actions list.)\u003C/p\u003E\u003Cp\u003EAny thoughts?\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYou can loop through all the part prefabs from PartLoader and then look at their modules:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Eforeach (AvailablePart a in PartLoader.LoadedPartsList) {\u003Cbr\u003E\tif (a.partPrefab.Modules != null) {\u003Cbr\u003E\t\tforeach (PartModule m in a.partPrefab.Modules) {\u003Cbr\u003E\t\t\tDebug.Log(\u0022Part \u0022 \u002B a.name \u002B \u0022 has module \u0022 \u002B m.name);\u003Cbr\u003E\t\t}\u003Cbr\u003E\t}\u003Cbr\u003E}\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EYou\u0027ll obviously hit the same module type multiple times, but you can just put them in a list iff you don\u0027t have one of that type yet.\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-11-13T04:36:26Z","Content":"\n\u003Cp\u003EHmm, that would get me a list of all partModules, but can I edit the partModules themselves from the list that would generate?\u003C/p\u003E\u003Cp\u003ETesting incoming it looks like.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\u003Cp\u003Eedit: Have not tested it yet, but I don\u0027t think that will work. That would get me the instance of the partModule on that part, not a global partModule I could edit once and be done.\u003C/p\u003E\u003Cp\u003EI could edit each partModule individually, but I can see that increasing the load time when you start the game. Hmmm.....\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-11-13T04:40:17Z\u0022 title=\u002211/13/2014 04:40  AM\u0022 data-short=\u00229 yr\u0022\u003ENovember 13, 2014\u003C/time\u003E by Diazo\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2014-11-13T04:55:37Z","Content":"\n\u003Cp\u003EUnless you\u0027re doing something that takes a noticeable period of time to execute on each module, the change in load times would only be a handful of seconds which is entirely inconsequential given KSP\u0027s load times...\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-11-13T05:01:50Z","Content":"\n\u003Cp\u003ETrue, but I\u0027m more worried that the partModule object does not actually exist at that level and is instantiated from the .dll each time the part is loaded into the editor or flight mode. If that is case then this is a dead end and I\u0027ll have to find another way.\u003C/p\u003E\u003Cp\u003EOut to time to actually test tonight so I still have to actually experiment tomorrow to see exactly what is happening.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2014-11-13T07:34:12Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Diazo\u0022 data-cite=\u0022Diazo\u0022\u003E\u003Cdiv\u003Ebut I\u0027m more worried that the partModule object does not actually exist at that level and is instantiated from the .dll each time the part is loaded into the editor or flight mode. If that is case then this is a dead end and I\u0027ll have to find another way.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EIt\u0027s cloned (as part of the part prefab) and then any persistent data gets copied into its fields. I\u0027m not sure it would work in your case; if that action list gets re-created during the second part (say, if it were being loaded from a save to map its actions to an action group*) then any changes you made to the prefab one wouldn\u0027t take. It\u0027s worth a try anyhow.\u003C/p\u003E\u003Cp\u003E*I don\u0027t know for certain this is how it works. I\u0027ve never worked with BaseAction\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-11-13T15:11:13Z","Content":"\n\u003Cp\u003EFor all my work with BaseAction, I\u0027m in totally unknown territory also, this is as much a partModule loading question as a baseAction question.\u003C/p\u003E\u003Cp\u003EWhile I\u0027ve yet to run any tests, I have had a sleep on it (and based on your comment about cloning) and my current expectation is that during the loading process each part in the prefrab gets a copy of the appropriate partModules and by the time I can affect anything it is too late for me to affect the global partModule object. This means I will have to walk the entire part prefab cycling through each partModule on each part. After that for new vessels created I think that would be fine, the big question mark is what happens to existing vessels in flight?\u003C/p\u003E\u003Cp\u003EThis is all pure speculation until I can get home and run some tests though, have a work day to get through first.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-11-13T15:17:18Z\u0022 title=\u002211/13/2014 03:17  PM\u0022 data-short=\u00229 yr\u0022\u003ENovember 13, 2014\u003C/time\u003E by Diazo\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-11-14T05:27:15Z","Content":"\n\u003Cp\u003EGrrr.\u003C/p\u003E\u003Cp\u003EIt\u0027s looking like this is a dead end.\u003C/p\u003E\u003Cp\u003EAvailablePart.partPrefab.Modules is null so I can\u0027t reference it.\u003C/p\u003E\u003Cp\u003EIt looks like the partModules are stored in the List\u0026lt;string\u0026gt;AvailablePart.moduleInfos, but that appears to just be the partModule names that I\u0027m assuming the list gets referenced to load the partModules when the part is spawned.\u003C/p\u003E\u003Cp\u003EWhich still leaves me with no clue where the default partModules sit around before they get used. My best lead was in the AssemblyLoader class, but I drew a blank there also.\u003C/p\u003E\u003Cp\u003EUnless anyone has a brainwave, this is a dead end and I\u0027ll come at this another way.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2014-11-14T11:05:53Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Diazo\u0022 data-cite=\u0022Diazo\u0022\u003E\u003Cdiv\u003EIt looks like the partModules are stored in the List\u0026lt;string\u0026gt;AvailablePart.moduleInfos, but that appears to just be the partModule names that I\u0027m assuming the list gets referenced to load the partModules when the part is spawned.\u003Cp\u003EWhich still leaves me with no clue where the default partModules sit around before they get used. My best lead was in the AssemblyLoader class, but I drew a blank there also.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThere isn\u0027t a \u0022default\u0022 ModuleScienceExperiment, for example. There are ModuleScienceExperiments, pre-loaded with relevant data (from ConfigNodes like you\u0027d expect), already attached to the part prefab. Here\u0027s what one looks like:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E[LOG 01:26:25.837] DebugTools, mk1pod has components:\u003Cbr\u003E[LOG 01:26:25.838] DebugTools, ...c: UnityEngine.Transform\u003Cbr\u003E[LOG 01:26:25.838] DebugTools, ...c: Part\u003Cbr\u003E[LOG 01:26:25.839] DebugTools, ...c: ModuleCommand\u003Cbr\u003E[LOG 01:26:25.839] DebugTools, ...c: PartResource\u003Cbr\u003E[LOG 01:26:25.840] DebugTools, ...c: ModuleSAS\u003Cbr\u003E[LOG 01:26:25.841] DebugTools, ...c: ModuleReactionWheel\u003Cbr\u003E[LOG 01:26:25.841] DebugTools, ...c: ModuleScienceExperiment\u003Cbr\u003E[LOG 01:26:25.842] DebugTools, ...c: ModuleScienceContainer\u003Cbr\u003E[LOG 01:26:25.842] DebugTools, ...c: PartResource\u003Cbr\u003E[LOG 01:26:25.843] DebugTools, ...c: FlagDecal\u003Cbr\u003E[LOG 01:26:25.843] DebugTools, ...c: ModuleTripLogger\u003Cbr\u003E[LOG 01:26:25.844] DebugTools, ---\u0026gt;model has components:\u003Cbr\u003E[LOG 01:26:25.844] DebugTools, ......c: UnityEngine.Transform\u003Cbr\u003E[LOG 01:26:25.845] DebugTools, ------\u0026gt;capsule has components:\u003Cbr\u003E[LOG 01:26:25.846] DebugTools, .........c: UnityEngine.Transform\u003Cbr\u003E[LOG 01:26:25.846] DebugTools, .........c: UnityEngine.MeshFilter\u003Cbr\u003E[LOG 01:26:25.847] DebugTools, .........c: UnityEngine.MeshRenderer\u003Cbr\u003E[LOG 01:26:25.847] DebugTools, ---------\u0026gt;collider has components:\u003Cbr\u003E[LOG 01:26:25.848] DebugTools, ............c: UnityEngine.Transform\u003Cbr\u003E[LOG 01:26:25.848] DebugTools, ............c: UnityEngine.MeshCollider\u003Cbr\u003E[LOG 01:26:25.849] DebugTools, ---------\u0026gt;flagTransform has components:\u003Cbr\u003E[LOG 01:26:25.850] DebugTools, ............c: UnityEngine.Transform\u003Cbr\u003E[LOG 01:26:25.850] DebugTools, ............c: UnityEngine.MeshFilter\u003Cbr\u003E[LOG 01:26:25.851] DebugTools, ............c: UnityEngine.MeshRenderer\u003Cbr\u003E[LOG 01:26:25.851] DebugTools, ---------\u0026gt;hatch has components:\u003Cbr\u003E[LOG 01:26:25.852] DebugTools, ............c: UnityEngine.Transform\u003Cbr\u003E[LOG 01:26:25.852] DebugTools, ............c: UnityEngine.MeshFilter\u003Cbr\u003E[LOG 01:26:25.853] DebugTools, ............c: UnityEngine.MeshRenderer\u003Cbr\u003E[LOG 01:26:25.854] DebugTools, ---------\u0026gt;rung has components:\u003Cbr\u003E[LOG 01:26:25.854] DebugTools, ............c: UnityEngine.Transform\u003Cbr\u003E[LOG 01:26:25.855] DebugTools, ............c: UnityEngine.MeshFilter\u003Cbr\u003E[LOG 01:26:25.855] DebugTools, ............c: UnityEngine.MeshRenderer\u003Cbr\u003E[LOG 01:26:25.856] DebugTools, ---------\u0026gt;rung has components:\u003Cbr\u003E[LOG 01:26:25.856] DebugTools, ............c: UnityEngine.Transform\u003Cbr\u003E[LOG 01:26:25.857] DebugTools, ............c: UnityEngine.MeshFilter\u003Cbr\u003E[LOG 01:26:25.858] DebugTools, ............c: UnityEngine.MeshRenderer\u003Cbr\u003E[LOG 01:26:25.859] DebugTools, ---------\u0026gt;window has components:\u003Cbr\u003E[LOG 01:26:25.860] DebugTools, ............c: UnityEngine.Transform\u003Cbr\u003E[LOG 01:26:25.860] DebugTools, ............c: UnityEngine.MeshFilter\u003Cbr\u003E[LOG 01:26:25.861] DebugTools, ............c: UnityEngine.MeshRenderer\u003Cbr\u003E[LOG 01:26:25.862] DebugTools, ------\u0026gt;ladder has components:\u003Cbr\u003E[LOG 01:26:25.862] DebugTools, .........c: UnityEngine.Transform\u003Cbr\u003E[LOG 01:26:25.863] DebugTools, .........c: UnityEngine.CapsuleCollider\u003Cbr\u003E[LOG 01:26:25.863] DebugTools, ------\u0026gt;airlock has components:\u003Cbr\u003E[LOG 01:26:25.864] DebugTools, .........c: UnityEngine.Transform\u003Cbr\u003E[LOG 01:26:25.864] DebugTools, .........c: UnityEngine.CapsuleCollider\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E(this being from)\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E[KSPAddon(KSPAddon.Startup.MainMenu, true)]\u003Cbr\u003Eclass PrefabDump : MonoBehaviour\u003Cbr\u003E{\u003Cbr\u003E    void Start()\u003Cbr\u003E    {\u003Cbr\u003E        var ap = PartLoader.getPartInfoByName(\u0022mk1pod\u0022);\u003Cbr\u003E        ap.partPrefab.gameObject.PrintComponents();\u003Cbr\u003E    }\u003Cbr\u003E}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EWhen a part is spawned, this whole GameObject gets cloned. If you were to destroy the ModuleScienceExperiment on this GO in the main menu, no mk1pods would be able to produce crew reports any more, whether they were loaded from a save game or created fresh.\u003C/p\u003E\u003Cp\u003EI think you\u0027re still sunk, though. I had a look around and couldn\u0027t find a way to create a brand-new BaseAction without using reflection\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-11-14T15:20:24Z","Content":"\n\u003Cp\u003EHmmm.\u003C/p\u003E\u003Cp\u003EI\u0027m not going to give up just yet then. If I can use that component list to reference the module I may not be done yet. \u003C/p\u003E\u003Cp\u003EI have an idea or two about making a dummy BaseAction and adding it to the partModule.actions list, but until I can access the partModule itself I can\u0027t test that.\u003C/p\u003E\u003Cp\u003EThanks for the help,\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-11-16T03:12:45Z","Content":"\n\u003Cp\u003EOkay, I actually think I almost have this, maybe.\u003C/p\u003E\u003Cp\u003EI can add the action to the partmodule and everything looks fine, except it does not show up once I place a part.\u003C/p\u003E\u003Cp\u003EAdding the action to the ModuleScienceExperiment on the Mk 1 pod, this is running in KSPAddon.Startup.MainMenu:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003EAvailablePart ap = PartLoader.getPartInfoByName(\u0022mk1pod\u0022);\u003Cbr\u003E        foreach(Component cp in ap.partPrefab.gameObject.GetComponents\u0026lt;Component\u0026gt;())\u003Cbr\u003E        {\u003Cbr\u003E            if (cp.GetType().FullName == \u0022ModuleScienceExperiment\u0022)\u003Cbr\u003E            {\u003Cbr\u003E                ModuleScienceExperiment mdlGim = (ModuleScienceExperiment)cp;\u003Cbr\u003E               BaseActionList testList = mdlGim.Actions;\u003Cbr\u003E                print(\u0022a \u0022 \u002B testList.Count); //prints 2 for the two actions on the part\u003Cbr\u003E                testList.Add(new BaseAction(testList, \u0022HWAct\u0022, new BaseActionDelegate(HWTest), new KSPAction(\u0022HWTestGUI\u0022)));\u003Cbr\u003E                print(\u0022b \u0022 \u002B testList.Count); //prints 3 to show my action having been added\u003Cbr\u003E            }\u003Cbr\u003E        }\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EThis throws no errors or any other indication something has gone wrong.\u003C/p\u003E\u003Cp\u003EHowever, when I go to the editor and place a Mk 1 Pod, I get the following in the log which confuses me:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E[LOG 19:44:17.642] a 3  //start my loop through the AvailablePart in the partLoaded, 3 for 3 actions\u003Cbr\u003E[LOG 19:44:17.643] ba DeployAction //note I have 3 actions\u003Cbr\u003E[LOG 19:44:17.644] ba ResetAction //Deploy and Reset come with the module \u003Cbr\u003E[LOG 19:44:17.644] ba HWAct //new Action I have added\u003Cbr\u003E[LOG 19:44:17.645] pm acts 2 //start of my loop through the placed parts, 2 for 2 actions\u003Cbr\u003E[LOG 19:44:17.646] pmba DeployAction //my action is missing on the part\u003Cbr\u003E[LOG 19:44:17.646] pmba ResetAction\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003ESo, any ideas what is going on? When I am in the editor the AvailablePart in the partLoader shows 3 actions the entire time I am in the editor, both before and after I place the part, but the part I place from that AvailablePart does not have the action I added.\u003C/p\u003E\u003Cp\u003EThere are absolutely no message that help, error messages or otherwise, did I mess up the creation of the Action or am I misunderstanding how the AvailablePart class works? I don\u0027t even know where to start.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2014-11-17T14:10:35Z","Content":"\n\u003Cp\u003ESorry for delayed response, somehow this post slipped by me\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Diazo\u0022 data-cite=\u0022Diazo\u0022\u003E\u003Cdiv\u003EI can add the action to the partmodule and everything looks fine, except it does not show up once I place a part.\u003Cp\u003E...\u003C/p\u003E\u003Cp\u003ESo, any ideas what is going on? When I am in the editor the AvailablePart in the partLoader shows 3 actions the entire time I am in the editor, both before and after I place the part, but the part I place from that AvailablePart does not have the action I added.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EIt looks like PartModule BaseActions are recreated after the prefab gets copied. Sadly, this means you\u0027ll have to modify every single spawned instance instead of the general set-and-forget solution you were looking for:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E[KSPAddon(KSPAddon.Startup.MainMenu, true)]\u003Cbr\u003Eclass EditPodModules : MonoBehaviour\u003Cbr\u003E{\u003Cbr\u003E    void Start()\u003Cbr\u003E    {\u003Cbr\u003E        PartLoader.getPartInfoByName(\u0022mk1pod\u0022).partPrefab.AddModule(\u0022AddAnAction\u0022);\u003Cbr\u003E    }\u003Cbr\u003E}\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003Eclass AddAnAction : PartModule\u003Cbr\u003E{\u003Cbr\u003E    public override void OnAwake()\u003Cbr\u003E    {\u003Cbr\u003E        Log.Normal(\u0022AddAnAction running\u0022);\u003Cbr\u003E        var exp = GetComponent\u0026lt;ModuleScienceExperiment\u0026gt;();\u003Cbr\u003E\u003Cbr\u003E        exp.Actions.Add(new BaseAction(exp.Actions, \u0022HWAct\u0022, new BaseActionDelegate(TestMethod), new KSPAction(\u0022HWTestGUI\u0022)));\u003Cbr\u003E        exp.Actions.ForEach(ba =\u0026gt; Log.Normal(\u0022Instance part action: {0}\u0022, ba.guiName));\u003Cbr\u003E    }\u003Cbr\u003E\u003Cbr\u003E    void TestMethod(KSPActionParam p)\u003Cbr\u003E    {\u003Cbr\u003E        print(\u0022TestMethod\u0022);\u003Cbr\u003E    }\u003Cbr\u003E}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-11-17T14:45:56Z","Content":"\n\u003Cp\u003EAlright, that confirms this as a dead end then.\u003C/p\u003E\u003Cp\u003EI started down this line of investigation for two reasons. \u003C/p\u003E\u003Cp\u003EFirst to avoid having to modify the part as it is placed as I\u0027m worried about code order and other things running on part creation trying to reference the action but running earlier in the start up cycle so the action does not exist yet. In theory this would be easy enough to deal with, in practice I\u0027m still a beginner programmer really and I can see that stymieing me quite easily.\u003C/p\u003E\u003Cp\u003ESecond was to avoid having to add a partModule. This was only for looks on the part detail window, but I did not want to see two ModuleGimbal (ModuleGimbal and ModuleGimbalAction) entries in the partModule list that appears when you right-click.\u003C/p\u003E\u003Cp\u003EIf I have to add a partModule anyway, I\u0027m going to go with the easier route of just using the KSPAction property on the partModule. \u003C/p\u003E\u003Cp\u003EIs there some way to hide a partModule from showing in the partModule list in the editor? (The list you pop out with RMB that shows details such as engine thrust, ISP, etc.)\u003C/p\u003E\u003Cp\u003EThanks for all the help xEvilReeperx,\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2014-11-17T16:11:51Z","Content":"\n\u003Cp\u003EIt looks like you can hide what\u0027s displayed by messing with AvailablePart.moduleInfos, although the AddAnAction PartModule from above doesn\u0027t seem to appear in that list anyway\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-11-17T16:23:44Z","Content":"\n\u003Cp\u003EHmmm, interesting.\u003C/p\u003E\u003Cp\u003EThe ModuleGimbalActions partModule I add to the part to add more actions to the ModuleGimbal partModule does show in that list. I wonder what the criteria are to be visible?\u003C/p\u003E\u003Cp\u003EExperiments incoming.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n"}]}