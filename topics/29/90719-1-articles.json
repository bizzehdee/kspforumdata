{"TopicId":90719,"ForumId":29,"TopicTitle":"Any simple way to perform logic per-tick on the active vessel?","CreatedByName":"Hexicube","CreatedById":109496,"CreatedDateTime":"2014-11-19T15:36:19Z","PageNum":1,"Articles":[{"CreatedByName":"Hexicube","CreatedById":109496,"CreatedDateTime":"2014-11-19T15:36:19Z","Content":"\n\u003Cp\u003EI\u0027m working on a project that I\u0027d rather not share until I know it\u0027ll work as I want it to, but first I need to know if it\u0027s possible to have code run constantly (only needs to be in-flight) for the active vessel. Do I need to use a PartModule to achieve this, and if so is it possible to ensure the vessel only has one of that module on it so the code doesn\u0027t run repeatedly?\u003C/p\u003E\u003Cp\u003E(apologies if it\u0027s stated somewhere, I\u0027ve looked for at least an hour in a lot of places)\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-11-19T15:52:12Z","Content":"\n\u003Cp\u003EThat is what the KSPAddon.StartUp property gives you. \u003C/p\u003E\u003Cp\u003EFrom my RCS Landing Assist mod: (Link removed)\u003C/p\u003E\u003Cp\u003EThat hook will instantiate a copy of the RCSLandingAid class every time the flight scene starts and then KSP will run the Update() or FixedUpdate() methods to update them every tick.\u003C/p\u003E\u003Cp\u003EUpdate() runs every time the screen (GUI) refreshes, input and interface stuff goes here. This can be highly variable, from 60 times a real world second all the way down to 3 or 4 times a second when the computer is struggling and it is doing a \u0022slide-show\u0022.\u003C/p\u003E\u003Cp\u003EFixedUpdate() runs every physics update, or 30 times per in-game (not real-world) second. Put stuff affecting a vessel or the game world in here.\u003C/p\u003E\u003Cp\u003ENote that there is no correlation between Update() and FixedUpdate(), a high end computer with a small vessel could run 5 or 6 Update() frames for every FixedUpdate() frame, where-as a low end computer running a huge vessel could run more FixedUpdate() frames then Update() frames.\u003C/p\u003E\u003Cp\u003EAlso note that this method offers no way to save data, you have to hook into a scenario module in that game save or a part module on that vessel to persist data. \u003C/p\u003E\u003Cp\u003EHope that helps,\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-11-19T16:29:51Z\u0022 title=\u002211/19/2014 04:29  PM\u0022 data-short=\u00229 yr\u0022\u003ENovember 19, 2014\u003C/time\u003E by Diazo\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Hexicube","CreatedById":109496,"CreatedDateTime":"2014-11-19T16:10:46Z","Content":"\n\u003Cp\u003EThat helps, though that leaves a couple questions:\u003C/p\u003E\u003Cp\u003E- Do I need to put this onto a stock part, or is it automatically attached to a part (such as the root node)?\u003C/p\u003E\u003Cp\u003E- Is it possible to get the delta of the tick that passed, or is OnFixedUpdate() guaranteed to have a fixed step of 1/30?\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-11-19T16:17:59Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Hexicube\u0022 data-cite=\u0022Hexicube\u0022\u003E\u003Cdiv\u003EThat helps, though that leaves a couple questions:\u003Cp\u003E- Do I need to put this onto a stock part, or is it automatically attached to a part (such as the root node)?\u003C/p\u003E\u003Cp\u003E- Is it possible to get the delta of the tick that passed, or is OnFixedUpdate() guaranteed to have a fixed step of 1/30?\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ENo, this is not attached to a part. The entire point of KSPAddon is to run code attached to the scene, not the part/vessel. This is also why it can\u0027t save data, it is not actually attached to an object.\u003C/p\u003E\u003Cp\u003EEvery time the flight scene starts, a new instance of RCSLandAid is created and every time you leave the flight scene it is destroyed.\u003C/p\u003E\u003Cp\u003EThe delta of tick that has passed is {something}.fixedDeltaTime \u003C/p\u003E\u003Cp\u003EI can\u0027t remember which class it is in, but search for fixedDeltaTime in your IDE and it should be easily findable.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n"},{"CreatedByName":"Hexicube","CreatedById":109496,"CreatedDateTime":"2014-11-19T16:26:37Z","Content":"\n\u003Cp\u003EAh right, it\u0027s just that your code that you presented uses PartModule. Is it supposed to?\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-11-19T16:29:28Z","Content":"\n\u003Cp\u003EStupid copy-paste.\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022https://github.com/SirDiazo/RCSLandAid/blob/master/RCSLandAid/RCSLandAid.cs#L9\u0022 rel=\u0022external nofollow\u0022\u003EHere is what I actually meant to link.\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EThe link (now removed) in my first post was a different mod that used a partModule attach to a part, it had nothing to do with the KSPAddon I was talking about.\u003C/p\u003E\u003Cp\u003ESorry about that,\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n"},{"CreatedByName":"Xaiier","CreatedById":22833,"CreatedDateTime":"2014-11-19T16:31:39Z","Content":"\n\u003Cp\u003EThe physics update rate is 50 per second as the timestep is 0.02, the 30 mentioned is incorrect. You may want to see \u003Ca href=\u0022http://docs.unity3d.com/ScriptReference/Time.html\u0022 rel=\u0022external nofollow\u0022\u003ETHIS\u003C/a\u003E for a better explanation of the physics update system.\u003C/p\u003E\u003Cp\u003EIt is unlikely you will need to bother much with that stuff anyways, unless you are doing something really specific.\u003C/p\u003E\n"},{"CreatedByName":"Hexicube","CreatedById":109496,"CreatedDateTime":"2014-11-19T16:41:19Z","Content":"\n\u003Cp\u003EAlright, got it to work now, the fact you don\u0027t override the Start/Update functions threw me off. I can probably look up the remaining things, but I may as well ask here:\u003C/p\u003E\u003Cp\u003E- Is there a way to check if the game is paused? (Update() still called when paused, but my code will not affect the vessel)\u003C/p\u003E\u003Cp\u003E- I assume that data will not persist over each flight? (I don\u0027t want it to, so will I need to clear it out each time?)\u003C/p\u003E\u003Cp\u003E- I will need to load sounds at some stage, is there a convention for doing so?\u003C/p\u003E\u003Cp\u003E[edit] Thanks for that link, saves me time finding out how to check the delta.\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-11-19T16:52:28Z","Content":"\n\u003Cp\u003EFixedUpdate() is 50 times a second? Okay. Either way, my point about trying to link data back and forth between the two methods still stands in that the relation between them will vary from computer to computer. Recently ran into an issue where a guy was assuming they ran on a one-to-one basis, so Update, FixedUpdate, Update, FixedUpdate, etc. and I wanted to be clear that is not the case.\u003C/p\u003E\u003Cp\u003EOn not overriding the Start() and Update() functions, KSP is a bit of an odd duck in that regard. My limited (and probably wrong) understanding of the situation is that KSP finds those methods via reflection and runs them as is so the override keyword does not have it\u0027s typical C# definition here.\u003C/p\u003E\u003Cp\u003ETry somewhere in the HighLogic class for checking if the game is paused, I think there is also an OnGamePause event in the GameEvents class.\u003C/p\u003E\u003Cp\u003ENo, data does not persist. The class is destroyed when you exit the flight scene. One caution however is that static variables seem to persist due to their nature. I had some weirdness with that and I had to add some \u0022reset to default\u0022 code in the OnDisable() method so things would have the values I expected the next time the flight scene was entered.\u003C/p\u003E\u003Cp\u003EAnd I have no clue about sounds, I\u0027ve never touched them. Try searching for a sounds mod to see how they handled it maybe?\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-11-19T16:55:18Z\u0022 title=\u002211/19/2014 04:55  PM\u0022 data-short=\u00229 yr\u0022\u003ENovember 19, 2014\u003C/time\u003E by Diazo\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"dazoe","CreatedById":100450,"CreatedDateTime":"2014-12-01T01:29:19Z","Content":"\n\u003Cp\u003EI just want to point out that the Awake, Start, Update, FixedUpdate, OnGUI, OnDestory functions are in fact called by the unity engine that KSP runs on instead of KSP it\u0027s self. Unity has a lot of documentation online so that would be a good place to start. The only down side is because KSP is a production build you are very limited with what you can do with the unity editor, for when I\u0027m messing around with plugins I don\u0027t even use unity, only Visual Studio. \u003Ca href=\u0022http://docs.unity3d.com/ScriptReference\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://docs.unity3d.com/ScriptReference\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EOn the note of being able to save data from one instance to another there is the PluginConfiguration class (from KSP\u0027s KSP.IO name space). I\u0027m not sure about the correct time to load the config but it seems to work find in the class constructor, and you can save the config in the OnDestroy method.\u003C/p\u003E\u003Cp\u003EHope this helps.\u003C/p\u003E\u003Cp\u003Eedit:\u003C/p\u003E\u003Cp\u003EAnother thing to note is about the time you spend in the various Update methods. For example taking too long in a FixedUpdate call could cause KSP to lag the physics causing KSP\u0027s performance to suffer. I\u0027m sure everyone know of the clock in the upper left corner of the screen if it turns red bad things are bound to happen.\u003C/p\u003E\u003Cp\u003EThere is also InvokeRepeating if you\u0027d like to create your own \u0022FixedUpdate\u0022 like method. It will instruct Unity to call a method at a custom fixed rate\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-12-01T01:33:15Z\u0022 title=\u002212/01/2014 01:33  AM\u0022 data-short=\u00229 yr\u0022\u003EDecember 1, 2014\u003C/time\u003E by dazoe\u003C/strong\u003E\n\u003C/span\u003E\n"}]}