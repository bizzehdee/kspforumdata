{"TopicId":131647,"ForumId":29,"TopicTitle":"Can I prevent a PartModule from saving entirely?","CreatedByName":"SixHourDays","CreatedById":140711,"CreatedDateTime":"2016-02-08T13:06:03Z","PageNum":1,"Articles":[{"CreatedByName":"SixHourDays","CreatedById":140711,"CreatedDateTime":"2016-02-08T13:06:03Z","Content":"\n\u003Cp\u003E\nHey everyone,\n\u003C/p\u003E\n\u003Cp\u003E\nHow can I \u003Cstrong\u003Eprevent\u003C/strong\u003E\u00A0a PartModule from saving entirely? \u00A0Mine are completely stateless, but there can be a lot of them; I\u0027d like to not clutter up saves.\n\u003C/p\u003E\n\u003Cp\u003E\nLonger explanation - I originally used ModuleManager to add these modules to ships - but I discovered that EVA Kerbals are immune to ModuleManager. \u00A0So I switched to scanning ships in the scene myself, and adding my helper modules to them in OnAwake. \u00A0However - on reload of ships that have saved them out, all the mismatched module indices make a lot of warning spam.\n\u003C/p\u003E\n\u003Cp\u003E\nAs always - any help is appreciated!\n\u003C/p\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2016-02-08T15:09:09Z","Content":"\n\u003Cp\u003E\nDo your modules have to be PartModules? What do they do? You might be able to get away with attaching custom MonoBehaviours right to the prefabs. That would definitely be the cleanest solution\n\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2016-02-08T15:16:44Z","Content":"\n\u003Cp\u003E\nYou talk about scanning ships, would VesselModule work?\n\u003C/p\u003E\n\u003Cp\u003E\nA class that inherits VesselModule gets a single copy of it added to every vessel in the game so would that work for you? (Remember that a Kerbal on EVA counts as a vessel.)\n\u003C/p\u003E\n\u003Cp\u003E\nThe big limitation is that VesselModule can not load or save data itself, but as you specifically say you don\u0027t need to do this that removes the biggest obstacle to using VesselModule.\n\u003C/p\u003E\n\u003Cp\u003E\nD.\n\u003C/p\u003E\n"},{"CreatedByName":"SixHourDays","CreatedById":140711,"CreatedDateTime":"2016-02-09T18:44:15Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nQuote\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\n\u003Cspan style=\u0022color:rgb(39,42,52);font-family:\u0027Helvetica Neue\u0027, Helvetica, Arial, sans-serif;font-size:14px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:22.4px;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;float:none;background-color:rgb(255,255,255);\u0022\u003EDo your modules have to be PartModules? What do they do?\u003C/span\u003E\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nI have ModuleScienceHelper part modules, and necessarily so. \u00A0I create one whenever I detect\u00A0existing ModuleScienceContainers or ModuleScienceExperiment modules in parts, and my module targets that. \u00A0So every ModuleScienceContainer has a ModuleScienceHelper dealing with it, and similarly for the experiments. \u00A0To be clear - my mod is partless; I\u0027m altering existing parts behaviour, not adding new ones.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nThe ModuleScienceHelper modules exist to\u00A0supress / mess with the target right click events (changing descriptions / visibility), and they also usurp those events with their own versions so I can get a notification of the right click event.\u00A0 For example: for containers, I\u0027m surpressing the ReviewData KSPEvent in the original module, providing my own identical looking version, and when my version is clicked, it\u00A0notifies my mod and then passes through the call\u00A0to the original containers handler method. \u00A0I\u0027ve done it that way because some things in KSP just don\u0027t have an event, and I need a notify when those things happen.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nQuote\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\n\u003Cspan style=\u0022color:rgb(39,42,52);font-family:\u0027Helvetica Neue\u0027, Helvetica, Arial, sans-serif;font-size:14px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:22.4px;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;float:none;background-color:rgb(255,255,255);\u0022\u003EYou talk about scanning ships, would VesselModule work?\u003C/span\u003E\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nProbably not. \u00A0It solves the issue of stuff saving out, but I lose the ability to provide my own KSPEvents etc, which I need. \u00A0Furthermore - by using my pairwise helper modules whenever I find parts with my desired targets (ModuleScience[Container/Experiment]), I\u0027m hoping to work with other mods more easily - as long as their crazy new parts have my target part modules, I\u0027ll find them, pair up helpers, and all should go smoothly. \u00A0Tbh though that\u0027s more of a future concern...solely considering working on stock 1.0.5 atm.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nLet\u0027s talk about OnSave. \u00A0It appears that the whole contents of my PartModule is present in the ConfigNode passed to me. \u00A0Can I literally just erase all of it? \u00A0If I can somehow get the parent ConfigNode, erase the child (my partmodules MODULE section), would that save out as if my part module doesn\u0027t exist in the ship? \u00A0Ideally that\u0027s what I\u0027d like - keep my PartModules, and have them never save to disk.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-02-09T18:55:05Z\u0022 title=\u002202/09/2016 06:55  PM\u0022 data-short=\u00228 yr\u0022\u003EFebruary 9, 2016\u003C/time\u003E by SixHourDays\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2016-02-09T19:50:09Z","Content":"\n\u003Cp\u003E\nErm, I suppose you could try something like:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html\u0022\u003E\npublic override void OnSave(ConfigNode node)\n{\nnode.RemoveValues(); //can\u0027t remember the exact method, check the object broswer.\nnode.RemoveNodes();\n}\u003C/pre\u003E\n\u003Cp\u003E\nI think OnSave runs after the KSFields save and so would wipe the data?\n\u003C/p\u003E\n\u003Cp\u003E\nHowever, that would still leave an empty MODULE node in the .sfs file. I don\u0027t think it would break anything but something to watch for.\n\u003C/p\u003E\n\u003Cp\u003E\nI will confirm that if you need to access to KSPEvents you have to use a partModule.\n\u003C/p\u003E\n\u003Cp\u003E\nD.\n\u003C/p\u003E\n"},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2016-02-09T20:07:03Z","Content":"\n\u003Cp\u003E\nAnother option would be to go back to using MM, and then just have a small VesselModule which just checks if its a Kerbal, adds the module(s) if yes, and then destroys itself\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint\u0022\u003E\n// blah blah, VM declarations...\npublic void Awake() // Might have to wait until start, can\u0027t remember\n{\n \tVessel v =  GetComponent\u0026lt;Vessel\u0026gt;();\n  if (v.isEVA)\n    v.rootPart.AddModules();\n  Destroy(this);\n}\u003C/pre\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-02-09T20:11:17Z\u0022 title=\u002202/09/2016 08:11  PM\u0022 data-short=\u00228 yr\u0022\u003EFebruary 9, 2016\u003C/time\u003E by Crzyrndm\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"SixHourDays","CreatedById":140711,"CreatedDateTime":"2016-02-09T21:04:19Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nQuote\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\n\u003Cspan style=\u0022color:rgb(39,42,52);font-family:\u0027Helvetica Neue\u0027, Helvetica, Arial, sans-serif;font-size:14px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:22.4px;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;float:none;background-color:rgb(255,255,255);\u0022\u003E\u003Cspan\u003E\u00A0\u003C/span\u003Eleave an empty MODULE node in the .sfs file. I don\u0027t think it would break anything but something to watch for.\u003C/span\u003E\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nI agree, hence wanting the parent, so I can remove that.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022http://forum.kerbalspaceprogram.com/index.php?/profile/92871-crzyrndm/\u0026amp;do=hovercard\u0022 data-mentionid=\u002292871\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/92871-crzyrndm/\u0022\u003E@Crzyrndm\u003C/a\u003E\u00A0- I could do that, but I\u0027m left in the same predicament if you leave the flight scene (and thus save) with Kerbals on EVA. \u00A0They would save out my helpers still - this kind of duality dealing with Kerbals in one way and ships another was what drove me to attempt a single solution to begin with.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-02-09T21:07:31Z\u0022 title=\u002202/09/2016 09:07  PM\u0022 data-short=\u00228 yr\u0022\u003EFebruary 9, 2016\u003C/time\u003E by SixHourDays\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2016-02-09T23:56:56Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222400992\u0022 data-ipsquote-contentid=\u0022131647\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221455043455\u0022 data-ipsquote-userid=\u0022140711\u0022 data-ipsquote-username=\u0022SixHourDays\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n5 hours ago, SixHourDays said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nFor example: for containers, I\u0027m surpressing the ReviewData KSPEvent in the original module, providing my own identical looking version, and when my version is clicked, it\u00A0notifies my mod and then passes through the call\u00A0to the original containers handler method. \u00A0I\u0027ve done it that way because some things in KSP just don\u0027t have an event, and I need a notify when those things happen.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nIf there were an event that allowed you to intercept (and potentially veto) your target KSPEvent(s), would you still need to define your own? That\u0027s how I\u0027d handle this. If you never need any more BaseFields than what your target modules implement, you can get away with just hijacking them and avoid being a PartModule altogether\n\u003C/p\u003E\n"},{"CreatedByName":"SixHourDays","CreatedById":140711,"CreatedDateTime":"2016-02-10T00:20:55Z","Content":"\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022http://forum.kerbalspaceprogram.com/index.php?/profile/75857-xevilreeperx/\u0026amp;do=hovercard\u0022 data-mentionid=\u002275857\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/75857-xevilreeperx/\u0022\u003E@xEvilReeperx\u003C/a\u003E\u00A0I am adding my own unique KSPEvents via ModuleScienceHelpers, in addition to the supressing/altering/replacing my targets KSPEvents as I described above :-( \u00A0Good suggestion though.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nThanks to everyone who\u0027s helping out! \u00A0We\u0027re almost there folks\u00A0- I just need a way to erase that MODULE configNode from the parent. \u00A0Does Part or Vessel have some equivalent to OnSave like PartModule does? \u00A0All I need is access to the ConfigNode\u0027s above my PartModule....I\u0027d settle for the whole Part, the whole Vessel...anything?\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n(btw I\u0027m still working, I\u0027m replying when I can)\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-02-10T00:22:04Z\u0022 title=\u002202/10/2016 12:22  AM\u0022 data-short=\u00228 yr\u0022\u003EFebruary 10, 2016\u003C/time\u003E by SixHourDays\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2016-02-10T13:35:14Z","Content":"\n\u003Cp\u003E\nThis is the best solution I could come up with:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode\u0022\u003E\n[KSPScenario(ScenarioCreationOptions.AddToAllGames, GameScenes.FLIGHT)]\npublic class ScenarioHideTheNut : ScenarioModule\n{\n    public override void OnSave(ConfigNode node)\n    {\n        base.OnSave(node);\n\n        foreach (var pps in HighLogic.CurrentGame.flightState.protoVessels.SelectMany(pv =\u0026gt; pv.protoPartSnapshots))\n            pps.modules.RemoveAll(\n                ppms =\u0026gt; (ppms.moduleRef != null \u0026amp;\u0026amp; ppms.moduleRef.GetType() == typeof (ModuleNut)) ||\n                        ppms.moduleName == typeof (ModuleNut).Name);\n    }\n}\n\npublic class ModuleNut : PartModule\n{\n    [KSPEvent(guiName = \u0022Hello world\u0022, active = true, guiActive = true)]\n    public void HelloWorld()\n    {\n        print(\u0022Nut says, \\\u0022Hello world!\\\u0022\u0022);\n    }\n}\n\n\npublic class AddNutToAllParts : VesselModule\n{\n    private void Start()\n    {\n        if (!HighLogic.LoadedSceneIsFlight) return;\n\n        var vessel = GetComponent\u0026lt;Vessel\u0026gt;();\n\n        foreach (var p in vessel.parts)\n            if (!p.gameObject.GetComponents\u0026lt;ModuleNut\u0026gt;().Any())\n            {\n                print(\u0022Adding \u0022 \u002B typeof (ModuleNut).Name \u002B \u0022 to \u0022 \u002B p.partInfo.name);\n                p.AddModule(typeof (ModuleNut).Name);\n            }\n    }\n}\u003C/pre\u003E\n\u003Cp\u003E\nThe ScenarioModule will prevent any PartModule(s) you want from being saved to the ConfigNode without preventing them from working normally otherwise. I used a VesselModule to add the test PartModule to the parts in the flight scene but it should work with MM scripts as well* if one needed to hide those\n\u003C/p\u003E\n\u003Cp\u003E\nEdit: *It occurs to me that you\u0027d probably want to make sure your MM patch ran last to avoid those mismatch problems if you weren\u0027t adding PartModules on the fly\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-02-10T14:01:35Z\u0022 title=\u002202/10/2016 02:01  PM\u0022 data-short=\u00228 yr\u0022\u003EFebruary 10, 2016\u003C/time\u003E by xEvilReeperx\u003C/strong\u003E\n\u003C/span\u003E\n"}]}