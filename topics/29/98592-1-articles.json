{"TopicId":98592,"ForumId":29,"TopicTitle":"Finding a part on another vessel in OnStart()","CreatedByName":"lo-fi","CreatedById":111099,"CreatedDateTime":"2015-02-02T20:56:04Z","PageNum":1,"Articles":[{"CreatedByName":"lo-fi","CreatedById":111099,"CreatedDateTime":"2015-02-02T20:56:04Z","Content":"\n\u003Cp\u003EOK, this one is tricky.\u003C/p\u003E\u003Cp\u003ESo I\u0027ve got a PartModule which is creating joints that acts as a trailer hitch. It stores the flightID of the part it gets hitched up to in persistence with the aim of finding that same part to run some checks against and create the joint with again.\u003C/p\u003E\u003Cp\u003ENow, both vessels, tractor and trailer (for arguments sake, I\u0027m not trying to create Farm Simulator here \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif\u0022 alt=\u0022;)\u0022\u003E ) stay as separate vessels, which is deliberate. What seems to be happening when the scene switches to flight is this:\u003C/p\u003E\u003Cp\u003EIf you select the tractor as the vessel to fly from the KSC:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Eforeach (Part pa in FindObjectsOfType(typeof(Part)) as Part[])\u003Cbr\u003E{\u003Cbr\u003E        print(pa.flightID);\u003Cbr\u003E        if (pa.flightID.Equals(uint.Parse(_flightID))) //seemed to have an issue with Uints as KSPFields, so I save  _flightID as string and reparse.                            {\u003Cbr\u003E              {\u003Cbr\u003E\u003Cbr\u003E               //truncated\u003Cbr\u003E              }\u003Cbr\u003E}\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003Eprints the ID of the parts in the tractor vessel and nothing more. Looking further into the logs suggests that all the parts and part modules for the trailer get going after this point.\u003C/p\u003E\u003Cp\u003ESelecting the trailer as the vessel to fly, prints the parts of both vessels, presumably because the tractor was second on the scene (as it were), and things work as expected. \u003C/p\u003E\u003Cp\u003ESo my question is this: Is there a point after which all vessels have been unpacked and are active, but BEFORE physics starts, and how might I tell when that point is? What I don\u0027t want to happen is for things to move about before the hitch joint is recreated, for obvious reasons.\u003C/p\u003E\u003Cp\u003EMany thanks!\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-02-02T21:01:53Z\u0022 title=\u002202/02/2015 09:01  PM\u0022 data-short=\u00229 yr\u0022\u003EFebruary 2, 2015\u003C/time\u003E by lo-fi\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"*Aqua*","CreatedById":103926,"CreatedDateTime":"2015-02-02T21:48:16Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022lo-fi\u0022 data-cite=\u0022lo-fi\u0022\u003E\u003Cdiv\u003E(...) tractor and trailer (...)\u003Cp\u003Efor arguments sake, I\u0027m not trying to create Farm Simulator here\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003EAre you sure? \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 alt=\u0022:D\u0022\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003ESo my question is this: Is there a point after which all vessels have been unpacked and are active, but BEFORE physics starts, and how might I tell when that point is? What I don\u0027t want to happen is for things to move about before the hitch joint is recreated, for obvious reasons.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EPacking \u0026amp; unpacking are the names of the processes when physics activate or deactivate I think.\u003C/p\u003E\u003Cp\u003EWhat might help you:\u003C/p\u003E\u003Cp\u003EGameEvents.onPartPack \u0026amp; onPartUnpack - Fired when a part comes into or leaves physics range/go on rails/leave rails\u003C/p\u003E\u003Cp\u003EGameEvents.onVesselGoOnRails \u0026amp; onVesselGoOffRails - The same but with whole vessels\u003C/p\u003E\u003Cp\u003EThese are events. When you hook on them they\u0027ll call whatever method you like when the conditions are met.\u003C/p\u003E\u003Cp\u003EExample:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Evoid Start()\u003Cbr\u003E{\u003Cbr\u003EGameEvents.onVesselGoOffRails.Add(GoingOffRailsEvent);\u003Cbr\u003E}\u003Cbr\u003E...\u003Cbr\u003Evoid GoingOffRailsEvent(Vessel vessel)\u003Cbr\u003E{\u003Cbr\u003E// vessel is the vessel which is going to/is in the process of/was going off rails.\u003Cbr\u003E// But the fact that you are getting a fully initialized Vessel object indicates\u003Cbr\u003E// that physics were loaded just the very moment before.\u003Cbr\u003E}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EIt might be a good idea to hook on that event, apply your checks and then wait for the next fixed update (= physics frame) to see if your joint works.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-02-02T21:50:39Z\u0022 title=\u002202/02/2015 09:50  PM\u0022 data-short=\u00229 yr\u0022\u003EFebruary 2, 2015\u003C/time\u003E by *Aqua*\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"lo-fi","CreatedById":111099,"CreatedDateTime":"2015-02-02T21:58:30Z","Content":"\n\u003Cp\u003EWell, if someone wants to model some cows and sheep, why not? \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif\u0022 alt=\u0022;)\u0022\u003E\u003C/p\u003E\u003Cp\u003EOK, that all makes sense. I\u0027ll hook into the events, set up a few debug lines and see how it goes. Looking at the log, \u003Cspan style=\u0022color:#333333;\u0022\u003EonVesselGoOffRails (Log message saying vessels are unpacked) \u003C/span\u003Eseems to be one of the last things that happens, and crucially after the trailer logs a load of stuff, implying its PartModules are active). Thank you!\u003C/p\u003E\u003Cp\u003EEDIT: Indeed, that does the trick. Thanks!\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-02-02T22:12:13Z\u0022 title=\u002202/02/2015 10:12  PM\u0022 data-short=\u00229 yr\u0022\u003EFebruary 2, 2015\u003C/time\u003E by lo-fi\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"ZodiusInfuser","CreatedById":76163,"CreatedDateTime":"2015-02-02T22:29:40Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022lo-fi\u0022 data-cite=\u0022lo-fi\u0022\u003E\u003Cdiv\u003EWell, if someone wants to model some cows and sheep, why not? \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif\u0022 alt=\u0022;)\u0022\u003E\u003Cp\u003EOK, that all makes sense. I\u0027ll hook into the events, set up a few debug lines and see how it goes. Looking at the log, \u003Cspan style=\u0022color:#333333;\u0022\u003EonVesselGoOffRails (Log message saying vessels are unpacked) \u003C/span\u003Eseems to be one of the last things that happens, and crucially after the trailer logs a load of stuff, implying its PartModules are active). Thank you!\u003C/p\u003E\u003Cp\u003EEDIT: Indeed, that does the trick. Thanks!\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EMake sure you add code to handle two craft becoming separated due to timewarp, because guaranteed there\u0027ll be someone who will try and use your hitch on orbit \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif\u0022 alt=\u0022:P\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"lo-fi","CreatedById":111099,"CreatedDateTime":"2015-02-02T22:32:14Z","Content":"\n\u003Cp\u003EThanks, that\u0027s a whole other thing to tackle. Still not sure how to handle that. :/\u003C/p\u003E\n"},{"CreatedByName":"Gaalidas","CreatedById":111158,"CreatedDateTime":"2015-02-03T00:20:03Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022ZodiusInfuser\u0022 data-cite=\u0022ZodiusInfuser\u0022\u003E\u003Cdiv\u003EMake sure you add code to handle two craft becoming separated due to timewarp, because guaranteed there\u0027ll be someone who will try and use your hitch on orbit \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif\u0022 alt=\u0022:P\u0022\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ESpace train anyone? That\u0027s right, we\u0027re going to do something that should never be done and try to pull one craft with another using rope. What could go wrong?\u003C/p\u003E\n"},{"CreatedByName":"ZodiusInfuser","CreatedById":76163,"CreatedDateTime":"2015-02-03T01:36:28Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022lo-fi\u0022 data-cite=\u0022lo-fi\u0022\u003E\u003Cdiv\u003EThanks, that\u0027s a whole other thing to tackle. Still not sure how to handle that. :/\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI would handle it by just checking if the crafts have drifted apart and if so don\u0027t create the joint upon existing timewarp. No idea what you\u0027re trying to accomplish \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif\u0022 alt=\u0022:P\u0022\u003E. Don\u0027t overcomplicate things if you dont have to.\u003C/p\u003E\n"},{"CreatedByName":"philotical","CreatedById":109390,"CreatedDateTime":"2015-02-03T04:03:54Z","Content":"\n\u003Cp\u003Eit might be a good idea to store the \u0022relative location\u0022 of the trailer vessel, if you do that, you can easely re-position it, even on the first physics frame and add the joint then..\u003C/p\u003E\u003Cp\u003Eat least that is what I think could work simpler and it would handle the drifting away problem just the same..\u003C/p\u003E\u003Cp\u003EIn my opinion, what you try to fight here is a race-car-condition..\u003C/p\u003E\u003Cp\u003EIt might not allways come up in the same order.. - so the first physics frame is still invisible to the user and surely not too early\u003C/p\u003E\u003Cp\u003EI\u0027ve been workin on a \u0022soft docking\u0022 for my huge stations - ship stays there but is still seperate - I use forces for this and the results are not as good as hoped..\u003C/p\u003E\u003Cp\u003ESo I\u0027m very intrested in your code if this get\u0027s released :-P\u003C/p\u003E\u003Cp\u003EIt might solve my problem too..\u003C/p\u003E\u003Cp\u003EThe seperate vessel thing is required for an NCI detail in case you wondered..\u003C/p\u003E\u003Cp\u003Eif they\u0027d docked real, NCI would no longer work as it should..\u003C/p\u003E\n"},{"CreatedByName":"lo-fi","CreatedById":111099,"CreatedDateTime":"2015-02-03T16:48:22Z","Content":"\n\u003Cp\u003EIt may be a non starter as Zodius suggests, but this is something I\u0027d really like to get to work. Relative position and orientation are easy, there are objects on hitch and corresponding coupling on the trailer that reveal that data easily. Snapping the trailer back to the correct position and orientation would be easy, though I\u0027ll possibly have to adjust the trailer velocity or hilarity will ensue. Might be a fun one to love stream, lots of cool stuff to show off. \u003C/p\u003E\u003Cp\u003ENot sure if you saw in KF thread, I\u0027m planning on making soft tie downs in the same fashion for attaching rovers to carrying craft. This might be even closer to what you\u0027re looking for! The current plan is to have a little part that you surface attach in various places to the rover or carrier. When commanded, they will raycast a certain distance and use the collision data to create a joint between themselves and what they hit - much the same as the hitch, but more forgiving of position and locks things tightly in place without docking. Could, of course, be integrated into another part with the addition of some extra transforms. All good fun!\u003C/p\u003E\n"},{"CreatedByName":"lo-fi","CreatedById":111099,"CreatedDateTime":"2015-02-03T22:54:17Z","Content":"\n\u003Cp\u003EAlso, one question:\u003C/p\u003E\u003Cp\u003EGameEvents.onVesselGoOffRails.Add(VesselUnPack); seems to add a hook every time OnStart is called and results in it being added every time you scene change, for example. Is there a way to check if it\u0027s been added already? Or is it better form to remove it, and if so, where?\u003C/p\u003E\n"},{"CreatedByName":"philotical","CreatedById":109390,"CreatedDateTime":"2015-02-03T23:01:42Z","Content":"\n\u003Cp\u003Eif(!GameEvents.onVesselGoOffRails.Contains(VesselUnPack))\u003C/p\u003E\u003Cp\u003E{\u003C/p\u003E\u003Cp\u003E GameEvents.onVesselGoOffRails.Add(VesselUnPack);\u003C/p\u003E\u003Cp\u003E}\u003C/p\u003E\u003Cp\u003Eno?\u003C/p\u003E\n"},{"CreatedByName":"lo-fi","CreatedById":111099,"CreatedDateTime":"2015-02-03T23:11:07Z","Content":"\n\u003Cp\u003EHmmm, no method like Contains()\u003C/p\u003E\n"},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2015-02-03T23:25:12Z","Content":"\n\u003Cp\u003EOnDestroy should work for a part module. It gets called just before leaving the scene \u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Evoid OnDestroy()\u003Cbr\u003E{\u003Cbr\u003E    GameEvents.onVesselGoOffRails.Remove(VesselUnpack);\u003Cbr\u003E}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n"},{"CreatedByName":"lo-fi","CreatedById":111099,"CreatedDateTime":"2015-02-03T23:39:58Z","Content":"\n\u003Cp\u003EThanks, that seems to be the one!\u003C/p\u003E\n"}]}