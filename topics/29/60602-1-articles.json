{"TopicId":60602,"ForumId":29,"TopicTitle":"ConfigNode Issues with a couple of Vector Types","CreatedByName":"TriggerAu","CreatedById":57838,"CreatedDateTime":"2014-01-21T12:05:28Z","PageNum":1,"Articles":[{"CreatedByName":"TriggerAu","CreatedById":57838,"CreatedDateTime":"2014-01-21T12:05:28Z","Content":"\n\u003Cp\u003EI\u0027ve been fiddling around with the ConfigNode type a fair bit in the last few days and have struck an issue that I was wondering if anyone else has struck. Any ideas would be much appreciated.\u003C/p\u003E\u003Cp\u003EI am doing this from code for a plugin and so using the ConfigNode.CreateConfigFromObject and ConfigNode.LoadObjectFromConfig to load/save an object and have the code structure worked out. I then tried to do this against all the types in the Parse functions - String, Bool, Enum, Vector2, Vector3, Vector3d, Vector4, etc. and I struck an issue with the Vector2 and vector3d types.\u003C/p\u003E\u003Cp\u003EIn a nutshell the short version of code looks like this and the String is successfully saved into the test.cfg file and loaded back from it - I can rem out the save line and edit the file and get the right value.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Epublic class Storage\u003Cbr\u003E    {\u003Cbr\u003E        [Persistent] String TestString = \u0022New String\u0022;\u003Cbr\u003E    }\u003Cbr\u003E...\u003Cbr\u003E    [KSPAddon(KSPAddon.Startup.MainMenu, false)]\u003Cbr\u003E    public class PersistingDataErrors: MonoBehaviour\u003Cbr\u003E    {\u003Cbr\u003E        Storage sTest = new Storage();\u003Cbr\u003E        void Awake()\u003Cbr\u003E        {\u003Cbr\u003E                ConfigNode cnToSave = ConfigNode.CreateConfigFromObject(sTest, new ConfigNode());\u003Cbr\u003E                cnToSave.Save(AssemblyPath \u002B \u0022/Test.cfg\u0022);\u003Cbr\u003E\u003Cbr\u003E                ConfigNode cnToLoad = ConfigNode.Load(AssemblyPath \u002B \u0022/Test.cfg\u0022);\u003Cbr\u003E                ConfigNode.LoadObjectFromConfig(sTest, cnToLoad);\u003Cbr\u003E\u003Cbr\u003E        }\u003Cbr\u003E    }\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EI can replace the String with a Vector3, Enum, Boolean and it all works as expected, but if I replace it With a Vector3d then on the save I get an Error \u0022\u003Cspan style=\u0022color:#FF0000;\u0022\u003ECannot cast from source type to destination type.\u003C/span\u003E\u0022, but I can load a Vector3d.\u003C/p\u003E\u003Cp\u003EIf I try a Vector2, then the save part works, but on a load I get \u0022\u003Cspan style=\u0022color:#FF0000;\u0022\u003EObject type UnityEngine.Vector3 cannot be converted to target type: UnityEngine.Vector2\u003C/span\u003E\u0022\u003C/p\u003E\u003Cp\u003EI\u0027ve tested using the Parse/Write functions for the two types and they work successfully to read write between a string and the specific object, but from the serialising functions I cant make these two work.\u003C/p\u003E\u003Cp\u003EA full plugin source demonstrating it can be found here - \u003Ca href=\u0022https://ksppluginframework.codeplex.com/SourceControl/latest#Examples/PersistingDataErrors/PersistingDataErrors.cs\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://ksppluginframework.codeplex.com/SourceControl/latest#Examples/PersistingDataErrors/PersistingDataErrors.cs\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EAny ideas or help would be ace.\u003C/p\u003E\n"},{"CreatedByName":"theSpeare","CreatedById":62144,"CreatedDateTime":"2014-01-21T12:17:09Z","Content":"\n\u003Cp\u003E(don\u0027t really have anything to help but I have a question)\u003C/p\u003E\u003Cp\u003ESince you\u0027re tinkering around with this and you definitely know a lot more about this than me but could you please explain how I could go about reading multiple nodes that are identical?\u003C/p\u003E\u003Cp\u003Evalues\u003C/p\u003E\u003Cp\u003E{\u003C/p\u003E\u003Cp\u003Evar_1 = 0;\u003C/p\u003E\u003Cp\u003Evar_2 = 20;\u003C/p\u003E\u003Cp\u003Evar_3 = 35;\u003C/p\u003E\u003Cp\u003E}\u003C/p\u003E\u003Cp\u003Evalues\u003C/p\u003E\u003Cp\u003E{\u003C/p\u003E\u003Cp\u003Evar_s = 2;\u003C/p\u003E\u003Cp\u003E}\u003C/p\u003E\u003Cp\u003Evalues\u003C/p\u003E\u003Cp\u003E{\u003C/p\u003E\u003Cp\u003Evar_2 = 21;\u003C/p\u003E\u003Cp\u003Evar_4 = 2;\u003C/p\u003E\u003Cp\u003E}\u003C/p\u003E\n"},{"CreatedByName":"taniwha","CreatedById":57176,"CreatedDateTime":"2014-01-21T12:58:29Z","Content":"\n\u003Cp\u003E\u003Cstrong\u003ETrigger Au\u003C/strong\u003E: I don\u0027t know about Vector2, but Vector3d is a KSP type, and it doesn\u0027t even have Parse methods.\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003EtheSpeare\u003C/strong\u003E: you use ConfigNode []values = node.GetNodes (\u0022values\u0022);\u003C/p\u003E\u003Cp\u003EThat will give you a potentially empty list of the matching nodes (ie, values{}).\u003C/p\u003E\n"},{"CreatedByName":"TriggerAu","CreatedById":57838,"CreatedDateTime":"2014-01-21T20:18:32Z","Content":"\n\u003Cp\u003EHi taniwha, thanks for the response I did think that might be it originally, but looking at the ConfigNode Class in VS\u0027s Object Browser you can see these two methods so I think it should work:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Epublic static Vector3d ParseVector3D(string vectorString)\u003Cbr\u003Epublic static string WriteVector(Vector3d vector)\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EI also used those to test the parse/writes to and from strings, it just seems to be the serialising function that fails, and only on one action, eg. It will load the Vector3d from a configNode serialised object, just wont write it.\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003EtheSpeare:\u003C/strong\u003E taniwha\u0027s answer looks spot on to me, feel free to come back with more questions, although another thread might be a better place - or the developer question mega thread\u003C/p\u003E\n"},{"CreatedByName":"TriggerAu","CreatedById":57838,"CreatedDateTime":"2014-01-24T09:10:08Z","Content":"\n\u003Cp\u003EJust wondering if anybody else have any ideas/info here before I log a bug?\u003C/p\u003E\n"},{"CreatedByName":"stupid_chris","CreatedById":62017,"CreatedDateTime":"2014-01-24T13:37:26Z","Content":"\n\u003Cp\u003EI\u0027ve encountered something similar lately. The problem I believe comes from the fact Unity does not recognize the type of Vector3d. On my side I was trying to save an array of values as Vector3d in an OnLoad() override. When I set debug logs up, the array was full as expected during loading, but empty when it got to the VAB. The only thing I could do to get it to work was to switch to Vector3 and add a [serializeField] in front of my declared array.\u003C/p\u003E\u003Cp\u003EAs for parsing, I\u0027d recommend using KSPUtil\u0027s ParseVector3d. I\u0027ve been getting really weird results from ConfigNode\u0027s parsers lately, not sure what\u0027s up with them.\u003C/p\u003E\n"},{"CreatedByName":"TriggerAu","CreatedById":57838,"CreatedDateTime":"2014-01-24T23:32:43Z","Content":"\n\u003Cp\u003EThanks Chris, unfortunately if I switch to the other methods I will have to write an object parser and reflect all the properties myself, which is beyond my knowledge.\u003C/p\u003E\u003Cp\u003EIf its an issue I might log it and use Vector3\u0027s for storing Vector3d and Vector2\u0027s in the meantime.\u003C/p\u003E\n"}]}