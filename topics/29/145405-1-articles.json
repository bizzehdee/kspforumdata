{"TopicId":145405,"ForumId":29,"TopicTitle":"Changing the building upgrade level?","CreatedByName":"Angelo Kerman","CreatedById":106975,"CreatedDateTime":"2016-08-05T04:34:06Z","PageNum":1,"Articles":[{"CreatedByName":"Angelo Kerman","CreatedById":106975,"CreatedDateTime":"2016-08-05T04:34:06Z","Content":"\n\u003Cp\u003E\nIf I call UpgradeableFacility.setNormLevel, what else do I need to do to make sure that the space center updates the buildings? When I call that method, the buildings update but the game won\u0027t highlight the buildings when I mouseover them. Here\u0027s what I do:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003E        public virtual void ApplyFacilities(bool saveGame = false)\n        {\n            if (facilitiesNode == null)\n            {\n                Debug.Log(\u0022No facilities snapshot, exiting\u0022);\n                return;\n            }\n            ConfigNode[] nodes = facilitiesNode.GetNodes();\n            float level;\n            for (int index = 0; index \u0026lt; nodes.Length; index\u002B\u002B)\n            {\n                if (ScenarioUpgradeableFacilities.protoUpgradeables.ContainsKey(nodes[index].name))\n                {\n                    level = float.Parse(nodes[index].GetValue(\u0022lvl\u0022));\n                    foreach (Upgradeables.UpgradeableFacility facility in ScenarioUpgradeableFacilities.protoUpgradeables[nodes[index].name].facilityRefs)\n                    {\n                        facility.setNormLevel(level);\n                    }\n                }\n            }\n\n            //Save the game\n            if (saveGame)\n                GamePersistence.SaveGame(\u0022persistent\u0022, HighLogic.SaveFolder, SaveMode.BACKUP);\n        }\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nIn the above code, I\u0027ve copied the config node for each building in the facilities scenario, and all I\u0027m doing is reading the values and telling the appropriate facility refs to set their upgrade level. It works, and the building changes its upgrade level, but then subsequent mouse-over events don\u0027t get noticed and the building doesn\u0027t highlight.\n\u003C/p\u003E\n"},{"CreatedByName":"JPLRepo","CreatedById":114736,"CreatedDateTime":"2016-08-05T06:14:42Z","Content":"\n\u003Cp\u003E\nwhat are you trying to do exactly?\u00A0 I\u0027m confused what you are trying to do? You are reading the current level of each Upgradeable (although there is an easier way see below) and then trying to set the level to the same value and then save the game?\n\u003C/p\u003E\n\u003Cp\u003E\nNot sure I understand why you are doing this? The ScenarioUpgradeableFacilities is automatically persisted to the save file already?\n\u003C/p\u003E\n\u003Cp\u003E\nBTW:\u003Cbr\u003E\nScenarioUpgradeableFacilities.Instance.GetFacilityLevel(SpaceCenterFacility enum value);\u003Cbr\u003E\nwill get the current facility level for whichever SpaceCenterFacility you pass in (it\u0027s an Enum).\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E\n\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"JPLRepo","CreatedById":114736,"CreatedDateTime":"2016-08-05T06:37:50Z","Content":"\n\u003Cp\u003E\nI think you need to be looking at the SpaceCenterBuilding class instead.\u003Cbr\u003E\nYou need to probably iterate the destructible array that is part of this class for each building and call the Reset method on each, and then setNormLevel.\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027m guessing your issue with the Highlighting is tied to the GUI and the fact that you are not triggering this via the UI, I suspect it is therefore not doing something to the UI that you are missing which is causing that issue. So the Tooltips? are not working when you over over the Facilities after you do this? What about the Building Picker? (the icons down the left side).\u003Cbr\u003E\u003Cbr\u003E\nThe timing could also important here.. are you doing this in the Spacecenter Scene? After Awake? If before, timing will be an issue.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-08-05T06:52:03Z\u0022 title=\u002208/05/2016 06:52  AM\u0022 data-short=\u00227 yr\u0022\u003EAugust 5, 2016\u003C/time\u003E by JPLRepo\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Angelo Kerman","CreatedById":106975,"CreatedDateTime":"2016-08-09T05:04:44Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222705289\u0022 data-ipsquote-contentid=\u0022145405\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221470379070\u0022 data-ipsquote-userid=\u0022114736\u0022 data-ipsquote-username=\u0022JPLRepo\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nOn 8/4/2016 at 11:37 PM, JPLRepo said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nI think you need to be looking at the SpaceCenterBuilding class instead.\u003Cbr\u003E\nYou need to probably iterate the destructible array that is part of this class for each building and call the Reset method on each, and then setNormLevel.\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027m guessing your issue with the Highlighting is tied to the GUI and the fact that you are not triggering this via the UI, I suspect it is therefore not doing something to the UI that you are missing which is causing that issue. So the Tooltips? are not working when you over over the Facilities after you do this? What about the Building Picker? (the icons down the left side).\u003Cbr\u003E\u003Cbr\u003E\nThe timing could also important here.. are you doing this in the Spacecenter Scene? After Awake? If before, timing will be an issue.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nHow do you get an instance of the SpaceCenterBuilding? I haven\u0027t been able to find it.\n\u003C/p\u003E\n"},{"CreatedByName":"JPLRepo","CreatedById":114736,"CreatedDateTime":"2016-08-09T06:12:02Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222710398\u0022 data-ipsquote-contentid=\u0022145405\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221470719084\u0022 data-ipsquote-userid=\u0022106975\u0022 data-ipsquote-username=\u0022Angel-125\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n1 hour ago, Angel-125 said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nHow do you get an instance of the SpaceCenterBuilding? I haven\u0027t been able to find it.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nHow about PsystemSetup.Instance.GetSpaceCenterFacilities(); - will give you an array of PsystemSetup.SpaceCenterFacility\u003Cbr\u003E\nor PsystemSetup.Instance.GetSpaceCenterFacility(\u0022\u0026lt;nameoffacility\u0026gt;\u0022); will return the single PsystemSetup.SpaceCenter\u003Cbr\u003E\n\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"Angelo Kerman","CreatedById":106975,"CreatedDateTime":"2016-08-09T17:49:08Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222710443\u0022 data-ipsquote-contentid=\u0022145405\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221470723122\u0022 data-ipsquote-userid=\u0022114736\u0022 data-ipsquote-username=\u0022JPLRepo\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n10 hours ago, JPLRepo said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nHow about PsystemSetup.Instance.GetSpaceCenterFacilities(); - will give you an array of PsystemSetup.SpaceCenterFacility\u003Cbr\u003E\nor PsystemSetup.Instance.GetSpaceCenterFacility(\u0022\u0026lt;nameoffacility\u0026gt;\u0022); will return the single PsystemSetup.SpaceCenter\u003Cbr\u003E\n\u00A0\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nSadly PsystemSetup.SpaceCenterFacility doesn\u0027t give me the ability to set the level. So far I haven\u0027t found an API that gets me access to the SpaceCenterFacility object. Any ideas?\n\u003C/p\u003E\n"},{"CreatedByName":"JPLRepo","CreatedById":114736,"CreatedDateTime":"2016-08-09T20:10:58Z","Content":"\n\u003Cp\u003E\nLet\u0027s go back a step. I believe what you are doing in your original code is the correct way to set the upgrade level of the facilities.\u003Cbr\u003E\nI think the issue here is, in stock it does not set the level in that way during the game (only on scene load) and what is missing is reset of the ToolTip UI objects attached to the facility prefab.\u003Cbr\u003E\nDuring normal gameplay the user initiates the upgrade via the GUI windows. I suspect by calling the setlevel function, the GUI is not being updated correctly to identify the upgraded building prefab.\n\u003C/p\u003E\n\u003Cp\u003E\nYou said originally that highlighting and mouse-over events stop working on the upgraded buildings.\u003Cbr\u003E\nWhat about the building picker icons? The icons down the left side of the space center. Do these still appear? and do they still work?\n\u003C/p\u003E\n\u003Cp\u003E\nI think what is missing here is by call setNormLevel you are skipping the GameEvents that trigger the UI SpaceCenterBuilding from updating.\n\u003C/p\u003E\n\u003Cp\u003E\nI think you actually need to call the SetLevel method of the UpgradeableFacility as it triggers the GameEvents.\n\u003C/p\u003E\n\u003Cp\u003E\nTry changing that bit of your code like this and see what happens:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pun\u0022\u003E\u0026lt;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Esnip \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E-\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E rest of code the same above\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E\u0026gt;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n  \n\u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Eif\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan\u003EScenarioUpgradeableFacilities\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003EprotoUpgradeables\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan\u003EContainsKey\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Enodes\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E[\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Eindex\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E].\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Ename\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E))\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E{\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n\tlevel \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E=\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan\u003Efloat\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan\u003EParse\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Enodes\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E[\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Eindex\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E].\u003C/span\u003E\u003Cspan\u003EGetValue\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan class=\u0022str\u0022\u003E\u0022lvl\u0022\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E));\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n    foreach \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan\u003EUpgradeables\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan\u003EUpgradeableFacility\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E facility in \u003C/span\u003E\u003Cspan\u003EScenarioUpgradeableFacilities\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003EprotoUpgradeables\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E[\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Enodes\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E[\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Eindex\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E].\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Ename\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E].\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003EfacilityRefs\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E)\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n    \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E{\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n      \t\u003C/span\u003E\u003Cspan class=\u0022com\u0022\u003E// You have to set your level to an in from the normalized value first, which is what setNormLevel does, but it doesn\u0027t fire the GameEvents\t\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n      \tlevel \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E=\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan\u003EMathf\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan\u003EClamp01\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Elevel\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E);\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n\t\tlevel \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E=\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan\u003EMathf\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan\u003EFloorToInt\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Elevel \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E*\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan\u003Efloat\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E)(\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Efacility\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan\u003EMaxLevel\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E\u002B\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022lit\u0022\u003E1\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E));\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n\t\tlevel \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E=\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan\u003EMathf\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan\u003EClamp\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Elevel\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E,\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022lit\u0022\u003E0\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E,\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E facility\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan\u003EMaxLevel\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E);\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E  \n      \t\u003C/span\u003E\u003Cspan class=\u0022com\u0022\u003E//Now call SetLevel, which does fire the GameEvents using the int level value from the normalized value.\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n      \tfacility\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan\u003ESetLevel\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Elevel\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E);\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n    \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E}\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E}\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n\n\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E\u0026lt;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Esnip \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E-\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E rest of code the same below\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E\u0026gt;\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"Angelo Kerman","CreatedById":106975,"CreatedDateTime":"2016-08-09T23:35:51Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222711057\u0022 data-ipsquote-contentid=\u0022145405\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221470773458\u0022 data-ipsquote-userid=\u0022114736\u0022 data-ipsquote-username=\u0022JPLRepo\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n3 hours ago, JPLRepo said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nLet\u0027s go back a step. I believe what you are doing in your original code is the correct way to set the upgrade level of the facilities.\u003Cbr\u003E\nI think the issue here is, in stock it does not set the level in that way during the game (only on scene load) and what is missing is reset of the ToolTip UI objects attached to the facility prefab.\u003Cbr\u003E\nDuring normal gameplay the user initiates the upgrade via the GUI windows. I suspect by calling the setlevel function, the GUI is not being updated correctly to identify the upgraded building prefab.\n\u003C/p\u003E\n\u003Cp\u003E\nYou said originally that highlighting and mouse-over events stop working on the upgraded buildings.\u003Cbr\u003E\nWhat about the building picker icons? The icons down the left side of the space center. Do these still appear? and do they still work?\n\u003C/p\u003E\n\u003Cp\u003E\nI think what is missing here is by call setNormLevel you are skipping the GameEvents that trigger the UI SpaceCenterBuilding from updating.\n\u003C/p\u003E\n\u003Cp\u003E\nI think you actually need to call the SetLevel method of the UpgradeableFacility as it triggers the GameEvents.\n\u003C/p\u003E\n\u003Cp\u003E\nTry changing that bit of your code like this and see what happens:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint prettyprinted\u0022\u003E\n\n\u003Cspan class=\u0022pun\u0022\u003E\u0026lt;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Esnip \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E-\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E rest of code the same above\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E\u0026gt;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n  \n\u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Eif\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan\u003EScenarioUpgradeableFacilities\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003EprotoUpgradeables\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan\u003EContainsKey\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Enodes\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E[\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Eindex\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E].\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Ename\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E))\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E{\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n\tlevel \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E=\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan\u003Efloat\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan\u003EParse\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Enodes\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E[\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Eindex\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E].\u003C/span\u003E\u003Cspan\u003EGetValue\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan class=\u0022str\u0022\u003E\u0022lvl\u0022\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E));\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n    foreach \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan\u003EUpgradeables\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan\u003EUpgradeableFacility\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E facility in \u003C/span\u003E\u003Cspan\u003EScenarioUpgradeableFacilities\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003EprotoUpgradeables\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E[\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Enodes\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E[\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Eindex\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E].\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Ename\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E].\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003EfacilityRefs\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E)\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n    \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E{\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n      \t\u003C/span\u003E\u003Cspan class=\u0022com\u0022\u003E// You have to set your level to an in from the normalized value first, which is what setNormLevel does, but it doesn\u0027t fire the GameEvents\t\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n      \tlevel \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E=\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan\u003EMathf\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan\u003EClamp01\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Elevel\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E);\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n\t\tlevel \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E=\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan\u003EMathf\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan\u003EFloorToInt\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Elevel \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E*\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan\u003Efloat\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E)(\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Efacility\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan\u003EMaxLevel\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E\u002B\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022lit\u0022\u003E1\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E));\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n\t\tlevel \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E=\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan\u003EMathf\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan\u003EClamp\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Elevel\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E,\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022lit\u0022\u003E0\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E,\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E facility\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan\u003EMaxLevel\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E);\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E  \n      \t\u003C/span\u003E\u003Cspan class=\u0022com\u0022\u003E//Now call SetLevel, which does fire the GameEvents using the int level value from the normalized value.\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n      \tfacility\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan\u003ESetLevel\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Elevel\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E);\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n    \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E}\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E}\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n\n\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E\u0026lt;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Esnip \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E-\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E rest of code the same below\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E\u0026gt;\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nI\u0027ll give that a try, thanks! \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nThat did the trick, thanks again! \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"JPLRepo","CreatedById":114736,"CreatedDateTime":"2016-08-09T23:56:00Z","Content":"\n\u003Cp\u003E\nSo it worked? That\u0027s Excellent. Sorry for a bit of a run around earlier in the week. I didn\u0027t sit down and actually think it through properly the first time.\n\u003C/p\u003E\n"}]}