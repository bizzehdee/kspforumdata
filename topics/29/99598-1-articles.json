{"TopicId":99598,"ForumId":29,"TopicTitle":"How can I tell if a body is being drawn in Flight?","CreatedByName":"MOARdV","CreatedById":60950,"CreatedDateTime":"2015-02-13T23:42:53Z","PageNum":1,"Articles":[{"CreatedByName":"MOARdV","CreatedById":60950,"CreatedDateTime":"2015-02-13T23:42:53Z","Content":"\n\u003Cp\u003EFor instance, when I orbit Kerbin, I see Kerbin, Mun, and Minmus. What do I look at to figure out that those bodies are being rendered in flight (I don\u0027t care about Map View, for instance)?\u003C/p\u003E\n"},{"CreatedByName":"*Aqua*","CreatedById":103926,"CreatedDateTime":"2015-02-14T08:38:59Z","Content":"\n\u003Cp\u003ECamera.current.WorldToScreenPoint(Vector3 position)\u003C/p\u003E\u003Cp\u003EIf I understand the \u003Ca href=\u0022http://docs.unity3d.com/ScriptReference/Camera.WorldToScreenPoint.html\u0022 rel=\u0022external nofollow\u0022\u003Edocumentation\u003C/a\u003E right, this method will return the 2D screen position of a 3D coordinate. If you use that on the 3D position of a celestial you should be able to calculate if the center of that celestial is visible on the screen.\u003C/p\u003E\u003Cp\u003EIs this what you are looking for? Or do you want to find out if any part of a celestial is visible on the screen?\u003C/p\u003E\n"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2015-02-14T09:09:51Z","Content":"\n\u003Cp\u003EYou could also try body.gameObject.renderer.isVisible but I m not sure how it will do with multiple cam.\u003C/p\u003E\n"},{"CreatedByName":"MOARdV","CreatedById":60950,"CreatedDateTime":"2015-02-14T13:30:13Z","Content":"\n\u003Cp\u003E@*Aqua* - no, that\u0027s not quite what I was looking for. I want to ask KSP \u0022Are you rendering the model for this body?\u0022. For instance, over Kerbin, you can look around and see the sun, Kerbin, Mun, and Minmus, but none of the other worlds are visible. If you fly out to Duna, you can\u0027t see any worlds once you\u0027ve moved away from Kerbin, and then one day as you approach, Duna appears. I want to find out which planets KSP wants to draw while in flight.\u003C/p\u003E\u003Cp\u003EThe specific problem I\u0027m trying to solve is this: I\u0027m currently maintaining the Distant Object Enhancement plugin. It draws impostors (\u0022flares\u0022) to represent each planet, so you can see them in space, even when you\u0027re not near them. The original plugin developer used an algorithm to determine whether or not to draw the flare based on the angular size of the world. However, the algorithm isn\u0027t perfect, so the impostor for Minmus is drawn over / near the model of Minmus that is rendered in orbit. I want to ask KSP if it\u0027s already drawing the model for a world, so I know I don\u0027t need to draw the impostor.\u003C/p\u003E\u003Cp\u003E@sarbian - renderer is null for all worlds. gameObject.activeSelf == true for all worlds. I\u0027ve already look at PQS (as a wild guess), but that can\u0027t be it, since Jool\u0027s is null. I think I looked at body.scaledBody, as well, and that wasn\u0027t it, either. I guess I\u0027ll keep peeking at values.\u003C/p\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2015-02-14T15:00:20Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022MOARdV\u0022 data-cite=\u0022MOARdV\u0022\u003E\u003Cdiv\u003EI want to ask KSP if it\u0027s already drawing the model for a world, so I know I don\u0027t need to draw the impostor.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThis snippet might help you, then. You should be able to adapt it to your needs:\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://puu.sh/fUhHb/5aa7b7eac6.png\u0022 alt=\u00225aa7b7eac6.png\u0022\u003E\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E[KSPAddon(KSPAddon.Startup.Flight, false)]\u003Cbr\u003Epublic class RenderedPlanetLocations : MonoBehaviour\u003Cbr\u003E{\u003Cbr\u003E    private List\u0026lt;Transform\u0026gt; _scaledTransforms = new List\u0026lt;Transform\u0026gt;();\u003Cbr\u003E    private Texture2D _redTexture;\u003Cbr\u003E\u003Cbr\u003E    private void Start()\u003Cbr\u003E    {\u003Cbr\u003E        _scaledTransforms =\u003Cbr\u003E            ScaledSpace.Instance.scaledSpaceTransforms\u003Cbr\u003E            .Where(ss =\u0026gt; ss.GetComponent\u0026lt;ScaledSpaceFader\u0026gt;() != null)\u003Cbr\u003E            .ToList();\u003Cbr\u003E\u003Cbr\u003E        // create red box texture\u003Cbr\u003E        _redTexture = new Texture2D(32, 32, TextureFormat.ARGB32, false);\u003Cbr\u003E\u003Cbr\u003E        _redTexture.SetPixels(Enumerable.Repeat(Color.clear, _redTexture.width*_redTexture.height).ToArray());\u003Cbr\u003E\u003Cbr\u003E        for (int y = 0; y \u0026lt; _redTexture.height; \u002B\u002By)\u003Cbr\u003E            for (int x = 0; x \u0026lt; _redTexture.width; \u002B\u002Bx)\u003Cbr\u003E                if (x% (_redTexture.width - 1) == 0 || y% (_redTexture.height - 1)== 0)\u003Cbr\u003E                    _redTexture.SetPixel(x, y, new Color(1f, 0f, 0f, 0.33f));\u003Cbr\u003E\u003Cbr\u003E        _redTexture.Apply();\u003Cbr\u003E\u003Cbr\u003E    }\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E    private void OnGUI()\u003Cbr\u003E    {\u003Cbr\u003E        var ssCamera = ScaledCamera.Instance.camera;\u003Cbr\u003E\u003Cbr\u003E        foreach (var t in _scaledTransforms)\u003Cbr\u003E        {\u003Cbr\u003E            if (!t.renderer.enabled) // game isn\u0027t rendering it at all\u003Cbr\u003E                continue;\u003Cbr\u003E\u003Cbr\u003E            if (!t.renderer.isVisible) // might be valid target for rendering, but is offscreen\u003Cbr\u003E                continue;\u003Cbr\u003E\u003Cbr\u003E            var screenPos = ssCamera.WorldToScreenPoint(t.transform.position);\u003Cbr\u003E\u003Cbr\u003E            if (screenPos.z \u0026lt; 0f) // behind the camera\u003Cbr\u003E                continue;\u003Cbr\u003E\u003Cbr\u003E            if (screenPos.x \u0026gt;= 0 \u0026amp;\u0026amp; screenPos.y \u0026lt; ssCamera.pixelWidth)\u003Cbr\u003E                if (screenPos.y \u0026gt;= 0 \u0026amp;\u0026amp; screenPos.y \u0026lt; ssCamera.pixelHeight)\u003Cbr\u003E                {\u003Cbr\u003E                    screenPos.y = Screen.height - screenPos.y;\u003Cbr\u003E\u003Cbr\u003E                    if (Event.current.type == EventType.Repaint)\u003Cbr\u003E                        Graphics.DrawTexture(new Rect(screenPos.x - _redTexture.width * 0.5f, screenPos.y - _redTexture.height * 0.5f, _redTexture.width, _redTexture.height), _redTexture);\u003Cbr\u003E\u003Cbr\u003E                    GUI.Label(new Rect(screenPos.x - GUI.skin.label.CalcSize(new GUIContent(t.name)).x * 0.5f, screenPos.y - _redTexture.height * 0.7f, 100f, 28f), t.name);\u003Cbr\u003E                }\u003Cbr\u003E        }\u003Cbr\u003E    }\u003Cbr\u003E}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-02-14T15:02:26Z\u0022 title=\u002202/14/2015 03:02  PM\u0022 data-short=\u00229 yr\u0022\u003EFebruary 14, 2015\u003C/time\u003E by xEvilReeperx\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"stupid_chris","CreatedById":62017,"CreatedDateTime":"2015-02-14T19:13:28Z","Content":"\n\u003Cp\u003EProblem is I think theyre technically always rendered. If you could zoom in enough, you could see Jool from the surface of Kerbin. I believe a past telescope mod could show this. Theyre jut so small theyre not really visible.\u003C/p\u003E\n"},{"CreatedByName":"MOARdV","CreatedById":60950,"CreatedDateTime":"2015-02-15T00:07:56Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022xEvilReeperx\u0022 data-cite=\u0022xEvilReeperx\u0022\u003E\u003Cdiv\u003EThis snippet might help you, then. You should be able to adapt it to your needs:\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYeah, that shows boxes around the worlds I\u0027m near, but nothing for the other worlds, so that\u0027s the key I need.\u003C/p\u003E\u003Cp\u003EThank you.\u003C/p\u003E\n"}]}