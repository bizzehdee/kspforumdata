{"TopicId":166271,"ForumId":29,"TopicTitle":"Part ConfigNode persistence of UPGRADESAPPLIED.","CreatedByName":"Rodhern","CreatedById":144074,"CreatedDateTime":"2017-10-08T02:10:31Z","PageNum":1,"Articles":[{"CreatedByName":"Rodhern","CreatedById":144074,"CreatedDateTime":"2017-10-08T02:10:31Z","Content":"\n\u003Cp\u003E\nI have a part module, \u0022\u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003EHeavyHelixSampleStorage\u003C/span\u003E\u0022, that inherits directly from \u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003EPartModule\u003C/span\u003E. The class has a field called \u0022\u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003EMyValue\u003C/span\u003E\u0022 that is marked with \u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003EKSPField (isPersistant= true)\u003C/span\u003E.\n\u003C/p\u003E\n\u003Cp\u003E\nEverything works the way I expect it to, except for \u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003EUPGRADESAPPLIED\u003C/span\u003E. The module node in the .sfs file may look like this:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode\u0022\u003E\nMODULE\n{\n  name = HeavyHelixSampleStorage\n  isEnabled = True\n  MyValue = 0\n  stagingEnabled = True\n  EVENTS\n  {\n  }\n  ACTIONS\n  {\n  }\n  SAMPLES\n  {\n  }\n  UPGRADESAPPLIED\n  {\n  }\n}\u003C/pre\u003E\n\u003Cp\u003E\nOnce I have called the inherited \u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003EOnSave\u003C/span\u003E I have a node with \u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003Ename\u003C/span\u003E, \u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003EisEnabled\u003C/span\u003E, \u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003EMyValue\u003C/span\u003E, \u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003EstagingEnabled\u003C/span\u003E, \u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003EEVENTS\u003C/span\u003E and \u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003EACTIONS\u003C/span\u003E.\n\u003C/p\u003E\n\u003Cp\u003E\nCool, that is everything taken care of except for \u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003ESAMPLES\u003C/span\u003E, which on purpose isn\u0027t marked with the \u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003EKSPField\u003C/span\u003E attribute, and \u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003EUPGRADESAPPLIED\u003C/span\u003E.\n\u003C/p\u003E\n\u003Cp\u003E\nMy save logic so far has been to add/save the \u0027missing\u0027 items. For some reason it seems that \u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003EUPGRADESAPPLIED\u003C/span\u003E breaks that logic; the node is not added in the inherited \u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003EOnSave\u003C/span\u003E, but it is added later on, resulting in two nodes if I have already added one.\n\u003C/p\u003E\n\u003Cp\u003E\nTo me it appears it might be a bug, but it may also be that it is just quirky part upgrade behaviour; any insights?\n\u003C/p\u003E\n\u003Cp\u003E\nEdit: I decided that it is weird enough to put on the bug tracker (marked as feedback).\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222017-10-08T04:33:57Z\u0022 title=\u002210/08/2017 04:33  AM\u0022 data-short=\u00226 yr\u0022\u003EOctober 8, 2017\u003C/time\u003E by Rodhern\u003C/strong\u003E\n\u003Cbr\u003Espelling; bug tracker\n\u003C/span\u003E\n"},{"CreatedByName":"blowfish","CreatedById":119688,"CreatedDateTime":"2017-10-10T23:37:56Z","Content":"\n\u003Cp\u003E\nThe\u00A0UPGRADESAPPLIED node is KSP\u0027s way of keeping track of what part upgrades have been applied to the module.\u00A0 You shouldn\u0027t need to touch it yourself.\u00A0 I don\u0027t quite see why it would be a problem but maybe I\u0027m not understanding what you\u0027re trying to do here...\n\u003C/p\u003E\n"},{"CreatedByName":"Rodhern","CreatedById":144074,"CreatedDateTime":"2017-10-11T01:12:42Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223191627\u0022 data-ipsquote-contentid=\u0022166271\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221507678676\u0022 data-ipsquote-userid=\u0022119688\u0022 data-ipsquote-username=\u0022blowfish\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n1 hour ago, blowfish said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nThe\u00A0UPGRADESAPPLIED node is KSP\u0027s way of keeping track of what part upgrades have been applied to the module.\u00A0 You shouldn\u0027t need to touch it yourself.\u00A0 I don\u0027t quite see why it would be a problem but maybe I\u0027m not understanding what you\u0027re trying to do here...\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nWell, technically you are correct, it is not a problem, it is more of a nuisance.\n\u003C/p\u003E\n\u003Cp\u003E\nIn my naive implementation my custom modules would store the node information in memory when loaded, then write the in-memory information when saved. This way any information changed in the meantime would automatically make its way to the persisted node. In the naive implementation PartModule.OnSave (the inherited bits) would fill out everything except my custom data, so I just had to not overwrite the already added values and nodes and all was good. With UPGRADESAPPLIED in the picture I have to (at least indirectly) keep track of which data is custom data. Just seems like an unnecessary complication to me, but sure, it is manageable.\n\u003C/p\u003E\n"},{"CreatedByName":"blowfish","CreatedById":119688,"CreatedDateTime":"2017-10-11T02:27:58Z","Content":"\n\u003Cp\u003E\nWait, but why do you even need to do any custom loading/saving?\u00A0 KSP does that all automatically\n\u003C/p\u003E\n"},{"CreatedByName":"Rodhern","CreatedById":144074,"CreatedDateTime":"2017-10-11T06:48:33Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223191705\u0022 data-ipsquote-contentid=\u0022166271\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221507688878\u0022 data-ipsquote-userid=\u0022119688\u0022 data-ipsquote-username=\u0022blowfish\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n4 hours ago, blowfish said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nWait, but why do you even need to do any custom loading/saving?\u00A0 KSP does that all automatically.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nYou make a good point; most people probably won\u0027t be bothered this \u0027issue\u0027.\n\u003C/p\u003E\n\u003Cp\u003E\nIt is not so much that I \u003Cem\u003Eneed\u003C/em\u003E to do custom load/save, it is more that I find it more natural or elegant. In case you are wondering, I am happy to give an example:\n\u003C/p\u003E\n\u003Cp\u003E\nMy part module is a container that is supposed to store collected \u0027asteroid samples\u0027. When you think about it, there is really no good reason why the part module needs to know every little data detail of an \u0027asteroid sample\u0027 at compile-time. In theory the part module couldn\u0027t care less, if somewhere down the road it is asked to store a sample with data like \u0022colour = green\u0022 or \u0022scent = odourless\u0022, even though those properties do not exist in the present code.\n\u003C/p\u003E\n"},{"CreatedByName":"blowfish","CreatedById":119688,"CreatedDateTime":"2017-10-11T06:51:08Z","Content":"\n\u003Cp\u003E\nSure, save whatever custom data you want.\u00A0 But why try to save things that KSP is already saving for you?\u00A0 Whatever you do is likely to conflict with what KSP is doing at some point in time and cause issues.\n\u003C/p\u003E\n"},{"CreatedByName":"Rodhern","CreatedById":144074,"CreatedDateTime":"2017-10-11T07:00:05Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223191831\u0022 data-ipsquote-contentid=\u0022166271\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221507704668\u0022 data-ipsquote-userid=\u0022119688\u0022 data-ipsquote-username=\u0022blowfish\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n2 minutes ago, blowfish said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nSure, save whatever custom data you want.\u00A0 But why try to save things that KSP is already saving for you?\u00A0 Whatever you do is likely to conflict with what KSP is doing at some point in time and cause issues.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nI think we agree on 90%\u002B of the stuff here. Obviously I don\u0027t want to save the stuff that is already saved for me.\n\u003C/p\u003E\n\u003Cp\u003E\nLooking at \u0022EVENTS\u0022, \u0022ACTIONS\u0022 and so on, it seemed to me that there was a sensible pattern there (that PartModule.OnSave takes care of those). Then \u0022UPGRADESAPPLIED\u0022 seemed to break that pattern. At first I was annoyed, and then I got curious if maybe there is a good reason \u0022UPGRADESAPPLIED\u0022 can\u0027t fit the \u0027old\u0027 pattern. That\u0027s all.\n\u003C/p\u003E\n"},{"CreatedByName":"JPLRepo","CreatedById":114736,"CreatedDateTime":"2017-10-11T08:42:45Z","Content":"\n\u003Cp\u003E\nI do not understand the issue. As \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/119688-blowfish/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022119688\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/119688-blowfish/\u0022 id=\u0022ips_uid_2503_3\u0022 style=\u0022\u0022 rel=\u0022\u0022\u003E@blowfish\u003C/a\u003E says. You should not need to do custom saving, loading, etc.\u003Cbr\u003E\nKSP will do it for you if you are inheriting from PartModule.\u003Cbr\u003E\nThe upgrades system is not breaking a pattern. It follows a different pattern. Upgrades are applied and loaded and saved differently because they must apply after everything else.\u003Cbr\u003E\nI still don\u0027t understand your issue. The inherited module will do the saving and loading for you. and if you use the PartModule attributes on your fields it will save and load them for you.\n\u003C/p\u003E\n\u003Cp\u003E\nSounds to me you would like to have something in a set way, that isn\u0027t something you can control when modding someone elses code. So you have to live with it and use what it gives you.\n\u003C/p\u003E\n"},{"CreatedByName":"Rodhern","CreatedById":144074,"CreatedDateTime":"2017-10-11T08:57:27Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223191878\u0022 data-ipsquote-contentid=\u0022166271\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221507711365\u0022 data-ipsquote-userid=\u0022114736\u0022 data-ipsquote-username=\u0022JPLRepo\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n3 minutes ago, JPLRepo said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nSounds to me you would like to have something in a set way, that isn\u0027t something you can control when modding someone elses code. So you have to live with it and use what it gives you.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nYes, I think you hit the nail on the head there. I would prefer to have something in a set way, and I do realize that it is not my decision to make.\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223191878\u0022 data-ipsquote-contentid=\u0022166271\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221507711365\u0022 data-ipsquote-userid=\u0022114736\u0022 data-ipsquote-username=\u0022JPLRepo\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n3 minutes ago, JPLRepo said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nThe upgrades system is not breaking a pattern. It follows a different pattern. Upgrades are applied and loaded and saved differently because they must apply after everything else.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThank you for taking time to answer that there is indeed a reason for the different pattern.\n\u003C/p\u003E\n\u003Cp\u003E\nCan we at least agree, that \u003Cem\u003Eif\u003C/em\u003E there had not been a particular reason for a different pattern, then you could as well use the pattern that is most pleasing to the customer/modder/player ?\n\u003C/p\u003E\n"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2017-10-11T11:29:30Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223191885\u0022 data-ipsquote-contentid=\u0022166271\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221507712247\u0022 data-ipsquote-userid=\u0022144074\u0022 data-ipsquote-username=\u0022Rodhern\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n2 hours ago, Rodhern said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nCan we at least agree, that \u003Cem\u003Eif\u003C/em\u003E there had not been a particular reason for a different pattern, then you could as well use the pattern that is most pleasing to the customer/modder/player ?\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nHow is that doing everything by hand is most pleasing ? Asking everyone to write code just for handling the basic task of loading/saving seems to be less pleasing. If you do not like how it work then write your own partmodule implementation and have fun with it (and don\u0027t complain that your mod does not work with others mods).\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222017-10-11T11:29:42Z\u0022 title=\u002210/11/2017 11:29  AM\u0022 data-short=\u00226 yr\u0022\u003EOctober 11, 2017\u003C/time\u003E by sarbian\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Rodhern","CreatedById":144074,"CreatedDateTime":"2017-10-11T12:01:26Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223191935\u0022 data-ipsquote-contentid=\u0022166271\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221507721370\u0022 data-ipsquote-userid=\u002257146\u0022 data-ipsquote-username=\u0022sarbian\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n5 minutes ago, sarbian said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\n... Asking everyone to write code just for handling the basic task of loading/saving seems to be less pleasing. ...\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nI think you misunderstand what I am trying to say. I completely agree with your statement. I wasn\u0027t trying to say that doing it by hand should be the main way.\n\u003C/p\u003E\n\u003Cp\u003E\nI noticed a pattern/behaviour that would allow several easy ways of implementing part module load/save, and noticed that a particular node got in the way. Now JPLRepo have explained that the upgrades system makes it so that it is not easy to do it the way I suggested. I am sure that sort of conclusion is obvious to those of you that are very familiar with the code. If I don\u0027t ask if a feature can be improved you probably wouldn\u0027t even have guessed how potentially confusing it can be for someone that only knows of the KSP code by a number of API signatures and some forum posts.\n\u003C/p\u003E\n"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2017-10-11T12:30:06Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223191945\u0022 data-ipsquote-contentid=\u0022166271\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221507723286\u0022 data-ipsquote-userid=\u0022144074\u0022 data-ipsquote-username=\u0022Rodhern\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n28 minutes ago, Rodhern said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\npotentially confusing\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nAll of KSP modding is \u0022potentially confusing\u0022. Even for an ex member of the team \u003Cimg alt=\u0022:D\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 title=\u0022:D\u0022\u003E\u003C/p\u003E\n"}]}