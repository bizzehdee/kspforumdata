{"TopicId":178632,"ForumId":29,"TopicTitle":"Persistent Guid are not a thing","CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2018-09-30T04:09:14Z","PageNum":1,"Articles":[{"CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2018-09-30T04:09:14Z","Content":"\n\u003Cp\u003E\nI\u0027ve been going crazy here for a while.\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027m using Guids to identify a number of things, but they keep getting reset to empty.\u00A0 I finally figured out that while you can create a persistant Guid, like this:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003E        [KSPField(isPersistant = true, guiActive = false)]\n        public System.Guid travelbugId;\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nit doesn\u0027t load it.\u00A0 So I\u0027m having to save it as a string, and then after loading, convert that string back to a Guid.\n\u003C/p\u003E\n\u003Cp\u003E\nAm I missing something here, or is this just one of those things that was never implemented?\n\u003C/p\u003E\n\u003Cp\u003E\nWhat seems to work is this:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003E        public System.Guid travelbugId;\n\n        [KSPField(isPersistant = true, guiActive = false)]\n        public string travelbugIdString;\n\n\nvoid Start()\n{\n\ttravelbugId = new Guid(travelbugIdString);\n}\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nKind of annoying, because I now either have to replace all my Guids with a string created from a Guid, or add extra code to convert a Guid to a string for saving, and then more code to convert it back\n\u003C/p\u003E\n\u003Cp\u003E\nEither way is not optimal\n\u003C/p\u003E\n"},{"CreatedByName":"Dagger","CreatedById":147766,"CreatedDateTime":"2018-10-01T00:28:20Z","Content":"\n\u003Cp\u003E\nThat\u0027s because the \u0022BaseField\u0022 class doesn\u0027t implement specifically the GUID type in it\u0027s \u0022Read\u0022 method.\n\u003C/p\u003E\n"},{"CreatedByName":"Shadowmage","CreatedById":138730,"CreatedDateTime":"2018-10-01T18:27:45Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223459938\u0022 data-ipsquote-contentid=\u0022178632\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221538280554\u0022 data-ipsquote-userid=\u0022129964\u0022 data-ipsquote-username=\u0022linuxgurugamer\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nOn 9/29/2018 at 10:09 PM, linuxgurugamer said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nI\u0027ve been going crazy here for a while.\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027m using Guids to identify a number of things, but they keep getting reset to empty.\u00A0 I finally figured out that while you can create a persistant Guid, like this:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\n\u003Cspan class=\u0022pln\u0022\u003E        [KSPField(isPersistant = true, guiActive = false)]\n        public System.Guid travelbugId;\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nit doesn\u0027t load it.\u00A0 So I\u0027m having to save it as a string, and then after loading, convert that string back to a Guid.\n\u003C/p\u003E\n\u003Cp\u003E\nAm I missing something here, or is this just one of those things that was never implemented?\n\u003C/p\u003E\n\u003Cp\u003E\nWhat seems to work is this:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\n\u003Cspan class=\u0022pln\u0022\u003E        public System.Guid travelbugId;\n\n        [KSPField(isPersistant = true, guiActive = false)]\n        public string travelbugIdString;\n\n\nvoid Start()\n{\n\ttravelbugId = new Guid(travelbugIdString);\n}\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nKind of annoying, because I now either have to replace all my Guids with a string created from a Guid, or add extra code to convert a Guid to a string for saving, and then more code to convert it back\n\u003C/p\u003E\n\u003Cp\u003E\nEither way is not optimal\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nKSP will not respect fields for persistence/serialization unless the classes were included during compilation -- at least that is how it plays out for user-defined classes.\u00A0 Likely more of a Unity engine issue than KSP per-se....\n\u003C/p\u003E\n\u003Cp\u003E\nFor example the stock Propellant class serializes just fine.\u00A0 Create an identical class (CustomPropellant, or w/e), and load it through a mod .dll, add a field/member to a Part-Module with proper decorations ([Serializable] or w/e), and it will not serialize (methods are never called).\n\u003C/p\u003E\n\u003Cp\u003E\nYes, extremely annoying.\u00A0 Breaks all sorts of things.\u00A0 Makes for ugly code.\u00A0 Not sure that it can be fixed though....\n\u003C/p\u003E\n"},{"CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2018-10-01T21:20:01Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223460560\u0022 data-ipsquote-contentid=\u0022178632\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221538418465\u0022 data-ipsquote-userid=\u0022138730\u0022 data-ipsquote-username=\u0022Shadowmage\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n2 hours ago, Shadowmage said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nKSP will not respect fields for persistence/serialization unless the classes were included during compilation -- at least that is how it plays out for user-defined classes.\u00A0 Likely more of a Unity engine issue than KSP per-se....\n\u003C/p\u003E\n\u003Cp\u003E\nFor example the stock Propellant class serializes just fine.\u00A0 Create an identical class (CustomPropellant, or w/e), and load it through a mod .dll, add a field/member to a Part-Module with proper decorations ([Serializable] or w/e), and it will not serialize (methods are never called).\n\u003C/p\u003E\n\u003Cp\u003E\nYes, extremely annoying.\u00A0 Breaks all sorts of things.\u00A0 Makes for ugly code.\u00A0 Not sure that it can be fixed though....\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nIf it hadn\u0027t worked at all, that would have made sense.\u00A0 The thing which threw me was that it actually did save the data to the file, it just couldn\u0027t load it.\n\u003C/p\u003E\n"},{"CreatedByName":"Shadowmage","CreatedById":138730,"CreatedDateTime":"2018-10-01T23:37:07Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223460626\u0022 data-ipsquote-contentid=\u0022178632\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221538428801\u0022 data-ipsquote-userid=\u0022129964\u0022 data-ipsquote-username=\u0022linuxgurugamer\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n2 hours ago, linuxgurugamer said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nThe thing which threw me was that it actually did save the data to the file, it just couldn\u0027t load it.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nInteresting....\n\u003C/p\u003E\n\u003Cp\u003E\nI wonder if KSP\u0027s serialization simply uses the .ToString() and .Parse() functions for a given Type?\u00A0\u00A0 Does Guid.class have a .Parse(string) method in it anywhere?\n\u003C/p\u003E\n\u003Cp\u003E\nOr perhaps the \u0027serialization\u0027 uses .ToString(), but the \u0027deserialization\u0027 uses, as \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/147766-dagger/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022147766\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/147766-dagger/\u0022 rel=\u0022\u0022\u003E@Dagger\u003C/a\u003E says, some sort of hard-coded switch-statement or dictionary based lookup....\n\u003C/p\u003E\n"},{"CreatedByName":"Dagger","CreatedById":147766,"CreatedDateTime":"2018-10-02T09:38:28Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223460694\u0022 data-ipsquote-contentid=\u0022178632\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221538437027\u0022 data-ipsquote-userid=\u0022138730\u0022 data-ipsquote-username=\u0022Shadowmage\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n9 hours ago, Shadowmage said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nInteresting....\n\u003C/p\u003E\n\u003Cp\u003E\nI wonder if KSP\u0027s serialization simply uses the .ToString() and .Parse() functions for a given Type?\u00A0\u00A0 Does Guid.class have a .Parse(string) method in it anywhere?\n\u003C/p\u003E\n\u003Cp\u003E\nOr perhaps the \u0027serialization\u0027 uses .ToString(), but the \u0027deserialization\u0027 uses, as \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/147766-dagger/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022147766\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/147766-dagger/\u0022 rel=\u0022\u0022\u003E@Dagger\u003C/a\u003E says, some sort of hard-coded switch-statement or dictionary based lookup....\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nYep. Thats it\n\u003C/p\u003E\n\u003Cp\u003E\nFor writing it uses a simple ToString (which makes sense as config nodes are string based) But for reading it uses a \u0022if stair\u0022 (as Types don\u0027t accept switch statements) and it can only read basic types (bool, int, float, vector, etc).\n\u003C/p\u003E\n\u003Cp\u003E\nYou can override this with reflection or some other libraries\u00A0and implement your own read, it might be a bit dirty but it will work.\n\u003C/p\u003E\n"}]}