{"TopicId":83967,"ForumId":29,"TopicTitle":"How to access a certain Scenario Module","CreatedByName":"philotical","CreatedById":109390,"CreatedDateTime":"2014-09-06T20:05:56Z","PageNum":1,"Articles":[{"CreatedByName":"philotical","CreatedById":109390,"CreatedDateTime":"2014-09-06T20:05:56Z","Content":"\n\u003Cp\u003EI made a scenrio module and it seems to work..\u003C/p\u003E\u003Cp\u003Ebut now I need to gain access to it\u0027s data and functions from an other class..\u003C/p\u003E\u003Cp\u003EI seem to have lost the overview - no clue how to do that.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E                            var game = HighLogic.CurrentGame;\u003Cbr\u003E                            ProtoScenarioModule psm = game.scenarios.Find(s =\u0026gt; s.moduleName == typeof(LCARS_NCI_Scenario).Name);\u003Cbr\u003E                            ScenarioModule scm = psm.moduleRef;\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EThis code delivers me the \u0022ScenarioModule\u0022 object..\u003C/p\u003E\u003Cp\u003Ebut it does not know my functions - my class is still not accessible \u003C/p\u003E\u003Cp\u003EI tried to make it static, made trouble, I tried to make a new instance, but that istance didn\u0027t run though onStart so it had no config data.\u003C/p\u003E\u003Cp\u003EHow do I get the running instance of my scenario class.\u003C/p\u003E\u003Cp\u003EI need to call this function somehow..\u003C/p\u003E\u003Cp\u003E*instance_name_of_my_scenario*.addObject(Selected_LCARS_NCI_Object, v.id);\u003C/p\u003E\u003Cp\u003Ecan anyone please hint me to the right direction, so I can get rid of my current brain blockade?\u003C/p\u003E\u003Cp\u003EThanks :-)\u003C/p\u003E\n"},{"CreatedByName":"DMagic","CreatedById":57416,"CreatedDateTime":"2014-09-06T21:12:59Z","Content":"\n\u003Cp\u003EyourScenarioType scm = (yourScenarioType)psm.moduleRef;\u003C/p\u003E\n"},{"CreatedByName":"philotical","CreatedById":109390,"CreatedDateTime":"2014-09-06T22:38:39Z","Content":"\n\u003Cp\u003EThat was the first thing I tried ofcourse..\u003C/p\u003E\u003Cp\u003Eand also right now it produced this:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E[LOG 00:29:26.340] SpawnPart2: ScenarioRef 1 \u003Cbr\u003E[LOG 00:29:26.340] SpawnPart2: ScenarioRef 2 \u003Cbr\u003E[LOG 00:29:26.341] SpawnPart2: ScenarioRef 3 \u003Cbr\u003E[LOG 00:29:26.341] SpawnPart2: LCARS_NCI_Scenario addObject ex=System.NullReferenceException: Object reference not set to an instance of an object\u003Cbr\u003E  at Philotical.LCARS_NaturalCauseInc.SpawnPart2 (.AvailablePart avPart, .CelestialBody SelectedBody) [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003Cbr\u003E[LOG 00:29:26.342] SpawnPart2: ScenarioRef 4\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003Ehere is the code:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E            try\u003Cbr\u003E            {\u003Cbr\u003E                var game = HighLogic.CurrentGame;\u003Cbr\u003E                ProtoScenarioModule psm = game.scenarios.Find(s =\u0026gt; s.moduleName == typeof(LCARS_NCI_Scenario).Name);\u003Cbr\u003E                UnityEngine.Debug.Log(\u0022SpawnPart2: ScenarioRef 2 \u0022);\u003Cbr\u003E                LCARS_NCI_Scenario ScenarioRef = (LCARS_NCI_Scenario)psm.moduleRef;\u003Cbr\u003E                UnityEngine.Debug.Log(\u0022SpawnPart2: ScenarioRef 3 \u0022);\u003Cbr\u003E\u003Cbr\u003E                ScenarioRef.addObject(Selected_LCARS_NCI_Object, v.id);\u003Cbr\u003E                UnityEngine.Debug.Log(\u0022SpawnPart2: LCARS_NCI_Scenario addObject done\u0022);\u003Cbr\u003E            }\u003Cbr\u003E            catch (Exception ex)\u003Cbr\u003E            {\u003Cbr\u003E                UnityEngine.Debug.Log(\u0022SpawnPart2: LCARS_NCI_Scenario addObject ex=\u0022 \u002B ex);\u003Cbr\u003E            }\u003Cbr\u003E            UnityEngine.Debug.Log(\u0022SpawnPart2: ScenarioRef 4 \u0022);\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003ECan it be, that I neglected to set some special thing in my scenrio class to make this work?\u003C/p\u003E\u003Cp\u003EI\u0027m at a loss..\u003C/p\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2014-09-07T14:22:58Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022philotical\u0022 data-cite=\u0022philotical\u0022\u003E\u003Cdiv\u003EThat was the first thing I tried ofcourse..\u003Cp\u003Eand also right now it produced this:\u003C/p\u003E\u003Cp\u003E[LOG 00:29:26.341] SpawnPart2: LCARS_NCI_Scenario addObject ex=System.NullReferenceException: Object reference not set to an instance of an object\u003C/p\u003E\u003Cp\u003E at Philotical.LCARS_NaturalCauseInc.SpawnPart2 (.AvailablePart avPart, .CelestialBody SelectedBody) [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003C/p\u003E\u003Cp\u003E[LOG 00:29:26.342] SpawnPart2: ScenarioRef 4\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EScenarioModules won\u0027t always be initialized when your plugin code runs. I suggest building in a delay with a coroutine. Yours is most likely throwing an exception because moduleRef is null (your code having found an uninitialized ProtoScenarioModule). Here\u0027s an example:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E[KSPAddon(KSPAddon.Startup.Flight, false)]\u003Cbr\u003Eclass StopAnnoyingAsteroids : MonoBehaviour\u003Cbr\u003E{\u003Cbr\u003E    IEnumerator Start()\u003Cbr\u003E    {\u003Cbr\u003E        while (ScenarioRunner.fetch.GetComponent\u0026lt;ScenarioDiscoverableObjects\u0026gt;() == null)\u003Cbr\u003E            yield return 0;\u003Cbr\u003E\u003Cbr\u003E        ScenarioRunner.fetch.GetComponent\u0026lt;ScenarioDiscoverableObjects\u0026gt;().StopAllCoroutines();  // prevent this scenario from spawning more asteroids and spamming my debug log\u003Cbr\u003E    }\u003Cbr\u003E}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n"},{"CreatedByName":"philotical","CreatedById":109390,"CreatedDateTime":"2014-09-08T02:58:07Z","Content":"\n\u003Cp\u003Ethank\u0027s but..\u003C/p\u003E\u003Cp\u003EI can\u0027t use yield in this situation - I\u0027m in sub function called by \u0022OnGUI\u0022 with this and it throughs an exception because of yield (I think)\u003C/p\u003E\u003Cp\u003E\u0026gt;\u0026gt;Error 6 The body of \u0027Philotical.LCARS_NaturalCauseInc.SpawnPart2(AvailablePart, CelestialBody)\u0027 cannot be an iterator block because \u0027Part\u0027 is not an iterator interface type \u003C/p\u003E\u003Cp\u003Eor can I make Part an iterator interface type? (I\u0027ll have to google what exactly it means btw.)\u003C/p\u003E\u003Cp\u003Ewhat happens:\u003C/p\u003E\u003Cp\u003Ein a window, I have a button, when it is clicked by the user, it will execute the above code, among others, and tryes to add some data to the scenario that was started on scene load..\u003C/p\u003E\u003Cp\u003Eit \u0022might\u0022 be, that my scenario is failing somewhere else (although the log states it\u0027s there and working), therefore I\u0027m not entirely sure this yield-suggestion applies here anyway..\u003C/p\u003E\u003Cp\u003Eit\u0027s user input not plugin start.. - does that make a difference or am I just wrong?\u003C/p\u003E\u003Cp\u003EHowever, I came to the assumption, that the problem must be inside my scenario class - it does write in the persistant - but that does not mean it\u0027s not failing somewhere after that..\u003C/p\u003E\u003Cp\u003EI guess if all you guys say, this is the way, then it must be in my code..\u003C/p\u003E\u003Cp\u003EI\u0027ll go hunting - thanks for the help..\u003C/p\u003E\u003Cp\u003Efinally I will locate the cause of my most likely self made issue issue\u003C/p\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2014-09-08T05:13:41Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022philotical\u0022 data-cite=\u0022philotical\u0022\u003E\u003Cdiv\u003Ein a window, I have a button, when it is clicked by the user, it will execute the above code, among others, and tryes to add some data to the scenario that was started on scene load..\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EIf you\u0027re seeing this error after the user clicks a button, my solution won\u0027t work for you. ProtoScenarioModule.moduleRef will only be null for a frame or two at most.\u003C/p\u003E\u003Cp\u003EYou\u0027re sure you\u0027ve set a value for \u0022v\u0022 right? I see the offending call refers to v.id\u003C/p\u003E\n"},{"CreatedByName":"philotical","CreatedById":109390,"CreatedDateTime":"2014-09-08T06:16:33Z","Content":"\n\u003Cp\u003Eyep v is right - however since a few minutes it works..\u003C/p\u003E\u003Cp\u003Ethe problem was somewhere deep in my \u0022wannabe\u0022 scenario..\u003C/p\u003E\u003Cp\u003Eit started, wrote to log and persistant too at game load (main screen to space center)\u003C/p\u003E\u003Cp\u003Ebut in a later call on scene change a sub function failed and ended the class..\u003C/p\u003E\u003Cp\u003Eso on user click the scenario was gone again.. - I\u0027ve never seen it, because my dev requires me to go to tracking station at first lol\u003C/p\u003E\u003Cp\u003Eyou both got me loocking in the right direction though - I started to suspect a self made issue..\u003C/p\u003E\u003Cp\u003EThanks for the support guys - it\u0027s appreciated\u003C/p\u003E\n"}]}