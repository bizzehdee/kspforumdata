{"TopicId":180697,"ForumId":29,"TopicTitle":"How do I make the vessel point in a certain direction?","CreatedByName":"Xyphos","CreatedById":139010,"CreatedDateTime":"2018-12-19T13:18:13Z","PageNum":1,"Articles":[{"CreatedByName":"Xyphos","CreatedById":139010,"CreatedDateTime":"2018-12-19T13:18:13Z","Content":"\n\u003Cp\u003E\nI want to make a simple mod that will hold 90,0,0 degrees but I don\u0027t know how to get/set the vessel\u0027s rotation orientation in space\n\u003C/p\u003E\n"},{"CreatedByName":"HebaruSan","CreatedById":156657,"CreatedDateTime":"2018-12-19T20:00:51Z","Content":"\n\u003Cp\u003E\nAny luck with\u00A0Vessel.Autopilot.\u003Cabbr title=\u0022Stability Augmentation System\u0022\u003ESAS\u003C/abbr\u003E.SetTargetOrientation? I\u0027ve been looking at how MechJeb does attitude control, and this is the only point I can find where its PID controller system calls into KSP code.\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://github.com/MuMech/MechJeb2/blob/7aaa6241e9009265f72aaef9e87d66fc23526fea/MechJeb2/MechJebModuleAttitudeController.cs#L379\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/MuMech/MechJeb2/blob/7aaa6241e9009265f72aaef9e87d66fc23526fea/MechJeb2/MechJebModuleAttitudeController.cs#L379\u003C/a\u003E\n\u003C/p\u003E\n"},{"CreatedByName":"MOARdV","CreatedById":60950,"CreatedDateTime":"2018-12-29T23:51:24Z","Content":"\n\u003Cp\u003E\nIf you are willing to use the stock \u003Cabbr title=\u0022Stability Augmentation System\u0022\u003ESAS\u003C/abbr\u003E system, it can be used to hold a heading when in Stability Assist.\u00A0 See\u00A0\u003Ca href=\u0022https://github.com/MOARdV/AvionicsSystems/blob/master/Source/MASVesselComputerControl.cs\u0022 rel=\u0022external nofollow\u0022\u003Ehere\u003C/a\u003E\u00A0for how I got it working.\u00A0 This is currently rather messy code - I\u0027m going to be splitting it off into its own code eventually.\n\u003C/p\u003E\n\u003Cp\u003E\nThe EngageAttitudePilot method starts the autopilot.\n\u003C/p\u003E\n\u003Cp\u003E\nWhat I\u0027ve found is that the \u003Cabbr title=\u0022Stability Augmentation System\u0022\u003ESAS\u003C/abbr\u003E heading hold is tied to the inertial frame, so you have to repeatedly update it when you want a planet-relative or orbit-relative heading (I\u0027m doing every Fixed Update, although that may be excessive) - that\u0027s what the second \u0027if\u0027 block in PilotFixedUpdate is doing.\n\u003C/p\u003E\n"},{"CreatedByName":"c4ooo","CreatedById":168905,"CreatedDateTime":"2019-01-01T00:10:43Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223513039\u0022 data-ipsquote-contentid=\u0022180697\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221546127484\u0022 data-ipsquote-userid=\u002260950\u0022 data-ipsquote-username=\u0022MOARdV\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nOn 12/29/2018 at 6:51 PM, MOARdV said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nIf you are willing to use the stock \u003Cabbr title=\u0022Stability Augmentation System\u0022\u003ESAS\u003C/abbr\u003E system, it can be used to hold a heading when in Stability Assist.\u00A0 See\u00A0\u003Ca href=\u0022https://github.com/MOARdV/AvionicsSystems/blob/master/Source/MASVesselComputerControl.cs\u0022 rel=\u0022external nofollow\u0022\u003Ehere\u003C/a\u003E\u00A0for how I got it working.\u00A0 This is currently rather messy code - I\u0027m going to be splitting it off into its own code eventually.\n\u003C/p\u003E\n\u003Cp\u003E\nThe EngageAttitudePilot method starts the autopilot.\n\u003C/p\u003E\n\u003Cp\u003E\nWhat I\u0027ve found is that the \u003Cabbr title=\u0022Stability Augmentation System\u0022\u003ESAS\u003C/abbr\u003E heading hold is tied to the inertial frame, so you have to repeatedly update it when you want a planet-relative or orbit-relative heading (I\u0027m doing every Fixed Update, although that may be excessive) - that\u0027s what the second \u0027if\u0027 block in PilotFixedUpdate is doing.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nI yoinked the code\u00A0and it seems to work somewhat. However there are two problems I have with it. First of all, it seems to overshoot all the time, but this should be easy to fix by adjusting the values in\u00A0\u003Ca href=\u0022https://github.com/MOARdV/AvionicsSystems/blob/master/Source/MASVesselComputerControl.cs#L242\u0022 rel=\u0022external nofollow\u0022\u003Earound line 242\u003C/a\u003E. Second of all though, although Rolling and Pitching seem to work fine, adjusting the Heading makes the craft/navball rotate \u0022straight\u0022 to the left/right instead of along an arc.\n\u003C/p\u003E\n\u003Cp\u003E\nFor example, after setting my target pitch to 45, roll to 0, and heading to 0, the code orients the craft like this:\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u00222b6Ioq5.png\u0022 class=\u0022ipsImage\u0022 height=\u0022215\u0022 src=\u0022https://imgur.com/2b6Ioq5.png\u0022 width=\u0022351\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nAs Increment target heading, I expect the craft to rotate along the green line, but instead it rotates along the blue line. Do you have any idea what could be causing this? I replaced the\u00A0getReferenceAttitude(activeReference) on line 235 with\u00A0Quaternion.LookRotation(north, east), where \u0022north\u0022 points to the north of the planet and \u0022east\u0022 points east.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cb\u003EEdit: IDK why i always find solutions soon after I post about something, but I think this code works for calculating\u00A0goalOrientation:\u00A0\u003C/b\u003E\u003Ca href=\u0022https://pastebin.com/G8LABpbm\u0022 style=\u0022font-weight:bold;\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://pastebin.com/G8LABpbm\u003C/a\u003E\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222019-01-01T03:21:58Z\u0022 title=\u002201/01/2019 03:21  AM\u0022 data-short=\u00225 yr\u0022\u003EJanuary 1, 2019\u003C/time\u003E by c4ooo\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"MOARdV","CreatedById":60950,"CreatedDateTime":"2019-01-01T19:26:31Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223514114\u0022 data-ipsquote-contentid=\u0022180697\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221546301443\u0022 data-ipsquote-userid=\u0022168905\u0022 data-ipsquote-username=\u0022c4ooo\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n19 hours ago, c4ooo said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nI yoinked the code\u00A0and it seems to work somewhat\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nYeah, that code is still kind of rough.\u00A0 I\u0027m ripping it out some time in the future and moving it into its own class, where I can isolate it from the rest of the MAS functional code (and focus on making it work better).\u00A0 One of the things I still need to do is change it so it can use a \u0027don\u0027t care\u0027 value for roll, since locking roll is not always useful in orbit.\n\u003C/p\u003E\n"},{"CreatedByName":"Xyphos","CreatedById":139010,"CreatedDateTime":"2019-01-06T04:37:04Z","Content":"\n\u003Cp\u003E\nYeah, I already know about \u003Cabbr title=\u0022Stability Augmentation System\u0022\u003ESAS\u003C/abbr\u003E AutoPilot, I\u0027m the Author of SASAG on \u003Cabbr title=\u0022Comprehensive Kerbal Archive Network (a KSP mod manager)\u0022\u003ECKAN\u003C/abbr\u003E \u003Cspan\u003E:p\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cspan\u003EI wanted to rotate a vessel to point a specific direction (East, zero pitch, zero yaw) so I could automate gravity turns and circulation\u00A0burns, and that\u0027s not possible with stock \u003Cabbr title=\u0022Stability Augmentation System\u0022\u003ESAS\u003C/abbr\u003E unless it\u0027s pointing to a maneuver node.\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cspan\u003EI\u0027ll look over your code, and see if I can find anything useful. thanks\u003C/span\u003E\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222019-01-06T04:40:38Z\u0022 title=\u002201/06/2019 04:40  AM\u0022 data-short=\u00225 yr\u0022\u003EJanuary 6, 2019\u003C/time\u003E by Xyphos\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Xyphos","CreatedById":139010,"CreatedDateTime":"2019-01-06T05:03:26Z","Content":"\n\u003Cp\u003E\nUPDATE: found what I was looking for, thanks. Specifically, the first and last lines in the following highlight block.\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://github.com/MOARdV/AvionicsSystems/blob/master/Source/MASVesselComputerControl.cs#L237-L258\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/MOARdV/AvionicsSystems/blob/master/Source/MASVesselComputerControl.cs#L237-L258\u003C/a\u003E\n\u003C/p\u003E\n"}]}