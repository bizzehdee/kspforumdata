{"TopicId":174182,"ForumId":29,"TopicTitle":"Exception with custom making history node","CreatedByName":"tomf","CreatedById":57809,"CreatedDateTime":"2018-04-22T18:04:29Z","PageNum":1,"Articles":[{"CreatedByName":"tomf","CreatedById":57809,"CreatedDateTime":"2018-04-22T18:04:29Z","Content":"\n\u003Cp\u003E\nI\u0027m attempting to make another custom node for Making History, this time an action to change the focussed vessel. This one fires and changes the focus but seems to be causing an error in the MH code and preventing the next node from firing. Can anyone (probably \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/66485-squad/\u0026amp;do=hovercard\u0022 data-mentionid=\u002266485\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/66485-squad/\u0022 rel=\u0022\u0022\u003E@SQUAD\u003C/a\u003E) tell me what is wrong?\n\u003C/p\u003E\n\u003Cp\u003E\nThe code for the node\n\u003C/p\u003E\n\u003Cdiv class=\u0022ipsSpoiler\u0022 data-ipsspoiler=\u0022\u0022\u003E\n\u003Cdiv class=\u0022ipsSpoiler_header\u0022\u003E\n\u003Cspan\u003ESpoiler\u003C/span\u003E\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsSpoiler_contents\u0022\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-c prettyprinted\u0022\u003E\n\n\u003Cspan class=\u0022kwd\u0022\u003Eclass\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan\u003EActionSwitchFocus\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E:\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan\u003EActionVessel\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n    \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E{\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n\n        \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Epublic\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E override \u003C/span\u003E\u003Cspan\u003EIEnumerator\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan\u003EFire\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E()\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n        \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E{\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n            \u003C/span\u003E\u003Cspan\u003EDebug\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan\u003ELog\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan class=\u0022str\u0022\u003E\u0022Action switch focus is being called\u0022\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E);\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n            \u003C/span\u003E\u003Cspan\u003EVessel\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E v \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E=\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan\u003EFlightGlobals\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan\u003EActiveVessel\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n\n            \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Ebool\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E swit \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E=\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan\u003EFlightGlobals\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan\u003ESetActiveVessel\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Evessel\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E);\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n            \u003C/span\u003E\u003Cspan\u003EDebug\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan\u003ELog\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan class=\u0022str\u0022\u003E\u0022Switch vessel has finished with \u0022\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E\u002B\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E swit\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E);\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n            \u003C/span\u003E\u003Cspan class=\u0022com\u0022\u003E//return base.Fire();\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n            \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Ereturn\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan\u003EEnumerable\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan\u003EEmpty\u003C/span\u003E\u003Cspan class=\u0022str\u0022\u003E\u0026lt;int\u0026gt;\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E().\u003C/span\u003E\u003Cspan\u003EGetEnumerator\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E();\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n        \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E}\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n    \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E}\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/div\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nAnd the Logs\n\u003C/p\u003E\n\u003Cdiv class=\u0022ipsSpoiler\u0022 data-ipsspoiler=\u0022\u0022\u003E\n\u003Cdiv class=\u0022ipsSpoiler_header\u0022\u003E\n\u003Cspan\u003ESpoiler\u003C/span\u003E\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsSpoiler_contents\u0022\u003E\n\u003Cpre class=\u0022ipsCode\u0022\u003E\n\n[HighLogic]: =========================== Scene Change : From FLIGHT to FLIGHT =====================\n \n(Filename: C:/buildslave/unity/build/artifacts/generated/common/runtime/DebugBindings.gen.cpp Line: 51)\n\nSwitch vessel has finished with True\n \n(Filename: C:/buildslave/unity/build/artifacts/generated/common/runtime/DebugBindings.gen.cpp Line: 51)\n\nNullReferenceException\n  at (wrapper managed-to-native) UnityEngine.MonoBehaviour:StartCoroutine_Auto_Internal (System.Collections.IEnumerator)\n  at UnityEngine.MonoBehaviour.StartCoroutine (IEnumerator routine) [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \n  at Expansions.Missions.MENode.ActivateNode (Boolean Loading) [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \n  at Expansions.Missions.Mission.SwitchActiveNodes (Expansions.Missions.MENode newNode) [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \n  at Expansions.Missions.Mission.UpdateMission () [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \n  at Expansions.Missions.Runtime.MissionSystem.UpdateMissions () [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \n  at Expansions.Missions.Runtime.MissionSystem.FixedUpdate () [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003C/pre\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/div\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"Dagger","CreatedById":147766,"CreatedDateTime":"2018-04-23T08:23:45Z","Content":"\n\u003Cp\u003E\nI\u0027m not very experienced on MH mods but the Fire() method seems like a coroutine so instead of returning:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003Ereturn Enumerable.Empty\u003C/span\u003E\u003Cspan class=\u0022tag\u0022\u003E\u0026lt;int\u0026gt;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E().GetEnumerator();\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nI would just do:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003Ereturn 0 \u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nor other parameter that fills your needs.\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cbr\u003E\n\u002BInfo about coroutines on unity:\u00A0\u003Cbr\u003E\u003Ca href=\u0022http://www.unitygeek.com/coroutines-in-unity3d/\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://www.unitygeek.com/coroutines-in-unity3d/\u003C/a\u003E\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222018-04-23T08:24:17Z\u0022 title=\u002204/23/2018 08:24  AM\u0022 data-short=\u00226 yr\u0022\u003EApril 23, 2018\u003C/time\u003E by Dagger\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2018-04-23T09:20:59Z","Content":"\n\u003Cp\u003E\nIf it s a coroutine the proper way is \u0022yield return null;\u0022\n\u003C/p\u003E\n"},{"CreatedByName":"tomf","CreatedById":57809,"CreatedDateTime":"2018-04-23T18:07:25Z","Content":"\n\u003Cp\u003E\nYup, that got that exception. Still doesn\u0027t work though but there is one less exception in the logs. Now I get\n\u003C/p\u003E\n\u003Cp\u003E\nNullReferenceException\u003Cbr\u003E\n\u00A0 at (wrapper managed-to-native) UnityEngine.Transform:INTERNAL_get_position (UnityEngine.Vector3\u0026amp;)\u003Cbr\u003E\n\u00A0 at UnityEngine.Transform.get_position () [0x00000] in \u0026lt;filename unknown\u0026gt;:0\u003Cbr\u003E\n\u00A0 at FlightGlobals.getFoR (FoRModes mode, UnityEngine.Transform referenceTransform, .Orbit orbit, .CelestialBody body) [0x00000] in \u0026lt;filename unknown\u0026gt;:0\u003Cbr\u003E\n\u00A0 at FlightGlobals.GetFoR (FoRModes mode) [0x00000] in \u0026lt;filename unknown\u0026gt;:0\u003Cbr\u003E\n\u00A0 at FlightCamera\u002B\u0026lt;Startup\u0026gt;c__Iterator0.MoveNext () [0x00000] in \u0026lt;filename unknown\u0026gt;:0\u003Cbr\u003E\n\u00A0 at UnityEngine.SetupCoroutine.InvokeMoveNext (IEnumerator enumerator, IntPtr returnValueAddress) [0x00000] in \u0026lt;filename unknown\u0026gt;:0\u003Cbr\u003E\nUnityEngine.MonoBehaviour:StartCoroutine_Auto_Internal(IEnumerator)\u003Cbr\u003E\nUnityEngine.MonoBehaviour:StartCoroutine(IEnumerator)\u003Cbr\u003E\nFlightCamera:OnLevelLoaded(GameScenes)\u003Cbr\u003E\nFlightCamera:OnSceneLoaded(Scene, LoadSceneMode)\u003Cbr\u003E\nUnityEngine.SceneManagement.SceneManager:Internal_SceneLoaded(Scene, LoadSceneMode)\n\u003C/p\u003E\n"}]}