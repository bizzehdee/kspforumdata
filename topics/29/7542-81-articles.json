{"TopicId":7542,"ForumId":29,"TopicTitle":"The official unoffical \u0026quot;help a fellow plugin developer\u0026quot; thread","CreatedByName":"Cephei","CreatedById":2555,"CreatedDateTime":"2012-03-04T10:02:40Z","PageNum":81,"Articles":[{"CreatedByName":"TheMaul","CreatedById":157501,"CreatedDateTime":"2016-01-23T19:51:25Z","Content":"\n\u003Cp\u003E\nHey guys. I\u0027m starting mod development and I\u0027d like to know\u00A0if\u00A0there are very simple mods I can download to start looking into the code. I\u0027ve already downloaded some but they are too complex to start with (even Chatterer is already several k-lines of code). Thanks !\n\u003C/p\u003E\n"},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2016-01-23T21:43:19Z","Content":"\n\u003Cp\u003E\nAnything in particular you\u0027re trying to do? I have/know a couple of small ones (\u003Ca href=\u0022https://github.com/Crzyrndm/Analog-Control/blob/master/Analog%20Control/AnalogControl.cs\u0022 rel=\u0022external nofollow\u0022\u003EKSPAddon\u003C/a\u003E, \u003Ca href=\u0022https://github.com/Crzyrndm/Thermal-Monitor/blob/master/Thermal%20Monitor/Thermal%20Monitor/Thermal%20Monitor.cs\u0022 rel=\u0022external nofollow\u0022\u003EPart Module\u003C/a\u003E), but they won\u0027t be of much use if you\u0027re doing something entirely different\n\u003C/p\u003E\n"},{"CreatedByName":"TheMaul","CreatedById":157501,"CreatedDateTime":"2016-01-24T00:14:09Z","Content":"\n\u003Cp\u003E\nI plan to make a sort of gravity viewing tool, so a\u00A0simple GUI and drawing lines on the map view\n\u003C/p\u003E\n"},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2016-01-24T08:17:43Z","Content":"\n\u003Cpre class=\u0022ipsCode prettyprint\u0022\u003E\n[KSPAddon(KSPAddon.Startup.Flight, false)]\npublic class DrawGravity : MonoBehaviour\n{\n  \tpublic bool inMapView;\n\tpublic void Start()\n\t{\n      \tGameEvents.OnMapEntered.Add(enteredMapView);\n      \tGameEvents.OnMapExited.Add(exitedMapView);\n\t}\n  \n\tpublic void enteredMapView()\n\t{\n\t  \tinMapView = true;\n\t}\n  \n\tpublic void exitedMapView()\n\t{\n      \tinMapView = false;\n\t}\n  \t\n\tpublic void OnDestroy()\n\t{\n      \tGameEvents.OnMapEntered.Remove(enteredMapView);\n      \tGameEvents.OnMapExited.Remove(exitedMapView);\n\t}\n  \n\tpublic void OnGUI()\n\t{\n      \tif (!inMapView)\n        \treturn;\n     \t// stuff for drawing UI elements\n      \t// look up Unity\u0027s GUI or GUILayout classes\n\t}\n}\u003C/pre\u003E\n\u003Cp\u003E\nShould be a fairly good starting point\n\u003C/p\u003E\n"},{"CreatedByName":"TheMaul","CreatedById":157501,"CreatedDateTime":"2016-01-24T12:49:38Z","Content":"\n\u003Cp\u003E\n\u003Cspan style=\u0022color:rgb(39,42,52);font-family:\u0027Helvetica Neue\u0027, Helvetica, Arial, sans-serif;font-size:14px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:22.4px;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;float:none;background-color:rgb(255,255,255);\u0022\u003EShould be a fairly good\u003C/span\u003E answer, thanks. I\u0027ll try that.\n\u003C/p\u003E\n"},{"CreatedByName":"Warzouz","CreatedById":140055,"CreatedDateTime":"2016-01-30T08:30:50Z","Content":"\n\u003Cp\u003E\nHi, I\u0027ve a very newbee question\n\u003C/p\u003E\n\u003Cp\u003E\nI want to look at plugins devs, I used a lot VB.Net few years ago. I just went through a C# tutorial to freshen up my syntax. I\u0027m installing VS 2015 (cummunity version).\n\u003C/p\u003E\n\u003Cp\u003E\nMy question is : As I want to create some \u0022window\u0022 oriented plugin and not \u0022part\u0022 oriented plugins, what version of Unity do I need to install ?\n\u003C/p\u003E\n\u003Cp\u003E\nThx\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2016-01-30T09:59:51Z","Content":"\n\u003Cp\u003E\nNone. Window oriented plugin you\u0027re looking at something very similar to what I posted 2 above your post. KSPAddon attribute on a monobehaviour, window drawn in OnGUI, lookup Unity GUI or GUILayout classes for documentation\n\u003C/p\u003E\n\u003Cp\u003E\nNOTE: Unity\u0027s new GUI system isn\u0027t particularly plugin friendly, so you\u0027ll probably want the editor to play with that. However I\u0027m under the impression that requires loading asset bundles which I don\u0027t believe are currently \u003Cstrong\u003Edirectly\u003C/strong\u003E loadable by KSP\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-01-30T10:02:53Z\u0022 title=\u002201/30/2016 10:02  AM\u0022 data-short=\u00228 yr\u0022\u003EJanuary 30, 2016\u003C/time\u003E by Crzyrndm\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2016-01-30T11:34:10Z","Content":"\n\u003Cp\u003E\nYou can load them, but you need Unity Pro to make them for Unity 4.x\n\u003C/p\u003E\n"},{"CreatedByName":"Warzouz","CreatedById":140055,"CreatedDateTime":"2016-01-30T12:02:02Z","Content":"\n\u003Cp\u003E\nThx.\n\u003C/p\u003E\n\u003Cp\u003E\nWhere can I find a basic template source for a plugins project ?\n\u003C/p\u003E\n"},{"CreatedByName":"TheMaul","CreatedById":157501,"CreatedDateTime":"2016-01-31T15:05:07Z","Content":"\n\u003Cp\u003E\nHi, is there a\u00A0way to debug plugins without restarting\u00A0the game every time ?\n\u003C/p\u003E\n"},{"CreatedByName":"JPLRepo","CreatedById":114736,"CreatedDateTime":"2016-01-31T18:56:24Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222387514\u0022 data-ipsquote-contentid=\u00227542\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221454252707\u0022 data-ipsquote-userid=\u0022157501\u0022 data-ipsquote-username=\u0022TheMaul\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n3 hours ago, TheMaul said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nHi, is there a\u00A0way to debug plugins without restarting\u00A0the game every time ?\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nUntil 1.1 comes out which is supposed to support dynamic dll loading you could \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/121435-wipplugintoolnov16-assemblyreloader-tool-for-plugin-authors\u0022\u003Etry this\u003C/a\u003E. But it has it\u0027s limitations.\n\u003C/p\u003E\n\u003Cp\u003E\nOtherwise, restarting is the only way to do it.\n\u003C/p\u003E\n"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2016-01-31T19:16:11Z","Content":"\n\u003Cp\u003E\nOr you could do real debugging :\u00A0\u003Ca href=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/102909-ksp-plugin-debugging-for-visual-studio-and-monodevelop-on-all-os/\u0022\u003Ehttp://forum.kerbalspaceprogram.com/index.php?/topic/102909-ksp-plugin-debugging-for-visual-studio-and-monodevelop-on-all-os/\u003C/a\u003E\n\u003C/p\u003E\n"},{"CreatedByName":"hab136","CreatedById":75997,"CreatedDateTime":"2016-01-31T21:55:38Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222386163\u0022 data-ipsquote-contentid=\u00227542\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221454155322\u0022 data-ipsquote-userid=\u0022140055\u0022 data-ipsquote-username=\u0022Warzouz\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nOn 1/30/2016 at 2:02 PM, Warzouz said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022 style=\u0022background-repeat:no-repeat;\u0022\u003E\n\u003Cp\u003E\nThx.\n\u003C/p\u003E\n\u003Cp\u003E\nWhere can I find a basic template source for a plugins project ?\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nCheck out\u00A0\u002201-SimplePartlessPlugin\u0022\u00A0in\u00A0\u003Ca href=\u0022https://github.com/taraniselsu/TacExamples\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/taraniselsu/TacExamples\u003C/a\u003E\n\u003C/p\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2016-01-31T23:27:22Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222387815\u0022 data-ipsquote-contentid=\u00227542\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221454267771\u0022 data-ipsquote-userid=\u002257146\u0022 data-ipsquote-username=\u0022sarbian\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n4 hours ago, sarbian said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nOr you could do real debugging :\u00A0\u003Ca href=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/102909-ksp-plugin-debugging-for-visual-studio-and-monodevelop-on-all-os/\u0022\u003Ehttp://forum.kerbalspaceprogram.com/index.php?/topic/102909-ksp-plugin-debugging-for-visual-studio-and-monodevelop-on-all-os/\u003C/a\u003E\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nAssemblyReloader supports this btw in case it wasn\u0027t clear, so you can reload \u003Cem\u003Eand\u003C/em\u003E debug your iterations. Most of its limitations are because I haven\u0027t needed that functionality and nobody\u0027s asked for it\n\u003C/p\u003E\n"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2016-02-01T09:34:34Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222388132\u0022 data-ipsquote-contentid=\u00227542\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221454282842\u0022 data-ipsquote-userid=\u002275857\u0022 data-ipsquote-username=\u0022xEvilReeperx\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n10 hours ago, xEvilReeperx said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nAssemblyReloader supports this btw in case it wasn\u0027t clear, so you can reload \u003Cem\u003Eand\u003C/em\u003E debug your iterations. Most of its limitations are because I haven\u0027t needed that functionality and nobody\u0027s asked for it\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nOh, I ll have to look into it more then \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022true\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"JPLRepo","CreatedById":114736,"CreatedDateTime":"2016-02-01T10:23:13Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222388132\u0022 data-ipsquote-contentid=\u00227542\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221454282842\u0022 data-ipsquote-userid=\u002275857\u0022 data-ipsquote-username=\u0022xEvilReeperx\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n10 hours ago, xEvilReeperx said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nAssemblyReloader supports this btw in case it wasn\u0027t clear, so you can reload \u003Cem\u003Eand\u003C/em\u003E debug your iterations. Most of its limitations are because I haven\u0027t needed that functionality and nobody\u0027s asked for it\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nSorry dude, I just meant it doesn\u0027t cover everything. My mods all have parts, contracts or internal models, so it\u0027s\u00A0not much use to me personally.\n\u003C/p\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2016-02-01T10:30:26Z","Content":"\n\u003Cp\u003E\nI was referring to the debugging support \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022true\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E Contracts are a problem (because unimplemented) but most people don\u0027t use a custom Part-derived type in their plugins and custom Internal\u003Cu\u003EModules\u003C/u\u003E are pretty rare in my experience as well...\n\u003C/p\u003E\n"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2016-02-01T10:36:07Z","Content":"\n\u003Cp\u003E\nCustom \u003Cspan style=\u0022color:rgb(39,42,52);font-family:\u0027Helvetica Neue\u0027, Helvetica, Arial, sans-serif;font-size:14px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:22.4px;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;float:none;background-color:rgb(255,255,255);\u0022\u003EPart-derived type are the kind of things I clearly don\u0027t want to see in any mod...\u003C/span\u003E\n\u003C/p\u003E\n"},{"CreatedByName":"ve2dmn","CreatedById":147103,"CreatedDateTime":"2016-02-14T14:31:07Z","Content":"\n\u003Cp\u003E\nI wrote my own code to detect which asteroid are heading for kerbin and when. That bit is working great and It auto-add the SOI change to KAC. The part that is not working is making custom contracts based on that information.\n\u003C/p\u003E\n\u003Cp\u003E\nBecause the orbits are only available during the\u00A0FLIGHT and\u00A0TRACKSTATION GameScenes, I have my code try to generate a custom contract and add it to the current ones. Problem is, it doesn\u0027t seems to do anything. The contracts doesn\u0027t show up, even in the debug menu. Here is the code:\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan\u003Eprivate void AddContract(String vID)\n\t\t{\n\t\t\t//Add Contract if possible\n\n\n\t\t\tDebug.Log (\u0022Try to find Contract for \u0022 \u002B vID);\n\n\t\t\tDebug.Log (\u0022number of Contracts to check : \u0022 \u002B ContractSystem.Instance.Contracts.Count ());\n\t\t\tDebug.Log (\u0022Status of Contract system: \u0022 \u002B (ContractSystem.Instance == null));\n\t\t\tDebug.Log (\u0022ContractSystem.Instance.enabled: \u0022 \u002B ContractSystem.Instance.enabled);\n\n\t\t\tDebug.Log (\u0022Generating new Contract \u0022);\n\t\t\tAsteroidRedirectContract GeneratedContractType = new AsteroidRedirectContract ();\n\t\t\tContract GeneratedContract = null;\n\t\t\tDebug.Log (\u0022Generating Contract of Type:\u0022 \u002B GeneratedContractType.GetType ());\n\n\t\t\tGeneratedContract = ContractSystem.Instance.GenerateContract (0, Contract.ContractPrestige.Trivial, GeneratedContractType.GetType ());\n\t\t\tif (GeneratedContract != null) {\n\t\t\t\tGeneratedContract.AddParameter (new AsteroidRedirectAltitudeParameters (vID));\n\t\t\t\tGeneratedContract.AddParameter (new AsteroidRedirectDockingParameters (vID));\n\t\t\t}\n\t\t\t\t\n\t\t\tif (!ContractSystem.Instance.Contracts.Contains(GeneratedContract)) \n\t\t\t{\n\t\t\t\t//Generate new Contract\n\t\t\t\n\t\t\t\tGeneratedContract.Accept ();\n\n\t\t\t\tContractSystem.Instance.Contracts.Add (GeneratedContract);\n\t\t\t\tDebug.Log (\u0022Generated Contract:\u0022 \u002B GeneratedContract.ToString ());\n\t\t\t}\n\n\t\t}\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nNow, I am obvious not a C# or Unity\u00A0developper, so I have no clue if I\u0027m doing something that is obviously wrong.... I\u0027ve tried to debug this for\u00A0hours trying various way and none seems to work,\u00A0which is why I am posting here...\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nContractSystem.Instance.Contracts.Count (), keeps going up with every contract that I Add(). So that seems to be working. Except, it doesn\u0027t do anything.\n\u003C/p\u003E\n\u003Cp\u003E\nAny Ideas?\n\u003C/p\u003E\n"},{"CreatedByName":"TheMightySpud","CreatedById":158070,"CreatedDateTime":"2016-02-15T20:40:53Z","Content":"\n\u003Cp\u003E\nHi all,\n\u003C/p\u003E\n\u003Cp\u003E\nI really really really really really really (yes, really :-P) Hope someone can see where I\u0027m going wrong on this......\n\u003C/p\u003E\n\u003Cp\u003E\nWhat I\u0027m trying to do is spawn a vessel (loaded from an existing Craft file) at startup,\u00A0using KSPAddon to trigger the spawning when you enter the space center from the main menu, when I\u0027ve got it working there will be a check to see if the vessel already exists, but for now I just want to get it to spawn.\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027ve got it triggering the code, but then something weird is happening and it\u0027s driving me nuts.\n\u003C/p\u003E\n\u003Cp\u003E\nAny time after a certain point that I try to do anything with the _newVessel I get an exception and it breaks.\n\u003C/p\u003E\n\u003Cp\u003E\nThe Exception (from the log) is\u00A0\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nQuote\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\n[EXC 20:13:37.146] NullReferenceException: Object reference not set to an instance of an object\u003Cbr\u003E\n\u00A0\u00A0 \u00A0Kerbal_Stargate.VesselSpawner.SpawnVessel (System.String vesselName, .ShipConstruct _shipConstruct, Vector3 _spawnOffset)\u003Cbr\u003E\n\u00A0\u00A0 \u00A0Kerbal_Stargate.VesselSpawner.SpawnVessel ()\u003Cbr\u003E\n\u00A0\u00A0 \u00A0Kerbal_Stargate.TMS_Module_001.Awake ()\u003Cbr\u003E\n\u00A0\u00A0 \u00A0UnityEngine.GameObject:AddComponent(Type)\u003Cbr\u003E\n\u00A0\u00A0 \u00A0AddonLoader:StartAddon(LoadedAssembly, Type, KSPAddon, Startup)\u003Cbr\u003E\n\u00A0\u00A0 \u00A0AddonLoader:StartAddons(Startup)\u003Cbr\u003E\n\u00A0\u00A0 \u00A0AddonLoader:OnLevelWasLoaded(Int32)\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nThe code (below) is a modified version of \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/107473-help-spawning-parts-beginning-from-specific-node/#comment-1951622\u0022\u003EKSPSmelter\u003C/a\u003E by \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022http://forum.kerbalspaceprogram.com/index.php?/profile/41667-taz00/\u0026amp;do=hovercard\u0022 data-mentionid=\u002241667\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/41667-taz00/\u0022\u003E@TAz00\u003C/a\u003E, which in turn is a modified bit of code from KAS.\n\u003C/p\u003E\n\u003Cp\u003E\nThe biggest problem has been converting the code to spawn at a specific point in the \u0027universe\u0027 from spawning based on the position of a Part, so I think I\u0027ve broken something somewhere. \u00A0The actual spawn location isn\u0027t important at the moment, I\u0027ll be translating save game position data to place the object once I have this part working properly.\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027ve been staring/fiddling/kicking this code for almost two days solid so I really do hope someone can help out. \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022true\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nCode for creating/spawning the vessel.\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan\u003Eusing System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Text;\nusing UnityEngine;\n\nnamespace TMS_Module_001\n{\n    /// \u003C/span\u003E\u003Cspan\u003E\u0026lt;summary\u0026gt;\u003C/span\u003E\u003Cspan\u003E\n    /// This class is pretty much built on what KAS uses to pull parts out of containers\n    /// All credit to https://github.com/KospY/KAS\n    /// https://github.com/KospY/KAS/blob/master/LICENSE.md\n    /// \u003C/span\u003E\u003Cspan\u003E\u0026lt;/summary\u0026gt;\u003C/span\u003E\u003Cspan\u003E\n    public class VesselSpawner\n    {\n        const string PluginPath = \u0022\\\\GameData\\\\TMSOrbitalMechanics\\\\PluginData\\\\\u0022;\n\n        private HideConfigNode _OldVabShip;\n        private string _craftFile = \u0022\u0022;\n        private string vesselName = \u0022\u0022;\n        private Vector3 vesselPosition = new Vector3(0.0f, 0.0f, 0.0f);\n        private CelestialBody bodyKerbin = null;\n\n        /// \u003C/span\u003E\u003Cspan\u003E\u0026lt;summary\u0026gt;\u003C/span\u003E\u003Cspan\u003E\n        /// \n        /// \u003C/span\u003E\u003Cspan\u003E\u0026lt;/summary\u0026gt;\u003C/span\u003E\u003Cspan\u003E\n        /// \u003C/span\u003E\u003Cspan\u003E\u0026lt;param\u003C/span\u003E\u003Cspan\u003E \u003C/span\u003E\u003Cspan\u003Ename\u003C/span\u003E\u003Cspan\u003E=\u003C/span\u003E\u003Cspan\u003E\u0022_craftFile\u0022\u003C/span\u003E\u003Cspan\u003E\u0026gt;\u003C/span\u003E\u003Cspan\u003ECraft file name as it appears in the PluginPath folder\u003C/span\u003E\u003Cspan\u003E\u0026lt;/param\u0026gt;\u003C/span\u003E\u003Cspan\u003E\n        /// \u003C/span\u003E\u003Cspan\u003E\u0026lt;param\u003C/span\u003E\u003Cspan\u003E \u003C/span\u003E\u003Cspan\u003Ename\u003C/span\u003E\u003Cspan\u003E=\u003C/span\u003E\u003Cspan\u003E\u0022_srcPart\u0022\u003C/span\u003E\u003Cspan\u003E\u0026gt;\u003C/span\u003E\u003Cspan\u003ESource part to spawn relative to\u003C/span\u003E\u003Cspan\u003E\u0026lt;/param\u0026gt;\u003C/span\u003E\u003Cspan\u003E\n        /// \u003C/span\u003E\u003Cspan\u003E\u0026lt;param\u003C/span\u003E\u003Cspan\u003E \u003C/span\u003E\u003Cspan\u003Ename\u003C/span\u003E\u003Cspan\u003E=\u003C/span\u003E\u003Cspan\u003E\u0022_spawnOffset\u0022\u003C/span\u003E\u003Cspan\u003E\u0026gt;\u003C/span\u003E\u003Cspan\u003EOffset spawn from Source part position\u003C/span\u003E\u003Cspan\u003E\u0026lt;/param\u0026gt;\u003C/span\u003E\u003Cspan\u003E\n        //public VesselSpawner(string _craftFile, Vector3 _spawnOffset)\n        public VesselSpawner(string _craftFile, string vesselName, Vector3 vesselPosition, CelestialBody bodyKerbin)\n        {\n            //Store paths\n            this._craftFile = _craftFile;\n            this.vesselPosition = vesselPosition;\n            this.vesselName = vesselName;\n            this.bodyKerbin = bodyKerbin;\n\n        }\n\n        /// \u003C/span\u003E\u003Cspan\u003E\u0026lt;summary\u0026gt;\u003C/span\u003E\u003Cspan\u003E\n        /// Spawns the vessel\n        /// \u003C/span\u003E\u003Cspan\u003E\u0026lt;/summary\u0026gt;\u003C/span\u003E\u003Cspan\u003E\n        public void SpawnVessel()\n        {\n            Debug.Log(\u0022SpawnVessel\u0022);\n            //Load craft file\n            ShipConstruct _ship = LoadVessel(this._craftFile);\n            if (_ship != null)\n            {\n                SpawnVessel(this.vesselName, _ship, this.vesselPosition);\n            }\n            else\n            {\n                Debug.Log(\u0022Failed to load the vessel\u0022);\n            }\n        }\n\n        /// \u003C/span\u003E\u003Cspan\u003E\u0026lt;summary\u0026gt;\u003C/span\u003E\u003Cspan\u003E\n        /// Attempt vessel load\n        /// \u003C/span\u003E\u003Cspan\u003E\u0026lt;/summary\u0026gt;\u003C/span\u003E\u003Cspan\u003E\n        /// \u003C/span\u003E\u003Cspan\u003E\u0026lt;param\u003C/span\u003E\u003Cspan\u003E \u003C/span\u003E\u003Cspan\u003Ename\u003C/span\u003E\u003Cspan\u003E=\u003C/span\u003E\u003Cspan\u003E\u0022_craftFile\u0022\u003C/span\u003E\u003Cspan\u003E\u0026gt;\u0026lt;/param\u0026gt;\u003C/span\u003E\u003Cspan\u003E\n        /// \u003C/span\u003E\u003Cspan\u003E\u0026lt;returns\u0026gt;\u0026lt;/returns\u0026gt;\u003C/span\u003E\u003Cspan\u003E\n        private ShipConstruct LoadVessel(string _craftFile)\n        {\n            Debug.Log(\u0022ConstructVessel\u0022);\n            //Get path to vessel\n            Debug.Log(\u0022Loading the craft file\u0022);\n            string BasePath = Environment.CurrentDirectory \u002B PluginPath;\n            string path = BasePath \u002B _craftFile;\n            Debug.Log(path);\n            //Save old ship for later, else player will see it in the VAB\n            _OldVabShip = new HideConfigNode(ShipConstruction.ShipConfig);\n\n            //Load craft file\n            ShipConstruct _shipConstruct = ShipConstruction.LoadShip(path);\n\n            //Check load\n            Debug.Log(\u0022Checking if its loaded\u0022);\n            if (_shipConstruct == null)\n            {\n                // Restore ShipConstruction ship, otherwise player sees loaded craft in VAB\n                ShipConstruction.ShipConfig = _OldVabShip.GetConfigNode();\n                return null; //Fail\n            }\n            Debug.Log(\u0022Sending it back\u0022);\n            return _shipConstruct;\n        }\n\n        /// \u003C/span\u003E\u003Cspan\u003E\u0026lt;summary\u0026gt;\u003C/span\u003E\u003Cspan\u003E\n        /// Spawn ship construct\n        /// https://github.com/KospY/KAS/blob/master/Plugin/KAS_Shared.cs\n        /// \u003C/span\u003E\u003Cspan\u003E\u0026lt;/summary\u0026gt;\u003C/span\u003E\u003Cspan\u003E\n        /// \u003C/span\u003E\u003Cspan\u003E\u0026lt;param\u003C/span\u003E\u003Cspan\u003E \u003C/span\u003E\u003Cspan\u003Ename\u003C/span\u003E\u003Cspan\u003E=\u003C/span\u003E\u003Cspan\u003E\u0022_shipConstruct\u0022\u003C/span\u003E\u003Cspan\u003E\u0026gt;\u003C/span\u003E\u003Cspan\u003EShipconstruct to spawn\u003C/span\u003E\u003Cspan\u003E\u0026lt;/param\u0026gt;\u003C/span\u003E\u003Cspan\u003E\n        /// \u003C/span\u003E\u003Cspan\u003E\u0026lt;param\u003C/span\u003E\u003Cspan\u003E \u003C/span\u003E\u003Cspan\u003Ename\u003C/span\u003E\u003Cspan\u003E=\u003C/span\u003E\u003Cspan\u003E\u0022_srcPart\u0022\u003C/span\u003E\u003Cspan\u003E\u0026gt;\u003C/span\u003E\u003Cspan\u003ESource part to spawn relative to\u003C/span\u003E\u003Cspan\u003E\u0026lt;/param\u0026gt;\u003C/span\u003E\u003Cspan\u003E\n        /// \u003C/span\u003E\u003Cspan\u003E\u0026lt;param\u003C/span\u003E\u003Cspan\u003E \u003C/span\u003E\u003Cspan\u003Ename\u003C/span\u003E\u003Cspan\u003E=\u003C/span\u003E\u003Cspan\u003E\u0022_spawnOffset\u0022\u003C/span\u003E\u003Cspan\u003E\u0026gt;\u003C/span\u003E\u003Cspan\u003EOffset spawn from Source part position\u003C/span\u003E\u003Cspan\u003E\u0026lt;/param\u0026gt;\u003C/span\u003E\u003Cspan\u003E\n        private void SpawnVessel(string vesselName, ShipConstruct _shipConstruct, Vector3 _spawnOffset)\n        {\n            Debug.Log(\u0022PrivateSpawnVessel\u0022);\n            //Store construct root\n            Part _newConstructRootPart = _shipConstruct.parts[0];\n\n            Debug.Log(\u0022Doing something with the Root\u0022);\n            //Center rootpart\n            Vector3 offset = _newConstructRootPart.transform.localPosition;\n            _newConstructRootPart.transform.Translate(-offset);\n\n            Debug.Log(\u0022Setting Root position or something\u0022);\n            //Get launch spawn point.\n            \n            GameObject launchPos = new GameObject();\n            launchPos.transform.position = vesselPosition;\n\n            //Store our launch / spawn position\n            Transform launchTransform = launchPos.transform;\n\n            //Kill original object\n            launchPos.DestroyGameObject();\n\n            //Set rootpart origin\n            _shipConstruct.Parts[0].localRoot.transform.Translate(launchPos.transform.position, Space.World);\n\n            //Position\n            float angle;\n            Vector3 axis;\n\n            //Extract ToAngleAxis data from selected spawning location\n            launchTransform.rotation.ToAngleAxis(out angle, out axis);\n\n            //TRANSFORM Rotate localRootPart in relation to root\n            _shipConstruct.Parts[0].localRoot.transform.RotateAround(launchTransform.position, axis, angle);\n\n            //Create vessel object\n            Debug.Log(\u0022CreateVesselObject\u0022);\n            Vessel _newVessel = _newConstructRootPart.localRoot.gameObject.AddComponent\u003C/span\u003E\u003Cspan\u003E\u0026lt;Vessel\u0026gt;\u003C/span\u003E\u003Cspan\u003E();\n\n            Debug.Log(\u0022Adding all the info to the ship\u0022);\n            //Attach vessel information\n            _newVessel.id = Guid.NewGuid();\n            _newVessel.name = vesselName;\n            //_newVessel.Landed = true;\n            _newVessel.Splashed = false;\n            _newVessel.landedAt = string.Empty;\n            _newVessel.situation = Vessel.Situations.LANDED;\n            _newVessel.vesselType = VesselType.Base;\n\n            //Init from VAB\n            _newVessel.Initialize(true);\n\n            //_newVessel.vesselName = _srcPart.vessel.vesselName \u002B \u0022 - \u0022 \u002B _shipConstruct.shipName;\n            //_newVessel.landedAt = _srcPart.vessel.vesselName;\n\n            //Store backup\n            ShipConstruction.CreateBackup(_shipConstruct);\n\n            Debug.Log(\u0022MissionIDStuff\u0022);\n            \n            //Set Orbit\n            InitiateOrbit(vesselPosition, _newVessel);\n\n            //Set Mission info\n            Debug.Log(\u0022Set Mission ID\u0022);\n            uint missionId = (uint)Guid.NewGuid().GetHashCode();\n            //string flagUrl = _srcPart.flagURL;\n            Debug.Log(\u0022Set Launch ID\u0022);\n            uint launchId = HighLogic.CurrentGame.launchID\u002B\u002B;\n\n            //Set part mission info\n            for (int i = 0; i \u0026lt; _newVessel.parts.Count; i\u002B\u002B) \n            {\n                Debug.Log(_newVessel.parts.Count);\n                Debug.Log(\u0022Loop through parts\u0022);\n                Part part = _newVessel.parts[i];\n                Debug.Log(part.name);\n                part.flightID = ShipConstruction.GetUniqueFlightID(FlightDriver.FlightStateCache.flightState);\n                Debug.Log(\u0022Done it Once\u0022);\n                part.launchID = launchId;\n                part.missionID = missionId;\n            }\n            Debug.Log(\u0022Finished Mission Stuff\u0022);\n            //Generate staging\n            //Staging.beginFlight();\n            //_newConstructRootPart.vessel.ResumeStaging();\n            //Staging.GenerateStagingSequence(_newConstructRootPart.localRoot);\n            //Staging.RecalculateVesselStaging(_newConstructRootPart.vessel);\n\n            //Set position, again\n            _newVessel.SetPosition(launchTransform.position);\n            _newVessel.SetRotation(launchTransform.rotation);\n\n            //Get all the parts, does it even matter since we launch from VAB?\n            for (int i = 0; i \u0026lt; _newVessel.parts.Count; i\u002B\u002B)\n            {\n                // Solar panels from containers (we dont have no bloody containers here tho) don\u0027t work otherwise\n                for (int j = 0; j \u0026lt; _newVessel.parts[i].Modules.Count; j\u002B\u002B)\n                {\n                    ConfigNode node = new ConfigNode();\n                    node.AddValue(\u0022name\u0022, _newVessel.parts[i].Modules[j].moduleName);\n                    _newVessel.parts[i].LoadModule(node, ref j);\n                }\n            }\n\n            Debug.Log(\u0022ProtoVesselStuff\u0022);\n            //Save Protovessel\n            ProtoVessel _newProto = new ProtoVessel(_newVessel);\n\n            Debug.Log(\u0022Defined ProtoVessel\u0022);\n\n            if (_newProto == null)\n            {\n                Debug.Log(\u0022Nope\u0022);\n            }\n                \n            else\n            {\n                Debug.Log(\u0022If Statement if not failed\u0022);\n\n                //Kill and remove spawned vessel, had some serious problems with spawn position warping/glitching\n                //\n                Debug.Log(\u0022_newVessel Die\u0022);\n                _newVessel.Die();\n                Debug.Log(\u0022New Vessel Dead\u0022);\n\n\n                Debug.Log(launchPos.transform.position);\n                //Set the protovessels position to the relative one we found, maybe redundant\n                Debug.Log(\u0022Move ProtoVessel\u0022);\n                _newProto.position = launchPos.transform.position;\n                \n\n                //If you check this value, you will see the height change from launch scene to resume scene, extra dafuq\n                \n                float height = _newProto.height;\n\n                if (FlightDriver.StartupBehaviour == FlightDriver.StartupBehaviours.RESUME_SAVED_FILE ||\n                    FlightDriver.StartupBehaviour == FlightDriver.StartupBehaviours.RESUME_SAVED_CACHE)\n                {\n                    //Odd behaviour with positioning during different flight scenes, workaround awaaaay\n                    //_newProto.height = TrueAlt(launchTransform.position, _newProto.height);\n                //}\n\n                //Load Protovessel\n                Debug.Log(\u0022ProtoVessel Load\u0022);\n                _newProto.Load(HighLogic.CurrentGame.flightState);\n\n                // Restore ShipConstruction ship, otherwise player sees loaded craft in VAB\n                ShipConstruction.ShipConfig = _OldVabShip.GetConfigNode();\n                }\n            }\n        }\n\n        /// \u003C/span\u003E\u003Cspan\u003E\u0026lt;summary\u0026gt;\u003C/span\u003E\u003Cspan\u003E\n        /// http://forum.kerbalspaceprogram.com/threads/111116-KSP-Altitude-Calculation-Inquiry\n        /// \u003C/span\u003E\u003Cspan\u003E\u0026lt;/summary\u0026gt;\u003C/span\u003E\u003Cspan\u003E\n        /// \u003C/span\u003E\u003Cspan\u003E\u0026lt;returns\u0026gt;\u0026lt;/returns\u0026gt;\u003C/span\u003E\u003Cspan\u003E\n        //private float TrueAlt(Vector3 _LauncPos, Vessel _srcVessel)\n        //{\n        //    Debug.Log(\u0022Altitude Stuff?\u0022);\n        //    //Vector3 pos = _srcPart.transform.position; //or this.vessel.GetWorldPos3D()\n        //   float ASL = FlightGlobals.getAltitudeAtPos(_LauncPos);\n        //    if (_srcVessel.mainBody.pqsController == null) { return ASL; }\n        //    float terrainAlt = Convert.ToSingle(_srcVessel.pqsAltitude);\n        //    if (_srcVessel.mainBody.ocean \u0026amp;\u0026amp; _srcVessel.heightFromTerrain \u0026lt;= 0) { return ASL; } //Checks for oceans\n        //    return ASL - terrainAlt;\n        //}\n\n        /// \u003C/span\u003E\u003Cspan\u003E\u0026lt;summary\u0026gt;\u003C/span\u003E\u003Cspan\u003E\n        /// https://github.com/taniwha-qf/Extraplanetary-Launchpads/blob/master/Source/BuildControl.cs\n        /// https://github.com/taniwha-qf/Extraplanetary-Launchpads/blob/master/License.txt\n        /// \u003C/span\u003E\u003Cspan\u003E\u0026lt;/summary\u0026gt;\u003C/span\u003E\u003Cspan\u003E\n        /// \u003C/span\u003E\u003Cspan\u003E\u0026lt;param\u003C/span\u003E\u003Cspan\u003E \u003C/span\u003E\u003Cspan\u003Ename\u003C/span\u003E\u003Cspan\u003E=\u003C/span\u003E\u003Cspan\u003E\u0022_newVessel\u0022\u003C/span\u003E\u003Cspan\u003E\u0026gt;\u0026lt;/param\u0026gt;\u003C/span\u003E\u003Cspan\u003E\n        /// \u003C/span\u003E\u003Cspan\u003E\u0026lt;param\u003C/span\u003E\u003Cspan\u003E \u003C/span\u003E\u003Cspan\u003Ename\u003C/span\u003E\u003Cspan\u003E=\u003C/span\u003E\u003Cspan\u003E\u0022_srcVessel\u0022\u003C/span\u003E\u003Cspan\u003E\u0026gt;\u0026lt;/param\u0026gt;\u003C/span\u003E\u003Cspan\u003E\n        private void InitiateOrbit(Vector3 vesselPosition, Vessel _newVessel)\n        {\n           Debug.Log(\u0022More OrbitStuff\u0022);\n           var mode = OrbitDriver.UpdateMode.UPDATE;\n           _newVessel.orbitDriver.SetOrbitMode(mode);\n        \n           var craftCoM = GetVesselWorldCoM(_newVessel);\n           //var vesselCoM = _newVessel.findWorldCenterOfMass;\n\n           var uTime = Planetarium.GetUniversalTime();\n\n           var vesselCoM = vesselPosition;\n           var offset = (Vector3d.zero \u002B craftCoM - vesselCoM).xzy;\n\n           _newVessel.orbit.Init();\n           _newVessel.orbit.StartUT = uTime;\n           _newVessel.orbit.referenceBody = bodyKerbin;\n           //_newVessel.orbit.pos = vesselPosition;\n           //_newVessel.orbit.vel = new Vector3d(0, 0, 0);\n           //_newVessel.angularMomentum = Vector3.zero;\n           //_newVessel.angularVelocity = Vector3.zero;\n           _newVessel.latitude = -1.0f;\n           _newVessel.longitude = 1.0f;\n           _newVessel.heightFromTerrain = 0.0f;\n           //_newVessel.SetRotation(0,0);\n           //_newVessel.altitude = 70.8178020151099;\n\n           var corb = _newVessel.orbit;\n\n           corb.UpdateFromStateVectors(corb.pos \u002B offset, _newVessel.orbit.vel, bodyKerbin, uTime);\n\n           Debug.Log(String.Format(\u0022[EL] {0} {1}\u0022, \u0022This is Orbit Info\u0022, corb.pos));\n\n        }\n\n        public Vector3 GetVesselWorldCoM(Vessel v)\n        {\n           var com = v.findLocalCenterOfMass();\n            return v.rootPart.partTransform.TransformPoint(com);\n        }\n    }\n}\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nThe trouble starts when I hit the line.....\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan\u003Epart.flightID = ShipConstruction.GetUniqueFlightID(FlightDriver.FlightStateCache.flightState);\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nJust as an excersize I commented out that line, and then it threw the exception at\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan\u003EDebug.Log(\u0022_newVessel Die\u0022);\n      _newVessel.Die();\nDebug.Log(\u0022New Vessel Dead\u0022);\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nleading me to think that it\u0027s something to do with the way I\u0027ve created/modified the vessel. :-/\n\u003C/p\u003E\n\u003Cp\u003E\nCode for calling the spawn......\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan\u003Eusing System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Text;\nusing UnityEngine;\n\nnamespace TMS_Module_001\n{\n    [KSPAddon(KSPAddon.Startup.SpaceCentre, true)]\n\n    public class TMS_Stargate : MonoBehaviour\n    {\n        public CelestialBody bodyMun;\n        public CelestialBody bodyKerbin;\n\n        public void Awake()\n        {\n\n            string vesselName = \u0022Module 001\u0022;\n            \n            //string celestialBody = \u0022Kerbin\u0022;\n            //CelestialBody celestialBody = new CelestialBody();\n\n            foreach (CelestialBody targetBody in FlightGlobals.Bodies)\n            {           \n                if (targetBody.name == \u0022Kerbin\u0022)\n                bodyKerbin = targetBody;\n            }\n\n            //string targetBody = celestialBody.name;\n            Vector3 vesselPosition = new Vector3(5f, 0f, 5f);\n\n            VesselSpawner TMS_Module_001 = new VesselSpawner(\u0022TMS_Module_001.craft\u0022, vesselName, vesselPosition, bodyKerbin);\n\n            Debug.Log(\u0022Spawn the Ship\u0022);\n            TMS_Module_001.SpawnVessel();\n            Debug.Log(\u0022Ship has Spawned\u0022);\n        }\n\n    }\n}\n\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nSo again, I really hope someone can shed some light on this, even if it\u0027s a case of pointing me in the right direction of what to look at \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022true\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nThanks\n\u003C/p\u003E\n\u003Cp\u003E\nTheMightySpud\n\u003C/p\u003E\n"},{"CreatedByName":"ShadyAct","CreatedById":72459,"CreatedDateTime":"2016-02-16T02:18:57Z","Content":"\n\u003Cp\u003E\nWill a 32-bit plugin run any differently on 64-bit KSP if it\u0027s compiled with x64 assemblies? (UnityEngine, etc.)\n\u003C/p\u003E\n"},{"CreatedByName":"hab136","CreatedById":75997,"CreatedDateTime":"2016-02-16T08:19:33Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222411457\u0022 data-ipsquote-contentid=\u00227542\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221455568853\u0022 data-ipsquote-userid=\u0022158070\u0022 data-ipsquote-username=\u0022TheMightySpud\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n11 hours ago, TheMightySpud said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022 style=\u0022background-position:1147px 0px;background-repeat:no-repeat;\u0022\u003E\n\u003Cp\u003E\nHi all,\n\u003C/p\u003E\n\u003Cp\u003E\nI really really really really really really (yes, really :-P) Hope someone can see where I\u0027m going wrong on this......\n\u003C/p\u003E\n\u003Cp\u003E\nWhat I\u0027m trying to do is spawn a vessel (loaded from an existing Craft file) at startup,\u00A0using KSPAddon to trigger the spawning when you enter the space center from the main menu, when I\u0027ve got it working there will be a check to see if the vessel already exists, but for now I just want to get it to spawn.\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027ve got it triggering the code, but then something weird is happening and it\u0027s driving me nuts.\n\u003C/p\u003E\n\u003Cp\u003E\nAny time after a certain point that I try to do anything with the _newVessel I get an exception and it breaks.\n\u003C/p\u003E\n\u003Cp\u003E\nThe Exception (from the log) is\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nThe code (below) is a modified version of \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/107473-help-spawning-parts-beginning-from-specific-node/#comment-1951622\u0022\u003EKSPSmelter\u003C/a\u003E by \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022http://forum.kerbalspaceprogram.com/index.php?/profile/41667-taz00/\u0026amp;do=hovercard\u0022 data-mentionid=\u002241667\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/41667-taz00/\u0022\u003E@TAz00\u003C/a\u003E, which in turn is a modified bit of code from KAS.\n\u003C/p\u003E\n\u003Cp\u003E\nThe biggest problem has been converting the code to spawn at a specific point in the \u0027universe\u0027 from spawning based on the position of a Part, so I think I\u0027ve broken something somewhere. \u00A0The actual spawn location isn\u0027t important at the moment, I\u0027ll be translating save game position data to place the object once I have this part working properly.\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027ve been staring/fiddling/kicking this code for almost two days solid so I really do hope someone can help out. \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022true\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nCode for creating/spawning the vessel.\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\n\u003Cspan\u003Eusing System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Text;\nusing UnityEngine;\n\nnamespace TMS_Module_001\n{\n    /// \u003C/span\u003E\u003Cspan\u003E\u0026lt;summary\u0026gt;\u003C/span\u003E\u003Cspan\u003E\n    /// This class is pretty much built on what KAS uses to pull parts out of containers\n    /// All credit to https://github.com/KospY/KAS\n    /// https://github.com/KospY/KAS/blob/master/LICENSE.md\n    /// \u003C/span\u003E\u003Cspan\u003E\u0026lt;/summary\u0026gt;\u003C/span\u003E\u003Cspan\u003E\n    public class VesselSpawner\n    {\n        const string PluginPath = \u0022\\\\GameData\\\\TMSOrbitalMechanics\\\\PluginData\\\\\u0022;\n\n        private HideConfigNode _OldVabShip;\n        private string _craftFile = \u0022\u0022;\n        private string vesselName = \u0022\u0022;\n        private Vector3 vesselPosition = new Vector3(0.0f, 0.0f, 0.0f);\n        private CelestialBody bodyKerbin = null;\n\n        /// \u003C/span\u003E\u003Cspan\u003E\u0026lt;summary\u0026gt;\u003C/span\u003E\u003Cspan\u003E\n        /// \n        /// \u003C/span\u003E\u003Cspan\u003E\u0026lt;/summary\u0026gt;\u003C/span\u003E\u003Cspan\u003E\n        /// \u003C/span\u003E\u003Cspan\u003E\u0026lt;param\u003C/span\u003E\u003Cspan\u003E \u003C/span\u003E\u003Cspan\u003Ename\u003C/span\u003E\u003Cspan\u003E=\u003C/span\u003E\u003Cspan\u003E\u0022_craftFile\u0022\u003C/span\u003E\u003Cspan\u003E\u0026gt;\u003C/span\u003E\u003Cspan\u003ECraft file name as it appears in the PluginPath folder\u003C/span\u003E\u003Cspan\u003E\u0026lt;/param\u0026gt;\u003C/span\u003E\u003Cspan\u003E\n        /// \u003C/span\u003E\u003Cspan\u003E\u0026lt;param\u003C/span\u003E\u003Cspan\u003E \u003C/span\u003E\u003Cspan\u003Ename\u003C/span\u003E\u003Cspan\u003E=\u003C/span\u003E\u003Cspan\u003E\u0022_srcPart\u0022\u003C/span\u003E\u003Cspan\u003E\u0026gt;\u003C/span\u003E\u003Cspan\u003ESource part to spawn relative to\u003C/span\u003E\u003Cspan\u003E\u0026lt;/param\u0026gt;\u003C/span\u003E\u003Cspan\u003E\n        /// \u003C/span\u003E\u003Cspan\u003E\u0026lt;param\u003C/span\u003E\u003Cspan\u003E \u003C/span\u003E\u003Cspan\u003Ename\u003C/span\u003E\u003Cspan\u003E=\u003C/span\u003E\u003Cspan\u003E\u0022_spawnOffset\u0022\u003C/span\u003E\u003Cspan\u003E\u0026gt;\u003C/span\u003E\u003Cspan\u003EOffset spawn from Source part position\u003C/span\u003E\u003Cspan\u003E\u0026lt;/param\u0026gt;\u003C/span\u003E\u003Cspan\u003E\n        //public VesselSpawner(string _craftFile, Vector3 _spawnOffset)\n        public VesselSpawner(string _craftFile, string vesselName, Vector3 vesselPosition, CelestialBody bodyKerbin)\n        {\n            //Store paths\n            this._craftFile = _craftFile;\n            this.vesselPosition = vesselPosition;\n            this.vesselName = vesselName;\n            this.bodyKerbin = bodyKerbin;\n\n        }\n\n        /// \u003C/span\u003E\u003Cspan\u003E\u0026lt;summary\u0026gt;\u003C/span\u003E\u003Cspan\u003E\n        /// Spawns the vessel\n        /// \u003C/span\u003E\u003Cspan\u003E\u0026lt;/summary\u0026gt;\u003C/span\u003E\u003Cspan\u003E\n        public void SpawnVessel()\n        {\n            Debug.Log(\u0022SpawnVessel\u0022);\n            //Load craft file\n            ShipConstruct _ship = LoadVessel(this._craftFile);\n            if (_ship != null)\n            {\n                SpawnVessel(this.vesselName, _ship, this.vesselPosition);\n            }\n            else\n            {\n                Debug.Log(\u0022Failed to load the vessel\u0022);\n            }\n        }\n\n        /// \u003C/span\u003E\u003Cspan\u003E\u0026lt;summary\u0026gt;\u003C/span\u003E\u003Cspan\u003E\n        /// Attempt vessel load\n        /// \u003C/span\u003E\u003Cspan\u003E\u0026lt;/summary\u0026gt;\u003C/span\u003E\u003Cspan\u003E\n        /// \u003C/span\u003E\u003Cspan\u003E\u0026lt;param\u003C/span\u003E\u003Cspan\u003E \u003C/span\u003E\u003Cspan\u003Ename\u003C/span\u003E\u003Cspan\u003E=\u003C/span\u003E\u003Cspan\u003E\u0022_craftFile\u0022\u003C/span\u003E\u003Cspan\u003E\u0026gt;\u0026lt;/param\u0026gt;\u003C/span\u003E\u003Cspan\u003E\n        /// \u003C/span\u003E\u003Cspan\u003E\u0026lt;returns\u0026gt;\u0026lt;/returns\u0026gt;\u003C/span\u003E\u003Cspan\u003E\n        private ShipConstruct LoadVessel(string _craftFile)\n        {\n            Debug.Log(\u0022ConstructVessel\u0022);\n            //Get path to vessel\n            Debug.Log(\u0022Loading the craft file\u0022);\n            string BasePath = Environment.CurrentDirectory \u002B PluginPath;\n            string path = BasePath \u002B _craftFile;\n            Debug.Log(path);\n            //Save old ship for later, else player will see it in the VAB\n            _OldVabShip = new HideConfigNode(ShipConstruction.ShipConfig);\n\n            //Load craft file\n            ShipConstruct _shipConstruct = ShipConstruction.LoadShip(path);\n\n            //Check load\n            Debug.Log(\u0022Checking if its loaded\u0022);\n            if (_shipConstruct == null)\n            {\n                // Restore ShipConstruction ship, otherwise player sees loaded craft in VAB\n                ShipConstruction.ShipConfig = _OldVabShip.GetConfigNode();\n                return null; //Fail\n            }\n            Debug.Log(\u0022Sending it back\u0022);\n            return _shipConstruct;\n        }\n\n        /// \u003C/span\u003E\u003Cspan\u003E\u0026lt;summary\u0026gt;\u003C/span\u003E\u003Cspan\u003E\n        /// Spawn ship construct\n        /// https://github.com/KospY/KAS/blob/master/Plugin/KAS_Shared.cs\n        /// \u003C/span\u003E\u003Cspan\u003E\u0026lt;/summary\u0026gt;\u003C/span\u003E\u003Cspan\u003E\n        /// \u003C/span\u003E\u003Cspan\u003E\u0026lt;param\u003C/span\u003E\u003Cspan\u003E \u003C/span\u003E\u003Cspan\u003Ename\u003C/span\u003E\u003Cspan\u003E=\u003C/span\u003E\u003Cspan\u003E\u0022_shipConstruct\u0022\u003C/span\u003E\u003Cspan\u003E\u0026gt;\u003C/span\u003E\u003Cspan\u003EShipconstruct to spawn\u003C/span\u003E\u003Cspan\u003E\u0026lt;/param\u0026gt;\u003C/span\u003E\u003Cspan\u003E\n        /// \u003C/span\u003E\u003Cspan\u003E\u0026lt;param\u003C/span\u003E\u003Cspan\u003E \u003C/span\u003E\u003Cspan\u003Ename\u003C/span\u003E\u003Cspan\u003E=\u003C/span\u003E\u003Cspan\u003E\u0022_srcPart\u0022\u003C/span\u003E\u003Cspan\u003E\u0026gt;\u003C/span\u003E\u003Cspan\u003ESource part to spawn relative to\u003C/span\u003E\u003Cspan\u003E\u0026lt;/param\u0026gt;\u003C/span\u003E\u003Cspan\u003E\n        /// \u003C/span\u003E\u003Cspan\u003E\u0026lt;param\u003C/span\u003E\u003Cspan\u003E \u003C/span\u003E\u003Cspan\u003Ename\u003C/span\u003E\u003Cspan\u003E=\u003C/span\u003E\u003Cspan\u003E\u0022_spawnOffset\u0022\u003C/span\u003E\u003Cspan\u003E\u0026gt;\u003C/span\u003E\u003Cspan\u003EOffset spawn from Source part position\u003C/span\u003E\u003Cspan\u003E\u0026lt;/param\u0026gt;\u003C/span\u003E\u003Cspan\u003E\n        private void SpawnVessel(string vesselName, ShipConstruct _shipConstruct, Vector3 _spawnOffset)\n        {\n            Debug.Log(\u0022PrivateSpawnVessel\u0022);\n            //Store construct root\n            Part _newConstructRootPart = _shipConstruct.parts[0];\n\n            Debug.Log(\u0022Doing something with the Root\u0022);\n            //Center rootpart\n            Vector3 offset = _newConstructRootPart.transform.localPosition;\n            _newConstructRootPart.transform.Translate(-offset);\n\n            Debug.Log(\u0022Setting Root position or something\u0022);\n            //Get launch spawn point.\n            \n            GameObject launchPos = new GameObject();\n            launchPos.transform.position = vesselPosition;\n\n            //Store our launch / spawn position\n            Transform launchTransform = launchPos.transform;\n\n            //Kill original object\n            launchPos.DestroyGameObject();\n\n            //Set rootpart origin\n            _shipConstruct.Parts[0].localRoot.transform.Translate(launchPos.transform.position, Space.World);\n\n            //Position\n            float angle;\n            Vector3 axis;\n\n            //Extract ToAngleAxis data from selected spawning location\n            launchTransform.rotation.ToAngleAxis(out angle, out axis);\n\n            //TRANSFORM Rotate localRootPart in relation to root\n            _shipConstruct.Parts[0].localRoot.transform.RotateAround(launchTransform.position, axis, angle);\n\n            //Create vessel object\n            Debug.Log(\u0022CreateVesselObject\u0022);\n            Vessel _newVessel = _newConstructRootPart.localRoot.gameObject.AddComponent\u003C/span\u003E\u003Cspan\u003E\u0026lt;Vessel\u0026gt;\u003C/span\u003E\u003Cspan\u003E();\n\n            Debug.Log(\u0022Adding all the info to the ship\u0022);\n            //Attach vessel information\n            _newVessel.id = Guid.NewGuid();\n            _newVessel.name = vesselName;\n            //_newVessel.Landed = true;\n            _newVessel.Splashed = false;\n            _newVessel.landedAt = string.Empty;\n            _newVessel.situation = Vessel.Situations.LANDED;\n            _newVessel.vesselType = VesselType.Base;\n\n            //Init from VAB\n            _newVessel.Initialize(true);\n\n            //_newVessel.vesselName = _srcPart.vessel.vesselName \u002B \u0022 - \u0022 \u002B _shipConstruct.shipName;\n            //_newVessel.landedAt = _srcPart.vessel.vesselName;\n\n            //Store backup\n            ShipConstruction.CreateBackup(_shipConstruct);\n\n            Debug.Log(\u0022MissionIDStuff\u0022);\n            \n            //Set Orbit\n            InitiateOrbit(vesselPosition, _newVessel);\n\n            //Set Mission info\n            Debug.Log(\u0022Set Mission ID\u0022);\n            uint missionId = (uint)Guid.NewGuid().GetHashCode();\n            //string flagUrl = _srcPart.flagURL;\n            Debug.Log(\u0022Set Launch ID\u0022);\n            uint launchId = HighLogic.CurrentGame.launchID\u002B\u002B;\n\n            //Set part mission info\n            for (int i = 0; i \u0026lt; _newVessel.parts.Count; i\u002B\u002B) \n            {\n                Debug.Log(_newVessel.parts.Count);\n                Debug.Log(\u0022Loop through parts\u0022);\n                Part part = _newVessel.parts[i];\n                Debug.Log(part.name);\n                part.flightID = ShipConstruction.GetUniqueFlightID(FlightDriver.FlightStateCache.flightState);\n                Debug.Log(\u0022Done it Once\u0022);\n                part.launchID = launchId;\n                part.missionID = missionId;\n            }\n            Debug.Log(\u0022Finished Mission Stuff\u0022);\n            //Generate staging\n            //Staging.beginFlight();\n            //_newConstructRootPart.vessel.ResumeStaging();\n            //Staging.GenerateStagingSequence(_newConstructRootPart.localRoot);\n            //Staging.RecalculateVesselStaging(_newConstructRootPart.vessel);\n\n            //Set position, again\n            _newVessel.SetPosition(launchTransform.position);\n            _newVessel.SetRotation(launchTransform.rotation);\n\n            //Get all the parts, does it even matter since we launch from VAB?\n            for (int i = 0; i \u0026lt; _newVessel.parts.Count; i\u002B\u002B)\n            {\n                // Solar panels from containers (we dont have no bloody containers here tho) don\u0027t work otherwise\n                for (int j = 0; j \u0026lt; _newVessel.parts[i].Modules.Count; j\u002B\u002B)\n                {\n                    ConfigNode node = new ConfigNode();\n                    node.AddValue(\u0022name\u0022, _newVessel.parts[i].Modules[j].moduleName);\n                    _newVessel.parts[i].LoadModule(node, ref j);\n                }\n            }\n\n            Debug.Log(\u0022ProtoVesselStuff\u0022);\n            //Save Protovessel\n            ProtoVessel _newProto = new ProtoVessel(_newVessel);\n\n            Debug.Log(\u0022Defined ProtoVessel\u0022);\n\n            if (_newProto == null)\n            {\n                Debug.Log(\u0022Nope\u0022);\n            }\n                \n            else\n            {\n                Debug.Log(\u0022If Statement if not failed\u0022);\n\n                //Kill and remove spawned vessel, had some serious problems with spawn position warping/glitching\n                //\n                Debug.Log(\u0022_newVessel Die\u0022);\n                _newVessel.Die();\n                Debug.Log(\u0022New Vessel Dead\u0022);\n\n\n                Debug.Log(launchPos.transform.position);\n                //Set the protovessels position to the relative one we found, maybe redundant\n                Debug.Log(\u0022Move ProtoVessel\u0022);\n                _newProto.position = launchPos.transform.position;\n                \n\n                //If you check this value, you will see the height change from launch scene to resume scene, extra dafuq\n                \n                float height = _newProto.height;\n\n                if (FlightDriver.StartupBehaviour == FlightDriver.StartupBehaviours.RESUME_SAVED_FILE ||\n                    FlightDriver.StartupBehaviour == FlightDriver.StartupBehaviours.RESUME_SAVED_CACHE)\n                {\n                    //Odd behaviour with positioning during different flight scenes, workaround awaaaay\n                    //_newProto.height = TrueAlt(launchTransform.position, _newProto.height);\n                //}\n\n                //Load Protovessel\n                Debug.Log(\u0022ProtoVessel Load\u0022);\n                _newProto.Load(HighLogic.CurrentGame.flightState);\n\n                // Restore ShipConstruction ship, otherwise player sees loaded craft in VAB\n                ShipConstruction.ShipConfig = _OldVabShip.GetConfigNode();\n                }\n            }\n        }\n\n        /// \u003C/span\u003E\u003Cspan\u003E\u0026lt;summary\u0026gt;\u003C/span\u003E\u003Cspan\u003E\n        /// http://forum.kerbalspaceprogram.com/threads/111116-KSP-Altitude-Calculation-Inquiry\n        /// \u003C/span\u003E\u003Cspan\u003E\u0026lt;/summary\u0026gt;\u003C/span\u003E\u003Cspan\u003E\n        /// \u003C/span\u003E\u003Cspan\u003E\u0026lt;returns\u0026gt;\u0026lt;/returns\u0026gt;\u003C/span\u003E\u003Cspan\u003E\n        //private float TrueAlt(Vector3 _LauncPos, Vessel _srcVessel)\n        //{\n        //    Debug.Log(\u0022Altitude Stuff?\u0022);\n        //    //Vector3 pos = _srcPart.transform.position; //or this.vessel.GetWorldPos3D()\n        //   float ASL = FlightGlobals.getAltitudeAtPos(_LauncPos);\n        //    if (_srcVessel.mainBody.pqsController == null) { return ASL; }\n        //    float terrainAlt = Convert.ToSingle(_srcVessel.pqsAltitude);\n        //    if (_srcVessel.mainBody.ocean \u0026amp;\u0026amp; _srcVessel.heightFromTerrain \u0026lt;= 0) { return ASL; } //Checks for oceans\n        //    return ASL - terrainAlt;\n        //}\n\n        /// \u003C/span\u003E\u003Cspan\u003E\u0026lt;summary\u0026gt;\u003C/span\u003E\u003Cspan\u003E\n        /// https://github.com/taniwha-qf/Extraplanetary-Launchpads/blob/master/Source/BuildControl.cs\n        /// https://github.com/taniwha-qf/Extraplanetary-Launchpads/blob/master/License.txt\n        /// \u003C/span\u003E\u003Cspan\u003E\u0026lt;/summary\u0026gt;\u003C/span\u003E\u003Cspan\u003E\n        /// \u003C/span\u003E\u003Cspan\u003E\u0026lt;param\u003C/span\u003E\u003Cspan\u003E \u003C/span\u003E\u003Cspan\u003Ename\u003C/span\u003E\u003Cspan\u003E=\u003C/span\u003E\u003Cspan\u003E\u0022_newVessel\u0022\u003C/span\u003E\u003Cspan\u003E\u0026gt;\u0026lt;/param\u0026gt;\u003C/span\u003E\u003Cspan\u003E\n        /// \u003C/span\u003E\u003Cspan\u003E\u0026lt;param\u003C/span\u003E\u003Cspan\u003E \u003C/span\u003E\u003Cspan\u003Ename\u003C/span\u003E\u003Cspan\u003E=\u003C/span\u003E\u003Cspan\u003E\u0022_srcVessel\u0022\u003C/span\u003E\u003Cspan\u003E\u0026gt;\u0026lt;/param\u0026gt;\u003C/span\u003E\u003Cspan\u003E\n        private void InitiateOrbit(Vector3 vesselPosition, Vessel _newVessel)\n        {\n           Debug.Log(\u0022More OrbitStuff\u0022);\n           var mode = OrbitDriver.UpdateMode.UPDATE;\n           _newVessel.orbitDriver.SetOrbitMode(mode);\n        \n           var craftCoM = GetVesselWorldCoM(_newVessel);\n           //var vesselCoM = _newVessel.findWorldCenterOfMass;\n\n           var uTime = Planetarium.GetUniversalTime();\n\n           var vesselCoM = vesselPosition;\n           var offset = (Vector3d.zero \u002B craftCoM - vesselCoM).xzy;\n\n           _newVessel.orbit.Init();\n           _newVessel.orbit.StartUT = uTime;\n           _newVessel.orbit.referenceBody = bodyKerbin;\n           //_newVessel.orbit.pos = vesselPosition;\n           //_newVessel.orbit.vel = new Vector3d(0, 0, 0);\n           //_newVessel.angularMomentum = Vector3.zero;\n           //_newVessel.angularVelocity = Vector3.zero;\n           _newVessel.latitude = -1.0f;\n           _newVessel.longitude = 1.0f;\n           _newVessel.heightFromTerrain = 0.0f;\n           //_newVessel.SetRotation(0,0);\n           //_newVessel.altitude = 70.8178020151099;\n\n           var corb = _newVessel.orbit;\n\n           corb.UpdateFromStateVectors(corb.pos \u002B offset, _newVessel.orbit.vel, bodyKerbin, uTime);\n\n           Debug.Log(String.Format(\u0022[EL] {0} {1}\u0022, \u0022This is Orbit Info\u0022, corb.pos));\n\n        }\n\n        public Vector3 GetVesselWorldCoM(Vessel v)\n        {\n           var com = v.findLocalCenterOfMass();\n            return v.rootPart.partTransform.TransformPoint(com);\n        }\n    }\n}\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nThe trouble starts when I hit the line.....\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\n\u003Cspan\u003Epart.flightID = ShipConstruction.GetUniqueFlightID(FlightDriver.FlightStateCache.flightState);\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nJust as an excersize I commented out that line, and then it threw the exception at\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\n\u003Cspan\u003EDebug.Log(\u0022_newVessel Die\u0022);\n      _newVessel.Die();\nDebug.Log(\u0022New Vessel Dead\u0022);\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nleading me to think that it\u0027s something to do with the way I\u0027ve created/modified the vessel. :-/\n\u003C/p\u003E\n\u003Cp\u003E\nCode for calling the spawn......\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\n\u003Cspan\u003Eusing System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Text;\nusing UnityEngine;\n\nnamespace TMS_Module_001\n{\n    [KSPAddon(KSPAddon.Startup.SpaceCentre, true)]\n\n    public class TMS_Stargate : MonoBehaviour\n    {\n        public CelestialBody bodyMun;\n        public CelestialBody bodyKerbin;\n\n        public void Awake()\n        {\n\n            string vesselName = \u0022Module 001\u0022;\n            \n            //string celestialBody = \u0022Kerbin\u0022;\n            //CelestialBody celestialBody = new CelestialBody();\n\n            foreach (CelestialBody targetBody in FlightGlobals.Bodies)\n            {           \n                if (targetBody.name == \u0022Kerbin\u0022)\n                bodyKerbin = targetBody;\n            }\n\n            //string targetBody = celestialBody.name;\n            Vector3 vesselPosition = new Vector3(5f, 0f, 5f);\n\n            VesselSpawner TMS_Module_001 = new VesselSpawner(\u0022TMS_Module_001.craft\u0022, vesselName, vesselPosition, bodyKerbin);\n\n            Debug.Log(\u0022Spawn the Ship\u0022);\n            TMS_Module_001.SpawnVessel();\n            Debug.Log(\u0022Ship has Spawned\u0022);\n        }\n\n    }\n}\n\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nSo again, I really hope someone can shed some light on this, even if it\u0027s a case of pointing me in the right direction of what to look at \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022true\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nThanks\n\u003C/p\u003E\n\u003Cp\u003E\nTheMightySpud\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThe most obvious thing to check is that bodyKerbin in not null; it\u0027s not guaranteed to be set by your loop through FlightGlobal.Bodies. \u00A0You should check right after the loop if it is null.\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027m not sure if FlightGlobals will work in the main menu; it might work only in flight.\n\u003C/p\u003E\n\u003Cp\u003E\nFor debugging, a thing I often do is check if each variable I\u0027m about to pass is null (vesselName, vesselPosition, bodyKerbin) and print a message and return if it is, and print the value if it\u0027s not null (so I know I\u0027m passing the right values).\n\u003C/p\u003E\n\u003Cp\u003E\nThen disable the printing for the release version. \u00A0You can wrap the debugging in #if DEBUG / #endif so that it only is compiled for the debug version\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222412094\u0022 data-ipsquote-contentid=\u00227542\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221455589137\u0022 data-ipsquote-userid=\u002272459\u0022 data-ipsquote-username=\u0022ShadyAct\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n6 hours ago, ShadyAct said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022 style=\u0022background-image:none;background-position:0% 0%;background-repeat:repeat;\u0022\u003E\n\u003Cp\u003E\nWill a 32-bit plugin run any differently on 64-bit KSP if it\u0027s compiled with x64 assemblies? (UnityEngine, etc.)\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nMy gut\u00A0says it should work, but it\u0027s not a great idea.\n\u003C/p\u003E\n\u003Cp\u003E\nI keep a totally separate copy of KSP for development, with the sound off and all the graphics set to \u0022terrible but fast\u0022, and only the mods needed for testing (if any). \u00A0It makes loading a whole lot faster than trying to load my \u0022real\u0022 copy of the copy.\n\u003C/p\u003E\n\u003Cp\u003E\n(You don\u0027t need to buy the game again, just copy the directory)\n\u003C/p\u003E\n"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2016-02-16T09:48:01Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222412094\u0022 data-ipsquote-contentid=\u00227542\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221455589137\u0022 data-ipsquote-userid=\u002272459\u0022 data-ipsquote-username=\u0022ShadyAct\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n7 hours ago, ShadyAct said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nWill a 32-bit plugin run any differently on 64-bit KSP if it\u0027s compiled with x64 assemblies? (UnityEngine, etc.)\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nKSP plugin works fine on both unless they use native code (most don\u0027t) or where specifically build to use an architecture (which is not the default)\n\u003C/p\u003E\n"},{"CreatedByName":"ShadyAct","CreatedById":72459,"CreatedDateTime":"2016-02-17T00:56:27Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222412528\u0022 data-ipsquote-contentid=\u00227542\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221455616081\u0022 data-ipsquote-userid=\u002257146\u0022 data-ipsquote-username=\u0022sarbian\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n15 hours ago, sarbian said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nKSP plugin works fine on both unless they use native code (most don\u0027t) or where specifically build to use an architecture (which is not the default)\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nCould you give me an example of native code?\n\u003C/p\u003E\n"},{"CreatedByName":"jkortech","CreatedById":146934,"CreatedDateTime":"2016-02-17T19:38:46Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222413926\u0022 data-ipsquote-contentid=\u00227542\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221455670587\u0022 data-ipsquote-userid=\u002272459\u0022 data-ipsquote-username=\u0022ShadyAct\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n18 hours ago, ShadyAct said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nCould you give me an example of native code?\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nMost of Principia is written in native code (C\u002B\u002B) except for a little C# for integrating it into KSP. That\u0027s the only one I know. It happens rarely because it is more hassle than it\u0027s worth unless you need the speed improvements afforded by having some native code.\n\u003C/p\u003E\n"}]}