{"TopicId":140699,"ForumId":29,"TopicTitle":"Calling OnGUI() from non-attributed class (no KSPAddon tag)","CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2016-05-28T18:54:30Z","PageNum":1,"Articles":[{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2016-05-28T18:54:30Z","Content":"\n\u003Cp\u003E\nAlright, with KSP 1.1 disabling the RenderingManager access, I\u0027m trying to move my windows to OnGUI and running into an issue.\n\u003C/p\u003E\n\u003Cp\u003E\nHow do I hook OnGUI from any old class in my project? That means a class that\u0027s not tagged with KSPAddon or anything similar.\n\u003C/p\u003E\n\u003Cp\u003E\nOne thing the Unity documentation did tell me is that OnGUI only works in a class that inherits MonoBehavoir and that is enabled.\n\u003C/p\u003E\n\u003Cp\u003E\nSo, here\u0027s the code giving me issues:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003EourWin = new MainGUIWindow(EditorLogic.SortedShipList, winTop, winLeft);\nourWin.enabled = true; //new line added in KSP 1.1\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nIn KSP 1.0.5, the main MainGUIWindow class did not inherit anything and hooked into RenderingManager in it\u0027s constructor method, this worked great.\n\u003C/p\u003E\n\u003Cp\u003E\nIn KSP 1.1, I changed MainGUIWindow to inherit from MonoBehavior, changed my RenderingManager method to OnGUI() and added the second line in the code snippet above to enable the class so the OnGUI() method gets called.\n\u003C/p\u003E\n\u003Cp\u003E\nHowever, the ourWin.enabled line is now throwing a NullRef error and I am now stumped.\n\u003C/p\u003E\n\u003Cp\u003E\nSo, how do I convert the MainGUIWindow class to a MonoBehavior class so I can have it call OnGUI the same way a class tagged KSPAddOn does?\n\u003C/p\u003E\n\u003Cp\u003E\nD\n\u003C/p\u003E\n"},{"CreatedByName":"Thomas P.","CreatedById":113164,"CreatedDateTime":"2016-05-28T19:01:30Z","Content":"\n\u003Cp\u003E\nTagging a monobehaviour with KSPAddon does nothing else except creating a new GameObject (new GameObject(\u0022nice name\u0022)) and adding the flagged type to it, using gameObject.AddComponent\u0026lt;myType\u0026gt;(). Creating monobehaviours with the standard constructor doesn\u0027t work in Unity. \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u003Cbr\u003E\nTherefore you can\u0027t pass variables to it, like the constructor does it.\n\u003C/p\u003E\n\u003Cp\u003E\nIn your case, I would add an OnGUI method to your KSPAddon, and call the draw methods you previously registered in RenderingManager from there. That way you don\u0027t need to extend from MonoBehavoir and you have minimal code changes, as opposed to MonoBehaviour, where you have to respect the lifecycle (no constructor, everything in Awake() and so on).\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2016-05-28T19:11:43Z","Content":"\n\u003Cp\u003E\nThat does appear to be what is going on.\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027m making the new instance of the class as per the code in the first post but not attaching it to an object, so Unity is immediately sending it to garbage collection, so the class has already been destroyed by the next line causing the NullRef on the .enabled call I\u0027m trying to make.\n\u003C/p\u003E\n\u003Cp\u003E\nGoing to switch to the nested OnGUI calls as you suggest, that sounds like it will work.\n\u003C/p\u003E\n\u003Cp\u003E\nD.\n\u003C/p\u003E\n"},{"CreatedByName":"Ziw","CreatedById":135292,"CreatedDateTime":"2016-05-28T22:05:28Z","Content":"\n\u003Cp\u003E\nMonoBehaviours are not meant to be created using \u0022new\u0022 keyword.\n\u003C/p\u003E\n\u003Cp\u003E\nThey are meant to be instantiated via calling \u0022AddComponent\u0022 on a relevant GameObject, this is how Unity works\n\u003C/p\u003E\n"},{"CreatedByName":"DennyTX","CreatedById":92389,"CreatedDateTime":"2016-06-13T04:54:03Z","Content":"\n\u003Cp\u003E\n\u00A0\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nuff, if i understand needs right, here are some code example. i used this when i moved \u00A0 from 4.2.6 to 5.2.4. just a note.\n\u003C/p\u003E\n\u003Cdiv style=\u0022table-layout:fixed;width:1000px;line-height:1.6;color:rgb(39,42,52);font-size:14px;margin-bottom:20px;margin-top:0px;font-family:\u0027Helvetica Neue\u0027, Helvetica, Arial, sans-serif;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255);\u0022\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003E\u00A0 \u00A0 public class ClassName\n\u00A0 \u00A0 {\n\u00A0 \u00A0 \u00A0 \u00A0 protected OnGUIObject onGUIObject;\n\n\u00A0 \u00A0 \u00A0 \u00A0 public NiceName(blabla)\n\u00A0 \u00A0 \u00A0 \u00A0 {\n\u00A0 \u00A0 \u00A0 \u00A0 \u00A0 \u00A0 \u00A0*****\n\u00A0 \u00A0 \u00A0 \u00A0 \u00A0 \u00A0 \u00A0GameObject onGUIHolder = new GameObject();\n\u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0onGUIObject = onGUIHolder.AddComponent\u003C/span\u003E\u003Cspan class=\u0022tag\u0022\u003E\u0026lt;OnGUIObject\u0026gt;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E();\u00A0\n\u00A0 \u00A0 \u00A0 \u00A0 \u00A0 \u00A0 \u00A0onGUIHolder.transform.parent = part.transform;\n\u00A0 \u00A0 \u00A0 \u00A0 }\n               \n\u00A0 \u00A0 \u00A0 \u00A0 public virtual void Activate()\n\u00A0 \u00A0 \u00A0 \u00A0 {\n\u00A0 \u00A0\u00A0\u00A0 \u00A0 \u00A0 \u00A0 \u00A0 \u00A0 onGUIObject.updateGUIFunction \u002B= OnGUI;\n\u00A0 \u00A0 \u00A0 \u00A0 }\n\n\u00A0 \u00A0 \u00A0 \u00A0 public virtual void Deactivate()\n\u00A0 \u00A0 \u00A0 \u00A0 {\n\u00A0 \u00A0 \u00A0 \u00A0 \u00A0 \u00A0 onGUIObject.updateGUIFunction -= OnGUI;\n\u00A0 \u00A0 \u00A0 \u00A0 }\n        \n        void OnGUI()\n        {\n            *****\n        }       \n}\u003C/span\u003E\u003C/pre\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003E    public delegate void UpdateGUIFunction();\n\n    public class OnGUIObject : MonoBehaviour\n    {\n        public UpdateGUIFunction updateGUIFunction;\n\n        void OnGUI()\n        {\n            if (updateGUIFunction != null)\n            {\n                updateGUIFunction();\n            }\n        }\n    }\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003C/div\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-06-13T05:24:47Z\u0022 title=\u002206/13/2016 05:24  AM\u0022 data-short=\u00228 yr\u0022\u003EJune 13, 2016\u003C/time\u003E by DennyTX\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2016-06-13T13:33:47Z","Content":"\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/92389-dennytx/\u0026amp;do=hovercard\u0022 data-mentionid=\u002292389\u0022 href=\u0022%7B___base_url___%7D/index.php?/profile/92389-dennytx/\u0022 rel=\u0022\u0022\u003E@DennyTX\u003C/a\u003E That is what I ended up doing.\n\u003C/p\u003E\n\u003Cp\u003E\nThe answer to my question in the first post is that Unity only calls OnGUI() in classes that inherit from monobehavior, so you either have to tag your class as a monobehavior (which I can\u0027t in this specific case), or call your own GUI method via a call in a OnGUI of a monobehavior class such as the KSPAddon.Flight class for your mod as per your code snippet.\n\u003C/p\u003E\n\u003Cp\u003E\nD.\n\u003C/p\u003E\n"}]}