{"TopicId":12501,"ForumId":29,"TopicTitle":"Invalid Cast Exception","CreatedByName":"Naelo","CreatedById":14384,"CreatedDateTime":"2012-06-11T05:49:59Z","PageNum":1,"Articles":[{"CreatedByName":"Naelo","CreatedById":14384,"CreatedDateTime":"2012-06-11T05:49:59Z","Content":"\n\u003Cp\u003EHey,\u003C/p\u003E\u003Cp\u003EI recently ran into a problem with \u0027Invalid Cast Exception - Cannot cast from source to destination type\u0027.\u003C/p\u003E\u003Cp\u003EI cannot locate where the error is, cause my log full of things looking like this:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003EInvalidCastException: Cannot cast from source type to destination type.\u003Cbr\u003E at MusicPlayer.WindowGUI (Int32 windowID) [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003Cbr\u003E\u003Cbr\u003E at UnityEngine.GUILayout\u002BLayoutedWindow.DoWindow (Int32 windowID) [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003Cbr\u003E\u003Cbr\u003E at UnityEngine.GUI\u002B_Window.Do () [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003Cbr\u003E\u003Cbr\u003E at UnityEngine.GUI.EndWindows (UnityEngine.IDList idlist) [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003Cbr\u003E\u003Cbr\u003E at UnityEngine.GUIUtility.EndGUI (Int32 doLayout, Int32 doWindows, UnityEngine.IDList idlist) [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003Cbr\u003E\u003Cbr\u003E(Filename: Line: -1)\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EIs it something with my plugin\\\u0027s GUI?\u003C/p\u003E\u003Cp\u003EI add my GUI via\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003ERenderingManager.AddToPostDrawQueue(3, new Callback(drawGUI));\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EFirst, I removed all namespaces, still no avail.\u003C/p\u003E\u003Cp\u003EThe weird thing is, when adding some print() commands to drawGUI() it shows me\u003C/p\u003E\u003Cp\u003Ethat the error is happening \u003Cstrong\u003Eafter\u003C/strong\u003E drawGUI has finished?\u003C/p\u003E\u003Cp\u003EdrawGUI looks like this:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E  private void drawGUI()\u003Cbr\u003E  {\u003Cbr\u003E    GUI.skin = HighLogic.Skin;\u003Cbr\u003E    if (guiMode == \u0027exp\u0027)\u003Cbr\u003E    {\u003Cbr\u003E      windowPos = GUILayout.Window(1, windowPos, WindowGUI, \u0027Music Player\u0027, GUILayout.MinWidth(200));\u003Cbr\u003E    }\u003Cbr\u003E    else if (guiMode == \u0027mini\u0027)\u003Cbr\u003E    {\u003Cbr\u003E      windowPos = GUILayout.Window(1, windowPos, WindowGUI, \u0027Music Player\u0027, GUILayout.MinWidth(200), GUILayout.MaxHeight(100));\u003Cbr\u003E    }\u003Cbr\u003E  }\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EAnd WindowGUI:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E  private void WindowGUI(int windowID)\u003Cbr\u003E  {\u003Cbr\u003E    GUIStyle mySty = new GUIStyle(GUI.skin.button);\u003Cbr\u003E    mySty.normal.textColor = mySty.focused.textColor = Color.white;\u003Cbr\u003E    mySty.hover.textColor = mySty.active.textColor = Color.yellow;\u003Cbr\u003E    mySty.onNormal.textColor = mySty.onFocused.textColor = mySty.onHover.textColor = mySty.onActive.textColor = Color.green;\u003Cbr\u003E    mySty.padding = new RectOffset(8, 8, 8, 8);\u003Cbr\u003E    mySty.fixedWidth = 200;\u003Cbr\u003E\u003Cbr\u003E    GUIStyle scrollSty = new GUIStyle(GUI.skin.scrollView);\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E    GUILayout.BeginVertical();\u003Cbr\u003E\u003Cbr\u003E    if (guiMode == \u0027exp\u0027)\u003Cbr\u003E    {\u003Cbr\u003E      if (GUILayout.Button(\u0027Minimize\u0027, GUILayout.ExpandWidth(true)))\u003Cbr\u003E      {\u003Cbr\u003E        guiMode = \u0027mini\u0027;\u003Cbr\u003E      }\u003Cbr\u003E    }\u003Cbr\u003E    else if (guiMode == \u0027mini\u0027)\u003Cbr\u003E    {\u003Cbr\u003E      if (GUILayout.Button(\u0027Expand\u0027, GUILayout.ExpandWidth(true)))\u003Cbr\u003E      {\u003Cbr\u003E        guiMode = \u0027exp\u0027;\u003Cbr\u003E      }\u003Cbr\u003E    }\u003Cbr\u003E\u003Cbr\u003E    GUILayout.Label((string)musiclib[curSongPos], GUILayout.ExpandWidth(true));\u003Cbr\u003E\u003Cbr\u003E    GUILayout.BeginHorizontal();\u003Cbr\u003E    if (GUILayout.Button(\u0027Play\u0027,GUILayout.Width(mySty.fixedWidth / 3)))\u003Cbr\u003E    {\u003Cbr\u003E      player.Play();\u003Cbr\u003E    }\u003Cbr\u003E    if (GUILayout.Button(\u0027Pause\u0027,GUILayout.Width(mySty.fixedWidth / 3)))\u003Cbr\u003E    {\u003Cbr\u003E      player.Pause();\u003Cbr\u003E    }\u003Cbr\u003E    if (GUILayout.Button(\u0027Stop\u0027,GUILayout.Width(mySty.fixedWidth / 3)))\u003Cbr\u003E    {\u003Cbr\u003E      player.Stop();\u003Cbr\u003E    }\u003Cbr\u003E    GUILayout.EndHorizontal();\u003Cbr\u003E\u003Cbr\u003E    GUILayout.BeginHorizontal();\u003Cbr\u003E    if(GUILayout.Button(\u0027Prev\u0027, GUILayout.Width(mySty.fixedWidth / 2))){\u003Cbr\u003E      prevSong();\u003Cbr\u003E    }\u003Cbr\u003E    if (GUILayout.Button(\u0027Next\u0027, GUILayout.Width(mySty.fixedWidth / 2)))\u003Cbr\u003E    {\u003Cbr\u003E      nextSong();\u003Cbr\u003E    }\u003Cbr\u003E    GUILayout.EndHorizontal();\u003Cbr\u003E\u003Cbr\u003E    player.volume = GUILayout.HorizontalSlider(player.volume, 0.01f, 1.0f, GUILayout.ExpandWidth(true));\u003Cbr\u003E\u003Cbr\u003E    if (guiMode == \u0027exp\u0027)\u003Cbr\u003E    {\u003Cbr\u003E      GUILayout.BeginScrollView(new Vector2(0, 0), GUILayout.ExpandWidth(true), GUILayout.Height(200));\u003Cbr\u003E      int ti = 0;\u003Cbr\u003E      foreach (MusicPath actpath in musiclib)\u003Cbr\u003E      {\u003Cbr\u003E        if (GUILayout.Button(actpath.showname, GUILayout.ExpandWidth(true)))\u003Cbr\u003E        {\u003Cbr\u003E          selectSong(ti);\u003Cbr\u003E        }\u003Cbr\u003E        ti\u002B=1;\u003Cbr\u003E      }\u003Cbr\u003E      GUILayout.EndScrollView();\u003Cbr\u003E    }\u003Cbr\u003E\u003Cbr\u003E    GUILayout.EndVertical();\u003Cbr\u003E    GUI.DragWindow(new Rect(0, 0, 10000, 20));\u003Cbr\u003E\u003Cbr\u003E  }\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EThese are pretty much the only functions that are called all the time.\u003C/p\u003E\u003Cp\u003EAny Ideas? I\\\u0027m pretty much stuck :/\u003C/p\u003E\u003Cp\u003EThanks,\u003C/p\u003E\u003Cp\u003ENaelo\u003C/p\u003E\n"},{"CreatedByName":"Romfarer","CreatedById":20387,"CreatedDateTime":"2012-06-11T07:22:32Z","Content":"\n\u003Cp\u003EI think the exception is being thrown here: \u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003EGUILayout.Label((string)musiclib[curSongPos], GUILayout.ExpandWidth(true)); \u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003Emusiclib[curSongPos] seems to return as int32 and you are trying to cast it into a string.\u003C/p\u003E\u003Cp\u003EEdit: so to explain a little further. Invalid Cast Exception can only happen when you cast something i.e. \u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003EPart p = (Part)Object.Initialize(something);\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EThe section you have provided from your output log is also the place it is being reported, albeit poorly at that. It is just a trace of the error, where the top line tells you exactly where the exception occurred, in your case at MusicPlayer.WindowGUI (Int32 windowID) [0x00000] in \u0026lt;filename unknown\u0026gt;:0 . So you know it happened in your WindowGUI method and it has something to do with Int32. Unfortunately the filename references are useless here. \u003C/p\u003E\n"},{"CreatedByName":"kellven","CreatedById":16971,"CreatedDateTime":"2012-06-11T08:13:25Z","Content":"\n\u003Cp\u003E I agree with Romfarer, only 2 things to add:\u003C/p\u003E\u003Cp\u003E 1. If\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Emusiclib[curSongPos]\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E does resolve to an int, and you want to display it, might want to try removing the (string) cast, and making it\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Emusiclib[curSongPos].tostring()\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E 2. If you\\\u0027re still getting problems, try adding a few\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003EDebug.Log(\u0027Made it this far: 0\u0027);\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E lines inside whatever block is causing the problems, that\\\u0027s helped me figure out exactly where the problem occurs many times debugging my own code. The last log to show up before you hit the exception in the place to start looking.\u003C/p\u003E\n"},{"CreatedByName":"Naelo","CreatedById":14384,"CreatedDateTime":"2012-06-11T19:03:24Z","Content":"\n\u003Cp\u003EYes - that was the problem!\u003C/p\u003E\u003Cp\u003EI used to only store strings in that ArrayList but then... I changed it to a custom class which has two attributes.\u003C/p\u003E\u003Cp\u003ETrying to convert the class to a string obviously doesnt work.\u003C/p\u003E\u003Cp\u003EThanks for the help, I would never have spotted that.\u003C/p\u003E\n"},{"CreatedByName":"kellven","CreatedById":16971,"CreatedDateTime":"2012-06-12T11:12:21Z","Content":"\n\u003Cp\u003E Actually, you CAN convert a class to a string, that\\\u0027s why I mentioned .tostring().\u003C/p\u003E\u003Cp\u003E If you\\\u0027re using VS, just type override then space, and select object.tostring(). Or write the override yourself. Useful if you want a data-container object to be \u0027string-able\u0027 for debug printing/etc.\u003C/p\u003E\n"}]}