{"TopicId":7542,"ForumId":29,"TopicTitle":"The official unoffical \u0026quot;help a fellow plugin developer\u0026quot; thread","CreatedByName":"Cephei","CreatedById":2555,"CreatedDateTime":"2012-03-04T10:02:40Z","PageNum":36,"Articles":[{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-03-20T16:16:10Z","Content":"\n\u003Cp\u003E@Dmagic: I\u0027m actually using that for a custom identifier character in saving, one quirk I ran into was that \u0022 (double quotes) don\u0027t work, you have to use \u0027 (single quotes).\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003EDisplayString = DegreesInInt.ToString(\u002200\u0022) \u002B \u0022\\u0176\u0022;\u003C/pre\u003E\u003Cp\u003E throws an error while \u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003EDisplayString = DegreesInInt.ToString(\u002200\u0022) \u002B \u0027\\u0176\u0027;\u003C/pre\u003E\u003Cp\u003E works.\u003C/p\u003E\u003Cp\u003EIf the second method still does not work, the next place I would look is at whichever GUI.style the right click menu uses to figure what it is doing with fonts.\u003C/p\u003E\u003Cp\u003E@Faark: I\u0027m currently storing configured action groups as a single string, but I\u0027m doing it on a per part basis, not a per vessel basis. That way docking two ships together does not wipe out the action groups on the child vessel. I\u0027m using a persistent KSPField(string) to store this data.\u003C/p\u003E\u003Cp\u003EMy issue is that I don\u0027t keep that string up to date in realtime. So when I save, I have to take my list of configured action groups, save only the actions that apply to that part, make my string to save for that part and write the string......\u003C/p\u003E\u003Cp\u003E...\u003C/p\u003E\u003Cp\u003E/headdesk, repeatedly.\u003C/p\u003E\u003Cp\u003EThe string is different for each part, why I am worried about this? Moving my save methods to the PartModule\u0027s OnSave.\u003C/p\u003E\u003Cp\u003EOn the multi-thread thing, I think we are talking past each other. \u003C/p\u003E\u003Cp\u003EI was thinking of trying something like this.\u003C/p\u003E\u003Cp\u003EIn editor, ListAG as List\u0026lt;ActionGroups\u0026gt;, SavePartGroups(p)\u003C/p\u003E\u003Cp\u003ESavePartGroups being the save method that returns a string with the configured actions for that part and a 3 second time delay check so it never runs more often then 3 seconds.\u003C/p\u003E\u003Cp\u003EThen in each partmodule OnSave() event, call SavePartGroups(this part)\u003C/p\u003E\u003Cp\u003EMy worry was that if the partmodules all called OnSave at the same time, it would bypass the 3 second time check and rather then running the calculations to make the code once and coping the string out to each part, it would run the calculations for each part and then copy each generated string to a single part. This is not multi-threading in the typical sense of the word (I don\u0027t think).\u003C/p\u003E\u003Cp\u003EAs it is, I\u0027d overlooked the fact that the calculation has to be run for each part anyway as the save string will be different, so I\u0027ll just move the call to save to the partmodule\u0027s OnSave event and bypass this entire mess.\u003C/p\u003E\u003Cp\u003EOn my code, I do have to warn you I come into this with limited programming experience in VB and while I wave in the general direction of best-practice, I know my code is a mess. I am going to post my thought process and stuff in my mod\u0027s development thread when I am ready to release so hopefully there will be something of interest there.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\u003Cp\u003Eedit: Doing that however does raise a couple issues I need to work around with docked vessel\u0027s. So, two questions.\u003C/p\u003E\u003Cp\u003E1) When two vessel\u0027s dock, is there an identifier of some sort that I can reference to tell which parts belong to which vessel? IE: I launch \u0022Lifter1\u0022 with FlightID10 and \u0022Lander1\u0022 with FlightID11. I dock the two and now have a single vessel \u0022Lifter1\u0022, but do any of the parts from FlightID11 save anything I can use to tell them apart from FlightID10?\u003C/p\u003E\u003Cp\u003E2) What happens to root parts when you dock? From my previous example, once docked, the root part for \u0022Lander1/FlightID11\u0022 is now the same root part as for \u0022Lifter1/FlightID10\u0022 correct?\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-03-20T16:31:19Z\u0022 title=\u002203/20/2014 04:31  PM\u0022 data-short=\u002210 yr\u0022\u003EMarch 20, 2014\u003C/time\u003E by Diazo\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2014-03-20T16:27:05Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Diazo\u0022 data-cite=\u0022Diazo\u0022\u003E\u003Cdiv\u003EMy worry was that if the partmodules all called OnSave at the same time, it would bypass the 3 second time check and rather then running the calculations to make the code once and coping the string out to each part, it would run the calculations for each part and then copy each generated string to a single part.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EParts are saved sequentionally, one after the other. There\u0027s no case in which multiple OnSaves will run simultaneously, in parallel\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-03-20T16:31:45Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022xEvilReeperx\u0022 data-cite=\u0022xEvilReeperx\u0022\u003E\u003Cdiv\u003EParts are saved sequentionally, one after the other. There\u0027s no case in which multiple OnSaves will run simultaneously, in parallel\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EOh, that makes things simpler, thank you.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n"},{"CreatedByName":"stupid_chris","CreatedById":62017,"CreatedDateTime":"2014-03-20T16:38:10Z","Content":"\n\u003Cp\u003EHave you thought of instead using a ScenarioModule to save your data?\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-03-20T16:51:38Z","Content":"\n\u003Cp\u003EScenarioModule? No, I did not even consider that.\u003C/p\u003E\u003Cp\u003EMostly because I don\u0027t even know what one is really, beyond the fact that it sets up the tutorial stuff you can select from the main menu.\u003C/p\u003E\u003Cp\u003EI\u0027m going to read up on them a bit now that you have piqued my interest on them, but I don\u0027t see myself changing my data saving strategy this close to getting my mod ready to go.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n"},{"CreatedByName":"Faark","CreatedById":69775,"CreatedDateTime":"2014-03-20T16:55:49Z","Content":"\n\u003Cp\u003ENo, scenario modules might be great to save data into a game save, but i don\u0027t see how to use them on a ShipConstruct / craft file. That seems required for your project, though...\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-03-20T17:10:36Z","Content":"\n\u003Cp\u003EYa, I just took a quick look at Harvester\u0027s blog where he talks about them.\u003C/p\u003E\u003Cp\u003EMost of my data is saved on a per part basis, with a little bit saved on a per vessel basis to handle docking and stuff.\u003C/p\u003E\u003Cp\u003EI\u0027m not actually saving anything on a scene or game wide basis for my current mod.\u003C/p\u003E\u003Cp\u003EHaving said that, ScenarioModule looks to be a very powerful tool for a future mod of mine that I\u0027m turning over in the back of my head. \u003C/p\u003E\u003Cp\u003EAnyways, my original question about saving has been answered, I\u0027ll be moving my save method to the partmodule\u0027s OnSave and just bypass my original problem of the editor scene not having an OnSave event.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-03-20T17:12:47Z\u0022 title=\u002203/20/2014 05:12  PM\u0022 data-short=\u002210 yr\u0022\u003EMarch 20, 2014\u003C/time\u003E by Diazo\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"DMagic","CreatedById":57416,"CreatedDateTime":"2014-03-21T02:42:02Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Diazo\u0022 data-cite=\u0022Diazo\u0022\u003E\u003Cdiv\u003E@Dmagic: I\u0027m actually using that for a custom identifier character in saving, one quirk I ran into was that \u0022 (double quotes) don\u0027t work, you have to use \u0027 (single quotes).\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003EDisplayString = DegreesInInt.ToString(\u002200\u0022) \u002B \u0022\\u0176\u0022;\u003C/pre\u003E\u003Cp\u003E throws an error while \u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003EDisplayString = DegreesInInt.ToString(\u002200\u0022) \u002B \u0027\\u0176\u0027;\u003C/pre\u003E\u003Cp\u003E works.\u003C/p\u003E\u003Cp\u003EIf the second method still does not work, the next place I would look is at whichever GUI.style the right click menu uses to figure what it is doing with fonts.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThe single quotes, I believe, are used for single characters, while the doubles are for strings, so I guess it only considers the unicode key as a character. \u003C/p\u003E\u003Cp\u003EI tried that method, and a few others for trying to insert the symbol as a character, but none worked in the right-click menu. After looking at Squad\u0027s parts I realized none of them have special characters in that menu either, so I\u0027m guessing they\u0027re using some font or style that doesn\u0027t allow it. I guess I can just use \u0022Deg\u0022 for now as I\u0027m really using the right-click menu as a place-holder for now.\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-03-21T03:20:11Z","Content":"\n\u003Cp\u003EAnyone who saw the previous version of this post, please ignore my late night rants about things not working.\u003C/p\u003E\u003Cp\u003EA more concise summary of the issue I\u0027m running into follows.\u003C/p\u003E\u003Cp\u003EI am working in the editor, trying to save a string to a KSPField Persistent string in the .craft file.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E [KSPField(isPersistant = true, guiActive = false)]\u003Cbr\u003E        public string AGXData;\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EThe following works:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003EIn Partmodule OnSave()\u003Cbr\u003E{\u003Cbr\u003EAGXData = \u0022test\u0022;\u003Cbr\u003Eprint(AGXData);\u003Cbr\u003E}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EThis saves \u0027test\u0027 to the .craft file and prints \u0027test\u0027 to the console as expected.\u003C/p\u003E\u003Cp\u003EHowever, as soon as I try to calculate the string, this breaks. While the string is always printed to the console correctly, it does not save to the craft file.\u003C/p\u003E\u003Cp\u003EPartmodule:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003EOnSave()\u003Cbr\u003E{\u003Cbr\u003EAGXData = \u0022Test1\u0022 \u002B \u0022test2\u0022;\u003Cbr\u003Eprint(AGXData);\u003Cbr\u003E}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EThis prints the string to the console correctly (Test1test2 in this case), but the .craft file has nothing, AGXData = *empty string with no characters*.\u003C/p\u003E\u003Cp\u003EI\u0027ve tried messing around with .ToString() thinking it maybe was a formatting issue, so \u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Estring Temp = \u0022Test1\u0022 \u002B \u0022test2\u0022;\u003Cbr\u003EAGXData = Temp.ToString();\u003Cbr\u003Eprint(AGXData);\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003Ealso prints to console while saving nothing.\u003C/p\u003E\u003Cp\u003EI am now at a total loss, why do some strings save and some not?\u003C/p\u003E\u003Cp\u003EThe only difference I can think of is that stuff I type in quotes, so \u0022test\u0022, works while stuff I calculate like so: SaveString = \u0022test1\u0022 \u002B \u0022test2\u0022; does not.\u003C/p\u003E\u003Cp\u003EHelp?\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-03-21T13:43:11Z\u0022 title=\u002203/21/2014 01:43  PM\u0022 data-short=\u002210 yr\u0022\u003EMarch 21, 2014\u003C/time\u003E by Diazo\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"DMagic","CreatedById":57416,"CreatedDateTime":"2014-03-21T15:07:46Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Diazo\u0022 data-cite=\u0022Diazo\u0022\u003E\u003Cdiv\u003EI am working in the editor, trying to save a string to a KSPField Persistent string in the .craft file.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThat\u0027s weird, I just tried this with something I\u0027m working on and it seems to work fine. \u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E            [KSPField(isPersistant = true)]   //guiActive = false, guiName = \u0022Bt\u0022\u003Cbr\u003E                 public string Bt;\u003Cbr\u003E\u003Cbr\u003E           //Running in OnUpdate()\u003Cbr\u003E\u003Cbr\u003E                 double uTime = Planetarium.GetUniversalTime();\u003Cbr\u003E                 Bt = uTime.ToString();   \u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EI tried this with and without the guiActive and guiName fields included and it worked fine with both. Under my part in the persistent file it included: Bt = 44093.4754801721\u003C/p\u003E\u003Cp\u003EI don\u0027t see why starting with a double and converting it to a string would produce different results from starting directly with a string. I also tried adding \u002B \u0022 seconds\u0022 to the end of the line and it also works.\u003C/p\u003E\u003Cp\u003EEdit: Ignore all that, I see you\u0027re talking about the .craft file, not the persistent file.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-03-21T15:14:02Z\u0022 title=\u002203/21/2014 03:14  PM\u0022 data-short=\u002210 yr\u0022\u003EMarch 21, 2014\u003C/time\u003E by DMagic\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Faark","CreatedById":69775,"CreatedDateTime":"2014-03-21T15:45:06Z","Content":"\n\u003Cp\u003EIt seems like persistence files and craft files partially use the same code for saving. And it seems like PartModule.OnSave(CfgNode) is called after all Fields are already written. The easiest workaround might be to write your data to the given ConfigNode directly...\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-03-21T15:55:39Z","Content":"\n\u003Cp\u003EI\u0027ve not looked at accessing the confignode directly before, any hints? \u003C/p\u003E\u003Cp\u003EI expect it is pretty easy but I have no access to my dev computer try things out until tomorrow (Saturday).\u003C/p\u003E\u003Cp\u003EThe other option I\u0027ve found is in looking at ProceduralParts, \u003Ca href=\u0022https://github.com/Swamp-Ig/ProceduralParts/blob/master/Source/ProceduralParts/TankContentSwitcher.cs\u0022 rel=\u0022external nofollow\u0022\u003E specifically the serialized TankTypeOption class at line 129.\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EThat implements a class with the IConfig interface which looks to do what I want.\u003C/p\u003E\u003Cp\u003EI\u0027ll see what I can get working.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-03-22T17:39:59Z","Content":"\n\u003Cp\u003EAnd in testing, it looks like writing to the config node directly works.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003EIn PartModule OnSave()\u003Cbr\u003E{\u003Cbr\u003Enode.SetValue(\u0022AGXData\u0022, AGXEditor.SaveActionGroups(this.part));\u003Cbr\u003E}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003Ecorrectly saves my calculation (as string returned by SaveActionGroups()).\u003C/p\u003E\u003Cp\u003ESo, I can work with this.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-03-23T03:09:05Z","Content":"\n\u003Cp\u003EAnd my next issue.\u003C/p\u003E\u003Cp\u003EDoes anyone have any idea what might cause this? (From the ksp.o\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003ENullReferenceException\u003Cbr\u003E  at (wrapper managed-to-native) UnityEngine.Component:InternalGetTransform ()\u003Cbr\u003E\u003Cbr\u003E  at UnityEngine.Component.get_transform () [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003Cbr\u003E\u003Cbr\u003E  at SpaceCenterCamera2.UpdateTransformOverview () [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003Cbr\u003E\u003Cbr\u003E  at SpaceCenterCamera2.UpdateTransform () [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003Cbr\u003E\u003Cbr\u003E  at SpaceCenterCamera2.Update () [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EMy own code is not touching the SpaceCenterCamera in any way, but this sometimes appears when the flight scene initializes and it prevents my ship from spawning.\u003C/p\u003E\u003Cp\u003EAny one seen anything like this before?\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\u003Cp\u003Eedit the first: Apparently it was something to do with my code in the OnSave node of my part module calling a method in my Flight Scene code. No clue \u003Cem\u003Ewhy\u003C/em\u003E it would do that, I was only dealing with my own code objects and nothing from KSP\u0027s default objects (I think). Anyways, work-around time.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-03-23T03:31:42Z\u0022 title=\u002203/23/2014 03:31  AM\u0022 data-short=\u002210 yr\u0022\u003EMarch 23, 2014\u003C/time\u003E by Diazo\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"stupid_chris","CreatedById":62017,"CreatedDateTime":"2014-03-23T03:32:02Z","Content":"\n\u003Cp\u003EI get that error often, it seems to be KSP itself actually. IIRC, it triggers most often when going to the launchpad from the space center.\u003C/p\u003E\n"},{"CreatedByName":"TriggerAu","CreatedById":57838,"CreatedDateTime":"2014-03-23T05:03:44Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022stupid_chris\u0022 data-cite=\u0022stupid_chris\u0022\u003E\u003Cdiv\u003EI get that error often, it seems to be KSP itself actually. IIRC, it triggers most often when going to the launchpad from the space center.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EEvery time for me on going to Launchpad or Runway, not your code Diazo\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-03-23T13:00:43Z","Content":"\n\u003Cp\u003EWell, something I was doing was triggering it at least.\u003C/p\u003E\u003Cp\u003EAfter trying to add my save method code to the partmodule\u0027s onsave, I got this error 9 out of 10 times I switched to the launchpad.\u003C/p\u003E\u003Cp\u003ETake the code out, I have not seen it since.\u003C/p\u003E\u003Cp\u003EMy best guess is that because I know my code had both ArrayOutOfRange and NullRef errors in it, one of those cascaded somehow and when the SpaceCamera loaded KSP was already borked.\u003C/p\u003E\u003Cp\u003EHaving said that, I have no explanation for why the SpaceCenter camara was the first error logged and as I\u0027ve implemented another method for saving, I\u0027m not going to experiment to find out.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n"},{"CreatedByName":"stupid_chris","CreatedById":62017,"CreatedDateTime":"2014-03-23T15:43:55Z","Content":"\n\u003Cp\u003EIt\u0027S not you, it happens regularly on my pure stock install. Don\u0027t start investigating errors not caused by your code you\u0027ll have a bad time \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif\u0022 alt=\u0022:P\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Alskari","CreatedById":57638,"CreatedDateTime":"2014-03-27T16:00:55Z","Content":"\n\u003Cp\u003EIn the case of a PartModule class how does one differentiate between the specific part\u0027s localPosition and the vessel\u0027s root part localPosition?\u003C/p\u003E\u003Cp\u003EI have a new PartModule I\u0027m attempting to get working, and I keep returning 0,0,0 as the localPosition of the part no mater where it is in the vessel.\u003C/p\u003E\n"},{"CreatedByName":"DMagic","CreatedById":57416,"CreatedDateTime":"2014-03-27T16:10:14Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Alskari\u0022 data-cite=\u0022Alskari\u0022\u003E\u003Cdiv\u003EIn the case of a PartModule class how does one differentiate between the specific part\u0027s localPosition and the vessel\u0027s root part localPosition?\u003Cp\u003EI have a new PartModule I\u0027m attempting to get working, and I keep returning 0,0,0 as the localPosition of the part no mater where it is in the vessel.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EUsing transform.InverseTransformPoint(\u0022root transform position\u0022) should give you the root part\u0027s position relative to your part\u0027s position. I imagine you can flip that around to get your part\u0027s position relative to the root part\u0027s. There might also be some more direct way of doing it, I\u0027ve never had to find the reverse like that.\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-03-27T16:16:13Z","Content":"\n\u003Cp\u003Eedit: Or I can get ninja\u0027d with a better method to get what you are after.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n"},{"CreatedByName":"Alskari","CreatedById":57638,"CreatedDateTime":"2014-03-27T17:53:20Z","Content":"\n\u003Cp\u003EAlright so this is what I\u0027m trying to work with. The red text is where I\u0027ve been screwing around. All I ever seem to get is the position and roation of the root part. Can someone explain why I can\u0027t seem to access anything about the part accessing the PartModule?\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Epublic class sfrInternal : PartModule\u003Cbr\u003E    {\u003Cbr\u003E\u003Cbr\u003E        private Transform kspParent;\u003Cbr\u003E        private Vector3 kspPosition;\u003Cbr\u003E        private Quaternion kspRotation;\u003Cbr\u003E        private bool isActive;\u003Cbr\u003E        private bool packed;\u003Cbr\u003E\u003Cbr\u003E        public override void OnAwake()\u003Cbr\u003E        {\u003Cbr\u003E            base.OnAwake();\u003Cbr\u003E        }\u003Cbr\u003E\u003Cbr\u003E        public override void OnLoad(ConfigNode node)\u003Cbr\u003E        {\u003Cbr\u003E            base.OnLoad(node);\u003Cbr\u003E        }\u003Cbr\u003E\u003Cbr\u003E        public override void OnSave(ConfigNode node)\u003Cbr\u003E        {\u003Cbr\u003E            base.OnSave(node);\u003Cbr\u003E        }\u003Cbr\u003E\u003Cbr\u003E        public override void OnStart(PartModule.StartState state)\u003Cbr\u003E        {\u003Cbr\u003E            base.OnStart(state);\u003Cbr\u003E        }\u003Cbr\u003E\u003Cbr\u003E        public override void OnUpdate()\u003Cbr\u003E        {\u003Cbr\u003E            base.OnUpdate();\u003Cbr\u003E\u003Cbr\u003E            if (!part.internalModel)\u003Cbr\u003E            {\u003Cbr\u003E                part.CreateInternalModel();\u003Cbr\u003E                part.vessel.SetActiveInternalPart(part);\u003Cbr\u003E                kspParent = part.transform;//InternalCamera.Instance.transform.parent;\u003Cbr\u003E                if (!part.internalModel)\u003Cbr\u003E                    part.internalModel.SetVisible(true);\u003Cbr\u003E                part.internalModel.transform.parent = part.transform;\u003Cbr\u003E                part.internalModel.transform.localRotation = new Quaternion(0.0f, 0.7f, -0.7f, 0.0f);\u003Cbr\u003E                part.internalModel.transform.localPosition = Vector3.zero;\u003Cbr\u003E                if (part.protoModuleCrew.Count \u0026gt; 0)\u003Cbr\u003E                {\u003Cbr\u003E                    part.internalModel.Initialize(part);\u003Cbr\u003E                    part.internalModel.enabled = true;\u003Cbr\u003E                    using (List\u0026lt;ProtoCrewMember\u0026gt;.Enumerator enumerator = ((List\u0026lt;ProtoCrewMember\u0026gt;)part.protoModuleCrew).GetEnumerator())\u003Cbr\u003E                    {\u003Cbr\u003E                        while (enumerator.MoveNext())\u003Cbr\u003E                        {\u003Cbr\u003E                            ProtoCrewMember current = enumerator.Current;\u003Cbr\u003E                            if (current.seat \u0026amp;\u0026amp; !part.vessel.packed)\u003Cbr\u003E                            {\u003Cbr\u003E                                current.seat.enabled = true;\u003Cbr\u003E                                current.seat.SpawnCrew();\u003Cbr\u003E                            }\u003Cbr\u003E                            if (current.KerbalRef)\u003Cbr\u003E                            {\u003Cbr\u003E                                current.KerbalRef.enabled = true;\u003Cbr\u003E                                current.KerbalRef.kerbalCam.cullingMask = 1;\u003Cbr\u003E                            }\u003Cbr\u003E                        }\u003Cbr\u003E                    }\u003Cbr\u003E                    using (List\u0026lt;InternalSeat\u0026gt;.Enumerator enumerator = part.internalModel.seats.GetEnumerator())\u003Cbr\u003E                    {\u003Cbr\u003E                        while (enumerator.MoveNext())\u003Cbr\u003E                        {\u003Cbr\u003E                            InternalSeat current = enumerator.Current;\u003Cbr\u003E                            if (current.kerbalRef)\u003Cbr\u003E                                current.SpawnCrew();\u003Cbr\u003E                            if (current.portraitCamera != null)\u003Cbr\u003E                                current.portraitCamera.cullingMask = 65537;\u003Cbr\u003E                        }\u003Cbr\u003E                    }\u003Cbr\u003E                }\u003Cbr\u003E            }\u003Cbr\u003E            Exception exception;\u003Cbr\u003E            if (isActive != part.vessel.isActiveVessel \u0026amp;\u0026amp; !vessel.packed)\u003Cbr\u003E            {\u003Cbr\u003E                isActive = part.vessel.isActiveVessel;\u003Cbr\u003E                if (part.internalModel \u0026amp;\u0026amp; part.protoModuleCrew.Count \u0026gt; 0)\u003Cbr\u003E                {\u003Cbr\u003E                    part.vessel.SetActiveInternalPart(part);\u003Cbr\u003E                    part.internalModel.Initialize(part);\u003Cbr\u003E                    using (List\u0026lt;InternalSeat\u0026gt;.Enumerator enumerator = part.internalModel.seats.GetEnumerator())\u003Cbr\u003E                    {\u003Cbr\u003E                        while (enumerator.MoveNext())\u003Cbr\u003E                        {\u003Cbr\u003E                            InternalSeat current = enumerator.Current;\u003Cbr\u003E                            current.enabled = true;\u003Cbr\u003E                            if (current.portraitCamera)\u003Cbr\u003E                                current.portraitCamera.cullingMask = 1;\u003Cbr\u003E                        }\u003Cbr\u003E                    }\u003Cbr\u003E                    try\u003Cbr\u003E                    {\u003Cbr\u003E                        using (List\u0026lt;ProtoCrewMember\u0026gt;.Enumerator enumerator = part.protoModuleCrew.GetEnumerator())\u003Cbr\u003E                        {\u003Cbr\u003E                            while (enumerator.MoveNext())\u003Cbr\u003E                            {\u003Cbr\u003E                                ProtoCrewMember current = enumerator.Current;\u003Cbr\u003E                                if (current.seat \u0026amp;\u0026amp; !part.vessel.packed)\u003Cbr\u003E                                {\u003Cbr\u003E                                    current.seat.enabled = true;\u003Cbr\u003E                                    current.seat.SpawnCrew();\u003Cbr\u003E                                }\u003Cbr\u003E                                if (current.KerbalRef)\u003Cbr\u003E                                {\u003Cbr\u003E                                    current.KerbalRef.enabled = true;\u003Cbr\u003E                                    current.KerbalRef.kerbalCam.cullingMask = 1;\u003Cbr\u003E                                }\u003Cbr\u003E                            }\u003Cbr\u003E                        }\u003Cbr\u003E                    }\u003Cbr\u003E                    catch (Exception ex)\u003Cbr\u003E                    {\u003Cbr\u003E                        exception = ex;\u003Cbr\u003E                    }\u003Cbr\u003E                }\u003Cbr\u003E            }\u003Cbr\u003E            try\u003Cbr\u003E            {\u003Cbr\u003E                if (sfrUtility.FindCamera(\u0022InternalCamera\u0022) \u0026amp;\u0026amp; part.vessel.isActiveVessel)\u003Cbr\u003E                {\u003Cbr\u003E[COLOR=\u0022#FF0000\u0022]                    sfrUtility.ChangeLayer(part.internalModel.transform, 16);\u003Cbr\u003E                    part.internalModel.transform.parent = kspParent; // = InternalCamera.Instance.transform.parent;\u003Cbr\u003E                    part.internalModel.transform.localRotation = new Quaternion(0.0f, 0.7f, -0.7f, 0.0f); //Working at root\u003Cbr\u003E                    part.internalModel.transform.localPosition = Vector3.zero; //Working at root[/COLOR]\u003Cbr\u003E                }\u003Cbr\u003E                else\u003Cbr\u003E                {\u003Cbr\u003E                    sfrUtility.ChangeLayer(part.internalModel.transform, 0);\u003Cbr\u003E                    part.internalModel.SetVisible(true);\u003Cbr\u003E                    part.internalModel.gameObject.SetActive(true);\u003Cbr\u003E                    part.internalModel.transform.parent = part.transform;\u003Cbr\u003E                    part.internalModel.transform.localRotation = new Quaternion(0.0f, 0.7f, -0.7f, 0.0f);\u003Cbr\u003E                    part.internalModel.transform.localPosition = Vector3.zero;\u003Cbr\u003E                }\u003Cbr\u003E            }\u003Cbr\u003E            catch (Exception ex)\u003Cbr\u003E            {\u003Cbr\u003E                exception = ex;\u003Cbr\u003E            }\u003Cbr\u003E            try\u003Cbr\u003E            {\u003Cbr\u003E                using (List\u0026lt;ProtoCrewMember\u0026gt;.Enumerator enumerator = part.protoModuleCrew.GetEnumerator())\u003Cbr\u003E                {\u003Cbr\u003E                    while (enumerator.MoveNext())\u003Cbr\u003E                    {\u003Cbr\u003E                        ProtoCrewMember current = enumerator.Current;\u003Cbr\u003E                        if (current.seat)\u003Cbr\u003E                        {\u003Cbr\u003E                            current.seat.enabled = true;\u003Cbr\u003E                            if (current.seat.portraitCamera)\u003Cbr\u003E                                current.seat.portraitCamera.cullingMask = (65537);\u003Cbr\u003E                        }\u003Cbr\u003E                        if (current.KerbalRef)\u003Cbr\u003E                        {\u003Cbr\u003E                            current.KerbalRef.enabled = true;\u003Cbr\u003E                            current.KerbalRef.kerbalCam.cullingMask = (65537);\u003Cbr\u003E                            if (current.KerbalRef.kerbalCamOverlay)\u003Cbr\u003E                                current.KerbalRef.kerbalCamOverlay.layer = 16;\u003Cbr\u003E                        }\u003Cbr\u003E                    }\u003Cbr\u003E                }\u003Cbr\u003E            }\u003Cbr\u003E            catch (Exception ex)\u003Cbr\u003E            {\u003Cbr\u003E                exception = ex;\u003Cbr\u003E            }\u003Cbr\u003E        }\u003Cbr\u003E    }\u003Cbr\u003E\u003Cbr\u003E}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-03-28T00:13:17Z\u0022 title=\u002203/28/2014 12:13  AM\u0022 data-short=\u002210 yr\u0022\u003EMarch 28, 2014\u003C/time\u003E by Alskari\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"stupid_chris","CreatedById":62017,"CreatedDateTime":"2014-03-28T12:38:47Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Alskari\u0022 data-cite=\u0022Alskari\u0022\u003E\u003Cdiv\u003EAlright so this is what I\u0027m trying to work with. The red text is where I\u0027ve been screwing around. All I ever seem to get is the position and roation of the root part. Can someone explain why I can\u0027t seem to access anything about the part accessing the PartModule?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EDo you want it in world or local coordinates? And if from local coordinates, by setting the origin where? Getting world coordinates for the part accessing the PartModule is as easy as \u0022Vector3 pos = this.part.transform.location;\u0022. If you want it in local coordinates from the root part, it would simply be something like \u0022Vector3 localPos = this.vessel.rootPart.tranform.location - this.part.transform.location;\u0022 You can apply the same logic to anything you would want.\u003C/p\u003E\n"},{"CreatedByName":"kiwiak","CreatedById":82796,"CreatedDateTime":"2014-03-28T12:41:42Z","Content":"\n\u003Cp\u003EHow can i add some option to right click menu when i click on kerbal on EVA? \u003C/p\u003E\u003Cp\u003EI mean option not associated with any part, like plant flag or eva report.\u003C/p\u003E\n"},{"CreatedByName":"stupid_chris","CreatedById":62017,"CreatedDateTime":"2014-03-28T12:44:38Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022kiwiak\u0022 data-cite=\u0022kiwiak\u0022\u003E\u003Cdiv\u003EHow can i add some option to right click menu when i click on kerbal on EVA? \u003Cp\u003EI mean option not associated with any part, like plant flag or eva report.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EKerbals are essentially one part vessels with a KerbalEVA PartModule. You can simply create a partmodule that does what you want, and then add that module to all EVA\u0027ed Kerbals.\u003C/p\u003E\n"}]}