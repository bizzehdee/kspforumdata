{"TopicId":83928,"ForumId":29,"TopicTitle":"[SOLVED] onCrewKilled and onKerbalStatusUpdate Help","CreatedByName":"DJK","CreatedById":114951,"CreatedDateTime":"2014-09-06T05:39:22Z","PageNum":1,"Articles":[{"CreatedByName":"DJK","CreatedById":114951,"CreatedDateTime":"2014-09-06T05:39:22Z","Content":"\n\u003Cp\u003EHi. I\u0027m basically working on a simple plugin and i ran into this :\u003C/p\u003E\u003Cp\u003Ecalling onCrewKilled or onKerbalStatusChange\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Evoid onCrewKilled(EventReport e)\u003Cbr\u003E        {\u003Cbr\u003E            Debug.Log(\u0022KSN onCrewKilled!\u0022);\u003Cbr\u003E        }\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EonKerbalStatusChange looks the same. Just a debug.log line to check when its called.\u003C/p\u003E\u003Cp\u003EAnd i get this:\u003C/p\u003E\u003Cp\u003E\u0022[00:02:50]: Bill Kerman was killed.\u003C/p\u003E\u003Cp\u003EKSN onCrewKilled!\u003C/p\u003E\u003Cp\u003EKSN onCrewKilled!\u003C/p\u003E\u003Cp\u003EKSN onCrewKilled!\u003C/p\u003E\u003Cp\u003EKSN onCrewKilled!\u003C/p\u003E\u003Cp\u003EKSN onCrewKilled!\u003C/p\u003E\u003Cp\u003EKSN onCrewKilled!\u003C/p\u003E\u003Cp\u003EKSN onCrewKilled!\u003C/p\u003E\u003Cp\u003EKSN onCrewKilled!\u003C/p\u003E\u003Cp\u003EKSN onCrewKilled!\u003C/p\u003E\u003Cp\u003EKSN onCrewKilled!\u003C/p\u003E\u003Cp\u003EKSN onCrewKilled!\u003C/p\u003E\u003Cp\u003EKSN onCrewKilled!\u003C/p\u003E\u003Cp\u003EKSN onCrewKilled!\u0022\u003C/p\u003E\u003Cp\u003ESame applies for onKerbalStatusChange.. can someone explain why its running more than one time? and how do i get around this to call/run it only once? The test rocket is just a mk1 cmd pod \u002B srb used to kill the kerbal.\u003C/p\u003E\u003Cp\u003EonCrewKilled / onKerbalStatusChange is being called on Awake - and yes, i have no clue what i\u0027m really doing since this is my 1st plugin and i\u0027ve never tried C# before.\u003C/p\u003E\u003Cp\u003EThe plugin i\u0027m trying to make should take funds when a kerbal dies (even by TACLS \u0026amp; when vessel is not focused, thats why i\u0027ve hoped to use onKerbalStatusChange).. so i was gonna use so any ideas or tips are welcome!\u003C/p\u003E\u003Cp\u003EThank you!\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-09-08T15:27:50Z\u0022 title=\u002209/08/2014 03:27  PM\u0022 data-short=\u00229 yr\u0022\u003ESeptember 8, 2014\u003C/time\u003E by DJK\u003C/strong\u003E\n\u003Cbr\u003EProblem Solved\n\u003C/span\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2014-09-07T15:14:39Z","Content":"\n\u003Cp\u003EIt looks like it works as expected to me, called once for each Kerbal killed. Can you show more code? The phrase \u0022onCrewKilled / onKerbalStatusChange is being called on Awake\u0022 makes me think you haven\u0027t registered the event in GameEvents or there\u0027s something else going wrong in your code\u003C/p\u003E\n"},{"CreatedByName":"DJK","CreatedById":114951,"CreatedDateTime":"2014-09-07T16:03:40Z","Content":"\n\u003Cp\u003EThanks for the reply xEvilReeperx.\u003C/p\u003E\u003Cp\u003EHere is the simple version of the code:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Eusing System;\u003Cbr\u003Eusing System.Collections.Generic;\u003Cbr\u003Eusing System.Linq;\u003Cbr\u003Eusing System.Text;\u003Cbr\u003E//using System.Threading.Tasks;\u003Cbr\u003Eusing UnityEngine;\u003Cbr\u003Eusing KSP;\u003Cbr\u003E\u003Cbr\u003Enamespace DJK_KS\u003Cbr\u003E{\u003Cbr\u003E    [KSPAddon(KSPAddon.Startup.EveryScene, false)]\u003Cbr\u003E    public class KSN : MonoBehaviour\u003Cbr\u003E    {\u003Cbr\u003E        public void Awake()\u003Cbr\u003E        {\u003Cbr\u003E            GameEvents.onCrewKilled.Add(onCrewKilled);\u003Cbr\u003E        }\u003Cbr\u003E\u003Cbr\u003E        private void onCrewKilled(EventReport e)\u003Cbr\u003E        {\u003Cbr\u003E            Debug.Log(\u0022KSN onCrewKilled!\u0022);\u003Cbr\u003E        }\u003Cbr\u003E    }\u003Cbr\u003E}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EWhich does this:\u003C/p\u003E\u003Cp\u003E\u0022[00:01:42]: Jebediah Kerman was killed.\u003C/p\u003E\u003Cp\u003EKSN onCrewKilled!\u003C/p\u003E\u003Cp\u003EKSN onCrewKilled!\u003C/p\u003E\u003Cp\u003EKSN onCrewKilled!\u003C/p\u003E\u003Cp\u003EKSN onCrewKilled!\u003C/p\u003E\u003Cp\u003EKSN onCrewKilled!\u003C/p\u003E\u003Cp\u003EKSN onCrewKilled!\u003C/p\u003E\u003Cp\u003EKSN onCrewKilled!\u003C/p\u003E\u003Cp\u003EKSN onCrewKilled!\u003C/p\u003E\u003Cp\u003EKSN onCrewKilled!\u003C/p\u003E\u003Cp\u003EKSN onCrewKilled!\u003C/p\u003E\u003Cp\u003EKSN onCrewKilled!\u003C/p\u003E\u003Cp\u003EKSN onCrewKilled!\u003C/p\u003E\u003Cp\u003EKSN onCrewKilled!\u003C/p\u003E\u003Cp\u003EKSN onCrewKilled!\u0022\u003C/p\u003E\u003Cp\u003EThats on a clean KSP install (no mods).. new game (sandbox this time) with no kerbal killed so far. Jeb was the first and only crew member on a mk1 pod \u002B srb that died.. shouldn\u0027t \u0022KSN onCrewKilled!\u0022 be called just once in debug? Like:\u003C/p\u003E\u003Cp\u003E\u0022[00:01:42]: Jebediah Kerman was killed.\u003C/p\u003E\u003Cp\u003EKSN onCrewKilled!\u0022\u003C/p\u003E\u003Cp\u003Eand not 14 times?\u003C/p\u003E\n"},{"CreatedByName":"FlynCow","CreatedById":120589,"CreatedDateTime":"2014-09-07T17:35:27Z","Content":"\n\u003Cp\u003EThe Problem is that Awake() Gets executed \u003Cstrong\u003EEverytime\u003C/strong\u003E the Scene changes, So your onCrewKilled(EventReport) Function gets registered Multiple times to the onCrewKilled Event.\u003C/p\u003E\u003Cp\u003EThe KSPAddon Constructor has a once Argument, true means it only gets executed once and false means it gets executed everytime your Startup argument happens.\u003C/p\u003E\n"},{"CreatedByName":"DMagic","CreatedById":57416,"CreatedDateTime":"2014-09-07T17:41:19Z","Content":"\n\u003Cp\u003EIs this what your log actually looks like (the line repeated 10 or so times), or does it continually print this?\u003C/p\u003E\u003Cp\u003EIf it repeats a certain number of times that\u0027s probably because you are registering the callback every time the scene changes, but never removing it. \u003C/p\u003E\u003Cp\u003EPut this in your OnDestroy() method.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003EGameEvents.onCrewKilled.Remove(onCrewKilled);\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n"},{"CreatedByName":"DJK","CreatedById":114951,"CreatedDateTime":"2014-09-08T15:25:19Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003EThe Problem is that Awake() Gets executed \u003Cstrong\u003EEverytime\u003C/strong\u003E the Scene changes, So your onCrewKilled(EventReport) Function gets registered Multiple times to the onCrewKilled Event.\u003Cp\u003EThe KSPAddon Constructor has a once Argument, true means it only gets executed once and false means it gets executed everytime your Startup argument happens.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EChanging the argument to true worked as a charm \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 alt=\u0022:D\u0022\u003E\u003C/p\u003E\u003Cp\u003EPutting this:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003EGameEvents.onCrewKilled.Remove(onCrewKilled);\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003Ein OnDestroy() method had no effect.\u003C/p\u003E\u003Cp\u003EThank you for the help guys, i really appreciate it!\u003C/p\u003E\n"}]}