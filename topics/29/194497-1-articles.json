{"TopicId":194497,"ForumId":29,"TopicTitle":"Issue with multiple mods replacing delegates of buttons","CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2020-06-06T05:10:23Z","PageNum":1,"Articles":[{"CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2020-06-06T05:10:23Z","Content":"\n\u003Cp\u003E\nI ran into this problem a month ago, and first spent several hours isolating it down to two specific mods, and then today I spent a number of hours debugging it.\u00A0 What made it strange was that the two mods both worked perfectly by themselves, it was only when both were installed that the problem showed up.\n\u003C/p\u003E\n\u003Cp\u003E\nIt was very strange., you can read about the issue here:\u00A0\n\u003C/p\u003E\n\u003Ciframe allowfullscreen=\u0022\u0022 data-controller=\u0022core.front.core.autosizeiframe\u0022 data-embedauthorid=\u0022129964\u0022 data-embedcontent=\u0022\u0022 data-embedid=\u0022embed6165010102\u0022 scrolling=\u0022no\u0022 src=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/194485-scenariomodule-proper-use-and-an-odd-issue/\u0026amp;tab=comments\u0026amp;do=embed\u0026amp;comment=3798133\u0026amp;embedComment=3798133\u0026amp;embedDo=findComment#comment-3798133\u0022 style=\u0022height:298px;max-width:502px;\u0022\u003E\u003C/iframe\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nThe problem of multiple buttons when both Fill-It-Up and Progressive-Colonization are present (and most likely Werner\u0027s Checker as well) arises because both mods are replacing the listener of the EditorLogic.fetch.launchBtn.onClick. \u00A0Then, when the button is clicked, BOTH replacements are called,\u00A0\u003Cbr\u003E\nand then both of them are invoking the EditorLogic.fetch.launchVessel\n\u003C/p\u003E\n\u003Cp\u003E\nThis isn\u0027t a bug in either mod, it\u0027s a bug in the implementation since there is no way for a mod to get a delegate of a button which is an unknown method.\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cbr\u003E\nWhile it\u0027s possible to remove all listeners, the only one this would work for would be the last mod initialized, since it would remove all others.\n\u003C/p\u003E\n\u003Cp\u003E\nIdeally, what should happen is one of the following (for the purposes of this discussion, I\u0027ll refer to both mods via abbreviations, and also assume there are only two mods, but this applies to any number of mods):\n\u003C/p\u003E\n\u003Col\u003E\u003Cli\u003E\nThe new UnityAction which each mod adds would be called simultaneously, and then only when both have finished, the original delegate (EditorLogic.fetch.launchVessel) would be called.\n\u003C/li\u003E\n\u003Cli\u003E\nThe first mod initialized would be called first, and when it was done the second mod would be called, and finally the original delegate would be called.\n\u003C/li\u003E\n\u003Cli\u003E\nA mod will specify a priority when initializing .\n\u003C/li\u003E\n\u003C/ol\u003E\u003Cp\u003E\n\u003Cbr\u003E\nThis can\u0027t be solved by one mod, a solution needs to be implemented and used by all mods which replaces the delegate(s) of this button.\n\u003C/p\u003E\n\u003Cp\u003E\nI am working on a solution for this because:\n\u003C/p\u003E\n\u003Col\u003E\u003Cli\u003E\nI found the problem\n\u003C/li\u003E\n\u003Cli\u003E\nI have at least two mods affected by this problem\n\u003C/li\u003E\n\u003C/ol\u003E\u003Cp\u003E\nI\u0027m writing a tiny mod which will be used by any other mod to control access to this button and it\u0027s delegates:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003Eclass ButtonManager\n{\n\u00A0\u00A0 \u00A0void InitializeListener(UnityEngine.UI.Button button, \u00A0UnityAction delegate);\n\u00A0\u00A0 \u00A0int AddListener(UnityEngine.UI.Button button, \u00A0UnityAction delegate, int priority = 5);\n\u00A0\u00A0 \u00A0void RemoveListener(UnityEngine.UI.Button button, \u00A0UnityAction delegate);\n\u00A0\u00A0 \u00A0void RemoveListener(int listenerId);\n\n\u00A0\u00A0 \u00A0int GetListenerCount(UnityEngine.UI.Button button);\n\u00A0\u00A0 \u00A0void RemoveAllListeners(UnityEngine.UI.Button button);\n\n\u00A0\u00A0 \u00A0void InvokeNextDelegate(int currentDelegateId);\n\n\u00A0\u00A0 \u00A0void SetModeSequential();\n\u00A0\u00A0 \u00A0void SetModeSimultaneous();\n}\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nThe priority will be used to determine the order of listeners to be called. \u00A0Higher priorities will be run first. \u00A0For the Sequential mode, mods with the same priority will be run in the order initialized.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Ctable align=\u0022left\u0022 border=\u00222\u0022 cellpadding=\u00222\u0022 cellspacing=\u00221\u0022 style=\u0022width:1000px;\u0022\u003E\u003Ctbody\u003E\u003Ctr\u003E\u003Ctd\u003E\nInitializeListener\u00A0\u00A0 \u00A0\n\u003C/td\u003E\n\u003Ctd\u003E\nInitializes the mod to work with the specified button. \u00A0The delegate should be the same as what the default it, it will have the lowest priority\n\u003C/td\u003E\n\u003C/tr\u003E\u003Ctr\u003E\u003Ctd\u003E\nAddListener\u00A0\u00A0 \u00A0\n\u003C/td\u003E\n\u003Ctd\u003E\nAdds a delegate to a button with a specified priority. \u00A0Returns a listenerId, used below\n\u003C/td\u003E\n\u003C/tr\u003E\u003Ctr\u003E\u003Ctd\u003E\nRemoveListener\u00A0\u00A0 \u00A0\n\u003C/td\u003E\n\u003Ctd\u003E\nRemoves a delegate from a button\n\u003C/td\u003E\n\u003C/tr\u003E\u003Ctr\u003E\u003Ctd\u003E\nGetListenerCount\u00A0\u00A0 \u00A0\n\u003C/td\u003E\n\u003Ctd\u003E\nGets a count of all the listeners\n\u003C/td\u003E\n\u003C/tr\u003E\u003Ctr\u003E\u003Ctd\u003E\nRemoveAllListeners\u00A0\u00A0\n\u003C/td\u003E\n\u003Ctd\u003E\nRemoves all except the default listener\n\u003C/td\u003E\n\u003C/tr\u003E\u003Ctr\u003E\u003Ctd\u003E\nInvokeNextDelegate\u00A0\u00A0\n\u003C/td\u003E\n\u003Ctd\u003E\nTells the mod to call the next delegate on the list\n\u003C/td\u003E\n\u003C/tr\u003E\u003Ctr\u003E\u003Ctd\u003E\n\u003Cp\u003E\nSetModeSequential\u00A0\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nSetModeSimultaneous\u00A0\u00A0\n\u003C/p\u003E\n\u003C/td\u003E\n\u003Ctd\u003E\nThese two can set or change the mode, sequential will run one delegate at a time, simultaneous will run all of the same priority at the same time, and then the next lower, etc\n\u003C/td\u003E\n\u003C/tr\u003E\u003Ctr\u003E\u003Ctd\u003E\n\u00A0\n\u003C/td\u003E\n\u003Ctd\u003E\n\u00A0\n\u003C/td\u003E\n\u003C/tr\u003E\u003C/tbody\u003E\u003C/table\u003E\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nI hope to have this finished in the next few days, and will first implement it in my mods.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222020-06-06T05:15:41Z\u0022 title=\u002206/06/2020 05:15  AM\u0022 data-short=\u00224 yr\u0022\u003EJune 6, 2020\u003C/time\u003E by linuxgurugamer\u003C/strong\u003E\n\u003C/span\u003E\n"}]}