{"TopicId":161718,"ForumId":29,"TopicTitle":"Mod GUI hang-up","CreatedByName":"Teilnehmer","CreatedById":143330,"CreatedDateTime":"2017-06-07T04:08:19Z","PageNum":1,"Articles":[{"CreatedByName":"Teilnehmer","CreatedById":143330,"CreatedDateTime":"2017-06-07T04:08:19Z","Content":"\n\u003Cp\u003E\n\u003Cs\u003EHouston\u003C/s\u003E, I have a problem:\n\u003C/p\u003E\n\u003Cp\u003E\nI\u2019ve updated a mod to KSP 1.3 (\u003Ca href=\u0022https://github.com/formicant/AutoAction\u0022 rel=\u0022external nofollow\u0022\u003Ethis one\u003C/a\u003E), and now, the moment before the GUI of the mod should appear the first time, KSP hangs up for an unpredictable time (0.2 to 10 seconds) for unknown reason.\n\u003C/p\u003E\n\u003Cp\u003E\nThe log shows nothing, but I can trace that the hang-up occurs somewhere in the middle of \u003Cspan\u003EDrawWindow()\u003C/span\u003E method (called form GUI.Window() in my OnGUI() method) between arbitrary GUI element rendering method calls.\n\u003C/p\u003E\n\u003Cp\u003E\nApparently, this is not connected with localization since even the not localized KSP-1.2.2 version of the mod hangs up in KSP 1.3.\n\u003C/p\u003E\n\u003Cp\u003E\nThe same thing also happened when I tried to update \u003Ca href=\u0022https://github.com/formicant/CriticalTemperatureGauge\u0022 rel=\u0022external nofollow\u0022\u003Emy another mod\u003C/a\u003E to 1.3.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nWhat causes those hang-ups, and how can I treat them?\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222017-06-07T04:12:06Z\u0022 title=\u002206/07/2017 04:12  AM\u0022 data-short=\u00227 yr\u0022\u003EJune 7, 2017\u003C/time\u003E by Teilnehmer\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2017-06-07T06:09:31Z","Content":"\n\u003Cp\u003E\nWhat causes them? Normal culprits are File IO (eg. logging) and/or heavy use of reflection, but anything can do it if you do it too much. In this case, throw\u00A0debug statements at the function and check the timestamps in the log would be the simplest IMO\n\u003C/p\u003E\n\u003Cp\u003E\nTreatment depends on the culprit. 90% of the time, you\u0027ll find that you\u0027re just doing something more often than is actually required. The other 10% you have to play smarter (coroutine to divide work across several frames, separate thread for the really heavy stuff, caching results, preloading, ...)\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222017-06-07T06:11:43Z\u0022 title=\u002206/07/2017 06:11  AM\u0022 data-short=\u00227 yr\u0022\u003EJune 7, 2017\u003C/time\u003E by Crzyrndm\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Teilnehmer","CreatedById":143330,"CreatedDateTime":"2017-06-07T07:04:46Z","Content":"\n\u003Cp\u003E\nHm\u2026\n\u003C/p\u003E\n\u003Cp\u003E\nI do not actually do anything but drawing the GUI elements.\n\u003C/p\u003E\n\u003Cp\u003E\nI\u2019ve already tried to locate the critical place in the code using debug log messages. The log showed that the time delay was during the execution of\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-c prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003Evar activateGroupB \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E=\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E GUI\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan\u003ETextField\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n\t\u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Enew\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan\u003ERect\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan class=\u0022lit\u0022\u003E5\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E\u002B\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022lit\u0022\u003E3\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E*\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E unit\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E,\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022lit\u0022\u003E103\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E,\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022lit\u0022\u003E3\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E*\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E unit\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E,\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022lit\u0022\u003E20\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E),\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n\t_activateGroupB\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan\u003EToStringValue\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003EnullValue\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E:\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022str\u0022\u003E\u0022\u0022\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E),\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n\t\u003C/span\u003E\u003Cspan class=\u0022lit\u0022\u003E4\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E,\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n\t\u003C/span\u003E\u003Cspan\u003ETextFieldStyle\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E).\u003C/span\u003E\u003Cspan\u003EParseNullableInt\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003EminValue\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E:\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022lit\u0022\u003E1\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E);\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nIt does not do anything complicated and is not even the first statement among the other similar ones.\n\u003C/p\u003E\n\u003Cp\u003E\nMoreover, if I change the order of the statements, then some other statement falls on the delay.\n\u003C/p\u003E\n\u003Cp\u003E\nIt looks like something happening in a different thread causes the hang-up, not the code I am watching.\n\u003C/p\u003E\n\u003Cp\u003E\nBtw, the hang-up occurs only once and does not repeat until restarting KSP.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222017-06-07T07:08:42Z\u0022 title=\u002206/07/2017 07:08  AM\u0022 data-short=\u00227 yr\u0022\u003EJune 7, 2017\u003C/time\u003E by Teilnehmer\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2017-06-07T18:07:40Z","Content":"\n\u003Cp\u003E\nI\u0027ve run into this also as my mods are still using the old GUI system and as far as I can tell the delay is caused by the fact that the old GUI system is no longer pre-loaded in KSP, rather it is loaded the first time an OnGUI call is made and so stalls for a few seconds while everything loads from disk into memory.\n\u003C/p\u003E\n\u003Cp\u003E\nI am seeing the same behavior where it happens once per KSP run and behaves normally afterwards. Note that which mod displays first doesn\u0027t matter, the first use of OnGUI causes the stall and once the stall is out of the way, all mods are fine.\n\u003C/p\u003E\n\u003Cp\u003E\nAs I intend to update to the new GUI system at some point soon, I\u0027ve just posted a warning in my release notes that it happens and left it at that.\n\u003C/p\u003E\n\u003Cp\u003E\nD.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222017-06-07T18:09:10Z\u0022 title=\u002206/07/2017 06:09  PM\u0022 data-short=\u00227 yr\u0022\u003EJune 7, 2017\u003C/time\u003E by Diazo\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Teilnehmer","CreatedById":143330,"CreatedDateTime":"2017-06-08T03:41:22Z","Content":"\n\u003Cp\u003E\nThanks a lot, Diazo!\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223083917\u0022 data-ipsquote-contentid=\u0022161718\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221496858860\u0022 data-ipsquote-userid=\u002281549\u0022 data-ipsquote-username=\u0022Diazo\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n9 hours ago, Diazo said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nAs I intend to update to the new GUI system at some point soon, I\u0027ve just posted a warning in my release notes that it happens and left it at that.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nOK, I\u2019ll do the same.\n\u003C/p\u003E\n\u003Cp\u003E\nWhere can I read something about the new GUI system? (or, which KSP mods use it, so I can look at their source and learn?)\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222017-06-08T03:42:22Z\u0022 title=\u002206/08/2017 03:42  AM\u0022 data-short=\u00227 yr\u0022\u003EJune 8, 2017\u003C/time\u003E by Teilnehmer\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2017-06-08T03:44:08Z","Content":"\n\u003Cp\u003E\nTo go all out and create your own GUI in the unity editor:\n\u003C/p\u003E\n\u003Ciframe data-embedcontent=\u0022\u0022 frameborder=\u00220\u0022 src=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/151354-unity-ui-creation-tutorial/\u0026amp;do=embed\u0022\u003E\u003C/iframe\u003E\n\u003Cp\u003E\nUse the more limited built-in system similar to the older OnGUI system:\n\u003C/p\u003E\n\u003Ciframe data-embedcontent=\u0022\u0022 frameborder=\u00220\u0022 src=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/149324-popupdialog-and-the-dialoggui-classes/\u0026amp;do=embed\u0022\u003E\u003C/iframe\u003E\n\u003Cp\u003E\nI\u0027m planning to make my own GUIs from scratch, the complexity of AGX requires it so I\u0027m going to do it the same for all my mods.\n\u003C/p\u003E\n\u003Cp\u003E\nD.\n\u003C/p\u003E\n"}]}