{"TopicId":161375,"ForumId":29,"TopicTitle":"Move unpacked vessels","CreatedByName":"Dagger","CreatedById":147766,"CreatedDateTime":"2017-05-31T19:26:11Z","PageNum":1,"Articles":[{"CreatedByName":"Dagger","CreatedById":147766,"CreatedDateTime":"2017-05-31T19:26:11Z","Content":"\n\u003Cp\u003E\nHi.\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027m trying to move NON packed vessels in a multiplayer mod that I\u0027m making. The issue is that the vessel shakes horribly and I don\u0027t know what might be happening.\n\u003C/p\u003E\n\u003Cp\u003E\nI don\u0027t have a problem doing it with packed vessels but I think that the flight integrator is messing with me when the vessel is unpacked and I don\u0027t know what parts should I touch to do so.\n\u003C/p\u003E\n\u003Cp\u003E\nThe full code:\u00A0\u003Ca href=\u0022https://github.com/DaggerES/LunaMultiPlayer/blob/master/Client/Systems/VesselPositionAltSys/VesselPositionAltUpdate.cs#L153\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/DaggerES/LunaMultiPlayer/blob/master/Client/Systems/VesselPositionAltSys/VesselPositionAltUpdate.cs#L153\u003C/a\u003E\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003ERotation = new Quaternion(rot[0], rot[1], rot[2], rot[3]);\nPosition = Body.GetWorldSurfacePosition(lat, lon, alt);\n\nVessel.checkSplashed();\nVessel.checkLanded();\n\nVessel.vesselTransform.rotation = Rotation;\nVessel.vesselTransform.position = Position;\nVessel.SetRotation(Rotation, true);\nVessel.SetPosition(Position, false);\nVessel.latitude = lat;\nVessel.longitude = lon;\nVessel.altitude = alt;\n\nforeach (var part in Vessel.parts)\n\tpart.ResumeVelocity();\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nHopefully someone can help me with this, I feel like I\u0027m close to finish this multiplayer mod but the movement is very jerky and I don\u0027t know what parts should I look at.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222017-05-31T19:27:43Z\u0022 title=\u002205/31/2017 07:27  PM\u0022 data-short=\u00227 yr\u0022\u003EMay 31, 2017\u003C/time\u003E by Dagger\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Dagger","CreatedById":147766,"CreatedDateTime":"2017-06-01T13:05:50Z","Content":"\n\u003Cp\u003E\nI think I\u0027ve found a solution...\n\u003C/p\u003E\n\u003Cp\u003E\n1: Subscribe to\u00A0onVesselPrecalcAssign\n\u003C/p\u003E\n\u003Cp\u003E\n2: When it\u0027s triggered, assign your customVesselPrecalc (that inherits from VesselPrecalculate) class to the vessel that is being created\n\u003C/p\u003E\n\u003Cp\u003E\n3: Assign that vessel to your customVesselPrecalc (supposedly this shoudn\u0027t be needed but otherwise precalc.vessel is null)\n\u003C/p\u003E\n\u003Cp\u003E\n4: Do an override of\u00A0MainPhysics and assign the received transform pos and rot before calling base.MainPhysics\n\u003C/p\u003E\n"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2017-06-01T18:07:53Z","Content":"\n\u003Cp\u003E\nYou forgot step 0: Hope that \u003Cabbr title=\u0022Ferram Aerospace Research (mod)\u0022\u003EFAR\u003C/abbr\u003E, Kopernicus or any mods that relies on MFI is not installed.\n\u003C/p\u003E\n"},{"CreatedByName":"Dagger","CreatedById":147766,"CreatedDateTime":"2017-06-02T05:34:25Z","Content":"\n\u003Cp\u003E\nHi \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/57146-sarbian/\u0026amp;do=hovercard\u0022 data-mentionid=\u002257146\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/57146-sarbian/\u0022 rel=\u0022\u0022\u003E@sarbian\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nAnother option that I saw is what principia uses. Would it be more compatible with other mods?\n\u003C/p\u003E\n\u003Cp\u003E\n1- It runs a function in the TimingManager.obsenceearly and sets the vessel.precalc.enabled=false\n\u003C/p\u003E\n\u003Cp\u003E\n2- In another function in TimingManager.Onprecalc it calls the vessel.SetPosition.\u00A0Then it sets precalc.enabled=true and calls precalc.MainPhysics\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222017-06-02T05:36:13Z\u0022 title=\u002206/02/2017 05:36  AM\u0022 data-short=\u00227 yr\u0022\u003EJune 2, 2017\u003C/time\u003E by Dagger\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2017-06-02T07:55:55Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223077164\u0022 data-ipsquote-contentid=\u0022161375\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221496381665\u0022 data-ipsquote-userid=\u0022147766\u0022 data-ipsquote-username=\u0022Dagger\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n2 hours ago, Dagger said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nHi \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/57146-sarbian/\u0026amp;do=hovercard\u0022 data-mentionid=\u002257146\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/57146-sarbian/\u0022 rel=\u0022\u0022\u003E@sarbian\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nAnother option that I saw is what principia uses. Would it be more compatible with other mods?\n\u003C/p\u003E\n\u003Cp\u003E\n1- It runs a function in the TimingManager.obsenceearly and sets the vessel.precalc.enabled=false\n\u003C/p\u003E\n\u003Cp\u003E\n2- In another function in TimingManager.Onprecalc it calls the vessel.SetPosition.\u00A0Then it sets precalc.enabled=true and calls precalc.MainPhysics\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nPrincipia works properly with the other mods so I guess this would work. Good luck dealing with the timing mess however.\n\u003C/p\u003E\n"}]}