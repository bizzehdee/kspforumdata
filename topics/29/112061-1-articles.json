{"TopicId":112061,"ForumId":29,"TopicTitle":"Is there a hook when switching vessels? I need to close my network sockets... somehow.","CreatedByName":"jarpy","CreatedById":145718,"CreatedDateTime":"2015-06-05T14:18:14Z","PageNum":1,"Articles":[{"CreatedByName":"jarpy","CreatedById":145718,"CreatedDateTime":"2015-06-05T14:18:14Z","Content":"Hi,\n\nI have a working prototype for a part that sends and receives over UDP sockets: [https://github.com/jarpy/OpenSpaceKontrol](https://github.com/jarpy/OpenSpaceKontrol)\n\nMy current challenge is that it only works for the first vessel/flight of a game session. After that, I\u0027m still holding the UDP sockets, so the next vessel can\u0027t bind to them.\n\n\u0027Would love to hear any suggestions for closing the sockets when the vehicle is destroyed or switched away. Is there a simple \u0022OnNotFocussed\u0022 kind of method I\u0027m missing? Or do I need to pull back and make my sockets part of a broader (non-part, non-vessel) context.\n\nThanks very much for any help you can offer."},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2015-06-05T21:31:03Z","Content":"[GameEvents.onVesselChange](https://github.com/Crzyrndm/Pilot-Assistant/blob/master/PilotAssistant/PilotAssistantFlightCore.cs#L85) is the event that fires when switching between vessels."},{"CreatedByName":"jarpy","CreatedById":145718,"CreatedDateTime":"2015-06-06T08:40:33Z","Content":"Thanks Crzyrndm.\n\nLooking at your code, I\u0027m starting to get the feeling that mine would be better implemented as a MonoBehaviour rather than a PartModule. So double-thanks for that."},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2015-06-06T13:33:56Z","Content":"Note that .onVesselChange also fires on undocking, losing parts to an accident (overheating/collision/etc) so you\u0027d have to check for that in your code.\n\nHowever, looking at your code, I\u0027d consider moving the actual UDP port binding and associated code to a KSPAddon.Flight class. Having it on a partModule like you do means that even just having two OskModule partModules on the same vessel could get interesting.\n\nA KSPAddon.Flight class only runs once per flight scene load so you don\u0027t have to worry about binding/unbinding sockets and such regardless of what happens during the scene.\n\nYou would still need the OskModule partmodule class to control the vessel, but I think writing the logic for a single KSPAddon.Flight to recognize a vessel switch would be simpler then having multiple partModules trying to decide it between themselves.\n\nD."},{"CreatedByName":"jarpy","CreatedById":145718,"CreatedDateTime":"2015-06-06T23:17:21Z","Content":"Sounds like great advice. I like your split approach, with separation of concerns between \u0022game things\u0022 (commands, telemetry) and \u0022computer things\u0022, (UDP sockets).\n\nThanks for taking the time to look at my code; this is a nice place."}]}