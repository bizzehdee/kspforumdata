{"TopicId":55056,"ForumId":29,"TopicTitle":"Help me understand Mechjeb\u0026#039;s vector math","CreatedByName":"danderson","CreatedById":21416,"CreatedDateTime":"2013-12-03T08:34:27Z","PageNum":1,"Articles":[{"CreatedByName":"danderson","CreatedById":21416,"CreatedDateTime":"2013-12-03T08:34:27Z","Content":"\n\u003Cp\u003EFor my own project, I need a bunch of things that mechjeb\u0027s VesselState helpfully defines - things like a north/east/up coordinate system, velocity vectors in various reference frames, and vectors for various useful attitudes (radial, normal etc.).\u003C/p\u003E\u003Cp\u003EI\u0027m having trouble grokking the definition and use of surfaceRotation. From the code (I\u0027ll assume for the discussion that we\u0027re analyzing a ship in a standard 100km orbit around Kerbin):\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E// Define a coordinate system in which up is away from the planet, east is in the direction of\u003Cbr\u003E// the planet\u0027s rotation, and north points north-ish (while remaining normal to east/up).\u003Cbr\u003Epublic Vector3d east, north, up;\u003Cbr\u003Epublic Vector3d CoM; // Vessel\u0027s center of mass.\u003Cbr\u003E\u003Cbr\u003E// ???\u003Cbr\u003Epublic Quaternion surfaceRotation = Quaternion.LookRotation(north, up);\u003Cbr\u003E\u003Cbr\u003E// Velocity in the universe inertial reference frame.\u003Cbr\u003Epublic Vector3d velocityVesselOrbit = vessel.orbit.GetVel();\u003Cbr\u003E// Velocity in the planet\u0027s rotating reference frame, i.e. velocity relative to the surface.\u003Cbr\u003Epublic Vector3d velocityVesselSurface = velocityVesselOrbit - vessel.mainBody.getRFrmVel(CoM);\u003Cbr\u003E\u003Cbr\u003E// ???\u003Cbr\u003Epublic Vector3d velocityMainBodySurface = rotationSurface * velocityVesselSurface;\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EMy current understanding is that surfaceRotation defines a rotation that would take the world coordinate system and rotate it such that, standing on the point of Kerbin directly below the ship, the Y axis increases away from the surface and X increases with latitude.\u003C/p\u003E\u003Cp\u003EThen, we move on to the velocity vectors. velocityVesselOrbit is the ship\u0027s velocity vector in Unity world coordinates, roughly equivalent to an inertial reference frame anchored to the planet\u0027s center (this ignores the fact that the world origin moves around to maintain floating point precision, but everything is consistent within one physics update).\u003C/p\u003E\u003Cp\u003EvelocityVesselSurface is the ship\u0027s velocity vector in the planet\u0027s rotating reference frame, in other words speed relative to the point of the planet\u0027s surface directly below.\u003C/p\u003E\u003Cp\u003EAnd finally, velocityMainBodySurface... Assuming my understanding of surfaceRotation is correct, I \u003Cem\u003Ethink\u003C/em\u003E that this just transforms the rotating frame velocity vector to a coordinate system where Y is away from the surface, instead of Y being an arbitrary direction defined by Unity.\u003C/p\u003E\u003Cp\u003EIn other words, if you plunk a Jeb down at the point directly below the ship, he would say that the vessel is moving at velocityMainBodySurface relative to him, assuming that X is north and Y is up into the sky, and Z is whatever direction matches unity\u0027s coordinate handedness.\u003C/p\u003E\u003Cp\u003EDoes all this sound correct? velocityMainBodySurface isn\u0027t used in MJ as far as I can tell, so all I have to go on is what I think I understand of quaternions and Unity\u0027s coordinate system.\u003C/p\u003E\n"},{"CreatedByName":"MerlinsMaster","CreatedById":112079,"CreatedDateTime":"2015-03-11T14:56:46Z","Content":"\n\u003Cp\u003EHey, what\u0027s up?\u003C/p\u003E\u003Cp\u003EI see no one has responded to this, but I was wondering if you ever found out the answers to your questions, because I\u0027m trying to figure out a lot of the same stuff.\u003C/p\u003E\n"},{"CreatedByName":"stupid_chris","CreatedById":62017,"CreatedDateTime":"2015-03-11T17:56:15Z","Content":"\n\u003Cp\u003EBecause this vector math involves Quaternion math. And quats are whack. For the general user, its safer not to try to understand them, unless you need to deal with rotations heavily and want to have complete control on what youre doing. Honestly, youre better off assuming this gives out what you need, and using it without understanding exactly what it does. If you really want to know what the heck this is about, I suggest you head to #RO on EsperNet and ask egg about quats.\u003C/p\u003E\n"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2015-03-11T19:22:29Z","Content":"\n\u003Cp\u003EIt would be a better idea to explain what you need that for me to comment on all MJ code \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EPost here or get on the #kspmodders channel on IRC. I am there most evening (GMT\u002B1)\u003C/p\u003E\n"},{"CreatedByName":"MerlinsMaster","CreatedById":112079,"CreatedDateTime":"2015-03-11T22:55:26Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022sarbian\u0022 data-cite=\u0022sarbian\u0022\u003E\u003Cdiv\u003EIt would be a better idea to explain what you need that for me to comment on all MJ code \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003Cp\u003EPost here or get on the #kspmodders channel on IRC. I am there most evening (GMT\u002B1)\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThe short version is that I\u0027m trying to make a space sim in Unity, and I\u0027m trying to figure out how to make the ship do the things you can do in Smart ASS (turning prograde, retrograde, etc), and I\u0027m having very little luck getting help on this particular subject in the Unity forums. So I\u0027d thought I\u0027d take a chance and see if I could find some ideas here. I\u0027ve been looking at the MJ source code, but I\u0027m kind of new to C# and I\u0027m out of my depth I\u0027m afraid.\u003C/p\u003E\n"},{"CreatedByName":"stupid_chris","CreatedById":62017,"CreatedDateTime":"2015-03-12T00:14:32Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022MerlinsMaster\u0022 data-cite=\u0022MerlinsMaster\u0022\u003E\u003Cdiv\u003EThe short version is that I\u0027m trying to make a space sim in Unity, and I\u0027m trying to figure out how to make the ship do the things you can do in Smart ASS (turning prograde, retrograde, etc), and I\u0027m having very little luck getting help on this particular subject in the Unity forums. So I\u0027d thought I\u0027d take a chance and see if I could find some ideas here. I\u0027ve been looking at the MJ source code, but I\u0027m kind of new to C# and I\u0027m out of my depth I\u0027m afraid.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYeah you\u0027re gonna have to understand how Quaternions work then, you can\u0027t work in the dark with that.\u003C/p\u003E\n"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2015-03-12T09:30:44Z","Content":"\n\u003Cp\u003EMJ code could help you a bit buy you have to keep in mind that KSP use multiple coordinate systems and that a lot of MJ code deal with that. That make it quite more complex that a basic Unity Scene where you have only one origin and don\u0027t have to convert everything.\u003C/p\u003E\u003Cp\u003EThe only relevant bit of code from you would be velocityVesselOrbit and velocityVesselSurface. Just ignore velocityMainBodySurface.\u003C/p\u003E\u003Cp\u003EBut I am afraid stupid_chris is right. You will have to understand quaternion at one point if you want to make what you are doing.\u003C/p\u003E\n"},{"CreatedByName":"MerlinsMaster","CreatedById":112079,"CreatedDateTime":"2015-03-13T01:59:00Z","Content":"\n\u003Cp\u003EThose are good points. It\u0027s not surprising that the code is as complex as it is.\u003C/p\u003E\u003Cp\u003EThat being said, I\u0027m very interested in finding out as much as I can about how KSP works under the hood. Are there any places that I can go to where discussions of this subject are taking place?\u003C/p\u003E\n"},{"CreatedByName":"stupid_chris","CreatedById":62017,"CreatedDateTime":"2015-03-13T02:29:13Z","Content":"\n\u003Cp\u003EYes, IRC. We pointed you there twice.\u003C/p\u003E\n"},{"CreatedByName":"MerlinsMaster","CreatedById":112079,"CreatedDateTime":"2015-03-13T05:39:53Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022stupid_chris\u0022 data-cite=\u0022stupid_chris\u0022\u003E\u003Cdiv\u003EYes, IRC. We pointed you there twice.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ECool. Good to know. Thanks, man.\u003C/p\u003E\n"},{"CreatedByName":"ColKlonk","CreatedById":137078,"CreatedDateTime":"2015-04-01T03:00:49Z","Content":"\n\u003Cp\u003EIt\u0027s not that difficult even if you only have high school maths..\u003C/p\u003E\u003Cp\u003EQuarts is just a new name conjured up for doing the same thing - It\u0027s just presented in a different way.\u003C/p\u003E\u003Cp\u003EReading these topics would help\u003C/p\u003E\u003Cp\u003EMaths:- Linear Algebra (same maths different angle - Vector maths will be in here), Basic Co-Ordinate rotations in n-planes (nothing more than Sines, Cosines)\u003C/p\u003E\u003Cp\u003E You can go into Complex Numbers.. but it\u0027s unnecessary for these purposes (use only the real part)\u003C/p\u003E\u003Cp\u003EComputers:- Any books on 3D game development - They all say the same thing.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-04-01T03:03:23Z\u0022 title=\u002204/01/2015 03:03  AM\u0022 data-short=\u00229 yr\u0022\u003EApril 1, 2015\u003C/time\u003E by ColKlonk\u003C/strong\u003E\n\u003C/span\u003E\n"}]}