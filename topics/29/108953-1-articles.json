{"TopicId":108953,"ForumId":29,"TopicTitle":"Modifying maximum ISP and maximum thrust at runtime","CreatedByName":"Pixel of Life","CreatedById":45646,"CreatedDateTime":"2015-05-12T20:39:30Z","PageNum":1,"Articles":[{"CreatedByName":"Pixel of Life","CreatedById":45646,"CreatedDateTime":"2015-05-12T20:39:30Z","Content":"KSP Interstellar\u0027s DT Vista engine can change its ISP on the fly. I\u0027ve been trying to add the same functionality to my plugin ([http://forum.kerbalspaceprogram.com/threads/120969-WIP-Plugin-1-0-2-RealisticNuke-%28More%29-Realistic-Nuclear-Rocket-Engines](https://forum.kerbalspaceprogram.com/threads/120969-WIP-Plugin-1-0-2-RealisticNuke-%28More%29-Realistic-Nuclear-Rocket-Engines)) by importing the LV-N\u0027s atmosphereCurve, assigning it to a FloatCurve variable, then using a for loop to go through all the keys and multiplying them with a value (between 0 and 1, 0 corresponds to no thrust and zero ISP, and 1 is max thrust and max ISP). I then replaced the original atmosphereCurve with the custom one. This is all in the OnFixedUpdate() function, but for some reason it isn\u0027t adjusting the ISP.\n\nHow do I make this work? Also, how do I adjust max thrust at runtime? Source is at [https://github.com/CaptainKorhonen/RealisticNuke](https://github.com/CaptainKorhonen/RealisticNuke) in case someone wants to have a look."},{"CreatedByName":"Nertea","CreatedById":83952,"CreatedDateTime":"2015-05-12T21:15:53Z","Content":"I\u0027m doing it in NFP, you can check out the [VariableIspEngine module](https://github.com/ChrisAdderley/NearFuturePropulsion/blob/master/VariableIspEngine.cs). Should be relatively clear."},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2015-05-13T08:36:56Z","Content":"I don\u0027t understand why you need to do that. The current engines already allow variable ISP with the atmosphereCurve, as you obviously saw.\n\nNetera source shows it but if you did not find it in there : you need to recalculate maxFuelFlow and minFuelFlow"},{"CreatedByName":"FreeThinker","CreatedById":117389,"CreatedDateTime":"2015-05-13T12:38:09Z","Content":"\u003E \n\u003E KSP Interstellar\u0027s DT Vista engine can change its ISP on the fly. I\u0027ve been trying to add the same functionality to my plugin ([http://forum.kerbalspaceprogram.com/threads/120969-WIP-Plugin-1-0-2-RealisticNuke-%28More%29-Realistic-Nuclear-Rocket-Engines](https://forum.kerbalspaceprogram.com/threads/120969-WIP-Plugin-1-0-2-RealisticNuke-%28More%29-Realistic-Nuclear-Rocket-Engines)) by importing the LV-N\u0027s atmosphereCurve, assigning it to a FloatCurve variable, then using a for loop to go through all the keys and multiplying them with a value (between 0 and 1, 0 corresponds to no thrust and zero ISP, and 1 is max thrust and max ISP). I then replaced the original atmosphereCurve with the custom one. This is all in the OnFixedUpdate() function, but for some reason it isn\u0027t adjusting the ISP.\n\u003E How do I make this work? Also, how do I adjust max thrust at runtime? Source is at [https://github.com/CaptainKorhonen/RealisticNuke](https://github.com/CaptainKorhonen/RealisticNuke) in case someone wants to have a look.\n\nIf you would look at the source code of KSPI Extended, you would figure out How I did it.\n\nI suggest you lalso look at the Thermal Noozle, which takes into account static presure"},{"CreatedByName":"Pixel of Life","CreatedById":45646,"CreatedDateTime":"2015-05-13T12:52:09Z","Content":"It looks like the instant I even look at the atmosphereCurve it just breaks the whole thing. The engine has its exhaust flame on all the time, there\u0027s a second flame pointing straight to the side, it doesn\u0027t show up in staging and it loses the collision mesh. The reactor temperature also stops updating. Probably some other problems too.\n\nISPCurve.Add(0f, engine.atmosphereCurve.Evaluate(0f));\n\nISPCurve.Add(1f, engine.atmosphereCurve.Evaluate(1f));\n\nWith these lines in the OnStart() method, the engine is broken. Without them, it works fine. What on earth is going on? These don\u0027t even try to write any data to the ModuleEngines, they just read the values from the atmosphereCurve and store them in another FloatCurve variable.\n\n**Edited \u003Ctime datetime=\u00222015-05-13T12:54:20Z\u0022 title=\u002205/13/2015 12:54  PM\u0022 data-short=\u00229 yr\u0022\u003EMay 13, 2015\u003C/time\u003E by CaptainKorhonen**"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2015-05-13T13:25:03Z","Content":"Hard to tell without seeing the current state of your code. One unrelated thing however, you should not set the part.thermalInternalFlux but use part.AddThermalFlux(kilowatts)"},{"CreatedByName":"Pixel of Life","CreatedById":45646,"CreatedDateTime":"2015-05-13T13:56:30Z","Content":"\u003E \n\u003E Hard to tell without seeing the current state of your code. One unrelated thing however, you should not set the part.thermalInternalFlux but use part.AddThermalFlux(kilowatts)\n\nCode looks exactly like the version on my github but lacks the OnFixedUpdate() method. If I add the two lines from my previous post to the OnStart() medthod it breaks the thing completely. Also, thanks for the tip, I\u0027ll change the heat generation thing.\n\nE: I\u0027ve synced the current version of the code to my github.\n\n**Edited \u003Ctime datetime=\u00222015-05-13T13:59:28Z\u0022 title=\u002205/13/2015 01:59  PM\u0022 data-short=\u00229 yr\u0022\u003EMay 13, 2015\u003C/time\u003E by CaptainKorhonen**"},{"CreatedByName":"Padishar","CreatedById":97386,"CreatedDateTime":"2015-05-13T15:30:17Z","Content":"You have this at the top of your class:\n\nModuleEngines engine = new ModuleEngines();\n\n...so those two lines are accessing the atmosphere curve from an uninitialized ModulesEngines. I suspect that you are getting an exception of some kind which is preventing other code from running correctly...\n\nI would suggest changing that line to say just:\n\nModuleEngines engine = null;\n\n...and in OnStart add a line of code that gets the ModuleEngines part module from the part.\n\n**Edited \u003Ctime datetime=\u00222015-05-13T15:36:43Z\u0022 title=\u002205/13/2015 03:36  PM\u0022 data-short=\u00229 yr\u0022\u003EMay 13, 2015\u003C/time\u003E by Padishar**"},{"CreatedByName":"Pixel of Life","CreatedById":45646,"CreatedDateTime":"2015-05-13T19:41:09Z","Content":"\u003E \n\u003E You have this at the top of your class:\n\u003E ModuleEngines engine = new ModuleEngines();\n\u003E \n\u003E ...so those two lines are accessing the atmosphere curve from an uninitialized ModulesEngines. I suspect that you are getting an exception of some kind which is preventing other code from running correctly...\n\u003E \n\u003E I would suggest changing that line to say just:\n\u003E \n\u003E ModuleEngines engine = null;\n\u003E \n\u003E ...and in OnStart add a line of code that gets the ModuleEngines part module from the part.\n\nThank you! This was pretty much exactly what was wrong with it! I think the engine broke because I created an empty ModuleEngines, fed the ISP values to it and then replaced the original ModuleEngines with the custom one which overwrote ALL the data in the original (apart from the atmosphereCurve), thus completely removing the engine functionality.\n\nSo I got that working, but then the ISP readout got stuck at \u0022NaNs\u0022. Turns out I had completely forgotten to import the max temperature from the engine\u0027s config and as it calculated the reactor\u0027s power level it ended up trying to divide by zero ![:sticktongue:](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue2.gif)\n\nAlso, thanks for the thermal thing, sarbian. I\u0027ll change the heat generation method."},{"CreatedByName":"blowfish","CreatedById":119688,"CreatedDateTime":"2015-05-14T20:29:12Z","Content":"FYI, if you\u0027re trying to set the thrust and Isp of an engine based on proprietary calculations, there is a plugin interface in development designed to do just that. It\u0027s called [SolverEngines](https://github.com/KSP-RO/SolverEngines), and is designed to allow you to use custom solvers which will replace the stock calculations rather than letting them happen and then changing the result."},{"CreatedByName":"Merill","CreatedById":136069,"CreatedDateTime":"2015-05-18T15:14:17Z","Content":"Thrust edit:\n\nwith 0.90: To set the thrust, change maxThrust (and minThrust if you want) in your ModuleEngine\n\nwith 1.0 : To set the thrust, change also maxFuelFlow = maxThrust / (G\\*vacuumIsp) \n\n(again, you can do the same with minfluelflow if minthrust \u003E0)\n\nG is in moduleEngines.g\n\nvacuum thrust can be obtained by something like ModuleEngines.atmosphereCurve.Curve[0].value\n\nSomeone has tried playing with atmChangeFlow? It seem to be a switch between thrust/fuelFlow reference.\n\n**Edited \u003Ctime datetime=\u00222015-05-18T15:38:30Z\u0022 title=\u002205/18/2015 03:38  PM\u0022 data-short=\u00229 yr\u0022\u003EMay 18, 2015\u003C/time\u003E by Merill**"}]}