{"TopicId":151801,"ForumId":29,"TopicTitle":"[SOLVED] Modifying part.attachJoint.Joint.anchor","CreatedByName":"Bonus Eventus","CreatedById":115722,"CreatedDateTime":"2016-11-10T03:16:25Z","PageNum":1,"Articles":[{"CreatedByName":"Bonus Eventus","CreatedById":115722,"CreatedDateTime":"2016-11-10T03:16:25Z","Content":"\n\u003Cp\u003E\nRan into a weird problem when modifying a partJoint.\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint prettyprinted\u0022\u003E\n\u003Cspan class=\u0022com\u0022\u003E//Inside of a method\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n\u003C/span\u003E\u003Cspan\u003EVector3\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E v \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E=\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Enew\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan\u003EVector3\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan class=\u0022lit\u0022\u003E0\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E,\u003C/span\u003E\u003Cspan class=\u0022lit\u0022\u003E0.6f\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E,\u003C/span\u003E\u003Cspan class=\u0022lit\u0022\u003E0\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E);\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n\n\u003C/span\u003E\u003Cspan\u003EVector3\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E temp_0 \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E=\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E p_0pos \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E\u002B\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E v\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n\u003C/span\u003E\u003Cspan\u003EVector3\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E temp_1 \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E=\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E p_1pos \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E\u002B\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E v\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n\np_0\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003EattachJoint\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan\u003EJoint\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Eanchor \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E=\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E temp_0\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\np_1\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003EattachJoint\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan\u003EJoint\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Eanchor \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E=\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E temp_1\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E;\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nThat method is called from a gui event and it works really well, just as expected.\n\u003C/p\u003E\n\u003Cp\u003E\nHowever, I thought the anchor position would be persistent, but it\u0027s not. OK no big deal, I can just write a Vector3 to a persistent string. Problem is\u003Cbr\u003E\nwhen I try to update the Joint.anchor from OnStart() it throws a null ref exception. Running same code from inside FixedUpdate will work, but one\u003Cbr\u003E\ncan see the part move into place as the state is set. Obviously not desirable.\u003Cbr\u003E\u003Cbr\u003E\nI\u0027m rather stuck. Anyone have any clue how I can save the state of the anchor?\u00A0\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-11-11T23:04:52Z\u0022 title=\u002211/11/2016 11:04  PM\u0022 data-short=\u00227 yr\u0022\u003ENovember 11, 2016\u003C/time\u003E by Bonus Eventus\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2016-11-10T12:53:57Z","Content":"\n\u003Cp\u003E\nYou should do your joint config when the \u003Cspan\u003EonPartJointSet\u003C/span\u003E GameEvent is triggered.\n\u003C/p\u003E\n"},{"CreatedByName":"Bonus Eventus","CreatedById":115722,"CreatedDateTime":"2016-11-10T14:02:58Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222845591\u0022 data-ipsquote-contentid=\u0022151801\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221478782437\u0022 data-ipsquote-userid=\u002257146\u0022 data-ipsquote-username=\u0022sarbian\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nOn 11/10/2016 at 4:53 AM, sarbian said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nYou should do your joint config when the \u003Cspan\u003EonPartJointSet\u003C/span\u003E GameEvent is triggered.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nExcellent, had a feeling you would know \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\n\u003Cstrong\u003EEDIT: \u003C/strong\u003E\u003Cbr\u003E\nThe GameEvent onPartJointSet fires and the state is set as expected. Unfortunately, it fires\u00A0around the end of the first update frame.\u003Cbr\u003E\nNothing I can do about that. Wondering how vessels save positional data in sfs. There must be a way to alter the joint placement\u003Cbr\u003E\nonSave, otherwise how does KJR or IR keep state?\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cstrong\u003EUDATE:\u003C/strong\u003E\u003Cbr\u003E\nI experimented with overwriting the config for the part, but apparently that\u0027s not where the vessel data is being loaded from. Wised up,\u003Cbr\u003E\nnow poking around in ShipConstruct and ShipConstruction.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cstrong\u003EUPDATE2:\u003C/strong\u003E\u003Cbr\u003E\nI found this post in \u0022Help a fellow plugin dev\u0022\u00A0\n\u003C/p\u003E\n\u003Ciframe data-embedcontent=\u0022\u0022 frameborder=\u00220\u0022 src=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/7542-the-official-unoffical-quothelp-a-fellow-plugin-developerquot-thread/\u0026amp;do=embed\u0026amp;comment=2826606\u0026amp;embedComment=2826606\u0026amp;embedDo=findComment\u0022\u003E\u003C/iframe\u003E\n\u003Cp\u003E\nThanks to IgorZ I was able to overwrite the Part\u0026gt;Position node of the sfs file with onProtoPartSnapShot which is an event fired for each part of a vessel when vessel.BackupVessel() is called.\u003Cbr\u003E\nSo, the bottom line is, you can move physically simulated parts around (and all of their children)\u00A0by animating or changing the vector3 of an attachJoint.Joint.anchor, and then save state by\u003Cbr\u003E\ninjecting code after BackupVessel is finished saving. Only caveat is that iva does not move with the part when the anchor is update. Not a big deal, since you can find out easily which parts\u003Cbr\u003E\nof the children have an IVA and then move them.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-11-11T23:04:24Z\u0022 title=\u002211/11/2016 11:04  PM\u0022 data-short=\u00227 yr\u0022\u003ENovember 11, 2016\u003C/time\u003E by Bonus Eventus\u003C/strong\u003E\n\u003C/span\u003E\n"}]}