{"TopicId":160424,"ForumId":29,"TopicTitle":"Adjusting part/vessel mass in flight","CreatedByName":"TiktaalikDreaming","CreatedById":136290,"CreatedDateTime":"2017-05-09T20:38:08Z","PageNum":1,"Articles":[{"CreatedByName":"TiktaalikDreaming","CreatedById":136290,"CreatedDateTime":"2017-05-09T20:38:08Z","Content":"\n\u003Cp\u003E\nI\u0027m maintaining the USAF Orion mod, and it\u0027s been noticed that vessel mass is not decreasing as pulse units are expended. \u00A0I chucked in some diagnostic logging and what seems to be happening is the parts (essentially custom fuel tanks) are decreasing in mass, but the vessel isn\u0027t.\n\u003C/p\u003E\n\u003Cp\u003E\nSo, adjusting the mass of a pulse unit magazine is done with this super complex formula;\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0 \u00A0 \u00A0 \u00A0 \u00A0 \u00A0 \u00A0 \u00A0 \u00A0 \u00A0 this.mass = (this.bombStockpile * this.bombMass) \u002B this.dryMass ;\u003Cbr\u003E\n\u00A0 \u00A0 \u00A0 \u00A0 \u00A0 \u00A0 \u00A0 \u00A0 \u00A0 \u00A0 Debug.Log(\u0022[USAFOrion] adjusted mass of magazine \u0022 \u002B this.bombStockpile \u002B \u0022 to \u0022 \u002B this.mass);\n\u003C/p\u003E\n\u003Cp\u003E\nWith my little debug line. \u00A0And mass (and bombStockpile) decrease as the units are used up.\n\u003C/p\u003E\n\u003Cp\u003E\nBut when I add in;\n\u003C/p\u003E\n\u003Cp\u003E\nDebug.Log(\u0022[USAFOrion] Nominally this should have updated the vessel mass. \u00A0It now shows : \u0022 \u002B vessel.totalMass);\n\u003C/p\u003E\n\u003Cp\u003E\nthe vessel doesn\u0027t change mass at all. \u00A0Even if I run\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0 \u00A0 \u00A0 \u00A0 \u00A0 \u00A0 vessel.UpdateResourceSets();\u003Cbr\u003E\n\u00A0 \u00A0 \u00A0 \u00A0 \u00A0 \u00A0 base.onPartFixedUpdate () ;\n\u003C/p\u003E\n\u003Cp\u003E\nwhich would seem to be the sort of thing you do to recalc vessel things.\n\u003C/p\u003E\n\u003Cp\u003E\nSo,\n\u003C/p\u003E\n\u003Cp\u003E\nA: Am I adjusting the part mass at all, or just some value that doesn\u0027t actually come into play anywhere?\u003Cbr\u003E\nB: If (A:), is there a way of triggering KSP to recalculate mass (and \u003Cabbr title=\u0022Center of Mass\u0022\u003ECoM\u003C/abbr\u003E) of the vessel?\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2017-05-10T05:45:44Z","Content":"\n\u003Cp\u003E\nDon\u0027t adjust part mass directly (since 1.0 if memory serves). You need to implement the\u00A0IPartMassModifier interface (alternatively just use a resource?).\n\u003C/p\u003E\n\u003Cp\u003E\nExample implementation:\u00A0\u003Cbr\u003E\u003Ca href=\u0022https://github.com/Crzyrndm/B9-PWings-Fork/blob/master/B9%20PWings%20Fork/WingProcedural.cs\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/Crzyrndm/B9-PWings-Fork/blob/master/B9 PWings Fork/WingProcedural.cs\u003C/a\u003E\u003Cbr\u003E\u003Ca href=\u0022https://github.com/Crzyrndm/B9-PWings-Fork/blob/master/B9%20PWings%20Fork/WingProcedural.cs#L3312-L3322\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/Crzyrndm/B9-PWings-Fork/blob/master/B9 PWings Fork/WingProcedural.cs#L3312-L3322\u003C/a\u003E\n\u003C/p\u003E\n"},{"CreatedByName":"TiktaalikDreaming","CreatedById":136290,"CreatedDateTime":"2017-05-10T06:48:26Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223051697\u0022 data-ipsquote-contentid=\u0022160424\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221494395144\u0022 data-ipsquote-userid=\u002292871\u0022 data-ipsquote-username=\u0022Crzyrndm\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n9 minutes ago, Crzyrndm said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nDon\u0027t adjust part mass directly (since 1.0 if memory serves). You need to implement the\u00A0IPartMassModifier interface (alternatively just use a resource?).\n\u003C/p\u003E\n\u003Cp\u003E\nExample implementation:\u00A0\u003Cbr\u003E\u003Ca href=\u0022https://github.com/Crzyrndm/B9-PWings-Fork/blob/master/B9%20PWings%20Fork/WingProcedural.cs\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/Crzyrndm/B9-PWings-Fork/blob/master/B9 PWings Fork/WingProcedural.cs\u003C/a\u003E\u003Cbr\u003E\u003Ca href=\u0022https://github.com/Crzyrndm/B9-PWings-Fork/blob/master/B9%20PWings%20Fork/WingProcedural.cs#L3312-L3322\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/Crzyrndm/B9-PWings-Fork/blob/master/B9 PWings Fork/WingProcedural.cs#L3312-L3322\u003C/a\u003E\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nIf I was working from scratch I think I would use a resource without a second thought, and just make sure it\u0027s only ever used in discrete amounts. \u00A0But there\u0027s a lot of code already in place, so I\u0027m trying to just get the existing stuff working.\n\u003C/p\u003E\n\u003Cp\u003E\nHaving a look now at the IPartMassModifier.\n\u003C/p\u003E\n\u003Cp\u003E\nThanks\n\u003C/p\u003E\n"},{"CreatedByName":"Shadowmage","CreatedById":138730,"CreatedDateTime":"2017-05-10T18:22:08Z","Content":"\n\u003Cp\u003E\nIndeed, the IPartMassModifier is the way to do it.\n\u003C/p\u003E\n\u003Cp\u003E\nIf you need any pointers on exact implementation, feel free to ping/PM me.\u00A0 I\u0027m more than a bit familiar with its use and setup.\n\u003C/p\u003E\n"},{"CreatedByName":"TiktaalikDreaming","CreatedById":136290,"CreatedDateTime":"2017-05-10T23:17:45Z","Content":"\n\u003Cp\u003E\nThis, \u00A0try something, compile, reload ksp, look at logs, repeat cycle is reminding me of that module I need that let\u0027s me reload modules without closing the game. Jeebus.\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"TiktaalikDreaming","CreatedById":136290,"CreatedDateTime":"2017-05-15T10:39:27Z","Content":"\n\u003Cp\u003E\nI\u0027m suspecting I\u0027ll need to not be extending Part, but PartModule to make this work. \u00A0rewrite time coming up. \u00A0:-(\n\u003C/p\u003E\n"}]}