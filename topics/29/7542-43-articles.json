{"TopicId":7542,"ForumId":29,"TopicTitle":"The official unoffical \u0026quot;help a fellow plugin developer\u0026quot; thread","CreatedByName":"Cephei","CreatedById":2555,"CreatedDateTime":"2012-03-04T10:02:40Z","PageNum":43,"Articles":[{"CreatedByName":"stupid_chris","CreatedById":62017,"CreatedDateTime":"2014-06-12T19:33:26Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Ippo\u0022 data-cite=\u0022Ippo\u0022\u003E\u003Cdiv\u003EI did notice \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif\u0022 alt=\u0022:P\u0022\u003E\u003Cp\u003EAnyway, I wanted to read in the full list of hired and applicant kerbals, but that was before I found out the proper way to get them using HighLogic \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif\u0022 alt=\u0022:P\u0022\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ESystem.IO and System.XML have been allowed again a few versions ago indeed. AFAIK, the only forbidden namespace right now is System.Diagnostics.Process\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-06-12T19:36:06Z\u0022 title=\u002206/12/2014 07:36  PM\u0022 data-short=\u002210 yr\u0022\u003EJune 12, 2014\u003C/time\u003E by stupid_chris\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Ippo","CreatedById":107018,"CreatedDateTime":"2014-06-12T20:33:57Z","Content":"\n\u003Cp\u003EI\u0027m having some problems with reflection. I\u0027m trying to find all the types that have an attribute that I define. I am using this code:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E        private void FindAllCrewDataGenerators()\u003Cbr\u003E        {\u003Cbr\u003E            var generators = from type in AssemblyLoader.loadedTypes\u003Cbr\u003E                             where Attribute.IsDefined(type, typeof(CrewDataGenerator))\u003Cbr\u003E                             select type;\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E            this.Generators = generators.ToList();\u003Cbr\u003E        }\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003Ewhere CrewDataGenerator is my custom attribute.\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022text-decoration:line-through;\u0022\u003EHowever, with this method defined my assembly won\u0027t load. In the output log I find this:\u003C/span\u003E\u003C/p\u003E\u003Cp\u003EI asked in the IRC channel: can\u0027t use linq, need to target .NET 3.5. Thank you! \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-06-12T20:40:58Z\u0022 title=\u002206/12/2014 08:40  PM\u0022 data-short=\u002210 yr\u0022\u003EJune 12, 2014\u003C/time\u003E by Ippo\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Echo 8 \u00C3\u0192\u00E2\u20AC\u00B0R\u00C3\u0192\u00E2\u201A\u00AC","CreatedById":37973,"CreatedDateTime":"2014-06-12T22:44:06Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Ippo\u0022 data-cite=\u0022Ippo\u0022\u003E\u003Cdiv\u003EI\u0027m having some problems with reflection. I\u0027m trying to find all the types that have an attribute that I define. I am using this code:\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E        private void FindAllCrewDataGenerators()\u003Cbr\u003E        {\u003Cbr\u003E            var generators = from type in AssemblyLoader.loadedTypes\u003Cbr\u003E                             where Attribute.IsDefined(type, typeof(CrewDataGenerator))\u003Cbr\u003E                             select type;\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E            this.Generators = generators.ToList();\u003Cbr\u003E        }\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003Ewhere CrewDataGenerator is my custom attribute.\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022text-decoration:line-through;\u0022\u003EHowever, with this method defined my assembly won\u0027t load. In the output log I find this:\u003C/span\u003E\u003C/p\u003E\u003Cp\u003EI asked in the IRC channel: can\u0027t use linq, need to target .NET 3.5. Thank you! \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EErm, LINQ was introduced with .Net 3.5.\u003C/p\u003E\n"},{"CreatedByName":"Ippo","CreatedById":107018,"CreatedDateTime":"2014-06-12T23:19:51Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Echo 8 \u00C3\u0192\u00E2\u20AC\u00B0R\u00C3\u0192\u00E2\u201A\u00AC\u0022 data-cite=\u0022Echo 8 \u00C3\u0192\u00E2\u20AC\u00B0R\u00C3\u0192\u00E2\u201A\u00AC\u0022\u003E\u003Cdiv\u003EErm, LINQ was introduced with .Net 3.5.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EGood luck convincing the Assembly Loader of that. ^^\u003C/p\u003E\n"},{"CreatedByName":"Echo 8 \u00C3\u0192\u00E2\u20AC\u00B0R\u00C3\u0192\u00E2\u201A\u00AC","CreatedById":37973,"CreatedDateTime":"2014-06-13T00:44:09Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Ippo\u0022 data-cite=\u0022Ippo\u0022\u003E\u003Cdiv\u003EGood luck convincing the Assembly Loader of that. ^^\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EWhy can\u0027t you use LINQ \u003Cspan style=\u0022text-decoration:underline;\u0022\u003EAND\u003C/span\u003E target .Net 3.5 at the same time? I don\u0027t have a handy C# project to test with, but I compiled and ran the following C\u002B\u002B/CLI code just fine:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Eusing namespace System::Linq;\u003Cbr\u003E\u003Cbr\u003Ebool attfilter(System::Type ^t);\u003Cbr\u003E\u003Cbr\u003Ebool attfilter(System::Type ^t) {\u003Cbr\u003E\treturn System::Attribute::IsDefined(t, KSPAddon::typeid);\u003Cbr\u003E}\u003Cbr\u003E\u003Cbr\u003Evoid Events::Start(void) {\u003Cbr\u003E\u003Cbr\u003E\tPDebug::Log(\u0022Events::Start()\u0022);\u003Cbr\u003E\tauto generators = Enumerable::Where(AssemblyLoader::loadedTypes, gcnew System::Func\u0026lt;System::Type ^, bool\u0026gt;(\u0026amp;attfilter));\u003Cbr\u003E\tauto Generators = Enumerable::ToList(generators);\u003Cbr\u003E\tfor each (auto g in Generators) {\u003Cbr\u003E\t\tPDebug::Log(g-\u0026gt;FullName);\u003Cbr\u003E\t}\u003Cbr\u003E\u003Cbr\u003E}\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n"},{"CreatedByName":"stupid_chris","CreatedById":62017,"CreatedDateTime":"2014-06-13T04:40:26Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Echo 8 \u00C3\u0192\u00E2\u20AC\u00B0R\u00C3\u0192\u00E2\u201A\u00AC\u0022 data-cite=\u0022Echo 8 \u00C3\u0192\u00E2\u20AC\u00B0R\u00C3\u0192\u00E2\u201A\u00AC\u0022\u003E\u003Cdiv\u003EWhy can\u0027t you use LINQ \u003Cspan style=\u0022text-decoration:underline;\u0022\u003EAND\u003C/span\u003E target .Net 3.5 at the same time? I don\u0027t have a handy C# project to test with, but I compiled and ran the following C\u002B\u002B/CLI code just fine:\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Eusing namespace System::Linq;\u003Cbr\u003E\u003Cbr\u003Ebool attfilter(System::Type ^t);\u003Cbr\u003E\u003Cbr\u003Ebool attfilter(System::Type ^t) {\u003Cbr\u003E\treturn System::Attribute::IsDefined(t, KSPAddon::typeid);\u003Cbr\u003E}\u003Cbr\u003E\u003Cbr\u003Evoid Events::Start(void) {\u003Cbr\u003E\u003Cbr\u003E\tPDebug::Log(\u0022Events::Start()\u0022);\u003Cbr\u003E\tauto generators = Enumerable::Where(AssemblyLoader::loadedTypes, gcnew System::Func\u0026lt;System::Type ^, bool\u0026gt;(\u0026amp;attfilter));\u003Cbr\u003E\tauto Generators = Enumerable::ToList(generators);\u003Cbr\u003E\tfor each (auto g in Generators) {\u003Cbr\u003E\t\tPDebug::Log(g-\u0026gt;FullName);\u003Cbr\u003E\t}\u003Cbr\u003E\u003Cbr\u003E}\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYou should be targetting .NET 3.5 anyway because KSP is built on that. Anyway, AssemblyLoader will often fail to load plugins using LINQ and that target .NET any higher than 3.5. It\u0027s more of a simple fact than anything else.\u003C/p\u003E\n"},{"CreatedByName":"Echo 8 \u00C3\u0192\u00E2\u20AC\u00B0R\u00C3\u0192\u00E2\u201A\u00AC","CreatedById":37973,"CreatedDateTime":"2014-06-13T07:12:14Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022stupid_chris\u0022 data-cite=\u0022stupid_chris\u0022\u003E\u003Cdiv\u003EYou should be targetting .NET 3.5 anyway because KSP is built on that. Anyway, AssemblyLoader will often fail to load plugins using LINQ and that target .NET any higher than 3.5. It\u0027s more of a simple fact than anything else.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI\u0027m going to have to investigate this at some point. LINQ in KSP plugins, that is. While I haven\u0027t used LINQ itself, I have used the same classes and methods that LINQ is built on with no problems.\u003C/p\u003E\u003Cp\u003EEDIT:\u003C/p\u003E\u003Cp\u003EIppo, would you mind posting a zip containing your project which crashes KSP? My quick and dirty test plugin loads fine, so I don\u0027t know if it\u0027s because the code is too trivial to trigger any problems or if I set project settings out of habit which allow me to use LINQ without any problems.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-06-13T07:50:12Z\u0022 title=\u002206/13/2014 07:50  AM\u0022 data-short=\u002210 yr\u0022\u003EJune 13, 2014\u003C/time\u003E by Echo 8 \u00C3\u0192\u00E2\u20AC\u00B0R\u00C3\u0192\u00E2\u201A\u00AC\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Ippo","CreatedById":107018,"CreatedDateTime":"2014-06-13T08:36:16Z","Content":"\n\u003Cp\u003EI\u0027m afraid I don\u0027t have it anymore, I didn\u0027t commit it until I got it to load.\u003C/p\u003E\u003Cp\u003EAnyway, it doesn\u0027t crash KSP: it just won\u0027t be loaded. So KSP works just fine, but your plugin is ignored.\u003C/p\u003E\u003Cp\u003EUsing .NET 4.5 the assembly won\u0027t load it at all with the code in my post above;\u003C/p\u003E\u003Cp\u003EUsing .NET 3.5 it gets loaded: but for some reason, it doesn\u0027t work (as in, it finds no types with my custom attributes even when I\u0027m sure there are);\u003C/p\u003E\u003Cp\u003EUsing .NET 3.5 and refactoring that neat linq to two hideous foreach loops makes it work as expected:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E        private void FindAllCrewDataGenerators()\u003Cbr\u003E        {\u003Cbr\u003E            this.Generators = new List\u0026lt;Type\u0026gt;();\u003Cbr\u003E            foreach (AssemblyLoader.LoadedAssembly asm in AssemblyLoader.loadedAssemblies)\u003Cbr\u003E                foreach (Type t in asm.assembly.GetTypes())\u003Cbr\u003E                    if (Attribute.IsDefined(t, typeof(CrewDataGenerator)))\u003Cbr\u003E                        this.Generators.Add(t);\u003Cbr\u003E        }\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n"},{"CreatedByName":"Echo 8 \u00C3\u0192\u00E2\u20AC\u00B0R\u00C3\u0192\u00E2\u201A\u00AC","CreatedById":37973,"CreatedDateTime":"2014-06-13T09:05:07Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Ippo\u0022 data-cite=\u0022Ippo\u0022\u003E\u003Cdiv\u003EI\u0027m afraid I don\u0027t have it anymore, I didn\u0027t commit it until I got it to load.\u003Cp\u003EAnyway, it doesn\u0027t crash KSP: it just won\u0027t be loaded. So KSP works just fine, but your plugin is ignored.\u003C/p\u003E\u003Cp\u003EUsing .NET 4.5 the assembly won\u0027t load it at all with the code in my post above;\u003C/p\u003E\u003Cp\u003EUsing .NET 3.5 it gets loaded: but for some reason, it doesn\u0027t work (as in, it finds no types with my custom attributes even when I\u0027m sure there are);\u003C/p\u003E\u003Cp\u003EUsing .NET 3.5 and refactoring that neat linq to two hideous foreach loops makes it work as expected:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E        private void FindAllCrewDataGenerators()\u003Cbr\u003E        {\u003Cbr\u003E            this.Generators = new List\u0026lt;Type\u0026gt;();\u003Cbr\u003E            foreach (AssemblyLoader.LoadedAssembly asm in AssemblyLoader.loadedAssemblies)\u003Cbr\u003E                foreach (Type t in asm.assembly.GetTypes())\u003Cbr\u003E                    if (Attribute.IsDefined(t, typeof(CrewDataGenerator)))\u003Cbr\u003E                        this.Generators.Add(t);\u003Cbr\u003E        }\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EAs for your case of using .Net 3.5 but finding no types, it might be a case of AssemblyLoader.loadedTypes not being populated with what you think it is. At least in the flight scene for me, AssemblyLoader.loadedTypes just contains Part, Partmodule, InternalModule and ScenarioModule.\u003C/p\u003E\n"},{"CreatedByName":"Ippo","CreatedById":107018,"CreatedDateTime":"2014-06-13T09:11:40Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Echo 8 \u00C3\u0192\u00E2\u20AC\u00B0R\u00C3\u0192\u00E2\u201A\u00AC\u0022 data-cite=\u0022Echo 8 \u00C3\u0192\u00E2\u20AC\u00B0R\u00C3\u0192\u00E2\u201A\u00AC\u0022\u003E\u003Cdiv\u003EAs for your case of using .Net 3.5 but finding no types, it might be a case of AssemblyLoader.loadedTypes not being populated with what you think it is. At least in the flight scene for me, AssemblyLoader.loadedTypes just contains Part, Partmodule, InternalModule and ScenarioModule.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYou are probably right. I didn\u0027t give it too much though: \u0022is it working? Ok I\u0027m switching to the foreach\u0022 \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Echo 8 \u00C3\u0192\u00E2\u20AC\u00B0R\u00C3\u0192\u00E2\u201A\u00AC","CreatedById":37973,"CreatedDateTime":"2014-06-13T09:47:31Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Ippo\u0022 data-cite=\u0022Ippo\u0022\u003E\u003Cdiv\u003EYou are probably right. I didn\u0027t give it too much though: \u0022is it working? Ok I\u0027m switching to the foreach\u0022 \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EJust for kicks, I tried to write your nested foreach loops (with KSPAddon instead of your attribute) with LINQ instead:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Eprivate void FindAllCrewDataGenerators()\u003Cbr\u003E{\u003Cbr\u003E\u003Cbr\u003E    var generators = from type in (\u003Cbr\u003E                             (from asm in AssemblyLoader.loadedAssemblies\u003Cbr\u003E                             select asm.assembly.GetTypes().AsEnumerable())\u003Cbr\u003E                                     .Aggregate((first, second) =\u0026gt; first.Concat(second)))\u003Cbr\u003E                     where Attribute.IsDefined(type, typeof(KSPAddon))\u003Cbr\u003E                     select type;\u003Cbr\u003E\u003Cbr\u003E    this.Generators = generators.ToList();\u003Cbr\u003E\u003Cbr\u003E}\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EThe nested loops is more efficient and easier to understand, IMO.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-06-13T09:50:48Z\u0022 title=\u002206/13/2014 09:50  AM\u0022 data-short=\u002210 yr\u0022\u003EJune 13, 2014\u003C/time\u003E by Echo 8 \u00C3\u0192\u00E2\u20AC\u00B0R\u00C3\u0192\u00E2\u201A\u00AC\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Ippo","CreatedById":107018,"CreatedDateTime":"2014-06-13T10:20:14Z","Content":"\n\u003Cp\u003EYou are probably right... but I\u0027m a fan of functional programming so LINQ gives me a raging \u003Cspan style=\u0022text-decoration:line-through;\u0022\u003E***\u003C/span\u003E enthusiasm and I would use it for everything ever \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 alt=\u0022:D\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-06-15T04:27:17Z","Content":"\n\u003Cp\u003EAlright.\u003C/p\u003E\u003Cp\u003ETo interface with my action groups mod, I\u0027m trying to work with the Action Group Panels that KSP shows down the left side of the screen when you go to Action Groups mode in the editor.\u003C/p\u003E\u003Cp\u003EHowever, I\u0027m hitting a brick wall.\u003C/p\u003E\u003Cp\u003EHas anyone done anything like this before?\u003C/p\u003E\u003Cp\u003EI\u0027m currently attempting 2 things:\u003C/p\u003E\u003Cp\u003E1) Detect when an action is added or removed (mouse click detection maybe?)\u003C/p\u003E\u003Cp\u003E2) Show/hide the panel while staying in Action groups mode.\u003C/p\u003E\u003Cp\u003EI did manage to find the EditorActionGroups class which has a groupActionList field of type UIScrollList. However, it looks like that is a private property and I can\u0027t do anything with it, not even read its contents.\u003C/p\u003E\u003Cp\u003ETo hide the panels, I found EditorPanls with a float of actionsPanelWidth that I can set (according to Visual Studio), but this seems to do nothing.\u003C/p\u003E\u003Cp\u003EDoes anyone have any ideas for how to do this, or where I should start investigating?\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n"},{"CreatedByName":"nli2work","CreatedById":106805,"CreatedDateTime":"2014-06-15T07:08:08Z","Content":"\n\u003Cp\u003ESo I got a part working in game... everything looks and functions as intended\u003C/p\u003E\u003Cp\u003Ebut in debug window this error comes up every update.\u003C/p\u003E\u003Cp\u003E[Exception]: MissingFieldException: Field \u0027.Part.attachJoint\u0027 not found.\u003C/p\u003E\u003Cp\u003Ewhat is it? can I fix it?\u003C/p\u003E\n"},{"CreatedByName":"fudgemonster","CreatedById":12946,"CreatedDateTime":"2014-06-15T14:29:28Z","Content":"\n\u003Cp\u003EQuick question: How do I make my craft uncontrollable when a specific resource runs out?\u003C/p\u003E\u003Cp\u003EI\u0027ve made new resources based on the layout of ElectricCharge in ResourcesGeneric, and added them to the stock command pods. The resources show up on right-click and deplete slowly as expected (I added a drain rate to the parts using the new resources). But when they run out, it doesn\u0027t kill the ships control. It\u0027s based on ElectricCharge, and it uses ModuleGenerator to deplete. Would I need a custom plugin to make the ship uncontrollable? Or am I just missing something simple?\u003C/p\u003E\u003Cp\u003EIf you would like the code then I\u0027ll put it up.\u003C/p\u003E\u003Cp\u003EAny help would be appreciated (i feel foolish i dont know this =P)\u003C/p\u003E\n"},{"CreatedByName":"Ippo","CreatedById":107018,"CreatedDateTime":"2014-06-15T14:32:00Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022fudgemonster\u0022 data-cite=\u0022fudgemonster\u0022\u003E\u003Cdiv\u003E...\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ELook for the InputLockManager class: you can use it to disable the controls. I haven\u0027t used it myself though, so you\u0027ll have to experiment a bit to find out what you want to lock exactly.\u003C/p\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2014-06-15T17:46:40Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Diazo\u0022 data-cite=\u0022Diazo\u0022\u003E\u003Cdiv\u003ETo interface with my action groups mod, I\u0027m trying to work with the Action Group Panels that KSP shows down the left side of the screen when you go to Action Groups mode in the editor.\u003Cp\u003E...\u003C/p\u003E\u003Cp\u003EI\u0027m currently attempting 2 things:\u003C/p\u003E\u003Cp\u003E1) Detect when an action is added or removed (mouse click detection maybe?)\u003C/p\u003E\u003Cp\u003E2) Show/hide the panel while staying in Action groups mode.\u003C/p\u003E\u003Cp\u003EI did manage to find the EditorActionGroups class which has a groupActionList field of type UIScrollList. However, it looks like that is a private property and I can\u0027t do anything with it, not even read its contents.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ELooks like the EzGUI stuff is all in Assembly-CSharp-firstpass DLL. Here\u0027s something I put together that should help with both your goals:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E[KSPAddon(KSPAddon.Startup.EditorAny, false)]\u003Cbr\u003Epublic class ActionGroupEditorTest : MonoBehaviour\u003Cbr\u003E{\u003Cbr\u003E\u003Cbr\u003E    void Start()\u003Cbr\u003E    {\u003Cbr\u003E        var panel = EditorPanels.Instance.actions;\u003Cbr\u003E\u003Cbr\u003E        // fired when the user selects a different part and selection list changes\u003Cbr\u003E        //   This list appears to be the rightmost list, containing possible actions\u003Cbr\u003E        //   note: the \u0022reset\u0022 button is included in this list once an item has been moved\u003Cbr\u003E        //         out of this list\u003Cbr\u003E        EditorActionGroups.Instance.partActionList.AddValueChangedDelegate(OnPartActionListChange);\u003Cbr\u003E\u003Cbr\u003E        // This is the left-most list, listing possible action groups\u003Cbr\u003E        EditorActionGroups.Instance.actionGroupList.AddValueChangedDelegate(OnActionGroupListChange);\u003Cbr\u003E\u003Cbr\u003E        // This is the middle list. Note that the name of the part \u003Cbr\u003E        // is included as an item. \u003Cbr\u003E        EditorActionGroups.Instance.groupActionsList.AddValueChangedDelegate(OnGroupActionsListChange);\u003Cbr\u003E\u003Cbr\u003E        // Seems to be fired when the panel state changes (opens, closes)\u003Cbr\u003E        // also triggered by calls in ShowPanel\u003Cbr\u003E        panel.AddValueChangedDelegate(OnChanged);\u003Cbr\u003E    }\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E    public void ShowPanel(bool visible = true)\u003Cbr\u003E    {\u003Cbr\u003E        if (EditorLogic.fetch.editorScreen == EditorLogic.EditorScreen.Actions)\u003Cbr\u003E            if (!visible)\u003Cbr\u003E            {\u003Cbr\u003E                // Dismiss causes transition; this hides panel immediately\u003Cbr\u003E                EditorPanels.Instance.panelManager.DismissImmediate();\u003Cbr\u003E\u003Cbr\u003E                // note: stays in action group edit mode\u003Cbr\u003E            }\u003Cbr\u003E            else\u003Cbr\u003E            {\u003Cbr\u003E                //EditorPanels.Instance.ShowActionGroups(); doesn\u0027t work \u003Cbr\u003E                EditorPanels.Instance.panelManager.BringInImmediate(EditorPanels.Instance.actions); // works\u003Cbr\u003E            }\u003Cbr\u003E\u003Cbr\u003E    }\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E    // Invoked when actions panel changes (made visible or invisible); \u003Cbr\u003E    // called AFTER transition is complete\u003Cbr\u003E    public void OnChanged(IUIObject obj)\u003Cbr\u003E    {\u003Cbr\u003E        Log.Error(\u0022OnChanged delegate! {0}\u0022, obj.name);\u003Cbr\u003E\u003Cbr\u003E        Log.Write(\u0022Action editor {0}\u0022, EditorLogic.fetch.editorScreen == EditorLogic.EditorScreen.Actions ? \u0022activated\u0022 : \u0022deactivated\u0022);\u003Cbr\u003E    }\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E    /// \u0026lt;summary\u0026gt;\u003Cbr\u003E    /// Invoked when an action is added to the middle list.\u003Cbr\u003E    /// \u0026lt;/summary\u0026gt;\u003Cbr\u003E    /// \u0026lt;param name=\u0022obj\u0022\u0026gt;\u0026lt;/param\u0026gt;\u003Cbr\u003E    public void OnGroupActionsListChange(IUIObject obj)\u003Cbr\u003E    {\u003Cbr\u003E        Log.Error(\u0022OnGroupActionsListChange: {0}\u0022, obj.name);\u003Cbr\u003E\u003Cbr\u003E        for (int i = 0; i \u0026lt; EditorActionGroups.Instance.groupActionsList.Count; \u002B\u002Bi)\u003Cbr\u003E        {\u003Cbr\u003E            var item = EditorActionGroups.Instance.groupActionsList.GetItem(i);\u003Cbr\u003E\u003Cbr\u003E            Log.Write(\u0022groupActionsList item {0} = {1}\u0022, i, item);\u003Cbr\u003E\u003Cbr\u003E            //EditorActionGroups.Instance.groupActionsList.GetItem(i).gameObject.PrintComponents();\u003Cbr\u003E\u003Cbr\u003E            /*\u003Cbr\u003E                * [LOG 06:27:30.993] DebugTools, ActionGroupItem(Clone) has components:\u003Cbr\u003E[LOG 06:27:30.994] DebugTools, ...c: UnityEngine.Transform\u003Cbr\u003E[LOG 06:27:30.994] DebugTools, ...c: UIListItemContainer\u003Cbr\u003E[LOG 06:27:30.995] DebugTools, ...c: EditorActionPartItem\u003Cbr\u003E[LOG 06:27:30.995] DebugTools, ---\u0026gt;ActionGroupTitle has components:\u003Cbr\u003E[LOG 06:27:30.996] DebugTools, ......c: UnityEngine.Transform\u003Cbr\u003E[LOG 06:27:30.997] DebugTools, ......c: UnityEngine.MeshRenderer\u003Cbr\u003E[LOG 06:27:30.997] DebugTools, ......c: UnityEngine.MeshFilter\u003Cbr\u003E[LOG 06:27:30.998] DebugTools, ......c: SpriteText\u003Cbr\u003E[LOG 06:27:30.999] DebugTools, ---\u0026gt;Background has components:\u003Cbr\u003E[LOG 06:27:30.999] DebugTools, ......c: UnityEngine.Transform\u003Cbr\u003E[LOG 06:27:31.000] DebugTools, ......c: UnityEngine.MeshFilter\u003Cbr\u003E[LOG 06:27:31.000] DebugTools, ......c: UnityEngine.MeshRenderer\u003Cbr\u003E[LOG 06:27:31.001] DebugTools, ......c: UIButton\u003Cbr\u003E[LOG 06:27:31.001] DebugTools, ......c: UnityEngine.BoxCollider\u003Cbr\u003E                * */\u003Cbr\u003E            var pa = item.gameObject.GetComponent\u0026lt;EditorActionPartItem\u0026gt;();\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E            if (pa != null \u0026amp;\u0026amp; pa.evt != null)\u003Cbr\u003E                Log.Write(\u0022guiName: {0}\u0022, pa.evt.guiName);\u003Cbr\u003E        }\u003Cbr\u003E    }\u003Cbr\u003E\u003Cbr\u003E    /// \u0026lt;summary\u0026gt;\u003Cbr\u003E    /// right-most list\u003Cbr\u003E    /// \u0026lt;/summary\u0026gt;\u003Cbr\u003E    /// \u0026lt;param name=\u0022obj\u0022\u0026gt;\u0026lt;/param\u0026gt;\u003Cbr\u003E    public void OnPartActionListChange(IUIObject obj)\u003Cbr\u003E    {\u003Cbr\u003E        Log.Error(\u0022OnPartActionListChange: {0}\u0022, obj.name);\u003Cbr\u003E\u003Cbr\u003E        for (int i = 0; i \u0026lt; EditorActionGroups.Instance.partActionList.Count; \u002B\u002Bi)\u003Cbr\u003E            Log.Write(\u0022partActionList item {0} = {1}\u0022, i, EditorActionGroups.Instance.partActionList.GetItem(i));\u003Cbr\u003E\u003Cbr\u003E    }\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E    /// \u0026lt;summary\u0026gt;\u003Cbr\u003E    /// left-most list\u003Cbr\u003E    /// \u0026lt;/summary\u0026gt;\u003Cbr\u003E    /// \u0026lt;param name=\u0022obj\u0022\u0026gt;\u0026lt;/param\u0026gt;\u003Cbr\u003E    public void OnActionGroupListChange(IUIObject obj)\u003Cbr\u003E    {\u003Cbr\u003E        Log.Error(\u0022OnActionGroupListChange: {0}\u0022, obj.name);\u003Cbr\u003E\u003Cbr\u003E        for (int i = 0; i \u0026lt; EditorActionGroups.Instance.actionGroupList.Count; \u002B\u002Bi)\u003Cbr\u003E            Log.Write(\u0022ActionGroupList item {0} = {1}\u0022, i, EditorActionGroups.Instance.actionGroupList.GetItem(i));\u003Cbr\u003E    }\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E    void OnGUI()\u003Cbr\u003E    {\u003Cbr\u003E        if (EditorLogic.fetch.editorScreen == EditorLogic.EditorScreen.Actions)\u003Cbr\u003E        {\u003Cbr\u003E            if (GUI.Button(new Rect(400f, 400f, 128f, 20f), \u0022Show\u0022)) ShowPanel(true);\u003Cbr\u003E            if (GUI.Button(new Rect(400f, 424f, 128f, 20f), \u0022Hide\u0022)) ShowPanel(false);\u003Cbr\u003E        }\u003Cbr\u003E    }\u003Cbr\u003E}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EI wonder if we can get our own UIButtons running. It might solve the clickthrough problem with Unity\u0027s GUI. No time to look into it today though \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_sad.gif\u0022 alt=\u0022:(\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-06-15T18:51:09Z","Content":"\n\u003Cp\u003E@EvilReeper: Wow, that is a lot more detailed then I was expecting.\u003C/p\u003E\u003Cp\u003EHowever, I seem to have something wrong in my development environment.\u003C/p\u003E\u003Cp\u003EWhen I first tried what you posted for me, I got a \u0022Type or Namespace IUIObject could not be found\u0022. Digging into that it looks like it means I don\u0027t have Assembly-CSharp-firstpass.dll referenced correctly.\u003C/p\u003E\u003Cp\u003EHowever, it certainly appears in my references list in Visual Studio so I then went and added it to the top of my .cs page with a Using statement as per the name on the assembly from the reference properties which is Assembly-CSharp.\u003C/p\u003E\u003Cp\u003EBut that does not work either as it seems to be confused by the - in the middle. If I try to compile with \u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Eusing Assembly-CSharp;\u003C/pre\u003E\u003Cp\u003E it underlines the dash and throws a \u0022; expected\u0022 error. If I remove that line so I only have the following:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Eusing System;\u003Cbr\u003Eusing System.Collections.Generic;\u003Cbr\u003Eusing System.Linq;\u003Cbr\u003Eusing System.Text;\u003Cbr\u003Eusing KSP.IO;\u003Cbr\u003Eusing System.Timers;\u003Cbr\u003Eusing UnityEngine;\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EI\u0027m back to the \u0022Type or Namespace IUIObject could not be found\u0022 error.\u003C/p\u003E\u003Cp\u003EEither way, I can\u0027t get your test code to actually compile to test it, are you able to point me towards what I have configured wrong?\u003C/p\u003E\u003Cp\u003EThanks a lot for the help here.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2014-06-15T19:27:41Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Diazo\u0022 data-cite=\u0022Diazo\u0022\u003E\u003Cdiv\u003EWhen I first tried what you posted for me, I got a \u0022Type or Namespace IUIObject could not be found\u0022. Digging into that it looks like it means I don\u0027t have Assembly-CSharp-firstpass.dll referenced correctly.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI didn\u0027t do anything special. Right-click project name in the solution explorer, \u0022Add reference\u0022, locate the DLL in appropriate folder, made sure there\u0027s a checkmark next to it and close the dialog. No using statements necessary\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-06-15T19:47:13Z","Content":"\n\u003Cp\u003EOdd, I double checked I have all that setup correctly.\u003C/p\u003E\u003Cp\u003EYou are referring to using the Assembly-CSharp-firstpass.dll that comes with KSP and is in the KSP_Install\\KSP_Data\\Managed folder correct? \u003C/p\u003E\u003Cp\u003ESearching through the Object Browser in Visual Studio, I can see that the BaseAction class is also part of Assembly-CSharp-firstpass and I use that all over the place so I do have the reference setup.\u003C/p\u003E\u003Cp\u003EHowever there is no IUIObject anywhere in my references when I do a search, indeed neither does \u0022IUI\u0022 or \u0022IObject\u0022 return any references. (Technically IObject returns two, but they are both in the System assembly.)\u003C/p\u003E\u003Cp\u003EDo you have a different .dll file somehow?\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\u003Cp\u003Eedit: Not a huge deal in the end as I\u0027ve found workable methods for both issues. \u003C/p\u003E\u003Cp\u003EIf I can get what you are showing me working to show/hide the panel, that is a lot nicer method then the hack job I\u0027ve done for that.\u003C/p\u003E\u003Cp\u003EHowever, I\u0027ve come up with a way to monitor action groups directly and will be using that regardless as that means if there is another mod installed that modified action group assignments, my AGX mod will recognize that.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-06-15T20:12:28Z\u0022 title=\u002206/15/2014 08:12  PM\u0022 data-short=\u002210 yr\u0022\u003EJune 15, 2014\u003C/time\u003E by Diazo\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2014-06-15T20:14:44Z","Content":"\n\u003Cp\u003EYes, that\u0027s the DLL. Odd. What method signature do you see when you use the object browser in visual studio to look up EZValueChangedDelegate? Or is that also hidden?\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Diazo\u0022 data-cite=\u0022Diazo\u0022\u003E\u003Cdiv\u003ESearching through the Object Browser in Visual Studio, I can see that the BaseAction class is also part of Assembly-CSharp-firstpass and I use that all over the place so I do have the reference setup.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EAre you sure about that? I see it in Assembly-CSharp\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cblockquote\u003E\u003Cimg src=\u0022http://puu.sh/9v29g/08ce3228a9.png\u0022 alt=\u002208ce3228a9.png\u0022\u003E\u003Cimg src=\u0022http://puu.sh/9v2bF/7b654f59ef.png\u0022 alt=\u00227b654f59ef.png\u0022\u003E\u003C/blockquote\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-06-15T20:37:00Z","Content":"\n\u003Cp\u003EReally? \u003C/p\u003E\u003Cp\u003E/checks\u003C/p\u003E\u003Cp\u003E/wanders off to bang his head into a wall\u003C/p\u003E\u003Cp\u003EOkay, I have my Solution Explorer shoved off to the right side of the screen so it cuts the file name off. I assumed my reference displaying \u0022Assembly-CSHar...\u0022 was the one we were talking about and was wrong.\u003C/p\u003E\u003Cp\u003EOff to investigate, thank you again for all the help.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-06-16T15:33:33Z","Content":"\n\u003Cp\u003EOkay, I have the UIpanels working.\u003C/p\u003E\u003Cp\u003EOne important caveat however is that you have to resummon the panels yourself, switching to another mode (actions -\u0026gt; parts) does not do it for you.\u003C/p\u003E\u003Cp\u003EAll I cared about was the actions panel, so I ran\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003EEditorPanels.Instance.panelManager.DismissImmediate();\u003C/pre\u003E\u003Cp\u003E when the player switched to the Actions Editor. However, when the player switched back to the parts or the crew editor, the UIpanel stayed hidden.\u003C/p\u003E\u003Cp\u003EI had to hook into the Parts and Crew buttons at the top of the screen and do a check that if the EditorPanel was hidden when the player clicked the Parts or Crew button, run \u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003EEditorPanels.Instance.panelManager.BringInImmediate(EditorPanels.Instance.actions);\u003C/pre\u003E\u003Cp\u003E so that KSP could find the EditorPanel to hide it before it would show the Parts UIPanel.\u003C/p\u003E\u003Cp\u003EOddly enough, EZGui queues these transitions up. In one test I hid the editor UIPanel, clicked the crew/parts buttons a bunch of times and nothing happened. I then switched back to actions and resummoned the editor UIPanel and the UIPanel went nuts doing all the switching of buttons I had clicked while it was hidden.\u003C/p\u003E\u003Cp\u003ESo, those looking into this also make sure you include code to resummon the UIPanel if you hide it.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n"},{"CreatedByName":"Ippo","CreatedById":107018,"CreatedDateTime":"2014-06-19T19:46:57Z","Content":"\n\u003Cp\u003EHi, how can I make my events show up in the action group selection?\u003C/p\u003E\n"},{"CreatedByName":"DMagic","CreatedById":57416,"CreatedDateTime":"2014-06-19T19:49:47Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Ippo\u0022 data-cite=\u0022Ippo\u0022\u003E\u003Cdiv\u003EHi, how can I make my events show up in the action group selection?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYou just want some of your events ([KSPEvents]) to also be available through action groups? \u003C/p\u003E\u003Cp\u003ECreate a [KSPAction(\u0022name\u0022)] and have it call your KSPEvent method, or make separate code for it.\u003C/p\u003E\n"}]}