{"TopicId":76782,"ForumId":29,"TopicTitle":"Why does raycast \u0026quot;hit\u0026quot; Kerbin when not aimed at Kerbin?","CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2014-07-06T00:12:10Z","PageNum":1,"Articles":[{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2014-07-06T00:12:10Z","Content":"\n\u003Cp\u003EWhy does Unity\u0027s Physics.Raycast keep hitting Kerbin at the wrong angles? It doesn\u0027t hit Kerbin when aimed at Kerbin, and DOES hit Kerbin when not aimed at Kerbin.\u003C/p\u003E\u003Cp\u003EHere\u0027s some screenshots of what my laser distance measurer is reporting: (-1 is what I display when I get no hit).\u003C/p\u003E\u003Cp\u003ENote it DOES show a hit when not aimed at Kerbin, and does NOT show a hit when aimed at Kerbin. I have checked my logic and it\u0027s not just a case of inverting the logic, because it does work when hitting nearby objects like other vessels, and it doesn\u0027t *always* claim to be hitting Kerbin - just when I\u0027m aimed near but not at kerbin. If I aim up at the sky it goes back to showing no hit.\u003C/p\u003E\u003Cp\u003EThe distance of the hit is also rather weird, but I\u0027m going to tackle that issue next. First I don\u0027t even understand why it\u0027s registering the wrong hit in the first place.\u003C/p\u003E\u003Cp\u003E(Rightclick the images and pick \u0022view image\u0022 to see them at full-res, to see the text.)\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://i.imgur.com/WbwDNlV.png\u0022 alt=\u0022WbwDNlV.png\u0022\u003E\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://i.imgur.com/FP5XNqu.png\u0022 alt=\u0022FP5XNqu.png\u0022\u003E\u003C/p\u003E\u003Cp\u003EThis is the call to Physics.RayCast():\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E   if( Physics.Raycast(origin, pointing, out hit, maxDistance, mask) )\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EWhere \u0027mask\u0027 is this:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E            mask =  (1 \u0026lt;\u0026lt; maskBitDefault)\u003Cbr\u003E                    \u002B (1 \u0026lt;\u0026lt; maskBitWater)\u003Cbr\u003E                    \u002B (1 \u0026lt;\u0026lt; maskBitPartsList)\u003Cbr\u003E                    \u002B (1 \u0026lt;\u0026lt; maskBitScaledScenery)\u003Cbr\u003E                    \u002B (1 \u0026lt;\u0026lt; maskBitLocalScenery)\u003Cbr\u003E                    \u002B (1 \u0026lt;\u0026lt; maskBitKerbals)\u003Cbr\u003E                    \u002B (1 \u0026lt;\u0026lt; maskBitDisconnectedParts)\u003Cbr\u003E                    \u002B (1 \u0026lt;\u0026lt; maskBitPartTriggers)\u003Cbr\u003E                    \u002B (1 \u0026lt;\u0026lt; maskBitWheelColliders)\u003Cbr\u003E                    \u002B (1 \u0026lt;\u0026lt; maskBitTerrainCollidres) ;\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003Eand those bit fields are these:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E        private int maskBitDefault = 0;\u003Cbr\u003E        private int maskBitWater = 3;\u003Cbr\u003E        private int maskBitPartsList = 8;\u003Cbr\u003E        private int maskBitScaledScenery = 10;\u003Cbr\u003E        private int maskBitLocalScenery = 15;\u003Cbr\u003E        private int maskBitKerbals = 16;\u003Cbr\u003E        private int maskBitDisconnectedParts = 19;\u003Cbr\u003E        private int maskBitPartTriggers= 21;\u003Cbr\u003E        private int maskBitWheelColliders = 27;\u003Cbr\u003E        private int maskBitTerrainCollidres = 28;\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2014-07-08T00:20:11Z","Content":"\n\u003Cp\u003Eokay so apparently it\u0027s on layer 10, which I *THINK* is the mapview layer... but....but... I\u0027m not *on* the map view. So that\u0027s weird that it\u0027s seeing hits for it. At any rate I\u0027ll remove that from the mask list. I still can\u0027t figure out how to find a hit when the terrain polygons are unloaded for being too far away, but at least no hits is an improvement over wrong hits.\u003C/p\u003E\n"},{"CreatedByName":"DMagic","CreatedById":57416,"CreatedDateTime":"2014-07-08T02:32:26Z","Content":"\n\u003Cp\u003EI think that above some certain height (160km for Kerbin? that\u0027s where the performance hit from the terrain settings cuts off) it switches to scaled space, though I could just be making that up. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif\u0022 alt=\u0022:wink:\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2014-07-08T03:55:00Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022DMagic\u0022 data-cite=\u0022DMagic\u0022\u003E\u003Cdiv\u003EI think that above some certain height (160km for Kerbin? that\u0027s where the performance hit from the terrain settings cuts off) it switches to scaled space, though I could just be making that up. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif\u0022 alt=\u0022:wink:\u0022\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI get that. The problem is that I\u0027m not actually aimed AT the planet and it\u0027s hitting it. that\u0027s not just a difference of scale - that\u0027s a difference in rotation, I think.\u003C/p\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2014-07-16T08:16:16Z","Content":"\n\u003Cp\u003EThe problem was that layer 10, the map view layer, is being drawn all the time, even when not on map view. Therefore raycast is hitting the map view\u0027s version of the Kerbin planet even when not in map view. Masking off layer 10 from the raycast fixed it.\u003C/p\u003E\n"}]}