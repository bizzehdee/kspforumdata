{"TopicId":62078,"ForumId":29,"TopicTitle":"How to control the vessel throttle from the plugin (without throttle resetting)","CreatedByName":"Pastry","CreatedById":20958,"CreatedDateTime":"2014-02-03T21:10:00Z","PageNum":1,"Articles":[{"CreatedByName":"Pastry","CreatedById":20958,"CreatedDateTime":"2014-02-03T21:10:00Z","Content":"\n\u003Cp\u003EHey everyone \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003ESo I\u0027ve searched this forum for a solution on how to control a vessel from within a plugin. I did find an answer which suggested using the OnFlyByWire, but it is incapable of doing what I want. Here\u0027s the short story: I\u0027m creating a mod that plays an authentic count-down sound on launch, and then finally launches the rocket automatically. The sound playing works, and the launching works. What I would like is to make the plugin automatically throttle full up before launch. To do this I\u0027ve attempted something like this:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E    public void Start()\u003Cbr\u003E    {\u003Cbr\u003E        FlightGlobals.ActiveVessel.OnFlyByWire \u002B= new FlightInputCallback(fly);\u003Cbr\u003E    }\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EAnd then do something like:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E    private void fly(FlightCtrlState e)\u003Cbr\u003E    {\u003Cbr\u003E        if (!didLaunch)\u003Cbr\u003E            e.mainThrottle = 1.0f;\u003Cbr\u003E    }\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003ENow this works to a certain extend. As long as the rocket has not yet launched, but is still on the countdown, the bool \u003Cem\u003EdidLaunch\u003C/em\u003E is false, and as such the main throttle remains 100%. The problem happens as soon as the rocket activates the stage automatically and launches, as at this point, e.mainThrottle does \u003Cem\u003Enot\u003C/em\u003E remain at 100% but resets to 0%. I obviously need it to stay there.\u003C/p\u003E\u003Cp\u003EHow would I go about achieving this?\u003C/p\u003E\u003Cp\u003EAnd as a bonus question if anything feels so inclinced to answer it \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E Another problem I\u0027m facing is that my plugin currently only activates the first stage. Unfortunately I do not know whether or not the user has used those launch legs that you need to decouple in order to fly off. If the user have used these, and they are in the first stage it is obviously not a problem. If, however, they are in, say, the second stage, my plugin would only activate the first stage and thus the rocket would not really have launched. I\u0027ve thought that maybe my only option is to somehow check all the parts of the vessel and make sure those legs are not included in the list, and if they are, I will have to keep activating stages until the one with the legs have been activated. Would this approach work?\u003C/p\u003E\u003Cp\u003EThank you all very much for your time \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-02-03T21:36:25Z","Content":"\n\u003Cp\u003EHmmm.\u003C/p\u003E\u003Cp\u003EI have two comments, first one is that for throttle I don\u0027t use the FlightCtrlState function. I just directly call the throttle via:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003EFlightInputHandler.state.mainThrottle = 0.5f;\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003Esets the throttle to 50%. Note that you \u003Cem\u003Ehave\u003C/em\u003E to error trap this. If you pass an invalid value, you will screw the GUI up and lose throttle control until the Flight scene reloads.\u003C/p\u003E\u003Cp\u003EFor directional control, I do it slightly differently as well.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Epublic void Start()\u003Cbr\u003E{\u003Cbr\u003EFlightGlobals.ActiveVessel.OnFlyByWire \u002B= MyAutoControl\u003Cbr\u003E}\u003Cbr\u003E\u003Cbr\u003Epublic void MyAutoControl(FlightCtrlState MyFlightCtrlState)\u003Cbr\u003E{\u003Cbr\u003EMyFlightCtrlState.pitch = 1f;\u003Cbr\u003E}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003Ewould be equal to holding down S to pitch up. (I think up, can\u0027t remember if 1 or -1 is pitch up.)\u003C/p\u003E\u003Cp\u003EOn the launchclamps, you can check all parts on the active vessel to see if they are launch clamps (using part.name I think) and if there are, getting their stage via part.stage (or the actual command KSP uses). Careful with it though as I recall reading somewhere that the stage are backwards. (IE: a 10 stage vessel at launch, hitting the Spacebar activates stage 10, not stage 1)\u003C/p\u003E\u003Cp\u003EHope that helps.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-02-03T21:39:03Z\u0022 title=\u002202/03/2014 09:39  PM\u0022 data-short=\u002210 yr\u0022\u003EFebruary 3, 2014\u003C/time\u003E by Diazo\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Pastry","CreatedById":20958,"CreatedDateTime":"2014-02-03T23:13:59Z","Content":"\n\u003Cp\u003EHey Diazo! Thank you very much for the help! The FlightInputHandler did the trick! \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EInteresting about the launch clamps problem, I will try out this approach when I get the time!\u003C/p\u003E\u003Cp\u003EThank you very much for the help, it is much appreciated!\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-02-03T23:25:36Z","Content":"\n\u003Cp\u003ENo worries.\u003C/p\u003E\u003Cp\u003EIf there is one thing I figured out it is how the throttle works. I\u0027ve spent enough time messing around with it for my mod after all.... \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif\u0022 alt=\u0022:wink:\u0022\u003E\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n"},{"CreatedByName":"numerobis","CreatedById":62016,"CreatedDateTime":"2014-02-04T14:55:06Z","Content":"\n\u003Cp\u003EYou can also decouple launch clamps directly by sending them an action. I did that once for a plugin that would let jets spin up for 10s before launch.\u003C/p\u003E\n"},{"CreatedByName":"Pastry","CreatedById":20958,"CreatedDateTime":"2014-02-04T15:16:03Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003EYou can also decouple launch clamps directly by sending them an action. I did that once for a plugin that would let jets spin up for 10s before launch.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ENow that\u0027s cool! How do you send actions to parts directly?\u003C/p\u003E\n"},{"CreatedByName":"numerobis","CreatedById":62016,"CreatedDateTime":"2014-02-04T18:19:42Z","Content":"\n\u003Cp\u003EYou send it to the module, to be precise. ModuleResourceIntake has \u0022public void ToggleAction (KSPActionParam param)\u0022 for example, so you stuff a param in there (which is often not actually used). For the launch clamp it looks like it\u0027s called \u0022ReleaseClamp\u0022.\u003C/p\u003E\n"},{"CreatedByName":"Pastry","CreatedById":20958,"CreatedDateTime":"2014-02-05T19:55:18Z","Content":"\n\u003Cp\u003EThank you for the kind help! \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E It all worked out. Here\u0027s a small demonstration of the simple, yet fun, final product \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003E\n\u003C/p\u003E\u003Cdiv class=\u0022ipsEmbeddedVideo\u0022 contenteditable=\u0022false\u0022\u003E\u003Cdiv\u003E\u003Ciframe width=\u0022480\u0022 height=\u0022270\u0022 src=\u0022https://www.youtube.com/embed/ZWta4V6encs?feature=oembed\u0022 frameborder=\u00220\u0022 allowfullscreen=\u0022true\u0022\u003E\u003C/iframe\u003E\u003C/div\u003E\u003C/div\u003E\u003Cp\u003EI want to switch the countdown audio clip with something more authentic if I can find such an audio clip that has a license which allows it \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"}]}