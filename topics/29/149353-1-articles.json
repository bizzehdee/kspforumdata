{"TopicId":149353,"ForumId":29,"TopicTitle":"Refreshing a PartModule\u0026#039;s editor description","CreatedByName":"Nertea","CreatedById":83952,"CreatedDateTime":"2016-10-05T22:19:26Z","PageNum":1,"Articles":[{"CreatedByName":"Nertea","CreatedById":83952,"CreatedDateTime":"2016-10-05T22:19:26Z","Content":"\n\u003Cp\u003E\nSo partmodule.GetInfo() is called when a part is initially loaded to setup the editor module description. However, I would like to populate some portion of my GetInfo block with data that is generated when the editor loads. Is there a way to force the description\u00A0block\u0027s text\u00A0to be rebuilt manually? I\u0027ve had a dig through the API with not a huge amount of luck.\n\u003C/p\u003E\n"},{"CreatedByName":"DMagic","CreatedById":57416,"CreatedDateTime":"2016-10-05T22:49:16Z","Content":"\n\u003Cp\u003E\nI am fairly certain that the GetInfo field is only populated by the part prefab, not any random instance of a part, so you\u0027ll have to look at AvailablePart.\n\u003C/p\u003E\n\u003Cp\u003E\nI would like at PartLoader.LoadedPartsList for all of the parts.\u00A0AvailablePart.moduleInfos is a list of all the part module GetInfo results. I think updating the relevant AvailablePart.ModuleInfo\u0027s info string should do it.\n\u003C/p\u003E\n"},{"CreatedByName":"JPLRepo","CreatedById":114736,"CreatedDateTime":"2016-10-05T23:02:19Z","Content":"\n\u003Cp\u003E\nPretty certain that\u0027s correct ^. Which is why the upgrade module cannot update the Getinfo either.\n\u003C/p\u003E\n"},{"CreatedByName":"Nertea","CreatedById":83952,"CreatedDateTime":"2016-10-05T23:08:42Z","Content":"\n\u003Cp\u003E\nI tried this on in the part\u0027s Start()\u00A0without any errors, but without any success in updating the module info. Is this what you are describing?\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003EAvailablePart p = PartLoader.LoadedPartsList.Find(pt =\u0026gt; pt.name == part.name);\nfor (int i = 0; i \u0026lt; p.moduleInfos.Count; i\u002B\u002B)\n{\n\tif (p.moduleInfos[i].moduleName == \u0022ModuleCryoTank\u0022)\n\tp.moduleInfos[i].info = GetInfo();\n}\u003C/span\u003E\u003C/pre\u003E\n"},{"CreatedByName":"DMagic","CreatedById":57416,"CreatedDateTime":"2016-10-05T23:58:10Z","Content":"\n\u003Cp\u003E\nThis is in the editor? Maybe the editor part tooltip is assigned when the editor starts.\n\u003C/p\u003E\n\u003Cp\u003E\nIn KSP.UI.Screens.Editor there are a bunch of classes related to the PartListTooltips, one of those might have something accessible with the info field.\n\u003C/p\u003E\n"},{"CreatedByName":"Nertea","CreatedById":83952,"CreatedDateTime":"2016-10-06T15:09:01Z","Content":"\n\u003Cp\u003E\nThis might be more work than it\u0027s worth at this point \u003Cimg alt=\u0022:P\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif\u0022 title=\u0022:P\u0022\u003E\u00A0I was hoping it\u0027d be relatively simple, but it seems like it might be easier to just drop a part action field in to show the field I want.\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"blowfish","CreatedById":119688,"CreatedDateTime":"2016-10-06T15:34:48Z","Content":"\n\u003Cp\u003E\nOut of curiosity, what info do you need to display that can\u0027t be determined before the editor launches?\n\u003C/p\u003E\n"},{"CreatedByName":"Nertea","CreatedById":83952,"CreatedDateTime":"2016-10-11T17:09:52Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222790419\u0022 data-ipsquote-contentid=\u0022149353\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221475768088\u0022 data-ipsquote-userid=\u0022119688\u0022 data-ipsquote-username=\u0022blowfish\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nOn 10/6/2016 at 8:34 AM, blowfish said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nOut of curiosity, what info do you need to display that can\u0027t be determined before the editor launches?\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nHmm well I have a part that specifies the amount of a resource it consumes based on the total amount of the resource. Currently the tooltip says something like 50Ec per 1000units, but it would be better to just display the total cooling cost. However, I can\u0027t seem to get the resource amount when GetInfo gets called, I guess stuff isn\u0027t initialized or similar.\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"blowfish","CreatedById":119688,"CreatedDateTime":"2016-10-11T17:15:18Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222797496\u0022 data-ipsquote-contentid=\u0022149353\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221476205792\u0022 data-ipsquote-userid=\u002283952\u0022 data-ipsquote-username=\u0022Nertea\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n4 minutes ago, Nertea said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nHmm well I have a part that specifies the amount of a resource it consumes based on the total amount of the resource. Currently the tooltip says something like 50Ec per 1000units, but it would be better to just display the total cooling cost. However, I can\u0027t seem to get the resource amount when GetInfo gets called, I guess stuff isn\u0027t initialized or similar.\u00A0\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThat\u0027s strange - the resources should all be there before PartModules are loaded. \u00A0Does \u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003Ethis.part.Resources\u003C/span\u003E not contain the resource you\u0027re looking for?\n\u003C/p\u003E\n"},{"CreatedByName":"Nertea","CreatedById":83952,"CreatedDateTime":"2016-10-11T17:17:51Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222797501\u0022 data-ipsquote-contentid=\u0022149353\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221476206118\u0022 data-ipsquote-userid=\u0022119688\u0022 data-ipsquote-username=\u0022blowfish\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n1 minute ago, blowfish said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nThat\u0027s strange - the resources should all be there before PartModules are loaded. \u00A0Does \u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003Ethis.part.Resources\u003C/span\u003E not contain the resource you\u0027re looking for?\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nDoesn\u0027t seem to. Here\u0027s the offending code:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003Epublic override string GetInfo()\n{\n  Debug.Log(\u0022GETINFO \u0022);\n  string msg = String.Format(\u0022Loss Rate: {0:F2}% {1}/hr\u0022, BoiloffRate, FuelName);\n  if (CoolingCost \u0026gt; 0.0f)\n  {\n    double max = GetMaxResourceAmount(FuelName);\n    msg \u002B= String.Format(\u0022\\nCooling Cost: {0:F2} Ec/s\u0022, CoolingCost*(float)(max/1000.0));\n  }\n  return msg;\n}\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nThe error is thrown in GetMaxResourceAmount, a helper of the form\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003Eprotected double GetMaxResourceAmount(string nm)\n{\n\tPartResource res = this.part.Resources.Get(PartResourceLibrary.Instance.GetDefinition(nm).id);\n\treturn res.maxAmount;\n}\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"blowfish","CreatedById":119688,"CreatedDateTime":"2016-10-11T17:22:37Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222797502\u0022 data-ipsquote-contentid=\u0022149353\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221476206271\u0022 data-ipsquote-userid=\u002283952\u0022 data-ipsquote-username=\u0022Nertea\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n2 minutes ago, Nertea said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nThe error is thrown in GetMaxResourceAmount, a helper of the form\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\n\u003Cspan class=\u0022pln\u0022\u003Eprotected double GetMaxResourceAmount(string nm)\n{\n\tPartResource res = this.part.Resources.Get(PartResourceLibrary.Instance.GetDefinition(nm).id);\n\treturn res.maxAmount;\n}\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nIs PartResourceLibrary.Instance.GetDefinition returning\u00A0null or is part.Resources.Get returning null?\n\u003C/p\u003E\n"},{"CreatedByName":"Nertea","CreatedById":83952,"CreatedDateTime":"2016-10-11T17:45:18Z","Content":"\n\u003Cp\u003E\nThat I don\u0027t know. I\u0027ll have to test that when I get home... is there a workaround for the resource library showing null?\n\u003C/p\u003E\n"},{"CreatedByName":"blowfish","CreatedById":119688,"CreatedDateTime":"2016-10-11T17:54:38Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222797539\u0022 data-ipsquote-contentid=\u0022149353\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221476207918\u0022 data-ipsquote-userid=\u002283952\u0022 data-ipsquote-username=\u0022Nertea\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n6 minutes ago, Nertea said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nThat I don\u0027t know. I\u0027ll have to test that when I get home... is there a workaround for the resource library showing null?\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nI\u0027m just trying to figure out what\u0027s failing since as far as I know, this should work. \u00A0You should definitely be able to get a resource definition from the resource library at this stage.\n\u003C/p\u003E\n"},{"CreatedByName":"Nertea","CreatedById":83952,"CreatedDateTime":"2016-10-11T18:21:39Z","Content":"\n\u003Cp\u003E\nAh okay. I\u0027ll get back to you when I have some test time.\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"Nertea","CreatedById":83952,"CreatedDateTime":"2016-10-12T14:55:22Z","Content":"\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/119688-blowfish/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022119688\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/119688-blowfish/\u0022 rel=\u0022\u0022\u003E@blowfish\u003C/a\u003E\u00A0This bit works fine and returns the ID:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003Eint id = PartResourceLibrary.Instance.GetDefinition(nm).id\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nThis second bit is the one that fails (returns null):\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003Ethis.part.Resources.Get(id)\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-10-12T14:55:41Z\u0022 title=\u002210/12/2016 02:55  PM\u0022 data-short=\u00227 yr\u0022\u003EOctober 12, 2016\u003C/time\u003E by Nertea\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"blowfish","CreatedById":119688,"CreatedDateTime":"2016-10-12T15:10:15Z","Content":"\n\u003Cp\u003E\nHmm. \u00A0This might sound silly, but does the part actually have this resource from the start? \u00A0If it uses resource switching it probably won\u0027t be there.\n\u003C/p\u003E\n\u003Cp\u003E\nIf that was completely off the mark maybe try logging what resources are actually on the part?\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-10-12T15:12:30Z\u0022 title=\u002210/12/2016 03:12  PM\u0022 data-short=\u00227 yr\u0022\u003EOctober 12, 2016\u003C/time\u003E by blowfish\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Nertea","CreatedById":83952,"CreatedDateTime":"2016-10-12T15:21:51Z","Content":"\n\u003Cp\u003E\nOh my... that is... uh.\n\u003C/p\u003E\n\u003Cp\u003E\nYeah, I have \u003Cabbr title=\u0022Module Manager (mod)\u0022\u003EMM\u003C/abbr\u003E delete the resource and then configure a part switcher. I hadn\u0027t even...\u00A0::embarassed::\n\u003C/p\u003E\n\u003Cp\u003E\nAll good now!\n\u003C/p\u003E\n"}]}