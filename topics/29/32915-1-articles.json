{"TopicId":32915,"ForumId":29,"TopicTitle":"PartModule.OnLoad() is schizophrenic! Here\u0026#039;s how to fix it.","CreatedByName":"Majiir","CreatedById":7550,"CreatedDateTime":"2013-06-14T07:10:12Z","PageNum":1,"Articles":[{"CreatedByName":"Majiir","CreatedById":7550,"CreatedDateTime":"2013-06-14T07:10:12Z","Content":"\n\u003Cp\u003EI was trying to implement fancy module config nodes the way stock modules have them, like the PROPELLANT blocks in ModuleEngines. I have no idea why, but it seems near impossible to get OnLoad to cooperate with us on our own modules. It works fine in the VAB, but as soon as you enter a flight scene, the ConfigNode you get is the one from the Vessel, not the part configuration. For many things, this is completely useless.\u003C/p\u003E\u003Cp\u003ESo, after much toiling and consumption of all my remaining alcohol, here\u0027s a one-liner:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Eif (part.partInfo != null) { node = GameDatabase.Instance.GetConfigs(\u0022PART\u0022).Where(c =\u0026gt; part.partInfo.name == c.name.Replace(\u0027_\u0027, \u0027.\u0027)).Single().config.GetNodes(\u0022MODULE\u0022).Where(n =\u0026gt; n.GetValue(\u0022name\u0022) == moduleName).Single(); }\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EThis grabs the part config directly, locates your module (note: only works if there is exactly one of your module on the part, sucky limitation) and replaces the parameter config node with what it finds. It could use improvement and you might tweak it to your own purposes, but I figured I\u0027d share anyway.\u003C/p\u003E\n"},{"CreatedByName":"Razchek","CreatedById":62645,"CreatedDateTime":"2013-06-14T07:59:31Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Majiir\u0022 data-cite=\u0022Majiir\u0022\u003E\u003Cdiv\u003EI was trying to implement fancy module config nodes the way stock modules have them, like the PROPELLANT blocks in ModuleEngines. I have no idea why, but it seems near impossible to get OnLoad to cooperate with us on our own modules. It works fine in the VAB, but as soon as you enter a flight scene, the ConfigNode you get is the one from the Vessel, not the part configuration. For many things, this is completely useless.\u003Cp\u003ESo, after much toiling and consumption of all my remaining alcohol, here\u0027s a one-liner:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Eif (part.partInfo != null) { node = GameDatabase.Instance.GetConfigs(\u0022PART\u0022).Where(c =\u0026gt; part.partInfo.name == c.name.Replace(\u0027_\u0027, \u0027.\u0027)).Single().config.GetNodes(\u0022MODULE\u0022).Where(n =\u0026gt; n.GetValue(\u0022name\u0022) == moduleName).Single(); }\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EThis grabs the part config directly, locates your module (note: only works if there is exactly one of your module on the part, sucky limitation) and replaces the parameter config node with what it finds. It could use improvement and you might tweak it to your own purposes, but I figured I\u0027d share anyway.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYou should ditch the \u0027where\u0027 calls. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E Other than that, there are really only other minor optimizations to make to the \u0027one-liner\u0027 lol.\u003C/p\u003E\u003Cp\u003EThank you for sharing!\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Eif (part.partInfo != null)\u003Cbr\u003E            {\u003Cbr\u003E                node =\u003Cbr\u003E                    GameDatabase.Instance.GetConfigs(\u0022PART\u0022)\u003Cbr\u003E                                .Single(c =\u0026gt; part.partInfo.name == c.name.Replace(\u0027_\u0027, \u0027.\u0027))\u003Cbr\u003E                                .config.GetNodes(\u0022MODULE\u0022)\u003Cbr\u003E                                .Single(n =\u0026gt; n.GetValue(\u0022name\u0022) == moduleName);\u003Cbr\u003E            }\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n"},{"CreatedByName":"Mr Shifty","CreatedById":68146,"CreatedDateTime":"2013-06-14T14:11:48Z","Content":"\n\u003Cp\u003EWhere was this code when I needed it a week ago?\u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E Thanks for posting it!\u003C/p\u003E\n"}]}