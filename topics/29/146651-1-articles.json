{"TopicId":146651,"ForumId":29,"TopicTitle":"Vessel moving slower than its velocity under 100km","CreatedByName":"Youen","CreatedById":116909,"CreatedDateTime":"2016-08-27T17:26:11Z","PageNum":1,"Articles":[{"CreatedByName":"Youen","CreatedById":116909,"CreatedDateTime":"2016-08-27T17:26:11Z","Content":"\n\u003Cp\u003E\nHi,\n\u003C/p\u003E\n\u003Cp\u003E\nI have observed something strange when orbiting around Kerbin at an altitude lower than 100km: the vessel is moving slower than its velocity. Here are the values I used:\n\u003C/p\u003E\n\u003Cp\u003E\n- velocity is retrieved with vessel.obt_velocity\n\u003C/p\u003E\n\u003Cp\u003E\n- position relative to kerbin is retrieved with vessel.GetWorldPos3D() - kerbin.position\n\u003C/p\u003E\n\u003Cp\u003E\n- time is retrieved with Planetarium.GetUniversalTime()\n\u003C/p\u003E\n\u003Cp\u003E\n- velocity from actual vessel movement is computed with (position1 - position0) / timeDelta\n\u003C/p\u003E\n\u003Cp\u003E\nWhat I observe is that velocities are exactly the same for any altitude above 100km, but vessel movement is slower (by a factor of about 0.9) when under 100km. Anyone has an explanation?\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-08-27T17:26:36Z\u0022 title=\u002208/27/2016 05:26  PM\u0022 data-short=\u00227 yr\u0022\u003EAugust 27, 2016\u003C/time\u003E by Youen\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"wasml","CreatedById":120438,"CreatedDateTime":"2016-08-28T04:43:17Z","Content":"\n\u003Cp\u003E\nShot in the dark here but could the reference frame change at 100 Km? In other words does the reference frame rotate with Kerbin under 100K?\n\u003C/p\u003E\n"},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2016-08-28T07:41:12Z","Content":"\n\u003Cp\u003E\nAt orbital velocities the physics reference frame is the vessel unless I\u0027m completely misremembering things\u00A0(switchover ~700m/s, really obvious it\u0027s happened if you watch the exhaust smoke behaviour). There is a switchover around 100km (I don\u0027t remember the exact\u00A0altitude) for terrain rendering but other than the altitude I don\u0027t recall anything linking the two.\n\u003C/p\u003E\n\u003Cp\u003E\nI can\u0027t think of anything that would cause such a switch, but I would be checking on other related measurements to see if they change at the same altitude on Kerbin\u00A0(eg.\u00A0solar velocity, solar velocity less kerbin velocity, velocity direction, acceleration, etc.)\n\u003C/p\u003E\n"},{"CreatedByName":"Youen","CreatedById":116909,"CreatedDateTime":"2016-08-28T08:48:14Z","Content":"\n\u003Cp\u003E\nThe vessel velocity (as reported by obt_velocity) is coherent at all altitudes, and matches the expected orbital velocity. For example it\u0027s the same as vessel.orbit.getOrbitalVelocityAtUT(Planetarium.GetUniversalTime()).\n\u003C/p\u003E\n\u003Cp\u003E\nvessel.orbit is also coherent and gives the correct orbit corresponding to Kerbin gravity.\n\u003C/p\u003E\n\u003Cp\u003E\nSo there is nothing wrong with any velocity I can read from KSP API.\n\u003C/p\u003E\n\u003Cp\u003E\nThe vessel position however does not match what it should. It follows the correct orbit, but slower than it should. vessel.orbit changes accordingly (same orbit, by time shifts to match the vessel moving too slowly along it). I haven\u0027t checked yet, but I think it will take more time than it should to make a complete orbit. I also haven\u0027t checked if other vessels are also moving slower than they should, or if it\u0027s only the player vessel. I will also check if I can observe the same behavior on another computer...\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-08-28T08:48:42Z\u0022 title=\u002208/28/2016 08:48  AM\u0022 data-short=\u00227 yr\u0022\u003EAugust 28, 2016\u003C/time\u003E by Youen\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2016-08-28T10:11:02Z","Content":"\n\u003Cp\u003E\nDid you try to check with\u00A0vessel.GetWorldPos3D() (you ll have to account for the body vel) ?\n\u003C/p\u003E\n"},{"CreatedByName":"Youen","CreatedById":116909,"CreatedDateTime":"2016-08-28T11:50:51Z","Content":"\n\u003Cp\u003E\nActually, \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/120438-wasml/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022120438\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/120438-wasml/\u0022 rel=\u0022\u0022\u003E@wasml\u003C/a\u003E is right ; the reference frame changes when going below 100km. Everything in vessel.orbit is in inertial frame when above 100km, but in rotating frame when below. It seems vessel.obt_velocity follows the same rules. My positions were always in the inertial frame (as said in \u003Cabbr title=\u0022Original Post(er). The first post in a thread, or the person who posted it.\u0022\u003EOP\u003C/abbr\u003E, I use GetWorldPos3D() - body.position), which explains why it didn\u0027t match below 100km. I probably made much more knots in my head than needed be, some of the things I said above are probably wrong. I wish this was documented in the first place!\n\u003C/p\u003E\n\u003Cp\u003E\nFor those who want to work with the Orbit objects, you must also take care to swap Y/Z components, but not for all methods (for example, it\u0027s already done for vessel.obt_velocity and Orbit.GetRelativeVel ; but you must do it for Orbit.getOrbitalVelocityAtUT).\n\u003C/p\u003E\n\u003Cp\u003E\nThanks everyone for the help sorting it out.\n\u003C/p\u003E\n\u003Cp\u003E\nHmm... and if someone knows how to check what reference frame is used without resorting to hacks such as testing vessel altitude (don\u0027t know if the 100km threshold applies to others bodies) that would help too.\n\u003C/p\u003E\n"},{"CreatedByName":"Youen","CreatedById":116909,"CreatedDateTime":"2016-08-28T12:58:59Z","Content":"\n\u003Cp\u003E\nDammit, I\u0027ll never get it right... Things do not match yet.\n\u003C/p\u003E\n\u003Cp\u003E\nIf I display the vessel velocity, computed from its position in inertial frame, it doesn\u0027t match when I\u0027m below 100km. It should be around 2250m/s (circular orbit at 100km), but I get 2040m/s (the difference matches the rotating frame velocity, 210m/s at 100km).\n\u003C/p\u003E\n\u003Cp\u003E\nTo compute my \u0022true orbital velocity\u0022, I use positions and universal time. To compute the positions, I use GetWorldPos3D() - body.position. I don\u0027t see how this could be more independent from Kerbin rotation.\n\u003C/p\u003E\n\u003Cp\u003E\nSo I\u0027m back to what I said in the \u003Cabbr title=\u0022Original Post(er). The first post in a thread, or the person who posted it.\u0022\u003EOP\u003C/abbr\u003E: apparently, the vessel doesn\u0027t move at the right velocity when under 100km. While KSP tells me the ship has an orbital speed of 2250m/s (which should be the right value), the vessel is actually moving at 2040m/s.\n\u003C/p\u003E\n"},{"CreatedByName":"Van Disaster","CreatedById":58876,"CreatedDateTime":"2016-08-28T15:39:35Z","Content":"\n\u003Cp\u003E\nThere was an anomaly someone reported in an endurance flight challenge recently - the F3 screen was reporting nearly twice the distance covered that a manual calculation would suggest ( and also given we know the planet\u0027s circumference ), and the user in question managed to reduce the issue somewhat by adding some resource intensive mods. Try loading up your game a bit \u0026amp; see if your error is the same?\n\u003C/p\u003E\n"},{"CreatedByName":"Youen","CreatedById":116909,"CreatedDateTime":"2016-08-28T16:18:16Z","Content":"\n\u003Cp\u003E\nI found the culprit : vessel.GetWorldPos3D does NOT return the world position (i.e. relative to the sun). It does so only when above 100km. When under 100km, it seems to add a rotation-frame position with the body position (which doesn\u0027t make any sense AFAICT).\n\u003C/p\u003E\n\u003Cp\u003E\nAlso, I found how to know wether the game is in this \u0022rotating frame reference\u0022 state or not: one can test the boolean \u0022inverseRotation\u0022 of the current body, which is set to true only when the altitude of the current vessel is below mainBody.inverseRotThresholdAltitude\n\u003C/p\u003E\n\u003Cp\u003E\nWhen in this mode, another side effect is that the body transform is frozen (so the body doesn\u0027t rotate anymore). Instead, the universe rotates around the body in opposite direction?\n\u003C/p\u003E\n\u003Cp\u003E\nThe whole thing seems to be another hack similar to the Krakensbane to avoid glitches near a body surface (I guess).\n\u003C/p\u003E\n\u003Cp\u003E\nEDIT: actually, vessel.GetWorldPos3D makes sense, as the position is valid relatively to all other objects (I hope). But since the universe is rotating around the body, it can\u0027t be used to derive a velocity (you end up with either a rotating-frame velocity, or an absolute velocity, depending on body.inverseRotation value).\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-08-28T17:00:32Z\u0022 title=\u002208/28/2016 05:00  PM\u0022 data-short=\u00227 yr\u0022\u003EAugust 28, 2016\u003C/time\u003E by Youen\u003C/strong\u003E\n\u003C/span\u003E\n"}]}