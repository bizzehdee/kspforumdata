{"TopicId":137374,"ForumId":29,"TopicTitle":"Events for docking and undocking","CreatedByName":"MOARdV","CreatedById":60950,"CreatedDateTime":"2016-04-19T21:38:05Z","PageNum":1,"Articles":[{"CreatedByName":"MOARdV","CreatedById":60950,"CreatedDateTime":"2016-04-19T21:38:05Z","Content":"\n\u003Cp\u003E\nI\u0027m looking for events that a VesselModule can subscribe to so it knows when its vessel has docked with or undocked from another vessel - specifically, an event like \u0022Vessel X is docking with Vessel Y\u0022 or \u0022Vessel X is a new vessel because it undocked from Vessel Y\u0022. \u00A0It looks like the SameVesselDocked and SameVesselUndocked callbacks in GameEvents would do the trick, but I don\u0027t see them firing.\n\u003C/p\u003E\n\u003Cp\u003E\nWhat I\u0027m trying to accomplish is this: In RasterPropMonitor, I\u0027ve got a dictionary of \u0022persistent\u0022 variables that primarily track the state of various values consumed by props in a craft. \u00A0When I dock, I\u0027d like the VesselModules involved in docking to collate their values together, so that the new, combined vessel has all the persistents from the two separate craft. \u00A0Likewise, when I undock, I\u0027d like the newly-created craft to inherit the entire contents of the persistent variables dictionary.\n\u003C/p\u003E\n\u003Cp\u003E\nBased on the parameters for the SameVessel* events, those looked like they\u0027d do the trick, but, like I said, I don\u0027t see them firing. \u00A0Is there some other way I can know when two craft are combining, or when a new craft exists because it separated from another craft?\n\u003C/p\u003E\n"},{"CreatedByName":"wasml","CreatedById":120438,"CreatedDateTime":"2016-04-20T00:44:33Z","Content":"\n\u003Cp\u003E\nI think GameEvents.onVesselWasModified will trigger on a dock event - but also on other events such as pieces falling off/exploding.\n\u003C/p\u003E\n"},{"CreatedByName":"DMagic","CreatedById":57416,"CreatedDateTime":"2016-04-20T01:15:21Z","Content":"\n\u003Cp\u003E\nOnPartCouple is used for docking. It gives a From and a To Part (the docking ports) and fires before the vessels are actually joined. The From vessel is not necessarily the active vessel, I think it is the dominant docking port, which is determined by other things.\n\u003C/p\u003E\n\u003Cp\u003E\nI think OnVesselCreate is the one used when undocking (and maybe decoupling, too).\n\u003C/p\u003E\n\u003Cp\u003E\nI think the SameVesselDocked/Undocked are used when two ports on the same vessel join together, not regular docking.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-04-20T01:17:22Z\u0022 title=\u002204/20/2016 01:17  AM\u0022 data-short=\u00228 yr\u0022\u003EApril 20, 2016\u003C/time\u003E by DMagic\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"JPLRepo","CreatedById":114736,"CreatedDateTime":"2016-04-20T01:16:03Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222523874\u0022 data-ipsquote-contentid=\u0022137374\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221461114921\u0022 data-ipsquote-userid=\u002257416\u0022 data-ipsquote-username=\u0022DMagic\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nJust now, DMagic said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nOnPartCouple is used for docking. It gives a From and a To Part (the docking ports) and fires before the vessels are actually joined.\n\u003C/p\u003E\n\u003Cp\u003E\nI think OnVesselCreate is the one used when undocking (and maybe decoupling, too)\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nNot near my PC right now, but that sounds about right for the ones I use.\n\u003C/p\u003E\n"},{"CreatedByName":"MOARdV","CreatedById":60950,"CreatedDateTime":"2016-04-20T01:31:12Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222523874\u0022 data-ipsquote-contentid=\u0022137374\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221461114921\u0022 data-ipsquote-userid=\u002257416\u0022 data-ipsquote-username=\u0022DMagic\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n13 minutes ago, DMagic said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nOnPartCouple is used for docking. It gives a From and a To Part (the docking ports) and fires before the vessels are actually joined. The From vessel is not necessarily the active vessel, I think it is the dominant docking port, which is determined by other things.\n\u003C/p\u003E\n\u003Cp\u003E\nI think OnVesselCreate is the one used when undocking (and maybe decoupling, too).\n\u003C/p\u003E\n\u003Cp\u003E\nI think the SameVesselDocked/Undocked are used when two ports on the same vessel join together, not regular docking.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nHmm. \u00A0So there\u0027s not a clear way to tell who spawned a vessel when undocking? \u00A0I can look at the OnVesselWasModified sequence and hack something together with that, I suppose.\n\u003C/p\u003E\n\u003Cp\u003E\nThanks for pointing me at OnPartCouple.\n\u003C/p\u003E\n"},{"CreatedByName":"DMagic","CreatedById":57416,"CreatedDateTime":"2016-04-20T01:34:35Z","Content":"\n\u003Cp\u003E\nWell, there is an OnPartUndock event, I haven\u0027t really looked at it, but it sounds promising. I\u0027m not sure if it gets fired from both vessels or only the vessel with the active port.\n\u003C/p\u003E\n"},{"CreatedByName":"MOARdV","CreatedById":60950,"CreatedDateTime":"2016-04-20T02:44:34Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222523894\u0022 data-ipsquote-contentid=\u0022137374\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221461116075\u0022 data-ipsquote-userid=\u002257416\u0022 data-ipsquote-username=\u0022DMagic\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n1 hour ago, DMagic said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nWell, there is an OnPartUndock event, I haven\u0027t really looked at it, but it sounds promising. I\u0027m not sure if it gets fired from both vessels or only the vessel with the active port.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThat last time I enabled that one, I never saw it fire, either. \u00A0Although I don\u0027t remember when it was that I tried it last. \u00A0Guess I\u0027ll have to go poke at it some more.\n\u003C/p\u003E\n"},{"CreatedByName":"MOARdV","CreatedById":60950,"CreatedDateTime":"2016-04-20T18:53:16Z","Content":"\n\u003Cp\u003E\nOkay, here\u0027s what I found: OnPartCouple works as advertised, so I can collate databases upon docking easily.\n\u003C/p\u003E\n\u003Cp\u003E\nUndocking is trickier:\n\u003C/p\u003E\n\u003Cp\u003E\nonPartUndock fires, containing the part that undocked (this is seen by the old Vessel Module, or OVM).\n\u003C/p\u003E\n\u003Cp\u003E\nThe new vessel is created and the new craft\u0027s VesselModule wakes up (I\u0027ll call it NVM for New Vessel Module).\n\u003C/p\u003E\n\u003Cp\u003E\nAfter that, I see vessel modified callbacks: both OVM and NVM see onVesselModified for the new vessel. \u00A0Then, OnSave happens for the new vessel. \u00A0And, finally, I see vessel modified callbacks for the old vessel.\n\u003C/p\u003E\n\u003Cp\u003E\nI don\u0027t know what the criteria are for onVesselModified (that is, which VesselModules will see them, and what triggers them), so I don\u0027t think I want to merge values every time I see that callback, but maybe I can add some code to remember when a vessel sees the \u0022Undock\u0022 message, and use that knowledge to assume that the next VesselModified callback it sees refers to the newly-created undocked ship.\n\u003C/p\u003E\n"}]}