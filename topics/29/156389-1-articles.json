{"TopicId":156389,"ForumId":29,"TopicTitle":"How to suspend control when in a text entry field?","CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2017-02-13T13:55:34Z","PageNum":1,"Articles":[{"CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2017-02-13T13:55:34Z","Content":"\n\u003Cp\u003E\nI\u0027m pretty sure this is a KSP bug. \u00A0I had a request from a user:\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nQuote\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nRight now if I\u0027m in editor and want to rename my vessel to something long (e.g. Cool Massive Interplanetary Exploration Rocketship) it opens and sometimes then closes a half dozen windows and changes my symmetry count/changes mode/moves the camera/etc. This mod was doing the same while I was in-flight testing the identifiers. Don\u0027t even remember what I typed, but deactivated\u00A0\u003Cabbr title=\u0022Stability Augmentation System\u0022\u003ESAS\u003C/abbr\u003E,\u00A0\u003Cabbr title=\u0022Reaction Control System\u0022\u003ERCS\u003C/abbr\u003E, turned the ship a little, and switched off my persistent camera focus mod (\u0022o\u0022) all in the span of less than a\u00A0seconds while typing the name in the box.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027m wondering if there is any way to generalize this, so that a patch/mod can be written to fix this issue for all mods.\n\u003C/p\u003E\n\u003Cp\u003E\nany ideas, suggestions?\n\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2017-02-13T15:13:35Z","Content":"\n\u003Cp\u003E\nThis again? I discontinued my ControlLock mod when the new GUI system hit because this was supposed to no longer be an issue.\n\u003C/p\u003E\n\u003Cp\u003E\nI really haven\u0027t looked at the new system yet, what do we have for hooks/events on text boxes?\n\u003C/p\u003E\n\u003Cp\u003E\n(On mobile, best I can do at the moment is look up the API docs once I know the Class Name.)\n\u003C/p\u003E\n\u003Cp\u003E\nWill try and poke at this when I get home, the new GUI will require coding something from scratch probably though.\n\u003C/p\u003E\n\u003Cp\u003E\nD.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222017-02-13T15:14:01Z\u0022 title=\u002202/13/2017 03:14  PM\u0022 data-short=\u00227 yr\u0022\u003EFebruary 13, 2017\u003C/time\u003E by Diazo\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"DMagic","CreatedById":57416,"CreatedDateTime":"2017-02-13T16:27:14Z","Content":"\n\u003Cp\u003E\nIt\u0027s easy for the new UI.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nThe Text Input Field (and I assume the Text Mesh Pro input field) has an isFocused flag that is true whenever the input field is accepting text input.\n\u003C/p\u003E\n\u003Cp\u003E\nSo you can attach an OnPointerClick event to the field to activate the control lock, then monitor the focus flag to check for when the mouse is clicked somewhere else. You can also deactivate the control lock whenever the text input is submitted, either with another button, or by setting up \u0022Enter\u0022 to submit the text.\n\u003C/p\u003E\n\u003Cp\u003E\nThe latest version of SCANsat uses this method and it seems to work fine:\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://github.com/S-C-A-N/SCANsat/blob/dev/SCANsat.Unity/Unity/SCAN_SettingsData.cs#L120-L129\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/S-C-A-N/SCANsat/blob/dev/SCANsat.Unity/Unity/SCAN_SettingsData.cs#L120-L129\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://github.com/S-C-A-N/SCANsat/blob/dev/SCANsat.Unity/Unity/SCAN_SettingsData.cs#L30-L40\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/S-C-A-N/SCANsat/blob/dev/SCANsat.Unity/Unity/SCAN_SettingsData.cs#L30-L40\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://github.com/S-C-A-N/SCANsat/blob/dev/SCANsat/SCAN_Unity/SCAN_UI_Settings.cs#L397-L409\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/S-C-A-N/SCANsat/blob/dev/SCANsat/SCAN_Unity/SCAN_UI_Settings.cs#L397-L409\u003C/a\u003E\n\u003C/p\u003E\n"},{"CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2017-02-13T16:35:06Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222953870\u0022 data-ipsquote-contentid=\u0022156389\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221486998815\u0022 data-ipsquote-userid=\u002281549\u0022 data-ipsquote-username=\u0022Diazo\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n1 hour ago, Diazo said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nThis again? I discontinued my ControlLock mod when the new GUI system hit because this was supposed to no longer be an issue.\n\u003C/p\u003E\n\u003Cp\u003E\nI really haven\u0027t looked at the new system yet, what do we have for hooks/events on text boxes?\n\u003C/p\u003E\n\u003Cp\u003E\n(On mobile, best I can do at the moment is look up the API docs once I know the Class Name.)\n\u003C/p\u003E\n\u003Cp\u003E\nWill try and poke at this when I get home, the new GUI will require coding something from scratch probably though.\n\u003C/p\u003E\n\u003Cp\u003E\nD.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nYes, unfortunately.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222953941\u0022 data-ipsquote-contentid=\u0022156389\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221487003234\u0022 data-ipsquote-userid=\u002257416\u0022 data-ipsquote-username=\u0022DMagic\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n7 minutes ago, DMagic said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nIt\u0027s easy for the new UI.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nThe Text Input Field (and I assume the Text Mesh Pro input field) has an isFocused flag that is true whenever the input field is accepting text input.\n\u003C/p\u003E\n\u003Cp\u003E\nSo you can attach an OnPointerClick event to the field to activate the control lock, then monitor the focus flag to check for when the mouse is clicked somewhere else. You can also deactivate the control lock whenever the text input is submitted, either with another button, or by setting up \u0022Enter\u0022 to submit the text.\n\u003C/p\u003E\n\u003Cp\u003E\nThe latest version of SCANsat uses this method and it seems to work fine:\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://github.com/S-C-A-N/SCANsat/blob/dev/SCANsat.Unity/Unity/SCAN_SettingsData.cs#L120-L129\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/S-C-A-N/SCANsat/blob/dev/SCANsat.Unity/Unity/SCAN_SettingsData.cs#L120-L129\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://github.com/S-C-A-N/SCANsat/blob/dev/SCANsat.Unity/Unity/SCAN_SettingsData.cs#L30-L40\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/S-C-A-N/SCANsat/blob/dev/SCANsat.Unity/Unity/SCAN_SettingsData.cs#L30-L40\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://github.com/S-C-A-N/SCANsat/blob/dev/SCANsat/SCAN_Unity/SCAN_UI_Settings.cs#L397-L409\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/S-C-A-N/SCANsat/blob/dev/SCANsat/SCAN_Unity/SCAN_UI_Settings.cs#L397-L409\u003C/a\u003E\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nWhat I\u0027m wondering is, is it possible to write a single (new) mod which would take care of this for all \u00A0mods?\n\u003C/p\u003E\n\u003Cp\u003E\nAnd for me, right now, I have the problem in a dialog box:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003EPopupDialog.SpawnPopupDialog(new Vector2(0.5f, 0.5f),\n                    new Vector2(0.5f, 0.5f),\n                    new MultiOptionDialog(\u0022\u0022,\n                        \u0022Janitor\u0027s Toolbar\u0022,\n                        HighLogic.UISkin,\n                        new Rect(0.5f, 0.5f, 150f, 60f),\n                        new DialogGUIFlexibleSpace(),\n                        new DialogGUIVerticalLayout(\n                            new DialogGUIFlexibleSpace(),\n                            new DialogGUIButton(\u0022Confirm blacklisting button\u0022,\n                                delegate\n                                {\n                                    string s = buttonId(ClickedButton);\n                                    Log.Info(\u0022blacklistIconHash: \u0022 \u002B s);\n                                    blacklistIcons.Add(s, s);\n                                    saveBlacklistData(blacklistIcons);\n                                }, 140.0f, 30.0f, true),\n                           \n                            new DialogGUIButton(\u0022Cancel\u0022, () =\u0026gt; { }, 140.0f, 30.0f, true)\n                            )),\n                    false,\n                    HighLogic.UISkin);\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"DMagic","CreatedById":57416,"CreatedDateTime":"2017-02-13T16:54:36Z","Content":"\n\u003Cp\u003E\nWell you could do what I said, but just in a generic way.\n\u003C/p\u003E\n\u003Cp\u003E\nFind every text input field (regular Unity or TMP), add a OnPointerClick event handler, and turn on control locks whenever an input field is activated, then disable the locks when it loses focus. Of course this would be difficult to handle because there is probably no good way to detect when another mod or KSP opens up any given window.\n\u003C/p\u003E\n\u003Cp\u003E\nAnd it\u0027s not going to do anything to fix OnGUI input fields, and there probably isn\u0027t any way to handle them from outside the mod in question. It also probably won\u0027t be possible to interrupt other mods that use keyboard shortcuts.\n\u003C/p\u003E\n\u003Cp\u003E\nI haven\u0027t tried using the PopupDialog for input fields, but I assume it just creates a TMP input field, so you could probably manually add a listener to that object when you create the dialog.\n\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2017-02-13T16:59:01Z","Content":"\n\u003Cp\u003E\nI\u0027ve been thinking on this and I\u0027m not sure how to proceed.\n\u003C/p\u003E\n\u003Cp\u003E\nThe issue is that there is no way to lock out the keyboard, mods check the raw Unity keyDown method and there is no way to disable that. (At least mine do, I\u0027ve never heard of another way to detect keypresses.)\n\u003C/p\u003E\n\u003Cp\u003E\nEven unbinding the key doesn\u0027t stop this, every mod that detects keystrokes needs to be locked out individually in its own code.\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027ve actually been worried about this previously, \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/151312-preventing-keystroke-fallthrough-on-text-field-usage-between-different-modsinputlockmanager/\u0022 rel=\u0022\u0022\u003Ehttp://forum.kerbalspaceprogram.com/index.php?/topic/151312-preventing-keystroke-fallthrough-on-text-field-usage-between-different-modsinputlockmanager/\u003C/a\u003E but nothing really came of it at the time.\n\u003C/p\u003E\n\u003Cp\u003E\nI still have no better idea than the community agreeing to all use the ControlInputTypes.KeyboardInput as the agreed on method of telling each other if a textbox has focus.\n\u003C/p\u003E\n\u003Cp\u003E\nTo make this work would require the \u003Cem\u003Eentire\u003C/em\u003E community to agree that:\n\u003C/p\u003E\n\u003Cp\u003E\n1) Any mod that has a text box must set InputLockManager.AddLock(ControlInputTypes.KeyboardInput) to true when a textbox gains focus and removes the lock when the text box loses focus.\n\u003C/p\u003E\n\u003Cp\u003E\n2) Any mod that detects key presses must gate the keypress behind a check against InputLockManger and if the KeyboardInput lock is set, ignore the keypress because a text box has focus.\n\u003C/p\u003E\n\u003Cp\u003E\nBut even a community of this size getting 100% compliance with this is next to impossible.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nBut the only way for this to work in a single mod that takes care of it is to find some way in Unity to disable the Key(), KeyDown() and KeyUp() methods so they don\u0027t return values when keyboard keys are pressed and I have no clue how to go about that.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nSo, I have no good answers to how to do this.\n\u003C/p\u003E\n\u003Cp\u003E\nD.\n\u003C/p\u003E\n"},{"CreatedByName":"paulprogart","CreatedById":174587,"CreatedDateTime":"2017-02-13T23:59:21Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222953984\u0022 data-ipsquote-contentid=\u0022156389\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221487005141\u0022 data-ipsquote-userid=\u002281549\u0022 data-ipsquote-username=\u0022Diazo\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n6 hours ago, Diazo said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nThe issue is that there is no way to lock out the keyboard, mods check the raw Unity keyDown method and there is no way to disable that. (At least mine do, I\u0027ve never heard of another way to detect keypresses.)\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nNever mind mods, stock game even does this... like try moving the arrow keys to edit while typing into the description box on top of the \u003Cabbr title=\u0022Vehicle Assembly Building\u0022\u003EVAB\u003C/abbr\u003E/\u003Cabbr title=\u0022SpacePlane Hangar\u0022\u003ESPH\u003C/abbr\u003E and the camera will move (and other stuff).\u00A0 Drives me nuts.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n6 hours ago, Diazo said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nBut the only way for this to work in a single mod that takes care of it is to find some way in Unity to disable the Key(), KeyDown() and KeyUp() methods so they don\u0027t return values when keyboard keys are pressed and I have no clue how to go about that.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nI expect you\u0027d have to preempt the key detection at the OS level, which is of course not a cross-platform solution, and also a huge headache given Unity\u0027s design.\n\u003C/p\u003E\n\u003Cp\u003E\nEven if there were some way for Unity to prioritise and cancel events, all mods would just move towards asking for priority 1 anyhow, because mod makers would get tired of bugs due to other mods out-prioritising them.\u00A0 \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u00A0 So cooperation would be needed one way or another.\n\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2017-02-14T04:33:10Z","Content":"\n\u003Cp\u003E\nWell, assuming that Squad added checks on all their inputs to ignore them, there is some hope using InputLockManger.\n\u003C/p\u003E\n\u003Cp\u003E\nNotably, the TextMesh Pro that KSP now uses does in fact have OnFocus and OnFocusLost events that could be hooked into that (in theory) you could hook an event to so that all text input fields in the game automatically set InputLockManager(ControlLockType.KeyboardInput) which should cause stock commands to not execute.\n\u003C/p\u003E\n\u003Cp\u003E\nThey might be called OnSelect and OnDeselect in the version KSP actually uses? \u003Ca href=\u0022http://digitalnativestudios.com/forum/index.php?topic=111.msg9409#msg9409\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://digitalnativestudios.com/forum/index.php?topic=111.msg9409#msg9409\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nThat would still require every mod maker to gate their own keychecks behind a check against InputLockManager still, but it\u0027s part of a solution?\n\u003C/p\u003E\n\u003Cp\u003E\nOut of time for tonight, see if sleeping on it helps.\n\u003C/p\u003E\n\u003Cp\u003E\nD.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222017-02-14T04:34:20Z\u0022 title=\u002202/14/2017 04:34  AM\u0022 data-short=\u00227 yr\u0022\u003EFebruary 14, 2017\u003C/time\u003E by Diazo\u003C/strong\u003E\n\u003C/span\u003E\n"}]}