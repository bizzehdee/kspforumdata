{"TopicId":173808,"ForumId":29,"TopicTitle":"Atmosphere buggy in IVA cameras KSP 1.4.x (solved)","CreatedByName":"MOARdV","CreatedById":60950,"CreatedDateTime":"2018-04-12T12:02:11Z","PageNum":1,"Articles":[{"CreatedByName":"MOARdV","CreatedById":60950,"CreatedDateTime":"2018-04-12T12:02:11Z","Content":"\n\u003Cp\u003E\nI\u0027ve found that the cameras I add to parts don\u0027t render the atmosphere under certain conditions.\u00A0 When I launch a craft (from the \u003Cabbr title=\u0022Vehicle Assembly Building\u0022\u003EVAB\u003C/abbr\u003E or the Space Center scene), and I enter IVA and switch on external cameras (shortly after sunrise), I see this:\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u0022wJ7kKo.jpg\u0022 class=\u0022ipsImage\u0022 height=\u0022530\u0022 src=\u0022https://imageshack.com/a/img922/1079/wJ7kKo.jpg\u0022 width=\u0022939\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nIf I return to the Space Center and return to the craft and look at the cameras, I see this:\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u0022NHrrrQ.jpg\u0022 class=\u0022ipsImage\u0022 height=\u0022470\u0022 src=\u0022https://imageshack.com/a/img923/8468/NHrrrQ.jpg\u0022 width=\u0022985\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nSo, it self-corrects.\n\u003C/p\u003E\n\u003Cp\u003E\nThe second issue is that the skybox seems to be missing overhead.\u00A0 If I take one of the cameras and tilt it upwards, I eventually find the edge of the sky:\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u0022T18bHk.jpg\u0022 class=\u0022ipsImage\u0022 height=\u0022495\u0022 src=\u0022https://imageshack.com/a/img923/7806/T18bHk.jpg\u0022 width=\u0022933\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nLikewise, if I put a cameras on the top of the craft aimed straight up, the sky is black.\n\u003C/p\u003E\n\u003Cp\u003E\nI don\u0027t have Scatterer or \u003Cabbr title=\u0022Environmental Visual Enhancement (mod)\u0022\u003EEVE\u003C/abbr\u003E installed - the closest I have to a visual mod in this case is Distant Object Enhancement, and just to double-check, I removed that DLL as well.\n\u003C/p\u003E\n\u003Cp\u003E\nI create the cameras\u00A0\u003Ca href=\u0022https://github.com/MOARdV/AvionicsSystems/blob/ac19cef18c49ff53757b8b9265184ec4370a172e/Source/MASCamera.cs#L584\u0022 rel=\u0022external nofollow\u0022\u003Ehere\u003C/a\u003E, copying the existing flight cameras.\u00A0 This code worked in 1.3.x, and I\u0027m not sure what I need to do differently to work around it.\n\u003C/p\u003E\n\u003Cp\u003E\nOne thing I\u0027m doing is that all of the cameras write into the same render texture, but this same behavior has been used in MAS and RPM for several years.\n\u003C/p\u003E\n\u003Cp\u003E\nEDIT: Changed from \u0022skybox\u0022 to \u0022atmosphere\u0022, since it\u0027s the atmosphere not rendering at the surface.\n\u003C/p\u003E\n\u003Cp\u003E\nEDIT 2: Thanks to \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/57229-sirkut/\u0026amp;do=hovercard\u0022 data-mentionid=\u002257229\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/57229-sirkut/\u0022 rel=\u0022\u0022\u003E@sirkut\u003C/a\u003E, found the solution.\u00A0 GalaxyCamera and Camera ScaledSpace should not be translated; those cameras should only rotate.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222018-05-01T12:42:36Z\u0022 title=\u002205/01/2018 12:42  PM\u0022 data-short=\u00226 yr\u0022\u003EMay 1, 2018\u003C/time\u003E by MOARdV\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"MOARdV","CreatedById":60950,"CreatedDateTime":"2018-04-13T13:26:59Z","Content":"\n\u003Cp\u003E\nThis is actually a little different than I reported.\u00A0 I retested the \u0022camera aimed up has no sky\u0022 portion, and it turns out that\u0027s not true.\u00A0 On launch, the atmosphere is missing as previously mentioned, but if I go to the space center and return, it\u0027s restored, and I can pan the camera clear to the horizon and still see sky.\u00A0 It looks like the atmosphere layer is generated for maybe the hemisphere that the camera is facing at Start(), but it\u0027s unaware that\u00A0the camera transform was updated.\n\u003C/p\u003E\n\u003Cp\u003E\nI found an AtmosphereFromGround object, but it\u0027s completely undocumented.\n\u003C/p\u003E\n"},{"CreatedByName":"Burning Kan","CreatedById":163619,"CreatedDateTime":"2018-04-28T00:49:01Z","Content":"\n\u003Cp\u003E\nLooks like someone before had this glitch\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/171146-camera-woes/\u0022 rel=\u0022\u0022\u003Ehttps://forum.kerbalspaceprogram.com/index.php?/topic/171146-camera-woes/\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nsounds same for me ,maybe \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/57229-sirkut/\u0026amp;do=hovercard\u0022 data-mentionid=\u002257229\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/57229-sirkut/\u0022 rel=\u0022\u0022\u003E@sirkut\u003C/a\u003Efound a fix in the meantime\n\u003C/p\u003E\n\u003Cp\u003E\njust in case\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"sirkut","CreatedById":57229,"CreatedDateTime":"2018-04-28T00:53:27Z","Content":"\n\u003Cp\u003E\nI haven\u0027t found the fix as gave up for the time being and worked on getting my main portion of my mod finished. I do however need to get back into it and fix it. I ran into those weird issues.\n\u003C/p\u003E\n"},{"CreatedByName":"MOARdV","CreatedById":60950,"CreatedDateTime":"2018-04-28T14:45:55Z","Content":"\n\u003Cp\u003E\nWell, at least it\u0027s not just me...\u00A0\u00A0\u003Cimg alt=\u0022:huh:\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_undecided.gif\u0022 title=\u0022:huh:\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"MOARdV","CreatedById":60950,"CreatedDateTime":"2018-05-01T12:37:24Z","Content":"\n\u003Cp\u003E\nThanks to \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/57229-sirkut/\u0026amp;do=hovercard\u0022 data-mentionid=\u002257229\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/57229-sirkut/\u0022 rel=\u0022\u0022\u003E@sirkut\u003C/a\u003E\u00A0finding some example code from a mod that doesn\u0027t exhibit the problem, I\u0027ve sorted out the answer (which other people will probably say, \u0022well, duh!\u0022 to):\n\u003C/p\u003E\n\u003Cp\u003E\nI created copies of the flight cameras for my own camera, but on the prerender step, I rotated and moved all of them to match the parts position.\u00A0 That was the problem - the GalaxyCamera and Camera ScaledSpace are supposed to remain fixed, it would appear.\u00A0 Chasing the vessel around moved those cameras outside of the skyboxes and the like.\u00A0 So, simple solution.\n\u003C/p\u003E\n\u003Cp\u003E\nIn summary: prior to rendering, update the rotation of all the cameras.\u00A0 Update the location of only Camera 01, Camera 00, and FXCamera.\u00A0 GalaxyCamera and Camera ScaledSpace should not move.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222018-05-01T12:41:18Z\u0022 title=\u002205/01/2018 12:41  PM\u0022 data-short=\u00226 yr\u0022\u003EMay 1, 2018\u003C/time\u003E by MOARdV\u003C/strong\u003E\n\u003Cbr\u003ESlipped and hit Save before I was done\n\u003C/span\u003E\n"}]}