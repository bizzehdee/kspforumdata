{"TopicId":207260,"ForumId":29,"TopicTitle":"Displayed graphic is jumping when rover gets too far","CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2022-03-13T14:41:48Z","PageNum":1,"Articles":[{"CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2022-03-13T14:41:48Z","Content":"\n\u003Cp\u003E\nI\u0027m working on reviving RoverScience.\u00A0 There is an old bug where if you get too far away (about 400m or so) from the displayed science dome, the location of the dome jumps.\u00A0 I believe this is due to the reference coordinates changing as the rover moves over the planet surface.\n\u003C/p\u003E\n\u003Cp\u003E\nI tried adding this code:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\u003Cspan class=\u0022pln\u0022\u003Evoid Start()\n{\n\t GameEvents.onVesselReferenceTransformSwitch.Add(UpdateMarkerPositionInvoked);\n}\n        void UpdateMarkerPositionInvoked(Transform t1, Transform t2)\n        {\n            DrawWaypoint.Instance.SetMarkerLocation(RoverScience.Instance.rover.scienceSpot.location.longitude, RoverScience.Instance.rover.scienceSpot.location.latitude, spawningObject: false);\n        }\n\n\n        public void SetMarkerLocation(double longitude, double latitude, bool spawningObject = true)\n        {\n            DestroyInterestingObject();\n\n            Vector3 bottomPoint = FlightGlobals.currentMainBody.GetWorldSurfacePosition(latitude, longitude, 0);\n            Vector3 topPoint = FlightGlobals.currentMainBody.GetWorldSurfacePosition(latitude, longitude, 1000);\n\n            double surfaceAltitude = GetSurfaceAltitude(longitude, latitude);\n            marker.transform.position = FlightGlobals.currentMainBody.GetWorldSurfacePosition(latitude, longitude, surfaceAltitude);\n\n            marker.transform.localScale = new Vector3(markerSizeMax, markerSizeMax, markerSizeMax);\n            markerRed.a = maxAlpha;\n\n       }\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nbut it seems that the gameevent I am trying to use isn\u0027t the right one.\n\u003C/p\u003E\n\u003Cp\u003E\nFor now, I added the following which works, but obviously isn\u0027t the best:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\u003Cspan class=\u0022pln\u0022\u003Evoid Start()\n{\n\tInvokeRepeating(\u0022UpdateMarkerPosition\u0022, 0.1f, 0.1f);\n}\n\nvoid UpdateMarkerPosition()\n{\n\tDrawWaypoint.Instance.SetMarkerLocation(RoverScience.Instance.rover.scienceSpot.location.longitude, RoverScience.Instance.rover.scienceSpot.location.latitude, spawningObject: false);\n}\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nSo how do I find out when the reference coordinates change?\u00A0\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"Gotmachine","CreatedById":163039,"CreatedDateTime":"2022-03-13T19:02:09Z","Content":"\n\u003Cp\u003E\nonVesselReferenceTransformSwitch is for when the \u0022control from here\u0022 part is modified, this is indeed unlikely to help in any way.\n\u003C/p\u003E\n\u003Cp\u003E\nYou could try offsetting the marker.transform.position by the value returned by GameEvent. onFloatingOriginShift, by I have some doubts this will work.\n\u003C/p\u003E\n\u003Cp\u003E\nThe best way to make things work is likely to have your marker object a child object of the local CelestialBody, instead of having it floating around in world space.\n\u003C/p\u003E\n"},{"CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2022-03-13T22:48:10Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00224102217\u0022 data-ipsquote-contentid=\u0022207260\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221647198129\u0022 data-ipsquote-userid=\u0022163039\u0022 data-ipsquote-username=\u0022Gotmachine\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n4 hours ago, Gotmachine said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nonVesselReferenceTransformSwitch is for when the \u0022control from here\u0022 part is modified, this is indeed unlikely to help in any way.\n\u003C/p\u003E\n\u003Cp\u003E\nYou could try offsetting the marker.transform.position by the value returned by GameEvent. onFloatingOriginShift, by I have some doubts this will work.\n\u003C/p\u003E\n\u003Cp\u003E\nThe best way to make things work is likely to have your marker object a child object of the local CelestialBody, instead of having it floating around in world space.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThanks, I\u0027ll have to look at that.\u00A0 This is an old mod, while I\u0027ve gotten it working, there were open bugs and a lot of inefficiencies there.\u00A0 I\u0027ll look at the code to see if I can do that easily, otherwise what I have does does, just not the best way to do it\n\u003C/p\u003E\n\u003Cp\u003E\nCurrently this is the code that creates the object:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\u003Cspan class=\u0022pln\u0022\u003E            marker = GameObject.CreatePrimitive(PrimitiveType.Sphere);\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nI\u0027ll have to figure out how to create it as a child of the local celestial body\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nEdit:\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/163039-gotmachine/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022163039\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/163039-gotmachine/\u0022 rel=\u0022\u0022\u003E@Gotmachine\u003C/a\u003EWould this do it:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\u003Cspan class=\u0022pln\u0022\u003E            marker = GameObject.CreatePrimitive(PrimitiveType.Sphere);\n            marker.transform.parent = FlightGlobals.ActiveVessel.mainBody.transform;\n\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222022-03-13T23:25:30Z\u0022 title=\u002203/13/2022 11:25  PM\u0022 data-short=\u00222 yr\u0022\u003EMarch 13, 2022\u003C/time\u003E by linuxgurugamer\u003C/strong\u003E\n\u003C/span\u003E\n"}]}