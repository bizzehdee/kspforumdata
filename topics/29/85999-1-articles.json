{"TopicId":85999,"ForumId":29,"TopicTitle":"Create an orbit above current orbit","CreatedByName":"m1nd0","CreatedById":69328,"CreatedDateTime":"2014-10-03T19:48:35Z","PageNum":1,"Articles":[{"CreatedByName":"m1nd0","CreatedById":69328,"CreatedDateTime":"2014-10-03T19:48:35Z","Content":"\n\u003Cp\u003EHey,\u003C/p\u003E\u003Cp\u003EI\u0027m trying to create an orbit which is X meters above the current orbit. I am however not able to get it to work.\u003C/p\u003E\u003Cp\u003EThis is the code I got so far:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E        private Orbit CreateOrbitAroundAndNear(CelestialBody body, Orbit nearOrbit, int minAltitude, int maxAltitude)\u003Cbr\u003E        {\u003Cbr\u003E            Orbit orbit = new Orbit();\u003Cbr\u003E            orbit.referenceBody = body;\u003Cbr\u003E            orbit.eccentricity = (double)UnityEngine.Random.Range(0.0001f, 0.01f);\u003Cbr\u003E\u003Cbr\u003E            orbit.semiMajorAxis = (double)UnityEngine.Random.Range((float)(body.Radius) \u002B (float)minAltitude, (float)(body.Radius) \u002B (float)maxAltitude);\u003Cbr\u003E            orbit.inclination = (double)UnityEngine.Random.Range((-1.0f / 10.0f), 1.0f / 10.0f);\u003Cbr\u003E\u003Cbr\u003E            orbit.LAN = (double)UnityEngine.Random.Range(0.999f, 1.001f);\u003Cbr\u003E\u003Cbr\u003E            orbit.argumentOfPeriapsis = (double)UnityEngine.Random.Range(0.999f, 1.001f);\u003Cbr\u003E            orbit.meanAnomalyAtEpoch = (double)UnityEngine.Random.Range(0.999f, 1.001f);\u003Cbr\u003E\u003Cbr\u003E            orbit.epoch = (double)UnityEngine.Random.Range(0.999f, 1.001f);\u003Cbr\u003E            orbit.Init();\u003Cbr\u003E            return orbit;\u003Cbr\u003E        }\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EI tried making the LAN, epoch and incination the same as the nearOrbit but that doesn\u0027t help much. When I create random orbits till one is close I notice that the almost basically only the semiMajorAxis is close to the original orbit:\u003C/p\u003E\u003Cp\u003E[LOG 21:42:33.989] LAN My: 115.483481610485 -- NewObj: 1.00026094913483\u003C/p\u003E\u003Cp\u003E[LOG 21:42:33.990] Epoch My: 30235055.4039439 -- NewObj: 0.999513447284698\u003C/p\u003E\u003Cp\u003E[LOG 21:42:33.990] Inclination My: 0 -- NewObj: -0.0787511840462685\u003C/p\u003E\u003Cp\u003EDoes anyone have an idea? Main idea is the new orbit should be within 10km of current orbit at a new height.\u003C/p\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2014-10-04T00:40:18Z","Content":"\n\u003Cp\u003EIs it possible that the problem is that Orbit is rejecting values that are geometrically impossible because other fields you aren\u0027t setting are defaulting to values that contradict your settings? (i.e. imagine if you set the eccentricity to 1.5, but don\u0027t set the orbit\u0027s periapsis and apoapsis values.) Could it be that instead of altering periapsis and apopasis to match eccentricity, it\u0027s actually just rejecting the values you\u0027re giving it for being contradictory?)\u003C/p\u003E\u003Cp\u003ESimilar interdependencies between the values exist throughout the Orbit object\u0027s fields and properties, and it looks from the API as if it does not enforce the guarantee that you can only set the values in ways that are geometrically possible. Because KSP allows a lot more setting of public fields than it probably should (a lot of things it does with fields should really be wrapped in properties or method calls), it allows users of the API to create logically bogus sets of values.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-10-04T00:44:05Z\u0022 title=\u002210/04/2014 12:44  AM\u0022 data-short=\u00229 yr\u0022\u003EOctober 4, 2014\u003C/time\u003E by Steven Mading\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"m1nd0","CreatedById":69328,"CreatedDateTime":"2014-10-04T01:12:56Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Steven Mading\u0022 data-cite=\u0022Steven Mading\u0022\u003E\u003Cdiv\u003EIs it possible that the problem is that Orbit is rejecting values that are geometrically impossible because other fields you aren\u0027t setting are defaulting to values that contradict your settings? (i.e. imagine if you set the eccentricity to 1.5, but don\u0027t set the orbit\u0027s periapsis and apoapsis values.) Could it be that instead of altering periapsis and apopasis to match eccentricity, it\u0027s actually just rejecting the values you\u0027re giving it for being contradictory?)\u003Cp\u003ESimilar interdependencies between the values exist throughout the Orbit object\u0027s fields and properties, and it looks from the API as if it does not enforce the guarantee that you can only set the values in ways that are geometrically possible. Because KSP allows a lot more setting of public fields than it probably should (a lot of things it does with fields should really be wrapped in properties or method calls), it allows users of the API to create logically bogus sets of values.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThe code above is actually the code KSP uses to create a random orbit around a body. I just added the \u0022nearOrbit\u0022 part which I need to implement.\u003C/p\u003E\n"},{"CreatedByName":"hypermonkey","CreatedById":123495,"CreatedDateTime":"2014-10-04T12:16:47Z","Content":"\n\u003Cp\u003EI think this is what you want\u003C/p\u003E\u003Cp\u003EdeltaSMA is in meters\u003C/p\u003E\u003Cp\u003EKeep in mind that an orbit can only be a fixed distance above another orbit if both are circular (eccentricity = 0).\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Epublic static Orbit CreateOrbitAroundAndNear(Orbit currentOrbit, double deltaSMA)\u003Cbr\u003E        {\u003Cbr\u003E\u003Cbr\u003E            Orbit nearOrbit = new Orbit();\u003Cbr\u003E            nearOrbit.referenceBody = currentOrbit.referenceBody;\u003Cbr\u003E            nearOrbit.eccentricity = currentOrbit.eccentricity;\u003Cbr\u003E\u003Cbr\u003E            nearOrbit.semiMajorAxis = currentOrbit.semiMajorAxis \u002B deltaSMA;\u003Cbr\u003E            nearOrbit.inclination = currentOrbit.inclination;\u003Cbr\u003E\u003Cbr\u003E            nearOrbit.LAN = currentOrbit.LAN;\u003Cbr\u003E\u003Cbr\u003E            nearOrbit.argumentOfPeriapsis = currentOrbit.argumentOfPeriapsis;\u003Cbr\u003E            nearOrbit.meanAnomalyAtEpoch = currentOrbit.meanAnomalyAtEpoch;\u003Cbr\u003E\u003Cbr\u003E            nearOrbit.epoch = currentOrbit.epoch;\u003Cbr\u003E            nearOrbit.Init();\u003Cbr\u003E            return nearOrbit;\u003Cbr\u003E\u003Cbr\u003E        }\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n"},{"CreatedByName":"m1nd0","CreatedById":69328,"CreatedDateTime":"2014-10-06T07:28:17Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022hypermonkey\u0022 data-cite=\u0022hypermonkey\u0022\u003E\u003Cdiv\u003EI think this is what you want\u003Cp\u003EdeltaSMA is in meters\u003C/p\u003E\u003Cp\u003EKeep in mind that an orbit can only be a fixed distance above another orbit if both are circular (eccentricity = 0).\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Epublic static Orbit CreateOrbitAroundAndNear(Orbit currentOrbit, double deltaSMA)\u003Cbr\u003E        {\u003Cbr\u003E\u003Cbr\u003E            Orbit nearOrbit = new Orbit();\u003Cbr\u003E            nearOrbit.referenceBody = currentOrbit.referenceBody;\u003Cbr\u003E            nearOrbit.eccentricity = currentOrbit.eccentricity;\u003Cbr\u003E\u003Cbr\u003E            nearOrbit.semiMajorAxis = currentOrbit.semiMajorAxis \u002B deltaSMA;\u003Cbr\u003E            nearOrbit.inclination = currentOrbit.inclination;\u003Cbr\u003E\u003Cbr\u003E            nearOrbit.LAN = currentOrbit.LAN;\u003Cbr\u003E\u003Cbr\u003E            nearOrbit.argumentOfPeriapsis = currentOrbit.argumentOfPeriapsis;\u003Cbr\u003E            nearOrbit.meanAnomalyAtEpoch = currentOrbit.meanAnomalyAtEpoch;\u003Cbr\u003E\u003Cbr\u003E            nearOrbit.epoch = currentOrbit.epoch;\u003Cbr\u003E            nearOrbit.Init();\u003Cbr\u003E            return nearOrbit;\u003Cbr\u003E\u003Cbr\u003E        }\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThank you for the help, however you now create an orbit around the current vessels orbit. What is need is a fixed circular orbit of 100 kmwhere the new orbit is near the orbit of the reference vessel. So the argument of periapsis (i think) should be something which would make the orbit near the reference vessel.\u003C/p\u003E\u003Cp\u003ETo put in in context. I lift of with my vessel and at some point I\u0027ll get near 100km, I want to spawn vessels once you start approaching 100km in a circular orbit at this height near the ascending vessel..\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-10-06T07:31:29Z\u0022 title=\u002210/06/2014 07:31  AM\u0022 data-short=\u00229 yr\u0022\u003EOctober 6, 2014\u003C/time\u003E by m1nd0\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"philotical","CreatedById":109390,"CreatedDateTime":"2014-10-06T09:09:05Z","Content":"\n\u003Cp\u003EIn NCI, I do fixed height orbits that way:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E                    myVessel.orbitDriver.orbit = Orbit.CreateRandomOrbitAround(SelectedBody, minAlt, maxAlt);\u003Cbr\u003E                    myVessel.orbitDriver.orbit.LAN = OrbitLan;\u003Cbr\u003E                    myVessel.orbitDriver.orbit.argumentOfPeriapsis = OrbitW;\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003Eif you set min and max alt only 1 meter apart, it usually gives an orbit quite where you wanted - precision is about 30-100 meters from what I can tell..\u003C/p\u003E\u003Cp\u003EHTH\u003C/p\u003E\n"},{"CreatedByName":"m1nd0","CreatedById":69328,"CreatedDateTime":"2014-10-06T21:18:21Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022philotical\u0022 data-cite=\u0022philotical\u0022\u003E\u003Cdiv\u003EIn NCI, I do fixed height orbits that way:\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E                    myVessel.orbitDriver.orbit = Orbit.CreateRandomOrbitAround(SelectedBody, minAlt, maxAlt);\u003Cbr\u003E                    myVessel.orbitDriver.orbit.LAN = OrbitLan;\u003Cbr\u003E                    myVessel.orbitDriver.orbit.argumentOfPeriapsis = OrbitW;\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003Eif you set min and max alt only 1 meter apart, it usually gives an orbit quite where you wanted - precision is about 30-100 meters from what I can tell..\u003C/p\u003E\u003Cp\u003EHTH\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThat works as long as my own orbit is circular. As soon as my eccentricity becomes to far from 0 it stops working. I\u0027ve had several attempts as most of them seem to work untill I change my orbit and my own eccentricity becomes larger then 0.05. \u003C/p\u003E\u003Cp\u003EI even tried with only setting the argumentOfPeriapsis, but even then it the new orbit still doesn\u0027t make any sence.\u003C/p\u003E\u003Cp\u003EThis is with only argumentOfPeriapsis:\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://puu.sh/c27B8/ee39c4af5c.jpg\u0022 alt=\u0022ee39c4af5c.jpg\u0022\u003E\u003C/p\u003E\u003Cp\u003EThis is with LAN and argumentOfperiapsis:\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://puu.sh/c27Hg/a2a4cb60b1.jpg\u0022 alt=\u0022a2a4cb60b1.jpg\u0022\u003E\u003C/p\u003E\u003Cp\u003EAs you can see only setting argumentOfperiapsis comes closest but still is far from what it should be. \u003C/p\u003E\u003Cp\u003EAnnother one with LAN and argumentOfperiapsis:\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://puu.sh/c27Yn/fc1e0ecc9e.jpg\u0022 alt=\u0022fc1e0ecc9e.jpg\u0022\u003E\u003C/p\u003E\u003Cp\u003EFrom this I can sort of tell the angle is calculated from the center of the orbit. So I\u0027m guessing I will have to do some angle calculations and adjust the LAN based on the offset of the orbit center? This is just a bit to much for me to comprehend.\u003C/p\u003E\n"},{"CreatedByName":"philotical","CreatedById":109390,"CreatedDateTime":"2014-10-06T21:43:01Z","Content":"\n\u003Cp\u003EI see..\u003C/p\u003E\u003Cp\u003Elot\u0027s of guess work..\u003C/p\u003E\u003Cp\u003EI can\u0027t help much more from remote.. - I\u0027 also just guessing..\u003C/p\u003E\u003Cp\u003Ebut don\u0027t give up..\u003C/p\u003E\u003Cp\u003Egood luck..\u003C/p\u003E\n"}]}