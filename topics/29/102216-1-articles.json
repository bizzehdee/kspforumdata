{"TopicId":102216,"ForumId":29,"TopicTitle":"[Technically RESOLVED] Which class to inherit from? - New plugin for very basic ship control","CreatedByName":"wossname","CreatedById":118005,"CreatedDateTime":"2015-03-18T19:18:47Z","PageNum":1,"Articles":[{"CreatedByName":"wossname","CreatedById":118005,"CreatedDateTime":"2015-03-18T19:18:47Z","Content":"Howdy,\n\nI have just started to create my first KSP plugin. I\u0027m up to the point where my IDE is set up correctly according to the tutorial here: [http://wiki.kerbalspaceprogram.com/wiki/Plugins](http://wiki.kerbalspaceprogram.com/wiki/Plugins).\n\nMy goal for now is to make a very simplistic proof-of-concept plugin that simply lets me activate the first stage of a rocket, say 10 seconds or so after spawning on the launchpad.\n\nI do not need any kind of graphical interface whatsoever (writing text to the log file will be sufficient), and the plugin only needs to be enabled when the vessel is actively engaged in a flight (from the launchpad and up until the end of the flight, but not in the VAB).\n\nI want to be able to switch between vehicles (when the user hits the [ and ] keys) and have my plugin affect the next vessel selected, so it \u0022follows\u0022 the focus of the main GUI controls such as mouse and keyboard.\n\nI don\u0027t want to have a \u0022physical\u0022 rocket part that I have to attach to the vessel in order to make my plugin available.\n\nThe tutorials I have seen generally assume that we are trying to make a physical part for a ship, but I just want something more to do with non-graphical flight interface augmentation.\n\nThe tutorials use \u0022PartModule\u0022 as the parent class (which seems to have some baggage with it involving config files). Given that I don\u0027t want to make a part as such, is there a more suitable class to inherit from? There\u0027s a lot of classes to choose from by the looks of it, could use some guidance.\n\nCheers.\n\nw."},{"CreatedByName":"NathanKell","CreatedById":75006,"CreatedDateTime":"2015-03-18T19:46:13Z","Content":"Moved to Plugin Development.\n\nYou\u0027re going to want to make a KSPAddon. Example:\n\n    [KSPAddon(KSPAddon.Startup.Flight, false)]class ControlLocker : MonoBehaviour\n\nKSPAddons take a startup scene (one of the scenes, or all) and a bool that says whether to start up every time the scene loads or to run only once (you presumably want runonce=true if you\u0027re doing some changes on KSP start, like at the main menu, and don\u0027t want to doubly change things when someone goes back to main menu).\n\nYou can then write various MonoBehaviour methods, like Start(), FixedUpdate(), Update, etc. Presumably you would want to have a double counter = 0, run on FixedUpdate and once FlightGlobals.ready increment the counter by TimeWarp.fixedDeltaTime, and when counter \u003E 10 do FlightGlobals.activevessel.stage or whatever."},{"CreatedByName":"FreeThinker","CreatedById":117389,"CreatedDateTime":"2015-03-18T19:46:15Z","Content":"I suggest you look at the source code of any mod which does anything at startup.\n\n**Edited \u003Ctime datetime=\u00222015-03-18T19:48:22Z\u0022 title=\u002203/18/2015 07:48  PM\u0022 data-short=\u00229 yr\u0022\u003EMarch 18, 2015\u003C/time\u003E by FreeThinker**"},{"CreatedByName":"wossname","CreatedById":118005,"CreatedDateTime":"2015-03-18T20:14:26Z","Content":"Thank you NathanKell and FreeThinker for replying.\n\nI\u0027ve been looking at the \u0022KSPSerialIO\u0022 plugin to try to understand how this all hangs together but I\u0027m struggling to see where the entry point is for it. Where are things like \u0022Start()\u0022 and \u0022FixedUpdate()\u0022 actually defined? They don\u0027t seem to be defined inside the MonoBehaviour class as far as I can see from looking at the VisualStudio object browser (\u0022show definition\u0022 when highlighting the MonoBehaviour class name).\n\nIf I\u0027m going to override those then don\u0027t I need to be able to see the base class\u0027s definition of it in the IDE? Sorry, my C# is pretty rusty, it\u0027s been a few years."},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2015-03-18T20:18:38Z","Content":"Awake, Start, Update, FixedUpdate, LateUpdate, OnGUI, OnDestroy, etc. are inherited from Unity\u0027s Monobehaviour (see the flowchart [here](http://docs.unity3d.com/Manual/ExecutionOrder.html) for details on when each one executes). PartModule also inherits from Monobehaviour, but also has it\u0027s own extra versions of those (eg. OnFixedUpdate) which only run when the part is active\n\n**Edited \u003Ctime datetime=\u00222015-03-18T20:20:51Z\u0022 title=\u002203/18/2015 08:20  PM\u0022 data-short=\u00229 yr\u0022\u003EMarch 18, 2015\u003C/time\u003E by Crzyrndm**"},{"CreatedByName":"wossname","CreatedById":118005,"CreatedDateTime":"2015-03-18T20:35:42Z","Content":"OK so this class library I\u0027m writing needs to conform to the Unity \u0022interface\u0022 (to use a C\u002B\u002B term) but that interface isn\u0027t visible from within the C# IDE?\n\nAt least I can\u0027t see these definitions in my current setup. I\u0027ll double check my library references in case I missed something.\n\nEdit: Well I can see my code being called in KSP but I don\u0027t understand how.\n\nIt\u0027s very weird but it is working... where is the \u0022contract\u0022 between my library and the Unity Engine? Confused - but happy it works. ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\nI\u0027d be grateful for a description of how Unity knows that my library is the right shape or not. Will it all explode in a heap if I get the slightest thing wrong?\n\n**Edited \u003Ctime datetime=\u00222015-03-18T20:48:05Z\u0022 title=\u002203/18/2015 08:48  PM\u0022 data-short=\u00229 yr\u0022\u003EMarch 18, 2015\u003C/time\u003E by wossname**"},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2015-03-18T20:38:30Z","Content":"Nada, they aren\u0027t there (I just checked)\n\nPS\n\nIt\u0027s not overriding per se. Functions with those names are added to the list to be called at certain events (frame, physics update, etc.), they don\u0027t replace anything\n\n**Edited \u003Ctime datetime=\u00222015-03-18T20:42:23Z\u0022 title=\u002203/18/2015 08:42  PM\u0022 data-short=\u00229 yr\u0022\u003EMarch 18, 2015\u003C/time\u003E by Crzyrndm**"},{"CreatedByName":"stupid_chris","CreatedById":62017,"CreatedDateTime":"2015-03-18T21:15:32Z","Content":"Unity calls all those functions through Reflection by looking into all the objects loaded in the game that inherit MonoBehaviour. It\u0027s a really bad way to do it, but Unity will be Unity. Just take it as it is. The functions will be called at the right moments. If you want the complete list of functions that Ynity can call, you can find them [here](http://docs.unity3d.com/ScriptReference/MonoBehaviour.html) (under \u0022Messages\u0022)."},{"CreatedByName":"wossname","CreatedById":118005,"CreatedDateTime":"2015-03-18T21:29:19Z","Content":"Yeah, I think I should have used the wording \u0022implementing those functions\u0022 rather than overriding.\n\nMy original question is answered, thank you. I now know that I can inherit from the MonoBehaviour class for my purposes.\n\nBut I\u0027d like to understand the reason why the IDE doesn\u0027t show at least some kind of placeholder for these functions. The \u0022...\\KSP\\_Data\\Managed\\UnityEngine.dll\u0022 is recognised by the VS IDE since I can see at least some of the class definition for the MonoBehaviour class, just not the bits that are vital for the code to work.\n\nAnyway, I\u0027ll continue to ponder this conundrum.\n\nMany thanks.\n\nw.\n\n- - - Updated - - -\n\n\u003E \n\u003E Unity calls all those functions through Reflection by looking into all the objects loaded in the game that inherit MonoBehaviour. It\u0027s a really bad way to do it, but Unity will be Unity. Just take it as it is. The functions will be called at the right moments. If you want the complete list of functions that Ynity can call, you can find them [here](http://docs.unity3d.com/ScriptReference/MonoBehaviour.html) (under \u0022Messages\u0022).\n\nI did wonder if some sort of duck-typing was going on somehow. Reflection makes sense.\n\nI have been in the wrong frame of mind while trying to write this first plugin. The right frame of mind is something like \u0022O, great Unity, please accept this puny DLL offering and this dead chicken and grant me a few hours of prosperous rocketry!\u0022 ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)"},{"CreatedByName":"stupid_chris","CreatedById":62017,"CreatedDateTime":"2015-03-18T21:32:33Z","Content":"\u003E \n\u003E I did wonder if some sort of duck-typing was going on somehow. Reflection makes sense.\n\u003E I have been in the wrong frame of mind while trying to write this first plugin. The right frame of mind is something like \u0022O, great Unity, please accept this puny DLL offering and this dead chicken and grant me a few hours of prosperous rocketry!\u0022 ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\nDon\u0027t wory about it. It\u0027s a really terrible way to do it. By all means, if you were to do a system like that, invoking functions through Reflection this way is NOT the way to do it."},{"CreatedByName":"wossname","CreatedById":118005,"CreatedDateTime":"2015-03-18T21:52:39Z","Content":"At least I know the trick to this now, so I can get on with it knowing that it really is just a weird interface.\n\nI\u0027m hoping that my final plugin can be simple enough that it uses as few of these \u0022invisible\u0022 functions as possible but still accomplish quite a lot.\n\nThe main reason I\u0027m trying to get this working is to make some electronic hardware I\u0027m building talk with KSP to control the rocket.\n\nIf I can get as much of the complexity abstracted out and away from KSP as possible then the plugin itself should be easily maintainable.\n\nOh boy, hardware design is so much easier than software. I don\u0027t know how you pro\u0027s do it!"},{"CreatedByName":"stupid_chris","CreatedById":62017,"CreatedDateTime":"2015-03-18T21:53:48Z","Content":"\u003E \n\u003E Oh boy, hardware design is so much easier than software. I don\u0027t know how you pro\u0027s do it!\n\nI can\u0027t tell exactly cause I don\u0027t really know either, but I can tell you ridiculous amounts of coffee are involved."},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2015-03-18T22:11:10Z","Content":"For a control plugin, you probably only need Start and OnDestroy.\n\nIn start you can register a function to enact all your control like [this](https://github.com/Crzyrndm/Pilot-Assistant/blob/master/PilotAssistant/PilotAssistant.cs#L109) (3 versions. onpre-, on-, onpost-), which does away with the need for FixedUpdate, and you don\u0027t need the rest if it\u0027s being handled by hardware\n\n**Edited \u003Ctime datetime=\u00222015-03-18T22:14:12Z\u0022 title=\u002203/18/2015 10:14  PM\u0022 data-short=\u00229 yr\u0022\u003EMarch 18, 2015\u003C/time\u003E by Crzyrndm**"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2015-03-18T23:12:06Z","Content":"Hum, for a control you would need to use the vessel OnFlyByWire callback to input controls (yaw, pitch, roll, RCS, throttle, ...) . You can have a look at Mechjeb [MechJebCore](https://github.com/MuMech/MechJeb2/blob/master/MechJeb2/MechJebCore.cs) to see how we do it."}]}