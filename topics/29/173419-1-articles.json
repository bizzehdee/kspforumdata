{"TopicId":173419,"ForumId":29,"TopicTitle":"How to find partcount of type on current vessel","CreatedByName":"CWhizard","CreatedById":187640,"CreatedDateTime":"2018-04-03T08:26:03Z","PageNum":1,"Articles":[{"CreatedByName":"CWhizard","CreatedById":187640,"CreatedDateTime":"2018-04-03T08:26:03Z","Content":"\n\u003Cp\u003E\nSo I need to find out if there is a science lab on board the ship.\u00A0 How can I do this?\n\u003C/p\u003E\n"},{"CreatedByName":"Snark","CreatedById":125662,"CreatedDateTime":"2018-04-03T17:04:02Z","Content":"\n\u003Cp\u003E\nHello, and welcome to the forum!\u00A0 \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223343502\u0022 data-ipsquote-contentid=\u0022173419\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221522743963\u0022 data-ipsquote-userid=\u0022187640\u0022 data-ipsquote-username=\u0022CWhizard\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n8 hours ago, CWhizard said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nSo I need to find out if there is a science lab on board the ship.\u00A0 How can I do this?\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThere are a couple of different ways, depending on what exactly you want to do.\u00A0 Which of the following is the case?\n\u003C/p\u003E\n\u003Col\u003E\u003Cli\u003E\nYou want to know, \u003Cem\u003E\u003Cu\u003Especifically\u003C/u\u003E\u003C/em\u003E, whether there are any instances of the \u003Ca href=\u0022https://wiki.kerbalspaceprogram.com/wiki/Mobile_Processing_Lab_MPL-LG-2\u0022 rel=\u0022external nofollow\u0022\u003EMPL-LG-2 Mobile Processing Lab\u003C/a\u003E on the ship.\n\u003C/li\u003E\n\u003Cli\u003E\nYou want to know how many \u003Cem\u003E\u003Cu\u003Escience labs in general\u003C/u\u003E\u003C/em\u003E there are on the ship-- i.e. how many parts that can do the same thing that the MPL can.\n\u003C/li\u003E\n\u003C/ol\u003E\u003Cp\u003E\nIn the stock game, the above two questions end up having the same answer, because there \u003Cem\u003E\u003Cu\u003Eis\u003C/u\u003E\u003C/em\u003E only one part in the stock game that can do what the MPL does, and that\u0027s the MPL.\u00A0 \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u00A0 But if the player is using a modded game, they may be running a mod that introduces additional modded parts that have that same functionality, so the question is, do you want to count such parts too, or not?\n\u003C/p\u003E\n\u003Cp\u003E\nBoth of these things are doable in a fairly straightforward fashion; it\u0027s just a question of which way you want to code it.\n\u003C/p\u003E\n\u003Cp\u003E\nLet\u0027s take them one by one.\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cstrong\u003EFind out specifically how many instances of the MPL there are on the ship:\u003C/strong\u003E\n\u003C/p\u003E\n\u003Col\u003E\u003Cli\u003E\nGet the \u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003E\u003Cstrong\u003EVessel\u003C/strong\u003E \u003C/span\u003Eobject you want to examine (e.g. via \u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003EPartModule.vessel \u003C/span\u003Eproperty if you\u0027re in the code for your PartModule, or via \u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003EFlightGlobals.ActiveVessel\u003C/span\u003E if you\u0027re in a MonoBehaviour script).\n\u003C/li\u003E\n\u003Cli\u003E\nThe vessel has a \u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003E\u003Cstrong\u003Eparts\u003C/strong\u003E \u003C/span\u003Eproperty, which is of type \u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003EList\u0026lt;Part\u0026gt;\u003C/span\u003E.\n\u003C/li\u003E\n\u003Cli\u003E\nIterate through that list.\u00A0 (Use a \u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003Efor \u003C/span\u003Eloop with index, not a \u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003Eforeach \u003C/span\u003Eloop, as the latter will spam your GC).\n\u003C/li\u003E\n\u003Cli\u003E\nAs you examine each \u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003EPart \u003C/span\u003Eobject in the parts list, check its \u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003E\u003Cstrong\u003EpartName\u003C/strong\u003E \u003C/span\u003Eproperty.\u00A0 If the \u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003EpartName \u003C/span\u003Eequals \u0022Large_Crewed_Lab\u0022, then you\u0027ve found one!\u00A0 Increment your count, or whatever.\n\u003C/li\u003E\n\u003C/ol\u003E\u003Cp\u003E\n\u003Cstrong\u003EFind out how many instances of \u003Cem\u003Eparts that can function as science labs\u003C/em\u003E there are on the ship:\u003C/strong\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nExactly like the above, for steps 1 through 3.\u00A0 However, in step 4, instead what you do is the following for the part:\n\u003C/p\u003E\n\u003Col\u003E\u003Cli\u003E\nget the part\u0027s \u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003E\u003Cstrong\u003EModules\u003C/strong\u003E \u003C/span\u003Eproperty, which is of type \u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003EPartModuleList\u003C/span\u003E.\n\u003C/li\u003E\n\u003Cli\u003E\nIterate through the list (again, use a numbered index, not \u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003Eforeach\u003C/span\u003E).\n\u003C/li\u003E\n\u003Cli\u003E\nFor each \u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003EPartModule \u003C/span\u003Ethat you find, then check \u003Cstrong\u003E\u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003Eif (module is ModuleScienceConverter)\u003C/span\u003E\u003C/strong\u003E\n\u003C/li\u003E\n\u003Cli\u003E\nIf that evaluates to true, you\u0027ve found a science-lab type of part.\u00A0 Increment your part count, stop iterating through the modules, and move on to the next part.\n\u003C/li\u003E\n\u003C/ol\u003E\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nDoes this answer your question?\n\u003C/p\u003E\n"},{"CreatedByName":"severedsolo","CreatedById":80345,"CreatedDateTime":"2018-04-05T08:06:16Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223343892\u0022 data-ipsquote-contentid=\u0022173419\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221522775042\u0022 data-ipsquote-userid=\u0022125662\u0022 data-ipsquote-username=\u0022Snark\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nOn 03/04/2018 at 6:04 PM, Snark said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nFind out how many instances of \u003Cem\u003Eparts that can function as science labs\u003C/em\u003E there are on the ship:\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nMuch easier for that one to just do vessel.FindPartModulesImplementing\u0026lt;ModuleScienceConverter\u0026gt;().Count()\n\u003C/p\u003E\n\u003Cp\u003E\nNote that this won\u0027t find modules on unloaded vessels. There is a method in FinePrint.Utilities.VesselUtilities to do this, but I\u0027m on my phone right now so can\u0027t remember exactly what it\u0027s called.\n\u003C/p\u003E\n\u003Cp\u003E\nEdit : actually I think the fineprint vessel utilities might have a method for getting counts of specific parts too.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222018-04-05T08:11:43Z\u0022 title=\u002204/05/2018 08:11  AM\u0022 data-short=\u00226 yr\u0022\u003EApril 5, 2018\u003C/time\u003E by severedsolo\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Snark","CreatedById":125662,"CreatedDateTime":"2018-04-05T13:44:24Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223345491\u0022 data-ipsquote-contentid=\u0022173419\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221522915576\u0022 data-ipsquote-userid=\u002280345\u0022 data-ipsquote-username=\u0022severedsolo\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n5 hours ago, severedsolo said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nMuch easier for that one to just do vessel.FindPartModulesImplementing\u0026lt;ModuleScienceConverter\u0026gt;().Count()\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nDepends on what you want to do.\u00A0 I see three potential drawbacks to using vessel.FindPartModulesImplementing:\n\u003C/p\u003E\n\u003Cul\u003E\u003Cli\u003E\n\u003Cstrong\u003EAlgorithmic performance.\u003C/strong\u003E\u00A0 FindPartModulesImplementing will scan every module of every part on the vessel, regardless.\u00A0 Depending on what one wants to do, this may be very computationally wasteful.\u00A0 For example, if all you want to know is \u003Cem\u003E\u003Cu\u003Eare there any labs\u003C/u\u003E\u003C/em\u003E rather than how \u003Cem\u003E\u003Cu\u003Emany\u003C/u\u003E\u003C/em\u003E there are... the algorithm I suggested would allow the code to break out of the loop as soon as it finds the first one, thus short-circuiting evaluation of the rest of the vessel.\n\u003C/li\u003E\n\u003Cli\u003E\n\u003Cstrong\u003ECorrectness.\u003C/strong\u003E\u00A0 FindPartModulesImplementing will, I expect, give a correct answer to \u0022how many labs are there\u0022 in \u003Cem\u003E\u003Cu\u003Emost\u003C/u\u003E\u003C/em\u003E cases.\u00A0 But it\u0027s not actually guaranteed to be correct, because it\u0027s counting \u003Cem\u003E\u003Cu\u003Emodules\u003C/u\u003E\u003C/em\u003E, not parts.\u00A0 In principle, it\u0027s\u00A0 possible for a part to have more than one ModuleScienceConverter on it, and if so, it would get counted multiple times.\n\u003C/li\u003E\n\u003Cli\u003E\n\u003Cstrong\u003EHeap allocation.\u003C/strong\u003E\u00A0 This one\u0027s the whopper.\u00A0 FindPartModulesImplementing is going to \u003Cem\u003E\u003Cu\u003Eallocate a List\u0026lt;\u0026gt;\u003C/u\u003E\u003C/em\u003E, which is of necessity on the heap, which means it\u0027s going to need to get garbage-collected.\u00A0 This is no big deal if the code\u0027s not getting called very frequently, but we don\u0027t know anything yet about the context in which the \u003Cabbr title=\u00221. Original Post(er). The first post in a thread, or the person who posted it. 2. Overpowered. A part or mechanic that upsets game balance by being too powerful.\u0022\u003EOP\u003C/abbr\u003E wants to call this logic.\u00A0 If it happens fairly frequently, then this is going to cause GC churn, which could have a deleterious effect on performance.\n\u003C/li\u003E\n\u003C/ul\u003E\u003Cp\u003E\nYes, it\u0027s simpler to call vessel.FindPartModulesImplementing.\u00A0 It means you only need to write one line of code instead of about half-a-dozen.\n\u003C/p\u003E\n\u003Cp\u003E\nBut it also means you\u0027re going to do a full scan of every single module of every single part in the vessel, every time, and that you\u0027re going to be creating heap objects every time; and if there happen to be multiple labs on the vessel, it\u0027s going to do \u003Cu\u003E\u003Cem\u003Emultiple\u003C/em\u003E\u003C/u\u003E heap allocations \u003Cspan style=\u0022font-size:10px;\u0022\u003E(potentitally O(N\u003Csup\u003E2\u003C/sup\u003E), but hopefully O(NlogN) assuming List\u0026lt;\u0026gt; is implemented intelligently)\u003C/span\u003E, because each one it finds it\u0027s going to need to \u003Cem\u003Eappend to the list\u003C/em\u003E, which requires growing the list, which leads to reallocations.\n\u003C/p\u003E\n\u003Cp\u003E\nSo, which approach is \u0022better\u0022 is going to depend a lot on which tradeoffs are the most relevant to the particular circumstances in which the logic is getting called, which in turn would depend on why the \u003Cabbr title=\u00221. Original Post(er). The first post in a thread, or the person who posted it. 2. Overpowered. A part or mechanic that upsets game balance by being too powerful.\u0022\u003EOP\u003C/abbr\u003E needs to know this information and what he\u0027ll be doing with it.\n\u003C/p\u003E\n"},{"CreatedByName":"severedsolo","CreatedById":80345,"CreatedDateTime":"2018-04-05T17:52:31Z","Content":"\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/125662-snark/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022125662\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/125662-snark/\u0022 rel=\u0022\u0022\u003E@Snark\u003C/a\u003E - I owe you an apology \u003Cimg alt=\u0022:D\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 title=\u0022:D\u0022\u003E I didn\u0027t read your post properly the first time - specifically I misread step 4 of the last bit, where you move on to the next part after finding the module. In my head, I was thinking \u0022well that\u0027s just what FindPartModulesImplemening does\u0022 - but of course it doesn\u0027t, because you aren\u0027t counting every module.\n\u003C/p\u003E\n\u003Cp\u003E\nTL:DR - I should not reply to posts on my mobile while I\u0027m at work.\n\u003C/p\u003E\n\u003Cp\u003E\nOh but I will say (just to try and save a little face \u003Cimg alt=\u0022:P\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif\u0022 title=\u0022:P\u0022\u003E) obviously I would not use FindPartModulesImplementing if I just wanted to know \u0022\u003Cstrong\u003Edoes this vessel have a lab\u003C/strong\u003E\u0022\u00A0 - I\u0027d probably do it your way or (because I\u0027m lazy and hate writing for loops) use FindPartModuleImplementing\u0026lt;\u0026gt;() (the singular one) - I imagine that probably does a for loop and returns as soon as it finds one anyway.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"CWhizard","CreatedById":187640,"CreatedDateTime":"2018-04-06T20:05:33Z","Content":"\n\u003Cp\u003E\nWell the intention is to modify the behavior of For Science so that on vessels including a science lab, it will gather zero science value experiments for use in the lab, which uses the data value not the remaining science value.\u00A0 So, for this specific case,\u00A0 I am looking at Is the There A Lab On Board.\u00A0 i don\u0027t need to know how many there are or how many modules total, just if there is at least one.\u00A0 But I do appreciate your explanation of the other methods which may come in handy for other projects.\u003Cbr\u003E\u003Cbr\u003E\nNow, in meantime since posting this I have shifted to just looking for a scientist on board.\u00A0 Since I develop on the base game (\u002B FS and Mechjeb) I assume a lab based ship or station will have a scientist on board.\u00A0 And if not too bad so sad you lose out on the opportunity to gather that experiment.\u00A0\u00A0\n\u003C/p\u003E\n"}]}