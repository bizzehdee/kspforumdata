{"TopicId":201211,"ForumId":29,"TopicTitle":"How to add partmodule to part at the main menu?","CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2021-03-24T14:15:20Z","PageNum":1,"Articles":[{"CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2021-03-24T14:15:20Z","Content":"\n\u003Cp\u003E\nI have a small mod which is designed to calculate the volume requirements for parts if they don\u0027t have a ModuleCargoPart, and (right now) is creating a \u003Cabbr title=\u0022Module Manager (mod)\u0022\u003EMM\u003C/abbr\u003E file so that the next time the game is loaded, the module is there.\u00A0 I\u0027d like to be able to add the ModuleCargoPart directly to avoid the need for a restart.\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027ve tried this:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003E                        ConfigNode node = new ConfigNode(\u0022ModuleCargoPart\u0022);\n                        node.AddValue(\u0022packedVolume\u0022, volume(availPart, num).ToString(\u0022F0\u0022));\n                        availPart.partConfig.AddNode(node);\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nwhich doesn\u0027t work.\u00A0 I also tried this which fails with an exception:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003E                        ModuleCargoPart mcp = new ModuleCargoPart();\n                        mcp.packedVolume = volume(availPart, num);\n                        availPart.partPrefab.Modules.Add(mcp);\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nThis is all running in a MonoBehaviour.Start, which runs when the MainMenu is reached.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nWhat am I doing wrong?\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nThanks\n\u003C/p\u003E\n"},{"CreatedByName":"peteletroll","CreatedById":144573,"CreatedDateTime":"2021-03-24T16:09:55Z","Content":"\n\u003Cp\u003E\nIn my experience, adding a PartModule at runtime causes problems. It seems that\u00A0every part has a fixed-length list of PartModules, defined at game startup, and if you add PartModules you get log messages about \u0022bad PartModule index\u0022, or something like that.\n\u003C/p\u003E\n\u003Cp\u003E\nBest workaround I found is to avoid PartModules in this case, and working directly with MonoBehaviours, that can be added at runtime without problems, but do not get saved in the sfs files.\n\u003C/p\u003E\n\u003Cp\u003E\nIf you need persistency, you need to add a PartModule, but you have to do it via \u003Cabbr title=\u0022Module Manager (mod)\u0022\u003EMM\u003C/abbr\u003E.\n\u003C/p\u003E\n"},{"CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2021-03-24T18:12:02Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223944533\u0022 data-ipsquote-contentid=\u0022201211\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221616602195\u0022 data-ipsquote-userid=\u0022144573\u0022 data-ipsquote-username=\u0022peteletroll\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n2 hours ago, peteletroll said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nIn my experience, adding a PartModule at runtime causes problems. It seems that\u00A0every part has a fixed-length list of PartModules, defined at game startup, and if you add PartModules you get log messages about \u0022bad PartModule index\u0022, or something like that.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nWell, there is some way to do it, since the game does it when loading \u003Cspan\u003E:=)\u003C/span\u003E\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223944533\u0022 data-ipsquote-contentid=\u0022201211\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221616602195\u0022 data-ipsquote-userid=\u0022144573\u0022 data-ipsquote-username=\u0022peteletroll\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n2 hours ago, peteletroll said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nBest workaround I found is to avoid PartModules in this case, and working directly with MonoBehaviours, that can be added at runtime without problems, but do not get saved in the sfs files.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nNot possible in this case, since it needs to be a\u00A0\u003Cstrong\u003EModuleCargoPart\u003C/strong\u003E\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223944533\u0022 data-ipsquote-contentid=\u0022201211\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221616602195\u0022 data-ipsquote-userid=\u0022144573\u0022 data-ipsquote-username=\u0022peteletroll\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n2 hours ago, peteletroll said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nIf you need persistency, you need to add a PartModule, but you have to do it via \u003Cabbr title=\u0022Module Manager (mod)\u0022\u003E\u003Cabbr title=\u0022Module Manager (mod)\u0022\u003EMM\u003C/abbr\u003E\u003C/abbr\u003E.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nI know, have that working, but would like, if possible, to avoid the double-load\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nWhich is why I asked the question \u003Cspan\u003E:-)\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222021-03-24T18:15:10Z\u0022 title=\u002203/24/2021 06:15  PM\u0022 data-short=\u00223 yr\u0022\u003EMarch 24, 2021\u003C/time\u003E by linuxgurugamer\u003C/strong\u003E\n\u003C/span\u003E\n"}]}