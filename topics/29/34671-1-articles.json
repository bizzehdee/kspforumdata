{"TopicId":34671,"ForumId":29,"TopicTitle":"Adding a PartModule to an EVA","CreatedByName":"TaranisElsu","CreatedById":57742,"CreatedDateTime":"2013-06-25T04:56:25Z","PageNum":1,"Articles":[{"CreatedByName":"TaranisElsu","CreatedById":57742,"CreatedDateTime":"2013-06-25T04:56:25Z","Content":"\n\u003Cp\u003ESo I tried to copy the code by Fel:\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022https://forum.kerbalspaceprogram.com/showthread.php/25305-0-20-2-Vanguard-Technologies-EVA-parachutes-Finally-updated-%28Jun-4%29?p=442982\u0026amp;viewfull=1#post442982\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://forum.kerbalspaceprogram.com/showthread.php/25305-0-20-2-Vanguard-Technologies-EVA-parachutes-Finally-updated-%28Jun-4%29?p=442982\u0026amp;viewfull=1#post442982\u003C/a\u003E\u003C/p\u003E\u003Cp\u003Elike this:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E[KSPAddon(KSPAddon.Startup.MainMenu, true)]\u003Cbr\u003Epublic class AddEvaModule : MonoBehaviour\u003Cbr\u003E{\u003Cbr\u003E    public void Awake()\u003Cbr\u003E    {\u003Cbr\u003E        ConfigNode node = new ConfigNode(\u0022MODULE\u0022);\u003Cbr\u003E        node.AddValue(\u0022name\u0022, \u0022MyEvaModule\u0022);\u003Cbr\u003E\u003Cbr\u003E        try\u003Cbr\u003E        {\u003Cbr\u003E            PartLoader.getPartInfoByName(\u0022kerbalEVA\u0022).partPrefab.AddModule(node);\u003Cbr\u003E        }\u003Cbr\u003E        catch (Exception ex)\u003Cbr\u003E        {\u003Cbr\u003E            Debug.LogError(\u0022TAC AddEvaModule [\u0022 \u002B Time.time \u002B \u0022]: Failed to add the part module to EVA: \u0022 \u002B ex.Message \u002B \u0022\\n\u0022 \u002B ex.StackTrace);\u003Cbr\u003E        }\u003Cbr\u003E    }\u003Cbr\u003E}\u003Cbr\u003E\u003Cbr\u003Epublic class MyEvaModule : PartModule\u003Cbr\u003E{\u003Cbr\u003E    public override void OnAwake()\u003Cbr\u003E    {\u003Cbr\u003E        Debug.Log(\u0022TAC MyEvaModule [\u0022 \u002B this.GetInstanceID().ToString(\u0022X\u0022) \u002B \u0022][\u0022 \u002B Time.time \u002B \u0022]: OnAwake\u0022);\u003Cbr\u003E        base.OnAwake();\u003Cbr\u003E    }\u003Cbr\u003E\u003Cbr\u003E    public override void OnStart(PartModule.StartState state)\u003Cbr\u003E    {\u003Cbr\u003E        Debug.Log(\u0022TAC MyEvaModule [\u0022 \u002B this.GetInstanceID().ToString(\u0022X\u0022) \u002B \u0022][\u0022 \u002B Time.time \u002B \u0022]: OnStart\u0022);\u003Cbr\u003E        base.OnStart(state);\u003Cbr\u003E    }\u003Cbr\u003E\u003Cbr\u003E    public override void OnLoad(ConfigNode node)\u003Cbr\u003E    {\u003Cbr\u003E        Debug.Log(\u0022TAC MyEvaModule [\u0022 \u002B this.GetInstanceID().ToString(\u0022X\u0022) \u002B \u0022][\u0022 \u002B Time.time \u002B \u0022]: OnLoad\u0022);\u003Cbr\u003E        base.OnLoad(node);\u003Cbr\u003E    }\u003Cbr\u003E\u003Cbr\u003E    public override void OnSave(ConfigNode node)\u003Cbr\u003E    {\u003Cbr\u003E        Debug.Log(\u0022TAC MyEvaModule [\u0022 \u002B this.GetInstanceID().ToString(\u0022X\u0022) \u002B \u0022][\u0022 \u002B Time.time \u002B \u0022]: OnSave\u0022);\u003Cbr\u003E        base.OnSave(node);\u003Cbr\u003E    }\u003Cbr\u003E\u003Cbr\u003E    public override void OnFixedUpdate()\u003Cbr\u003E    {\u003Cbr\u003E        base.OnFixedUpdate();\u003Cbr\u003E    }\u003Cbr\u003E}\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003Ebut I keep getting this error:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E[Error]: TAC AddEvaModule [4.394309]: Failed to add the part module to EVA: Object reference not set to an instance of an object\u003Cbr\u003E  at Part.AddModule (System.String moduleName) [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003Cbr\u003E  at Part.AddModule (.ConfigNode node) [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003Cbr\u003E  at AddEvaModule.Awake () [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EAm I doing something wrong? Or does that not work anymore?\u003C/p\u003E\u003Cp\u003EI would be content just adding resources to the EVA instead of a PartModule, if that would work. But I cannot get that to work either \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_sad.gif\u0022 alt=\u0022:(\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"TaranisElsu","CreatedById":57742,"CreatedDateTime":"2013-06-25T06:34:48Z","Content":"\n\u003Cp\u003ESo I got it to work, but it is still throwing an exception:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E[KSPAddon(KSPAddon.Startup.MainMenu, true)]\u003Cbr\u003Epublic class AddEvaModule : MonoBehaviour\u003Cbr\u003E{\u003Cbr\u003E    private static bool initialized = false;\u003Cbr\u003E\u003Cbr\u003E    public void Update()\u003Cbr\u003E    {\u003Cbr\u003E        if (!initialized)\u003Cbr\u003E        {\u003Cbr\u003E            initialized = true;\u003Cbr\u003E            AddModule();\u003Cbr\u003E            AddResources();\u003Cbr\u003E        }\u003Cbr\u003E    }\u003Cbr\u003E\u003Cbr\u003E    private void AddModule()\u003Cbr\u003E    {\u003Cbr\u003E        try\u003Cbr\u003E        {\u003Cbr\u003E            ConfigNode node = new ConfigNode(\u0022MODULE\u0022);\u003Cbr\u003E            node.AddValue(\u0022name\u0022, \u0022MyEvaModule\u0022);\u003Cbr\u003E\u003Cbr\u003E            var partInfo = PartLoader.getPartInfoByName(\u0022kerbalEVA\u0022);\u003Cbr\u003E            Debug.Log(\u0022TAC AddEvaModule [\u0022 \u002B Time.time \u002B \u0022]: Part info = \u0022 \u002B partInfo);\u003Cbr\u003E\u003Cbr\u003E            var prefab = partInfo.partPrefab;\u003Cbr\u003E            Debug.Log(\u0022TAC AddEvaModule [\u0022 \u002B Time.time \u002B \u0022]: Prefab = \u0022 \u002B prefab);\u003Cbr\u003E\u003Cbr\u003E            var module = prefab.AddModule(node);\u003Cbr\u003E            Debug.Log(\u0022TAC AddEvaModule [\u0022 \u002B Time.time \u002B \u0022]: Module = \u0022 \u002B module);\u003Cbr\u003E        }\u003Cbr\u003E        catch (Exception ex)\u003Cbr\u003E        {\u003Cbr\u003E            Debug.LogError(\u0022TAC AddEvaModule [\u0022 \u002B Time.time \u002B \u0022]: Failed to add the part module to EVA: \u0022 \u002B ex.Message \u002B \u0022\\n\u0022 \u002B ex.StackTrace);\u003Cbr\u003E        }\u003Cbr\u003E    }\u003Cbr\u003E\u003Cbr\u003E    private void AddResources()\u003Cbr\u003E    {\u003Cbr\u003E        try\u003Cbr\u003E        {\u003Cbr\u003E            var partInfo = PartLoader.getPartInfoByName(\u0022kerbalEVA\u0022);\u003Cbr\u003E            Debug.Log(\u0022TAC AddEvaModule [\u0022 \u002B Time.time \u002B \u0022]: Part info = \u0022 \u002B partInfo);\u003Cbr\u003E\u003Cbr\u003E            var prefab = partInfo.partPrefab;\u003Cbr\u003E            Debug.Log(\u0022TAC AddEvaModule [\u0022 \u002B Time.time \u002B \u0022]: Prefab = \u0022 \u002B prefab);\u003Cbr\u003E\u003Cbr\u003E            PartResource resource = prefab.gameObject.AddComponent\u0026lt;PartResource\u0026gt;();\u003Cbr\u003E            resource.SetInfo(PartResourceLibrary.Instance.resourceDefinitions[\u0022MyResource\u0022]);\u003Cbr\u003E            resource.amount = 10;\u003Cbr\u003E            resource.maxAmount = 20;\u003Cbr\u003E\u003Cbr\u003E            Debug.Log(\u0022TAC AddEvaModule [\u0022 \u002B Time.time \u002B \u0022]: resource = \u0022 \u002B resource);\u003Cbr\u003E\u003Cbr\u003E            prefab.Resources.list.Add(resource);\u003Cbr\u003E\u003Cbr\u003E            Debug.Log(\u0022TAC AddEvaModule [\u0022 \u002B Time.time \u002B \u0022]: added resource\u0022);\u003Cbr\u003E        }\u003Cbr\u003E        catch (Exception ex)\u003Cbr\u003E        {\u003Cbr\u003E            Debug.LogError(\u0022TAC AddEvaModule [\u0022 \u002B Time.time \u002B \u0022]: Failed to add resources to EVA: \u0022 \u002B ex.Message \u002B \u0022\\n\u0022 \u002B ex.StackTrace);\u003Cbr\u003E        }\u003Cbr\u003E    }\u003Cbr\u003E}\u003Cbr\u003E\u003Cbr\u003Epublic class MyEvaModule : PartModule\u003Cbr\u003E{\u003Cbr\u003E    private float lastUpdate;\u003Cbr\u003E    private float lastFixedUpdate;\u003Cbr\u003E\u003Cbr\u003E    public override void OnAwake()\u003Cbr\u003E    {\u003Cbr\u003E        Debug.Log(\u0022TAC MyEvaModule [\u0022 \u002B this.GetInstanceID().ToString(\u0022X\u0022) \u002B \u0022][\u0022 \u002B Time.time \u002B \u0022]: OnAwake\u0022);\u003Cbr\u003E        base.OnAwake();\u003Cbr\u003E\u003Cbr\u003E        lastUpdate = 0.0f;\u003Cbr\u003E        lastFixedUpdate = 0.0f;\u003Cbr\u003E    }\u003Cbr\u003E\u003Cbr\u003E    public override void OnStart(PartModule.StartState state)\u003Cbr\u003E    {\u003Cbr\u003E        Debug.Log(\u0022TAC MyEvaModule [\u0022 \u002B this.GetInstanceID().ToString(\u0022X\u0022) \u002B \u0022][\u0022 \u002B Time.time \u002B \u0022]: OnStart\u0022);\u003Cbr\u003E        base.OnStart(state);\u003Cbr\u003E    }\u003Cbr\u003E\u003Cbr\u003E    public override void OnLoad(ConfigNode node)\u003Cbr\u003E    {\u003Cbr\u003E        Debug.Log(\u0022TAC MyEvaModule [\u0022 \u002B this.GetInstanceID().ToString(\u0022X\u0022) \u002B \u0022][\u0022 \u002B Time.time \u002B \u0022]: OnLoad\u0022);\u003Cbr\u003E        base.OnLoad(node);\u003Cbr\u003E    }\u003Cbr\u003E\u003Cbr\u003E    public override void OnSave(ConfigNode node)\u003Cbr\u003E    {\u003Cbr\u003E        Debug.Log(\u0022TAC MyEvaModule [\u0022 \u002B this.GetInstanceID().ToString(\u0022X\u0022) \u002B \u0022][\u0022 \u002B Time.time \u002B \u0022]: OnSave\u0022);\u003Cbr\u003E        base.OnSave(node);\u003Cbr\u003E    }\u003Cbr\u003E\u003Cbr\u003E    public override void OnUpdate()\u003Cbr\u003E    {\u003Cbr\u003E        base.OnUpdate();\u003Cbr\u003E\u003Cbr\u003E        float now = Time.time;\u003Cbr\u003E        if ((now - lastUpdate) \u0026gt; 5.0)\u003Cbr\u003E        {\u003Cbr\u003E            Debug.Log(\u0022TAC MyEvaModule [\u0022 \u002B this.GetInstanceID().ToString(\u0022X\u0022) \u002B \u0022][\u0022 \u002B Time.time \u002B \u0022]: OnUpdate\u0022);\u003Cbr\u003E            lastUpdate = now;\u003Cbr\u003E        }\u003Cbr\u003E    }\u003Cbr\u003E\u003Cbr\u003E    // Never gets called....\u003Cbr\u003E    public override void OnFixedUpdate()\u003Cbr\u003E    {\u003Cbr\u003E        base.OnFixedUpdate();\u003Cbr\u003E\u003Cbr\u003E        float now = Time.time;\u003Cbr\u003E        if ((now - lastFixedUpdate) \u0026gt; 5.0)\u003Cbr\u003E        {\u003Cbr\u003E            Debug.Log(\u0022TAC MyEvaModule [\u0022 \u002B this.GetInstanceID().ToString(\u0022X\u0022) \u002B \u0022][\u0022 \u002B Time.time \u002B \u0022]: OnFixedUpdate\u0022);\u003Cbr\u003E            lastFixedUpdate = now;\u003Cbr\u003E        }\u003Cbr\u003E    }\u003Cbr\u003E}\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EThe error:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E[Log]: TAC AddEvaModule [3.922859]: Part info = AvailablePart\u003Cbr\u003E[Log]: TAC AddEvaModule [3.922859]: Prefab = kerbalEVA_RD (Part)\u003Cbr\u003E[Error]: TAC AddEvaModule [3.922859]: Failed to add the part module to EVA: Object reference not set to an instance of an object\u003Cbr\u003E  at Part.AddModule (System.String moduleName) [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003Cbr\u003E  at Part.AddModule (.ConfigNode node) [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003Cbr\u003E  at AddEvaModule.AddModule () [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EIt seems to be good enough for now. The exception does not seem to effect anything. And I got resources to work, see the code.\u003C/p\u003E\n"},{"CreatedByName":"Fel","CreatedById":57121,"CreatedDateTime":"2013-06-26T02:29:07Z","Content":"\n\u003Cp\u003EAlthough you probably don\u0027t need it, \u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022https://forum.kerbalspaceprogram.com/showthread.php/26446-0-20-2-KerbalEVA-Lifesupport\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://forum.kerbalspaceprogram.com/showthread.php/26446-0-20-2-KerbalEVA-Lifesupport\u003C/a\u003E\u003C/p\u003E\u003Cp\u003E(Yeah, resource code looks right so nvm)\u003C/p\u003E\n"},{"CreatedByName":"DSSP","CreatedById":72559,"CreatedDateTime":"2013-10-09T19:37:48Z","Content":"\n\u003Cp\u003Ebasicly the error says exactly whats wrong.\u003C/p\u003E\u003Cp\u003EpartInfo.partPrefab is not an instance of an object (the object is not instantiated).\u003C/p\u003E\u003Cp\u003EKerbalEVA eva = FlightGlobals.ActiveVessel.GetComponent\u0026lt;KerbalEVA\u0026gt;(); \u0026lt;---- this is an instance of an object\u003C/p\u003E\u003Cp\u003Ealso KerbalEVA is a PartModule are you sure you want to add a module to a module ?\u003C/p\u003E\u003Cp\u003Efind the part that holds the module and add the module to the part.\u003C/p\u003E\n"},{"CreatedByName":"TaranisElsu","CreatedById":57742,"CreatedDateTime":"2013-10-10T00:48:13Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022DSSP\u0022 data-cite=\u0022DSSP\u0022\u003E\u003Cdiv\u003Ebasicly the error says exactly whats wrong.\u003Cp\u003EpartInfo.partPrefab is not an instance of an object (the object is not instantiated).\u003C/p\u003E\u003Cp\u003EKerbalEVA eva = FlightGlobals.ActiveVessel.GetComponent\u0026lt;KerbalEVA\u0026gt;(); \u0026lt;---- this is an instance of an object\u003C/p\u003E\u003Cp\u003Ealso KerbalEVA is a PartModule are you sure you want to add a module to a module ?\u003C/p\u003E\u003Cp\u003Efind the part that holds the module and add the module to the part.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI cannot use \u0022FlightGlobals.ActiveVessel\u0022 because I am not adding the PartModule during the flight scene. I am trying to add the module to the prefab part so that it is there whenever an EVA is started/created. And partInfo.partPrefab does point to an object. It is trying to use something in the AddModule method that is null.\u003C/p\u003E\u003Cp\u003EThis is what I figured out (thanks to Fel):\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022https://github.com/taraniselsu/TacLifeSupport/blob/master/Source/AddLifeSupport.cs#L187\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/taraniselsu/TacLifeSupport/blob/master/Source/AddLifeSupport.cs#L187\u003C/a\u003E\u003C/p\u003E\u003Cp\u003Ewhich is called from:\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022https://github.com/taraniselsu/TacLifeSupport/blob/master/Source/AddLifeSupport.cs#L176\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/taraniselsu/TacLifeSupport/blob/master/Source/AddLifeSupport.cs#L176\u003C/a\u003E\u003C/p\u003E\u003Cp\u003ENote that \u0022kerbalEVA\u0022 is the name of the part, while \u0022KerbalEVA\u0022 is the name of the PartModule. I am finding the \u0022kerbalEVA\u0022 part and adding my PartModule to it. It works... but it still throws an exception which does not seem to cause any problems.\u003C/p\u003E\u003Cp\u003EI would like to know a better way to do it, but I have not figured anything out yet. Nor have I seen anything from anyone else.\u003C/p\u003E\n"}]}