{"TopicId":169508,"ForumId":29,"TopicTitle":"Why is the camera moving even though I called Event.current.Use() on a KeyDown event?","CreatedByName":"Warrigal","CreatedById":183457,"CreatedDateTime":"2018-01-12T20:09:19Z","PageNum":1,"Articles":[{"CreatedByName":"Warrigal","CreatedById":183457,"CreatedDateTime":"2018-01-12T20:09:19Z","Content":"\n\u003Cp\u003E\nI\u0027m creating a \u0022spinner\u0022 control, which displays a number which the user can adjust by clicking the number and pressing the up and down arrow keys. All this is working fine, but when I press an up or down arrow key, not only does that make the number in my control change; it also moves the camera.\n\u003C/p\u003E\n\u003Cp\u003E\nThis is happening even though I\u0027m calling Event.current.Use() in my event handler for KeyDown events. I thought that calling Event.current.Use() would prevent the camera from moving.\n\u003C/p\u003E\n\u003Cp\u003E\nThe desired behavior is that if the user presses the up or down arrow key while a spinner has keyboard focus, the spinner\u0027s value change and the camera does \u003Cem\u003Enot \u003C/em\u003Emove.\n\u003C/p\u003E\n\u003Cp\u003E\nHere\u0027s the event handler itself:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-c prettyprinted\u0022\u003E\n\u003Cspan class=\u0022kwd\u0022\u003Ecase\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan\u003EEventType\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan\u003EKeyDown\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E:\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n    \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Eif\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003EthisHasKeyboardFocus\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E)\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n    \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E{\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n        \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Eif\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan\u003EEvent\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Ecurrent\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003EkeyCode \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E==\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan\u003EKeyCode\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan\u003EDownArrow\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E)\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n        \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E{\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n            value \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E-=\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022lit\u0022\u003E1\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n        \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E}\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n        \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Eelse\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Eif\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan\u003EEvent\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Ecurrent\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003EkeyCode \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E==\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan\u003EKeyCode\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan\u003EUpArrow\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E)\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n        \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E{\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n            value \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E\u002B=\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022lit\u0022\u003E1\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n        \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E}\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n\n        \u003C/span\u003E\u003Cspan\u003EEvent\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Ecurrent\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan\u003EUse\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E();\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n    \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E}\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n    \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Ebreak\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E;\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nHere\u0027s the entire file defining the spinner control: \u003Ca href=\u0022https://github.com/tswett/WarrigalsAutopilot/blob/a360c575651a30970b2c13f18fe30e88746e0c43/WarrigalsAutopilot/Odospinner.cs\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/tswett/WarrigalsAutopilot/blob/a360c575651a30970b2c13f18fe30e88746e0c43/WarrigalsAutopilot/Odospinner.cs\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nAnd here\u0027s the GitHub issue I created for this problem: \u003Ca href=\u0022https://github.com/tswett/WarrigalsAutopilot/issues/1\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/tswett/WarrigalsAutopilot/issues/1\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nAny help would be appreciated!\n\u003C/p\u003E\n"},{"CreatedByName":"Li0n","CreatedById":142527,"CreatedDateTime":"2018-01-12T20:51:06Z","Content":"\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/183457-warrigal/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022183457\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/183457-warrigal/\u0022 rel=\u0022\u0022\u003E@Warrigal\u003C/a\u003E not sure it can applies to your case but did you look what you can do with the \u003Ca href=\u0022http://kspapi.forwoods.org/#/classes/InputLockManager\u0022 rel=\u0022external nofollow\u0022\u003EInputLockManager class\u003C/a\u003E ? You can use it to prevent a click on a GUI element from passing through it, maybe that can help.\n\u003C/p\u003E\n"},{"CreatedByName":"Warrigal","CreatedById":183457,"CreatedDateTime":"2018-01-12T23:12:49Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223266581\u0022 data-ipsquote-contentid=\u0022169508\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221515790266\u0022 data-ipsquote-userid=\u0022142527\u0022 data-ipsquote-username=\u0022Li0n\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n2 hours ago, Li0n said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/183457-warrigal/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022183457\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/183457-warrigal/\u0022 rel=\u0022\u0022\u003E@Warrigal\u003C/a\u003E not sure it can applies to your case but did you look what you can do with the \u003Ca href=\u0022http://kspapi.forwoods.org/#/classes/InputLockManager\u0022 rel=\u0022external nofollow\u0022\u003EInputLockManager class\u003C/a\u003E ? You can use it to prevent a click on a GUI element from passing through it, maybe that can help.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nWell, it\u0027s the key-down event which I want to consume, not the mouse click event. In any case, are there other mods which use InputLockManager for the purpose of consuming an input event? It would be really helpful to have something else to imitate.\n\u003C/p\u003E\n"},{"CreatedByName":"Li0n","CreatedById":142527,"CreatedDateTime":"2018-01-13T07:19:25Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223266728\u0022 data-ipsquote-contentid=\u0022169508\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221515798769\u0022 data-ipsquote-userid=\u0022183457\u0022 data-ipsquote-username=\u0022Warrigal\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n7 hours ago, Warrigal said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nWell, it\u0027s the key-down event which I want to consume, not the mouse click event. In any case, are there other mods which use InputLockManager for the purpose of consuming an input event? It would be really helpful to have something else to imitate.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nI\u0027ve just try and InputLockManager do catch the key-down event.\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nQuote\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nInputLockManager.SetControlLock\u00A0(ControlTypes.CAMERACONTROLS ,\u00A0\u0022SomeName\u0022);\n\u003C/p\u003E\n\u003Cp\u003E\n...\n\u003C/p\u003E\n\u003Cp\u003E\nInputLockManager.RemoveControlLock\u00A0(\u0022SomeName\u0022);\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nI use it in \u003Ca href=\u0022https://github.com/Li0n-0/CrewLight/blob/ceaa3bf9404eed3cb8b8593f3a613e6deb7cf65d/Source/ModuleMotionDetector.cs#L272\u0022 rel=\u0022external nofollow\u0022\u003EModuleMotionDetector.cs\u003C/a\u003E (in UpdateGUI()), for CrewLight. I\u0027ve recompiled \u003Ca href=\u0022https://github.com/Li0n-0/CrewLight/archive/controlLock.zip\u0022 rel=\u0022external nofollow\u0022\u003Ethis version\u003C/a\u003E so you can give it a try, open the motion detector GUI (right-click on a light, motion detector button), when your mouse is hover the GUI the arrow keys don\u0027t move the camera anymore.\n\u003C/p\u003E\n"},{"CreatedByName":"Warrigal","CreatedById":183457,"CreatedDateTime":"2018-01-18T21:38:17Z","Content":"\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/142527-li0n/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022142527\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/142527-li0n/\u0022 rel=\u0022\u0022\u003E@Li0n\u003C/a\u003E Well, I used InputLockManager.SetControlLock(ControlType.CAMERACONTROLS, ...) as you suggested. It seems to work, so thanks for your help!\n\u003C/p\u003E\n"}]}