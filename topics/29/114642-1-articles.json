{"TopicId":114642,"ForumId":29,"TopicTitle":"How to force Kerbals to stand instead of float?","CreatedByName":"*Aqua*","CreatedById":103926,"CreatedDateTime":"2015-06-30T10:11:56Z","PageNum":1,"Articles":[{"CreatedByName":"*Aqua*","CreatedById":103926,"CreatedDateTime":"2015-06-30T10:11:56Z","Content":"Hi everybody!\n\nI\u0027m trying to add a kind of magnetic boots to EVA\u0027d Kerbals so that they can walk on the surface of space stations.\n\nI thought I\u0027ll only have to apply a force pressing the Kerbal down to a part and it\u0027ll switch from \u0027float mode\u0027 to \u0027walk mode\u0027. Unfortunately it doesn\u0027t work like that.\n\nIs there a way to force a Kerbal to switch to \u0027walk mode\u0027?"},{"CreatedByName":"LitaAlto","CreatedById":110917,"CreatedDateTime":"2015-07-01T13:38:53Z","Content":"This would be a really cool mod--but I can\u0027t help with the technical question, alas. I suspect that the game checks to see if you\u0027re on the surface of a world, and toggles animations based on that."},{"CreatedByName":"Stoney3K","CreatedById":139954,"CreatedDateTime":"2015-07-31T11:01:11Z","Content":"\u003E \n\u003E This would be a really cool mod--but I can\u0027t help with the technical question, alas. I suspect that the game checks to see if you\u0027re on the surface of a world, and toggles animations based on that.\n\nWell, you can stand on a craft when it\u0027s airborne, even on low-gravity moons, so I suspect there\u0027s more to it than that. If you just apply a force anti-normal to your target surface (much like the gravity on a celestial body would do), there is little chance that a Kerbal will stand, most probably, it will just face-plant flat. ![;)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif)\n\nIt may very well be possible that a Kerbal\u0027s feet have a different collider which the game checks to see if it is \u0022standing\u0022 on something. Basically, when the underside of a Kerbal\u0027s feet are flush with the collider of the part that it\u0027s supposed to stand on, it would be standing instead of floating/crawling.\n\nTry forcing the rotation of your EVA Kerbal to always be normal to the part you\u0027re sticking it to, and see if that has any effects."},{"CreatedByName":"*Aqua*","CreatedById":103926,"CreatedDateTime":"2015-07-31T16:07:13Z","Content":"Good idea but rotation isn\u0027t the problem. On Kerbin a Kerbal would always stand up, even if he hit the surface head first.\n\nMaybe the game checks if he hit a PQS collider (I bet there\u0027s something like that) or if he\u0027s in an atmosphere."},{"CreatedByName":"Stoney3K","CreatedById":139954,"CreatedDateTime":"2015-07-31T22:13:42Z","Content":"\u003E \n\u003E Maybe the game checks if he hit a PQS collider (I bet there\u0027s something like that) or if he\u0027s in an atmosphere.\n\nKerbals can stand on the Mun or on Minmus, even if they\u0027re on top of a flying craft.\n\nNever tested that on \\*orbit\\* though. I do know that when transitioning from \u0022Flying High\u0022 to sub-orbital or orbit, a Kerbal on EVA will instantly align itself tangential (face down) with the planet it\u0027s orbiting, while on a \u0022Flying High\u0022 situation, it will align feet down.\n\nIf you can find the criterium for that you may be able to override it and trick the EVA Kerbal into thinking it\u0027s moving over a (local) surface.\n\nIs it even possible to stand on asteroids?"},{"CreatedByName":"lo-fi","CreatedById":111099,"CreatedDateTime":"2015-08-01T15:09:02Z","Content":"There is a collider in each foot (I\u0027ve verified this myself):\n\n[http://forum.kerbalspaceprogram.com/threads/113748-Reference-Kerbal-EVA-model-transform-tree](https://forum.kerbalspaceprogram.com/threads/113748-Reference-Kerbal-EVA-model-transform-tree)\n\nAlso, have a look at KerbalEVA.minWalkingGee and KerbalEVA.minRunningGee, which is set to .17 and .6 respectively by default. Maybe you could play with those when the boots are active?\n\n**Edited \u003Ctime datetime=\u00222015-08-01T15:11:48Z\u0022 title=\u002208/01/2015 03:11  PM\u0022 data-short=\u00228 yr\u0022\u003EAugust 1, 2015\u003C/time\u003E by lo-fi**"},{"CreatedByName":"Gaalidas","CreatedById":111158,"CreatedDateTime":"2015-08-01T15:34:58Z","Content":"It may be something to do with gravity, not just force. I\u0027ll need to go back a few years, but I remember Scott Manley doing an experiment with the interior of a circular, hollow, space station where he created artificial gravity by spinning the station and was able to drive a rover under that gravity. Now, granted, gravity is simply force directed in a specific direction relative to the body in question, but I have a feeling it needs to be force that can be measured by one of those gravity measuring devices. So, if the force is being applied to the kerbal, but is not measurable by one of those gravioli thingies, then the kerbal is just being pressed up against something. If, however, the gravioli detects a gravitational pull then the kerbal might try to stand on the surface that is \u0022below\u0022 them.\n\nEDIT: or just read lo-fi\u0027s post. I spent too long thinking about what I wanted to say."},{"CreatedByName":"*Aqua*","CreatedById":103926,"CreatedDateTime":"2015-08-01T16:33:51Z","Content":"I already tried that, too. ![;)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif) But no success.\n\nSomewhere in the game is a piece of code which decides on certain conditions if a Kerbal should float or walk. I neighter found that code nor the conditions. I also didn\u0027t find a way to know what mode currently is active.\n\n@Stoney3K\n\nThis sounds promising! I\u0027ll investigate that."},{"CreatedByName":"lo-fi","CreatedById":111099,"CreatedDateTime":"2015-08-02T07:59:17Z","Content":"I\u0027ve got this. It looks like it\u0027s governed by the colliders in the Kerbals (feet?) - minRun and minWalk are probably minimum force with which the (maybe feet) colliders in the Kerbal touch whatever.\n\nIn this video, I\u0027m holding the S key the whole time:\n\n\u003Ciframe width=\u0022480\u0022 height=\u0022270\u0022 src=\u0022https://www.youtube.com/embed/Fq_owvHwEOU?feature=oembed\u0022 frameborder=\u00220\u0022 allowfullscreen=\u0022true\u0022\u003E\u003C/iframe\u003E\n\nGravity is NOT hacked. I\u0027ve got a raycast running, which gives me some info to construct a vector to add a force to the Kerbal. When the Kerbal touches the ground with enough force, walking is enabled.\n\nAlso, it\u0027s hilarious:\n\n\u003Ciframe width=\u0022480\u0022 height=\u0022270\u0022 src=\u0022https://www.youtube.com/embed/dBWOcIDKvjM?feature=oembed\u0022 frameborder=\u00220\u0022 allowfullscreen=\u0022true\u0022\u003E\u003C/iframe\u003E\n\n- - - Updated - - -\n\nUpdate: I noticed also that some game objects are disabled in certain states. The foot bone, for example, is disabled unless in ragdoll state. Interesting, huh? I couldn\u0027t sleep, and had a few minutes to mess about. I know floating was the opposite of what you wanted to do, but it turned out to be useful. I think.\n\nHacky, thrown together code if you want it, of course!"},{"CreatedByName":"*Aqua*","CreatedById":103926,"CreatedDateTime":"2015-08-02T13:15:36Z","Content":"Sure! Show me your code! ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\nWalk mode really doesn\u0027t depend on a force which pushes Kerbals down. I let a 1 g force act on a Kerbal which pushed him into a space station. He just stuck to a part not switching to walk mode. Meanwhile the station began to spin faster and faster because of that force.\n\nI didn\u0027t have time to investigate Stoney3K\u0027s observation yet. But I believe that could point me to the solution."},{"CreatedByName":"Stoney3K","CreatedById":139954,"CreatedDateTime":"2015-08-02T14:55:02Z","Content":"\u003E \n\u003E Sure! Show me your code! ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\u003E Walk mode really doesn\u0027t depend on a force which pushes Kerbals down. I let a 1 g force act on a Kerbal which pushed him into a space station. He just stuck to a part not switching to walk mode. Meanwhile the station began to spin faster and faster because of that force.\n\nAha, your method is correct, but that means you\u0027re fighting Newton\u0027s third law here.\n\nYou\u0027re pushing the Kerbal down towards the station, but there\u0027s nothing to stop the station from moving in an equal and opposite direction (away from your Kerbal) with the same acceleration. Your poor Kerbal is essentially \u0022falling\u0022 towards the station which is just as rapidly running away from a Kerbal trying to kick it in the skin. ![;)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif)\n\nMeaning, the acceleration witnessed by the Kerbal\u0027s feet is nearly zero. (Not coincidentally, that is also the reason why there is \u0022weightlessness\u0022 in space, even though the gravitational pull is almost 1g in LEO)\n\nThe trick here would not be pushing \u0022down\u0022 harder on your Kerbal, it would be to restrict the station you want to walk on from moving. You will only be able to exert a \u0022weight\u0022 force if there is an inanimate object to stand on."},{"CreatedByName":"*Aqua*","CreatedById":103926,"CreatedDateTime":"2015-08-02T16:33:28Z","Content":"Yep, I know that I have to add an equal counter-force to the station at the collision point. ![;)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif)\n\nThe station (in fact only a full orange tank) began to spin slowly, the Kerbal experienced nearly 1 g for a limited time (ca. 10\u002B seconds, then the rotation becomes very noticeable). Still no switch to walk mode during that time. ![:(](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_sad.gif)"},{"CreatedByName":"Stoney3K","CreatedById":139954,"CreatedDateTime":"2015-08-02T19:41:03Z","Content":"\u003E \n\u003E Yep, I know that I have to add an equal counter-force to the station at the collision point. ![;)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif)\n\u003E The station (in fact only a full orange tank) began to spin slowly, the Kerbal experienced nearly 1 g for a limited time (ca. 10\u002B seconds, then the rotation becomes very noticeable). Still no switch to walk mode during that time. ![:(](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_sad.gif)\n\nIf you add an equal counter-force the station should not spin at all."},{"CreatedByName":"lo-fi","CreatedById":111099,"CreatedDateTime":"2015-08-02T23:01:47Z","Content":"EDIT: Ignore me, that doesn\u0027t work in orbit! Weirdly, the Kerbal stops being able to walk the moment what it\u0027s standing on isn\u0027t in contact with the ground any more. Sorry I can\u0027t be of much more help, but it\u0027s been fun to mess around with!\n\nAnd now the spoiler tags have gone haywire!\n\n**Edited \u003Ctime datetime=\u00222015-08-02T23:41:56Z\u0022 title=\u002208/02/2015 11:41  PM\u0022 data-short=\u00228 yr\u0022\u003EAugust 2, 2015\u003C/time\u003E by lo-fi**"},{"CreatedByName":"Stoney3K","CreatedById":139954,"CreatedDateTime":"2015-08-03T10:57:58Z","Content":"\u003E \n\u003E EDIT: Ignore me, that doesn\u0027t work in orbit! Weirdly, the Kerbal stops being able to walk the moment what it\u0027s standing on isn\u0027t in contact with the ground any more. Sorry I can\u0027t be of much more help, but it\u0027s been fun to mess around with!\n\nI found out the same thing: Kerbals can\u0027t stand on flying objects, not even if they\u0027re hovering mere inches over the surface. Poor Jeanette Kerman here was unable to stand on the cargo bay floor, she would just back-plant once the plane takes off.\n\n[![DpFrdUr.jpg](http://i.imgur.com/DpFrdUr.jpg)](http://imgur.com/DpFrdUr)"},{"CreatedByName":"lo-fi","CreatedById":111099,"CreatedDateTime":"2015-08-03T20:33:30Z","Content":"Kerbals inherit the Vessel class, so I\u0027m wondering if the mechanism in that which deals with it being splashed, landed etc. is used to determine what the Kerbal will do. They also swim, don\u0027t they? It\u0027s clearly not to do with orbits. I found that having a Kerbal stood on top of a command pod, it would be in the floating pose, unable to walk until the very moment the command pod hit the ground, at which point it would walk again, no matter how tenuous the pods contact with the ground might have been. I can\u0027t think of any situation a Kerbal would want to be walking, unless classed as \u0022landed\u0022, so there\u0027s some sense to that line if thinking. Maybe."},{"CreatedByName":"lo-fi","CreatedById":111099,"CreatedDateTime":"2015-08-03T22:06:07Z","Content":"Update: I tried manually setting vessel.landed for the Kerbal. This prevents you from using RCS, stops the kerbal from going into the free fall pose, and makes it assume the low gravity leaping posture when not stood on something. Merits further investigation!"},{"CreatedByName":"MrHappyFace","CreatedById":76365,"CreatedDateTime":"2015-08-03T22:54:39Z","Content":"II suggest you look at the KerbalEVA.fsm field. You can force pretty much any KerbalEVA state you want there, including floating, rag doll mode, etc. I\u0027ll post a list of states later once I have access to my computer.\n\nI do have some code that manipulates the fsm here: [https://github.com/HappyFaceIndustries/KerbalAnimationSuite/blob/master/Source/KAS_AnimationClip.cs](https://github.com/HappyFaceIndustries/KerbalAnimationSuite/blob/master/Source/KAS_AnimationClip.cs)\n\nLook at the KerbalEVA\\_Utility class.\n\n**Edited \u003Ctime datetime=\u00222015-08-03T22:59:59Z\u0022 title=\u002208/03/2015 10:59  PM\u0022 data-short=\u00228 yr\u0022\u003EAugust 3, 2015\u003C/time\u003E by MrHappyFace**\n  \nAdded information"},{"CreatedByName":"lo-fi","CreatedById":111099,"CreatedDateTime":"2015-08-03T23:04:12Z","Content":"Perfect! I did peek at the fsm stuff and thought it looked promising, but I couldn\u0027t quite figure out what to do with it. Very helpful, thank you ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)"},{"CreatedByName":"lo-fi","CreatedById":111099,"CreatedDateTime":"2015-08-04T00:12:51Z","Content":"Update: I think I got something semi-workable:\n\n\u003Ciframe width=\u0022480\u0022 height=\u0022270\u0022 src=\u0022https://www.youtube.com/embed/D_8auUInDXE?feature=oembed\u0022 frameborder=\u00220\u0022 allowfullscreen=\u0022true\u0022\u003E\u003C/iframe\u003E\n\nI turn the boots off and let the kerbal float away towards the end, though I\u0027ve forgotten to reset the landed state in the code after that, so zero-G EVA stuff is still disabled. As MrHappyFace points out, the more intelligent way is probably to mess with the FSM. Now this seems to be possible, do let me know if you\u0027d like some magnetic boots made for the kerbals! Would be a rather fun thing to do ![:D](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif)\n\n    using System;using System.Collections.Generic;using System.Collections;using System.Reflection;using System.Linq;using System.Text;using UnityEngine;namespace KerbalGadgets{    public class MagBoots : VesselModule    {        KerbalEVA _kerbal;        GameObject _rayObject;        GameObject _targetObject;        Rigidbody _TargetRB;        Vessel _vessel;        bool isReady;        bool bootToggle;        float magForce = .5f;        public string ravInfo;        public float rayDistance = 0.2f;        public int layerMask = 0;        public void Start()        {            _kerbal = this.GetComponent();            _vessel = this.GetComponent();            if (_kerbal != null)            {                Debug.LogWarning(\u0022Kerbal in EVA....!\u0022);                _rayObject = new GameObject(\u0022rayObject\u0022);                _rayObject.transform.position = transform.Search(\u0022bn_spA01\u0022).position;                _rayObject.transform.rotation = transform.Search(\u0022bn_spA01\u0022).rotation;                _rayObject.transform.parent = _kerbal.gameObject.transform;#if DEBUG                    if (_rayObject != null)                    {                        Debug.LogWarning(\u0022Found left hand foot\u0022);                        _rayObject.SetActive(true);                        Extensions.DebugLine(_rayObject.transform);                    }#endif                isReady = true;            }            else            {                Debug.LogWarning(\u0022Not Kerbal in EVA\u0022);                return;            }        }        public void Update()        {            if (Input.GetKeyUp(KeyCode.P))            {                bootToggle = !bootToggle;                if (bootToggle)                    print(\u0022MagBoots Active\u0022);                else                    print(\u0022MagBoots Disabled\u0022);            }            //print(\u0022State\u0022 \u002B _vessel.state \u002B \u0022landed \u0022 \u002B _vessel.Landed \u002B \u0022splashed \u0022 \u002B _vessel.Splashed);        }        public void FixedUpdate()        {            if (!isReady)                return;            if (bootToggle)                _vessel.Landed = true;            else                return;            _rayObject.SetActive(true);            RaycastHit hit;            if (RayCast(rayDistance, _rayObject, _rayObject.transform.right, out hit))            {                _targetObject = hit.collider.gameObject;                _TargetRB = hit.rigidbody;                print(hit.collider.name);            }            else            {                _targetObject = null;                print(\u0022target null\u0022);            }            //print(ravInfo);            if (_targetObject != null)            {                print(\u0022Applying forces\u0022);                Vector3 direction = _rayObject.transform.position - hit.point;                _kerbal.rigidbody.AddForceAtPosition(-direction.normalized * magForce, hit.point);                if (_TargetRB != null)                    _TargetRB.AddForceAtPosition(direction.normalized * magForce, hit.point);                else                    print(\u0022no rigidbody L\u0022);            }        }        bool RayCast(float rayLength, GameObject rayObject, Vector3 direction, out RaycastHit hit)        {            var ray = new Ray(rayObject.transform.position, direction);            int tempLayerMask = ~layerMask;            return Physics.Raycast(ray, out hit, rayLength, tempLayerMask);        }    }}"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2015-08-04T00:13:53Z","Content":"\u003E \n\u003E II suggest you look at the KerbalEVA.fsm field. You can force pretty much any KerbalEVA state you want there, including floating, rag doll mode, etc. I\u0027ll post a list of states later once I have access to my computer.\n\u003E I do have some code that manipulates the fsm here: [https://github.com/HappyFaceIndustries/KerbalAnimationSuite/blob/master/Source/KAS_AnimationClip.cs](https://github.com/HappyFaceIndustries/KerbalAnimationSuite/blob/master/Source/KAS_AnimationClip.cs)\n\nThis is interesting. How far did you get on that particular project? It seems to have been a while since you made any changes"},{"CreatedByName":"MrHappyFace","CreatedById":76365,"CreatedDateTime":"2015-08-04T00:38:38Z","Content":"I\u0027ve been preoccupied with Kopernicus stuff, but you can download it from the github downloads page if you want. It seems to work fine on my computer, but crashed on other computers."},{"CreatedByName":"Gaalidas","CreatedById":111158,"CreatedDateTime":"2015-08-04T02:17:38Z","Content":"This whole thing, especially after the little video lo-fi made, reminds me of the sea-sickness cure mod. It allowed Kerbals to walk normally on a floating craft."},{"CreatedByName":"lo-fi","CreatedById":111099,"CreatedDateTime":"2015-08-04T06:33:32Z","Content":"Oh yes! Maybe that might be a good place to look for pointers too. Well remembered!"},{"CreatedByName":"*Aqua*","CreatedById":103926,"CreatedDateTime":"2015-08-04T16:10:46Z","Content":"\u003E \n\u003E \\_rayObject.transform.position = transform.Search(\u0022bn\\_spA01\u0022).position;\n\u003E \\_rayObject.transform.rotation = transform.Search(\u0022bn\\_spA01\u0022).rotation;\n\nI wonder why there\u0027s a Search() method. Is it defined in a custom class extension?\n\nI ask because VS\u0027s autocompletion doesn\u0027t list it here.\n\nEdit:\n\nNever mind. I found it in KerbalFoundries.\n\n**Edited \u003Ctime datetime=\u00222015-08-04T16:13:16Z\u0022 title=\u002208/04/2015 04:13  PM\u0022 data-short=\u00228 yr\u0022\u003EAugust 4, 2015\u003C/time\u003E by \\*Aqua\\***"}]}