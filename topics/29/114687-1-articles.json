{"TopicId":114687,"ForumId":29,"TopicTitle":"Splitting science into types","CreatedByName":"Patrick Kerbivan","CreatedById":114804,"CreatedDateTime":"2015-06-30T21:37:53Z","PageNum":1,"Articles":[{"CreatedByName":"Patrick Kerbivan","CreatedById":114804,"CreatedDateTime":"2015-06-30T21:37:53Z","Content":"I\u0027ve set my sights on what I suspect is a rather ambitious project, and I\u0027m hoping someone can point me in the right direction to get started. I\u0027ve got some hobbyist-level coding experience and in the past I\u0027ve created a few new parts for KSP, but I\u0027ve never been this deep \u0022under the hood\u0022 before.\n\nThe core function of the mod is to split the generic Science resource into 4 new categories. Experiment results will be converted into varying amounts of points in these sub categories (which categories get the points depends on the experiment), then different combinations of these points will be required to unlock different tech nodes. A more thorough explanation of the idea has been posted [here](https://forum.kerbalspaceprogram.com/threads/127304-Science-Points-Tech-Unlock-Overhaul-Idea), though some of the fancier features will of course wait until I get the basic framework handled.\n\nBreaking it down, I\u0027d appreciate any suggestions or links to code examples from other mods that would be relevant to the following tasks:\n\n- Add new persistent career-wide resource types like funds, reputation, and science.\n- Intervene in the process of experiment results being recovered/transmitted and converted into the science resource so that the points can be distributed to the new kinds of science points; this would need to be sensitive to the type of results so the distribution of the points can be modified based on the source.\n- Modify the cost of unlocking research nodes to require the new kinds of science points.\n\nThanks in advance!"},{"CreatedByName":"simon56modder","CreatedById":119640,"CreatedDateTime":"2015-06-30T21:47:52Z","Content":"That seems interesting but hard ... you should ask sarbian ![:D](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif)"},{"CreatedByName":"Patrick Kerbivan","CreatedById":114804,"CreatedDateTime":"2015-07-01T04:51:24Z","Content":"\u003E \n\u003E That seems interesting but hard ... you should ask sarbian ![:D](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif)\n\nSarbian... Sarbian... Sarbian!\n\n...nope, nothing.\n\nSeriously though, I don\u0027t feel entitled to directly pester one of the masters when I\u0027m just a fledgling who\u0027s probably aiming way too high. The reddit crowd liked my idea, but I\u0027ve gotten zero feedback from the post I made about it here, so I\u0027m not as optimistic that it\u0027s worth the effort anyway. Nevertheless, I\u0027ll keep poking at things on my own and see where I get. ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2015-07-01T08:34:50Z","Content":"Yeah, I did not want to reply since the scope is large, is not answered in a couple of sentences and outside the part of the game I know best. The idea by itself is good but it require to override so much stock mechanics... \n\nStoring the resource state is the easiest : You use a ScenarioModule with your logic and values. \n\nThe science part require a replacement of a quite a few modules to handle research and transmission of multiple type of value ( ModuleScienceExperiment \u0026 ModuleScienceContainer as a bare minimum and I guess a few more).\n\nThe techTree may be the more complex part and have no idea if it can be done without redoing the whole screen yourself."},{"CreatedByName":"Ser","CreatedById":104207,"CreatedDateTime":"2015-07-01T09:30:51Z","Content":"I\u0027ve looked much at the \n\n[TechManager](https://forum.kerbalspaceprogram.com/threads/98293) mod\u0027s code when was studying science and tech tree related stuff.\n\nI don\u0027t think your goal is that impossible. You could hook to GameEvents.OnScienceReceived (haven\u0027t used it but the name sounds interesting, right?) You can also replace R\u0026D\u0027s research button handler:\n\n    yourTechTree.controller.researchButton.SetInputDelegate(new EZInputDelegate(yourResearchButtonHandler));\n\nand distribute your custom science as you wish.\n\n**Edited \u003Ctime datetime=\u00222015-07-01T10:17:13Z\u0022 title=\u002207/01/2015 10:17  AM\u0022 data-short=\u00229 yr\u0022\u003EJuly 1, 2015\u003C/time\u003E by Ser**"},{"CreatedByName":"Patrick Kerbivan","CreatedById":114804,"CreatedDateTime":"2015-07-01T09:47:46Z","Content":"After putting some more thought into it I realized that some of the science stuff could be worked around by not directly interfering with the generic science collection. The plan is to keep the same science values with all experiments, just split those points among the categories (in different proportions depending on the experiment), so the stock science points would be equal to the sum of all the new categories and could still be consumed when a tech node is unlocked.\n\nIf I just monitor for the transmission/recovery of experiments (maybe just by tracking changes to the science archives?) then I can trigger the addition of the points to the category totals. I\u0027m betting if I look at Kerbal Construction Time\u0027s delayed research feature I can figure out how to control research node unlocking to also require the designated amounts of subcategory points.\n\nSince mobile lab research doesn\u0027t return its science as a result of a particular experiment (does it?) that would be a trickier one to deal with. An easy solution would be regularly comparing the stock science totals to the category totals, then adding equally to all category totals until their sum matches stock points again. If I could capture and maintain a list of experiments that are added to labs as data I could at least create some sort of weighted distribution ratio to be used in those checks.\n\nThe part I have the least idea how to approach is presenting the relevant information in a useful way. For experiments maybe I could use something like Module Manager to automatically add \u0022Experiment yields *X*% Chemistry, *Y*% Physics.\u0022 to the results description? Indicating the category point requirements on the research screen is even trickier, though I could perhaps use the same approach to insert the requirements in the node description.\n\nIn my imagination there would be little icons for the categories that show up where the stock science requirement appears now, but I\u0027m betting that would involve hacking that whole interface, as suggested.\n\n- - - Updated - - -\n\n\u003E You could hook to GameEvents.OnScienceReceived (haven\u0027t used it but the name is interesting, right?)\n\nThat certainly sounds like what I\u0027m looking for when it comes to capturing returned results...\n\n\u003E \n\u003E You also can replace R\u0026D\u0027s research button handler:\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E \n\u003E \n\u003E     yourTechTree.controller.researchButton.SetInputDelegate(new EZInputDelegate(yourResearchButtonHandler));\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E and distribute your custom science as you wish.\n\nAnd that definitely looks like another solution. Thank you!"}]}