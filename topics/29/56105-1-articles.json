{"TopicId":56105,"ForumId":29,"TopicTitle":"Two questions I can\u0026#039;t pin down about hidden parts and GUI updating.","CreatedByName":"TwistedMexi","CreatedById":95468,"CreatedDateTime":"2013-12-14T07:52:14Z","PageNum":1,"Articles":[{"CreatedByName":"TwistedMexi","CreatedById":95468,"CreatedDateTime":"2013-12-14T07:52:14Z","Content":"\n\u003Cp\u003EI\u0027ve been learning KSP plugins mostly by trial and error, but two things I can\u0027t figure out are...\u003C/p\u003E\u003Cp\u003E1. [Edit: I was trying to figure out how to hide parts, when I really just needed to delete the part folder. Realized after I posted.]\u003C/p\u003E\u003Cp\u003E2. How do I update a GUI window\u0027s label during flight? I keep getting errors saying I\u0027m not on the GUI thread but I have no idea where it should be updating from, right now it\u0027s using the OnUpdate() method.\u003C/p\u003E\u003Cp\u003EThanks in advance.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-12-14T08:24:09Z\u0022 title=\u002212/14/2013 08:24  AM\u0022 data-short=\u002210 yr\u0022\u003EDecember 14, 2013\u003C/time\u003E by TwistedMexi\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"blizzy78","CreatedById":68543,"CreatedDateTime":"2013-12-14T11:18:08Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022TwistedMexi\u0022 data-cite=\u0022TwistedMexi\u0022\u003E\u003Cdiv\u003E2. How do I update a GUI window\u0027s label during flight? I keep getting errors saying I\u0027m not on the GUI thread but I have no idea where it should be updating from, right now it\u0027s using the OnUpdate() method.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EGUI stuff needs to be done in OnGUI().\u003C/p\u003E\n"},{"CreatedByName":"TwistedMexi","CreatedById":95468,"CreatedDateTime":"2013-12-14T18:25:19Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022blizzy78\u0022 data-cite=\u0022blizzy78\u0022\u003E\u003Cdiv\u003EGUI stuff needs to be done in OnGUI().\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI thought so, but it doesn\u0027t seem to update for me. \u003C/p\u003E\u003Cp\u003EDo I call OnGui() when I want it to update, or does it get called already? I\u0027ve tried it both ways, but the label in the window stays on \u0022This is a label.\u0022 I\u0027m used to just doing something like labelname.Text = stringvariable, so I\u0027m unsure of how to specify this label specifically. That may be part of my problem.\u003C/p\u003E\u003Cp\u003EThis is what I have for OnGUI(), OnDraw(), and OnWindow()\u003C/p\u003E\u003Cp\u003EVelocity is of course a string.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E        public void OnGui()\u003Cbr\u003E        {\u003Cbr\u003E            GUI.Label(_windowPosition, velocity);\u003Cbr\u003E        }\u003Cbr\u003E\u003Cbr\u003E        private void OnDraw()\u003Cbr\u003E        {\u003Cbr\u003E            if (this.vessel == FlightGlobals.ActiveVessel \u0026amp;\u0026amp; this.part.IsPrimary(this.vessel.parts, this.ClassID))\u003Cbr\u003E            {\u003Cbr\u003E                _windowPosition = GUILayout.Window(10, _windowPosition, OnWindow, \u0022This is my Plugin Title\u0022, _windowStyle);\u003Cbr\u003E\u003Cbr\u003E                if (_windowPosition.x == 0f \u0026amp;\u0026amp; _windowPosition.y == 0f)\u003Cbr\u003E                    _windowPosition = _windowPosition.CenterScreen();\u003Cbr\u003E            }\u003Cbr\u003E        }\u003Cbr\u003E\u003Cbr\u003E        private void OnWindow(int windowId)\u003Cbr\u003E        {\u003Cbr\u003E            GUILayout.BeginHorizontal(GUILayout.Width(250f));\u003Cbr\u003E            GUILayout.Label(\u0022This is a label.\u0022, _labelStyle);\u003Cbr\u003E            GUILayout.EndHorizontal();\u003Cbr\u003E\u003Cbr\u003E            GUI.DragWindow();\u003Cbr\u003E        }\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n"},{"CreatedByName":"SirJulio","CreatedById":95447,"CreatedDateTime":"2013-12-14T18:52:03Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022TwistedMexi\u0022 data-cite=\u0022TwistedMexi\u0022\u003E\u003Cdiv\u003Esnip\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI had the same problem at the beginning when you come from Winforms or WPF. With Unity, all gui controls are one shot so you don\u0027t update them, but just create another one and stop to draw the old one. Here i would do that (not verified) :\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E        public void OnGui()\u003Cbr\u003E        {\u003Cbr\u003E            if (this.vessel == FlightGlobals.ActiveVessel \u0026amp;\u0026amp; this.part.IsPrimary(this.vessel.parts, this.ClassID))\u003Cbr\u003E            {\u003Cbr\u003E                _windowPosition = GUILayout.Window(10, _windowPosition, OnWindow, \u0022This is my Plugin Title\u0022, _windowStyle);\u003Cbr\u003E\u003Cbr\u003E                if (_windowPosition.x == 0f \u0026amp;\u0026amp; _windowPosition.y == 0f)\u003Cbr\u003E                    _windowPosition = _windowPosition.CenterScreen();\u003Cbr\u003E            }\u003Cbr\u003E        }\u003Cbr\u003E\u003Cbr\u003E        private void OnWindow(int windowId)\u003Cbr\u003E        {\u003Cbr\u003E            GUILayout.BeginHorizontal(GUILayout.Width(250f));\u003Cbr\u003E            GUILayout.Label(\u0022This is a label.\u0022, _labelStyle);\u003Cbr\u003E            // Your labe\u003Cbr\u003E            GUI.Label(_windowPosition, velocity);\u003Cbr\u003E            GUILayout.EndHorizontal();\u003Cbr\u003E\u003Cbr\u003E            GUI.DragWindow();\u003Cbr\u003E        }\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n"},{"CreatedByName":"blizzy78","CreatedById":68543,"CreatedDateTime":"2013-12-14T18:59:21Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022SirJulio\u0022 data-cite=\u0022SirJulio\u0022\u003E\u003Cdiv\u003EWith Unity, all gui controls are one shot so you don\u0027t update them, but just create another one and stop to draw the old one.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EExactly, with Unity you basically tell it to draw these controls each time OnGUI() is called (which is basically every frame.)\u003C/p\u003E\n"},{"CreatedByName":"TwistedMexi","CreatedById":95468,"CreatedDateTime":"2013-12-14T19:02:29Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022SirJulio\u0022 data-cite=\u0022SirJulio\u0022\u003E\u003Cdiv\u003E\u003Cem\u003Esnip\u003C/em\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EGot it! Thanks for the help. Your code seemed off to me, but I was able to figure out what you meant. This is working code, for anyone else\u0027s reference.\u003C/p\u003E\u003Cp\u003EIt seems really ineffective to redraw every time like that, but I guess I just need to get used to Unity.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E        public void OnGui()\u003Cbr\u003E        {\u003Cbr\u003E            if (this.vessel == FlightGlobals.ActiveVessel \u0026amp;\u0026amp; this.part.IsPrimary(this.vessel.parts, this.ClassID))\u003Cbr\u003E            {\u003Cbr\u003E                _windowPosition = GUILayout.Window(10, _windowPosition, OnWindow, \u0022This is my Plugin Title\u0022, _windowStyle);\u003Cbr\u003E            }\u003Cbr\u003E        }\u003Cbr\u003E\u003Cbr\u003E        private void OnDraw()\u003Cbr\u003E        {\u003Cbr\u003E            if (this.vessel == FlightGlobals.ActiveVessel \u0026amp;\u0026amp; this.part.IsPrimary(this.vessel.parts, this.ClassID))\u003Cbr\u003E            {\u003Cbr\u003E                _windowPosition = GUILayout.Window(10, _windowPosition, OnWindow, \u0022This is my Plugin Title\u0022, _windowStyle);\u003Cbr\u003E\u003Cbr\u003E                if (_windowPosition.x == 0f \u0026amp;\u0026amp; _windowPosition.y == 0f)\u003Cbr\u003E                    _windowPosition = _windowPosition.CenterScreen();\u003Cbr\u003E            }\u003Cbr\u003E        }\u003Cbr\u003E\u003Cbr\u003E        private void OnWindow(int windowId)\u003Cbr\u003E        {\u003Cbr\u003E            GUILayout.BeginHorizontal(GUILayout.Width(250f));\u003Cbr\u003E            GUILayout.Label(velocity, _labelStyle);\u003Cbr\u003E            GUILayout.EndHorizontal();\u003Cbr\u003E\u003Cbr\u003E            GUI.DragWindow();\u003Cbr\u003E        }\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n"},{"CreatedByName":"SirJulio","CreatedById":95447,"CreatedDateTime":"2013-12-14T19:40:46Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022TwistedMexi\u0022 data-cite=\u0022TwistedMexi\u0022\u003E\u003Cdiv\u003EIt seems really ineffective to redraw every time like that, but I guess I just need to get used to Unity.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EOh yes ! That was exacty my thought. As a rule of thumb, i just call gui stuffs in OnGUI or WindowFunc callback methods, i don\u0027t know if that\u0027s how it is designed to work but it works so.\u003C/p\u003E\u003Cp\u003EGood luck.\u003C/p\u003E\n"},{"CreatedByName":"blizzy78","CreatedById":68543,"CreatedDateTime":"2013-12-14T20:25:18Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022TwistedMexi\u0022 data-cite=\u0022TwistedMexi\u0022\u003E\u003Cdiv\u003EThis is working code, for anyone else\u0027s reference.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EWhy do you do the same thing in OnGUI() and OnDraw()? You don\u0027t need OnDraw(). Like I\u0027ve said in my first reply, GUI things go into OnGUI().\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022SirJulio\u0022 data-cite=\u0022SirJulio\u0022\u003E\u003Cdiv\u003EAs a rule of thumb, i just call gui stuffs in OnGUI or WindowFunc callback methods, i don\u0027t know if that\u0027s how it is designed to work but it works so.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ELooks good.\u003C/p\u003E\n"},{"CreatedByName":"TwistedMexi","CreatedById":95468,"CreatedDateTime":"2013-12-14T20:46:24Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022blizzy78\u0022 data-cite=\u0022blizzy78\u0022\u003E\u003Cdiv\u003EWhy do you do the same thing in OnGUI() and OnDraw()? You don\u0027t need OnDraw(). Like I\u0027ve said in my first reply, GUI things go into OnGUI().\u003Cp\u003ELooks good.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI followed a video tutorial for KSP to get familiar with the basic setup. It said the initial GUI gets called at OnDraw() and I use that for centering the window initially. I also have this:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E        public override void OnStart(StartState state)\u003Cbr\u003E        {\u003Cbr\u003E            if (state != StartState.Editor)\u003Cbr\u003E            {\u003Cbr\u003E                if (!_hasInitStyles) InitStyles();\u003Cbr\u003E                RenderingManager.AddToPostDrawQueue(0, OnDraw);\u003Cbr\u003E            }\u003Cbr\u003E        }\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EDo I not need OnDraw, and if that\u0027s the case, should \u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003ERenderingManager.AddToPostDrawQueue(0, OnDraw);\u003C/pre\u003E\u003Cp\u003E be \u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003ERenderingManager.AddToPostDrawQueue(0, OnGui);\u003C/pre\u003E\u003Cp\u003E?\u003C/p\u003E\n"},{"CreatedByName":"SirJulio","CreatedById":95447,"CreatedDateTime":"2013-12-15T19:31:17Z","Content":"\n\u003Cp\u003EFrom my understanding of unity, On[...] methods for class that inherit from MonoBehaviour are called automatically. RenderingManager is a KSP class which is basically a list of callback to draw your stuff.\u003C/p\u003E\u003Cp\u003ETake a look at the veru first example of Taraniselsu on his \u003Ca href=\u0022https://github.com/taraniselsu/TacExamples\u0022 rel=\u0022external nofollow\u0022\u003Egithub\u003C/a\u003E. That\u0027s all you need to know of entry point for your code.\u003C/p\u003E\u003Cp\u003EIMO If you can use RenderingManager, don\u0027t even bother with the rest (except awake, use it as a constructor, and OnDestroy, use that as an IDisposable). Register your callbock in rendering manager and call your ui function from that callback.\u003C/p\u003E\n"},{"CreatedByName":"TaranisElsu","CreatedById":57742,"CreatedDateTime":"2013-12-18T02:51:14Z","Content":"\n\u003Cp\u003EUse either OnGUI or RenderingManager, not both. I recommend sticking with RenderingManager.\u003C/p\u003E\u003Cp\u003EYour code here: \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/61639-Two-questions-I-can-t-pin-down-about-hidden-parts-and-GUI-updating?p=838979\u0026amp;viewfull=1#post838979\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://forum.kerbalspaceprogram.com/threads/61639-Two-questions-I-can-t-pin-down-about-hidden-parts-and-GUI-updating?p=838979\u0026amp;viewfull=1#post838979\u003C/a\u003E looks good if you delete the OnGUI method.\u003C/p\u003E\u003Cp\u003EYou will probably also need to move \u0022if (!_hasInitStyles) InitStyles();\u0022 to your OnDraw method. Do you have any errors related to that? If not, then I am mistaken and it is fine there.\u003C/p\u003E\n"}]}