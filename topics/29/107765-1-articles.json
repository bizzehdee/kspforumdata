{"TopicId":107765,"ForumId":29,"TopicTitle":"Plugin to allow multi-part fairings / boost protect covers to work in stock 1.0x aero","CreatedByName":"sumghai","CreatedById":66272,"CreatedDateTime":"2015-05-05T23:39:02Z","PageNum":1,"Articles":[{"CreatedByName":"sumghai","CreatedById":66272,"CreatedDateTime":"2015-05-05T23:39:02Z","Content":"Note: This is mutually exclusive from my SDHI AeroFairings project, for reasons to be explained shortly.\n\nKSP 1.0 introduced a new aero drag occlusion system, along with stock procedural fairings - while I know that e-dog\u0027s Procedural Fairings is compatible with stock aero, I prefer multipart or limited-configuration fairings as they enforce sensible payload design.\n\nThe problem is that, due to the way stock aero was devised, KW Rocketry\u0027s multipart fairings, SDHI SMS\u0027s interstage fairing and pod boost protect covers and similar fairing systems no longer occlude drag properly.\n\nA plugin (or better yet, an update to the game itself) to allow stock aero to properly handle multipart fairings would be greatly appreciated.\n\nFor those who say \u0022Just use nuFAR and its new voxel occlusion system\u0022, I\u0027ll state that I do in fact prefer FAR, but I want these multipart fairings to work in stock aero too."},{"CreatedByName":"Mecripp","CreatedById":181994,"CreatedDateTime":"2015-05-06T00:25:09Z","Content":"Why not something like AIES fairings if they was update would they work better ?"},{"CreatedByName":"sumghai","CreatedById":66272,"CreatedDateTime":"2015-05-06T00:30:21Z","Content":"\u003E \n\u003E Why not something like AIES fairings if they was update would they work better ?\n\nNo, because AIES fairings are still technically multipart fairings.\n\nEDIT: To clarify, a multipart fairing is where the fairing pieces are separate parts from the fairing base. KW Rocketry Fairings have fairing halves built up of individual segments, while AIES fairings halves are single pieces, but from the perspective of the stock aero system, both are considered multipart fairings.\n\n**Edited \u003Ctime datetime=\u00222015-05-06T01:14:49Z\u0022 title=\u002205/06/2015 01:14  AM\u0022 data-short=\u00229 yr\u0022\u003EMay 6, 2015\u003C/time\u003E by sumghai**"},{"CreatedByName":"sumghai","CreatedById":66272,"CreatedDateTime":"2015-05-06T22:58:47Z","Content":"**[MOD - Moving to Plugin Development Help subforum, since what follows is now technical content]**\n\nOkay, so after some discussion on IRC, I\u0027ve gathered some useful information that may help the development of this plugin.\n\n- ModuleCargoBay is (to my knowledge) the only way the game handles drag occlusion for hollow parts, and has the following key parameters:\n\n\u003E \n\u003E DeployModuleIndex is the index of the animation module that opens your cargo bay. If your deploy animation is the first module in your part config, this should be 0. If it is the 2nd module, this should be 1. 3rd = 2 ....\n\u003E ClosedPosition is the position in your animation that represents closed. If your animation goes from closed -\u003Eopen, this should be 0. If your animation starts open and goes to closed, this should be 1.\n\u003E \n\u003E lookupRadius is probably the distance from the center of mass of the cargo bay to do part containment lookup. On all stock cargo bays this is set to half the length of the cargo bay; so a 10m long bay would have a value of 5.\n\n- For \u0022true\u0022 cargo bays, such as the stock Mk3 Cargo Bay CRG-100, DeployModuleIndex listens for a change in the state of a specified/preceding ModuleAnimateGeneric that opens/closes the bay doors, and ClosedPosition for the actual end state itself. Once triggered, ModuleCargoBay would then raycast against the cargo bay\u0027s colliders to determine the shielded state of the payload inside the bay.\n\n- The stock procedural fairings also use ModuleCargoBay to determine atmo drag occlusion; however, the proc fairing CFGs don\u0027t have ModuleAnimateGeneric, but instead, has ModuleProceduralFairing\n\n- I suspect what\u0027s happening is that ModuleProceduralFairing is actually creating a \u0022dummy\u0022 animation that ModuleCargoBay can consult to determine whether the fairings are intact (payload shielded) or jettisoned (payload exposed to atmo drag)\n\n- **In terms of my original request, the idea is to thus create a new \u0022helper\u0022 PartModule that tricks ModuleCargoBay into using a decoupler staging action (ModuleDecoupler/ModuleAnchoredDecoupler) as a valid animation:**\n\ni.e. ModuleDecoupler/ModuleAnchoredDecoupler ---\u003E ModuleDecouplerListenerForCargoBay ---\u003E ModuleCargoBay\n\n* * *\n\nAdditional notes:\n\n - ModuleCargoBay\u0027s lookupRadius is measured from the part\u0027s CoM, so many fairings will need to have their part origins changed mid-way along their height, and the lookupRadius specified as half the height\n\n - Because ModuleCargoBay must be able to listen to a change in animated state from either ModuleAnimateGeneric, ModuleProceduralFairing or the proposed **ModuleDecouplerListenerForCargoBay**, faring segments parts that only have ModuleCargoBay won\u0027t work.\n\n(Specifically, SDHI\u0027s fairings and BPC are single-length segments with built-in decouplers, and so these parts would work fine with the new listener module. On the other hand, KW Rocketry fairings have the decoupler only in the cone pieces and not the side panels that make up its length, and so even if the KW fairing side panels each had ModuleCargoBay, they can\u0027t listen to the decoupler action from another part)\n\nSo... any takers for this request? ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)"},{"CreatedByName":"sumghai","CreatedById":66272,"CreatedDateTime":"2015-05-07T01:24:59Z","Content":"According to Sarbian via IRC, apparently ModuleProceduralFairings directly instructs ModuleCargoBay how to alter its drag occlusion behaviour, instead of merely providing an animation state change like ModuleAnimateGeneric does.\n\nFurther investigation is needed to understand how ModuleProceduralFairings and ModuleAnimateGeneric pass on information to ModuleCargoBay."},{"CreatedByName":"raidernick","CreatedById":97711,"CreatedDateTime":"2015-05-07T19:49:33Z","Content":"Is this what I think it is? Thanks so much for working on this it is much needed."},{"CreatedByName":"Squiggsy","CreatedById":139947,"CreatedDateTime":"2015-05-10T09:34:50Z","Content":"Have some rep! I literally just finished making some multi part fairings and then looked up some information about them only to find they no longer work with stock aero. so this is greatly appreciated and i wish you the best of luck in your endeavors!"},{"CreatedByName":"Dave7","CreatedById":70552,"CreatedDateTime":"2015-05-11T15:56:14Z","Content":"Thinking out loud:\n\nThought 1: Is it possible to use ModuleCargoBay with fairing bases to make an invisible bay for shielding and have your fairings wrap around it for the visuals instead of having the fairings do the shielding?\n\nThought 2: Does anyone know if there is a way to use ModuleProceduralFairing and preset the fairing sizes via .cfg and use your own fairing textures to make the fairings?\n\nEdit: for presets I mean using the xSectionHeight\u0027s and all those other things in the stock fairing .cfg\u0027s to make the fairing without having to click and drag it. Maybe you just need a plugin to override the user input.\n\n**Edited \u003Ctime datetime=\u00222015-05-11T16:02:13Z\u0022 title=\u002205/11/2015 04:02  PM\u0022 data-short=\u00229 yr\u0022\u003EMay 11, 2015\u003C/time\u003E by Dave7**"},{"CreatedByName":"sumghai","CreatedById":66272,"CreatedDateTime":"2015-05-11T20:48:44Z","Content":"\u003E \n\u003E Thought 1: Is it possible to use ModuleCargoBay with fairing bases to make an invisible bay for shielding and have your fairings wrap around it for the visuals instead of having the fairings do the shielding?\n\nMy understanding of ModuleCargoBay is that it raycasts drag occlusion based on a fairing/cargo bay\u0027s colliders - there\u0027s not much point having a visual mesh for the fairing itself and a separate invisible mesh for the collider, if the fairing collider can be made as part of the original fairing model itself.\n\n\u003E \n\u003E Thought 2: Does anyone know if there is a way to use ModuleProceduralFairing and preset the fairing sizes via .cfg and use your own fairing textures to make the fairings?\n\u003E Edit: for presets I mean using the xSectionHeight\u0027s and all those other things in the stock fairing .cfg\u0027s to make the fairing without having to click and drag it. Maybe you just need a plugin to override the user input.\n\nI thought about that as well, but according to various sources, Harvester (who wrote both ModuleCargoBay and ModuleProceduralFairings) never really wrote his code with moddability in mind, and I suspect it\u0027d be difficult to get a hold of him to explain the each of the parameters and possible values."},{"CreatedByName":"Dave7","CreatedById":70552,"CreatedDateTime":"2015-05-11T22:54:08Z","Content":"\u003E \n\u003E I thought about that as well, but according to various sources, Harvester (who wrote both ModuleCargoBay and ModuleProceduralFairings) never really wrote his code with moddability in mind, and I suspect it\u0027d be difficult to get a hold of him to explain the each of the parameters and possible values.\n\nHave you checked with edog about this? His procedural fairings mod is shielding parts and its using multiple fairing parts. Granted they are being modified (scale \u0026 shape) after placement and maybe his code is changing other stuff with them also, I haven\u0027t checked, but it should be possible to use your fairings with just .cfg changes or maybe a plugin to add whatever ModuleProceduralFairings needs to calculate the enclosed area or whatever its doing. I haven\u0027t had time to look at it much."},{"CreatedByName":"sumghai","CreatedById":66272,"CreatedDateTime":"2015-05-11T23:07:14Z","Content":"\u003E \n\u003E Have you checked with edog about this? His procedural fairings mod is shielding parts and its using multiple fairing parts. Granted they are being modified (scale \u0026 shape) after placement and maybe his code is changing other stuff with them also, I haven\u0027t checked, but it should be possible to use your fairings with just .cfg changes or maybe a plugin to add whatever ModuleProceduralFairings needs to calculate the enclosed area or whatever its doing. I haven\u0027t had time to look at it much.\n\nStarwaster has already had a look at ModuleCargoBay and ModuleProceduralFairings, and he thinks he may have an idea or two."},{"CreatedByName":"Dave7","CreatedById":70552,"CreatedDateTime":"2015-05-11T23:31:23Z","Content":"Ah that\u0027s good news. I hope you guys get it sorted out. Wish I could help more but I\u0027m getting too old and rusty."},{"CreatedByName":"NecroBones","CreatedById":105424,"CreatedDateTime":"2015-05-30T00:35:06Z","Content":"I\u0027m really looking forward to hearing what you guys can come up with. My 0-Point Inline Fairings mod is strictly FAR/NEAR only right now, until we can find a solution. \n\nIf it\u0027s possible to make it work with visual model and not just colliders, that would be fantastic. Right now, my fairings mod uses the stock \u0022ModuleJettison\u0022 engine fairing panel system (like the LV-N engine). Each of my fairing bases has four different fairing lengths, depending on which attachment node you use, so ray-casts would have to be based on the current panels, and not the inactive ones. The panels don\u0027t have colliders at the moment, and it would be a bit of a nightmare to add them all (2 half-cylinders per length (4) per base (3). If each \u0022panel\u0022 were to use 6 rectangular colliders to approximate a 12-sided cylinder, that comes out to each base needing 48 new colliders, not including the front ends which would also need colliders).\n\nDo you think this plugin might work for my fairings?"},{"CreatedByName":"sumghai","CreatedById":66272,"CreatedDateTime":"2015-06-07T10:16:08Z","Content":"Okay, got some mostly good news.\n\nStarwaster\u0027s [Animated Decouplers plugin](https://github.com/Starwaster/AnimatedDecouplers/releases) has been updated such that it now works in conjunction with the stock ModuleCargoBay - in layman\u0027s terms, AD provides a range of derivative decoupler modules that come with an animation argument, which allows the ModuleCargoBay to update its drag occlusion state once the fairing parts are decoupled.\n\nThis has already been implemented on the dev version of SDHI SMS with excellent results in stock aero (FAR uses voxel-based emergent drag occlusion calculation, and so isn\u0027t affected).\n\nThe caveat is that this plugin doesn\u0027t (yet) work for fairing pieces made up of multiple segments (such as the old KW Rocketry fairings), where not all the fairing pieces have the modified decoupler module that ModuleCargoBay needs to listen for in order to update its drag occlusion state.\n\n\u003E \n\u003E I\u0027m really looking forward to hearing what you guys can come up with. My 0-Point Inline Fairings mod is strictly FAR/NEAR only right now, until we can find a solution. \n\u003E If it\u0027s possible to make it work with visual model and not just colliders, that would be fantastic. Right now, my fairings mod uses the stock \u0022ModuleJettison\u0022 engine fairing panel system (like the LV-N engine). Each of my fairing bases has four different fairing lengths, depending on which attachment node you use, so ray-casts would have to be based on the current panels, and not the inactive ones. The panels don\u0027t have colliders at the moment, and it would be a bit of a nightmare to add them all (2 half-cylinders per length (4) per base (3). If each \u0022panel\u0022 were to use 6 rectangular colliders to approximate a 12-sided cylinder, that comes out to each base needing 48 new colliders, not including the front ends which would also need colliders).\n\u003E \n\u003E Do you think this plugin might work for my fairings?\n\nThe stock ModuleCargoBay requires colliders in order for raycasting for drag occlusion to work, so I don\u0027t think visual-only meshes would be supported.."},{"CreatedByName":"NecroBones","CreatedById":105424,"CreatedDateTime":"2015-06-08T13:03:10Z","Content":"\u003E The stock ModuleCargoBay requires colliders in order for raycasting for drag occlusion to work, so I don\u0027t think visual-only meshes would be supported..\n\nI figured that would probably still be the case. I did some test runs last week with colliders added to one of my fairings, and it still didn\u0027t seem to provide occlusion to payload with AD at the time."}]}