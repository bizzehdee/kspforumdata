{"TopicId":109166,"ForumId":29,"TopicTitle":"Need help getting started","CreatedByName":"cvod","CreatedById":110540,"CreatedDateTime":"2015-05-14T09:00:32Z","PageNum":1,"Articles":[{"CreatedByName":"cvod","CreatedById":110540,"CreatedDateTime":"2015-05-14T09:00:32Z","Content":"I\u0027ve got Visual Studio set up and I\u0027ve looked through all the \u0022tutorials\u0022 and getting started material, but I still have can\u0027t figure out what should be a relatively simple task. I also looked through other people\u0027s source code, but given that I\u0027m completely new to C# I\u0027m not sure what I should be looking for. Could anyone post some example code of making a GUI window appear whenever at the space center or whenever at the RnD building?"},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2015-05-14T10:39:32Z","Content":"To get something started in the space center, you\u0027re looking at a KSP Addon type plugin (rather than a Part Module). This means inheriting from Monobehaviour and having the class tagged with the KSPAddon attribute.\n\n    [KSPAddon (KSPAddon.Startup.SpaceCentre, false)]public class YourClass : MonoBehaviour{}\n\nThis gives you a class for which the methods Awake, Start, Update, FixedUpdate (NOTE: not particularly useful outside the Flight scene), OnGUI and OnDestroy. There are (a lot) more, but those are the ones you will use the most.\n\nTo draw a window, you want OnGUI\n\n    public void OnGUI(){    GUI.Window(/*some number*/, new Rect(300,500,300,300), windowFunc, \u0022This is a window Title\u0022); // draws a 300x300 window 300 in and 500 down from the top left of the screen.// You have a choice of GUI or GUILayout for most UI objects. GUI you specify the size explictly using a Rect for each object, GUILayout you have formatting functions to shape your layout. Both work, what you use is up to you.}void windowFunc(int id){    // the contents of your window go here.    // NOTE: if using GUI functions, the (x,y) coordinates are relative to the top left of the window, not the screen (ie. (0,0) in this function is the top left corner of the window)}\n\nThe R\u0026D window is an overlay on the space center scene so if you want a window in both there is no special considerations (although you will have to block it for the other buildings that aren\u0027t the VAB/SPH if you don\u0027t want them showing up). To detect entry to these facilities, we add callbacks to functions for various \u0022OnEnter\u0022 and \u0022OnLeaving\u0022 events\n\n    public void Start(){    GameEvents.onGUIRnDComplexSpawn.Add(RnDEnteredFunc);     GameEvents.onGUIRnDComplexDespawn.Add(RnDLeavingFunc);}public void OnDestroy() //You don\u0027t want to leave event subscriptions lying around{    GameEvents.onGUIRnDComplexSpawn.Remove(RnDEnteredFunc);    GameEvents.onGUIRnDComplexDespawn.Remove(RnDLeavingFunc);}void RnDEnteredFunc(){}void RnDLeavingFunc(){}\n\nset a boolean value in those callbacks and gate your OnGUI code behind that check if you only want to show in the RnD complex\n\n    bool bRnDOverlayVisible = false;void OnGUI(){    if (!bRnDOverlayVisible)        return; // I prefer return statements for gating as it reduces the level of nesting but you can also wrap everything inside the if statement. Whatever works for you}\n\n**Edited \u003Ctime datetime=\u00222015-05-14T10:43:31Z\u0022 title=\u002205/14/2015 10:43  AM\u0022 data-short=\u00229 yr\u0022\u003EMay 14, 2015\u003C/time\u003E by Crzyrndm**"},{"CreatedByName":"cvod","CreatedById":110540,"CreatedDateTime":"2015-05-14T11:20:17Z","Content":"Wow, thanks so much for the help!"},{"CreatedByName":"cvod","CreatedById":110540,"CreatedDateTime":"2015-05-15T01:12:32Z","Content":"How would I make the window drag-able? I tried the following code, but it doesn\u0027t seem to do anything. Also one thing I don\u0027t understand about the code is why \u0022int id\u0022 is needed for the \u0022windowFunc\u0022 method. If I remove it, then Visual Studio shows an error with \u0022GUI.Window\u0022\n\n    namespace Testing{    [KSPAddon(KSPAddon.Startup.SpaceCentre, false)]    public class Testing : MonoBehaviour    {        public void OnGUI()        {            GUI.Window(1, new Rect(10, 10, 300, 700), windowFunc, \u0022Title\u0022);        }         void windowFunc(int id)        {            GUI.DragWindow();        }    }}"},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2015-05-15T01:17:07Z","Content":"To make it draggable, you need a persistent Rect instead of creating one each time.\n\n    namespace Testing{    [KSPAddon(KSPAddon.Startup.SpaceCentre, false)]    public class Testing : MonoBehaviour    {        Rect windowRect = new Rect(10,10,300,700);        public void OnGUI()        {            windowRect = GUI.Window(1, windowRect, windowFunc, \u0022Title\u0022);        }         void windowFunc(int id)        {            GUI.DragWindow();        }    }}\n\nThe window id I don\u0027t understand too well myself, expect that two windows with the same id cannot both be drawn at the same time (you can draw one or the other, but not both). I just give them a large arbitrary random number"},{"CreatedByName":"cvod","CreatedById":110540,"CreatedDateTime":"2015-05-15T01:57:28Z","Content":"Sweet, thanks for your help. Looks like I should have read up on classes and methods a bit more before jumping in."},{"CreatedByName":"cvod","CreatedById":110540,"CreatedDateTime":"2015-05-16T06:34:40Z","Content":"I\u0027m asking a lot of questions so I\u0027ll just put them all in this thread instead of making new ones.\n\nI\u0027m trying to get information on the node that is currently clicked such as it\u0027s name and the parts assigned to it. I found the class \u0022RDNode\u0022 which has a \u0022OnNodeSelected()\u0022 method, but I can\u0027t figure out how to use it. Looking at the old Treeloader source, it makes use of the \u0022ConfigNode\u0022 class. I\u0027m not really sure how to use either or what I should be looking for to get the info of the clicked node."},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2015-05-16T07:20:44Z","Content":"ConfigNode is the class which KSP uses to read/write/store the majority of data in .cfg files (eg. PART { ... } is initially read into a ConfigNode)\n\nThis is probably the one you want\n\n    RDController.Instance.node_selected"},{"CreatedByName":"cvod","CreatedById":110540,"CreatedDateTime":"2015-05-18T04:41:52Z","Content":"What does the template parameter do for file IO commands? I\u0027m trying to check that a file exists, but I\u0027m not sure what to put for \u0022T\u0022. Also, does the directory for the file not need specified?\n\n    KSP.IO.File.Exists(\u0022filename\u0022)"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2015-05-18T09:25:14Z","Content":"It\u0027s used by KSP to define the patch where you file is stored. Say you mod is in GameData/myMod/myMod.dll and it contains a class called MyModule. \n\nKSP.IO.File.Exists\u003Cmymodule\u003E(\u0022filename\u0022) will check for a file relative to the position of the dll that contains MyModule. From memory it should be GameData/myMod/pluginData/myMod/filename.cfg\u003C/mymodule\u003E\n\nThe path are quite long since it was designed when all the plugins lived in the same dir."},{"CreatedByName":"cvod","CreatedById":110540,"CreatedDateTime":"2015-05-21T20:46:34Z","Content":"I\u0027m not sure if this is doing what I think it\u0027s doing. There\u0027s probably a better way to do this. I\u0027m trying to load the tech tree data using ConfigNode. Is this the correct way to do it?\n\n    ConfigNode allNodes = GameDatabase.Instance.GetConfigNode(\u0022RDNode\u0022);\n\nIf it is, for some reason my plugin stops working when I try to get the RnD node position data.\n\n    string[] allNodePos = allNodes.GetValues(\u0022pos\u0022);\n\nWhat am I doing wrong?\n\nAlso, does the GetConfigNode method get sub structures in the config files? So will it get the Parent structures within the RDNode structure?"},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2015-05-21T21:34:32Z","Content":"You probably want something like\n\n    string[] allNodePos = new string[allNodes.Length];for (int i = 0; i \u003C allNodes.Length; i\u002B\u002B)    allNodePos[i] = allNodes[i].GetValue(\u0022pos\u0022);\n\nor even\n\n    string[][] allNodePos = new string[allNodes.Length][];for (int i = 0; i \u003C allNodes.Length; i\u002B\u002B)    allNodePos[i] = allNodes[i].GetValue(\u0022pos\u0022).Split(\u0027,\u0027);\n\nwhich will give you each of the pos numbers in individual cells (eg. allNodePos[0][0] is the first number in the first node)\n\n**Edited \u003Ctime datetime=\u00222015-05-21T21:38:11Z\u0022 title=\u002205/21/2015 09:38  PM\u0022 data-short=\u00229 yr\u0022\u003EMay 21, 2015\u003C/time\u003E by Crzyrndm**"},{"CreatedByName":"cvod","CreatedById":110540,"CreatedDateTime":"2015-05-22T01:13:08Z","Content":"I\u0027m still having trouble with this part\n\n    [COLOR=#333333]ConfigNode allNodes = GameDatabase.Instance.GetConfigNodes(\u0022RDNode\u0022);[/COLOR]\n\nThis produces a list of length zero. And if I replace \u0022RDNode\u0022 with \u0022TechTree\u0022 it produces a list of length two. Neither are results I would have expected."},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2015-05-22T01:29:05Z","Content":"if the root node is techTree, that\u0027s the one you need to check GameDatabase for. You can then get the RDNodes using techTreeNode.GetNodes(\u0022RDNode\u0022).\n\nAs for why there is two, I don\u0027t know. print them both to the log and see what they look like (the node.toString method will show values just as they would appear in a .cfg)"}]}