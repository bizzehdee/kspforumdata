{"TopicId":217544,"ForumId":29,"TopicTitle":"KSPAddon.Startup option for the mission builder scene?","CreatedByName":"UltraJohn","CreatedById":15008,"CreatedDateTime":"2023-06-04T20:58:39Z","PageNum":1,"Articles":[{"CreatedByName":"UltraJohn","CreatedById":15008,"CreatedDateTime":"2023-06-04T20:58:39Z","Content":"\n\u003Cp\u003E\nHello.\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027m currently trying to figure out how to get set a KSPAddon.Startup working for the mission builder scene. As far as I can tell, none of the options available works for this, except for KSPAddon.EveryScene. However this one for some reason acts very strange, where it runs multiple times in a row on the same scene load.\n\u003C/p\u003E\n\u003Cp\u003E\nWith a quick test like this:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-c prettyprinted\u0022\u003E\u003Cspan class=\u0022pun\u0022\u003E[\u003C/span\u003E\u003Cspan class=\u0022typ\u0022\u003EKSPAddon\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan class=\u0022typ\u0022\u003EKSPAddon\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan class=\u0022typ\u0022\u003EStartup\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan class=\u0022typ\u0022\u003EEveryScene\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E,\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Efalse\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E)]\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n\u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Epublic\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Eclass\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022typ\u0022\u003EHUDReplacerMissionBuilder\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E:\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022typ\u0022\u003EMonoBehaviour\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E{\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n\t\u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Epublic\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Evoid\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022typ\u0022\u003EAwake\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E()\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n\t\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E{\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n\t\t\u003C/span\u003E\u003Cspan class=\u0022typ\u0022\u003EDebug\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan class=\u0022typ\u0022\u003ELog\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan class=\u0022str\u0022\u003E\u0022HUDReplacer: Scene switch test: \u0022\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E\u002B\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022typ\u0022\u003EHighLogic\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan class=\u0022typ\u0022\u003ELoadedScene\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E);\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n\t\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E}\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E}\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nYou\u0027ll see in the log that this was fired twice for the SPACECENTER scene:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\u003Cspan class=\u0022pln\u0022\u003E[LOG 22:53:28.641] [HighLogic]: =========================== Scene Change : From MAINMENU to SPACECENTER (Async) =====================\n[LOG 22:53:28.848] [AddonLoader]: Instantiating addon \u0027HUDReplacerMissionBuilder\u0027 from assembly \u0027HUDReplacer\u0027\n[LOG 22:53:28.848] HUDReplacer: Scene switch test: SPACECENTER\n[LOG 22:53:28.848] [UIMasterController]: HideUI\n[LOG 22:53:29.556] [AddonLoader]: Instantiating addon \u0027CustomConfigsManager\u0027 from assembly \u0027ModuleManager\u0027\n[LOG 22:53:29.558] [AddonLoader]: Instantiating addon \u0027HUDReplacerMissionBuilder\u0027 from assembly \u0027HUDReplacer\u0027\n[LOG 22:53:29.558] HUDReplacer: Scene switch test: SPACECENTER\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nMoreso loading into the \u003Cabbr title=\u0022Vehicle Assembly Building\u0022\u003EVAB\u003C/abbr\u003E it\u0027ll fire off FOUR times:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\u003Cspan class=\u0022pln\u0022\u003E[LOG 22:54:51.467] [HighLogic]: =========================== Scene Change : From SPACECENTER to EDITOR (Async) =====================\n[LOG 22:54:51.611] [UIApp] OnDestroy: AlarmClock\n[LOG 22:54:51.612] ScaleModList: listSize 41 maxListSize 3233\n[LOG 22:54:51.612] [UIApp] OnDestroy: KSPedia\n[LOG 22:54:51.612] ScaleModList: listSize 41 maxListSize 3233\n[LOG 22:54:51.680] [AddonLoader]: Instantiating addon \u0027HUDReplacerMissionBuilder\u0027 from assembly \u0027HUDReplacer\u0027\n[LOG 22:54:51.681] HUDReplacer: Scene switch test: EDITOR\n[LOG 22:54:51.681] [UIMasterController]: HideUI\n[LOG 22:54:52.399] UICanvasPrefabSpawner SceneLogic spawning Editor\n[LOG 22:54:52.421] No Input Locks in effect right now\n[LOG 22:54:52.492] [AddonLoader]: Instantiating addon \u0027HUDReplacerMissionBuilder\u0027 from assembly \u0027HUDReplacer\u0027\n[LOG 22:54:52.492] HUDReplacer: Scene switch test: EDITOR\n[LOG 22:54:54.275] [UIMasterController]: HideUI\n[LOG 22:54:54.584] [AddonLoader]: Instantiating addon \u0027HUDReplacerMissionBuilder\u0027 from assembly \u0027HUDReplacer\u0027\n[LOG 22:54:54.584] HUDReplacer: Scene switch test: EDITOR\n[LOG 22:54:54.585] [UIMasterController]: ShowUI\n[LOG 22:54:54.738] [AddonLoader]: Instantiating addon \u0027HUDReplacerMissionBuilder\u0027 from assembly \u0027HUDReplacer\u0027\n[LOG 22:54:54.738] HUDReplacer: Scene switch test: EDITOR\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nThis doesn\u0027t happen using any of the explicit options of KSPAddon.Startup such as GameScenes.SpaceCentre, though none of these fires off at the mission builder scene. Unless I\u0027m missing something obvious, how would I go about getting one that\u0027s only targetting the mission builder?\n\u003C/p\u003E\n"},{"CreatedByName":"Nazalassa","CreatedById":217956,"CreatedDateTime":"2023-07-09T16:10:27Z","Content":"\n\u003Cp\u003E\nMy guess is that KSPAddon.Startup.EveryScene may be equivalent to all of the explicit options of KSPAddon.Startup, among which there are four that specify \u0022\u003Cabbr title=\u0022Vehicle Assembly Building\u0022\u003EVAB\u003C/abbr\u003E\u0022:\n\u003C/p\u003E\n\u003Cul\u003E\n\u003Cli\u003E\nEditorAny (both \u003Cabbr title=\u0022Vehicle Assembly Building\u0022\u003EVAB\u003C/abbr\u003E and \u003Cabbr title=\u0022SpacePlane Hangar\u0022\u003ESPH\u003C/abbr\u003E)\n\u003C/li\u003E\n\u003Cli\u003E\nEditorVAB (only \u003Cabbr title=\u0022Vehicle Assembly Building\u0022\u003EVAB\u003C/abbr\u003E)\n\u003C/li\u003E\n\u003Cli\u003E\nTwo more (EditorFlightAndTracking or similar names)\n\u003C/li\u003E\n\u003C/ul\u003E\n\u003Cp\u003E\n\u003Cspan style=\u0022text-decoration:underline;\u0022\u003EPossible fix\u003C/span\u003E: create a timer.\u003Cbr\u003E\nWhenever your function that runs on scene change is called, check if a certain amount of time (like 2 sec.) has elapsed since last time the timer was reset; if it is the case then it\u0027s likely that it\u0027s the first of the (possibly many) calls to the function on this scene change. So just reset the timer (so it is at 0 sec.). If it is less than 2 sec. or something, then don\u0027t do anything.\n\u003C/p\u003E\n"},{"CreatedByName":"UltraJohn","CreatedById":15008,"CreatedDateTime":"2023-07-09T16:38:29Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00224300991\u0022 data-ipsquote-contentid=\u0022217544\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221688919027\u0022 data-ipsquote-userid=\u0022217956\u0022 data-ipsquote-username=\u0022Nazalassa\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n17 minutes ago, Nazalassa said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nMy guess is that KSPAddon.Startup.EveryScene may be equivalent to all of the explicit options of KSPAddon.Startup, among which there are four that specify \u0022\u003Cabbr title=\u0022Vehicle Assembly Building\u0022\u003E\u003Cabbr title=\u0022Vehicle Assembly Building\u0022\u003EVAB\u003C/abbr\u003E\u003C/abbr\u003E\u0022:\n\u003C/p\u003E\n\u003Cul\u003E\n\u003Cli\u003E\nEditorAny (both \u003Cabbr title=\u0022Vehicle Assembly Building\u0022\u003E\u003Cabbr title=\u0022Vehicle Assembly Building\u0022\u003EVAB\u003C/abbr\u003E\u003C/abbr\u003E and \u003Cabbr title=\u0022SpacePlane Hangar\u0022\u003E\u003Cabbr title=\u0022SpacePlane Hangar\u0022\u003ESPH\u003C/abbr\u003E\u003C/abbr\u003E)\n\u003C/li\u003E\n\u003Cli\u003E\nEditorVAB (only \u003Cabbr title=\u0022Vehicle Assembly Building\u0022\u003E\u003Cabbr title=\u0022Vehicle Assembly Building\u0022\u003EVAB\u003C/abbr\u003E\u003C/abbr\u003E)\n\u003C/li\u003E\n\u003Cli\u003E\nTwo more (EditorFlightAndTracking or similar names)\n\u003C/li\u003E\n\u003C/ul\u003E\n\u003Cp\u003E\n\u003Cspan style=\u0022text-decoration:underline;\u0022\u003EPossible fix\u003C/span\u003E: create a timer.\u003Cbr\u003E\nWhenever your function that runs on scene change is called, check if a certain amount of time (like 2 sec.) has elapsed since last time the timer was reset; if it is the case then it\u0027s likely that it\u0027s the first of the (possibly many) calls to the function on this scene change. So just reset the timer (so it is at 0 sec.). If it is less than 2 sec. or something, then don\u0027t do anything.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nHmm it does make sense that this is the case why different scenes call the startup method varying amount of times, but it also doesn\u0027t seem like this should be the correct behavior? How many modders don\u0027t know about this and are accidentally initializing their mods more than once for no reason? Does this contribute to the longer and longer scene loading times we experience due to an increase in number of mods?\n\u003C/p\u003E\n\u003Cp\u003E\nThe other problem is that MissionBuilder never really got its own KSPAddon.Startup option, since it was added in a dlc later on. It seems a bit strange that I have to reference a startup option that runs in several different scenes, just to make a check for this specific one, and not only that also have to create a workaround for the \u0022random amount of initializations.\u0022\n\u003C/p\u003E\n\u003Cp\u003E\nThere used to exist a sort of solution for these problems back in 2014. Someone made an extension to KSPAddon to handle scenes as bitflags. Unfortunately it was never updated to recent versions of KSP, but it would be interesting to rework this and add in the MissionBuilder scene as well.\n\u003C/p\u003E\n\u003Ciframe allowfullscreen=\u0022\u0022 data-controller=\u0022core.front.core.autosizeiframe\u0022 data-embedauthorid=\u0022104043\u0022 data-embedcontent=\u0022\u0022 data-embedid=\u0022embed9510930956\u0022 src=\u0022https://forum.kerbalspaceprogram.com/topic/72301-expanded-kspaddon-modes/?do=embed\u0022 style=\u0022height:194px;max-width:502px;\u0022\u003E\u003C/iframe\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n"}]}