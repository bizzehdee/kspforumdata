{"TopicId":46423,"ForumId":29,"TopicTitle":".CS != .DLL Project VisiKerb hits a wall","CreatedByName":"Jahulath","CreatedById":78050,"CreatedDateTime":"2013-09-24T18:00:23Z","PageNum":1,"Articles":[{"CreatedByName":"Jahulath","CreatedById":78050,"CreatedDateTime":"2013-09-24T18:00:23Z","Content":"\n\u003Cp\u003EHi folks, I have been working on the plugin by SFR to try and fix a few things and generally make some nice looking command pods. Thus far I have been doing ok and getting some models up and running using \u003Ca href=\u0022http://kerbalspaceprogram.com/sfr-command-pod/\u0022 rel=\u0022external nofollow\u0022\u003Ethe original plugin that can be found here\u003C/a\u003E.\u003C/p\u003E\u003Cp\u003ESome images and that, sorry I got a bit carried away but those Kerbals just look so awesome in their little pods!\u003C/p\u003E\u003Cblockquote lang=\u0022en\u0022\u003E\u003Ca href=\u0022//imgur.com/a/Vs9IQ\u0022 rel=\u0022external nofollow\u0022\u003EJavascript is disabled. View full album\u003C/a\u003E\u003C/blockquote\u003E\u003Cp\u003EOk so I have a problem with the plugin code however my attempts at recreating the original .dll file from the source code have not worked well. The original .cs file does not Compile into a useable .dll file because the Kerbals do not spawn.\u003C/p\u003E\u003Cp\u003EWhat I have done thus far is to compile the code along with some tweaks, I got the IVA view working correctly and the code is running as shown by both debug warnings and the presence of the IVA model...\u003C/p\u003E\u003Cp\u003EBut still no Kerbals \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cry.gif\u0022 alt=\u0022;.;\u0022\u003E\u003C/p\u003E\u003Cp\u003EIf anyone has any suggestions, the offending code is here, I would be very happy if you could help...\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Eusing System;\u003Cbr\u003Eusing System.Collections.Generic;\u003Cbr\u003Eusing System.Linq;\u003Cbr\u003Eusing UnityEngine;\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003Enamespace sfrPartModules1\u003Cbr\u003E{\u003Cbr\u003E    class sfrUtility\u003Cbr\u003E    {\u003Cbr\u003E        public static Camera FindCamera(string name)\u003Cbr\u003E        {\u003Cbr\u003E            foreach (Camera c in Camera.allCameras)\u003Cbr\u003E                if (c.name == name)\u003Cbr\u003E                    return c;\u003Cbr\u003E            return null;\u003Cbr\u003E        }\u003Cbr\u003E\u003Cbr\u003E        public static void LogCameras()\u003Cbr\u003E        {\u003Cbr\u003E            int i = 0;\u003Cbr\u003E            foreach (Camera c in Camera.allCameras)\u003Cbr\u003E            {\u003Cbr\u003E                Debug.LogWarning(\u0022Cam \u0022 \u002B i\u002B\u002B \u002B \u0022 \u0022 \u002B c.name \u002B \u0022 \u0022 \u002B c.cullingMask);\u003Cbr\u003E                Debug.Log(c.transform.position \u002B \u0022 \u0022 \u002B c.transform.rotation.eulerAngles \u002B \u0022 \u0022 \u002B c.fov \u002B \u0022 \u0022 \u002B c.depth \u002B \u0022 \u0022 \u002B c.clearFlags);\u003Cbr\u003E            }\u003Cbr\u003E        }\u003Cbr\u003E\u003Cbr\u003E        public static void LogModules(Part part)\u003Cbr\u003E        {\u003Cbr\u003E            int i = 0;\u003Cbr\u003E            foreach (PartModule p in part.Modules)\u003Cbr\u003E                Debug.Log(\u0022Mod \u0022 \u002B i\u002B\u002B \u002B \u0022 \u0022 \u002B p.name \u002B \u0022 \u0022 \u002B p.GUIName \u002B \u0022 \u0022 \u002B p.guiText);\u003Cbr\u003E        }\u003Cbr\u003E    }\u003Cbr\u003E\u003Cbr\u003E// surplus class removed here\u003Cbr\u003E// Then on to the remainder\u003Cbr\u003E\u003Cbr\u003E public class sfrInternal : PartModule\u003Cbr\u003E    {\u003Cbr\u003E\u003Cbr\u003E        Transform kspParent;\u003Cbr\u003E        Vector3 kspPosition = new Vector3(18.3f, -6.9f, 0);\u003Cbr\u003E        Quaternion kspRotation = new Quaternion(0, 0.7f, -0.7f, 0);\u003Cbr\u003E        bool isActive = true;\u003Cbr\u003E\u003Cbr\u003E        public override void OnAwake()\u003Cbr\u003E        {\u003Cbr\u003E            base.OnAwake();\u003Cbr\u003E           Debug.LogWarning(\u0022sfrInternal OnAwake \u0022 \u002B GameInfo.gameScene \u002B \u0022 \u0022 \u002B part \u002B \u0022 \u0022 \u002B vessel);\u003Cbr\u003E        }\u003Cbr\u003E\u003Cbr\u003E        public override void OnLoad(ConfigNode node)\u003Cbr\u003E        {\u003Cbr\u003E            base.OnLoad(node);\u003Cbr\u003E           Debug.LogWarning(\u0022sfrInternal OnLoad \u0022 \u002B node.name);\u003Cbr\u003E\u003Cbr\u003E        }\u003Cbr\u003E\u003Cbr\u003E        public override void OnSave(ConfigNode node)\u003Cbr\u003E        {\u003Cbr\u003E            base.OnSave(node);\u003Cbr\u003E           Debug.LogWarning(\u0022sfrInternal OnSave \u0022 \u002B node.name);\u003Cbr\u003E\u003Cbr\u003E        }\u003Cbr\u003E\u003Cbr\u003E        public override void OnStart(StartState state)\u003Cbr\u003E        {\u003Cbr\u003E            base.OnStart(state);\u003Cbr\u003E           Debug.LogWarning(\u0022sfrInternal OnStart, StartState: \u0022 \u002B state);\u003Cbr\u003E\u003Cbr\u003E            Camera c = sfrUtility.FindCamera(\u0022Main Camera\u0022);\u003Cbr\u003E            if (c)\u003Cbr\u003E                c.cullingMask |= 1 \u0026lt;\u0026lt; 16 | 1 \u0026lt;\u0026lt; 20;\u003Cbr\u003E\u003Cbr\u003E            if(!part.internalModel)\u003Cbr\u003E            {\u003Cbr\u003E                try\u003Cbr\u003E                {\u003Cbr\u003E                    part.CreateInternalModel();\u003Cbr\u003E                }\u003Cbr\u003E                catch (Exception e)\u003Cbr\u003E                {\u003Cbr\u003E                    Debug.LogException(e, this);\u003Cbr\u003E                }\u003Cbr\u003E            }\u003Cbr\u003E\u003Cbr\u003E            if(part.internalModel)\u003Cbr\u003E            {\u003Cbr\u003E                if (state != StartState.Editor)\u003Cbr\u003E                    kspParent = part.internalModel.transform.parent;\u003Cbr\u003E\u003Cbr\u003E                part.internalModel.transform.parent = part.transform;\u003Cbr\u003E                part.internalModel.transform.localRotation = new Quaternion(0, 0.7f, -0.7f, 0);\u003Cbr\u003E                part.internalModel.transform.localPosition = Vector3.zero;\u003Cbr\u003E            }\u003Cbr\u003E        }\u003Cbr\u003E\u003Cbr\u003E        public override void OnUpdate()\u003Cbr\u003E        {\u003Cbr\u003E            base.OnUpdate();\u003Cbr\u003E        Debug.LogWarning(\u0022sfrInternal OnUpdate\u0022);\u003Cbr\u003E\u003Cbr\u003E            if (isActive != part.vessel.isActiveVessel)\u003Cbr\u003E            {\u003Cbr\u003E            Camera c = sfrUtility.FindCamera(\u0022Main Camera\u0022);\u003Cbr\u003E            if (c)\u003Cbr\u003E                c.cullingMask |= 1 \u0026lt;\u0026lt; 16 | 1 \u0026lt;\u0026lt; 20;\u003Cbr\u003E\u003Cbr\u003E                part.CreateInternalModel();\u003Cbr\u003E                kspParent = part.internalModel.transform.parent; // InternalCamera.Instance.transform.parent;\u003Cbr\u003E\u003Cbr\u003E                part.internalModel.SetVisible(true);\u003Cbr\u003E                part.vessel.SetActiveInternalPart(part);\u003Cbr\u003E\u003Cbr\u003E                if (part.protoModuleCrew.Count \u0026gt; 0 \u0026amp;\u0026amp; isActive)\u003Cbr\u003E                {\u003Cbr\u003E                    part.vessel.SpawnCrew();\u003Cbr\u003E                }\u003Cbr\u003E\u003Cbr\u003E                part.internalModel.transform.parent = part.transform;\u003Cbr\u003E                part.internalModel.transform.localRotation = new Quaternion(0, 0.7f, -0.7f, 0);\u003Cbr\u003E                part.internalModel.transform.localPosition = Vector3.zero;\u003Cbr\u003E            }      \u003Cbr\u003E\u003Cbr\u003E            if(!part.internalModel)\u003Cbr\u003E            {\u003Cbr\u003E   \t\tpart.CreateInternalModel();\u003Cbr\u003E                kspParent = part.internalModel.transform.parent; // InternalCamera.Instance.transform.parent;\u003Cbr\u003E\u003Cbr\u003E                part.internalModel.SetVisible(true);\u003Cbr\u003E                part.vessel.SetActiveInternalPart(part);\u003Cbr\u003E\u003Cbr\u003E                if (part.protoModuleCrew.Count \u0026gt; 0 \u0026amp;\u0026amp; isActive)\u003Cbr\u003E                {\u003Cbr\u003E                    part.vessel.SpawnCrew();\u003Cbr\u003E                }\u003Cbr\u003E\u003Cbr\u003E                part.internalModel.transform.parent = part.transform;\u003Cbr\u003E                part.internalModel.transform.localRotation = new Quaternion(0, 0.7f, -0.7f, 0);\u003Cbr\u003E                part.internalModel.transform.localPosition = Vector3.zero;\u003Cbr\u003E            }\u003Cbr\u003E\u003Cbr\u003E            try\u003Cbr\u003E            {\u003Cbr\u003E                if (sfrUtility.FindCamera(\u0022InternalCamera\u0022))\u003Cbr\u003E                {\u003Cbr\u003E                    if (part.vessel.isActiveVessel)\u003Cbr\u003E                    {\u003Cbr\u003E                        part.internalModel.transform.position = Vector3.zero;    //kspPosition; \u003Cbr\u003E//  Edited here to swap out for the Vector3.Zero as originally commented in the source\u003Cbr\u003E                        part.internalModel.transform.parent = kspParent;\u003Cbr\u003E                        part.internalModel.transform.localRotation = new Quaternion(0, 0.7f, -0.7f, 0);\u003Cbr\u003E                    }\u003Cbr\u003E                }\u003Cbr\u003E                else\u003Cbr\u003E                {\u003Cbr\u003E                    part.internalModel.transform.parent = part.transform;\u003Cbr\u003E                    part.internalModel.transform.localRotation = new Quaternion(0, 0.7f, -0.7f, 0);\u003Cbr\u003E                    part.internalModel.transform.localPosition = Vector3.zero;\u003Cbr\u003E                }\u003Cbr\u003E            }\u003Cbr\u003E            catch (Exception e)\u003Cbr\u003E            {\u003Cbr\u003E                Debug.LogException(e, this);\u003Cbr\u003E            }\u003Cbr\u003E\u003Cbr\u003E        }\u003Cbr\u003E\u003Cbr\u003E    }\u003Cbr\u003E\u003Cbr\u003E}\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n"}]}