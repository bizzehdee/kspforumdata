{"TopicId":148553,"ForumId":29,"TopicTitle":"How do i add particle effect in plugin?","CreatedByName":"rkfnql322","CreatedById":66671,"CreatedDateTime":"2016-09-24T15:52:50Z","PageNum":1,"Articles":[{"CreatedByName":"rkfnql322","CreatedById":66671,"CreatedDateTime":"2016-09-24T15:52:50Z","Content":"\n\u003Cp\u003E\nI\u0027ve been working on fuel jettison nozzle mod. For now, I\u0027ve done fuel subtracting plugin but now, I can\u0027t find way to add effect.\n\u003C/p\u003E\n\u003Cp\u003E\nSound seems to be easy to add with fxgroup. but how do i add smoke and fire?\n\u003C/p\u003E\n\u003Cp\u003E\nMy part is not a engine so moduleenginefx seems not appropriate and using KSPADDON seems too complicated.\n\u003C/p\u003E\n\u003Cp\u003E\nI just wanna know how to add default effects. What I\u0027m gonna make is a fuel jettison nozzle with long smoke trail, and fire trail when heated.\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003Eusing System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Text;\n\nnamespace MyKSPProject\n{\n    public class HelloKerbinMod : PartModule\n    {\n        FXGroup fx = new FXGroup(\u0022smoke\u0022);\n        \n        [KSPField(guiActive = true, guiActiveEditor = true, guiName = \u0022Status\u0022, isPersistant = true)]\n        string status;\n\n        [KSPField(guiActive = true, guiActiveEditor = false, guiFormat = \u0022F1\u0022, guiName = \u0022Fuel Amount\u0022, guiUnits = \u0022L\u0022, isPersistant = true)]\n        double fuel;\n\n        [KSPField(guiActive = true, guiActiveEditor = true, guiFormat = \u0022F1\u0022, guiName = \u0022Nozzle Size\u0022, guiUnits = \u0022cm^2\u0022, isPersistant = true)]\n        public float nozzleSize;\n\n        [KSPField(guiActive = true, guiActiveEditor = false, guiFormat = \u0022F0\u0022, guiName = \u0022Tanks found\u0022, isPersistant = true)]\n        public int tanks;\n\n        [KSPEvent(active = true, externalToEVAOnly = false, guiActive = true, guiActiveEditor = false, guiActiveUncommand = false, guiActiveUnfocused = false, name = \u0022toggleNozzle\u0022, guiName = \u0022Toggle Nozzle\u0022)]\n        public void toggleNozzle()\n        {\n            part.enabled = !part.enabled;\n            if (fuel == 0)\n            {\n                status = \u0022TANK EMPTY\u0022;\n            }\n            else\n            {\n                status = part.enabled ? \u0022Opend\u0022 : \u0022Closed\u0022;\n            }\n        }\n\n        public void consumeFuel()\n        {\n            foreach (Part p in vessel.parts)\n            {\n                foreach (PartResource r in p.Resources)\n                {\n                    if (r.resourceName == \u0022LiquidFuel\u0022 \u0026amp;\u0026amp; r.amount \u0026gt; 0)\n                    {\n                        r.amount -= nozzleSize / tanks;\n                        fx.setActive(true);\n                    }\n\n                    if (r.amount \u0026lt; 0)\n                    {\n                        r.amount = 0;\n                    }\n                }\n            }\n        }\n\n\n\n\n        public override void OnLoad(ConfigNode node)\n        {\n            nozzleSize = float.Parse(node.GetValue(\u0022nozzleSize\u0022));\n\n            if (fuel == 0)\n            {\n                status = \u0022TANK EMPTY\u0022;\n            }\n            else\n            {\n                status = part.enabled ? \u0022Opend\u0022 : \u0022Closed\u0022;\n            }\n\n            fx.name = \u0022fx_smokeTrail_medium\u0022;\n\n            part.enabled = false;\n            part.deactivate();\n            base.OnLoad(node);\n        }\n\n        public override void OnUpdate()\n        {\n            consumeFuel();\n            if (!status.Contains(\u0022TEMP\u0022) \u0026amp;\u0026amp; part.temperature \u0026gt;= 1000)\n            {\n                status \u002B= \u0022 TEMP WARNING!!\u0022;\n            }\n            base.OnUpdate();\n        }\n\n        public void Update()\n        {\n            EstimateFuel();\n        }\n\n        public void EstimateFuel()\n        {\n            double tmpfuel = 0;\n            int tmptanks = 0;\n            foreach (Part p in vessel.parts)\n            {\n                foreach (PartResource r in p.Resources)\n                {\n                    if (r.resourceName == \u0022LiquidFuel\u0022)\n                    {\n                        tmpfuel \u002B= r.amount;\n                        tmptanks\u002B\u002B;\n                    }\n                }\n            }\n            fuel = tmpfuel;\n            tanks = tmptanks;\n\n            if (fuel \u0026lt;= 0)\n            {\n                part.enabled = false;\n            }\n        }\n    }\n\n}\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nhere\u0027s the code. and let me ask one more thing.. why status is not refreshed at first time in flight scene? status field is blank when its started and starts to display something after when i activate KSPEVENT.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n"}]}