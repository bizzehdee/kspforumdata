{"TopicId":110975,"ForumId":29,"TopicTitle":"Pitch and Heading of Prograde vector","CreatedByName":"captncraig","CreatedById":144208,"CreatedDateTime":"2015-05-27T03:40:47Z","PageNum":1,"Articles":[{"CreatedByName":"captncraig","CreatedById":144208,"CreatedDateTime":"2015-05-27T03:40:47Z","Content":"I am wanting to make a more advanced navball that I can run in a browser for my physical console project.\n\nI am hoping to modify the navball code from [https://github.com/creshal/telemachus-glass-cockpit](https://github.com/creshal/telemachus-glass-cockpit) which is built on data from telemachus.\n\nIt is able to draw the navball by reading rawPitch, rawHeading and rawRoll from telemachus (calculated with this code: [https://github.com/richardbunt/Telemachus/blob/master/Telemachus/src/DataLinkHandlers.cs#L1123](https://github.com/richardbunt/Telemachus/blob/master/Telemachus/src/DataLinkHandlers.cs#L1123))\n\nIn order to render prograde, retrograde, maneuver, etc.., I need to modify telemachus to give me raw pitch and heading data for those vectors.\n\nIf I take \n\n    [COLOR=#333333]Vector3 prograde = this.vessel.GetObtVelocity();[/COLOR]\n\n I get a vector in x,y,z space. That is about as far as I have gotten. I need to transform this into pitch and heading values relative to the current body in order to render them on the navball. \n\nCan anyone point me in the right direction?"},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2015-05-27T04:44:31Z","Content":"Calculate prograde pitch by the angle between prograde and [surface normal](https://github.com/Crzyrndm/Pilot-Assistant/blob/master/PilotAssistant/Utility/FlightData.cs#L47) like [this](https://github.com/Crzyrndm/Pilot-Assistant/blob/master/PilotAssistant/Utility/FlightData.cs#L57) (substituting vessel.up (forward in KSP) for the prograde vector). Heading is a bit more complex, but you can also find the calculations required at that link\n\n**Edited \u003Ctime datetime=\u00222015-05-27T04:59:22Z\u0022 title=\u002205/27/2015 04:59  AM\u0022 data-short=\u00229 yr\u0022\u003EMay 27, 2015\u003C/time\u003E by Crzyrndm**"},{"CreatedByName":"captncraig","CreatedById":144208,"CreatedDateTime":"2015-05-27T18:52:58Z","Content":"I think the prograde heading is the same as the surface heading in your linked code, so thanks for that. The pitch is not working for me. I\u0027ll keep trying a few things and post my code in a bit."},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2015-05-27T22:01:32Z","Content":"\u003E \n\u003E I think the prograde heading is the same as the surface heading in your linked code\n\nThey are very slightly different (surf**Vel**Forward and surf**Ves**Forward as the reference vector)"},{"CreatedByName":"captncraig","CreatedById":144208,"CreatedDateTime":"2015-05-28T04:19:21Z","Content":"Yeah, I\u0027m having a bit of trouble with the pitch:\n\n    [FONT=Menlo][COLOR=#009695]var [/COLOR][COLOR=#333333]planetUp[/COLOR][COLOR=#333333]=[/COLOR][COLOR=#333333]([/COLOR][COLOR=#333333]thisVessel[/COLOR][COLOR=#333333].[/COLOR][COLOR=#333333]rootPart[/COLOR][COLOR=#333333].[/COLOR][COLOR=#333333]transform[/COLOR][COLOR=#333333].[/COLOR][COLOR=#333333]position[/COLOR][COLOR=#333333]-[/COLOR][COLOR=#333333]thisVessel[/COLOR][COLOR=#333333].[/COLOR][COLOR=#333333]mainBody[/COLOR][COLOR=#333333].[/COLOR][COLOR=#333333]position[/COLOR][COLOR=#333333])[/COLOR][COLOR=#333333].[/COLOR][COLOR=#333333]normalized[/COLOR][COLOR=#333333];[/COLOR][COLOR=#009695]var [/COLOR][COLOR=#333333]pitch[/COLOR][COLOR=#333333]=[/COLOR][COLOR=#3364a4]Vector3d[/COLOR][COLOR=#333333].[/COLOR][COLOR=#333333]Angle[/COLOR][COLOR=#333333]([/COLOR][COLOR=#333333]planetUp[/COLOR][COLOR=#333333],[/COLOR][COLOR=#333333]thisVessel[/COLOR][COLOR=#333333].[/COLOR][COLOR=#333333]obt_velocity[/COLOR][COLOR=#333333].[/COLOR][COLOR=#333333]normalized[/COLOR][COLOR=#333333])[/COLOR][COLOR=#333333];[/COLOR][COLOR=#009695]return [/COLOR][COLOR=#333333]pitch[/COLOR][COLOR=#333333];[/COLOR][/FONT]\n\nI would expect this to stay at or near 0 as I ascend pointing straight up. It starts at around 90 and shrinks gradually to around 11 or so degrees as I climb. This is obviously not correct. Thanks for your help. I got the heading working perfectly."},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2015-05-28T04:21:23Z","Content":"pitch at launch would be zero relative to surface velocity, not orbital velocity (navball starts in surface mode). It starts at 90 degrees because the rotational velocity of the planet is perpendicular to the up vector, then shrinks as your vertical velocity increases."},{"CreatedByName":"captncraig","CreatedById":144208,"CreatedDateTime":"2015-05-28T15:03:49Z","Content":"Ok, that actually makes a lot of sense. I got it pretty good using surface velocity under 36000 and orbit velocity above that. \n\nIs there a table somewhere of altitudes for switching surface -\u003E orbit mode for all bodies? Or even better a useful formula?\n\nThanks for all your help!"},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2015-05-28T21:46:32Z","Content":"Go by the display mode\n\n    FlightUIController.speedDisplayMode"}]}