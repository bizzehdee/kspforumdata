{"TopicId":108699,"ForumId":29,"TopicTitle":"Spawning from a ProtoCrewMember","CreatedByName":"rhoark","CreatedById":57151,"CreatedDateTime":"2015-05-11T00:46:02Z","PageNum":1,"Articles":[{"CreatedByName":"rhoark","CreatedById":57151,"CreatedDateTime":"2015-05-11T00:46:02Z","Content":"I\u0027m trying to put a kerbal in the world given a ProtoCrewMember. Doing some cargo cult programming looking at [what ContractConfigurator does](https://github.com/jrossignol/ContractConfigurator/blob/master/source/ContractConfigurator/ContractBehaviour/SpawnKerbal.cs), I came up with this:\n\n    ProtoCrewMember protocrew = [etc...]var flight = ShipConstruction.GetUniqueFlightID(HighLogic.CurrentGame.flightState);var crew = new ProtoCrewMember[1];crew[0] = protocrew;var parts = new ConfigNode[1];parts[0] = ProtoVessel.CreatePartNode(\u0022kerbalEVA\u0022, flight, crew);var nothing = new ConfigNode[0];var orbit = new Orbit(0,0,0,0,0,0,0,vessel.mainBody);var position = vessel.GetWorldPos3D();orbit.UpdateFromStateVectors(position, vessel.mainBody.getRFrmVel(position), vessel.mainBody, Planetarium.GetUniversalTime());var vesselConfig = ProtoVessel.CreateVesselNode(protocrew.name, VesselType.EVA, orbit, 0, parts, nothing);var protoVessel = HighLogic.CurrentGame.AddVessel(vesselConfig);\n\nTrying this from the launchpad, the result is always a message in the log \u0022Vessel Jebediah Kerman crashed through terrain on Kerbin\u0022. I\u0027m guessing that means something is wrong with the orbit I\u0027m providing, or the position it is based on, but I don\u0027t see how that could be since they\u0027re constructed based on a vessel not crashing through terrain."},{"CreatedByName":"TAz00","CreatedById":41667,"CreatedDateTime":"2015-05-11T06:17:50Z","Content":"Check this out : [https://github.com/godarklight/DarkMultiPlayer/blob/master/Client/ScenarioWorker.cs](https://github.com/godarklight/DarkMultiPlayer/blob/master/Client/ScenarioWorker.cs)\n\nThere\u0027s a \u0027GenerateStrandedKerbal\u0027 method"},{"CreatedByName":"rhoark","CreatedById":57151,"CreatedDateTime":"2015-05-11T14:47:46Z","Content":"Spawning in a random orbit like DarkMultiplayer does seems to go fine. I need a landed kerbal, though."},{"CreatedByName":"rhoark","CreatedById":57151,"CreatedDateTime":"2015-05-12T01:17:44Z","Content":"Getting closer - I now have a landed kerbal. However, it doesn\u0027t seem to actually initialize gender, trait, or personality from the provided ProtoCrewMember.\n\nHere\u0027s what I\u0027m doing:\n\n    uint LetThereBeKerbal(ProtoCrewMember protocrew) {\tvar body = vessel.mainBody;\tvar flight = ShipConstruction.GetUniqueFlightID(HighLogic.CurrentGame.flightState);\tvar crew = new ProtoCrewMember[1];\tcrew[0] = protocrew;\tvar parts = new ConfigNode[1];\tparts[0] = ProtoVessel.CreatePartNode(\u0022kerbalEVA\u0022, flight, crew);\tvar extra = new ConfigNode[0];\tvar orbit = Orbit.CreateRandomOrbitAround(body);\tvar vesselConfig = ProtoVessel.CreateVesselNode(protocrew.name, VesselType.EVA, orbit, 0, parts, extra);\tvar position = part.transform.position;\tposition \u002B= (position-body.position).normalized * 5.0;\tvesselConfig.SetValue(\u0022sit\u0022, Vessel.Situations.LANDED.ToString());\tvesselConfig.SetValue(\u0022landed\u0022, true.ToString());\tvesselConfig.SetValue(\u0022lat\u0022, (body.GetLatitude(position)).ToString());\tvesselConfig.SetValue(\u0022lon\u0022, (body.GetLongitude(position)).ToString());\tvesselConfig.SetValue(\u0022alt\u0022, (body.GetAltitude(position)).ToString());\tvar protoVessel = HighLogic.CurrentGame.AddVessel(vesselConfig);\treturn flight;}"}]}