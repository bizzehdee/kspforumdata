{"TopicId":87147,"ForumId":29,"TopicTitle":"How does Science work?","CreatedByName":"jamespicone","CreatedById":125714,"CreatedDateTime":"2014-10-13T04:23:11Z","PageNum":1,"Articles":[{"CreatedByName":"jamespicone","CreatedById":125714,"CreatedDateTime":"2014-10-13T04:23:11Z","Content":"\n\u003Cp\u003EHi all. I\u0027ve got some ideas for a mod to change the way science data is collected/stored/converted into science points (briefly, instead of experiments that run once and store data, you have sensors that collect data continuously, comms antennas send it back continuously, and it asymptotically approaches max science for that biome/situation/data type situation), but I\u0027m running into a bit of a block in that the various science classes aren\u0027t terribly well-documented, at least as far as I can see. Does anyone know what the \u0027science lifecycle\u0027 is? My current understanding is something like this:\u003C/p\u003E\u003Cp\u003E- Vessels have a ModuleScienceExperiment and optionally a ModuleDataTransmitter and some ModuleScienceContainers. (Do EVAs have a ModuleScienceExperiment? Crew capsules definitely do.)\u003C/p\u003E\u003Cp\u003E- At some point in flight, DeployExperiment() or DeployAction(KSPActionParam) get called. That triggers any relevant animation and creates a ScienceData. ScienceData is created as a number of mits, with an id that points into the science subject table and provides the data-per-mit information. Also stores the reduction for transmission and the boosted-by-lab state per-sciencedata. The ModuleScienceExperiment keeps that ScienceData in an internal array. Relevant: ScienceUtil is used to get experimental biome/situation. What does GetTransmitterScore do?\u003C/p\u003E\u003Cp\u003E- If comms: ModuleDataTransmitter::StartTransmission() or TransmitData() get called, do something to increment science at home, and call ModuleScienceExperiment::DumpData()\u003C/p\u003E\u003Cp\u003E- If collected by Kerbal: ModuleScienceExperiment::CollectDataExternalEvent() gets called, does something?\u003C/p\u003E\u003Cp\u003E- If moved into ModuleScienceContainer: Don\u0027t know. Presumably AddData() gets called on the modulesciencecontainer or something? Which object is responsible for this? When is this used? Presumably EVA Kerbals returning to a command pod or the like trigger this.\u003C/p\u003E\u003Cp\u003E- If recovered: ScienceData in modules is transformed into science points somehow.\u003C/p\u003E\u003Cp\u003EEssentially I\u0027m interested in how the conversion to science points happens and how I can do it myself - essentially, implementing MyModuleScienceExperiment that does things completely differently. I\u0027m not sure there\u0027s a clean way to implement what I\u0027m thinking of doing on top of the current mechanics - maybe have a ModuleScienceExperiment that every FixedUpdate() makes ScienceData at very small data sizes and then SendEvent(StartTransmitting()), but that\u0027s pretty ugly. I\u0027m not sure I can safely \u0027merge\u0027 ScienceData objects.\u003C/p\u003E\u003Cp\u003EAny thoughts?\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-10-13T05:22:22Z\u0022 title=\u002210/13/2014 05:22  AM\u0022 data-short=\u00229 yr\u0022\u003EOctober 13, 2014\u003C/time\u003E by jamespicone\u003C/strong\u003E\n\u003Cbr\u003EEmoticons!\n\u003C/span\u003E\n"},{"CreatedByName":"jamespicone","CreatedById":125714,"CreatedDateTime":"2014-10-15T14:53:19Z","Content":"\n\u003Cp\u003EI\u0027ve done some more work on this and asked around a lot in the #kspmodding channel on EsperNet, the central class here is ResearchAndDevelopment. In particular, ResearchAndDevelopment.GetExperimentSubject, GetExperiment, GetScienceValue, and SubmitScienceData. I\u0027ve now got my mod at the point where it can generate pseudo-ScienceData and when the vessel is recovered it gets collected. Buuuuuttttt.... the Research and Development archives don\u0027t update properly, science doesn\u0027t update properly, and in general it\u0027s not quite functioning right.\u003C/p\u003E\u003Cp\u003ECode is here: \u003Ca href=\u0022https://code.google.com/p/ssaad/source/browse/\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://code.google.com/p/ssaad/source/browse/\u003C/a\u003E . I\u0027m doing the following to update science during vessel recovery:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Epublic void handleRecoveryProcessing(ProtoVessel pv, MissionRecoveryDialog d, float f) {\u003Cbr\u003E            foreach (JMPScienceSubject s in scienceData.Keys) {\u003Cbr\u003E                float sci = ResearchAndDevelopment.GetScienceValue(scienceData[s], s.subject);\u003Cbr\u003E                ResearchAndDevelopment.Instance.SubmitScienceData(scienceData[s], s.subject);\u003Cbr\u003E\u003Cbr\u003E                d.AddDataWidget(new MissionRecoveryDialog.ScienceSubjectWidget(s.subject, scienceData[s], sci));\u003Cbr\u003E            }\u003Cbr\u003E\u003Cbr\u003E            scienceData.Clear();\u003Cbr\u003E            capacityUsed = 0;\u003Cbr\u003E            part.RequestResource(\u0022DataStorage\u0022, -capacity);\u003Cbr\u003E\u003Cbr\u003E            GameEvents.onVesselRecoveryProcessing.Remove(handleRecoveryProcessing);\u003Cbr\u003E        }\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EThe MissionRecoveryDialog is displaying 0.0 for science earned (which I can fix by adding to MissionRecoveryDialog.scienceEarned, but that doesn\u0027t seem like the right way to do things), and while the subjects are showing up in the research and development archives, they\u0027re displaying as having 0 science done on them and the bar is completely empty. I also get full value of any additional missions hitting the same science subject. Anyone have any ideas why that\u0027s happening and how I can fix it? I\u0027ve tried playing around with the fields of ScienceSubject during recovery processing and that doesn\u0027t seem to be helping any.\u003C/p\u003E\n"},{"CreatedByName":"jamespicone","CreatedById":125714,"CreatedDateTime":"2014-10-16T06:17:26Z","Content":"\n\u003Cp\u003EFigured it out, I have to call ResearchAndDevelopment.GetSubjectByID() during recovery processing to get the ScienceSubject to do stuff to.\u003C/p\u003E\n"}]}