{"TopicId":66213,"ForumId":29,"TopicTitle":"Spawning a single part as a vessel in orbit","CreatedByName":"oakwhiz","CreatedById":105647,"CreatedDateTime":"2014-03-19T10:57:16Z","PageNum":1,"Articles":[{"CreatedByName":"oakwhiz","CreatedById":105647,"CreatedDateTime":"2014-03-19T10:57:16Z","Content":"\n\u003Cp\u003EI can\u0027t seem to figure out what the procedure is for taking a part and spawning it as a debris object in a particular orbit. I know that debris objects are just vessels, so I\u0027m assuming that I have to create a Vessel, add a Part to the Vessel, add an Orbit to the Vessel, and then create a ProtoVessel from that Vessel. I haven\u0027t been able to find any documentation on instantiating a new vessel though.\u003C/p\u003E\u003Cp\u003EAny pointers as to where I should start?\u003C/p\u003E\n"},{"CreatedByName":"Faark","CreatedById":69775,"CreatedDateTime":"2014-03-19T11:11:29Z","Content":"\n\u003Cp\u003EI would approach it the other way around: Create a savegame with your debris vessel, inspect its ConfigNodes and learn how to generate those ConfigNodes, then create the ProtoVessel from them and use its loading code...\u003C/p\u003E\n"},{"CreatedByName":"oakwhiz","CreatedById":105647,"CreatedDateTime":"2014-03-19T13:44:49Z","Content":"\n\u003Cp\u003EI tried the following code but it generates an exception in the chunk of code after \u0022Set orbit params\u0022. I can\u0027t figure out what I\u0027m doing wrong here. There has got to be a way to create a vessel dynamically.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E            // Find the Kerbin CelestialBody\u003Cbr\u003E            CelestialBody kerbin = null;\u003Cbr\u003E            foreach (CelestialBody aBody in FlightGlobals.Bodies)\u003Cbr\u003E            {\u003Cbr\u003E                if (aBody.name == \u0022Kerbin\u0022)\u003Cbr\u003E                {\u003Cbr\u003E                    kerbin = aBody;\u003Cbr\u003E                }\u003Cbr\u003E            }\u003Cbr\u003E\u003Cbr\u003E            // Create a new blank vessel\u003Cbr\u003E            Vessel newVessel = new Vessel();\u003Cbr\u003E\u003Cbr\u003E            // Add a part to the vessel\u003Cbr\u003E             Debug.Log(\u0022getPartInfoByName\u0022);\u003Cbr\u003E            AvailablePart ap = PartLoader.getPartInfoByName(\u0022cupola\u0022);\u003Cbr\u003E             Debug.Log(\u0022Instantiate\u0022);\u003Cbr\u003E            UnityEngine.Object obj = UnityEngine.Object.Instantiate(ap.partPrefab);\u003Cbr\u003E             Debug.Log(\u0022newPart\u0022);\u003Cbr\u003E            Part newPart = (Part)obj;\u003Cbr\u003E             Debug.Log(\u0022rootPart ; parts.Add()\u0022);\u003Cbr\u003E            newPart.gameObject.name = \u0022cupola\u0022;\u003Cbr\u003E            newPart.partInfo = ap;\u003Cbr\u003E            newVessel.rootPart = newPart;\u003Cbr\u003E            newVessel.parts = new List\u0026lt;Part\u0026gt;();\u003Cbr\u003E            newVessel.parts.Add(newPart);\u003Cbr\u003E\u003Cbr\u003E            // Set vessel parameters\u003Cbr\u003E             Debug.Log(\u0022Set vessel params\u0022);\u003Cbr\u003E            newVessel.Landed = false;\u003Cbr\u003E         \tnewVessel.Splashed = false;\u003Cbr\u003E         \tnewVessel.landedAt = string.Empty;\u003Cbr\u003E            newVessel.situation = Vessel.Situations.ORBITING;\u003Cbr\u003E            newVessel.vesselType = VesselType.Debris;\u003Cbr\u003E\u003Cbr\u003E            // Set up an orbit for the vessel\u003Cbr\u003E             Debug.Log(\u0022Set orbit params\u0022);\u003Cbr\u003E            double utTime = Planetarium.GetUniversalTime();\u003Cbr\u003E            OrbitPhysicsManager.HoldVesselUnpack(180);\u003Cbr\u003E            // The next line tries to put the debris somewhere around the CelestialBody\u003Cbr\u003E            newVessel.orbit.UpdateFromStateVectors((UnityEngine.Random.onUnitSphere \u002B UnityEngine.Random.insideUnitSphere) * 200000f, UnityEngine.Random.onUnitSphere * 5000f, kerbin, utTime);\u003Cbr\u003E            newVessel.orbit.Init();\u003Cbr\u003E            newVessel.orbit.UpdateFromUT(utTime);\u003Cbr\u003E            newVessel.orbitDriver.pos = newVessel.orbit.pos.xzy;\u003Cbr\u003E            newVessel.orbitDriver.vel = newVessel.orbit.vel;\u003Cbr\u003E\u003Cbr\u003E\t\t\t// Set rotation parameters\u003Cbr\u003E\t\t\tnewVessel.SetRotation(UnityEngine.Random.rotation);\u003Cbr\u003E            newVessel.angularMomentum = Vector3.zero;\u003Cbr\u003E            newVessel.angularVelocity = Vector3.zero;\u003Cbr\u003E\u003Cbr\u003E            // ???\u003Cbr\u003E             Debug.Log(\u0022GoOnRails\u0022);\u003Cbr\u003E            newVessel.GoOnRails();\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EOutput:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003ESet orbit params\u003Cbr\u003E[Exception]: NullReferenceException: Object reference not set to an instance of an object\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n"},{"CreatedByName":"problemecium","CreatedById":101649,"CreatedDateTime":"2014-03-30T02:25:57Z","Content":"\n\u003Cp\u003EAny progress on this? Someday when I\u0027m a more experienced modder I was considering trying to make the \u0022other\u0022 space center launch ships randomly, although without the full launch simulation.\u003C/p\u003E\n"}]}