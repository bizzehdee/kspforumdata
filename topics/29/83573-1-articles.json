{"TopicId":83573,"ForumId":29,"TopicTitle":"[SOLVED] Resource Manipulation Help","CreatedByName":"jandcando","CreatedById":66121,"CreatedDateTime":"2014-09-01T21:51:37Z","PageNum":1,"Articles":[{"CreatedByName":"jandcando","CreatedById":66121,"CreatedDateTime":"2014-09-01T21:51:37Z","Content":"\n\u003Cp\u003EI have started writing my first plugin for my mod, Impossible Innovations, and I\u0027m adding intakes for collecting hydrogen and a converter for converting it into deuterium or tritium. But I ran into a problem:\u003C/p\u003E\u003Cp\u003EEverything works perfectly, but I have been manipulating resources with:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Epublic override void OnUpdate()\u003Cbr\u003E{\u003Cbr\u003Ebase.OnUpdate();\u003Cbr\u003E\u003Cbr\u003Ethis.part.RequestResource(\u0022Hydrogen\u0022, -1);\u003Cbr\u003E}\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EBut the code above is highly dependent on the set Delta Time and it is not affected by time warp. Also, when using physical time warp the rate goes down by a factor of 2 for each warp step.\u003C/p\u003E\u003Cp\u003EI want to know how to manipulate resources based on ingame-seconds, not delta seconds. Can anyone help me out on this?\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-09-09T23:47:33Z\u0022 title=\u002209/09/2014 11:47  PM\u0022 data-short=\u00229 yr\u0022\u003ESeptember 9, 2014\u003C/time\u003E by jandcando\u003C/strong\u003E\n\u003Cbr\u003ENOW its solved\n\u003C/span\u003E\n"},{"CreatedByName":"NathanKell","CreatedById":75006,"CreatedDateTime":"2014-09-01T23:41:23Z","Content":"\n\u003Cp\u003E(-X * Timewarp.fixedDeltaTime) is what you want (where X is units per second of UT), and you need to do this in OnFixedUpdate (which is done per tick) rather than OnUpdate, which is done per visual frame.\u003C/p\u003E\n"},{"CreatedByName":"jandcando","CreatedById":66121,"CreatedDateTime":"2014-09-02T10:34:22Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022NathanKell\u0022 data-cite=\u0022NathanKell\u0022\u003E\u003Cdiv\u003E(-X * Timewarp.fixedDeltaTime) is what you want (where X is units per second of UT), and you need to do this in OnFixedUpdate (which is done per tick) rather than OnUpdate, which is done per visual frame.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EOk I\u0027ll give that a try!\u003C/p\u003E\n"},{"CreatedByName":"jandcando","CreatedById":66121,"CreatedDateTime":"2014-09-02T20:05:51Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022NathanKell\u0022 data-cite=\u0022NathanKell\u0022\u003E\u003Cdiv\u003E(-X * Timewarp.fixedDeltaTime) is what you want (where X is units per second of UT), and you need to do this in OnFixedUpdate (which is done per tick) rather than OnUpdate, which is done per visual frame.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ESo this is what I need to do if I want 1 hydrogen per second?\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Epublic override void OnFixedUpdate()\u003Cbr\u003E{\u003Cbr\u003E     this.part.RequestResource(\u0022Hydrogen\u0022, Timewarp.fixedDeltaTime * -1f);\u003Cbr\u003E\u003Cbr\u003E     base.OnFixedUpdate();\u003Cbr\u003E}\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EThis code isn\u0027t being called for some reason, though.\u003C/p\u003E\n"},{"CreatedByName":"NathanKell","CreatedById":75006,"CreatedDateTime":"2014-09-03T06:29:55Z","Content":"\n\u003Cp\u003EPartModule-derived class, or a KSPAddon?\u003C/p\u003E\u003Cp\u003EIf the former make sure it\u0027s been Started by KSP (and is active). If the latter, use FixedUpdate().\u003C/p\u003E\u003Cp\u003E(That code looks correct to me, for a module)\u003C/p\u003E\n"},{"CreatedByName":"jandcando","CreatedById":66121,"CreatedDateTime":"2014-09-03T21:16:47Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022NathanKell\u0022 data-cite=\u0022NathanKell\u0022\u003E\u003Cdiv\u003EPartModule-derived class, or a KSPAddon?\u003Cp\u003EIf the former make sure it\u0027s been Started by KSP (and is active). If the latter, use FixedUpdate().\u003C/p\u003E\u003Cp\u003E(That code looks correct to me, for a module)\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EIt\u0027s a PartModule extension, and it worked when it was called OnUpdate(), but when I call OnFixedUpdate() it just gets ignored from what I can tell. I\u0027m going to keep experimenting with this.\u003C/p\u003E\n"},{"CreatedByName":"jandcando","CreatedById":66121,"CreatedDateTime":"2014-09-05T23:59:50Z","Content":"\n\u003Cp\u003EOh I found what the problem is! I need to call part.forceactivate() so that the part is active when the flight loads. Apparently OnFixedUpdate isn\u0027t called unless the part is active.\u003C/p\u003E\n"},{"CreatedByName":"stupid_chris","CreatedById":62017,"CreatedDateTime":"2014-09-09T16:30:39Z","Content":"\n\u003Cp\u003EExcept that activates every PartModule on the part. Not a good practice. Just use FixedUpdate(), you won\u0027t need to to that. You\u0027ll just need to add something like \u0022if (!HighLogic.LoadedSceneIsFlight) { return; }\u0022 at the top but that\u0027s all.\u003C/p\u003E\n"},{"CreatedByName":"jandcando","CreatedById":66121,"CreatedDateTime":"2014-09-09T19:24:32Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022stupid_chris\u0022 data-cite=\u0022stupid_chris\u0022\u003E\u003Cdiv\u003EExcept that activates every PartModule on the part. Not a good practice. Just use FixedUpdate(), you won\u0027t need to to that. You\u0027ll just need to add something like \u0022if (!HighLogic.LoadedSceneIsFlight) { return; }\u0022 at the top but that\u0027s all.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI don\u0027t see any documentation for FixedUpdate(). If you actually meant OnFixedUpdate, I tried that and it didn\u0027t work unless the part was activated.\u003C/p\u003E\u003Cp\u003EI\u0027m new to KSP modding, soo sorry if I\u0027m being ignorant right now...\u003C/p\u003E\n"},{"CreatedByName":"NathanKell","CreatedById":75006,"CreatedDateTime":"2014-09-09T21:58:09Z","Content":"\n\u003Cp\u003EOnFixedUpdate is run by KSP, only when the part is active (and only works on PartModule-derived classes).\u003C/p\u003E\u003Cp\u003EFixedUpdate is run by Unity, always.\u003C/p\u003E\n"},{"CreatedByName":"jandcando","CreatedById":66121,"CreatedDateTime":"2014-09-09T22:38:18Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022NathanKell\u0022 data-cite=\u0022NathanKell\u0022\u003E\u003Cdiv\u003EOnFixedUpdate is run by KSP, only when the part is active (and only works on PartModule-derived classes).\u003Cp\u003EFixedUpdate is run by Unity, always.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EOk that should simplify my code greatly. Thanks!\u003C/p\u003E\n"},{"CreatedByName":"jandcando","CreatedById":66121,"CreatedDateTime":"2014-09-09T23:08:21Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022NathanKell\u0022 data-cite=\u0022NathanKell\u0022\u003E\u003Cdiv\u003EOnFixedUpdate is run by KSP, only when the part is active (and only works on PartModule-derived classes).\u003Cp\u003EFixedUpdate is run by Unity, always.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI tried this:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E public override void FixedUpdate()\u003Cbr\u003E        {\u003Cbr\u003E            if (intakeActive == \u0022Active\u0022)\u003Cbr\u003E            {\u003Cbr\u003E                part.RequestResource(\u0022Hydrogen\u0022, ((this.part.vessel.atmDensity * -1.4f) - 0.01f) * TimeWarp.fixedDeltaTime);\u003Cbr\u003E            }\u003Cbr\u003E        }\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EThis code produced the error:\u003C/p\u003E\u003Cp\u003E\u0027ImpossibleInnovations.ModuleIIHydrogenIntake.FixedUpdate()\u0027: no suitable method found to override\u003C/p\u003E\u003Cp\u003EAm I missing a reference? I have Assembly-CSharp.dll and UnityEngine.dll referenced already.\u003C/p\u003E\n"},{"CreatedByName":"NathanKell","CreatedById":75006,"CreatedDateTime":"2014-09-09T23:09:06Z","Content":"\n\u003Cp\u003Enothing to override; just use public void FixedUpdate\u003C/p\u003E\n"},{"CreatedByName":"jandcando","CreatedById":66121,"CreatedDateTime":"2014-09-09T23:15:37Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022NathanKell\u0022 data-cite=\u0022NathanKell\u0022\u003E\u003Cdiv\u003Enothing to override; just use public void FixedUpdate\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EWow thanks! Everything seems to be working now. I appreciate the help.\u003C/p\u003E\n"},{"CreatedByName":"NathanKell","CreatedById":75006,"CreatedDateTime":"2014-09-09T23:44:04Z","Content":"\n\u003Cp\u003EMy pleasure!\u003C/p\u003E\n"}]}