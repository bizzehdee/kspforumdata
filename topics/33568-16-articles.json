{"TopicId":33568,"ForumId":35,"TopicTitle":"[WIN/MAC/LINUX] KSP Trajectory Optimization Tool v1.6.9 [New MATLAB Version!]","CreatedByName":"Arrowstar","CreatedById":2521,"CreatedDateTime":"2013-06-18T04:59:31Z","PageNum":16,"Articles":[{"CreatedByName":"Arrowstar","CreatedById":2521,"CreatedDateTime":"2014-01-29T06:00:12Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Galane\u0022 data-cite=\u0022Galane\u0022\u003E\u003Cdiv\u003EIt\u0027ll be able to figure out the soonest departure time from Duna to Kerbin, with the mass and fuel available, leaving enough fuel to slow down at Kerbin?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EIn a manner of speaking, yes. Perhaps not the soonest departure, but definitely the fastest transfer. If you specify propulsion residual constraints (that is, how much prop you have left over), you can force it to keep some fuel in reserve, as well. Is this what you meant?\u003C/p\u003E\u003Cp\u003EUpdate on MA progress. Tonight I have a standalone script running a very basic optimization on a simple Kerbin/Mun transfer. Actually, we can hardly call it an optimization. All I\u0027m doing is asking the optimizer to find is the delta-v of a vector that, in an unconstrained fashion, minimizes mass usage. Without constraints, it should result in a 0 m/s delta-v burn. Still working out quirks in the system, but everything looks good so far! \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Galane","CreatedById":77949,"CreatedDateTime":"2014-01-29T08:28:51Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Arrowstar\u0022 data-cite=\u0022Arrowstar\u0022\u003E\u003Cdiv\u003EWithout constraints, it should result in a 0 m/s delta-v burn. Still working out quirks in the system, but everything looks good so far! \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThe only way to not use any fuel, is not to play? (Apologies to \u0022War Games\u0022.)\u003C/p\u003E\n"},{"CreatedByName":"bk2w","CreatedById":99893,"CreatedDateTime":"2014-01-29T23:39:40Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Arrowstar\u0022 data-cite=\u0022Arrowstar\u0022\u003E\u003Cdiv\u003EMy \u0022injection burn\u0022 do you mean the \u0022insertion burn\u0022?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYep, I mean insertion burn, or arrival burn.\u003C/p\u003E\u003Cp\u003EDo you already have enough information to calculate the orbital velocity of the spacecraft and of the target body at the interception? Then we could calculate the difference between the two and have a rough approximation of what the actual insertion burn would need to be.\u003C/p\u003E\u003Cp\u003E-Brian\u003C/p\u003E\n"},{"CreatedByName":"Arrowstar","CreatedById":2521,"CreatedDateTime":"2014-01-30T14:29:57Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022bk2w\u0022 data-cite=\u0022bk2w\u0022\u003E\u003Cdiv\u003EYep, I mean insertion burn, or arrival burn.\u003Cp\u003EDo you already have enough information to calculate the orbital velocity of the spacecraft and of the target body at the interception? Then we could calculate the difference between the two and have a rough approximation of what the actual insertion burn would need to be.\u003C/p\u003E\u003Cp\u003E-Brian\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ESo yes, that information exists. But honestly, it\u0027s not very good at estimating the delta-v needed to insert into orbit, as what it\u0027s actually measuring is delta-v needed to stop at the planet, just outside it\u0027s SoI. It\u0027s how you enter orbit is critical and will dictate the amount of delta-v needed for the mission. \u003C/p\u003E\u003Cp\u003EThat all said, the porkchop plot can be made to optimize on arrival\u002Bdeparture C3 energy, which is more along the lines of what you\u0027re talking about. See the options on the main GUI menu bar for more details. Let me know if you have any questions, I\u0027m having to type this real fast this morning, so not a lot of time for detailed explanation. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Frederf","CreatedById":3844,"CreatedDateTime":"2014-01-31T00:47:56Z","Content":"\n\u003Cp\u003EOne thing I forsee taking a great deal of manual computation burden off is a wide array of generic events in the mission architect. For example rendezvousing with a probe or similar will have an event-based mass change that isn\u0027t maneuver related. Munar landers in an Apollo style profile for example has dead weight added and subtracted in mission. Joining for adding modules of fuel/supplies in orbit for interplanetary travel is another example.\u003C/p\u003E\n"},{"CreatedByName":"Arrowstar","CreatedById":2521,"CreatedDateTime":"2014-01-31T00:52:04Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Frederf\u0022 data-cite=\u0022Frederf\u0022\u003E\u003Cdiv\u003EOne thing I forsee taking a great deal of manual computation burden off is a wide array of generic events in the mission architect. For example rendezvousing with a probe or similar will have an event-based mass change that isn\u0027t maneuver related. Munar landers in an Apollo style profile for example has dead weight added and subtracted in mission. Joining for adding modules of fuel/supplies in orbit for interplanetary travel is another example.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThis is very much how things are already working. I only have four different types of events: coasting, dv maneuver, set state, and mass dump, each with their own set of multiple implementations that all work the same way. The last one is what you\u0027re talking about: it gives the analyst the ability to add/subtract mass from the current stage. Typically you\u0027d use it when staging or when accounting for contingency prop you might want to take along, but there\u0027s no reason why you couldn\u0027t enter in negative values to \u0022subtract\u0022 and make the s/c heavier. This is allowed. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Arrowstar","CreatedById":2521,"CreatedDateTime":"2014-01-31T05:54:20Z","Content":"\n\u003Cp\u003ESo good news. Tonight I got the optimizer code mostly working. It\u0027s not hooked up to the GUI yet, but I\u0027ve got it running nicely in an external script. I developed a new objective function that really helped a lot. Instead of minimizing fuel usage, it attempts to minimize the distance to a particular target body. This works great if you seed it with a good initial guess (which will basically be a requirement for Mission Architect). Where do those \u0022initial guesses\u0022 come from? Well, luckily, the rest of KSP TOT has an entire suite of analysis tools designed to find optimum maneuvers! \u003C/p\u003E\u003Cp\u003ESo what I did was find a Kerbin-Duna window using the KSP TOT porkchop plot, plug that burn into Mission Architect, add a coast to Duna SoI, and a circularization burn. Then Mission Architect modified the coast to the burn true anomaly and the departure burn vector and got this:\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://i.imgur.com/Kl0OJ36.png\u0022 alt=\u0022Kl0OJ36.png\u0022\u003E\u003C/p\u003E\u003Cp\u003ELook at the final spacecraft state there. I was aiming for a ~100 km altitude circular, equatorial orbit. It did pretty well. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EWhat do you guys think?\u003C/p\u003E\n"},{"CreatedByName":"diomedea","CreatedById":93700,"CreatedDateTime":"2014-01-31T09:54:19Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Arrowstar\u0022 data-cite=\u0022Arrowstar\u0022\u003E\u003Cdiv\u003E\u003Cp\u003EWhat do you guys think?\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThat is quite impressive, really good result. Though, I hope that by \u0022minimizing distance to a target body\u0022 instead of \u0022minimizing fuel usage\u0022, doesn\u0027t mean in the end we can\u0027t choose the destination orbit radius, nor have the plan cost more fuel than strictly needed.\u003C/p\u003E\u003Cp\u003EBTW, I like these updates of how the tool coding proceeds.\u003C/p\u003E\u003Cp\u003EAlso, what strategy this tool is going to use to achieve a desired orbit inclination? In your example, it looks like the inclination was achieved by means of burning DV while entering the final orbit (step 6). I most often try to set initial periapsis from the transfer orbit so that the inclination with the final orbit is already given. If the desired inclination is not possible from the transfer orbit, I would burn retrograde at periapsis enough to lower eccentricity, but still keeping apoapsis high enough; then change the inclination at apoapsis and circularize at the next periapsis. Those are generally the strategies costing me less fuel when it comes to inclination.\u003C/p\u003E\n"},{"CreatedByName":"Arrowstar","CreatedById":2521,"CreatedDateTime":"2014-01-31T14:32:01Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022diomedea\u0022 data-cite=\u0022diomedea\u0022\u003E\u003Cdiv\u003EThat is quite impressive, really good result. Though, I hope that by \u0022minimizing distance to a target body\u0022 instead of \u0022minimizing fuel usage\u0022, doesn\u0027t mean in the end we can\u0027t choose the destination orbit radius, nor have the plan cost more fuel than strictly needed.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYou will be able to set a constraint on the minimum/maximum distance to target that the optimizer should hit. The whole optimization process is likely going to be a three part thing the user will have to do: minimize the distance to target unconstrained, just to get in the SoI; minimize distance to target, but constrain the radius; and then minimize fuel usage. The first two are needed to direct the optimizer towards the correct solution. Once you are close, then constrain the optimizer more (with orbital parameters and the like) and tell it to minimize fuel usage. This \u0022walking in\u0022 of the solution will likely be necessary for complex missions, and it\u0027s also what we do in the \u0022real world\u0022.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022diomedea\u0022 data-cite=\u0022diomedea\u0022\u003E\u003Cdiv\u003E\u003Cp\u003EBTW, I like these updates of how the tool coding proceeds.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ECool, I\u0027ll keep doing them. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 alt=\u0022:D\u0022\u003E\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022diomedea\u0022 data-cite=\u0022diomedea\u0022\u003E\u003Cdiv\u003E\u003Cp\u003EAlso, what strategy this tool is going to use to achieve a desired orbit inclination? In your example, it looks like the inclination was achieved by means of burning DV while entering the final orbit (step 6). I most often try to set initial periapsis from the transfer orbit so that the inclination with the final orbit is already given. If the desired inclination is not possible from the transfer orbit, I would burn retrograde at periapsis enough to lower eccentricity, but still keeping apoapsis high enough; then change the inclination at apoapsis and circularize at the next periapsis. Those are generally the strategies costing me less fuel when it comes to inclination.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThe strategy is whatever you design it to be. In my picture, the inclination is actually targeted all the way from Kerbin. I know it doesn\u0027t look like it, but the final maneuver is really just a circularization burn (set SMA = desired, ecc = 0). No inclination was changed in the Duna SoI at all.\u003C/p\u003E\u003Cp\u003EIf you want to change the inclination more, you can set constraints on the final orbit to have a high apogee and low perigee. Then go ahead and place a maneuver at apogee to do the inclination change, and add it to the things that the optimizer solves for. Should work out well enough. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EDoes that answer your questions?\u003C/p\u003E\n"},{"CreatedByName":"diomedea","CreatedById":93700,"CreatedDateTime":"2014-01-31T15:09:47Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Arrowstar\u0022 data-cite=\u0022Arrowstar\u0022\u003E\u003Cdiv\u003E\u003Cp\u003EDoes that answer your questions?\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYes, perfectly. And I really like how this tool will work. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 alt=\u0022:D\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Kurtvw","CreatedById":83214,"CreatedDateTime":"2014-02-02T20:47:56Z","Content":"\n\u003Cp\u003EA quick question, Arrowstar..\u003C/p\u003E\u003Cp\u003ERight now I\u0027m using version 11.2 (if you have a more recent one, please do tell), and I\u0027m noticing that a lot of times the orbit it plots in KSP is not what it looks like in the KSPTOT. And I\u0027m confused about the selection for use Mean Anom, and Epoch, Could you explain why I might check or uncheck that? Under what circumstances there would be an advantage?\u003C/p\u003E\u003Cp\u003EAnyhow, as it relates to the variations, Is it because it often puts the maneuver marker days in advance of the current time? Or should the transfer orbit look exactly as shown? It seems to me that since I\u0027m having it import direct from KSP and output direct to KSP I should be getting exact results. I\u0027m often able to tweak the manuver to get it right, but sometimes its off by quite a long distance, in one case from Duna to Kerbin it shot me into a much higher Apoapsis out near Jool, and with periapsis still near Duna.\u003C/p\u003E\n"},{"CreatedByName":"Arrowstar","CreatedById":2521,"CreatedDateTime":"2014-02-03T14:30:43Z","Content":"\n\u003Cp\u003EKurt, I\u0027m in the middle of running to work, and your question has a bit of a long answer, so I\u0027ll get to it tonight. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EAnyway, quick update on the Mission Architect development. Yesterday I finished up the major part of the Optimizer GUI and integrated it with the rest of Mission Architect. Using it, I was able to plan a mission from low Kerbin orbit to low Duna orbit, directly inserting into a 100x100x3 deg inclination orbit using only two burns. This is similar to what I showed before, the difference being that the optimizer code is now running in MA and not in a stand alone script. Anyway, the take away here is that Mission Architect works! \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 alt=\u0022:D\u0022\u003E\u003C/p\u003E\u003Cp\u003EUnfortunately, it works kinda slowly. The various optimizer runs take about 4 minutes for ten iterations of the optimizer, and you could see anywhere from 10-50 iterations per optimization run. Given that, yesterday I spent a long time optimizing code and pursuing means to get things running faster. Right now I\u0027m vectorizing the code that coverts between orbital elements position/velocity. This means that, ultimately, I will be able to remove the for loop I\u0027ve got in the main propagator (\u0022go to this time step, then this, then this\u0022) and just pass in a vector of time steps in one command and I\u0027ll get out all the orbits in one command. This should \u003Cem\u003Egreatly\u003C/em\u003E increase run time speed. Other ideas I\u0027m pursuing are parallelization of the optimizer code (very easy as MATLAB can do this for you), and experiments show a 2-fold decrease in run time when computing objection function gradients in parallel; and compiling some basic MATLAB code into MEX files that execute at about 100 times the speed of the function they replace. Unfortunately, you can only compile a subset of MATLAB functions into MEX files, so you have to pick what you pull out for compilation carefully.\u003C/p\u003E\u003Cp\u003EMy goal is to get optimization down to 3 seconds per iteration on average. Right now, best I\u0027ve ever seen is 6.4 seconds per iteration, but that\u0027s without massive parallelization. I think once I couple those two with whatever compiling I can pull off, I will make it, easy. \u003C/p\u003E\u003Cp\u003EIn any event, progress has been made and things are happening, but the past few days have been more about putting the pieces together and making sure they work well than developing new features, hence there being nothing to share. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EOh, nice side effect of all this optimization: since the code I\u0027m working on is low level stuff used everywhere in TOT, \u003Cem\u003Eall\u003C/em\u003E tools/functions should see an increase in speed. Yay! \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"diomedea","CreatedById":93700,"CreatedDateTime":"2014-02-03T19:21:52Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Arrowstar\u0022 data-cite=\u0022Arrowstar\u0022\u003E\u003Cdiv\u003E\u003Cp\u003EUnfortunately, it works kinda slowly. The various optimizer runs take about 4 minutes for ten iterations of the optimizer, and you could see anywhere from 10-50 iterations per optimization run. ....\u003C/p\u003E\u003Cp\u003EMy goal is to get optimization down to 3 seconds per iteration on average. Right now, best I\u0027ve ever seen is 6.4 seconds per iteration, but that\u0027s without massive parallelization. I think once I couple those two with whatever compiling I can pull off, I will make it, easy. \u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EHappy to know about your progress, this is fast becoming a usable feature (and joy, everything would be run faster in TOT after compiling and parallel optimizer code are done). Actually, 24 seconds for each iteration don\u0027t seem too much, believe in reality space mission parameters took much longer to be computed.\u003C/p\u003E\n"},{"CreatedByName":"Kurtvw","CreatedById":83214,"CreatedDateTime":"2014-02-04T01:37:45Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Arrowstar\u0022 data-cite=\u0022Arrowstar\u0022\u003E\u003Cdiv\u003EKurt, I\u0027m in the middle of running to work, and your question has a bit of a long answer, so I\u0027ll get to it tonight. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ECool, looking forward to it, thanks!\u003C/p\u003E\n"},{"CreatedByName":"Galane","CreatedById":77949,"CreatedDateTime":"2014-02-04T02:16:12Z","Content":"\n\u003Cp\u003ENASA or some corporate space company might come calling. Have you tried using real solar system orbit info instead of KSP data? Having a planner like this that can run on cheap PC systems would save a lot of money.\u003C/p\u003E\n"},{"CreatedByName":"Arrowstar","CreatedById":2521,"CreatedDateTime":"2014-02-04T06:06:35Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Kurtvw\u0022 data-cite=\u0022Kurtvw\u0022\u003E\u003Cdiv\u003EA quick question, Arrowstar..\u003Cp\u003ERight now I\u0027m using version 11.2 (if you have a more recent one, please do tell), and I\u0027m noticing that a lot of times the orbit it plots in KSP is not what it looks like in the KSPTOT. And I\u0027m confused about the selection for use Mean Anom, and Epoch, Could you explain why I might check or uncheck that? Under what circumstances there would be an advantage?\u003C/p\u003E\u003Cp\u003EAnyhow, as it relates to the variations, Is it because it often puts the maneuver marker days in advance of the current time? Or should the transfer orbit look exactly as shown? It seems to me that since I\u0027m having it import direct from KSP and output direct to KSP I should be getting exact results. I\u0027m often able to tweak the manuver to get it right, but sometimes its off by quite a long distance, in one case from Duna to Kerbin it shot me into a much higher Apoapsis out near Jool, and with periapsis still near Duna.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EOkay, so, KSP and KSP TOT both work off two fundamental principles of motion: the two body gravity assumption and the patched conics approximation. The former says that only one planet/moon can affect your spacecraft at a time, and the latter dictates how you move between the influence of gravity sources. So far so good. Where KSP TOT differs from KSP is that the I\u0027m using a patched conics approximation in which the sphere of influence has radius of \u003Cem\u003Ezero\u003C/em\u003E. That is, the SoI size is always assumed to be small as compared to the next largest SoI up the celestial body hierarchy. In the real world, this is actually an okay assumption. But in KSP, where the game is scaled, some of the differences do start to show through, as you\u0027ve found.\u003C/p\u003E\u003Cp\u003ESo what about the solutions KSP TOT gives you? They\u0027re excellent for the zero-sized SoI problem. For the KSP simulation, the non-zero SoI size problem, they are good approximations. However, as you\u0027ve found, you will have to adjust the solution to find the real solution. It\u0027s not too hard, so I\u0027m not too concerned with people needing to do this.\u003C/p\u003E\u003Cp\u003ELuckily, Mission Architect does not have this same zero-sized SoI limitation: I\u0027m building it from the ground up to act just like KSP. So far it\u0027s worked well, and the solutions you get from the maneuver planning codes in KSP TOT will make good first guesses for maneuvers in Mission Architect, just like they are good first guesses in KSP proper.\u003C/p\u003E\u003Cp\u003EHope that helps. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EOn that front, I didn\u0027t get all that much accomplished today in MA. I had hoped to vectorize a lot of my math... and I did. But it turns out that the overhead from doing that was actually worse than just running the for-loops I was avoiding with compiled code. Also, the resulting vectorized code was \u003Cem\u003Ehorrible\u003C/em\u003E. Though it worked, it was not elegant in any way, shape, or form. I\u0027m happy that I\u0027m ultimately abandoning that approach, because it wasn\u0027t pretty to work with or maintain.\u003C/p\u003E\u003Cp\u003ESo I\u0027m stuck at about 6.2 seconds per optimization iteration, and the average mission optimization seems to be about 15-20 iterations. Call it about two minutes per optimization. This\u0027ll have to do for now, though there is some additional disk read/write that I\u0027m going to try to eliminate in the future, and that will help some.\u003C/p\u003E\u003Cp\u003ETomorrow\u0027s tasks are to fix up a few bugs with the Mission Optimizer window and get started on the Optimizer display. This latter feature will show, in real time, the result of the optimization and will hopefully let users cancel it cleanly if needed.\u003C/p\u003E\u003Cp\u003EHope that sounds good. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"tavert","CreatedById":57383,"CreatedDateTime":"2014-02-04T06:51:49Z","Content":"\n\u003Cp\u003ESo how much of that time per iteration is computing the objective function and constraints, versus the gradients and Jacobian? Are you relying on Matlab to do finite differences for you, or can you compute gradients analytically? Are the optimization variables the orbital elements and maneuver components for each phase?\u003C/p\u003E\u003Cp\u003EIf vectorizing is adding overhead, either you\u0027re doing it wrong or your problems just aren\u0027t very big. For loops should be avoided like the plague in Matlab for sizes beyond about 5-10.\u003C/p\u003E\n"},{"CreatedByName":"Kurtvw","CreatedById":83214,"CreatedDateTime":"2014-02-04T08:10:24Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Arrowstar\u0022 data-cite=\u0022Arrowstar\u0022\u003E\u003Cdiv\u003EOkay, so, KSP and KSP TOT both work off two fundamental principles of motion: the two body gravity assumption and the patched conics approximation. The former says that only one planet/moon can affect your spacecraft at a time, and the latter dictates how you move between the influence of gravity sources. So far so good. Where KSP TOT differs from KSP is that the I\u0027m using a patched conics approximation in which the sphere of influence has radius of \u003Cem\u003Ezero\u003C/em\u003E. That is, the SoI size is always assumed to be small as compared to the next largest SoI up the celestial body hierarchy. In the real world, this is actually an okay assumption. But in KSP, where the game is scaled, some of the differences do start to show through, as you\u0027ve found.\u003Cp\u003ESo what about the solutions KSP TOT gives you? They\u0027re excellent for the zero-sized SoI problem. For the KSP simulation, the non-zero SoI size problem, they are good approximations. However, as you\u0027ve found, you will have to adjust the solution to find the real solution. It\u0027s not too hard, so I\u0027m not too concerned with people needing to do this.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003Ethanks for taking the time to explain... I\u0027d actually figured this was probably the case, but its good to have you clarify. I\u0027ve had some of the best luck with KSP TOT for getting me ballpark dialed in on my manuver (as compared with other similar mods). But I wasn\u0027t sure if the errors were real or not. Sounds like its working as best it can and as long as it dials me into orbits I can afford, it\u0027s all good.\u003C/p\u003E\u003Cp\u003EFor those you you reading along though, I\u0027ll tell you there is more profit in adjusting the maneuver time than there is in adjusting the maneuver velocities...\u003C/p\u003E\n"},{"CreatedByName":"PlonioFludrasco","CreatedById":98915,"CreatedDateTime":"2014-02-04T10:05:21Z","Content":"\n\u003Cp\u003EDownloading!\u003C/p\u003E\u003Cp\u003EI want to see how much can help me with interplanetary transfers.\u003C/p\u003E\n"},{"CreatedByName":"Arrowstar","CreatedById":2521,"CreatedDateTime":"2014-02-04T14:29:35Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022tavert\u0022 data-cite=\u0022tavert\u0022\u003E\u003Cdiv\u003ESo how much of that time per iteration is computing the objective function and constraints, versus the gradients and Jacobian? Are you relying on Matlab to do finite differences for you, or can you compute gradients analytically? Are the optimization variables the orbital elements and maneuver components for each phase?\u003Cp\u003EIf vectorizing is adding overhead, either you\u0027re doing it wrong or your problems just aren\u0027t very big. For loops should be avoided like the plague in Matlab for sizes beyond about 5-10.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EWould need to look at the time break down, but MATLAB is doing the gradients in parallel. MATLAB is doing finite differencing; there is no analytical gradient for this problem. Optimization variables for this run is a true anomaly for departure burn and the right ascension, declination, and magnitude of the burn (better than three rectilinear components for optimization). \u003C/p\u003E\u003Cp\u003EI agree that I probably just screwed it up somewhere. I vectorized the functions that convert to and from Keplerian orbital elements to position/velocity vectors. These are fairly complex functions with a fair bit of logic in them, plenty of room for error. If you\u0027d like to take a look, shoot me a PM and I\u0027ll send you what I\u0027ve got.\u003C/p\u003E\n"},{"CreatedByName":"Arrowstar","CreatedById":2521,"CreatedDateTime":"2014-02-04T14:31:44Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022PlonioFludrasco\u0022 data-cite=\u0022PlonioFludrasco\u0022\u003E\u003Cdiv\u003EDownloading!\u003Cp\u003EI want to see how much can help me with interplanetary transfers.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThanks! Let me know if I can help with any questions. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Arrowstar","CreatedById":2521,"CreatedDateTime":"2014-02-05T06:15:16Z","Content":"\n\u003Cp\u003EI made some good progress today on the Mission Architect tool. I managed to squash a (serious) bug that was preventing some SoI transitions to be found. I stumbled across it while planning a direct Kerbin-Ike misson. In any event, everything works great now. I also have plans for additional speed improvements across the MA application in general. It involves a bit of rework with the way data is stored, but the code should be much faster afterwards. \u003C/p\u003E\u003Cp\u003EMy goal for tomorrow is to get this speed improvement implemented (the current data storage technique is pretty slow guys). After that, I\u0027ll get the GUI for the Optimizer progress page (let\u0027s you watch the mission optimizer work) going. Hopefully will finish this last item this weekend. Might be ready for a test pre-release next week. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EHere\u0027s a nice picture of my trip to Ike:\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://i.imgur.com/wAIEeSx.png\u0022 alt=\u0022wAIEeSx.png\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"diomedea","CreatedById":93700,"CreatedDateTime":"2014-02-05T09:35:39Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Arrowstar\u0022 data-cite=\u0022Arrowstar\u0022\u003E\u003Cdiv\u003E... Where KSP TOT differs from KSP is that the I\u0027m using a patched conics approximation in which the sphere of influence has radius of \u003Cem\u003Ezero\u003C/em\u003E. That is, the SoI size is always assumed to be small as compared to the next largest SoI up the celestial body hierarchy. ...\u003C/div\u003E\u003C/blockquote\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Arrowstar\u0022 data-cite=\u0022Arrowstar\u0022\u003E\u003Cdiv\u003E... I managed to squash a (serious) bug that was preventing some SoI transitions to be found. ...\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EJust out of curiosity, are the two facts with SoI radius related? I got some doubts (\u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_huh.gif\u0022 alt=\u0022:confused:\u0022\u003E) while reading the first sentence, that some issues may come from that assumption. While I am certain the correct SoI is used with the main bodies at the extremes of a transfer, eventual other bodies along the trajectory, whose SoI is intersected, would not be considered having influence. Of course that would prevent accidental slingshots to be found and computed (I believe planned slingshot are, by setting the relevant body in both the incoming and outgoing parts of the slingshot trajectory).\u003C/p\u003E\n"},{"CreatedByName":"Arrowstar","CreatedById":2521,"CreatedDateTime":"2014-02-05T14:23:03Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022diomedea\u0022 data-cite=\u0022diomedea\u0022\u003E\u003Cdiv\u003EJust out of curiosity, are the two facts with SoI radius related? I got some doubts (\u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_huh.gif\u0022 alt=\u0022:confused:\u0022\u003E) while reading the first sentence, that some issues may come from that assumption. While I am certain the correct SoI is used with the main bodies at the extremes of a transfer, eventual other bodies along the trajectory, whose SoI is intersected, would not be considered having influence. Of course that would prevent accidental slingshots to be found and computed (I believe planned slingshot are, by setting the relevant body in both the incoming and outgoing parts of the slingshot trajectory).\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EOh, apologies for the confusion. No, Mission Architect uses the same SoI radii that KSP uses. There was a bug in the way the intersects were being calculated (particularly when the s/c orbit was hyperbolic), and I fixed that. It\u0027s the rest of KSPTOT that uses the infinitesimal SoI radius assumption.\u003C/p\u003E\u003Cp\u003EI should note, for the record, that this idea of a zero-sized SoI is not my own idea. It\u0027s how orbital mechanics is taught in classrooms, and for good reason. Dealing with spheres of influence is a royal pain in the neck. Not worrying about them simplifies your problem, and the math/logic behind your problem, considerably.\u003C/p\u003E\n"},{"CreatedByName":"diomedea","CreatedById":93700,"CreatedDateTime":"2014-02-05T15:14:33Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Arrowstar\u0022 data-cite=\u0022Arrowstar\u0022\u003E\u003Cdiv\u003EOh, apologies for the confusion. No, Mission Architect uses the same SoI radii that KSP uses. There was a bug in the way the intersects were being calculated (particularly when the s/c orbit was hyperbolic), and I fixed that. It\u0027s the rest of KSPTOT that uses the infinitesimal SoI radius assumption.\u003Cp\u003EI should note, for the record, that this idea of a zero-sized SoI is not my own idea. It\u0027s how orbital mechanics is taught in classrooms, and for good reason. Dealing with spheres of influence is a royal pain in the neck. Not worrying about them simplifies your problem, and the math/logic behind your problem, considerably.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYep, thanks for explaining that. Very interesting as always.\u003C/p\u003E\u003Cp\u003EAbout SoI radius, agreed. I know they are just an assumption, if true multi-body gravitational fields computing was feasible, we would treat SoI just as an indicator of the relative gravitation force. That was the approach with the Orbiter Space Sim, at least that had 3-body computing and SoI was given with a percentage of the relative strength. With the limit of 2-body computing that KSP has, a SoI is really an artificial boundary, suddenly the gravity a craft is subject to wholly changes from one to another center of mass. But then, you mean KSPTOT, instead of using SoI to switch to a different center of gravity, is using true newtonian gravity with all the centers of mass along a trajectory?\u003C/p\u003E\n"}]}