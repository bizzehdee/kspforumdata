{"TopicId":38202,"ForumId":16,"TopicTitle":"How to dodge FPS destroying lag","CreatedByName":"Captain Sierra","CreatedById":74666,"CreatedDateTime":"2013-07-22T19:21:54Z","PageNum":1,"Articles":[{"CreatedByName":"Captain Sierra","CreatedById":74666,"CreatedDateTime":"2013-07-22T19:21:54Z","Content":"\n\u003Cp\u003EWe all get it. We all have problems docking to our huge space stations because of it. Until Squad gets proper multi-threading support running, we all get FPS destroying lag at some point. I am building a massive interplanetary ship up at my space docks. Right now, All I have is the docks (with two small adapter pieces) and two of my heavy tugs. Next up to launch is my interplanetary tugs. I\u0027m already seeing traces of lag like slight framerate losses. Its noticable, but not interfering as of yet. It\u0027s only gonna get worse the more I pile on up there. Is there any good way to at least buy me more time before I\u0027m running at 2 FPS? After the assembly tugs, I have to put up the megatug that propels the craft and the fuel module(s) (going up dry so I gotta run at least a dozen tanker missions). Anyone know of some ways to reduce the onset of the lagging?\u003C/p\u003E\n"},{"CreatedByName":"Flixxbeatz","CreatedById":29991,"CreatedDateTime":"2013-07-22T19:32:11Z","Content":"\n\u003Cp\u003EMind sharing your computer specs?\u003C/p\u003E\n"},{"CreatedByName":"zerotwo","CreatedById":60799,"CreatedDateTime":"2013-07-22T19:35:47Z","Content":"\n\u003Cp\u003EReduce all available settings:\u003C/p\u003E\u003Cp\u003EAway from my home computer at the moment, so I don\u0027t know the exact setting title but, in the game\u0027s options you should find \u0022Max Physics Delta-Time per Frame\u0022, drag this until it shows the largest number possible. This will reduce the number of times per second KSP calculates physics (if someone could follow up with the location in one of the game\u0027s settings text files, that might help this gent to further tune the physics down).\u003C/p\u003E\u003Cp\u003EInstall mods that involve fewer parts;\u003C/p\u003E\u003Cp\u003EQuantum Struts or any mod with \u0022heavy\u0022 struts can replace struts more than 10:1, if you build smart.\u003C/p\u003E\u003Cp\u003ELando\u0027s Part Generator 2.3 allows you to create custom parts. Going to need 4x orange gas cans? Make 1x item that does the same.\u003C/p\u003E\u003Cp\u003EThere\u0027s also a parts mod out there I can\u0027t for the life of me remember the name of that combines \u0022often used\u0022 parts into single pieces (to save on drag/processing), that mixes like, a ROCK-64 tank and a large RCS fuel tank into one object, that sort of thing, hopefully someone will know what I am referring to.\u003C/p\u003E\u003Cp\u003EWatch out for your running mods:\u003C/p\u003E\u003Cp\u003EI am one of those guys with a fancy fancy computer, real purdy like, and once upon a time I was launching a probe-hauler into space (with five probes attached) and my system ground completely to a halt, not even 1 fps, for big sections of the launch process (14km-60km) and whenever I was near anything my system basically stopped functioning. The problem? All five of my probes had ISA map sat items on them, turning those off solved the problem instantly.\u003C/p\u003E\u003Cp\u003EStrip down to the basics, get a few simplified parts mods, grab your quantum struts, get your mechjeb, and just run with as little as possible.\u003C/p\u003E\n"},{"CreatedByName":"Captain Sierra","CreatedById":74666,"CreatedDateTime":"2013-07-22T19:44:30Z","Content":"\n\u003Cp\u003EComputer specs:\u003C/p\u003E\u003Cp\u003EIntel i7 (8 core) processor\u003C/p\u003E\u003Cp\u003E8 Gb (12 sticks) of RAM\u003C/p\u003E\u003Cp\u003E17.3 inch display\u003C/p\u003E\u003Cp\u003E0.5 Tb hard drive\u003C/p\u003E\u003Cp\u003ECurrently running KSP on default graphics at max res for windowed mode (before the frame disappears off the end of the screen).\u003C/p\u003E\u003Cp\u003EI uninstalled KW Rocketry (but thinking of reinstalling it for it\u0027s large tanks, tanker flights). I can use it for heavy struts. I have quantum struts. I have very few parts mods I run regularly. I\u0027m not actively running any instruments on stuff.\u003C/p\u003E\u003Cp\u003EI\u0027m trying to avoid cheaty things like fuel tanks that hold 5x more than they should. I\u0027m doing the tanker stage the realistic way (orbital refueling).\u003C/p\u003E\u003Cp\u003EEDIT: I found said setting and reduced it to calculating 2x every second over 10. I also reduced the texturing and rendering graphics.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-07-22T19:54:58Z\u0022 title=\u002207/22/2013 07:54  PM\u0022 data-short=\u002210 yr\u0022\u003EJuly 22, 2013\u003C/time\u003E by Captain Sierra\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Benie","CreatedById":70327,"CreatedDateTime":"2013-07-22T20:10:16Z","Content":"\n\u003Cp\u003EI get pretty good framerate with any launch. Only time my FPS drops to like 3-5, is approaching one of my Space Stations, and my Duna Base.\u003C/p\u003E\n"},{"CreatedByName":"Captain Sierra","CreatedById":74666,"CreatedDateTime":"2013-07-22T20:40:23Z","Content":"\n\u003Cp\u003EThere in lies the problem. This project involves a lot of docking and orbital construction. That is why I am asking this question. I need to reduce the lag that I know will incur when I come in for the docking maneuver as part of assembly.\u003C/p\u003E\u003Cp\u003ELaunching I get great FPS. The only time the slightest bit of lag appears is when I am coming in on docking approach and the game starts physics calculations on the space docks and the tugs already docked there in preparation.\u003C/p\u003E\n"},{"CreatedByName":"draeath","CreatedById":25709,"CreatedDateTime":"2013-07-22T21:02:25Z","Content":"\n\u003Cp\u003EI find that when I\u0027m approaching another craft, KSP starts to trash my disk for a minute or two. My FPS stabilizes after that point.\u003C/p\u003E\u003Cp\u003EAssuming that\u0027s what you\u0027re noticing (eg does it go away with time?) you could mitigate this by improving your disk performance. (defrag, faster disks, SSD etc).\u003C/p\u003E\u003Cp\u003ESince I have the RAM, I\u0027m going to try copying KSP into a ramdisk before launching, to see how it behaves.\u003C/p\u003E\n"},{"CreatedByName":"Captain Sierra","CreatedById":74666,"CreatedDateTime":"2013-07-22T21:22:06Z","Content":"\n\u003Cp\u003EIt does not improve with time. It remains persistent for the duration of the time physics is loaded on the ship. I am already getting an FPS of 15-20 and I only have 3 tugs up there. I have one more to launch, then a fuel/RCS stage before I even start bringing the big stuff up there. :facepalm:\u003C/p\u003E\u003Cp\u003ESo to answer you, it does not improve after time. It remains persistently poor for as long as I am within physics loading range of the docks.\u003C/p\u003E\u003Cp\u003EEDIT: I have the CPU power to not get this, the problem comes from it being an 8 core processor. Each core by itself is not very powerful and without proper multi-threading support (which KSP does not have yet, though planned), My \u0027high performance\u0027 machine is no better than anyone elses because I can\u0027t utilize the full power of my CPU. That\u0027s what I think is going on here.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-07-22T21:25:32Z\u0022 title=\u002207/22/2013 09:25  PM\u0022 data-short=\u002210 yr\u0022\u003EJuly 22, 2013\u003C/time\u003E by Captain Sierra\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Fox Arcana","CreatedById":70823,"CreatedDateTime":"2013-07-22T22:18:24Z","Content":"\n\u003Cp\u003EI suggest getting a more powerful single core instead\u003C/p\u003E\n"},{"CreatedByName":"Captain Sierra","CreatedById":74666,"CreatedDateTime":"2013-07-22T23:42:29Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022CombustibleSanic\u0022 data-cite=\u0022CombustibleSanic\u0022\u003E\u003Cdiv\u003EI suggest getting a more powerful single core instead\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EIn most cases, multi-core is better and since KSP is not the only game I play, I\u0027m not about to go optimizing my hardware specifically for it (money is also a problem).\u003C/p\u003E\u003Cp\u003ESo far, space dock \u002B 4 tugs = 5 FPS. NEW PLAN!!!\u003C/p\u003E\u003Cp\u003EI\u0027m going to completely get rid of the space dock and tugs, waste of hardware allocation. I\u0027ll just send up the megatug, fuel it, send up the fuel module, fuel it, then send the RCS module, fuel it, and then send the rest.\u003C/p\u003E\n"},{"CreatedByName":"Donziboy2","CreatedById":74984,"CreatedDateTime":"2013-07-23T00:17:38Z","Content":"\n\u003Cp\u003EI have found closing the MechJeb DeltaV window when I am not using it to help alot.\u003C/p\u003E\u003Cp\u003EAlso the game does not seem to max out any of my 4 Cores and when it starts to slow down badly my FPS drops and my GPUs utilization also goes down which is strange......\u003C/p\u003E\n"},{"CreatedByName":"Donziboy2","CreatedById":74984,"CreatedDateTime":"2013-07-23T14:08:31Z","Content":"\n\u003Cp\u003EAlso increased the Turbo Boost on my I5 2500K this morning so that with 3-4 cores active it runs around 4.3Ghz and that took my 500 ton tanker from 8fps to 12. I also set CPU affinity from all to just 2 cores and set the priority to real time.\u003C/p\u003E\u003Cp\u003EI was able to see 1 core almost fully utilized and the second was only partly used. I have a G15 keyboard with LCD so I can monitor CPU/RAM/GPU usage.\u003C/p\u003E\n"},{"CreatedByName":"draeath","CreatedById":25709,"CreatedDateTime":"2013-07-23T14:09:13Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Donziboy2\u0022 data-cite=\u0022Donziboy2\u0022\u003E\u003Cdiv\u003E... game does not seem to max out any of my 4 Cores\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EUnity is single-threaded.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Donziboy2\u0022 data-cite=\u0022Donziboy2\u0022\u003E\u003Cdiv\u003Emy FPS drops and my GPUs utilization also goes down which is strange.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThis means your GPU is not the bottleneck. Your CPU/RAM is \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif\u0022 alt=\u0022;)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Donziboy2","CreatedById":74984,"CreatedDateTime":"2013-07-23T16:08:16Z","Content":"\n\u003Cp\u003ESo an I5 2500K running at 4.3Ghz with 16GB of ram is a bottleneck then we all need to be running P4\u0027s at 8Ghz.......\u003C/p\u003E\n"},{"CreatedByName":"draeath","CreatedById":25709,"CreatedDateTime":"2013-07-23T16:10:26Z","Content":"\n\u003Cp\u003EWelcome to the \u0022joy\u0022 of single-threading.\u003C/p\u003E\u003Cp\u003EI\u0027m kind of grumpy about that. People should just stop making single-threaded engines already... force folks into using threads!\u003C/p\u003E\n"},{"CreatedByName":"Donziboy2","CreatedById":74984,"CreatedDateTime":"2013-07-23T17:04:49Z","Content":"\n\u003Cp\u003EThere is a large number of games still coming out that will hardly use 2 cores let alone 4 or 8.\u003C/p\u003E\u003Cp\u003EUnity is not a new engine either, multithreading sounds so wonderful until you actually have to create the software and utilize it then its a pain.\u003C/p\u003E\n"},{"CreatedByName":"draeath","CreatedById":25709,"CreatedDateTime":"2013-07-23T18:07:30Z","Content":"\n\u003Cp\u003EWow, imagine that! Proper software engineering is hard... Proper architecture is mandatory if you\u0027re going to even consider multithreading, but the kind of understanding that is required to pull all that off correctly really does raise the bar. That kind of thing is what separates Good from merely Adequate.\u003C/p\u003E\n"},{"CreatedByName":"Captain Sierra","CreatedById":74666,"CreatedDateTime":"2013-07-23T19:06:22Z","Content":"\n\u003Cp\u003EMost high performance processors are multi-cored. It\u0027s pretty much mandatory for any game that needs decent hardware to run to have proper multi-threading support. Which means either Squad needs to look at ways to run KSP multi-threaded, ditching unity if they must and going for a different engine (no idea how hard this would be but it can\u0027t be easy.\u003C/p\u003E\n"},{"CreatedByName":"jscheiben","CreatedById":69820,"CreatedDateTime":"2013-07-23T19:15:06Z","Content":"\n\u003Cp\u003EI too would like to see multi core support. Nothing worse than having a decent rig but not being able to use it. I run into the same lag but not as low as 2-3fps, i\u0027m probably a bit higher my specs are (I7, 16gb ddr3, 3gb gtx670, and game running off my ssd). I have actually stopped playing for the past few weeks as the lag drives me nuts.\u003C/p\u003E\n"},{"CreatedByName":"Captain Sierra","CreatedById":74666,"CreatedDateTime":"2013-07-23T19:17:13Z","Content":"\n\u003Cp\u003EYour machine is about the same as mine:\u003C/p\u003E\u003Cp\u003Ei7, 16gb RAM, NVidia GeForce graphics, 0.5 Tb hard drive\u003C/p\u003E\u003Cp\u003Ei7 is an 8 core processor. Those of us with them NEED multi-threading to be able to use the hardware we have.\u003C/p\u003E\n"},{"CreatedByName":"draeath","CreatedById":25709,"CreatedDateTime":"2013-07-23T19:19:36Z","Content":"\n\u003Cp\u003ESeems to me you could decouple physics to a different thread easily enough. Not familiar with Unity, is there some reason they are tied?\u003C/p\u003E\n"},{"CreatedByName":"Jackissimus","CreatedById":73641,"CreatedDateTime":"2013-07-23T19:33:43Z","Content":"\n\u003Cp\u003EOK, nobody is brave enough, so I am going to say it: Reduce part count!\u003C/p\u003E\u003Cp\u003EThis is a great example: \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/showthread.php/35722-Can-we-please-fix-the-shaky-wobbly-rockets?p=474545\u0026amp;viewfull=1#post474545\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://forum.kerbalspaceprogram.com/showthread.php/35722-Can-we-please-fix-the-shaky-wobbly-rockets?p=474545\u0026amp;viewfull=1#post474545\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EMy 2cents and I\u0027m leaving this thread before the storm comes ...\u003C/p\u003E\n"},{"CreatedByName":"draeath","CreatedById":25709,"CreatedDateTime":"2013-07-23T19:51:02Z","Content":"\n\u003Cp\u003EGood point and all Jack, but fixing the symptom is not fixing the problem.\u003C/p\u003E\n"},{"CreatedByName":"DMagic","CreatedById":57416,"CreatedDateTime":"2013-07-23T20:01:51Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Donziboy2\u0022 data-cite=\u0022Donziboy2\u0022\u003E\u003Cdiv\u003EI have found closing the MechJeb DeltaV window when I am not using it to help alot.\u003Cp\u003E.....\u003C/p\u003E\u003Cp\u003E my FPS drops and my GPUs utilization also goes down which is strange......\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThis is very true. I\u0027ve found that the default DeltaV window in Mechjeb causes about a 10-20% drop in FPS. If you use MechJeb and have FPS problems, closing this window can make a difference; not a huge difference, but 2 or 3 extra FPS can be fairly noticeable. \u003C/p\u003E\u003Cp\u003EAnd the drop in GPU usage makes sense when you think about performance being CPU limited. The GPU doesn\u0027t have to work nearly as hard at 10 FPS than it does at 60 FPS, so usage drops.\u003C/p\u003E\u003Cp\u003EEdit: And about Unity multithreading, I don\u0027t think the problem is with Unity\u0027s threading, it\u0027s the version of PhysX it uses. You can clearly see that KSP uses more than 1 thread by looking at it\u0027s CPU usage. But PhysX version 2 is single-threaded and has bad performance on the CPU. PhysX version 3 is supposedly much better, but I\u0027m not sure if it\u0027s feasible for KSP to switch to that, or if it\u0027s something that would have to be supported by Unity first.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-07-23T20:05:29Z\u0022 title=\u002207/23/2013 08:05  PM\u0022 data-short=\u002210 yr\u0022\u003EJuly 23, 2013\u003C/time\u003E by DMagic\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"draeath","CreatedById":25709,"CreatedDateTime":"2013-07-23T20:32:31Z","Content":"\n\u003Cp\u003E... or switch to something like Bullet?\u003C/p\u003E\n"}]}