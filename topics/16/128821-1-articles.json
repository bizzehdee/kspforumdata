{"TopicId":128821,"ForumId":16,"TopicTitle":"Have problems to calculate the right PhaseAngle (kOS)","CreatedByName":"TJ179","CreatedById":147898,"CreatedDateTime":"2015-12-29T04:11:05Z","PageNum":1,"Articles":[{"CreatedByName":"TJ179","CreatedById":147898,"CreatedDateTime":"2015-12-29T04:11:05Z","Content":"\n\u003Cp\u003E\nHey,\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\ni have problems to calculate the right PhaseAngle with kOS.\n\u003C/p\u003E\n\u003Cp\u003E\nhere my Script:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode\u0022\u003E\nfunction CurrentPhaseAngle{\n\t\tparameter origin.\n\t\tparameter destination.\n\t\t\n        set normal to  origin:OBT:POSITION:NORMALIZED.\n        set projected to VECTOREXCLUDE(normal,destination:POSITION).\n        set result to VECTORANGLE(origin:POSITION, projected).\n        if VDOT(VCRS(origin:POSITION, projected), normal) \u0026lt; 0\n        {\n            return 360 - result.\n        }\n        else\n        {\n\t\t\treturn result.\n        }\n    }\n\t\n\t\n\tset currentPhase to CurrentPhaseAngle(Kerbin,Duna).\n\t\n\tprint \u0022CurrentPhaseAngle:\u0022\u002B currentPhase.\u003C/pre\u003E\n\u003Cp\u003E\nResult is i my example 90\u00B0 to from Kerbin to Duna\u00A0but transfer Window Planer says it\u0027s 119\u00B0.\u003Cimg class=\u0022ipsImage\u0022 src=\u0022http://192.168.192.2/photo/webapi/thumb.php?api=SYNO.PhotoStation.Thumb\u0026amp;method=get\u0026amp;version=1\u0026amp;size=large\u0026amp;id=photo_2f_6b737068696c66652e706e67\u0026amp;rotate_version=0\u0026amp;thumb_sig=2f766f6c756d65312f70686f746f2f6b737068696c66652e706e67\u0026amp;mtime=1451362578\u0022 alt=\u0022thumb.php?api=SYNO.PhotoStation.Thumb\u0026amp;me\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\ncan someone help me ?\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"FancyMouse","CreatedById":142946,"CreatedDateTime":"2015-12-29T10:47:54Z","Content":"\n\u003Cp\u003E\nimage hosted on 192.168.192.2 - nice\n\u003C/p\u003E\n\u003Cp\u003E\nlooking at your script - seems you\u0027re not getting the definition right. phase angle zero isn\u0027t the direction of destination - it\u0027s your own planet prograde.\n\u003C/p\u003E\n"},{"CreatedByName":"ElWanderer","CreatedById":114015,"CreatedDateTime":"2015-12-29T16:57:10Z","Content":"\n\u003Cp\u003E\nThe best place for kOS advice is Reddit. (meanwhile,\u00A0autocorrect reckons for iOS advice, go to Redditch)\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://www.reddit.com/r/Kos/\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://www.reddit.com/r/Kos/\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nI see you have a variable called normal that you set to a normalized vector. Are you aware these can have very different meanings? Normal is usually used to mean at 90\u00B0 to the plane of the orbit. Using :normalized returns a vector in the same direction, just reduced to a length of one unit.\n\u003C/p\u003E\n\u003Cp\u003E\nEdit 2: wish I could help, but I\u0027ve not got my head around vector exclusion yet!\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-12-29T17:10:39Z\u0022 title=\u002212/29/2015 05:10  PM\u0022 data-short=\u00228 yr\u0022\u003EDecember 29, 2015\u003C/time\u003E by ElWanderer\u003C/strong\u003E\n\u003Cbr\u003Edarned autocarrot\n\u003C/span\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2015-12-29T18:40:50Z","Content":"\n\u003Cp\u003E\nDon\u0027t use SHIP:OBT:POSITION, that\u0027s the position relative to the center of the universe which is YOU in kOS\u0027s reckoning, so you\u0027re taking a magnitude near-zero vector and stretching it out to length 1 when you normalize it.\u00A0 It\u0027s going to be super fiddly which way that\u0027s pointing.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nIf you\u0027re looking for a vector where you guarantee you know the origin of it, use vector subtraction to force it to work no matter what the underlying XYZ looks like.\n\u003C/p\u003E\n\u003Cp\u003E\nTry (object:POSITION - BODY:POSITION) to get a vector you know for certain means a vector from a body to the object, whatever object happens to be.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nAlso be aware that the kind of calculation I\u0027m speaking of presumes that origin and destination are both in the same SOI and share the same parent body (i.e. going from Kerbin to Duna, it\u0027s using Sun as the body they both orbit.)\u00A0 That\u0027s not wrong, you just need to ensure you understand that when doing their math.\u00A0 If you tried to transfer from, say, Kerbin to Ike rather than from Kerbin to Duna, the fact that Ike\u0027s parent body isn\u0027t the Sun like Kerbin\u0027s is could cause problems if you don\u0027t account for it.\u00A0 I\u0027d just make it explicit by passing a third parameter, the common body they share, and then using that as the origin point for all your vector position subtractions).\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-12-29T18:45:48Z\u0022 title=\u002212/29/2015 06:45  PM\u0022 data-short=\u00228 yr\u0022\u003EDecember 29, 2015\u003C/time\u003E by Steven Mading\u003C/strong\u003E\n\u003C/span\u003E\n"}]}