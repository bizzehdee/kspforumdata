{"TopicId":65106,"ForumId":29,"TopicTitle":"Trigger a part\u0026#039;s action from code?","CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-03-07T14:58:36Z","PageNum":1,"Articles":[{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-03-07T14:58:36Z","Content":"\n\u003Cp\u003Eedit: Answer from the end of the thread added in.\u003C/p\u003E\u003Cp\u003EAlight, here is the absolute basic way to trigger a part\u0027s action. Note pretty much everything is hardcoded to make the example simpler and uses simple for-each loops to make it clear what is going on. You will want to customize to work with whatever mod you are writing.\u003C/p\u003E\u003Cp\u003EA big shout-out to Faark for the help with this.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E public void Update()\u003Cbr\u003E        {\u003Cbr\u003E            foreach (Part p in FlightGlobals.ActiveVessel.Parts) //start cycling through parts on the active vessel\u003Cbr\u003E            {\u003Cbr\u003E                if (p.name == \u0022solarPanels1\u0022) //find the solarPanel1 part\u003Cbr\u003E                {\u003Cbr\u003E                    foreach (PartModule pm in p.Modules) //start cycling through partmodules on the solarPanel1\u003Cbr\u003E                    {\u003Cbr\u003E                        if (pm.moduleName == \u0022ModuleDeployableSolarPanel\u0022) //find the \u0027ModuleDeployableSolarPanel\u0027 partmodule\u003Cbr\u003E                        {\u003Cbr\u003E                            BaseActionList bal = new BaseActionList(p, pm); //create a BaseActionList bal with the available actions on the part. p being our current part, pm being our current partmodule\u003Cbr\u003E                            if (bal.Count \u0026gt; 0) //oops, left over from earlier testing, the ModuleDeployableSolarPanel always has 3 actions\u003Cbr\u003E                            {\u003Cbr\u003E                                foreach (BaseAction ba in bal) //start cycling through baseActions in the BaseActionList\u003Cbr\u003E                                {\u003Cbr\u003E                                    if (Trigger \u0026amp;\u0026amp; ba.guiName == \u0022Extend Panel\u0022) //Trigger is a bool set to true via a GUI button on-screen (code not shown)\u003Cbr\u003E                                    {\u003Cbr\u003E                                        print(\u0022Try Extend\u0022);\u003Cbr\u003E                                        KSPActionParam ap = new KSPActionParam(KSPActionGroup.None, KSPActionType.Deactivate); //an important line, see post\u003Cbr\u003E                                        ba.Invoke(ap); //Invoke the \u0022Extend Panel\u0022 command (our current ba. variable) with the ActionParameter from the previous line.\u003Cbr\u003E                                        Trigger = false; //command executed, set Trigger false for next GUI button click\u003Cbr\u003E                                    }\u003Cbr\u003E                                    if (Trigger2 \u0026amp;\u0026amp; ba.guiName == \u0022Retract Panel\u0022) //same as above, for the Retract Panel action\u003Cbr\u003E                                    {\u003Cbr\u003E                                        print(\u0022Try Retract\u0022);\u003Cbr\u003E                                        KSPActionParam ap = new KSPActionParam(KSPActionGroup.None, KSPActionType.Deactivate);\u003Cbr\u003E                                        ba.Invoke(ap);\u003Cbr\u003E                                        Trigger2 = false;\u003Cbr\u003E                                    }\u003Cbr\u003E                                }\u003Cbr\u003E                            }\u003Cbr\u003E                        }\u003Cbr\u003E                     }\u003Cbr\u003E                }\u003Cbr\u003E\u003Cbr\u003E            }\u003Cbr\u003E        }\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EThe KSPActionParam is deceptively important. When you make the ap variable to use, you tell it the KSPActionGroup to use. As I\u0027m trigger things manually with code, I never used anything except KSPActionGroup.none.\u003C/p\u003E\u003Cp\u003EThe KSPActionType is a bit tricky as well. If you are executing a single direction command (such as Extend, or Retract) this actually does not matter. However, a dual direction command (such as Toggle Panels) works off this. \u003C/p\u003E\u003Cp\u003EOn my test solar panel KSPActionType.Activate on the TogglePanels action would extend the panels and KSPActionType.Deactivate would retract the panels. \u003C/p\u003E\u003Cp\u003EExecuting the TogglePanels action with KSPActionType.Activate a second time did nothing. \u003C/p\u003E\u003Cp\u003ESo, here are the basics on activating part actions, hope this helps you out too.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\u003Cp\u003E***** Begin original post. *****\u003C/p\u003E\u003Cp\u003EAlright. I\u0027m looking for opinions on how different people do things with how they handle commands between parts.\u003C/p\u003E\u003Cp\u003EFirst, some background. \u003C/p\u003E\u003Cp\u003EI\u0027m looking into making more action groups available but due to how KSP handles its default groups I\u0027m having to write a separate action group manager that will run in parallel with the default groups.\u003C/p\u003E\u003Cp\u003EThis means I need to dynamically find what Commands are available from parts on the vessel in order to present them to the player to assign to Action Groups.\u003C/p\u003E\u003Cp\u003EI\u0027ve been using the solarPanel1 that is stock for testing.\u003C/p\u003E\u003Cp\u003EThere are two promising lists, PartModule.Events and PartModule.Actions. \u003C/p\u003E\u003Cp\u003E(Note that Part.Events and Part.Actions are both empty.)\u003C/p\u003E\u003Cp\u003EFrom here on when I say \u0022solarPanel1\u0022, read that as me saying \u0022solarPanel1.ModuleSolarPanel\u0022.\u003C/p\u003E\u003Cp\u003EsolarPanel1.Events has \u0022Extend\u0022 and \u0022Retract\u0022, solarPanel1.Actions has \u0022ExtendPanelAction\u0022, \u0022ExtendPanel\u0022, and \u0022RetractPanel\u0022.\u003C/p\u003E\u003Cp\u003ELooking at the solarPanel1 in the VAB, there are 3 Commands available to be assigned to an Action Group, \u0022Toggle\u0022, \u0022Extend\u0022 and \u0022Retract\u0022.\u003C/p\u003E\u003Cp\u003ESo this looks like the solarPanel1.Actions is what I want to look at but I have not figured out how to issue an Action command yet to see if \u0022ExtendPanelAction\u0022 is the same thing as the \u0022Toggle Panel\u0022 that shows in the VAB.\u003C/p\u003E\u003Cp\u003EI am able to issue Event commands and the \u0022Extend\u0022 and \u0022Retract\u0022 event do in fact open and close the solar panel.\u003C/p\u003E\u003Cp\u003EThere is a 3rd possibility as well, there are three methods \u0022solarPanlel.ExtendPanel()\u0022, \u0022.RetractPanel()\u0022 and \u0022.TogglePanel()\u0022 that look exactly like what I need. However, I am at a total loss on how to list the methods available to a partmodule during run time and how to tell which methods are the Command methods that I would show in my action groups mod.\u003C/p\u003E\u003Cp\u003ESo, for all you mod devs out there, when you add fancy commands to your parts, are you adding an Action or an Event? I am trying to make sure this action group mod is compatible with everyone else\u0027s mod right out of the box.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-03-08T19:51:05Z\u0022 title=\u002203/08/2014 07:51  PM\u0022 data-short=\u002210 yr\u0022\u003EMarch 8, 2014\u003C/time\u003E by Diazo\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Faark","CreatedById":69775,"CreatedDateTime":"2014-03-07T16:10:07Z","Content":"\n\u003Cp\u003EActions are what actions groups use, Events are what GUI-stuff uses. The only mentionable difference is that Actions have an additional argument (KSPActionParam), but i guess that\u0027s mostly ignored and both use the same code underneath.\u003C/p\u003E\u003Cp\u003EAnyway, you appear to miss the actual points about .Events \u0026amp; .Actions. Those do all the heavy work for you. Just enumerate though all of BaseActionList\u0027s BaseAction\u0027s and use those objects. It offer\u0027s name, guiName and an Invoke(KSPActionParam)...\u003C/p\u003E\u003Cp\u003Eps: I\u0027m looking forward to see your hopefully used-friendly UI. If you need your own in the first place, it would be nice to also include stock - action groups... and thus make it another \u0022in flight action group manager\u0022 as well. Also it would be nice to have UI to call action groups only for a specific part of the vessel, bot \u0022actions only for all parts of a kind\u0022 and \u0022group only for part that was launched as X\u0022 (should be possible to distinguish them, e.g. via missionId)\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-03-07T16:14:10Z\u0022 title=\u002203/07/2014 04:14  PM\u0022 data-short=\u002210 yr\u0022\u003EMarch 7, 2014\u003C/time\u003E by Faark\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-03-07T16:41:22Z","Content":"\n\u003Cp\u003EBaseActionList? I saw that in the Object Browser but assumed it was a template list type thing similar to how KSPActionGroup is an enum template for the default action groups and did not investigate. Apparently I should have.\u003C/p\u003E\u003Cp\u003EAnd yes, the UI will support both the 10 built in groups and filtering in flight mode so hopefully that includes what you are hoping to see.\u003C/p\u003E\u003Cp\u003EThanks for the tip.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n"},{"CreatedByName":"DMagic","CreatedById":57416,"CreatedDateTime":"2014-03-07T17:25:08Z","Content":"\n\u003Cp\u003EPretty much everything that I make with a KSPEvent also gets a KSPAction, the Action usually just points to the Event. If there\u0027s ever a situation where both aren\u0027t used it\u0027s usually the Event that I take out, I can imagine people doing the opposite though.\u003C/p\u003E\u003Cp\u003EI suppose one difference is that Events include all of the GUIActiveUnfocused stuff, like EVA events, or select target events, but I\u0027m not sure there\u0027s ever a real reason to assign those to action groups.\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-03-08T16:39:52Z","Content":"\n\u003Cp\u003EOkay, BaseActionList is what I was after.\u003C/p\u003E\u003Cp\u003EI have a list of Actions and the GUI friendly name to display, but now how do I trigger one of these Actions?\u003C/p\u003E\u003Cp\u003EI\u0027m not stuck yet having only spent 10 minutes on it, but this is not looking as straightforward as I was hoping it would be.\u003C/p\u003E\u003Cp\u003EAny help is always appreciated. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n"},{"CreatedByName":"Faark","CreatedById":69775,"CreatedDateTime":"2014-03-08T17:24:09Z","Content":"\n\u003Cp\u003EYou select all BaseActions you want to fire your action group and call their Invoke\u0027s. Every PartModule for every part has its own BaseAction, just loop though it how ever you stored your action group and Invoke them. A stupid example might look sth like that:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003EKSPActionParam ap = new KSPActionParam(KSPActionGroup.None, KSPActionType.Activate);\u003Cbr\u003Eforeach (var actionBase in FlightGlobals.ActiveVessel.Parts\u003Cbr\u003E    .Where(p =\u0026gt; /*is solar panel i want to toggle*/)\u003Cbr\u003E    .SelectMany(p =\u0026gt; p.FindModulesImplementing\u0026lt;ModuleDeployableSolarPanel\u0026gt;())\u003Cbr\u003E    .Select(modDepSolarPanel =\u0026gt; modDepSolarPanel.Actions[/*name of my action, i guess \u0022ExtendPanelsAction\u0022 */]))\u003Cbr\u003E{\u003Cbr\u003E    actionBase.Invoke(ap);\u003Cbr\u003E}\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-03-08T19:24:49Z","Content":"\n\u003Cp\u003EThank you \u003Cem\u003Every\u003C/em\u003E much for that Faark, you just saved me more then a few hours of figuring that out.\u003C/p\u003E\u003Cp\u003EI\u0027ve updated the first post with my findings to hopefully allow this thread to be found by the next person who is searching for this info.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n"},{"CreatedByName":"Faark","CreatedById":69775,"CreatedDateTime":"2014-03-08T21:30:55Z","Content":"\n\u003Cp\u003EGreat to hear it\u0027s working as expected. Hope your mod will be very easy to use.\u003C/p\u003E\u003Cp\u003EBtw, you don\u0027t have to create another instance of BaseActionList. Every Part (though barely used) \u0026amp; especially PartModule already has one of those (.Actions) and creating them seems pretty expensive, so you might want to use the existing ones. (i rly hope KSP don\u0027t use reflection every time a vessel is loaded and instead copies the existing list from a prefab)\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-03-08T23:41:36Z","Content":"\n\u003Cp\u003EHmmm.\u003C/p\u003E\u003Cp\u003EThank you for that reminder, I\u0027ll switch to using PartModule.Actions.\u003C/p\u003E\u003Cp\u003EHowever, Part.Actions is null on the solarPanel1 part. This is in the same update frame as when I\u0027m referencing the ModuleDeployableSolarPanel.Actions so I\u0027m not sure what is going on there.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\u003Cp\u003Eedit: Interesting....\u003C/p\u003E\u003Cp\u003EIt looks like Part.Actions is orphaned and not used, I can populate it myself for this. We\u0027ll see how this goes.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-03-09T04:22:36Z\u0022 title=\u002203/09/2014 04:22  AM\u0022 data-short=\u002210 yr\u0022\u003EMarch 9, 2014\u003C/time\u003E by Diazo\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"mindstalker","CreatedById":89250,"CreatedDateTime":"2014-03-13T04:33:14Z","Content":"\n\u003Cp\u003EEdit: Nevermind, this is a way of declaring actions, you are looking for a way to finding and triggering another parts actions.\u003C/p\u003E\u003Cp\u003EI\u0027ve found an easier way to do this, inside the partmodule\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E[KSPAction(\u0022Deploy\u0022, KSPActionGroup.None)]\u003Cbr\u003E\tpublic void DeployAction(KSPActionParam param) {\u003Cbr\u003E\t\tthis.Deploy ();\u003Cbr\u003E\t}\u003Cbr\u003E\u003Cbr\u003E[KSPEvent(guiActive = true, guiName = \u0022Deploy\u0022)]\u003Cbr\u003E\tpublic void DeployEvent() {\u003Cbr\u003E\t\tthis.Deploy ();\u003Cbr\u003E\t}\u003Cbr\u003E\u003Cbr\u003E\tpublic void Deploy() {\u003Cbr\u003E\t\t//code\u003Cbr\u003E\t}\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E[KSPAction(\u0022Deploy\u0022, KSPActionGroup.None)]\u003C/p\u003E\u003Cp\u003Egoes infront of the function you want to trigger with the parts \u0022Deploy\u0022 action (or whatever you want to call it)\u003C/p\u003E\u003Cp\u003E[KSPEvent(guiActive = true, guiName = \u0022Deploy\u0022)]\u003C/p\u003E\u003Cp\u003Egoes infront of the rightclick on part menu while in flight.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-03-13T20:24:47Z\u0022 title=\u002203/13/2014 08:24  PM\u0022 data-short=\u002210 yr\u0022\u003EMarch 13, 2014\u003C/time\u003E by mindstalker\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-03-13T13:48:28Z","Content":"\n\u003Cp\u003EWhile the code shown works within a mod you are writing where you know the name, for my purposes this line \u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Epublic void DeployEvent()\u003C/pre\u003E\u003Cp\u003E breaks things because I don\u0027t know the method names.\u003C/p\u003E\u003Cp\u003EI have to pull the name of the Actions dynamically in code and I\u0027m under no illusions that the different mod makers followed any sort of pattern for making the partModule.Action.name and the method name that invokes that action consistent.\u003C/p\u003E\u003Cp\u003EEven in Squad\u0027s parts it is not consistent. My test solar panel has \u0022Extend Panel\u0022, \u0022Retract Panel\u0022 and \u0022Toggle Panels\u0022 as the method names, note that only the Toggle Panels action is plural.\u003C/p\u003E\u003Cp\u003ESo that leaves me a few more hoops to jump through because I have to build my action list dynamically as compared to a mod that is self contained and the method names are known.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n"},{"CreatedByName":"Faark","CreatedById":69775,"CreatedDateTime":"2014-03-13T14:51:18Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Diazo\u0022 data-cite=\u0022Diazo\u0022\u003E\u003Cdiv\u003EEven in Squad\u0027s parts it is not consistent. My test solar panel has \u0022Extend Panel\u0022, \u0022Retract Panel\u0022 and \u0022Toggle Panels\u0022 as the method names, note that only the Toggle Panels action is plural.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EWow, they really are. I never noticed when setting up my action groups in the VAB^^\u003C/p\u003E\u003Cp\u003EThough i don\u0027t see a problem with his DeployEvent(...). An UI label like KethanDrillXXL-\u0026gt;Deploy should be easy enough to understand. Unless ofc the part creator did sth really crazy... but since you have the same data as KSP has for its action group manager, it would mean this parts action groups are crap anyway, even without your mod.\u003C/p\u003E\n"}]}