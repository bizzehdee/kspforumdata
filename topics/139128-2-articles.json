{"TopicId":139128,"ForumId":34,"TopicTitle":"[1.2.x/1.3] MemGraph 1.1.0.3 - with Stutter Reduction","CreatedByName":"Padishar","CreatedById":97386,"CreatedDateTime":"2016-05-06T09:52:19Z","PageNum":2,"Articles":[{"CreatedByName":"Padishar","CreatedById":97386,"CreatedDateTime":"2016-05-27T11:26:25Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222603555\u0022 data-ipsquote-contentid=\u0022139128\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221464344784\u0022 data-ipsquote-userid=\u002274091\u0022 data-ipsquote-username=\u0022p1t1o\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n15 minutes ago, p1t1o said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nGarbage collection is probably a necessary evil - but why does the game have to freeze solid whilst garbage collection is done? Surely it is no slower or faster than any of the other processes that are occurring? I\u0027m assuming a lot of games have some kind of garbage collection process, why don\u0027t they stutter?\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nFirstly, while the garbage collection process (at least all the ones that are in common use)\u00A0is occurring, nothing else must be allowed to allocate any memory or change the contents of any reference variable because the collector has to determine which blocks of memory are still being used and it does this by first assuming that all blocks are no longer needed and then scanning through all the memory looking for block references which it then marks as still used. \u00A0Theoretically, there\u00A0are ways to implement a garbage collector that doesn\u0027t \u0022stop the world\u0022 for any appreciable time but they would result in the allocation of memory taking significantly longer which is one of the main reasons for using a garbage collector mechanism in the first place.\n\u003C/p\u003E\n\u003Cp\u003E\nThe garbage collection process in KSP can take anywhere from \u0026lt;10ms to \u0026gt;500ms depending on the speed of the CPU, the speed of the memory access and the size and number of memory blocks that are allocated. At 60fps\u00A0there are \u0026lt;17ms per rendered frame so, if the game is paused for even 10ms, it is quite likely that the next rendered frame will not get done in that 17ms resulting in a stutter. \u00A0A more usual (for KSP) time would be 80-120 ms so you will miss between 5 and 7 frames of the 60 that should occur in a second. \u00A0If the GC takes 500ms (for whatever reason) then you will lose half the frames...\n\u003C/p\u003E\n\u003Cp\u003E\nGarbage collection\u00A0is only used by some programming languages (well, strictly speaking, language runtimes) such as Java and C# (or other .NET/Mono\u00A0based languages). \u00A0A lot of games (and underlying game engines) do not use it precisely because of the stalling issue. \u00A0If you have to explicitly code the releasing of unwanted memory (e.g. in C or C\u002B\u002B using the standard allocators)\u00A0then the programmer has control over when the CPU is used to do it rather than letting the language runtime decide to do it when it feels like it. \u00A0Those games that are GC based and don\u0027t stutter have simply been written in such a way that they do not create significant amounts of garbage during normal gameplay. \u00A0As you can see from Tig\u0027s graph, his game produces somewhere between 10\u00A0and 20 MB of garbage every second, so code is allocating and discarding more than 300 KB of memory for every 60fps frame that is rendered. \u00A0After using the heap padding feature his stutters are approx. one minute apart rather than 15 seconds apart but, if KSP were only creating 30KB of garbage each frame then they would be 10 minutes apart and could be deliberately triggered when the user wont notice the pause.\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222603592\u0022 data-ipsquote-contentid=\u0022139128\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221464347667\u0022 data-ipsquote-userid=\u00224320\u0022 data-ipsquote-username=\u0022Broco\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n1 minute ago, Broco said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nThey either use more advanced Garbage Collectors (Unity\u0027s is pretty old), they create less garbage, they use call the GC manually in certain events (example Skyrim: When you get in or out of a cave, aka loading screen).\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nYes, all of these things can reduce the perceived stutter and, in combination, can reduce it to a level where it is effectively unnoticeable. \u00A0However, the most important part is creating less garbage. \u00A0The same is true in any language, if you\u0027re trying to write a program that requires consistent, fast performance, then you don\u0027t waste CPU cycles constantly allocating and releasing temporary memory. \u00A0If you do it in any GC based system you will get a stutter, do it in a non-GC system and you will simply get poorer general performance. \u00A0If any game written in C or C\u002B\u002B did 10000\u002B\u00A0calls to malloc/free/new/delete every frame, it would be very unlikely to manage 60 fps...\n\u003C/p\u003E\n"},{"CreatedByName":"p1t1o","CreatedById":74091,"CreatedDateTime":"2016-05-27T12:00:32Z","Content":"\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022http://forum.kerbalspaceprogram.com/index.php?/profile/97386-padishar/\u0026amp;do=hovercard\u0022 data-mentionid=\u002297386\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/97386-padishar/\u0022 rel=\u0022\u0022\u003E@Padishar\u003C/a\u003E\u003Cspan\u003E\u00A0\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022http://forum.kerbalspaceprogram.com/index.php?/profile/4320-broco/\u0026amp;do=hovercard\u0022 data-mentionid=\u00224320\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/4320-broco/\u0022 rel=\u0022\u0022\u003E@Broco\u003C/a\u003E\u00A0Thanks guys.\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cspan\u003EIs the 1.5gb \u0022padding\u0022 arbitrary? Could one, for example, if you had a lot of excess RAM -\u00A0lets say KSP runs at 7GB but I have 16 - set the \u0022padding\u0022 to 5gb or more to further\u00A0increase the time between stutters? Or could this introduce further problems, like the GC taking longer each cycle?\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cspan\u003EDoes the \u0022padding\u0022 function simply because there is a larger garbage pool so it doesn\u0027t have to be collected as often? Or is it more involved?\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nIf the period in between stutters could be increased arbitrarily (based on RAM capacity I suppose), it could easily reach a point of minimal invasiveness without having to be eliminated entirely. I think mine stutters about every 20-30s, if it was 5mins I don\u0027t think I would notice it at all, or if I did, its annoyance would be orders of magnitude less.\n\u003C/p\u003E\n\u003Cp\u003E\nCheers\n\u003C/p\u003E\n"},{"CreatedByName":"Padishar","CreatedById":97386,"CreatedDateTime":"2016-05-27T12:30:53Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222603626\u0022 data-ipsquote-contentid=\u0022139128\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221464350432\u0022 data-ipsquote-userid=\u002274091\u0022 data-ipsquote-username=\u0022p1t1o\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n2 minutes ago, p1t1o said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nIs the 1.5gb \u0022padding\u0022 arbitrary? Could one, for example, if you had a lot of excess RAM -\u00A0lets say KSP runs at 7GB but I have 16 - set the \u0022padding\u0022 to 5gb or more to further\u00A0increase the time between stutters? Or could this introduce further problems, like the GC taking longer each cycle?\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThe 1.5 GB is as a result of my testing in a limited range of situations and I do plan to tune the padding mechanism further and also allow the user some control over it.\u00A0\u00A0Due to how the memory allocator and GC work, it isn\u0027t currently possible to forcibly pad the heap for large block allocations (this is anything over 2032 bytes) and it is very inefficient on memory usage to pad it for blocks above 500 bytes. \u00A0These factors combine to make the improvement highly dependent on the pattern of memory usage (specifically, how many blocks of what different sizes are being allocated). \u00A0If the memory usage was (virtually)\u00A0all in small blocks then the improvement would be considerably better. \u00A0Large blocks have to be allocated directly from the normal heap headroom that Mono maintains (rather than the \u0022pre-allocated blocks\u0022 that the padding mechanism creates)\u00A0and this is simply a proportion of the total heap size (and it looks like Unity deliberately reduces this proportion as memory use increases to prevent too much free memory being retained \u003Cimg alt=\u0022:(\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_sad.gif\u0022 title=\u0022:(\u0022\u003E). \u00A0Increasing the padding does generally always increase the time between stutters but the benefit shrinks rapidly as the heap gets larger and, yes, the padding results in a lot more work for the collector (though I\u0027m also investigating a cunning way to minimise this).\n\u003C/p\u003E\n"},{"CreatedByName":"p1t1o","CreatedById":74091,"CreatedDateTime":"2016-05-27T12:44:11Z","Content":"\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022http://forum.kerbalspaceprogram.com/index.php?/profile/97386-padishar/\u0026amp;do=hovercard\u0022 data-mentionid=\u002297386\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/97386-padishar/\u0022 rel=\u0022\u0022\u003E@Padishar\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nCheers, good luck and thanks for the hard work!\n\u003C/p\u003E\n"},{"CreatedByName":"Tig","CreatedById":103242,"CreatedDateTime":"2016-05-27T20:15:14Z","Content":"\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222603471\u0022 data-ipsquote-contentid=\u0022139128\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221464337780\u0022 data-ipsquote-userid=\u0022162264\u0022 data-ipsquote-username=\u0022stk2008\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n11 hours ago, stk2008 said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nThis is probably a stupid question but\n\u003C/p\u003E\n\u003Cp\u003E\nWhat is the Mod\u002BEnd key?\n\u003C/p\u003E\n\u003Cp\u003E\nI see End key on my keyboard but whats the Mod key on windows as I assume Mod key is for Linus?.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nThanks again \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nAlthough its been answered.\u00A0 Its not a stupid question at all.\u00A0 \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u00A0 I started using the platform agnostic \u0022Mod\u0022 instead of \u0022Alt\u0022 because pre 1.1 I tried out Kerbal on Linux and was cursing at why I couldn\u0027t load up the debug.\u00A0 Different \u0022Mod\u0022 key.\u00A0 Took me 10 minutes to figure it out. \u00A0 *facepalm*.\u00A0 You\u0027ll get no judgment from me, lol.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222603473\u0022 data-ipsquote-contentid=\u0022139128\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221464337823\u0022 data-ipsquote-userid=\u002297386\u0022 data-ipsquote-username=\u0022Padishar\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n11 hours ago, Padishar said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nAs an example, yes, there is a reason for the positive slope between collections. \u00A0The actual rate of memory allocation is a lot more constant but the memory allocator works on 4 KB pages and it groups allocations of similar sizes together into the same 4KB pages.\u00A0 [snip]\n\u003C/p\u003E\n\u003Cp\u003E\nIf there isn\u0027t an existing page with empty space for the correct size range of block then the allocator will take a page that is currently not used at all and add it to the list of pages used for that block size range. \u00A0It\u0027s only when a page\u00A0is\u00A0added like this that the memory usage can be detected.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\n\u003Cspan\u003EThank you that makes perfect sense now.\u00A0 Looking at my graph above I perceive, albeit somewhat poorly defined, small stair-steps in my MemGraph chart.\u00A0 I\u0027m wondering if that\u0027s happening as it runs out of larger block sizes.\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cspan\u003EI can see how managed memory languages were probably really popular with guys/gals coming from C/C\u002B\u002B into something like C# for some applications.\u00A0 But if there\u0027s anything I\u0027ve learned from this discussion its that even if your memory is \u0022managed\u0022 if you don\u0027t understand memory management and specifically how your memory management works you can really screw things up still.\u00A0 I\u0027ve seen memory issues in other managed games, perhaps there is a new generation that never had to deal with unmanaged languages and some of them are exacerbating the problem.\u00A0 At least with C/C\u002B\u002B if you messed up your memory management typically the consequences were very bad very quickly - hence the bug got found and smashed.\u00A0\u00A0 Now it seems like managed languages can allow people to use very poor techniques, especially in how/where they create, but it still works... and if the program is small enough the issue is not perceptible. \u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cspan\u003EOr maybe its just that I\u0027m crusty and bitter that I had a professor who had us learn SPARC assembly... \u003C/span\u003E\u003Cimg alt=\u0022:rolleyes:\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_rolleyes.gif\u0022 title=\u0022:rolleyes:\u0022\u003E\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222603473\u0022 data-ipsquote-contentid=\u0022139128\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221464337823\u0022 data-ipsquote-userid=\u002297386\u0022 data-ipsquote-username=\u0022Padishar\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n11 hours ago, Padishar said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nSo much for the people that complain that the game is \u0022unplayable\u0022 (without qualifying it with \u0022for me\u0022).\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\n\u003Cspan\u003EAnd with 101 mods! Although to be fair some are dependencies, plus about 10 custom MM cfgs.\u003C/span\u003E\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222603473\u0022 data-ipsquote-contentid=\u0022139128\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221464337823\u0022 data-ipsquote-userid=\u002297386\u0022 data-ipsquote-username=\u0022Padishar\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n11 hours ago, Padishar said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nThe \u0022not responding\u0022 dialog isn\u0027t really a \u0022crash\u0022 warning. \u00A0It simply tells the user that the program has not responded to a Windows message that it was sent, usually because it is busy doing something and isn\u0027t bothering to run the main message processing loop in the program. \u00A0Most programs that do\u00A0any kind of long calculation will do the same thing but often only when the user tries to interact with the program while it is busy (e.g. if you click on a busy window you will often trigger this dialog instantly because Windows sends the program a \u0022click\u0022 message but it doesn\u0027t respond to it immediately).\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\n\u003Cspan\u003ESo true, I wrote that in my post because so many people think it is \u003Cstrong\u003Ealways \u003C/strong\u003Ea crash warning... to be fair, with windows 9 out of 10 times (or more) it probably is a crash. \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cspan\u003EI wonder how many of the \u0022my game is crashing, i quit\u0022 reports are just people being impatient with this warning and not waiting a few seconds.\u003C/span\u003E\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222603473\u0022 data-ipsquote-contentid=\u0022139128\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221464337823\u0022 data-ipsquote-userid=\u002297386\u0022 data-ipsquote-username=\u0022Padishar\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n11 hours ago, Padishar said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nI suspect these may be caused by the game auto-saving (though every minute seems a little frequent so it may be some other regular housekeeping task that KSP does).\n\u003C/p\u003E\n\u003Cp\u003E\nNot a problem, you\u0027ve been more than helpful. \u00A0I used to use fraps every time I played the game and I\u0027ve only ever seen this happen once though I\u0027ve hardly used fraps with KSP 1.1.\u00A0 I spent a considerable time trying to repeat it but I couldn\u0027t. \u00A0I switched from using fraps to using a mod to get better accuracy at low frame rates (fraps only displays integer values in its overlay and there\u0027s a lot of difference between 2 and 3 fps).\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\n\u003Cspan\u003EAutosave interval is set to 5 minutes, although there is something in the settings.cfg i hadn\u0027t noticed before called\u00A0\u003C/span\u003EAUTOSAVE_SHORT_INTERVAL, its set to 30.\u00A0 I changed it to a few different values, didn\u0027t appear to have any effect - found a few other posts with the same results.\u00A0 In any event I also use the S.A.V.E. mod, but its set to 20 minutes intervals.\n\u003C/p\u003E\n\u003Cp\u003E\nI use fraps mainly for the frametimes; I\u0027m big into the frametime analysis and happy to see that more and more gaming websites are focusing on the metric.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nIts subjective, it always is with fps, but my personal preference is for consistency over average speed.\u00A0 In theoretical gaming world I\u0027d rather a rocksolid 40 fps over 45 fps that is bouncing between 35 and 55.\u00A0 Totally subjective.\n\u003C/p\u003E\n\u003Cp\u003E\nAnd yes, the integer does bother me with fraps.\u00A0 Especially since its not only the overlay but the freaking logs as well, which i just don\u0027t understand since the frametime log is very precise.\u00A0 Sure, I could recreate my own more accurate fps from the frametime log but why make me go through the hassle... sigh.\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cspan\u003E-----\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cspan\u003EThank you as always.\u00A0 If I may, what aspect of Kerbal/Unity/Mono is causing the huge increase in total memory being used?\u00A0 From the beginning of my play session to the end the HWM grew about 800MB or so (from a max of ~3000 to 3800ish) so unless I totally misunderstood you on how blocks are freed and new pages allocated that shouldn\u0027t be the issue (or rather only 800MB of it), but my total memory went from 6.8GB to 13.1GB.\u00A0 What else is in there?\u00A0 I thought the vast majority of the rest of the memory being used was for models/textures.\u00A0 My understanding was that all that gets loaded at the start and then should just remain static in memory.\u00A0 But clearly I\u0027m missing something... about\u003Cstrong\u003E 5 gigs\u003C/strong\u003E of something. \u00A0\u003C/span\u003E\u003Cimg alt=\u0022:D\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 title=\u0022:D\u0022\u003E\u003Cspan\u003E \u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-05-27T20:22:32Z\u0022 title=\u002205/27/2016 08:22  PM\u0022 data-short=\u00228 yr\u0022\u003EMay 27, 2016\u003C/time\u003E by Tig\u003C/strong\u003E\n\u003Cbr\u003Etypographical\n\u003C/span\u003E\n"},{"CreatedByName":"spacehorse","CreatedById":164514,"CreatedDateTime":"2016-05-28T15:59:30Z","Content":"\n\u003Cp\u003E\nThank you for the good work, I am not technical enough but looks like work for me and the \u0022gameplay\u0022 feeling is a lot of better after activation (Looks alos in the graph) THANKS!\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-05-28T15:59:52Z\u0022 title=\u002205/28/2016 03:59  PM\u0022 data-short=\u00228 yr\u0022\u003EMay 28, 2016\u003C/time\u003E by spacehorse\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"N1njawarrior","CreatedById":163993,"CreatedDateTime":"2016-05-28T18:26:58Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222605288\u0022 data-ipsquote-contentid=\u0022139128\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221464451170\u0022 data-ipsquote-userid=\u0022164514\u0022 data-ipsquote-username=\u0022spacehorse\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n2 hours ago, spacehorse said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nThank you for the good work, I am not technical enough but looks like work for me and the \u0022gameplay\u0022 feeling is a lot of better after activation (Looks alos in the graph) THANKS!\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nfrom my experience as a coder, this seems like it would work,\u00A0but my mac is too slow for it to do much, in fact it\u0027s so slow that this mod makes it worse, which is a shame, I was really looking forward to something like this, but I must keep my scene switching times below 2 minutes.\n\u003C/p\u003E\n\u003Cp\u003E\nBut again, good work, I like what you\u0027re doing here.\n\u003C/p\u003E\n"},{"CreatedByName":"Padishar","CreatedById":97386,"CreatedDateTime":"2016-05-28T19:14:24Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222605483\u0022 data-ipsquote-contentid=\u0022139128\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221464460018\u0022 data-ipsquote-userid=\u0022163993\u0022 data-ipsquote-username=\u0022N1njawarrior\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n41 minutes ago, N1njawarrior said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nfrom my experience as a coder, this seems like it would work,\u00A0but my mac is too slow for it to do much, in fact it\u0027s so slow that this mod makes it worse, which is a shame, I was really looking forward to something like this, but I must keep my scene switching times below 2 minutes.\n\u003C/p\u003E\n\u003Cp\u003E\nBut again, good work, I like what you\u0027re doing here.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThere is a possibility that the Mac build of Mono uses slightly different private data in each memory block resulting in different block sizes or simply tracks different block sizes to the windows build. \u00A0If this is the case then there may be no padding created for one or more block sizes which would reduce the effectiveness.\n\u003C/p\u003E\n\u003Cp\u003E\nI am surprised that it would make the performance worse though. \u00A0What do you actually mean? \u00A0Are the GC stutters closer together after padding the heap or does the game just run slower in general (the U value in the window is basically fps)? \u00A0How much RAM does your machine have? \u00A0Any chance you can do a test exactly as described in the first post and then upload your player.log file?\n\u003C/p\u003E\n"},{"CreatedByName":"N1njawarrior","CreatedById":163993,"CreatedDateTime":"2016-05-28T19:27:13Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222605532\u0022 data-ipsquote-contentid=\u0022139128\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221464462864\u0022 data-ipsquote-userid=\u002297386\u0022 data-ipsquote-username=\u0022Padishar\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nJust now, Padishar said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nThere is a possibility that the Mac build of Mono uses slightly different private data in each memory block resulting in different block sizes or simply tracks different block sizes to the windows build. \u00A0If this is the case then there may be no padding created for one or more block sizes which would reduce the effectiveness.\n\u003C/p\u003E\n\u003Cp\u003E\nI am surprised that it would make the performance worse though. \u00A0What do you actually mean? \u00A0Are the GC stutters closer together after padding the heap or does the game just run slower in general (the U value in the window is basically fps)? \u00A0How much RAM does your machine have? \u00A0Any chance you can do a test exactly as described in the first post and then upload your player.log file?\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThis mod doesn\u0027t make the stutters any worse, (that would be pretty hard) or cause a hit in frames/fps, (again, that would be hard to do.) The performance hit I spoke of doesn\u0027t actually happen while playing the game, on when switching scenes, it cause the loading times when doing things like launching a vessel, or entering to the SPH to be\u00A0\u003Cstrong\u003Esignificantly\u003C/strong\u003E\u00A0longer.\n\u003C/p\u003E\n\u003Cp\u003E\nIn terms of the machine I\u0027m running, it\u0027s a six-year-old mac-mini, and one of the ram slots is broken, I currently have 4GB of ram. (8GB if both slots worked) I will try to run run that test as soon as I get the chance, if there is anything else I can do to help, just let me know.\n\u003C/p\u003E\n"},{"CreatedByName":"Padishar","CreatedById":97386,"CreatedDateTime":"2016-05-28T19:56:17Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222605550\u0022 data-ipsquote-contentid=\u0022139128\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221464463633\u0022 data-ipsquote-userid=\u0022163993\u0022 data-ipsquote-username=\u0022N1njawarrior\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n3 hours ago, N1njawarrior said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nI currently have 4GB of ram.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nAhhh, the heap padding increases the memory usage of KSP by a little over 1.5GB (at the main menu my x64 KSP on Windows has a commit size of 2.2 GB and this rises to 3.8 GB after doing the padding). \u00A0This will cause a machine with only 4GB of RAM to have a bit of a fit so that isn\u0027t really a surprise. \u00A0I will be modifying the padding mechansim to make it tunable which should allow it to be used on a machine with only 4GB, though\u00A0since the whole point of it is to trade memory usage against GC frequency, the benefit with so little RAM will never be great.\n\u003C/p\u003E\n\u003Cp\u003E\nEdit: I have edited the first post to make it clear that it currently wont work well with only 4GB of RAM.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-05-28T22:32:42Z\u0022 title=\u002205/28/2016 10:32  PM\u0022 data-short=\u00228 yr\u0022\u003EMay 28, 2016\u003C/time\u003E by Padishar\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Gordon Dry","CreatedById":163177,"CreatedDateTime":"2016-05-29T16:06:55Z","Content":"\n\u003Cp\u003E\nCould it be that MemGraph after \u0022calibrating\u0022 has the side-effect of KSP using much more RAM than without?\n\u003C/p\u003E\n"},{"CreatedByName":"Padishar","CreatedById":97386,"CreatedDateTime":"2016-05-29T16:29:33Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222606676\u0022 data-ipsquote-contentid=\u0022139128\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221464538015\u0022 data-ipsquote-userid=\u0022163177\u0022 data-ipsquote-username=\u0022Gordon Dry\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n22 minutes ago, Gordon Dry said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nCould it be that MemGraph after \u0022calibrating\u0022 has the side-effect of KSP using much more RAM than without?\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nWhat are you trying to imply? \u00A0In what way is that not totally obvious from all these:\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222564631\u0022 data-ipsquote-contentid=\u0022139128\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221462528339\u0022 data-ipsquote-userid=\u002297386\u0022 data-ipsquote-username=\u0022Padishar\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nOn 5/6/2016 at 10:52 AM, Padishar said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nHowever, I have since devised\u00A0a way to\u00A0force\u00A0Mono to keep significantly more free space in the heap,\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222564631\u0022 data-ipsquote-contentid=\u0022139128\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221462528339\u0022 data-ipsquote-userid=\u002297386\u0022 data-ipsquote-username=\u0022Padishar\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nOn 5/6/2016 at 10:52 AM, Padishar said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nMod-End pads the Mono heap with approx 1.5 GB of headroom to reduce frequency of garbage collections.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222605580\u0022 data-ipsquote-contentid=\u0022139128\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221464465377\u0022 data-ipsquote-userid=\u002297386\u0022 data-ipsquote-username=\u0022Padishar\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n20 hours ago, Padishar said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nAhhh, the heap padding increases the memory usage of KSP by a little over 1.5GB (at the main menu my x64 KSP on Windows has a commit size of 2.2 GB and this rises to 3.8 GB after doing the padding).\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-05-29T16:29:47Z\u0022 title=\u002205/29/2016 04:29  PM\u0022 data-short=\u00228 yr\u0022\u003EMay 29, 2016\u003C/time\u003E by Padishar\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Gordon Dry","CreatedById":163177,"CreatedDateTime":"2016-05-29T16:56:42Z","Content":"\n\u003Cp\u003E\nOkay, the last sessions my RAM usage was about 11.9 GB, now I had 16 GB RAM usage - that\u0027s my physical RAM and I had problems to manage the situation - I don\u0027t like reset buttons, I prefer killing hanging processes, I needed 10 minutes to manage that...\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-05-29T16:56:50Z\u0022 title=\u002205/29/2016 04:56  PM\u0022 data-short=\u00228 yr\u0022\u003EMay 29, 2016\u003C/time\u003E by Gordon Dry\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Padishar","CreatedById":97386,"CreatedDateTime":"2016-05-29T17:09:17Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222606749\u0022 data-ipsquote-contentid=\u0022139128\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221464541002\u0022 data-ipsquote-userid=\u0022163177\u0022 data-ipsquote-username=\u0022Gordon Dry\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n6 minutes ago, Gordon Dry said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nOkay, the last sessions my RAM usage was about 11.9 GB, now I had 16 GB RAM usage - that\u0027s my physical RAM and I had problems to manage the situation - I don\u0027t like reset buttons, I prefer killing hanging processes, I needed 10 minutes to manage that...\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nI\u0027m sorry, I simply don\u0027t understand what you\u0027re trying to say. \u00A0If you\u0027re trying to report an apparent problem caused by this mod then you\u0027ll need to accurately describe what you did in the session (with, I presume, details of the\u00A0memory usage of KSP at different times during the session, including exactly which measure of memory use you are quoting)\u00A0and, preferably, post an output_log.txt/player.log file of the session. \u00A0To be really thorough, you should repeat the whole session without using the heap padding so a valid comparison can be made.\n\u003C/p\u003E\n"},{"CreatedByName":"Padishar","CreatedById":97386,"CreatedDateTime":"2016-05-30T22:43:22Z","Content":"\n\u003Cp\u003E\nI have now released version 1.0.0.7. \u00A0This adds readouts of the minimum (just after GC) and maximum (just before GC) heap sizes and the time between the last two collections. It also makes the heap padding configurable via a text file. \u00A0The default settings now allocate\u00A0approx. 900 MB of padding\u00A0and the screenshot in the OP now shows the effect of running this. \u00A0Before the padding the collections were happening at 13 second intervals and after the padding this increased to 44 seconds. \u00A0Modifying the configuration to allocate around 2.5 GB of padding increased it to 112 seconds.\n\u003C/p\u003E\n\u003Cp\u003E\nEdit: \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022http://forum.kerbalspaceprogram.com/index.php?/profile/74091-p1t1o/\u0026amp;do=hovercard\u0022 data-mentionid=\u002274091\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/74091-p1t1o/\u0022 rel=\u0022\u0022\u003E@p1t1o\u003C/a\u003E, now that it\u0027s configurable you can simply edit the values in padheap.cfg, e.g. if you add a 0 on the end of all the counts then it should allocate more like 9GB extra. \u00A0If it does work and does give a decent extra effect then you might want to tune it back a bit to give you more headroom. \u00A0The counts in the file are simply counts of the number of pre-allocated blocks to create for each block size. \u00A0The current values are fairly arbitrary, simply based on sharing the total padding fairly evenly between the block sizes with a considerable bias towards smaller blocks which was experimentally determined to improve the effect in the limited number of situations I tested.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-05-31T17:00:13Z\u0022 title=\u002205/31/2016 05:00  PM\u0022 data-short=\u00228 yr\u0022\u003EMay 31, 2016\u003C/time\u003E by Padishar\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Gordon Dry","CreatedById":163177,"CreatedDateTime":"2016-05-31T10:46:28Z","Content":"\n\u003Cp\u003E\nSeems to work better now, I have to investigate further.\n\u003C/p\u003E\n\u003Cp\u003E\nI suggest to change the settings files from .cfg to.xml to avoid MM patch rebuilding after settings were changed.\n\u003C/p\u003E\n"},{"CreatedByName":"Padishar","CreatedById":97386,"CreatedDateTime":"2016-05-31T11:27:41Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222609502\u0022 data-ipsquote-contentid=\u0022139128\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221464691588\u0022 data-ipsquote-userid=\u0022163177\u0022 data-ipsquote-username=\u0022Gordon Dry\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n22 minutes ago, Gordon Dry said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nSeems to work better now, I have to investigate further.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThanks for the reply.\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222609502\u0022 data-ipsquote-contentid=\u0022139128\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221464691588\u0022 data-ipsquote-userid=\u0022163177\u0022 data-ipsquote-username=\u0022Gordon Dry\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n22 minutes ago, Gordon Dry said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nI suggest to change the settings files from .cfg to.xml to avoid MM patch rebuilding after settings were changed.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nWhat makes you think that changing any of the settings files causes MM to ignore the cache?\u00A0 As far as I\u0027m aware, MM only rebuilds when files that are loaded into the GameDatabase change and the ones from this mod aren\u0027t due to them being in the PluginData folder. \u00A0In any case, MM specifically logs the names of the files that cause\u00A0it to rebuild so, does your log explicitly say that one of this mod\u0027s ,cfg files caused a rebuild?\n\u003C/p\u003E\n"},{"CreatedByName":"p1t1o","CreatedById":74091,"CreatedDateTime":"2016-05-31T17:51:21Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222608801\u0022 data-ipsquote-contentid=\u0022139128\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221464648202\u0022 data-ipsquote-userid=\u002297386\u0022 data-ipsquote-username=\u0022Padishar\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n19 hours ago, Padishar said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nEdit: \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022http://forum.kerbalspaceprogram.com/index.php?/profile/74091-p1t1o/\u0026amp;do=hovercard\u0022 data-mentionid=\u002274091\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/74091-p1t1o/\u0022 rel=\u0022\u0022\u003E@p1t1o\u003C/a\u003E, now that it\u0027s configurable you can simply edit the values in padheap.cfg, e.g. if you add a 0 on the end of all the counts then it should allocate more like 9GB extra. \u00A0If it does work and does give a decent extra effect then you might want to tune it back a bit to give you more headroom. \u00A0The counts in the file are simply counts of the number of pre-allocated blocks to create for each block size. \u00A0The current values are fairly arbitrary, simply based on sharing the total padding fairly evenly between the block sizes with a considerable bias towards smaller blocks which was experimentally determined to improve the effect in the limited number of situations I tested.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThanks for the heads-up! Sounds great! Unfortunately I\u0027m at 97% RAM usage at the moment (why did I have to save just a few bucks and only spring for 8GB? Talk about bottleneck...) so I\u0027m guessing this isn\u0027t going to do much for me until I can bulk that up a bit?\n\u003C/p\u003E\n"},{"CreatedByName":"Padishar","CreatedById":97386,"CreatedDateTime":"2016-05-31T17:56:11Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222610040\u0022 data-ipsquote-contentid=\u0022139128\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221464717081\u0022 data-ipsquote-userid=\u002274091\u0022 data-ipsquote-username=\u0022p1t1o\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n3 minutes ago, p1t1o said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nThanks for the heads-up! Sounds great! Unfortunately I\u0027m at 97% RAM usage at the moment (why did I have to save just a few bucks and only spring for 8GB? Talk about bottleneck...) so I\u0027m guessing this isn\u0027t going to do much for me until I can bulk that up a bit?\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nAhhh, sorry, I thought the example in your post indicated you had 16GB. \u00A0Yeah, if you haven\u0027t got much physical memory free then it might well do more harm than good, even at the default settings...\n\u003C/p\u003E\n"},{"CreatedByName":"Guest","CreatedById":-1,"CreatedDateTime":"2016-05-31T20:37:26Z","Content":"\n\u003Cp\u003E\nKSP has indirectly trained me over time to keep my \u0022garbage\u0022 low. I usually don\u0027t let my number of active flights get over 15, and I clean up debris as quickly as possible in the tracking center. The information in this thread explains why I have been having to do this. I had noticed over time that the more on rails flights that I had, the worse my game performed, but I never would have suspected on-rails flights were causing garbage collection problems. I\u0027m really excited now that this information has been brought to light. Padishar, thank you for creating this tool. I feel it\u0027s only a matter of time now that we can all start seeing major benefits from this. This thread deserves a sticky and should be required reading for all KSP developers moving forward, IMO.\n\u003C/p\u003E\n"},{"CreatedByName":"Wiseman","CreatedById":116239,"CreatedDateTime":"2016-05-31T23:05:20Z","Content":"\n\u003Cp\u003E\nFirst of all, I wanted to thank you for this stutter reduction experiment. I haven\u0027t been able to play at all since 1.1.2 because of the frantic garbage collection going on. I was curious, though, if you know what\u0027s causing this behavior:\n\u003C/p\u003E\n\u003Cdiv class=\u0022ipsSpoiler\u0022 data-ipsspoiler=\u0022\u0022\u003E\n\u003Cdiv class=\u0022ipsSpoiler_header\u0022\u003E\n\u003Cspan\u003ESpoiler\u003C/span\u003E\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsSpoiler_contents\u0022\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u0022JNpjqKv.jpg\u0022 class=\u0022ipsImage\u0022 src=\u0022http://i.imgur.com/JNpjqKv.jpg\u0022\u003E\u003C/p\u003E\n\u003C/div\u003E\n\u003C/div\u003E\n\u003Cp\u003E\nHere\u0027s a link to my \u003Ca href=\u0022https://www.dropbox.com/s/kyf1jbn7fa2hv0i/KSP.log?dl=0\u0022 rel=\u0022external nofollow\u0022\u003Elog file\u003C/a\u003E.\n\u003C/p\u003E\n\u003Cp\u003E\nI have a pretty hefty modlist (142 according to CKAN, and a few manually installed visual mods as well), including Kopernicus and OPM, as you can see in the screenshot above. I tripled the size of the padding in the config file, and reduced my frame limit to 60. In flight view, that increased my interval to about 72~ seconds, which is great! (The wide swaths of the second third of the log)\u00A0But, when switching to map view, it dropped down to 20 seconds briefly (the end of the log and back to the left side), then went back up if I stopped touching things. The real issue issue was when\u00A0I focused on another planet, the garbage collector seems to have gone into overdrive and was stuttering every few frames.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nUpdate: I think this has to do with Kopernicus, OPM, and/or the OPM visual overhaul mod, or some combination thereof. The framerate gets cranky every time I scroll in or out from a particular body, but that seems in line with my thinking as it coincides with the loading/unloading of those bodies. However, anytime I\u0027m focused on a planet with rings, the memory usage and resultant garbage collection shoots through the roof. In any case, this seems unlikely to have anything to do with your mod, so my apologies!\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-05-31T23:30:14Z\u0022 title=\u002205/31/2016 11:30  PM\u0022 data-short=\u00228 yr\u0022\u003EMay 31, 2016\u003C/time\u003E by Wiseman\u003C/strong\u003E\n\u003Cbr\u003EUpdate with further testing\n\u003C/span\u003E\n"},{"CreatedByName":"Tig","CreatedById":103242,"CreatedDateTime":"2016-06-01T05:10:58Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222608801\u0022 data-ipsquote-contentid=\u0022139128\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221464648202\u0022 data-ipsquote-userid=\u002297386\u0022 data-ipsquote-username=\u0022Padishar\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nOn 5/30/2016 at 6:43 PM, Padishar said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nI have now released version 1.0.0.7. \u00A0This adds readouts of the minimum (just after GC) and maximum (just before GC) heap sizes and the time between the last two collections. It also makes the heap padding configurable via a text file. \u00A0The default settings now allocate\u00A0approx. 900 MB of padding\u00A0and the screenshot in the OP now shows the effect of running this. \u00A0Before the padding the collections were happening at 13 second intervals and after the padding this increased to 44 seconds. \u00A0Modifying the configuration to allocate around 2.5 GB of padding increased it to 112 seconds.\n\u003C/p\u003E\n\u003Cp\u003E\nEdit: \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022http://forum.kerbalspaceprogram.com/index.php?/profile/74091-p1t1o/\u0026amp;do=hovercard\u0022 data-mentionid=\u002274091\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/74091-p1t1o/\u0022 rel=\u0022\u0022\u003E@p1t1o\u003C/a\u003E, now that it\u0027s configurable you can simply edit the values in padheap.cfg, e.g. if you add a 0 on the end of all the counts then it should allocate more like 9GB extra. \u00A0If it does work and does give a decent extra effect then you might want to tune it back a bit to give you more headroom. \u00A0The counts in the file are simply counts of the number of pre-allocated blocks to create for each block size. \u00A0The current values are fairly arbitrary, simply based on sharing the total padding fairly evenly between the block sizes with a considerable bias towards smaller blocks which was experimentally determined to improve the effect in the limited number of situations I tested.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nHey \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022http://forum.kerbalspaceprogram.com/index.php?/profile/97386-padishar/\u0026amp;do=hovercard\u0022 data-mentionid=\u002297386\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/97386-padishar/\u0022 rel=\u0022\u0022\u003E@Padishar\u003C/a\u003E, thanks for the update.\u00A0 Going to do more full testing on different sizes when I have time, busy week...\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027ve done some limited testing though and just wanted to give the TLDR version since you know my settings and the way I test by now \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nEverything works *exactly* the way you would have theorized in advance.\u00A0 More heap = longer interval = longer stutter frame in ms, but the increase in said frame is slight compared to the increase in the intervals.\n\u003C/p\u003E\n\u003Cp\u003E\nThx again.\n\u003C/p\u003E\n\u003Cp\u003E\nPS.\u00A0 To all other users, I\u0027ll say this a bit stronger than the mod author, this mod is in no way for people with 4GB of ram, and frankly be careful with your MemGraph settings with 8GB of ram if you\u0027re running stock.\u00A0 Mods will run you out of 8GB of ram very quickly in my experience with MemGraph and GCMonitor.\u00A0 I\u0027m seeing my total ram usage (not heap) grow even in stock with every scene change still and mods exacerbate that issue, at least for me.\u00A0 The moment you run out of physical ram by using this mod, which I\u0027ve tested, you\u0027ll see a big drop in performance even on an ssd.\u00A0 (I have a Samsung EVO, maybe the swap on an m.2 would be fast enough, i don\u0027t know, but I\u0027ll take donations towards buying one for testing purposes. \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E )\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-06-01T05:21:25Z\u0022 title=\u002206/01/2016 05:21  AM\u0022 data-short=\u00228 yr\u0022\u003EJune 1, 2016\u003C/time\u003E by Tig\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Galenmacil","CreatedById":118681,"CreatedDateTime":"2016-06-01T05:13:16Z","Content":"\n\u003Cp\u003E\nI was going to write how I was unable to understand the new feature in MemGraph 1.0.7 until I finally figured it out. I used the \u0022extra 0 at the end of each line\u0022 Padishar suggested and It seems to make a huge difference on the frequency of KSP garbage collection.\n\u003C/p\u003E\n\u003Cp\u003E\nEdit: Reduced garbage collection frequency to 120s in between.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-06-01T05:27:17Z\u0022 title=\u002206/01/2016 05:27  AM\u0022 data-short=\u00228 yr\u0022\u003EJune 1, 2016\u003C/time\u003E by Galenmacil\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Tig","CreatedById":103242,"CreatedDateTime":"2016-06-01T05:37:42Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222611005\u0022 data-ipsquote-contentid=\u0022139128\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221464757996\u0022 data-ipsquote-userid=\u0022118681\u0022 data-ipsquote-username=\u0022Galenmacil\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n26 minutes ago, Galenmacil said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nI was going to write how I was unable to understand the new feature in MemGraph 1.0.7 until I finally figured it out. I used the \u0022extra 0 at the end of each line\u0022 Padishar suggested and It seems to make a huge difference on the frequency of KSP garbage collection.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nGlad you figured it out and glad it\u0027s solving this nasty issue for lots of us.\n\u003C/p\u003E\n\u003Cp\u003E\nFor anyone confused by the numbers, my personal recommendation would be to double or triple \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022http://forum.kerbalspaceprogram.com/index.php?/profile/97386-padishar/\u0026amp;do=hovercard\u0022 data-mentionid=\u002297386\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/97386-padishar/\u0022 rel=\u0022\u0022\u003E@Padishar\u003C/a\u003E\u0027s numbers after the colon in padheap.cfg if you\u0027re running 16GB of ram.\u00A0 Watch your ram usage with GCMonitor and adjust as you see fit.\u00A0 I wouldn\u0027t change his numbers much with mods and 8GB of ram, but again the mods - how many/which ones - can have a profound effect.\u00A0 There is \u003Cstrong\u003ENO one-size-fits-all\u003C/strong\u003E settings with MemGraph to lessen with the stutter issue. \u00A0 I\u0027m just trying to give you a good starting point for anyone confused... hopefully it helps a few.\n\u003C/p\u003E\n\u003Cp\u003E\nI wouldn\u0027t recommend just adding a zero to the end unless you\u0027re in \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022http://forum.kerbalspaceprogram.com/index.php?/profile/118681-galenmacil/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022118681\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/118681-galenmacil/\u0022 rel=\u0022\u0022\u003E@Galenmacil\u003C/a\u003E\u0027s range of 32GB\u002B ram.\u00A0 ( hehe, saw your post before your edit \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u00A0 )\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-06-01T05:40:39Z\u0022 title=\u002206/01/2016 05:40  AM\u0022 data-short=\u00228 yr\u0022\u003EJune 1, 2016\u003C/time\u003E by Tig\u003C/strong\u003E\n\u003Cbr\u003Eclarification.\n\u003C/span\u003E\n"},{"CreatedByName":"p1t1o","CreatedById":74091,"CreatedDateTime":"2016-06-01T08:55:00Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222610046\u0022 data-ipsquote-contentid=\u0022139128\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221464717371\u0022 data-ipsquote-userid=\u002297386\u0022 data-ipsquote-username=\u0022Padishar\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n14 hours ago, Padishar said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nAhhh, sorry, I thought the example in your post indicated you had 16GB. \u00A0Yeah, if you haven\u0027t got much physical memory free then it might well do more harm than good, even at the default settings...\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nHaha no it was literally an example/wishful thinking on my part! I do intend to increase my RAM when I get a chance so I am keeping an eye on this for later \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nMo\u0027 address space,\u00A0Mo\u0027 problems \u003Cimg alt=\u0022:D\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 title=\u0022:D\u0022\u003E\u003C/p\u003E\n"}]}