{"TopicId":103963,"ForumId":36,"TopicTitle":"[WIP][1.9.x-1.12.x] Scatterer-atmospheric scattering (0.0838 - 14/08/2022) Scattering improvements, in-game atmo generation and multi-sun support","CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-04-12T08:37:35Z","PageNum":80,"Articles":[{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-11-19T01:15:27Z","Content":"\n[quote name=\u0027rbray89\u0027]Ocean is of type TransparentCuttout... You\u0026#39;ll need to add the RenderType to the tags in the replacement shader or do the ocean radius math fix thing in your sky shader.[/QUOTE]\u003Cbr\u003E\n\u003Cbr\u003E\nHmm, can I have two rendertype tags in the replacement shader? Do I need to copy it in two different subshaders and give them different tags?\u003Cbr\u003E\n\u003Cbr\u003E\nEdited:You already answered this a page ago, multiple subshaders works but multiple tags doesn\u0026#39;t.\u003Cbr\u003E\n\u003Cbr\u003E\n[URL=\u0022https://mega.nz/#!idYiECiR!EGIfls2jtkl5tLzTAi5Z2FMHk0spvmg6C7yrpT1atDQ\u0022]https://mega.nz/#!idYiECiR!EGIfls2jtkl5tLzTAi5Z2FMHk0spvmg6C7yrpT1atDQ[/URL]\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-11-19T01:38:39Z\u0022 title=\u002211/19/2015 01:38  AM\u0022 data-short=\u00228 yr\u0022\u003ENovember 19, 2015\u003C/time\u003E by blackrack\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"rbray89","CreatedById":48847,"CreatedDateTime":"2015-11-19T02:03:14Z","Content":"\n[quote name=\u0027blackrack\u0027]Hmm, can I have two rendertype tags in the replacement shader? Do I need to copy it in two different subshaders and give them different tags?\u003Cbr\u003E\n\u003Cbr\u003E\nEdited:You already answered this a page ago, multiple subshaders works but multiple tags doesn\u0026#39;t.\u003Cbr\u003E\n\u003Cbr\u003E\n[URL=\u0022https://mega.nz/#!idYiECiR!EGIfls2jtkl5tLzTAi5Z2FMHk0spvmg6C7yrpT1atDQ\u0022]https://mega.nz/#!idYiECiR!EGIfls2jtkl5tLzTAi5Z2FMHk0spvmg6C7yrpT1atDQ[/URL][/QUOTE]\u003Cbr\u003E\n\u003Cbr\u003E\nCool, that is good to know. \u003Cbr\u003E\n\u003Cbr\u003E\nOut of curiosity, it seems that whatever you are doing is replacing the built-in depth texture. Is that intended?\n"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-11-19T02:05:29Z","Content":"\n[quote name=\u0027rbray89\u0027]Cool, that is good to know. \u003Cbr\u003E\n\u003Cbr\u003E\nOut of curiosity, it seems that whatever you are doing is replacing the built-in depth texture. Is that intended?[/QUOTE]\u003Cbr\u003E\n\u003Cbr\u003E\nWhat do you mean replacing the built-in depth texture? The regular depth buffer?\n"},{"CreatedByName":"Manwith Noname","CreatedById":117203,"CreatedDateTime":"2015-11-19T02:07:29Z","Content":"\n[quote name=\u0027blackrack\u0027][URL]https://mega.nz/#!idYiECiR!EGIfls2jtkl5tLzTAi5Z2FMHk0spvmg6C7yrpT1atDQ[/URL][/QUOTE]\u003Cbr\u003E\n\u003Cbr\u003E\nIt\u0026#39;s a beautiful thing.\u003Cbr\u003E\n\u003Cbr\u003E\nThere are other things I notice which I can report if you wish, though some of them may not be possible to fix due to the different rendering technique, I think.\u003Cbr\u003E\n\u003Cbr\u003E\nEdit: One in particular is possibly tied to a problem I believe you have mentioned yourself.\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-11-19T02:10:21Z\u0022 title=\u002211/19/2015 02:10  AM\u0022 data-short=\u00228 yr\u0022\u003ENovember 19, 2015\u003C/time\u003E by Manwith Noname\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-11-19T02:08:43Z","Content":"\n[quote name=\u0027Manwith Noname\u0027]It\u0026#39;s a beautiful thing.\u003Cbr\u003E\n\u003Cbr\u003E\nThere are other things I notice which I can report if you wish, though some of them may not be possible to fix due to the different rendering technique, I think.[/QUOTE]\u003Cbr\u003E\n\u003Cbr\u003E\nI\u0026#39;ve noticed what seems like increased pixelation of the edges around terrain, and sometimes they seem to flicker.\n"},{"CreatedByName":"Manwith Noname","CreatedById":117203,"CreatedDateTime":"2015-11-19T02:15:25Z","Content":"\n[quote name=\u0027blackrack\u0027]I\u0026#39;ve noticed what seems like increased pixelation of the edges around terrain, and sometimes they seem to flicker.[/QUOTE]\u003Cbr\u003E\n\u003Cbr\u003E\nYep. I\u0026#39;m going to reboot and run another test but I also seem to see a large rise in CPU usage with the latest files.\n"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-11-19T02:17:02Z","Content":"\n[quote name=\u0027Manwith Noname\u0027]Yep. I\u0026#39;m going to reboot and run another test but I also seem to see a large rise in CPU usage with the latest files.[/QUOTE]\u003Cbr\u003E\n\u003Cbr\u003E\nAre you sure about the CPU usage? I\u0026#39;m using a fairly slow laptop and which almost has one core maxed when running KSP and didn\u0026#39;t see any drops.\n"},{"CreatedByName":"Manwith Noname","CreatedById":117203,"CreatedDateTime":"2015-11-19T02:23:10Z","Content":"\nThat\u0026#39;s why I am going to reboot and kill off some other stuff I\u0026#39;ve been doing. If you look back at some of my pics, the KSC scene shows 17% total usage and about 40% on core 0. In flight this rises to 25% total and 70% single. Just now, I\u0026#39;m fairly sure the KSC scene was showing 60% single core and flight was up to 85-90%.\u003Cbr\u003E\n\u003Cbr\u003E\nLike I said though, need to reboot incase this is other stuff in the background.\n"},{"CreatedByName":"rbray89","CreatedById":48847,"CreatedDateTime":"2015-11-19T02:27:22Z","Content":"\n[quote name=\u0027blackrack\u0027]What do you mean replacing the built-in depth texture? The regular depth buffer?[/QUOTE]\u003Cbr\u003E\n\u003Cbr\u003E\nExactly. I can\u0026#39;t imagine why my cloud particles would fade out like that otherwise (they read the depth buffer for soft-drawing).\n"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-11-19T02:32:55Z","Content":"\n[quote name=\u0027rbray89\u0027]Exactly. I can\u0026#39;t imagine why my cloud particles would fade out like that otherwise (they read the depth buffer for soft-drawing).[/QUOTE]\u003Cbr\u003E\n\u003Cbr\u003E\nI honestly wouldn\u0026#39;t think it would replace the default depth buffer. If it did the results should be the same also since I\u0026#39;m reusing what unity uses to create a depth buffer,just higher precision in OpenGL.\n"},{"CreatedByName":"rbray89","CreatedById":48847,"CreatedDateTime":"2015-11-19T02:43:11Z","Content":"\n[quote name=\u0027blackrack\u0027]I honestly wouldn\u0026#39;t think it would replace the default depth buffer. If it did the results should be the same also since I\u0026#39;m reusing what unity uses to create a depth buffer,just higher precision in OpenGL.[/QUOTE]\u003Cbr\u003E\n\u003Cbr\u003E\nThe only difference was that before, your fixes, the shader was replacing the particles, making them think later that the depth was 0, making them transparent. This is still good news overall for OpenGL.\n"},{"CreatedByName":"Manwith Noname","CreatedById":117203,"CreatedDateTime":"2015-11-19T02:52:02Z","Content":"\nOk, 2 pics of the KSC scene.\u003Cbr\u003E\n\u003Cbr\u003E\n[URL]http://steamcommunity.com/sharedfiles/filedetails/?id=557954876[/URL]\u003Cbr\u003E\n\u003Cbr\u003E\nThis is with the latest files. In reality, this is bouncing between 60-80% on a single core usage.\u003Cbr\u003E\n\u003Cbr\u003E\n[URL]http://steamcommunity.com/sharedfiles/filedetails/?id=557957784[/URL]\u003Cbr\u003E\n\u003Cbr\u003E\nThis second pic is after I deleted scatterer from the install and replaced it along with the files from the fix3.zip, which from memory is before the whole new shader approach. Again, in reality this is bouncing between 35-50% single core usage.\u003Cbr\u003E\n\u003Cbr\u003E\nEdit: Roll on 1.1 and multithreading support ;)\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-11-19T02:54:29Z\u0022 title=\u002211/19/2015 02:54  AM\u0022 data-short=\u00228 yr\u0022\u003ENovember 19, 2015\u003C/time\u003E by Manwith Noname\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-11-19T03:03:15Z","Content":"\n[quote name=\u0027Manwith Noname\u0027]Ok, 2 pics of the KSC scene.\u003Cbr\u003E\n\u003Cbr\u003E\n[URL]http://steamcommunity.com/sharedfiles/filedetails/?id=557954876[/URL]\u003Cbr\u003E\n\u003Cbr\u003E\nThis is with the latest files. In reality, this is bouncing between 60-80% on a single core usage.\u003Cbr\u003E\n\u003Cbr\u003E\n[URL]http://steamcommunity.com/sharedfiles/filedetails/?id=557957784[/URL]\u003Cbr\u003E\n\u003Cbr\u003E\nThis second pic is after I deleted scatterer from the install and replaced it along with the files from the fix3.zip, which from memory is before the whole new shader approach. Again, in reality this is bouncing between 35-50% single core usage.\u003Cbr\u003E\n\u003Cbr\u003E\nEdit: Roll on 1.1 and multithreading support ;)[/QUOTE]\u003Cbr\u003E\n\u003Cbr\u003E\nInteresting. Could you do this comparison again with only scatterer? My reasoning is that if EVE uses the depth buffer, then it\u0026#39;s enabling the default one, and then we have both the default and the scatterer one enabled. I want so see how much more overhead the custom depth buffer is adding by itself, and how much more the two used together cause.\n"},{"CreatedByName":"Manwith Noname","CreatedById":117203,"CreatedDateTime":"2015-11-19T03:06:40Z","Content":"\nWill do, I was going down that route anyway, I got to thinking and removed both EVE and Scatterer...\u003Cbr\u003E\n\u003Cbr\u003E\n[URL]http://steamcommunity.com/sharedfiles/filedetails/?id=557966134[/URL]\u003Cbr\u003E\n\u003Cbr\u003E\nVanilla bounces between 20-40% on a single core.\u003Cbr\u003E\n\u003Cbr\u003E\nEdit:\u003Cbr\u003E\n\u003Cbr\u003E\nJust Scatterer with the latest shaders bounces between 35-55%.\u003Cbr\u003E\n\u003Cbr\u003E\n[url]http://steamcommunity.com/sharedfiles/filedetails/?id=557968982[/url]\u003Cbr\u003E\n\u003Cbr\u003E\nJust Scatterer but with fix3 shaders bounces between 30-50%\u003Cbr\u003E\n\u003Cbr\u003E\n[url]http://steamcommunity.com/sharedfiles/filedetails/?id=557970868[/url]\u003Cbr\u003E\n\u003Cbr\u003E\nInteresting...the plot thickens.\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-11-19T03:19:20Z\u0022 title=\u002211/19/2015 03:19  AM\u0022 data-short=\u00228 yr\u0022\u003ENovember 19, 2015\u003C/time\u003E by Manwith Noname\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"TheGamingNoobster","CreatedById":94887,"CreatedDateTime":"2015-11-19T03:50:45Z","Content":"\nHey guys, when I first installed scatterer, the effects wouldn\u0026#39;t load. I retried several times to no avail... Sorry if this isn\u0026#39;t very helpful... If it means anything, there was still a large amount of lag when loaded.\n"},{"CreatedByName":"HafCoJoe","CreatedById":80363,"CreatedDateTime":"2015-11-19T05:17:34Z","Content":"\n[quote name=\u0027TheGamingNoobster\u0027]Hey guys, when I first installed scatterer, the effects wouldn\u0026#39;t load. I retried several times to no avail... Sorry if this isn\u0026#39;t very helpful... If it means anything, there was still a large amount of lag when loaded.[/QUOTE]\u003Cbr\u003E\n\u003Cbr\u003E\nI had an issue similar to this when I was testing. Could you try flying to the specific locations and seeing if they load or did you try that? The mapview doesn\u0026#39;t load the effects for me last time I checked.\u003Cbr\u003E\n\u003Cbr\u003E\n[B]Also, 2,000th thread post :D[/B]\n"},{"CreatedByName":"selfish_meme","CreatedById":125899,"CreatedDateTime":"2015-11-19T11:45:47Z","Content":"\n[quote name=\u0027blackrack\u0027]\u003Cbr\u003E\nTry this:\u003Cbr\u003E\n\u003Cbr\u003E\n[URL]https://mega.nz/#!ad5QXQKS!fbAn2AMTNT8eUFffR7xJmrHO-4E39EoGCCdFEJhRw74[/URL][/QUOTE]\u003Cbr\u003E\n\u003Cbr\u003E\nThe clouds are the same, but your ice magic froze the world\u003Cbr\u003E\n[IMG]http://i.imgur.com/P2N2sgZ.png[/IMG]\u003Cbr\u003E\n\u003Cbr\u003E\n[COLOR=\u0022silver\u0022][SIZE=1]- - - Updated - - -[/SIZE][/COLOR]\u003Cbr\u003E\n\u003Cbr\u003E\n[quote name=\u0027blackrack\u0027]Hmm, can I have two rendertype tags in the replacement shader? Do I need to copy it in two different subshaders and give them different tags?\u003Cbr\u003E\n\u003Cbr\u003E\nEdited:You already answered this a page ago, multiple subshaders works but multiple tags doesn\u0026#39;t.\u003Cbr\u003E\n\u003Cbr\u003E\n[URL]https://mega.nz/#!idYiECiR!EGIfls2jtkl5tLzTAi5Z2FMHk0spvmg6C7yrpT1atDQ[/URL][/QUOTE]\u003Cbr\u003E\n\u003Cbr\u003E\nThe edges seem softer, but still visible\u003Cbr\u003E\n[IMG]http://i.imgur.com/UjTlQSp.png[/IMG]\u003Cbr\u003E\n\u003Cbr\u003E\n[COLOR=\u0022silver\u0022][SIZE=1]- - - Updated - - -[/SIZE][/COLOR]\u003Cbr\u003E\n\u003Cbr\u003E\nThe load time on scenes seems quicker\n"},{"CreatedByName":"Proot","CreatedById":98932,"CreatedDateTime":"2015-11-19T16:18:52Z","Content":"\nWell, at the end my problem seems not related to EVE in any way (seems two different problems), but I\u0026#39;m still getting the black sky. I\u0026#39;ll try again the process of install the released version to check when and where it falls.\u003Cbr\u003E\nI\u0026#39;ll let you know the results ASP.\n"},{"CreatedByName":"Cbigclouds","CreatedById":153847,"CreatedDateTime":"2015-11-20T01:44:22Z","Content":"\n[quote name=\u0027Proot\u0027]Well, at the end my problem seems not related to EVE in any way (seems two different problems), but I\u0026#39;m still getting the black sky. I\u0026#39;ll try again the process of install the released version to check when and where it falls.\u003Cbr\u003E\nI\u0026#39;ll let you know the results ASP.[/QUOTE]\u003Cbr\u003E\n\u003Cbr\u003E\nI had the same problem with black sky. was installing mods 1 by 1. scatterer worked until i installed outer planets mod. all mods installed via ckan. (collisionfx, mechjeb, distant object enhancement(defaultcfg), smokescreen, mod manager, ksp players.) just -nopopupwindow as an extension via steam.\n"},{"CreatedByName":"Proot","CreatedById":98932,"CreatedDateTime":"2015-11-20T02:33:27Z","Content":"\nOk, I\u0026#39;m still having the same issue, with all the fixes, in DX and openGL.\u003Cbr\u003E\nThe log spams:\u003Cbr\u003E\n\u003Cbr\u003E\n[CODE][LOG 03:03:12.092] scatterer effects loaded for Kerbin\u003Cbr\u003E\n[EXC 03:03:12.277] NullReferenceException: Object reference not set to an instance of an object\u003Cbr\u003E\nscatterer.SkyNode.toggleCoronas ()\u003Cbr\u003E\nscatterer.SkyNode.UpdateNode ()\u003Cbr\u003E\nscatterer.Manager.Update ()\u003Cbr\u003E\nscatterer.Core.Update ()[/CODE]\u003Cbr\u003E\n\u003Cbr\u003E\nIf I go to map view at the return the scarreting seems to be up again, but looks weird. Like overexposed, and the edge of the horizon is not properly blended, like in the first versions.\u003Cbr\u003E\nAlso, the tint feature seems completely gone in the map view, so all looks pretty bluish.\u003Cbr\u003E\n\u003Cbr\u003E\nIf you need more info, the full logs or anything else just tell me. ;)\n"},{"CreatedByName":"tkw","CreatedById":142638,"CreatedDateTime":"2015-11-20T02:43:11Z","Content":"\nit need fix this mod now\n"},{"CreatedByName":"Manwith Noname","CreatedById":117203,"CreatedDateTime":"2015-11-20T04:46:15Z","Content":"\nI just don\u0026#39;t get it. I haven\u0026#39;t had much time tonight to KSP but I just thought I\u0026#39;d run it to check if I get the same errors as Proot and Nhawks, which I\u0026#39;m not. My logs are completely clear of [EXC], with the \u0022exception\u0022 (see what I did there) of Steam controller reports when I quit out of the game. Also, all [WRN] and [ERR] flags point to Squad issues (colliders needing rigid body\u0026#39;s, too many polygons....and why the hell is a Stock craft spitting all kinds of missing modules at me !mechjeb!...who\u0026#39;s building stock craft with mechjeb, hmmm...I digress).\u003Cbr\u003E\n\u003Cbr\u003E\nThe only warning I see that appears to relate to Scatterer is when using the fix3.zip files which tells me I can\u0026#39;t use HDR and MSAA in forward rendering and so HDR is disabled. If I want to use HDR disable MSAA in the options...or something. Last log I have is with the deferred shaders and don\u0026#39;t show that so I can\u0026#39;t copy and paste...should have thought of that.\u003Cbr\u003E\n\u003Cbr\u003E\nAnyway, I\u0026#39;ll post this pic just incase this has never been observed before...\u003Cbr\u003E\n\u003Cbr\u003E\n[URL]http://steamcommunity.com/sharedfiles/filedetails/?id=558582811[/URL]\u003Cbr\u003E\n\u003Cbr\u003E\nIt appears with both the old (fix3.zip) and new (anotherone.zip) methods.\u003Cbr\u003E\n\u003Cbr\u003E\n*walks away scratching his head*\u003Cbr\u003E\n\u003Cbr\u003E\nEdit: Oh, Blackrack, just in case you didn\u0026#39;t spot my edit on the last page, CPU usage change is negligible with just Scatterer in place. It\u0026#39;s there but a lot less than when EVE is present.\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-11-20T04:52:21Z\u0022 title=\u002211/20/2015 04:52  AM\u0022 data-short=\u00228 yr\u0022\u003ENovember 20, 2015\u003C/time\u003E by Manwith Noname\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Manwith Noname","CreatedById":117203,"CreatedDateTime":"2015-11-20T05:27:24Z","Content":"\nOk, I would edit my post but this might be important for anyone who understands all this and may have checked in since I posted the above.\u003Cbr\u003E\n\u003Cbr\u003E\nBlack sky is caused by Kopernicus.\u003Cbr\u003E\n\u003Cbr\u003E\nI tried this because Proot and Nhawks are both making beautification packs that bring all the wonderful visual candy together. I missed CBigclouds comment in amongst the others until just now. When they mentioned OPM, I realised Kopernicus is the link.\u003Cbr\u003E\n\u003Cbr\u003E\nEdit: So to clarify, I threw Kopernicus in my install and my sky went black. I also get the same exceptions mentioned above.\u003Cbr\u003E\n\u003Cbr\u003E\nRe wording: Kopernicus with Scatterer makes the sky go black.\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-11-20T05:33:42Z\u0022 title=\u002211/20/2015 05:33  AM\u0022 data-short=\u00228 yr\u0022\u003ENovember 20, 2015\u003C/time\u003E by Manwith Noname\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Bizz Keryear","CreatedById":68896,"CreatedDateTime":"2015-11-20T11:13:39Z","Content":"\n[quote name=\u0027blackrack\u0027]The sunglare textures are the only repeating things and they\u0026#39;re mostly insignificant, a 512x512 texture is nothing, and they\u0026#39;re only loaded if their associated planet is loaded so at worst you see slightly more memory usage when both Laythe and Jool are loaded, for the rest it\u0026#39;s the same. The black texture could also be removed. Both of these points are so insignificant memory-wise and the current sunglare system is only temporary anyway so I haven\u0026#39;t bothered changing them.[/QUOTE]\u003Cbr\u003E\n\u003Cbr\u003E\nYeah, but what about the black one ... and it might be because of a long distance view mod I have installed there might be all planets loaded anyway\n"},{"CreatedByName":"selfish_meme","CreatedById":125899,"CreatedDateTime":"2015-11-20T11:44:16Z","Content":"\n[quote name=\u0027Manwith Noname\u0027]Ok, I would edit my post but this might be important for anyone who understands all this and may have checked in since I posted the above.\u003Cbr\u003E\n\u003Cbr\u003E\nBlack sky is caused by Kopernicus.\u003Cbr\u003E\n\u003Cbr\u003E\nI tried this because Proot and Nhawks are both making beautification packs that bring all the wonderful visual candy together. I missed CBigclouds comment in amongst the others until just now. When they mentioned OPM, I realised Kopernicus is the link.\u003Cbr\u003E\n\u003Cbr\u003E\nEdit: So to clarify, I threw Kopernicus in my install and my sky went black. I also get the same exceptions mentioned above.\u003Cbr\u003E\n\u003Cbr\u003E\nRe wording: Kopernicus with Scatterer makes the sky go black.[/QUOTE]\u003Cbr\u003E\n\u003Cbr\u003E\nI didn\u0026#39;t load Kopernicus because of the bouyancy issue which explains why I never got the black skies.\n"}]}