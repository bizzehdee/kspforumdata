{"TopicId":162200,"ForumId":36,"TopicTitle":"[WIP][1.8.1, 1.9.1, 1.10.1, 1.11.0\u20132, 1.12.2\u20135] Principia\u2014version \u200E\u200EKleene, released 2024-07-05\u2014n-Body and Extended Body Gravitation","CreatedByName":"eggrobin","CreatedById":4680,"CreatedDateTime":"2014-02-05T00:19:35Z","PageNum":3,"Articles":[{"CreatedByName":"eggrobin","CreatedById":4680,"CreatedDateTime":"2014-02-06T16:34:55Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022asmi\u0022 data-cite=\u0022asmi\u0022\u003E\u003Cdiv\u003EThat might not work for performance reasons. The best I\u0027ve managed to get 100k steps of RK5(4) executed is in about 1 second if my memory serves me - that it\u0027s on powerful i7 3930K CPU with significant portions of code written manually on SSE2/3 intrinsics (=assembly). \u003Cp\u003EAnd in your case it will have to be done \u003Cstrong\u003Ein addition\u003C/strong\u003E to regular updates calculations. You could probably run it for t and (t\u002Bdt) in parallel on separate cores if you write the code carefully not to use any shared state, but experience with my mod (which is heavily parallel and extensively uses all available cores) indicates that there are enough users here with relatively weak 2-core or even 1-core CPUs.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ETo clarify:\u003C/p\u003E\u003Cp\u003EThe main integration currently uses a pretty dumb 5th order SPRK (it has 6 RHS evaluations per step); as it is written in C# it\u0027s about an order of magnitude slower than yours (do you use Dormand-Prince, Cash-Karp, Fehlberg, or something else? RK5(4) is a rather ambiguous name. Also, what is the dimension of your system? Most of the time is spent computing the RHS anyway, so your mileage may vary quite a bit depending on the specifics of the problem). I intend to switch to an integrator designed for \u003Cem\u003EN\u003C/em\u003E-body gravitation, which should allow me to run 1_000_000x timewarp easily.\u003C/p\u003E\u003Cp\u003EThe trajectories \u003Cstrong\u003Eferram4\u003C/strong\u003E was talking about are those from the \u003Cem\u003Edynamic\u003C/em\u003E integration (I haven\u0027t found a better name, see the \u0027terminology\u0027 section). Those will only be computed while the active vessel is under thrust (not counting the ion engine stuff, which I\u0027ll have to handle differently), so out of timewarp. When out of timewarp, the main integration has negligible performance cost (recall that this is the same integration that we have to be able to run at 1_000_000x; even with my current SPRK, this is virtually free outside timewarp).\u003C/p\u003E\u003Cp\u003ERough estimates for the performance cost of the \u003Cem\u003Edynamic\u003C/em\u003E integration over 10 years yield something on the order of 50 ms: use 10 days as a timestep, which may sound crazy, but look at the timesteps in (Chambers 1999), assume only 10_000 steps per second, which is probably pessimistic. Even if I have to double that to show two trajectories, I can just update the predictions every couple of physics update, or make them shorter, or, as \u003Cstrong\u003Eferram4\u003C/strong\u003E said, make one with extrapolated initial conditions less precise.\u003C/p\u003E\n"},{"CreatedByName":"eggrobin","CreatedById":4680,"CreatedDateTime":"2014-02-06T16:51:14Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Faark\u0022 data-cite=\u0022Faark\u0022\u003E\u003Cdiv\u003EWell, its an \u003Ca href=\u0022https://connect.microsoft.com/VisualStudio/feedback/details/780602/compiling-c-clr-dll-in-vs-2012-targeting-net-2-0-introduces-indirect-dependency-on-net-4-0#tabs\u0022 rel=\u0022external nofollow\u0022\u003Eofficial statement from MS regarding cli/c\u002B\u002B assemblies on vs2010\u002B that target \u0026lt;net4\u003C/a\u003E, so you might want to check out your assembly in ILSpy or sth similar. You will most likely find a \u0022Runtime: .NET 4.0\u0022 and reference of mscorlib and System.dll to both version 2.0 and 4.0, like this:\u003Cp\u003E\u003Ca href=\u0022http://i.imgur.com/NlnyuD7.png?1\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://i.imgur.com/NlnyuD7.png?1\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EOfc that might not be a problem and Unity-Mono simply ignores those references to non-existent librarys... until you accidentally use any feature that requires .NET 4.0 and you just don\u0027t get whats wrong, especially since it compiles just fine. Thats the same reason we frequently tell newer modders to target a framework lower than 4.0 that is more compatible with Ksp\u0027s Unity-Mono.\u003C/p\u003E\u003Cp\u003EI found about about those CLI/C\u002B\u002B limitation when i tried to use my library in a C# project that properly targeted a pure .NET 2 runtime. But hey, if it works for you, no one will force you to change anything. And in case you experience \u0022crazy\u0022 issues you now know an additional possible source.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EKSP\u0027s Assembly-CSharp already targets the .NET framework version 4.5 (and so do I), so I\u0027m not sure why this should be a problem...\u003C/p\u003E\n"},{"CreatedByName":"thorfinn","CreatedById":8349,"CreatedDateTime":"2014-02-06T18:00:44Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003E\u003Cspan style=\u0022color:#333333;\u0022\u003EThe thing is, once you get used to how they work, 2-body orbital mechanics are pretty simple. This will hopefully provide an interesting challenge and new possibilities, while not fundamentally changing most of the game.\u003C/span\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI guess we\u0027ll know how hard it becomes when we get there (I\u0027m still a bit scared, but after all satellites moving around would be a really big problem only for Remotetech, true.) \u003C/p\u003E\u003Cp\u003EBut if you ever got to this:\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003EGravitational moment (quadrupole) for planets, enabling such amusing things as Sun-synchronous orbits\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI would be \u003Cstrong\u003Every\u003C/strong\u003E curious to see what orbits would look like around a realistic \u003Ca href=\u0022https://en.wikipedia.org/wiki/Haumea_(dwarf_planet)\u0022 rel=\u0022external nofollow\u0022\u003EHaumea\u003C/a\u003E\u003C/p\u003E\n"},{"CreatedByName":"asmi","CreatedById":59068,"CreatedDateTime":"2014-02-06T18:04:30Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022eggrobin\u0022 data-cite=\u0022eggrobin\u0022\u003E\u003Cdiv\u003EThe main integration currently uses a pretty dumb 5th order SPRK (it has 6 RHS evaluations per step); as it is written in C# it\u0027s about an order of magnitude slower than yours (do you use Dormand-Prince, Cash-Karp, Fehlberg, or something else? RK5(4) is a rather ambiguous name. Also, what is the dimension of your system? Most of the time is spent computing the RHS anyway, so your mileage may vary quite a bit depending on the specifics of the problem). I intend to switch to an integrator designed for \u003Cem\u003EN\u003C/em\u003E-body gravitation, which should allow me to run 1_000_000x timewarp easily.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI used code for algorithm from that post as baseline: \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/49121-On-Newtonian-trajectories-vs-patched-conics\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://forum.kerbalspaceprogram.com/threads/49121-On-Newtonian-trajectories-vs-patched-conics\u003C/a\u003E and that post for more detailed description: \u003Ca href=\u0022http://www.roesle.org/cms25/index.php/projects/81-general/95-on-newtonian-trajectories-in-kerbal-space-program\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://www.roesle.org/cms25/index.php/projects/81-general/95-on-newtonian-trajectories-in-kerbal-space-program\u003C/a\u003E The code uses Dormand and Prince\u0027s Runge Kutta RK5(4)7M. It uses adaptive time step and also provides coefficients for fifth order interpolation. The idea was to precalculate trajectory to set amount of steps ahead, and use these points and interpolation to actually move spacecraft. This way we would only need to recalculate the whole trajectory is there is some sort of dynamic event (like applying the thrust, or entering atmosphere). It provided pretty good accuracy, and would be relatively cheap since you could calculate additional data points in the background. Unfortunately due to spare time constraints I never got to the point of getting it into KSP, but was focusing on profiling algorithm\u0027s performance and used simple WinForms app for ease of testing. If you\u0027re interested I could try to dig out that code and send it to you. Oh, and I used whole KSP celestials (orbital and physical data is taken from wiki).\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022eggrobin\u0022 data-cite=\u0022eggrobin\u0022\u003E\u003Cdiv\u003EThe trajectories \u003Cstrong\u003Eferram4\u003C/strong\u003E was talking about are those from the \u003Cem\u003Edynamic\u003C/em\u003E integration (I haven\u0027t found a better name, see the \u0027terminology\u0027 section). Those will only be computed while the active vessel is under thrust (not counting the ion engine stuff, which I\u0027ll have to handle differently), so out of timewarp. When out of timewarp, the main integration has negligible performance cost (recall that this is the same integration that we have to be able to run at 1_000_000x; even with my current SPRK, this is virtually free outside timewarp).\u003Cp\u003ERough estimates for the performance cost of the \u003Cem\u003Edynamic\u003C/em\u003E integration over 10 years yield something on the order of 50 ms: use 10 days as a timestep, which may sound crazy, but look at the timesteps in (Chambers 1999), assume only 10_000 steps per second, which is probably pessimistic. Even if I have to double that to show two trajectories, I can just update the predictions every couple of physics update, or make them shorter, or, as \u003Cstrong\u003Eferram4\u003C/strong\u003E said, make one with extrapolated initial conditions less precise.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ETime step have to be adaptive, as sometimes even 10s is too much, while in other cases 10 days is OK. And why ion engines are so special? There are plenty of other low-thrust engines, besides it\u0027s not the thrust is what\u0027s matters, but acceleration they can provide.\u003C/p\u003E\n"},{"CreatedByName":"thorfinn","CreatedById":8349,"CreatedDateTime":"2014-02-06T18:13:28Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022asmi\u0022 data-cite=\u0022asmi\u0022\u003E\u003Cdiv\u003E And why ion engines are so special?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EFor very low thrust engines (\u0022ion\u0022 is what we have in stock now in that class) you\u0027d want to be able to apply thrust during high timewarp, so craft physics will be off and you\u0027d have to have some replacement simplified model to apply thrust to, decrease mass et cetera. I guess you would have to handwave thrust offsets and things like that.\u003C/p\u003E\u003Cp\u003EI suppose there would be an acceleration cutoff somewhere low (0.01G?) below which your ship is considered \u0022ion class\u0022 and can thrust during high warp.\u003C/p\u003E\n"},{"CreatedByName":"eggrobin","CreatedById":4680,"CreatedDateTime":"2014-02-06T18:48:38Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022asmi\u0022 data-cite=\u0022asmi\u0022\u003E\u003Cdiv\u003E\u003Cp\u003ETime step have to be adaptive\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI used to think that too. It\u0027s more complicated. It\u0027s always more complicated. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EIn this case we care about symplecticity, and adaptive timesteps kill symplecticity. See the quote from Chambers in the OP. You can however have different timesteps for different bodies, as long as each timestep divides the next one (Saha and Tremaine 1994). Chambers has a form of adaptive timestep (it\u0027s more of a dual-method thing), but it\u0027s far more complicated than the usual business either looking at convergence or using an embedded method like Dormand-Prince. All these \u0027smarter\u0027 integrators use the Keplerian approximation to some extent to allow for longer timesteps, so it\u0027s not your average RK or SPRK method.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003EAnd why ion engines are so special? There are plenty of other low-thrust engines, besides it\u0027s not the thrust is what\u0027s matters, but acceleration they can provide.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EIon engines are not special. I was referring to low-acceleration long duration planned burns, in contrast with the real-time burns we currently have. That\u0027s a pretty bad misnomer though, I guess I\u0027ll call these \u003Cem\u003Elong-duration burns\u003C/em\u003E from now on (unless you can find a better name).\u003C/p\u003E\u003Cp\u003EEDIT:\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022asmi\u0022 data-cite=\u0022asmi\u0022\u003E\u003Cdiv\u003EI used code for algorithm from that post as baseline: \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/49121-On-Newtonian-trajectories-vs-patched-conics\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://forum.kerbalspaceprogram.com/threads/49121-On-Newtonian-trajectories-vs-patched-conics\u003C/a\u003E and that post for more detailed description: \u003Ca href=\u0022http://www.roesle.org/cms25/index.php/projects/81-general/95-on-newtonian-trajectories-in-kerbal-space-program\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://www.roesle.org/cms25/index.php/projects/81-general/95-on-newtonian-trajectories-in-kerbal-space-program\u003C/a\u003E The code uses Dormand and Prince\u0027s Runge Kutta RK5(4)7M. It uses adaptive time step and also provides coefficients for fifth order interpolation.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EOh, that\u0027s Matt Roesle (\u003Cstrong\u003EMattasmack\u003C/strong\u003E)! He\u0027s done some interesting work on \u003Cem\u003EN\u003C/em\u003E-body simulations in KSP (see the acknowledgements), but his choice of integrator is suboptimal. A symplectic one is much better (and one specifically developed for the gravitational \u003Cem\u003EN\u003C/em\u003E-body problem would be leaps and bounds above that).\u003C/p\u003E\u003Cp\u003EEDIT2: Actually, the fact that he doesn\u0027t use compensated summation is \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/63536-0-23-Alternis-Kerbol-Release-thread-v0-1-Jan-3-New-version-cloud-update?p=892251\u0026amp;viewfull=1#post892251\u0022 rel=\u0022external nofollow\u0022\u003Emore critical\u003C/a\u003E than the lack of symplecticity. This would be easy to add though.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-02-06T19:53:02Z\u0022 title=\u002202/06/2014 07:53  PM\u0022 data-short=\u002210 yr\u0022\u003EFebruary 6, 2014\u003C/time\u003E by eggrobin\u003C/strong\u003E\n\u003Cbr\u003EClose parenthesis.\n\u003C/span\u003E\n"},{"CreatedByName":"BubbaWilkins","CreatedById":57993,"CreatedDateTime":"2014-02-06T19:07:42Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022eggrobin\u0022 data-cite=\u0022eggrobin\u0022\u003E\u003Cdiv\u003EI used to think that too. It\u0027s more complicated. It\u0027s always more complicated. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003Cp\u003EIn this case we care about symplecticity, and adaptive timesteps kill symplecticity. See the quote from Chambers in the OP. You can however have different timesteps for different bodies, as long as each timestep divides the next one (Saha and Tremaine 1994). Chambers has a form of adaptive timestep (it\u0027s more of a dual-method thing), but it\u0027s far more complicated than the usual business either looking at convergence or using an embedded method like Dormand-Prince. All these \u0027smarter\u0027 integrators use the Keplerian approximation to some extent to allow for longer timesteps, so it\u0027s not your average RK or SPRK method.\u003C/p\u003E\u003Cp\u003EIon engines are not special. I was referring to low-acceleration long duration planned burns, in contrast with the real-time burns we currently have. That\u0027s a pretty bad misnomer though, I guess I\u0027ll call these \u003Cem\u003Elong-duration burns\u003C/em\u003E from now on (unless you can find a better name.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI expected you to trot out Cappa Fero, but seeing as Thibault cancels that out unless you\u0027ve studied Itsa Glippa, we\u0027ll stick with Bonetti\u0027s defense.\u003C/p\u003E\u003Cp\u003EI suppose you aren\u0027t left handed either.\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EIn all seriousness, this is a very ambitious project. I look forward to see it\u0027s development progress.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-02-06T19:13:54Z\u0022 title=\u002202/06/2014 07:13  PM\u0022 data-short=\u002210 yr\u0022\u003EFebruary 6, 2014\u003C/time\u003E by BubbaWilkins\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Bluekommeh","CreatedById":34045,"CreatedDateTime":"2014-02-06T19:13:44Z","Content":"\n\u003Cp\u003E\u0022We cant do N-Bodies, they would fry your computer :^)\u0022 -Squad, 2011\u003C/p\u003E\u003Cp\u003EMods will blow Squead into bankruptcy.\u003C/p\u003E\n"},{"CreatedByName":"eggrobin","CreatedById":4680,"CreatedDateTime":"2014-02-06T19:32:04Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Bluekommeh\u0022 data-cite=\u0022Bluekommeh\u0022\u003E\u003Cdiv\u003EMods will blow Squead into bankruptcy.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI hope not, there wouldn\u0027t be anything left to mod... \u003C/p\u003E\u003Cp\u003EMods only make the game more attractive if anything, so I think we\u0027re safe though.\u003C/p\u003E\u003Cp\u003ESquad\u0027s attitude on this particular matter is understandable, as this is really hard to do right, and the Keplerian approximation is mostly pretty good. Stock aerodynamics are harder to justify...\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-02-06T20:17:16Z\u0022 title=\u002202/06/2014 08:17  PM\u0022 data-short=\u002210 yr\u0022\u003EFebruary 6, 2014\u003C/time\u003E by eggrobin\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"eggrobin","CreatedById":4680,"CreatedDateTime":"2014-02-06T19:54:55Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022BubbaWilkins\u0022 data-cite=\u0022BubbaWilkins\u0022\u003E\u003Cdiv\u003EItsa Glippa\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EFrom the fencing context, I\u0027m pretty sure this should read \u0027Camillo Agrippa\u0027.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003ECappa Fero\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ECapo Ferro?\u003C/p\u003E\n"},{"CreatedByName":"lincourtl","CreatedById":72218,"CreatedDateTime":"2014-02-06T19:55:17Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Bluekommeh\u0022 data-cite=\u0022Bluekommeh\u0022\u003E\u003Cdiv\u003E\u0022We cant do N-Bodies, they would fry your computer :^)\u0022 -Squad, 2011\u003Cp\u003EMods will blow Squead into bankruptcy.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ETo the contrary, mods are great for showing Squad how to do things they might not thought possible. All they have to do is to continue supporting a robust modding community, assimilate the mods that add the most to the game, and they\u0027re fine. I can understand Squad\u0027s objections to n-body orbital mechanics on a pure game-play basis though. I don\u0027t think most people would find that fun. For those of us who do want that added realism, there\u0027s always the mods. \u003C/p\u003E\u003Cp\u003EBut yeah, the aerodynamics issue is much less defensible. Similarly, I\u0027d like to see realistic reentry heating, axial tilt, magnetary fields, and radiation belts in the stock game. I\u0027m not going to cry into my Cheerios if that never happens though.\u003C/p\u003E\n"},{"CreatedByName":"BubbaWilkins","CreatedById":57993,"CreatedDateTime":"2014-02-06T20:37:07Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022eggrobin\u0022 data-cite=\u0022eggrobin\u0022\u003E\u003Cdiv\u003EFrom the fencing context, I\u0027m pretty sure this should read \u0027Camillo Agrippa\u0027.\u003Cp\u003ECapo Ferro?\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ECorrect on both accounts, however I was actually referencing the Princess Bride duel scene. Apparently the site I used to look it up had most of it spelled wrong. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"eggrobin","CreatedById":4680,"CreatedDateTime":"2014-02-06T20:38:25Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022ferram4\u0022 data-cite=\u0022ferram4\u0022\u003E\u003Cdiv\u003E\u003Cp\u003EAre you setting it in Update or FixedUpdate? Make sure you use the former, I\u0027ve seen effects lagging behind when using FixedUpdate. If that\u0027s not it, try seeing if you can do things in localSpace.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI tried setting them in Update(), they still lag.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022lincourtl\u0022 data-cite=\u0022lincourtl\u0022\u003E\u003Cdiv\u003Eaxial tilt\u003C/div\u003E\u003C/blockquote\u003EThis would be really nice. I\u0027m not sure I can find a way to mod it in, and if I cannot, conservation of angular momentum for planets is lost. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_sad.gif\u0022 alt=\u0022:(\u0022\u003E\u003Cp\u003EI\u0027ll add it to the open questions.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-02-06T20:41:16Z\u0022 title=\u002202/06/2014 08:41  PM\u0022 data-short=\u002210 yr\u0022\u003EFebruary 6, 2014\u003C/time\u003E by eggrobin\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"jxi24","CreatedById":102030,"CreatedDateTime":"2014-02-06T21:11:38Z","Content":"\n\u003Cp\u003EI have a clarification question. When for example calculating the N-body dynamics how are you handling the effects of for example the moons around Jool, effecting the orbits of other bodies in the system?\u003C/p\u003E\u003Cp\u003EI know that the way large scale simulations for the galaxy are done at the research level is to subdivide the universe into regions, and in places where there is a lot of matter the grids are smaller and done with more accuracy.\u003C/p\u003E\u003Cp\u003EFor example, to simplify the number of calculations you need to preform, are you going to take the sum of Jool and it\u0027s moons and treat it as a point source to calculate the effects on the orbits of things far away from Jool, and then near Jool do more detailed calculations for the moons orbits?\u003C/p\u003E\n"},{"CreatedByName":"eggrobin","CreatedById":4680,"CreatedDateTime":"2014-02-06T21:27:24Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022jxi24\u0022 data-cite=\u0022jxi24\u0022\u003E\u003Cdiv\u003EI have a clarification question. When for example calculating the N-body dynamics how are you handling the effects of for example the moons around Jool, effecting the orbits of other bodies in the system?\u003Cp\u003EI know that the way large scale simulations for the galaxy are done at the research level is to subdivide the universe into regions, and in places where there is a lot of matter the grids are smaller and done with more accuracy.\u003C/p\u003E\u003Cp\u003EFor example, to simplify the number of calculations you need to preform, are you going to take the sum of Jool and it\u0027s moons and treat it as a point source to calculate the effects on the orbits of things far away from Jool, and then near Jool do more detailed calculations for the moons orbits?\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ENo, for the moment this is truly \u003Cem\u003EN\u003C/em\u003E-body. The answer is a bit more complicated once I start using integrators specifically designed for this problem (see Saha \u0026amp; Tremaine 1994), but mostly it will remain truly \u003Cem\u003EN\u003C/em\u003E-body (it\u0027s just that the Sun\u0027s influence will get special treatment).\u003C/p\u003E\u003Cp\u003EBear in mind the number of massive bodies is very small (17 in stock, conceivably ~50 if somebody decides to add lots of planets and moons; if I need to manage stuff like asteroids or rings I might want to try to be smarter, but the Saha \u0026amp; Tremaine integrator should be pretty good even for that).\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-02-06T21:31:07Z\u0022 title=\u002202/06/2014 09:31  PM\u0022 data-short=\u002210 yr\u0022\u003EFebruary 6, 2014\u003C/time\u003E by eggrobin\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Guest","CreatedById":-1,"CreatedDateTime":"2014-02-06T21:40:18Z","Content":"\n\u003Cp\u003EHow will the amount of non-massive bodies impact performance? People have launched quite a lot ships in a single save, I imagine this could easily hit 100 for some.\u003C/p\u003E\n"},{"CreatedByName":"asmi","CreatedById":59068,"CreatedDateTime":"2014-02-06T22:09:42Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Dragon01\u0022 data-cite=\u0022Dragon01\u0022\u003E\u003Cdiv\u003EHow will the amount of non-massive bodies impact performance? People have launched quite a lot ships in a single save, I imagine this could easily hit 100 for some.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EIf it\u0027s going to be \u003Cstrong\u003Etrue\u003C/strong\u003E N-body, than the more stuff is in space, the slower performance would be. In practice it\u0027s quite common to cut off bodies that will have negligible impact on trajectory. But that would allow you some very cool stuff like putting a satellite around your huge space station \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"eggrobin","CreatedById":4680,"CreatedDateTime":"2014-02-06T22:10:48Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Dragon01\u0022 data-cite=\u0022Dragon01\u0022\u003E\u003Cdiv\u003EHow will the amount of non-massive bodies impact performance? People have launched quite a lot ships in a single save, I imagine this could easily hit 100 for some.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThe main cost is the RHS computation. If the \u003Cem\u003EB\u003C/em\u003E massive bodies exert forces on the \u003Cem\u003EB\u003C/em\u003E \u002B \u003Cem\u003EV\u003C/em\u003E bodies, the cost of the RHS computation is proportional to \u003Cem\u003EB\u003C/em\u003E(\u003Cem\u003EB\u003C/em\u003E \u002B \u003Cem\u003EV\u003C/em\u003E), so asymptotically linear in \u003Cem\u003EV\u003C/em\u003E and quadratic in \u003Cem\u003EB\u003C/em\u003E.\u003C/p\u003E\u003Cp\u003EFrom the OP:\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022me\u0022 data-cite=\u0022me\u0022\u003E\u003Cdiv\u003E\u003Cp\u003ENear-unit-roundoff (using IEEE 754 binary64) errors can be achieved while sustaining 100_000x timewarp with B = 17, V \u0026lt; 5. Handwavy asymptotic calculations indicate that for V = 100, this integrator would slow down to about 20_000x timewarp. Using better integrators (and saner tolerances), performance could easily be increased by a couple of orders of magnitude, making the simulation usable for RSS as well as stock.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI\u0027ll only know once I have implemented it, but I think even 10_000_000x with \u003Cem\u003EB\u003C/em\u003E = 20, \u003Cem\u003EV\u003C/em\u003E = 100 should easily be feasible (see Chambers 1999 for the sort of timesteps I\u0027ll be able to use with better integrators and my answer to \u003Cstrong\u003Easmi\u003C/strong\u003E \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/68502-WIP-Principia-N-Body-Gravitation-and-Better-Integrators-for-Kerbal-Space-Program?p=953262\u0026amp;viewfull=1#post953262\u0022 rel=\u0022external nofollow\u0022\u003Eon post #51 of this thread\u003C/a\u003E for very rough estimates of the speed for a single vessel).\u003C/p\u003E\n"},{"CreatedByName":"Spartwo","CreatedById":58131,"CreatedDateTime":"2014-02-06T22:17:22Z","Content":"\n\u003Cp\u003EI thought Unity couldn\u0027t support N-body physics.My mod list is getting longer and longer.\u003C/p\u003E\n"},{"CreatedByName":"eggrobin","CreatedById":4680,"CreatedDateTime":"2014-02-06T22:21:41Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022asmi\u0022 data-cite=\u0022asmi\u0022\u003E\u003Cdiv\u003EIf it\u0027s going to be \u003Cstrong\u003Etrue\u003C/strong\u003E N-body, than the more stuff is in space, the slower performance would be.\u003C/div\u003E\u003C/blockquote\u003E \u003Cp\u003EIt still gets slower, it\u0027s just a question of linear vs. quadratic, see my reply to \u003Cstrong\u003EDragon01\u003C/strong\u003E.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003EIn practice it\u0027s quite common to cut off bodies that will have negligible impact on trajectory. But that would allow you some very cool stuff like putting a satellite around your huge space station \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EOk, I forgot to mention that. The \u003Cem\u003EV\u003C/em\u003E I define in the OP is not supposed to be 0, it stands for \u0027vessel\u0027. Maybe I\u0027ll add an option for massive vessels, but my current integrator definitely can\u0027t handle that. Maybe the Saha \u0026amp; Tremaine one can.\u003C/p\u003E\n"},{"CreatedByName":"eggrobin","CreatedById":4680,"CreatedDateTime":"2014-02-06T22:34:17Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Spartwo\u0022 data-cite=\u0022Spartwo\u0022\u003E\u003Cdiv\u003EI thought Unity couldn\u0027t support N-body physics.My mod list is getting longer and longer.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYou might be confused.\u003C/p\u003E\u003Cp\u003EUnity doesn\u0027t support 2-body orbital mechanics, nor does it support large distances or velocities (for some mindbogglingly stupid reason it uses single-precision floating point), rotating ground, \u0026amp;c.\u003C/p\u003E\u003Cp\u003E KSP handles the orbit propagation, the floating origin stuff, the rotating reference frames \u0026amp;c. so that Unity can do the small amount of physics it can handle---such as (badly) managing collisions, joints, and various other forces.\u003C/p\u003E\u003Cp\u003EWhat this mod will do is handle orbit propagation in a different way (using an integrator, rather than using the 2-body approximation).\u003C/p\u003E\n"},{"CreatedByName":"thorfinn","CreatedById":8349,"CreatedDateTime":"2014-02-06T23:28:54Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003E\u003Cspan style=\u0022color:#333333;\u0022\u003Efor some mindbogglingly stupid reason it uses single-precision floating point\u003C/span\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EWell, almost nobody has the requirements of KSP, and it\u0027s a budget game engine at that.\u003C/p\u003E\n"},{"CreatedByName":"eggrobin","CreatedById":4680,"CreatedDateTime":"2014-02-06T23:58:23Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022thorfinn\u0022 data-cite=\u0022thorfinn\u0022\u003E\u003Cdiv\u003EWell, almost nobody has the requirements of KSP, and it\u0027s a budget game engine at that.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ENevertheless, single precision floating point is almost always a bad idea. On x87 FPUs it\u0027s slower, and unless your code happens to be highly vectorisable the performance improvement with SSE2/3 is negligible (it\u0027s not going to be more than twice as fast anyway, even if everything can be vectorised). Memory usage concerns from physics are not an issue when you have stuff like textures to worry about.\u003C/p\u003E\u003Cp\u003EAnyway,\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022me\u0022 data-cite=\u0022me\u0022\u003E\u003Cdiv\u003E\u003Cp\u003EThe method I currently use for drawing trajectories (LineRenderers, object in layer 9, transform.parent = null, useWorldSpace=true, updated every time the GUI is drawn) has some issues: when rotating the camera in map mode, the lines lag behind. Does this have a known solution? (I guess so, RT2 doesn\u0027t have this problem).\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI\u0027m mostly clueless as far as this is concerned. So far I have tried putting the object in layer 31 as \u003Cstrong\u003ECilph\u003C/strong\u003E does, drawing the trajectories at the same time as the GUI, in Update, in OnPreCull (again from the RT2 code). Nothing changes. I\u0027ll try making a dedicated renderer class and adding it as a component of MapView.MapCamera.gameObject like \u003Cstrong\u003ECilph\u003C/strong\u003E, since his code works (and he seems to have a clue about how Unity works).\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-02-07T00:22:12Z\u0022 title=\u002202/07/2014 12:22  AM\u0022 data-short=\u002210 yr\u0022\u003EFebruary 7, 2014\u003C/time\u003E by eggrobin\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"J.Random","CreatedById":63332,"CreatedDateTime":"2014-02-07T00:49:51Z","Content":"\n\u003Cp\u003EIf this thing works, if it works fast enough, and/or if you manage to spread the processing load on multicore systems, I will want to pay for such mod. Because that\u0027s going to be an incredible, astonishing improvement for KSP, and it deserves the support.\u003C/p\u003E\n"},{"CreatedByName":"FanaticalFighter","CreatedById":77314,"CreatedDateTime":"2014-02-07T09:43:48Z","Content":"\n\u003Cp\u003EAny idea when you\u0027re releasing a prototype/alpha test? Because if you want testers, I\u0027ll love to do it!\u003C/p\u003E\n"}]}