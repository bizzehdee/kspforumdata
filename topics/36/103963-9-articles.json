{"TopicId":103963,"ForumId":36,"TopicTitle":"[WIP][1.9.x-1.12.x] Scatterer-atmospheric scattering (0.0838 - 14/08/2022) Scattering improvements, in-game atmo generation and multi-sun support","CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-04-12T08:37:35Z","PageNum":9,"Articles":[{"CreatedByName":"John FX","CreatedById":59415,"CreatedDateTime":"2015-04-23T08:26:29Z","Content":"So I downloaded it and had a look and what I saw was good. Except for it made my EVE clouds disappear and it looked wrong from orbit, too much on the day side. I think if the fix suggested earlier for changing stuff as you get higher and from the sounds of it some of the other fixes in the pipeline happen then I will reinstall but until then I\u0027ll just watch with interest."},{"CreatedByName":"Proot","CreatedById":98932,"CreatedDateTime":"2015-04-23T11:54:55Z","Content":"I\u0027m the only one having issues with the config tool?\n\nI\u0027ve tried it in two different PC (both with NVIDIA cards and updated drivers, one Windows 7 other 8.1), but both says that plattaform can\u0027t handle shaders (wich is not true). I\u0027m doing something wrong? ![:(](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_sad.gif)\n\nThe mod works perfectly well. ![:confused:](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_huh.gif)\n\n**Edited \u003Ctime datetime=\u00222015-04-23T12:01:23Z\u0022 title=\u002204/23/2015 12:01  PM\u0022 data-short=\u00229 yr\u0022\u003EApril 23, 2015\u003C/time\u003E by Proot**"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-04-23T11:58:54Z","Content":"\u003E \n\u003E I\u0027m the only one having issues with the config tool?\n\u003E I\u0027ve tried it in two different PC (both with NVIDIA cards and updated drivers, one in Windows 7 other on 8.1), but both says that plattaform can\u0027t handle shaders (wich is not true). I\u0027m doing something wrong? ![:(](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_sad.gif)\n\u003E \n\u003E The mod works perfectly well. ![:confused:](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_huh.gif)\n\nDo you have a directx-11 capable card? Try adding the -force-d3d11 command line"},{"CreatedByName":"Endersmens","CreatedById":80723,"CreatedDateTime":"2015-04-23T12:29:54Z","Content":"\u003E \n\u003E Download the scatterer archive from [KerbalStuff](https://kerbalstuff.com/mod/700/Scatterer), then drop the \u0027scatterer\u0027 directory from the archive into your KSP installs GameData directory\n\nThanks, that\u0027s the first thing i tried and it worked.\n\nBlackrack, I would suggest you put the scatterer folder into a \u0022GameData\u0022 folder for the download so that people know where to put it.\n\nI love the way this makes everything look, I especially like how in the mornings and evenings, the ground darkens and gets a special tint to it. I like the postprocessing fog, but It can be a bit overwhelming. I tried turning it down and it didn\u0027t really change much. Also, when there are multiple layers of distance (i.e. when the mountains are the back, and there are two or three smaller hill crests visible too) there appears to be a line of dark pixels outlining each hill crest.\n\nAnother nitpick, the menu SHOULD NOT come up by default EVERY SCENE and have to be toggled off. It could come up one time after installation so people know how to access it and use it, but it is very annoying loading up a craft and every single scene having to toggle the scatterer screen. (and sometimes the module manager screen too)\n\nAlso, during night time, the fog turns a weird red color, reminds me a zombie apocalypse. The mountains become red instead of light blue.\n\nand last but not least, this mod froze my time warp once. I was trying to warp to morning and it just. stopped. It said i was warping at 1000x, but it wasn\u0027t warping, it was stuck. And warp wouldn\u0027t work at all after that until my game crashed and i reloaded it. \n\nSorry for all the complaints, and I do understand that this is a WIP, but that\u0027s precisely why I gave all those. So they can be added to the work in progress. Beautiful mod though! Once this is more stable and has less space screw ups I can see this being an essential mod to any save I have."},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-04-23T15:17:13Z","Content":"I have problems getting scaledspace to work correctly, I know how you scale things up or down and the coordinate system changes, but the problem is my shaders have to be fed the cameraToWorld matrix and the camera\u0027s transform.forward as well as other stuff. The problem is, I can\u0027t find a way to translate these things to scaledSpace coordinates so the shaders are working wrong because they think the camera is in a completely different position and orientation.\n\n\u003E \n\u003E Thanks, that\u0027s the first thing i tried and it worked.\n\u003E Blackrack, I would suggest you put the scatterer folder into a \u0022GameData\u0022 folder for the download so that people know where to put it.\n\u003E \n\u003E I love the way this makes everything look, I especially like how in the mornings and evenings, the ground darkens and gets a special tint to it. I like the postprocessing fog, but It can be a bit overwhelming. I tried turning it down and it didn\u0027t really change much. Also, when there are multiple layers of distance (i.e. when the mountains are the back, and there are two or three smaller hill crests visible too) there appears to be a line of dark pixels outlining each hill crest.\n\u003E \n\u003E Another nitpick, the menu SHOULD NOT come up by default EVERY SCENE and have to be toggled off. It could come up one time after installation so people know how to access it and use it, but it is very annoying loading up a craft and every single scene having to toggle the scatterer screen. (and sometimes the module manager screen too)\n\u003E \n\u003E Also, during night time, the fog turns a weird red color, reminds me a zombie apocalypse. The mountains become red instead of light blue.\n\u003E \n\u003E and last but not least, this mod froze my time warp once. I was trying to warp to morning and it just. stopped. It said i was warping at 1000x, but it wasn\u0027t warping, it was stuck. And warp wouldn\u0027t work at all after that until my game crashed and i reloaded it. \n\u003E \n\u003E Sorry for all the complaints, and I do understand that this is a WIP, but that\u0027s precisely why I gave all those. So they can be added to the work in progress. Beautiful mod though! Once this is more stable and has less space screw ups I can see this being an essential mod to any save I have.\n\nThe red thing is fixed and will be released in the next update. The line of dark pixels is inevitable for now because the depth buffer the game writes is always aliased.\n\nI\u0027ll do the menu thing."},{"CreatedByName":"Endersmens","CreatedById":80723,"CreatedDateTime":"2015-04-23T15:19:50Z","Content":"\u003E \n\u003E The red thing is fixed and will be released in the next update. The line of dark pixels is inevitable for now because the depth buffer the game writes is always aliased.\n\u003E \n\u003E I\u0027ll do the menu thing.\n\nAwesome! Sorry if I sounded rude in my post, I really did not intend to. Just constructive criticism. I hope you understand that. ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\nPlus the fact that you listened and acted makes you an awesome person and modder. ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\nThat\u0027s unfortunate about the dark pixels, I guess if I want really really nice pictures using this mod I\u0027ll have to go in photoshop and edit the pixels out. worth it though!\n\nEDIT: Any guesses about why my timewarp stopped working? There\u0027s a small chance it was another mod, but since this one messed with the sky i thought it might have been this one."},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-04-23T15:24:51Z","Content":"\u003E \n\u003E Awesome! Sorry if I sounded rude in my post, I really did not intend to. Just constructive criticism. I hope you understand that. ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\u003E Plus the fact that you listened and acted makes you an awesome person and modder. ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\u003E \n\u003E That\u0027s unfortunate about the dark pixels, I guess if I want really really nice pictures using this mod I\u0027ll have to go in photoshop and edit the pixels out. worth it though!\n\u003E \n\u003E EDIT: Any guesses about why my timewarp stopped working? There\u0027s a small chance it was another mod, but since this one messed with the sky i thought it might have been this one.\n\nIt\u0027s alright, i\u0027m guessing if you try downsampling (not sure if it works with KSP) the dark pixels would go away, It\u0027s just a guess though so it may or may not work. The dark pixels are also definitely more pronounced in dx11 and opengl (both buggy as hell with the postprocessing shader).\n\nNo idea about the timewarp but it never happened to me using scatterer and a heavily modded install."},{"CreatedByName":"Endersmens","CreatedById":80723,"CreatedDateTime":"2015-04-23T15:27:04Z","Content":"\u003E \n\u003E It\u0027s alright, i\u0027m guessing if you try downsampling (not sure if it works with KSP) the dark pixels would go away, It\u0027s just a guess though so it may or may not work. The dark pixels are also definitely more pronounced in dx11 and opengl (both buggy as hell with the postprocessing shader).\n\u003E No idea about the timewarp but it never happened to me using scatterer and a heavily modded install.\n\nI wasn\u0027t using that many\\* mods, I was using BahamutoD\u0027s mods with quiztech and FAR. \n\n\\*along with ShowFPS and the reducing lag setting.cfg"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-04-23T15:28:41Z","Content":"\u003E \n\u003E the reducing lag setting.cfg\n\nThis seems dodgy, but it could be scatterer doing it as well (though I don\u0027t really see a reason why it would), just remember we\u0027re still pretty early in development."},{"CreatedByName":"Proot","CreatedById":98932,"CreatedDateTime":"2015-04-23T15:56:35Z","Content":"\u003E \n\u003E Do you have a directx-11 capable card? Try adding the -force-d3d11 command line\n\nNo way to get it running. I must be doing something wrong, but I don\u0027t know what... Right now I\u0027m trying in W7 with a GT540M (DirectX 11 GPU, Shader Model 5.0 support). The first run worked, but stopped trying to generate a new configuration. So I updated the drivers (all fine) and now this says that shaders are not supported.\n\n...? ![:confused:](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_huh.gif)"},{"CreatedByName":"Endersmens","CreatedById":80723,"CreatedDateTime":"2015-04-23T16:01:42Z","Content":"\u003E \n\u003E This seems dodgy, but it could be scatterer doing it as well (though I don\u0027t really see a reason why it would), just remember we\u0027re still pretty early in development.\n\nIt just changes two things in the settings, it changes mindistance and maxsubdivision. (it reduces how much water KSP loads, which takes massive amounts of CPU power, so lowering those numbers boosts performance by 10 fold easy. ) nothing that should cause bugginess."},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-04-23T17:54:35Z","Content":"\u003E \n\u003E No way to get it running. I must be doing something wrong, but I don\u0027t know what... Right now I\u0027m trying in W7 with a GT540M (DirectX 11 GPU, Shader Model 5.0 support). The first run worked, but stopped trying to generate a new configuration. So I updated the drivers (all fine) and now this says that shaders are not supported.\n\u003E ...? ![:confused:](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_huh.gif)\n\nIs there anything other than shaders not supported in the little debug box? With directX11 and shader model 5 it should work. If you\u0027re on a laptop maybe it\u0027s starting on the IGP? I remember Optimus being buggy as hell, if I\u0027m not mistaken, there\u0027s a setting somewhere that allows an application to start on the GPU instead of the iGPU. If all else fails I think plugging in a hdmi monitor or TV forces everything to run off the main GPU."},{"CreatedByName":"rbray89","CreatedById":48847,"CreatedDateTime":"2015-04-23T19:28:49Z","Content":"So I was thinking about support for clouds, and I fear they may not play nicely with the post-processing method for doing the light scattering. \n\nBecause post-processing occurs at the last stage of rendering, there is no good way to mask off the clouds. You could change the cloud shader to write to the depth buffer, but that would ruin anything behind it.\n\nWhat you could do, is instead of doing post-processing, is add physical geometry like I do for my atmosphere (a large cube around the camera). Then the draw order can be altered such that it is before the transparent clouds."},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-04-23T19:40:41Z","Content":"\u003E \n\u003E So I was thinking about support for clouds, and I fear they may not play nicely with the post-processing method for doing the light scattering. \n\u003E Because post-processing occurs at the last stage of rendering, there is no good way to mask off the clouds. You could change the cloud shader to write to the depth buffer, but that would ruin anything behind it.\n\u003E \n\u003E What you could do, is instead of doing post-processing, is add physical geometry like I do for my atmosphere (a large cube around the camera). Then the draw order can be altered such that it is before the transparent clouds.\n\nHi rbray, not sure I understand how to do that, my shader doesn\u0027t necessarily need to be a post-processing shader, but I need some information about the terrain position and distance, either by applying the shader straight to terrain objects or by using the depth buffer to get said information. Could you elaborate more on your cube method? Is it just a cube that I render the same shader to, instead of rendering to the camera or what?"},{"CreatedByName":"rbray89","CreatedById":48847,"CreatedDateTime":"2015-04-23T19:45:00Z","Content":"\u003E \n\u003E Hi rbray, not sure I understand how to do that, my shader doesn\u0027t necessarily need to be a post-processing shader, but I need some information about the terrain position and distance, either by applying the shader straight to terrain objects or by using the depth buffer to get said information. Could you elaborate more on your cube method? Is it just a cube that I render the same shader to, instead of rendering to the camera or what?\n\nThat is exactly it. Same shader, but applied to a cube that wraps around the camera. It needs to be a bit bigger than the near-clipping plane of the \u0022far\u0022 camera. Hope that makes sense."},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-04-23T19:47:31Z","Content":"\u003E \n\u003E That is exactly it. Same shader, but applied to a cube that wraps around the camera. It needs to be a bit bigger than the near-clipping plane of the \u0022far\u0022 camera. Hope that makes sense.\n\nThis makes sense, but if it is a exactly just bigger than the near-clipping plane of the far camera, how do you get the clouds to render on top of it?"},{"CreatedByName":"rbray89","CreatedById":48847,"CreatedDateTime":"2015-04-23T19:57:32Z","Content":"\u003E \n\u003E This makes sense, but if it is a exactly just bigger than the near-clipping plane of the far camera, how do you get the clouds to render on top of it?\n\nAny size between the two planes would work really, but you want to avoid getting too close to either. The rendering queue is what is the magic here.\n\nSo, to optimize rendering, we have z-sorting and depth buffers. Z-sorting just uses the origin of the object, and draws things that are CLOSER, first. Then the z-buffer comes in, and checks if there is anything on-top of the pixel that make it so that this pixel doesn\u0027t have to be drawn. Problem with this, is that if you have transparent objects, you can\u0027t tell them to draw to the depth buffer, or things behind it may never be drawn, resulting in black. \n\nSo to address this, we don\u0027t write transparent stuff to the depth buffer, and we use render queues to \u0022group\u0022 objects to be rendered in specific order. Typically, you render skybox, then opaque, alphaTest, transparent, then overlay last.\n\nShaders have a render queue tag that indicates what the rendering order should be. My clouds are on Transparent, so My atmosphere is on AlphaTest (or Transparent-X; you can use offsets to manually play with the order) , which means all the terrain and buildings are drawn, then the atmosphere, then the clouds. \n\nHope this made sense ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)"},{"CreatedByName":"John FX","CreatedById":59415,"CreatedDateTime":"2015-04-23T20:01:20Z","Content":"Cool, so we may get a nice sky as well as clouds. I have to say having tried both the game sure is ugly without either now.\u0027"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-04-23T20:01:50Z","Content":"\u003E \n\u003E Any size between the two planes would work really, but you want to avoid getting too close to either. The rendering queue is what is the magic here.\n\u003E So, to optimize rendering, we have z-sorting and depth buffers. Z-sorting just uses the origin of the object, and draws things that are CLOSER, first. Then the z-buffer comes in, and checks if there is anything on-top of the pixel that make it so that this pixel doesn\u0027t have to be drawn. Problem with this, is that if you have transparent objects, you can\u0027t tell them to draw to the depth buffer, or things behind it may never be drawn, resulting in black. \n\u003E \n\u003E So to address this, we don\u0027t write transparent stuff to the depth buffer, and we use render queues to \u0022group\u0022 objects to be rendered in specific order. Typically, you render skybox, then opaque, alphaTest, transparent, then overlay last.\n\u003E \n\u003E Shaders have a render queue tag that indicates what the rendering order should be. My clouds are on Transparent, so My atmosphere is on AlphaTest (or Transparent-X; you can use offsets to manually play with the order) , which means all the terrain and buildings are drawn, then the atmosphere, then the clouds. \n\u003E \n\u003E Hope this made sense ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\nWow, this makes perfect sense, I\u0027ll definitely do this, but first on my list I have to fix scaledspace.\n\nThanks a lot."},{"CreatedByName":"Proot","CreatedById":98932,"CreatedDateTime":"2015-04-23T20:20:53Z","Content":"Conversation among geniuses ![:sticktongue:](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue2.gif)\n\nI love when I feel a bit like a chimp, because that means that I\u0027ll see great things. ![:D](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif)\n\nBTW: no luck with the config tool. I was suspecting about Optimus too, but I can\u0027t find the problem right now. I\u0027ll try later on other desktop pc.\n\n**Edited \u003Ctime datetime=\u00222015-04-23T20:22:58Z\u0022 title=\u002204/23/2015 08:22  PM\u0022 data-short=\u00229 yr\u0022\u003EApril 23, 2015\u003C/time\u003E by Proot**"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-04-23T20:30:50Z","Content":"\u003E \n\u003E Conversation among geniuses ![:sticktongue:](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue2.gif)\n\u003E I love when I feel a bit like a chimp, because that means that I\u0027ll see great things. ![:D](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif)\n\u003E \n\u003E BTW: no luck with the config tool. I was suspecting about Optimus too, but I can\u0027t find the problem right now. I\u0027ll try later on other desktop pc.\n\nYeah, definitely try with a desktop PC. Right now I\u0027m suspecting no one else has tried the config tool because no one is reporting problems or posting configs/screens. So I don\u0027t really know if it\u0027s a problem with certain machines or something. Oh well..."},{"CreatedByName":"SmallFatFetus","CreatedById":137860,"CreatedDateTime":"2015-04-24T01:27:02Z","Content":"How close are we to getting a 3.2x or 6.4x kerbin config? I stalk this thread like a fiend, so feel free to post some pictures!\n\nSmallFatFetus"},{"CreatedByName":"NoMrBond","CreatedById":69263,"CreatedDateTime":"2015-04-24T01:55:18Z","Content":"\u003E \n\u003E Yeah, definitely try with a desktop PC. Right now I\u0027m suspecting no one else has tried the config tool because no one is reporting problems or posting configs/screens. So I don\u0027t really know if it\u0027s a problem with certain machines or something. Oh well...\n\nI wish I could, unfortunately every time I force dx11 everything goes pink for some reason"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-04-24T09:00:51Z","Content":"\u003E \n\u003E How close are we to getting a 3.2x or 6.4x kerbin config? I stalk this thread like a fiend, so feel free to post some pictures!\n\u003E SmallFatFetus\n\nThe default config already works on these, but the problem is, they make the terrain pretty flat so it looks very bland. In addition, and this is some weird behavior on the part of the mod, but a bigger planet sort of \u0022stretches\u0022 and \u0022dilutes\u0022 the atmosphere (if it makes sense) and it needs an adjusted config.\n\nI haven\u0027t played much with 6.4x kerbin but here\u0027s a random screen [http://i.imgur.com/rak45U0.jpg](http://i.imgur.com/rak45U0.jpg)\n\n\u003E \n\u003E I wish I could, unfortunately every time I force dx11 everything goes pink for some reason\n\nSo wait, the config tool isn\u0027t working for anybody but me right now? Hold on, let me check on another machine.\n\nEdited: Works perfectly well here, both directly and while adding the -force-d3d11 command. Is anybody else unable to run it?"},{"CreatedByName":"John FX","CreatedById":59415,"CreatedDateTime":"2015-04-24T10:18:09Z","Content":"I must admit to installing the mod, seeing that it covered up clouds from EVE and then uninstalling at that point. Often I wait until \u0027default\u0027 works well enough before I start changing things.\n\nE : I could imagine a lot of people who would want prettier skies are already running EVE so it might be that \u0027no clouds out of the box\u0027 puts them off. Am I right in thinking there is a version that fixes that which is unreleased?\n\nOr, is there a version of EVE that works with scatterer?\n\n**Edited \u003Ctime datetime=\u00222015-04-24T10:21:16Z\u0022 title=\u002204/24/2015 10:21  AM\u0022 data-short=\u00229 yr\u0022\u003EApril 24, 2015\u003C/time\u003E by John FX**"}]}