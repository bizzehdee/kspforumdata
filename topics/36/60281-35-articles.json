{"TopicId":60281,"ForumId":36,"TopicTitle":"[Hardware, Plugin] Arduino based physical display \u002B serial port io\u002B tutorial (24-11-19)","CreatedByName":"zitronen","CreatedById":11842,"CreatedDateTime":"2014-01-18T01:25:25Z","PageNum":35,"Articles":[{"CreatedByName":"bork_bork","CreatedById":137466,"CreatedDateTime":"2015-03-02T21:59:56Z","Content":"\n\u003Cp\u003EMarzubus - thanks for putting together this port. I put it on my Mega2560 with a MacBookPro. I am noticing very slow refresh to my arduino and auto-detect is not working. If I set no-detect I get data to the arduino. \u003C/p\u003E\u003Cp\u003EThis is with serial running at 115200, which should be more than sufficient. Is there a method to debug the Serial Port detect handshake?\u003C/p\u003E\u003Cp\u003EEDIT: After reading through a few previous posts, I may be hitting the 32bit struct padding issue. Has anyone else already solved that and can share code?\u003C/p\u003E\u003Cp\u003E/bork\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022marzubus\u0022 data-cite=\u0022marzubus\u0022\u003E\u003Cdiv\u003EHey Folks!\u003Cp\u003EI have released the 0.17.1 version of the Mac / Linux / Win Port of KSPSerialIO.\u003C/p\u003E\u003Cp\u003EChangelog: \u003C/p\u003E\u003Cp\u003E* major cleanup and rebase\u003C/p\u003E\u003Cp\u003E* merge with 0.17.1 upstream code\u003C/p\u003E\u003Cp\u003E* fixed time-warp issue by migrating from MonoBehavior::Update() to MonoBehavior::FixedUpdate()\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-03-02T22:15:43Z\u0022 title=\u002203/02/2015 10:15  PM\u0022 data-short=\u00229 yr\u0022\u003EMarch 2, 2015\u003C/time\u003E by bork_bork\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"marzubus","CreatedById":68021,"CreatedDateTime":"2015-03-02T23:22:42Z","Content":"\n\u003Cp\u003EThe detection is a problem. since 0.17 for some reason. I need to figure out a solution for that. Are you using a mega or DUE or why do you ask about the 32 bit padding? \u003C/p\u003E\u003Cp\u003EI did another build without fixedUpdate(), since I traced my warping issue to another issue. here is a patched dll: \u003Ca href=\u0022https://www.dropbox.com/s/ms985yh9qjo00zv/KSPSerialIO.dll?dl=0\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://www.dropbox.com/s/ms985yh9qjo00zv/KSPSerialIO.dll?dl=0\u003C/a\u003E, can u try that? Maybe fixedUpdate was a bad idea.\u003C/p\u003E\u003Cp\u003EAlso be sure that whatever you have in your arduino\u0027s main loop is NOT taking long to execute. Are you just running the KSPSerialIO Demo 10? or have you added more to the main loop? \u003C/p\u003E\u003Cp\u003EI was experimenting with updating OLED\u0027s from the main loop, but the 50ms delay to update the OLED made my arduino lag behind and disconnect. \u003C/p\u003E\u003Cp\u003ETry just the Demo10 code and see if it lags on simple stuff like SAS LED and so on. Make sure to test it for at least a launch to orbit, since the lag can sneak up on you.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-03-02T23:27:39Z\u0022 title=\u002203/02/2015 11:27  PM\u0022 data-short=\u00229 yr\u0022\u003EMarch 2, 2015\u003C/time\u003E by marzubus\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"bork_bork","CreatedById":137466,"CreatedDateTime":"2015-03-03T02:54:37Z","Content":"\n\u003Cp\u003EI am running a driver for 7 segment displays based on the MAX7219 (MaxMatrix library). I have tested that in a tight loop and get sub 10ms update times, so I don\u0027t expect that to be a problem, but I can try disabling it and see if that improves the update rate. I\u0027ll also wire up only the simple LED for SAS and see how that goes.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022marzubus\u0022 data-cite=\u0022marzubus\u0022\u003E\u003Cdiv\u003E\u003Cp\u003EAlso be sure that whatever you have in your arduino\u0027s main loop is NOT taking long to execute. Are you just running the KSPSerialIO Demo 10? or have you added more to the main loop? \u003C/p\u003E\u003Cp\u003ETry just the Demo10 code and see if it lags on simple stuff like SAS LED and so on. Make sure to test it for at least a launch to orbit, since the lag can sneak up on you.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\n"},{"CreatedByName":"marzubus","CreatedById":68021,"CreatedDateTime":"2015-03-03T09:29:28Z","Content":"\n\u003Cp\u003Esub 10 should be OK, also remember that my port of KSP Serial IO syncs with the serial device on every frame render, so if you are doing something like 120FPS that could be the problem too. \u003C/p\u003E\u003Cp\u003EIn you config have you also set refresh? refresh should always be 1.0, if its left out of config it will default to 1.0 \u003C/p\u003E\u003Cp\u003EYou can just use the SASLED = 13 to use the onboard one. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif\u0022 alt=\u0022;)\u0022\u003E\u003C/p\u003E\u003Cp\u003EAnd are you on a DUE or a MEGA?\u003C/p\u003E\u003Cp\u003EEDIT: I have fixed autodetect!!!! Wheres a party hat kerbal when you need one...\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022https://kerbalstuff.com/mod/540/KSPSerialIO%20Mac/Linux/Win\u0022 rel=\u0022external nofollow\u0022\u003ELink\u003C/a\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-03-03T11:01:08Z\u0022 title=\u002203/03/2015 11:01  AM\u0022 data-short=\u00229 yr\u0022\u003EMarch 3, 2015\u003C/time\u003E by marzubus\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"T.A.P.O.R.","CreatedById":137748,"CreatedDateTime":"2015-03-03T19:35:34Z","Content":"\n\u003Cp\u003EHi zitronen\u003C/p\u003E\u003Cp\u003EI\u0027m not sure if I got a corrupted DL, but I can\u0027t get the basic SAS \u0026amp; RCS to work in KSPIODemo10 (even from a fresh zip extract).\u003C/p\u003E\u003Cp\u003EKSPIODemo9 works just fine though.\u003C/p\u003E\u003Cp\u003EThis is on a UNO R3\u003C/p\u003E\u003Cp\u003EI\u0027ll test on my Leonardo when I get back from work.\u003C/p\u003E\n"},{"CreatedByName":"marzubus","CreatedById":68021,"CreatedDateTime":"2015-03-03T19:49:58Z","Content":"\n\u003Cp\u003EI had to patch my port to fix a issue with control packets . I thought it was a issue with my fork but maybe it\u0027s from upstream . See \u003Ca href=\u0022https://github.com/unixunion/KSPSerialIO/commit/a52b6be76dae893845e7776b5b857916645ea79c\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/unixunion/KSPSerialIO/commit/a52b6be76dae893845e7776b5b857916645ea79c\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EEdit: comparing to upstream, it doesn\u0027t Seem to be a issue in Zitron\u0027s code. Can u test with the cross platform port because I know that works.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-03-03T19:56:40Z\u0022 title=\u002203/03/2015 07:56  PM\u0022 data-short=\u00229 yr\u0022\u003EMarch 3, 2015\u003C/time\u003E by marzubus\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"stibbons","CreatedById":57865,"CreatedDateTime":"2015-03-04T10:40:21Z","Content":"\n\u003Cp\u003EThis evening I\u0027ve uninstalled my local build of the old 0.16.1 plugin and switched to zitronen\u0027s 0.17.1. Added the new bits to my packet structs, and everything\u0027s running smoothly with my controller.\u003C/p\u003E\u003Cp\u003EWhen I get some time over the weekend I\u0027m keen to update my controller to read the new ActionGroups field in VesselData.\u003C/p\u003E\n"},{"CreatedByName":"zitronen","CreatedById":11842,"CreatedDateTime":"2015-03-04T11:32:04Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022T.A.P.O.R.\u0022 data-cite=\u0022T.A.P.O.R.\u0022\u003E\u003Cdiv\u003EHi zitronen\u003Cp\u003EI\u0027m not sure if I got a corrupted DL, but I can\u0027t get the basic SAS \u0026amp; RCS to work in KSPIODemo10 (even from a fresh zip extract).\u003C/p\u003E\u003Cp\u003EKSPIODemo9 works just fine though.\u003C/p\u003E\u003Cp\u003EThis is on a UNO R3\u003C/p\u003E\u003Cp\u003EI\u0027ll test on my Leonardo when I get back from work.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ECan you make sure you are running the latest version (0.17.1): \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/66393-Hardware-Plugin-Arduino-based-physical-display-serial-port-io-tutorial-%2817-Dec%29?p=1708617\u0026amp;viewfull=1#post1708617\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://forum.kerbalspaceprogram.com/threads/66393-Hardware-Plugin-Arduino-based-physical-display-serial-port-io-tutorial-%2817-Dec%29?p=1708617\u0026amp;viewfull=1#post1708617\u003C/a\u003E\u003C/p\u003E\n"},{"CreatedByName":"Nuke","CreatedById":10883,"CreatedDateTime":"2015-03-04T14:26:25Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022zitronen\u0022 data-cite=\u0022zitronen\u0022\u003E\u003Cdiv\u003EBe careful if you are going 32bit: \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/66393-Hardware-Plugin-Arduino-based-physical-display-serial-port-io-tutorial-%2817-Dec%29?p=1544333\u0026amp;viewfull=1#post1544333\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://forum.kerbalspaceprogram.com/threads/66393-Hardware-Plugin-Arduino-based-physical-display-serial-port-io-tutorial-%2817-Dec%29?p=1544333\u0026amp;viewfull=1#post1544333\u003C/a\u003E\u003Cp\u003EIt\u0027s still not clear if the code will run properly without massive changes due to struct padding.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003Eits probibly an endianness thing. avr is big endian, intel is little endian, and arm is both. confused? you should be. ive read articles that say its dumb to worry about endianness but they are usually for coders writing only for one platform. when you shove bits down a serial line between two dissimilar architectures and expect to use the same code at both ends to convert a stream of bytes into a structure and vise versa, you are going to have problems. i usually make a union between a byte array and a structure, then use it as a class member, then add a member function to perform byteswaps on a member by member basis. then you can use the same code at both ends, calling byteswap() at one end if the endiannes is different (obviously at the end with the faster cpu). i usually have the server query the client about its endianness at the start of a session so it knows whether or not it needs to perform a byteswap.\u003C/p\u003E\u003Cp\u003Ethat is of course assuming you are moving structures and not text. if you are using an at command set, then you really dont need to worry about endianness at all, but really that is going to be a slow down on 8 bit micros without a lot of memory. i did one once to configure an r/c receiver i built. i had to use every scrap of flash and some of the eeprom to store strings. it was rather tedius. i eventually replaced it with a bytecode interpreter.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-03-04T14:36:40Z\u0022 title=\u002203/04/2015 02:36  PM\u0022 data-short=\u00229 yr\u0022\u003EMarch 4, 2015\u003C/time\u003E by Nuke\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"zitronen","CreatedById":11842,"CreatedDateTime":"2015-03-04T17:05:02Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Nuke\u0022 data-cite=\u0022Nuke\u0022\u003E\u003Cdiv\u003Eits probibly an endianness thing. avr is big endian, intel is little endian, and arm is both. confused?.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EIt\u0027s not an endian issue, it\u0027s to do with how the compiler pads the structures for 32bit and 8bit: \u003Ca href=\u0022http://vcfaq.mvps.org/lang/11.htm\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://vcfaq.mvps.org/lang/11.htm\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EOnce that\u0027s fixed (harbingerx81 had to rewrite the receive function to manually correct things) everything worked. There maybe ways around it that doesn\u0027t involve painstaking rewrites every time the struct changes, but nothing has been tested so far.\u003C/p\u003E\n"},{"CreatedByName":"bork_bork","CreatedById":137466,"CreatedDateTime":"2015-03-04T18:14:45Z","Content":"\n\u003Cp\u003ESo, I did a bit more testing. I am getting massive checksum fails on packets. Only 1 out of hundreds of packets passes checksum. That explains why the display felt very \u0027laggy\u0027. Now to debug why I am getting so many checksum failures. This is with KSPDemo9 running at 115200. I was unable to get KSPDemo10 to read anything from the serial port yet.\u003C/p\u003E\u003Cp\u003EI am running an ATMega2560.\u003C/p\u003E\u003Cp\u003E/bork\u003C/p\u003E\n"},{"CreatedByName":"zitronen","CreatedById":11842,"CreatedDateTime":"2015-03-04T22:48:22Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022bork_bork\u0022 data-cite=\u0022bork_bork\u0022\u003E\u003Cdiv\u003ESo, I did a bit more testing. I am getting massive checksum fails on packets. Only 1 out of hundreds of packets passes checksum. That explains why the display felt very \u0027laggy\u0027. Now to debug why I am getting so many checksum failures. This is with KSPDemo9 running at 115200. I was unable to get KSPDemo10 to read anything from the serial port yet.\u003Cp\u003EI am running an ATMega2560.\u003C/p\u003E\u003Cp\u003E/bork\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EAre you sending too many packets? What is your refresh rate in the config file? And can you make sure you are running the latest version (0.17.1) of the plugin?\u003C/p\u003E\n"},{"CreatedByName":"stibbons","CreatedById":57865,"CreatedDateTime":"2015-03-05T03:37:20Z","Content":"\n\u003Cp\u003EYou might want to also try it with a slower speed, and worst case try with a different USB cable. I\u0027ve had several arduinos arrive with cables bad enough that I couldn\u0027t talk to the board at all.\u003C/p\u003E\n"},{"CreatedByName":"bork_bork","CreatedById":137466,"CreatedDateTime":"2015-03-05T03:55:26Z","Content":"\n\u003Cp\u003ESo - the answer to the checksum fails was buffer overruns. The 20ms taken to drive the display was too much. I have re-written the display driver and got it down to 3ms. No more buffer overruns and no more checksum fails! Thanks everyone for the help!\u003C/p\u003E\u003Cp\u003EA great debugging tip to anyone out there seeing similar: Put a check at the top of KSPBoardReceiveData to see if available bytes is \u0026gt; 62 and light up pin 13 to show the error.\u003C/p\u003E\n"},{"CreatedByName":"bork_bork","CreatedById":137466,"CreatedDateTime":"2015-03-05T05:44:07Z","Content":"\n\u003Cp\u003EIs it possible to read the state of SAS / Brakes, etc? I would like to display current state and have button for toggle, rather than a switch. In the current code I only see inputs for SAS, etc.\u003C/p\u003E\n"},{"CreatedByName":"Freshmeat","CreatedById":111048,"CreatedDateTime":"2015-03-05T07:32:48Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022bork_bork\u0022 data-cite=\u0022bork_bork\u0022\u003E\u003Cdiv\u003EIs it possible to read the state of SAS / Brakes, etc? I would like to display current state and have button for toggle, rather than a switch. In the current code I only see inputs for SAS, etc.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EAs of version 17, it is. The information is in \u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003EVData.ActionGroups\u003C/pre\u003E\u003Cp\u003E It is 16 bits containing status of following actions: SAS, RCS, Light, Gear, Brakes, Abort, Custom01 - 10, Where Custom refers to action group 1-10 of the vessel.\u003C/p\u003E\n"},{"CreatedByName":"T.A.P.O.R.","CreatedById":137748,"CreatedDateTime":"2015-03-05T10:43:24Z","Content":"\n\u003Cp\u003E\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022zitronen\u0022 data-cite=\u0022zitronen\u0022\u003E\u003Cdiv\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003ECan you make sure you are running the latest version (0.17.1): \u003C/span\u003E\u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/66393-Hardware-Plugin-Arduino-based-physical-display-serial-port-io-tutorial-%2817-Dec%29?p=1708617\u0026amp;viewfull=1#post1708617\u0022 rel=\u0022external nofollow\u0022\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003Ehttp://forum.kerbalspaceprogram.com/threads/66393-Hardware-Plugin-Arduino-based-physical-display-serial-port-io-tutorial-%2817-Dec%29?p=1708617\u0026amp;viewfull=1#post1708617\u003C/span\u003E\u003C/a\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003EI re-downloaded \u003C/span\u003E\u003Ca href=\u0022https://sites.google.com/site/zitronfiles/KSPIODemo10.zip?attredirects=0\u0022 rel=\u0022external nofollow\u0022\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003EKSPIODemo10\u003C/span\u003E\u003C/a\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003E \u0026amp; \u003C/span\u003E\u003Ca href=\u0022https://sites.google.com/site/zitronfiles/KSPSerialIO_017_1.zip?attredirects=0\u0022 rel=\u0022external nofollow\u0022\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003E0.17.1\u003C/span\u003E\u003C/a\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003E and all seems to be working.\u003C/span\u003E\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003EWith some PM help from AmeliaEatyaHeart I managed to get my 7 Seg LED Displays and my controls working!\u003C/span\u003E\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003EHere\u0027s the fix:\u003C/span\u003E\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003ETab: KSPIODemo10\u003C/span\u003E\u003C/strong\u003E\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E\u003Cbr\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003E#include \u0026lt;LedControl.h\u0026gt;    \u003C/span\u003E\u003Cbr\u003E\u003Cbr\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003E        #define    LEDClkPin   4\u003C/span\u003E\u003Cbr\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003E        #define    LEDChipSel  3  \u003C/span\u003E\u003Cbr\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003E        #define    LEDDatain   2\u003C/span\u003E\u003Cbr\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003E        //these pins were set up for an Arduino Uno, adjust as appropriate.\u003C/span\u003E\u003Cbr\u003E\u003Cbr\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003E        LedControl lc=LedControl(LEDDatain,LEDClkPin,LEDChipSel,2);//1==num of 8x8pixel arrays in line. can be up to 8.\u003C/span\u003E\u003Cbr\u003E\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003Evoid setup()\u003C/span\u003E\u003Cbr\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003E{  Serial.begin(38400);\u003C/span\u003E\u003Cbr\u003E\u003Cbr\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003E[B]\u003C/span\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003E LedControl lc=LedControl(LEDDatain,LEDClkPin,LEDChipSel,2); //number of displays is the last variable, will be 1-8.\u003C/span\u003E\u003Cbr\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003E blankLEDscreens(); //initialise screen, and show display number examples.\u003C/span\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003E[/B]\u003C/span\u003E\u003Cbr\u003E\u003Cbr\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003E  initLEDS();\u003C/span\u003E\u003Cbr\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003E  InitTxPackets();\u003C/span\u003E\u003Cbr\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003E  controlsInit();\u003C/span\u003E\u003Cbr\u003E\u003Cbr\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003E  LEDSAllOff();  \u003C/span\u003E\u003Cbr\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003E}\u003C/span\u003E\u003Cbr\u003E\u003Cbr\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003Evoid loop()\u003C/span\u003E\u003Cbr\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003E{  \u003C/span\u003E\u003Cbr\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003E  input();\u003C/span\u003E\u003Cbr\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003E  output();\u003C/span\u003E\u003Cbr\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003E}\u003C/span\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003ETab: Utilities\u003C/span\u003E\u003C/strong\u003E\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003Evoid Indicators() \u003C/span\u003E\u003Cbr\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003E{  \u003C/span\u003E\u003Cbr\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003E[B]\u003C/span\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003EprintNumLED(0, (long)(VData.AP), \u0027A\u0027, 3);//will display apoapsis, with the decimal point separating km and m.\u003C/span\u003E\u003Cbr\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003EprintNumLED(1, (long)(VData.RAlt), \u0027B\u0027, 3);//will display Radar Alt in same format.\u003C/span\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003E[/B]\u003C/span\u003E\u003Cbr\u003E\u003Cbr\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003E  caution = 0;\u003C/span\u003E\u003Cbr\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003E  warning = 0;\u003C/span\u003E\u003Cbr\u003E\u003Cbr\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003E  caution \u002B= VData.G \u0026gt; GCAUTION;\u003C/span\u003E\u003Cbr\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003E  warning \u002B= VData.G \u0026gt; GWARN;\u003C/span\u003E\u003Cbr\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003E  caution \u002B= VData.LiquidFuelS/VData.LiquidFuelTotS*100 \u0026lt; FUELCAUTION;\u003C/span\u003E\u003Cbr\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003E  warning \u002B= VData.LiquidFuelS/VData.LiquidFuelTotS*100 \u0026lt; FUELWARN;\u003C/span\u003E\u003Cbr\u003E\u003Cbr\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003E  if (caution != 0)\u003C/span\u003E\u003Cbr\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003E    digitalWrite(YLED,HIGH);\u003C/span\u003E\u003Cbr\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003E  else\u003C/span\u003E\u003Cbr\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003E    digitalWrite(YLED,LOW);\u003C/span\u003E\u003Cbr\u003E\u003Cbr\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003E  if (warning != 0)\u003C/span\u003E\u003Cbr\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003E    digitalWrite(RLED,HIGH);\u003C/span\u003E\u003Cbr\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003E  else\u003C/span\u003E\u003Cbr\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003E    digitalWrite(RLED,LOW);\u003C/span\u003E\u003Cbr\u003E\u003Cbr\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003E  digitalWrite(SASLED,ControlStatus(AGSAS));\u003C/span\u003E\u003Cbr\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003E  digitalWrite(RCSLED,ControlStatus(AGRCS));\u003C/span\u003E\u003Cbr\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003E  digitalWrite(CG1LED,ControlStatus(AGCustom01));\u003C/span\u003E\u003Cbr\u003E\u003Cbr\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003E}\u003C/span\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003EDon\u0027t forget to include AmeliaEatYaheart\u0027s LedControlFunctions tab from \u003C/span\u003E\u003Ca href=\u0022https://www.dropbox.com/s/nmrvrhj1fj0es3v/Demo_for_7segMAX7219_module.zip?dl=0\u0022 rel=\u0022external nofollow\u0022\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003Ethis sketch\u003C/span\u003E\u003C/a\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003E.\u003C/span\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-03-05T10:45:59Z\u0022 title=\u002203/05/2015 10:45  AM\u0022 data-short=\u00229 yr\u0022\u003EMarch 5, 2015\u003C/time\u003E by T.A.P.O.R.\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"bork_bork","CreatedById":137466,"CreatedDateTime":"2015-03-05T16:56:41Z","Content":"\n\u003Cp\u003EVery nice, thanks guys!\u003C/p\u003E\n"},{"CreatedByName":"cm2227","CreatedById":54899,"CreatedDateTime":"2015-03-09T09:59:26Z","Content":"\n\u003Cp\u003EHello Zitronen,\u003C/p\u003E\u003Cp\u003Edo you think it is possible to add a way of enabling or disabling control of inputs with a control packet?\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E\u0026lt;bool name=\u0022ThrottleEnable\u0022\u0026gt;0\u0026lt;/bool\u0026gt;\u003Cbr\u003E\u0026lt;bool name=\u0022PitchEnable\u0022\u0026gt;0\u0026lt;/bool\u0026gt;\u003Cbr\u003E\u0026lt;bool name=\u0022RollEnable\u0022\u0026gt;0\u0026lt;/bool\u0026gt;\u003Cbr\u003E\u0026lt;bool name=\u0022YawEnable\u0022\u0026gt;0\u0026lt;/bool\u0026gt;\u003Cbr\u003E\u0026lt;bool name=\u0022TXEnable\u0022\u0026gt;0\u0026lt;/bool\u0026gt;\u003Cbr\u003E\u0026lt;bool name=\u0022TYEnable\u0022\u0026gt;0\u0026lt;/bool\u0026gt;\u003Cbr\u003E\u0026lt;bool name=\u0022TZEnable\u0022\u0026gt;0\u0026lt;/bool\u0026gt;\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EYou could use one of the additional control bytes bit wise. \u003C/p\u003E\u003Cp\u003EI think it would be a huge advantage for autopilot-style applications, to be able to explicitly switch control from the pilot to the arduino and back by software.\u003C/p\u003E\n"},{"CreatedByName":"marzubus","CreatedById":68021,"CreatedDateTime":"2015-03-09T11:15:54Z","Content":"\n\u003Cp\u003EIs it not enough to use modes 2 or 3 so if the value is ZERO it is ignored?\u003C/p\u003E\u003Cp\u003E // Throttle and axis controls have the following settings:\u003C/p\u003E\u003Cp\u003E // 0: The internal value (supplied by KSP) is always used.\u003C/p\u003E\u003Cp\u003E // 1: The external value (read from serial packet) is always used.\u003C/p\u003E\u003Cp\u003E // 2: If the internal value is not zero use it, otherwise use the external value.\u003C/p\u003E\u003Cp\u003E // 3: If the external value is not zero use it, otherwise use the internal value. \u003C/p\u003E\u003Cp\u003EOr what would be the use-case / user-story here?\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022cm2227\u0022 data-cite=\u0022cm2227\u0022\u003E\u003Cdiv\u003EHello Zitronen,\u003Cp\u003Edo you think it is possible to add a way of enabling or disabling control of inputs with a control packet?\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E\u0026lt;bool name=\u0022ThrottleEnable\u0022\u0026gt;0\u0026lt;/bool\u0026gt;\u003Cbr\u003E\u0026lt;bool name=\u0022PitchEnable\u0022\u0026gt;0\u0026lt;/bool\u0026gt;\u003Cbr\u003E\u0026lt;bool name=\u0022RollEnable\u0022\u0026gt;0\u0026lt;/bool\u0026gt;\u003Cbr\u003E\u0026lt;bool name=\u0022YawEnable\u0022\u0026gt;0\u0026lt;/bool\u0026gt;\u003Cbr\u003E\u0026lt;bool name=\u0022TXEnable\u0022\u0026gt;0\u0026lt;/bool\u0026gt;\u003Cbr\u003E\u0026lt;bool name=\u0022TYEnable\u0022\u0026gt;0\u0026lt;/bool\u0026gt;\u003Cbr\u003E\u0026lt;bool name=\u0022TZEnable\u0022\u0026gt;0\u0026lt;/bool\u0026gt;\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EYou could use one of the additional control bytes bit wise. \u003C/p\u003E\u003Cp\u003EI think it would be a huge advantage for autopilot-style applications, to be able to explicitly switch control from the pilot to the arduino and back by software.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\n"},{"CreatedByName":"cm2227","CreatedById":54899,"CreatedDateTime":"2015-03-09T13:46:59Z","Content":"\n\u003Cp\u003EWell, that\u0027s a little embarrassing. I missed out on the update introducing the control modes. So to say, my problem is already solved! Thanks for pointing that out. Now back to soldering...\u003C/p\u003E\n"},{"CreatedByName":"zitronen","CreatedById":11842,"CreatedDateTime":"2015-03-09T17:22:24Z","Content":"\n\u003Cp\u003EAll right looks like 0.17.1 is working for most people, I will update the first post soon. \u003C/p\u003E\u003Cp\u003EEdit: ok done.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-03-09T21:59:16Z\u0022 title=\u002203/09/2015 09:59  PM\u0022 data-short=\u00229 yr\u0022\u003EMarch 9, 2015\u003C/time\u003E by zitronen\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"marzubus","CreatedById":68021,"CreatedDateTime":"2015-03-10T08:43:44Z","Content":"\n\u003Cp\u003E\nHej Zitronen,\n\u003C/p\u003E\n\u003Cp\u003E\nI have a kerbalstuff page for the Mac/Linux port now.\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-cite=\u0022zitronen\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-username=\u0022zitronen\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nzitronen said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cdiv\u003E\nAll right looks like 0.17.1 is working for most people, I will update the first post soon.\n\u003Cp\u003E\nEdit: ok done.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222021-05-19T18:38:52Z\u0022 title=\u002205/19/2021 06:38  PM\u0022 data-short=\u00223 yr\u0022\u003EMay 19, 2021\u003C/time\u003E by Snark\u003C/strong\u003E\n\u003Cbr\u003ELink to defunct website removed by moderator\n\u003C/span\u003E\n"},{"CreatedByName":"zitronen","CreatedById":11842,"CreatedDateTime":"2015-03-10T19:17:18Z","Content":"\n\u003Cp\u003EDone, thanks.\u003C/p\u003E\n"},{"CreatedByName":"Darkblade48","CreatedById":113269,"CreatedDateTime":"2015-03-11T16:03:32Z","Content":"\n\u003Cp\u003EFirst, I want to thanks zitronen as well as everyone that is working on this project. I think it\u0027s a great way to combine programming, electronics with KSP (all things that I have interest in!) and as such, I\u0027m currently trying to build my own KSP controller with some basic buttons, switches and an Arduino Uno.\u003C/p\u003E\u003Cp\u003EI\u0027m still quite new, and was looking over the KSPIODemo10 example code and was not sure about one thing.\u003C/p\u003E\u003Cp\u003ESo far, I understand that \u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003E\u003Cp\u003E//pins for input\u003C/p\u003E\u003Cp\u003E#define SASPIN 8\u003C/p\u003E\u003Cp\u003E#define RCSPIN 9\u003C/p\u003E\u003Cp\u003E#define CG1PIN 10\u003C/p\u003E\u003Cp\u003E#define THROTTLEPIN 0\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EAre the defined pins for SAS (pin 8), RCS (pin 9) and so forth. Additional pins can be assigned to (say) control groups, lights, gears, brakes, etc relatively easily.\u003C/p\u003E\u003Cp\u003EHowever, I then see another part of the code\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003E\u003Cp\u003E//Input enums\u003C/p\u003E\u003Cp\u003E#define SAS 7\u003C/p\u003E\u003Cp\u003E#define RCS 6\u003C/p\u003E\u003Cp\u003E#define LIGHTS 5\u003C/p\u003E\u003Cp\u003E#define GEAR 4\u003C/p\u003E\u003Cp\u003E#define BRAKES 3\u003C/p\u003E\u003Cp\u003E#define PRECISION 2\u003C/p\u003E\u003Cp\u003E#define ABORT 1\u003C/p\u003E\u003Cp\u003E#define STAGE 0\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI\u0027m not quite sure what these assignments do. Are these pin assignments (i.e. if I wanted to assign (say) lights to pin 7, would this be possible? Though, looking at the top part of the code, it looks like pin 7 is assigned to a red LED for low fuel warning too...)\u003C/p\u003E\n"}]}