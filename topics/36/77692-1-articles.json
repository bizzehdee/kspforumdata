{"TopicId":77692,"ForumId":36,"TopicTitle":"[WIP, Plugin, Parts] (2014-10-16) LaserDist 0.5 for KSP 0.9, Alpha","CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2014-07-15T08:20:07Z","PageNum":1,"Articles":[{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2014-07-15T08:20:07Z","Content":"\n\u003Cp\u003E\u003Cspan style=\u0022font-size:18px;\u0022\u003ELaserDist\u003C/span\u003E\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022font-size:14px;\u0022\u003E[WIP, Plugin, Parts] (2014-10-16) LaserDist 0.5 for KSP 0.9, Alpha\u003C/span\u003E\u003C/p\u003E\u003Cp\u003EReleases:\u003C/p\u003E\u003Cp\u003E* \u003Ca href=\u0022https://github.com/Dunbaratu/LaserDist/releases\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/Dunbaratu/LaserDist/releases\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EZIP Download (See release page above):\u003C/p\u003E\u003Cp\u003E* \u003Ca href=\u0022https://github.com/Dunbaratu/LaserDist/releases/download/v0.4/LaserDist.zip\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/Dunbaratu/LaserDist/releases/download/v0.4/LaserDist.zip\u003C/a\u003E\u003C/p\u003E\u003Cp\u003ESource Code Hosting site:\u003C/p\u003E\u003Cp\u003E* \u003Ca href=\u0022https://github.com/Dunbaratu/LaserDist\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/Dunbaratu/LaserDist\u003C/a\u003E\u003C/p\u003E\u003Cp\u003ELicense:\u003C/p\u003E\u003Cp\u003E* GPL v3\u003C/p\u003E\u003Cp\u003ECopyright \u00A9 2014 Steven Mading (aka Dunbaratu on Github)\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022/cdn-cgi/l/email-protection#cde8fa8fa2bdb9a4a2a3e8fa89\u0022\u003E\u003Cspan class=\u0022__cf_email__\u0022 data-cfemail=\u0022f49995909d9a9387b49399959d98da979b99\u0022\u003E[email\u0026#160;protected]\u003C/span\u003E\u003C/a\u003E\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003E\u003Cspan style=\u0022font-size:14px;\u0022\u003EThis is a very small plugin. It makes a KSP Part that\u003C/span\u003E\u003C/strong\u003E\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003E\u003Cspan style=\u0022font-size:14px;\u0022\u003Emeasures straight line distances by laser.\u003C/span\u003E\u003C/strong\u003E\u003C/p\u003E\u003Cp\u003EThe \u0022Beamer 100x Disto-o-meter\u0022 Part aims a laser in a line\u003C/p\u003E\u003Cp\u003Eand then measures the distance in meters to the first object\u003C/p\u003E\u003Cp\u003Ethe laser hits. The result is displayed in the right-click\u003C/p\u003E\u003Cp\u003Emenu for the part.\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://i.imgur.com/8pMJOLA.png\u0022 alt=\u00228pMJOLA.png\u0022\u003E\u003C/p\u003E\u003Cp\u003EThe laser can work over long distances - here it\u0027s measuring the\u003C/p\u003E\u003Cp\u003Edistance from a Kerbin orbit vessel to the Mun:\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://i.imgur.com/Qrq5Ttl.png\u0022 alt=\u0022Qrq5Ttl.png\u0022\u003E\u003C/p\u003E\u003Cp\u003EAnd even at those very long distances, the lasers can measure\u003C/p\u003E\u003Cp\u003Erather small differences in distace, within reason (it has\u003C/p\u003E\u003Cp\u003Ean accuracy of 2 meters at this extreme range, to keep the\u003C/p\u003E\u003Cp\u003Egame from bogging down too much). In the screenshot below,\u003C/p\u003E\u003Cp\u003Enotice how the two lasers are returning different numbers for\u003C/p\u003E\u003Cp\u003Etheir distance to the terrain very far away:\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://i.imgur.com/WL1FOyG.png\u0022 alt=\u0022WL1FOyG.png\u0022\u003E\u003C/p\u003E\u003Cp\u003EThe direction of the laser is whichever way the laser gun is\u003C/p\u003E\u003Cp\u003Epointed when you mounted it on the craft, as demonstrated here:\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://i.imgur.com/XvLJIHn.png\u0022 alt=\u0022XvLJIHn.png\u0022\u003E\u003C/p\u003E\u003Cp\u003EThe electric draw for the laser is substantial. Each laser consumes\u003C/p\u003E\u003Cp\u003E1 electric charge every 3 seconds that it\u0027s on.\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022font-size:14px;\u0022\u003EWhy does this Mod exist?\u003C/span\u003E\u003C/p\u003E\u003Cp\u003EThe intended purpose of this part is to be used in conjunction with\u003C/p\u003E\u003Cp\u003Escripted autopilots like [kOS](\u003Ca href=\u0022https://github.com/KSP-KOS/KOS/releases\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/KSP-KOS/KOS/releases\u003C/a\u003E), to\u003C/p\u003E\u003Cp\u003Eprovide a way to for you to write scripted pilot software that can\u003C/p\u003E\u003Cp\u003Esee the distance to the ground (or anything else like a ship) along\u003C/p\u003E\u003Cp\u003Ethe laser line. The reason this can be useful is so you can detect\u003C/p\u003E\u003Cp\u003Ethings like terrain slope and mountains in the way. The default\u003C/p\u003E\u003Cp\u003Eradar altimiter in KSP only shows you the distance directly under\u003C/p\u003E\u003Cp\u003Ethe craft.\u003C/p\u003E\u003Cp\u003EIn a nutshell, the purpose is to solve this problem shown in this picture:\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://i.imgur.com/GI3y7yt.png\u0022 alt=\u0022GI3y7yt.png\u0022\u003E\u003C/p\u003E\u003Cp\u003EThis mod can let you read the distance along the blue line in the diagram.\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022font-size:14px;\u0022\u003EWhy isn\u0027t it inside kOS then?\u003C/span\u003E\u003C/p\u003E\u003Cp\u003EThere is more than one KSP mod project for the purpose of letting\u003C/p\u003E\u003Cp\u003Eusers write scripted autopilots. Another such project currently under\u003C/p\u003E\u003Cp\u003Edevelopment is\u003Ca href=\u0022https://github.com/griderd/Jebnix\u0022 rel=\u0022external nofollow\u0022\u003E Jebnix\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EMy goal is to make this part script-engine-agnostic so it works with\u003C/p\u003E\u003Cp\u003Eany such mod. I\u0027ve been working in kOS mostly, but I didn\u0027t want this\u003C/p\u003E\u003Cp\u003Epart to be kOS-specific because there\u0027s no particular reason it has\u003C/p\u003E\u003Cp\u003Eto be.\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022font-size:14px;\u0022\u003EInformation for other modders trying to use the part:\u003C/span\u003E\u003C/p\u003E\u003Cp\u003EAs long as the scripting autopilot is designed to be able to query\u003C/p\u003E\u003Cp\u003Eand/or set KSPFields on parts, it should be able to read the value of\u003C/p\u003E\u003Cp\u003Ethe distance, and turn the laser on and off, as follows:\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://i.imgur.com/NwzwldV.png\u0022 alt=\u0022NwzwldV.png\u0022\u003E\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cul\u003E\u003Cli\u003E KSPField: \u0027Distance\u0027 is a float - the number of meters being shown in the display. It\u0027s -1 if there is currently no hit.\u003Cbr\u003E\u003C/li\u003E\u003Cli\u003E KSPField: \u0027HitName\u0027 is a string - the name of the object being hit.\u003Cbr\u003E\u003C/li\u003E\u003Cli\u003E KSPField: \u0027Activated\u0027 is a bool - true if the measuring device is on. \u003Cbr\u003E\u003C/li\u003E\u003Cli\u003E KSPField: \u0027DrawLaser\u0027 is a bool (called \u0022Visible\u0022 in the GUI) - true if the laser should be drawn when it\u0027s activated or false if it should be (realistically) invisible because, hey, it\u0027s coherent light and it\u0027s not supposed to be seen from the side.\u003Cbr\u003E\u003C/li\u003E\u003Cli\u003E KSPField: \u0027CPUGreedyPercent\u0027 is a float (called \u0022CPU hog\u0022 in the GUI) ranging from 0.0 to 20.0. It\u0027s how much of a single physics tick of time this mod will allow itself to consume during a single Update. If it hasn\u0027t gotten a good enough answer within that much time, it will wait until the next update to continue the calculation.\u003Cbr\u003E\u003C/li\u003E\u003Cli\u003E KSPField: \u0027UpdateAge\u0027 is an integer - It\u0027s how many Unity Updates (animation frames, basically) it\u0027s been since the value you are seeing was calculated. Becuase of the logic of CPUGreedyPercent (see above) sometimes the value being displayed is stale by a few update ticks and shouldn\u0027t be trusted until the next time that UpdateAge becomes zero again. If you\u0027re in a situation where this mod needs to spend more than 1 update of time to get to a good answer for the distance, you\u0027ll see this value spinning a bit, quickly going 0,1,2,3,0,1,2,3,0,1,2,3...etc. When you see that, only when it hit the zeros was the distance value perfectly correct at THAT moment.\u003Cbr\u003ENote: The higher that CPUGreedyPercent (\u0022CPU hog\u0022) is, the less likely it is that UpdateAge will ever be nonzero, but the bigger hit your framerate might take.\u003C/li\u003E\u003C/ul\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022font-size:14px;\u0022\u003EHow to Mount it.\u003C/span\u003E\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://wiki.kerbalspaceprogram.com/w/images/d/dd/Electronics.png\u0022 alt=\u0022Electronics.png\u0022\u003E. The Beamer 100x Dist-o-Meter is located in the \u0022Electronics\u0022 tech node of the career tech tree. It\u0027s a 300-point node on the tree so you might not have it yet in a new fresh career game.\u003C/p\u003E\u003Cp\u003EThe Laser can be mounted anywhere as a surface-mount item. Take care to\u003C/p\u003E\u003Cp\u003Enote the orientation of the laser emiiter. (KSP lets you fine-tune\u003C/p\u003E\u003Cp\u003Ethe rotation of a part by using the SHIFT key while you hit the WASDQE\u003C/p\u003E\u003Cp\u003Ekeys.)\u003C/p\u003E\u003Cp\u003EThe Laser will bounce back and give you a distance measurement when\u003C/p\u003E\u003Cp\u003Eit encounters \u003Cstrong\u003EANY\u003C/strong\u003E object, including parts of your own craft. So\u003C/p\u003E\u003Cp\u003Etake care to mount it somewhere where the laser beam will have a clear\u003C/p\u003E\u003Cp\u003Eline of sight without obstruction. \u003C/p\u003E\u003Cp\u003ETo ensure a good mounting point, you can use \u0022tweakables\u0022 to enable the\u003C/p\u003E\u003Cp\u003Elaser and make it show up in the VAB to look and see if you have it aimed\u003C/p\u003E\u003Cp\u003Ewell.\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022font-size:14px;\u0022\u003ELightspeed \u003C/span\u003E\u003C/p\u003E\u003Cp\u003ENote that if you use it to measure the distance to a far away body (i.e.\u003C/p\u003E\u003Cp\u003Elike aiming it at Duna from Kerbin), the mod does take into account\u003C/p\u003E\u003Cp\u003Elightspeed. You have to hold the laser on an object steady and unchanged\u003C/p\u003E\u003Cp\u003Efor the entire duration of time it takes for lightspeed delay to\u003C/p\u003E\u003Cp\u003Ebounce the signal back or you won\u0027t get a measurement, so using it at that\u003C/p\u003E\u003Cp\u003Egreat distance will be very hard.\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022font-size:14px;\u0022\u003EFUTURE EXPANSION PLANS (i.e. the reason this is a WIP)\u003C/span\u003E\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cul\u003E\u003Cli\u003E \u003Cstrong\u003EMax distance isn\u0027t enforced yet\u003C/strong\u003E: It\u0027s part of a future plan\u003Cbr\u003Eto have different variants of the part that work better the\u003Cbr\u003Ehigher up the tech tree you go. For now, despite what it says,\u003Cbr\u003Ethe range is actually infinite.\u003Cbr\u003E\u003C/li\u003E\u003Cli\u003E \u003Cstrong\u003EOther sorts of sensors?\u003C/strong\u003E: Now that the numerical approximation behind\u003Cbr\u003Emaking a \u0022fake raycast\u0022 that finds intersections with the planet terrain\u003Cbr\u003Efrom far away and from any angle is implemented, this opens up the\u003Cbr\u003Echance that other sorts of long range beam sensors could be made.\u003Cbr\u003EFor example a \u0022biome detector\u0022 that returns the name of the biome\u003Cbr\u003Ewhere the hit occurred is a possibility, as is a \u0022density at a distance\u0022\u003Cbr\u003Emeasurement which might tell you the atmospheric pressure or density\u003Cbr\u003Eat the ground level where the hit occurred. (Maybe because of something\u003Cbr\u003Ethat the laser detects about interference with the air? It\u0027s a bit\u003Cbr\u003Ehard to justify realistically how that would work, but it\u0027s definitely\u003Cbr\u003Epossible with the software. Just not sure if it\u0027s possible in the \u003Cbr\u003Ereal world, or whether real-world sanity is really the intent\u003Cbr\u003Eof this mod or not.\u003Cbr\u003E\u003C/li\u003E\u003C/ul\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E\u003Cspan\u003EHow do I use it from my script then?\u003C/span\u003E\u003C/p\u003E\u003Cp\u003EVery Soon Now the dev team of kOS (of which I\u0027m part) plans to\u003C/p\u003E\u003Cp\u003Ehave a release that lets you read the fields of any part\u0027s KSPFields\u003C/p\u003E\u003Cp\u003E(The stuff you see in the rightclick popup user interface panels), and\u003C/p\u003E\u003Cp\u003Emanipulate any part\u0027s widgets on the rightclick menus (the buttons,\u003C/p\u003E\u003Cp\u003Ethe sliders, etc).\u003C/p\u003E\u003Cp\u003EThe plan from the beginning was to make LaserDist be a good test case\u003C/p\u003E\u003Cp\u003Eof this feature that may actually be useful in its own right.\u003C/p\u003E\u003Cp\u003EBut that\u0027s not released just yet. So at the moment this is only\u003C/p\u003E\u003Cp\u003Eusable as a manual piloting aid where you leave the part menu open\u003C/p\u003E\u003Cp\u003Eand look at it by eye as you fly.\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022font-size:14px;\u0022\u003EPart modeling help?\u003C/span\u003E\u003C/p\u003E\u003Cp\u003EI am aware that the artwork on the model isn\u0027t pretty. I\u0027m a \u003C/p\u003E\u003Cp\u003Eprogrammer, not a graphic artist, and I don\u0027t have experience\u003C/p\u003E\u003Cp\u003Ewith things like Maya and Blender. In fact I just made the model\u003C/p\u003E\u003Cp\u003Eby slapping together some stretched Cube and Cylnder objects in\u003C/p\u003E\u003Cp\u003EUnity itself, without the aid of a modeling program. The model\u003C/p\u003E\u003Cp\u003Eis good enough to work with, but I\u0027d be happy to have someone\u003C/p\u003E\u003Cp\u003Ebetter at art redesign the model. I included the model in\u003C/p\u003E\u003Cp\u003Ethe github directory if you want to have a look.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-04-20T03:02:45Z\u0022 title=\u002204/20/2015 03:02  AM\u0022 data-short=\u00229 yr\u0022\u003EApril 20, 2015\u003C/time\u003E by Steven Mading\u003C/strong\u003E\n\u003Cbr\u003Eforgot to mention it works in 0.9 ages ago.\n\u003C/span\u003E\n"},{"CreatedByName":"Teoman2","CreatedById":113901,"CreatedDateTime":"2014-07-15T08:23:27Z","Content":"\n\u003Cp\u003EWow um, That looks AMAZING. I cant help though, I\u0027m not a programmer. Here, have a scary pic though...\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://i1296.photobucket.com/albums/ag18/Alfie_Bourne/BRINGMETHECHILD_zps444344e1.jpg\u0022 alt=\u0022BRINGMETHECHILD_zps444344e1.jpg\u0022\u003E\u003C/p\u003E\u003Cp\u003EMakes you think twice about jeb\u003C/p\u003E\n"},{"CreatedByName":"Pondafarr","CreatedById":99169,"CreatedDateTime":"2014-07-15T12:01:08Z","Content":"\n\u003Cp\u003EThe part looks TOO good, it should be swapped out to look like a 1950\u0027s style steel flashlight...and duct tape \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2014-07-20T09:31:03Z","Content":"\n\u003Cp\u003EUpdated for KSP 0.24.\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022https://github.com/Dunbaratu/LaserDist/releases/tag/v0.1p5\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/Dunbaratu/LaserDist/releases/tag/v0.1p5\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EThere is literally no difference in how it behaves and the source code wasn\u0027t changed. It was just recompiled.\u003C/p\u003E\u003Cp\u003EIt seems to \u0022work\u0022 as well as it did before.\u003C/p\u003E\n"},{"CreatedByName":"Pondafarr","CreatedById":99169,"CreatedDateTime":"2014-07-20T13:38:58Z","Content":"\n\u003Cp\u003EHave you had any preliminary success with integrating it into KoS? the obvious thing is to include it in a spaceplane terrain following code, and to avoid that damn mountain on reentry landing...\u003C/p\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2014-07-20T14:51:33Z","Content":"\n\u003Cp\u003EThe roadmap for how to integrate this into kOS is this:\u003C/p\u003E\u003Cp\u003E- It\u0027s wrong for kOS to explicitly support this LaserDist with customized code just for LaserDist.\u003C/p\u003E\u003Cp\u003E- It\u0027s wrong for LaserDist to explicitly support kOS with customized code just for kOS.\u003C/p\u003E\u003Cp\u003E- Instead, kOS should implement a \u003Cstrong\u003Egeneric\u003C/strong\u003E way to query/adjust the KSPfields of \u003Cstrong\u003Eany\u003C/strong\u003E part. If it can do this, then it can support LaserDist and a bunch of other things.\u003C/p\u003E\u003Cp\u003E(A KSPField is a single row of the popup box that appears when you rightclick a part).\u003C/p\u003E\u003Cp\u003EI was talking with erendrake and he agrees that this is the best approach. But as to when? I don\u0027t know.\u003C/p\u003E\n"},{"CreatedByName":"Drew Kerman","CreatedById":103177,"CreatedDateTime":"2014-07-21T02:17:30Z","Content":"\n\u003Cp\u003Ewell now, I can see this being useful for advanced terrain auto-guidance with my rover driver software. Egggcellent look forward to when it gets proper kOS integration\u003C/p\u003E\n"},{"CreatedByName":"Boamere","CreatedById":68058,"CreatedDateTime":"2014-07-21T21:55:31Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Teoman2\u0022 data-cite=\u0022Teoman2\u0022\u003E\u003Cdiv\u003ESnip\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EWhat on Eart-kerbin?\u003C/p\u003E\n"},{"CreatedByName":"AndreyATGB","CreatedById":62674,"CreatedDateTime":"2014-07-21T22:17:21Z","Content":"\n\u003Cp\u003EThis looks pretty nice, reading the OP I figure this isn\u0027t within the scope of this mod but I\u0027d really like a mod that can measure lengths in the VAB. The best way to do this right now is to use procedural parts and hover them over stuff.\u003C/p\u003E\n"},{"CreatedByName":"Tyrador","CreatedById":92682,"CreatedDateTime":"2014-07-28T10:06:58Z","Content":"\n\u003Cp\u003EMaybe it would be possible to use this laser for docking alignment? Or even combine/wield stock docking port with these lasers?\u003C/p\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2014-07-28T16:32:05Z","Content":"\n\u003Cp\u003EThis is the algorithm I\u0027m planning on using to solve the PQS terrain hit problem (the fact that Squad appears to have never implemented an API function to find a ray intersect with the PQS terrain - They did create several API methods that seem by their name to do this, but upon using them I\u0027ve discovered that despite their name they actually just find the intersect with the sea-level sphere of the planet, ignoring the PQS terrain entirely.)\u003C/p\u003E\u003Cp\u003EGiven a point in space, I can query KSP and ask it to tell me the PQS terrain below that spot in space. But the math being used to generate that answer is proprietary and hidden, so I can\u0027t solve for the intersect of a ray with the terrain surface function analytically (the math would probably be too ugly to do that anyway even if I could see it). I have to solve for it using a numerical algorithm that approximates the answer.\u003C/p\u003E\u003Cp\u003EThis is how I\u0027m going to try doing it:\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://i.imgur.com/bbSwgEh.png\u0022 alt=\u0022bbSwgEh.png\u0022\u003E\u003C/p\u003E\u003Cp\u003EIf I \u003Cstrong\u003Ereally\u003C/strong\u003E wanted to be clever about it and reduce computational expense, I could try to take advantage of the fact that I know that from one animation frame to the next, the correct answer must necessarily be very close to the previous animation frame\u0027s correct answer, and therefore start the outermost recursion level with an \u0027i\u0027 just one step away from the previous \u0027i\u0027 that hit. (i.e. if on the previous animation frame, I found the hit in slice i=7, then on the next animation frame, don\u0027t start with slice i=0, start with slice i=6, on the assumption that in one animation frame its possible for the correct hit to move across the boundary from one slice to the next, but not possible to move as far as two whole slices in a mere tenth of a second or less.)\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-07-28T16:40:43Z\u0022 title=\u002207/28/2014 04:40  PM\u0022 data-short=\u00229 yr\u0022\u003EJuly 28, 2014\u003C/time\u003E by Steven Mading\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Ralathon","CreatedById":71537,"CreatedDateTime":"2014-07-28T16:53:58Z","Content":"\n\u003Cp\u003EWould it be possible to get a vector displaying the orientation of the laser in addition to the distance?\u003C/p\u003E\u003Cp\u003EOne way I\u0027d want to use this is to put the laser on a infernal robotics hinge and sweep it over the landscape to give KOS a rough heightmap to select landing sites. But it\u0027ll be rather difficult to calculate the lay of the terrain if I don\u0027t have a quick way to fetch the orientation of the laser.\u003C/p\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2014-07-28T17:36:41Z","Content":"\n\u003Cp\u003EI\u0027d thought of how it would be nice to combine this with Infernal Robotics to dynamically aim the laser. I\u0027m glad someone wants to pursue that and I\u0027d love to see the results.\u003C/p\u003E\u003Cp\u003EAs to how to read the vector, what I\u0027d rather do is instead of making an exception for LaserDist, make it so that kOS can read the orientation of *any* part. It\u0027s already possible in kOS to apply a Rotation to a Vector, so if you could read the orientation rotation of any generic part, then in principle it would be possible to get the rotation transform of the LaserDist part, then apply that rotation to the unit vector V(0,-1, 0) (negative Y is the default \u0022down\u0022 orientation of the laser before it is rotated by the part\u0027s current transform).\u003C/p\u003E\u003Cp\u003Eerendrake and I were discussing this and it is a thing we want to do - be able to read position and orientation information of any part on a vessel.\u003C/p\u003E\n"},{"CreatedByName":"erendrake","CreatedById":57164,"CreatedDateTime":"2014-07-29T20:28:47Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Steven Mading\u0022 data-cite=\u0022Steven Mading\u0022\u003E\u003Cdiv\u003Ebe able to read position and orientation information of any part on a vessel.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThis is something i am already working on right now, that is of course once i get off my ass and start working on kOS again.\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022https://github.com/KSP-KOS/KOS/issues/169\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/KSP-KOS/KOS/issues/169\u003C/a\u003E\u003C/p\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2014-07-30T23:54:29Z","Content":"\n\u003Cp\u003ENew release: \u003Ca href=\u0022https://github.com/Dunbaratu/LaserDist/releases/tag/v0.2\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/Dunbaratu/LaserDist/releases/tag/v0.2\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EThis has a crudimentary PQS terrain solver. It\u0027s still not perfect and occasionally does not register hits. That\u0027s because the computation expense of getting it perfect is not something I\u0027m willing to burden the game engine with (it would take about a thousand iterations to be sure it always worked perfectly) As it is, I only use 100 iterations, which can cause it to occasionally miss a mountain because it falls in-between sample points of the algorithm.\u003C/p\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2014-10-06T10:54:11Z","Content":"\n\u003Cp\u003E\u003Cspan style=\u0022font-size:14px;\u0022\u003Ev0.3 Now ready for kOS when kOS Fields released?\u003C/span\u003E\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://i.imgur.com/Qrq5Ttl.png\u0022 alt=\u0022Qrq5Ttl.png\u0022\u003E\u003C/p\u003E\u003Cp\u003EA lot has been fixed up and redone about the low-level numeric approximation algorithm (the \u0022PQS raycast solver\u0022). That\u0027s the bit that deals with the fact that none of KSP\u0027s built-in APIs actually find raycast intersections with the terrain when the terrain is far away and thus not \u0022fully\u0022 loaded. (Even though some are named as if they would, they don\u0027t. They only find intersection with the sea level sphere under the terrain.) \u003Cimg src=\u0022http://i.imgur.com/WL1FOyG.png\u0022 alt=\u0022WL1FOyG.png\u0022\u003E\u003C/p\u003E\u003Cp\u003EChanges to the homebrewed PQS raycasting algorightm:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cul\u003E\u003Cli\u003E **tighter \u002B/- error level**: When the terrain is far enough way not to be fully loaded, so that my PQS aproximater raycaster has to be used, the new \u0022epsilon\u0022 is 2 meters. (This is the accuracy level for the numeric approximizer. When it gets a value within 2 meters of the right answer it quits and gives you that. It used to be 5 meters).\u003Cbr\u003E\u003C/li\u003E\u003Cli\u003E **less hogging of the limited CPU time**: When it has to fallback to the PQS approximate raycaster, it now limits its CPU usage based on how LONG it\u0027s taking rather than on other guesses. It actually watches a stopwatch and limits itself to a thin slice of the total time one physics update is meant to take - so other mods and the main game can have their time too.\u003Cbr\u003E\u003C/li\u003E\u003Cli\u003E **algorithm can now spread across updates**: To allow less hogging of the CPU time, it now can store its state in the algorithm and then come back to it in the next update tick. So when the time is exceeded and it doesn\u0027t have a good answer yet, it now waits for the next update to pick up where it left off. This means that getting an answer can sometimes now take a few updates to obtain. A manual player won\u0027t see the difference, but an autopilot script needs to know about this.\u003Cbr\u003E\u003C/li\u003E\u003C/ul\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://i.imgur.com/NwzwldV.png\u0022 alt=\u0022NwzwldV.png\u0022\u003E New fields on the rightclick panel:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cul\u003E\u003Cli\u003E **CPU hog** - a number from 2 to 20 - editable - This lets you set the balance between getting answers fast versus being nice to the rest of the game and trying not to take too much time during an animation frame. If you want faster updates to the Distance readout, set this higher. If the mod is stealing your framerate and becoming a problem, set this lower. If you want to permanently change this value and not constantly adjust it, change the setting \u0060\u0060\u0060CPUGreedyPercent\u0060\u0060\u0060 in the part.cfg file for the laser.\u003Cbr\u003E\u003C/li\u003E\u003Cli\u003E **Update Age** - integer - readonly - How many animation frame updates has it been since the value in the Distance field was up to date? If this value is bigger than zero, then that means you are looking at slightly stale data. In normal operation it should be zero when near the terrain, and then when higher up it will spin from 0 to 1 to 2 to 3 to 4 or so and then back to 0 again - very fast. This lets you know how slow your updates are from the solver. If you want quicker updating, you have to set **CPU hog** higher.\u003Cbr\u003E\u003C/li\u003E\u003C/ul\u003E\u003Cp\u003E\u003C/p\u003E\n"},{"CreatedByName":"GeoPhizzix","CreatedById":98946,"CreatedDateTime":"2014-10-06T13:07:59Z","Content":"\n\u003Cp\u003ELooks useful, will have to try this out as soon as I am given the chance.\u003C/p\u003E\n"},{"CreatedByName":"erendrake","CreatedById":57164,"CreatedDateTime":"2014-10-06T16:15:10Z","Content":"\n\u003Cp\u003EThis is looking better and better, good work Steven!\u003C/p\u003E\n"},{"CreatedByName":"hieywiey","CreatedById":99098,"CreatedDateTime":"2014-10-07T00:20:03Z","Content":"\n\u003Cp\u003ECan this also be used to get a small amount of science from, for example finding the distance between Kerbin and [insert Planet/Moon/Asteroid Name Here], being worth more science for bodies that are farther away?\u003C/p\u003E\n"},{"CreatedByName":"Camacha","CreatedById":59088,"CreatedDateTime":"2014-10-07T02:06:00Z","Content":"\n\u003Cp\u003EI totally missed this. Very cool. I am still very tempted to do a comprehensive suite of different sensors, but I cannot justify the investment in time that would take, as I am already short on time for my daily duties and plans.\u003C/p\u003E\u003Cp\u003EMaybe I should write what I envision down so that other people can run with it.\u003C/p\u003E\n"},{"CreatedByName":"RoverDude","CreatedById":105198,"CreatedDateTime":"2014-10-07T02:31:15Z","Content":"\n\u003Cp\u003EBeautiful \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003ELet me know if you still need a model, I\u0027ll donate one.\u003C/p\u003E\n"},{"CreatedByName":"SkyHook","CreatedById":31496,"CreatedDateTime":"2014-10-07T02:36:11Z","Content":"\n\u003Cp\u003EIf this works in the VAB, it\u0027s gold.\u003C/p\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2014-10-07T03:19:03Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022hieywiey\u0022 data-cite=\u0022hieywiey\u0022\u003E\u003Cdiv\u003ECan this also be used to get a small amount of science from, for example finding the distance between Kerbin and [insert Planet/Moon/Asteroid Name Here], being worth more science for bodies that are farther away?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EMaybe someday. At the moment it would be a bit of a break of game balance because right now the laser is infinite distance. Also, for the really far objects it will start running into the problem that Unity is doing everything in single-precision floats and not doubles. I suspect that it will get to the point where you just don\u0027t have enough finite control to keep the laser aimed on the tiny fraction of a degree arc where there\u0027s a hit.\u003C/p\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2014-10-07T03:20:31Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022RoverDude\u0022 data-cite=\u0022RoverDude\u0022\u003E\u003Cdiv\u003EBeautiful \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003Cp\u003ELet me know if you still need a model, I\u0027ll donate one.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EIf you\u0027re interested, here is where I\u0027ve got the model I do have, and the readme describes where the \u0022hotspots\u0022 in it are (where it attaches, and where the code expects to draw the laserbeam from):\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022https://github.com/Dunbaratu/LaserDist/tree/master/UnityModel\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/Dunbaratu/LaserDist/tree/master/UnityModel\u003C/a\u003E\u003C/p\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2014-10-09T06:26:03Z","Content":"\n\u003Cp\u003ERelease 0.4:\u003C/p\u003E\u003Cp\u003EAdded support for KSP-AVC mod (version checker) and KSP 0.25\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022https://github.com/Dunbaratu/LaserDist/releases\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/Dunbaratu/LaserDist/releases\u003C/a\u003E\u003C/p\u003E\n"}]}