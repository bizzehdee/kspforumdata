{"TopicId":162200,"ForumId":36,"TopicTitle":"[WIP][1.8.1, 1.9.1, 1.10.1, 1.11.0\u20132, 1.12.2\u20135] Principia\u2014version \u200E\u200EKleene, released 2024-07-05\u2014n-Body and Extended Body Gravitation","CreatedByName":"eggrobin","CreatedById":4680,"CreatedDateTime":"2014-02-05T00:19:35Z","PageNum":6,"Articles":[{"CreatedByName":"FanaticalFighter","CreatedById":77314,"CreatedDateTime":"2014-02-11T15:42:28Z","Content":"\n\u003Cp\u003EI downloaded and compiled the .dlls. (actually, I downloaded, tried to read the code, didn\u0027t get it at all, then compiled and ran xD) \u003C/p\u003E\u003Cp\u003EAnyway, I wanted to ask, why are the projections so... triangly? For me, most orbits (LKO, LMO) are pretty much straight lines going through the planet and making a star-ish pattern. ??\u003C/p\u003E\n"},{"CreatedByName":"bulletrhli","CreatedById":55960,"CreatedDateTime":"2014-02-11T16:21:01Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022FanaticalFighter\u0022 data-cite=\u0022FanaticalFighter\u0022\u003E\u003Cdiv\u003EI downloaded and compiled the .dlls. (actually, I downloaded, tried to read the code, didn\u0027t get it at all, then compiled and ran xD) \u003Cp\u003EAnyway, I wanted to ask, why are the projections so... triangly? For me, most orbits (LKO, LMO) are pretty much straight lines going through the planet and making a star-ish pattern. ??\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EHow do you even compile the code \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif\u0022 alt=\u0022:P\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"eggrobin","CreatedById":4680,"CreatedDateTime":"2014-02-11T16:44:39Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022FanaticalFighter\u0022 data-cite=\u0022FanaticalFighter\u0022\u003E\u003Cdiv\u003EI downloaded and compiled the .dlls. (actually, I downloaded, tried to read the code, didn\u0027t get it at all, then compiled and ran xD) \u003Cp\u003EAnyway, I wanted to ask, why are the projections so... triangly? For me, most orbits (LKO, LMO) are pretty much straight lines going through the planet and making a star-ish pattern. ??\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI\u0027m downsampling by a factor of 100 to plot the trajectories in order to improve performance and reduce memory usage (I probably don\u0027t need to for such short predictions, but I didn\u0027t really think about it when I typed 100; I need that for predictions over a decade). As a result, fast orbits look polygonal (you get 1 point every ks). Eventually, smarter downsampling (velocity-dependent) should be implemented, as well as something more advanced than LineRenderers. In the meantime, I have pushed a new version that should somewhat alleviate this (by reducing the downsampling to 100 seconds from 1000 seconds).\u003C/p\u003E\u003Cp\u003EThe barycentric coordinates are also somewhat broken (you\u0027ll occasionally see obvious jumps in the trajectory). I suspect this comes from Unity\u0027s Quaternion. I am using Quaternion rather than QuaternionD because the obsolete radian-based methods are not implemented for QuaternionD; I don\u0027t trust either---why should I trust something that thinks constantly converting between radians and degrees is a good thing---, I\u0027ll just write my own versor.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-02-11T16:47:38Z\u0022 title=\u002202/11/2014 04:47  PM\u0022 data-short=\u002210 yr\u0022\u003EFebruary 11, 2014\u003C/time\u003E by eggrobin\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Taki117","CreatedById":89975,"CreatedDateTime":"2014-02-11T16:45:15Z","Content":"\n\u003Cp\u003EStupid Question: Does this fix the SoI\u0027s making Lagrange points possible?\u003C/p\u003E\n"},{"CreatedByName":"rhoark","CreatedById":57151,"CreatedDateTime":"2014-02-11T18:51:59Z","Content":"\n\u003Cp\u003EI\u0027d leave station keeping as an exercise for the user, with kOS and NeverUnload. Enabling the physics is enough without doing the pilot\u0027s job for them.\u003C/p\u003E\n"},{"CreatedByName":"mikeydz","CreatedById":93894,"CreatedDateTime":"2014-02-11T19:38:04Z","Content":"\n\u003Cp\u003EOnce this progresses into a playable state, yes. Lagrange points will become possible. Eagerly waiting and watching this.\u003C/p\u003E\n"},{"CreatedByName":"eggrobin","CreatedById":4680,"CreatedDateTime":"2014-02-11T20:39:12Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022rhoark\u0022 data-cite=\u0022rhoark\u0022\u003E\u003Cdiv\u003EI\u0027d leave station keeping as an exercise for the user, with kOS and NeverUnload. Enabling the physics is enough without doing the pilot\u0027s job for them.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThere would be quite a bit of stationkeeping to do (maintaining a couple dozen LKO satellites in LKO with orbital decay, keeping stuff around Lagrange points etc.), so this would get quite tedious. Moreover, stationkeeping has to be done quite regularly. If you had to do it yourself (or, even if that were automated by kOS, if kOS did the stationkeeping by loading the vessels), you couldn\u0027t timewarp for very long, rendering interplanetary missions impractical. In addition, NeverUnload is not a solution: the floating origin stays where it is and Unity physics is done in single precision, so if the active vessel is on Duna, a vessel performing stationkeeping in LKO would jump 2km at a time. Needless to say, instead of performing a minor correction to its orbit, it would end up in a random orbit (or crash on Kerbin). Finally, stationkeeping is way harder than you seem to think, see \u003Cstrong\u003Ethorfinn\u003C/strong\u003E\u0027s post. You can\u0027t conceivably write the gradient descent you\u0027d need to minimise this cost function in kOS, not to mention an integrator. You\u0027d need a full-fledged programming language and a few weeks of careful coding (not counting the time to do research, and assuming you have experience in numerical math) in order to write your stationkeeping algorithm. You\u0027d basically be writing a 1000-line plugin that does stationkeeping. While this is fun, and I recommend you read the papers and my eventual implementation, I\u0027m not sure this is a good idea from a gameplay perspective. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EAs a conclusion: you need stationkeeping, you need it to be automated, you can\u0027t load the vessel to do stationkeeping and kOS wouldn\u0027t do as programming language.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-02-12T02:13:46Z\u0022 title=\u002202/12/2014 02:13  AM\u0022 data-short=\u002210 yr\u0022\u003EFebruary 12, 2014\u003C/time\u003E by eggrobin\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"ddenis","CreatedById":89784,"CreatedDateTime":"2014-02-13T11:35:53Z","Content":"\n\u003Cp\u003EJust one very important thing to consider which could be lost and about which I haven\u0027t found anything in the thread.\u003C/p\u003E\u003Cp\u003EScience will require some work on it too.\u003C/p\u003E\u003Cp\u003EBecause now High Orbit science is defined by the sphere of influence in which the vessel is, but what will be with N-bodies? Would the vessel still have such parameter, it would be measured by distance to body?\u003C/p\u003E\n"},{"CreatedByName":"AndreyATGB","CreatedById":62674,"CreatedDateTime":"2014-02-13T12:33:18Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022ddenis\u0022 data-cite=\u0022ddenis\u0022\u003E\u003Cdiv\u003EJust one very important thing to consider which could be lost and about which I haven\u0027t found anything in the thread.\u003Cp\u003EScience will require some work on it too.\u003C/p\u003E\u003Cp\u003EBecause now High Orbit science is defined by the sphere of influence in which the vessel is, but what will be with N-bodies? Would the vessel still have such parameter, it would be measured by distance to body?\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ESOIs are a real thing, I don\u0027t see the problem. An SOI is by definition when a planet is affecting you the most (the point after which the Earth has more effects than the Sun is considered Earth\u0027s SOI).\u003C/p\u003E\n"},{"CreatedByName":"ddenis","CreatedById":89784,"CreatedDateTime":"2014-02-13T12:47:02Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022AndreyATGB\u0022 data-cite=\u0022AndreyATGB\u0022\u003E\u003Cdiv\u003ESOIs are a real thing, I don\u0027t see the problem. An SOI is by definition when a planet is affecting you the most (the point after which the Earth has more effects than the Sun is considered Earth\u0027s SOI).\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI, also, don\u0027t see problems, just added one thing just to not forget. If author hasn\u0027t considered it before. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"thorfinn","CreatedById":8349,"CreatedDateTime":"2014-02-13T18:06:14Z","Content":"\n\u003Cp\u003EIt might just be a slightly squashed sphere from now on \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"eggrobin","CreatedById":4680,"CreatedDateTime":"2014-02-13T20:56:24Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022ddenis\u0022 data-cite=\u0022ddenis\u0022\u003E\u003Cdiv\u003EJust one very important thing to consider which could be lost and about which I haven\u0027t found anything in the thread.\u003Cp\u003EScience will require some work on it too.\u003C/p\u003E\u003Cp\u003EBecause now High Orbit science is defined by the sphere of influence in which the vessel is, but what will be with N-bodies? Would the vessel still have such parameter, it would be measured by distance to body?\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EFrom the game\u0027s point of view, the SOIs are still here and the biomes should still work like they did. It\u0027s just that I\u0027m moving stuff around instead of letting the game do its thing, and I\u0027m ignoring SOIs.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022AndreyATGB\u0022 data-cite=\u0022AndreyATGB\u0022\u003E\u003Cdiv\u003EAn SOI is by definition when a planet is affecting you the most (the point after which the Earth has more effects than the Sun is considered Earth\u0027s SOI).\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EIt\u0027s actually really messy to define properly. There are mostly three definitions for the SOI of a body---for concreteness, let\u0027s call it Earth (in a system with two massive bodies: the Earth and the Sun), \u003C/p\u003E\u003Cul\u003E\u003Cli\u003EThe sphere of attraction is the region in which the force exerted by the Earth is greater than that exerted by the Sun. It is tiny and mostly useless (the Moon is outside of Earth\u0027s sphere of attraction with respect to the Sun).\u003Cbr\u003E\u003C/li\u003E\u003Cli\u003EThe sphere of action, or Laplace sphere (Laplace 1799) is a tad more complicated to define, and finding the definition on the internet takes a while: look at the unperturbed problem of a (massless) test particle orbiting the Earth, and consider the position \u003Cem\u003Er\u003C/em\u003E\u003Csub\u003EEarth\u003C/sub\u003E of the test particle relative to the center of the Earth. The particle undergoes some acceleration \u003Cem\u003Er\u003C/em\u003E\u0022\u003Csub\u003EEarth\u003C/sub\u003E = \u003Cem\u003Ea\u003C/em\u003E\u003Csub\u003EEarth\u003C/sub\u003E. Now add the Sun. Call \u003Cem\u003Ep\u003C/em\u003E\u003Csub\u003EEarth\u003C/sub\u003E the resulting change in the second derivative of \u003Cem\u003Er\u003C/em\u003E\u003Csub\u003EEarth\u003C/sub\u003E (it\u0027s the \u003Cem\u003Eperturbation\u003C/em\u003E due to the Sun of the 2-body approximation of the relative motion of the test particle and the Earth). Similarly, define \u003Cem\u003Ea\u003C/em\u003E\u003Csub\u003ESun\u003C/sub\u003E and \u003Cem\u003Ep\u003C/em\u003E\u003Csub\u003ESun\u003C/sub\u003E. The sphere of influence of the Earth is the region where the acceleration to perturbation ratio for the Earth is smaller than the corresponding ratio for the Sun, namely,\u003Cbr\u003E\u003Cem\u003Ea\u003C/em\u003E\u003Csub\u003EEarth\u003C/sub\u003E/\u003Cem\u003Ep\u003C/em\u003E\u003Csub\u003EEarth\u003C/sub\u003E \u0026lt; \u003Cem\u003Ea\u003C/em\u003E\u003Csub\u003ESun\u003C/sub\u003E/\u003Cem\u003Ep\u003C/em\u003E\u003Csub\u003ESun\u003C/sub\u003E.\u003Cbr\u003EIn this region, the 2-body approximation around \u003Cem\u003EB\u003C/em\u003E\u003Csub\u003E1\u003C/sub\u003E is better than the 2-body approximation around \u003Cem\u003EB\u003C/em\u003E\u003Csub\u003E2\u003C/sub\u003E.\u003Cbr\u003EThe sphere of action is larger than the sphere of attraction. This is the SOI used by KSP.\u003Cbr\u003E\u003C/li\u003E\u003Cli\u003EThe proper definition for the Hill sphere is slightly more involved. The idea is that when your orbital energy (in the corotating frame of reference for the CR3BP) is low enough (and you\u0027re close to the Earth), there is a bounded region around the Earth that you can\u0027t leave. If you keep increasing your orbital energy, there\u0027s a point where this region will include the Lagrange point L1 and will suddenly expand so that you are able to reach the sun: when you have this orbital energy, conservation of energy does no longer prevent you from escaping the Earth. Just before this happens, the region around the Earth that you can\u0027t leave (which extends up to L1) is the Hill sphere; it\u0027s the region inside the equipotential through L1 (on the Earth side).\u003Cbr\u003EIf you want to visualise this, look at the image below (the rotational potential of the CR3BP) and imagine having a horizontal surface of water that rises on this weird hill with two holes. Say you are on a boat in the tiny lake around Earth. The area where there is water is the area where your orbital energy allows you to go (by trading kinetic energy for potential energy).\u003Cbr\u003EYou could be in the lake around the sun, but there is a mountain pass at L1 between the two lakes preventing you from going from one to the other. As the water (the orbital energy) rises, there is a moment where the lowest point of that mountain pass (L1) is submerged. From then on there is nothing preventing you from going to the Sun. Just before the lakes merge, the lake around Earth is its Hill sphere. Page 580 of \u003Ca href=\u0022http://www2.esm.vt.edu/~sdross/papers/multiple_gravity_assists.pdf\u0022 rel=\u0022external nofollow\u0022\u003Ethis paper by Ross \u0026amp; Scheeres 2007\u003C/a\u003E shows the shape of the forbidden regions depending on the energy (\u003Cem\u003EC\u003C/em\u003E\u003Csub\u003EJ\u003C/sub\u003E = -2 \u003Cem\u003EH\u003C/em\u003E, where \u003Cem\u003EH\u003C/em\u003E is the energy, because astronomers are weird and count the energy backwards). The Hill sphere is larger than the Laplace sphere.\u003Cbr\u003E\u003Ca href=\u0022https://en.wikipedia.org/wiki/File:Lagrangian_points_equipotential.jpg\u0022 rel=\u0022external nofollow\u0022\u003E\u003Cimg src=\u0022https://upload.wikimedia.org/wikipedia/commons/thumb/5/5f/Lagrangian_points_equipotential.jpg/220px-Lagrangian_points_equipotential.jpg\u0022 alt=\u0022220px-Lagrangian_points_equipotential.jpg\u0022\u003E\u003C/a\u003E\u003Cbr\u003E\u003C/li\u003E\u003C/ul\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EIt should be noted that Jupiter has quite a few satellites outside of its Hill sphere, so having an energy below that of L1 is not a required condition for having a stable orbit.\u003C/p\u003E\u003Cp\u003EThe Laplace sphere is mostly useful for determining which patched conic approximation to use (this is why it was defined together with the patched conic approximation by Laplace in his \u003Cem\u003ETrait\u00C3\u0192\u00C2\u00A9 de m\u00C3\u0192\u00C2\u00A9canique c\u00C3\u0192\u00C2\u00A9leste\u003C/em\u003E).\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022thorfinn\u0022 data-cite=\u0022thorfinn\u0022\u003E\u003Cdiv\u003EIt might just be a slightly squashed sphere from now on \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EIndeed, none of these are actually spheres (the first two get more spherical as the ratio of the small mass to the larger goes to 0, but the Hill sphere remains pinched at L1).\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-02-13T22:48:23Z\u0022 title=\u002202/13/2014 10:48  PM\u0022 data-short=\u002210 yr\u0022\u003EFebruary 13, 2014\u003C/time\u003E by eggrobin\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"FanaticalFighter","CreatedById":77314,"CreatedDateTime":"2014-02-14T03:18:07Z","Content":"\n\u003Cp\u003EBTW, eggrobin, how are you handling maneuvre nodes for Principia?\u003C/p\u003E\n"},{"CreatedByName":"CaptainKipard","CreatedById":70516,"CreatedDateTime":"2014-02-14T05:12:10Z","Content":"\n\u003Cp\u003EI\u0027m eagerly waiting for a mod that sees Kerbol gain a companion star with its own planets and whatnot.\u003C/p\u003E\n"},{"CreatedByName":"eggrobin","CreatedById":4680,"CreatedDateTime":"2014-02-15T03:21:32Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022FanaticalFighter\u0022 data-cite=\u0022FanaticalFighter\u0022\u003E\u003Cdiv\u003EBTW, eggrobin, how are you handling maneuvre nodes for Principia?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EBy adding them to the \u0027further modding\u0027 list. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EThere are quite a few things I will want to show on the predicted trajectory using interactive markers (you should be able to click on them to get more details).\u003C/p\u003E\u003Cp\u003EExamples include aerodynamic events (free molecular flow to fluid flow transition, Mach numbers, instability), stationkeeping burns, long-duration burns (start and end). A maneuver node can be such a marking. When tweaking it, the new trajectory is computed using the dynamic integration (I really don\u0027t like this name, can someone come up with something nicer?). As for the interface for tweaking it, I think I\u0027ll go with a window and sliders; the current system has ergonomic issues. An interesting question is that of the axes. In stock KSP, we are always in a Keplerian orbit, so it makes sense to see burns as a linear combination of prograde, radial and normal. This will also work for strongly bound orbits. For weakly bound orbits, other axes may be useful.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Cpt. Kipard\u0022 data-cite=\u0022Cpt. Kipard\u0022\u003E\u003Cdiv\u003EI\u0027m eagerly waiting for a mod that sees Kerbol gain a companion star with its own planets and whatnot.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ERemember that double precision limits the size of the system. The resolution with a 53-bit mantissa at the aphelion of Pluto is 0.8 mm, so you can\u0027t do much bigger.\u003C/p\u003E\u003Cp\u003EIf I were to use extended precision (which is slower, as x87 is a scalar FPU, but I don\u0027t know how critical performance will end up being), the resolution at 1 light-year would be 0.5 mm. This would be much nicer for RSS.\u003C/p\u003E\u003Cp\u003EIf performance really isn\u0027t an issue, I could try double-double (implemented in software, so an order of magnitude slower), which would give me an error of 0.01 mm at the edge of the observable universe (though for systems that big you\u0027d really want GR, and I don\u0027t want to look at the curvature of that rabbit hole).\u003C/p\u003E\u003Cp\u003EI could talk about IEEE 754 quads, whose error at the edge of the observable universe would be 87 nm, but this is getting rather silly unless you\u0027re interested in molecular dynamics at the scale of superclusters.\u003C/p\u003E\u003Cp\u003EAnyway, I\u0027m not currently in the planet-making business, and I hear PFCE is rather buggy (e.g. compatibility with FAR or lack thereof). I\u0027m not sure if the problem of making a fully functional star, i.e., a star which is a light source, feeds the solar panels, etc. has been solved either.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-02-15T03:32:49Z\u0022 title=\u002202/15/2014 03:32  AM\u0022 data-short=\u002210 yr\u0022\u003EFebruary 15, 2014\u003C/time\u003E by eggrobin\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"FanaticalFighter","CreatedById":77314,"CreatedDateTime":"2014-02-15T03:58:26Z","Content":"\n\u003Cp\u003E@Eggrobin:\u003C/p\u003E\u003Cp\u003ESo essentially, you\u0027re telling me that we\u0027ll have finite burns maneuver nodes? I can\u0027t stop grinning at that, that\u0027ll make ion engine probes and long nuclear burns so much easier to predict. But then, with long duration burns, you\u0027ll want to decide whether the orientation of the craft remains fixed, or keeps pointing prograde, or what not. (For example, does the craft point at a fixed point in space while burning, or does it change its orientation to stay exactly on, say prograde or something)\u003C/p\u003E\n"},{"CreatedByName":"eggrobin","CreatedById":4680,"CreatedDateTime":"2014-02-15T10:59:43Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022FanaticalFighter\u0022 data-cite=\u0022FanaticalFighter\u0022\u003E\u003Cdiv\u003E@Eggrobin:\u003Cp\u003ESo essentially, you\u0027re telling me that we\u0027ll have finite burns maneuver nodes? I can\u0027t stop grinning at that, that\u0027ll make ion engine probes and long nuclear burns so much easier to predict. But then, with long duration burns, you\u0027ll want to decide whether the orientation of the craft remains fixed, or keeps pointing prograde, or what not. (For example, does the craft point at a fixed point in space while burning, or does it change its orientation to stay exactly on, say prograde or something)\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThis pretty much has to exist since thrust through timewarp is planned. I guess I\u0027ll need to have a few options as far as orientation is concerned (thrust through timewarp has to be automated, since you can\u0027t control the ship directly during timewarp).\u003C/p\u003E\n"},{"CreatedByName":"thorfinn","CreatedById":8349,"CreatedDateTime":"2014-02-15T13:47:33Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003E\u003Cspan style=\u0022color:#333333;\u0022\u003ERemember that double precision limits the size of the system. The resolution with a 53-bit mantissa at the aphelion of Pluto is 0.8 mm, so you can\u0027t do much bigger \u003C/span\u003E[...]\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI think he was talking about a multiple star system, that shouldn\u0027t have such pressing issues: the other stars would be within a few dozen AU, and Kerbal-scaled AU at that.\u003C/p\u003E\u003Cp\u003EIf separated star systems were ever to be implemented, I think that making each system its own island and considering interstellar flight a special case would be the sensible choice: there is literally nothing of interest in the void between stars after all...\u003C/p\u003E\n"},{"CreatedByName":"eggrobin","CreatedById":4680,"CreatedDateTime":"2014-02-17T01:56:08Z","Content":"\n\u003Cp\u003E\u003Cstrong\u003EStatus update:\u003C/strong\u003E\u003C/p\u003E\u003Cp\u003EI have finally managed to work on this a bit over the weekend.\u003C/p\u003E\u003Cp\u003EExtensive experimentation has failed to yield a better velocity, so we are stuck with computing the proper acceleration from the rather mysterious Vessel.obt_velocity for now (for some reason in whatever reference frame this velocity is in, the geometric accelerations are as expected, except for the Coriolis acceleration which is halved \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_huh.gif\u0022 alt=\u0022:confused:\u0022\u003E).\u003C/p\u003E\u003Cp\u003EThis yields roughly the same results as Vessel.perturbation without the moving average.\u003C/p\u003E\u003Cp\u003EThe same experiments have further shown that a na\u00C3\u0192\u00C2\u00AFve low-pass filter will not be enough to remove Unity\u0027s silliness. For instance, one finds the proper acceleration is strongly correlated with the rotation rate of the ship. Smarter post-processing will be needed.\u003C/p\u003E\u003Cp\u003EI shall now attempt to actually integrate whatever proper acceleration I have managed to grab.\u003C/p\u003E\u003Cp\u003EI also wrote \u003Ca href=\u0022https://github.com/eggrobin/Principia/blob/master/Documentation/ODEs%20and%20Runge-Kutta%20integrators.pdf?raw=true\u0022 rel=\u0022external nofollow\u0022\u003Ethe first explanatory post, which describes ODEs and Runge-Kutta methods (PDF)\u003C/a\u003E.\u003C/p\u003E\u003Cp\u003EI have tried not only to explain \u003Cem\u003Ehow\u003C/em\u003E Runge-Kutta methods work (this can easily be found on \u003Cem\u003EWikipedia\u003C/em\u003E) but \u003Cem\u003Ewhy\u003C/em\u003E they have this structure.\u003C/p\u003E\u003Cp\u003EHopefully you will find it interesting.\u003C/p\u003E\n"},{"CreatedByName":"Tuna-Fish","CreatedById":103717,"CreatedDateTime":"2014-02-17T15:29:18Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022eggrobin\u0022 data-cite=\u0022eggrobin\u0022\u003E\u003Cdiv\u003E\u003Cp\u003ERemember that double precision limits the size of the system. The resolution with a 53-bit mantissa at the aphelion of Pluto is 0.8 mm, so you can\u0027t do much bigger.\u003C/p\u003E\u003Cp\u003EIf I were to use extended precision (which is slower, as x87 is a scalar FPU, but I don\u0027t know how critical performance will end up being), the resolution at 1 light-year would be 0.5 mm. This would be much nicer for RSS.\u003C/p\u003E\u003Cp\u003EIf performance really isn\u0027t an issue, I could try double-double (implemented in software, so an order of magnitude slower), which would give me an error of 0.01 mm at the edge of the observable universe (though for systems that big you\u0027d really want GR, and I don\u0027t want to look at the curvature of that rabbit hole).\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EIn my experience, a ghetto double double (11 bit exponent, 106 bit mantissa, implemented as a sum of two doubles, the smaller of which always has an exponent 53 less than the bigger) is nowhere near order of magnitude slower than x87 80bit, and can in some situations be faster, depending on the compiler, as the x87 stack is not always handled gracefully.\u003C/p\u003E\u003Cp\u003ESomething like representing location as a double double and velocity as a double would give you much greater precision than plain doubles while still not being that much slower.\u003C/p\u003E\u003Cp\u003EX = Xa \u002B Xb\u003C/p\u003E\u003Cp\u003EX\u0027 = X \u002B Vx\u003C/p\u003E\u003Cp\u003EX\u0027a = Xa \u002B Vx\u003C/p\u003E\u003Cp\u003EX\u0027b = Xb \u002B (Vx - (X\u0027a -Xa))\u003C/p\u003E\u003Cp\u003E(Ordering of operations is significant)\u003C/p\u003E\u003Cp\u003EThis has only 4 times the math of the x87 version, and consumes and reads/writes as much memory (as 80-bit numbers need to be 128-bit aligned). If you can do SIMD, putting Xa and Ya in the same tuple (and Xb and Yb in the next) halves the arithmetic operations needed.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-02-17T17:43:40Z\u0022 title=\u002202/17/2014 05:43  PM\u0022 data-short=\u002210 yr\u0022\u003EFebruary 17, 2014\u003C/time\u003E by Tuna-Fish\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"thorfinn","CreatedById":8349,"CreatedDateTime":"2014-02-17T19:07:01Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003E\u003Cspan style=\u0022color:#333333;\u0022\u003EThe same experiments have further shown that a na\u00C3\u0192\u00C2\u00AFve low-pass filter will not be enough to remove Unity\u0027s silliness. For instance, one finds the proper acceleration is strongly correlated with the rotation rate of the ship. Smarter post-processing will be needed.\u003C/span\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EGah. Sorry. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E As for the correlation with angular rates, do you mean the centrifugal force due to the phisics calculations being done wrt. the root part and \u003Cstrong\u003Enot\u003C/strong\u003E the center of gravity?\u003C/p\u003E\n"},{"CreatedByName":"eggrobin","CreatedById":4680,"CreatedDateTime":"2014-02-17T19:41:01Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Tuna-Fish\u0022 data-cite=\u0022Tuna-Fish\u0022\u003E\u003Cdiv\u003EIn my experience, a ghetto double double (11 bit exponent, 106 bit mantissa, implemented as a sum of two doubles, the smaller of which always has an exponent 53 less than the bigger) is nowhere near order of magnitude slower than x87 80bit, and can in some situations be faster, depending on the compiler, as the x87 stack is not always handled gracefully.\u003Cp\u003E[...]\u003C/p\u003E\u003Cp\u003EIf you can do SIMD, putting Xa and Ya in the same tuple (and Xb and Yb in the next) halves the arithmetic operations needed.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYou make some very good points.\u003C/p\u003E\u003Cp\u003EI guess if I need more significant digits I\u0027ll use double-double rather than extended precision then.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022thorfinn\u0022 data-cite=\u0022thorfinn\u0022\u003E\u003Cdiv\u003EGah. Sorry. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E As for the correlation with angular rates, do you mean the centrifugal force due to the phisics calculations being done wrt. the root part and \u003Cstrong\u003Enot\u003C/strong\u003E the center of gravity?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ENo, I\u0027m compensating for the geometric accelerations applied by KSP. What I mean is what you see when you spin the ship very fast: the camera (which is centered on the center of gravity) wobbles because Unity doesn\u0027t conserve momentum in its interactions between rigid bodies.\u003C/p\u003E\u003Cp\u003EIt seems most of the biases I was measuring when the ship was not rotating very quickly were coming from the reaction wheels though; I\u0027m not sure if that\u0027s because I have a joystick or whether it\u0027s a deeper bug, but with reaction wheels enabled, a test ship (Mk1 - FL-T200 - LV-T30) picks up angular momentum quickly without input (SAS off), while this phenomenon is much slower with reaction wheels disabled.\u003C/p\u003E\u003Cp\u003EIgnoring the reaction wheels issue (which may well occur between the chair and the keyboard), it seems a low-pass filter for rounding errors, with a band-stop around the rotation rate and a maybe a high-pass on torque might do the trick. I\u0027ll see about what post-processing I want to do later on, this will require quite a bit of logging and data analysis.\u003C/p\u003E\u003Cp\u003EFFT is hard; let\u0027s go integrating. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-02-17T19:49:23Z\u0022 title=\u002202/17/2014 07:49  PM\u0022 data-short=\u002210 yr\u0022\u003EFebruary 17, 2014\u003C/time\u003E by eggrobin\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"nhnifong","CreatedById":12196,"CreatedDateTime":"2014-02-18T00:49:42Z","Content":"\n\u003Cp\u003EIf you don\u0027t mind dumbing it down a little bit, does this recent update mean that you are now working on the problem of sustained acceleration under timewarp? Such as with ion engines?\u003C/p\u003E\n"},{"CreatedByName":"eggrobin","CreatedById":4680,"CreatedDateTime":"2014-02-18T11:35:38Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022nhnifong\u0022 data-cite=\u0022nhnifong\u0022\u003E\u003Cdiv\u003EIf you don\u0027t mind dumbing it down a little bit, does this recent update mean that you are now working on the problem of sustained acceleration under timewarp? Such as with ion engines?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ENo, it means I\u0027m working on the problem of making this playable, \u003Cem\u003Ei.e.\u003C/em\u003E, of making rockets useful. Currently, off-rails thrust is ignored. This means you can\u0027t change your orbit. I\u0027m trying to grab whatever acceleration comes from your engines/getting out and pushing/decoupling etc. and to change your trajectory accordingly. Remember that in this mod, I\u0027m the one moving stuff around, not Unity (this also applies to off-rails), so I have to fetch these accelerations in order for them to affect the trajectory.\u003C/p\u003E\u003Cp\u003EOn-rails (timewarp) thrust is a feature I will work on once the basic stuff works, like the rest of the \u0027further modding\u0027 section.\u003C/p\u003E\n"},{"CreatedByName":"TimMartland","CreatedById":68334,"CreatedDateTime":"2014-02-18T13:39:15Z","Content":"\n\u003Cp\u003EWow. Dubstep orbits.\u003C/p\u003E\n"}]}