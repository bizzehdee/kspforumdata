{"TopicId":103963,"ForumId":36,"TopicTitle":"[WIP][1.9.x-1.12.x] Scatterer-atmospheric scattering (0.0838 - 14/08/2022) Scattering improvements, in-game atmo generation and multi-sun support","CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-04-12T08:37:35Z","PageNum":328,"Articles":[{"CreatedByName":"steve_v","CreatedById":69272,"CreatedDateTime":"2020-02-07T04:25:08Z","Content":"\u003E \n\u003E \n\u003E 3 hours ago, Starwaster said:\n\u003E \n\u003E \n\u003E Actually, we have symlinks too.\n\u003E \n\nYou do indeed, but up until fairly recently you needed elevated privileges to make them so they got a lot less use than they do on \\*nix.  \n\n\u003E \n\u003E \n\u003E 3 hours ago, Starwaster said:\n\u003E \n\u003E \n\u003E Vortex decided (totally without my permission) that it was going to symlink my Subnautica mods instead of actually copying the files\n\u003E \n\nPersonally, I\u0027d be stoked if an update made that a feature (with a note in the changelog of course). Symlinks are awesome, and they really shouldn\u0027t cause problems for a well-written application.  \n\n\u003E \n\u003E \n\u003E 3 hours ago, Starwaster said:\n\u003E \n\u003E \n\u003E Subnautica really did not like that.\n\u003E \n\nDunno about Windows, but over here symlinks are pretty well transparent to applications as they\u0027re resolved at the native syscall level.  If you want to know the real path you use readlink() or realpath().  \n\nSubnautica is Unity as well AFAIK, so without digging into the API docs I\u0027d guess either Unity or mono is returning the real path by default, and some code in Subnautica didn\u0027t make allowances for that.\n\n**Edited \u003Ctime datetime=\u00222020-02-07T04:37:06Z\u0022 title=\u002202/07/2020 04:37  AM\u0022 data-short=\u00224 yr\u0022\u003EFebruary 7, 2020\u003C/time\u003E by steve\\_v**"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2020-02-12T21:40:16Z","Content":"Since 1.9 is out:\n\n1.9 breaks scatterer for now. However, there are many cool changes in 1.9. The local space cameras have been unified into a single Camera (on Dx11 at least), which will fix many issues and facilitate many visual effects as well as save some performance. Terrain shadows might not work as well as before though, the precision is going to be highly diminished, unless I find a way to support more than 4 shadow cascades or up their resolution. Depth buffer handling seems to have changed, \u003Cabbr title=\u0022Environmental Visual Enhancement (mod)\u0022\u003EEVE\u003C/abbr\u003E needs some lines removed about outputting modified depth values. Supporting both dx11 with its unified camera and Opengl with 2 cameras is likely to become a pain. Also some graphical issues in stock I\u0027m not happy about, like some backfaces being visible on the mountains you can see from \u003Cabbr title=\u0022Kerbal Space Center\u0022\u003EKSC\u003C/abbr\u003E.\n\nI\u0027ll keep you guys posted on an updated version, I have some small updates I\u0027ve been working on which I might release for 1.8 first.\n\n**Edited \u003Ctime datetime=\u00222020-02-12T21:44:53Z\u0022 title=\u002202/12/2020 09:44  PM\u0022 data-short=\u00224 yr\u0022\u003EFebruary 12, 2020\u003C/time\u003E by blackrack**"},{"CreatedByName":"alberro\u002B","CreatedById":199496,"CreatedDateTime":"2020-02-13T03:07:36Z","Content":"\u003E \n\u003E \n\u003E 5 hours ago, blackrack said:\n\u003E \n\u003E \n\u003E Since 1.9 is out:\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E 1.9 breaks scatterer for now. However, there are many cool changes in 1.9. The local space cameras have been unified into a single Camera (on Dx11 at least), which will fix many issues and facilitate many visual effects as well as save some performance. Terrain shadows might not work as well as before though, the precision is going to be highly diminished, unless I find a way to support more than 4 shadow cascades or up their resolution. Depth buffer handling seems to have changed, \u003Cabbr title=\u0022Environmental Visual Enhancement (mod)\u0022\u003EEVE\u003C/abbr\u003E needs some lines removed about outputting modified depth values. Supporting both dx11 with its unified camera and Opengl with 2 cameras is likely to become a pain. Also some graphical issues in stock I\u0027m not happy about, like some backfaces being visible on the mountains you can see from \u003Cabbr title=\u0022Kerbal Space Center\u0022\u003EKSC\u003C/abbr\u003E.\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E I\u0027ll keep you guys posted on an updated version, I have some small updates I\u0027ve been working on which I might release for 1.8 first.\n\u003E \n\nTake your time dude. Modding KSP is all about patience."},{"CreatedByName":"R-T-B","CreatedById":200868,"CreatedDateTime":"2020-02-14T02:39:05Z","Content":"\u003E \n\u003E \n\u003E On 2/12/2020 at 1:40 PM, blackrack said:\n\u003E \n\u003E \n\u003E Since 1.9 is out:\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E 1.9 breaks scatterer for now. However, there are many cool changes in 1.9. The local space cameras have been unified into a single Camera (on Dx11 at least), which will fix many issues and facilitate many visual effects as well as save some performance. Terrain shadows might not work as well as before though, the precision is going to be highly diminished, unless I find a way to support more than 4 shadow cascades or up their resolution. Depth buffer handling seems to have changed, \u003Cabbr title=\u0022Environmental Visual Enhancement (mod)\u0022\u003EEVE\u003C/abbr\u003E needs some lines removed about outputting modified depth values. Supporting both dx11 with its unified camera and Opengl with 2 cameras is likely to become a pain. Also some graphical issues in stock I\u0027m not happy about, like some backfaces being visible on the mountains you can see from \u003Cabbr title=\u0022Kerbal Space Center\u0022\u003EKSC\u003C/abbr\u003E.\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E I\u0027ll keep you guys posted on an updated version, I have some small updates I\u0027ve been working on which I might release for 1.8 first.\n\u003E \n\nYep, that dual mode approach is likely to be a pain.\n\nOut of curiousity, does it work at present if you force OpenGL?  I can\u0027t test because I am still on 1.8.1, hehe."},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2020-02-14T08:12:57Z","Content":"\u003E \n\u003E \n\u003E 5 hours ago, R-T-B said:\n\u003E \n\u003E \n\u003E Out of curiousity, does it work at present if you force OpenGL?  I can\u0027t test because I am still on 1.8.1, hehe.\n\u003E \n\nI haven\u0027t tried, if what the devs said about the unified camera being used only in dx11 is true, I expect it should work in OpenGL as I saw no other problems.\n\nMaybe someone here tested already?"},{"CreatedByName":"Windh","CreatedById":200483,"CreatedDateTime":"2020-02-14T08:56:32Z","Content":"\u003E \n\u003E \n\u003E 1 hour ago, blackrack said:\n\u003E \n\u003E \n\u003E I haven\u0027t tried, if what the devs said about the unified camera being used only in dx11 is true, I expect it should work in OpenGL as I saw no other problems.\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E Maybe someone here tested already?\n\u003E \n\nI just tested (forced OpenGL through Steam). Seems to be working better than without. However, when you get a distance from the atmosphere the colors of the land masses still gets bluish.\n\nI also have some pretty rough framerates (I have a midend system, runs 1.8 prettty OK). \n\nNow it\u0027s kind of rough. And there\u0027s a 10 fps difference between full screen and windowed mode (being \u002B10).\n\n**Edited \u003Ctime datetime=\u00222020-02-14T09:28:40Z\u0022 title=\u002202/14/2020 09:28  AM\u0022 data-short=\u00224 yr\u0022\u003EFebruary 14, 2020\u003C/time\u003E by Windh**"},{"CreatedByName":"Windh","CreatedById":200483,"CreatedDateTime":"2020-02-14T09:13:29Z","Content":"[https://imgur.com/eULznIv](https://imgur.com/eULznIv)\n\n**Edited \u003Ctime datetime=\u00222020-02-14T09:13:53Z\u0022 title=\u002202/14/2020 09:13  AM\u0022 data-short=\u00224 yr\u0022\u003EFebruary 14, 2020\u003C/time\u003E by Windh**"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2020-02-14T13:07:59Z","Content":"\u003E \n\u003E \n\u003E 4 hours ago, Windh said:\n\u003E \n\u003E \n\u003E However, when you get a distance from the atmosphere the colors of the land masses still gets bluish.\n\u003E \n\nThanks for testing, do you have a screenshot of this issue? I can\u0027t really imagine what the issue is"},{"CreatedByName":"Bombaatu","CreatedById":157643,"CreatedDateTime":"2020-02-14T15:03:45Z","Content":"Might be helpful in tracking down problems for 1.9. When I first loaded everything appeared fine. I went into the tracking station, still good. When I came out of the tracking station, I had the black-sky-no-water issue. Subsequent scene changes did not correct it, and the log showed a NullPointerException coming from Scatterer. I don\u0027t have the log available at the moment, though."},{"CreatedByName":"UltraJohn","CreatedById":15008,"CreatedDateTime":"2020-02-14T15:20:03Z","Content":"Hi.\n\nI\u0027m on 1.8.1 and I don\u0027t see any water with ocean shaders enabled.\n\n[LOG 16:08:28.803] [Scatterer] Effects couldn\u0027t be loaded for Kerbin because of exception: System.NullReferenceException: Object reference not set to an instance of an object  \n\n  at scatterer.OceanFFTgpu.Cleanup () [0x00006] in \u003Cb83aac02f0a14d468c952212b6223826\u003E:0 \u003Cbr\u003E\n  at scatterer.OceanWhiteCaps.Cleanup () [0x00000] in \u003Cb83aac02f0a14d468c952212b6223826\u003E:0 \u003Cbr\u003E\n  at scatterer.OceanNode.loadFromConfigNode () [0x00137] in \u003Cb83aac02f0a14d468c952212b6223826\u003E:0 \u003Cbr\u003E\n  at scatterer.Manager.Awake () [0x00174] in \u003Cb83aac02f0a14d468c952212b6223826\u003E:0 \u003Cbr\u003E\n  at scatterer.Core.Update () [0x008e3] in \u003Cb83aac02f0a14d468c952212b6223826\u003E:0 \u003Cbr\u003E\n[LOG 16:08:28.803] ocean node Cleanup\u003Cbr\u003E\n[LOG 16:08:28.803] [Scatterer] manager couldn\u0027t be removed for Kerbin because of exception: System.NullReferenceException: Object reference not set to an instance of an object\u003Cbr\u003E\n  at scatterer.OceanFFTgpu.Cleanup () [0x00006] in \u003Cb83aac02f0a14d468c952212b6223826\u003E:0 \u003Cbr\u003E\n  at scatterer.OceanWhiteCaps.Cleanup () [0x00000] in \u003Cb83aac02f0a14d468c952212b6223826\u003E:0 \u003Cbr\u003E\n  at scatterer.Manager.OnDestroy () [0x00032] in \u003Cb83aac02f0a14d468c952212b6223826\u003E:0 \u003Cbr\u003E\n  at scatterer.Core.Update () [0x009b5] in \u003Cb83aac02f0a14d468c952212b6223826\u003E:0 \u003Cbr\u003E\n[LOG 16:08:28.803] [Scatterer] Kerbin removed from active planets.\n\u003C/b83aac02f0a14d468c952212b6223826\u003E\u003C/b83aac02f0a14d468c952212b6223826\u003E\u003C/b83aac02f0a14d468c952212b6223826\u003E\u003C/b83aac02f0a14d468c952212b6223826\u003E\u003C/b83aac02f0a14d468c952212b6223826\u003E\u003C/b83aac02f0a14d468c952212b6223826\u003E\u003C/b83aac02f0a14d468c952212b6223826\u003E\u003C/b83aac02f0a14d468c952212b6223826\u003E\u003C/b83aac02f0a14d468c952212b6223826\u003E"},{"CreatedByName":"Manwith Noname","CreatedById":117203,"CreatedDateTime":"2020-02-14T16:06:21Z","Content":"\u003E \n\u003E \n\u003E On 2/12/2020 at 9:40 PM, blackrack said:\n\u003E \n\u003E \n\u003E ...Terrain shadows might not work as well as before though...\n\u003E \n\nDoesn\u0027t stock do terrain shadows now? I seem to recall an entry in the settings.cfg appearing a while back something along the lines of \u0022celestial bodies cast shadows\u0022 which people thought would be eclipse casting but I\u0027ve got a vague recollection it was in fact much like the terrain shadows implemented in Scatterer."},{"CreatedByName":"Drew Kerman","CreatedById":103177,"CreatedDateTime":"2020-02-14T17:10:35Z","Content":"\u003E \n\u003E \n\u003E 1 hour ago, Manwith Noname said:\n\u003E \n\u003E \n\u003E Doesn\u0027t stock do terrain shadows now? I seem to recall an entry in the settings.cfg appearing a while back something along the lines of \u0022celestial bodies cast shadows\u0022 which people thought would be eclipse casting but I\u0027ve got a vague recollection it was in fact much like the terrain shadows implemented in Scatterer.\n\u003E \n\nI haven\u0027t played much 1.8.x but I still have no idea what this setting actually does. I remember asking someone to post a pic of it in the 1.8 release thread but don\u0027t recall anyone ever doing it"},{"CreatedByName":"Manwith Noname","CreatedById":117203,"CreatedDateTime":"2020-02-14T19:21:21Z","Content":"[@Drew Kerman](https://forum.kerbalspaceprogram.com/index.php?/profile/103177-drew-kerman/)\n\nHere\u0027s a grab with it enabled.\n\nSpoiler\n\n![04C868B3CFE58CC36AE0620378F5F5E307672C20](https://steamuserimages-a.akamaihd.net/ugc/783000589570459554/04C868B3CFE58CC36AE0620378F5F5E307672C20/)\n\nIf you watch the sun set you can see the shadows \u0022grow\u0022 towards you as it lowers behind the mountains. I can grab something with it disabled at the same UT easily enough for comparison in a bit, gotta run right now though. This is 1.9 stock.\n\nEdit: Here\u0027s a similar view, same UT with the terrain shadows disabled...\n\nSpoiler\n\n![B119F08BD9200FB66AA143BDC039734A9111EC05](https://steamuserimages-a.akamaihd.net/ugc/783000589570669155/B119F08BD9200FB66AA143BDC039734A9111EC05/)\n\n**Edited \u003Ctime datetime=\u00222020-02-14T20:15:00Z\u0022 title=\u002202/14/2020 08:15  PM\u0022 data-short=\u00224 yr\u0022\u003EFebruary 14, 2020\u003C/time\u003E by Manwith Noname**"},{"CreatedByName":"R-T-B","CreatedById":200868,"CreatedDateTime":"2020-02-14T20:13:42Z","Content":"\u003E \n\u003E \n\u003E 7 hours ago, blackrack said:\n\u003E \n\u003E \n\u003E Thanks for testing, do you have a screenshot of this issue? I can\u0027t really imagine what the issue is\n\u003E \n\nI grabbed a quick one for you by sideloading 1.9 on a separate install.  Mind you, all my mods are still in there (this is my 1.9 install where I keep track of how broken everything is, lol), but the blue terrain is still pretty apparent, even in the main menu:\n\n![screenshot0.jpg](https://img.techpowerup.org/200214/screenshot0.jpg)"},{"CreatedByName":"Windh","CreatedById":200483,"CreatedDateTime":"2020-02-14T21:54:44Z","Content":"\u003E \n\u003E \n\u003E 1 hour ago, R-T-B said:\n\u003E \n\u003E \n\u003E I grabbed a quick one for you by sideloading 1.9 on a separate install.  Mind you, all my mods are still in there (this is my 1.9 install where I keep track of how broken everything is, lol), but the blue terrain is still pretty apparent, even in the main menu:\n\u003E \n\nYep, there it is. Ice-world vibe.   \n\nI also had all my other mods installed as well (not too many visual ones though).\n\n**Edited \u003Ctime datetime=\u00222020-02-14T22:05:52Z\u0022 title=\u002202/14/2020 10:05  PM\u0022 data-short=\u00224 yr\u0022\u003EFebruary 14, 2020\u003C/time\u003E by Windh**"},{"CreatedByName":"alberro\u002B","CreatedById":199496,"CreatedDateTime":"2020-02-15T03:10:58Z","Content":"\u003E \n\u003E \n\u003E 6 hours ago, R-T-B said:\n\u003E \n\u003E \n\u003E I grabbed a quick one for you by sideloading 1.9 on a separate install.  Mind you, all my mods are still in there (this is my 1.9 install where I keep track of how broken everything is, lol), but the blue terrain is still pretty apparent, even in the main menu:\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E [![screenshot0.jpg](https://img.techpowerup.org/200214/screenshot0.jpg)](https://img.techpowerup.org/200214/screenshot0.jpg \u0022Enlarge image\u0022)\n\u003E \n\nIt might be broken, but i\u0027m getting some sick ice world vibes."},{"CreatedByName":"Trevisan","CreatedById":69985,"CreatedDateTime":"2020-02-15T04:14:56Z","Content":"Same here, ocean shaders turn water invisible."},{"CreatedByName":"Six6igma","CreatedById":162774,"CreatedDateTime":"2020-02-16T01:45:36Z","Content":"I haven\u0027t played in quite a while. Does this Kerbin look right? I don\u0027t think it\u0027s supposed to look like that, as though it were glazed over, as though its contrast was turned way up. If this isn\u0027t how this should look, can someone suggest what the problem might be?\n\n![jcRW1K6.jpg](https://i.imgur.com/jcRW1K6.jpg)\n\nAnd also, the distant mountains and the sky look milky. Is this how it is supposed to look?\n\n![Woq3eOy.jpg](https://i.imgur.com/Woq3eOy.jpg)\n\nJust look at that Kerbin and the weird southern area. This can\u0027t be right. What could be wrong? How would I begin to fix this?\n\n![mfPfJCA.jpg](https://i.imgur.com/mfPfJCA.jpg)\n\nI had AVP v3.6 and this Kerbin looked the same then as it does now that I have AVP v4.0. I\u0027m using Scatterer v0.0541 with default config. I\u0027m using \u003Cabbr title=\u0022Environmental Visual Enhancement (mod)\u0022\u003EEVE\u003C/abbr\u003E v1.8.0-2 with no config.\n\n**Edited \u003Ctime datetime=\u00222020-02-16T02:38:42Z\u0022 title=\u002202/16/2020 02:38  AM\u0022 data-short=\u00224 yr\u0022\u003EFebruary 16, 2020\u003C/time\u003E by Six6igma**"},{"CreatedByName":"alberro\u002B","CreatedById":199496,"CreatedDateTime":"2020-02-16T18:25:20Z","Content":"In resume, what are some issues found in Scatterer used in 1.9? I know that \u003Cabbr title=\u0022Environmental Visual Enhancement (mod)\u0022\u003EEVE\u003C/abbr\u003E has few issues, except some issues with cloud layering."},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2020-02-16T19:22:46Z","Content":"Everyone: Asking about 1.9\n\nMe:\n\n\u003Ciframe allowfullscreen=\u0022\u0022 frameborder=\u00220\u0022 height=\u0022270\u0022 width=\u0022480\u0022 data-embed-src=\u0022https://www.youtube.com/embed/lV-1tSvEh9s?feature=oembed\u0022\u003E\u003C/iframe\u003E\n\n\u003E \n\u003E \n\u003E 17 hours ago, Six6igma said:\n\u003E \n\u003E \n\u003E I haven\u0027t played in quite a while. Does this Kerbin look right? I don\u0027t think it\u0027s supposed to look like that, as though it were glazed over, as though its contrast was turned way up. If this isn\u0027t how this should look, can someone suggest what the problem might be?\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E And also, the distant mountains and the sky look milky. Is this how it is supposed to look?\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E Just look at that Kerbin and the weird southern area. This can\u0027t be right. What could be wrong? How would I begin to fix this?\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E I had AVP v3.6 and this Kerbin looked the same then as it does now that I have AVP v4.0. I\u0027m using Scatterer v0.0541 with default config. I\u0027m using \u003Cabbr title=\u0022Environmental Visual Enhancement (mod)\u0022\u003EEVE\u003C/abbr\u003E v1.8.0-2 with no config.\n\u003E \n\nLooks like you are using AVP so start in the AVP thread"},{"CreatedByName":"airtrafficcontroller","CreatedById":174649,"CreatedDateTime":"2020-02-16T19:36:48Z","Content":"\u003E \n\u003E \n\u003E 7 minutes ago, blackrack said:\n\u003E \n\u003E \n\u003E Me:\n\u003E \n\nEveryone: ![:o](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/ZNGIcon2.png \u0022:o\u0022)"},{"CreatedByName":"Delay","CreatedById":173586,"CreatedDateTime":"2020-02-16T19:45:25Z","Content":"\u003E \n\u003E \n\u003E 21 minutes ago, blackrack said:\n\u003E \n\u003E \n\u003E \u003Ciframe allowfullscreen=\u0022\u0022 frameborder=\u00220\u0022 height=\u0022270\u0022 width=\u0022480\u0022 data-embed-src=\u0022https://www.youtube.com/embed/lV-1tSvEh9s?feature=oembed\u0022\u003E\u003C/iframe\u003E\n\u003E \n\nWhat are the performance hits with those on?"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2020-02-16T20:02:18Z","Content":"\u003E \n\u003E \n\u003E 11 minutes ago, Delay said:\n\u003E \n\u003E \n\u003E What are the performance hits with those on?\n\u003E \n\nAs far as I can tell, absolutely none on a gtx 1060. It uses the depth buffer to inject the caustics into the shadowmask (essentially a texture where the shadows are as they should look on your screen, all shaders then read the corresponding pixel on the shadowmask to check if they are in shadow or not, I just add the caustics there). The caustics are basically two layers of the same texture mixed with some different scales and speeds.\n\nSo no rendering meshes, no re-rendering objects, basically a few texture fetches so it\u0027s fast."},{"CreatedByName":"Arco123","CreatedById":201477,"CreatedDateTime":"2020-02-16T20:35:29Z","Content":"\u003E \n\u003E \n\u003E 31 minutes ago, blackrack said:\n\u003E \n\u003E \n\u003E As far as I can tell, absolutely none on a gtx 1060. It uses the depth buffer to inject the caustics into the shadowmask (essentially a texture where the shadows are as they should look on your screen, all shaders then read the corresponding pixel on the shadowmask to check if they are in shadow or not, I just add the caustics there). The caustics are basically two layers of the same texture mixed with some different scales and speeds.\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E So no rendering meshes, no re-rendering objects, basically a few texture fetches so it\u0027s fast.\n\u003E \n\nFps? I cant get above 20-30 with AVP and scatterer at lowest settings. I5-7400, 16gb of ram and a GTX 1060 3gb."},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2020-02-16T20:42:19Z","Content":"\u003E \n\u003E \n\u003E 3 minutes ago, Arco123 said:\n\u003E \n\u003E \n\u003E Fps? I cant get above 20-30 with AVP and scatterer at lowest settings. I5-7400, 16gb of ram and a GTX 1060 3gb.\n\u003E \n\n20-30 fps? What are you doing?\n\nLook at the video above, it should tell you everything you need to know about fps."}]}