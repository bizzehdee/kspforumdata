{"TopicId":103963,"ForumId":36,"TopicTitle":"[WIP][1.9.x-1.12.x] Scatterer-atmospheric scattering (0.0838 - 14/08/2022) Scattering improvements, in-game atmo generation and multi-sun support","CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-04-12T08:37:35Z","PageNum":80,"Articles":[{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-11-19T01:15:27Z","Content":"[quote name=\u0027rbray89\u0027]Ocean is of type TransparentCuttout... You\u0027ll need to add the RenderType to the tags in the replacement shader or do the ocean radius math fix thing in your sky shader.[/QUOTE]  \n\nHmm, can I have two rendertype tags in the replacement shader? Do I need to copy it in two different subshaders and give them different tags?  \n\nEdited:You already answered this a page ago, multiple subshaders works but multiple tags doesn\u0027t.  \n\n[URL=\u0022https://mega.nz/#!idYiECiR!EGIfls2jtkl5tLzTAi5Z2FMHk0spvmg6C7yrpT1atDQ\u0022]https://mega.nz/#!idYiECiR!EGIfls2jtkl5tLzTAi5Z2FMHk0spvmg6C7yrpT1atDQ[/URL]\n\n**Edited \u003Ctime datetime=\u00222015-11-19T01:38:39Z\u0022 title=\u002211/19/2015 01:38  AM\u0022 data-short=\u00228 yr\u0022\u003ENovember 19, 2015\u003C/time\u003E by blackrack**"},{"CreatedByName":"rbray89","CreatedById":48847,"CreatedDateTime":"2015-11-19T02:03:14Z","Content":"[quote name=\u0027blackrack\u0027]Hmm, can I have two rendertype tags in the replacement shader? Do I need to copy it in two different subshaders and give them different tags?  \n\nEdited:You already answered this a page ago, multiple subshaders works but multiple tags doesn\u0027t.  \n\n[URL=\u0022https://mega.nz/#!idYiECiR!EGIfls2jtkl5tLzTAi5Z2FMHk0spvmg6C7yrpT1atDQ\u0022]https://mega.nz/#!idYiECiR!EGIfls2jtkl5tLzTAi5Z2FMHk0spvmg6C7yrpT1atDQ[/URL][/QUOTE]  \n\nCool, that is good to know.   \n\nOut of curiosity, it seems that whatever you are doing is replacing the built-in depth texture. Is that intended?"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-11-19T02:05:29Z","Content":"[quote name=\u0027rbray89\u0027]Cool, that is good to know.   \n\nOut of curiosity, it seems that whatever you are doing is replacing the built-in depth texture. Is that intended?[/QUOTE]  \n\nWhat do you mean replacing the built-in depth texture? The regular depth buffer?"},{"CreatedByName":"Manwith Noname","CreatedById":117203,"CreatedDateTime":"2015-11-19T02:07:29Z","Content":"[quote name=\u0027blackrack\u0027][URL]https://mega.nz/#!idYiECiR!EGIfls2jtkl5tLzTAi5Z2FMHk0spvmg6C7yrpT1atDQ[/URL][/QUOTE]  \n\nIt\u0027s a beautiful thing.  \n\nThere are other things I notice which I can report if you wish, though some of them may not be possible to fix due to the different rendering technique, I think.  \n\nEdit: One in particular is possibly tied to a problem I believe you have mentioned yourself.\n\n**Edited \u003Ctime datetime=\u00222015-11-19T02:10:21Z\u0022 title=\u002211/19/2015 02:10  AM\u0022 data-short=\u00228 yr\u0022\u003ENovember 19, 2015\u003C/time\u003E by Manwith Noname**"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-11-19T02:08:43Z","Content":"[quote name=\u0027Manwith Noname\u0027]It\u0027s a beautiful thing.  \n\nThere are other things I notice which I can report if you wish, though some of them may not be possible to fix due to the different rendering technique, I think.[/QUOTE]  \n\nI\u0027ve noticed what seems like increased pixelation of the edges around terrain, and sometimes they seem to flicker."},{"CreatedByName":"Manwith Noname","CreatedById":117203,"CreatedDateTime":"2015-11-19T02:15:25Z","Content":"[quote name=\u0027blackrack\u0027]I\u0027ve noticed what seems like increased pixelation of the edges around terrain, and sometimes they seem to flicker.[/QUOTE]  \n\nYep. I\u0027m going to reboot and run another test but I also seem to see a large rise in CPU usage with the latest files."},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-11-19T02:17:02Z","Content":"[quote name=\u0027Manwith Noname\u0027]Yep. I\u0027m going to reboot and run another test but I also seem to see a large rise in CPU usage with the latest files.[/QUOTE]  \n\nAre you sure about the CPU usage? I\u0027m using a fairly slow laptop and which almost has one core maxed when running KSP and didn\u0027t see any drops."},{"CreatedByName":"Manwith Noname","CreatedById":117203,"CreatedDateTime":"2015-11-19T02:23:10Z","Content":"That\u0027s why I am going to reboot and kill off some other stuff I\u0027ve been doing. If you look back at some of my pics, the KSC scene shows 17% total usage and about 40% on core 0. In flight this rises to 25% total and 70% single. Just now, I\u0027m fairly sure the KSC scene was showing 60% single core and flight was up to 85-90%.  \n\nLike I said though, need to reboot incase this is other stuff in the background."},{"CreatedByName":"rbray89","CreatedById":48847,"CreatedDateTime":"2015-11-19T02:27:22Z","Content":"[quote name=\u0027blackrack\u0027]What do you mean replacing the built-in depth texture? The regular depth buffer?[/QUOTE]  \n\nExactly. I can\u0027t imagine why my cloud particles would fade out like that otherwise (they read the depth buffer for soft-drawing)."},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-11-19T02:32:55Z","Content":"[quote name=\u0027rbray89\u0027]Exactly. I can\u0027t imagine why my cloud particles would fade out like that otherwise (they read the depth buffer for soft-drawing).[/QUOTE]  \n\nI honestly wouldn\u0027t think it would replace the default depth buffer. If it did the results should be the same also since I\u0027m reusing what unity uses to create a depth buffer,just higher precision in OpenGL."},{"CreatedByName":"rbray89","CreatedById":48847,"CreatedDateTime":"2015-11-19T02:43:11Z","Content":"[quote name=\u0027blackrack\u0027]I honestly wouldn\u0027t think it would replace the default depth buffer. If it did the results should be the same also since I\u0027m reusing what unity uses to create a depth buffer,just higher precision in OpenGL.[/QUOTE]  \n\nThe only difference was that before, your fixes, the shader was replacing the particles, making them think later that the depth was 0, making them transparent. This is still good news overall for OpenGL."},{"CreatedByName":"Manwith Noname","CreatedById":117203,"CreatedDateTime":"2015-11-19T02:52:02Z","Content":"Ok, 2 pics of the KSC scene.  \n\n[URL]http://steamcommunity.com/sharedfiles/filedetails/?id=557954876[/URL]  \n\nThis is with the latest files. In reality, this is bouncing between 60-80% on a single core usage.  \n\n[URL]http://steamcommunity.com/sharedfiles/filedetails/?id=557957784[/URL]  \n\nThis second pic is after I deleted scatterer from the install and replaced it along with the files from the fix3.zip, which from memory is before the whole new shader approach. Again, in reality this is bouncing between 35-50% single core usage.  \n\nEdit: Roll on 1.1 and multithreading support ;)\n\n**Edited \u003Ctime datetime=\u00222015-11-19T02:54:29Z\u0022 title=\u002211/19/2015 02:54  AM\u0022 data-short=\u00228 yr\u0022\u003ENovember 19, 2015\u003C/time\u003E by Manwith Noname**"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-11-19T03:03:15Z","Content":"[quote name=\u0027Manwith Noname\u0027]Ok, 2 pics of the KSC scene.  \n\n[URL]http://steamcommunity.com/sharedfiles/filedetails/?id=557954876[/URL]  \n\nThis is with the latest files. In reality, this is bouncing between 60-80% on a single core usage.  \n\n[URL]http://steamcommunity.com/sharedfiles/filedetails/?id=557957784[/URL]  \n\nThis second pic is after I deleted scatterer from the install and replaced it along with the files from the fix3.zip, which from memory is before the whole new shader approach. Again, in reality this is bouncing between 35-50% single core usage.  \n\nEdit: Roll on 1.1 and multithreading support ;)[/QUOTE]  \n\nInteresting. Could you do this comparison again with only scatterer? My reasoning is that if EVE uses the depth buffer, then it\u0027s enabling the default one, and then we have both the default and the scatterer one enabled. I want so see how much more overhead the custom depth buffer is adding by itself, and how much more the two used together cause."},{"CreatedByName":"Manwith Noname","CreatedById":117203,"CreatedDateTime":"2015-11-19T03:06:40Z","Content":"Will do, I was going down that route anyway, I got to thinking and removed both EVE and Scatterer...  \n\n[URL]http://steamcommunity.com/sharedfiles/filedetails/?id=557966134[/URL]  \n\nVanilla bounces between 20-40% on a single core.  \n\nEdit:  \n\nJust Scatterer with the latest shaders bounces between 35-55%.  \n\n[url]http://steamcommunity.com/sharedfiles/filedetails/?id=557968982[/url]  \n\nJust Scatterer but with fix3 shaders bounces between 30-50%  \n\n[url]http://steamcommunity.com/sharedfiles/filedetails/?id=557970868[/url]  \n\nInteresting...the plot thickens.\n\n**Edited \u003Ctime datetime=\u00222015-11-19T03:19:20Z\u0022 title=\u002211/19/2015 03:19  AM\u0022 data-short=\u00228 yr\u0022\u003ENovember 19, 2015\u003C/time\u003E by Manwith Noname**"},{"CreatedByName":"TheGamingNoobster","CreatedById":94887,"CreatedDateTime":"2015-11-19T03:50:45Z","Content":"Hey guys, when I first installed scatterer, the effects wouldn\u0027t load. I retried several times to no avail... Sorry if this isn\u0027t very helpful... If it means anything, there was still a large amount of lag when loaded."},{"CreatedByName":"HafCoJoe","CreatedById":80363,"CreatedDateTime":"2015-11-19T05:17:34Z","Content":"[quote name=\u0027TheGamingNoobster\u0027]Hey guys, when I first installed scatterer, the effects wouldn\u0027t load. I retried several times to no avail... Sorry if this isn\u0027t very helpful... If it means anything, there was still a large amount of lag when loaded.[/QUOTE]  \n\nI had an issue similar to this when I was testing. Could you try flying to the specific locations and seeing if they load or did you try that? The mapview doesn\u0027t load the effects for me last time I checked.  \n\n[B]Also, 2,000th thread post :D[/B]"},{"CreatedByName":"selfish_meme","CreatedById":125899,"CreatedDateTime":"2015-11-19T11:45:47Z","Content":"[quote name=\u0027blackrack\u0027]  \n\nTry this:  \n\n[URL]https://mega.nz/#!ad5QXQKS!fbAn2AMTNT8eUFffR7xJmrHO-4E39EoGCCdFEJhRw74[/URL][/QUOTE]  \n\nThe clouds are the same, but your ice magic froze the world  \n\n[IMG]http://i.imgur.com/P2N2sgZ.png[/IMG]  \n\n[COLOR=\u0022silver\u0022][SIZE=1]- - - Updated - - -[/SIZE][/COLOR]  \n\n[quote name=\u0027blackrack\u0027]Hmm, can I have two rendertype tags in the replacement shader? Do I need to copy it in two different subshaders and give them different tags?  \n\nEdited:You already answered this a page ago, multiple subshaders works but multiple tags doesn\u0027t.  \n\n[URL]https://mega.nz/#!idYiECiR!EGIfls2jtkl5tLzTAi5Z2FMHk0spvmg6C7yrpT1atDQ[/URL][/QUOTE]  \n\nThe edges seem softer, but still visible  \n\n[IMG]http://i.imgur.com/UjTlQSp.png[/IMG]  \n\n[COLOR=\u0022silver\u0022][SIZE=1]- - - Updated - - -[/SIZE][/COLOR]  \n\nThe load time on scenes seems quicker"},{"CreatedByName":"Proot","CreatedById":98932,"CreatedDateTime":"2015-11-19T16:18:52Z","Content":"Well, at the end my problem seems not related to EVE in any way (seems two different problems), but I\u0027m still getting the black sky. I\u0027ll try again the process of install the released version to check when and where it falls.  \n\nI\u0027ll let you know the results ASP."},{"CreatedByName":"Cbigclouds","CreatedById":153847,"CreatedDateTime":"2015-11-20T01:44:22Z","Content":"[quote name=\u0027Proot\u0027]Well, at the end my problem seems not related to EVE in any way (seems two different problems), but I\u0027m still getting the black sky. I\u0027ll try again the process of install the released version to check when and where it falls.  \n\nI\u0027ll let you know the results ASP.[/QUOTE]  \n\nI had the same problem with black sky. was installing mods 1 by 1. scatterer worked until i installed outer planets mod. all mods installed via ckan. (collisionfx, mechjeb, distant object enhancement(defaultcfg), smokescreen, mod manager, ksp players.) just -nopopupwindow as an extension via steam."},{"CreatedByName":"Proot","CreatedById":98932,"CreatedDateTime":"2015-11-20T02:33:27Z","Content":"Ok, I\u0027m still having the same issue, with all the fixes, in DX and openGL.  \n\nThe log spams:  \n\n[CODE][LOG 03:03:12.092] scatterer effects loaded for Kerbin  \n\n[EXC 03:03:12.277] NullReferenceException: Object reference not set to an instance of an object  \n\nscatterer.SkyNode.toggleCoronas ()  \n\nscatterer.SkyNode.UpdateNode ()  \n\nscatterer.Manager.Update ()  \n\nscatterer.Core.Update ()[/CODE]  \n\nIf I go to map view at the return the scarreting seems to be up again, but looks weird. Like overexposed, and the edge of the horizon is not properly blended, like in the first versions.  \n\nAlso, the tint feature seems completely gone in the map view, so all looks pretty bluish.  \n\nIf you need more info, the full logs or anything else just tell me. ;)"},{"CreatedByName":"tkw","CreatedById":142638,"CreatedDateTime":"2015-11-20T02:43:11Z","Content":"it need fix this mod now"},{"CreatedByName":"Manwith Noname","CreatedById":117203,"CreatedDateTime":"2015-11-20T04:46:15Z","Content":"I just don\u0027t get it. I haven\u0027t had much time tonight to KSP but I just thought I\u0027d run it to check if I get the same errors as Proot and Nhawks, which I\u0027m not. My logs are completely clear of [EXC], with the \u0022exception\u0022 (see what I did there) of Steam controller reports when I quit out of the game. Also, all [WRN] and [ERR] flags point to Squad issues (colliders needing rigid body\u0027s, too many polygons....and why the hell is a Stock craft spitting all kinds of missing modules at me !mechjeb!...who\u0027s building stock craft with mechjeb, hmmm...I digress).  \n\nThe only warning I see that appears to relate to Scatterer is when using the fix3.zip files which tells me I can\u0027t use HDR and MSAA in forward rendering and so HDR is disabled. If I want to use HDR disable MSAA in the options...or something. Last log I have is with the deferred shaders and don\u0027t show that so I can\u0027t copy and paste...should have thought of that.  \n\nAnyway, I\u0027ll post this pic just incase this has never been observed before...  \n\n[URL]http://steamcommunity.com/sharedfiles/filedetails/?id=558582811[/URL]  \n\nIt appears with both the old (fix3.zip) and new (anotherone.zip) methods.  \n\n\\*walks away scratching his head\\*  \n\nEdit: Oh, Blackrack, just in case you didn\u0027t spot my edit on the last page, CPU usage change is negligible with just Scatterer in place. It\u0027s there but a lot less than when EVE is present.\n\n**Edited \u003Ctime datetime=\u00222015-11-20T04:52:21Z\u0022 title=\u002211/20/2015 04:52  AM\u0022 data-short=\u00228 yr\u0022\u003ENovember 20, 2015\u003C/time\u003E by Manwith Noname**"},{"CreatedByName":"Manwith Noname","CreatedById":117203,"CreatedDateTime":"2015-11-20T05:27:24Z","Content":"Ok, I would edit my post but this might be important for anyone who understands all this and may have checked in since I posted the above.  \n\nBlack sky is caused by Kopernicus.  \n\nI tried this because Proot and Nhawks are both making beautification packs that bring all the wonderful visual candy together. I missed CBigclouds comment in amongst the others until just now. When they mentioned OPM, I realised Kopernicus is the link.  \n\nEdit: So to clarify, I threw Kopernicus in my install and my sky went black. I also get the same exceptions mentioned above.  \n\nRe wording: Kopernicus with Scatterer makes the sky go black.\n\n**Edited \u003Ctime datetime=\u00222015-11-20T05:33:42Z\u0022 title=\u002211/20/2015 05:33  AM\u0022 data-short=\u00228 yr\u0022\u003ENovember 20, 2015\u003C/time\u003E by Manwith Noname**"},{"CreatedByName":"Bizz Keryear","CreatedById":68896,"CreatedDateTime":"2015-11-20T11:13:39Z","Content":"[quote name=\u0027blackrack\u0027]The sunglare textures are the only repeating things and they\u0027re mostly insignificant, a 512x512 texture is nothing, and they\u0027re only loaded if their associated planet is loaded so at worst you see slightly more memory usage when both Laythe and Jool are loaded, for the rest it\u0027s the same. The black texture could also be removed. Both of these points are so insignificant memory-wise and the current sunglare system is only temporary anyway so I haven\u0027t bothered changing them.[/QUOTE]  \n\nYeah, but what about the black one ... and it might be because of a long distance view mod I have installed there might be all planets loaded anyway"},{"CreatedByName":"selfish_meme","CreatedById":125899,"CreatedDateTime":"2015-11-20T11:44:16Z","Content":"[quote name=\u0027Manwith Noname\u0027]Ok, I would edit my post but this might be important for anyone who understands all this and may have checked in since I posted the above.  \n\nBlack sky is caused by Kopernicus.  \n\nI tried this because Proot and Nhawks are both making beautification packs that bring all the wonderful visual candy together. I missed CBigclouds comment in amongst the others until just now. When they mentioned OPM, I realised Kopernicus is the link.  \n\nEdit: So to clarify, I threw Kopernicus in my install and my sky went black. I also get the same exceptions mentioned above.  \n\nRe wording: Kopernicus with Scatterer makes the sky go black.[/QUOTE]  \n\nI didn\u0027t load Kopernicus because of the bouyancy issue which explains why I never got the black skies."}]}