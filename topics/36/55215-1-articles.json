{"TopicId":55215,"ForumId":36,"TopicTitle":"WIP - Custom Hardware Control Panel","CreatedByName":"KK4TEE","CreatedById":95462,"CreatedDateTime":"2013-12-04T19:46:54Z","PageNum":1,"Articles":[{"CreatedByName":"KK4TEE","CreatedById":95462,"CreatedDateTime":"2013-12-04T19:46:54Z","Content":"\n\u003Cp\u003E\u003Cimg src=\u0022http://i.imgur.com/nEyCCoMh.jpg\u0022 alt=\u0022nEyCCoMh.jpg\u0022\u003E\u003C/p\u003E\u003Cp\u003EI\u0027ve been working on this for a couple of months and finally got to the point where it is almost useable, so I thought I\u0027d share. It started as a desire to have a real \u0022Launch\u0022 button to press to send off my space ships in Kerbal Space Program, but as evolved into much more. \u003C/p\u003E\u003Cp\u003EI\u0027ve built an Arduino based control board that can receive information from KSP and display it on analog gauges, as well as read button presses and toggle switches and press keyboard keys to activate things like staging or SAS.\u003C/p\u003E\u003Cp\u003EThis is my first Arduino Project, first Python project, first time soldering, and first KSP modding attempt. It has been, and continues to be, an enormous amount of fun!\u003C/p\u003E\u003Cp\u003EThe hardest part of this project was figuring out how to get flight information from KSP out to an Arduino over a serial connection. At first I tried to write a plugin for KSP that would print values to a serial port directly, but I quickly became overwhelmed and decided to try another approach.\u003C/p\u003E\u003Cp\u003EI then tried to find a way to use information from Telemachus, but I couldn\u0027t figure out how to parse the server to get individual bits of flight data instead of a graph. I\u0027m fairly sure it can be done, but I\u0027m new at all of this and couldn\u0027t figure it out yet.\u003C/p\u003E\u003Cp\u003EI ended up finding a mod (Flight Recorder) that would save flight information to a CSV file every 200ms. I then wrote a Python program to parse the CSV file, create a dictionary using the headers (Mission time, altitude, Geeforce, etc) and then read the last line of the file for the values to add to the dictionary keys. It then formats it as a string and prints the values to the serial port with a newline character at the end.\u003C/p\u003E\u003Cp\u003ESadly Flight Recorder doesn\u0027t (yet) record resource usage, so I had to experiment using kOS to log that information to a separate CSV file. This actually works great for a few minutes, but I don\u0027t think kOS was really meant to write to a file 5 times per second. It seems to develop a memory leak and crashes the game fairly quickly.\u003C/p\u003E\u003Cp\u003EReading toggle switch states and keypad buttons into KSP was actually fairly easy. I used an Arduino Micro setup as a USB HID Keyboard to press a pre-programed key based on which toggle switch was flipped. When I press the yellow \u0022Stage\u0022 button the arduino sends a \u0022Space\u0022 character from the keyboard. When I press the blue SAS button it presses \u0022t\u0022 as a keyboard.\u003C/p\u003E\u003Cp\u003EThe tablet computer (or any device with a web browser) is able to view a simple HTML page generated by the python program. The python program calls a set of functions that print HTML headers to a file, then print the dictionary that stores the most recent flight information, then print the trailing HTML. I got the idea of doing it this way from one of the other mods that was like Flight Recorder (but sadly I can\u0027t remember what it was called). Basically the table formatting doesn\u0027t change, so you just print the HTML code in between each call to print a piece of flight data. The resulting HTML file is then served via an Apache webserver that I have on my computer, which can be accessed by any other computer on the LAN (or internet, if you setup port forwarding). My code for this doesn\u0027t work very well yet, which is why I ended up using a lot of place holders so far. I\u0027m still learning how to prevent extra \u0022\\\u0022 characters from showing up, as well as odd spacings, among other things. Once it is useable I\u0027ll add it to the github page.\u003C/p\u003E\u003Cp\u003EHere is a part list of most of the things I needed for the project, not including tools:\u003C/p\u003E\u003Cp\u003EThe pelican case and waterproof connectors were probably the most expensive bits.\u003C/p\u003E\u003Cp\u003E 1x Pelican 1200 Case\u003C/p\u003E\u003Cp\u003E 1x Arduino Micro (for reading the button states)\u003C/p\u003E\u003Cp\u003E 1x Arduino Mega (for driving all of the displays)\u003C/p\u003E\u003Cp\u003E 5x Colored LED Angel Eye buttons from spark fun (product 11966)\u003C/p\u003E\u003Cp\u003E 2x Power Symbol LED button from eBay\u003C/p\u003E\u003Cp\u003E Various LEDs and resistors that I got from kits on Amazon and Radioshack\u003C/p\u003E\u003Cp\u003E 1x \u00224x5 keys metal panel\u0022 keypad from eBay/China. It has removable caps so you can print your own labels (\u0022Map View\u0022 for example)\u003C/p\u003E\u003Cp\u003E 2x 12 position rotary switch \u0022Amico Split Shaft\u0022 from Amazon, with knob. These weren\u0027t as useful as I had anticipated. I wanted to use them to set individual time warp levels (1x, 5x, 10x, etc) but I don\u0027t know how to pass that into KSP.\u003C/p\u003E\u003Cp\u003E 8x 5v Voltmeter from sparkfun. These were more cube shaped than I anticipated, but work fairly well and feature swappable backgrounds so I can label them \u0022Liquid Fuel\u0022 or \u0022Electric Charge\u0022 instead of \u0022Volts\u0022.\u003C/p\u003E\u003Cp\u003E 5x Eight digit 7 segment display with serial interface (kit). I\u0027ll use these to output Altitude, Periapsis, Apoapsis, Current Velocity, and Radar Altimeter or MET. The serial interface is used to save pins on the Arduino.\u003C/p\u003E\u003Cp\u003E 5x Covered Toggle Switch w/ LED (Missile Cover) from Sparkfun. Smaller than expected, but they do allow you to toggle the LED separately from the switch.\u003C/p\u003E\u003Cp\u003E 1x \u0022On/Off Key Switch with 2 Round Keys\u0022 from Amazon. The one from Sparkfun looked kind of cheap, so I bought a larger higher current one from Amazon.\u003C/p\u003E\u003Cp\u003E 2x SB400 Solderable breadboard from Amazon. I only used one, but I ordered a second just in case I messed up.\u003C/p\u003E\u003Cp\u003E -- Various USB cable adapters.\u003C/p\u003E\u003Cp\u003E 4x 1/8\u0022x12\u0022x12\u0022 Polycarbonate sheets from Amazon to act as the mounting surface.\u003C/p\u003E\u003Cp\u003E LM2587 DC/DC Booster Converter Voltage Regulator from Amazon. This converts 5v USB power to 9v for the LEDs buttons and future desk lamp.\u003C/p\u003E\u003Cp\u003E 5x TIP120 Transistor from Amazon to switch the 9V supply for LEDs. The idea is so that when a ship runs low on Electric Charge the Arduino will quickly flicker the LEDs to simulate low power. It also lets me dim all of the various displays/LEDs depending on how bright I want them to be.\u003C/p\u003E\u003Cp\u003E 1x 4x20 Character LCD w/ Serial interface from eBay. This will display anything that I don\u0027t feel like having a dedicated display for.\u003C/p\u003E\u003Cp\u003E 1x Waterproof USB connector from usbfirewire.com. The first one had a defect with the cap, but their customer service was very good and they sent a replacement via next day air.\u003C/p\u003E\u003Cp\u003E 1x CAT6 Waterproof connector from Amazon.\u003C/p\u003E\u003Cp\u003E 1x Box of military surplus gauges from eBay. I ended up getting some cool ones including the ones pictured in the album and one multi gauge labeled a \u0022Bat-o-Meter\u0022. It turned out to be used for testing batteries, not seeing how close you are to Gotham City.\u003C/p\u003E\u003Cp\u003EImugur Link with more pics: \u003Ca href=\u0022http://imgur.com/a/iF0sT\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://imgur.com/a/iF0sT\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EReddit Link w/ some discussion: \u003Ca href=\u0022http://www.reddit.com/r/KerbalSpaceProgram/comments/1s1hn6/my_custom_ksp_control_board/\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://www.reddit.com/r/KerbalSpaceProgram/comments/1s1hn6/my_custom_ksp_control_board/\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EI\u0027ve put my code up on github under a GPLv3 license in case anyone is interested in doing a similar project for themselves. \u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022https://github.com/KK4TEE/Control-Panel\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/KK4TEE/Control-Panel\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EIf anyone knows of a plugin for KSP that can print serial output, please let me know! My eventual goal is to get a KSP plugin in C# that can send data out a serial port directly, but I have a lot to learn still before I can code that myself. Thanks, and enjoy!\u003C/p\u003E\n"},{"CreatedByName":"Specialist290","CreatedById":58489,"CreatedDateTime":"2013-12-04T19:51:21Z","Content":"\n\u003Cp\u003EWelcome to the forums, and \u003Cem\u003Every\u003C/em\u003E impressive work! Keep us posted on how this project goes.\u003C/p\u003E\n"},{"CreatedByName":"Rich","CreatedById":17874,"CreatedDateTime":"2013-12-04T23:09:40Z","Content":"\n\u003Cp\u003EYou can access individual data values from Telemachus using the appropriate URL; an example is given below.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Ehttp://[B]127.0.0.1:8085[/B]/telemachus/datalink?alt=[B]v.altitude[/B]\u0026amp;pd=[B]v.dynamicPressure[/B]\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EThis will return a JSON formatted string with the requested values.\u003C/p\u003E\n"},{"CreatedByName":"Camacha","CreatedById":59088,"CreatedDateTime":"2013-12-05T03:21:58Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022KK4TEE\u0022 data-cite=\u0022KK4TEE\u0022\u003E\u003Cdiv\u003E\u003Cp\u003E 2x 12 position rotary switch \u0022Amico Split Shaft\u0022 from Amazon, with knob. These weren\u0027t as useful as I had anticipated. I wanted to use them to set individual time warp levels (1x, 5x, 10x, etc) but I don\u0027t know how to pass that into KSP.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EVery nice work!\u003C/p\u003E\u003Cp\u003EIf I understand correctly, these rotary switches work by powering each individual terminal/pin on the back according to the chosen setting. The power is supplied to the pole, which passes it on to said pin. \u003C/p\u003E\u003Cp\u003EYou could differentiate output to the Arduino by soldering a resistor of different resistance to each pin. By using an analog input on the Arduino, you can figure out which way the switch is turned. After that you can work with the assumption that you start at warp 0x. Each time you switch up one level, the Arduino passes \u0022\u0026gt;\u0022 to KSP, and each time you switch down one level, KSP recieves \u0022\u0026lt;\u0022. \u003C/p\u003E\u003Cp\u003EEdit: One problem I see is when you are not allowed to use a higher warp by KSP due to altitude. There is no way I know of to relay that back to the Arduino, although I see that you posted a possible solution on Reddit by turning warp to 0 and back to the desired level each time the switch changes position. That way you will get the highest possible warp level every time you set it to that level or higher.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-12-05T03:36:16Z\u0022 title=\u002212/05/2013 03:36  AM\u0022 data-short=\u002210 yr\u0022\u003EDecember 5, 2013\u003C/time\u003E by Camacha\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"nyrath","CreatedById":61886,"CreatedDateTime":"2013-12-05T16:25:48Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022KK4TEE\u0022 data-cite=\u0022KK4TEE\u0022\u003E\u003Cdiv\u003E\u003Cp\u003E 2x 12 position rotary switch \u0022Amico Split Shaft\u0022 from Amazon, with knob. These weren\u0027t as useful as I had anticipated. I wanted to use them to set individual time warp levels (1x, 5x, 10x, etc) but I don\u0027t know how to pass that into KSP.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI think this is similar to what you want to do. This is a tutorial for interfacing a rotary encoder to a Trinket Arduino to create a volume knob\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022http://learn.adafruit.com/trinket-usb-volume-knob?view=all\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://learn.adafruit.com/trinket-usb-volume-knob?view=all\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EThe example has it emitting text strings for \u0022volume up\u0022 or \u0022volume down\u0022 through the serial port. Like Camacha says, you can replace that with \u0022\u0026gt;\u0022 or \u0022\u0026lt;\u0022\u003C/p\u003E\u003Cp\u003EThis is an example of reading a set of momentary-contact switches with a single Arduino analog input pin by using different resistors on each button\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022http://tronixstuff.com/2011/01/11/tutorial-using-analog-input-for-multiple-buttons/\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://tronixstuff.com/2011/01/11/tutorial-using-analog-input-for-multiple-buttons/\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EThis is similar to what Camacha was talking about with resistors on a rotary switch.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-12-05T16:39:54Z\u0022 title=\u002212/05/2013 04:39  PM\u0022 data-short=\u002210 yr\u0022\u003EDecember 5, 2013\u003C/time\u003E by nyrath\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"kiwiak","CreatedById":82796,"CreatedDateTime":"2013-12-05T17:02:30Z","Content":"\n\u003Cp\u003EImpressive.\u003C/p\u003E\n"},{"CreatedByName":"Moach","CreatedById":9,"CreatedDateTime":"2013-12-05T17:02:59Z","Content":"\n\u003Cp\u003EWhadda??! \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_huh.gif\u0022 alt=\u0022:confused:\u0022\u003E *jawdrop* \u003C/p\u003E\u003Cp\u003Ewhoa, that\u0027s a pretty awesome rig you got there \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cool.gif\u0022 alt=\u0022:cool:\u0022\u003E\u003C/p\u003E\u003Cp\u003E...and I had thought I was the one who was \u003Ca href=\u0022https://gp-m5.tumblr.com\u0022 rel=\u0022external nofollow\u0022\u003Emore or less completely insane\u003C/a\u003E\u003C/p\u003E\u003Cp\u003Every nice job! - look forward to seeing it in action (any chance you could make a video of it working sometime?)\u003C/p\u003E\u003Cp\u003Echeers dude!\u003C/p\u003E\n"},{"CreatedByName":"KK4TEE","CreatedById":95462,"CreatedDateTime":"2013-12-06T00:18:53Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Rich\u0022 data-cite=\u0022Rich\u0022\u003E\u003Cdiv\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Ehttp://[B]127.0.0.1:8085[/B]/telemachus/datalink?alt=[B]v.altitude[/B]\u0026amp;pd=[B]v.dynamicPressure[/B]\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThanks Rich. That should help me out a lot. I\u0027m looking forward to learning about JSON strings now.\u003C/p\u003E\n"},{"CreatedByName":"KK4TEE","CreatedById":95462,"CreatedDateTime":"2013-12-06T00:38:28Z","Content":"\n\u003Cp\u003Enyrath and Camacha: Thanks for the tips for interfacing the 12 position knob. I tried my hand at soldering the first one in a resistor chain to use an analog pin and almost butchered it, but it now seems to be working alright. I\u0027ll try adding the time-warp controls to my program when I switch the data feed from Flight Recorder to Telemachus. The example code in the links was very helpful.\u003C/p\u003E\u003Cp\u003EMoach: That\u0027s a nice battlestation you\u0027ve got! Among other things I like the way you have the Logitech and throttle control setup for easy access on the left. I\u0027m looking forward to adding a SpaceNavigator to my setup once KSP supports it, and I\u0027m hoping it will work with Star Citizen as well. \u003C/p\u003E\u003Cp\u003EI\u0027ll try to make a video of the setup in action once I get the gauges working a little more reliably. I need to solder in some resistors or install a voltage regulator for the gauges because the raw USB power seems to fluctuate depending on if the backlights are on or not. If the lights are on the gauges droop down about 10%, throwing the readings off. I\u0027m planing on putting a 5v regulator after my 9v up-converter so that I get a very stable 5v for gauges and Arduino in addition to 9V for the lights. Hopefully I\u0027ll be able to work on that some this weekend.\u003C/p\u003E\n"},{"CreatedByName":"nyrath","CreatedById":61886,"CreatedDateTime":"2013-12-06T01:37:00Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022KK4TEE\u0022 data-cite=\u0022KK4TEE\u0022\u003E\u003Cdiv\u003EThanks Rich. That should help me out a lot. I\u0027m looking forward to learning about JSON strings now.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYou are using Python, correct? If so, there is a Python library that can parse JSON strings for you.\u003C/p\u003E\u003Cp\u003EJSON parser documentation\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022https://docs.python.org/2/library/json.html\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://docs.python.org/2/library/json.html\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EExample\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022http://stackoverflow.com/questions/8220748/parsing-json-python\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://stackoverflow.com/questions/8220748/parsing-json-python\u003C/a\u003E\u003C/p\u003E\n"},{"CreatedByName":"Mulbin","CreatedById":55562,"CreatedDateTime":"2014-01-17T23:06:09Z","Content":"\n\u003Cp\u003EWow, this is fantastic.\u003C/p\u003E\u003Cp\u003EI\u0027m currently building a custom switch panel for KSP using on/off toggle switches which will be run through a pulse generator board (off the shelf, specifically for flight sim building \u003Ca href=\u0022http://www.desktopaviator.com/Products/Model_2120/index.htm\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://www.desktopaviator.com/Products/Model_2120/index.htm\u003C/a\u003E) but once this first panel is completed I was considering buying an Arduino for gauges... I will have to download your code! Would it be ok to get some hints from you when I finally get to this stage?\u003C/p\u003E\u003Cp\u003EI\u0027ll post up my control panel in a new thread as I build it soon... just waiting on a delivery of switches to start construction!\u003C/p\u003E\u003Cp\u003EAlso I was wondering what type of switch you are using... are you using single state switches that stay locked in the \u0022on\u0022 position as I plan to? If so have you found a way to convert the constant \u0022on\u0022 signal to a button press with Arduino? If not I\u0027ll stick with the pulse generator which achieves this effect... just that Arduino is cheaper \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Mulbin","CreatedById":55562,"CreatedDateTime":"2014-02-04T17:52:15Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022KK4TEE\u0022 data-cite=\u0022KK4TEE\u0022\u003E\u003Cdiv\u003EIf anyone knows of a plugin for KSP that can print serial output, please let me know! \u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ERight here! - \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/66393-Hardware-Plugin-KSP-Arduino-based-physical-display-and-serial-port-plugin-%28WIP%29\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://forum.kerbalspaceprogram.com/threads/66393-Hardware-Plugin-KSP-Arduino-based-physical-display-and-serial-port-plugin-%28WIP%29\u003C/a\u003E\u003C/p\u003E\n"}]}