{"TopicId":95699,"ForumId":36,"TopicTitle":"LEDJeb [0.90][WIP] A Physical and Virtual LED Readout","CreatedByName":"heaton84","CreatedById":134452,"CreatedDateTime":"2015-01-05T04:04:33Z","PageNum":1,"Articles":[{"CreatedByName":"heaton84","CreatedById":134452,"CreatedDateTime":"2015-01-05T04:04:33Z","Content":"\n\u003Cp\u003E\u003Cstrong\u003EUpdate 1/11/2015: Version 0.2 Beta is out.\u003C/strong\u003E\u003C/p\u003E\u003Cp\u003EReleases are now posted on the Add-on Releases forum. Post is here: \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/107006-0-90-LEDJeb-Flight-Data-Readout-0-2-Beta-2015-01-11\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://forum.kerbalspaceprogram.com/threads/107006-0-90-LEDJeb-Flight-Data-Readout-0-2-Beta-2015-01-11\u003C/a\u003E\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003EUpdate 1/10/2015: Version 0.1 Alpha is out for KSP 0.90!\u003C/strong\u003E Link is below.\u003C/p\u003E\u003Cp\u003ELEDJeb provides an interface for a physical LED readout based on MAX7219 display modules. It also provides a virtual panel to both facilitate testing, and to be used by those who don\u0027t care to invest in the physical display but do have a second monitor to spare.\u003C/p\u003E\u003Cp\u003EThe plugin will be configurable and scalable. You can have one display, or you could have 100 displays.\u003C/p\u003E\u003Cp\u003ESource and binaries are all available \u003Ca href=\u0022https://github.com/heaton84/LEDJeb\u0022 rel=\u0022external nofollow\u0022\u003EHERE\u003C/a\u003E. Be sure to check out the readme file!\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003EVersion 0.1 Alpha - Known Bugs\u003C/strong\u003E\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cul\u003E\u003Cli\u003EThe virtual readout program \u003Cem\u003Emust\u003C/em\u003E be started before you launch KSP, or it won\u0027t work. \u003Cbr\u003E\u003C/li\u003E\u003Cli\u003EThere is no time to intercept or estimated burn time yet. I am still sorting out how MechJeb calculates these to emulate it. \u003Cbr\u003E\u003C/li\u003E\u003Cli\u003ECurrently, no decimal points are sent down to the readout client. This means that velocity and inclination both are displayed as \u0022times 10\u0022, it\u0027s really just missing the decimal. \u003Cbr\u003E\u003C/li\u003E\u003Cli\u003EThe plugin \u003Cspan style=\u0022text-decoration:underline;\u0022\u003E\u003Cstrong\u003EWILL CRASH KSP\u003C/strong\u003E\u003C/span\u003E when KSP is closed. I am still trying to figure out why this happens. \u003Cbr\u003E\u003C/li\u003E\u003Cli\u003EDistances are auto-scaled to KM and MM, but there is currently no indication as to which scaling is present. Open to ideas on how this would be done on a physical panel. \u003Cbr\u003E\u003C/li\u003E\u003Cli\u003ERelative inclination (ascending node) seems to be wrong at the moment. \u003Cbr\u003E\u003C/li\u003E\u003C/ul\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://i.imgur.com/uE15Mxp.png\u0022 alt=\u0022uE15Mxp.png\u0022\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-01-12T03:46:28Z\u0022 title=\u002201/12/2015 03:46  AM\u0022 data-short=\u00229 yr\u0022\u003EJanuary 12, 2015\u003C/time\u003E by heaton84\u003C/strong\u003E\n\u003Cbr\u003EFirst release of plugin\n\u003C/span\u003E\n"},{"CreatedByName":"heaton84","CreatedById":134452,"CreatedDateTime":"2015-01-07T23:44:50Z","Content":"\n\u003Cp\u003EI\u0027m searching high and low and having a hard time trying to get the next maneuver node. Could someone point me in the right direction? Thanks.\u003C/p\u003E\n"},{"CreatedByName":"artwhaley","CreatedById":118388,"CreatedDateTime":"2015-01-08T02:25:00Z","Content":"\n\u003Cp\u003E\u003Cspan style=\u0022font-family:Consolas;\u0022\u003E\u003Cspan style=\u0022color:#333333;\u0022\u003EI don\u0027t have a project set up to get all the details right now, but I can get you started in the right direction ! \u003C/span\u003E\u003C/span\u003E\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022font-family:Consolas;\u0022\u003E\u003Cspan style=\u0022color:#333333;\u0022\u003Evessel.patchedConicSolver.maneuverNodes[\u003C/span\u003E\u003C/span\u003E\u003Cspan style=\u0022font-family:Consolas;\u0022\u003E\u003Cspan style=\u0022color:#0086B3;\u0022\u003E0\u003C/span\u003E\u003C/span\u003E\u003Cspan style=\u0022font-family:Consolas;\u0022\u003E\u003Cspan style=\u0022color:#333333;\u0022\u003E] is the next node, and it has properties for time, direction, and deltav. I don\u0027t remember exactly what those properties are... or what math I had to do to get them into useful numbers... but that\u0027s the start. If it\u0027s not obvious (and, in my experience, not much in the KSP API IS obvious) shout at me and I\u0027ll dig out an old project that dealt with this to see if I can be of more help. \u003C/span\u003E\u003C/span\u003E\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022font-family:Consolas;\u0022\u003E\u003Cspan style=\u0022color:#333333;\u0022\u003EIf you\u0027re not already doing it, the best way I\u0027ve found to figure out anything in KSP coding is to dig through the source code for mechjeb. It\u0027s a big project so figuring out where they grab or calculate anything takes a little time, but they\u0027ve figured out how to get just about every useful bit of info out of KSP... so when I\u0027m trying to figure something out, that\u0027s my go to source!\u003C/span\u003E\u003C/span\u003E\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022font-family:Consolas;\u0022\u003E\u003Cspan style=\u0022color:#333333;\u0022\u003EWhich method are you using to get the data out of KSP? I\u0027ve played with doing it via HTTP, both using the telemachus plugin as a server inside KSP, and using my own plugin to do HTTP Post messages out of KSP to a server in the remote application. \u003C/span\u003E\u003C/span\u003E\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022font-family:Consolas;\u0022\u003E\u003Cspan style=\u0022color:#333333;\u0022\u003EArt\u003C/span\u003E\u003C/span\u003E\u003C/p\u003E\n"},{"CreatedByName":"tg626","CreatedById":112361,"CreatedDateTime":"2015-01-08T02:32:16Z","Content":"\n\u003Cp\u003EYou mis-spelled Inclination...\u003C/p\u003E\u003Cp\u003ESorry to be \u0022that guy\u0022\u003C/p\u003E\u003Cp\u003EThis looks rather useful for folks who, like me, have 2 monitors.\u003C/p\u003E\n"},{"CreatedByName":"heaton84","CreatedById":134452,"CreatedDateTime":"2015-01-08T04:12:14Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022artwhaley\u0022 data-cite=\u0022artwhaley\u0022\u003E\u003Cdiv\u003E\u003Cspan style=\u0022font-family:Consolas;\u0022\u003E\u003Cspan style=\u0022color:#333333;\u0022\u003EI don\u0027t have a project set up to get all the details right now, but I can get you started in the right direction ! \u003C/span\u003E\u003C/span\u003E\u003Cp\u003E\u003Cspan style=\u0022font-family:Consolas;\u0022\u003E\u003Cspan style=\u0022color:#333333;\u0022\u003Evessel.patchedConicSolver.maneuverNodes[\u003C/span\u003E\u003C/span\u003E\u003Cspan style=\u0022font-family:Consolas;\u0022\u003E\u003Cspan style=\u0022color:#0086B3;\u0022\u003E0\u003C/span\u003E\u003C/span\u003E\u003Cspan style=\u0022font-family:Consolas;\u0022\u003E\u003Cspan style=\u0022color:#333333;\u0022\u003E] is the next node, and it has properties for time, direction, and deltav. I don\u0027t remember exactly what those properties are... or what math I had to do to get them into useful numbers... but that\u0027s the start. If it\u0027s not obvious (and, in my experience, not much in the KSP API IS obvious) shout at me and I\u0027ll dig out an old project that dealt with this to see if I can be of more help. \u003C/span\u003E\u003C/span\u003E\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022font-family:Consolas;\u0022\u003E\u003Cspan style=\u0022color:#333333;\u0022\u003EIf you\u0027re not already doing it, the best way I\u0027ve found to figure out anything in KSP coding is to dig through the source code for mechjeb. It\u0027s a big project so figuring out where they grab or calculate anything takes a little time, but they\u0027ve figured out how to get just about every useful bit of info out of KSP... so when I\u0027m trying to figure something out, that\u0027s my go to source!\u003C/span\u003E\u003C/span\u003E\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022font-family:Consolas;\u0022\u003E\u003Cspan style=\u0022color:#333333;\u0022\u003EWhich method are you using to get the data out of KSP? I\u0027ve played with doing it via HTTP, both using the telemachus plugin as a server inside KSP, and using my own plugin to do HTTP Post messages out of KSP to a server in the remote application. \u003C/span\u003E\u003C/span\u003E\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022font-family:Consolas;\u0022\u003E\u003Cspan style=\u0022color:#333333;\u0022\u003EArt\u003C/span\u003E\u003C/span\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThanks! I was starting to look into MechJeb, but you are right, it\u0027s a large project. I at least have a starting point of what to look for... will report back if I can\u0027t figure it out.\u003C/p\u003E\u003Cp\u003EI am using sockets. The ultimate goal is to feed the data out via a serial port to drive a real display, so this was the closest mechanism I could find that I could boil down to an interface quickly.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022tg626\u0022 data-cite=\u0022tg626\u0022\u003E\u003Cdiv\u003EYou mis-spelled Inclination...\u003Cp\u003ESorry to be \u0022that guy\u0022\u003C/p\u003E\u003Cp\u003EThis looks rather useful for folks who, like me, have 2 monitors.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EOh, you. Heh, yeah I\u0027ll fix that. Thanks for the feedback!\u003C/p\u003E\n"},{"CreatedByName":"artwhaley","CreatedById":118388,"CreatedDateTime":"2015-01-08T05:30:35Z","Content":"\n\u003Cp\u003EIf memory serves... getting the time of the next node is easy, it\u0027s .UT or something similar. Getting deltaV took a conversion. Another good place to look for examples of grabbing data is the RPM source - the core/propmonitorcomputer file is where most of that magic happens... They\u0027re getting deltav with .GetBurnVector(vessel.orbit).magnitude Again, it\u0027s been a while, so I\u0027m not sure if that will compile or if you\u0027ll have to resolve any alias\u0027s or methods that\u0027s calling.\u003C/p\u003E\u003Cp\u003EOne of these days I\u0027m going to sit down and learn something about IPC for Linux and Mac and make a plugin that just rapidly gets ALL of the data out of KSP, so third party plugins and apps can use it. For Windows it seems like a memory mapped file would be perfect - as you could write all the flight data to it every frame and multiple apps could read from it and use the data any way they want... and they could even write instructions to it that could get spotted by the KSP plugin. That way everyone who wants to display data, or pass it to an arduino, or make a navball, or make a webservice, or build a control panel wouldn\u0027t have to reinvent the wheel. But I\u0027d want it to work on all three platforms, and I don\u0027t know if there\u0027s a good fast method of IPC that they all handle well. There are a lot of things ahead of this on my \u0027one of these days\u0027 list though.\u003C/p\u003E\u003Cp\u003EAnother cute thing I played with that could help you when you get to the hardware stage... I fiddled with a tm4c1294 connected launchpad ($25 dev board, with ethernet jack) and managed to get it talking both ways with Telemachus. Haven\u0027t done anything with it yet other than demonstrating that it worked, but it was stupid simple to make it light an led when SAS was enabled... and I used the hardware buttons to toggle Mechjeb SMARTASS on and off. It\u0027s got enough IO that I may someday hook a whole cockpit to it. It\u0027s, of course, not as simple as your serial port solution, but if you find yourself needing more io, it\u0027s a cool, cheap board that can communicate directly on the network with KSP, if it needs to and with Energia, it runs Arduino code. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"rabidninjawombat","CreatedById":108889,"CreatedDateTime":"2015-01-08T05:35:00Z","Content":"\n\u003Cp\u003EOh man! This looks cool. \u003C/p\u003E\u003Cp\u003EAnd timely, as i was just in the starting planning phases of attempting to try to possibly, maybe, attempt to build some KSP hardware \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 alt=\u0022:D\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"heaton84","CreatedById":134452,"CreatedDateTime":"2015-01-08T23:50:11Z","Content":"\n\u003Cp\u003EOk, I have everything except time to intercept and burn time remaining.\u003C/p\u003E\u003Cp\u003EThe MechJeb stuff on burn time remaining is rather... involved. I have to either rely on MechJeb or extract it all out piece by piece.\u003C/p\u003E\u003Cp\u003EFor \u0022relative inclination\u0022 (ascending node), I literally added together the current vessel\u0027s obit.inclination and the target vessel\u0027s orbit.inclination, and it appears to match the game\u0027s ascending node value pretty closely. This seems counter-intuitive, but if it works, it works I guess.\u003C/p\u003E\u003Cp\u003EStill a bit of cleanup to get things less... Kerbal.... and I want to get decimal points working. Then, I think I\u0027m ready to share an early release.\u003C/p\u003E\u003Cp\u003EFor hardware, I\u0027m looking at a Microchip PIC 16F628A. Since I am designing with daisy-chained MAX7219\u0027s in mind, the protocol is a bit wonky but it definitely works.\u003C/p\u003E\n"},{"CreatedByName":"Gaalidas","CreatedById":111158,"CreatedDateTime":"2015-01-09T01:05:07Z","Content":"\n\u003Cp\u003EWow... cool stuff. I have no clue... and I mean absolutely \u003Cem\u003Eno freaking clue\u003C/em\u003E what you\u0027re all talking about, but it looks awesome.\u003C/p\u003E\n"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2015-01-09T12:20:54Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022artwhaley\u0022 data-cite=\u0022artwhaley\u0022\u003E\u003Cdiv\u003E\u003Cp\u003EIf you\u0027re not already doing it, the best way I\u0027ve found to figure out anything in KSP coding is to dig through the source code for mechjeb. It\u0027s a big project so figuring out where they grab or calculate anything takes a little time, but they\u0027ve figured out how to get just about every useful bit of info out of KSP... so when I\u0027m trying to figure something out, that\u0027s my go to source!\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EFeel free to pop on IRC and ask me question if you need info about some MJ stuff. I\u0027m there most evening and weekend (GMT\u002B1)\u003C/p\u003E\n"},{"CreatedByName":"heaton84","CreatedById":134452,"CreatedDateTime":"2015-01-11T06:31:54Z","Content":"\n\u003Cp\u003ERelease 0.1 alpha is out! Heads up: it crashes KSP when you close the game. Is anyone familiar with InternalGetGameObject throwing a NullReferenceException?\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003ENullReferenceException\u003Cp\u003E at (wrapper managed-to-native) UnityEngine.Component:InternalGetGameObject ()\u003C/p\u003E\u003Cp\u003E at UnityEngine.Component.get_gameObject () [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003C/p\u003E\u003Cp\u003E at ApplicationLauncher.ScaleModList () [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003C/p\u003E\u003Cp\u003E at ApplicationLauncher.RemoveApplication (.ApplicationLauncherButton button) [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003C/p\u003E\u003Cp\u003E at ResourceDisplay.OnDestroy () [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\n"},{"CreatedByName":"Cortek56","CreatedById":106367,"CreatedDateTime":"2015-01-11T11:49:35Z","Content":"\n\u003Cp\u003EThanks ! Truely awesome !!!\u003C/p\u003E\n"},{"CreatedByName":"heaton84","CreatedById":134452,"CreatedDateTime":"2015-01-25T19:45:31Z","Content":"\n\u003Cp\u003EUpdate, release 0.25 is out. \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/108334-0-90-LEDJeb-Flight-Data-Readout-0-25-Beta-2015-01-23\u0022 rel=\u0022external nofollow\u0022\u003EThread here\u003C/a\u003E.\u003C/p\u003E\u003Cp\u003EOne thought on the readout scaling.... I could place the decimal point based on UOM. For example:\u003C/p\u003E\u003Cp\u003E0000000.0 M\u003C/p\u003E\u003Cp\u003E000000.00 KM\u003C/p\u003E\u003Cp\u003E00000.000 MM\u003C/p\u003E\u003Cp\u003E0000.0000 GM\u003C/p\u003E\u003Cp\u003EThis would let me get away with simple labels on the physical panel, and the virtual panel could infer scaling from this convention. It\u0027s either this, or allow for a separate controller to illuminate scaling on the final panel (more $$$).\u003C/p\u003E\u003Cp\u003EOn the physical side of things, I have a rough proof of concept working in MPLAB\u0027s simulator. Once I get a few more parts in, I should be able to breadboard up a physical readout!\u003C/p\u003E\n"}]}