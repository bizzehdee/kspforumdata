{"TopicId":32560,"ForumId":36,"TopicTitle":"[WIP] Konsole","CreatedByName":"astronutkhillips","CreatedById":67981,"CreatedDateTime":"2013-06-12T05:52:57Z","PageNum":1,"Articles":[{"CreatedByName":"astronutkhillips","CreatedById":67981,"CreatedDateTime":"2013-06-12T05:52:57Z","Content":"\n\u003Cp\u003EI\u0027m working on a plugin to give a developer style console to KSP. Primary uses would be developers of plugins and users who want to explore the internals of KSP.\u003C/p\u003E\u003Cp\u003EThe idea is to use the Mono.csharp.eval to allow real time execution of C# statements. Like:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E\u0026gt;print(2\u002B2)\u003Cbr\u003E4\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003Eor more to the point.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E\u0026gt;GameObject.Find(\u0022Minmus\u0022).destroy(); //Take that Minmus!\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003ECobbling from the internet I came up with this proof of concept. \u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Eusing System;\u003Cbr\u003Eusing KSP.IO;\u003Cbr\u003Eusing UnityEngine;\u003Cbr\u003Eusing System.Collections;\u003Cbr\u003Eusing System.Collections.Generic;\u003Cbr\u003Eusing Mono.CSharp;\u003Cbr\u003E\u003Cbr\u003Epublic class PartlessLoader : KSP.Testing.UnitTest\u003Cbr\u003E{\u003Cbr\u003E\tpublic PartlessLoader()\u003Cbr\u003E\t{\u003Cbr\u003E\t\t//Called at the first loading screen\u003Cbr\u003E\t\t//When you start the game.\u003Cbr\u003E\t\tMyPlugin.Initialize();\u003Cbr\u003E\t}\u003Cbr\u003E}\u003Cbr\u003E\u003Cbr\u003Epublic static class MyPlugin\u003Cbr\u003E{\u003Cbr\u003E    public static UnityEngine.GameObject CmdConsole;\u003Cbr\u003E\tpublic static void Initialize()\u003Cbr\u003E\t{\u003Cbr\u003E        CmdConsole = new UnityEngine.GameObject(\u003Cbr\u003E\t\t\t\t\t\t\u0022No Parts!\u0022,\u003Cbr\u003E                        new Type[] { typeof(CmdConsole) });\u003Cbr\u003E        UnityEngine.GameObject.DontDestroyOnLoad(CmdConsole);\u003Cbr\u003E\t}\u003Cbr\u003E}\u003Cbr\u003E\u003Cbr\u003Epublic class CmdConsole : MonoBehaviour/*Singleton\u0026lt;CmdConsole\u0026gt;*/\u003Cbr\u003E{\u003Cbr\u003E    public KeyCode[] m_ShortcutKeys = new KeyCode[]{KeyCode.LeftAlt, KeyCode.F12}; //the keys used to open Console;\u003Cbr\u003E    public bool m_IsConsoleOpen = false;\u003Cbr\u003E\u003Cbr\u003E    private string m_editstr = \u0022\u0022;\u003Cbr\u003E    private string m_result = \u0022\u0022;\u003Cbr\u003E\u003Cbr\u003E    private int m_cmdId = 0; //used to identify cmd\u003Cbr\u003E\u003Cbr\u003E    // Use this for initialization\u003Cbr\u003E    void Start () {\u003Cbr\u003E        Mono.CSharp.Evaluator.Init(new string[] { });\u003Cbr\u003E        foreach (System.Reflection.Assembly assembly in AppDomain.CurrentDomain.GetAssemblies())\u003Cbr\u003E        {\u003Cbr\u003E            //Dbg.Log(\u0022refer: {0}\u0022, assembly.FullName);\u003Cbr\u003E            if( assembly.FullName.Contains(\u0022Cecil\u0022) || assembly.FullName.Contains(\u0022UnityEditor\u0022) )\u003Cbr\u003E                continue;\u003Cbr\u003E            Mono.CSharp.Evaluator.ReferenceAssembly(assembly);\u003Cbr\u003E        }\u003Cbr\u003E        Evaluator.Run (\u0022using UnityEngine;\\n\u0022 \u002B \u003Cbr\u003E                       \u0022using System;\u0022\u003Cbr\u003E                       );\u003Cbr\u003E    }\u003Cbr\u003E\u003Cbr\u003E    void Update() {\u003Cbr\u003E        //check if the console should be opened\u003Cbr\u003E        if (m_IsConsoleOpen)\u003Cbr\u003E            return;\u003Cbr\u003E\u003Cbr\u003E        bool bAllKeysDown = true;\u003Cbr\u003E        foreach ( KeyCode kc in m_ShortcutKeys )\u003Cbr\u003E        {\u003Cbr\u003E            if( !Input.GetKey(kc) )\u003Cbr\u003E            {\u003Cbr\u003E                bAllKeysDown = false;\u003Cbr\u003E                break;\u003Cbr\u003E            }\u003Cbr\u003E        }\u003Cbr\u003E\u003Cbr\u003E        if( bAllKeysDown )\u003Cbr\u003E        {\u003Cbr\u003E            m_IsConsoleOpen = true;\u003Cbr\u003E        }\u003Cbr\u003E    }\u003Cbr\u003E\u003Cbr\u003E    void OnGUI()\u003Cbr\u003E    {\u003Cbr\u003E        //if (!m_IsConsoleOpen)\u003Cbr\u003E        //    return;\u003Cbr\u003E\u003Cbr\u003E        m_editstr = GUI.TextArea(new Rect(10, 10, 400, 100), m_editstr);\u003Cbr\u003E\u003Cbr\u003E        if( GUI.Button(new Rect(420, 60, 100, 40), \u0022Execute\u0022) )\u003Cbr\u003E        {\u003Cbr\u003E            \u002B\u002Bm_cmdId;\u003Cbr\u003E            bool bSuccess = Run(m_editstr);\u003Cbr\u003E            m_result = string.Format(\u0022{0}: {1}\u0022, m_cmdId, bSuccess ? \u0022OK\u0022 : \u0022Fail\u0022);\u003Cbr\u003E            m_editstr = \u0022\u0022; //clear the script\u003Cbr\u003E        }\u003Cbr\u003E\u003Cbr\u003E        if( GUI.Button(new Rect(530, 60, 100, 40), \u0022Close\u0022) )\u003Cbr\u003E        {\u003Cbr\u003E            m_IsConsoleOpen = false;\u003Cbr\u003E        }\u003Cbr\u003E\u003Cbr\u003E        if (m_result.Length \u0026gt; 0)\u003Cbr\u003E        {\u003Cbr\u003E            GUI.TextArea(new Rect(420, 10, 200, 30), m_result);\u003Cbr\u003E        }\u003Cbr\u003E    }\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E    public bool Run(string cmd) {\u003Cbr\u003E        return Evaluator.Run(cmd);\u003Cbr\u003E    }\u003Cbr\u003E\u003Cbr\u003E}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EWhich _almost_ works. But it throws an exception. \u003C/p\u003E\u003Cp\u003ETypeLoadException: Could not load type \u0027System.Runtime.InteropServices.GuidAttribute\u0027 from assembly \u0027mscorlib,\u003C/p\u003E\u003Cp\u003EGoogle says I am compiling to the wrong c# version. But that doesn\u0027t seem to be the problem. Any ideas?\u003C/p\u003E\n"},{"CreatedByName":"EndlessWaves","CreatedById":41302,"CreatedDateTime":"2013-06-12T09:35:32Z","Content":"\n\u003Cp\u003EWhich version are you compiling against? C# 3.0/ .NET 3.5?\u003C/p\u003E\u003Cp\u003ER4m0n made one a few months ago but I don\u0027t know if he kept it up to date or posted the source anywhere:\u003C/p\u003E\u003Cp\u003E\n\u003C/p\u003E\u003Cdiv class=\u0022ipsEmbeddedVideo\u0022 contenteditable=\u0022false\u0022\u003E\u003Cdiv\u003E\u003Ciframe width=\u0022480\u0022 height=\u0022270\u0022 src=\u0022https://www.youtube.com/embed/5E1GvxZncUU?feature=oembed\u0022 frameborder=\u00220\u0022 allowfullscreen=\u0022true\u0022\u003E\u003C/iframe\u003E\u003C/div\u003E\u003C/div\u003E\n"},{"CreatedByName":"astronutkhillips","CreatedById":67981,"CreatedDateTime":"2013-06-12T18:17:06Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022EndlessWaves\u0022 data-cite=\u0022EndlessWaves\u0022\u003E\u003Cdiv\u003EWhich version are you compiling against? C# 3.0/ .NET 3.5?\u003Cp\u003ER4m0n made one a few months ago but I don\u0027t know if he kept it up to date or posted the source anywhere:\u003C/p\u003E\u003Cp\u003E\n\u003C/p\u003E\u003Cdiv class=\u0022ipsEmbeddedVideo\u0022 contenteditable=\u0022false\u0022\u003E\u003Cdiv\u003E\u003Ciframe width=\u0022480\u0022 height=\u0022270\u0022 src=\u0022https://www.youtube.com/embed/5E1GvxZncUU?feature=oembed\u0022 frameborder=\u00220\u0022 allowfullscreen=\u0022true\u0022\u003E\u003C/iframe\u003E\u003C/div\u003E\u003C/div\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EWow! That is exactly what I was trying for. I wish R4m0n was still around. I\u0027d like to know how he made it work.\u003C/p\u003E\n"},{"CreatedByName":"EndlessWaves","CreatedById":41302,"CreatedDateTime":"2013-06-12T19:00:18Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022astronutkhillips\u0022 data-cite=\u0022astronutkhillips\u0022\u003E\u003Cdiv\u003EI wish R4m0n was still around.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThe last Mechjeb 2 commit was only 6 days ago and he\u0027s still on the IRC channel (although currently AFK) so he may well be.\u003C/p\u003E\n"},{"CreatedByName":"astronutkhillips","CreatedById":67981,"CreatedDateTime":"2013-06-13T01:43:39Z","Content":"\n\u003Cp\u003ENuts! I got home tonight and was able to try r4m0ns version and it throws the same exception on mine. But then I tried it with 0.18.1 and it works. So they broke it with 0.19. Argh. so close....\u003C/p\u003E\n"},{"CreatedByName":"astronutkhillips","CreatedById":67981,"CreatedDateTime":"2013-06-13T02:23:42Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022astronutkhillips\u0022 data-cite=\u0022astronutkhillips\u0022\u003E\u003Cdiv\u003ENuts! I got home tonight and was able to try r4m0ns version and it throws the same exception on mine. But then I tried it with 0.18.1 and it works. So they broke it with 0.19. Argh. so close....\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ENevermind. It was a plugin conflict. Works great! Thanks EndlessWaves! And r4m0n wherever you are. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"ahappydude","CreatedById":458,"CreatedDateTime":"2013-06-13T04:35:30Z","Content":"\n\u003Cp\u003EYesyes thanks! Ideas brewing...\u003C/p\u003E\n"},{"CreatedByName":"astronutkhillips","CreatedById":67981,"CreatedDateTime":"2013-06-13T06:04:37Z","Content":"\n\u003Cp\u003EThe NuMech console is freaking amazing!!! Why in the hell arent all plugin devs using this thing? If I had this a month ago I could have saved about 30hrs of reloading Kerbal over and over and over. \u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003E\u003Cspan style=\u0022font-size:18px;\u0022\u003ETry it!\u003C/span\u003E\u003C/strong\u003E\u003C/p\u003E\n"}]}