{"TopicId":16590,"ForumId":36,"TopicTitle":"Kerbal Space Program Trajectory Optimization Tool","CreatedByName":"Arrowstar","CreatedById":2521,"CreatedDateTime":"2012-08-11T02:06:52Z","PageNum":1,"Articles":[{"CreatedByName":"Arrowstar","CreatedById":2521,"CreatedDateTime":"2012-08-11T02:06:52Z","Content":"\n\u003Cp\u003EHi everyone!\u003C/p\u003E\u003Cp\u003EThose of you from Orbiter-Forum may recognize me as the author of the \u003Ca href=\u0022http://www.orbithangar.com/searchid.php?ID=5418\u0022 rel=\u0022external nofollow\u0022\u003ETrajectory Optimization Tool\u003C/a\u003E (TOT), a software application designed to make finding optimal interplanetary trajectories in the Earth\u0027s solar system easy. Given that I\u0027ve taken TOT as far as I could for Orbiter, I\u0027ve decided that I\u0027d like to do the same for Kerbal Space Program. The aim of this software tool, then, is to provide the KSP community with an easy-to-use application that can find optimal arbitrary trajectories to and from any body in the KSP solar system.\u003C/p\u003E\u003Cp\u003EHow does this differ from the other \u0022orbit calculator\u0022 tools that are out there, you ask? It\u0027s really quite straight forward. Those \u003Cem\u003Eonly\u003C/em\u003E compute particular types of orbits, such as Hohmann transfer orbits, Bi-elliptical transfer orbits, etc. In doing so, these tools make a number of important assumptions about the layout of the solar system and the trajectory that you, as the user, may want to take. The most important underlying assumption of these programs is is this: that the lowest energy transfer is usually the one with the lowest delta-V. However, in real life, this is usually quite wrong, and even simple Earth-Mars trajectories typically have transfer angles less than 180 degrees (Hohmann). On the other hand, KSP TOT uses a sophisticated algorithm known as a Lambert solver to compute two-body trajectories between any two planets/moons/etc. This algorithm will ultimately be passed to an optimizer, which will find the optimal trajectory between where you are and where you want to go. In TOT, I use a genetic algorithm for this work and I\u0027m heavily leaning towards that again here in KSP TOT. \u003C/p\u003E\u003Cp\u003EKSP TOT is currently being written in Java. To demonstrate that this isn\u0027t vaporware, I\u0027d like to show you how my tool compares to analysis that JPL did for the 2005 Earth-Mars transfer. Their \u0022porkchop plot\u0022 (a graph that shows how much energy is required to depart Earth and arrive at Mars) is shown here (credit: Wikipedia):\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cblockquote\u003E\u003Cimg src=\u0022https://upload.wikimedia.org/wikipedia/en/7/70/Porkchop_plot.gif\u0022 alt=\u0022Porkchop_plot.gif\u0022\u003E\u003C/blockquote\u003E\u003Cp\u003EThe minimum C3 energy is about 16 km^2/sec^2.\u003C/p\u003E\u003Cp\u003ENow, consider the same analysis I\u0027ve done with KSP TOT. My version of the porkchop plot is show here:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cblockquote\u003E\u003Cimg src=\u0022http://img442.imageshack.us/img442/8715/marstransferwindow2005.png\u0022 alt=\u0022marstransferwindow2005.png\u0022\u003E\u003C/blockquote\u003E\u003Cp\u003EAs you can see, they are basically identical. I use this to validate the underlying transfer orbit analysis software that I\u0027ve written for KSP TOT. From here on out, it\u0027s really just a matter of passing that algorithm to an optimizer, building a GUI, and finding out what you folks, the users, want from such a tool. In that case, I urge anyone with thoughtful suggestions or questions to post here and I\u0027ll try to get back to you. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003ESo as I said, comments, questions, and concerns are more than welcome. Thanks everyone, and happy orbiting!\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222012-08-11T02:15:37Z\u0022 title=\u002208/11/2012 02:15  AM\u0022 data-short=\u002211 yr\u0022\u003EAugust 11, 2012\u003C/time\u003E by Arrowstar\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"togfox","CreatedById":17083,"CreatedDateTime":"2012-08-11T02:14:15Z","Content":"\n\u003Cp\u003ENice. Yet another realism tool. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E I\u0027ll watch this thread closely.\u003C/p\u003E\n"},{"CreatedByName":"pina_coladas","CreatedById":9346,"CreatedDateTime":"2012-08-12T00:28:05Z","Content":"\n\u003Cp\u003EVery cool and just in time for the expanded solar system in 0.17! I\u0027m curious about the genetic algorithm though. How long did it take to compute that earth-mars transfer in your graph? Can a typical desktop computer spit these things out relatively quickly or do they have to chug along for a bit? Do they use genetic algorithms for this stuff at JPL too?\u003C/p\u003E\n"},{"CreatedByName":"silent_prtoagonist","CreatedById":1927,"CreatedDateTime":"2012-08-12T02:34:35Z","Content":"\n\u003Cp\u003EI considered doing something like this for my final project in the optimization course I took last spring (although I ended up doing a different project); I\u0027ll be very interested to follow your development. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EI\u0027m also curious about the choice of a genetic algorithm. It seems like this wouldn\u0027t be a difficult problem for the more efficient algorithms, as long as you don\u0027t mind loosing the capacity to find multiple minima...\u003C/p\u003E\n"},{"CreatedByName":"Arrowstar","CreatedById":2521,"CreatedDateTime":"2012-08-12T20:28:28Z","Content":"\n\u003Cp\u003EFor simple trajectories, a genetic algorithm is not efficient. In that, both of you are correct. However, consider the case where you are trying to find optimal departure and arrival times for four or five different bodies on an interplanetary tour. A genetic algorithm works quite well here because it searches a large portion of the design space (which, for this example, is very large) in parallel. \u003C/p\u003E\u003Cp\u003EAs for the question about computing speed, it is \u0022fast enough.\u0022 Yes, a solution will take a minute or two to converge in all likelihood. In the TOT for Orbiter, I wrote my code in MATLAB and typically was able to find trajectories in under 5 minutes. The more complicated the trajectory (or, the more design variables) and the bigger the population you use to search the design space, the slower the computations will be. I\u0027m really not too concerned about speed, though. Prior experience has shown that it will be fine in most cases. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EAlso, I should point out that the graph that I showed up there is just a simple search across the design space, picking N departure times and M arrival times. I just evaluated the C3 energy cost for each of those points to generate the contour. In general, the genetic algorithm would not have to do this, and will be far more efficient... \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E Pina, it took about 20 seconds to generate the graph in this way.\u003C/p\u003E\u003Cp\u003EDo they use GAs at JPL? Honestly, I don\u0027t know. I know that a number of universities have used GAs for advanced trajectory optimization work and papers have been published, some of which I have read. It seems like a promising field of study.\u003C/p\u003E\u003Cp\u003E---------------\u003C/p\u003E\u003Cp\u003EAnyway, an update: yesterday I did some GUI work on the Flight Plan designer and today I\u0027m going to be working on the related computations. As I\u0027ve said, I\u0027ve already done a bunch of this before with Orbiter TOT, so it shouldn\u0027t be too terrible. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"TheCardinal","CreatedById":22874,"CreatedDateTime":"2012-08-12T21:29:57Z","Content":"\n\u003Cp\u003EBeautiful plots, Arrowstar, if only i knew how to read them (or use them). Could you explain what kind of information is in them and how someone can use them?\u003C/p\u003E\n"},{"CreatedByName":"Arrowstar","CreatedById":2521,"CreatedDateTime":"2012-08-12T21:46:04Z","Content":"\n\u003Cp\u003ESure. I\u0027m just going to discuss mine, since the JPL plot is a bit more advanced and shows more information. C3 energy is the term we use to describe how much kinetic energy the spacecraft must provide to reach a destination in space \u003Cem\u003Ebeyond\u003C/em\u003E that required to leave its current gravity well. In my example, it\u0027s the amount of kinetic energy needed to get to Mars from Earth. We use this as a metric because presumably it takes the same amount of kinetic energy to get up to escape speed regardless of the direction in which you apply it to leave. (Keep in mind that this assumes that Earth and its gravity well is infinitely small and that the spacecraft is in solar orbit at the same place the Earth is.)\u003C/p\u003E\u003Cp\u003EThe color bar on the right of the plot shows which contours correspond to higher or lower C3 energy. The bluer you get, the less energy needed to get to Mars. The redder you get, the more energy needed. \u003C/p\u003E\u003Cp\u003EThe reason there are two minimum points (two sets of \u0022porkchops\u0022) is that there are two different ways to get to Mars. You can find trajectories that are \u0022short way\u0022 (transfer angle around the Sun less than 180 degrees) and you can find \u0022long way\u0022 trajectories that have transfer angles greater than 180 degrees around the Sun. Transfer angle is kind of like the change in true anomaly needed to get to where you\u0027re going. In my plot, it turns out that the upper porkchop is the \u0022long way\u0022 (or Type 2) transfer, and the lower porkchop is the \u0022short way\u0022 (or Type I) transfer.\u003C/p\u003E\u003Cp\u003EThe labels on the x and y axis are Earth departure and Mars arrival times, given in Julian Date. So, if you want to leave Earth on a particular day and arrive at Mars on a particular day, just find that point on the grid and look up the C3 energy on the color bar. Viola: you know how much energy is required to get you to Mars for those dates.\u003C/p\u003E\u003Cp\u003EI think that\u0027s about it... did I lose you (or anyone else)? Any questions? \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"domox","CreatedById":17108,"CreatedDateTime":"2012-08-12T22:52:39Z","Content":"\n\u003Cp\u003EThat is super handy.\u003C/p\u003E\n"},{"CreatedByName":"silent_prtoagonist","CreatedById":1927,"CreatedDateTime":"2012-08-13T01:06:45Z","Content":"\n\u003Cp\u003EAh, that makes sense about the GAs, I wasn\u0027t thinking about multiple-encounter missions.\u003C/p\u003E\n"},{"CreatedByName":"TheCardinal","CreatedById":22874,"CreatedDateTime":"2012-08-13T18:28:13Z","Content":"\n\u003Cp\u003EThe explanation was very clear and understandable. The only thing i still don\u0027t get is the julian date in the x and y-axis. In the x-axis i see five times 2.4536 and two times 2.4537 (times 10^6), in the Y-axis there are also multiple occurences of the same value. Why is that and what julian date is 2453600?\u003C/p\u003E\n"},{"CreatedByName":"domox","CreatedById":17108,"CreatedDateTime":"2012-08-13T19:38:07Z","Content":"\n\u003Cp\u003E\u003Ca href=\u0022http://www.wolframalpha.com/input/?i=2.4536\u002Bto\u002Bjulian\u002Bdate\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://www.wolframalpha.com/input/?i=2.4536\u002Bto\u002Bjulian\u002Bdate\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EWolfram is indispensable with this game (and math in general)...\u003C/p\u003E\n"},{"CreatedByName":"Arrowstar","CreatedById":2521,"CreatedDateTime":"2012-08-14T01:34:08Z","Content":"\n\u003Cp\u003ETheCardinal: The reason that you see the date repeating on the axis is because of truncation of the numbers. Julian dates are long strings and there wasn\u0027t enough room on the axis to fit all the digits, hence why you see the \u0022same\u0022 date repeating. In reality, they are different dates, I promise! Had I elected to use a shorter date format, such as modified Julian date (MJD), you\u0027d be able to read the numbers better. Sorry for the confusion!\u003C/p\u003E\n"},{"CreatedByName":"Arrowstar","CreatedById":2521,"CreatedDateTime":"2012-08-14T05:05:47Z","Content":"\n\u003Cp\u003EI did a bit of work on KSP TOT yesterday and today, and I have something to show for it. Presenting version 1 of the user interface...\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://img19.imageshack.us/img19/8207/ksptot.png\u0022 alt=\u0022ksptot.png\u0022\u003E\u003C/p\u003E\u003Cp\u003EWhat do you guys think? Keep in mind this is very heavily Work in Progress...\u003C/p\u003E\n"},{"CreatedByName":"togfox","CreatedById":17083,"CreatedDateTime":"2012-08-14T06:05:36Z","Content":"\n\u003Cp\u003ENice. Happy to discretely test it under a NDA (\u0026lt;-- NDA part is a joke, testing part is not).\u003C/p\u003E\n"},{"CreatedByName":"Arrowstar","CreatedById":2521,"CreatedDateTime":"2012-08-14T13:29:36Z","Content":"\n\u003Cp\u003EI will need testers, and will happily take you up on your offer when the application actually gets to the point where there\u0027s something to test. Right now I still need to implement all the delta-V calculation code, though I have the theory all figured out right now. \u003C/p\u003E\u003Cp\u003EBy the way, are the any particular feature requests while I\u0027m thinking of it? What would make life easier as an interplanetary Kerbonaut?\u003C/p\u003E\n"},{"CreatedByName":"Arrowstar","CreatedById":2521,"CreatedDateTime":"2012-08-15T05:02:46Z","Content":"\n\u003Cp\u003ESo tonight I finished up the calculation segment of the code so far as will be necessary for a 0.1 release. I added functions that compute departure C3 energy, delta-V for powered gravity assist maneuvers, and hyperbolic arrival delta-V (basically the Sun-relative difference between the spacecraft velocity and the planet velocity). For the 0.2 release I\u0027ll add functions for computing delta-V directly from your initial orbit around Kerbin or whatever and for your desired final orbit around whatever body you\u0027ve selected as a destination. That\u0027ll provide for a bit more accuracy in the analysis, but the 0.1 release will have calculations that will be almost just as good for trajectory optimization.\u003C/p\u003E\u003Cp\u003EI also worked on the GUI a bit more. The gravity assist flight plan segment interface is 90% done now.\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://img191.imageshack.us/img191/5857/ksptot2.png\u0022 alt=\u0022ksptot2.png\u0022\u003E\u003C/p\u003E\u003Cp\u003EThat\u0027s it for now. As usual, comments and feedback welcome...\u003C/p\u003E\n"},{"CreatedByName":"pina_coladas","CreatedById":9346,"CreatedDateTime":"2012-08-15T07:50:15Z","Content":"\n\u003Cp\u003EAre you planning on presenting some kind of instrumentation or data in-game? Maybe eventually mechjeb integration? Is it too soon to ask?...\u003C/p\u003E\n"},{"CreatedByName":"TheCardinal","CreatedById":22874,"CreatedDateTime":"2012-08-15T07:59:51Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022pina_coladas\u0022 data-cite=\u0022pina_coladas\u0022\u003E\u003Cdiv\u003EAre you planning on presenting some kind of instrumentation or data in-game? Maybe eventually mechjeb integration? Is it too soon to ask?...\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI\u0027ve been thinking the same thing. In my opinion the gravity assist will become quite important as soon as more planets and moons are added to KSP, especially for the distant ones. The autom8te option in Mechjeb probably can be used for setting the trajectory.\u003C/p\u003E\n"},{"CreatedByName":"togfox","CreatedById":17083,"CreatedDateTime":"2012-08-15T08:12:20Z","Content":"\n\u003Cp\u003EId offer improvements but i cant till ive seen the first version. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EPm me when its ready and ill give it and the formulas a good bashing. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Arrowstar","CreatedById":2521,"CreatedDateTime":"2012-08-15T13:22:16Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022pina_coladas\u0022 data-cite=\u0022pina_coladas\u0022\u003E\u003Cdiv\u003EAre you planning on presenting some kind of instrumentation or data in-game? Maybe eventually mechjeb integration? Is it too soon to ask?...\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI would LOVE to have MechJeb integration. I\u0027ve actually been thinking about this a fair amount and I think I could pull it off. Of course, I would need R4m0n\u0027s help as he would have to parse the data coming out of KSP TOT, be it either a data stream from the application or some type of flat file with the trajectory information in it or something.\u003C/p\u003E\u003Cp\u003ECan I assume this is something a lot of people want to see?\u003C/p\u003E\u003Cp\u003ETogfox: Sounds good. Shoot me a PM and I\u0027ll ship you a copy of v0.1 when I\u0027ve got it ready. Might even be this weekend if I can get things cleaned up enough. Keep in mind that it will be very WIP....\u003C/p\u003E\n"},{"CreatedByName":"jeff_9219","CreatedById":23754,"CreatedDateTime":"2012-08-15T17:41:28Z","Content":"\n\u003Cp\u003EWhat are the chances of a version for us dreaded mac users? eventually closer to release at least?\u003C/p\u003E\n"},{"CreatedByName":"TheCardinal","CreatedById":22874,"CreatedDateTime":"2012-08-15T19:00:12Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Arrowstar\u0022 data-cite=\u0022Arrowstar\u0022\u003E\u003Cdiv\u003E\u003Cp\u003ECan I assume this is something a lot of people want to see?\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI certainly would like to see this integrated. The further the planet/moon will be, the more use it will be to KSP users. Of course those will be reachable with a lot of fuel and boosters but with a gravity assist the craft doesn\u0027t need to be humongeous. And it will add an extra element to the game.\u003C/p\u003E\n"},{"CreatedByName":"Arrowstar","CreatedById":2521,"CreatedDateTime":"2012-08-16T01:09:36Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022jeff_9219\u0022 data-cite=\u0022jeff_9219\u0022\u003E\u003Cdiv\u003EWhat are the chances of a version for us dreaded mac users? eventually closer to release at least?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ESince it\u0027s written in Java, as long as you can obtain version 7 of the Java Runtime Environment, you should be able to use it. Since I\u0027m using the native theme for the GUI, it should even sort of resemble a normal Mac application. If you want to volunteer to test it on Mac, I\u0027d be happy to give it to you whenever I finish v0.1.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022TheCardinal\u0022 data-cite=\u0022TheCardinal\u0022\u003E\u003Cdiv\u003EI certainly would like to see this integrated. The further the planet/moon will be, the more use it will be to KSP users. Of course those will be reachable with a lot of fuel and boosters but with a gravity assist the craft doesn\u0027t need to be humongeous. And it will add an extra element to the game.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EAlrighty then! Whenever I get to a good point, I\u0027ll try to get in touch with R4m0n and see what he says. No promises, obviously, since it\u0027ll be on him to do a good chunk of the work involved in any integration effort.\u003C/p\u003E\n"},{"CreatedByName":"pina_coladas","CreatedById":9346,"CreatedDateTime":"2012-08-16T08:30:35Z","Content":"\n\u003Cp\u003EHere\u0027s a question for you: does your system assume instantaneous impulse to the desired trajectory? I only ask because in the Kerbal universe celestial bodies are so tiny that a low thrust to weight ratio craft can get pretty far from apoapsis during an insertion burn, which I imagine would throw off the accuracy of some of the more delicate slingshot maneuvers. Is this a dumb question? Am I asking something outside the scope of this project?\u003C/p\u003E\n"},{"CreatedByName":"Arrowstar","CreatedById":2521,"CreatedDateTime":"2012-08-16T13:21:53Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022pina_coladas\u0022 data-cite=\u0022pina_coladas\u0022\u003E\u003Cdiv\u003EHere\u0027s a question for you: does your system assume instantaneous impulse to the desired trajectory? I only ask because in the Kerbal universe celestial bodies are so tiny that a low thrust to weight ratio craft can get pretty far from apoapsis during an insertion burn, which I imagine would throw off the accuracy of some of the more delicate slingshot maneuvers. Is this a dumb question? Am I asking something outside the scope of this project?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ENot a dumb question at all! You are correct, KSP TOT does assume impulsive maneuvers. If i wanted to do finite duration maneuvers, the whole problem becomes \u003Cem\u003Ea lot\u003C/em\u003E more complicated to compute. I would have to write the equations of motion of the spacecraft and then integrate those numerically while somehow enforcing the end conditions of arrival and departure at the correct bodies. It would be a nightmare.\u003C/p\u003E\u003Cp\u003EKSP TOT isn\u0027t designed to be perfectly accurate, though for most interplanetary situations it should be good enough as to not be noticeable. Instead, it\u0027s designed to basically tell you when to leave home and what your transfer orbits should approximately look like. Of course, since KSP uses a two-body model of motion, it should actually be possible to follow the computed trajectory perfectly after the initial burn, assuming you hit your gravity assist maneuvers perfectly. But I\u0027ll leave that little problem to the pilots. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif\u0022 alt=\u0022;)\u0022\u003E\u003C/p\u003E\n"}]}