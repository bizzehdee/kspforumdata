{"TopicId":103963,"ForumId":36,"TopicTitle":"[WIP][1.9.x-1.12.x] Scatterer-atmospheric scattering (0.0838 - 14/08/2022) Scattering improvements, in-game atmo generation and multi-sun support","CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-04-12T08:37:35Z","PageNum":39,"Articles":[{"CreatedByName":"Minarkhaios","CreatedById":58867,"CreatedDateTime":"2015-06-02T20:44:25Z","Content":"Fair enough, I understand now why this is not so simple. Thanks to the three of you for your answers.\n\nJust a random though about the up and down for the sea. Is it possible to create an invisible object that will collide with the current ship ? Something small enough used only to push up a bit the current vessel ? And link it\u0027s coordinate with the higher wave below ? (Or the coordinate of what we see as a wave and is just an equation\u0027s representation without physical existence)\n\nI think I will start to investigate on my own and try some stuff with unity (long road but, well, at least I won\u0027t bother anyone with stupid question like this one ![:D](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif) )\n\nEdit : It seems that I\u0027m again totally off subject : [This seems to be a cleaner solution, just moving the object](https://www.shadertoy.com/view/XdsGDB)\n\n**Edited \u003Ctime datetime=\u00222015-06-02T20:52:26Z\u0022 title=\u002206/02/2015 08:52  PM\u0022 data-short=\u00229 yr\u0022\u003EJune 2, 2015\u003C/time\u003E by Minarkhaios**"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-06-02T21:29:07Z","Content":"\u003E \n\u003E Fair enough, I understand now why this is not so simple. Thanks to the three of you for your answers.\n\u003E Just a random though about the up and down for the sea. Is it possible to create an invisible object that will collide with the current ship ? Something small enough used only to push up a bit the current vessel ? And link it\u0027s coordinate with the higher wave below ? (Or the coordinate of what we see as a wave and is just an equation\u0027s representation without physical existence)\n\u003E \n\u003E I think I will start to investigate on my own and try some stuff with unity (long road but, well, at least I won\u0027t bother anyone with stupid question like this one ![:D](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif) )\n\u003E \n\u003E Edit : It seems that I\u0027m again totally off subject : [This seems to be a cleaner solution, just moving the object](https://www.shadertoy.com/view/XdsGDB)\n\nKeep in mind that that object is contained entirely in the shader, to do something similar in KSP you\u0027d have to either get the wave height and position information out of the shader (I think this isn\u0027t feasible or really tricky, maybe rbray could shine some light on this), or do all of the wave calculations outside of the shader so you have all the required data in your program to move the object up or down.\n\nThis could be feasible with the proland water shaders, I haven\u0027t looked much into it but the guy who ported proland to unity did something similar in one of his projects but it was dx11-only.\n\nYou can read about it here if you want [http://scrawkblog.com/2013/06/04/ocean-with-brdf-lighting-in-unity/](http://scrawkblog.com/2013/06/04/ocean-with-brdf-lighting-in-unity/) scroll to the end for the waves thing.\n\n**Edited \u003Ctime datetime=\u00222015-06-02T21:32:31Z\u0022 title=\u002206/02/2015 09:32  PM\u0022 data-short=\u00229 yr\u0022\u003EJune 2, 2015\u003C/time\u003E by blackrack**"},{"CreatedByName":"rbray89","CreatedById":48847,"CreatedDateTime":"2015-06-02T21:35:08Z","Content":"\u003E \n\u003E Keep in mind that that object is contained entirely in the shader, to do something similar in KSP you\u0027d have to either get the wave height and position information out of the shader (I think this isn\u0027t feasible or really tricky, maybe rbray could shine some light on this), or do all of the wave calculations outside of the shader so you have all the required data in your program to move the object up or down.\n\u003E This could be feasible with the proland water shaders, I haven\u0027t looked much into it but the guy who ported proland to unity did something similar in one of his projects but it was dx11-only.\n\nYou could use compute shaders (or do something to a render/texture, and read from that). Those are the only real way to get stuff out of a shader. Might be easier to use the same computational method used in the shader for a single point (ship origin) to do the moving. Hehe, you might even be able to replace the shaders for the craft pards with one that relocates the vertices when within \u0027X\u0027 distance of the ocean ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-06-02T21:37:27Z","Content":"\u003E \n\u003E Hehe, you might even be able to replace the shaders for the craft pards with one that relocates the vertices when within \u0027X\u0027 distance of the ocean .\n\nThis sounds really clever, but could this really work?"},{"CreatedByName":"rbray89","CreatedById":48847,"CreatedDateTime":"2015-06-02T21:45:25Z","Content":"\u003E \n\u003E This sounds really clever, but could this really work?\n\nI see why not... You would want to pass in a vector to the shader every cycle, though all parts would get the same movement, regardless if attached to the same craft or not, so debris might look odd. You\u0027d also want to do this to Kerbal shaders. Note that I mean to fully replace the shader, not use replacement shaders ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif) It would just be REALLY annoying to do this, as the shaders are all closed-source."},{"CreatedByName":"HafCoJoe","CreatedById":80363,"CreatedDateTime":"2015-06-03T03:10:26Z","Content":"\u003E \n\u003E Hehe, you might even be able to replace the shaders for the craft pards with one that relocates the vertices when within \u0027X\u0027 distance of the ocean ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\nWould that alleviate extra lag too? I\u0027m concerned about my FPS when looking at those waves. I\u0027d install regardless of an impact haha. Too beautiful...\n\nEDIT: Say you wouldn\u0027t have a need for a \u0027tester\u0027 would you Blackrack?"},{"CreatedByName":"Minarkhaios","CreatedById":58867,"CreatedDateTime":"2015-06-03T04:26:41Z","Content":"\u003E \n\u003E I see why not... You would want to pass in a vector to the shader every cycle, though all parts would get the same movement, regardless if attached to the same craft or not, so debris might look odd. You\u0027d also want to do this to Kerbal shaders. Note that I mean to fully replace the shader, not use replacement shaders ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif) It would just be REALLY annoying to do this, as the shaders are all closed-source.\n\nWouldn\u0027t it be easier to apply a small force to each part based on the same data ? something similar to the lifting bodies found in ferram mod ? (Or am I again understanding something wrong ?)"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-06-03T07:07:56Z","Content":"\u003E \n\u003E Would that alleviate extra lag too? I\u0027m concerned about my FPS when looking at those waves. I\u0027d install regardless of an impact haha. Too beautiful...\n\u003E EDIT: Say you wouldn\u0027t have a need for a \u0027tester\u0027 would you Blackrack?\n\nWhat kind of GPU do you have? From my testing I\u0027d say as long as you have a gtx 460 or better you shouldn\u0027t be getting any slowdowns from the water. Also, keep in mind the water is still broken in a really bad way and I\u0027ll just post it for everyone to test as soon as it works better. I\u0027ve also started working on full EVE compatibility yesterday.\n\n**Edited \u003Ctime datetime=\u00222015-06-03T09:22:08Z\u0022 title=\u002206/03/2015 09:22  AM\u0022 data-short=\u00229 yr\u0022\u003EJune 3, 2015\u003C/time\u003E by blackrack**"},{"CreatedByName":"bgeery","CreatedById":128020,"CreatedDateTime":"2015-06-03T07:56:59Z","Content":"\u003E \n\u003E **Update: 20-05-2015 - v0.0151 Pink objects quickfix (Please stop reporting this bug)**\n\nCould you please clarify the above statement in post #1? Does this mean this update fixes the bug, so stop reporting issues with older versions? Or, this fixes what you can right now and they have to live with the pink objects, if they still have them with this version?"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-06-03T09:21:09Z","Content":"\u003E \n\u003E Could you please clarify the above statement in post #1? Does this mean this update fixes the bug, so stop reporting issues with older versions? Or, this fixes what you can right now and they have to live with the pink objects, if they still have them with this version?\n\nThis update fixes the bug, except for the pink box in the loading screen but that doesn\u0027t hurt the game."},{"CreatedByName":"bgeery","CreatedById":128020,"CreatedDateTime":"2015-06-03T09:35:53Z","Content":"\u003E \n\u003E This update fixes the bug, except for the pink box in the loading screen but that doesn\u0027t hurt the game.\n\nHuh, \u0027cause I still have \u0027em. ![:(](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_sad.gif) I\u0027m special like that. OpenGL, GTX970\n![xLfQgn0.jpg](http://i.imgur.com/xLfQgn0.jpg)"},{"CreatedByName":"BudgetHedgehog\uFEFF","CreatedById":104112,"CreatedDateTime":"2015-06-03T09:55:11Z","Content":"I\u0027ve had that appear when I revert to launch only. OpenGL too."},{"CreatedByName":"bgeery","CreatedById":128020,"CreatedDateTime":"2015-06-03T10:08:20Z","Content":"\u003E \n\u003E I\u0027ve had that appear when I revert to launch only. OpenGL too.\n\nYup, that\u0027s how I produced them for the screenshot. Didn\u0027t notice if that\u0027s the only way, but you are probably correct, as I\u0027m always doing simulated launches and revert.\n\n**Edited \u003Ctime datetime=\u00222015-06-03T10:15:40Z\u0022 title=\u002206/03/2015 10:15  AM\u0022 data-short=\u00229 yr\u0022\u003EJune 3, 2015\u003C/time\u003E by bgeery**"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2015-06-03T11:01:22Z","Content":"\u003E \n\u003E You could use compute shaders (or do something to a render/texture, and read from that).\n\nWith Unity 5.1 moving to unify the use of compute shader for DX11 and OpenGL that could be a solution at long term."},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-06-03T11:59:29Z","Content":"\u003E \n\u003E Huh, \u0027cause I still have \u0027em. ![:(](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_sad.gif) I\u0027m special like that. OpenGL, GTX970\n\u003E [http://i.imgur.com/xLfQgn0.jpg](http://i.imgur.com/xLfQgn0.jpg)\n\nYeah sorry, It removes the pink textures on gameobjects but some people do report a messed-up UI on OpenGL. What you could try is download the 0.014 version (go to the kerbalstuff link in the OP, click changelog and download 0.014) and copy the replacement shaders folder from 0.014 and drop it in your current version."},{"CreatedByName":"rbray89","CreatedById":48847,"CreatedDateTime":"2015-06-03T14:30:08Z","Content":"\u003E \n\u003E With Unity 5.1 moving to unify the use of compute shader for DX11 and OpenGL that could be a solution at long term.\n\nI was actually thinking about that. It would be neat to see."},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-06-03T20:02:28Z","Content":"Just wanted to post these\n\n![vibvIo3.jpg](http://i.imgur.com/vibvIo3.jpg)\n\n![WUfZcVi.jpg](http://i.imgur.com/WUfZcVi.jpg)"},{"CreatedByName":"Grach","CreatedById":107422,"CreatedDateTime":"2015-06-03T20:19:38Z","Content":"\u003E \n\u003E Just wanted to post these\n\u003E [http://i.imgur.com/vibvIo3.jpg](http://i.imgur.com/vibvIo3.jpg)\n\u003E \n\u003E [http://i.imgur.com/WUfZcVi.jpg](http://i.imgur.com/WUfZcVi.jpg)\n\nAbsolutely stunning ![:0.0:](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_shocked.gif)"},{"CreatedByName":"Proot","CreatedById":98932,"CreatedDateTime":"2015-06-03T21:03:14Z","Content":"\u003E \n\u003E Just wanted to post these\n\u003E [http://i.imgur.com/vibvIo3.jpg](http://i.imgur.com/vibvIo3.jpg)\n\u003E \n\u003E [http://i.imgur.com/WUfZcVi.jpg](http://i.imgur.com/WUfZcVi.jpg)\n\n\u003Ciframe width=\u0022480\u0022 height=\u0022270\u0022 src=\u0022https://www.youtube.com/embed/k4YSeLGqP4k?feature=oembed\u0022 frameborder=\u00220\u0022 allowfullscreen=\u0022true\u0022\u003E\u003C/iframe\u003E\n\nThat reflection works at high distances/map view? It\u0027s configurable?\n\nThe effect is close to perfection, but IMHO the reflection should be a bit wider.\n\nOne detail, Blackrack: would be possible to add a bit of blur at the horizon line to avoid that tiny line that cuts terrain and sky? Would be the perfect touch.\n\nAnd one more thing... what you want before?:\n\nto add the water shader or the multiplanet support? Would be perfect have an intermediate version, to experiment a bit more with the atmos before add oceans to the equation. I\u0027ve created my first set of atmos in a friend\u0027s computer, but I still have some round patch artifacts at certain points (much, much less than before, anyway). But once you modify the altitude/density of the stock atmo, seems a bit hard to get a completely smooth result. Is there any tip/trick to get the perfect smooth?"},{"CreatedByName":"V8jester","CreatedById":136093,"CreatedDateTime":"2015-06-03T21:13:26Z","Content":"\u003E \n\u003E Just wanted to post these\n\u003E [http://i.imgur.com/vibvIo3.jpg](http://i.imgur.com/vibvIo3.jpg)\n\u003E \n\u003E [http://i.imgur.com/WUfZcVi.jpg](http://i.imgur.com/WUfZcVi.jpg)\n\nDon\u0027t bother applauding just throw money at this man! Blackrack every time I come back to your thread I\u0027m amazed. What SEUS did for Minecraft you are doing for KSP. I can\u0027t wait to see the next release."},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-06-03T21:51:19Z","Content":"\u003E \n\u003E \u003Ciframe width=\u0022480\u0022 height=\u0022270\u0022 src=\u0022https://www.youtube.com/embed/k4YSeLGqP4k?feature=oembed\u0022 frameborder=\u00220\u0022 allowfullscreen=\u0022true\u0022\u003E\u003C/iframe\u003E\n\u003E \n\u003E That reflection works at high distances/map view? It\u0027s configurable?\n\u003E \n\u003E The effect is close to perfection, but IMHO the reflection should be a bit wider.\n\u003E \n\u003E One detail, Blackrack: would be possible to add a bit of blur at the horizon line to avoid that tiny line that cuts terrain and sky? Would be the perfect touch.\n\u003E \n\u003E And one more thing... what you want before?:\n\u003E \n\u003E to add the water shader or the multiplanet support? Would be perfect have an intermediate version, to experiment a bit more with the atmos before add oceans to the equation. I\u0027ve created my first set of atmos in a friend\u0027s computer, but I still have some round patch artifacts at certain points (much, much less than before, anyway). But once you modify the altitude/density of the stock atmo, seems a bit hard to get a completely smooth result. Is there any tip/trick to get the perfect smooth?\n\nOnce you get past a certain distance the effect is just this water color and reflection [http://i.imgur.com/U7oD7Uh.jpg](http://i.imgur.com/U7oD7Uh.jpg), no more waves are generated, this could be easily made to work at a high distance or in scaled space, in fact, this is what proland does to improve performance, once past a certain distance the water is disabled and the water color and sun reflection are rendered directly in the terrain shader.\n\nI did some progress on the water shader but there is still a huge issue I haven\u0027t figured out and so I might take another break from it and do something else first. I\u0027ve already started working on full EVE compatibility but haven\u0027t had that much free time to put into it yet. I\u0027ve actually been putting off multiple planets because it\u0027s a bit of a \u0022chore\u0022 to do and I wanted to do the fun stuff first, there\u0027s also that reflectedlight thing that should get rid of soupiness from orbit. To summarize I\u0027ll probably have full EVE compatibility ready this week-end or somewhere in the middle of next week and after that it\u0027s either fixing the water or adding multiple planets.\n\nYou\u0027re right about the blur at the horizon, I always see it happening in real-life and can never tell where the sea ends and the sky begins, especially if I\u0027m looking at it from a mountain. I can see this being feasible in the postprocessing shader.\n\nTo get smooth results I always make sure to multiply the default Rt and RL values by the same coefficient, I basically don\u0027t change their ratios, and then I play with HR until it looks right, HM is more forgiving but generally gives a really cloudy/heavy atmosphere feel. Because the atmospheric model used in proland requires physical correctness, artistic control can be really limited but keeping the default ratios of Rt and RL generally results in good results, this is how I do it anyway.\n\nAlso, if you\u0027re getting the round patches past 200km, ignore these, these are caused by my \u0022experimental\u0022 idea of changing the camera\u0027s clipping planes once they reach their limit and the way I do it right now is really messy, it doesn\u0027t mean your atmosphere isn\u0027t right and it\u0027ll probably work fine in future versions.\n\n**Edited \u003Ctime datetime=\u00222015-06-03T22:07:46Z\u0022 title=\u002206/03/2015 10:07  PM\u0022 data-short=\u00229 yr\u0022\u003EJune 3, 2015\u003C/time\u003E by blackrack**"},{"CreatedByName":"V8jester","CreatedById":136093,"CreatedDateTime":"2015-06-03T22:16:34Z","Content":"Hey I had a question. Will the waves in the water you are working on, affect a floating craft? Or will the craft settle into a static position same as it does in vanilla?"},{"CreatedByName":"BudgetHedgehog\uFEFF","CreatedById":104112,"CreatedDateTime":"2015-06-03T23:12:13Z","Content":"\u003E \n\u003E will the craft settle into a static position same as it does in vanilla?\n\nThat one.\n\nAnyway, yer a wizard, blackrack. It\u0027s looking gorgeous!"},{"CreatedByName":"SmallFatFetus","CreatedById":137860,"CreatedDateTime":"2015-06-03T23:27:48Z","Content":"\u003Ciframe width=\u0022480\u0022 height=\u0022270\u0022 src=\u0022https://www.youtube.com/embed/ceJ_DeT-c3M?feature=oembed\u0022 frameborder=\u00220\u0022 allowfullscreen=\u0022true\u0022\u003E\u003C/iframe\u003E\n\n\u003Ciframe width=\u0022480\u0022 height=\u0022270\u0022 src=\u0022https://www.youtube.com/embed/ceJ_DeT-c3M?feature=oembed\u0022 frameborder=\u00220\u0022 allowfullscreen=\u0022true\u0022\u003E\u003C/iframe\u003E\n\nCould a script be set up to gently rock the capsule/boat/whatever when smashed down?\n\nCould you add better splashes?\n\nCloud you add better sounds, and get rid of the loud-and-ugly-sounding \u0022WHUMP\u0022 when you hit the water?\n\nCould you add some nice noises of water lapping against the side of the craft?\n\nWonderful job on the water. It\u0027s coming along nice.\n\nSmallFatFetus\n\n**Edited \u003Ctime datetime=\u00222015-06-03T23:33:56Z\u0022 title=\u002206/03/2015 11:33  PM\u0022 data-short=\u00229 yr\u0022\u003EJune 3, 2015\u003C/time\u003E by SmallFatFetus**"},{"CreatedByName":"RyanRising","CreatedById":79932,"CreatedDateTime":"2015-06-04T01:21:45Z","Content":"\u003E \n\u003E \u003Ciframe width=\u0022480\u0022 height=\u0022270\u0022 src=\u0022https://www.youtube.com/embed/ceJ_DeT-c3M?feature=oembed\u0022 frameborder=\u00220\u0022 allowfullscreen=\u0022true\u0022\u003E\u003C/iframe\u003E\n\u003E \n\u003E \n\u003E \u003Ciframe width=\u0022480\u0022 height=\u0022270\u0022 src=\u0022https://www.youtube.com/embed/ceJ_DeT-c3M?feature=oembed\u0022 frameborder=\u00220\u0022 allowfullscreen=\u0022true\u0022\u003E\u003C/iframe\u003E\n\u003E \n\u003E Could a script be set up to gently rock the capsule/boat/whatever when smashed down?\n\u003E \n\u003E Could you add better splashes?\n\u003E \n\u003E Cloud you add better sounds, and get rid of the loud-and-ugly-sounding \u0022WHUMP\u0022 when you hit the water?\n\u003E \n\u003E Could you add some nice noises of water lapping against the side of the craft?\n\u003E \n\u003E Wonderful job on the water. It\u0027s coming along nice.\n\u003E \n\u003E SmallFatFetus\n\nPizzaoverhead (Your go-to sound guy) has a mod for that last one, but I think that the scope of this mod is just visual effects.\n\nIt doesn\u0027t actually sound too hard to make a small torque in the water that rocks your vessel back and forth when it\u0027s \u0022Splashed Down\u0022, but I have no coding experience. I don\u0027t think it would add too much to your experience, though, and it does sound near-impossible to make it sync up with the waves. \n\nThe water sounds mod is [here](https://forum.kerbalspaceprogram.com/threads/122158).\n\n**Edited \u003Ctime datetime=\u00222015-06-05T15:13:07Z\u0022 title=\u002206/05/2015 03:13  PM\u0022 data-short=\u00229 yr\u0022\u003EJune 5, 2015\u003C/time\u003E by RyanRising**\n  \nMore specific. DISCLAIMER: It doesn\u0027t sound too hard, but it might be very, very difficult. I can\u0027t tell."}]}