{"TopicId":103963,"ForumId":36,"TopicTitle":"[WIP][1.9.x-1.12.x] Scatterer-atmospheric scattering (0.0838 - 14/08/2022) Scattering improvements, in-game atmo generation and multi-sun support","CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-04-12T08:37:35Z","PageNum":218,"Articles":[{"CreatedByName":"Galileo","CreatedById":150430,"CreatedDateTime":"2016-12-09T21:12:01Z","Content":"\u003E \n\u003E \n\u003E 3 minutes ago, blackrack said:\n\u003E \n\u003E \n\u003E Who can guess what\u0027s going on here?\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E  \n\u003E \n\u003E \n\u003E \n\u003E \n\u003E [![Y4IVDe2.png](http://i.imgur.com/Y4IVDe2.png)](http://i.imgur.com/Y4IVDe2.png \u0022Enlarge image\u0022)\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E  \n\u003E \n\u003E \n\u003E \n\u003E \n\u003E [![XJmjqBq.png](http://i.imgur.com/XJmjqBq.png)](http://i.imgur.com/XJmjqBq.png \u0022Enlarge image\u0022)\n\u003E \n\nIt would be unfair for me to guess,  but I know...  And it\u0027s awesome\n\n**Edited \u003Ctime datetime=\u00222016-12-09T21:13:02Z\u0022 title=\u002212/09/2016 09:13  PM\u0022 data-short=\u00227 yr\u0022\u003EDecember 9, 2016\u003C/time\u003E by Galileo**"},{"CreatedByName":"Shadowmage","CreatedById":138730,"CreatedDateTime":"2016-12-09T21:18:05Z","Content":"\u003E \n\u003E \n\u003E 5 minutes ago, blackrack said:\n\u003E \n\u003E \n\u003E Who can guess what\u0027s going on here?\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E [...]\n\u003E \n\nLooks like some inverted / incorrectly calculated normals.... and something else.  Perhaps an incorrect normalization of the normals in the shader?\n\nFrom the looks of it I would also guess that you are trying to work on figuring out the shadows for the planetary rings, perhaps using the visible output of the shader as debugging for the ring-planet occlusion data."},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2016-12-09T21:35:00Z","Content":"\u003E \n\u003E \n\u003E 17 minutes ago, Shadowmage said:\n\u003E \n\u003E \n\u003E Looks like some inverted / incorrectly calculated normals.... and something else.  Perhaps an incorrect normalization of the normals in the shader?\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E From the looks of it I would also guess that you are trying to work on figuring out the shadows for the planetary rings, perhaps using the visible output of the shader as debugging for the ring-planet occlusion data.\n\u003E \n\nClose on the second line, trying to figure out shadows. What you\u0027re seeing on the planet is the UV coordinates (technically only one coordinate needed for the ring texture) of the point on the ring that that is casting the shadow on the planet, completely black areas on the planet are areas not receiving any ring shadows.\n\nMap black to the right of say, a ring texture like [this](http://i0.wp.com/www.sovietunit.net/wp-content/uploads/2011/11/SaturnRings.png) and white to the left, then take (1-alpha) and it should be good.\n\nAll that\u0027s left is to do a texture fetch, however it seems I can\u0027t grab the ring texture directly from the ring material itself. Getting a grey texture instead so might have to use C# reflection again. Will post more pics when I make more progress.\n\n**Edited \u003Ctime datetime=\u00222016-12-09T21:35:30Z\u0022 title=\u002212/09/2016 09:35  PM\u0022 data-short=\u00227 yr\u0022\u003EDecember 9, 2016\u003C/time\u003E by blackrack**"},{"CreatedByName":"Li0n","CreatedById":142527,"CreatedDateTime":"2016-12-09T21:41:14Z","Content":"\u003E \n\u003E \n\u003E 30 minutes ago, blackrack said:\n\u003E \n\u003E \n\u003E Who can guess what\u0027s going on here?\n\u003E \n\nRemind me of this :\n\nSpoiler\n\n![pcvJlUM.jpg](http://i.imgur.com/pcvJlUM.jpg)"},{"CreatedByName":"Errol","CreatedById":118622,"CreatedDateTime":"2016-12-09T22:50:38Z","Content":"If the camera is on the backside of the rings relative to the sun (as I\u0027m picturing it in order for the rings to cast that \u0022white shadow\u0022 on the planet) wouldn\u0027t the rings be much harder to see, as we would be seeing the unlit side of all the objects in them? I thought I saw ring shader images in this thread once that showed this type of behavior."},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2016-12-09T23:00:29Z","Content":"\u003E \n\u003E \n\u003E 10 minutes ago, Errol said:\n\u003E \n\u003E \n\u003E If the camera is on the backside of the rings relative to the sun (as I\u0027m picturing it in order for the rings to cast that \u0022white shadow\u0022 on the planet) wouldn\u0027t the rings be much harder to see, as we would be seeing the unlit side of all the objects in them? I thought I saw ring shader images in this thread once that showed this type of behavior.\n\u003E \n\nI\u0027m assuming the rings are not completely matte/opaque and instead made of small particles and/or ice. Therefore I added a bit of mie scattering when seen from the back and took some liberties with the shading relative to the light source. Will still adjust it later if it feels wrong.\n\nLook here:\n\n\u003Ciframe allowfullscreen=\u0022true\u0022 frameborder=\u00220\u0022 height=\u0022270\u0022 src=\u0022https://www.youtube.com/embed/SbQyUBGfE48?feature=oembed\u0022 width=\u0022480\u0022\u003E\u003C/iframe\u003E\n\n**Edited \u003Ctime datetime=\u00222016-12-09T23:01:10Z\u0022 title=\u002212/09/2016 11:01  PM\u0022 data-short=\u00227 yr\u0022\u003EDecember 9, 2016\u003C/time\u003E by blackrack**"},{"CreatedByName":"Errol","CreatedById":118622,"CreatedDateTime":"2016-12-09T23:13:03Z","Content":"Oh man!  \n\nI\u0027m not playing the experimental release because it is bugged for me with Galileo\u0027s SVE, but man, it will be nuts when we have all this wrapped up together! I play with axial tilt \u003Cabbr title=\u0022Real Solar System (mod)\u0022\u003ERSS\u003C/abbr\u003E style as well, so eclipses are far more rare. Pretty much the only thing I can think of that isn\u0027t in the game yet in some way is seasons for kerbin."},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2016-12-09T23:24:40Z","Content":"Just got ring shadows working, here is a quick image dump using saturn from [@Galileo](https://forum.kerbalspaceprogram.com/index.php?/profile/150430-galileo/)\u0027s SSRSS. Sorry for bad compression\n\n![KBEoIBt.jpg](http://i.imgur.com/KBEoIBt.jpg)\n\n![EEG9EY9.jpg](http://i.imgur.com/EEG9EY9.jpg)\n\n![p1Ubptu.jpg](http://i.imgur.com/p1Ubptu.jpg)\n\n![EIZ0tNU.jpg](http://i.imgur.com/EIZ0tNU.jpg)\n\n![jADgyx4.jpg](http://i.imgur.com/jADgyx4.jpg)\n\n![vwZM1Dn.jpg](http://i.imgur.com/vwZM1Dn.jpg)\n\n![ZoG6pv3.jpg](http://i.imgur.com/ZoG6pv3.jpg)\n\n![jVa3bW1.jpg](http://i.imgur.com/jVa3bW1.jpg)\n\nThe rings and the shadows are a bit aliased and a bit rough but I suspect mipmapping or manually doing something similar should fix it. Shadows are also a bit weak, may need to boost them a bit instead of just using the ring texture alpha value.\n\nAlso, I still need to fade the rings into fine particles/noise when zooming in on them.\n\n**Edited \u003Ctime datetime=\u00222016-12-09T23:37:06Z\u0022 title=\u002212/09/2016 11:37  PM\u0022 data-short=\u00227 yr\u0022\u003EDecember 9, 2016\u003C/time\u003E by blackrack**"},{"CreatedByName":"Poodmund","CreatedById":128643,"CreatedDateTime":"2016-12-10T00:22:10Z","Content":"![nk12xotFCd0Na.gif](http://i.giphy.com/nk12xotFCd0Na.gif)\n\nYou\u0027re my hero! ![:D](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif \u0022:D\u0022)"},{"CreatedByName":"Li0n","CreatedById":142527,"CreatedDateTime":"2016-12-10T09:11:34Z","Content":"Those last pics looks really amazing ![:confused:](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_huh.gif \u0022:confused:\u0022)\n\nI realize this \u0022shadow rings\u0022 are still WIP but do they have a lot of impact on performance ?"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2016-12-10T09:15:02Z","Content":"\u003E \n\u003E \n\u003E 2 hours ago, Li0n said:\n\u003E \n\u003E \n\u003E Those last pics looks really amazing ![:confused:](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_huh.gif \u0022:confused:\u0022)\n\u003E \n\u003E \n\u003E \n\u003E I realize this \u0022shadow rings\u0022 are still WIP but do they have a lot of impact on performance ?\n\u003E \n\nThey shouldn\u0027t, literally just a plane-ray intersection calculation and a texture fetch. But as always, it depends on your hardware. Should have about as much impact as the eclipses.\n\n**Edited \u003Ctime datetime=\u00222016-12-10T11:56:19Z\u0022 title=\u002212/10/2016 11:56  AM\u0022 data-short=\u00227 yr\u0022\u003EDecember 10, 2016\u003C/time\u003E by blackrack**"},{"CreatedByName":"Li0n","CreatedById":142527,"CreatedDateTime":"2016-12-10T09:16:26Z","Content":"\u003E \n\u003E \n\u003E 1 minute ago, blackrack said:\n\u003E \n\u003E \n\u003E No they shouldn\u0027t, literally just a plane-ray intersection calculation and a texture fetch. But as always, it depends on your hardware. Should have about as much impact as the eclipses.\n\u003E \n\nNow this is (amazing)\u00B2 ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif \u0022:)\u0022)"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2016-12-10T17:47:48Z","Content":"\u003E \n\u003E \n\u003E 18 hours ago, Errol said:\n\u003E \n\u003E \n\u003E Pretty much the only thing I can think of that isn\u0027t in the game yet in some way is seasons for kerbin.\n\u003E \n\nYeah seasons might be a bit more complicated...\n\nHowever I would like to know what kind of other shaders you guys would like to see in the game, eg other shaders for Kopernicus or stuff like that."},{"CreatedByName":"cy4n","CreatedById":185531,"CreatedDateTime":"2016-12-10T17:48:31Z","Content":"Bloom, DoF, better reflections, and more godrays."},{"CreatedByName":"NeoFatalis","CreatedById":153893,"CreatedDateTime":"2016-12-10T17:56:40Z","Content":"Maybe motion blur?"},{"CreatedByName":"Galileo","CreatedById":150430,"CreatedDateTime":"2016-12-10T17:57:27Z","Content":"\u003E \n\u003E \n\u003E 10 minutes ago, blackrack said:\n\u003E \n\u003E \n\u003E Yeah seasons might be a bit more complicated...\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E However I would like to know what kind of other shaders you guys would like to see in the game, eg other shaders for Kopernicus or stuff like that.\n\u003E \n\nDOF would be the most noticeable and appreciated.. but it also probably comes with a big performance hit ![:(](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_sad.gif \u0022:(\u0022)\n\n**Edited \u003Ctime datetime=\u00222016-12-10T17:57:54Z\u0022 title=\u002212/10/2016 05:57  PM\u0022 data-short=\u00227 yr\u0022\u003EDecember 10, 2016\u003C/time\u003E by Galileo**"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2016-12-10T18:09:36Z","Content":"Hmm, I\u0027m surprised by the number of people who actually want DoF, usually it\u0027s the first option I disable in any game."},{"CreatedByName":"Errol","CreatedById":118622,"CreatedDateTime":"2016-12-10T18:30:49Z","Content":"DoF effects in games are usually quite bad. I don\u0027t know much about programming and shaders, but I am a professional photographer, so I can shed some light on this.\n\nThere are actually 4 variables that affect the length of the depth of field (how many things are in focus), and even more factors that go into determining the \u0022quality of the bokeh\u0022 or how the out of focus areas look, I\u0027m not going to focus on that though. I just want to talk about the length of the depth of field. So here are the four factors. Focal length, focal distance, size of images sensor area and aperture, also the effects are cumulative. Generally aperture is the primary variable for controlling DoF in photography, as it usually has the most immediately and profoundly noticeable effect on DoF (a smaller aperture gives a longer depth of field; this is a while a pin hole camera does not need a lens be able to produce a focused image, it has an infinitely small aperture, so it has an infinitely long DoF, or nearly at least). Focal length is \u0022how far in you are zoomed\u0022 (longer focal length, or zoomed in further, gives a shorter depth of field). Focal distance is the distance the subject is from the camera (again, closer to the camera, shorter depth field). Size of the image on the sensor is pretty obvious (larger sensor, shorter DoF, which is why cheaper cameras with smaller sensors are better for landscape and worse for portraiture, they have longer DoF then their larger sensor brothers).  \n\nThe thing is that KSP allows us to control focal length (FoV) and focal distance (camera zoom). So even though the \u0022aperture\u0022 of the game camera never chances, and the image size on the \u0022sensor\u0022 also never changes, since neither of them exist, we could still have a dynamic DoF with those other controls.   \n\nNo idea if a dynamic DoF is computationally feasible, or even necessary, but hey, there\u0027s some learning for you.  \n\nEDIT: Also, my vote for new shaders for the game: I would love to see something done with sky box shading of some kind. Specifically nebulae and other large and dim space objects being blocked from view by atmosphere on the night side (and of course also blocked during the day side), while being visible from orbit. I had the idea before that it could be done with two skyboxes, one covering the other one. The stars would be in behind, with gas clouds on the layer in front. Then the gas clouds can be faded in or out depending on how deep into the atmosphere you are. This would make the night sky from the surface look more realistic, less going on and more just pinpoint stars. \n\n**Edited \u003Ctime datetime=\u00222016-12-10T19:11:40Z\u0022 title=\u002212/10/2016 07:11  PM\u0022 data-short=\u00227 yr\u0022\u003EDecember 10, 2016\u003C/time\u003E by Errol**"},{"CreatedByName":"RoboRay","CreatedById":46556,"CreatedDateTime":"2016-12-10T18:35:51Z","Content":"Those ring shadows are gorgeous!  You can call them rough if you want, but they certainly look plausible.  More than that, they look *natural*."},{"CreatedByName":"Tekener","CreatedById":117427,"CreatedDateTime":"2016-12-10T19:12:57Z","Content":"\u003E \n\u003E \n\u003E 1 hour ago, blackrack said:\n\u003E \n\u003E \n\u003E Hmm, I\u0027m surprised by the number of people who actually want DoF, usually it\u0027s the first option I disable in any game.\n\u003E \n\nI hate DoF and always disable it. Humans are no technical cameras - the stars are always sharp when the eyes focus further than 3 meters. There is no reason why someone whould like this option unless he\u0027s used to view the world through the eyes of a camera ... \n\nSo I agree with you, DoF is completly unnatural and the first thing I disable in any game.\n\n\u003E \n\u003E \n\u003E 19 hours ago, blackrack said:\n\u003E \n\u003E \n\u003E The rings and the shadows are a bit aliased and a bit rough but I suspect mipmapping or manually doing something similar should fix it. Shadows are also a bit weak, may need to boost them a bit instead of just using the ring texture alpha value.\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E Also, I still need to fade the rings into fine particles/noise when zooming in on them.\n\u003E \n\nI think the images afre more than perfect - at least to me, I find them comppletly natural and they look like the Cassini images (org image from NASA):\n\n![7504_PIA21046_MAIN.jpg](http://saturn.jpl.nasa.gov/system/resources/detail_files/7504_PIA21046_MAIN.jpg)"},{"CreatedByName":"PickledTripod","CreatedById":135197,"CreatedDateTime":"2016-12-10T19:16:45Z","Content":"\u003E \n\u003E \n\u003E 2 minutes ago, Tekener said:\n\u003E \n\u003E \n\u003E I hate DoF and always disable it. Humans are no technical cameras - the stars are always sharp when the eyes focus further than 3 meters. There is no reason why someone whould like this option unless he\u0027s used to view the world through the eyes of a camera ... \n\u003E \n\u003E \n\u003E \n\u003E \n\u003E So I agree with you, DoF is completly unnatural and the first thing I disable in any game.\n\u003E \n\nI agree with you, it\u0027s completely unnatural and I personally hate it. But you know what? Many people like their games to have a \u0022cinematic\u0022 feel,like they\u0027re watching a movie. Just look at ENB presets for Skyrim on the Nexus..."},{"CreatedByName":"Errol","CreatedById":118622,"CreatedDateTime":"2016-12-10T19:18:29Z","Content":"[@Tekener](https://forum.kerbalspaceprogram.com/index.php?/profile/117427-tekener/)I disagree, what you said only applies to being in deep space. What about those of us that are base building? Or doing submarines? Or flying atmospheric with multiple crafts simultaneously? The point is, it would be a very useful effect, especially for anyone doing youtube. This game has lots to look at and blur out into bokeh besides stars."},{"CreatedByName":"Galileo","CreatedById":150430,"CreatedDateTime":"2016-12-10T19:32:42Z","Content":"Everything is always capable of be disabled with scatterer.  Why wouldn\u0027t dof? Those who want it,  keep it on.  If you don\u0027t want it,  disable it. I\u0027m only assuming of course that it\u0027s toggle-able\n\n**Edited \u003Ctime datetime=\u00222016-12-10T19:33:19Z\u0022 title=\u002212/10/2016 07:33  PM\u0022 data-short=\u00227 yr\u0022\u003EDecember 10, 2016\u003C/time\u003E by Galileo**"},{"CreatedByName":"Poodmund","CreatedById":128643,"CreatedDateTime":"2016-12-10T20:09:34Z","Content":"Loving the ring shaders but as far as more visual work goes, I would prefer for the Module Manager config compatibility to be properly nailed down before moving forward with additional features.\n\nCurrently, if you remove all the Scatterer stock configs and textures and try to introduce a config for a body with the config files located outside of the Scatterer directory, it all falls down as for some reason it tries to default the config location path to the Duna folder in the Scatterer directory... which seems very weird.\n\nTo reproduce I install Scatterer on a vanilla build, delete the GameData/scatterer/config directory and then create a planetsList style config and an atmo config (with textures) for any body in GameData/\\*Test\\* directory. \n\nI know it might sound like I\u0027m beating a dead horse here but its a real issue when trying to promote positive compatibility between visual packs without encroaching on Scatterer\u0027s main directory; but thats just me and I appreciate that it doesn\u0027t add a shiny new feature so its not a popular request."},{"CreatedByName":"Oshika","CreatedById":172318,"CreatedDateTime":"2016-12-10T21:48:32Z","Content":"Hi,\n\nThank you for your awesome mod, \n\nhowever i have some issue and i don\u0027t found the solution, with scatterer installed i have a black sky on kerbin and when i open the map view kerbin is totally pink. \n\nI have the \u0022console\u0022 of scatterer but it don\u0027t seems to work in game. \n\ni sought on google with keyword \u0022black sky\u0022 or \u0022pink kerbin\u0022 but i have not found anything, only one topic about black sky but the problem was different of mine."}]}