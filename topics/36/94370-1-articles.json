{"TopicId":94370,"ForumId":36,"TopicTitle":"[1.3] Trajectories - Prediction of atmospheric trajectories","CreatedByName":"Kobymaru","CreatedById":107372,"CreatedDateTime":"2014-12-24T11:11:20Z","PageNum":1,"Articles":[{"CreatedByName":"Kobymaru","CreatedById":107372,"CreatedDateTime":"2014-12-24T11:11:20Z","Content":"\n\u003Cp\u003E\nThis is the development thread for the Trajectories Mod, which predicts atmospheric trajectories.\n\u003C/p\u003E\n\u003Cp\u003E\nThis thread is mainly for Bug reports and discussions about the development (with icky code and stuff \u003Cimg alt=\u0022:wink:\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif\u0022\u003E )\n\u003C/p\u003E\n\u003Cp\u003E\nFor the download of the latest release and information on the usage, please see this thread:\u00A0\n\u003C/p\u003E\n\u003Ciframe data-embedcontent=\u0022\u0022 frameborder=\u00220\u0022 src=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/162324-13\u0026amp;do=embed\u0022\u003E\u003C/iframe\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222017-06-20T09:34:58Z\u0022 title=\u002206/20/2017 09:34  AM\u0022 data-short=\u00227 yr\u0022\u003EJune 20, 2017\u003C/time\u003E by Kobymaru\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"atomicfury","CreatedById":120037,"CreatedDateTime":"2014-12-24T15:13:26Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Kobymaru\u0022 data-cite=\u0022Kobymaru\u0022\u003E\u003Cdiv\u003EThis is the development thread for the Trajectories Mod, which predicts atmospheric trajectories.\u003Cp\u003EThis thread is mainly for Bug reports and discussions about the development (with icky code and stuff \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif\u0022 alt=\u0022;)\u0022\u003E )\u003C/p\u003E\u003Cp\u003EFor the download of the latest release and information on the usage, please see this thread: \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/104694\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://forum.kerbalspaceprogram.com/threads/104694\u003C/a\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EProgress on FAR support! Good news: I think I found a fix. Bad news: It involves FAR. I\u0027ll pop over the FAR thread next, but here\u0027s the scoop.\u003C/p\u003E\u003Cp\u003EWhen Trajectories initializes, to load FAR it runs a referenceDrag calculation with some high values, looking for a number greater than 1. With the new skin drag code in FAR 0.14.5.1, something was spitting NaN\u0027s back. I put some debug statement in FAR and found that one of the functions had a zero rho (density) value. Trajectories was passing rho=10, the first FAR method had rho=10, but then another resulted in a rho=0 causing the NaN\u0027s.\u003C/p\u003E\u003Cp\u003EThis is FAR, in FARBasicDragModel.cs:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E        public Vector3d RunDragCalculation(Vector3d velocity, double MachNumber, double rho)\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EIt later calls:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E       DragModel(local_velocity, MachNumber);\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EDragModel uses rho, but seems to get it from some other scope, and uses a rho = 0 for a vessel in space using Trajectories, rather than the rho requested by the call.\u003C/p\u003E\u003Cp\u003EA possible fix is to pass rho to DragModel. FAR is such an impressive piece of work though that I don\u0027t know what ferram\u0027s intended behavior is. I\u0027ll stop over there next.\u003C/p\u003E\n"},{"CreatedByName":"atomicfury","CreatedById":120037,"CreatedDateTime":"2014-12-24T19:20:30Z","Content":"\n\u003Cp\u003EOK, I let ferram4 know about this and I put a pull request in. He said it will be \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/20451-0-90-Ferram-Aerospace-Research-v0-14-5-1-12-19-14?p=1627509\u0026amp;viewfull=1#post1627509\u0022 rel=\u0022external nofollow\u0022\u003Efixed\u003C/a\u003E for the dev version and then the next release. \u003C/p\u003E\u003Cp\u003ESo as of that release Trajectories can support FAR.\u003C/p\u003E\n"},{"CreatedByName":"Kobymaru","CreatedById":107372,"CreatedDateTime":"2014-12-24T22:16:24Z","Content":"\n\u003Cp\u003EWow, thanks for your work. I will release a new version with FAR enabled when ferram releases a new FAR version to the public.\u003C/p\u003E\n"},{"CreatedByName":"atomicfury","CreatedById":120037,"CreatedDateTime":"2014-12-25T18:35:53Z","Content":"\n\u003Cp\u003EThank you for keeping the mod going! I like landing as close as possible to KSC. Glad to help.\u003C/p\u003E\n"},{"CreatedByName":"Kobymaru","CreatedById":107372,"CreatedDateTime":"2014-12-25T22:25:40Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022atomicfury\u0022 data-cite=\u0022atomicfury\u0022\u003E\u003Cdiv\u003EProgress on FAR support! Good news: I think I found a fix.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EWhen you say \u0022fix\u0022, do you mean that it doesn\u0027t lock up anymore, or that the prediction accurately works? Because I am having an issue that with FAR, the impact marker constantly drifts to the West as soon as the craft enters the atmosphere.\u003C/p\u003E\u003Cp\u003EEdit:\u003C/p\u003E\u003Cp\u003EOk, at least that\u0027s not a new bug. Tested with KSP 0.25, Ferram 0.14.4 and Trajectories 1.0.0.0 and the behaviour is the same. Still kind of unpleasent if the marker keeps drifting.\u003C/p\u003E\u003Cp\u003EEdit 2:\u003C/p\u003E\u003Cp\u003E\u0022Fixed\u0022 if you set the AoA in the descent profile to -180\u00C3\u201A\u00C2\u00B0. On one hand that\u0027s logical because if you point your nose retro, then the air is coming from behind you. On the other hand, then 0\u00C3\u201A\u00C2\u00B0 should not be default. And \u002B180\u00C3\u201A\u00C2\u00B0 should give the same result as -180\u00C3\u201A\u00C2\u00B0 (but it doesn\u0027t). Note to self: some thinking about reference frames is in order.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-12-25T23:05:26Z\u0022 title=\u002212/25/2014 11:05  PM\u0022 data-short=\u00229 yr\u0022\u003EDecember 25, 2014\u003C/time\u003E by Kobymaru\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Youen","CreatedById":116909,"CreatedDateTime":"2014-12-26T15:56:46Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022atomicfury\u0022 data-cite=\u0022atomicfury\u0022\u003E\u003Cdiv\u003EDragModel uses rho, but seems to get it from some other scope, and uses a rho = 0 for a vessel in space using Trajectories, rather than the rho requested by the call.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EIf I remember correctly, I already had to set a private member variable of FAR (through reflection) because indeed rho wasn\u0027t passed where it should be. But the code probably changed since then. The correct way is probably to tell ferram about it (as you already have if I follow correctly) instead of trying to hack even more than I already did ;-)\u003C/p\u003E\n"},{"CreatedByName":"Kobymaru","CreatedById":107372,"CreatedDateTime":"2014-12-26T17:51:17Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Youen\u0022 data-cite=\u0022Youen\u0022\u003E\u003Cdiv\u003EIf I remember correctly, I already had to set a private member variable of FAR (through reflection) because indeed rho wasn\u0027t passed where it should be. But the code probably changed since then. The correct way is probably to tell ferram about it (as you already have if I follow correctly) instead of trying to hack even more than I already did ;-)\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYeah, that\u0027s always preferable \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E We should take advantage of the fact that the KSP community is so close and Mod authors are just around the Forum corners \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif\u0022 alt=\u0022;)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Probus","CreatedById":102512,"CreatedDateTime":"2014-12-26T22:29:33Z","Content":"\n\u003Cp\u003EFYI Kobymaru. If I can be of help, just let me know.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Probus\u0022 data-cite=\u0022Probus\u0022\u003E\u003Cdiv\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022ferram4\u0022 data-cite=\u0022ferram4\u0022\u003E\u003Cdiv\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Probus\u0022 data-cite=\u0022Probus\u0022\u003E\u003Cdiv\u003EHi Ferram,\u003Cp\u003E As I mentioned earlier in IRC, AIES is throwing NaN errors. I think KSP is looking for an undefined variable in the CFG files of each part. Here is the error/warning type:\u003C/p\u003E\u003Cp\u003E[WRN 16:03:58.165] FAR Error: Aerodynamic force = NaN Aerodynamic moment = 0.189424095163685 CoD Local = 0.0227040961332294 CoD Global = NaN AIES R350 \u0027TOR\u0027\u003C/p\u003E\u003Cp\u003EWhat variables would you guess that I need to define in AIES CFG files to give FAR what its looking for? Or is this task an order of magnitude greater than that?\u003C/p\u003E\u003Cp\u003EThanks for your mods Ferram! I never play with out FAR.\u003C/p\u003E\u003Cp\u003EBest Regards,\u003C/p\u003E\u003Cp\u003E Probus\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI have no idea what is wrong; either AIES has defined FAR modules in the config that need to be stripped out or its models are completely and utterly borked somehow (I don\u0027t even think it\u0027s possible) and there is no way to get FAR to handle its geometry properly.\u003C/p\u003E\u003Cp\u003EUnless it\u0027s a wing, there is absolutely nothing that has to be changed in the config files for FAR to function; all that needs to be done is make sure that the configs are running on 0.90-standards, and everything will function fine.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EFerram,\u003C/p\u003E\u003Cp\u003E I\u0027ve been digging into this and I am pretty sure it is the \u0022Trajectories\u0022 mod causing the FAR errors on the AIES parts.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\n"},{"CreatedByName":"atomicfury","CreatedById":120037,"CreatedDateTime":"2014-12-27T00:22:55Z","Content":"\n\u003Cp\u003E@Probus - you shouldn\u0027t use Trajectories with FAR right now. Those NaN statements are the least of your worries, it can cause KSP to freeze up. There is an incompatibility between FAR and Trajectories that causes that behavior. It\u0027ll be fixed up with the next releases.\u003C/p\u003E\n"},{"CreatedByName":"Youen","CreatedById":116909,"CreatedDateTime":"2014-12-28T15:54:43Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022linuxgurugamer\u0022 data-cite=\u0022linuxgurugamer\u0022\u003E\u003Cdiv\u003EKSP-AVC seems to think that the version is still 1.1, not 1.1.1\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThe procedure for that is :\u003C/p\u003E\u003Cp\u003E- connect to \u003Ca href=\u0022http://ksp-avc.cybutek.net\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://ksp-avc.cybutek.net\u003C/a\u003E\u003C/p\u003E\u003Cp\u003E- login with the password I gave you on PM\u003C/p\u003E\u003Cp\u003E- update info in \u0022My versions\u0022 (I see you already have done it)\u003C/p\u003E\u003Cp\u003E- either download the updated .version file, or simply edit the one that ships in Trajectories.zip to match the version number\u003C/p\u003E\u003Cp\u003E- edit the version of the DLL (in visual studio, in properties of the Trajectories project, in the Application tab, click \u0022Assembly information...\u0022)\u003C/p\u003E\u003Cp\u003E- build in release which should also package the new zip\u003C/p\u003E\u003Cp\u003EThis is not really a smooth process, feel free to improve if you can :-) I\u0027m not sure the DLL version really has to mach, but I think it\u0027s cleaner.\u003C/p\u003E\n"},{"CreatedByName":"Kobymaru","CreatedById":107372,"CreatedDateTime":"2014-12-28T17:39:17Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Youen\u0022 data-cite=\u0022Youen\u0022\u003E\u003Cdiv\u003EThe procedure for that is :\u003Cp\u003E- connect to \u003Ca href=\u0022http://ksp-avc.cybutek.net\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://ksp-avc.cybutek.net\u003C/a\u003E\u003C/p\u003E\u003Cp\u003E- login with the password I gave you on PM\u003C/p\u003E\u003Cp\u003E- update info in \u0022My versions\u0022 (I see you already have done it)\u003C/p\u003E\u003Cp\u003E- either download the updated .version file, or simply edit the one that ships in Trajectories.zip to match the version number\u003C/p\u003E\u003Cp\u003E- edit the version of the DLL (in visual studio, in properties of the Trajectories project, in the Application tab, click \u0022Assembly information...\u0022)\u003C/p\u003E\u003Cp\u003E- build in release which should also package the new zip\u003C/p\u003E\u003Cp\u003EThis is not really a smooth process, feel free to improve if you can :-) I\u0027m not sure the DLL version really has to mach, but I think it\u0027s cleaner.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThanks! I reuploaded a new build with the proper version number.\u003C/p\u003E\n"},{"CreatedByName":"Kobymaru","CreatedById":107372,"CreatedDateTime":"2015-01-03T14:32:59Z","Content":"\n\u003Cp\u003EI\u0027ve got good news and bad news. \u003C/p\u003E\u003Cp\u003EGood news first.\u003C/p\u003E\u003Cp\u003EI found the culprit of the inaccuracies when FAR is used! Turns out the cache system uses a constant altitude (half the atmosphere height) for Mach Number calculation (see VesselAerodynamicModel.cs, Line 228-230). This means the Mach number is wrong for pretty much all of the trajectory.\u003C/p\u003E\u003Cp\u003EDisabling the cache (see VesselAerodynamicModel.cs, Line 463) fixes everything. I hit the KSP runway the first time I tried it.\u003C/p\u003E\u003Cp\u003ENow the bad news:\u003C/p\u003E\u003Cp\u003EApparently, without the cache system the performance degrades dramatically and makes the game unplayable. So much for that :/\u003C/p\u003E\u003Cp\u003EAny ideas how to proceed now?\u003C/p\u003E\u003Cp\u003EMy wild guesses are:\u003C/p\u003E\u003Cp\u003E- Temporarily using a much lower altitude for Mach Number calculation, because that\u0027s where most of the forces go missing.\u003C/p\u003E\u003Cp\u003E- Somehow (???) improving calculation performance of the trajectory\u003C/p\u003E\n"},{"CreatedByName":"zengei","CreatedById":75233,"CreatedDateTime":"2015-01-03T14:43:06Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Kobymaru\u0022 data-cite=\u0022Kobymaru\u0022\u003E\u003Cdiv\u003EAny ideas how to proceed now?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI don\u0027t know the particulars of the code but couldn\u0027t you precalculate the Mach number for ranges of altitudes and then do a dictionary lookup for the Mach number (i.e. cache multiple values rather than one)? Then you just adjust the size of the ranges for more accuracy/more performance. I would imagine even with very small ranges such performance would be pretty good. The system right now would just be equivalent to having a single range for the entire atmosphere.\u003C/p\u003E\n"},{"CreatedByName":"Youen","CreatedById":116909,"CreatedDateTime":"2015-01-03T19:14:38Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022zengei\u0022 data-cite=\u0022zengei\u0022\u003E\u003Cdiv\u003EI don\u0027t know the particulars of the code but couldn\u0027t you precalculate the Mach number for ranges of altitudes and then do a dictionary lookup for the Mach number (i.e. cache multiple values rather than one)? Then you just adjust the size of the ranges for more accuracy/more performance. I would imagine even with very small ranges such performance would be pretty good. The system right now would just be equivalent to having a single range for the entire atmosphere.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EIf I remember correctly, I took out the mach number as a constant, because it reduced the number of dimensions of the cache array. Currently the cache is two-dimensional : angle of attack and velocity. If you add the mach number, you multiply the cache size by as much different mach values you want to use. It might work, and might actually not use too much more memory if other dimensions resolution are reduced. Also, be carefull to make the system work for all bodies, Jool has a very different mach number range for example.\u003C/p\u003E\u003Cp\u003EThe idea to use a lower altitude mach number as a constant could improve landing precision, but maybe deteriorate aerobraking precision?\u003C/p\u003E\u003Cp\u003EAlso, something I didn\u0027t have time to try, is to add a simple scale factor to all forces, because they are always too low (or too high? don\u0027t remember). Whatever the cause is, it could workaround the accuracy issues (maybe).\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-01-03T19:18:00Z\u0022 title=\u002201/03/2015 07:18  PM\u0022 data-short=\u00229 yr\u0022\u003EJanuary 3, 2015\u003C/time\u003E by Youen\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Kobymaru","CreatedById":107372,"CreatedDateTime":"2015-01-03T22:58:49Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Youen\u0022 data-cite=\u0022Youen\u0022\u003E\u003Cdiv\u003EIf I remember correctly, I took out the mach number as a constant, because it reduced the number of dimensions of the cache array. Currently the cache is two-dimensional : angle of attack and velocity. If you add the mach number, you multiply the cache size by as much different mach values you want to use. It might work, and might actually not use too much more memory if other dimensions resolution are reduced.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ETBH I\u0027m not that worried about the Memory, I\u0027m more worried that the cache will be hit much much less and the CPU load will be way too high.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Youen\u0022 data-cite=\u0022Youen\u0022\u003E\u003Cdiv\u003EAlso, be carefull to make the system work for all bodies, Jool has a very different mach number range for example.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThanks for the note!\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Youen\u0022 data-cite=\u0022Youen\u0022\u003E\u003Cdiv\u003EThe idea to use a lower altitude mach number as a constant could improve landing precision, but maybe deteriorate aerobraking precision?\u003Cp\u003EYes, definitely. It\u0027s a fallback solution.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Youen\u0022 data-cite=\u0022Youen\u0022\u003E\u003Cdiv\u003E Also, something I didn\u0027t have time to try, is to add a simple scale factor to all forces, because they are always too low (or too high? don\u0027t remember). Whatever the cause is, it could workaround the accuracy issues (maybe).\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ETBH I\u0027m not really for \u0022scale factors\u0022, especially if we know that without the cache, the calculations are precise.\u003C/p\u003E\n"},{"CreatedByName":"Youen","CreatedById":116909,"CreatedDateTime":"2015-01-04T17:14:06Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Kobymaru\u0022 data-cite=\u0022Kobymaru\u0022\u003E\u003Cdiv\u003EI\u0027m more worried that the cache will be hit much much less and the CPU load will be way too high.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EIndeed, and also you\u0027ll have to interpolate in three dimensions (maybe not a big deal though).\u003C/p\u003E\u003Cp\u003ETypically, I think the CPU load related to forces computations would double (because you need two values to interpolate instead of one), but not more because you don\u0027t need to compute values that are not on your trajectory (I guess values that get computed would form a (curved) line of 2x2x2 blocks in the 3D grid, and if the trajectory changes significantly this line will slowly sweep new values). If the trajectory is stable, only the first computation would be slower (0 cache miss multiplied by two still gives 0).\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Kobymaru\u0022 data-cite=\u0022Kobymaru\u0022\u003E\u003Cdiv\u003Ewithout the cache, the calculations are precise.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EAre you 100% sure? I thought I had precision issues even without the cache (but also I fixed some bugs and made improvements all the time, so maybe it\u0027s better now and the cache is the biggest remaining contributor to inacuracy)\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-01-05T11:41:32Z\u0022 title=\u002201/05/2015 11:41  AM\u0022 data-short=\u00229 yr\u0022\u003EJanuary 5, 2015\u003C/time\u003E by Youen\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"peachoftree","CreatedById":110108,"CreatedDateTime":"2015-01-06T13:57:47Z","Content":"\n\u003Cp\u003ECorrect me if im wrong, but doesn\u0027t mach value vary with air density, so couldnt you calculate mach from altitude without it being too CPU intensive and still get the same effect. something like mach = altitude * magic_density_to_mach_coefficent, maybe something with the formulas found at \u003Ca href=\u0022http://www.engineeringtoolbox.com/speed-sound-d_82.html\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://www.engineeringtoolbox.com/speed-sound-d_82.html\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EEDIT: after looking through the code, I see that density is included in the array and if you calculate pressure using that mach number calculation becomes dead simple\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-01-06T16:15:38Z\u0022 title=\u002201/06/2015 04:15  PM\u0022 data-short=\u00229 yr\u0022\u003EJanuary 6, 2015\u003C/time\u003E by peachoftree\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"prophet_01","CreatedById":111502,"CreatedDateTime":"2015-01-07T14:15:50Z","Content":"\n\u003Cp\u003ESince 0.90 the trajectories mod causes a glitch for me. If I launch a vessel from the VAB or SPH the game refuses to load basically everything. I\u0027m simply looking at the sky textures and the sun, no kerbin, no vessel, no buildings, but also the game hasn\u0027t crashed completely. If I launch from the space center directly on the launch pad (without entering the VAB/SPH) everything is fine. \u003C/p\u003E\u003Cp\u003EI\u0027m using a number of mods (including FAR) on 32 bit. I reinstalled the mods one by one on a fresh backup until the problem showed up again, so I\u0027m pretty sure it\u0027s this mod \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_sad.gif\u0022 alt=\u0022:(\u0022\u003E I have yet to test if a fresh install with trajectories only will still do that or if it\u0027s a compatibility issue with another mod. Will test that later and post the result. Apart from that the mod worked as it\u0027s supposed to do, although I frequently had fps drops if it tried calculed multiple passes at kerbin\u003C/p\u003E\n"},{"CreatedByName":"Kobymaru","CreatedById":107372,"CreatedDateTime":"2015-01-13T13:51:05Z","Content":"\n\u003Cp\u003EOk, about that NaN bug:\u003C/p\u003E\u003Cp\u003EIt seems that FAR is not fully initialized after launch, afteer a certain condition (such as altitude maybe) is reached.\u003C/p\u003E\u003Cp\u003ESteps to reproduce the bug:\u003C/p\u003E\u003Cp\u003E1) Launch vessel with wings\u003C/p\u003E\u003Cp\u003E2) Activate trajectories immediately\u003C/p\u003E\u003Cp\u003E3) Observe NaN\u0027s\u003C/p\u003E\u003Cp\u003ESteps to avoid the bug:\u003C/p\u003E\u003Cp\u003E1) Launch new Vessel with wings\u003C/p\u003E\u003Cp\u003E2) Wait until FAR logs\u003C/p\u003E\u003Cp\u003E - Normal Shock Mach Number Curve Initialized\u003C/p\u003E\u003Cp\u003E - Normal Shock Pressure Curve Initialized\u003C/p\u003E\u003Cp\u003E - Prandlt-Meyer Expansion Curves Initialized\u003C/p\u003E\u003Cp\u003E - Stagnation Pressure Curve Initialized\u003C/p\u003E\u003Cp\u003E3) Activate trajectories\u003C/p\u003E\u003Cp\u003E4) Observe that everything is fine\u003C/p\u003E\u003Cp\u003ENow I have to dig into the conditions of when the curves are initialized and not calculate trajectories before. (Happens the first time the vessel goes over about 200 m/s).\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022font-size:8px;\u0022\u003E\u003Cspan style=\u0022color:#C0C0C0;\u0022\u003E- - - Updated - - -\u003C/span\u003E\u003C/span\u003E\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022peachoftree\u0022 data-cite=\u0022peachoftree\u0022\u003E\u003Cdiv\u003ECorrect me if im wrong, but doesn\u0027t mach value vary with air density, so couldnt you calculate mach from altitude without it being too CPU intensive and still get the same effect. something like mach = altitude * magic_density_to_mach_coefficent, maybe something with the formulas found at \u003Ca href=\u0022http://www.engineeringtoolbox.com/speed-sound-d_82.html\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://www.engineeringtoolbox.com/speed-sound-d_82.html\u003C/a\u003E\u003Cp\u003EEDIT: after looking through the code, I see that density is included in the array and if you calculate pressure using that mach number calculation becomes dead simple\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ESure, calculating the Mach number is dead simple. But calculating the drag is not! We currently use a \u003Cstrong\u003E\u003Cspan style=\u0022text-decoration:underline;\u0022\u003E2\u003C/span\u003E\u003C/strong\u003E\u003Cspan style=\u0022text-decoration:underline;\u0022\u003E-dimensional\u003C/span\u003E lookup table, think of it as a function of (Velocity, AoA) |-\u0026gt; F_drag . The mach number is currently fixed. If it were NOT fixed, the Mach calculation would be simple, but the drag function would become \u003C/p\u003E\u003Cp\u003E(Velocity, AoA, MachNumber) |-\u0026gt; F_drag and we would require a \u003Cstrong\u003E\u003Cspan style=\u0022text-decoration:underline;\u0022\u003E3\u003C/span\u003E\u003C/strong\u003E\u003Cspan style=\u0022text-decoration:underline;\u0022\u003E-dimensional\u003C/span\u003E lookup table. That\u0027s not impossible, but it might lead to the problems mentioned above. Or not. I dunno. I think I\u0027ll just implement it and see what happens.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022prophet_01\u0022 data-cite=\u0022prophet_01\u0022\u003E\u003Cdiv\u003ESince 0.90 the trajectories mod causes a glitch for me. If I launch a vessel from the VAB or SPH the game refuses to load basically everything. I\u0027m simply looking at the sky textures and the sun, no kerbin, no vessel, no buildings, but also the game hasn\u0027t crashed completely. If I launch from the space center directly on the launch pad (without entering the VAB/SPH) everything is fine. \u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI am very sorry, but I cannot reproduce this. I constantly launch from VAB/SPH and never had this. Maybe you should reinstall/repair your KSP installation?\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022prophet_01\u0022 data-cite=\u0022prophet_01\u0022\u003E\u003Cdiv\u003EApart from that the mod worked as it\u0027s supposed to do, although I frequently had fps drops if it tried calculed multiple passes at kerbin\u003C/div\u003E\u003C/blockquote\u003E Performance is a problem, but unfortunately not one that is going to be fixed anytime soon. Sorry about that \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_sad.gif\u0022 alt=\u0022:(\u0022\u003E\n"},{"CreatedByName":"sralica","CreatedById":116496,"CreatedDateTime":"2015-01-17T18:36:35Z","Content":"\n\u003Cp\u003EFor me this mod does not function correctly with FAR. I am trying to land on Kerbin, not using a plane; no wings on a craft. It decelerate faster then predicted and completely misses landing prediction. if I remove FAR it is OK.\u003C/p\u003E\u003Cp\u003EUsing ksp 0.90, 32bit, mods: toolbar, ATM, DeadlyReentry, HyperEdit, MechJeb2, Trajectories\u003C/p\u003E\u003Cp\u003EDescent profile set to AoA -180 or \u002B180, using MJ to keep heading (ether Orbit-\u0026gt; retrograde or SURFace -\u0026gt; SVEL negative) so I am falling in reverse trough the atmosphere.\u003C/p\u003E\u003Cp\u003EAm I the only one with this problem?\u003C/p\u003E\n"},{"CreatedByName":"Baythan","CreatedById":18815,"CreatedDateTime":"2015-01-17T19:09:04Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022sralica\u0022 data-cite=\u0022sralica\u0022\u003E\u003Cdiv\u003EFor me this mod does not function correctly with FAR. I am trying to land on Kerbin, not using a plane; no wings on a craft. It decelerate faster then predicted and completely misses landing prediction. if I remove FAR it is OK.\u003Cp\u003EUsing ksp 0.90, 32bit, mods: toolbar, ATM, DeadlyReentry, HyperEdit, MechJeb2, Trajectories\u003C/p\u003E\u003Cp\u003EDescent profile set to AoA -180 or \u002B180, using MJ to keep heading (ether Orbit-\u0026gt; retrograde or SURFace -\u0026gt; SVEL negative) so I am falling in reverse trough the atmosphere.\u003C/p\u003E\u003Cp\u003EAm I the only one with this problem?\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EAs per the first page of this thread: It is a known issue that FAR/NEAR landing predictions are inaccurate due to the methods used by Trajectories to calculate with the new drag model. Methods to improve accuracy without drastically reducing performance are being developed.\u003C/p\u003E\u003Cp\u003EEven with the inaccuracies, you are MUCH more likely to get in the area you want to be in while using this mod than if you did not use it. Adding in the difficulty of using DeadlyReentry, you\u0027ll have to experiment with how far past your landing point you want that X... and because of FAR it will be different for every vehicle. Without DR I just like to drop near-vertical on top of my targets and I use trajectories to plan when to start the drop from orbit because this mod will still predict how much the planets will rotate under you.\u003C/p\u003E\u003Cp\u003EKeep at it Kobymaru!\u003C/p\u003E\n"},{"CreatedByName":"Youen","CreatedById":116909,"CreatedDateTime":"2015-01-17T21:55:56Z","Content":"\n\u003Cp\u003EAlso, make sure you set all sliders to \u002B180 (or all to -180), not just the first one (maybe you already did, just in case)\u003C/p\u003E\n"},{"CreatedByName":"Youen","CreatedById":116909,"CreatedDateTime":"2015-01-23T21:23:37Z","Content":"\n\u003Cp\u003EI thought I would not fall again, but apparently I couldn\u0027t resist trying KSP 0.90 and have been playing again for some days (and nights). I used the latest Trajectories release, which works great with stock and NEAR, but, as has been reported, the cache system is really wrong with FAR. I just made some measurements : I get forces about two times too low when the cache is enabled. Without the cache, there\u0027s only about 0.1% difference with the actual forces applied by FAR on the vessel at any time.\u003C/p\u003E\u003Cp\u003EI\u0027m currently investigating, apparently it isn\u0027t related to the mach number, which appears to have a very low influence on the final result.\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://i.imgur.com/9NcqeYd.png\u0022 alt=\u00229NcqeYd.png\u0022\u003E\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022font-size:8px;\u0022\u003E\u003Cspan style=\u0022color:#C0C0C0;\u0022\u003E- - - Updated - - -\u003C/span\u003E\u003C/span\u003E\u003C/p\u003E\u003Cp\u003EOK, found the problem.\u003C/p\u003E\u003Cp\u003EFirst, there was a bug with mach number estimation. I wanted to get the mach number at an average altitude, but body.maxAtmosphereAltitude is above-sea altitude, and I thought it was relative to the body center, so I incorrectly subtracted body.Radius. That wasn\u0027t really making a difference though (maybe FAR clamps the altitude anyway).\u003C/p\u003E\u003Cp\u003EThe real problem however is that FAR forces are no longer proportional to rho (air density). So we\u0027ll have to add a third dimension to the cache system (altitude), and compute rho for each altitude (as a bonus, we can also compute the real mach number). My guess is that a very low resolution on that axis will do though. I\u0027ll make some more tests to find a good tradeoff for accuracy/memory/CPU usage on the cache resolution.\u003C/p\u003E\u003Cp\u003EBottom line is, we really need a debugger for KSP modding :-( Several hours spent displaying stuff on the screen until I could pinpoint the culprit... Should have been solved in a matter of minutes with a debugger.\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022font-size:8px;\u0022\u003E\u003Cspan style=\u0022color:#C0C0C0;\u0022\u003E- - - Updated - - -\u003C/span\u003E\u003C/span\u003E\u003C/p\u003E\u003Cp\u003EAnd there was also a bug in the cache interpolation code (it was inverting the interpolation coefficients for some axes, which had little impact due to the quite high resolution of the cache, but was wrong nonetheless). With this fix, I\u0027ll probably be able to reduce the cache resolution and still be more accurate than before. This bug might also explain why setting \u002B180\u00C3\u201A\u00C2\u00B0 in the descent profile was different from -180\u00C3\u201A\u00C2\u00B0 (because it was sampling the wrong side of the cache cell on both ends).\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022font-size:8px;\u0022\u003E\u003Cspan style=\u0022color:#C0C0C0;\u0022\u003E- - - Updated - - -\u003C/span\u003E\u003C/span\u003E\u003C/p\u003E\u003Cp\u003EI\u0027m getting lots of errors \u0022FAR Error: Aerodynamic force = NaN Aerodynamic moment = 0 CoD Local = 0 CoD Global = NaN\u0022 when reaching the edge of the interface, is that a known issue? (FAR 0.14.6)\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-01-23T20:56:54Z\u0022 title=\u002201/23/2015 08:56  PM\u0022 data-short=\u00229 yr\u0022\u003EJanuary 23, 2015\u003C/time\u003E by Youen\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"AngelLestat","CreatedById":58968,"CreatedDateTime":"2015-01-23T21:32:52Z","Content":"\n\u003Cp\u003EI never test it in near, I have far..\u003C/p\u003E\u003Cp\u003EBut I had understand that the only difference that nears has with far is all the UI that show your flying data.. but if in nears works fine, then I am mistake.\u003C/p\u003E\n"}]}