{"TopicId":60281,"ForumId":36,"TopicTitle":"[Hardware, Plugin] Arduino based physical display \u002B serial port io\u002B tutorial (24-11-19)","CreatedByName":"zitronen","CreatedById":11842,"CreatedDateTime":"2014-01-18T01:25:25Z","PageNum":10,"Articles":[{"CreatedByName":"zitronen","CreatedById":11842,"CreatedDateTime":"2014-03-12T16:51:36Z","Content":"\n\u003Cp\u003EIf I send both the amount and the in game delta time then it should be fairly easy to calculate it in arduino. So for each resource we need to send the max and current amount as floats, so 8 bytes per resource. \u003C/p\u003E\u003Cp\u003EAnother alternative is to put all the resource stuff in a separate packet that is sent less frequently. Either way, right now we still have lots of space in the packet so it shouldn\u0027t be a huge issue.\u003C/p\u003E\n"},{"CreatedByName":"Katamari","CreatedById":38096,"CreatedDateTime":"2014-03-12T17:06:19Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Mulbin\u0022 data-cite=\u0022Mulbin\u0022\u003E\u003Cdiv\u003EYou would have to use the in game MET clock to calculate... not real time. Real time would be very inaccurate as KSP speeds up and slows down according to graphics and memory load. Sometimes 1 in game second can last up to 5 real seconds.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI didn\u0027t think about that... Hmmm, when time is no longer constant... Sounds like relativity, except that you are correct in that this cannot be accurately calculated from outside the game.\u003C/p\u003E\u003Cp\u003EAnyways, now that we have control groups, I am already really happy with where it is at! Individual resource outputs (just Max and Present of each resource type would be sufficient) would be cool to have rather than the pure percentage. If by \u0022axes\u0022 that you are working on, you mean Current ship Axes and not \u0022input axes\u0022, then that would be a pretty awesome addition.\u003C/p\u003E\u003Cp\u003EUnfortunately, I still think that resource consumption rate is kind of niche, but if you can find out how to do it, it would have its uses (Ex: calculating burn time remaining).\u003C/p\u003E\n"},{"CreatedByName":"zitronen","CreatedById":11842,"CreatedDateTime":"2014-03-12T17:11:16Z","Content":"\n\u003Cp\u003EYou just want the roll pitch yaw right? I can probably squeeze it into to the next update, should be simple enough.\u003C/p\u003E\n"},{"CreatedByName":"Mulbin","CreatedById":55562,"CreatedDateTime":"2014-03-12T17:49:25Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Katamari\u0022 data-cite=\u0022Katamari\u0022\u003E\u003Cdiv\u003EI still think that resource consumption rate is kind of niche, but if you can find out how to do it, it would have its uses \u003C/div\u003E\u003C/blockquote\u003E \u003Cp\u003EWith fuel consumption thats true, but knowing if your battery is draining or charging is essential and you can\u0027t always tell by just looking at a battery level dial as it may be moving very, very slowly (I\u0027m using dials not digital displays). Thats why steam gauges includes charge/drain as well as current power level.\u003C/p\u003E\u003Cp\u003EMight be worth looking at their code for hints on how the data is handled.\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/40730-0-22-SteamGauges-Release-V1-3-1\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://forum.kerbalspaceprogram.com/threads/40730-0-22-SteamGauges-Release-V1-3-1\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EThis mod also tracks consumption - \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/50077-0-23-Fusebox-electric-charge-tracker-and-build-helper-0-9-released-01-03-14\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://forum.kerbalspaceprogram.com/threads/50077-0-23-Fusebox-electric-charge-tracker-and-build-helper-0-9-released-01-03-14\u003C/a\u003E\u003C/p\u003E\n"},{"CreatedByName":"Chaosratt","CreatedById":71354,"CreatedDateTime":"2014-03-12T18:36:56Z","Content":"\n\u003Cp\u003ERandom thought on another variable/data to pull down that I do not see on the first page\u0027s table. Time and/or distance to the next maneuver node.\u003C/p\u003E\n"},{"CreatedByName":"RSRaney","CreatedById":35397,"CreatedDateTime":"2014-03-14T15:20:28Z","Content":"\n\u003Cp\u003EChaosratt, you beat me too it. I was just about to post the same question. My son is always nose to the screen trying to read the \u0027time to next maneuver\u0027. \u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Chaosratt\u0022 data-cite=\u0022Chaosratt\u0022\u003E\u003Cdiv\u003ERandom thought on another variable/data to pull down that I do not see on the first page\u0027s table. Time and/or distance to the next maneuver node.\u003C/div\u003E\u003C/blockquote\u003E\n"},{"CreatedByName":"zitronen","CreatedById":11842,"CreatedDateTime":"2014-03-15T18:29:12Z","Content":"\n\u003Cp\u003E\u003Cspan\u003E\u0022Weekly\u0022 update 7\u003C/span\u003E\u003C/p\u003E\u003Cp\u003EAdded:\u003C/p\u003E\u003Cp\u003EAltitude above sea level\u003C/p\u003E\u003Cp\u003ELiquidFuelTotal\u003C/p\u003E\u003Cp\u003ELiquidFuel\u003C/p\u003E\u003Cp\u003EOxidizerTotal\u003C/p\u003E\u003Cp\u003EOxidizer\u003C/p\u003E\u003Cp\u003EEChargeTotal\u003C/p\u003E\u003Cp\u003EECharge\u003C/p\u003E\u003Cp\u003EMonoPropTotal\u003C/p\u003E\u003Cp\u003EMonoProp\u003C/p\u003E\u003Cp\u003EIntakeAirTotal\u003C/p\u003E\u003Cp\u003EIntakeAir\u003C/p\u003E\u003Cp\u003ESolidFuelTotal\u003C/p\u003E\u003Cp\u003ESolidFuel\u003C/p\u003E\u003Cp\u003EXenonGasTotal\u003C/p\u003E\u003Cp\u003EXenonGas\u003C/p\u003E\u003Cp\u003EPlugin and updated code: \u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022https://sites.google.com/site/zitronfiles/KSPSerialIO_013_5.zip\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://sites.google.com/site/zitronfiles/KSPSerialIO_013_5.zip\u003C/a\u003E\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022https://sites.google.com/site/zitronfiles/KSPIODemo3.zip\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://sites.google.com/site/zitronfiles/KSPIODemo3.zip\u003C/a\u003E\u003C/p\u003E\u003Cp\u003ENote: the output data structure has changed, you need to update your arduino structure to be compatible. You will also need to compute your own resource percentages, \u0022FuelP\u0022 is replaced by \u0022Alt\u0022.\u003C/p\u003E\n"},{"CreatedByName":"Mulbin","CreatedById":55562,"CreatedDateTime":"2014-03-15T18:47:05Z","Content":"\n\u003Cp\u003EGreat... now I have to explain to my wife why she won\u0027t see me for the rest of the night \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif\u0022 alt=\u0022;)\u0022\u003E\u003C/p\u003E\u003Cp\u003ENice work!\u003C/p\u003E\n"},{"CreatedByName":"Mulbin","CreatedById":55562,"CreatedDateTime":"2014-03-15T19:29:18Z","Content":"\n\u003Cp\u003ESo if I understand correctly analogWrite(PWMPin, round(fuelp*100/255)) no longer works unless I add another bit of code to determine that fuelp=LiquidFuel/LiquidFuelTotalX100\u003C/p\u003E\u003Cp\u003EOf course you know what I\u0027m going to say next \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 alt=\u0022:D\u0022\u003E.... what would the code look like for this?\u003C/p\u003E\n"},{"CreatedByName":"zitronen","CreatedById":11842,"CreatedDateTime":"2014-03-15T20:27:14Z","Content":"\n\u003Cp\u003EJust do analogWrite(PWMPin, round(LiquidFuel/LiquidFuelTotal*255))\u003C/p\u003E\u003Cp\u003EYou will need to check for when LiquidFuelTotal = 0, i.e. when you don\u0027t have any liquid fuel tanks, so you don\u0027t end up with divide by zero. \u003C/p\u003E\u003Cp\u003ESo:\u003C/p\u003E\u003Cp\u003Eif (LiquidFuelTotal != 0)\u003C/p\u003E\u003Cp\u003EanalogWrite(PWMPin, round(LiquidFuel/LiquidFuelTotal*255));\u003C/p\u003E\u003Cp\u003Eelse\u003C/p\u003E\u003Cp\u003EanalogWrite(PWMPin, 0);\u003C/p\u003E\n"},{"CreatedByName":"Mulbin","CreatedById":55562,"CreatedDateTime":"2014-03-15T22:59:54Z","Content":"\n\u003Cp\u003EOk, next noob problem. \u003C/p\u003E\u003Cp\u003EI\u0027ve added a definition for my monopropellant pin, and set the pin as an output under void controlsInit\u003C/p\u003E\u003Cp\u003EI\u0027m trying to add the following... I\u0027ve tried putting it under void controls and void indicators with no luck.\u003C/p\u003E\u003Cp\u003Eif (MonoPropTot != 0)\u003C/p\u003E\u003Cp\u003E analogWrite(MONOPIN, round(MonoProp/MonoPropTot*255));\u003C/p\u003E\u003Cp\u003E else\u003C/p\u003E\u003Cp\u003E analogWrite(MONOPIN, 0);\u003C/p\u003E\u003Cp\u003EBut I\u0027m just getting errors thrown back that MonoProp is not defined. What am I missing? With the previous version I could just add in the lines for the fuel gauge and it worked... I didn\u0027t have to define anything additional.\u003C/p\u003E\n"},{"CreatedByName":"zitronen","CreatedById":11842,"CreatedDateTime":"2014-03-16T00:17:27Z","Content":"\n\u003Cp\u003EIt should be VData.MonoProp and VData.MonoPropTot (assuming VData is the name of the data packet you are using).\u003C/p\u003E\n"},{"CreatedByName":"Mulbin","CreatedById":55562,"CreatedDateTime":"2014-03-16T21:05:07Z","Content":"\n\u003Cp\u003Egreat, got the code working... sadly I can\u0027t get these gauges to accurately display though. For some reason the needle moves really slowly in the upper part and gets faster the closer it moves towards zero. So 0-50% takes up most of the gauge and 50-100% only takes a few millimeters. I\u0027m sure there is some clever maths I could use to even it out but no idea what!\u003C/p\u003E\n"},{"CreatedByName":"zitronen","CreatedById":11842,"CreatedDateTime":"2014-03-18T18:59:09Z","Content":"\n\u003Cp\u003ECan you just check with a multimeter that the arduino is outputing correct voltages?\u003C/p\u003E\n"},{"CreatedByName":"Katamari","CreatedById":38096,"CreatedDateTime":"2014-03-18T23:05:50Z","Content":"\n\u003Cp\u003EI don\u0027t think it is a problem with the Arduino. I don\u0027t know where the gauges came from, but it is probably that the gauges were not made to be driven by a linear voltage source.\u003C/p\u003E\u003Cp\u003EI would suggest just going by trial and error. Try putting different analog tests out to it (just try regular analog outputs from the min to the max) and see where they line up on the gauge. Then either see if there is some sort of a fit line for them (Wolfram Alpha will probably let you put in points and try a line of best fit) or else just set specific ranges to attach to points and do a series of \u0022if .. then, else ...\u0022 to set the gauge to specific values.\u003C/p\u003E\n"},{"CreatedByName":"Mulbin","CreatedById":55562,"CreatedDateTime":"2014-03-18T23:56:45Z","Content":"\n\u003Cp\u003EYeah, I wired it up to a voltmeter with a 5k resistor and it works fine, just these gauges. They are from a 1970s car so presumably 12v although 5v gets the needle almost to the top. They only have coils, no resistors. Not sure yet if I will keep fighting them or just replace them with modern 5v gauges (I\u0027ll keep the case though)... I may even be able to keep the dial faces which are quite nice.\u003C/p\u003E\n"},{"CreatedByName":"zitronen","CreatedById":11842,"CreatedDateTime":"2014-03-19T02:11:57Z","Content":"\n\u003Cp\u003ESo they are current gauges? Maybe try different series resistor values? Have you checked how much current is being drawn? Maybe it\u0027s non-linear because you are trying to draw too much current from the pins (20mA max).\u003C/p\u003E\n"},{"CreatedByName":"Mulbin","CreatedById":55562,"CreatedDateTime":"2014-03-22T14:36:48Z","Content":"\n\u003Cp\u003EJust picked up so signal meters that I\u0027ll wire up with some 5v resistors and sit behind the existing dial faces... mush easier!\u003C/p\u003E\u003Cp\u003ENow... what am I doing wrong here?\u003C/p\u003E\u003Cp\u003EI have an RCS switch and two leds... the idea is that when the switch is on and there is monopropellant in the tank then the green led is on... if the switch is on but the tank is empty the red led is on instead.\u003C/p\u003E\u003Cp\u003EBut it doesn\u0027t work. It uploads ok without errors, the RCS is turning on correctly, but the lights just don\u0027t turn on (I\u0027ve tested them and they are fine).\u003C/p\u003E\u003Cp\u003Eif (digitalRead(RCSPIN))\u003C/p\u003E\u003Cp\u003E MainControls(RCS, LOW);\u003C/p\u003E\u003Cp\u003E else\u003C/p\u003E\u003Cp\u003E MainControls(RCS, HIGH);\u003C/p\u003E\u003Cp\u003E if ((RCS == HIGH) \u0026amp;\u0026amp; (VData.MonoProp \u0026lt;=1))\u003C/p\u003E\u003Cp\u003E digitalWrite(RCSWARNLED, HIGH);\u003C/p\u003E\u003Cp\u003E else\u003C/p\u003E\u003Cp\u003E digitalWrite(RCSWARNLED, LOW);\u003C/p\u003E\u003Cp\u003E if ((RCS == HIGH) \u0026amp;\u0026amp; (VData.MonoProp \u0026gt;1))\u003C/p\u003E\u003Cp\u003E digitalWrite(RCSLED, HIGH);\u003C/p\u003E\u003Cp\u003E else\u003C/p\u003E\u003Cp\u003E digitalWrite(RCSLED, LOW);\u003C/p\u003E\u003Cp\u003EI have defined RCSLED and RCSWARNLED as outputs.\u003C/p\u003E\n"},{"CreatedByName":"zitronen","CreatedById":11842,"CreatedDateTime":"2014-03-22T15:23:02Z","Content":"\n\u003Cp\u003EWhat is this supposed to do: (RCS == HIGH) ?\u003C/p\u003E\u003Cp\u003E\u0022RCS\u0022 is defined as 6, in the first tab you should see \u0022#define RCS 6\u0022, so if you see \u0022RCS\u0022 anywhere in the code just think \u00226\u0022. Since 6 will never equal to HIGH (1) that won\u0027t work.\u003C/p\u003E\n"},{"CreatedByName":"Mulbin","CreatedById":55562,"CreatedDateTime":"2014-03-22T15:45:40Z","Content":"\n\u003Cp\u003EHmm... I tried all sorts of other things like...\u003C/p\u003E\u003Cp\u003Eif ((digitalRead(RCSPIN)) \u0026amp;\u0026amp; (VData.MonoProp \u0026gt;1))\u003C/p\u003E\u003Cp\u003Eor..\u003C/p\u003E\u003Cp\u003Eif ((RCSPIN == HIGH) \u0026amp;\u0026amp; (VData.MonoProp \u0026gt;1))\u003C/p\u003E\u003Cp\u003Ebut nothing is working.\u003C/p\u003E\u003Cp\u003EBasically in English the function I want is...\u003C/p\u003E\u003Cp\u003EIf the RCS system is switched on AND there is monopropellant on the ship\u003C/p\u003E\u003Cp\u003EThen turn the green LED on\u003C/p\u003E\u003Cp\u003EElse\u003C/p\u003E\u003Cp\u003ETurn the green LED off\u003C/p\u003E\n"},{"CreatedByName":"zitronen","CreatedById":11842,"CreatedDateTime":"2014-03-22T17:16:07Z","Content":"\n\u003Cp\u003E(RCSPIN == HIGH) will never work, RCSPIN is just a number you assigned.\u003C/p\u003E\u003Cp\u003Edoes this not work?\u003C/p\u003E\u003Cp\u003Eif (digitalRead(RCSPIN))\u003C/p\u003E\u003Cp\u003EdigitalWrite(RCSLED, HIGH);\u003C/p\u003E\u003Cp\u003Eelse\u003C/p\u003E\u003Cp\u003EdigitalWrite(RCSLED, LOW);\u003C/p\u003E\n"},{"CreatedByName":"Mulbin","CreatedById":55562,"CreatedDateTime":"2014-03-22T17:39:27Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022zitronen\u0022 data-cite=\u0022zitronen\u0022\u003E\u003Cdiv\u003E(RCSPIN == HIGH) will never work, RCSPIN is just a number you assigned.\u003Cp\u003Edoes this not work?\u003C/p\u003E\u003Cp\u003Eif (digitalRead(RCSPIN))\u003C/p\u003E\u003Cp\u003EdigitalWrite(RCSLED, HIGH);\u003C/p\u003E\u003Cp\u003Eelse\u003C/p\u003E\u003Cp\u003EdigitalWrite(RCSLED, LOW);\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThat doesn\u0027t do what I want, it would just turn the light on whenever the RCS is turned on... \u003C/p\u003E\u003Cp\u003EI want the light to only turn on when the RCS is on \u003Cspan style=\u0022text-decoration:underline;\u0022\u003E\u003Cstrong\u003EAND\u003C/strong\u003E\u003C/span\u003E there is some monopropellant in the tank.\u003C/p\u003E\n"},{"CreatedByName":"Mulbin","CreatedById":55562,"CreatedDateTime":"2014-03-22T17:51:22Z","Content":"\n\u003Cp\u003ENever mind, I\u0027ve cracked it!\u003C/p\u003E\u003Cp\u003EI had forgotten about the ON/OFF state of the switch actually being reversed.\u003C/p\u003E\u003Cp\u003ESo this works perfectly \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003Eif (digitalRead(RCSPIN))\u003C/p\u003E\u003Cp\u003E MainControls(RCS, LOW);\u003C/p\u003E\u003Cp\u003E else\u003C/p\u003E\u003Cp\u003E MainControls(RCS, HIGH);\u003C/p\u003E\u003Cp\u003E if (!(digitalRead(RCSPIN)) \u0026amp;\u0026amp; (VData.MonoProp \u0026gt;1))\u003C/p\u003E\u003Cp\u003E digitalWrite(RCSLED, HIGH);\u003C/p\u003E\u003Cp\u003E else\u003C/p\u003E\u003Cp\u003E digitalWrite(RCSLED, LOW);\u003C/p\u003E\u003Cp\u003E if (!(digitalRead(RCSPIN)) \u0026amp;\u0026amp; (VData.MonoProp \u0026lt;=1))\u003C/p\u003E\u003Cp\u003E digitalWrite(RCSWARNLED, HIGH);\u003C/p\u003E\u003Cp\u003E else\u003C/p\u003E\u003Cp\u003E digitalWrite(RCSWARNLED, LOW);\u003C/p\u003E\u003Cp\u003ENow there is always a light on when the RCS is switched on, but it changes from green to red when the monoprop runs out \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-03-22T17:54:49Z\u0022 title=\u002203/22/2014 05:54  PM\u0022 data-short=\u002210 yr\u0022\u003EMarch 22, 2014\u003C/time\u003E by Mulbin\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"zitronen","CreatedById":11842,"CreatedDateTime":"2014-03-23T17:40:29Z","Content":"\n\u003Cp\u003E\u003Cspan\u003E\u0022Weekly\u0022 update 8: 0.14.1\u003C/span\u003E\u003C/p\u003E\u003Cp\u003EAxes! Currently Only throttle, will add others later. You will need to go to settings file and set ThrottleEnable to 1, by default throttle is not enabled. Once throttle is enabled you will lose the ability to control it with keyboard. Connect a pot to an analog input pin 0 and that\u0027s it (see \u003Ca href=\u0022arduino.cc/en/Tutorial/ReadAnalogVoltage\u0022 rel=\u0022external nofollow\u0022\u003Earduino.cc/en/Tutorial/ReadAnalogVoltage\u003C/a\u003E).\u003C/p\u003E\u003Cp\u003EPlugin:\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022https://sites.google.com/site/zitronfiles/KSPSerialIO_014_1.zip\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://sites.google.com/site/zitronfiles/KSPSerialIO_014_1.zip\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EArduino:\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022https://sites.google.com/site/zitronfiles/KSPIODemo4.zip\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://sites.google.com/site/zitronfiles/KSPIODemo4.zip\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EOnce this has been tested I will add more axes and update the first post.\u003C/p\u003E\u003Cp\u003EEdit: Unfortunately I\u0027m away to Germany next week, will not be able to answer questions.\u003C/p\u003E\n"},{"CreatedByName":"Chaosratt","CreatedById":71354,"CreatedDateTime":"2014-03-23T18:34:34Z","Content":"\n\u003Cp\u003E@zitronen:\u003C/p\u003E\u003Cp\u003EHow hard would it be to get text data from KSP on a low priority? Thinking once per vessel load, or update once in a great while?\u003C/p\u003E\u003Cp\u003EBasically thinking of pulling text like how the \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/54925-WIP-ALCOR-Advanced-Landing-Capsule-for-Orbital-Rendezvous-by-ASET-(UPD-11-02-2014)\u0022 rel=\u0022external nofollow\u0022\u003EALCOR Capusle\u003C/a\u003E works for, using \u003Ca href=\u0022http://www.wide.hk/products.php?product=-IIC-%7B47%7D-I2C-1602-OLED-Module-Display-%252d-For-Arduino-%7B47%7D-PIC-%7B47%7D-AVR-%7B47%7D-ARM\u0022 rel=\u0022external nofollow\u0022\u003Ethese\u003C/a\u003E displays. They\u0027re expensive, unless someone knows of a cheaper one.\u003C/p\u003E\n"}]}