{"TopicId":137998,"ForumId":36,"TopicTitle":"Delegate help","CreatedByName":"jmbon","CreatedById":87472,"CreatedDateTime":"2016-04-24T17:22:10Z","PageNum":1,"Articles":[{"CreatedByName":"jmbon","CreatedById":87472,"CreatedDateTime":"2016-04-24T17:22:10Z","Content":"\n\u003Cp\u003E\nHello, I am trying to create a new GUI window in KSP but when I call my delegate callback(onDraw()), VS errors on me. I\u0027ve looked at the API pages, Unity tutorials and C# pages for help but have been unable to fix the issues. I\u0027d greatly appreciate any help. Below is my code along with the VS errors.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003Enamespace KSP_Wind_Display\n{\n//    public delegate CallBack(int que, int onDraw);\n\n    public class Wind_GUI_Display : PartModule\n    {\n        delegate void CallBack();\n        CallBack callback;\n\n\n        private Rect window_pos = new Rect(); // New blank window\n        private GUIStyle window_style, label_style;\n        private bool has_init_styles = false;\n\n        public override void OnStart(PartModule.StartState state)\n        {\n            base.OnStart(state);\n\n            if (!has_init_styles)\n                init_styles();\n\n            callback \u002B= onDraw;\n\n            if (state != StartState.Editor)\n                RenderingManager.AddToPostDrawQueue(0, callback());               \n\u0026lt;-------- Error 11 The best overloaded method match for \u0027RenderingManager.AddToPostDrawQueue(int, Callback)\u0027 has some invalid arguments\n\u0026lt;-------- Error 12 Argument 2: cannot convert from \u0027void\u0027 to \u0027Callback\u0027\t\n        }\n\n        private void onDraw() // Start up the window\n        {\n            if (this.vessel == FlightGlobals.ActiveVessel)\n                window_pos = GUILayout.Window(10, window_pos, onWindow, \u0022Wind Direction\u0022, window_style);\n        }\n\n        private void onWindow(int window_id)\n        {\n            GUILayout.BeginHorizontal();\n            GUILayout.EndHorizontal();\n\n            GUI.DragWindow(); // Makes the window draggable\n        }\n\n        private void init_styles()\n        {\n            window_style = new GUIStyle(HighLogic.Skin.window);\n            window_style.fixedWidth = 250.0f;\n\n            label_style = new GUIStyle(HighLogic.Skin.label);\n            label_style.stretchWidth = true; // stretches the label width to that of the window\n\n            has_init_styles = true;\n        }\n\t}\n}\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nFor Error 11, shouldn\u0027t that result in onDraw() being called.\u00A0AddToPostDrawQueue needs an int and Callback as it\u0027s arguments and that\u0027s what I am passing it.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nFor Error 12, I suspect the problem is where I first declare Callback to be void type of delegate. However, I don\u0027t want Callback to return anything so it has to be a void.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027ve worked at this problem for about 2 hours now and online forums, tutorials and man pages haven\u0027t help. Can someone here spot the issue and at least give me a hint on how to resolve it? Thanks in advance.\n\u003C/p\u003E\n"},{"CreatedByName":"Snark","CreatedById":125662,"CreatedDateTime":"2016-04-24T17:37:54Z","Content":"\n\u003Cp\u003E\nHere\u0027s the problem.\n\u003C/p\u003E\n\u003Cul\u003E\u003Cli\u003E\nWhat you\u0027re doing:\u00A0 \u0022AddToPostDrawQueue(0, \u003Cstrong\u003Ecallback\u003Cspan style=\u0022font-size:36px;\u0022\u003E\u003Cspan style=\u0022background-color:#FFFF00;\u0022\u003E()\u003C/span\u003E\u003C/span\u003E\u003C/strong\u003E)\u0022\n\u003C/li\u003E\n\u003Cli\u003E\nWhat you should be doing:\u00A0 \u0022AddToPostDrawQueue(0, \u003Cstrong\u003Ecallback\u003C/strong\u003E)\u0022\n\u003C/li\u003E\n\u003C/ul\u003E\u003Cp\u003E\nBy adding those parentheses, what that means is that you\u0027re not passing \u003Cem\u003E\u003Cu\u003Ethe callback itself\u003C/u\u003E\u003C/em\u003E\u003Cem\u003E \u003C/em\u003Eto the method.\u00A0 Instead, what you\u0027re doing is \u003Cem\u003E\u003Cu\u003Ecalling\u003C/u\u003E\u003C/em\u003E the callback (which returns void), and then passing that return value to AddToPostDrawQueue.\u00A0 So of course VS is complaining, because you\u0027re giving it a void when it wanted a callback.\n\u003C/p\u003E\n\u003Cp\u003E\nJust get rid of the parentheses so that you\u0027re passing the callback \u003Cem\u003E\u003Cu\u003Eitself\u003C/u\u003E\u003C/em\u003E.\n\u003C/p\u003E\n"},{"CreatedByName":"jmbon","CreatedById":87472,"CreatedDateTime":"2016-04-24T20:58:40Z","Content":"\n\u003Cp\u003E\nOk. I understand that. When I make the changes, VS gives me;\n\u003C/p\u003E\n\u003Cp\u003E\nError\u00A0\u00A0 \u00A011\u00A0\u00A0 \u00A0The best overloaded method match for \u0027RenderingManager.AddToPostDrawQueue(int, Callback)\u0027 has some invalid arguments\u003Cbr\u003E\nError\u00A0\u00A0 \u00A012\u00A0\u00A0 \u00A0Argument 2: cannot convert from \u0027CallBack\u0027 to \u0027Callback\u0027\u003Cbr\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nI believe Error 11 is being caused by Error 12 but unless there is a reserved keyword type called Callback, Error 12 doesn\u0027t make much sense to me. All I can think of is that Callback in\u00A0\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003E.RenderingManager.AddToPostDrawQueue(int, Callback)\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nis not a delegate at all. However, I can find no other reference in Unity nor C# man pages to callbacks except in delegates. Any ideas or wisdom? Thanks again.\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"Snark","CreatedById":125662,"CreatedDateTime":"2016-04-24T22:42:54Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222537073\u0022 data-ipsquote-contentid=\u0022137998\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221461531520\u0022 data-ipsquote-userid=\u002287472\u0022 data-ipsquote-username=\u0022jmbon\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n1 hour ago, jmbon said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nOk. I understand that. When I make the changes, VS gives me;\n\u003C/p\u003E\n\u003Cp\u003E\nError\u00A0\u00A0 \u00A011\u00A0\u00A0 \u00A0The best overloaded method match for \u0027RenderingManager.AddToPostDrawQueue(int, Callback)\u0027 has some invalid arguments\u003Cbr\u003E\nError\u00A0\u00A0 \u00A012\u00A0\u00A0 \u00A0Argument 2: cannot convert from \u0027CallBack\u0027 to \u0027Callback\u0027\u003Cbr\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nI believe Error 11 is being caused by Error 12 but unless there is a reserved keyword type called Callback, Error 12 doesn\u0027t make much sense to me. All I can think of is that Callback in\u00A0\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\n\u003Cspan class=\u0022pln\u0022\u003E.RenderingManager.AddToPostDrawQueue(int, Callback)\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nis not a delegate at all. However, I can find no other reference in Unity nor C# man pages to callbacks except in delegates. Any ideas or wisdom? Thanks again.\u00A0\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nSo, I\u0027ll answer your question in two ways.\u00A0 First, I\u0027ll tell you how you can answer this sort of question yourself.\u00A0 \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u00A0 Then I\u0027ll describe your specific issue.\n\u003C/p\u003E\n\u003Cp\u003E\nSo, the thing to do in Visual Studio:\u00A0 Mouse over \u0022RenderingManager\u0022 and hit F12.\u00A0 This will take you to the definition of the RenderingManager class.\u00A0 You\u0027ll see the AddToPostDrawQueue method there, and you can see that it takes a Callback.\u00A0 Hmm, what\u0027s a Callback, you wonder.\u00A0 So you just mouseover that and hit F12 again and it takes you to the definition.\u00A0 There!\u00A0 Your question is answered.\u00A0 \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nIn this case, it shows you that it\u0027s defined in the KSPUtil assembly, and that it\u0027s a delegate which is just a void function that takes no arguments.\n\u003C/p\u003E\n\u003Cp\u003E\nSince you declared your own delegate as being void and taking no arguments, I\u0027m not sure why it doesn\u0027t like it, I would have thought they\u0027d be equivalent.\u00A0 Have you tried declaring your own callback as \u0022Callback\u0022 (from KSPUtil) rather than declaring your own CallBack-with-a-capital-B?\u00A0 What happens then?\n\u003C/p\u003E\n"},{"CreatedByName":"jmbon","CreatedById":87472,"CreatedDateTime":"2016-04-24T23:43:42Z","Content":"\n\u003Cp\u003E\nI didn\u0027t know about the F12 functionality but\u00A0it\u0027s the same as right clicking the variable, class, etc., and selecting \u0027Peek Definition\u0027. See, I thought they were equivalent as well, hence me coming here after the forums, man pages, and online tutorials/examples didn\u0027t help.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nAnywho, when changing the B to lowercase, I got conflicting types from my program and KSPUtils.dll . I commented out my\u00A0\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003Epublic delegate CallBack(int que, int onDraw);\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nand it seems to have solved the current issue but now my UI window doesn\u0027t show up in KSP.\u00A0\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003Eusing UnityEngine;\n\n//This module will create a new GUI window and button, on button press the part will explode, close the GUI, and be removed.\n\nnamespace KSP_Wind_Display\n{\n    public class Wind_GUI_Display : PartModule\n    {\n        Callback callback;\n\n        private Rect window_pos = new Rect(); // New blank window\n        private GUIStyle window_style, label_style;\n        private bool has_init_styles = false;\n\n        public override void OnStart(PartModule.StartState state)\n        {\n            base.OnStart(state);\n\n            if (!has_init_styles)\n                init_styles();\n\n            callback \u002B= onDraw;\n\n            if (state == StartState.Flying || state == StartState.Landed || state == StartState.PreLaunch || state == StartState.Splashed)\n            {\n                RenderingManager.AddToPostDrawQueue(0, callback);\n                Debug.Log(\u0022\\n\\n\\n\\nIt should have drawn the UI\\n\\n\\n\\n\u0022);\n            }\n        }\n\n        private void onDraw() // Start up the window\n        {\n            if (this.vessel == FlightGlobals.ActiveVessel)\n                window_pos = GUILayout.Window(1, window_pos, onWindow, \u0022Wind Direction\u0022, GUILayout.MinWidth(100));\n        }\n\n        private void onWindow(int window_id)\n        {\n            GUILayout.BeginHorizontal();\n            GUILayout.Label(\u0022Width\u0022);\n            GUILayout.EndHorizontal();\n\n            GUI.DragWindow(); // Makes the window draggable\n        }\n\n        private void init_styles()\n        {\n            window_style = new GUIStyle(HighLogic.Skin.window);\n            window_style.fixedWidth = 250.0f;\n\n            label_style = new GUIStyle(HighLogic.Skin.label);\n            label_style.stretchWidth = true; // stretches the label width to that of the window\n\n            has_init_styles = true;\n        }\n    }\n}\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nI suspect the problem is because \u0027callback\u0027 was a delegate where I casted onDraw to. Now that it\u0027s not really a delegate, I suspect that \u0027RenderingManager.AddToPostDrawQueue(0, callback);\u0027 isn\u0027t being called correctly now. Any thoughts? I appreciate the help.\u00A0\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-04-24T23:53:41Z\u0022 title=\u002204/24/2016 11:53  PM\u0022 data-short=\u00228 yr\u0022\u003EApril 24, 2016\u003C/time\u003E by jmbon\u003C/strong\u003E\n\u003Cbr\u003Ecode change\n\u003C/span\u003E\n"}]}