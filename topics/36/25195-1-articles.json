{"TopicId":25195,"ForumId":36,"TopicTitle":"Making a plugin load","CreatedByName":"Ydoow","CreatedById":10165,"CreatedDateTime":"2013-05-02T23:13:58Z","PageNum":1,"Articles":[{"CreatedByName":"Ydoow","CreatedById":10165,"CreatedDateTime":"2013-05-02T23:13:58Z","Content":"\n\u003Cp\u003EI understand plugins work by attaching themselves to other parts and working through those parts, more or less.\u003C/p\u003E\u003Cp\u003ESo how would I get a plugin to influence any part? I want my plugin to load/function regardless of what\u0027s put on a craft.\u003C/p\u003E\u003Cp\u003EI\u0027m not seeing the big difference between implementation PartModule and Part. The wiki makes quick mention of it, and leads me to believe I should use PartModule, but I don\u0027t understand why, or even how.\u003C/p\u003E\u003Cp\u003EMy assumption is, though, that once I get my plugin attached to a part or vessel, I start overriding code in the OnLoad/OnStart/OnActive methods, correct?\u003C/p\u003E\u003Cp\u003ESo far I\u0027ve implemented PartModule and thrown some basic Log output messages into the mentioned methods, but nothing shows up; because I don\u0027t know how to get the plugin to utilize any parts.\u003C/p\u003E\n"},{"CreatedByName":"EndlessWaves","CreatedById":41302,"CreatedDateTime":"2013-05-02T23:47:51Z","Content":"\n\u003Cp\u003EMODULE\u003C/p\u003E\u003Cp\u003E{\u003C/p\u003E\u003Cp\u003Ename = ClassName\u003C/p\u003E\u003Cp\u003E}\u003C/p\u003E\u003Cp\u003EThat\u0027s the thing in the part.cfg that adds your PartModule derived-component to the part GameObject so all of the Monobehaviour and PartModule methods get called when relevant for that part.\u003C/p\u003E\n"},{"CreatedByName":"Ydoow","CreatedById":10165,"CreatedDateTime":"2013-05-03T00:01:43Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022EndlessWaves\u0022 data-cite=\u0022EndlessWaves\u0022\u003E\u003Cdiv\u003EMODULE\u003Cp\u003E{\u003C/p\u003E\u003Cp\u003Ename = ClassName\u003C/p\u003E\u003Cp\u003E}\u003C/p\u003E\u003Cp\u003EThat\u0027s the thing in the part.cfg that adds your PartModule derived-component to the part GameObject so all of the Monobehaviour and PartModule methods get called when relevant for that part.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003E I understand plugins work by attaching themselves to other parts and working through those parts, more or less.\u003C/p\u003E\u003Cp\u003ESo how would I get a plugin to influence any part? I want my plugin to load/function regardless of what\u0027s put on a craft.\u003C/p\u003E\u003Cp\u003EI\u0027m not seeing the big difference between implementation PartModule and Part. The wiki makes quick mention of it, and leads me to believe I should use PartModule, but I don\u0027t understand why, or even how.\u003C/p\u003E\u003Cp\u003EMy assumption is, though, that once I get my plugin attached to a part or vessel, I start overriding code in the OnLoad/OnStart/OnActive methods, correct?\u003C/p\u003E\u003Cp\u003ESo far I\u0027ve implemented PartModule and thrown some basic Log output messages into the mentioned methods, but nothing shows up; because I don\u0027t know how to get the plugin to utilize any parts.\u003C/p\u003E\u003Cp\u003EEdit: Similar to Kerbal Alarm Clock. It states you don\u0027t need to attach any part to a craft to make the plugin work, but have no idea how to accomplish that.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-05-03T00:12:39Z\u0022 title=\u002205/03/2013 12:12  AM\u0022 data-short=\u002211 yr\u0022\u003EMay 3, 2013\u003C/time\u003E by Ydoow\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Frement","CreatedById":62711,"CreatedDateTime":"2013-05-03T01:13:17Z","Content":"\n\u003Cp\u003EPerhaps this example code helps:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Eusing System;\u003Cbr\u003Eusing System.Threading;\u003Cbr\u003Eusing System.Collections.Generic;\u003Cbr\u003Eusing System.Linq;\u003Cbr\u003Eusing System.Text;\u003Cbr\u003Eusing UnityEngine;\u003Cbr\u003E\u003Cbr\u003Enamespace ClassLibrary1\u003Cbr\u003E{\u003Cbr\u003E    public class Class1 : ScenarioModule\u003Cbr\u003E    {\u003Cbr\u003E        public static bool running;\u003Cbr\u003E\u003Cbr\u003E        private int rounds = 0;\u003Cbr\u003E        private int textShown = 0;\u003Cbr\u003E\u003Cbr\u003E        public Class1()\u003Cbr\u003E        {\u003Cbr\u003E            if (!Class1.running)\u003Cbr\u003E            {\u003Cbr\u003E                Class1.running = true;\u003Cbr\u003E                Thread worker = new Thread(Worker);\u003Cbr\u003E                worker.Start();\u003Cbr\u003E            }\u003Cbr\u003E        }\u003Cbr\u003E\u003Cbr\u003E        private void Worker()\u003Cbr\u003E        {\u003Cbr\u003E            while (true)\u003Cbr\u003E            {\u003Cbr\u003E                if (HighLogic.LoadedSceneIsFlight)\u003Cbr\u003E                {\u003Cbr\u003E                    textShown\u002B\u002B;\u003Cbr\u003E                    ScreenMessages.PostScreenMessage(\u0022Text \u0022 \u002B textShown \u002B \u0022 (\u0022 \u002B rounds \u002B \u0022) from Worker();\u0022, 1, ScreenMessageStyle.UPPER_CENTER);\u003Cbr\u003E                }\u003Cbr\u003E                rounds\u002B\u002B;\u003Cbr\u003E                Thread.Sleep(2000);\u003Cbr\u003E            }\u003Cbr\u003E        }\u003Cbr\u003E    }\u003Cbr\u003E}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EWhen entering the scene that the scenario is set to, it starts a background thread that will continue even if you leave that scene, allowing your plugin to work without any parts, and in any scene.\u003C/p\u003E\n"},{"CreatedByName":"EndlessWaves","CreatedById":41302,"CreatedDateTime":"2013-05-03T12:25:05Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Ydoow\u0022 data-cite=\u0022Ydoow\u0022\u003E\u003Cdiv\u003EI understand plugins work by attaching themselves to other parts and working through those parts, more or less.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ETechnically Part code objects and PartModule-derived code objects are both attached to the part\u0027s top level GameObject, but the Part codeObject does maintain a list of PartModules that it calls methods on.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Ydoow\u0022 data-cite=\u0022Ydoow\u0022\u003E\u003Cdiv\u003E\u003Cp\u003ESo how would I get a plugin to influence any part?\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYou would get a reference to that part and then call methods on it. Typically through the vessel, for example FlightGlobals.ActiveVessel, FlightGlobals.Vessels or this.vessel (the last one only on Part and PartModule derived classes).\u003C/p\u003E\u003Cp\u003EI\u0027m not seeing the big difference between implementation PartModule and Part. The wiki makes quick mention of it, and leads me to believe I should use PartModule, but I don\u0027t understand why, or even how.\u003C/p\u003E\u003Cp\u003EMy assumption is, though, that once I get my plugin attached to a part or vessel, I start overriding code in the OnLoad/OnStart/OnActive methods, correct?\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Ydoow\u0022 data-cite=\u0022Ydoow\u0022\u003E\u003Cdiv\u003E\u003Cp\u003EI want my plugin to load/function regardless of what\u0027s put on a craft.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThen you can\u0027t use PartModule because objects using that class only get created when you add a part to a craft. What you do is create your own GameObject and add a MonoBehaviour derived class to that.\u003C/p\u003E\u003Cp\u003EThe favoured way at the moment to launch such code is to use KSP\u0027s testing framework, for example Deadly Reentry uses:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E    public class DeadlyReentry : KSP.Testing.UnitTest\u003Cbr\u003E    {\u003Cbr\u003E        public DeadlyReentry()\u003Cbr\u003E        {\u003Cbr\u003E            GameObject ghost = new GameObject(\u0022DeadlyReentryGhost\u0022, typeof(DeadlyReentryGhost));\u003Cbr\u003E            GameObject.DontDestroyOnLoad(ghost);\u003Cbr\u003E        }\u003Cbr\u003E    }\u003Cbr\u003E\u003Cbr\u003E    public class DeadlyReentryGhost : MonoBehaviour\u003Cbr\u003E    {\u003Cbr\u003E    //Do stuff, all of the [URL=\u0022http://docs.unity3d.com/Documentation/ScriptReference/MonoBehaviour.html\u0022]MonoBehaviour[/URL] overridable methods will get called.\u003Cbr\u003E    }\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Frement\u0022 data-cite=\u0022Frement\u0022\u003E\u003Cdiv\u003EWhen entering the scene that the scenario is set to, it starts a background thread that will continue even if you leave that scene, allowing your plugin to work without any parts, and in any scene.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EDid you test that? I was under the impression that unity wasn\u0027t thread safe and trying to access anything in the game from a secondary thread would cause problems.\u003C/p\u003E\n"},{"CreatedByName":"Ydoow","CreatedById":10165,"CreatedDateTime":"2013-05-05T00:47:44Z","Content":"\n\u003Cp\u003EThanks endless wave! I used your method, and I\u0027m seeing messages sent to the Log, so it is working.\u003C/p\u003E\u003Cp\u003EWhen exactly is the plugin loaded, though? During the loading screen, Main Menu, Saved file being loaded, Flight scene, etc...?\u003C/p\u003E\u003Cp\u003EIt doesn\u0027t really matter I guess, but it would be good to know for future use perhaps.\u003C/p\u003E\n"},{"CreatedByName":"EndlessWaves","CreatedById":41302,"CreatedDateTime":"2013-05-05T10:26:09Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Ydoow\u0022 data-cite=\u0022Ydoow\u0022\u003E\u003Cdiv\u003EWhen exactly is the plugin loaded, though? During the loading screen, Main Menu, Saved file being loaded, Flight scene, etc...?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThe output_log.txt in the KSP_Data folder contains the details of the game\u0027s most recent run.\u003C/p\u003E\u003Cp\u003EIt looks like unit tests are loaded before almost everything else as you\u0027d expect, so before the loading screen.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-05-05T14:57:13Z\u0022 title=\u002205/05/2013 02:57  PM\u0022 data-short=\u002211 yr\u0022\u003EMay 5, 2013\u003C/time\u003E by EndlessWaves\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Michael Kim","CreatedById":38782,"CreatedDateTime":"2013-05-05T14:41:42Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Ydoow\u0022 data-cite=\u0022Ydoow\u0022\u003E\u003Cdiv\u003EEdit: Similar to Kerbal Alarm Clock. It states you don\u0027t need to attach any part to a craft to make the plugin work, but have no idea how to accomplish that.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EKerbal Alarm Clock uses a \u0022ghost part\u0022 to load its stuff into the game on startup\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Frement\u0022 data-cite=\u0022Frement\u0022\u003E\u003Cdiv\u003EWhen entering the scene that the scenario is set to, it starts a background thread that will continue even if you leave that scene, allowing your plugin to work without any parts, and in any scene.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EIt seems that you need to add the scenario module into the persistent.sfs manually, or it won\u0027t be loaded\u003C/p\u003E\u003Cp\u003EEDIT: BTW EndlessWaves, is the source code of Deadly Reentry available anywhere? The forum thread is lost.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-05-05T14:45:53Z\u0022 title=\u002205/05/2013 02:45  PM\u0022 data-short=\u002211 yr\u0022\u003EMay 5, 2013\u003C/time\u003E by Michael Kim\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"EndlessWaves","CreatedById":41302,"CreatedDateTime":"2013-05-05T14:56:05Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Michael Kim\u0022 data-cite=\u0022Michael Kim\u0022\u003E\u003Cdiv\u003EBTW EndlessWaves, is the source code of Deadly Reentry available anywhere? The forum thread is lost.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003E\u003Ca href=\u0022https://github.com/r4m0n/KSP_DeadlyReentry\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/r4m0n/KSP_DeadlyReentry\u003C/a\u003E\u003C/p\u003E\n"},{"CreatedByName":"Michael Kim","CreatedById":38782,"CreatedDateTime":"2013-05-05T15:36:15Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022EndlessWaves\u0022 data-cite=\u0022EndlessWaves\u0022\u003E\u003Cdiv\u003E\u003Ca href=\u0022https://github.com/r4m0n/KSP_DeadlyReentry\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/r4m0n/KSP_DeadlyReentry\u003C/a\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThank you very much!\u003C/p\u003E\n"}]}