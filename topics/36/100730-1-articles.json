{"TopicId":100730,"ForumId":36,"TopicTitle":"[WIP][Plugin][0.90] Telemachus and RemoteTech Kitbash","CreatedByName":"jackellice","CreatedById":123980,"CreatedDateTime":"2015-02-25T21:12:27Z","PageNum":1,"Articles":[{"CreatedByName":"jackellice","CreatedById":123980,"CreatedDateTime":"2015-02-25T21:12:27Z","Content":"Telemachus and RemoteTech Kitbash\n\nThe purpose of this mod is to function as a realism add-on that combines Telemachus and RemoteTech in a nifty way.\n\nThis mod is a small change that does two things\n\n1. Telemachus module to every RemoteTech enabled Antenna. That means if RemoteTech or anyone patches other antennas to include a RemoteTech antenna, it will be able to function as a Telemachus antenna as well.\n2. makes Telemachus reliant on RemoteTech to function. That means if the antenna does not have a connection to the KSC, No Telemetary will be received by the end user.\n\nRequirements:\n\n1. [Remote Tech v1.6.3](https://forum.kerbalspaceprogram.com/threads/83305-0-90-0-RemoteTech-v1-6-3-2015-02-06)\n2. [Telemachus 2014-10-12](https://forum.kerbalspaceprogram.com/threads/24594-0-25-%282014-10-12%29-Telemachus-%E2%80%93-Telemetry-and-Flight-Control-in-the-Web-Browser)\n\nI don\u0027t know if this will work in later versions. If anyone could help me figure out how to modify another mod\u0027s override update method outside of recompiling their dll, i\u0027m all ears.\n\nLicenses located here\n\n[For Telemachus](https://github.com/richardbunt/Telemachus/blob/master/Licences/LICENCE)(Modified BSD) This product includes software developed by Richard Bunt.\n\n[For remoteTech](https://github.com/RemoteTechnologiesGroup/RemoteTech/blob/master/LICENSE.txt)(GPLv2) \n\nInstallation\n\nInstallation requires you to move the gamedata folder to the ksp directory. If you compile the Telemachus dll, you will have to replace the dll in Telemachus\u0027 folder. it does this to add the remotetech reliance to all telemachus parts. If that is not desired just simply use the config file. It will just add telemachus to all remote tech antenna without including the reliance.\n\nRemember to **only install this modification after installing RemoteTech and Telemachus**\n\n\u003E ![stock_dish_not_working_by_jackellice-d8jhqfe.png]()![stock_dish_working_by_jackellice-d8jhqd2.png](http://fc08.deviantart.net/fs71/i/2015/056/0/3/stock_dish_working_by_jackellice-d8jhqd2.png)\n\u003E \n\n\u003E \n\u003E [/SIZE][SIZE=3]{  \n\u003E [/SIZE][SIZE=3] statusString = \u0022No Connection!\u0022;  \n\u003E [/SIZE][SIZE=3] isActive = false;  \n\u003E [/SIZE][SIZE=3] telemachusInactive();[/SIZE]  \n\u003E [SIZE=3]}[/SIZE]\n\u003E \n\u003E \n\u003E     [SIZE=3]else if (!RemoteTech.API.API.HasConnectionToKSC(FlightGlobals.ActiveVessel.id))//if remote tech is not operational do this.\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E \n\u003E \n\u003E @PART  \n\u003E [\\*]:HAS[@MODULE[ModuleRTAntenna]]:AFTER[RemoteTech]:NEEDS[RemoteTech]{  \n\u003E  MODULE  \n\u003E  {  \n\u003E  name = TelemachusDataLink  \n\u003E  }  \n\u003E   \n\u003E   \n\u003E  MODULE  \n\u003E  {  \n\u003E  name = TelemachusPowerDrain  \n\u003E  powerConsumptionBase = 0.01  \n\u003E  powerConsumptionIncrease = 0.02  \n\u003E  }  \n\u003E }\n\u003E \n\u003E \n\u003E     \n\u003E \n\u003E \n\u003E \n\u003E \n\u003E \n\nCompiled files \n\nFiles include the config file and the compiled dll\n\nDownload from here\n\nSource Code \n\nFiles included are a config file to add telemachus to all RemoteTech parts and the source code for the Telemachus dll. Permission has been granted by forum.kerbalspaceprogram.com/members/17885-Rich\u0022]Rich\n\nDownload from [here](https://drive.google.com/open?id=0B1cwjX6yqx70RUFDWmtxM3ltSjA\u0026authuser=0)\n\nThis mod is not endorsed by either Rich or Peppie23\n\nPossible Future Updates\n\nProvided I can figure out how, move my changes over to a separate dll so that it doesn\u0027t change the Telemachus dll.\n\nMake telemetary data lag as the signal delay increases with distance.\n\ninclude more telemetary data or UI to the server side of Telemachus.\n\nSo that\u0027s that. let me know what you think.\n\n**Edited \u003Ctime datetime=\u00222015-02-27T11:32:21Z\u0022 title=\u002202/27/2015 11:32  AM\u0022 data-short=\u00229 yr\u0022\u003EFebruary 27, 2015\u003C/time\u003E by jackellice**\n  \nreadding permissions"},{"CreatedByName":"Drew Kerman","CreatedById":103177,"CreatedDateTime":"2015-02-26T03:41:47Z","Content":"\u003E \n\u003E Make telemetary data lag as the signal delay increases with distance.\n\nThis would be a killer feature for a lot of people. Currently nothing out there that I know of that does this"},{"CreatedByName":"jackellice","CreatedById":123980,"CreatedDateTime":"2015-02-26T06:57:02Z","Content":"Oh hey you do KSA. I saw it recently, It was pretty cool.\n\nAs to you kOS stuff. I have been thinking if it was possible to code stuff from a telemachus link that transfers the code to the onboard kOS.\n\nIf I can make telemetary data lag and it doesn\u0027t look juttery on the web server side I think it should be very possible for you to get that working for kOS."},{"CreatedByName":"Drew Kerman","CreatedById":103177,"CreatedDateTime":"2015-02-26T12:30:27Z","Content":"You know kOS now has a telnet server/client capability? It might be possible to hook telemachus into that."},{"CreatedByName":"jackellice","CreatedById":123980,"CreatedDateTime":"2015-02-26T13:18:58Z","Content":"I\u0027ve been having difficulty understanding the code in Telemachus beyond what\u0027s specified for the part module.\n\nI\u0027m not familiar enough to know where to add a delay to the telemetary data."},{"CreatedByName":"jackellice","CreatedById":123980,"CreatedDateTime":"2015-02-26T18:58:01Z","Content":"So this is what I think may make it work. I\u0027m not familiar with server code and the ramifications of what i\u0027m doing.\n\nThis bit is located in the KSPWebSocketService class in the Server.dll\n\n\u003E \n\u003E \n\u003E \n\u003E [COLOR=#000000][FONT=Verdana]private void streamData(object sender, ElapsedEventArgs e) [/FONT][/COLOR]  \n\u003E [COLOR=#000000][FONT=Verdana] {[/FONT][/COLOR]  \n\u003E [COLOR=#000000][FONT=Verdana] streamTimer.Interval = streamRate;[/FONT][/COLOR]  \n\u003E   \n\u003E [COLOR=#000000][FONT=Verdana] DataSources dataSources = new DataSources();[/FONT][/COLOR]  \n\u003E   \n\u003E [COLOR=#000000][FONT=Verdana] if (toRun.Count \u002B subscriptions.Count \u003E 0)[/FONT][/COLOR]  \n\u003E [COLOR=#000000][FONT=Verdana] {[/FONT][/COLOR]  \n\u003E [COLOR=#000000][FONT=Verdana] try[/FONT][/COLOR]  \n\u003E [COLOR=#000000][FONT=Verdana] {[/FONT][/COLOR]  \n\u003E [COLOR=#000000][FONT=Verdana] List\u003Cstring\u003E entries = new List\u003Cstring\u003E();[/FONT][/COLOR]\u003Cbr\u003E\u003Cbr\u003E[COLOR=#000000][FONT=Verdana] APIEntry entry = null;[/FONT][/COLOR]\u003Cbr\u003E\u003Cbr\u003E[COLOR=#000000][FONT=Verdana] lock (subscriptionLock)[/FONT][/COLOR]\u003Cbr\u003E[COLOR=#000000][FONT=Verdana] {[/FONT][/COLOR]\u003Cbr\u003E[COLOR=#000000][FONT=Verdana] dataSources.vessel = kspAPI.getVessel();[/FONT][/COLOR]\u003Cbr\u003E\u003Cbr\u003E[B][COLOR=#000000][FONT=Verdana] signalDelay = RemoteTech.API.API.GetSignalDelayToKSC(dataSources.vessel.id);// this is what i\u0027ve added[/FONT][/COLOR]\u003Cbr\u003E[COLOR=#000000][FONT=Verdana] if (UnityEngine.Time.time - currentTime \u003E signalDelay) // as well as this calculates the change in time. if the change is more than signal delay time, execute[/FONT][/COLOR]\u003Cbr\u003E[COLOR=#000000][FONT=Verdana] {[/FONT][/COLOR][/B]\u003Cbr\u003E[COLOR=#000000][FONT=Verdana] if (dataSources.vessel != null)[/FONT][/COLOR]\u003Cbr\u003E[COLOR=#000000][FONT=Verdana] {[/FONT][/COLOR]\u003Cbr\u003E[COLOR=#000000][FONT=Verdana] toRun.UnionWith(subscriptions);[/FONT][/COLOR]\u003Cbr\u003E\u003Cbr\u003E[COLOR=#000000][FONT=Verdana] foreach (string s in toRun)[/FONT][/COLOR]\u003Cbr\u003E[COLOR=#000000][FONT=Verdana] {[/FONT][/COLOR]\u003Cbr\u003E[COLOR=#000000][FONT=Verdana] DataSources dataSourcesClone = dataSources.Clone();[/FONT][/COLOR]\u003Cbr\u003E[COLOR=#000000][FONT=Verdana] string trimedQuotes = s.Trim();[/FONT][/COLOR]\u003Cbr\u003E[COLOR=#000000][FONT=Verdana] string refArg = trimedQuotes;[/FONT][/COLOR]\u003Cbr\u003E[COLOR=#000000][FONT=Verdana] kspAPI.parseParams(ref refArg, ref dataSourcesClone);[/FONT][/COLOR]\u003Cbr\u003E\u003Cbr\u003E[COLOR=#000000][FONT=Verdana] kspAPI.process(refArg, out entry);[/FONT][/COLOR]\u003Cbr\u003E\u003Cbr\u003E[COLOR=#000000][FONT=Verdana] if (entry != null)[/FONT][/COLOR]\u003Cbr\u003E[COLOR=#000000][FONT=Verdana] {[/FONT][/COLOR]\u003Cbr\u003E[COLOR=#000000][FONT=Verdana] entry.formatter.setVarName(trimedQuotes);[/FONT][/COLOR]\u003Cbr\u003E[COLOR=#000000][FONT=Verdana] entries.Add(entry.formatter.format(entry.function(dataSourcesClone)));[/FONT][/COLOR]\u003Cbr\u003E[COLOR=#000000][FONT=Verdana] }[/FONT][/COLOR]\u003Cbr\u003E[COLOR=#000000][FONT=Verdana] }[/FONT][/COLOR]\u003Cbr\u003E\u003Cbr\u003E[COLOR=#000000][FONT=Verdana] toRun.Clear();[/FONT][/COLOR]\u003Cbr\u003E\u003Cbr\u003E[COLOR=#000000][FONT=Verdana] if (entry != null)[/FONT][/COLOR]\u003Cbr\u003E[COLOR=#000000][FONT=Verdana] {[/FONT][/COLOR]\u003Cbr\u003E[COLOR=#000000][FONT=Verdana] WebSocketFrame frame = new WebSocketFrame(ASCIIEncoding.UTF8.GetBytes(entry.formatter.pack(entries)));[/FONT][/COLOR]\u003Cbr\u003E[COLOR=#000000][FONT=Verdana] byte[] bFrame = frame.AsBytes();[/FONT][/COLOR]\u003Cbr\u003E[COLOR=#000000][FONT=Verdana] dataRates.addDownLinkPoint(System.DateTime.Now, bFrame.Length * UpLinkDownLinkRate.BITS_PER_BYTE);[/FONT][/COLOR]\u003Cbr\u003E[COLOR=#000000][FONT=Verdana] clientConnection.Send(bFrame);[/FONT][/COLOR]\u003Cbr\u003E[COLOR=#000000][FONT=Verdana] }[/FONT][/COLOR]\u003Cbr\u003E[COLOR=#000000][FONT=Verdana] }[/FONT][/COLOR]\u003Cbr\u003E[COLOR=#000000][FONT=Verdana] else[/FONT][/COLOR]\u003Cbr\u003E[COLOR=#000000][FONT=Verdana] {[/FONT][/COLOR]\u003Cbr\u003E[COLOR=#000000][FONT=Verdana] sendNullMessage();[/FONT][/COLOR]\u003Cbr\u003E[COLOR=#000000][FONT=Verdana] }[/FONT][/COLOR]\u003Cbr\u003E[B][COLOR=#000000][FONT=Verdana] }// end of if statment[/FONT][/COLOR]\u003Cbr\u003E[COLOR=#000000][FONT=Verdana] currentTime = UnityEngine.Time.time;// changes current time to the current time of the frame[/FONT][/COLOR][/B]\u003Cbr\u003E[COLOR=#000000][FONT=Verdana] } [/FONT][/COLOR]\u003Cbr\u003E[COLOR=#000000][FONT=Verdana] }[/FONT][/COLOR]\u003Cbr\u003E[COLOR=#000000][FONT=Verdana] catch(NullReferenceException)[/FONT][/COLOR]\u003Cbr\u003E[COLOR=#000000][FONT=Verdana] {[/FONT][/COLOR]\u003Cbr\u003E[COLOR=#000000][FONT=Verdana] PluginLogger.debug(\u0022Swallowing null reference exception, potentially due to async game state change.\u0022);[/FONT][/COLOR]\u003Cbr\u003E[COLOR=#000000][FONT=Verdana] sendNullMessage();[/FONT][/COLOR]\u003Cbr\u003E[COLOR=#000000][FONT=Verdana] }[/FONT][/COLOR]\u003Cbr\u003E[COLOR=#000000][FONT=Verdana] catch (Exception ex)[/FONT][/COLOR]\u003Cbr\u003E[COLOR=#000000][FONT=Verdana] {[/FONT][/COLOR]\u003Cbr\u003E[COLOR=#000000][FONT=Verdana] PluginLogger.debug(\u0022Closing socket due to potential client disconnect:\u0022 \u002B ex.GetType().ToString());[/FONT][/COLOR]\u003Cbr\u003E[COLOR=#000000][FONT=Verdana] close();[/FONT][/COLOR]\u003Cbr\u003E[COLOR=#000000][FONT=Verdana] }[/FONT][/COLOR]\u003Cbr\u003E[COLOR=#000000][FONT=Verdana] }[/FONT][/COLOR]\u003Cbr\u003E[COLOR=#000000][FONT=Verdana] else[/FONT][/COLOR]\u003Cbr\u003E[COLOR=#000000][FONT=Verdana] {[/FONT][/COLOR]\u003Cbr\u003E[COLOR=#000000][FONT=Verdana] sendNullMessage();[/FONT][/COLOR]\u003Cbr\u003E[COLOR=#000000][FONT=Verdana] }\u003Cbr\u003E[/FONT][/COLOR]\u003C/string\u003E\u003C/string\u003E\n\u003E \n\u003E \n\u003E     \n\u003E \n\u003E \n\u003E"},{"CreatedByName":"Agathorn","CreatedById":99662,"CreatedDateTime":"2015-02-27T00:00:58Z","Content":"This is cool and all but you need to ensure you keep your ducks in a row. You aren\u0027t really in compliance with Telemachus\u0027 license (though you can be with some small changes), and you haven\u0027t provided your own license either. Like I this I think this is cool, so i\u0027d hate to see it taken down for little things you can fix ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)"},{"CreatedByName":"jackellice","CreatedById":123980,"CreatedDateTime":"2015-02-27T00:50:43Z","Content":"Could you be more specific as to what I\u0027m not complying with? Thanks!"},{"CreatedByName":"Agathorn","CreatedById":99662,"CreatedDateTime":"2015-02-27T02:22:56Z","Content":"\u003E \n\u003E Could you be more specific as to what I\u0027m not complying with? Thanks!\n\nWell if you check out the Telemachus license, as I see it there are 3 main points:\n\n1. You need his permission to redistribute. did you get that? Generally you would post something saying you did.\n\n2. It needs to include the copyright notice, which i\u0027m not sure a link satisfies that. Probably best just to include the actual text both in the post and in your source code. It might already bein your source code, which I didn\u0027t look at, so if it is my apologies.\n\nAnd lastly: \n\n\u003E \n\u003E 3. All advertising materials mentioning features or use of this software\n\u003E  must display the following acknowledgement:\n\u003E \n\u003E  This product includes software developed by Richard Bunt.\n\nLike I said, minor things really. Just best to cross your Ts and Dot your Is as the saying goes."},{"CreatedByName":"jackellice","CreatedById":123980,"CreatedDateTime":"2015-02-27T02:30:33Z","Content":"This is fair. I\u0027ve misread it as requiring permission if the source file wasn\u0027t distributed as well. I\u0027ll remove the compiled dll.\n\nLicenses were provided in both compiled and source files.\n\nWill add the acknowledgement.\n\nThanks for clarifying.\n\n**Edited \u003Ctime datetime=\u00222015-02-27T02:50:40Z\u0022 title=\u002202/27/2015 02:50  AM\u0022 data-short=\u00229 yr\u0022\u003EFebruary 27, 2015\u003C/time\u003E by jackellice**"},{"CreatedByName":"jackellice","CreatedById":123980,"CreatedDateTime":"2015-02-27T11:55:55Z","Content":"Alright it\u0027s all sorted now"},{"CreatedByName":"panzerwaffe044","CreatedById":143917,"CreatedDateTime":"2015-06-26T03:08:40Z","Content":"Is it still working? Could you refresh the link, please?"}]}