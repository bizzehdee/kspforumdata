{"TopicId":103963,"ForumId":36,"TopicTitle":"[WIP][1.9.x-1.12.x] Scatterer-atmospheric scattering (0.0838 - 14/08/2022) Scattering improvements, in-game atmo generation and multi-sun support","CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-04-12T08:37:35Z","PageNum":149,"Articles":[{"CreatedByName":"pingopete","CreatedById":74168,"CreatedDateTime":"2016-03-09T22:00:50Z","Content":"\u003E \n\u003E \n\u003E 5 minutes ago, blackrack said:\n\u003E \n\u003E \n\u003E The last values are the scale (inverse of), but even with the default scale you should see the other components. So try if it works with the base game.\n\u003E \n\nJust tried with the default sunflare config but still nothing"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2016-03-09T22:03:46Z","Content":"\u003E \n\u003E \n\u003E 3 minutes ago, pingopete said:\n\u003E \n\u003E \n\u003E Just tried with the default sunflare config but still nothing\n\u003E \n\nAlright, so probably still an issue with the sunflare on OpenGL, I\u0027ll try to send you a fixed shader file when I can.\n\n**Edited \u003Ctime datetime=\u00222016-03-09T22:04:04Z\u0022 title=\u002203/09/2016 10:04  PM\u0022 data-short=\u00228 yr\u0022\u003EMarch 9, 2016\u003C/time\u003E by blackrack**"},{"CreatedByName":"pingopete","CreatedById":74168,"CreatedDateTime":"2016-03-09T22:04:26Z","Content":"\u003E \n\u003E \n\u003E Just now, blackrack said:\n\u003E \n\u003E \n\u003E Alright, so probably still an issue with the sunflare on OpenGL, I\u0027ll try to send you a different shader file when I can.\n\u003E \n\ncool, thanks for looking into it"},{"CreatedByName":"eggrobin","CreatedById":4680,"CreatedDateTime":"2016-03-09T22:33:10Z","Content":"I tried looking at a real eclipse with scatterer (it worked! ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif \u0022:)\u0022)), see the post linked below.\n\n\u003Ciframe data-embedcontent=\u0022\u0022 frameborder=\u00220\u0022 src=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/62205-wip105-principia-version-buffon-2016-02-22-n-body-and-extended-body-gravitation/\u0026do=embed\u0026embedComment=2449893\u0026embedDo=findComment\u0022\u003E\u003C/iframe\u003E"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2016-03-10T16:49:36Z","Content":"Planetary rings are fixed:\n\n![r82RziF.png](http://i.imgur.com/r82RziF.png)\n\nWith one issue:\n\nThey will appear over the atmosphere when seen from angles like this:\n\n![OBl8kWA.png](http://i.imgur.com/OBl8kWA.png)\n\nHowever from inside the atmosphere they will display correctly, so if you add rings to an earth-like planet the rings will still render correctly in the sky.\n\nGiven that the atmosphere and the rings are both transparent objects, it can be difficult to sort them, z-sorting can only be used against the planet (what you see above) as you don\u0027t want transparent objects writing to the z-buffer, and sorting purely using renderqueues can\u0027t be applied as the ring is both in front of and behind the atmosphere at the same time, unless seen all the way from inside the atmosphere.\n\nBut this is good enough for now until I come up with a better solution. First thought that comes to mind is splitting the ring mesh in two and sorting them based on which half is in front of or behind the atmosphere, but there might be a simpler way I\u0027m not aware of. Another trick that can be used is, well, shrinking down the atmo so it\u0027s edge is above the planet and this problem isn\u0027t visible anymore, that\u0027s more of a duct-tape solution ![:P](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif \u0022:P\u0022)\n\n**Edited \u003Ctime datetime=\u00222016-03-10T17:02:21Z\u0022 title=\u002203/10/2016 05:02  PM\u0022 data-short=\u00228 yr\u0022\u003EMarch 10, 2016\u003C/time\u003E by blackrack**"},{"CreatedByName":"rbray89","CreatedById":48847,"CreatedDateTime":"2016-03-10T16:54:39Z","Content":"\u003E \n\u003E \n\u003E 1 minute ago, blackrack said:\n\u003E \n\u003E \n\u003E But this is good enough for now until I come up with a better solution. First thought that comes to mind is splitting the ring mesh in two and sorting them based on which half is in front of or behind the atmosphere, but there might be a simpler way I\u0027m not aware of.\n\u003E \n\nThat\u0027s actually a really good idea. I do something similar for my clouds, where the 2d cloud layer is actually just a mesh that I move around, and compensate for placement in the shader. In my case, I did that so I could effectively double the rendering geometry without hitting performance issues."},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2016-03-10T17:00:13Z","Content":"\u003E \n\u003E \n\u003E 3 minutes ago, rbray89 said:\n\u003E \n\u003E \n\u003E That\u0027s actually a really good idea. I do something similar for my clouds, where the 2d cloud layer is actually just a mesh that I move around, and compensate for placement in the shader. In my case, I did that so I could effectively double the rendering geometry without hitting performance issues.\n\u003E \n\nI see, very nice! So you render half a sphere oriented towards the camera at all times, is that right? Could it be that the orientation gets stuck sometimes and that is the reason for the \u0022half the clouds are missing\u0022 bug that people have been complaining about lately ![:P](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif \u0022:P\u0022) ?"},{"CreatedByName":"rbray89","CreatedById":48847,"CreatedDateTime":"2016-03-10T17:02:54Z","Content":"\u003E \n\u003E \n\u003E 1 minute ago, blackrack said:\n\u003E \n\u003E \n\u003E I see, very nice! So you render half a sphere oriented towards the camera at all times, is that right? Could it be that the orientation gets stuck sometimes and that is the reason for the \u0022half the clouds are missing\u0022 bug that people have been complaining about lately ![:P](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif \u0022:P\u0022) ?\n\u003E \n\nThat\u0027s exactly it ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif \u0022:)\u0022) there is an issue where when entering map view/scaled space I stop moving the object to face the camera."},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2016-03-10T17:05:53Z","Content":"\u003E \n\u003E \n\u003E Just now, rbray89 said:\n\u003E \n\u003E \n\u003E That\u0027s exactly it ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif \u0022:)\u0022) there is an issue where when entering map view/scaled space I stop moving the object to face the camera.\n\u003E \n\nAhh, I noticed that moving the camera in mapview to match the view of the ship \u0022fixes\u0022 the problem. However I thought you might be loading part of the textures separately and it was just some parts of the texture not getting loaded, I thought you were using cubemaps like this or something ![:P](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif \u0022:P\u0022)"},{"CreatedByName":"SkyKaptn","CreatedById":153990,"CreatedDateTime":"2016-03-10T17:39:31Z","Content":"\u003E \n\u003E \n\u003E 47 minutes ago, blackrack said:\n\u003E \n\u003E \n\u003E Planetary rings are fixed\n\u003E \n\nThank you! That made my day Champ ![:cool:](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cool.gif \u0022:cool:\u0022)"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2016-03-10T20:51:32Z","Content":"Alright, I\u0027m uploading a new version, the fixed planetary rings are there, telescope mods will also work fine in scaledSpace now, however the postprocessing shader will still interfere with them when PQS is active.\n\nThe option to draw the atmo over EVE clouds is there, it will make the terminators and the orbital view better in general, it will also make the eclipses appear over clouds but it has some issues of it\u0027s own:\n\n![DfALMWD.png](http://i.imgur.com/DfALMWD.png)\n\nAs you can see, the clouds on the edge are overly tinted because the atmosphere shader thinks they are actually behind the curve and therefore, is applying a lot more extinction. The transition from PQS to scaledSpace also has some problems. If you don\u0027t like it you can turn it off from the main menu or turn it off for a specific planet from the planetsList file.\n\nIf you don\u0027t use EVE you should also turn it off.\n\nIn the future I will try to come up with a better way to do this, perhaps even work with rbray and make modified versions of the EVE cloud shaders which will have scattering rendered directly and correctly inside them (should also look better from the ground).\n\nThis release should also fix the lens flare shader on OpenGL for those who still can\u0027t get it to work ([@pingopete](https://forum.kerbalspaceprogram.com/index.php?/profile/74168-pingopete/) please test if it\u0027s fixed)\n\n**Edited \u003Ctime datetime=\u00222016-03-10T20:53:26Z\u0022 title=\u002203/10/2016 08:53  PM\u0022 data-short=\u00228 yr\u0022\u003EMarch 10, 2016\u003C/time\u003E by blackrack**"},{"CreatedByName":"JONYghost","CreatedById":157216,"CreatedDateTime":"2016-03-10T21:18:38Z","Content":"I have rough vissual bugs when in landing and landed on Duna. Is this gonna get fixed? Didn\u0027t happen at mid february, can\u0027t say exact version, but before the sun got changed."},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2016-03-10T21:24:42Z","Content":"\u003E \n\u003E \n\u003E 5 minutes ago, JONYghost said:\n\u003E \n\u003E \n\u003E I have rough vissual bugs when in landing and landed on Duna. Is this gonna get fixed? Didn\u0027t happen at mid february, can\u0027t say exact version, but before the sun got changed.\n\u003E \n\nPost screenshots of issue. And Duna in general is full of artifacts as it\u0027s scale doesn\u0027t work well with the scattering so I can\u0027t say for sure if it will be fixed."},{"CreatedByName":"JONYghost","CreatedById":157216,"CreatedDateTime":"2016-03-10T21:26:53Z","Content":"\u003E \n\u003E \n\u003E 2 minutes ago, blackrack said:\n\u003E \n\u003E \n\u003E Post screenshots of issue. And Duna in general is full of artifacts as it\u0027s scale doesn\u0027t work well with the scattering so I can\u0027t say for sure if it will be fixed.\n\u003E \n\nJust posted it on SVE, but here you have those pics: [https://www.dropbox.com/sh/5k0mp8p7x5hcngm/AABmQUPFQkNx35czkJGEpCKza?dl=0](https://www.dropbox.com/sh/5k0mp8p7x5hcngm/AABmQUPFQkNx35czkJGEpCKza?dl=0)\n\nthey start around 90km and intensify during landing and landed\n\n**Edited \u003Ctime datetime=\u00222016-03-10T21:27:10Z\u0022 title=\u002203/10/2016 09:27  PM\u0022 data-short=\u00228 yr\u0022\u003EMarch 10, 2016\u003C/time\u003E by JONYghost**"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2016-03-10T21:28:49Z","Content":"\u003E \n\u003E \n\u003E 2 minutes ago, JONYghost said:\n\u003E \n\u003E \n\u003E Just post it on SVE, but here you have those pics: [https://www.dropbox.com/sh/5k0mp8p7x5hcngm/AABmQUPFQkNx35czkJGEpCKza?dl=0](https://www.dropbox.com/sh/5k0mp8p7x5hcngm/AABmQUPFQkNx35czkJGEpCKza?dl=0)\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E they start around 90km and intensify during landing and landed\n\u003E \n\nHave you tried disabling terrain shadows? Also, test if it happens with scatterer only.\n\n**Edited \u003Ctime datetime=\u00222016-03-10T21:29:46Z\u0022 title=\u002203/10/2016 09:29  PM\u0022 data-short=\u00228 yr\u0022\u003EMarch 10, 2016\u003C/time\u003E by blackrack**"},{"CreatedByName":"JONYghost","CreatedById":157216,"CreatedDateTime":"2016-03-10T21:30:09Z","Content":"\u003E \n\u003E \n\u003E 1 minute ago, blackrack said:\n\u003E \n\u003E \n\u003E Have you tried disabling terrain shadows?\n\u003E \n\nI think I did it this afternoon or at least think I did, I\u0027m running a quick check give me 1 min \n\n**Edited \u003Ctime datetime=\u00222016-03-10T21:30:36Z\u0022 title=\u002203/10/2016 09:30  PM\u0022 data-short=\u00228 yr\u0022\u003EMarch 10, 2016\u003C/time\u003E by JONYghost**"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2016-03-10T21:35:22Z","Content":"\u003E \n\u003E \n\u003E 4 minutes ago, JONYghost said:\n\u003E \n\u003E \n\u003E I think I did it this afternoon or at least think I did, I\u0027m running a quick check give me 1 min\n\u003E \n\nAlright, test withotu any other mods also."},{"CreatedByName":"JONYghost","CreatedById":157216,"CreatedDateTime":"2016-03-10T21:40:07Z","Content":"\u003E \n\u003E \n\u003E 4 minutes ago, JONYghost said:\n\u003E \n\u003E \n\u003E \u003E \n\u003E \u003E \n\u003E \u003E 5 minutes ago, blackrack said:\n\u003E \u003E \n\u003E \u003E \n\u003E \u003E Have you tried disabling terrain shadows?\n\u003E \u003E \n\u003E \n\u003E \n\u003E \n\u003E \n\u003E Okay they are gone, sadly removing your awsome shadow effects... but It\u0027s fixed for now. \n\u003E \n\u003E \n\u003E \n\u003E \n\u003E Pd: do you know why clouds from SVE go off when between 60 and 170 km?\n\u003E \n\n\u003E \n\u003E \n\u003E 11 minutes ago, blackrack said:\n\u003E \n\u003E \n\u003E Have you tried disabling terrain shadows? Also, test if it happens with scatterer only.\n\u003E \n\nYeah I took scatterer before, and It went off and with old stock textures. Disabling shadows worked fine, I miss those great effects you make, but It fixes the problem thank you. Hope you find a way around it ![;)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif \u0022;)\u0022)"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2016-03-10T21:42:36Z","Content":"\u003E \n\u003E \n\u003E Just now, JONYghost said:\n\u003E \n\u003E \n\u003E Okay they are gone, sadly removing your awsome shadow effects... but It\u0027s fixed for now. \n\u003E \n\u003E \n\u003E \n\u003E \n\u003E Pd: do you know why clouds from SVE go off when between 60 and 170 km\n\u003E \n\nI think if you force directx11 you can enable terrain shadows and get rid of the artifacts, try it.\n\nFor the clouds if it\u0027s the same issue rbray just talked about just wait for an update from EVE, or go into map view and orient the camera to look in roughly the same direction as your ship then quit map view."},{"CreatedByName":"JONYghost","CreatedById":157216,"CreatedDateTime":"2016-03-10T21:47:23Z","Content":"\u003E \n\u003E \n\u003E 3 minutes ago, blackrack said:\n\u003E \n\u003E \n\u003E I think if you force directx11 you can enable terrain shadows and get rid of the artifacts, try it.\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E For the clouds if it\u0027s the same issue rbray just talked about just wait for an update from EVE, or go into map view and orient the camera to look in roughly the same direction as your ship then quit map view.\n\u003E \n\nSorry, I don\u0027t know how to do it ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif \u0022:)\u0022) but if you tell me  how to, I\u0027ll do it just now"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2016-03-10T21:55:42Z","Content":"\u003E \n\u003E \n\u003E 8 minutes ago, JONYghost said:\n\u003E \n\u003E \n\u003E Sorry, I don\u0027t know how to do it ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif \u0022:)\u0022) but if you tell me  how to, I\u0027ll do it just now\n\u003E \n\n[http://forum.kerbalspaceprogram.com/index.php?/topic/95837-forcing-directx11-40-memory-reduction/](https://forum.kerbalspaceprogram.com/index.php?/topic/95837-forcing-directx11-40-memory-reduction/)"},{"CreatedByName":"JONYghost","CreatedById":157216,"CreatedDateTime":"2016-03-10T21:56:43Z","Content":"\u003E \n\u003E \n\u003E Just now, blackrack said:\n\u003E \n\u003E \n\u003E [http://forum.kerbalspaceprogram.com/index.php?/topic/95837-forcing-directx11-40-memory-reduction/](https://forum.kerbalspaceprogram.com/index.php?/topic/95837-forcing-directx11-40-memory-reduction/)\n\u003E \n\nThanks, I get on it. Sadly the glitch to get the clouds does not work, at least for me."},{"CreatedByName":"JONYghost","CreatedById":157216,"CreatedDateTime":"2016-03-10T22:05:03Z","Content":"\u003E \n\u003E \n\u003E 4 minutes ago, blackrack said:\n\u003E \n\u003E \n\u003E [http://forum.kerbalspaceprogram.com/index.php?/topic/95837-forcing-directx11-40-memory-reduction/](https://forum.kerbalspaceprogram.com/index.php?/topic/95837-forcing-directx11-40-memory-reduction/)\n\u003E \n\nI\u0027ve been doing research on it and I think I will survive without shaders. I have a pretty decent gaming laptop i7 4720 HQ 16gb ram and an nvidia 860m with 4gb dedicated ram. I will just wait for ksp to use Unity 5, but thanks for all. Reason behind this decision is, I don\u0027t want to risk data or hardware, for visual improvements; thus, I\u0027ll keep you posted if during new versions, this bug disappears."},{"CreatedByName":"stratochief66","CreatedById":59541,"CreatedDateTime":"2016-03-11T13:32:38Z","Content":"RSS looked super-borked with the most recent update of Scatterer. The sun flares didn\u0027t show from the ground or in orbit, and the scatterer atmo effect disappeared once I entered SS. Which is to say, the scatterer effect does still appear from the ground."},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2016-03-11T13:57:56Z","Content":"\u003E \n\u003E \n\u003E 25 minutes ago, stratochief66 said:\n\u003E \n\u003E \n\u003E RSS looked super-borked with the most recent update of Scatterer. The sun flares didn\u0027t show from the ground or in orbit, and the scatterer atmo effect disappeared once I entered SS. Which is to say, the scatterer effect does still appear from the ground.\n\u003E \n\nMake a detailed report and include screenshots."}]}