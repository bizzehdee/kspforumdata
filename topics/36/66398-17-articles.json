{"TopicId":66398,"ForumId":36,"TopicTitle":"[WIP] Loading textures only as required","CreatedByName":"Faark","CreatedById":69775,"CreatedDateTime":"2014-03-21T14:47:56Z","PageNum":17,"Articles":[{"CreatedByName":"Faark","CreatedById":69775,"CreatedDateTime":"2014-06-01T19:20:48Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022SpacedInvader\u0022 data-cite=\u0022SpacedInvader\u0022\u003E\u003Cdiv\u003EThis version seems to use much more memory while in play. A rocket that used to have a working memory of about 2.8gb on the pad now uses about 3.3gb with a commit of 3.4gb. It is fairly complex with about 110 parts, but this could mean trouble for complex structures like stations.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EOkay, i spend way to much time today testing with a 85 and 250 [lod-]textures launch pad scenario. \u003C/p\u003E\u003Cblockquote\u003E\u003Cp\u003EV SpaceCenter LaunchPad (WorkingSet/Commit)\u003C/p\u003E\u003Cp\u003E84tex\u003C/p\u003E\u003Cp\u003Ev3 1g121/1g267 1g450/1g665\u003C/p\u003E\u003Cp\u003Ev2 1g140/1g215 1g500/1g600\u003C/p\u003E\u003Cp\u003Ev3 1g155/1g272 1g450/1g680\u003C/p\u003E\u003Cp\u003Ev2 1g141/1g220 1g500/1g592\u003C/p\u003E\u003Cp\u003E250tex\u003C/p\u003E\u003Cp\u003Ev2 1g154/1g226 1g757/1g842\u003C/p\u003E\u003Cp\u003Ev3 1g144/1g267 1g783/1g914\u003C/p\u003E\u003Cp\u003Ev2 1g154/1g234 1g737/1g841\u003C/p\u003E\u003Cp\u003Ev3 1g155/1g279 1g800/1g942\u003C/p\u003E\u003Cp\u003Ev3 1g156/1g271 1g773/1g972(f)\u003C/p\u003E\u003Cp\u003Ev3 1g155/1g268 1g790/1g890(n)\u003C/p\u003E\u003Cp\u003Ev3 1g151/1g261 1g855/1g950(f)\u003C/p\u003E\u003Cp\u003Ev3 1g149/1g270 1g780/1g908(n)\u003C/p\u003E\u003Cp\u003Ev3 1g016/1g268 1g660/1g892(n)\u003C/p\u003E\u003Cp\u003Ev3 1g157/1g269 1g941/2g036(f)\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/blockquote\u003E\u003Cp\u003E are as expected v3 required about ~60-80mb in total. Measuring it is kinda complicated, since everything can have an impact. For example an focused app during SC=\u0026gt;LaunchPad had 40-150mb more memory committed. But stuff like that is in the nature of multi-threaded applications. I cannot reproduce such a significant increase in memory usage.\u003C/p\u003E\u003Cp\u003EThere are some fixes that might relate to your issue. I changed some handling in case there were 2 similar named files with different extensions. Do you have stuff like that in your GameData? Did the amount of textures changed between version in the first place? (You can re-enable the debug UI via cfg)\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022smart013\u0022 data-cite=\u0022smart013\u0022\u003E\u003Cdiv\u003E[..]\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ESo far this kind of errors was always caused by a missing dependency, so please try to re-install all dependencies listed in the first post, including DirectX. Btw: nvd3dum.dll is the file used by KSP, not the one required for LOD.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Badabooooom\u0022 data-cite=\u0022Badabooooom\u0022\u003E\u003Cdiv\u003EI did run some test with ATM 3-1 and Loading on Demand 2.2. It seems like that LoD is not loading ATM\u0027s textures properly (easily to see when ATM is running in aggressive mode). Instead of using ATM\u0027s textures, it is loading textures directly from mod\u0027s resources.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThats exactly what LOD is supposed to do. It currently does not offer any kind of \u0022low-res\u0022 textures and i hope this will never be necessary (apart from DXT compression, what will be one of the next features and should help a lot). LOD tries to always have enough memory available by not loading textures unless they are required, but itself requires logic to know when those textures are required. It currently only has those logic for part textures. ATM instead just scales down textures, thus is a perfect to handle textures LOD can\u0027t.\u003C/p\u003E\u003Cp\u003EHelp would be appreciated, ofc!\u003C/p\u003E\n"},{"CreatedByName":"Alewx","CreatedById":102791,"CreatedDateTime":"2014-06-01T19:35:20Z","Content":"\n\u003Cp\u003ESince the mipmap disabling in TR, I can have mutliple launches and revertings to the VAB, depending on the part count, 4-5 times till it crashes with oom exception. So I can\u0027t report any problems from this weekend.\u003C/p\u003E\n"},{"CreatedByName":"smart013","CreatedById":106088,"CreatedDateTime":"2014-06-01T21:16:43Z","Content":"\n\u003Cp\u003EWhoa!\u003C/p\u003E\u003Cp\u003EOk, you were right, there *was* a error on my side, and now everything seems to run just fine. And fast!\u003C/p\u003E\u003Cp\u003EGreat mod, really hoping you keep up the fantastic work.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-06-01T21:19:41Z\u0022 title=\u002206/01/2014 09:19  PM\u0022 data-short=\u002210 yr\u0022\u003EJune 1, 2014\u003C/time\u003E by smart013\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"SpacedInvader","CreatedById":106018,"CreatedDateTime":"2014-06-02T00:16:51Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Faark\u0022 data-cite=\u0022Faark\u0022\u003E\u003Cdiv\u003EOkay, i spend way to much time today testing with a 85 and 250 [lod-]textures launch pad scenario. \u003Cp\u003EThere are some fixes that might relate to your issue. I changed some handling in case there were 2 similar named files with different extensions. Do you have stuff like that in your GameData? Did the amount of textures changed between version in the first place? (You can re-enable the debug UI via cfg)\u003C/p\u003E\u003C/div\u003E\u003Cblockquote\u003E\u003Cdiv\u003EV SpaceCenter LaunchPad (WorkingSet/Commit)\u003C/div\u003E\u003Cp\u003E84tex\u003C/p\u003E\u003Cp\u003Ev3 1g121/1g267 1g450/1g665\u003C/p\u003E\u003Cp\u003Ev2 1g140/1g215 1g500/1g600\u003C/p\u003E\u003Cp\u003Ev3 1g155/1g272 1g450/1g680\u003C/p\u003E\u003Cp\u003Ev2 1g141/1g220 1g500/1g592\u003C/p\u003E\u003Cp\u003E250tex\u003C/p\u003E\u003Cp\u003Ev2 1g154/1g226 1g757/1g842\u003C/p\u003E\u003Cp\u003Ev3 1g144/1g267 1g783/1g914\u003C/p\u003E\u003Cp\u003Ev2 1g154/1g234 1g737/1g841\u003C/p\u003E\u003Cp\u003Ev3 1g155/1g279 1g800/1g942\u003C/p\u003E\u003Cp\u003Ev3 1g156/1g271 1g773/1g972(f)\u003C/p\u003E\u003Cp\u003Ev3 1g155/1g268 1g790/1g890(n)\u003C/p\u003E\u003Cp\u003Ev3 1g151/1g261 1g855/1g950(f)\u003C/p\u003E\u003Cp\u003Ev3 1g149/1g270 1g780/1g908(n)\u003C/p\u003E\u003Cp\u003Ev3 1g016/1g268 1g660/1g892(n)\u003C/p\u003E\u003Cp\u003Ev3 1g157/1g269 1g941/2g036(f)\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/blockquote\u003E\u003Cp\u003E are as expected v3 required about ~60-80mb in total. Measuring it is kinda complicated, since everything can have an impact. For example an focused app during SC=\u0026gt;LaunchPad had 40-150mb more memory committed. But stuff like that is in the nature of multi-threaded applications. I cannot reproduce such a significant increase in memory usage.\u003C/p\u003E\u003C/blockquote\u003E\u003Cp\u003EI will spend time looking through my gamedata folder to see if any mods have left similarly named files like that sitting around. That being said, I\u0027m a little confused by your numbers. It looks to me like you\u0027re getting the same 400-600 MB jump in memory usage that I am experiencing, except you\u0027re getting it for both V2 and V3, where I am only getting it with V3. Perhaps the issue is that I was getting better usage stats with the previous version through some quirk of my install?\u003C/p\u003E\u003Cp\u003EEDIT: Is it possible that the extra texture memory might be at least slightly additive when you have more textures? I\u0027ve been testing (unscientifically) what happens when I reduce the overall number of textures and the results seem to show that being the case, at least to a small degree. I had about 2200 textures, which would have me load into the VAB at the aforementioned 3.3GB, then I tried removing a few hundred textures, which resulted in the same ship loading at about 3.15GB without losing any of its textures.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-06-02T00:24:39Z\u0022 title=\u002206/02/2014 12:24  AM\u0022 data-short=\u002210 yr\u0022\u003EJune 2, 2014\u003C/time\u003E by SpacedInvader\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Alewx","CreatedById":102791,"CreatedDateTime":"2014-06-02T00:44:02Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022SpacedInvader\u0022 data-cite=\u0022SpacedInvader\u0022\u003E\u003Cdiv\u003EI will spend time looking through my gamedata folder to see if any mods have left similarly named files like that sitting around. That being said, I\u0027m a little confused by your numbers. It looks to me like you\u0027re getting the same 400-600 MB jump in memory usage that I am experiencing, except you\u0027re getting it for both V2 and V3, where I am only getting it with V3. Perhaps the issue is that I was getting better usage stats with the previous version through some quirk of my install?\u003Cp\u003EEDIT: Is it possible that the extra texture memory might be at least slightly additive when you have more textures? I\u0027ve been testing (unscientifically) what happens when I reduce the overall number of textures and the results seem to show that being the case, at least to a small degree. I had about 2200 textures, which would have me load into the VAB at the aforementioned 3.3GB, then I tried removing a few hundred textures, which resulted in the same ship loading at about 3.15GB without losing any of its textures.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EHere I can confirm similar behaviour with entering the VAB, now as I got my first welded parts. I have almost the same load in memory but I have currently only 1012 textures handled by LoD.\u003C/p\u003E\u003Cp\u003E@SpaceInvader: How big is your persistant save file that you use for testing? Mine is something around 9mb; 145 debris, 1 Station, 1 ship, around 20 landing flags and about 15 sattelites.\u003C/p\u003E\n"},{"CreatedByName":"SpacedInvader","CreatedById":106018,"CreatedDateTime":"2014-06-02T01:32:43Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Alewx\u0022 data-cite=\u0022Alewx\u0022\u003E\u003Cdiv\u003EHere I can confirm similar behaviour with entering the VAB, now as I got my first welded parts. I have almost the same load in memory but I have currently only 1012 textures handled by LoD.\u003Cp\u003E@SpaceInvader: How big is your persistant save file that you use for testing? Mine is something around 9mb; 145 debris, 1 Station, 1 ship, around 20 landing flags and about 15 sattelites.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYou\u0027re confirming the possible additive memory, or the large-ish increase in memory going from VAB to pad? Sorry, just want to be sure of what you\u0027re saying here. Also, my persistent save is much smaller at about 1.4MB.\u003C/p\u003E\n"},{"CreatedByName":"Alewx","CreatedById":102791,"CreatedDateTime":"2014-06-02T07:43:36Z","Content":"\n\u003Cp\u003EMy average memory useage with VAB entering from fresh gamestart is 2.8GB and then going to launchpad it is 3.1GB, it only gets changed a little depending on the complexity of the craft.\u003C/p\u003E\u003Cp\u003EBut as I have only half the number of textures from you, I assume that the memory is used by something else and not by textures otherwise my numbers would have to be much lower than yours.\u003C/p\u003E\n"},{"CreatedByName":"Badabooooom","CreatedById":112049,"CreatedDateTime":"2014-06-02T09:19:54Z","Content":"\n\u003Cp\u003ESomething is going wrong with TGA images:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E2.6.2014 11:18:48: Loaded Texture 534, informing KSP runtme\u003Cbr\u003E2.6.2014 11:18:48: Unhandled exception!\u003Cbr\u003E2.6.2014 11:18:49: System.Exception: Failed to load TGA file: C:\\Kerbal\\Game\\GameData\\ProceduralFairings\\thrustPlate1.tga ---\u0026gt; System.ArgumentException: Virheellinen parametri. (Invalid Argument)\u003Cbr\u003E   kohteessa System.Drawing.Image.get_RawFormat()\u003Cbr\u003E   kohteessa System.Drawing.Graphics.DrawImage(Image image, Int32 x, Int32 y, Int32 width, Int32 height)\u003Cbr\u003E   kohteessa System.Drawing.Bitmap..ctor(Image original, Int32 width, Int32 height)\u003Cbr\u003E   kohteessa System.Drawing.Bitmap..ctor(Image original)\u003Cbr\u003E   kohteessa FormatDatabase.RecognizeTGA(FileInfo file, Byte[] data)\u003Cbr\u003E   --- Sis\u00C3\u0192\u00C2\u00A4isen poikkeuksen pinon j\u00C3\u0192\u00C2\u00A4ljityksen loppu ---\u003Cbr\u003E   kohteessa FormatDatabase.RecognizeTGA(FileInfo file, Byte[] data)\u003Cbr\u003E   kohteessa FormatDatabase.AddRecognitionScope\u00601.Recognize(FileInfo file, Byte[] bytes)\u003Cbr\u003E   kohteessa FormatDatabase.Recognize(String file, Byte[] data)\u003Cbr\u003E   kohteessa TextureManager.StartLoadHighResTextureScope.ProcessLoadedData(Byte[] loaded_data)\u003Cbr\u003E   kohteessa Disk.RequestFileScope.RunProcessor()\u003Cbr\u003E   kohteessa Work.WorkThread()\u003Cbr\u003E   kohteessa System.Threading.ThreadHelper.ThreadStart_Context(Object state)\u003Cbr\u003E   kohteessa System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state, Boolean preserveSyncCtx)\u003Cbr\u003E   kohteessa System.Threading.ExecutionContext.Run(ExecutionContext executionContext, ContextCallback callback, Object state, Boolean preserveSyncCtx)\u003Cbr\u003E   kohteessa System.Threading.ExecutionContext.Run(ExecutionContext executionContext, ContextCallback callback, Object state)\u003Cbr\u003E   kohteessa System.Threading.ThreadHelper.ThreadStart()\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EThis doesn\u0027t seems to happen always. After quickly looking code, it seems like that static LoadTargaImage method is called in TargaImage.h during FormatDatabase.RecognizeTGA methods execution (LoadTargaImage is inlined - so it is not visible in stacktrace). LoadTargaImage seems to construct first it\u0027s own targa image object and then gives this image object for Syste.Drawing Bitmap constructor, which should create a new bitmap object. According this \u003Ca href=\u0022http://stackoverflow.com/questions/629955/parameter-not-valid-exception-loading-system-drawing-image\u0022 rel=\u0022external nofollow\u0022\u003Estack overflow discussion\u003C/a\u003E, it is likely that targa image is invalid somehow.\u003C/p\u003E\n"},{"CreatedByName":"Subcidal","CreatedById":20751,"CreatedDateTime":"2014-06-02T23:36:11Z","Content":"\n\u003Cp\u003ETrying this mod again seeing it\u0027s been updated a few times now. I keep crashing on the last loading screen before the main menu, I\u0027m unsure why. I\u0027ve disabled TR\u0027s mipmap and compression options, Not sure what else it could be. I have a pretty heavily modded game, So i\u0027m unsure as to where to start. And the varying amount of crash reports in this thread isn\u0027t helping me pinpoint it much either.\u003C/p\u003E\u003Cp\u003EAnybody have any insight? Would love to use LoD, Starting to become essential at this point. Everytime I make a long flight to the tundra (Using RSS) I usually crash when i come down to land =( hour long flights down the drain, hard to deal with.\u003C/p\u003E\u003Cp\u003ECrash logs::\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022https://www./?x8rd1d1i818218r\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://www./?x8rd1d1i818218r\u003C/a\u003E\u003C/p\u003E\n"},{"CreatedByName":"BananaDealer","CreatedById":60684,"CreatedDateTime":"2014-06-03T00:21:15Z","Content":"\n\u003Cp\u003EOooh... New version!\u003C/p\u003E\u003Cp\u003EEdit: Just wanna say- the info thing got gone when I updated to LoDv3. Also some parts aren\u0027t getting their textures loaded properly. Some are high-res, others would be as if you\u0027re loading with quarter/eight-res on. That\u0027s after the thing\u0027s supposedly done preparing...\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-06-03T00:49:23Z\u0022 title=\u002206/03/2014 12:49  AM\u0022 data-short=\u002210 yr\u0022\u003EJune 3, 2014\u003C/time\u003E by BananaDealer\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"SpacedInvader","CreatedById":106018,"CreatedDateTime":"2014-06-03T08:02:45Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Alewx\u0022 data-cite=\u0022Alewx\u0022\u003E\u003Cdiv\u003EMy average memory useage with VAB entering from fresh gamestart is 2.8GB and then going to launchpad it is 3.1GB, it only gets changed a little depending on the complexity of the craft.\u003Cp\u003EBut as I have only half the number of textures from you, I assume that the memory is used by something else and not by textures otherwise my numbers would have to be much lower than yours.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EHmm... Now I\u0027m kinda wondering where all of your memory is going if I\u0027ve got twice the textures you\u0027ve got and you\u0027re getting the same memory usage that I\u0027m getting.\u003C/p\u003E\n"},{"CreatedByName":"raxo2222","CreatedById":110750,"CreatedDateTime":"2014-06-03T09:29:58Z","Content":"\n\u003Cp\u003EATM seems to not work at all - I get lag with 300 part ship. Well, Dynamic Time or how its called is set to keep 10 FPS, but time itself slows down to 1/3 or 1/4 of normal. So how I can play at normal speed with 300 part ship?\u003C/p\u003E\u003Cp\u003EAlso it doesn\u0027t let ATM\u0027s compressed textures in.\u003C/p\u003E\u003Cp\u003EOr my computer is too slow for game with 60 mods?\u003C/p\u003E\u003Cp\u003EEdit: Stock settings to reduce texture quality doesn\u0027t work too.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-06-03T09:47:18Z\u0022 title=\u002206/03/2014 09:47  AM\u0022 data-short=\u002210 yr\u0022\u003EJune 3, 2014\u003C/time\u003E by raxo2222\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Alewx","CreatedById":102791,"CreatedDateTime":"2014-06-03T10:42:34Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022SpacedInvader\u0022 data-cite=\u0022SpacedInvader\u0022\u003E\u003Cdiv\u003EHmm... Now I\u0027m kinda wondering where all of your memory is going if I\u0027ve got twice the textures you\u0027ve got and you\u0027re getting the same memory usage that I\u0027m getting.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThat is exactly my question. We should share Mod lists. But I doubt that there will be too much difference.\u003C/p\u003E\u003Cp\u003EWith the latest Universal Storage update, now I have 1015 textures in LoD.\u003C/p\u003E\n"},{"CreatedByName":"Faark","CreatedById":69775,"CreatedDateTime":"2014-06-03T11:43:49Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022BananaDealer\u0022 data-cite=\u0022BananaDealer\u0022\u003E\u003Cdiv\u003EJust wanna say- the info thing got gone when I updated to LoDv3. Also some parts aren\u0027t getting their textures loaded properly. Some are high-res, others would be as if you\u0027re loading with quarter/eight-res on. That\u0027s after the thing\u0027s supposedly done preparing...\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EDebug UI is intentionally gone, you can re-enable it via the cfg. Details about the other issues incl instructions on how to reproduce it would be nice. Please also try to delete the old LOD directory and report whether this makes any difference.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Subcidal\u0022 data-cite=\u0022Subcidal\u0022\u003E\u003Cdiv\u003ECrash logs::\u003Cp\u003E\u003Ca href=\u0022https://www./?x8rd1d1i818218r\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://www./?x8rd1d1i818218r\u003C/a\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThere is definitively some mod modifying LOD textures, either an old ATM version or there might be other TR configs that re-enable this.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Badabooooom\u0022 data-cite=\u0022Badabooooom\u0022\u003E\u003Cdiv\u003ESomething is going wrong with TGA images:\u003Cp\u003E[..]\u003C/p\u003E\u003Cp\u003EThis doesn\u0027t seems to happen always. After quickly looking code, it seems like that static LoadTargaImage method is called in TargaImage.h during FormatDatabase.RecognizeTGA methods execution (LoadTargaImage is inlined - so it is not visible in stacktrace). LoadTargaImage seems to construct first it\u0027s own targa image object and then gives this image object for Syste.Drawing Bitmap constructor, which should create a new bitmap object. According this \u003Ca href=\u0022http://stackoverflow.com/questions/629955/parameter-not-valid-exception-loading-system-drawing-image\u0022 rel=\u0022external nofollow\u0022\u003Estack overflow discussion\u003C/a\u003E, it is likely that targa image is invalid somehow.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI had quite a few \u0022Parameter not valid\u0022 exceptions in situations where the game was running out of memory, even though it should give an OutOfMemoryException. Have you verified that this wasn\u0027t the cause? Since so far i couldn\u0027t reproduce this kind of error any other way.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022SpacedInvader\u0022 data-cite=\u0022SpacedInvader\u0022\u003E\u003Cdiv\u003EHmm... Now I\u0027m kinda wondering where all of your memory is going if I\u0027ve got twice the textures you\u0027ve got and you\u0027re getting the same memory usage that I\u0027m getting.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI guess the diff are textures that are handled by LOD and not loaded, thus don\u0027t require any memory.\u003C/p\u003E\n"},{"CreatedByName":"BananaDealer","CreatedById":60684,"CreatedDateTime":"2014-06-03T12:31:09Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Faark\u0022 data-cite=\u0022Faark\u0022\u003E\u003Cdiv\u003EDebug UI is intentionally gone, you can re-enable it via the cfg. Details about the other issues incl instructions on how to reproduce it would be nice. Please also try to delete the old LOD directory and report whether this makes any difference.\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI\u0027m not sure how to replicate it... Got about 2170 textures so maybe that\u0027s the \u0022issue\u0022. It just happens on part by part basis. Sometimes it\u0027s even only parts of a part\u0027s texture being lower res, like say with SumGhai\u0027s parachute-sporting clamp-o-tron. The parachute on the outside is high-res, while the clamp-o-tron is lower res.\u003C/p\u003E\u003Cp\u003EI\u0027ll provide pictures as soon as the bug shows up again...\u003C/p\u003E\n"},{"CreatedByName":"Senshi","CreatedById":57692,"CreatedDateTime":"2014-06-03T15:17:39Z","Content":"\n\u003Cp\u003EWe really need a KSP Memory Profiler, telling us which part/model/teture hogs how much memory...I only have 1029 textures, all cramped and compressed with ATM and at 1/4 resolution...starts with 3.0GB memory on the launchpad, then slowly creeps up to the inevitable 3.6GB crash about 30-45min later...\u003C/p\u003E\n"},{"CreatedByName":"BananaDealer","CreatedById":60684,"CreatedDateTime":"2014-06-03T15:35:52Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Senshi\u0022 data-cite=\u0022Senshi\u0022\u003E\u003Cdiv\u003EWe really need a KSP Memory Profiler, telling us which part/model/teture hogs how much memory...I only have 1029 textures, all cramped and compressed with ATM and at 1/4 resolution...starts with 3.0GB memory on the launchpad, then slowly creeps up to the inevitable 3.6GB crash about 30-45min later...\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYou might want to consider this mod then... Also perhaps switching to aggressive ATM, if you haven\u0027t already...\u003C/p\u003E\n"},{"CreatedByName":"Badabooooom","CreatedById":112049,"CreatedDateTime":"2014-06-03T16:55:26Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Faark\u0022 data-cite=\u0022Faark\u0022\u003E\u003Cdiv\u003E\u003Cp\u003EI had quite a few \u0022Parameter not valid\u0022 exceptions in situations where the game was running out of memory, even though it should give an OutOfMemoryException. Have you verified that this wasn\u0027t the cause? Since so far i couldn\u0027t reproduce this kind of error any other way.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ETrue. I did try demo from \u003Ca href=\u0022http://www.codeproject.com/Articles/31702/NET-Targa-Image-Reader\u0022 rel=\u0022external nofollow\u0022\u003ETarga Image Reader\u003C/a\u003E that you are using in your code - it managed to read TGA without any problems. So - at least it is not Targa Image Reader\u0027s fault. Going to try some texture reduction packs and see is that going to help - or maybe I will write own tool that allows to select what textuers are going to reduced (ATM is not going to fix problem, because I want to use LoD).\u003C/p\u003E\n"},{"CreatedByName":"dRuPpI","CreatedById":97229,"CreatedDateTime":"2014-06-03T18:31:03Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022raxo2222\u0022 data-cite=\u0022raxo2222\u0022\u003E\u003Cdiv\u003EATM seems to not work at all - I get lag with 300 part ship. Well, Dynamic Time or how its called is set to keep 10 FPS, but time itself slows down to 1/3 or 1/4 of normal. So how I can play at normal speed with 300 part ship?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003Ethat\u0027s normal and has nothing to do with LOD you need 6 GHZ CPU to play a 300 Part ship with out getting a yellow timer \u003C/p\u003E\u003Cp\u003ENote: if you use more Mods (Plugins) the performance of KSP goes down and down and down.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022raxo2222\u0022 data-cite=\u0022raxo2222\u0022\u003E\u003Cdiv\u003EWell, Dynamic Time or how its called is set to keep 10 FPS, but time itself slows down to 1/3 or 1/4 of normal. So how I can play at normal speed with 300 part ship?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThat\u0027s what Time Control do is slows down time to keep FPS\u003C/p\u003E\n"},{"CreatedByName":"BananaDealer","CreatedById":60684,"CreatedDateTime":"2014-06-03T18:55:43Z","Content":"\n\u003Cp\u003EMore on the bug front. Pictures:\u003C/p\u003E\u003Cblockquote lang=\u0022en\u0022\u003E\u003Ca href=\u0022//imgur.com/a/oILXL\u0022 rel=\u0022external nofollow\u0022\u003EJavascript is disabled. View full album\u003C/a\u003E\u003C/blockquote\u003E\u003Cp\u003EIn the first and second pictures, the KSO docking ports were loaded at a lower resolution than the rest of the parts (game\u0027s set to load Half-Res at 8xAA). Same can be said for the battery packs on the left and the Stretchy Tank and KW engine in the third image. The Procedural Fairing base also experiences the same issue.\u003C/p\u003E\n"},{"CreatedByName":"raxo2222","CreatedById":110750,"CreatedDateTime":"2014-06-03T19:22:12Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022dRuPpI\u0022 data-cite=\u0022dRuPpI\u0022\u003E\u003Cdiv\u003Ethat\u0027s normal and has nothing to do with LOD you need 6 GHZ CPU to play a 300 Part ship with out getting a yellow timer \u003Cp\u003ENote: if you use more Mods (Plugins) the performance of KSP goes down and down and down.\u003C/p\u003E\u003Cp\u003EThat\u0027s what Time Control do is slows down time to keep FPS\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ESo lowering resolution of textures won\u0027t help? Well, so I have to play in slow motion, when my lander is docked to rest of ship.\u003C/p\u003E\u003Cp\u003EI thought it was GPU having too much stuff in its hand o.o\u003C/p\u003E\u003Cp\u003EEDIT: So I guess I will be using MechJeb for navigation \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 alt=\u0022:D\u0022\u003E\u003C/p\u003E\u003Cp\u003EAlso my lander itself has 150 parts or so and works fine alone - no slow motion.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-06-03T19:31:06Z\u0022 title=\u002206/03/2014 07:31  PM\u0022 data-short=\u002210 yr\u0022\u003EJune 3, 2014\u003C/time\u003E by raxo2222\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"frash23","CreatedById":69988,"CreatedDateTime":"2014-06-03T19:58:29Z","Content":"\n\u003Cp\u003EDo you think an openGL port possible?\u003C/p\u003E\u003Cp\u003EI\u0027m not asking for it right now, just if possible :b\u003C/p\u003E\n"},{"CreatedByName":"Alewx","CreatedById":102791,"CreatedDateTime":"2014-06-03T20:05:13Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022frash23\u0022 data-cite=\u0022frash23\u0022\u003E\u003Cdiv\u003EDo you think an openGL port possible?\u003Cp\u003EI\u0027m not asking for it right now, just if possible :b\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI think not as it sounds like Fraak wrote it do directly interact with the DX compnents to do his magic. So it\u0027s win-exclusive currently, maybe in a distant future it might be possible. But that is just me, damn win 7 user \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 alt=\u0022:D\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"SpacedInvader","CreatedById":106018,"CreatedDateTime":"2014-06-03T23:55:43Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Alewx\u0022 data-cite=\u0022Alewx\u0022\u003E\u003Cdiv\u003EThat is exactly my question. We should share Mod lists. But I doubt that there will be too much difference.\u003Cp\u003EWith the latest Universal Storage update, now I have 1015 textures in LoD.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EIs there a program or mod that allows you to easily generate a mod list? I do have 80ish mods and I\u0027m not really that interested in writing them all out...\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Faark\u0022 data-cite=\u0022Faark\u0022\u003E\u003Cdiv\u003EI guess the diff are textures that are handled by LOD and not loaded, thus don\u0027t require any memory.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EDoes LOD handle MBM files at all? I\u0027ve noticed several of my largest part mods are mostly MBM and removing them from the game can free up hundreds of MB of memory still, even with LOD \u002B ATM installed, so I\u0027m wondering if this might be where all the extra memory is being eaten up?\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Senshi\u0022 data-cite=\u0022Senshi\u0022\u003E\u003Cdiv\u003EWe really need a KSP Memory Profiler, telling us which part/model/teture hogs how much memory...I only have 1029 textures, all cramped and compressed with ATM and at 1/4 resolution...starts with 3.0GB memory on the launchpad, then slowly creeps up to the inevitable 3.6GB crash about 30-45min later...\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI think this is the next question we need to solve. This mod has allowed most of us to install way more mods than would previously have been possible by cutting out most of the texture memory (I know for a fact that I don\u0027t even get to the main menu without it with my current setup), but now we\u0027re left with the question of where all that memory is still being used. It\u0027s pretty clear that its something that we all have in common, or at least in similar, as a load of 2.8 - 3.0 GB with an increase moving into play mode seems very common.\u003C/p\u003E\n"},{"CreatedByName":"Faark","CreatedById":69775,"CreatedDateTime":"2014-06-04T01:41:46Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Badabooooom\u0022 data-cite=\u0022Badabooooom\u0022\u003E\u003Cdiv\u003EGoing to try some texture reduction packs and see is that going to help - or maybe I will write own tool that allows to select what textuers are going to reduced (ATM is not going to fix problem, because I want to use LoD).\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYea, that should work for now. But i hope that LoD loading images compressed via DXT will save enough to not having to care about sth like that anymore. If it doesn\u0027t then this project will need some other kind of reduction, ofc.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022BananaDealer\u0022 data-cite=\u0022BananaDealer\u0022\u003E\u003Cdiv\u003EI\u0027m not sure how to replicate it... Got about 2170 textures so maybe that\u0027s the \u0022issue\u0022. It just happens on part by part basis. Sometimes it\u0027s even only parts of a part\u0027s texture being lower res, like say with SumGhai\u0027s parachute-sporting clamp-o-tron. The parachute on the outside is high-res, while the clamp-o-tron is lower res.[..]\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThanks for the report and pics. Especially that \u0022sometimes\u0022 part is worrying. Load requests cannot be \u0022dropped\u0022 or sth like that, at least not without leaving those x/y status screen open forever. Is there any interesting in the logs? Also it would be interesting whether the necessary textures of those parts are actually referenced at that time according to DebugUI =\u0026gt; Info (that button does write that stuff into the ksp log).\u003C/p\u003E\u003Cp\u003ESo far at least i haven\u0027t experienced anything like that by myself \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_sad.gif\u0022 alt=\u0022:(\u0022\u003E\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022raxo2222\u0022 data-cite=\u0022raxo2222\u0022\u003E\u003Cdiv\u003ESo lowering resolution of textures won\u0027t help?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EIt highly depends on what is slowing down KSP. If its to much stuff to render smaller textures can help, but lots of parts usually mean slow frame rate because of badly scaling physic calculations.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022frash23\u0022 data-cite=\u0022frash23\u0022\u003E\u003Cdiv\u003EDo you think an openGL port possible?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EPossible? Yes. Likely? No, to be honest. For sure not anytime \u0022soon\u0022 (valve time, if you know what i mean), as slow as the project is currently progressing...\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022SpacedInvader\u0022 data-cite=\u0022SpacedInvader\u0022\u003E\u003Cdiv\u003EDoes LOD handle MBM files at all? I\u0027ve noticed several of my largest part mods are mostly MBM and removing them from the game can free up hundreds of MB of memory still, even with LOD \u002B ATM installed, so I\u0027m wondering if this might be where all the extra memory is being eaten up?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYes, MBM is a fully supported image format for this mod, just like TGA or PNG. But LOD can only handle images (of whatever format) that it can associate with a part, so that might be a cause. Images handled by LOD are listed in both the log files and its config.\u003C/p\u003E\u003Cp\u003EBut again the best way to say anything about some issue (or in your case observation) would be to get fool proof instructions on how to reproduce it here, preferably with a near-stock installation. I guess you didn\u0027t just delete some random MBM files?\u003C/p\u003E\n"}]}