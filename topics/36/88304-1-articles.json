{"TopicId":88304,"ForumId":36,"TopicTitle":"Background Processing 0.4.4.0 [KSP 1.1.3]","CreatedByName":"jamespicone","CreatedById":125714,"CreatedDateTime":"2014-10-23T16:45:08Z","PageNum":1,"Articles":[{"CreatedByName":"jamespicone","CreatedById":125714,"CreatedDateTime":"2014-10-23T16:45:08Z","Content":"\n\u003Cp\u003E\nEDIT: Now has a SpaceDock page: \u003Ca href=\u0022http://spacedock.info/mod/288/BackgroundProcessing\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://spacedock.info/mod/288/BackgroundProcessing\u003C/a\u003E. The SpaceDock page is the best source of information on what the mod currently does and how to use it.\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027m working on a little mod/library to make it easier to write PartModules that do something when a vessel is not being actively controlled by the player - say, because they\u0027ve left it landed or orbiting and gone back to the space center, or undocked it, whatever. For an example of mods that currently do something like this, SCANSat\u0027s scanners can continue mapping a planet even when the vessel with the scanners on them is in the background. I\u0027m also intending to fake resource handling for certain resources while vessels are backgrounded - ElectricCharge in particular. Essentially I\u0027m replicating some of the functionality of ASMI\u0027s RealTimeModules with a more convenient license (MIT).\n\u003C/p\u003E\n\u003Cp\u003E\nThe source is \u003Ca href=\u0022https://code.google.com/p/background-processing/source/browse/\u0022 rel=\u0022external nofollow\u0022\u003Ehere\u003C/a\u003E, but keep in mind that this is early days and the mod doesn\u0027t do much of use for players yet, and is only just usable by mod authors for backgrounding. I\u0027m posting here because it has, at least, gotten to the point where as a mod author you could theoretically use it and it would be theoretically useful.\n\u003C/p\u003E\n\u003Cp\u003E\nIt works like this: It creates a MonoBehaviour at startup, BackgroundProcessing.Addon, with a RegisterHandler method, and provides an interface, IBackgroundHandler. PartModules that want background processing should, in their OnAwake method, create a new, static object implementing IBackgroundHandler (that is, there is one IBackgroundHandler per PartModule /type/), and should then call BackgroundProcessing.Addon.Instance.RegisterHandler(). Once again, that\u0027s all in OnAwake - don\u0027t register handlers after that.\n\u003C/p\u003E\n\u003Cp\u003E\nThen, during play, if the background processing library picks up a backgrounded vessel, it calls IBackgroundHandler.FixedBackgroundUpdate() on the appropriate handler for every partmodule in the vessel, passing in a reference to the vessel (which may or may not be all there - be very careful with it. It won\u0027t be null though), and a part flightID which will allow the handler to determine exactly which partmodule it was that needs handling. It\u0027s extremely simple.\n\u003C/p\u003E\n\u003Cp\u003E\nThe next step is to implement some handling for electric charge in the background.\n\u003C/p\u003E\n\u003Cp\u003E\nEDIT: The method mod authors should use to interface with this library/mod has changed. Right now, on startup, the mod checks all PartModules in the system to see whether they have certain methods. If they do, those methods are called at the appropriate times. If you want your PartModule to perform any kind of processing when the Vessel it is on is out of load range, define:\n\u003C/p\u003E\n\u003Cdiv\u003E\n\u00A0\n\u003C/div\u003E\n\u003Cpre class=\u0022ipsCode\u0022\u003E\nclass MyPartModule : PartModule {\n  public static void FixedBackgroundUpdate(Vessel vessel, uint partFlightID);\n}\n\u003C/pre\u003E\n\u003Cp\u003E\nit\u0027ll get called at fixed intervals with the relevant vessel and the partFlightID of the part that owns the module that triggered the background call (so you\u0027ll get multiple calls per vessel if there are multiple PartModules with backgrounding on the same vessel). Think of it as FixedUpdate for when you don\u0027t exist.\n\u003C/p\u003E\n\u003Cp\u003E\nIf your PartModule should produce or consume a resource in the background, or if your mod wants a particular resource handled in the background, you can do that too. Override these methods:\n\u003C/p\u003E\n\u003Cdiv\u003E\n\u00A0\n\u003C/div\u003E\n\u003Cpre class=\u0022ipsCode\u0022\u003E\nclass MyPartModule : PartModule {\n  public static List\u0026lt;string\u0026gt; GetInterestingResources();\n\n  public static int GetBackgroundResourceCount();\n  public static void GetBackgroundResource(int i, out string resourceName, out float rate);\n}\n\u003C/pre\u003E\n\u003Cp\u003E\nGetInterestingResources() should return a List\u0026lt;string\u0026gt; containing the resource name of every resource your PartModule thinks should be handled in the background. ElectricCharge is an interesting resource by default, no others are. For example, a hydrogen ramscoop PartModule that sucks up interstellar hydrogen from a future-tech mod that has a Hydrogen resource might return {\u0022Hydrogen\u0022}.\n\u003C/p\u003E\n\u003Cp\u003E\nGetBackgroundResourceCount() and GetBackgroundResource() form a pair used to indicate that your PartModule produces or consumes a particular resource in the background consistently - either your PartModule is a constant drain or some kind of generator. GetBackgroundResourceCount() should return the number of different resources your PartModule produces in the background, and GetBackgroundResource() should return the resource name and the rate (in units per second) that that resource is produced for the i-th resource your PartModule produces. For example, the hydrogen ramscoop PartModule I just mentioned would look like this:\n\u003C/p\u003E\n\u003Cdiv\u003E\n\u00A0\n\u003C/div\u003E\n\u003Cpre class=\u0022ipsCode\u0022\u003E\npublic static int GetBackgroundResourceCount() {return 1;}\npublic static int GetBackgroundResource(int i, out string resourceName, out float rate) {resourceName = \u0022Hydrogen\u0022; rate = \u00220.001f\u0022;}\n\u003C/pre\u003E\n\u003Cp\u003E\nI\u0027m currently working on providing some methods backgrounded PartModules can use as an analog to RequestResource, so that the ramscoop above could be speed-dependent, for example. Also bugfixes, improving some code, making solar panels behave properly, cleaner timewarp handling, etc. etc.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-08-03T12:57:04Z\u0022 title=\u002208/03/2016 12:57  PM\u0022 data-short=\u00227 yr\u0022\u003EAugust 3, 2016\u003C/time\u003E by jamespicone\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"KAO","CreatedById":30795,"CreatedDateTime":"2014-10-23T20:34:50Z","Content":"\n\u003Cp\u003Edo you think this system will be able to implement orbital decay?\u003C/p\u003E\n"},{"CreatedByName":"duckofthemoon","CreatedById":43214,"CreatedDateTime":"2014-10-24T02:26:31Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022KAO\u0022 data-cite=\u0022KAO\u0022\u003E\u003Cdiv\u003Edo you think this system will be able to implement orbital decay?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EKAO asking the real the real questions.\u003C/p\u003E\n"},{"CreatedByName":"Drew Kerman","CreatedById":103177,"CreatedDateTime":"2014-10-24T02:52:35Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022jamespicone\u0022 data-cite=\u0022jamespicone\u0022\u003E\u003Cdiv\u003EThe next step is to implement some handling for electric charge in the background.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYes! Currently I just test that my probes can successfully operate under any darkness conditions in a particular orbit and then just assume they always contain enough electrical charge. This works fine for stuff like comms sats that I never really switch to but for an active probe, it\u0027s not very realistic for it to have full battery charge if I switch to it halfway through a night transition and want to run experiments. Feels a bit cheaty and I generally back out of the game, edit the SFS and come back to it.\u003C/p\u003E\n"},{"CreatedByName":"jamespicone","CreatedById":125714,"CreatedDateTime":"2014-10-24T04:50:36Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022KAO\u0022 data-cite=\u0022KAO\u0022\u003E\u003Cdiv\u003Edo you think this system will be able to implement orbital decay?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThis probably isn\u0027t the right way to handle it. Orbital decay isn\u0027t a partmodule thing, and it\u0027s something you want every vessel to experience, not just those in those in the background. It could certainly be worked into it, but I don\u0027t plan to do it.\u003C/p\u003E\u003Cp\u003EI\u0027m not actually sure how possible it is - don\u0027t know how KSP handles modifying orbital parameters for backgrounded vessels.\u003C/p\u003E\n"},{"CreatedByName":"Unit327","CreatedById":90967,"CreatedDateTime":"2014-10-24T05:09:59Z","Content":"\n\u003Cp\u003ELooks like it could be quite handy. I see you are going through every part on every vessel on every physics frame (FixedUpdate), do you have an idea of the performance impact that will have?\u003C/p\u003E\n"},{"CreatedByName":"jamespicone","CreatedById":125714,"CreatedDateTime":"2014-10-24T05:46:31Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Unit327\u0022 data-cite=\u0022Unit327\u0022\u003E\u003Cdiv\u003ELooks like it could be quite handy. I see you are going through every part on every vessel on every physics frame (FixedUpdate), do you have an idea of the performance impact that will have?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI\u0027m only going through parts that have registered a background callback every FixedUpdate, not every part (but yes for every vessel). I\u0027m not sure what the performance implications will be in actual use. Mostly that\u0027s an implementation detail - this is early-days yet, and I\u0027d prefer to get the resource stuff going before I look at setting up a more delta-t-based update system.\u003C/p\u003E\n"},{"CreatedByName":"Ruedii","CreatedById":57704,"CreatedDateTime":"2014-10-24T07:31:56Z","Content":"\n\u003Cp\u003EIs there a way you could make this do things on timers or triggers configured by the config file. For instance causing something to occur automatically every 5 minutes of gameplay.\u003C/p\u003E\u003Cp\u003EAnother idea is one that can attach a behavior of a part to any routine in the game, for instance a light that changes color when the craft changes state to touched down.\u003C/p\u003E\u003Cp\u003ETo be able to do this from config files would be an incredibly powerful tool.\u003C/p\u003E\n"},{"CreatedByName":"jamespicone","CreatedById":125714,"CreatedDateTime":"2014-10-26T20:57:55Z","Content":"\n\u003Cp\u003ESome resource-fakery is implemented and functioning. Not in a way that would be useful to players, as of yet - the modules to fake resources for and how much to fake are hardcoded and wrong, just for testing - but the code is there and as far as I can tell works.\u003C/p\u003E\u003Cp\u003ESome thought needs to go into how to represent fakery well. ElectricCharge is really the only resource in stock KSP that\u0027s sensible to handle like this, which at least reduces the space, but I still don\u0027t really want to hardcode handling for ModuleDeployableSolarPanel, ModuleGenerator, etc. to extract the rate and whether or not its actually relevant in the case ModuleGenerator. I\u0027m going to need to consider a bit but I think there\u0027s going to need to be a config file that specifies what modules to fake resource handling for, what resource they generate, and any ConfigNode values to check to get rate information, relevancy information, power-curve information. Also going to need to be some flags to specify whether relevancy/power curve is appropriate. If done properly this should be extensible to arbitrary resources defined by mods.\u003C/p\u003E\u003Cp\u003EThere aren\u0027t that many things that drain ElectricCharge over time, but they should have moderately simple configs AFAICT - module name, resource name, config node for rate.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Ruedii\u0022 data-cite=\u0022Ruedii\u0022\u003E\u003Cdiv\u003EIs there a way you could make this do things on timers or triggers configured by the config file. For instance causing something to occur automatically every 5 minutes of gameplay.\u003Cp\u003EAnother idea is one that can attach a behavior of a part to any routine in the game, for instance a light that changes color when the craft changes state to touched down.\u003C/p\u003E\u003Cp\u003ETo be able to do this from config files would be an incredibly powerful tool.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThat\u0027s not really the goal here, although yes that would be powerful. I\u0027m just aiming at getting vessels that aren\u0027t currently controlled by the player to execute some mod-relevant code, and to fake some resource handling for them. Having individual background modules specify the timing they want to get called on could be a thing, but I\u0027m not sure it offers any real benefit over calling into them as fast as performance allows and letting them delta-time it out.\u003C/p\u003E\n"},{"CreatedByName":"jamespicone","CreatedById":125714,"CreatedDateTime":"2014-10-27T22:38:21Z","Content":"\n\u003Cp\u003EDoubleposting to note that as of right now I have functioning backgrounded resource handling for anything using ModuleGenerator or ModuleDeployableSolarPanel, although I don\u0027t currently do anything with power curves or shadows for solar panels (they\u0027re just assumed to output at constant output all the time). I also don\u0027t have any resource consumption backgrounded yet - really the only relevant thing in stock KSP are the probe bodies. Keep in mind I\u0027m only background-handling ElectricCharge, but the current system is resource-agnostic - you can ask it to do anything.\u003C/p\u003E\u003Cp\u003EIn fact it\u0027s got all the appropriate hooks to allow arbitrary PartModules to request arbitrary resources (including mod-defined ones) be background-handled, as long as a partmodule can tell me what the resource is and what rate it consumes or produces it at.\u003C/p\u003E\u003Cp\u003EI\u0027ve changed the way background methods are found and hooked onto so that mods using this library don\u0027t actually need it to compile or run. You can think of it as an optional extra - mods can support background processing for their partmodules, and then if the BackgroundProcessing mod is present they will get processed in the background.\u003C/p\u003E\n"},{"CreatedByName":"jamespicone","CreatedById":125714,"CreatedDateTime":"2014-10-28T18:01:09Z","Content":"\n\u003Cp\u003ETripleposting to note that BackgroundProcessing, as of now, is considered usable. The initial post in this thread has the link to KerbalStuff if you want the mod or the mod source, and instructions for mod authors who want background processing in their mod.\u003C/p\u003E\u003Cp\u003EAs of right now solar panel powercurves and kerbol-visibility is handled, although orientation isn\u0027t (all panels are considered optimally-oriented). Also PartModules can now request resources during a background update.\u003C/p\u003E\n"},{"CreatedByName":"FreeThinker","CreatedById":117389,"CreatedDateTime":"2014-10-29T14:45:02Z","Content":"\n\u003Cp\u003ESo the current version should update my satelites powers level. Perhaps finally those batteries get some real use!!!\u003C/p\u003E\u003Cp\u003EDoes it take into account the satelite facing to the sun?\u003C/p\u003E\u003Cp\u003ENow it would be nice if I could somehow monitor the power level of all my satelites ...\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-10-29T15:16:23Z\u0022 title=\u002210/29/2014 03:16  PM\u0022 data-short=\u00229 yr\u0022\u003EOctober 29, 2014\u003C/time\u003E by FreeThinker\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"jamespicone","CreatedById":125714,"CreatedDateTime":"2014-10-29T15:55:49Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022FreeThinker\u0022 data-cite=\u0022FreeThinker\u0022\u003E\u003Cdiv\u003ESo the current version should update my satelites powers level. Perhaps finally those batteries get some real use!!!\u003Cp\u003EDoes it take into account the satelite facing to the sun?\u003C/p\u003E\u003Cp\u003ENow it would be nice if I could somehow monitor the power level of all my satelites ...\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYes. It also takes into account obscured solar panels, panel tracking, and the power curve where distant solar panels are less effective. One caveat - solar panels that are blocked from the sun by the vessel itself or another backgrounded vessel probably won\u0027t be considered obscured, as far as I can tell the colliders for the vessel\u0027s parts aren\u0027t present. That\u0027s nontrivial to fix and hopefully shouldn\u0027t matter too much.\u003C/p\u003E\n"},{"CreatedByName":"Kerbas_ad_astra","CreatedById":126593,"CreatedDateTime":"2014-11-02T17:00:14Z","Content":"\n\u003Cp\u003EKSP itself doesn\u0027t notice if e.g. one set of solar panels is shaded by another set when the vessel is active, so a vehicle\u0027s behavior won\u0027t change if you don\u0027t implement that feature into BackgroundProcessing. I\u0027ve got a probe flying \u0022sideways\u0022 to the Sun with solar panels deployed in an X-configuration -- even though the two panels closer to the Sun are clearly casting shadows on the panels further away, I\u0027m still getting power from all of them.\u003C/p\u003E\n"},{"CreatedByName":"dtoxic","CreatedById":103573,"CreatedDateTime":"2014-11-28T15:54:59Z","Content":"\n\u003Cp\u003Ejust encountered this warning, nothing crashed or got broke thou but still maybe you want to take a look at it\u003C/p\u003E\u003Cp\u003Eusing ksp 0.25 x32 with Lionhead Probes pack mod\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cblockquote\u003E\u003Cp\u003E(Filename: C:/BuildAgent/work/d63dfc6385190b60/artifacts/StandalonePlayerGenerated/UnityEngineDebug.cpp Line: 49)\u003C/p\u003E\u003Cp\u003EBackgroundProcessing: PartModule/ProtoPartModuleSnapshot sync error processing part LH.Hermes. Something is very wrong.\u003C/p\u003E\u003C/blockquote\u003E\u003Cp\u003Eand the logs\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022https://www.dropbox.com/s/3f1bh2psmkqt54e/KSP%200.25-BP.rar?dl=0\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://www.dropbox.com/s/3f1bh2psmkqt54e/KSP%200.25-BP.rar?dl=0\u003C/a\u003E\u003C/p\u003E\u003Cp\u003Ehope it helps\u003C/p\u003E\n"},{"CreatedByName":"jamespicone","CreatedById":125714,"CreatedDateTime":"2014-11-29T09:49:32Z","Content":"\n\u003Cp\u003EThat error pops up when the code can\u0027t match modules between the protovessel for a vessel and the actual instantiated vessel. It could be trouble if there are background-processing-using modules present on the vessel doing that. Fortunately, I\u0027m not aware of any modules using it yet. I\u0027ll have to look into the Lionhead Probes pack mod to see what they\u0027re doing, but it looks like at the very least the mechanism I use to try and match the modules doesn\u0027t quite work and I\u0027ll have to be cleverer.\u003C/p\u003E\u003Cp\u003EThanks for the report and for providing the logs.\u003C/p\u003E\n"},{"CreatedByName":"dtoxic","CreatedById":103573,"CreatedDateTime":"2014-11-29T10:02:19Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022jamespicone\u0022 data-cite=\u0022jamespicone\u0022\u003E\u003Cdiv\u003EThat error pops up when the code can\u0027t match modules between the protovessel for a vessel and the actual instantiated vessel. It could be trouble if there are background-processing-using modules present on the vessel doing that. Fortunately, I\u0027m not aware of any modules using it yet. I\u0027ll have to look into the Lionhead Probes pack mod to see what they\u0027re doing, but it looks like at the very least the mechanism I use to try and match the modules doesn\u0027t quite work and I\u0027ll have to be cleverer.\u003Cp\u003EThanks for the report and for providing the logs.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003Eno problem if you need anything else just drop me a line \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"jamespicone","CreatedById":125714,"CreatedDateTime":"2014-12-05T02:00:54Z","Content":"\n\u003Cp\u003EAlright, finally got around to having a look at this.\u003C/p\u003E\u003Cp\u003EI suspect there\u0027s some weird interaction with ModuleManager going on. Earlier on your log has these lines, from, as far as I can tell, KSP\u0027s internal loading code:\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003E[WRN 16:48:06.152] [Part]: PartModule indexing mismatch at LH.Hermes, index 4.\u003Cp\u003ENode \u0027ModuleScienceExperiment\u0027 found in loaded data, but \u0027ModuleDataTransmitter\u0027 is defined in prefab.\u003C/p\u003E\u003Cp\u003ELooking for ModuleScienceExperiment in other indices...\u003C/p\u003E\u003Cp\u003E[WRN 16:48:06.152] ...ModuleScienceExperiment module found at index 5.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThat\u0027s the same problem that I\u0027m running into. Is it possible that this vessel was loaded with a different set of ModuleManager configs from when it was saved, or something like that? Does the same thing happen if you just make a new vessel of the same kind on the pad?\u003C/p\u003E\u003Cp\u003EI\u0027ve just updated BackgroundProcessing to have a newer method for trying to sync up partmodules and protopartmodulesnapshots. Could you try version 0.2.5, from KerbalStuff, and see what log messages you get?\u003C/p\u003E\u003Cp\u003EThanks.\u003C/p\u003E\n"},{"CreatedByName":"dtoxic","CreatedById":103573,"CreatedDateTime":"2014-12-05T02:34:29Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022jamespicone\u0022 data-cite=\u0022jamespicone\u0022\u003E\u003Cdiv\u003EAlright, finally got around to having a look at this.\u003Cp\u003EI suspect there\u0027s some weird interaction with ModuleManager going on. Earlier on your log has these lines, from, as far as I can tell, KSP\u0027s internal loading code:\u003C/p\u003E\u003Cp\u003EThat\u0027s the same problem that I\u0027m running into. Is it possible that this vessel was loaded with a different set of ModuleManager configs from when it was saved, or something like that? Does the same thing happen if you just make a new vessel of the same kind on the pad?\u003C/p\u003E\u003Cp\u003EI\u0027ve just updated BackgroundProcessing to have a newer method for trying to sync up partmodules and protopartmodulesnapshots. Could you try version 0.2.5, from KerbalStuff, and see what log messages you get?\u003C/p\u003E\u003Cp\u003EThanks.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003Ehey cool will let you know what i found\u003C/p\u003E\u003Cp\u003Eon the other hand i do use MM patch to modify that part LH.Hermes...(RemoteTech) does it and is the only one that i know of, that modifies the part\u003C/p\u003E\u003Cp\u003Ewill give the new version a go see what i find \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003E======================================\u003C/p\u003E\u003Cp\u003Ejust tried it and now the log get\u0027s spammed with nullref\u0027s\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cblockquote\u003E\u003Cp\u003ENullReferenceException: Object reference not set to an instance of an object\u003C/p\u003E\u003Cp\u003E at BackgroundProcessing.Addon.GetVesselData (.Vessel v) [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003C/p\u003E\u003Cp\u003E at BackgroundProcessing.Addon.FixedUpdate () [0x00000] in \u0026lt;filename unknown\u0026gt;:0\u003C/p\u003E\u003C/blockquote\u003E\u003Cp\u003Ehere are the logs\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022https://www.dropbox.com/s/ral559h6ohzegw6/BP-Null.rar?dl=0\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://www.dropbox.com/s/ral559h6ohzegw6/BP-Null.rar?dl=0\u003C/a\u003E\u003C/p\u003E\u003Cp\u003Enote: i did not use the same vessel just a random one build, but i don\u0027t think that makes any difference \u003C/p\u003E\u003Cp\u003Eif you need anything more let me know \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-12-05T02:53:26Z\u0022 title=\u002212/05/2014 02:53  AM\u0022 data-short=\u00229 yr\u0022\u003EDecember 5, 2014\u003C/time\u003E by dtoxic\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"toadicus","CreatedById":67745,"CreatedDateTime":"2014-12-05T21:44:49Z","Content":"\n\u003Cp\u003EI\u0027m considering using this for a future update and have a few questions.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022jamespicone\u0022 data-cite=\u0022jamespicone\u0022\u003E\u003Cdiv\u003EAs of right now solar panel powercurves and kerbol-visibility is handled, although orientation isn\u0027t (all panels are considered optimally-oriented). Also PartModules can now request resources during a background update.\u003C/div\u003E\u003C/blockquote\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022jamespicone\u0022 data-cite=\u0022jamespicone\u0022\u003E\u003Cdiv\u003EYes. It also takes into account obscured solar panels, panel tracking, and the power curve where distant solar panels are less effective. One caveat - solar panels that are blocked from the sun by the vessel itself or another backgrounded vessel probably won\u0027t be considered obscured, as far as I can tell the colliders for the vessel\u0027s parts aren\u0027t present. That\u0027s nontrivial to fix and hopefully shouldn\u0027t matter too much.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThese two answers appear to conflict. Did something change? If a vessel\u0027s sun-facing is considered as suggested by the second answer, is some form of stabilization implemented and/or possible, to maintain an optimal orientation with relation to the sun?\u003C/p\u003E\u003Cp\u003EI see you have the dll packaged without any path, ala ModuleManager. The current state of the code seems to contradict the OP which suggests that IBackgroundHandler is provided and should be implemented, so I assuming a need to link against your DLL is out. Is the intent for distribution for mods to package your DLL and link to your thread / KerbalStuff entry ala ModuleManager, or do you want to distribute it yourself?\u003C/p\u003E\n"},{"CreatedByName":"jamespicone","CreatedById":125714,"CreatedDateTime":"2014-12-05T23:07:20Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022toadicus\u0022 data-cite=\u0022toadicus\u0022\u003E\u003Cdiv\u003EI\u0027m considering using this for a future update and have a few questions.\u003Cp\u003EThese two answers appear to conflict. Did something change? If a vessel\u0027s sun-facing is considered as suggested by the second answer, is some form of stabilization implemented and/or possible, to maintain an optimal orientation with relation to the sun?\u003C/p\u003E\u003Cp\u003EI see you have the dll packaged without any path, ala ModuleManager. The current state of the code seems to contradict the OP which suggests that IBackgroundHandler is provided and should be implemented, so I assuming a need to link against your DLL is out. Is the intent for distribution for mods to package your DLL and link to your thread / KerbalStuff entry ala ModuleManager, or do you want to distribute it yourself?\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI haven\u0027t kept the OP here up to date. The \u003Ca href=\u0022https://kerbalstuff.com/mod/302/BackgroundProcessing\u0022 rel=\u0022external nofollow\u0022\u003EKerbalStuff\u003C/a\u003E page is the current description of how to use/what it does. At present, solar panel orientation is handled, both for static solar panels and ones that can swivel. Swivellers swivel to the optimal position given craft orientation, static panels just get as much as they get given the craft orientation, I don\u0027t attempt to change the orientation.\u003C/p\u003E\u003Cp\u003EI haven\u0027t looked into changing vessel orientation with respect Kerbol while off-rails to maintain solar panel output, but it should be possible.\u003C/p\u003E\u003Cp\u003ENo need to link into the DLL any more. The intent is that the mod should act as an \u0027extra\u0027 - mods can implement that static methods mentioned in KerbalStuff/the edit at the bottom of the OP (Read from \u0022The method mod authors should use to interface with this library/mod has changed.\u0022). Then, if BackgroundProcessing is present, they get on-rails processing.\u003C/p\u003E\u003Cp\u003EI haven\u0027t written any code to detect and prevent multiple instances running, so if distributing with your mod, it\u0027s probably a good idea to get people to put it in the root directory of GameData and have them overwrite if it\u0027s present.\u003C/p\u003E\n"},{"CreatedByName":"jamespicone","CreatedById":125714,"CreatedDateTime":"2014-12-06T09:50:33Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022dtoxic\u0022 data-cite=\u0022dtoxic\u0022\u003E\u003Cdiv\u003Ehey cool will let you know what i found\u003Cp\u003Eon the other hand i do use MM patch to modify that part LH.Hermes...(RemoteTech) does it and is the only one that i know of, that modifies the part\u003C/p\u003E\u003Cp\u003Ewill give the new version a go see what i find \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003E======================================\u003C/p\u003E\u003Cp\u003Ejust tried it and now the log get\u0027s spammed with nullref\u0027s\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cblockquote\u003E\u003Cp\u003ENullReferenceException: Object reference not set to an instance of an object\u003C/p\u003E\u003Cp\u003E at BackgroundProcessing.Addon.GetVesselData (.Vessel v) [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003C/p\u003E\u003Cp\u003E at BackgroundProcessing.Addon.FixedUpdate () [0x00000] in \u0026lt;filename unknown\u0026gt;:0\u003C/p\u003E\u003C/blockquote\u003E\u003Cp\u003Ehere are the logs\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022https://www.dropbox.com/s/ral559h6ohzegw6/BP-Null.rar?dl=0\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://www.dropbox.com/s/ral559h6ohzegw6/BP-Null.rar?dl=0\u003C/a\u003E\u003C/p\u003E\u003Cp\u003Enote: i did not use the same vessel just a random one build, but i don\u0027t think that makes any difference \u003C/p\u003E\u003Cp\u003Eif you need anything more let me know \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EOkay, I\u0027m kind of confused. The only way that should happen is if there\u0027s a part on a vessel that doesn\u0027t have a prefab... I\u0027ve added the missing check that was causing the NRE, there\u0027s another version on Kerbalstuff, 0.2.6. It might not help.\u003C/p\u003E\u003Cp\u003EYou have kind of a significant amount of mods installed, which makes it tricky for me to test this stuff here. I\u0027ve tried just a ModuleManager/RemoteTech install together and they don\u0027t seem to be causing any issues over here.\u003C/p\u003E\n"},{"CreatedByName":"dtoxic","CreatedById":103573,"CreatedDateTime":"2014-12-06T14:48:11Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022jamespicone\u0022 data-cite=\u0022jamespicone\u0022\u003E\u003Cdiv\u003EOkay, I\u0027m kind of confused. The only way that should happen is if there\u0027s a part on a vessel that doesn\u0027t have a prefab... I\u0027ve added the missing check that was causing the NRE, there\u0027s another version on Kerbalstuff, 0.2.6. It might not help.\u003Cp\u003EYou have kind of a significant amount of mods installed, which makes it tricky for me to test this stuff here. I\u0027ve tried just a ModuleManager/RemoteTech install together and they don\u0027t seem to be causing any issues over here.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003Eohh ok didn\u0027t know it was depending on how many mod\u0027s one has installed (but then again i am no coder so \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif\u0022 alt=\u0022:P\u0022\u003E )\u003C/p\u003E\u003Cp\u003Eill give it a run in moded and clean install see what happens and then report here \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003E=============================\u003C/p\u003E\u003Cp\u003Estill no luck, thou now there is far less spaming in the log\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-12-06T16:30:31Z\u0022 title=\u002212/06/2014 04:30  PM\u0022 data-short=\u00229 yr\u0022\u003EDecember 6, 2014\u003C/time\u003E by dtoxic\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"philotical","CreatedById":109390,"CreatedDateTime":"2014-12-06T15:13:18Z","Content":"\n\u003Cp\u003Ethis is a cool project..\u003C/p\u003E\u003Cp\u003Ewill be heplfull for many things..\u003C/p\u003E\u003Cp\u003EI\u0027ve read about the performance question with the loops on every frame..\u003C/p\u003E\u003Cp\u003Ein my experiance, you can easely reduce it to once every 0.2 seconds..\u003C/p\u003E\u003Cp\u003Eyou will not \u0022feel\u0022 muh difference but gain a lot performance..\u003C/p\u003E\u003Cp\u003Eespecially if there are many vessels in the loop..\u003C/p\u003E\u003Cp\u003Ejust my 2 cents..\u003C/p\u003E\n"},{"CreatedByName":"jamespicone","CreatedById":125714,"CreatedDateTime":"2014-12-07T11:03:57Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022dtoxic\u0022 data-cite=\u0022dtoxic\u0022\u003E\u003Cdiv\u003Eohh ok didn\u0027t know it was depending on how many mod\u0027s one has installed (but then again i am no coder so \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif\u0022 alt=\u0022:P\u0022\u003E )\u003Cp\u003Eill give it a run in moded and clean install see what happens and then report here \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003E=============================\u003C/p\u003E\u003Cp\u003Estill no luck, thou now there is far less spaming in the log\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EEach mod you run is another thing my mod is interacting with - if I do something they don\u0027t expect, or vice-versa, it can cause problems.\u003C/p\u003E\u003Cp\u003EFar less spamming in the log is good, but what\u0027s currently being printed?\u003C/p\u003E\n"}]}