{"TopicId":60281,"ForumId":36,"TopicTitle":"[Hardware, Plugin] Arduino based physical display \u002B serial port io\u002B tutorial (24-11-19)","CreatedByName":"zitronen","CreatedById":11842,"CreatedDateTime":"2014-01-18T01:25:25Z","PageNum":30,"Articles":[{"CreatedByName":"carlosfandango","CreatedById":134420,"CreatedDateTime":"2015-01-04T21:27:32Z","Content":"\n\u003Cp\u003EIf these are the same displays that I\u0027m planning on using (they might not be exactly the same of course) then you need to check that the Dout pin (24) is not connected to the \u002BV line. It\u0027s a common fault on these boards and eventually fries them. Apologies if you already know this.\u003C/p\u003E\u003Cp\u003EHi, I\u0027m just about to get started on a physical panel for my ksp. To introduce myself: I am an electronics engineer working in the film/TV biz, I have a lot of experience as a result so I might be able to help with any electronics problems or questions you may have. Obviously though, I do not know everything there is to know!\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-01-04T21:49:00Z\u0022 title=\u002201/04/2015 09:49  PM\u0022 data-short=\u00229 yr\u0022\u003EJanuary 4, 2015\u003C/time\u003E by Claw\u003C/strong\u003E\n\u003Cbr\u003Emultipost\n\u003C/span\u003E\n"},{"CreatedByName":"MrOnak","CreatedById":104432,"CreatedDateTime":"2015-01-04T22:02:30Z","Content":"\n\u003Cp\u003EYaaaaaaaaaaaaaaay a new fanatic \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif\u0022 alt=\u0022;)\u0022\u003E Welcome on board carlos \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Freshmeat","CreatedById":111048,"CreatedDateTime":"2015-01-05T06:46:26Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Mulbin\u0022 data-cite=\u0022Mulbin\u0022\u003E\u003Cdiv\u003EProgress! The sketch now uploads to the Arduino. Com port is working fine and KSPserial is detecting the device but...\u003Cp\u003EAll that happens is the display shows 0000000 leaving the last digit unlit. I\u0027m assuming from the code that it should be showing Altitude?\u003C/p\u003E\u003Cp\u003ETried both MrOnak\u0027s original version and Freshmeat\u0027s edit (keen to be efficient as will be running 2 daisy chains each with 8 Max chips... so a total 128 digits!), both codes have the same effect.\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022http://i.imgur.com/FgOcpEy.jpg\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://i.imgur.com/FgOcpEy.jpg\u003C/a\u003E\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022font-size:8px;\u0022\u003E\u003Cspan style=\u0022color:#C0C0C0;\u0022\u003E- - - Updated - - -\u003C/span\u003E\u003C/span\u003E\u003C/p\u003E\u003Cp\u003EAlso, just dug this up from earlier in the thread by Zitronen if it\u0027s any help! (all greek to me \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif\u0022 alt=\u0022;)\u0022\u003E )\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EHave you tried replacing VData.Alt with \u002712345678\u0027? When I try to get something to work, I start by making it display a fixed value for debugging. Alternativly, start by writing a dedicated program that just displays stuff, and then import the code into the plugin. I assume you checked the wiring throughtly.\u003C/p\u003E\u003Cp\u003EIn other news, display driver chips are in route from China. Got fed up with 75HC959 and all the work you have to do manually. More important, two doors will arive this weekend, so I finally complete my garage to workshop conversion. Yeah for not freezing my butt off when I want to solder something \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 alt=\u0022:D\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"MrOnak","CreatedById":104432,"CreatedDateTime":"2015-01-05T08:07:42Z","Content":"\n\u003Cp\u003EOkay the reason why the right-most digit doesn\u0027t light up is because I changed the loop from 0-8 to 1-9 due to my use of pow() but I forgot to adapt the use of i in setDigit() \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_sad.gif\u0022 alt=\u0022:(\u0022\u003E. Don\u0027t drink and code, I guess hehe.\u003C/p\u003E\u003Cp\u003EIf you replace your loop() function with the one below (fixed version of freshmeats alternative) they all should light up.\u003C/p\u003E\u003Cp\u003EThat said, it is odd that you say KSPIO confirms to have found the Arduino but the numbers stay zero. I\u0027ll do some thinking but spontaneously I\u0027m at a loss. \u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Evoid loop()\u003Cbr\u003E{  \u003Cbr\u003E\u003Cbr\u003E  // update KSP data\u003Cbr\u003E  input();\u003Cbr\u003E\u003Cbr\u003E  // fetch current altitude as long value, not as floating point\u003Cbr\u003E  alt = (long) VData.Alt; // casting to long is needed to be able to fetch individual digits I believe\u003Cbr\u003E\u003Cbr\u003E  // update displays - for loop staring at 1 to make pow() work\u003Cbr\u003E\u003Cbr\u003E  int digitPlace = 1;\u003Cbr\u003E\u003Cbr\u003E  for(int i = 0; i \u0026lt; 8; i\u002B\u002B) { \u003Cbr\u003E    // this isolates the i-th digit\u003Cbr\u003E    digit = (alt / digitPlace) % 10;\u003Cbr\u003E    digitPlace = digitPlace *10;\u003Cbr\u003E\u003Cbr\u003E    lc.setDigit(0, i, digit, false);\u003Cbr\u003E  }\u003Cbr\u003E\u003Cbr\u003E  delay(70); // roughly matches the default update frequency of KSPIO\u003Cbr\u003E}\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n"},{"CreatedByName":"carlosfandango","CreatedById":134420,"CreatedDateTime":"2015-01-05T10:22:43Z","Content":"\n\u003Cp\u003EThanks for the welcome :-)\u003C/p\u003E\u003Cp\u003EI\u0027m not very far along with my project yet, I have designed some physical gauges using stepper motors, so if these get built and work I will try to post some relevant details. I\u0027m also working on some fancy joysticks that have multiple axes.\u003C/p\u003E\u003Cp\u003E-CF\u003C/p\u003E\n"},{"CreatedByName":"zitronen","CreatedById":11842,"CreatedDateTime":"2015-01-05T14:54:52Z","Content":"\n\u003Cp\u003EHoly crap so much happening I can\u0027t keep up!\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022MrOnak\u0022 data-cite=\u0022MrOnak\u0022\u003E\u003Cdiv\u003E\u003Cp\u003E@Zitronen: Any specific reason for setting the default baud rate to 38400?\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThere\u0027s no reason for having default baud rate at 38400. Back when we started it seemed like a good number, since we only had 40 bytes to send, now we have 180 maybe we should increase it. You can change it in the config and see if it causes any problems, I doubt it would!\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Freshmeat\u0022 data-cite=\u0022Freshmeat\u0022\u003E\u003Cdiv\u003EI understand where you\u0027re coming from. If I may, I\u0027d then suggest adding a \u0022force sync\u0022 to the ControlPacket, so you could get immediate sync after an undock. It is a bit stressful to loose throttle and RCS during these maneuvers. \u003Cp\u003EOn the bug I wrote about, I think the issue is fuel lines. My pod has fuel lines linked directly to the engine, and the fuel in these tanks is not counted.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EWhat if we only synced RCS, SAS and maybe some other \u0022important\u0022 stuff on vessel switching? Maybe that will be a better fix? What can possibly go wrong? Have it as an option as well.\u003C/p\u003E\u003Cp\u003EYeah fuel lines... The resource code I stole from mechjeb only looks for things attached through nodes, I wouldn\u0027t know where to begin to fix that (unless someone can find better code I can steal!).\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022MrOnak\u0022 data-cite=\u0022MrOnak\u0022\u003E\u003Cdiv\u003E@Zitronen: Am I right that the Arduino side of your plugin is not on your github?\u003Cp\u003EReason why I\u0027m asking is because I\u0027ve applied a useful patch to my AVR-c \u0022fork\u0022 of your code that adds a return value to kspio_input() and I believe that might be useful for your official code as well. My kspio_input() function matches your input().\u003C/p\u003E\u003Cp\u003EThe return value allows to run code that depends on vesselData numbers to be run only when the numbers actually have changed.\u003C/p\u003E\u003Cp\u003ESee my latest commit in my branch for details:\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022https://github.com/MrOnak/avr_KSPIO/commit/6d3c1bb5d483c28d6feb542f67f1b07ed9a99ce4\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/MrOnak/avr_KSPIO/commit/6d3c1bb5d483c28d6feb542f67f1b07ed9a99ce4\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EIf I\u0027m not mistaken your code with this patch would be this (changes in \u003Cspan style=\u0022color:#FF0000;\u0022\u003E\u003Cstrong\u003Ebold\u003C/strong\u003E\u003C/span\u003E):\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E[B][COLOR=\u0022#FF0000\u0022]int[/COLOR] [/B]input() {\u003Cbr\u003E  now = millis();\u003Cbr\u003E [B] [COLOR=\u0022#FF0000\u0022]int returnValue = -1;[/COLOR][/B]\u003Cbr\u003E\u003Cbr\u003E  if (KSPBoardReceiveData()){\u003Cbr\u003E    deadtimeOld = now;\u003Cbr\u003E   [B] [COLOR=\u0022#FF0000\u0022]returnValue = id;[/COLOR][/B]\u003Cbr\u003E\u003Cbr\u003E    switch(id) {\u003Cbr\u003E    case 0: //Handshake packet\u003Cbr\u003E      Handshake();\u003Cbr\u003E      break;\u003Cbr\u003E    case 1:\u003Cbr\u003E      Indicators();\u003Cbr\u003E      break;\u003Cbr\u003E    }\u003Cbr\u003E\u003Cbr\u003E    //We got some data, turn the green led on\u003Cbr\u003E    digitalWrite(GLED,HIGH);\u003Cbr\u003E    Connected = true;\u003Cbr\u003E  }\u003Cbr\u003E  else\u003Cbr\u003E  { //if no message received for a while, go idle\u003Cbr\u003E    deadtime = now - deadtimeOld; \u003Cbr\u003E    if (deadtime \u0026gt; IDLETIMER)\u003Cbr\u003E    {\u003Cbr\u003E      deadtimeOld = now;\u003Cbr\u003E      Connected = false;\u003Cbr\u003E      LEDSAllOff();\u003Cbr\u003E    }    \u003Cbr\u003E  }\u003Cbr\u003E\u003Cbr\u003E  [B][COLOR=\u0022#FF0000\u0022]return returnValue;[/COLOR][/B]\u003Cbr\u003E}\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EIn case you\u0027re interested in a bit of collaboration, I\u0027ll try and send you pull requests whenever I find useful changes / additions and your Arduino code is on github \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYeah that makes sense, and it really should be on github. All these different demo versions is getting pretty silly. I will remember to put it up before we hit version 9000.\u003C/p\u003E\u003Cp\u003EI\u0027ll be back in a week or so, don\u0027t break anything \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 alt=\u0022:D\u0022\u003E! Also welcome back Mulbin, looks like you are on track to getting your 7 segs working, thanks everyone for helping!\u003C/p\u003E\n"},{"CreatedByName":"MrOnak","CreatedById":104432,"CreatedDateTime":"2015-01-05T14:58:09Z","Content":"\n\u003Cp\u003E@Zitronen: \u003C/p\u003E\u003Cp\u003EI\u0027ll be able to test higher baudrates in 2 weeks or so, will report back. I actually managed to physically break my soldering iron (the plastic handle snapped... don\u0027t ask) so I\u0027m out of action for the time being \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif\u0022 alt=\u0022;)\u0022\u003E\u003C/p\u003E\u003Cp\u003EAlso, I\u0027ll keep an eye on your github for that Arduino code \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"AshRagnorok","CreatedById":82055,"CreatedDateTime":"2015-01-05T16:36:01Z","Content":"\n\u003Cp\u003E@Zitronen: Wanted to say Great work with the plugin. I have two requests: Can the vessel name be added to the packet as well as Current SOI?\u003C/p\u003E\n"},{"CreatedByName":"Freshmeat","CreatedById":111048,"CreatedDateTime":"2015-01-05T21:06:13Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022zitronen\u0022 data-cite=\u0022zitronen\u0022\u003E\u003Cdiv\u003E\u003Cp\u003EWhat if we only synced RCS, SAS and maybe some other \u0022important\u0022 stuff on vessel switching? Maybe that will be a better fix? \u003Cstrong\u003EWhat can possibly go wrong?\u003C/strong\u003E Have it as an option as well.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYou said it loud, we\u0027re doomed \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif\u0022 alt=\u0022;)\u0022\u003E Anyway, great solution.\u003C/p\u003E\n"},{"CreatedByName":"Mulbin","CreatedById":55562,"CreatedDateTime":"2015-01-05T23:28:36Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022MrOnak\u0022 data-cite=\u0022MrOnak\u0022\u003E\u003Cdiv\u003EOkay the reason why the right-most digit doesn\u0027t light up is... -snip-\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYep, that got all 8 lit up, but still stuck on 00000000\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Freshmeat\u0022 data-cite=\u0022Freshmeat\u0022\u003E\u003Cdiv\u003EHave you tried replacing VData.Alt with \u002712345678\u0027? When I try to get something to work, I start by making it display a fixed value for debugging\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EGood idea... something isn\u0027t right, when I replace VData.Alt with 12345678 it actually displays _7_45678, it\u0027s not the chip/leds though, I\u0027ve tested it on 4 separate LED modules now and they all do the same thing. Wiring is also fine and other generic arduino 7 segment sketches work fine, so something not right with the code...\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://i.imgur.com/jHYB5YP.jpg\u0022 alt=\u0022jHYB5YP.jpg\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Freshmeat","CreatedById":111048,"CreatedDateTime":"2015-01-06T10:44:04Z","Content":"\n\u003Cp\u003E@Mulbin:\u003C/p\u003E\u003Cp\u003ECan you try:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Evoid loop()\u003Cbr\u003E{  \u003Cbr\u003E\u003Cbr\u003E  // update KSP data\u003Cbr\u003E  input();\u003Cbr\u003E\u003Cbr\u003E  // fetch current altitude as long value, not as floating point\u003Cbr\u003E  //alt = (long) VData.Alt; // casting to long is needed to be able to fetch individual digits I believe\u003Cbr\u003E\u003Cbr\u003E  //int digitPlace = 1;\u003Cbr\u003E\u003Cbr\u003E  for(int i = 0; i \u0026lt; 8; i\u002B\u002B) { \u003Cbr\u003E\u003Cbr\u003E    lc.setDigit(0, i, i, false);\u003Cbr\u003E  }\u003Cbr\u003E\u003Cbr\u003E  delay(70); // roughly matches the default update frequency of KSPIO\u003Cbr\u003E}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EThat should print the digit position in the actual digit, so result should be 76543210, if I am reading the documentation correct.\u003C/p\u003E\n"},{"CreatedByName":"MrOnak","CreatedById":104432,"CreatedDateTime":"2015-01-06T10:48:34Z","Content":"\n\u003Cp\u003EHeh freshmeat beat me to it \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Mulbin","CreatedById":55562,"CreatedDateTime":"2015-01-06T15:57:09Z","Content":"\n\u003Cp\u003EYep, that works. As soon as I upload the sketch I get 76543210\u003C/p\u003E\n"},{"CreatedByName":"Freshmeat","CreatedById":111048,"CreatedDateTime":"2015-01-06T16:48:18Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Mulbin\u0022 data-cite=\u0022Mulbin\u0022\u003E\u003Cdiv\u003EYep, that works. As soon as I upload the sketch I get 76543210\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EMust be the way MrOnak chose to isolate digits then. Try this:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Evoid loop()\u003Cbr\u003E{  \u003Cbr\u003E\u003Cbr\u003E  // update KSP data\u003Cbr\u003E  input();\u003Cbr\u003E\u003Cbr\u003E  // fetch current altitude as long value, not as floating point\u003Cbr\u003E  //alt = (long) VData.Alt; // casting to long is needed to be able to fetch individual digits I believe\u003Cbr\u003E\u003Cbr\u003E  alt = 1234567;\u003Cbr\u003E\u003Cbr\u003E  int digitPlace = 1;\u003Cbr\u003E\u003Cbr\u003E  for(int i = 0; i \u0026lt; 8; i\u002B\u002B) { \u003Cbr\u003E    // this isolates the i-th digit\u003Cbr\u003E    digitTemp = long((alt / digitPlace));\u003Cbr\u003E    digit = digitTemp % 10;\u003Cbr\u003E    digitPlace = digitPlace *10;\u003Cbr\u003E\u003Cbr\u003E    lc.setDigit(0, i, digit, false);\u003Cbr\u003E  }\u003Cbr\u003E\u003Cbr\u003E  delay(70); // roughly matches the default update frequency of KSPIO\u003Cbr\u003E}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003ENo idea if it works, but that would be my next try.\u003C/p\u003E\u003Cp\u003EEdit: % (modulo) does not work on floats, what kind of var is alt?\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-01-06T16:54:44Z\u0022 title=\u002201/06/2015 04:54  PM\u0022 data-short=\u00229 yr\u0022\u003EJanuary 6, 2015\u003C/time\u003E by Freshmeat\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Mulbin","CreatedById":55562,"CreatedDateTime":"2015-01-06T18:01:31Z","Content":"\n\u003Cp\u003EThat throws up this...\u003C/p\u003E\u003Cp\u003EKSPIODemo8.ino: In function \u0027void loop()\u0027:\u003C/p\u003E\u003Cp\u003EKSPIODemo8:155: error: \u0027digitTemp\u0027 was not declared in this scope\u003C/p\u003E\n"},{"CreatedByName":"Freshmeat","CreatedById":111048,"CreatedDateTime":"2015-01-06T18:21:09Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Mulbin\u0022 data-cite=\u0022Mulbin\u0022\u003E\u003Cdiv\u003EThat throws up this...\u003Cp\u003EKSPIODemo8.ino: In function \u0027void loop()\u0027:\u003C/p\u003E\u003Cp\u003EKSPIODemo8:155: error: \u0027digitTemp\u0027 was not declared in this scope\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ESorry\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Evoid loop()\u003Cbr\u003E{  \u003Cbr\u003E\u003Cbr\u003E  // update KSP data\u003Cbr\u003E  input();\u003Cbr\u003E\u003Cbr\u003E  // fetch current altitude as long value, not as floating point\u003Cbr\u003E  //alt = (long) VData.Alt; // casting to long is needed to be able to fetch individual digits I believe\u003Cbr\u003E\u003Cbr\u003E  alt = 1234567;\u003Cbr\u003E\u003Cbr\u003E  int digitPlace = 1;\u003Cbr\u003E  long digitTemp;\u003Cbr\u003E\u003Cbr\u003E  for(int i = 0; i \u0026lt; 8; i\u002B\u002B) { \u003Cbr\u003E    // this isolates the i-th digit\u003Cbr\u003E    digitTemp = long((alt / digitPlace));\u003Cbr\u003E    digit = digitTemp % 10;\u003Cbr\u003E    digitPlace = digitPlace *10;\u003Cbr\u003E\u003Cbr\u003E    lc.setDigit(0, i, digit, false);\u003Cbr\u003E  }\u003Cbr\u003E\u003Cbr\u003E  delay(70); // roughly matches the default update frequency of KSPIO\u003Cbr\u003E}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n"},{"CreatedByName":"Mulbin","CreatedById":55562,"CreatedDateTime":"2015-01-06T18:57:13Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Freshmeat\u0022 data-cite=\u0022Freshmeat\u0022\u003E\u003Cdiv\u003ESorry\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI\u0027m the one who should be sorry for all the questions \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EOk, uploaded the sketch and it\u0027s acting strangely again. As soon as it uploads the display reads _2_34567\u003C/p\u003E\n"},{"CreatedByName":"Freshmeat","CreatedById":111048,"CreatedDateTime":"2015-01-06T19:38:51Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Mulbin\u0022 data-cite=\u0022Mulbin\u0022\u003E\u003Cdiv\u003EI\u0027m the one who should be sorry for all the questions \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003Cp\u003EOk, uploaded the sketch and it\u0027s acting strangely again. As soon as it uploads the display reads _2_34567\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThen it is the modulo that f*ck up the reading. Well, try doing it this way:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Evoid loop()\u003Cbr\u003E{  \u003Cbr\u003E\u003Cbr\u003E  // update KSP data\u003Cbr\u003E  input();\u003Cbr\u003E\u003Cbr\u003E  // fetch current altitude as long value, not as floating point\u003Cbr\u003E  //alt = long(VData.Alt); // casting to long is needed to be able to fetch individual digits I believe. Note that this destroys the number as it is printed, if you want to reuse alt elsewhere you need to get it from VData.Alt again.\u003Cbr\u003E\u003Cbr\u003E  long alt = 1234567;\u003Cbr\u003E\u003Cbr\u003E  int tens;\u003Cbr\u003E  int digit;\u003Cbr\u003E\u003Cbr\u003E  for(int i = 7; i \u0026gt; -1; i--) {  //we need to start lowest digit first\u003Cbr\u003E    // this isolates the i-th digit\u003Cbr\u003E    tens = alt / 10;                  \u003Cbr\u003E    digit = alt - (10*tens)\u003Cbr\u003E    alt = tens; \u003Cbr\u003E\u003Cbr\u003E    lc.setDigit(0, i, digit, false);\u003Cbr\u003E  }\u003Cbr\u003E\u003Cbr\u003E  delay(70); // roughly matches the default update frequency of KSPIO\u003Cbr\u003E}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n"},{"CreatedByName":"Mulbin","CreatedById":55562,"CreatedDateTime":"2015-01-06T19:56:03Z","Content":"\n\u003Cp\u003EI think we\u0027re getting closer... but...\u003C/p\u003E\u003Cp\u003EKSPIODemo8.ino: In function \u0027void loop()\u0027:\u003C/p\u003E\u003Cp\u003EKSPIODemo8:158: error: expected \u0060;\u0027 before \u0027alt\u0027\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif\u0022 alt=\u0022;)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Mulbin","CreatedById":55562,"CreatedDateTime":"2015-01-07T00:18:02Z","Content":"\n\u003Cp\u003EOk... I took a guess that what it means the code should look like this, with the \u0022;\u0022 after (10*tens)?\u003C/p\u003E\u003Cp\u003Etens = alt / 10; \u003C/p\u003E\u003Cp\u003E digit = alt - (10*tens);\u003C/p\u003E\u003Cp\u003E alt = tens; \u003C/p\u003E\u003Cp\u003EBut the code is still not right, the display now shows 7____000\u003C/p\u003E\n"},{"CreatedByName":"MrOnak","CreatedById":104432,"CreatedDateTime":"2015-01-07T06:43:14Z","Content":"\n\u003Cp\u003EDid you get a datasheet with your displays? If so, please upload it somewhere and link it.\u003C/p\u003E\u003Cp\u003EReason I\u0027m asking is I\u0027d like to know what input causes a digit to display an underscore. The code that \u0022extracts\u0022 single digits from a long value - the (alt / digitPlace) % 10 part - is tried and proven, that is not the problem. \u003C/p\u003E\u003Cp\u003EIn theory I can imagine some floating point issues but that would only lead to wrong digits ranging from 0-9, not something completely invalid. Aside from that, I\u0027m displaying the altitude from a float just fine on a testrig that is using the same digit-math so... floating points going out of whack seem unlikely since it works for me.\u003C/p\u003E\n"},{"CreatedByName":"Mulbin","CreatedById":55562,"CreatedDateTime":"2015-01-07T10:18:09Z","Content":"\n\u003Cp\u003ENo, there are no underscores, I\u0027m just trying to indicate blank spaces!\u003C/p\u003E\n"},{"CreatedByName":"MrOnak","CreatedById":104432,"CreatedDateTime":"2015-01-07T10:20:29Z","Content":"\n\u003Cp\u003EOkay, nevertheless, do you have a datasheet?\u003C/p\u003E\n"},{"CreatedByName":"Mulbin","CreatedById":55562,"CreatedDateTime":"2015-01-07T10:46:59Z","Content":"\n\u003Cp\u003ENo sorry, they don\u0027t come with anything but a bag! They are a pretty standard chip and board though, here is one from another manufacturer.\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022http://embedded-lab.com/blog/?p=6862\u0026amp;utm_source=feedburner\u0026amp;utm_medium=feed\u0026amp;utm_campaign=Feed%3A\u002BEmbeddedLab\u002B%28Embedded\u002BLab%29\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://embedded-lab.com/blog/?p=6862\u0026amp;utm_source=feedburner\u0026amp;utm_medium=feed\u0026amp;utm_campaign=Feed%3A\u002BEmbeddedLab\u002B%28Embedded\u002BLab%29\u003C/a\u003E\u003C/p\u003E\u003Cp\u003ESketches for this work fine on mine.\u003C/p\u003E\n"},{"CreatedByName":"zitronen","CreatedById":11842,"CreatedDateTime":"2015-01-07T11:57:48Z","Content":"\n\u003Cp\u003ESo the way I\u0027ve been using my 7 segs is by converting the number to a string first using dtostrf(), then writing the string to the LEDs. This way you have better control of the formatting and you can also display letters and symbols.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Echar SSLED[9] = \u0022--------\u0022;\u003Cbr\u003E\u003Cbr\u003E...\u003Cbr\u003Ebyte decimal = 9; //decimal is where you want the decimal point, set it to \u0026gt;9 if you don\u0027t want it.\u003Cbr\u003E\u003Cbr\u003Edtostrf(round(###put value here###),8,0,SSLED);\u003Cbr\u003Ewrite7Segment(display, SSLED, decimal);\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Evoid write7Segment(byte display, char value[9], byte decimal)\u003Cbr\u003E{\u003Cbr\u003E  for (byte j = 0; j\u0026lt;8; j\u002B\u002B) {\u003Cbr\u003E    lc.setChar(display,j,value[j],decimal==j);\u003Cbr\u003E  }\u003Cbr\u003E}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EI have a whole convoluted function for moving the decimal point around and displaying the unit on the lcd (see video in first post), I would post it here but it\u0027s kind of hard coded to use only 6 digits.\u003C/p\u003E\n"}]}