{"TopicId":103963,"ForumId":36,"TopicTitle":"[WIP][1.9.x-1.12.x] Scatterer-atmospheric scattering (0.0838 - 14/08/2022) Scattering improvements, in-game atmo generation and multi-sun support","CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-04-12T08:37:35Z","PageNum":11,"Articles":[{"CreatedByName":"_Augustus_","CreatedById":115084,"CreatedDateTime":"2015-04-25T12:46:23Z","Content":"\u003E \n\u003E Well, thanks. PQS is the detailed terrain system that you see from the surface of the planet or a low orbit.\n\u003E Edited: Laythe before and after.\n\u003E \n\u003E [http://i.imgur.com/bc7svJW.png](http://i.imgur.com/bc7svJW.png)\n\u003E \n\u003E [http://i.imgur.com/FAswdO2.png](http://i.imgur.com/FAswdO2.png)\n\u003E \n\u003E I should be able to find better settings than this later on, Jool lost quite a bit of detail.\n\n Laythe should have haze. It does have a salty atmosphere ![:P](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif)\nAlso when will you make multiple bodies editable? I want that, the Eve haze, and awesome Kerbin at the same time."},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-04-25T12:55:09Z","Content":"\u003E \n\u003E Laythe should have haze. It does have a salty atmosphere ![:P](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif)\n\u003E Also when will you make multiple bodies editable? I want that, the Eve haze, and awesome Kerbin at the same time.\n\nI have hit a brickwall with the postprocessing shader in scaled space, when I find a good way around that there will be multiple planets.\n\n\u003E \n\u003E You can keep the PQS active by editing the altitude where ScaledSpace fades in.\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E \n\u003E     body.scaledVersion.GetComponent().fadeStart = value; body.scaledVersion.GetComponent().fadeEnd = value2;\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E And do you want to deactivate the Coronas of the Sun or the emitted light? ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\nAs always, Thomas P. to the rescue, I\u0027ll try this and report back. Not the coronas or the emitted light but the glare effect (exposure circle thing that forms when you look straight at the sun and you can see it disappearing if you just slightly pan the sun off screen)\n\n\u003E \n\u003E For the sunglare I only know a way: RealSolarSystem.\n\u003E With Texture Replacer you can turn to black the glare, but that will be only a dimming of the texture.\n\u003E \n\u003E EDIT: I\u0027m pretty eager to use the tool on any computer. Laythe looks amazing.\n\u003E \n\u003E EDIT2: Anyway, stock Jool isn\u0027t full of detail, precisely... ![:P](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif)\n\nIn this case I might be able to dim/undim it as needed ingame.\n\n**Edited \u003Ctime datetime=\u00222015-04-25T12:58:40Z\u0022 title=\u002204/25/2015 12:58  PM\u0022 data-short=\u00229 yr\u0022\u003EApril 25, 2015\u003C/time\u003E by blackrack**"},{"CreatedByName":"Proot","CreatedById":98932,"CreatedDateTime":"2015-04-25T13:03:38Z","Content":"The postprocessing covers completely the planet in all ways?\n\nMaybe you just need to apply the same effect but in a different way.\n\nI mean, can you trigger a more subtle/transparent postprocessing, just for scaled space?"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-04-25T13:06:31Z","Content":"\u003E \n\u003E body.scaledVersion.GetComponent().fadeStart = value; body.scaledVersion.GetComponent().fadeEnd = value2;\n\nI think there\u0027s a typyo here, .scaledVersion doesn\u0027t exist, I\u0027m trying it with .scaledBody.\n\n\u003E \n\u003E Ah, OK. I\u0027ll look into this. ![;)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif)\n\nThanks!"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-04-25T13:11:12Z","Content":"\u003E \n\u003E The postprocessing covers completely the planet in all ways?\n\u003E Maybe you just need to apply the same effect but in a different way.\n\u003E \n\u003E I mean, can you trigger a more subtle/transparent postprocessing, just for scaled space?\n\nThe problem is, the scaled space planet has no height/depth whatsoever, it\u0027s a flat texture on a sphere and it cheats at lighting and shadows by using what I assume is a bump map or something similar. So applying postprocessing to it will return nothing but a flat-looking ocean planet, making the postprocessing transparent will just make it look like this\n\n[http://i.imgur.com/gC7s6td.jpg](http://i.imgur.com/gC7s6td.jpg)\n\n[http://i.imgur.com/P2icg7i.jpg](http://i.imgur.com/P2icg7i.jpg)\n\nThese are old pics from when I was just applying transparency to that blue sphere that used to cover kerbin after the 160km altitude but the result should look exactly the same, it\u0027s basically just a blue overlay painted on top of the planet.\n\nEdited: \n\n\u003E \n\u003E As for the sun glare, try this and report back please: \n\u003E \n\u003E \n\u003E \n\u003E \n\u003E \n\u003E     Sun.Instance.sunFlare.gameObject.SetActive(false);\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E I can\u0027t test this myself at the moment because of computer-problems. ![;)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif)\n\u003E \n\u003E Ah, you are useing the CelestialBody component, not the whole PSystemBody. Try .scaledBody. If it doesn\u0027t works, I\u0027ll write a function to get the right scaledVersion. ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif) But I think it should work.\n\nI\u0027ll try both after lunch, thanks a lot! I hope this works.\n\n**Edited \u003Ctime datetime=\u00222015-04-25T13:14:15Z\u0022 title=\u002204/25/2015 01:14  PM\u0022 data-short=\u00229 yr\u0022\u003EApril 25, 2015\u003C/time\u003E by blackrack**"},{"CreatedByName":"Ralathon","CreatedById":71537,"CreatedDateTime":"2015-04-25T13:17:54Z","Content":"Can\u0027t you use the height map as alpha channel for the effect? That way you end up with high transparency in high areas (mountains) and low in the plains and oceans."},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-04-25T13:23:59Z","Content":"\u003E \n\u003E Can\u0027t you use the height map as alpha channel for the effect? That way you end up with high transparency in high areas (mountains) and low in the plains and oceans.\n\nThis could work too but the effect would look off since the scattered light as a function of distance is more than just a base color with a transparency value proportional to said distance. But this could give acceptable results from a bit far away. Maybe after I modified the PQS height but I reach the limit where it hits the far clipping plane?\n\nOr maybe I could find another way to just pass the heightmap to the shader and work with it straight up..."},{"CreatedByName":"Proot","CreatedById":98932,"CreatedDateTime":"2015-04-25T14:59:33Z","Content":"\u003E \n\u003E The problem is, the scaled space planet has no height/depth whatsoever, it\u0027s a flat texture on a sphere and it cheats at lighting and shadows by using what I assume is a bump map or something similar. So applying postprocessing to it will return nothing but a flat-looking ocean planet, making the postprocessing transparent will just make it look like this\n\u003E [http://i.imgur.com/gC7s6td.jpg](http://i.imgur.com/gC7s6td.jpg)\n\u003E \n\u003E [http://i.imgur.com/P2icg7i.jpg](http://i.imgur.com/P2icg7i.jpg)\n\u003E \n\u003E These are old pics from when I was just applying transparency to that blue sphere that used to cover kerbin after the 160km altitude but the result should look exactly the same, it\u0027s basically just a blue overlay painted on top of the planet.\n\u003E \n\u003E Edited: \n\u003E \n\u003E I\u0027ll try both after lunch, thanks a lot! I hope this works.\n\nAs long as the transition remain smooth, that looks like a pretty decent temporary solution -for me- (maybe a little less of transparecy and a bit more of light/contrast...). But I\u0027m pretty sure that the solution you want is much better deal... so don\u0027t take this too much on count, lol.\n\nLately I use this as a kind of visual reference: [https://www.google.es/maps/@9.9219692,7.9093048,23003639m/data=!3m1!1e3](https://www.google.es/maps/@9.9219692,7.9093048,23003639m/data=!3m1!1e3)"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-04-25T15:35:17Z","Content":"\u003E \n\u003E As for the sun glare, try this and report back please: \n\u003E \n\u003E \n\u003E \n\u003E \n\u003E \n\u003E     Sun.Instance.sunFlare.gameObject.SetActive(false);\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E I can\u0027t test this myself at the moment because of computer-problems. ![;)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif)\n\u003E \n\u003E Ah, you are useing the CelestialBody component, not the whole PSystemBody. Try .scaledBody. If it doesn\u0027t works, I\u0027ll write a function to get the right scaledVersion. ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif) But I think it should work.\n\nInitially I thought this worked exactly like I wanted, but upon return to the surface I realized kerbin wasn\u0027t getting any sunlight anymore.\n\n\u003E \n\u003E You can keep the PQS active by editing the altitude where ScaledSpace fades in.\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E \n\u003E     body.scaledVersion.GetComponent().fadeStart = value; body.scaledVersion.GetComponent().fadeEnd = value2;\n\nI did some testing, and this seems to control when the scaledSpace object is faded in/out but the PQS itself remains unaffected and still fades in and out as usual and completely disables at 160kms up ![:(](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_sad.gif)\n\n\u003E \n\u003E Lately I use this as a kind of visual reference:\n\u003E \n\u003E  [https://www.google.es/maps/@9.9219692,7.9093048,23003639m/data=!3m1!1e3](https://www.google.es/maps/@9.9219692,7.9093048,23003639m/data=!3m1!1e3)\n\nThe drop shadows on those clouds are gorgeous.\n\nEdited:\n\n\u003E \n\u003E EDIT: I\u0027m pretty eager to use the tool on any computer. Laythe looks amazing.\n\nIf you still can\u0027t use the tool, you can just use the config included with the mod, rename it to Laythe instead of Kerbin and then just go ingame and set the sky transparency to 70-80% and the postprocessing exposure to about 12-15% and it should look about the same as the screen I posted.\n\n**Edited \u003Ctime datetime=\u00222015-04-25T15:53:39Z\u0022 title=\u002204/25/2015 03:53  PM\u0022 data-short=\u00229 yr\u0022\u003EApril 25, 2015\u003C/time\u003E by blackrack**"},{"CreatedByName":"djnattyd","CreatedById":63737,"CreatedDateTime":"2015-04-25T16:35:10Z","Content":"I\u0027m having a hard time getting my head around the config tool.\n\n I\u0027m using Kerbin 365 which rescales the system to 3.2x sizes, Kerbin itself has a radius of 192,000m which I\u0027m able to enter into the tool and get it to generate a new globe but I can\u0027t figure out how to set the atmosphere height correctly."},{"CreatedByName":"amarius1","CreatedById":111155,"CreatedDateTime":"2015-04-25T16:46:54Z","Content":"How RAM hungry is this?"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-04-25T17:03:01Z","Content":"\u003E \n\u003E I\u0027m having a hard time getting my head around the config tool.\n\u003E  I\u0027m using Kerbin 365 which rescales the system to 3.2x sizes, Kerbin itself has a radius of 192,000m which I\u0027m able to enter into the tool and get it to generate a new globe but I can\u0027t figure out how to set the atmosphere height correctly.\n\nAtmosphere height= radius( 192 000, not sure how you got this, since stock kerbin\u0027s radius is 600 000) \u002B desired atmosphere height\n\nor you could leave the radius unchanged and change the ratio of (atmosphere height/radius) and it\u0027ll scale both up according to kerbin\u0027s radius when you get ingame.\n\n\u003E \n\u003E How RAM hungry is this?\n\nNot RAM hungry at all as far as I know."},{"CreatedByName":"papics","CreatedById":77783,"CreatedDateTime":"2015-04-25T17:18:52Z","Content":"That view from the hazy Laythe is beautiful!"},{"CreatedByName":"djnattyd","CreatedById":63737,"CreatedDateTime":"2015-04-25T17:27:11Z","Content":"Thanks Blackrack.\n\nThe radius came from the RSS.cfg that Kerbin 365 uses. I meant to type 1,920,000."},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-04-25T17:30:41Z","Content":"Thanks to Thomas P. I was able to keep the PQS active longer, but I have to admit the postprocessing is really underwhelming here and there are some artifacts.\n\nBut at least now I can play with the settings and maybe fade it out until I find something better.\n\n![ww5tQWI.jpg](http://i.imgur.com/ww5tQWI.jpg)\n\nEdited:\n\nFrom a 300 km altitude things look a little bit better so I guess I could fade it out from here\n\nstock: [http://i.imgur.com/PLgmjJZ.jpg](http://i.imgur.com/PLgmjJZ.jpg)\n\npost processing default: [http://i.imgur.com/Rl2FdtA.jpg](http://i.imgur.com/Rl2FdtA.jpg)\n\npost processing with a quick adjustment: [http://i.imgur.com/hlm2wfK.jpg](http://i.imgur.com/hlm2wfK.jpg)\n\n\u003E \n\u003E Thanks Blackrack.\n\u003E The radius came from the RSS.cfg that Kerbin 365 uses. I meant to type 1,920,000.\n\nSo did it work?\n\n**Edited \u003Ctime datetime=\u00222015-04-25T17:54:09Z\u0022 title=\u002204/25/2015 05:54  PM\u0022 data-short=\u00229 yr\u0022\u003EApril 25, 2015\u003C/time\u003E by blackrack**"},{"CreatedByName":"Gaalidas","CreatedById":111158,"CreatedDateTime":"2015-04-25T17:37:22Z","Content":"\u003E \n\u003E Not RAM hungry at all as far as I know.\n\nLikely this stuff is more processing-power hungry than anything else. The game won\u0027t crash from memory overages (at least not with this mod as the culprit) but may crash from processor overages."},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-04-25T17:40:52Z","Content":"\u003E \n\u003E Likely this stuff is more processing-power hungry than anything else. The game won\u0027t crash from memory overages (at least not with this mod as the culprit) but may crash from processor overages.\n\nWell, this mod uses up more GPU than CPU and RAM combined, and as far as I know KSP isn\u0027t very GPU-intensive so it should run fine for anyone with an older midrange GPU or better and not have any slowdowns.\n\nEdited: kerbin just turned into a nebula [http://i.imgur.com/NjaDsfi.jpg](http://i.imgur.com/NjaDsfi.jpg)\n\n**Edited \u003Ctime datetime=\u00222015-04-25T17:52:40Z\u0022 title=\u002204/25/2015 05:52  PM\u0022 data-short=\u00229 yr\u0022\u003EApril 25, 2015\u003C/time\u003E by blackrack**"},{"CreatedByName":"Technical Ben","CreatedById":10512,"CreatedDateTime":"2015-04-25T17:59:22Z","Content":"That last picture looks wonderful. ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-04-25T18:01:24Z","Content":"\u003E \n\u003E That last picture looks wonderful. ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\nIn a weird way it does yeah, that\u0027s what you get when the scaledSpace object is disabled, PQS has almost completely faded out and postprocessing is rendered directly on top of the skybox. Makes me think of disabling the scaledSpace object and rendering directly on top of a custom texture or a custom scaledSpace object."},{"CreatedByName":"Proot","CreatedById":98932,"CreatedDateTime":"2015-04-25T18:19:23Z","Content":"\u003E \n\u003E Thanks to Thomas P. I was able to keep the PQS active longer, but I have to admit the postprocessing is really underwhelming here and there are some artifacts.\n\u003E But at least now I can play with the settings and maybe fade it out until I find something better.\n\u003E \n\u003E [http://i.imgur.com/ww5tQWI.jpg](http://i.imgur.com/ww5tQWI.jpg)\n\n**Great step on!** \n\nI wish I could give you more rep..."},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-04-25T18:32:59Z","Content":"I bumped up the far camera\u0027s far plane, this would look great if it wasn\u0027t jittering because of all the depth buffer imprecisions at this distance.\n\n![KIH4ELy.jpg](http://i.imgur.com/KIH4ELy.jpg)\n\nI\u0027m going to try bumping up the close camera\u0027s far plane (shouldn\u0027t make a difference at this place in space) so I can bump up the far camera\u0027s near plane and try and gain some precision in the depth buffer used by the postprocessing.\n\n\u003E \n\u003E \n\u003E Proot said:\n\u003E \n\u003E \n\u003E **Great step on!**\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E I wish I could give you more rep...\n\u003E \n\nThanks, you guys support means a lot to me.\n\nEdited: Oh god it worked, with no adverse effects on the near camera too.\n\n![osIQx1p.png](http://i.imgur.com/osIQx1p.png)\n\n**Edited \u003Ctime datetime=\u00222016-04-14T08:32:03Z\u0022 title=\u002204/14/2016 08:32  AM\u0022 data-short=\u00228 yr\u0022\u003EApril 14, 2016\u003C/time\u003E by blackrack**"},{"CreatedByName":"NathanKell","CreatedById":75006,"CreatedDateTime":"2015-04-25T19:27:56Z","Content":"There\u0027s no guarantee that the scaled space mesh will be a perfect sphere; certainly various moons\u0027 aren\u0027t, and in RSS I do wrap the mesh to the PQS terrain even for large planets. That said for anything but rocky misshapen lumps of moons it will likely be indistinguishable from a sphere except on close examination.\n\nUsing heightmaps isn\u0027t the answer because (a) not all bodies have them and (![B)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_cool.png) even if they do, a heightmap is just one PQSMod among many that contribute to the final terrain. If you actually want a map of the \\_final\\_ terrain heights, you\u0027ll need to either use the built in export method or use stupid\\_chris\u0027s.\n\nAnd yes, most of the terrain variation you see in scaled space is from the normal maps applied to all bodies."},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-04-25T19:33:21Z","Content":"\u003E \n\u003E There\u0027s no guarantee that the scaled space mesh will be a perfect sphere; certainly various moons\u0027 aren\u0027t, and in RSS I do wrap the mesh to the PQS terrain even for large planets. That said for anything but rocky misshapen lumps of moons it will likely be indistinguishable from a sphere except on close examination.\n\u003E Using heightmaps isn\u0027t the answer because (a) not all bodies have them and (![B)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_cool.png) even if they do, a heightmap is just one PQSMod among many that contribute to the final terrain. If you actually want a map of the \\_final\\_ terrain heights, you\u0027ll need to either use the built in export method or use stupid\\_chris\u0027s.\n\u003E \n\u003E And yes, most of the terrain variation you see in scaled space is from the normal maps applied to all bodies.\n\nI decided against this, right now I\u0027m just extending the PQS altitude, adjusting the different camera\u0027s planes to that altitude on the fly, to keep it \u0022in the shot\u0022 and keep the depth buffer precise, and applying the postprocessing shader to the now-visible-from-far-away PQS of the planet. Until it gets sufficiently small then I just fade in the scaledObject and fade out and disable postprocessing altogether. \n\nDoes this approach seem sound? It keeps the high detail of the PQS available to the post processing shader and it certainly bought me lots of wiggle space until I can figure out a good method for scaledSpace.\n\n**Edited \u003Ctime datetime=\u00222015-04-25T20:04:11Z\u0022 title=\u002204/25/2015 08:04  PM\u0022 data-short=\u00229 yr\u0022\u003EApril 25, 2015\u003C/time\u003E by blackrack**"},{"CreatedByName":"Drew Kerman","CreatedById":103177,"CreatedDateTime":"2015-04-25T21:11:17Z","Content":"\u003E \n\u003E Edited: kerbin just turned into a nebula [http://i.imgur.com/NjaDsfi.jpg](http://i.imgur.com/NjaDsfi.jpg)\n\nLooks like it\u0027s being eaten by a Psychlo Ultimate Bomb ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)"},{"CreatedByName":"NathanKell","CreatedById":75006,"CreatedDateTime":"2015-04-26T00:18:41Z","Content":"blackrack: It\u0027s a bad idea IMO: from far away PQS will look either look much, much worse than the prerendered scaledspace texture\u002BNRM, or it will lead to way too much processing overhead. And that\u0027s for Kerbin-sized stuff, let alone anything larger. :\\\n\nThere\u0027s good reason PQS gets faded out and disabled as low as it does."}]}