{"TopicId":103963,"ForumId":36,"TopicTitle":"[WIP][1.9.x-1.12.x] Scatterer-atmospheric scattering (0.0838 - 14/08/2022) Scattering improvements, in-game atmo generation and multi-sun support","CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-04-12T08:37:35Z","PageNum":81,"Articles":[{"CreatedByName":"Proot","CreatedById":98932,"CreatedDateTime":"2015-11-20T12:27:54Z","Content":"I can\u0027t see where the problem is with Kopernicus, it never came into conflict with scatterer before. And all my changes with Kopernicus are not stock and mainly related to the ground so it\u0027s even more intriguing for me...  \n\nAnyways,I\u0027ll roll back to Kopernicus 0.4 BETA to check it. Thanks!"},{"CreatedByName":"Majorjim!","CreatedById":61954,"CreatedDateTime":"2015-11-20T14:50:41Z","Content":"[quote name=\u0027Manwith Noname\u0027]  \n\nBlack sky is caused by Kopernicus.  \n\n[/QUOTE]  \n\nNo it is not. I use Scatterer but do not have Kopernicus and I still get the black sky every now and then. Most likely caused by one of the other beautification mods I use."},{"CreatedByName":"Proot","CreatedById":98932,"CreatedDateTime":"2015-11-20T15:08:51Z","Content":"[quote name=\u0027Majorjim\u0027]No it is not. I use Scatterer but do not have Kopernicus and I still get the black sky every now and then. Most likely caused by one of the other beautification mods I use.[/QUOTE]  \n\nAfter all my test I must agree. Looks like the new version of Kopernicus made the problem worst, but didn\u0027t seem the origin of the problem.  \n\nI\u0027ve back to Kopernicus 0.4 (where all was working perfectly) but the problem persist at many ways. No more black sky, but all still looks overexposed and the horizon blending is wrong, the tint feature is still gone at map view...  \n\nI\u0027m gonna upload the actual state of KSPRC and I\u0027ll send it to Blackrack to see if he can find the issue."},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-11-20T15:36:27Z","Content":"[quote name=\u0027Proot\u0027]After all my test I must agree. Looks like the new version of Kopernicus made the problem worst, but didn\u0027t seem the origin of the problem.  \n\nI\u0027ve back to Kopernicus 0.4 (where all was working perfectly) but the problem persist at many ways. No more black sky, but all still looks overexposed and the horizon blending is wrong, the tint feature is still gone at map view...  \n\nI\u0027m gonna upload the actual state of KSPRC and I\u0027ll send it to Blackrack to see if he can find the issue.[/QUOTE]  \n\nHas kopernicus officially updated for 1.0.5?"},{"CreatedByName":"Olympic1","CreatedById":79730,"CreatedDateTime":"2015-11-20T15:40:39Z","Content":"[quote name=\u0027blackrack\u0027]Has kopernicus officially updated for 1.0.5?[/QUOTE]  \n\nYes.."},{"CreatedByName":"Nhawks17","CreatedById":32999,"CreatedDateTime":"2015-11-20T16:07:49Z","Content":"Oh wow, yeah seems Kopernicus was making the issue worse but the EVE features are still \u0027broken\u0027\n\n**Edited \u003Ctime datetime=\u00222015-11-20T16:12:06Z\u0022 title=\u002211/20/2015 04:12  PM\u0022 data-short=\u00228 yr\u0022\u003ENovember 20, 2015\u003C/time\u003E by Nhawks17**"},{"CreatedByName":"Proot","CreatedById":98932,"CreatedDateTime":"2015-11-20T16:30:43Z","Content":"[quote name=\u0027Nhawks17\u0027]Oh wow, yeah seems Kopernicus was making the issue worse but the EVE features are still \u0027broken\u0027[/QUOTE]  \n\nThe EVE problem seems to be in the new configs system, so for the moment seems to not be involved in this."},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-11-20T17:01:36Z","Content":"I just noticed that the shimmering/aliasing border around terrain introduced by the new depth buffer is really bad. And it gets worse the higher your resolution is.  \n\nEdited: Also, as Proot noted, the blending seems to be messed up.\n\n**Edited \u003Ctime datetime=\u00222015-11-20T17:15:08Z\u0022 title=\u002211/20/2015 05:15  PM\u0022 data-short=\u00228 yr\u0022\u003ENovember 20, 2015\u003C/time\u003E by blackrack**"},{"CreatedByName":"Manwith Noname","CreatedById":117203,"CreatedDateTime":"2015-11-20T18:14:35Z","Content":"[quote name=\u0027Majorjim\u0027]No it is not. I use Scatterer but do not have Kopernicus and I still get the black sky every now and then. Most likely caused by one of the other beautification mods I use.[/QUOTE]  \n\nIt may not be the only mod to cause issues but it\u0027s a dead cert if you just put Scatterer in your install, all is fine. Same goes for Kopernicus, alone, I see no problems, logs are clean.  \n\nMix the two, the sky goes black and the log goes crazy.  \n\nSame as Proot, I had used this combination in the past without issue, so somewhere in the changes of both mods is hopefully a clue.  \n\nAlso, Majorjim, could you list your mods please. Maybe Proot and Nhawks also, though I suspect they are similar. I appreciate everyone has their own work they wish to do so if noone else is testing mod combinations methodically, I will. Though I\u0027m off out tonight and away working for a couple of days. I might find the odd hour to do something."},{"CreatedByName":"Poodmund","CreatedById":128643,"CreatedDateTime":"2015-11-20T18:30:34Z","Content":"I am using Scatterer, EVE and Kopernicus without any problems. I am saving my textures using nVidia\u0027s dds plugin using DXT5 with an Interpolated Alpha channel and it seems to be working fine. I would guess it is a texture issue.  \n\nEDIT: Today I am getting a very strange bug as I have literally changed nothing but fired up the game today and at the Space Center I cannot change scene, if I click a building the game freezes. Getting a load of Null Refs. Latest Kopernicus build is also being used as shown in log, it seems a shader is not present at least:  \n\n[CODE][LOG 18:45:43.403] [Kopernicus]: Fixed SpaceCenterCamera[LOG 18:45:43.414] [ScenarioDestructibles]: Loading... 0 objects registered  \n\n[LOG 18:45:43.417] Loading Depletion Nodes  \n\n[LOG 18:45:43.417] DepNodeCount: 0  \n\n[LOG 18:45:43.419] Loading Biome Nodes  \n\n[LOG 18:45:43.419] BiomeNodeCount: 0  \n\n[LOG 18:45:43.420] Loading Planet Nodes  \n\n[LOG 18:45:43.421] PlanetNodeCount: 0  \n\n[LOG 18:45:51.628] scatterer effects loaded for Kerbin  \n\n[EXC 18:45:51.790] IsolatedStorageException: Could not find file \u0022D:\\Users\\\\*\\*\\*\\*\\*\\*\\Desktop\\KSP OPM Cloud Dev\\Kerbal Space Program\\GameData\\scatterer\\CompiledDepthTexture.shader\u0022.  \n\nSystem.IO.FileStream..ctor (System.String path, FileMode mode, FileAccess access, FileShare share, Int32 bufferSize, Boolean anonymous, FileOptions options)  \n\nSystem.IO.FileStream..ctor (System.String path, FileMode mode, FileAccess access, FileShare share, Int32 bufferSize, Boolean isAsync, Boolean anonymous)  \n\nSystem.IO.FileStream..ctor (System.String path, FileMode mode, FileAccess access)  \n\nscatterer.ShaderTool.GetShader2 (System.String resource)  \n\nscatterer.CustomDepthBufferCam.OnPreRender ()  \n\n[EXC 18:45:51.808] NullReferenceException: Object reference not set to an instance of an object  \n\nscatterer.SkyNode.toggleCoronas ()  \n\nscatterer.SkyNode.UpdateNode ()  \n\nscatterer.Manager.Update ()  \n\nscatterer.Core.Update ()[/CODE]  \n\nThat exception repeats constantly, if I click on a building this happens:  \n\n[CODE][LOG 18:45:54.981] Game State Saved to saves/default/persistent[ERR 18:45:54.984] [DestructibleBuilding]: ID for this building is not defined correctly. Cannot unregister.  \n\n[EXC 18:45:54.987] NullReferenceException  \n\nAtmosphere.CloudsPQS.OnSphereInactive ()  \n\nAtmosphere.CloudsPQS.GameSceneLoaded (GameScenes scene)  \n\nEventData\u00601[GameScenes].Fire (GameScenes data)  \n\nHighLogic.LoadScene (GameScenes scene)  \n\nEditorDriver.StartEditor (EditorFacility facility)  \n\nVehicleAssemblyBuilding.OnClicked ()  \n\nSpaceCenterBuilding.EnterBuilding ()  \n\nSpaceCenterBuilding.OnLeftClick ()  \n\nSpaceCenterBuilding\u002B.MoveNext ()  \n\n[EXC 18:45:55.038] NullReferenceException: Object reference not set to an instance of an object  \n\nscatterer.SkyNode.toggleCoronas ()  \n\nscatterer.SkyNode.UpdateNode ()  \n\nscatterer.Manager.Update ()  \n\nscatterer.Core.Update ()[/CODE]  \n\nAny ideas?\n\n**Edited \u003Ctime datetime=\u00222015-11-20T19:09:02Z\u0022 title=\u002211/20/2015 07:09  PM\u0022 data-short=\u00228 yr\u0022\u003ENovember 20, 2015\u003C/time\u003E by Poodmund**"},{"CreatedByName":"Alkahest","CreatedById":144015,"CreatedDateTime":"2015-11-22T05:50:52Z","Content":"Scatterer is causing the black sky issue even when EVE and Kopernicus have been removed, is there some configuration option to fix this? It starts up fine and looks correct for a moment, and then the screen stops for a second or two and then switches to black sky.\n\n**Edited \u003Ctime datetime=\u00222015-11-22T05:55:40Z\u0022 title=\u002211/22/2015 05:55  AM\u0022 data-short=\u00228 yr\u0022\u003ENovember 22, 2015\u003C/time\u003E by Alkahest**"},{"CreatedByName":"Singing Boyo","CreatedById":118389,"CreatedDateTime":"2015-11-22T09:02:17Z","Content":"So, I just tested Scatterer \u002B EVE \u002B Kopernicus. Interestingly, the black sky issue only shows when disabling stock atmo. If I open the Scatterer UI and enable the stock atmo, the sky looks about right, at least for stock.  \n\nUnfortunately, I\u0027ve never actually used Scatterer before (last time I looked at it it didn\u0027t like linux), so I can\u0027t say for sure what is actually working here and what isn\u0027t, but it doesn\u0027t seem like it\u0027s completely breaking everything. I do still get the NREs in toggleCoronas, but I can\u0027t tell whether that\u0027s only with stock atmo disabled or not."},{"CreatedByName":"Murdox","CreatedById":148129,"CreatedDateTime":"2015-11-22T10:49:41Z","Content":"I\u0027ve tried almost every possible commands to open Scatterer UI, but i just can\u0027t get it open... What\u0027s the trick you did to open it Singing Boyo or anyone else? I tryed to search thread and readme file from mod folder with no success. Thanks for help!\n\n**Edited \u003Ctime datetime=\u00222015-11-22T11:17:01Z\u0022 title=\u002211/22/2015 11:17  AM\u0022 data-short=\u00228 yr\u0022\u003ENovember 22, 2015\u003C/time\u003E by Murdox**"},{"CreatedByName":"Poodmund","CreatedById":128643,"CreatedDateTime":"2015-11-22T11:21:32Z","Content":"Alt (Mod)\u002BF11, if on Linux it will be Right-Shift\u002BF11.  \n\nNote that you have to have an Active Vessel in range of Scatterer\u0027s preset activation distances for the effects to \u0027turn-on\u0027. These distances, IIRC, are set in the PlanetsList.cfg  \n\nEDIT: Blackrack, will it be possible to locate .cfg and Planet folders outside of Scatterer\u0027s main directory as supplying additional configs for mods that add planets may be troublesome when it comes to overwriting the PlanetsList.cfg. Is there a modular approach that can be taken? Can additional PlanetList.cfg files with a different file name coexist alongside the main file for additional planets?\n\n**Edited \u003Ctime datetime=\u00222015-11-22T11:24:30Z\u0022 title=\u002211/22/2015 11:24  AM\u0022 data-short=\u00228 yr\u0022\u003ENovember 22, 2015\u003C/time\u003E by Poodmund**"},{"CreatedByName":"Murdox","CreatedById":148129,"CreatedDateTime":"2015-11-22T11:32:07Z","Content":"Thank you Poodmund for very detailed answer! I\u0027m also trying to mess up with Scatterer \u002B EVE \u002B Kopernicus combo.\n\n**Edited \u003Ctime datetime=\u00222015-11-22T12:44:47Z\u0022 title=\u002211/22/2015 12:44  PM\u0022 data-short=\u00228 yr\u0022\u003ENovember 22, 2015\u003C/time\u003E by Murdox**"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-11-22T14:58:44Z","Content":"It seems everyone who\u0027s having trouble with the black sky is reporting some kind of nullref with togglecoronas(), I\u0027ll try to take a look at this tonight. I also have to take a look at Proot\u0027s WIP KSPRC.  \n\n[quote name=\u0027Poodmund\u0027]Alt (Mod)\u002BF11, if on Linux it will be Right-Shift\u002BF11.  \n\nNote that you have to have an Active Vessel in range of Scatterer\u0027s preset activation distances for the effects to \u0027turn-on\u0027. These distances, IIRC, are set in the PlanetsList.cfg  \n\nEDIT: Blackrack, will it be possible to locate .cfg and Planet folders outside of Scatterer\u0027s main directory as supplying additional configs for mods that add planets may be troublesome when it comes to overwriting the PlanetsList.cfg. Is there a modular approach that can be taken? Can additional PlanetList.cfg files with a different file name coexist alongside the main file for additional planets?[/QUOTE]  \n\nI\u0027ll see what I can do, probably the best way would be to have each planet have it\u0027s own separate file and have the mod autodetect them at start."},{"CreatedByName":"Singing Boyo","CreatedById":118389,"CreatedDateTime":"2015-11-22T22:08:47Z","Content":"About opening the UI. I\u0027m on linux, and oddly enough need RShift-Alt-F11. Similarly, opening EVE\u0027s UI is RShift-Alt-0 (Which should really be Alt-0 or RShift-0). Not sure why this is, but it\u0027s what I end up needing, so if you can\u0027t open it, maybe try that."},{"CreatedByName":"Poodmund","CreatedById":128643,"CreatedDateTime":"2015-11-22T22:51:03Z","Content":"Due to Linux using Alt as a standard OS shortcut key, the modifier keybinding in KSP is moved to Right-Shift instead so that \u0027bad things\u0027 do not happen."},{"CreatedByName":"StickyScissors","CreatedById":144204,"CreatedDateTime":"2015-11-23T04:43:04Z","Content":"So, reading through this thread it seems i\u0027m not the only person with the sky turning black, lagging my game for a few moments before running smoothly again when i alt-tab in/out.   \n\nMost of the time(read: every time), if i tab in/out, the sky will do the blackness thing, lagging and then just crash without a popup. And if it matters, im trying to tab in/out of fullscreen. If that\u0027s the issue than i\u0027m just going to uninstall scatterer, because playing on a smaller resolution just annoys me and having everything crammed into a small screen is claustrophobic"},{"CreatedByName":"Manwith Noname","CreatedById":117203,"CreatedDateTime":"2015-11-23T05:42:01Z","Content":"Have you tried adding the command -popupwindow to your launch parameters? You should be able to run KSP in borderless window mode with it, so no lower resolution needed if that\u0027s what you are referring to?"},{"CreatedByName":"GorillaZilla","CreatedById":100625,"CreatedDateTime":"2015-11-24T01:26:48Z","Content":"[quote name=\u0027rbray89\u0027]Bingo. Abstracting things to bare minimum. Pretty views should come from those sending craft to the places :)[/QUOTE]  \n\nDouble Bingo! Thats one of the things I have been thinking about too, having the map view kind of spoils you, you can zoom in on any planet and get pretty much the same visuals as actually visiting (In stock kerbal anyway)  \n\nHaving the map view be just that, a map view and the planets just mysterious coloured specks visable when you look at the right part of the sky and zoom in, would make actually seeing a planet on person for the first time a truely magical experience (With RVE, Scatter. EVE ect for maximum POW!)  \n\nSo fair plays this is a good one to develop, would be something I would be dying to have in a future Educational build of KSP :cool:  \n\n[quote name=\u0027Poodmund\u0027]Loving the new multi-planet support, I have been playing around with Tekto this evening trying it out using all homemade textures with the new EVE release.  \n\n[IMG]http://i.imgur.com/tqwiEx6l.jpg[/IMG] [/QUOTE]  \n\nBy the way, that looks really slick ;-)\n\n**Edited \u003Ctime datetime=\u00222015-11-24T01:31:49Z\u0022 title=\u002211/24/2015 01:31  AM\u0022 data-short=\u00228 yr\u0022\u003ENovember 24, 2015\u003C/time\u003E by GorillaZilla**"},{"CreatedByName":"direwolf","CreatedById":153980,"CreatedDateTime":"2015-11-24T01:33:43Z","Content":"Anyone who have trouble getting Scatterer to work with RSS / Kopernicus can give my patched version a try. It fixes the celestial / transform naming mess by simply detecting the proper celestial body using both names defined in PlanetList.cfg and does the same with assets, like shaders and config. Should help with black sky and NullReference exceptions should be gone altogether for your bonus enjoyment.  \n\nAs a disclaimer, I\u0027ve only tested it on my setup: OSX 10.11, Stock KSP modded with 64bit UnityPlayer 4.6.4. Only Scatterer and RSS 10.4.1 installed with 8K textures. Feedback from 32bit and/or Windows / Linux host with and without RSS would be appreciated.  \n\nWithout any further ado:  \n\nPull request for the technically inclined: [URL]https://github.com/LGhassen/Scatterer/pull/5[/URL]  \n\nGameData snapshot: [URL]https://www.dropbox.com/s/pejxjr4rrnrfuo6/scatterer-0.191-rss-compat-c0a39c7.zip[/URL]  \n\nHow it looks with 100% default configuration:  \n\n[IMGUR]1NZLq[/IMGUR]  \n\nHave fun!"},{"CreatedByName":"Manwith Noname","CreatedById":117203,"CreatedDateTime":"2015-11-24T03:35:56Z","Content":"[quote name=\u0027direwolf\u0027]Feedback from 32bit and/or Windows / Linux host with and without RSS would be appreciated.[/QUOTE]  \n\nKSP 32 on Win 8.1 x64 with DX9 (assuming that is still the default) rendering....is a no go sadly. The atmosphere doesn\u0027t load at all and I get lots of this in the logs....  \n\n[code]  \n\n[EXC 03:16:18.574] InvalidOperationException: Operation is not valid due to the current state of the object  \n\nSystem.Linq.Enumerable.Single[CelestialBody] (IEnumerable\u00601 source, System.Func\u00602 predicate, Fallback fallback)  \n\nSystem.Linq.Enumerable.Single[CelestialBody] (IEnumerable\u00601 source, System.Func\u00602 predicate)  \n\nscatterer.Core.Update ()  \n\n[/code]  \n\nThis was a completely vanilla install. I then threw Kopernicus 0.5.2 in just incase there was some dependency but the situation remained the same."},{"CreatedByName":"StickyScissors","CreatedById":144204,"CreatedDateTime":"2015-11-24T05:21:49Z","Content":"[quote name=\u0027Manwith Noname\u0027]Have you tried adding the command -popupwindow to your launch parameters? You should be able to run KSP in borderless window mode with it, so no lower resolution needed if that\u0027s what you are referring to?[/QUOTE]  \n\n[Nevermind]  \n\nEdit: [Nevermind]  \n\nEdit 2: Forget what i said before, i managed to solve the porblems, it\u0027s all fine and dandy now, thanks!\n\n**Edited \u003Ctime datetime=\u00222015-11-24T05:31:45Z\u0022 title=\u002211/24/2015 05:31  AM\u0022 data-short=\u00228 yr\u0022\u003ENovember 24, 2015\u003C/time\u003E by StickyScissors**"},{"CreatedByName":"NeoGambit","CreatedById":143050,"CreatedDateTime":"2015-11-24T05:25:21Z","Content":"Not sure if its any help, but I\u0027m running KSP 64 bit on Windows 7 64bit, using Stock Visual Enhancements / EVE and Scatterer. With Kopernicus, getting the black sky on the launchpad, (enabling stock atmo brings it back, but scatterer won\u0027t load till you hit 17km above surface). Removed Kopernicus, and everything works flawlessly. The Alt\u002BTab thing seems to cause scatterer to re-render, causes a slight pause, but resumes normal operations afterwards.  \n\nEDIT: Default DX9 load\n\n**Edited \u003Ctime datetime=\u00222015-11-24T05:32:11Z\u0022 title=\u002211/24/2015 05:32  AM\u0022 data-short=\u00228 yr\u0022\u003ENovember 24, 2015\u003C/time\u003E by NeoGambit**"}]}