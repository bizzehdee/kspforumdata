{"TopicId":60281,"ForumId":36,"TopicTitle":"[Hardware, Plugin] Arduino based physical display \u002B serial port io\u002B tutorial (24-11-19)","CreatedByName":"zitronen","CreatedById":11842,"CreatedDateTime":"2014-01-18T01:25:25Z","PageNum":70,"Articles":[{"CreatedByName":"stibbons","CreatedById":57865,"CreatedDateTime":"2016-12-02T23:11:37Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222872021\u0022 data-ipsquote-contentid=\u002260281\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221480692265\u0022 data-ipsquote-userid=\u002211842\u0022 data-ipsquote-username=\u0022zitronen\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n7 hours ago, zitronen said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nI think \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/57865-stibbons/\u0026amp;do=hovercard\u0022 data-mentionid=\u002257865\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/57865-stibbons/\u0022 rel=\u0022\u0022\u003E@stibbons\u003C/a\u003E got a working navball on a 32bit teensy, he can probably tell you what he did to struct packing.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nI am running running stuff on a 32 bit teensy (with a Cortex-M4, as opposed to the Due\u0027s M3), but the\u00A0\u003Ca href=\u0022https://bitbucket.org/pjhardy/ksky/src/0c79d936e055e882d70eae1521799e35fbdc7179/arduino/KerbalNavball/data_packets.h?at=master\u0026amp;fileviewer=file-view-default\u0022 rel=\u0022external nofollow\u0022\u003Esource for the data packets\u003C/a\u003E\u00A0in that sketch shows I\u0027m not doing anything special with the struct packing.\n\u003C/p\u003E\n\u003Cp\u003E\nIt\u0027s worth pointing out that my teensy doesn\u0027t plug in to a serial connection, though. It\u0027s having VesselData packets sent to it over I2C from another microcontroller.\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222872407\u0022 data-ipsquote-contentid=\u002260281\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221480710375\u0022 data-ipsquote-userid=\u0022168905\u0022 data-ipsquote-username=\u0022c4ooo\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n2 hours ago, c4ooo said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nIs the bottleneck the fact that an arduino cant really drive an LCD or is it your 3D drawing code?\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThe bottleneck is just that an 8 bit microcontroller is being used to do software 3D transforms. Eyeballing @boostme\u0027s code shows tells me that they\u0027re using integer math, which makes their code run much faster than mine - I was nowhere near 10fps on my Uno. But the same code runs at upwards of 40fps when I use a Teensy 3.2 to do the drawing. Considering I have the game sending data at 12.5fps it\u0027s a very suitable arrangement.\n\u003C/p\u003E\n"},{"CreatedByName":"c4ooo","CreatedById":168905,"CreatedDateTime":"2016-12-02T23:37:12Z","Content":"\n\u003Cp\u003E\nAhh ok. Briefly\u00A0glancing at his code though, there are some things he could optimize \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u00A0For example,\u00A0calculating\u00A0and storing the Sin() and Cos() values for pitch yaw and only roll once every frame, instead of\u00A0every time a point is drawn.\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"boostme","CreatedById":118817,"CreatedDateTime":"2016-12-03T06:32:14Z","Content":"\n\u003Cp\u003E\nThe struct packing indeed fixed it.\n\u003C/p\u003E\n\u003Cp\u003E\nThe FPS limit is all about how fast the\u00A0 CPU can get pixels to the LCD. As I recall \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/57865-stibbons/\u0026amp;do=hovercard\u0022 data-mentionid=\u002257865\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/57865-stibbons/\u0022 rel=\u0022\u0022\u003E@stibbons\u003C/a\u003E uses an LCD controller that does drawing primitives without CPU intervention.\n\u003C/p\u003E\n\u003Cp\u003E\nOn the Due the 3D calculations only take about 8 ms. I\u0027ve stripped out all FP calculations already. The rest of the time it is shifting pixels.\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027m currently drawing a wireframe at 12 FPS and filling it at 3 FPS. The result is only slightly weird.\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027m also toying with only updating one half of the wireframe every frame - a weird kind of 3d interlacing, if you will. That should (effectively) double the FPS.\n\u003C/p\u003E\n\u003Cp\u003E\nAs it is the trig functions are merely table lookups. Cacheing values between point calculations would merely mean that you now get the value from a different memory location - no change in speed.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-12-03T07:36:27Z\u0022 title=\u002212/03/2016 07:36  AM\u0022 data-short=\u00227 yr\u0022\u003EDecember 3, 2016\u003C/time\u003E by boostme\u003C/strong\u003E\n\u003Cbr\u003Emore thoughts\n\u003C/span\u003E\n"},{"CreatedByName":"Mattew","CreatedById":144806,"CreatedDateTime":"2016-12-03T10:58:36Z","Content":"\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/57865-stibbons/\u0026amp;do=hovercard\u0022 data-mentionid=\u002257865\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/57865-stibbons/\u0022 rel=\u0022\u0022\u003E@stibbons\u003C/a\u003E\u00A0 plugin sends data at rate 12.5 fps? How you get this number?\n\u003C/p\u003E\n"},{"CreatedByName":"stibbons","CreatedById":57865,"CreatedDateTime":"2016-12-03T11:59:08Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222873124\u0022 data-ipsquote-contentid=\u002260281\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221480762716\u0022 data-ipsquote-userid=\u0022144806\u0022 data-ipsquote-username=\u0022Mattew\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n49 minutes ago, Mattew said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/57865-stibbons/\u0026amp;do=hovercard\u0022 data-mentionid=\u002257865\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/57865-stibbons/\u0022 rel=\u0022\u0022\u003E@stibbons\u003C/a\u003E\u00A0 plugin sends data at rate 12.5 fps? How you get this number?\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThe refresh setting in the config file sets time between packets in seconds. I set that to 0.08,but I suspect the default these days is a little higher than that.\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"boostme","CreatedById":118817,"CreatedDateTime":"2016-12-03T15:31:54Z","Content":"\n\u003Cp\u003E\nThe Mega only managed 10 FPS with a wireframe ball. The Due happily does 12.5 with a filled in ball and 20 with a wireframe.\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027m cheating slightly with the filling, but it\u0027s hardly noticeable. I\u0027m filling the triangles next to the equator on every frame, and I let the others lag.\n\u003C/p\u003E\n\u003Cp\u003E\nI also thought I\u0027d try a full openGL 3D-rendered ball on a Raspberry Pi-3, but only got around 4 FPS on a very low-res ball.\n\u003C/p\u003E\n"},{"CreatedByName":"Mattew","CreatedById":144806,"CreatedDateTime":"2016-12-03T17:24:26Z","Content":"\n\u003Cp\u003E\nOoooh, I get it now \u003Cimg alt=\u0022:D\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 title=\u0022:D\u0022\u003E\u00A0 My IO runs ast 0.2 refresh rate. Work okay. Never bothered to go higher to be honest \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nAnd you, Navball masters, how hard is to get angle to\u00A0vector? \u00A0number tha tell me if I point to vector or somewhere else.\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"zitronen","CreatedById":11842,"CreatedDateTime":"2016-12-03T20:04:16Z","Content":"\n\u003Cp\u003E\n\u003Cspan style=\u0022color:#B22222;\u0022\u003E\u003Cspan style=\u0022font-size:18px;\u0022\u003EUpdate 0.18.6:\u003C/span\u003E\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nChanges:\n\u003C/p\u003E\n\u003Cul\u003E\u003Cli\u003E\nAdded navball mode input and output (again thanks to \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/168905-c4ooo/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022168905\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/168905-c4ooo/\u0022 rel=\u0022\u0022\u003E@c4ooo\u003C/a\u003E, hero of the republic)\n\u003C/li\u003E\n\u003Cli\u003E\nNote for 18.5 users: changes were made to setting \u0026amp; reading \u003Cabbr title=\u0022Stability Augmentation System\u0022\u003ESAS\u003C/abbr\u003E modes because it shares the byte with navball modes (we save 1 byte), see below for how to use \u003Cabbr title=\u0022Stability Augmentation System\u0022\u003ESAS\u003C/abbr\u003E mode now\n\u003C/li\u003E\n\u003Cli\u003E\nAdded easy to use functions to set and read \u003Cabbr title=\u0022Stability Augmentation System\u0022\u003ESAS\u003C/abbr\u003E and navball modes\n\u003C/li\u003E\n\u003C/ul\u003E\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003E//Navball Target Modes\n#define NAVBallIGNORE   0\n#define NAVBallORBIT    1\n#define NAVBallSURFACE  2\n#define NAVBallTARGET   3\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nNew functions:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003Ebyte getSASMode() {\n  return VData.NavballSASMode \u0026amp; B00001111; // leaves alone the lower 4 bits of; all higher bits set to 0.\n}\n\nbyte getNavballMode() {\n  return VData.NavballSASMode \u0026gt;\u0026gt; 4; // leaves alone the higher 4 bits of; all lower bits set to 0.\n}\n\nvoid setSASMode(byte m) {\n  CPacket.NavballSASMode \u0026amp;= B11110000;\n  CPacket.NavballSASMode \u002B= m;\n}\n\nvoid setNavballMode(byte m) {\n  CPacket.NavballSASMode \u0026amp;= B00001111;\n  CPacket.NavballSASMode \u002B= m \u0026lt;\u0026lt; 4;\n}\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nArduino code example for changing mode:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003EsetSASMode(SMSAS); //setting \u003Cabbr title=\u0022Stability Augmentation System\u0022\u003ESAS\u003C/abbr\u003E mode\nsetNavballMode(NAVBallSURFACE); //setting navball mode\n      \n\nif (getSASMode() == SMPrograde) { //--------- This is how you read \u003Cabbr title=\u0022Stability Augmentation System\u0022\u003ESAS\u003C/abbr\u003E modes\n\t//Blink LED, do stuff, etc.\n}\n\nif (getNavballMode() == NAVBallTARGET) { //--------- This is how you read navball modes\n\t//Blink LED, do stuff, etc.\n}\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nDownload link:\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://sites.google.com/site/zitronfiles/KSPSerialIO_018_6.zip\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://sites.google.com/site/zitronfiles/KSPSerialIO_018_6.zip\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nArduino code:\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://sites.google.com/site/zitronfiles/KSPIODemo16.zip\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://sites.google.com/site/zitronfiles/KSPIODemo16.zip\u003C/a\u003E\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-12-04T01:27:36Z\u0022 title=\u002212/04/2016 01:27  AM\u0022 data-short=\u00227 yr\u0022\u003EDecember 4, 2016\u003C/time\u003E by zitronen\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"c4ooo","CreatedById":168905,"CreatedDateTime":"2016-12-04T01:18:30Z","Content":"\n\u003Cp\u003E\nMistake spotted in your example code \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\ngetNavBallModr() should be \u0022return VData.NavballSASMode \u0026gt;\u0026gt; 4\u0022. The way you have it, the function returns 16, 32, or 48, not 1, 2, and 3 \u003Cimg alt=\u0022:wink:\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif\u0022 title=\u0022;)\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nThanks for the merge \u003Cimg alt=\u0022:D\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 title=\u0022:D\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"zitronen","CreatedById":11842,"CreatedDateTime":"2016-12-04T01:29:34Z","Content":"\n\u003Cp\u003E\nOh s*** you are right, I updated the file.\n\u003C/p\u003E\n"},{"CreatedByName":"Freshmeat","CreatedById":111048,"CreatedDateTime":"2016-12-04T11:19:53Z","Content":"\n\u003Cp\u003E\nMan, I am running behind times now. Got to find time for a serious hardware/software update.\n\u003C/p\u003E\n"},{"CreatedByName":"Mattew","CreatedById":144806,"CreatedDateTime":"2016-12-04T12:32:52Z","Content":"\n\u003Cp\u003E\nYeah pretty much. We are getting major updates faster then I can draw schematics for said changes \u003Cimg alt=\u0022:D\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 title=\u0022:D\u0022\u003E\u00A0 Good job!\n\u003C/p\u003E\n\u003Cp\u003E\nOn topic of updates. I start working on DUE for KSOIO and some crazy magic happend and Due is talkting to pluggin using its original Atmega16U2 as USB-TTL convertor, like there werent any issue on W10 at all. No need of CH340 (it actualy wasnt able to establish link using ch340, handshake failed). \u00A0I dont know how or why. Dont ask \u003Cimg alt=\u0022:D\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 title=\u0022:D\u0022\u003E\u00A0 Note\u00A0that there isnt any hardware connected to Due board atm, but getting succesful handshake is engought I think\n\u003C/p\u003E\n"},{"CreatedByName":"JoshTheCoward","CreatedById":171969,"CreatedDateTime":"2016-12-05T00:53:17Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222868124\u0022 data-ipsquote-contentid=\u002260281\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221480414850\u0022 data-ipsquote-userid=\u0022111048\u0022 data-ipsquote-username=\u0022Freshmeat\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nOn 11/29/2016 at 5:20 AM, Freshmeat said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nThe problem is driver based, so the plugin cannot fix it. A workaround is to purchase a \u003Ca href=\u0022http://www.ebay.com/itm/USB-To-RS232-TTL-CH340G-Converter-Module-Adapter-STC-replace-Pl2303-CP2102-Z3-/252123624606?hash=item3ab3bd349e:g:WmsAAOSwpdpVcaQu\u0022 rel=\u0022external nofollow\u0022\u003EUSB to TTL converter\u003C/a\u003E based on a different chip and connect tx, rx to Dig0 and Dig1, and \u002B5V and GND to Vin and GND instead of USB to Arduino.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nSorry I am new to this, I apologize if this is a dumb question. Is the drivers for the arduino? Would the Leonardo be affected too?\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nEdit: Never mind tried Arduino Leonardo on Win10 and it works perfect! Thanks so much guys cant wait to finish my build.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nEdit 2: Works perfect on my Mega 2560 as well on Win10\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-12-05T04:02:53Z\u0022 title=\u002212/05/2016 04:02  AM\u0022 data-short=\u00227 yr\u0022\u003EDecember 5, 2016\u003C/time\u003E by JoshTheCoward\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Freshmeat","CreatedById":111048,"CreatedDateTime":"2016-12-05T09:25:26Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222875435\u0022 data-ipsquote-contentid=\u002260281\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221480899197\u0022 data-ipsquote-userid=\u0022171969\u0022 data-ipsquote-username=\u0022JoshTheCoward\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n8 hours ago, JoshTheCoward said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nSorry I am new to this, I apologize if this is a dumb question. Is the drivers for the arduino? Would the Leonardo be affected too?\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nEdit: Never mind tried Arduino Leonardo on Win10 and it works perfect! Thanks so much guys cant wait to finish my build.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nEdit 2: Works perfect on my Mega 2560 as well on Win10\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nIt so happens that several knock-off arduinos use a different usb-ttl converter chip from the original, and those work with win 10. Gratulation on having one of those \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"Mattew","CreatedById":144806,"CreatedDateTime":"2016-12-06T08:33:36Z","Content":"\n\u003Cp\u003E\nUuuu, sooo I did connected I2C 4x20 lcd to my Due and I can confirm that it is getting data from pluggin while using on-board Atmega16U2 (running w10) while Uno with same configuration did not (not trying both boards at same time ofc). Anybody have idea what is going on? May 32-bit Due architecture have something to do with it? I did tiny changes in code but those are mainly for stability and 32bit compatibility.\n\u003C/p\u003E\n"},{"CreatedByName":"stibbons","CreatedById":57865,"CreatedDateTime":"2016-12-06T08:48:27Z","Content":"\n\u003Cp\u003E\nIt\u0027s not likely that changes in KSP 1.2 / 1.2.1 had any effect on the serial comms. But if the Arduino IDE has updated recently it may include newer 16U2 serial drivers that play nicely with our serial library? It would be interesting to check it with an Uno or similar.\n\u003C/p\u003E\n"},{"CreatedByName":"Benji","CreatedById":116398,"CreatedDateTime":"2016-12-06T11:50:20Z","Content":"\n\u003Cp\u003E\nWith this fix, faster baudrate (115200) and a Due I\u0027m finally able to use this fabolous plugin on Win10.\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222871690\u0022 data-ipsquote-contentid=\u002260281\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221480660230\u0022 data-ipsquote-userid=\u0022144806\u0022 data-ipsquote-username=\u0022Mattew\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nOn 2.12.2016 at 7:30 AM, Mattew said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nSomebody talk about that several pages back. Mega2560 is 8-bit and SAM3X on Due is actualy\u00A032-bit mCu. There are required some changes in code to make it work I think.\n\u003C/p\u003E\n\u003Cp\u003E\nFound it.\n\u003C/p\u003E\n\u003Cp style=\u0022color:rgb(39,42,52);font-family:\u0027Helvetica Neue\u0027, Helvetica, Arial, sans-serif;font-size:13px;font-style:normal;font-weight:normal;letter-spacing:normal;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255);\u0022\u003E\nCritical thing for anybody moving to 32 bit CPUS is that you need to add\n\u003C/p\u003E\n\u003Cp style=\u0022color:rgb(39,42,52);font-family:\u0027Helvetica Neue\u0027, Helvetica, Arial, sans-serif;font-size:13px;font-style:normal;font-weight:normal;letter-spacing:normal;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255);\u0022\u003E\nstruct __attribute__((__packed__)) VesselData\n\u003C/p\u003E\n\u003Cp style=\u0022color:rgb(39,42,52);font-family:\u0027Helvetica Neue\u0027, Helvetica, Arial, sans-serif;font-size:13px;font-style:normal;font-weight:normal;letter-spacing:normal;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255);\u0022\u003E\nTo your message structure definition in the Arduino code, otherwise all the bytes in the message get mixed together.\n\u003C/p\u003E\n\u003Cp style=\u0022color:rgb(39,42,52);font-family:\u0027Helvetica Neue\u0027, Helvetica, Arial, sans-serif;font-size:13px;font-style:normal;font-weight:normal;letter-spacing:normal;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255);\u0022\u003E\n\u003Cspan style=\u0022font-family:Arial, Helvetica, sans-serif;\u0022\u003E\u003Cspan style=\u0022font-size:16px;\u0022\u003EI get it what problem is going on but i dont get it how to fix it \u003Cimg alt=\u0022:D\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 title=\u0022:D\u0022\u003E\u003C/span\u003E\u003C/span\u003E\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nI can confirm receiving data from KSP by letting this onboard LED show if \u003Cabbr title=\u0022Stability Augmentation System\u0022\u003ESAS\u003C/abbr\u003E is on or off.\n\u003C/p\u003E\n\u003Cp\u003E\nAlso the Due is able to run a TFT Display without causing deconnects.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nThe only thing that doesn\u0027t work is sending data. Wasn\u0027t it easy as putting something like this ...\u003Cbr\u003E\n\u00A0\u00A0\u00A0 CPacket.Throttle = 1000;\u003Cbr\u003E\n\u00A0\u00A0\u00A0 CPacket.Pitch = 1000;\u003Cbr\u003E\n\u00A0\u00A0\u00A0 CPacket.Roll = -300;\n\u003C/p\u003E\n\u003Cp\u003E\n...into void controls() ?\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-12-06T12:27:48Z\u0022 title=\u002212/06/2016 12:27  PM\u0022 data-short=\u00227 yr\u0022\u003EDecember 6, 2016\u003C/time\u003E by Benji\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Mattew","CreatedById":144806,"CreatedDateTime":"2016-12-06T19:06:49Z","Content":"\n\u003Cp\u003E\nUuum,\u00A0 \u003Cspan style=\u0022color:rgb(37,37,37);font-family:sans-serif;font-size:14px;font-style:normal;font-weight:normal;letter-spacing:normal;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255);float:none;\u0022\u003EHouston, we\u0027ve had a problem here. I did try send data to game and no succes. Not over Atmega16U but no luck with CH340 either. I am trying do what is already in demo (\u003Cabbr title=\u0022Reaction Control System\u0022\u003ERCS\u003C/abbr\u003E on/off) \u00A0by pulling pin 9 LOW (pin 9 to gnd) wich should activate or deactivate \u003Cabbr title=\u0022Reaction Control System\u0022\u003ERCS\u003C/abbr\u003E, is that right? Reciving is still fine either on Mega16U or CH340. But send data? Nothing. Any idea what to try? I again thinks its bcs of Due\u00B4s 32-bit architecture. Somehow.\u003C/span\u003E\n\u003C/p\u003E\n"},{"CreatedByName":"zitronen","CreatedById":11842,"CreatedDateTime":"2016-12-06T20:02:52Z","Content":"\n\u003Cp\u003E\nDid you add the stuct packing instructions to both the receiving and sending packets?\n\u003C/p\u003E\n"},{"CreatedByName":"Mattew","CreatedById":144806,"CreatedDateTime":"2016-12-07T10:06:05Z","Content":"\n\u003Cp\u003E\nYeah I did. Nothing changes. I also did try change all uint8_t to uint32_t in KSPsenddata in serialCOM tab. No change and i got random disconnects so i reversed changes. Maybe there are needed some changes in reciving end (pluggin itself) to get work on 32bit?\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0So all teensy, due guys did not talk directly to pluggin, is that right?\n\u003C/p\u003E\n\u003Cp\u003E\nIs \u0022struct __attribute__((__packed__)) ControlPacket\u0022 is right?\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"Benji","CreatedById":116398,"CreatedDateTime":"2016-12-07T10:52:00Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222878232\u0022 data-ipsquote-contentid=\u002260281\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221481105165\u0022 data-ipsquote-userid=\u0022144806\u0022 data-ipsquote-username=\u0022Mattew\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n44 minutes ago, Mattew said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nYeah I did. Nothing changes. I also did try change all uint8_t to uint32_t in KSPsenddata in serialCOM tab. No change and i got random disconnects so i reversed changes. Maybe there are needed some changes in reciving end (pluggin itself) to get work on 32bit?\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0So all teensy, due guys did not talk directly to pluggin, is that right?\n\u003C/p\u003E\n\u003Cp\u003E\nIs \u0022struct __attribute__((__packed__)) ControlPacket\u0022 is right?\u00A0\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nI tried this struct__attribute... on the ControlPacket too.\n\u003C/p\u003E\n\u003Cp\u003E\nNo succes for the Due. Receiving is still working.\n\u003C/p\u003E\n"},{"CreatedByName":"zitronen","CreatedById":11842,"CreatedDateTime":"2016-12-09T00:49:34Z","Content":"\n\u003Cp\u003E\nAre you using KSP 1.2.2? Does it work with 1.2.1? I can\u0027t replicate the problem, can only guess...\n\u003C/p\u003E\n"},{"CreatedByName":"Benji","CreatedById":116398,"CreatedDateTime":"2016-12-09T01:56:04Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222880446\u0022 data-ipsquote-contentid=\u002260281\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221481244574\u0022 data-ipsquote-userid=\u002211842\u0022 data-ipsquote-username=\u0022zitronen\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n7 hours ago, zitronen said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nAre you using KSP 1.2.2? Does it work with 1.2.1? I can\u0027t replicate the problem, can only guess...\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nOhhh, was it \u0022self-updating\u0022 again. I thought I had deactivated this.\n\u003C/p\u003E\n\u003Cp\u003E\nThe Daily Kerbal didn\u0027t mention it, or did it? Aha, It\u0027s in Announcements now.\n\u003C/p\u003E\n\u003Cp\u003E\nObviously I\u0027m on 1.2.2 now. Didn\u0027t know.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nBut as I tried last time, I was still on 1.2.1 . \u003Cu\u003EUsing Demo16 and 0.18.6 .\u003C/u\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nWill try again tomorrow. It\u0027s very A.M. here.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-12-09T08:04:27Z\u0022 title=\u002212/09/2016 08:04  AM\u0022 data-short=\u00227 yr\u0022\u003EDecember 9, 2016\u003C/time\u003E by Benji\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Mattew","CreatedById":144806,"CreatedDateTime":"2016-12-09T13:46:14Z","Content":"\n\u003Cp\u003E\noh damn. I didnt know we have new KSP version. It was realy at wednesday? Asking bcs my Due had issues even before that. I start working on it like on tuesday. \u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nBut let me think an loud here. If I understand it correctly then \u00A0\u0022__attribute__((__packed__))\u0022 for Vessel Packet make Arduino be like \u0022hey, wait until whole data packet is recived and THEN start reading it\u0022. So if this is for data recive in arduino, should not be same thing in computer, in pluggin,\u00A0when arduino send data (control packet) to pc? Or it doesnt matter for pc if data are send as 8-bit or 32-bit?\n\u003C/p\u003E\n\u003Cp\u003E\nStill hoping for Teensy guys to save us \u003Cimg alt=\u0022:D\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 title=\u0022:D\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nWeekend is starting so I can test any suggestion or idea you have \u003Cimg alt=\u0022:wink:\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif\u0022 title=\u0022;)\u0022\u003E\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"zitronen","CreatedById":11842,"CreatedDateTime":"2016-12-09T14:05:43Z","Content":"\n\u003Cp\u003E\nstruct padding has to do with how things are stored in memory. On 32bit, when you have a struct with some bytes the compiler can choose to add padding so each individual property are 32bit long instead of 8. This is done not to just make our lives miserable, but for performance reasons. So something like\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003Estruct {\nbyte A //compiler will add padding to make this 32 bits\nlong B\n}\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nend up taking 64 bits in memory instead of 40 bits as you would expect. Obviously if you try to copy data into the struct like we are doing and the struct is not the right size you will get the wrong result. \u0022__attribute__((__packed__))\u0022 forces the compiler to make the struct as small as possible.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-12-09T14:29:19Z\u0022 title=\u002212/09/2016 02:29  PM\u0022 data-short=\u00227 yr\u0022\u003EDecember 9, 2016\u003C/time\u003E by zitronen\u003C/strong\u003E\n\u003C/span\u003E\n"}]}