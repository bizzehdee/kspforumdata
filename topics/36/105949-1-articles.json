{"TopicId":105949,"ForumId":36,"TopicTitle":"Calculating the correct altitude over water","CreatedByName":"Nereid","CreatedById":68815,"CreatedDateTime":"2015-04-29T11:15:08Z","PageNum":1,"Articles":[{"CreatedByName":"Nereid","CreatedById":68815,"CreatedDateTime":"2015-04-29T11:15:08Z","Content":"I\u0027m still facing the problem to calculate the correct altitude for a radar altimeter in NanoGauges over see/water.\n\nOver terrain it\u0027s easy: subtract terrain height from altitude. Over water... well, this will create a desaster. In this case the radar altimeter should display the altitude above sea level.\n\nSo, question: Is there a way to detect if a vessel is flying over water? is there a better way to calculate the radar altitude?\n\nThanks for any tip."},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2015-04-29T11:42:10Z","Content":"Assuming your issue is that radar alt is going to the seabed\n\n    Math.Min(radarAlt, vessel.alt)"},{"CreatedByName":"Daid","CreatedById":32171,"CreatedDateTime":"2015-04-29T11:42:12Z","Content":"I thought water was always at \u0022height\u0022 0? If it\u0027s not, then maybe you can check the RSS code to see what they change to get the water level to be at the proper height?"},{"CreatedByName":"Nereid","CreatedById":68815,"CreatedDateTime":"2015-04-29T12:13:47Z","Content":"\u003E \n\u003E Assuming your issue is that radar alt is going to the seabed\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E \n\u003E     Math.Min(radarAlt, vessel.alt)\n\nWell, this wont work, because on Mun there is no water and some terrain is below height 0. ![:(](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_sad.gif)\n\n- - - Updated - - -\n\n\u003E \n\u003E I thought water was always at \u0022height\u0022 0? If it\u0027s not, then maybe you can check the RSS code to see what they change to get the water level to be at the proper height?\n\nYes water height is 0. But if there is no water and terrain is below 0, we cant assume radar altitude = altitude (above sea level)."},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2015-04-29T12:18:53Z","Content":"[This](https://github.com/MuMech/MechJeb2/blob/master/MechJeb2/CelestialBodyExtensions.cs#L16-L24) may help"},{"CreatedByName":"Nereid","CreatedById":68815,"CreatedDateTime":"2015-04-29T12:42:13Z","Content":"\u003E \n\u003E [This](https://github.com/MuMech/MechJeb2/blob/master/MechJeb2/CelestialBodyExtensions.cs#L16-L24) may help\n\nAh! Cool. ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif) I will check it this evening. If it works, I will integrate this solution in NG. Thanks ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2015-04-29T14:30:19Z","Content":"The fix to the Math.Min shown above is to gate it behind a CelestialBody.ocean check.\n\nIf .ocean is true, that body has a sea, if false it does not.\n\nD."},{"CreatedByName":"Nereid","CreatedById":68815,"CreatedDateTime":"2015-04-29T15:01:55Z","Content":"\u003E \n\u003E The fix to the Math.Min shown above is to gate it behind a CelestialBody.ocean check.\n\u003E If .ocean is true, that body has a sea, if false it does not.\n\u003E \n\u003E D.\n\nThis will only work if no celestial body (with .ocean=true) has terrain below 0 without an ocean. But to be honest I don\u0027t know if KSP supports such strange terrain."},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2015-04-29T15:33:50Z","Content":"That is one of the oddities of KSP.\n\nIf a body .ocean = true, that body has a \u0022water sphere\u0022 that is perfectly round at an ASL of 0 so you can never go to a \u0022negative\u0022 altitude, you hit water at ASL 0 first.\n\nIt\u0027s (one of) the reasons moving your camera so you can\u0027t see the ground during launch can result in such a large FPS increase, KSP is drawing two \u0022grounds\u0022, one is the terrain you can land on, one is the water \u0022ground\u0022 sphere. KSP draws both of them, you just see whichever one has a higher altitude.\n\nD."},{"CreatedByName":"Nereid","CreatedById":68815,"CreatedDateTime":"2015-04-29T17:28:33Z","Content":"\u003E \n\u003E That is one of the oddities of KSP.\n\u003E If a body .ocean = true, that body has a \u0022water sphere\u0022 that is perfectly round at an ASL of 0 so you can never go to a \u0022negative\u0022 altitude, you hit water at ASL 0 first.\n\u003E \n\u003E D.\n\nAh, ok. If this is true than we have a very simple way to calculate the true (radar) altitude. Thanks ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)"},{"CreatedByName":"Capt. Hunt","CreatedById":97860,"CreatedDateTime":"2015-05-01T02:23:46Z","Content":"This might be a stupid question, but why not just use the ASL altimeter over water? It\u0027s already calibrated to read altitude above sea level."}]}