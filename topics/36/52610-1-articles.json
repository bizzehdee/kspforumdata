{"TopicId":52610,"ForumId":36,"TopicTitle":"Achievements Plugin: How to contribute achievements from other mods","CreatedByName":"blizzy78","CreatedById":68543,"CreatedDateTime":"2013-11-10T16:19:59Z","PageNum":1,"Articles":[{"CreatedByName":"blizzy78","CreatedById":68543,"CreatedDateTime":"2013-11-10T16:19:59Z","Content":"\n\u003Cp\u003EHi, some of you may know that I\u0027ve made an \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/52535\u0022 rel=\u0022external nofollow\u0022\u003E\u003Cstrong\u003EAchievements Plugin\u003C/strong\u003E\u003C/a\u003E. I figured that with now over a hundred achievements, maybe other mod authors might want to chime in and contribute new achievements related to their mods. I have now opened up the API of the Achievements Plugin to allow just that.\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003ERequirements\u003C/strong\u003E\u003C/p\u003E\u003Cp\u003ETo contribute new achievements, you only need the Achievements.dll from the plugin, starting with version 1.4.6. You need to reference that in your project.\u003C/p\u003E\u003Cp\u003ENote that you probably don\u0027t want to make the Achievements.dll a direct dependency of your mod\u0027s DLL. Because of that, it is best to start a new DLL project that has dependencies on both your mod\u0027s DLL and the Achievements.dll. If the player doesn\u0027t have the Achievements Plugin installed, only your achievements DLL will fail to load, but your base mod DLL will run fine.\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003ECode\u003C/strong\u003E\u003C/p\u003E\u003Cp\u003ETo add a new achievement, you need to write a bit of code. Don\u0027t worry, it\u0027s not that much. Most of it goes into checking for achievement requirements, such as \u0022is landed\u0022 or \u0022is in orbit\u0022, and things like that.\u003C/p\u003E\u003Cp\u003EPlease consider the following complete and annotated example. It should readily compile and be usable in the game.\u003C/p\u003E\u003Cp\u003E\u003Cem\u003ENote: The following example source code is hereby placed into the public domain, for obvious reasons. Feel free to use it as you wish. I do not reserve any rights to it whatsoever.\u003C/em\u003E\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Eusing System;\u003Cbr\u003Eusing System.Collections.Generic;\u003Cbr\u003Eusing System.Linq;\u003Cbr\u003Eusing System.Text;\u003Cbr\u003Eusing UnityEngine;\u003Cbr\u003E\u003Cbr\u003E// This is an achievements factory. It is used to create actual achievement instances and to provide\u003Cbr\u003E// information about the category of those achievements.\u003Cbr\u003E//\u003Cbr\u003E// Achievements factory classes are searched for in all assemblies. When found, an achievements factory\u003Cbr\u003E// is instantiated automatically using its no-args constructor.\u003Cbr\u003E//\u003Cbr\u003E// You can have as many achievements factories as you like, but in general, you need at least one per\u003Cbr\u003E// category.\u003Cbr\u003Eclass NorthPoleFactory : AchievementFactory {\u003Cbr\u003E\t// Returns the actual achievements.\u003Cbr\u003E\tpublic IEnumerable\u0026lt;Achievement\u0026gt; getAchievements() {\u003Cbr\u003E\t\treturn new Achievement[] {\u003Cbr\u003E\t\t\tnew NorthPole()\u003Cbr\u003E\t\t};\u003Cbr\u003E\t}\u003Cbr\u003E\u003Cbr\u003E\t// Returns the category of the achievements returned by getAchievements().\u003Cbr\u003E\tpublic Category getCategory() {\u003Cbr\u003E\t\treturn Category.LANDING;\u003Cbr\u003E\t}\u003Cbr\u003E}\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E// An actual achievement.\u003Cbr\u003E//\u003Cbr\u003E// While achievements must only implement the Achievement interface, it is best to subclass from\u003Cbr\u003E// the AchievementBase class. This class provides several helper functions to register event\u003Cbr\u003E// callbacks.\u003Cbr\u003E//\u003Cbr\u003E// An achievement is basically a finite state machine. The main method being used is check(), which\u003Cbr\u003E// will be invoked in a specific interval. In this method, you should check for any requirements\u003Cbr\u003E// that your achievement has. If check() returns true, this means that the player has earned the\u003Cbr\u003E// achievement, and the method will never be invoked again. As long as it returns false, the method\u003Cbr\u003E// will be invoked again at a later time.\u003Cbr\u003E//\u003Cbr\u003E// Other interesting classes to look at (check the Achievement Plugin\u0027s source code):\u003Cbr\u003E//\u003Cbr\u003E// - Body (celestial bodies, also try Vessel.getCurrentBody() from Extensions)\u003Cbr\u003E// - Category (achievement categories)\u003Cbr\u003E// - CountingAchievement (base class for achievements that count up)\u003Cbr\u003E// - Extensions (various extension methods)\u003Cbr\u003E// - Location (surface locations)\u003Cbr\u003Eclass NorthPole : AchievementBase {\u003Cbr\u003E\t// You can register event callbacks in the constructor. Most of the time, this will be\u003Cbr\u003E\t// registerOnVesselChange() to reset achievement state when the player changes the vessel\u003Cbr\u003E\t// being actively controlled.\u003Cbr\u003E\t//\u003Cbr\u003E\t// See the AchievementBase class for other event handling methods.\u003Cbr\u003E\tpublic NorthPole() {\u003Cbr\u003E\t\tregisterOnVesselChange(onVesselChange);\u003Cbr\u003E\t}\u003Cbr\u003E\u003Cbr\u003E\t// While check() is invoked in specific intervals, update() will be invoked every frame.\u003Cbr\u003E\t// You can use this method to check for achievement requirements, too.\u003Cbr\u003E\t//\u003Cbr\u003E\t// USE ONLY IF check() DOESN\u0027T ABSOLUTELY MEET YOUR NEEDS.\u003Cbr\u003E\tpublic override void update() {\u003Cbr\u003E\t}\u003Cbr\u003E\u003Cbr\u003E\t// This is the main method to check for achievement requirements. If check() returns true,\u003Cbr\u003E\t// this means that the player has earned the achievement, and check() will never be invoked again.\u003Cbr\u003E\t//\u003Cbr\u003E\t// vessel is the actively controlled vessel. Note that this can be null, for instance if the\u003Cbr\u003E\t// player is in the tracking station. You should always check for null if you need the current\u003Cbr\u003E\t// vessel.\u003Cbr\u003E\tpublic override bool check(Vessel vessel) {\u003Cbr\u003E\t\treturn (vessel != null) \u0026amp;\u0026amp; vessel.isOnSurface() \u0026amp;\u0026amp; (vessel.horizontalSrfSpeed \u0026lt; 1d) \u0026amp;\u0026amp;\u003Cbr\u003E\t\t\tLocation.KERBIN_NORTH_POLE.isAtLocation(vessel);\u003Cbr\u003E\t}\u003Cbr\u003E\u003Cbr\u003E\t// The vessel change event callback that was registered in the constructor.\u003Cbr\u003E\tprivate void onVesselChange(Vessel vessel) {\u003Cbr\u003E\t\t// reset achievement state here\u003Cbr\u003E\t}\u003Cbr\u003E\u003Cbr\u003E\t// Initialize achievement state from the achievements save file, as saved earlier in save().\u003Cbr\u003E\t//\u003Cbr\u003E\t// node is a config node specific to this achievement. You can\u0027t accidentally interfere with\u003Cbr\u003E\t// other achievements.\u003Cbr\u003E\tpublic override void init(ConfigNode node) {\u003Cbr\u003E\t}\u003Cbr\u003E\u003Cbr\u003E\t// Save achievement state to the achievements save file. State can be loaded again in init().\u003Cbr\u003E\t//\u003Cbr\u003E\t// node is a config node specific to this achievement. You can\u0027t accidentally interfere with\u003Cbr\u003E\t// other achievements.\u003Cbr\u003E\t//\u003Cbr\u003E\t// Note that the config node values \u0022flight\u0022 and \u0022time\u0022 are reserved. If you set them, they will\u003Cbr\u003E\t// be overwritten.\u003Cbr\u003E\tpublic override void save(ConfigNode node) {\u003Cbr\u003E\t}\u003Cbr\u003E\u003Cbr\u003E\t// Returns this achievement\u0027s title. Keep short so that it fits into the \u0022toast\u0022 texture.\u003Cbr\u003E\t// Always use \u0022Headline Style\u0022.\u003Cbr\u003E\tpublic override string getTitle() {\u003Cbr\u003E\t\treturn \u0022North Pole Landing\u0022;\u003Cbr\u003E\t}\u003Cbr\u003E\u003Cbr\u003E\t// Returns this achievement\u0027s text. Keep short (two lines of text) so that it fits into the\u003Cbr\u003E\t// \u0022toast\u0022 texture.\u003Cbr\u003E\tpublic override string getText() {\u003Cbr\u003E\t\treturn \u0022Land at Kerbin\u0027s north pole.\u0022;\u003Cbr\u003E\t}\u003Cbr\u003E\u003Cbr\u003E\t// Returns this achievement\u0027s key. The key must be unique across all achievements.\u003Cbr\u003E\t//\u003Cbr\u003E\t// This key MUST NOT change once an achievement has been made public. It is used to check if\u003Cbr\u003E\t// the player has already earned the achievement. If the key changes, the achievement will need to\u003Cbr\u003E\t// be earned again by the player, which makes them unhappy.\u003Cbr\u003E\t//\u003Cbr\u003E\t// It is best to use some sort of ad-hoc categories, for example: landing.kerbin.surface.northPole\u003Cbr\u003E\tpublic override string getKey() {\u003Cbr\u003E\t\treturn \u0022landing.northPole\u0022;\u003Cbr\u003E\t}\u003Cbr\u003E}\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EFor more example code, check out the \u003Ca href=\u0022https://github.com/blizzy78/ksp_achievements\u0022 rel=\u0022external nofollow\u0022\u003Esource code\u003C/a\u003E of the builtin achievements.\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003ETitle and Text Guidelines\u003C/strong\u003E\u003C/p\u003E\u003Cp\u003ETitles should always use \u0022Headline Style\u0022. Keep them rather short and memorable, preferably humorous, but related to the achievement and its text. If you can\u0027t come up with something neat, ask someone else! Most people will love to toss ideas at you.\u003C/p\u003E\u003Cp\u003E- Good example: I See What You Did There\u003C/p\u003E\u003Cp\u003E- Bad example: I see what you did there\u003C/p\u003E\u003Cp\u003EAchievement text must not exceed two lines of text, or it will be longer than the \u0022toast\u0022 texture. Always check with the achievements list in the game to see if your text is short enough.\u003C/p\u003E\u003Cp\u003EAlso, the text should not be too verbose. Try to keep the list of requirements short. You can leave out obvious requirements, even though your achievement code is checking for them.\u003C/p\u003E\u003Cp\u003ESpell out acronyms, such as \u0022Kerbal Space Center\u0022 instead of \u0022KSC\u0022.\u003C/p\u003E\u003Cp\u003ETo keep the player immersed, do not use real-world names and phrases. Bad example: Send a probe on a Voyager mission.\u003C/p\u003E\u003Cp\u003ENote that the Sun\u0027s name is \u003Cstrong\u003Enot\u003C/strong\u003E Kerbol in the game, is is \u0022Sun\u0022.\u003C/p\u003E\u003Cp\u003E- Good example: Land on the Kerbal Space Center runway from an altitude of at least 10000 m.\u003C/p\u003E\u003Cp\u003E- Bad example: Launch, get up to 10000 m, then land on the KSC runway, not crashing and no parts breaking off.\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003EHidden Achievements\u003C/strong\u003E\u003C/p\u003E\u003Cp\u003EAchievements are usually visible in the achievements list window, even if the player has not earned them yet. But you can \u0022hide\u0022 an achievement, so that it remains hidden unless the player has earned it. After that, it will stay visible.\u003C/p\u003E\u003Cp\u003EPlease use hiding of achievements only sparingly, if at all. It should remain reserved for special \u0022surprise\u0022 achievements that are not obvious. For example, an achievement that is rewarded for extracting Kethane from the ground of another celestial body should not be hidden because the act of doing so is pretty obvious.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-11-14T16:24:23Z\u0022 title=\u002211/14/2013 04:24  PM\u0022 data-short=\u002210 yr\u0022\u003ENovember 14, 2013\u003C/time\u003E by blizzy78\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Majiir","CreatedById":7550,"CreatedDateTime":"2013-11-10T20:27:27Z","Content":"\n\u003Cp\u003ENice work! I\u0027ll be giving this a good look for both Kethane and KAS.\u003C/p\u003E\u003Cp\u003EThe API feels very Java-like, all the way from the class structure to the naming conventions. You might consider using attributes to avoid AchievementFactory which, while serving a purpose in your code, doesn\u0027t do much for API users.\u003C/p\u003E\u003Cp\u003EI\u0027m a huge fan of modding APIs, and I\u0027m glad you opted for the slightly more complex structure. Here\u0027s to this getting a lot of use!\u003C/p\u003E\n"},{"CreatedByName":"blizzy78","CreatedById":68543,"CreatedDateTime":"2013-11-10T22:39:58Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Majiir\u0022 data-cite=\u0022Majiir\u0022\u003E\u003Cdiv\u003EYou might consider using attributes to avoid AchievementFactory which, while serving a purpose in your code, doesn\u0027t do much for API users.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EIt may look like that at first glance, but it actually isn\u0027t that simple. For example, consider the following - simplified - snippet that returns multiple achievements, one for each body in the system:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Epublic IEnumerable\u0026lt;Achievement\u0026gt; getAchievements() {\u003Cbr\u003E  List\u0026lt;Achievement\u0026gt; achievements = new List\u0026lt;Achievement\u0026gt;();\u003Cbr\u003E  foreach (Body body in Body.ALL_LANDABLE)) {\u003Cbr\u003E    achievements.Add(new BodyLanding(body, \u0022One Small Step - \u0022 \u002B body.name));\u003Cbr\u003E  }\u003Cbr\u003E  return achievements;\u003Cbr\u003E}\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EIn this example, the BodyLanding class can be used over and over again, with a different body parameter resulting in a different achievement requirement (the body being landed on.)\u003C/p\u003E\u003Cp\u003EI don\u0027t quite see how to achieve that degree of flexibility using a declarative approach.\u003C/p\u003E\n"},{"CreatedByName":"Whirligig Girl","CreatedById":36077,"CreatedDateTime":"2013-12-03T11:20:37Z","Content":"\n\u003Cp\u003EI am too tired to code right now, but I do have an idea for someone else:\u003C/p\u003E\u003Cp\u003E(hidden) Yup, it\u0027s dead.\u003C/p\u003E\u003Cp\u003Eland within 100 meters of the Kraken\u003C/p\u003E\n"},{"CreatedByName":"blizzy78","CreatedById":68543,"CreatedDateTime":"2013-12-03T11:24:45Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022GregroxMun\u0022 data-cite=\u0022GregroxMun\u0022\u003E\u003Cdiv\u003EI am too tired to code right now, but I do have an idea for someone else:\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThanks, I think this is better suited in the players\u0027 thread: \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/52535\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://forum.kerbalspaceprogram.com/threads/52535\u003C/a\u003E\u003C/p\u003E\n"}]}