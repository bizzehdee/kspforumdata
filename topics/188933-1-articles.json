{"TopicId":188933,"ForumId":36,"TopicTitle":"1.8.0 Modders Notes","CreatedByName":"TriggerAu","CreatedById":57838,"CreatedDateTime":"2019-10-16T12:43:53Z","PageNum":1,"Articles":[{"CreatedByName":"TriggerAu","CreatedById":57838,"CreatedDateTime":"2019-10-16T12:43:53Z","Content":"\n\u003Cp\u003E\nHere\u2019s some notes and details from the team with regards to the changes that come with KSP \u00A01.8.0\u003Cbr\u003E\u003Cspan style=\u0022font-size:20px;\u0022\u003E\u003Cstrong\u003E\u003Cspan style=\u0022color:#3498db;\u0022\u003EUnity Upgrade Summary\u003C/span\u003E\u003C/strong\u003E\u003C/span\u003E\n\u003C/p\u003E\n\u003Cul\u003E\u003Cli\u003E\nKSP now runs on Unity 2019.2.2f1.\n\u003C/li\u003E\n\u003Cli\u003E\nDX11 support. DX9 no longer supported.\n\u003C/li\u003E\n\u003Cli\u003E\n.NET 3.5 is deprecated. So we switch it up to .NET4.x.\n\u003C/li\u003E\n\u003Cli\u003E\n.NET 4 full API.\n\u003C/li\u003E\n\u003Cli\u003E\nNow supporting C# 7.3 with Roslyn Compiler. Though we recommend you consider performance and Garbage generation within Unity when writing your code.\n\u003C/li\u003E\n\u003Cli\u003E\nGPU instancing support.\n\u003C/li\u003E\n\u003Cli\u003E\nPhysX 3.4.2 upgrade.\n\u003C/li\u003E\n\u003Cli\u003E\nNew Incremental Garbage Collector implemented.\n\u003C/li\u003E\n\u003Cli\u003E\nLegacy particle system is gone.\n\u003C/li\u003E\n\u003Cli\u003E\nUnity no longer supports DXT3 compressed DDS format\n\u003C/li\u003E\n\u003C/ul\u003E\u003Cp\u003E\n\u003Cspan style=\u0022font-size:20px;\u0022\u003E\u003Cspan style=\u0022color:#3498db;\u0022\u003E\u003Cstrong\u003EProject Plugin Upgrades\u003C/strong\u003E\u003C/span\u003E\u003C/span\u003E\u003Cbr\u003E\nThis is probably just for info, unlikely to be much direct correlation with mod authoring\n\u003C/p\u003E\n\u003Cul\u003E\u003Cli\u003E\nTextMeshPro is now 1.2.2 in the main project, still not Unity native TMP\n\u003C/li\u003E\n\u003Cli\u003E\nVPP is now SDK V6\n\u003C/li\u003E\n\u003C/ul\u003E\u003Cp\u003E\n\u003Cspan style=\u0022color:#3498db;\u0022\u003E\u003Cstrong\u003E\u003Cspan style=\u0022font-size:20px;\u0022\u003EThings to look out for when Updating C# Plugin DLLs\u003C/span\u003E\u003C/strong\u003E\u003C/span\u003E\n\u003C/p\u003E\n\u003Cul\u003E\u003Cli\u003E\nChange Target framework for your Mod application to .NET framework 4.x (any .NET \u0026gt; 4.x).\n\u003C/li\u003E\n\u003Cli\u003E\nReferences: UnityEngine.DLL is now split across several DLLs. You should at least add UnityEngine.DLL and UnityEngine.CoreModule.DLL to your project references. There will be other references required depending on what the mod needs.\n\u003Cul\u003E\u003Cli\u003E\nadd UnityEngine.IMGUIModule.DLL - for any IMGUI mods.\n\u003C/li\u003E\n\u003Cli\u003E\nadd UnityEngine.InputLegacyModule.DLL - if you are references Input.\n\u003C/li\u003E\n\u003Cli\u003E\nadd UnityEngine.AnimationModule.DLL - if you reference Animations/AnimationState.\n\u003C/li\u003E\n\u003Cli\u003E\nTexture2D.LoadImage - moved to ImageConversion.LoadImage - add UnityEngine.ImageConversionModule.DLL reference.\n\u003C/li\u003E\n\u003Cli\u003E\nadd UnityEngine.AudioModule.DLL for any audio mods.\n\u003C/li\u003E\n\u003C/ul\u003E\u003C/li\u003E\n\u003Cli\u003E\nIf your automating builds using csc directly, nostdlib:, nosdkpath and direct refs to mscorlib, System.Core and System are recommended.\n\u003C/li\u003E\n\u003C/ul\u003E\u003Cp\u003E\n\u003Cspan style=\u0022font-size:20px;\u0022\u003E\u003Cspan style=\u0022color:#3498db;\u0022\u003E\u003Cstrong\u003ENotes about Part Tools\u003C/strong\u003E\u003C/span\u003E\u003C/span\u003E\u003Cbr\u003E\nNew part tools will be made available that contains latest part shaders for DX11 support.\u003Cbr\u003E\nOther than that, the same processes apply as always.\u003Cbr\u003E\u003Cspan style=\u0022font-size:20px;\u0022\u003E\u003Cspan style=\u0022color:#3498db;\u0022\u003E\u003Cstrong\u003ESpecific Changes to KSP\u003C/strong\u003E\u003C/span\u003E\u003C/span\u003E\u003Cbr\u003E\u003Cspan style=\u0022font-size:16px;\u0022\u003E\u003Cstrong\u003EUnity Changes\u003C/strong\u003E\u003C/span\u003E\n\u003C/p\u003E\n\u003Cul\u003E\u003Cli\u003E\nCoroutines returned from a MonoBehaviour while its GameObject is being disabled or destroyed are no longer started and Unity will report them as an error in the log.\n\u003C/li\u003E\n\u003Cli\u003E\nDXT3 DDS formatted textures are not supported by Unity or KSP any more. You must convert to DXT5\n\u003C/li\u003E\n\u003Cli\u003E\nYou should not call the Log or log messages in class constructors.\n\u003C/li\u003E\n\u003Cli\u003E\nGUISkin changes may require specifying ExpandWidth(true) GUIOption in some GUILayout calls - like\u00A0GUILayout.Toggle to maintain visual appearance with 1.7.3 styles\n\u003C/li\u003E\n\u003C/ul\u003E\u003Cp\u003E\n\u003Cstrong\u003E\u003Cspan style=\u0022font-size:16px;\u0022\u003EShaders\u003C/span\u003E\u003C/strong\u003E\n\u003C/p\u003E\n\u003Cul\u003E\u003Cli\u003E\nNew shader variants for the PQS terrain have been added. Low quality shaders are equivalent to the old shaders. Medium quality materials use the \u0022Terrain/PQS/PQS Main - Optimised With Fast Blend\u0022 shader. High quality materials use the \u0022Terrain/PQS/PQS Triplanar Zoom Rotation\u0022 shader.\n\u003C/li\u003E\n\u003Cli\u003E\nThe new PQS shaders require that the tangents be built for the PQS quads. Please turn on the setting for the PQS if you\u2019re going to be using them.\n\u003C/li\u003E\n\u003Cli\u003E\nThe new shader for the \u003Cabbr title=\u0022Kerbal Space Center\u0022\u003EKSC\u003C/abbr\u003E terrain is called \u0022KSP/Scenery/Diffuse Ground \u003Cabbr title=\u0022Kerbal Space Center\u0022\u003EKSC\u003C/abbr\u003E\u0022\n\u003C/li\u003E\n\u003Cli\u003E\nIf your \u0022Shader.Find\u0022 call does not find your old shader you can try to add \u0022Legacy Shaders/\u0022 to the name. LIke \u0022Legacy Shaders/Particles/Additive\u0022\n\u003C/li\u003E\n\u003Cli\u003E\nA number of shaders have been moved to legacy by Unity. However, a number of these have been made available by us in the distribution. Particularly particle shaders that are now marked as Legacy.\n\u003C/li\u003E\n\u003C/ul\u003E\u003Cp\u003E\n\u003Cspan style=\u0022font-size:16px;\u0022\u003E\u003Cstrong\u003EPerformance Changes\u003C/strong\u003E\u003C/span\u003E\u003Cbr\u003E\nA number of tweaks were made to remove unnecessary, or massively repeated processing. Some of these you\u2019ll find in the changelog as they are simply and should have no concern to modding. The below ones are unlikely to have an impact, but here\u0027s some extra detail that could be useful from what we have seen in code and mod testing\n\u003C/p\u003E\n\u003Cul\u003E\u003Cli\u003E\nWe\u2019re caching the list of render meshes when parts are first created instead of \u201Cfinding\u201D them as the time as the meshes don\u2019t change during flight in stock game. If you\u2019re dynamically creating meshes which are then added to the vessel (or removing meshes), they might not be included in the mesh cache. Please call the following methods as appropriate when changing the meshes on a part:\n\u003Cul\u003E\u003Cli\u003E\n\u0060part.ResetModelMeshRenderersCache()\u0060\n\u003C/li\u003E\n\u003Cli\u003E\n\u0060part.ResetModelRenderersCache()\u0060\n\u003C/li\u003E\n\u003Cli\u003E\n\u0060part.ResetModelSkinnedMeshRenderersCache()\u0060\n\u003C/li\u003E\n\u003C/ul\u003E\u003C/li\u003E\n\u003Cli\u003E\nTooltips are now cached and re-used for performance reasons. If you have some information that is left over from a previously displayed tooltip, please make sure to overwrite it. Also, please clear any listeners that you might have on them when they\u2019re finished being used as the methods will continue to be called in the future.\n\u003C/li\u003E\n\u003Cli\u003E\nIf you want to refresh the \u003Cabbr title=\u0022Part Action Window\u0022\u003EPAW\u003C/abbr\u003E for a part, please use MonoUtilities.RefreshPartContextWindow(part) as it has better performance than MonoUtilities.RefreshContextWindows(part)\n\u003C/li\u003E\n\u003Cli\u003E\nInstead of using gameObject.GetComponentUpwards\u0026lt;Part\u0026gt;(), please use FlightGlobals.GetPartUpwardsCached(gameObject) instead for performance reasons. This gets the Part component that on this object or its parents, the first call stores that as a cached value and then returns the cache until the scene changes or the cache is cleared. Similar to the mesh renderer components above, if you are changing the hierarchy of the GOs and the parent Part has changed then there is a reset method you can call to reset the cache: \u0060FlightGlobals.ResetObjectPartUpwardsCache().\u0060\n\u003C/li\u003E\n\u003Cli\u003E\nThe value property of the VesselValues class now calculates the value only on the first \u201Cget\u201D per frame (eg \u0060vessel.AutopilotSkill\u0060). The result is cached and the same result will be returned for the rest of the frame. If you require an uncached version then there is a valueUncached property. If you want to force the value to be updated so that the rest of the code uses it, please call the ResetValueCache() method so the next get call will recalc it.\n\u003C/li\u003E\n\u003Cli\u003E\nThe ProtoModuleSnapshot constructor does not create the confignode string at all times any more. As the configNode should only be used once the part is packed or the vessel is onrails or when making a backup of an existing protomodulesnapshot this was generating massive garbage and CPU hit for no purpose. If your code is accessing the snapshots when the partmodule is active then the suggestion is ensuring to only check that for unloaded vessels)\n\u003C/li\u003E\n\u003C/ul\u003E\u003Cp\u003E\n\u003Cspan style=\u0022font-size:20px;\u0022\u003E\u003Cspan style=\u0022color:#3498db;\u0022\u003E\u003Cstrong\u003EOther Info\u003C/strong\u003E\u003C/span\u003E\u003C/span\u003E\n\u003C/p\u003E\n\u003Cul\u003E\u003Cli\u003E\nKerbalPortraitGallery.ActiveCrew is obsolete. Please use KerbalPortraitGallery.ActiveCrewItems.\n\u003C/li\u003E\n\u003Cli\u003E\nAny mods that have KSPedia slides will likely have to recompiled the slides, please check your slides.\u003Cbr\u003E\n\u00A0\n\u003C/li\u003E\n\u003C/ul\u003E\n"}]}