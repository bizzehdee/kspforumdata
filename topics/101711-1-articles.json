{"TopicId":101711,"ForumId":29,"TopicTitle":"ApplicationLauncher creating extra copies of buttons?","CreatedByName":"johnqevil","CreatedById":119237,"CreatedDateTime":"2015-03-11T04:46:25Z","PageNum":1,"Articles":[{"CreatedByName":"johnqevil","CreatedById":119237,"CreatedDateTime":"2015-03-11T04:46:25Z","Content":"\n\u003Cp\u003EI must be doing something stupid. It seems likely as it\u0027s late here. I\u0027m getting five copies of the same button, and I just can\u0027t figure out why. I\u0027ve even compared code to my previous plugin, and I\u0027m not seeing it. Code below:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Eusing System;\u003Cbr\u003Eusing System.Collections.Generic;\u003Cbr\u003Eusing System.Linq;\u003Cbr\u003Eusing System.Text;\u003Cbr\u003Eusing UnityEngine;\u003Cbr\u003Eusing KSP;\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003Enamespace SpaceRace\u003Cbr\u003E{\u003Cbr\u003E    [KSPAddon(KSPAddon.Startup.EveryScene, false)]\u003Cbr\u003E    public class SpaceRaceMain : MonoBehaviour\u003Cbr\u003E    {\u003Cbr\u003E        private String save_folder;\u003Cbr\u003E        public ApplicationLauncherButton buttonSR;\u003Cbr\u003E        private Rect mainWindow = new Rect(Screen.width / 8 \u002B 100, Screen.height / 4, 400, 125);\u003Cbr\u003E        private Rect trainingWindow = new Rect(Screen.width / 8, Screen.height / 4 \u002B 100, 400, 125);\u003Cbr\u003E        private Rect researchWindow = new Rect(Screen.width / 8, Screen.height / 4 \u002B 100, 400, 125);\u003Cbr\u003E        private Rect rivalWindow = new Rect(Screen.width / 8, Screen.height / 4 \u002B 100, 400, 125); \u003Cbr\u003E        public static SpaceRaceMain InstanceSR;\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E        public void Start()\u003Cbr\u003E        {\u003Cbr\u003E            if (InstanceSR != null)\u003Cbr\u003E            {\u003Cbr\u003E                Destroy(InstanceSR);\u003Cbr\u003E            }\u003Cbr\u003E            InstanceSR = this;\u003Cbr\u003E            Debug.Log(\u0022Firing Start()\u0022);\u003Cbr\u003E            GameEvents.onGUIApplicationLauncherReady.Add(OnGUIAppLauncherReady);\u003Cbr\u003E            save_folder = GetRootPath() \u002B \u0022/saves/\u0022 \u002B HighLogic.SaveFolder \u002B \u0022/\u0022;\u003Cbr\u003E        }\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E        void OnGUIAppLauncherReady()\u003Cbr\u003E        {\u003Cbr\u003E            {\u003Cbr\u003E                this.buttonSR = ApplicationLauncher.Instance.AddModApplication(\u003Cbr\u003E                    onAppLauncherToggleOn,\u003Cbr\u003E                    onAppLauncherToggleOff,\u003Cbr\u003E                    null,\u003Cbr\u003E                    null,\u003Cbr\u003E                    null,\u003Cbr\u003E                    null,\u003Cbr\u003E                    ApplicationLauncher.AppScenes.SPACECENTER,\u003Cbr\u003E                    (Texture)GameDatabase.Instance.GetTexture(\u0022EvilCorp/Textures/icon_button_stock\u0022, false));\u003Cbr\u003E            }\u003Cbr\u003E        }\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E        public void DestroyButtons()\u003Cbr\u003E        {\u003Cbr\u003E            GameEvents.onGUIApplicationLauncherReady.Remove(OnGUIAppLauncherReady);\u003Cbr\u003E            ApplicationLauncher.Instance.RemoveModApplication(buttonSR);\u003Cbr\u003E        }\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E        public static String GetRootPath()\u003Cbr\u003E        {\u003Cbr\u003E            String path = KSPUtil.ApplicationRootPath;\u003Cbr\u003E            path = path.Replace(\u0022\\\\\u0022, \u0022/\u0022);\u003Cbr\u003E            if (path.EndsWith(\u0022/\u0022)) path = path.Substring(0, path.Length - 1);\u003Cbr\u003E            return path;\u003Cbr\u003E        }\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E        void onAppLauncherToggleOn()\u003Cbr\u003E        {\u003Cbr\u003E            Debug.Log(\u0022SpaceRace: Open Menu\u0022);\u003Cbr\u003E            RenderingManager.AddToPostDrawQueue(0, OnDraw);\u003Cbr\u003E        }\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E        void onAppLauncherToggleOff()\u003Cbr\u003E        {\u003Cbr\u003E            Debug.Log(\u0022SpaceRace: Close Menu\u0022);\u003Cbr\u003E            RenderingManager.RemoveFromPostDrawQueue(0, OnDraw);\u003Cbr\u003E        }\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E        private void OnDraw()\u003Cbr\u003E        {\u003Cbr\u003E            mainWindow = GUILayout.Window(65832, mainWindow, OnWindow, \u0022Space Race\u0022);\u003Cbr\u003E        }\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E        private void TrainingDraw()\u003Cbr\u003E        {\u003Cbr\u003E            trainingWindow = GUILayout.Window(87465, trainingWindow, TrainingWindow, \u0022Training Center\u0022);\u003Cbr\u003E        }\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E        private void TrainingWindow(int windowId)\u003Cbr\u003E        {\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E        }\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E        private void ResearchDraw()\u003Cbr\u003E        {\u003Cbr\u003E            researchWindow = GUILayout.Window(76132, researchWindow, ResearchWindow, \u0022Research Center\u0022);\u003Cbr\u003E        }\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E        private void ResearchWindow(int windowId)\u003Cbr\u003E        {\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E        }\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E        private void RivalDraw()\u003Cbr\u003E        {\u003Cbr\u003E            rivalWindow = GUILayout.Window(65324, rivalWindow, RivalWindow, \u0022Rival Space Center\u0022);\u003Cbr\u003E        }\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E        private void RivalWindow(int windowId)\u003Cbr\u003E        {\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E        }\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E        private void OnWindow(int windowId)\u003Cbr\u003E        {\u003Cbr\u003E            GUILayout.BeginHorizontal();\u003Cbr\u003E            if (GUILayout.Button(\u0022Training Center\u0022))\u003Cbr\u003E            {\u003Cbr\u003E                RenderingManager.AddToPostDrawQueue(0, TrainingDraw);\u003Cbr\u003E            }\u003Cbr\u003E            GUILayout.EndHorizontal();\u003Cbr\u003E            GUILayout.BeginHorizontal();\u003Cbr\u003E            if (GUILayout.Button(\u0022Research Center\u0022))\u003Cbr\u003E            {\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E            }\u003Cbr\u003E            GUILayout.EndHorizontal();\u003Cbr\u003E            GUILayout.BeginHorizontal();\u003Cbr\u003E            if (GUILayout.Button(\u0022View Rival Space Center\u0022))\u003Cbr\u003E            {\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E            }\u003Cbr\u003E            GUILayout.EndHorizontal();\u003Cbr\u003E        }\u003Cbr\u003E    }\u003Cbr\u003E}\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-03-11T04:50:33Z\u0022 title=\u002203/11/2015 04:50  AM\u0022 data-short=\u00229 yr\u0022\u003EMarch 11, 2015\u003C/time\u003E by johnqevil\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2015-03-11T04:55:09Z","Content":"\n\u003Cp\u003ENothing calls DestroyButtons() (you want to do that in OnDestroy())\u003C/p\u003E\n"},{"CreatedByName":"johnqevil","CreatedById":119237,"CreatedDateTime":"2015-03-11T04:56:10Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Crzyrndm\u0022 data-cite=\u0022Crzyrndm\u0022\u003E\u003Cdiv\u003ENothing calls DestroyButtons() (you want to do that in OnDestroy())\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ETold you it was something stupid \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 alt=\u0022:D\u0022\u003E. Thanks!\u003C/p\u003E\u003Cp\u003EEDIT: Yup, that did it!\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-03-11T05:02:35Z\u0022 title=\u002203/11/2015 05:02  AM\u0022 data-short=\u00229 yr\u0022\u003EMarch 11, 2015\u003C/time\u003E by johnqevil\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"stupid_chris","CreatedById":62017,"CreatedDateTime":"2015-03-11T05:33:35Z","Content":"\n\u003Cp\u003EAlso, I believe it\u0027s worth mentioning that I believe passing those parameters as null could cause errors. Just create an empty method and pass that instead.\u003C/p\u003E\n"},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2015-03-11T05:41:57Z","Content":"\n\u003Cp\u003EI\u0027ve not had any issues using null to fill in the blanks?\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-03-11T05:47:54Z\u0022 title=\u002203/11/2015 05:47  AM\u0022 data-short=\u00229 yr\u0022\u003EMarch 11, 2015\u003C/time\u003E by Crzyrndm\u003C/strong\u003E\n\u003C/span\u003E\n"}]}