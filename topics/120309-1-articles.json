{"TopicId":120309,"ForumId":15,"TopicTitle":"Making Normal map in gimp","CreatedByName":"Vorg","CreatedById":74652,"CreatedDateTime":"2015-09-06T23:10:50Z","PageNum":1,"Articles":[{"CreatedByName":"Vorg","CreatedById":74652,"CreatedDateTime":"2015-09-06T23:10:50Z","Content":"\n\u003Cp\u003EI\u0027ve been playing around with a custom kerbal head texture adding some detail, right now just throat and teeth (all that white, but only a tiny area is used). I want to make a normal map. gray desaturated it and then stretched the level range. I then used gaussian and selective gaussian blur with low settings to remove the gradient created by stretching the range. But I find the normal map plugin has a lot of settings. Do I just use default? or do some need changing? \u003C/p\u003E\u003Cp\u003EAlso for saving, I see there is a DXT5nm .dds format option. I\u0027m guessing that is the correct format to use?\u003C/p\u003E\n"},{"CreatedByName":"Shadowmage","CreatedById":138730,"CreatedDateTime":"2015-09-08T21:04:11Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Vorg\u0022 data-cite=\u0022Vorg\u0022\u003E\u003Cdiv\u003EI\u0027ve been playing around with a custom kerbal head texture adding some detail, right now just throat and teeth (all that white, but only a tiny area is used). I want to make a normal map. gray desaturated it and then stretched the level range. I then used gaussian and selective gaussian blur with low settings to remove the gradient created by stretching the range. But I find the normal map plugin has a lot of settings. Do I just use default? or do some need changing? \u003Cp\u003EAlso for saving, I see there is a DXT5nm .dds format option. I\u0027m guessing that is the correct format to use?\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EMy personal settings for the GIMP normal-map plugin are:\u003C/p\u003E\u003Cp\u003EFilter Type: Sobel 3x3 (though, you can play around to find what works best for you)\u003C/p\u003E\u003Cp\u003Etick the check-box for \u0027invert Y\u0027 (needed, as otherwise the normals come out...uhh..partially inverted)\u003C/p\u003E\u003Cp\u003EAll other settings left at default\u003C/p\u003E\u003Cp\u003EYes, DXT5nm is the correct format for normal maps.\u003C/p\u003E\n"},{"CreatedByName":"Gaalidas","CreatedById":111158,"CreatedDateTime":"2015-09-09T19:55:36Z","Content":"\n\u003Cp\u003E...\u003Cem\u003EIF\u003C/em\u003E using dds that is. DXT5nm causes it to become a pinkish-hued normal map and removes a lot of details from the map as a whole... at least in \u003Cem\u003Emost\u003C/em\u003E cases. There are some outlying cases where the resulting normal doesn\u0027t get a hue change at all. I\u0027ve found that highly-detailed normal maps, especially with vertical-line details in it, will loose a lot of those details in the conversion. You might get around that by making the normal map with the original texture already inverted, and using higher-detail filters like the Sobel 3x3 may also help. For some normal maps, I\u0027ve had to resort to leaving them in png format to keep the finer details alive.\u003C/p\u003E\u003Cp\u003EHowever, if doing it the manual way like you described works best for you, all power to you. You can still save in the DXT5nm format, you\u0027ll just want to make sure your y-axis of the normal is properly oriented like it does when inverting the Y axis in the normal map plugin. I honestly don\u0027t understand it enough to explain it here.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-09-09T19:58:06Z\u0022 title=\u002209/09/2015 07:58  PM\u0022 data-short=\u00228 yr\u0022\u003ESeptember 9, 2015\u003C/time\u003E by Gaalidas\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Vorg","CreatedById":74652,"CreatedDateTime":"2016-03-14T02:45:35Z","Content":"\n\u003Cp\u003E\nI\u0027ve been messing with this some more and ran into more problems. KSP seems to have partly locked the light source to below the kerbal, so shadows are above instead of below. Also, KSP randomly inverts the ears.\n\u003C/p\u003E\n\u003Cp\u003E\nHere is the normal map: \u003Ca href=\u0022https://www.dropbox.com/s/3frgyzadknczn7f/kerbalHeadNRM.dds?dl=0\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://www.dropbox.com/s/3frgyzadknczn7f/kerbalHeadNRM.dds?dl=0\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nAnd here is the grey scale: \u003Ca href=\u0022https://www.dropbox.com/s/5k8ilsr6utnaivq/kerbalHeadNMGrey.png?dl=0\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://www.dropbox.com/s/5k8ilsr6utnaivq/kerbalHeadNMGrey.png?dl=0\u003C/a\u003E\n\u003C/p\u003E\n"},{"CreatedByName":"InsaneDruid","CreatedById":137849,"CreatedDateTime":"2016-03-14T19:30:55Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222170562\u0022 data-ipsquote-contentid=\u0022120309\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221441828536\u0022 data-ipsquote-userid=\u0022111158\u0022 data-ipsquote-username=\u0022Gaalidas\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nOn 9.9.2015 at 9:55 PM, Gaalidas said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\n...\u003Cem\u003EIF\u003C/em\u003E using dds that is. DXT5nm causes it to become a pinkish-hued normal map and removes a lot of details from the map as a whole... at least in \u003Cem\u003Emost\u003C/em\u003E cases. There are some outlying cases where the resulting normal doesn\u0027t get a hue change at all. I\u0027ve found that highly-detailed normal maps, especially with vertical-line details in it, will loose a lot of those details in the conversion. You might get around that by making the normal map with the original texture already inverted, and using higher-detail filters like the Sobel 3x3 may also help. For some normal maps, I\u0027ve had to resort to leaving them in png format to keep the finer details alive.\n\u003C/p\u003E\n\u003Cp\u003E\nHowever, if doing it the manual way like you described works best for you, all power to you. You can still save in the DXT5nm format, you\u0027ll just want to make sure your y-axis of the normal is properly oriented like it does when inverting the Y axis in the normal map plugin. I honestly don\u0027t understand it enough to explain it here.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nUnfortunately, that is quite wrong.\n\u003C/p\u003E\n\u003Cp\u003E\nFirst, please keep in mind that a normal map doesn\u0027t store color. It stores x/y/z coordinates in object or tangent space.\n\u003C/p\u003E\n\u003Cp\u003E\nDXT5nm INCREASES the quality when using dds as it stores the information in the green and alpha channels of the image (which are compressed less lossy - red 5bits, green 6bits, blue 5bits, alpha 8bits - for the eye is mostly sensitive in green-ish wavelenghts and you need 8 bits=256 values for smooth alpha), while not storying the z coordinates as it can be reprocuded from the rest of the information and filling the red and blue ones with a single color to minimize compression artefacts as the compressors are usually comparing the differences between the channels to weight the lossy compression that is used (what color exactly can be variing, when using white, the result will be the pinkish hue as described).\n\u003C/p\u003E\n\u003Cp\u003E\nAs the channels are swizzled, its obvious why, when looked at with a standard image viewer, a \u0022loss\u0022 of (vertical) detail may be seen. Because this information in now in the alpha channel!\n\u003C/p\u003E\n\u003Cp\u003E\nSo long story short: dxt5nm uses some tricks (only storing x and y coordinates \u002B storing them in the channels with the least lossy compression \u002B minimizing artefacts by not storing different data in red and blue channels) to increase the quality of a normal map stored in a dds file. The flipped storage has nothing to do with dxt5nm.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022http://forum.kerbalspaceprogram.com/index.php?/profile/74652-vorg/\u0026amp;do=hovercard\u0022 data-mentionid=\u002274652\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/74652-vorg/\u0022\u003E@Vorg\u003C/a\u003E: could be false coordinates. KSP uses y\u002B up, x\u002B right. z- far\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-03-14T19:37:59Z\u0022 title=\u002203/14/2016 07:37  PM\u0022 data-short=\u00228 yr\u0022\u003EMarch 14, 2016\u003C/time\u003E by InsaneDruid\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Vorg","CreatedById":74652,"CreatedDateTime":"2016-03-14T22:40:33Z","Content":"\n\u003Cp\u003E\nSo how do I fix it? I use Invert Y when making the normal to get the normal map to look as expected. There is also an Invert X That I leave unchecked along with swap RGB\n\u003C/p\u003E\n\u003Cp\u003E\nFor Filter I have tried Sobel and Prewitt 3x3. Sobel looks a bit crisper in the preview window. 5x5 seems to scale too much making it clip in some areas.\n\u003C/p\u003E\n\u003Cp\u003E\nI leave Minimum Z at 0 and Scale at 1. I messed with fractional scales and the 5x5 options, but it didn\u0027t look like it was working as well and if it is scaled any more, you get the stair step from using 8 bit 256 grey scale. I don\u0027t know if Gimp can do 16 bit grey scale. But I would have to then smooth it which gets tricky not to smooth stuff you don\u0027t want smoothed.\n\u003C/p\u003E\n\u003Cp\u003E\nI leave the other settings default, Height Source: RGB, Alpha Channel: unchanged, conversion: none, DU/DV map: none. I tried googling more info on this plugin, but there just doesn\u0027t seem to be much. Everyone assumes you know exactly what all the settings are and do or know code well enough to read through it and figure it out.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nThere are also some option in the dds export that may or may not help, but I don\u0027t think so: \u0022Use Perceptural error metric\u0022, \u0022Apply gamma correction\u0022, Preserve alpha test coverage.\n\u003C/p\u003E\n"},{"CreatedByName":"Vorg","CreatedById":74652,"CreatedDateTime":"2016-03-17T00:00:11Z","Content":"\n\u003Cp\u003E\nMore testing and I am noticing that the lighting is wrong. When on the pad, light should be coming from above and the base kerbal is lit up correctly. But the normal map is providing a secondary lighting matching how the normal map image is lit. When viewing it with just an image viewer and in Gimp, you see light under the noise and ears, etc. It\u0027s as if a light is above the image which gives it the 3d effect. But that lighting seems to be burned in. A normals map is supposed to tell the game engine how to reflect the light across the texture to ad the 3d effect, not add lighting. I have tried making the light effect come from the top, but Gimp will only put the light from above. If I create the map and rotate it to match KSP\u0027s strange upsidown requirement for dds files, gimp inverts the image. And KSP shouldn\u0027t be using that light source anyway.\n\u003C/p\u003E\n"},{"CreatedByName":"InsaneDruid","CreatedById":137849,"CreatedDateTime":"2016-03-17T16:06:13Z","Content":"\n\u003Cp\u003E\nA normal map provides no light source. Never. As said before: a normal map doesn\u0027t store color or brightness. It stores information about the normals (and thus the angle of an surface in a point). Its just an array of arrays of data, stored in an existing file format that is usually used for images.\n\u003C/p\u003E\n\u003Cp\u003E\nI don\u0027t use gimp and create my normals with shadermap2. So, I cant tell what buttons to press as I don\u0027t know what buttons there are \u003Cimg alt=\u0022;)\u0022 data-emoticon=\u0022true\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif\u0022 title=\u0022;)\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nCan you make a screenshot of the head in game? What you describe sounds like the normal map procudes an inverted effect of what you want, ie bumps that should be higher than the average are shaded like they are indentations, and vice versa?\n\u003C/p\u003E\n"},{"CreatedByName":"Vorg","CreatedById":74652,"CreatedDateTime":"2016-03-17T20:56:36Z","Content":"\n\u003Cp\u003E\nDon\u0027t have time to fire it up now. Maybe latter tonight. I\u0027m finding the invert problem changes with nearly every tweak I try. Always, at least 1 ear is inverted, sometimes both. Sometimes the nose is inverted, sometimes not. But always something. Not even been looking in the mouth because to get them to open wide and keep the mouth open, I launch them and eva a few Km up letting them fall. Get a nice view inside then :).\n\u003C/p\u003E\n\u003Cp\u003E\nThe Normal map link and a PNG of the grey scale I\u0027m using atm is posted a few post up. Here is the normal: \u003Ca href=\u0022https://www.dropbox.com/s/3frgyzadknczn7f/kerbalHeadNRM.dds?dl=0\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://www.dropbox.com/s/3frgyzadknczn7f/kerbalHeadNRM.dds?dl=0\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nJust put that in the \u0022default\u0022 folder for texture replacer. Then put a command pod on the pad with a male kerbal in it (teeth also work for females, but not the outside of the face where the problem seems to be), and eva him.\n\u003C/p\u003E\n"},{"CreatedByName":"InsaneDruid","CreatedById":137849,"CreatedDateTime":"2016-03-18T10:30:47Z","Content":"\n\u003Cp\u003E\nAs I said, its just inverted (hights are lows and lows are heights). By inverting the grayscale heightmap it \u003Cem\u003Eshould \u003C/em\u003Ecome out\u003Cem\u003E \u003C/em\u003Eok. Or there may be an option in the filter for gimp. As I said, I never use Gimp. Maybe invert scale?\n\u003C/p\u003E\n\u003Cp\u003E\nI generated a test map with shadermap and everything is fine. \u003Ca href=\u0022http://abload.de/image.php?img=untitled-16kq5l.jpg\u0022\u003E\u003Cimg src=\u0022http://abload.de/thumb/untitled-16kq5l.jpg\u0022 class=\u0022ipsImage\u0022 alt=\u0022untitled-16kq5l.jpg\u0022\u003E\u003C/a\u003E.\n\u003C/p\u003E\n"},{"CreatedByName":"Vorg","CreatedById":74652,"CreatedDateTime":"2016-03-18T22:57:26Z","Content":"\n\u003Cp\u003E\nThat smooth area around the eyes wouldn\u0027t even show up for me. Did some more testing with starting with inverted grey scale, etc. Ether it would be all inverted or partly inverted. So I tried something else. I rotated the image 180 for the PNG format (think maybe it is flipped, not rotated, textures where not aligned.) and used the default PNG options which had max compression set. And it worked. Still not as pronounced as what you have, but it was all there. Even the lip area which wasn\u0027t showing, now gives a sharp double lip. The grey scale needs much more work now that more of it gets through.\n\u003C/p\u003E\n\u003Cp\u003E\nSo, the problem is in the DDS Export plugin. It also has a lot of options, anyone of which may be the problem, or none of them. The little expermenting I did with those options seem to make things much worse right off before even trying it in game.\n\u003C/p\u003E\n"},{"CreatedByName":"InsaneDruid","CreatedById":137849,"CreatedDateTime":"2016-03-19T10:28:34Z","Content":"\n\u003Cp\u003E\nSorry, can\u0027t help you there with gimp.\n\u003C/p\u003E\n"},{"CreatedByName":"Gaalidas","CreatedById":111158,"CreatedDateTime":"2016-05-02T17:28:01Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222456941\u0022 data-ipsquote-contentid=\u0022120309\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221457983855\u0022 data-ipsquote-userid=\u0022137849\u0022 data-ipsquote-username=\u0022InsaneDruid\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nOn 3/14/2016 at 0:30 PM, InsaneDruid said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nUnfortunately, that is quite wrong.\n\u003C/p\u003E\n\u003Cp\u003E\nFirst, please keep in mind that a normal map doesn\u0027t store color. It stores x/y/z coordinates in object or tangent space.\n\u003C/p\u003E\n\u003Cp\u003E\nDXT5nm INCREASES the quality when using dds as it stores the information in the green and alpha channels of the image (which are compressed less lossy - red 5bits, green 6bits, blue 5bits, alpha 8bits - for the eye is mostly sensitive in green-ish wavelenghts and you need 8 bits=256 values for smooth alpha), while not storying the z coordinates as it can be reprocuded from the rest of the information and filling the red and blue ones with a single color to minimize compression artefacts as the compressors are usually comparing the differences between the channels to weight the lossy compression that is used (what color exactly can be variing, when using white, the result will be the pinkish hue as described).\n\u003C/p\u003E\n\u003Cp\u003E\nAs the channels are swizzled, its obvious why, when looked at with a standard image viewer, a \u0022loss\u0022 of (vertical) detail may be seen. Because this information in now in the alpha channel!\n\u003C/p\u003E\n\u003Cp\u003E\nSo long story short: dxt5nm uses some tricks (only storing x and y coordinates \u002B storing them in the channels with the least lossy compression \u002B minimizing artefacts by not storing different data in red and blue channels) to increase the quality of a normal map stored in a dds file. The flipped storage has nothing to do with dxt5nm.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022http://forum.kerbalspaceprogram.com/index.php?/profile/74652-vorg/\u0026amp;do=hovercard\u0022 data-mentionid=\u002274652\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/74652-vorg/\u0022 rel=\u0022\u0022\u003E@Vorg\u003C/a\u003E: could be false coordinates. KSP uses y\u002B up, x\u002B right. z- far\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nAh... good to know.\u00A0 I was only speaking from my experience.\u00A0 The expertise simply doesn\u0027t exist in my brain.\u00A0 They sure \u003Cem\u003Elook\u003C/em\u003E less detailed though, which really stinks.\n\u003C/p\u003E\n"}]}