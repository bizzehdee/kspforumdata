{"TopicId":186865,"ForumId":104,"TopicTitle":"Atmosphere Gauge calcs","CreatedByName":"cyberKerb","CreatedById":28891,"CreatedDateTime":"2019-07-31T14:21:43Z","PageNum":1,"Articles":[{"CreatedByName":"cyberKerb","CreatedById":28891,"CreatedDateTime":"2019-07-31T14:21:43Z","Content":"\n\u003Cp\u003E\nI\u0027m read a range of forum post, the wiki, the wiki discussion and reddit, but there doesn\u0027t seem to be a known calculation for deriving the Atmosphere Gauge value between 0-1\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027ve seen how the \u003Ca href=\u0022https://github.com/MOARdV/AvionicsSystems/blob/master/Source/MASVesselComputer.cs#L318\u0022 rel=\u0022external nofollow\u0022\u003ERPM/MAS mod\u003C/a\u003E hooks into the object to read the value directly, but I was wondering if anyone had worked out the calculations to match the gauges values?\u003Cbr\u003E\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/129946-richfiles/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022129946\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/129946-richfiles/\u0022 rel=\u0022\u0022\u003E@richfiles\u003C/a\u003E\u00A0- did you end up working out the details for your gauge? I saw the comment about atmos being \u0022\u003Cspan style=\u0022background-color:#ffffff;color:#353c41;font-size:14px;\u0022\u003E\u003Cspan\u003E\u00A0\u003C/span\u003E.000001 of 1 ASL atmosphere\u003C/span\u003E\u0022, but where do you calculate or grab that 1 ASL value from in the API? Is it a lookup table?\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222019-07-31T14:51:42Z\u0022 title=\u002207/31/2019 02:51  PM\u0022 data-short=\u00224 yr\u0022\u003EJuly 31, 2019\u003C/time\u003E by wile1411\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"richfiles","CreatedById":129946,"CreatedDateTime":"2019-07-31T22:48:20Z","Content":"\n\u003Cp\u003E\n\u003Cimg alt=\u0022bflkbyL.jpg\u0022 class=\u0022ipsImage\u0022 data-ratio=\u002265.13\u0022 height=\u0022666\u0022 width=\u00221024\u0022 src=\u0022https://i.imgur.com/bflkbyL.jpg\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nIn the end, I found the issue to be such a pain, \u003Cs\u003EI just went with a 0-100% scale.\u003C/s\u003E\u00A0\u003Cimg alt=\u0022:confused:\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_huh.gif\u0022 title=\u0022:confused:\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nThe issue ended up being trying to apply a scale based on the number of divisions the KSP onscreen atmosphere density readout shows. I think it was an odd number, and at one point I\u0027d considered going with \u003Cu\u003E\u003Cem\u003Ean order of magnitude scale, adding a decimal location and a zero to the density each time\u003C/em\u003E\u003C/u\u003E. \u003Cspan style=\u0022font-size:9px;\u0022\u003E\u003Cem\u003E(This is actually what I did, but with SI units)\u003C/em\u003E\u003C/span\u003E.\u00A0I decided I didn\u0027t like the guestimation nature of that, the fact that it might not represent actual numerical values, and the fact that even the onscreen one has no numeric values, I ultimately went with \u003Cs\u003Epercentage\u003C/s\u003E.\u00A0\u003Cem\u003E\u003Cspan style=\u0022font-size:9px;\u0022\u003E(went with an order of magnitude scale that\u00A0references ASL density and scales over an\u00A0arbitrary order of magnitude scale)\u003C/span\u003E\u003C/em\u003E\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222019-07-31T23:25:22Z\u0022 title=\u002207/31/2019 11:25  PM\u0022 data-short=\u00224 yr\u0022\u003EJuly 31, 2019\u003C/time\u003E by richfiles\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"cyberKerb","CreatedById":28891,"CreatedDateTime":"2019-07-31T22:51:53Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223644032\u0022 data-ipsquote-contentid=\u0022186865\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221564613300\u0022 data-ipsquote-userid=\u0022129946\u0022 data-ipsquote-username=\u0022richfiles\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nJust now, richfiles said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nIn the end, I found the issue to be such a pain, I just went with a 0-100% scale.\u00A0\u003Cimg alt=\u0022:confused:\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_huh.gif\u0022 title=\u0022:confused:\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nThe issue ended up being trying to apply a scale based on the number of divisions the KSP onscreen atmosphere density readout shows. I think it was an odd number, and at one point I\u0027d considered going with an order of magnitude scale, adding a decimal location and a zero to the density each time. I decided I didn\u0027t like the guestimation nature of that, the fact that it might not represent actual numerical values, and the fact that even the onscreen one has no numeric values, I ultimately went with percentage.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nDid you use the \u0027Density\u0027 value that is the only atmos value in the KSSerialIO mod? If so, what were you using as the max number you were dividing by to get the percent?\u003Cbr\u003E\ngithub source line:\u00A0KSPSerialPort.VData.Density = (float)ActiveVessel.atmDensity;\n\u003C/p\u003E\n\u003Cp\u003E\nOr did you fork the\u00A0KSSerialIO and add your own value? I want interested to know what you ended up with sourcewise see at the Max value changes for each celestialbody.\n\u003C/p\u003E\n"},{"CreatedByName":"richfiles","CreatedById":129946,"CreatedDateTime":"2019-07-31T23:22:06Z","Content":"\n\u003Cp\u003E\nI was about to come back and change my post. I\u0027ll just add, I guess. I have done \u003Cem\u003Eno\u003C/em\u003E software yet. Between getting hurt at work in 2016, The Nintendo Switch coming out (with a new Zelda) in 2017 (which was an easy pastime while dealing with a healing shoulder), and the latter half of 2017 and all of 2018 being absolute madness at my old job, with them trying to cut labor down, but not the workload, I hadn\u0027t touched this since way back then.\n\u003C/p\u003E\n\u003Cp\u003E\nHad I scrolled just another screen or two down, I\u0027d have seen where I did come up with a scale of atmospheres, rather than percentage.\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u00222oW4UhH.png\u0022 class=\u0022ipsImage\u0022 data-ratio=\u002259.51\u0022 height=\u0022609\u0022 width=\u00221024\u0022 src=\u0022https://i.imgur.com/2oW4UhH.png\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nNow I remember it. It\u0027s still a \u0022relative\u0022 scale, like percentage, but at least this one has a unit (being a single atmosphere at sea level). As I said, it\u0027s been a long time since looking into this stuff, so I\u0027d forgotten how the atmospheric density was sent.\n\u003C/p\u003E\n\u003Cp\u003E\nSounds like it\u0027s based on an actual numeric value. Presumably, you\u0027d want a lookup table with every body that has an atmosphere. You\u0027d have to read your \u003Cabbr title=\u0022Sphere of Influence\u0022\u003ESoI\u003C/abbr\u003E, I think, to pull the right value, and then just divide that by the number of steps your output resolution supports (if it\u0027s an 8-bit output, then divide it by 255, for example). You would just divide the atmospheric density value sent by the plugin by that value. You could just store the result of dividing\u00A0max atmospheric density for each separate body\u00A0by 255 in your lookup table. The scale isn\u0027t a hard numeric translation either. I WAS correct in recalling one thing. The numbers are krackenspew. I derived them purely by taking the onscreen Atmospheric density meter and it\u0027s four shading\u00A0divisions, and divided the graduations on the scale\u00A0into seven divisions, simply to line up\u00A0with an order of magnitude scale that \u003Cem\u003Elooks\u003C/em\u003E pretty, has one end at 1 ASL,\u00A0and has a low value at the other end\u00A0that is more or less\u00A0considered \u0022near vacuum\u0022. There\u0027s literally nothing more to it. Their gauge is an awful jumble of graduations that the scale makes little sense to me. Software wise, it will be a proportional linear scale, based on the numeric value sent. If it displays wildly differently than what\u0027s on screen, then it probably will get tweaked, but I\u0027m a long way away from software. If it is positionally similar, then I won\u0027t touch a thing.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222019-07-31T23:36:18Z\u0022 title=\u002207/31/2019 11:36  PM\u0022 data-short=\u00224 yr\u0022\u003EJuly 31, 2019\u003C/time\u003E by richfiles\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"cyberKerb","CreatedById":28891,"CreatedDateTime":"2019-08-02T07:07:31Z","Content":"\n\u003Cp\u003E\nThanks \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/129946-richfiles/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022129946\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/129946-richfiles/\u0022 rel=\u0022\u0022\u003E@richfiles\u003C/a\u003E\u00A0for going back and looking through all that. It covered what I\u0027d already read on the forum.\n\u003C/p\u003E\n\u003Cp\u003E\nHere\u0027s what my searching uncovered:\n\u003C/p\u003E\n\u003Cp\u003E\nRPM formula for Atmo Depth that is used when the gauge GUI object is unavailable::\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003EupperAtmosphereLimit = Math.Log(100000.0);\n\ndepth = (float)\n\t\t(\n\t\t  (\n\t\t    upperAtmosphereLimit \u002B Math.Log\n\t\t      (\n\t\t      FlightGlobals.getAtmDensity(vessel.staticPressurekPa * PhysicsGlobals.KpaToAtmospheres, FlightGlobals.Bodies[1].atmosphereTemperatureSeaLevel)\n\t\t      /\n\t\t      FlightGlobals.getAtmDensity(FlightGlobals.currentMainBody.atmospherePressureSeaLevel, FlightGlobals.currentMainBody.atmosphereTemperatureSeaLevel)\n\t\t      )\n\t\t  )\n\t\t  /\n\t\t  upperAtmosphereLimit\n\t\t).Clamp(0.0f, 1.0f);\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nI came up with the following formula trying to match the density curve to the GUI gauge curve during a test launch.\u003Cbr\u003E\u003Cs\u003EVDensity = (vesselairpressure*1000)/(287.053*atmosTempK)\u003Cbr\u003E\nGauge % = 10^(LOG(VDensity)/4)-0.021808\u003C/s\u003E\u003Cbr\u003E\u003Cbr\u003E\nIn \u0022spreadsheet land\u0022, it stays within 0.02% of the gauge (on average). It\u0027s worst when the pressure is really low near space.\u00A0I\u0027ll run both calcs, the RPM \u0026amp; my kluged version, \u00A0tonight to see how they compare to the actual gauge value.\n\u003C/p\u003E\n\u003Cp\u003E\nEdit: OK the kludged version works well, but only for Kerbin - kinda expected. Now to throw more formulas and to plug numbers in until I get the curve I\u0027m expecting.\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cs\u003EKSPSerialPort.VData.AmtosDepth = (float)Math.Pow(10, ((Math.Log((ActiveVessel.staticPressurekPa * 1000.0f) / (287.53f * ActiveVessel.atmosphericTemperature), 10.0)) / 4) - 0.021808f);\u003C/s\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nEdit2: Better calc at bottom of thread\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222019-08-03T11:14:05Z\u0022 title=\u002208/03/2019 11:14  AM\u0022 data-short=\u00224 yr\u0022\u003EAugust 3, 2019\u003C/time\u003E by wile1411\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"cyberKerb","CreatedById":28891,"CreatedDateTime":"2019-08-02T14:38:38Z","Content":"\n\u003Cp\u003E\nOk - I\u0027m done for the night. I\u0027ve taken the non-math/Kerbal\u00A0route to try to get something together for this math problem.\u003Cbr\u003E\nThe results aren\u0027t bad, as all values are within \u002B-0.5%\u003Cbr\u003E\nI would be good if someone who is more knowledgeable that me in this area to see if they can tease out the correct formula. My fumbling in excel was just tweaking the shape of charts based on formulas to make expected lines match.\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cstrong\u003EKludge Calculations\u003C/strong\u003E\u003Cbr\u003E\u003Cu\u003EStep 1\u003C/u\u003E\u003Cbr\u003E\u003Cs\u003ECalcAirDensity = (float)(ActiveVessel.staticPressurekPa*PhysicsGlobals.KpaToAtmospheres*1000/(287.058*ActiveVessel.atmosphericTemperature));\u003Cbr\u003E\nOr\u003Cbr\u003E\nCalcAirDensity = (float)FlightGlobals.getAtmDensity(ActiveVessel.staticPressurekPa * PhysicsGlobals.KpaToAtmospheres, ActiveVessel.atmosphericTemperature);\u003C/s\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nNote: Don\u0027t use\u00A0(float)ActiveVessel.atmDensity My wild guess is that this might be a legacy property. The atmDensity field doesn\u0027t have a value\u00A0until it\u0027s \u0026gt;= 0.00000001.\u003Cbr\u003E\nI need to recheck if\u00A0the GUI gauge is still showing \u0026gt; 0 in these cases or if it\u0027s zeroing ahead of time, but I don\u0027t think this is the case. My logging shows that GUI gauge still has values all the way until pressure is 0.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cu\u003EStep 2\u003C/u\u003E\u003Cbr\u003E\u003Cs\u003E(float)(Math.Exp((Math.Log(CalcAirDensity) / 4) - \u003Cstrong\u003EBodyVal\u003C/strong\u003E) * 10)\u003C/s\u003E\u003Cbr\u003E\nSubstitute the BodyVal with applicable value below.\u003Cbr\u003E\nDon\u0027t ask me\u00A0where \u00274\u0027 come from - I randomly entered it in and the gradient of the chart matched\u00A0what I was looking for. So I went with it.\u00A0\u003Cimg alt=\u0022:confused:\u0022 data-emoticon=\u0022\u0022 data-ratio=\u0022105.88\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_huh.gif\u0022 title=\u0022:confused:\u0022 width=\u002217\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\n\u003Cstrong\u003EBodyVal \u003C/strong\u003Enumber based on testing\u003Cbr\u003E\u003Cs\u003EKerbin =\u00A01.1983\u003Cbr\u003E\nDuna =\u00A00.575\u003Cbr\u003E\nLaythe = 1.0811\u003Cbr\u003E\nEve =\u00A01.5071\u003C/s\u003E\u003Cbr\u003E\nIf anyone works out how these can be derived from the celestial body properties, let me know.\n\u003C/p\u003E\n\u003Cp\u003E\nThis gives me an atmosphere value between 0.0 - 1.0 that correlates closely to the Atmosphere Gauge on the GUI.\n\u003C/p\u003E\n\u003Cp\u003E\nIf you fork\u00A0your own KerbalSerialIO, you could add the code in C# to a variable in then you\u0027ll be able use the value for setting a physical gauge.\u003Cbr\u003E\nHowever, this isn\u0027t intended to be a \u0027solution\u0027, just a step towards finding the right formula.\u003Cbr\u003E\nPinging a few people who might be interested / serious math god. \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/11842-zitronen/\u0026amp;do=hovercard\u0022 data-mentionid=\u002211842\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/11842-zitronen/\u0022 rel=\u0022\u0022\u003E@zitronen\u003C/a\u003E, \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/183934-hugopeeters/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022183934\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/183934-hugopeeters/\u0022 rel=\u0022\u0022\u003E@hugopeeters\u003C/a\u003E\u00A0\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/129946-richfiles/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022129946\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/129946-richfiles/\u0022 rel=\u0022\u0022\u003E@richfiles\u003C/a\u003E\u00A0\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/2521-arrowstar/\u0026amp;do=hovercard\u0022 data-mentionid=\u00222521\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/2521-arrowstar/\u0022 rel=\u0022\u0022\u003E@Arrowstar\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cstrong\u003EEDIT: found better formula - see below.\u003C/strong\u003E\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222019-08-03T09:54:50Z\u0022 title=\u002208/03/2019 09:54  AM\u0022 data-short=\u00224 yr\u0022\u003EAugust 3, 2019\u003C/time\u003E by wile1411\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"zitronen","CreatedById":11842,"CreatedDateTime":"2019-08-02T17:24:52Z","Content":"\n\u003Cp\u003E\nIs it not just air density? Where sea level is 100% (1.225kg/m^3) and space is 0%?\n\u003C/p\u003E\n"},{"CreatedByName":"cyberKerb","CreatedById":28891,"CreatedDateTime":"2019-08-03T00:08:50Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223644802\u0022 data-ipsquote-contentid=\u0022186865\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221564766692\u0022 data-ipsquote-userid=\u002211842\u0022 data-ipsquote-username=\u0022zitronen\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n16 hours ago, zitronen said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nIs it not just air density? Where sea level is 100% (1.225kg/m^3) and space is 0%?\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThe numbers moved out of sync with what I was seeing on the gauge when I used\u00A0density / sea level.\u003Cbr\u003E\nI tried that initially and these are the values for the foll0wing calc:\u003Cbr\u003E\n\u00A0ActiveVessel.atmDensity\u00A0 \u00A0/\u00A0 \u00A0FlightGlobals.getAtmDensity(FlightGlobals.currentMainBody.atmospherePressureSeaLevel, FlightGlobals.currentMainBody.atmosphereTemperatureSeaLevel);\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003EatmDensity\t   SL Density\t   Result\tActual Gauge\n0.80186027\t/  1.22988546\t=  65.2%\t90.0%\n0.49960122\t/  1.22988546\t=  40.6%\t80.0%\n0.29447165\t/  1.22988546\t=  23.9%\t70.1%\n0.15967405\t/  1.22988546\t=  13.0%\t60.2%\n0.07618099\t/  1.22988546\t=   6.2%\t50.0%\n0.03136805\t/  1.22988546\t=   2.6%\t40.1%\n0.00990661\t/  1.22988546\t=   0.8%\t30.0%\n0.00197034\t/  1.22988546\t=   0.2%\t20.0%\n0.0001245\t/  1.22988546\t=   0.0%\t10.0%\n0\t        /  1.22988546\t=   0.0%\t 0.6%\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\n\u003Cbr\u003E\nI went back and tried some regression analysis and a far simpler formula popped out.\u003Cbr\u003E\nSLDensity = (float)FlightGlobals.getAtmDensity(FlightGlobals.currentMainBody.atmospherePressureSeaLevel, FlightGlobals.currentMainBody.atmosphereTemperatureSeaLevel);\u003Cbr\u003E\nAtmosDepth = (float)Math.Pow(ActiveVessel.atmDensity\u00A0/ SLDensity,0.25f);\u003Cbr\u003E\u003Cbr\u003E\nAs a quick test in the morning, I found it works for Duna, Kerbin, \u0026amp; Laythe - so I think that\u0027s the one . I\u0027ll test again tonight to see if I need to add some decimals to that 0.25 figure to be slightly more accurate.\u003Cbr\u003E\nEDIT: Re-ran the numbers through the tool (here:\u00A0\u003Ca href=\u0022https://planetcalc.com/5992/\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://planetcalc.com/5992/\u003C/a\u003E) and confirmed that the formula is best fit. Kinda chuffed that it worked\u00A0\u003Cimg alt=\u0022:D\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 title=\u0022:D\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/129946-richfiles/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022129946\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/129946-richfiles/\u0022 rel=\u0022\u0022\u003E@richfiles\u003C/a\u003E\u00A0Calc all done for you when you get to your software stage. I\u0027ve had a few attempts\u00A0working with hardware a few times like what you\u0027ve posted on the forums. This time around I\u0027m trying to stick with software and work those issues out first. Hopefully I make it further than last time and have a few working components.\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/11842-zitronen/\u0026amp;do=hovercard\u0022 data-mentionid=\u002211842\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/11842-zitronen/\u0022 rel=\u0022\u0022\u003E@zitronen\u003C/a\u003E\u00A0Not sure there\u0027s any point adding SL Density to the protocol on it\u0027s own. While\u00A0it\u0027s required to do the calc, it would be a different Sea Level Density figure depending on what planet you were on. All that would result in would be getting ppl to do the calc on their microcontroller and it\u0027s preferable to avoid the log, ln, power function were possible on those little things.\u003Cbr\u003E\nProbably be simpler to just replace Density with the Depth calculation below. Last option would be to read directly from the GUI Atmosphere gauge value.\n\u003C/p\u003E\n\u003Cp\u003E\nSuggestion to substitute the Density value and supply a atmosphere depth value that should be between 0 and 1.\u00A0\u003Cbr\u003E\u003Cstrong\u003EKSPSerialPort.VData.Density = (float)ActiveVessel.atmDensity;\u003C/strong\u003E\u003Cbr\u003E\nwith\u003Cbr\u003E\u003Cstrong\u003EKSPSerialPort.VData.Density = \u003C/strong\u003E\u003Cstrong\u003E(float)Math.Pow(ActiveVessel.atmDensity / (FlightGlobals.getAtmDensity(FlightGlobals.currentMainBody.atmospherePressureSeaLevel, FlightGlobals.currentMainBody.atmosphereTemperatureSeaLevel)), 0.25f);\u003C/strong\u003E\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222019-08-03T10:04:09Z\u0022 title=\u002208/03/2019 10:04  AM\u0022 data-short=\u00224 yr\u0022\u003EAugust 3, 2019\u003C/time\u003E by wile1411\u003C/strong\u003E\n\u003Cbr\u003Eextra testing of new formula\n\u003C/span\u003E\n"},{"CreatedByName":"zitronen","CreatedById":11842,"CreatedDateTime":"2019-08-03T16:38:23Z","Content":"\n\u003Cp\u003E\nHmm this is weird. Why would you want to know this value? If you just want to know how deep you are in the atmosphere why not just use altitude and remember atmo start height for each planet? That formula is also odd since IRL density ratio is exponential, not 4th root.\n\u003C/p\u003E\n\u003Cp\u003E\nDensity by itself is useful, if density halves your drag and lift halves at the same true air speed, which is why I included it.\n\u003C/p\u003E\n"},{"CreatedByName":"cyberKerb","CreatedById":28891,"CreatedDateTime":"2019-08-04T01:04:37Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223645300\u0022 data-ipsquote-contentid=\u0022186865\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221564850303\u0022 data-ipsquote-userid=\u002211842\u0022 data-ipsquote-username=\u0022zitronen\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n8 hours ago, zitronen said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nHmm this is weird. Why would you want to know this value? If you just want to know how deep you are in the atmosphere why not just use altitude and remember atmo start height for each planet? That formula is also odd since IRL density ratio is exponential, not 4th root.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nFor me, it was to create an atmosphere gauge to view on a physical controller while in IVA view.\u003Cbr\u003E\nI didn\u0027t use the alt vs maxheight calculation as that a linear value. The gauge is sourced from an exponential value, but it\u0027s converted somehow so it moves different to the values you\u0027d expect it to use.\u003Cbr\u003E\nThe formula I had is not perfect by any means but it at least replicates the atmosphere gauge \u002B- 0.5%. Not idea why 4th root gets close or\u00A0works as well as it does.\u00A0Main reason I posted it is there have been a couple of threads (here and reddit) querying what the calcs are behind the gauge. I figured I\u0027d try.\n\u003C/p\u003E\n\u003Cp\u003E\nAlso aware there are opinions that the atmosphere gauge is useless and takes up screen space, so no loss if no one interested. \u003Cspan\u003E\u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u00A0Richfiles even mentioned the scale was weird, the tick marks don\u0027t make sense\u00A0and the color bands are another mystery\u003C/span\u003E\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003EAtmos\tMaxAlt\nGauge\tvs Alt%\n90.0%\t96.0%\n80.1%\t90.9%\n70.1%\t86.0%\n60.0%\t81.4%\n50.0%\t76.0%\n40.0%\t69.5%\n30.0%\t61.1%\n20.0%\t48.7%\n10.0%\t23.5%\n0.7%\t0.1%\u003C/span\u003E\u003C/pre\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223645300\u0022 data-ipsquote-contentid=\u0022186865\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221564850303\u0022 data-ipsquote-userid=\u002211842\u0022 data-ipsquote-username=\u0022zitronen\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n8 hours ago, zitronen said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nDensity by itself is useful, if density halves your drag and lift halves at the same true air speed, which is why I included it.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThis is the stuff I need to learn but don\u0027t know it\u0027s contextual application.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222019-08-04T01:17:52Z\u0022 title=\u002208/04/2019 01:17  AM\u0022 data-short=\u00224 yr\u0022\u003EAugust 4, 2019\u003C/time\u003E by wile1411\u003C/strong\u003E\n\u003C/span\u003E\n"}]}