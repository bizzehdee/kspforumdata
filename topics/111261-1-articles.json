{"TopicId":111261,"ForumId":29,"TopicTitle":"can someone please look over the code for my first ever plugin. I dont want to break the game.","CreatedByName":"MrMcMuffin","CreatedById":145231,"CreatedDateTime":"2015-05-29T15:29:32Z","PageNum":1,"Articles":[{"CreatedByName":"MrMcMuffin","CreatedById":145231,"CreatedDateTime":"2015-05-29T15:29:32Z","Content":"**\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_**\n\n1. **using** UnityEngine;\n2. **using** System;\n3. **using** System.Timers;\n4. \n5. **namespace** MachGuage\n6. {\n7. **public** **class** MachGuage : Plugin\n8. {\n9. **private** **static** Timer aTimer;\n10. \n11. aTimer.Tick *//this hopefully will do all the calculations for converting m/s to mach*\n12. {\n13. MachNumber = (**this**.Velocity \\* 0.0029411764705882);\n14. {\n15. Round(MachNumber);\n16. }\n17. }\n18. **private** Rect \\_windowposition = new Rect();\n19. **private** GUIStyle \\_windowStyle, \\_labelStyle;\n20. **private** **bool** \\_hasInitStyles = **false**;\n21. \n22. \n23. **public** **override** **void** OnStart(StartState state)\n24. {\n25. aTimer = new System.Timers.Timer(20)\n26. aTimer.Enabled = **true**;\n27. **if** (state != StartState.Editor),\n28. {\n29. **if** (!\\_hasInitStyles) InitStyles();\n30. RenderingManager.AddToPostDrawQueue(0, OnDraw);\n31. }\n32. }\n33. \n34. **private** **void** OnDraw()\n35. {\n36. **if** (**this**.vessel == FlightGlobals.ActiveVessels)\n37. \\_WindowPosition = GUILayout.Window(10, \\_windowPosition, OnWindow, \u0022Mach Guage\u0022)\n38. }\n39. \n40. **Private** **void** OnWindow(**int** windowId)\n41. {\n42. GUILayout.BeginHorizontal(GuiLayout.Width(100f));\n43. GUILayout.label(aTimer.Tick = MachNumber);\n44. **if** (MachNumber == 0)\n45. {\n46. GUILayout.Label(\u0022You are not moving. and now the guage is bored\u0022);\n47. }\n48. GUILayout.EndHorizontal();\n49. \n50. GUI.DragWindow();\n51. }\n52. \n53. prvate **void** InitStyles()\n54. {\n55. \\_windowStyle = new GUIStyle(HighLogic.Skin.Window);\n56. \\_windowStyle.fixedWidth = 100f\n57. \n58. \\_labelStyle = new GUIStyle(HighLogic.Skin.label);\n59. \\_labelStyle.stretchWidth = **true**;\n60. \n61. \\_hasInitStyles = **true**;\n62. }\n63. }\n64. }\n65. the copy from pastebin messed up the brackets and stuff sorry about that\n66. \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_  \nThis is supposed to be a mach gauge, and my first time doing anything with C#. If you revise it will you please send me the code via private message. You will be given credit for your help when i eventually release the plugin. by the way, I would like integration with the default toolbar so i dont have to make a part.  \nThanks,  \nRyan:D:D"},{"CreatedByName":"MrHappyFace","CreatedById":76365,"CreatedDateTime":"2015-05-29T17:25:09Z","Content":"All of it seems fine except this:\n\n\u003E \n\u003E 1. **private** **static** Timer aTimer;\n\u003E 2. aTimer.Tick *//this hopefully will do all the calculations for converting m/s to mach*\n\u003E 3. {\n\u003E 4. MachNumber = (**this**.Velocity \\* 0.0029411764705882);\n\u003E 5. {\n\u003E 6. Round(MachNumber);\n\u003E 7. }\n\u003E 8. }\n\nYou should just use the OnUpdate() method like this:\n\n\u003E \n\u003E 1. **public** **override** **void** OnUpdate ()\n\u003E 2. {\n\u003E 3. MachNumber = (**this**.Velocity \\* 0.0029411764705882);\n\u003E 4. Round(MachNumber);\n\u003E 5. }\n\nAlso, you should extend PartModule, not Plugin. Plugin isn\u0027t even a class.\n\nAlso, are you using an IDE like MonoDevelop/Xamarin Studio or Visual Studio, or are you just using Notepad, because you should be using an IDE.\n\n**Edited \u003Ctime datetime=\u00222015-05-29T17:27:13Z\u0022 title=\u002205/29/2015 05:27  PM\u0022 data-short=\u00229 yr\u0022\u003EMay 29, 2015\u003C/time\u003E by MrHappyFace**"},{"CreatedByName":"MrMcMuffin","CreatedById":145231,"CreatedDateTime":"2015-05-29T18:24:52Z","Content":"Thanks so much MrHappyFace, I\u0027m about to transfer it to an IDE. should this work without a part, and how do i get it on the toolbar"},{"CreatedByName":"MrHappyFace","CreatedById":76365,"CreatedDateTime":"2015-05-29T20:41:40Z","Content":"If you want it without a part, then do something like this:\n\n    [KSPAddon(KSPAddon.Startup.Flight, false)]  //this spawns your addon seperate from any part. Can run in any game scene including the loading screen, the main menu, the editor, and in flightpublic class MachGauge : MonoBehaviour   //Read up on the unity documentation for MonoBehaviour [URL=\u0022http://docs.unity3d.com/ScriptReference/MonoBehaviour.html\u0022]here[/URL]{    //replace OnStart(StartState state) with Start()    //replace OnUpdate() with Update()    //use FlightGlobals.ActiveVessel instead of vessel or part}\n\nAnd for the toolbar, use the official documentation: [http://forum.kerbalspaceprogram.com/threads/86682-Appilcation-Launcher-and-Mods](https://forum.kerbalspaceprogram.com/threads/86682-Appilcation-Launcher-and-Mods)"},{"CreatedByName":"NathanKell","CreatedById":75006,"CreatedDateTime":"2015-05-30T01:26:56Z","Content":"Also, parts and vessels already have mach numbers (vessel.mach and part.machNumber) you don\u0027t have to (and shouldn\u0027t\\*) calculate it yourself.\n\n\\*I mean, you could. But if you do, you\u0027ll need to calculate the speed of sound, first."},{"CreatedByName":"MrMcMuffin","CreatedById":145231,"CreatedDateTime":"2015-05-30T23:28:44Z","Content":"You are right nathan. I wont be calculating a single damn thing. Thanks. Here the revised label code\n\nPrivate void OnWindow(int windowId)\n\n{\n\nGUILayout.BeginHorizontal(GuiLayout.Width(100f));\n\nGUILayout.label(vessel.mach);\n\n}"},{"CreatedByName":"MrMcMuffin","CreatedById":145231,"CreatedDateTime":"2015-05-31T00:11:04Z","Content":"\u003E \n\u003E Also, parts and vessels already have mach numbers (vessel.mach and part.machNumber) you don\u0027t have to (and shouldn\u0027t\\*) calculate it yourself.\n\u003E \\*I mean, you could. But if you do, you\u0027ll need to calculate the speed of sound, first.\n\nBy the way you gonna update real solar system any time soon"},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2015-05-31T02:44:25Z","Content":"That code won\u0027t actually work, you need to close any layout groups (ie. you\u0027re missing a GUILayout.EndHorizontal()). There\u0027s a simpler way to do it aswell:\n\n    private void OnWindow(int windowId){      GUILayout.label(vessel.mach.ToString(), GUILayout.Width(100f));}\n\nEDIT\n\nFormatting would probably be useful as well\n\n    private void OnWindow(int windowId){      GUILayout.label(vessel.mach.ToString(\u00220.000\u0022), GUILayout.Width(100f)); // prints a number rounded to 3dp in a label 100 units wide}\n\n**Edited \u003Ctime datetime=\u00222015-05-31T06:33:04Z\u0022 title=\u002205/31/2015 06:33  AM\u0022 data-short=\u00229 yr\u0022\u003EMay 31, 2015\u003C/time\u003E by Crzyrndm**"},{"CreatedByName":"MrMcMuffin","CreatedById":145231,"CreatedDateTime":"2015-05-31T19:27:24Z","Content":"Good news guys, the mod is finished. thanks for all the help and support."}]}