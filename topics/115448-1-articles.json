{"TopicId":115448,"ForumId":39,"TopicTitle":"Summer KSP controller : Arduino \u002B KSP Serial IO \u002B Joystick","CreatedByName":"Cbrollin","CreatedById":147536,"CreatedDateTime":"2015-07-09T01:20:00Z","PageNum":1,"Articles":[{"CreatedByName":"Cbrollin","CreatedById":147536,"CreatedDateTime":"2015-07-09T01:20:00Z","Content":"\n\u003Cp\u003ESo this summer, I and a fellow grad student decided to both work on making a controller for Kerbal Space Program. My controller has all of the main functions working now, so I thought I would post the progress so far.\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003ECurrent Progress\u003C/strong\u003E\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://i.imgur.com/l6tuzDWl.jpg?1\u0022 alt=\u0022l6tuzDWl.jpg?1\u0022\u003E\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003ECredit\u003C/strong\u003E\u003C/p\u003E\u003Cp\u003EI have \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/members/11850-zitronen\u0022 rel=\u0022external nofollow\u0022\u003Ezitronen\u003C/a\u003E to thank for his excellent plugin and tutorial on the arduino working with KSP. You can find his page \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/66393-Hardware-Plugin-Arduino-based-physical-display-serial-port-io-tutorial-%2817-Dec%29\u0022 rel=\u0022external nofollow\u0022\u003Ehere\u003C/a\u003E.\u003C/p\u003E\u003Cp\u003EI was very much inspired by the \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/72254-K-E-E-B-I-m-finally-prepared-to-show-my-hardware-mod\u0022 rel=\u0022external nofollow\u0022\u003EK.E.E.B.\u003C/a\u003E controller made by \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/members/56597-Luis\u0022 rel=\u0022external nofollow\u0022\u003ELuis\u003C/a\u003E, and took many of my ideas from his design. \u003C/p\u003E\u003Cp\u003EI took a look at \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/121245-Arduino-KSP_Serial_IO-Odysseus\u0022 rel=\u0022external nofollow\u0022\u003EOdysseus\u003C/a\u003E by \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/members/145010-Sputnix\u0022 rel=\u0022external nofollow\u0022\u003ESputnix\u003C/a\u003E. It is very clean and an excellent design. I will probably implement some of his design elements in my controller as it progresses. I also liked the form of Sputnix\u0027s forum post, and I am trying to emulate that here.\u003C/p\u003E\u003Cp\u003EAlso, thanks to all on the forums for all your wonderful ideas and knowledge, especially in C# and arduino coding.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Chr\u003E\u003Cstrong\u003EFunctions\u003C/strong\u003E\u003Cp\u003EThe main joystick is just a Saitek ST290 chopped in half. I figured it was easier to use an existing joystick than having to wire it up to the arduino and code it. This handles main flight, rotation, yaw and pitch. This also handles the throttle. It also means this will take up 2 USB ports instead of 1. Thank goodness for powered USB hubs.\u003C/p\u003E\u003Cp\u003EThe small center joystick is a work in progress. It is the only thing currently not wired up. It is a small hat switch that will be used for translation movements for docking.\u003C/p\u003E\u003Cp\u003EThe 5 red buttons handle SAS, RCS, Lights, gears, and brakes. They are backlit by LEDs and display the current in game status, regardless of the switch position.\u003C/p\u003E\u003Cp\u003EThe red arm switch is essentially a stage lock. The yellow staging button is only active when the arm switch is armed.\u003C/p\u003E\u003Cp\u003EThe yellow staging button launches and stages the rocket. It blinks similar to the LED on the in game staging panel. It blinks when the rocket is on the launch pad. When in flight it is solid until there are no stages left. When there are no stages left, or the arming switch isnt armed, the light is off.\u003C/p\u003E\u003Cp\u003EThe blue switch opens Map View, and is lit up when in Map View.\u003C/p\u003E\u003Cp\u003EFinally, the LCD displays information from the game. I currently have it only displaying altitude and velocity. I would like to add a selector switch to change between different information. I would also like to add the functionality to display sci notation with units instead of a very large number.\u003C/p\u003E\u003Cp\u003EThe next things I am going to add are a few buttons to switch between staging, docking, and maybe horizontal flight modes. I also need to add a handle for the top of the throttle.\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003EParts\u003C/strong\u003E\u003C/p\u003E\u003Cp\u003E1x Arduino Uno R3\u003C/p\u003E\u003Cp\u003E1x Saitek St290\u003C/p\u003E\u003Cp\u003E1x old computer case (for the metal)\u003C/p\u003E\u003Cp\u003E1x MCP23017 I/O expander - adding another later, \u003Ca href=\u0022http://www.adafruit.com/products/732\u0022 rel=\u0022external nofollow\u0022\u003Elink\u003C/a\u003E, \u003Ca href=\u0022https://github.com/adafruit/Adafruit-MCP23017-Arduino-Library\u0022 rel=\u0022external nofollow\u0022\u003Earduino code library\u003C/a\u003E, you can also get them cheaper \u003Ca href=\u0022http://store.cutedigi.com/mcp23017-i2c-16-input-output-port-expander/\u0022 rel=\u0022external nofollow\u0022\u003Ehere\u003C/a\u003E\u003C/p\u003E\u003Cp\u003E5x Red Latching Illuminated buttons - \u003Ca href=\u0022https://www.amazon.com/Light-Locking-Button-Switch-R16-503/dp/B00ARBVB50/ref=pd_sbs_328_2?ie=UTF8\u0026amp;refRID=13QYM2G1AEQFXEBKRGP0\u0022 rel=\u0022external nofollow\u0022\u003Elink\u003C/a\u003E\u003C/p\u003E\u003Cp\u003E1x Toggle switch with Missile cover - \u003Ca href=\u0022https://www.sparkfun.com/products/9278\u0022 rel=\u0022external nofollow\u0022\u003Ehere\u003C/a\u003E and \u003Ca href=\u0022https://www.sparkfun.com/products/9276\u0022 rel=\u0022external nofollow\u0022\u003Ehere\u003C/a\u003E\u003C/p\u003E\u003Cp\u003E1x Yellow momentary illuminated button - \u003Ca href=\u0022http://www.adafruit.com/products/1441\u0022 rel=\u0022external nofollow\u0022\u003Elink\u003C/a\u003E\u003C/p\u003E\u003Cp\u003E1x Blue momentary illuminated button - \u003Ca href=\u0022http://www.adafruit.com/products/1477\u0022 rel=\u0022external nofollow\u0022\u003Elink\u003C/a\u003E\u003C/p\u003E\u003Cp\u003E1x hat switch - salvaged from another old joystick\u003C/p\u003E\u003Cp\u003E1x 16x2 LCD screen\u003C/p\u003E\u003Cp\u003E I will add links to these and to the other things that I used\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-07-09T21:46:40Z\u0022 title=\u002207/09/2015 09:46  PM\u0022 data-short=\u00229 yr\u0022\u003EJuly 9, 2015\u003C/time\u003E by Cbrollin\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"stibbons","CreatedById":57865,"CreatedDateTime":"2015-07-09T04:44:44Z","Content":"\n\u003Cp\u003EVery nice work. I like how you\u0027re using the indicator LED on the stage button, think I might have to borrow that idea for my controller. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EWhat\u0027s the enclosure built from? I\u0027m also curious about how you got the Saitek mounted, just disassemble the original box and screw it in to the panel?\u003C/p\u003E\n"},{"CreatedByName":"Sputnix","CreatedById":141420,"CreatedDateTime":"2015-07-09T07:01:13Z","Content":"\n\u003Cp\u003ELooks like a very neat project! Good start! \u003C/p\u003E\u003Cp\u003EI would recommend to anyone that can afford it, to go with a Mega 2560. You run out of pins very quickly (depending on what exactly you want to do - that is).\u003C/p\u003E\u003Cp\u003EAlthough, bit-registers are fun to use too \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003E(Clone-Duino\u0027s are quite affordable -- even down under with the distance-tax).\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Cbrollin\u0022 data-cite=\u0022Cbrollin\u0022\u003E\u003Cdiv\u003E\u003Cp\u003EI took a look at \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/121245-Arduino-KSP_Serial_IO-Odysseus\u0022 rel=\u0022external nofollow\u0022\u003EOdysseus\u003C/a\u003E by \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/members/145010-Sputnix\u0022 rel=\u0022external nofollow\u0022\u003ESputnix\u003C/a\u003E. It is very clean and an excellent design. I will probably implement some of his design elements in my controller as it progresses. I also liked the form of Sputnix\u0027s forum post, and I am trying to emulate that here.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EAww shucks. Thanks \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_embarrassed.gif\u0022 alt=\u0022:blush:\u0022\u003E\u003C/p\u003E\u003Cp\u003EIf you\u0027re interested in how to do the spoiler tags -- here\u0027s the code (with the content going between the blocks):\u003C/p\u003E\u003Cp\u003EJust replace the opening / closing parenthesis ( ) with brackets [ ]\u003C/p\u003E\u003Cp\u003E(spoiler=Click to see the full log )\u003C/p\u003E\u003Cp\u003E(/spoiler)\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-07-09T07:05:13Z\u0022 title=\u002207/09/2015 07:05  AM\u0022 data-short=\u00229 yr\u0022\u003EJuly 9, 2015\u003C/time\u003E by Sputnix\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Cbrollin","CreatedById":147536,"CreatedDateTime":"2015-07-09T15:17:48Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022stibbons\u0022 data-cite=\u0022stibbons\u0022\u003E\u003Cdiv\u003EVery nice work. I like how you\u0027re using the indicator LED on the stage button, think I might have to borrow that idea for my controller. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003Cp\u003EWhat\u0027s the enclosure built from? I\u0027m also curious about how you got the Saitek mounted, just disassemble the original box and screw it in to the panel?\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYeah, I really wanted the staging button to do that. The button was hard to find though. Not many people selling yellow. Got it from \u003Ca href=\u0022http://www.adafruit.com/products/1441\u0022 rel=\u0022external nofollow\u0022\u003Eadafruit\u003C/a\u003E.\u003C/p\u003E\u003Cp\u003ESo the enclosure is built from the metal sides of an old computer case and some wood. Just what I had laying around. I just had to cut the Saitek in half, and solder some longer wires to the potentiometer for the throttle. \u003C/p\u003E\u003Cp\u003EThen I just put some screws straight into the plastic of the controller. I will try to get some pictures of the inside later, though it isnt pretty.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Sputnix\u0022 data-cite=\u0022Sputnix\u0022\u003E\u003Cdiv\u003ELooks like a very neat project! Good start! \u003Cp\u003EI would recommend to anyone that can afford it, to go with a Mega 2560. You run out of pins very quickly (depending on what exactly you want to do - that is).\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYeah. The other student that is also doing a controller got a Due to do his project. A lot more I/O pins. Im kinda jealous. I have limited funds though, with a wife and kid, so I had to work with what I had laying around at first. I already had an Uno, and the MCP23017 chips give me 16 more IO pins per chip at about 3 dollars a chip. So that was cheaper for me.\u003C/p\u003E\u003Cp\u003EThe only thing is that I am not sure how the code is gonna look once I add the second IO chip. I am currently using an \u003Ca href=\u0022https://github.com/adafruit/Adafruit-MCP23017-Arduino-Library\u0022 rel=\u0022external nofollow\u0022\u003EMCP library\u003C/a\u003E from adafruit.\u003C/p\u003E\u003Cp\u003ENext time I post some code, I will go for the spoiler look. More clean for sure.\u003C/p\u003E\n"},{"CreatedByName":"Sputnix","CreatedById":141420,"CreatedDateTime":"2015-07-10T11:24:21Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Cbrollin\u0022 data-cite=\u0022Cbrollin\u0022\u003E\u003Cdiv\u003E\u003Cp\u003EYeah. The other student that is also doing a controller got a Due to do his project. A lot more I/O pins. Im kinda jealous. I have limited funds though, with a wife and kid, so I had to work with what I had laying around at first. I already had an Uno, and the MCP23017 chips give me 16 more IO pins per chip at about 3 dollars a chip. So that was cheaper for me.\u003C/p\u003E\u003Cp\u003EThe only thing is that I am not sure how the code is gonna look once I add the second IO chip. I am currently using an \u003Ca href=\u0022https://github.com/adafruit/Adafruit-MCP23017-Arduino-Library\u0022 rel=\u0022external nofollow\u0022\u003EMCP library\u003C/a\u003E from adafruit.\u003C/p\u003E\u003Cp\u003ENext time I post some code, I will go for the spoiler look. More clean for sure.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYou can go back to clean it up \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif\u0022 alt=\u0022;)\u0022\u003E\u003C/p\u003E\u003Cp\u003EI completely understand the funding thing. I actually looked into using a bit-shift register (And combining three of them together). In the end I decided to go a simpler route, and because I \u003Cem\u003Ejust\u003C/em\u003E had enough on the mega, figured I\u0027d save myself a bit of heartache with another level of complexity \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif\u0022 alt=\u0022:P\u0022\u003E\u003C/p\u003E\u003Cp\u003EI\u0027m not completely foreign to electronics (and have more of a programming background) -- but this Arduino thing is a whole new minefield to navigate.\u003C/p\u003E\u003Cp\u003EI look forward to seeing your progress \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EPS - I like your re-purposing of the computer case. I almost went down that route - but I don\u0027t have the necessary metal-work tools to do that.\u003C/p\u003E\n"},{"CreatedByName":"Freshmeat","CreatedById":111048,"CreatedDateTime":"2015-07-10T18:49:20Z","Content":"\n\u003Cp\u003EI have gotten nice results using CD4021 shift registers. They are about a dollar apiece on ebay. You might also be able to multiplex your inputs, but I do not know how you IO expander plays along with that.\u003C/p\u003E\n"}]}