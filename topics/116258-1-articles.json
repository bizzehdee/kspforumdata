{"TopicId":116258,"ForumId":20,"TopicTitle":"How can I find out which mod is eating my RAM?","CreatedByName":"Streetwind","CreatedById":98962,"CreatedDateTime":"2015-07-18T19:28:43Z","PageNum":1,"Articles":[{"CreatedByName":"Streetwind","CreatedById":98962,"CreatedDateTime":"2015-07-18T19:28:43Z","Content":"\n\u003Cp\u003EI currently play a modded carreer mode. I load to 2.4 GB memory usage on the menu screen, which goes up to 2.7 GB after loading the savegame and sitting at the space center screen. So far, so good.\u003C/p\u003E\u003Cp\u003EUnfortunately there\u0027s a memory leak \u003Cem\u003Esomewhere\u003C/em\u003E. If I keep playing, the memory usage will, guaranteed, without fail, creep up past 3.5 to 3.6 GB and eventually crash the game with an out of memory error. It takes around 1 to 1.5 hours for it to get there, so unfortunately this isn\u0027t something I can nail down to doing something specific. I\u0027ve taken to monitoring my memory usage and just quitting and restarting the client whenever I exceed 3.4 GB, but it\u0027s getting annoying. Also, I found another mod I want to add, and that will reduce the amount of headroom that I have before the leak makes me crash.\u003C/p\u003E\u003Cp\u003EIs there any way I can track down where my spare RAM is leaking off to?\u003C/p\u003E\n"},{"CreatedByName":"smjjames","CreatedById":134004,"CreatedDateTime":"2015-07-18T19:36:19Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Streetwind\u0022 data-cite=\u0022Streetwind\u0022\u003E\u003Cdiv\u003EI currently play a modded carreer mode. I load to 2.4 GB memory usage on the menu screen, which goes up to 2.7 GB after loading the savegame and sitting at the space center screen. So far, so good.\u003Cp\u003EUnfortunately there\u0027s a memory leak \u003Cem\u003Esomewhere\u003C/em\u003E. If I keep playing, the memory usage will, guaranteed, without fail, creep up past 3.5 to 3.6 GB and eventually crash the game with an out of memory error. It takes around 1 to 1.5 hours for it to get there, so unfortunately this isn\u0027t something I can nail down to doing something specific. I\u0027ve taken to monitoring my memory usage and just quitting and restarting the client whenever I exceed 3.4 GB, but it\u0027s getting annoying. Also, I found another mod I want to add, and that will reduce the amount of headroom that I have before the leak makes me crash.\u003C/p\u003E\u003Cp\u003EIs there any way I can track down where my spare RAM is leaking off to?\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ESame here man, same here.\u003C/p\u003E\u003Cp\u003EI too wish I could see what the source of the memory leaks are when it\u0027s a mod.\u003C/p\u003E\u003Cp\u003EI know of no easy way to do it like \u0027aha!, it\u0027s ___ 100% for sure\u0027. You\u0027ll have to do a binary search to find the problem. Also, having GCmonitor helps so that you can see when it\u0027s jumping in RAM usage.\u003C/p\u003E\u003Cp\u003EFor me, I swear there is some sort of memory leak with MJs landing guidance. There also seems to be some smaller leaks that slowly creep in, but I have no way of telling what is caused by stock KSP (or perhaps Unity) and what is caused by a mod.\u003C/p\u003E\u003Cp\u003EAnyhow, what mods do you have?\u003C/p\u003E\n"},{"CreatedByName":"Streetwind","CreatedById":98962,"CreatedDateTime":"2015-07-18T19:39:51Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022smjjames\u0022 data-cite=\u0022smjjames\u0022\u003E\u003Cdiv\u003EAnyhow, what mods do you have?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003E\u003Ca href=\u0022https://dl.dropboxusercontent.com/u/44754370/mods.png\u0022 rel=\u0022external nofollow\u0022\u003EThis\u003C/a\u003E plus ModuleManager.\u003C/p\u003E\n"},{"CreatedByName":"smjjames","CreatedById":134004,"CreatedDateTime":"2015-07-19T17:18:55Z","Content":"\n\u003Cp\u003EI have some of those mods too.\u003C/p\u003E\u003Cp\u003EAnyhow, does anybody know of an easy (or easier than most) method to figure out what is causing memory leaks if it\u0027s coming from a mod? Because I\u0027m getting small jumps in memory usage over time as well.\u003C/p\u003E\n"},{"CreatedByName":"Padishar","CreatedById":97386,"CreatedDateTime":"2015-07-19T19:13:37Z","Content":"\n\u003Cp\u003EIt basically isn\u0027t possible to determine which mods are using what memory. Even Squad with access to the full source code and debugging environment would find this awkward as the overhead of tracking this information would probably make the game unplayably slow.\u003C/p\u003E\u003Cp\u003EI am not claiming that there aren\u0027t any mods that cause memory leaks but it is well known that the stock game also suffers from a number of leaks (scene changes, especially reverts, engineer\u0027s report updating, etc.). Also, the constant turnover of memory allocations causes the free memory to become fragmented which can result in more memory being claimed from the OS to satisfy large requests even though the total of free memory is greater than needed.\u003C/p\u003E\n"},{"CreatedByName":"peachoftree","CreatedById":110108,"CreatedDateTime":"2015-07-20T02:48:04Z","Content":"\n\u003Cp\u003EI would recommend testing your big plugins first, such as kopernicus and SCANsat, as those are more likely to contain a leak, followed by smaller plugins, than part packs. \u003C/p\u003E\u003Cp\u003ETest by moving everything out of game data except the squad folder, the mod you are testing and its hard dependencies\u003C/p\u003E\n"},{"CreatedByName":"Ser","CreatedById":104207,"CreatedDateTime":"2015-07-20T15:10:17Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Streetwind\u0022 data-cite=\u0022Streetwind\u0022\u003E\u003Cdiv\u003E\u003Ca href=\u0022https://dl.dropboxusercontent.com/u/44754370/mods.png\u0022 rel=\u0022external nofollow\u0022\u003EThis\u003C/a\u003E plus ModuleManager.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EA lot of parts I see.\u003C/p\u003E\u003Cp\u003EAlso try to start with disabling Trajectories. Some time ago I had suspicions on it but there\u0027s a high chance they have fixed them.\u003C/p\u003E\u003Cp\u003EMemory rising over time does not necessarily point on memory leak in a mod. I guess parts and textures might be loaded dynamically as they are used. And never get unloaded than. So the problem might be in total quantity of mods.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-07-20T20:15:40Z\u0022 title=\u002207/20/2015 08:15  PM\u0022 data-short=\u00228 yr\u0022\u003EJuly 20, 2015\u003C/time\u003E by Ser\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Streetwind","CreatedById":98962,"CreatedDateTime":"2015-07-20T21:53:16Z","Content":"\n\u003Cp\u003ENo, parts are all loaded up front, not dynamically as needed. That\u0027s why KSP is such an immense memory hog in the first place \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif\u0022 alt=\u0022:P\u0022\u003E\u003C/p\u003E\u003Cp\u003EI managed to narrow it down a little bit - it\u0027s largely scene changes. Whenever I enter or exit a building, switch to a vessel or revert a test flight, there\u0027s a small bump in memory usage that never goes away again. Over time it accumulates.\u003C/p\u003E\u003Cp\u003ERemoving Trajectories is easy enough, I\u0027ll test that right now.\u003C/p\u003E\n"},{"CreatedByName":"hoojiwana","CreatedById":57079,"CreatedDateTime":"2015-07-20T21:56:10Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Streetwind\u0022 data-cite=\u0022Streetwind\u0022\u003E\u003Cdiv\u003EI managed to narrow it down a little bit - it\u0027s largely scene changes. Whenever I enter or exit a building, switch to a vessel or revert a test flight, there\u0027s a small bump in memory usage that never goes away again. Over time it accumulates.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI\u0027m pretty sure that\u0027s just the stock game doing that, though a mod may be exacerbating the issue.\u003C/p\u003E\n"},{"CreatedByName":"Streetwind","CreatedById":98962,"CreatedDateTime":"2015-07-20T22:38:54Z","Content":"\n\u003Cp\u003EWell, Trajectories wasn\u0027t a cul\u00C3\u0192\u00C2\u00BCrit. Better Buoyancy not either. I guess if there\u0027s no other option, I might eventually go and test plugin by plugin... though it\u0027ll take a while to motivate me to do that. I had hoped I could avoid it \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_sad.gif\u0022 alt=\u0022:(\u0022\u003E\u003C/p\u003E\u003Cp\u003EA quick test with a pure stock instance though, sure. Let\u0027s see if I can get stock to leak. Tomorrow.\u003C/p\u003E\n"},{"CreatedByName":"Captain Sierra","CreatedById":74666,"CreatedDateTime":"2015-07-20T22:53:23Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Streetwind\u0022 data-cite=\u0022Streetwind\u0022\u003E\u003Cdiv\u003ENo, parts are all loaded up front, not dynamically as needed. That\u0027s why KSP is such an immense memory hog in the first place \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif\u0022 alt=\u0022:P\u0022\u003E\u003Cp\u003EI managed to narrow it down a little bit - it\u0027s largely scene changes. Whenever I enter or exit a building, switch to a vessel or revert a test flight, there\u0027s a small bump in memory usage that never goes away again. Over time it accumulates.\u003C/p\u003E\u003Cp\u003ERemoving Trajectories is easy enough, I\u0027ll test that right now.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThis is a stock memory leak that most people who aren\u0027t streamers doing a 24 hour (or some other ridiculous time frame) nonstop KSP livestream run into. That said, adding a lot of mods makes the issue occur far more frequently. I have a similar load of part mods and run into the same problems.\u003C/p\u003E\n"},{"CreatedByName":"Ser","CreatedById":104207,"CreatedDateTime":"2015-07-21T12:18:32Z","Content":"\n\u003Cp\u003EStreetwind, speaking of scene changes, I have noticed that amount of used memory drops sometimes when exiting to KSP main menu\u003C/p\u003E\n"},{"CreatedByName":"Kar","CreatedById":122714,"CreatedDateTime":"2015-07-22T15:42:26Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Ser\u0022 data-cite=\u0022Ser\u0022\u003E\u003Cdiv\u003EStreetwind, speaking of scene changes, I have noticed that amount of used memory drops sometimes when exiting to KSP main menu\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI already noticed that too! When I load up KSP, (many mods too) I have about 1.2, 1.3 gb used. When I quit KSP my memory usage goes around 900mb!\u003C/p\u003E\u003Cp\u003EWhen I see this, Hey! It\u0027s time to play KSP again! RAM just grow up inside my PC!\u003C/p\u003E\u003Cp\u003EReally now, for my experience, when I do a long mission, if the game do not crash and my lander lands on Kerbin, I always do a quicksave before recover because the lag is so much that I just know if I do that the game is gonna crash. Sometime it does not, others do, in any case, I quit KSP and restart it again. Fresh again. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Ser","CreatedById":104207,"CreatedDateTime":"2015-07-22T16:06:47Z","Content":"\n\u003Cp\u003EKar, try not to quit KSP but just going to start menu, that was the thing I\u0027ve noticed. Of course, if you quit any game back to OS you\u0027ll get all the memory back.\u003C/p\u003E\n"},{"CreatedByName":"Streetwind","CreatedById":98962,"CreatedDateTime":"2015-07-22T18:32:28Z","Content":"\n\u003Cp\u003EGoing back to the title screen doesn\u0027t reduce RAM usage for me at all. Well, maybe 10 MB out of 3500 or so...\u003C/p\u003E\n"},{"CreatedByName":"Cdr_Zeta","CreatedById":59015,"CreatedDateTime":"2015-07-27T16:45:13Z","Content":"\n\u003Cp\u003EHello,\u003C/p\u003E\u003Cp\u003EHe meant Operating System I think.\u003C/p\u003E\u003Cp\u003EThis problem is well known.\u003C/p\u003E\u003Cp\u003EI think atmosphere MOD makes it alot worse (climbs faster); it also has a memory overhead (about \u002B500 then goes back to it\u0027s start point); I plan on using it and have to leave memory for it.\u003C/p\u003E\u003Cp\u003EThe memory creep is still there with no mods; best to try and see how fast memory creeps comparing MODS rather than comparing size.\u003C/p\u003E\u003Cp\u003Ecmdr zeta\u003C/p\u003E\n"},{"CreatedByName":"Wolf Baginski","CreatedById":138549,"CreatedDateTime":"2015-07-27T18:40:26Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Kar\u0022 data-cite=\u0022Kar\u0022\u003E\u003Cdiv\u003EI already noticed that too! When I load up KSP, (many mods too) I have about 1.2, 1.3 gb used. When I quit KSP my memory usage goes around 900mb!\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EGoing by my Windows experience. that sounds like Task Manager giving different numbers. The graph in the Performance tab is Physical RAM. The memory number shown under Processes is the total RAM, physical and virtual. That\u0027s the number for KSP that you need to be aware of.\u003C/p\u003E\u003Cp\u003EIf you\u0027re not running a big program, the Kernel and other permanent tasks stay in physical RAM. Load KSP and a lot will be paged to virtual RAM on disk. Something like the background Google Drive app spends most of its time just waiting, but when there\u0027s nothing happening it stays in physical RAM. When you exit KSP, the physical RAM being used by these parts will be much less.\u003C/p\u003E\u003Cp\u003E64-bit Windows with enough physical RAM won\u0027t have anything delayed by virtual memory. How much is enough? Going by the address-space limits for 32-bit programs, 8GB of physical RAM should be. That 1.3GB wouldn\u0027t drop.\u003C/p\u003E\n"},{"CreatedByName":"Kerbal101","CreatedById":157058,"CreatedDateTime":"2016-01-25T14:11:24Z","Content":"\n\u003Cp\u003E\nIts same on Linux.\n\u003C/p\u003E\n\u003Cp\u003E\nFor me, KSP starts with 2,8 GiB, but slowly after 1-2 hours bogs to 3,6.\n\u003C/p\u003E\n\u003Cp\u003E\nThe most noticeable impact: scene takes much more time to load and fps also bogs down.\n\u003C/p\u003E\n"},{"CreatedByName":"Diche Bach","CreatedById":76097,"CreatedDateTime":"2016-08-18T13:32:56Z","Content":"\n\u003Cp\u003E\nI\u0027ve allocated about 16 GB worth of virtual RAM in my Windows control panels (about twice the 8GB or physical RAM I have). And that did seem to improve performance a bit.\n\u003C/p\u003E\n\u003Cp\u003E\nLots of guides for doing that on Windows out there, but I can link to one if folks are in need.\n\u003C/p\u003E\n\u003Cp\u003E\nDefragmenting the hard-drive where the game app and its assets lives also seems to have a small but noticeable effect.\n\u003C/p\u003E\n\u003Cp\u003E\nJust now experimenting with this \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/120387-some-relief-for-memory-outage-crashes/\u0022 rel=\u0022\u0022\u003E\u0022-force-opengl\u0022 tweak\u003C/a\u003E to see how that works . . .\n\u003C/p\u003E\n\u003Cp\u003E\nThe thing I cannot find is: how to configure a specific application launcher (e.g., the KSP_64.exe launcher, or rather its shortcut) to use a specific amount of virtual memory. I have my suspicions that Windows is not allowing KSP_64.exe to use as much VM as it could use, and that might help.\n\u003C/p\u003E\n\u003Cp\u003E\nIn any event, thanks for this discussion. It didn\u0027t seem reasonable to me that the game (even a heavily modded on) would actually \u0022need\u0022 more than 8GB of RAM to functional reasonably well, and the fact others have the same problem (and have noted it to have \u0022leak\u0022 like characteristics) is edifying.\n\u003C/p\u003E\n"},{"CreatedByName":"Streetwind","CreatedById":98962,"CreatedDateTime":"2016-08-19T07:03:31Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222721190\u0022 data-ipsquote-contentid=\u0022116258\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221471527176\u0022 data-ipsquote-userid=\u002276097\u0022 data-ipsquote-username=\u0022Diche Bach\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n17 hours ago, Diche Bach said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nI have my suspicions that Windows is not allowing KSP_64.exe to use as much VM as it could use, and that might help.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nPssst.... this discussion is from summer 2015, where 64bit KSP was not yet a thing that existed. \u003Cimg alt=\u0022:P\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif\u0022 title=\u0022:P\u0022\u003E Everyone played under 32bit, with a 3.5 GB hard cap on usable memory.\n\u003C/p\u003E\n\u003Cp\u003E\nAlso, the memory leak was later confirmed and fixed as a stock issue that was exacerbated (but not caused) by some mods. KSP doesn\u0027t leak memory like that anymore nowadays. Which doesn\u0027t discount the possibility of \u003Cem\u003Eother\u003C/em\u003E memory leaks, of course. But frankly, ever since we got access to 64bit, I have had absolutely zero memory related problems.\n\u003C/p\u003E\n"},{"CreatedByName":"Diche Bach","CreatedById":76097,"CreatedDateTime":"2016-08-19T21:16:03Z","Content":"\n\u003Cp\u003E\nhmmmph . . . well my mods must be the culprits . . .\n\u003C/p\u003E\n"},{"CreatedByName":"Red Iron Crown","CreatedById":12858,"CreatedDateTime":"2016-08-20T11:20:17Z","Content":"\n\u003Cp\u003E\nFor that matter, each 64-bit\u00A0program under Windows\u00A0is assigned a full 64 bits of virtual memory space, which is 16.8 million \u003Cem\u003Eterabytes\u003C/em\u003E (though some of it is reserved for the OS). I think the site you\u0027re drawing advice from about \u0022virtual RAM\u0022 is mistaken.\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"Diche Bach","CreatedById":76097,"CreatedDateTime":"2016-08-21T16:30:43Z","Content":"\n\u003Cp\u003E\nSo am I the only one whose heavily modded KSP_64.exe eats up 95% of 8GB of RAM (not to mention the VGA\u0027s RAM)?\n\u003C/p\u003E\n\u003Cp\u003E\nIf so, how do I become a \u0022cool\u0022 kid whose heavily modded build runs pretty good, i.e., how do I get my mod build optimized?\n\u003C/p\u003E\n\u003Cp\u003E\nI realize that is a gigantic question, but maybe one of you sages, could just nudge me in the right direction with a little post??\n\u003C/p\u003E\n\u003Cp\u003E\nI only ask because: I play many games that are very heavily modded (Skyrim with about 120 mods; Fallout 4 with probably ~90, etc.) and I have never observed the gigantic RAM usage I see with my modded KSP.\n\u003C/p\u003E\n"},{"CreatedByName":"Streetwind","CreatedById":98962,"CreatedDateTime":"2016-08-22T07:29:12Z","Content":"\n\u003Cp\u003E\nIt depends entirely on which mods you install. I\u0027ve scratched on 9 GB myself, though I do have 16 in the machine, so...\n\u003C/p\u003E\n\u003Cp\u003E\nSome mods are so large, they eat a gigabyte by themselves. And some mods consume practically nothing. People have had installs with over 100 mods in the 32bit days despite the limit of 3.5 GB, but if you try, you can easily consume twice as much with a quarter of the mods. As such, how many you have installed is fairly meaningless. It all depends on each individual mod.\n\u003C/p\u003E\n\u003Cp\u003E\nAs for why so much memory use? Because KSP loads all assets into memory at startup, as opposed to unpacking them on demand. This greatly increases memory use, but also shortens load times of scene changes (particluarly entering the editor or a flight scene) and costs less system performance (as long as there\u0027s enough memory available). It\u0027s also simpler to implement... always keep in mind that KSP started as a one-man, learning-by-doing project. And for the scope of the stock game, it\u0027s perfectly adequate even today. Limitations only begin to pop up once you do something like tripling or quadrupling the amount of parts and assets.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-08-22T07:31:43Z\u0022 title=\u002208/22/2016 07:31  AM\u0022 data-short=\u00227 yr\u0022\u003EAugust 22, 2016\u003C/time\u003E by Streetwind\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Diche Bach","CreatedById":76097,"CreatedDateTime":"2016-08-22T20:40:23Z","Content":"\n\u003Cp\u003E\nThe take away (which I had already guessed based on observing how the game behaves and hearing how my machine is whirring at various stages) would seem to be: mods which add lots of new assets (particular \u0022parts\u0022) are the most likely to cause performance issues.\n\u003C/p\u003E\n\u003Cp\u003E\nThat is bad news for a gear fondler like me. I like nothing more than more parts than I can ever possible use\n\u003C/p\u003E\n"}]}