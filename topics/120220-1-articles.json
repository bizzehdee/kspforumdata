{"TopicId":120220,"ForumId":29,"TopicTitle":"Spawning a Vessel","CreatedByName":"AlphaAsh","CreatedById":105348,"CreatedDateTime":"2015-09-05T20:22:31Z","PageNum":1,"Articles":[{"CreatedByName":"AlphaAsh","CreatedById":105348,"CreatedDateTime":"2015-09-05T20:22:31Z","Content":"\n\u003Cp\u003EConsider, if you would, the lovely bit of code I finally got to do what I wanted:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E        public static void UnhangarCraft(Vessel vVesselStored)\u003Cbr\u003E        {\u003Cbr\u003E            // Convert the stored protovessel to a new protovessel.\u003Cbr\u003E            // Use BackupVessel because that seems to work and protovessel does not. \u0060\\o/\u0060\u003Cbr\u003E            ProtoVessel pVessel = vVesselStored.BackupVessel();\u003Cbr\u003E\u003Cbr\u003E            // Get rid of the original hidden vessel - even though it was unloaded KSP still \u0027sees\u0027 the original craft.\u003Cbr\u003E            // I do not care why. :|\u003Cbr\u003E            vVesselStored.state = Vessel.State.DEAD;\u003Cbr\u003E\u003Cbr\u003E            foreach (Part p in vVesselStored.Parts)\u003Cbr\u003E            {\u003Cbr\u003E                if (p != null \u0026amp;\u0026amp; p.gameObject != null)\u003Cbr\u003E                    p.gameObject.DestroyGameObject();\u003Cbr\u003E            }\u003Cbr\u003E\u003Cbr\u003E            // Load the new protovessel we made. KSP won\u0027t reload (or rather render) a vessel that was unloaded - it will only load a protovessel. :$\u003Cbr\u003E            pVessel.Load(FlightDriver.FlightStateCache.flightState);\u003Cbr\u003E            // I suspect this is actually a KSP bug since the same crap happens with newly spawned static objects. If you query the active state\u003Cbr\u003E            // of the invisible craft, it claims it is active. And no, forcing the renderers doesn\u0027t work either.\u003Cbr\u003E\u003Cbr\u003E            // Convert protovessel to vessel\u003Cbr\u003E            Vessel vNewVessel = pVessel.vesselRef;\u003Cbr\u003E\u003Cbr\u003E            // Unload then reload the vessel - this seems to be the way to properly re-initialise flightstate etc.\u003Cbr\u003E            // Don\u0027t do this and you get a craft with a stuck surface velocity reading. It looks like KSP transposes orbital\u003Cbr\u003E            // and surface velocity or some other stupid s**t. I don\u0027t care.\u003Cbr\u003E            // And yes, this time KSP does load an unloaded vessel with no need for protovessel b******t. I don\u0027t care why.\u003Cbr\u003E            vNewVessel.Unload();\u003Cbr\u003E            vNewVessel.Load();\u003Cbr\u003E        }\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EHere\u0027s the spec: A craft rolls up to a hangar. The crew get out. You use a simple GUI to \u0027hangar\u0027 the craft. The craft\u0027s id is saved to a text database/persistence file/whatever and is then set inactive and unloaded.\u003C/p\u003E\u003Cp\u003EDoesn\u0027t matter that the vessel still \u0027exists\u0027. There\u0027s a check every frame once you come back to a flight scene that makes any hangared craft inactive/invisible. This allows you to take control of a hangared craft from the tracking station or space center scene, which is intentional (and also handled).\u003C/p\u003E\u003Cp\u003EWhen you unhangar a craft, the id is matched to the vessel in FlightGlobals, the hangar cleared and then the above code does its thing.\u003C/p\u003E\u003Cp\u003EI wanted to pick the brains of fellow KSP modders on what exactly I am missing here, seeing if there is a less clunky solution. Because what I thought were obvious solutions just didn\u0027t work.\u003C/p\u003E\u003Cp\u003EAny thoughts, advice, chastisement or hurling of rotten vegetables welcome.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-09-06T15:09:36Z\u0022 title=\u002209/06/2015 03:09  PM\u0022 data-short=\u00228 yr\u0022\u003ESeptember 6, 2015\u003C/time\u003E by AlphaAsh\u003C/strong\u003E\n\u003Cbr\u003ESpolling and grimmar fixes\n\u003C/span\u003E\n"},{"CreatedByName":"nightingale","CreatedById":119307,"CreatedDateTime":"2015-09-05T20:30:08Z","Content":"\n\u003Cp\u003EI have about \u003Ca href=\u0022https://github.com/jrossignol/ContractConfigurator/blob/master/source/ContractConfigurator/ContractBehaviour/SpawnVessel.cs#L216\u0022 rel=\u0022external nofollow\u0022\u003E300 lines of code\u003C/a\u003E to make spawning vessels work in Contract Configurator. There\u0027s about a dozen hacks in there where I just couldn\u0027t get something to work right in all situations and ended up just doing something weird \u0022because it worked\u0022. So when it comes to spawning/loading/unloading vessels... I\u0027d say you\u0027re doing pretty good with what you\u0027ve got there. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"AlphaAsh","CreatedById":105348,"CreatedDateTime":"2015-09-06T11:04:11Z","Content":"\n\u003Cp\u003EI think my favourite discovery was when I used Load and LoadObjects after each other. My twin engined aircraft with two braking parachutes became a monstrous four-engined, four parachute hybrid. Basically two craft treated as one. It cloned the pilot when he got in. It actually flew but I think I heard the craft\u0027s soul screaming \u0022kiiiiilllll meeeee pllleeeassee\u0022 all the way. The Z tearing was intense.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-09-06T15:11:29Z\u0022 title=\u002209/06/2015 03:11  PM\u0022 data-short=\u00228 yr\u0022\u003ESeptember 6, 2015\u003C/time\u003E by AlphaAsh\u003C/strong\u003E\n\u003C/span\u003E\n"}]}