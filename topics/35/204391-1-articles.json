{"TopicId":204391,"ForumId":35,"TopicTitle":"Online Calculator for Trajectories with Multiple Gravity Assists","CreatedByName":"Krafpy","CreatedById":213892,"CreatedDateTime":"2021-08-16T18:20:12Z","PageNum":1,"Articles":[{"CreatedByName":"Krafpy","CreatedById":213892,"CreatedDateTime":"2021-08-16T18:20:12Z","Content":"\n\u003Cp\u003E\nHello !\n\u003C/p\u003E\n\u003Cp\u003E\nI released an online tool that allows for automatic planning of interplanetary trajectories with multiple gravity assists.\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://krafpy.github.io/KSP-MGA-Planner/\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://krafpy.github.io/KSP-MGA-Planner/\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nThe tool provides an interactive 3D replica of KSP\u0027s solar system where you can zoom on planets and moons. It also provides a time selector to see the KSP\u0027s system configuration at a specific date.\n\u003C/p\u003E\n\u003Cp\u003E\nThe trajectory calculator works in two steps:\n\u003C/p\u003E\n\u003Col\u003E\n\u003Cli\u003E\nGeneration of a planteray sequence : configure the origin and destination body, and constraints on the trajectory (maximum number of swing-bys...). The sequence generation calculates a set of \u003Cem\u003Epossible \u003C/em\u003Esequences that respect the constraints you\u0027ve specified.\n\u003C/li\u003E\n\u003Cli\u003E\nTrajectory optimization : once you\u0027ve selected a sequence, you specify an earliest and latest departure date, and a parking orbit radius around the departure body. The tool will then run an optimization process to calculate a \u003Cem\u003Epossible\u003C/em\u003E optimal trajectory with the given sequence and departure conditions.\n\u003C/li\u003E\n\u003C/ol\u003E\n\u003Cp\u003E\nThe details of the nomenclature and each settings is detailed in the \u0022How to use\u0022 section.\n\u003C/p\u003E\n\u003Cp\u003E\nThe calculated trajectory will be displayed in the solar system view: interplanetary orbit arcs as well as flyby orbits of each planet encountered. The date and \u0394V along each axes of each maneuver are displayed. The trajectory can be vizualised step by step, and you can click on the date of each maneuver to set the system view to that date.\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u0022example_trajectory.png\u0022 class=\u0022ipsImage\u0022 data-ratio=\u002261.55\u0022 height=\u0022461\u0022 width=\u0022749\u0022 src=\u0022https://raw.githubusercontent.com/Krafpy/KSP-MGA-Planner/master/imgs/example_trajectory.png\u0022\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cspan style=\u0022font-size:20px;\u0022\u003E\u003Cstrong\u003EJuly 2022 Update\u003Cspan\u003E: \u003C/span\u003EHow to add solar systems\u003C/strong\u003E\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nThe tool can now support different solar systems from mods. Follow these steps if you want to use the tool on a solar system that is not supported:\n\u003C/p\u003E\n\u003Col\u003E\n\u003Cli\u003E\nFork the project from its github repository (\u003Ca href=\u0022https://github.com/Krafpy/KSP-MGA-Planner\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/Krafpy/KSP-MGA-Planner\u003C/a\u003E) and create a new branch for your solar system.\n\u003C/li\u003E\n\u003Cli\u003E\nCreate a new folder in the \u0060data\u0060 folder where the solar system data will be stored (e.g. data/some-system).\n\u003C/li\u003E\n\u003Cli\u003E\nCopy the \u0060config.yml\u0060 and \u0060bodies.yml\u0060 files from the \u0060data/stock\u0060 to the folder you just created and edit them with your solar system data.\n\u003Cul\u003E\n\u003Cli\u003E\n\u0060config.yml\u0060 stores the global configurations of the tool. These parameters must be changed depending on the properties of the solar system (e.g. duration of a day, camera clip distances for large solar systems...).\n\u003C/li\u003E\n\u003Cli\u003E\n\u0060bodies.yml\u0060 stores the description of each bodies in the solar system. Follow rigorously the edit notes.\u003Cbr\u003E\nIf the solar system uses Kopernicus\u0027 .cfg files for configuration, you can directly convert them into a \u0060bodie.yml\u0060 file on this page \u003Cspan\u003E:\u00A0 \u003C/span\u003E\u003Ca href=\u0022https://krafpy.github.io/KSP-MGA-Planner/tools/cfg-to-yml/\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://krafpy.github.io/KSP-MGA-Planner/tools/cfg-to-yml/\u003C/a\u003E\n\u003C/li\u003E\n\u003C/ul\u003E\n\u003C/li\u003E\n\u003Cli\u003E\nAdd an entry to the \u0060data/systems.yml\u0060 file, following the template.\n\u003C/li\u003E\n\u003Cli\u003E\n\u003Cstrong\u003ETest the tool\u003C/strong\u003E on your computer with your system. You simply need to run a HTTP sever on the repository folder (I use VSCode live server).\n\u003C/li\u003E\n\u003Cli\u003E\nCreate a pull request to the github repository for me to merge it (only for mods, not personal solar systems).\n\u003C/li\u003E\n\u003C/ol\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cspan style=\u0022font-size:20px;\u0022\u003E\u003Cstrong\u003EImportant notes and current issues\u003C/strong\u003E :\u003C/span\u003E\n\u003C/p\u003E\n\u003Cul\u003E\n\u003Cli\u003E\nDespite the precision of the maneuvers details, it is very unlikely that following them will give the exact same trajectory in game. They do however result in a similar trajectory to the one calculated by the tool, and most of the time only some fine tunings are needed at each maneuver.\n\u003C/li\u003E\n\u003Cli\u003E\nThere is no guarantee that the calculated trajectory is \u003Cem\u003Ethe\u003C/em\u003E best one. Since multiple gravity assists problems can only be solved using iterative optimization algorithm (here it\u0027s a differential evolution algorithm which is implemented), the result only \u003Cem\u003Eapproximates\u003C/em\u003E the best solution. It is totally possible that a better trajectory than the one calculated exists.\n\u003C/li\u003E\n\u003Cli\u003E\nA calculated trajectory may be unfeasible (more likely because of unfeasible flybys) in game due to the implementation not (yet) considering some parts of KSP\u0027s physics.\n\u003C/li\u003E\n\u003Cli\u003E\nA calculated trajectory may be complete non sense and absurd because of constraints implemented in the optimization process (this is very likely to occur when you look for trajectory between moons like in the Jool\u0027s system).\n\u003C/li\u003E\n\u003C/ul\u003E\n\u003Cp\u003E\nThese problems may be solved in the future.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nI hope this tool may be useful and I\u0027m open to any feedback. Thanks !\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222022-08-20T14:10:41Z\u0022 title=\u002208/20/2022 02:10  PM\u0022 data-short=\u00221 yr\u0022\u003EAugust 20, 2022\u003C/time\u003E by Krafpy\u003C/strong\u003E\n\u003Cbr\u003EJuly 2022 update\n\u003C/span\u003E\n"},{"CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2021-08-16T18:54:51Z","Content":"\n\u003Cp\u003E\nWould be nice to see this in-game, so that it can work with any installed planet pack.\u00A0 But looks very nice\n\u003C/p\u003E\n"},{"CreatedByName":"antipro","CreatedById":173370,"CreatedDateTime":"2021-08-16T23:12:02Z","Content":"\n\u003Cp\u003E\nit seems pretty cool and it would be nice to have a mod like this, anyway trying with a Ke-Ev-Ev-Mo and Ke-Mo sequences,\u003Cbr\u003E\nI can\u0027t get a result better than a direct Ke-Mo \u003Cabbr title=\u0022Mechjeb (mod)\u0022\u003E\u003Cabbr title=\u0022Mechjeb (mod)\u0022\u003EMJ\u003C/abbr\u003E\u003C/abbr\u003E adv transfer at year 168 day 96.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222021-08-18T09:04:30Z\u0022 title=\u002208/18/2021 09:04  AM\u0022 data-short=\u00222 yr\u0022\u003EAugust 18, 2021\u003C/time\u003E by antipro\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Krafpy","CreatedById":213892,"CreatedDateTime":"2021-08-17T10:27:10Z","Content":"\n\u003Cp\u003E\nThe displayed \u0022total \u0394V\u0022 does not count the circularization around the destination body. Since you cannot define the final orbit you want to get around the destination body, I judged not necessary to count it in the trajectory details. Note that it is however taken in account by the optimization process which tries to minimize the relative velocity at the arrival.\n\u003C/p\u003E\n\u003Cp\u003E\nIn the case of the Ke-Ev-Ev-Mo trajectory, the resulting \u0394V is higher than a direct Ke-Mo transfer (usually up to 3000 m/s for the first one, and less than 2000 for the second one). This is because there are more maneuvers in the Ke-Ev-Ev-Mo trajectory, thus more \u0394V is used to get an encounter. But since the gravity assists lowered your orbit, the final encounter velocity will be smaller than if you did a direct Ke-Mo transfer, which should counter the extra \u0394V from the various maneuvers.\n\u003C/p\u003E\n\u003Cp\u003E\n(The total \u0394V with circularization is however displayed in the dev console if you want to see it : F12 -\u0026gt; Console)\n\u003C/p\u003E\n\u003Cp\u003E\nI notice now that this may be confusing, so I\u0027ll work on it right now to add the circularization maneuver in the trajectory details.\n\u003C/p\u003E\n\u003Cp\u003E\nI also point out that searching in a very wide range of departure dates may result in less optimal trajectories than with smaller ranges.\n\u003C/p\u003E\n\u003Cp\u003E\nAs for making this a mod (as linuxgurugamer already mentioned it), I considered it at the beginning but I wanted to experiment with the physics and maths of orbital mechanics. But if I manage to improve my current tool and have it working well, I will consider adapting it into a mod (if I have the time...).\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nEdit: I updated the tool so now the \u0394V for circularization around the destination body is counted in the total \u0394V.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222021-08-17T11:27:23Z\u0022 title=\u002208/17/2021 11:27  AM\u0022 data-short=\u00222 yr\u0022\u003EAugust 17, 2021\u003C/time\u003E by Krafpy\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Snark","CreatedById":125662,"CreatedDateTime":"2021-08-17T11:57:13Z","Content":"\n\u003Cp\u003E\nMoving to \u0022Tools and Applications\u0022, since this isn\u0027t really a tutorial per se.\n\u003C/p\u003E\n\u003Cp\u003E\nVery cool work, \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/213892-krafpy/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022213892\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/213892-krafpy/\u0022 rel=\u0022\u0022\u003E@Krafpy\u003C/a\u003E!\u00A0 \u003Cspan\u003E\u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u003C/span\u003E\n\u003C/p\u003E\n"},{"CreatedByName":"antipro","CreatedById":173370,"CreatedDateTime":"2021-08-18T09:04:01Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00224021047\u0022 data-ipsquote-contentid=\u0022204391\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221629196030\u0022 data-ipsquote-userid=\u0022213892\u0022 data-ipsquote-username=\u0022Krafpy\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nOn 8/17/2021 at 12:27 PM, Krafpy said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nI updated the tool so now the \u0394V for circularization around the destination body is counted in the total \u0394V.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\ngood, but I still can\u0027t calculate a better or at least similar \u003Cabbr title=\u0022Delta-V\u0022\u003E\u003Cabbr title=\u0022Delta-V\u0022\u003EdV\u003C/abbr\u003E\u003C/abbr\u003E result:\u003Cbr\u003E\u003Cbr\u003E\u003Cabbr title=\u0022Mechjeb (mod)\u0022\u003E\u003Cabbr title=\u0022Mechjeb (mod)\u0022\u003EMJ\u003C/abbr\u003E\u003C/abbr\u003E adv transfer: 2198 \u002B 1967 = \u003Cstrong\u003E4165\u00A0m/s\u003C/strong\u003E (at 100km)\u003Cbr\u003E\nMGA: Ke-Mo: \u003Cstrong\u003E\u003Cspan\u003E5301\u003C/span\u003E m/s\u003C/strong\u003E\u003Cbr\u003E\nMGA: Ke-Ev-Ev-Mo: \u003Cstrong\u003E\u003Cspan\u003E4470\u003C/span\u003E m/s\u003C/strong\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u0022MJ%20Ke-Mo.jpg?dl=1\u0022 class=\u0022ipsImage\u0022 data-ratio=\u002290.00\u0022 height=\u0022675\u0022 width=\u00221200\u0022 src=\u0022https://www.dropbox.com/s/ujtf7hy6fqemsks/MJ%20Ke-Mo.jpg?dl=1\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u0022MGA%20Ke-Mo.jpg?dl=1\u0022 class=\u0022ipsImage\u0022 data-ratio=\u002277.31\u0022 height=\u0022913\u0022 width=\u00221181\u0022 src=\u0022https://www.dropbox.com/s/9xvjw6vw43gdg8t/MGA%20Ke-Mo.jpg?dl=1\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u0022MGA%20Ke-Ev-Ev-Mo.jpg?dl=1\u0022 class=\u0022ipsImage\u0022 data-ratio=\u002275.25\u0022 height=\u0022902\u0022 width=\u00221200\u0022 src=\u0022https://www.dropbox.com/s/fl39vgis5t96r8e/MGA%20Ke-Ev-Ev-Mo.jpg?dl=1\u0022\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222021-08-18T12:33:24Z\u0022 title=\u002208/18/2021 12:33  PM\u0022 data-short=\u00222 yr\u0022\u003EAugust 18, 2021\u003C/time\u003E by antipro\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Krafpy","CreatedById":213892,"CreatedDateTime":"2021-08-18T11:04:26Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00224021400\u0022 data-ipsquote-contentid=\u0022204391\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221629277441\u0022 data-ipsquote-userid=\u0022173370\u0022 data-ipsquote-username=\u0022antipro\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n1 hour ago, antipro said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nI still can\u0027t calculate a better or at least similar \u003Cabbr title=\u0022Delta-V\u0022\u003E\u003Cabbr title=\u0022Delta-V\u0022\u003EdV\u003C/abbr\u003E\u003C/abbr\u003E result\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nAlright I think I know where this can come from.\n\u003C/p\u003E\n\u003Cp\u003E\nI can\u0027t really see it on your screenshot, but I guess tha\u003Cabbr\u003Et on \u003Cabbr title=\u0022Mechjeb (mod)\u0022\u003EMJ\u003C/abbr\u003E\u003C/abbr\u003E\u0027s trajectory, the first maneuver (on Kerbin\u0027s parking orbit) is not only prograde but also have a normal component. Which directly gives the correct inclination when you exit Kerbin\u0027s \u003Cabbr title=\u0022Sphere of Influence\u0022\u003ESOI\u003C/abbr\u003E, so that the deep space orbit immediatly matches Moho\u0027s orbit inclination. Whereas in my implementation, the first maneuver can only be prograde.\n\u003C/p\u003E\n\u003Cp\u003E\nThis though doesn\u0027t explain all as this problem can be countered if the DSM happens right after exiting Kerbin\u0027s \u003Cabbr title=\u0022Sphere of Influence\u0022\u003ESOI\u003C/abbr\u003E and gives the correct inclination to the transit orbit. I have another idea of what may cause this, but it\u0027s a bit complicated to explain here because it is related to how the trajectory is computed and represented in my program.\n\u003C/p\u003E\n\u003Cp\u003E\nIt can also simply be an error in \u003Cabbr title=\u0022Delta-V\u0022\u003EdV\u003C/abbr\u003E calculation... (maths mistakes can happen \u003Cimg alt=\u0022:(\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_sad.gif\u0022 title=\u0022:(\u0022\u003E)\n\u003C/p\u003E\n\u003Cp\u003E\nThanks for reporting this problem. I\u0027ll try to work on it as soon as I can.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"antipro","CreatedById":173370,"CreatedDateTime":"2021-08-18T13:16:28Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00224021424\u0022 data-ipsquote-contentid=\u0022204391\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221629284666\u0022 data-ipsquote-userid=\u0022213892\u0022 data-ipsquote-username=\u0022Krafpy\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n2 hours ago, Krafpy said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nI guess tha\u003Cabbr\u003Et on \u003Cabbr title=\u0022Mechjeb (mod)\u0022\u003E\u003Cabbr title=\u0022Mechjeb (mod)\u0022\u003EMJ\u003C/abbr\u003E\u003C/abbr\u003E\u003C/abbr\u003E\u0027s trajectory, the first maneuver (on Kerbin\u0027s parking orbit) is not only prograde but also have a normal component.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nyes, it has a normal component of -35, and also the parking orbit is inclined by 25\u00B0, that saves about 150 \u003Cabbr title=\u0022Delta-V\u0022\u003E\u003Cabbr title=\u0022Delta-V\u0022\u003EdV\u003C/abbr\u003E\u003C/abbr\u003E compared to if I launch into an Eq orbit.\u003Cbr\u003E\nThis is why the navball maneuver indicator is so close to the prograde indicator.\u003Cbr\u003E\u003Cbr\u003E\u003Cimg alt=\u0022node%201.png?dl=1\u0022 class=\u0022ipsImage\u0022 data-ratio=\u002290.00\u0022 height=\u0022675\u0022 width=\u00221200\u0022 src=\u0022https://www.dropbox.com/s/bh1vdyqqk07yhtb/node%201.png?dl=1\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00224021424\u0022 data-ipsquote-contentid=\u0022204391\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221629284666\u0022 data-ipsquote-userid=\u0022213892\u0022 data-ipsquote-username=\u0022Krafpy\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n2 hours ago, Krafpy said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nThanks for reporting this problem. I\u0027ll try to work on it as soon as I can.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThx to you for this software.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222021-08-18T13:29:43Z\u0022 title=\u002208/18/2021 01:29  PM\u0022 data-short=\u00222 yr\u0022\u003EAugust 18, 2021\u003C/time\u003E by antipro\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Arrowstar","CreatedById":2521,"CreatedDateTime":"2021-08-19T14:18:56Z","Content":"\n\u003Cp\u003E\nThis is pretty neat, good work.\u00A0 It\u0027s interesting you went down the DSM route instead of the powered flyby route like I do in KSPTOT\u0027s MFMS tool.\u00A0 Was there a reason for that decision?\n\u003C/p\u003E\n\u003Cp\u003E\nBtw, did MFMS inspire any of this?\u00A0 It looks very similar in some ways lol. \u003Cimg alt=\u0022:lol:\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_laugh.png\u0022 title=\u0022:lol:\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Krafpy","CreatedById":213892,"CreatedDateTime":"2021-08-19T18:44:11Z","Content":"\n\u003Cp\u003E\nT\u003Cspan\u003Ehanks for your comment \u003Cspan\u003E\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/2521-arrowstar/\u0026amp;do=hovercard\u0022 data-mentionid=\u00222521\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/2521-arrowstar/\u0022 rel=\u0022\u0022\u003E@Arrowstar\u003C/a\u003E\u003C/span\u003E\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nI took the DSM route because it looked \u0022simpler\u0022 to implement. In the sense that I could directly use a Lambert solver to find arcs with a guaranteed intersection along with the DSM \u003Cabbr title=\u0022Delta-V\u0022\u003E\u003Cabbr title=\u0022Delta-V\u0022\u003EdV\u003C/abbr\u003E\u003C/abbr\u003E. I don\u0027t really know how to implement powered flybys. It would be nice to combine both to have even better trajectories I think.\n\u003C/p\u003E\n\u003Cp\u003E\nI didn\u0027t really look at existing tools before starting mine. I just got that idea during a physics class and I was curious to learn orbital mechanics, so I thought creating this tool would be interesting. So if it\u0027s similar to yours, it\u0027s pure \u003Cspan lang=\u0022en\u0022 xml:lang=\u0022en\u0022\u003E\u003Cspan\u003E\u003Cspan\u003Ecoincidence\u003C/span\u003E\u003C/span\u003E\u003C/span\u003E \u003Cimg alt=\u0022:lol:\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_laugh.png\u0022 title=\u0022:lol:\u0022\u003E.\n\u003C/p\u003E\n\u003Cp\u003E\nMy main resource was a Ph.D thesis by Matteo Ceriotti about optimization of multiple gravity assists trajectories. The other sources I used are listed on the github repo of my tool.\n\u003C/p\u003E\n\u003Cp\u003E\nI would be curious to see how your tool performs compared to mine (yours would probably win lol, as mine has still a lot of room for improvement). I am using a differential evolution algorithm to optimize the trajectory with a vector representation. What method are you using in your tool ?\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222021-08-19T18:52:18Z\u0022 title=\u002208/19/2021 06:52  PM\u0022 data-short=\u00222 yr\u0022\u003EAugust 19, 2021\u003C/time\u003E by Krafpy\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"antipro","CreatedById":173370,"CreatedDateTime":"2021-08-20T10:50:47Z","Content":"\n\u003Cp\u003E\nHi \u003Cspan\u003E\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/213892-krafpy/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022213892\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/213892-krafpy/\u0022 rel=\u0022\u0022\u003E@Krafpy\u003C/a\u003E\u003C/span\u003E,\u00A0\u003Cspan lang=\u0022en\u0022 xml:lang=\u0022en\u0022\u003E\u003Cspan\u003E\u003Cspan\u003EI understand that advanced math is familiar to you so,\u003C/span\u003E\u003C/span\u003E\u003C/span\u003E\u003Cbr\u003E\njust out of curiosity, could you write a software similar to MGA but which solves the problem of calculating the best route for a certain Grand Tour?\u003Cbr\u003E\nThat is, given a series of celestial bodies, find the best low space flyby sequence, or given the exact sequence of celestial bodies, find the best route?\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222021-08-20T10:54:14Z\u0022 title=\u002208/20/2021 10:54  AM\u0022 data-short=\u00222 yr\u0022\u003EAugust 20, 2021\u003C/time\u003E by antipro\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Krafpy","CreatedById":213892,"CreatedDateTime":"2021-08-20T11:33:29Z","Content":"\n\u003Cp\u003E\n\u003Cspan\u003E\u003Cspan\u003E\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/173370-antipro/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022173370\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/173370-antipro/\u0022 rel=\u0022\u0022\u003E@antipro\u003C/a\u003E So if I understand correctly, extending my MGA to have custom planetary sequences ?\u003C/span\u003E\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cspan\u003E\u003Cspan\u003EIf it\u0027s that, then I can definitely add a custom flyby sequence input to my MGA solver. The optimization process doesn\u0027t need any change and will search an optimal trajectory that follows the sequence it receives... regardless of if it\u0027s from the sequence generator or from a custom input. It was something I was already planning on.\u003C/span\u003E\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cspan\u003E\u003Cspan\u003EAs for the altitude of the flybys, I\u0027m currently limiting the maximum altitude to two times the radius of the body, so that may be enough ? I will see if I can add an input to control that too.\u003C/span\u003E\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cspan\u003E\u003Cspan\u003EUnfortunately school starts soon for me and I have to prepare a lot homeworks. But I\u0027ll try at least to get the sequence input done as soon as possible.\u003C/span\u003E\u003C/span\u003E\n\u003C/p\u003E\n"},{"CreatedByName":"antipro","CreatedById":173370,"CreatedDateTime":"2021-08-20T12:45:45Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00224022206\u0022 data-ipsquote-contentid=\u0022204391\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221629459209\u0022 data-ipsquote-userid=\u0022213892\u0022 data-ipsquote-username=\u0022Krafpy\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n42 minutes ago, Krafpy said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nSo if I understand correctly, extending my MGA to have custom planetary sequences ?\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\ncorrect, \u003Cspan lang=\u0022en\u0022 xml:lang=\u0022en\u0022\u003E\u003Cspan\u003E\u003Cspan\u003Efor example:\u003Cbr\u003E\n- the user chooses the planets included in his Grand Tour contract \u0026gt; MGA-Planner provides the best sequence and the \u003C/span\u003E\u003C/span\u003E\u003Cspan\u003E\u003Cspan\u003Etrajectories.\u003C/span\u003E\u003C/span\u003E\u003C/span\u003E\u003Cbr\u003E\n-\u003Cspan lang=\u0022en\u0022 xml:lang=\u0022en\u0022\u003E\u003Cspan\u003E\u003Cspan\u003E the user chooses a specific \u003C/span\u003E\u003C/span\u003E\u003Cspan\u003E\u003Cspan\u003Eplanetary sequence\u003C/span\u003E\u003C/span\u003E\u003Cspan\u003E\u003Cspan\u003E \u0026gt; MGA-Planner provides the best \u003C/span\u003E\u003C/span\u003E\u003Cspan\u003E\u003Cspan\u003Etrajectories.\u003C/span\u003E\u003C/span\u003E\u003C/span\u003E\u003Cbr\u003E\u003Cbr\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00224022206\u0022 data-ipsquote-contentid=\u0022204391\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221629459209\u0022 data-ipsquote-userid=\u0022213892\u0022 data-ipsquote-username=\u0022Krafpy\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n1 hour ago, Krafpy said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nIt was something I was already planning on.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\ngood to know.\u003Cbr\u003E\u003Cbr\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00224022206\u0022 data-ipsquote-contentid=\u0022204391\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221629459209\u0022 data-ipsquote-userid=\u0022213892\u0022 data-ipsquote-username=\u0022Krafpy\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n1 hour ago, Krafpy said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nAs for the altitude of the flybys, I\u0027m currently limiting the maximum altitude to two times the radius of the body, so that may be enough ?\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\n\u003Cspan lang=\u0022en\u0022 xml:lang=\u0022en\u0022\u003E\u003Cspan\u003E\u003Cspan\u003Eno, it wouldn\u0027t be enough but it doesn\u0027t matter, it\u0027s not that important in order to complete the Grand Tours contracts.\u003Cbr\u003E\nI said \u0022low space\u0022 because of \u003C/span\u003E\u003C/span\u003E\u003Cspan\u003E\u003Cspan\u003EI was thinking about how to get as many scientific experiments as possible.\u003C/span\u003E\u003C/span\u003E\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00224022206\u0022 data-ipsquote-contentid=\u0022204391\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221629459209\u0022 data-ipsquote-userid=\u0022213892\u0022 data-ipsquote-username=\u0022Krafpy\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n1 hour ago, Krafpy said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nBut I\u0027ll try at least to get the sequence input done as soon as possible.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\n\u003Cspan lang=\u0022en\u0022 xml:lang=\u0022en\u0022\u003E\u003Cspan\u003E\u003Cspan\u003EThanks.\u003C/span\u003E\u003C/span\u003E\u003C/span\u003E\n\u003C/p\u003E\n"},{"CreatedByName":"Arrowstar","CreatedById":2521,"CreatedDateTime":"2021-08-20T14:52:09Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00224021968\u0022 data-ipsquote-contentid=\u0022204391\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221629398651\u0022 data-ipsquote-userid=\u0022213892\u0022 data-ipsquote-username=\u0022Krafpy\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n19 hours ago, Krafpy said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nT\u003Cspan\u003Ehanks for your comment \u003Cspan\u003E\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/2521-arrowstar/\u0026amp;do=hovercard\u0022 data-mentionid=\u00222521\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/2521-arrowstar/\u0022 rel=\u0022\u0022\u003E@Arrowstar\u003C/a\u003E\u003C/span\u003E\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nI took the DSM route because it looked \u0022simpler\u0022 to implement. In the sense that I could directly use a Lambert solver to find arcs with a guaranteed intersection along with the DSM \u003Cabbr title=\u0022Delta-V\u0022\u003E\u003Cabbr title=\u0022Delta-V\u0022\u003EdV\u003C/abbr\u003E\u003C/abbr\u003E. I don\u0027t really know how to implement powered flybys. It would be nice to combine both to have even better trajectories I think.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nPowered flybys are a bit challenging, I agree.\u00A0 The idea is basically to figure out what the delta-v vector at flyby periapsis is that connects your inbound and outbound trajectories.\u00A0 I admit it took me a few weeks of getting the math worked out back in the day, but it works well now.\u00A0 I\u0027ve actually considered adding DSMs to my software but powered flybys work pretty well and I just haven\u0027t been interested in doing it yet.\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nQuote\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nI would be curious to see how your tool performs compared to mine (yours would probably win lol, as mine has still a lot of room for improvement). I am using a differential evolution algorithm to optimize the trajectory with a vector representation. What method are you using in your tool ?\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nI use a genetic algorithm as well.\u00A0 I\u0027ve tried a few global optimization algorithms but GAs (or DE, same thing basically) seem to work the best.\u00A0 I definitely found that Direct Search methods and MATLAB\u0027s \u0022Global Search\u0022 methods didn\u0027t work nearly as well.\n\u003C/p\u003E\n"},{"CreatedByName":"Krafpy","CreatedById":213892,"CreatedDateTime":"2021-08-20T23:06:24Z","Content":"\n\u003Cp\u003E\nSoftware update ! You can now enter a custom planetary sequence. This is useful if the automated generator omitted interesting sequences or if you want to define your own routes. The trajectory optimizer will automatically calculate the trajectory for the custom sequence if you specified one. If not specified, then it will use the selected sequence from the proposed ones as before.\n\u003C/p\u003E\n\u003Cp\u003E\nFor example, the automated generator does not propose a Ke-Ev-Mo route (for some reason I don\u0027t know yet). However, setting that sequence manually provides very interesting Kerbin to Moho trajectories ! I managed to get one which requires about 2700m/s of total \u003Cabbr title=\u0022Delta-V\u0022\u003E\u003Cabbr title=\u0022Delta-V\u0022\u003EdV\u003C/abbr\u003E\u003C/abbr\u003E.\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cspan\u003E\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/173370-antipro/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022173370\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/173370-antipro/\u0022 rel=\u0022\u0022\u003E@antipro\u003C/a\u003E You can define the sequence for your Grand Tours. It doesn\u0027t generate a sequence for a particular set of planets though. You have to define\u003C/span\u003E the sequence manually, i.e. the visited planets as well as intermediate flybys for eventual gravity assists. For example if you want to visit Eve and Duna, you can enter : Ke-Ev-Ke-Du.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n(if the input bar looks ugly, it\u0027s probably because your web browser saved the previous CSS file in cache, in that case: F12 -\u0026gt; Network -\u0026gt; check \u0022Disable cache\u0022 and reload the page)\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222021-08-20T23:14:16Z\u0022 title=\u002208/20/2021 11:14  PM\u0022 data-short=\u00222 yr\u0022\u003EAugust 20, 2021\u003C/time\u003E by Krafpy\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Arrowstar","CreatedById":2521,"CreatedDateTime":"2021-08-21T01:35:32Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00224022477\u0022 data-ipsquote-contentid=\u0022204391\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221629500784\u0022 data-ipsquote-userid=\u0022213892\u0022 data-ipsquote-username=\u0022Krafpy\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n2 hours ago, Krafpy said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nSoftware update ! You can now enter a custom planetary sequence. This is useful if the automated generator omitted interesting sequences or if you want to define your own routes. The trajectory optimizer will automatically calculate the trajectory for the custom sequence if you specified one. If not specified, then it will use the selected sequence from the proposed ones as before.\n\u003C/p\u003E\n\u003Cp\u003E\nFor example, the automated generator does not propose a Ke-Ev-Mo route (for some reason I don\u0027t know yet). However, setting that sequence manually provides very interesting Kerbin to Moho trajectories ! I managed to get one which requires about 2700m/s of total \u003Cabbr title=\u0022Delta-V\u0022\u003E\u003Cabbr title=\u0022Delta-V\u0022\u003EdV\u003C/abbr\u003E\u003C/abbr\u003E.\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cspan\u003E\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/173370-antipro/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022173370\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/173370-antipro/\u0022 rel=\u0022\u0022\u003E@antipro\u003C/a\u003E You can define the sequence for your Grand Tours. It doesn\u0027t generate a sequence for a particular set of planets though. You have to define\u003C/span\u003E the sequence manually, i.e. the visited planets as well as intermediate flybys for eventual gravity assists. For example if you want to visit Eve and Duna, you can enter : Ke-Ev-Ke-Du.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n(if the input bar looks ugly, it\u0027s probably because your web browser saved the previous CSS file in cache, in that case: F12 -\u0026gt; Network -\u0026gt; check \u0022Disable cache\u0022 and reload the page)\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nSo I tried a Kerbin - Eve - Jool - Eeloo flyby with your software tonight and compared it to KSPTOT.\u00A0 I end up with a total mission delta-v of 2.5 km/s.\u00A0 Yours seems to settle pretty consistently around 5.5 km/s - 6.0 km/s.\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u0022WCnXKfV.png\u0022 class=\u0022ipsImage\u0022 data-ratio=\u002279.63\u0022 height=\u0022825\u0022 width=\u00221036\u0022 src=\u0022https://i.imgur.com/WCnXKfV.png\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nA few questions that might help debug a bit:\n\u003C/p\u003E\n\u003Cul\u003E\u003Cli\u003E\nHow many individuals are in your DE population?\n\u003C/li\u003E\n\u003Cli\u003E\nHow are you bounding the optimization variables?\n\u003C/li\u003E\n\u003Cli\u003E\nDoes your Lambert solver consider both long way and short way trajectories?\n\u003C/li\u003E\n\u003C/ul\u003E\n"},{"CreatedByName":"antipro","CreatedById":173370,"CreatedDateTime":"2021-08-21T03:53:37Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00224022477\u0022 data-ipsquote-contentid=\u0022204391\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221629500784\u0022 data-ipsquote-userid=\u0022213892\u0022 data-ipsquote-username=\u0022Krafpy\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n5 hours ago, Krafpy said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nHowever, setting that sequence manually provides very interesting Kerbin to Moho trajectories ! I managed to get one which requires about 2700m/s of total \u003Cabbr title=\u0022Delta-V\u0022\u003E\u003Cabbr title=\u0022Delta-V\u0022\u003EdV\u003C/abbr\u003E\u003C/abbr\u003E.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nNice, I\u0027ve just tried the Ke-Ev-Mo sequence for the whole year 168 and I got:\u003Cbr\u003E\nDeparture date:\u003Cstrong\u003E\u003Cspan\u003E Year 168 - Day 219 - 00:29:05\u003C/span\u003E UT\u003C/strong\u003E\u003Cbr\u003E\nTotal \u0394V:\u003Cstrong\u003E\u003Cspan\u003E 2688.0\u003C/span\u003E m/s\u003C/strong\u003E\u003Cbr\u003E\u003Cspan lang=\u0022en\u0022 xml:lang=\u0022en\u0022\u003E\u003Cspan\u003E\u003Cspan\u003EPretty amazing, isn\u0027t it?\u003C/span\u003E\u003C/span\u003E\u003C/span\u003E\u003Cbr\u003E\u003Cbr\u003E\nThen I tried a typical easy Grand Tour seq. such as \u0022Ke-Ev-Mo-Du-Ke\u0022 for the first 100 years and I got:\u003Cbr\u003E\nDeparture date:\u003Cstrong\u003E\u003Cspan\u003E Year 53 - Day 240 - 05:11:55\u003C/span\u003E UT\u003C/strong\u003E\u003Cbr\u003E\nTotal \u0394V:\u003Cstrong\u003E\u003Cspan\u003E 8218.7\u003C/span\u003E m/s\u003C/strong\u003E\u003Cbr\u003E\u003Cbr\u003E\nDon\u0027t know about the \u003Cabbr title=\u0022Delta-V\u0022\u003E\u003Cabbr title=\u0022Delta-V\u0022\u003EdV\u003C/abbr\u003E\u003C/abbr\u003E, anyway the complete Tour lasted 57 years cause after the Eve swing-by something went bad:\u003Cbr\u003E\u003Cspan lang=\u0022en\u0022 xml:lang=\u0022en\u0022\u003E\u003Cspan\u003E\u003Cspan\u003Ethe Apoapsids became very high, more than eeloo\u0027s SMA\u003C/span\u003E\u003C/span\u003E\u003C/span\u003E, and just before return home it decided I have to\u003Cbr\u003E\nliterally pass through the sun...this will hurt..\u003Cspan\u003E eheh..\u003C/span\u003E\u003Cbr\u003E\u003Cbr\u003E\u003Cimg alt=\u0022Ke-Ev-Mo-Du-Ke.jpg?dl=1\u0022 class=\u0022ipsImage\u0022 data-ratio=\u002283.00\u0022 height=\u0022979\u0022 width=\u00221200\u0022 src=\u0022https://www.dropbox.com/s/nj315q5j726k4xd/Ke-Ev-Mo-Du-Ke.jpg?dl=1\u0022\u003E\u003Cbr\u003E\u003Cbr\u003E\u003Cimg alt=\u0022high%20Ap.jpg?dl=1\u0022 class=\u0022ipsImage\u0022 data-ratio=\u002246.92\u0022 height=\u0022442\u0022 width=\u00221200\u0022 src=\u0022https://www.dropbox.com/s/oc1l38pbphnhcg5/high%20Ap.jpg?dl=1\u0022\u003E\u003Cbr\u003E\u003Cbr\u003E\nIt takes some time of my slow cpu to calculate 5 or more planets, but I will do other tests. It\u0027s just funny.\u003Cbr\u003E\u003Cbr\u003E\nOne thing, if I can say: many Grand Tours contracts end with the \u0022return to kerbin\u0022 condition,\u003Cbr\u003E\u003Cspan lang=\u0022en\u0022 xml:lang=\u0022en\u0022\u003E\u003Cspan\u003E\u003Cspan\u003Etherefore it would be useful to be able to choose whether or not to add the last circularization maneuver in the Total \u003Cabbr title=\u0022Delta-V\u0022\u003E\u003Cabbr title=\u0022Delta-V\u0022\u003EdV\u003C/abbr\u003E\u003C/abbr\u003E.\u003C/span\u003E\u003C/span\u003E\u003C/span\u003E\u003Cbr\u003E\ncause in these cases, the last maneuver\u00A0coming from deep space, is aerobraking and not circularize.\u003Cbr\u003E\u003Cbr\u003E\u003Cspan lang=\u0022en\u0022 xml:lang=\u0022en\u0022\u003E\u003Cspan\u003E\u003Cspan\u003EProvided that it \u003C/span\u003E\u003C/span\u003E\u003Cspan\u003E\u003Cspan\u003Eis mathematically simple \u003C/span\u003E\u003C/span\u003E\u003C/span\u003Eenough\u003Cspan lang=\u0022en\u0022 xml:lang=\u0022en\u0022\u003E\u003Cspan\u003E\u003Cspan\u003E, the next step would be to add bodies that do not orbit the same body, I mean Gilly, Ike and Jool\u0027s moons.\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E\nedit: with the \u0022\u003C/span\u003E\u003C/span\u003E\u003C/span\u003EKe-Ev-Du-Ke\u003Cspan lang=\u0022en\u0022 xml:lang=\u0022en\u0022\u003E\u003Cspan\u003E\u003Cspan\u003E\u0022 seq. it seems all went good.\u003C/span\u003E\u003C/span\u003E\u003C/span\u003E\u003Cbr\u003E\nDeparture date:\u003Cstrong\u003E\u003Cspan\u003E Year 99 - Day 408 - 04:58:52\u003C/span\u003E UT\u003C/strong\u003E\u003Cbr\u003E\nTotal \u0394V:\u003Cstrong\u003E\u003Cspan\u003E 3743.5\u003C/span\u003E m/s \u003C/strong\u003E\u003Cspan lang=\u0022en\u0022 xml:lang=\u0022en\u0022\u003E\u003Cspan\u003E\u003Cspan\u003E(minus the circularization \u003Cabbr title=\u0022Delta-V\u0022\u003E\u003Cabbr title=\u0022Delta-V\u0022\u003EdV\u003C/abbr\u003E\u003C/abbr\u003E\u003C/span\u003E\u003C/span\u003E\u003C/span\u003E\u003Cspan\u003E) 3743.5\u003C/span\u003E - 904.1 = \u003Cstrong\u003E2.839,4 m/s\u003C/strong\u003E\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E\u003Cimg alt=\u0022Ke-Ev-Du-Ke.jpg?dl=1\u0022 class=\u0022ipsImage\u0022 data-ratio=\u002276.25\u0022 height=\u0022891\u0022 width=\u00221200\u0022 src=\u0022https://www.dropbox.com/s/6t3aiabqt9kv31t/Ke-Ev-Du-Ke.jpg?dl=1\u0022\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222021-08-21T05:02:55Z\u0022 title=\u002208/21/2021 05:02  AM\u0022 data-short=\u00222 yr\u0022\u003EAugust 21, 2021\u003C/time\u003E by antipro\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Krafpy","CreatedById":213892,"CreatedDateTime":"2021-08-21T10:39:29Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00224022549\u0022 data-ipsquote-contentid=\u0022204391\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221629518017\u0022 data-ipsquote-userid=\u0022173370\u0022 data-ipsquote-username=\u0022antipro\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n6 hours ago, antipro said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\n\u003Cspan lang=\u0022en\u0022 xml:lang=\u0022en\u0022\u003E\u003Cspan\u003E\u003Cspan\u003Ethe Apoapsids became very high, more than eeloo\u0027s SMA\u003C/span\u003E\u003C/span\u003E\u003C/span\u003E, and just before return home it decided I have to\u003Cbr\u003E\nliterally pass through the sun...this will hurt..\u003Cspan\u003E eheh..\u003C/span\u003E\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThis is a problem I was aware of and it is on the list of things to fix. So yeah, like I mentionned in my very first post, expect to sometimes get non sense trajectories like this one. As for colliding trajectories, it\u0027s something, I thought that, with the way I implemented flybys, shouldn\u0027t be possible... but turns out my maths were wrong \u003Cimg alt=\u0022:lol:\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_laugh.png\u0022 title=\u0022:lol:\u0022\u003E.\n\u003C/p\u003E\n\u003Cp\u003E\nAlso note that in the Ke-Ev-Mo-Du-Ke sequence, you are doing a direct transfer from Moho to Duna... which is something that requires a lot of \u003Cabbr title=\u0022Delta-V\u0022\u003EdV\u003C/abbr\u003E. So here it would be interesting I think to add an extra Eve flyby and therefore have the following sequence for your tour \u003Cspan\u003E: \u003C/span\u003EKe-Ev-Mo\u003Cstrong\u003E-Ev-\u003C/strong\u003EDu-Ke.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00224022549\u0022 data-ipsquote-contentid=\u0022204391\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221629518017\u0022 data-ipsquote-userid=\u0022173370\u0022 data-ipsquote-username=\u0022antipro\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n6 hours ago, antipro said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nit would be useful to be able to choose whether or not to add the last circularization maneuver in the Total \u003Cabbr title=\u0022Delta-V\u0022\u003E\u003Cabbr title=\u0022Delta-V\u0022\u003EdV\u003C/abbr\u003E\u003C/abbr\u003E.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nIt is something I can easily add. And since you plan on using aerobraking, I can make so that the optimization process still tries to minimize the relative velocity to Kerbin for example, but without considering the circularization.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00224022549\u0022 data-ipsquote-contentid=\u0022204391\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221629518017\u0022 data-ipsquote-userid=\u0022173370\u0022 data-ipsquote-username=\u0022antipro\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n6 hours ago, antipro said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nIt takes some time of my slow cpu to calculate 5 or more planets\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nIndeed the computations get longer as you add more bodies. I made the computation multithreaded, but this is surely not enough for some processors. I\u0027ll add more details about the optimzation step in my next post to answer to Arrowstar. Also I recommend you to have the task manager open if you want to experiment with bigger sequences... to avoid asking too much of your CPU and RAM.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00224022549\u0022 data-ipsquote-contentid=\u0022204391\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221629518017\u0022 data-ipsquote-userid=\u0022173370\u0022 data-ipsquote-username=\u0022antipro\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n6 hours ago, antipro said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nthe next step would be to add bodies that do not orbit the same body, I mean Gilly, Ike and Jool\u0027s moons.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThis is a whole other challenge. Combining gravity assists using planets and their moons is something I thought of at the beginning... but that I will consider when what I have now will work well and have all other issues fixed. I have no idea yet how I this can be implemented... but would definitely be a cool feature.\n\u003C/p\u003E\n\u003Cp\u003E\n(Though I don\u0027t really think a flyby of Gilly would be of any interest lol)\n\u003C/p\u003E\n\u003Cp\u003E\nCurrently, you can plan trajectories between Jool\u0027s moons, which is I think the most interesting. But all bodies visited (including departure and arrival body) must therefore be Jool\u0027s moons only. Though for having tested it, it is more probable to get non sense trajectories.\n\u003C/p\u003E\n"},{"CreatedByName":"Krafpy","CreatedById":213892,"CreatedDateTime":"2021-08-21T14:37:56Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00224022526\u0022 data-ipsquote-contentid=\u0022204391\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221629509732\u0022 data-ipsquote-userid=\u00222521\u0022 data-ipsquote-username=\u0022Arrowstar\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n13 hours ago, Arrowstar said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nA few questions that might help debug a bit:\n\u003C/p\u003E\n\u003Cul\u003E\u003Cli\u003E\nHow many individuals are in your DE population?\n\u003C/li\u003E\n\u003Cli\u003E\nHow are you bounding the optimization variables?\n\u003C/li\u003E\n\u003Cli\u003E\nDoes your Lambert solver consider both long way and short way trajectories?\n\u003C/li\u003E\n\u003C/ul\u003E\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nSo here are more details on the optimization process implementation (\u003Cstrong\u003Eas of the day I write this post\u003C/strong\u003E):\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cspan style=\u0022font-size:20px;\u0022\u003E\u003Cstrong\u003ETrajectory parameterization and DE settings\u003C/strong\u003E\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nEach agent is a vector of dimension \u003Cem\u003Ed = 4(n-1)\u002B2\u003C/em\u003E representing a trajectory, where \u003Cem\u003En\u003C/em\u003E is the number of bodies in the sequence. The size of the population is set to 500 *\u003Cem\u003E d\u003C/em\u003E. All components are real valued numbers and represent the variables of a trajectory. In order:\n\u003C/p\u003E\n\u003Cul\u003E\u003Cli\u003E\n\u003Cem\u003Et\u003Csub\u003E0\u003C/sub\u003E\u003C/em\u003E : The date of departure (in seconds, between the earliest and latest departure date specified)\n\u003C/li\u003E\n\u003Cli\u003E\n\u003Cem\u003Ek \u003C/em\u003E: The scale of the ejection velocity, as a multiple of the velocity required to eject from the gravitational influence of the departure body at the parking orbit radius (between 1.05 and 3)\n\u003C/li\u003E\n\u003C/ul\u003E\u003Cp\u003E\nThen for each interplanetary leg \u003Cem\u003Ei\u003C/em\u003E (definition in the \u0022How to use\u0022 section on the website), the 4 following components are added:\n\u003C/p\u003E\n\u003Cul\u003E\u003Cli\u003E\n\u003Cem\u003ET\u003Csub\u003Ei\u003C/sub\u003E\u003C/em\u003E\u003Cspan\u003E: \u003C/span\u003EThe duration of the leg (in seconds) joining the exited body and the next body on the sequence.\n\u003C/li\u003E\n\u003Cli\u003E\n\u003Cspan lang=\u0022el\u0022 title=\u0022Greek-language text\u0022 xml:lang=\u0022el\u0022\u003E\u03B1\u003Cem\u003E\u003Csub\u003Ei\u003C/sub\u003E\u003C/em\u003E : \u003C/span\u003EThe offset (in time) on the leg at which the DSM happen (between 0 and 1, so if this component has a value of 0.5 this means the DSM will happen after half of the leg duration).\n\u003C/li\u003E\n\u003Cli\u003E\n\u03B8\u003Csub\u003Ei\u003C/sub\u003E\u003Cspan\u003E: \u003C/span\u003Ean angle used to compute the entrance point on the \u003Cabbr title=\u0022Sphere of Influence\u0022\u003E\u003Cabbr title=\u0022Sphere of Influence\u0022\u003ESOI\u003C/abbr\u003E\u003C/abbr\u003E of the next body (described later).\n\u003C/li\u003E\n\u003Cli\u003E\n\u03C6\u003Csub\u003Ei\u003C/sub\u003E : same thing as above ^.\n\u003C/li\u003E\n\u003C/ul\u003E\u003Cp\u003E\nThe settings for the DE, as define here \u003Cspan\u003E: \u003C/span\u003E\u003Ca href=\u0022https://en.wikipedia.org/wiki/Differential_evolution\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://en.wikipedia.org/wiki/Differential_evolution\u003C/a\u003E , are : CR = 0.9 and F = 0.8. The algorithm I implemented is also the one describe on the wikipedia page.\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cspan style=\u0022font-size:20px;\u0022\u003E\u003Cstrong\u003ETrajectory calculation\u003C/strong\u003E\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nCurrently, the bounds are calculated and applied when the trajectory is computed (in the fitness function of the DE). Because depending on the trajectory, the bounds are different. The trajectory computation steps with bounds calculation are the following:\n\u003C/p\u003E\n\u003Col\u003E\u003Cli\u003E\nCalculate the parking orbit (equatoral circular orbit).\n\u003C/li\u003E\n\u003Cli\u003E\nCalculate the ejection velocity : v\u003Csub\u003Eejection\u003C/sub\u003E = \u003Cem\u003Ek\u003C/em\u003E * \u221A2 * v\u003Csub\u003Ecircular\u003C/sub\u003E ; and its corresponding \u003Cabbr title=\u0022Delta-V\u0022\u003E\u003Cabbr title=\u0022Delta-V\u0022\u003EdV\u003C/abbr\u003E\u003C/abbr\u003E : \u003Cabbr title=\u0022Delta-V\u0022\u003E\u003Cabbr title=\u0022Delta-V\u0022\u003EdV\u003C/abbr\u003E\u003C/abbr\u003E\u003Csub\u003E0\u003C/sub\u003E = v\u003Csub\u003Eejection\u003C/sub\u003E - v\u003Csub\u003Ecircular\u003C/sub\u003E (we suppose a prograde only maneuver).\n\u003C/li\u003E\n\u003Cli\u003E\n\u00A0Calculate the angle (true anomaly) at which this ejection should be done in order to have a velocity at infinity (i.e. when exiting the \u003Cabbr title=\u0022Sphere of Influence\u0022\u003E\u003Cabbr title=\u0022Sphere of Influence\u0022\u003ESOI\u003C/abbr\u003E\u003C/abbr\u003E) tangent to the departure\u0027s body orbit.\n\u003C/li\u003E\n\u003Cli\u003E\nPropagate the ejection orbit until exiting the \u003Cabbr title=\u0022Sphere of Influence\u0022\u003E\u003Cabbr title=\u0022Sphere of Influence\u0022\u003ESOI\u003C/abbr\u003E\u003C/abbr\u003E, calculate the global state vectors when exiting the \u003Cabbr title=\u0022Sphere of Influence\u0022\u003E\u003Cabbr title=\u0022Sphere of Influence\u0022\u003ESOI\u003C/abbr\u003E\u003C/abbr\u003E.\n\u003C/li\u003E\n\u003Cli\u003E\nFor each leg \u003Cem\u003Ei \u003C/em\u003E\u003Cspan\u003E:\u003C/span\u003E\n\u003Col\u003E\u003Cli\u003E\n\u003Cspan\u003ECalculate the deep space orbit from the state vectors calculated before.\u003C/span\u003E\n\u003C/li\u003E\n\u003Cli\u003E\n\u003Cspan\u003EApply the following bounds to \u003Cem\u003ET\u003C/em\u003E\u003Csub\u003E\u003Cem\u003Ei\u003C/em\u003E\u003C/sub\u003E and\u00A0\u003C/span\u003E\u003Cspan lang=\u0022el\u0022 title=\u0022Greek-language text\u0022 xml:lang=\u0022el\u0022\u003E\u03B1\u003Cem\u003E\u003Csub\u003Ei\u003C/sub\u003E\u003C/em\u003E\u003C/span\u003E\u003Cspan\u003E (simple clamping), \u003C/span\u003Elet \u003Cem\u003EP\u003C/em\u003E be the period of the resulted deep space orbit \u003Cspan\u003E:\u003C/span\u003E\n\u003Cul\u003E\u003Cli\u003E\n\u003Cspan\u003Eif the leg is \u003Cstrong\u003Enot resonant\u003C/strong\u003E, then 0.5\u003Cem\u003EP\u003C/em\u003E \u003C/span\u003E\u2264\u003Cspan\u003E \u003Cem\u003ET\u003C/em\u003E\u003Csub\u003E\u003Cem\u003Ei\u003C/em\u003E\u003C/sub\u003E\u003C/span\u003E \u2264\u003Cspan\u003E \u003Cem\u003EP\u003C/em\u003E and 0.01 \u003C/span\u003E\u2264 \u003Cspan lang=\u0022el\u0022 title=\u0022Greek-language text\u0022 xml:lang=\u0022el\u0022\u003E\u03B1\u003Cem\u003E\u003Csub\u003Ei\u003C/sub\u003E\u003C/em\u003E\u003C/span\u003E \u2264 0.999.\n\u003C/li\u003E\n\u003Cli\u003E\n\u003Cspan\u003Eif the leg \u003Cstrong\u003Eis resonant\u003C/strong\u003E, then \u003Cem\u003EP\u003C/em\u003E \u003C/span\u003E\u2264\u003Cspan\u003E\u003Cem\u003ET\u003C/em\u003E\u003Csub\u003E\u003Cem\u003Ei\u003C/em\u003E\u003C/sub\u003E\u003C/span\u003E \u2264\u003Cspan\u003E 3\u003Cem\u003EP\u003C/em\u003E\u003C/span\u003E and \u003Cstrong\u003Emax(\u003C/strong\u003E (\u003Cem\u003En\u003Csub\u003Erevs\u003C/sub\u003E\u003C/em\u003E - 1) / \u003Cem\u003En\u003Csub\u003Erevs\u003C/sub\u003E\u003C/em\u003E ; 0.01 \u003Cstrong\u003E)\u003C/strong\u003E \u2264 \u003Cspan lang=\u0022el\u0022 title=\u0022Greek-language text\u0022 xml:lang=\u0022el\u0022\u003E\u03B1\u003Cem\u003E\u003Csub\u003Ei\u003C/sub\u003E\u003C/em\u003E\u003C/span\u003E \u2264 0.999, where \u003Cem\u003En\u003Csub\u003Erevs\u003C/sub\u003E\u003C/em\u003E = \u003Cspan\u003E\u003Cem\u003ET\u003C/em\u003E\u003Csub\u003E\u003Cem\u003Ei\u003C/em\u003E\u003C/sub\u003E / \u003Cem\u003EP\u003C/em\u003E (this is to try to avoid the post-DSM arc from having a duration that would give multiple revolutions).\u003C/span\u003E\n\u003C/li\u003E\n\u003C/ul\u003E\u003C/li\u003E\n\u003Cli\u003E\n\u003Cspan\u003EPropagate that orbit for duration\u00A0 \u003C/span\u003E\u003Cspan lang=\u0022el\u0022 title=\u0022Greek-language text\u0022 xml:lang=\u0022el\u0022\u003E\u03B1\u003Cem\u003E\u003Csub\u003Ei\u003C/sub\u003E\u003C/em\u003E\u003C/span\u003E\u003Cspan\u003E\u003Cem\u003ET\u003C/em\u003E\u003Csub\u003E\u003Cem\u003Ei\u003C/em\u003E\u003C/sub\u003E\u003C/span\u003E \u003Cspan\u003E, the resulting position is point A and the velocity vector at that position is \u003Cstrong\u003Ev\u003Csub\u003EA0\u003C/sub\u003E\u003C/strong\u003E.\u003C/span\u003E\n\u003C/li\u003E\n\u003Cli\u003E\n\u003Cspan\u003ECalculate the position of the targeted body at the encounter date (\u003Cem\u003ET\u003C/em\u003E\u003Csub\u003E\u003Cem\u003Ei\u003C/em\u003E\u003C/sub\u003E \u002B time of flight until last \u003Cabbr title=\u0022Sphere of Influence\u0022\u003E\u003Cabbr title=\u0022Sphere of Influence\u0022\u003ESOI\u003C/abbr\u003E\u003C/abbr\u003E exit \u002B \u003C/span\u003E\u003Cem\u003Et\u003Csub\u003E0\u003C/sub\u003E\u003C/em\u003E\u003Cspan\u003E).\u003C/span\u003E\n\u003C/li\u003E\n\u003Cli\u003E\n\u003Cspan\u003ECalculate bounds for \u003C/span\u003E\u03B8\u003Csub\u003Ei\u003C/sub\u003E and \u03C6\u003Csub\u003Ei\u003C/sub\u003E (described in the next section) and with that the point at which the \u003Cabbr title=\u0022Sphere of Influence\u0022\u003E\u003Cabbr title=\u0022Sphere of Influence\u0022\u003ESOI\u003C/abbr\u003E\u003C/abbr\u003E of the targeted body is entered: point B.\n\u003C/li\u003E\n\u003Cli\u003E\nSlove the Lambert problem to find the orbit that links points A and B in a time (1 - \u003Cspan lang=\u0022el\u0022 title=\u0022Greek-language text\u0022 xml:lang=\u0022el\u0022\u003E\u03B1\u003Cem\u003E\u003Csub\u003Ei\u003C/sub\u003E\u003C/em\u003E\u003C/span\u003E)\u003Cspan\u003E\u003Cem\u003ET\u003C/em\u003E\u003Csub\u003E\u003Cem\u003Ei\u003C/em\u003E\u003C/sub\u003E\u003C/span\u003E. This gives the velocity vector at point A and B : \u003Cstrong\u003Ev\u003Csub\u003EA\u003C/sub\u003E\u003C/strong\u003E and \u003Cstrong\u003Ev\u003Csub\u003EB\u003C/sub\u003E\u003C/strong\u003E.\n\u003C/li\u003E\n\u003Cli\u003E\nRecord the DSM \u003Cabbr title=\u0022Delta-V\u0022\u003E\u003Cabbr title=\u0022Delta-V\u0022\u003EdV\u003C/abbr\u003E\u003C/abbr\u003E : \u003Cabbr title=\u0022Delta-V\u0022\u003E\u003Cabbr title=\u0022Delta-V\u0022\u003EdV\u003C/abbr\u003E\u003C/abbr\u003E\u003Csub\u003E\u003Cem\u003Ei\u003C/em\u003E\u003C/sub\u003E = || \u003Cstrong\u003Ev\u003Csub\u003EA\u003C/sub\u003E\u003C/strong\u003E - \u003Cspan\u003E\u003Cstrong\u003Ev\u003Csub\u003EA0\u003C/sub\u003E\u003C/strong\u003E\u003C/span\u003E ||.\n\u003C/li\u003E\n\u003Cli\u003E\nCalculate the relative velocity to the body when entered at point B and the flyby orbit.\n\u003C/li\u003E\n\u003Cli\u003E\nDepending on the case \u003Cspan\u003E\u003Cspan\u003E:\u003C/span\u003E\u003C/span\u003E\n\u003Cul\u003E\u003Cli\u003E\n\u003Cspan\u003E\u003Cspan\u003Eif the body \u003Cstrong\u003Eis the destination \u003C/strong\u003Ebody : propagate the flyby orbit until its periapsis and calculate the circularization maneuver. END THE PROCESS.\u003C/span\u003E\u003C/span\u003E\n\u003C/li\u003E\n\u003Cli\u003E\n\u003Cspan\u003E\u003Cspan\u003Eif the body \u003Cstrong\u003Eis not the destination\u003C/strong\u003E body : \u003C/span\u003E\u003C/span\u003Ecalculate the exit point from the \u003Cabbr title=\u0022Sphere of Influence\u0022\u003E\u003Cabbr title=\u0022Sphere of Influence\u0022\u003ESOI\u003C/abbr\u003E\u003C/abbr\u003E after the flyby, and calculate the global state vectors when exiting the \u003Cabbr title=\u0022Sphere of Influence\u0022\u003E\u003Cabbr title=\u0022Sphere of Influence\u0022\u003ESOI\u003C/abbr\u003E\u003C/abbr\u003E to be used by the next leg.\n\u003C/li\u003E\n\u003C/ul\u003E\u003C/li\u003E\n\u003C/ol\u003E\u003C/li\u003E\n\u003C/ol\u003E\u003Cp\u003E\nIt can happen that step 5.3. (\u0022\u003Cspan\u003EPropagate that orbit for duration\u00A0 \u003C/span\u003E\u003Cspan lang=\u0022el\u0022 title=\u0022Greek-language text\u0022 xml:lang=\u0022el\u0022\u003E\u03B1\u003Cem\u003E\u003Csub\u003Ei\u003C/sub\u003E\u003C/em\u003E\u003C/span\u003E\u003Cspan\u003E\u003Cem\u003ET\u003C/em\u003E\u003Csub\u003E\u003Cem\u003Ei\u003C/em\u003E\u003C/sub\u003E\u003C/span\u003E\u0022) fails and returns NaN values (for a reason I don\u0027t really understand yet). If that happens, the agent is randomized again and the trajectory is recalculated.\n\u003C/p\u003E\n\u003Cp\u003E\nThe Lambert solver doesn\u0027t consider long and short ways. I am using ESA\u0027s Lambert solver script for pykep (\u003Ca href=\u0022https://github.com/esa/pykep/blob/master/src/lambert_problem.cpp\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/esa/pykep/blob/master/src/lambert_problem.cpp\u003C/a\u003E) that I adapted for TypeScript, and simplified to not consider multiple revolutions.\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cspan style=\u0022font-size:20px;\u0022\u003E\u003Cstrong\u003EMeaning and bounds of \u03B8 and \u03C6\u003C/strong\u003E\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nThese two angles are used to represent an entrance point on a \u003Cabbr title=\u0022Sphere of Influence\u0022\u003E\u003Cabbr title=\u0022Sphere of Influence\u0022\u003ESOI\u003C/abbr\u003E\u003C/abbr\u003E. In order to do the step 5.5. of the algorithm above, we must solve the Lambert problem to link point A and a point B\u0027 which is the position of the planet targeted at the encounter date. This allows us to calculate a relative encounter velocity that will approximately be the same as if we targeted a specific point on the \u003Cabbr title=\u0022Sphere of Influence\u0022\u003E\u003Cabbr title=\u0022Sphere of Influence\u0022\u003ESOI\u003C/abbr\u003E\u003C/abbr\u003E. We normalize this encounter velocity vector and reverse its direction : this gives a vector \u003Cstrong\u003Eu\u003C/strong\u003E pointing in the\u00A0opposite direction of the incoming velocity.\n\u003C/p\u003E\n\u003Cp\u003E\n\u03B8 and \u03C6 then describe a point \u003Cem\u003Earound\u003C/em\u003E the direction of \u003Cstrong\u003Eu\u003C/strong\u003E that lay in a sort of \u003Cem\u003Ering\u003C/em\u003E on the \u003Cabbr title=\u0022Sphere of Influence\u0022\u003E\u003Cabbr title=\u0022Sphere of Influence\u0022\u003ESOI\u003C/abbr\u003E\u003C/abbr\u003E surface. We can suppose that the velocity vector with which the spaceship will enter the \u003Cabbr title=\u0022Sphere of Influence\u0022\u003E\u003Cabbr title=\u0022Sphere of Influence\u0022\u003ESOI\u003C/abbr\u003E\u003C/abbr\u003E will be parallel to \u003Cstrong\u003Eu\u003C/strong\u003E. With that said, we clamp \u03B8 between \u03B8\u003Csub\u003Emin\u003C/sub\u003E and \u03B8\u003Csub\u003Emax\u003C/sub\u003E which are defined as follow (in a 2D projection):\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u00221Z-9bLbWJ6Ie49SkishJkTDROlBrs6SXv2QOaQir\u0022 class=\u0022ipsImage\u0022 data-ratio=\u002284.44\u0022 height=\u0022830\u0022 width=\u0022983\u0022 src=\u0022https://lh3.googleusercontent.com/1Z-9bLbWJ6Ie49SkishJkTDROlBrs6SXv2QOaQirEPKcrIrokuTsMvFZDIQgphcfIT1p8QyjqFh_3__ZbccFGcam8Cwfuz0JxwHRzE3EtfIoXy-7j4l5y5l4BsP3vjtmN01chnqQDQ=w2400\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nFrom the geometry of the figure we deduce that \u003Cspan\u003E\u003Cspan\u003E:\u003C/span\u003E\u003C/span\u003E\n\u003C/p\u003E\n\u003Cul\u003E\u003Cli\u003E\n\u03B8\u003Csub\u003Emin\u003C/sub\u003E = arcsin( R\u003Csub\u003Ebody\u003C/sub\u003E / R\u003Csub\u003E\u003Cabbr title=\u0022Sphere of Influence\u0022\u003E\u003Cabbr title=\u0022Sphere of Influence\u0022\u003ESOI\u003C/abbr\u003E\u003C/abbr\u003E\u003C/sub\u003E )\n\u003C/li\u003E\n\u003Cli\u003E\n\u03B8\u003Csub\u003Emax\u003C/sub\u003E = arcsin( R\u003Csub\u003Emax\u003C/sub\u003E / R\u003Csub\u003E\u003Cabbr title=\u0022Sphere of Influence\u0022\u003E\u003Cabbr title=\u0022Sphere of Influence\u0022\u003ESOI\u003C/abbr\u003E\u003C/abbr\u003E\u003C/sub\u003E )\n\u003C/li\u003E\n\u003C/ul\u003E\u003Cp\u003E\n\u03B8 therefore defines where on the purple arc the point will be. \u03C6 then defines a rotation angle around \u003Cstrong\u003Eu\u003C/strong\u003E between \u003Cspan lang=\u0022el\u0022 title=\u0022Greek-language text\u0022 xml:lang=\u0022el\u0022\u003E0 and 2\u03C0. \u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cspan lang=\u0022el\u0022 title=\u0022Greek-language text\u0022 xml:lang=\u0022el\u0022\u003EThe point on the \u003Cabbr title=\u0022Sphere of Influence\u0022\u003E\u003Cabbr title=\u0022Sphere of Influence\u0022\u003ESOI\u003C/abbr\u003E\u003C/abbr\u003E is then calculated by:\u003C/span\u003E\n\u003C/p\u003E\n\u003Col\u003E\u003Cli\u003E\n\u003Cspan lang=\u0022el\u0022 title=\u0022Greek-language text\u0022 xml:lang=\u0022el\u0022\u003ERotating \u003Cstrong\u003Eu\u003C/strong\u003E along \u003Cstrong\u003Ew\u003C/strong\u003E = \u003Cstrong\u003Eu\u003C/strong\u003E \u003C/span\u003E\u00D7 (1, 0, 0)\u003Csup\u003ET\u003C/sup\u003E of the angle \u03B8 (we need a perpendicular vector in space around which we can rotate), this gives a new vector \u003Cstrong\u003Eu\u0027\u003C/strong\u003E.\n\u003C/li\u003E\n\u003Cli\u003E\n\u003Cspan lang=\u0022el\u0022 title=\u0022Greek-language text\u0022 xml:lang=\u0022el\u0022\u003ERotating \u003Cstrong\u003Eu\u0027\u003C/strong\u003E around \u003Cstrong\u003Eu\u003C/strong\u003E of the angle \u003C/span\u003E\u03C6.\n\u003C/li\u003E\n\u003Cli\u003E\nMultiplying \u003Cstrong\u003Eu\u0027\u003C/strong\u003E by R\u003Csub\u003E\u003Cabbr title=\u0022Sphere of Influence\u0022\u003E\u003Cabbr title=\u0022Sphere of Influence\u0022\u003ESOI\u003C/abbr\u003E\u003C/abbr\u003E\u003C/sub\u003E.\n\u003C/li\u003E\n\u003C/ol\u003E\u003Cp\u003E\nThis gives the position of the entrance point on the \u003Cabbr title=\u0022Sphere of Influence\u0022\u003E\u003Cabbr title=\u0022Sphere of Influence\u0022\u003ESOI\u003C/abbr\u003E\u003C/abbr\u003E (in the coordinate system centered on the body), \u003Cspan lang=\u0022el\u0022 title=\u0022Greek-language text\u0022 xml:lang=\u0022el\u0022\u003Ewhich lay inside a ring cut on the \u003Cabbr title=\u0022Sphere of Influence\u0022\u003E\u003Cabbr title=\u0022Sphere of Influence\u0022\u003ESOI\u003C/abbr\u003E\u003C/abbr\u003E surface.\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cspan lang=\u0022el\u0022 title=\u0022Greek-language text\u0022 xml:lang=\u0022el\u0022\u003EIn the current implementation, I set : R\u003Csub\u003Emax\u003C/sub\u003E = 2 * R\u003Csub\u003Ebody\u003C/sub\u003E.\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cspan lang=\u0022el\u0022 title=\u0022Greek-language text\u0022 xml:lang=\u0022el\u0022\u003EThis was done in the hope to ensure that the flyby is possible considering the entrance point and the relative velocity, and to avoid the flyby orbit to cross through the body\u0027s surface (which turns out, for that last assumption, doesn\u0027t work).\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nI know this is not the most efficient nor the cleanest way to do this (I\u0027m solving a Lambert problem twice for each leg for example). That\u0027s why there is a lot of room for improvement. I\u0027m open to any suggestion.\n\u003C/p\u003E\n\u003Cp\u003E\nWhat I\u0027m considering for the moment is to have all components of the agent vectors be values between 0 and 1. Then the specific interpolations will be done during the trajectory computation. This would allow to have constant bounds. I\u0027m also considering replacing the way the \u003Cem\u003ET\u003Csub\u003Ei\u003C/sub\u003E\u003C/em\u003E\u0027s are bound because this causes some problems (try Mo-Ee trajectory).\n\u003C/p\u003E\n\u003Cp\u003E\nThe source code is available here \u003Cspan\u003E: \u003C/span\u003E\u003Ca href=\u0022https://github.com/Krafpy/KSP-MGA-Planner\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/Krafpy/KSP-MGA-Planner\u003C/a\u003E (I\u0027m planning on rewriting some parts to have a cleaner structure)\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222021-08-21T15:00:57Z\u0022 title=\u002208/21/2021 03:00  PM\u0022 data-short=\u00222 yr\u0022\u003EAugust 21, 2021\u003C/time\u003E by Krafpy\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Arrowstar","CreatedById":2521,"CreatedDateTime":"2021-08-22T01:18:25Z","Content":"\n\u003Cp\u003E\nOkay so I haven\u0027t had a chance to go through and really think about what you said earlier but I do have some thoughts.\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00224022682\u0022 data-ipsquote-contentid=\u0022204391\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221629556676\u0022 data-ipsquote-userid=\u0022213892\u0022 data-ipsquote-username=\u0022Krafpy\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n10 hours ago, Krafpy said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nThe Lambert solver doesn\u0027t consider long and short ways. I am using ESA\u0027s Lambert solver script for pykep (\u003Ca href=\u0022https://github.com/esa/pykep/blob/master/src/lambert_problem.cpp\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/esa/pykep/blob/master/src/lambert_problem.cpp\u003C/a\u003E) that I adapted for TypeScript, and simplified to not consider multiple revolutions.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nI\u0027m not talking about multiple revolutions, I\u0027m talking about the concept that every Lambert\u0027s problem, even the single rev cases, all have two solutions: one where the transfer angle is greater than 180 deg and one where it\u0027s less than 180 deg.\u00A0 If you\u0027re only using one of those solutions everywhere then you\u0027re going to have an issue because short way and long way can have radically different delta-v.\u00A0 Looking at the lambert code you\u0027re using, I think the input flag is the \u0022\u003Cspan\u003Econst\u003C/span\u003E \u003Cspan\u003Eint\u003C/span\u003E \u0026amp;cw\u0022 input, though I\u0027ve run into the ESA ACT\u0027s Lambert solver before and I\u0027ve never been a big fan of their \u0022clockwise\u0022 / \u0022counterclockwise\u0022 notation.\u00A0 Anyway, what are you using for that parameter and have you tried changing it to verify that it works the way you think it does?\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nI guess on top of that, you might consider playing around with the automatic bounding of the time of flight variables as well, if I\u0027m reading your post correctly.\u00A0 It can be hard to pick generalized bounds that work for all cases.\u00A0 It might be worthwhile allowing the user to specify the upper and lower bounds for time of flight between bodies.\n\u003C/p\u003E\n\u003Cp\u003E\nThat\u0027s all I\u0027ve got for now, there\u0027s a lot of math to look at lol. \u003Cspan\u003E\u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u003C/span\u003E\n\u003C/p\u003E\n"},{"CreatedByName":"Krafpy","CreatedById":213892,"CreatedDateTime":"2021-08-22T09:10:27Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00224022832\u0022 data-ipsquote-contentid=\u0022204391\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221629595105\u0022 data-ipsquote-userid=\u00222521\u0022 data-ipsquote-username=\u0022Arrowstar\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n10 hours ago, Arrowstar said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nall have two solutions: one where the transfer angle is greater than 180 deg and one where it\u0027s less than 180 deg\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nAh ok thanks for the precision. So ESA\u0027s script \u003Cem\u003Edoes\u003C/em\u003E consider long and short way, and you can indeed configure that with the \u0022cw\u0022 parameter. In my adaptation, I removed all parts that deal with this variable (basically just an if statement that changed the sign of some values if this variable was set to 1, at line 90 : \u003Ca href=\u0022https://github.com/esa/pykep/blob/master/src/lambert_problem.cpp#L90\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/esa/pykep/blob/master/src/lambert_problem.cpp#L90\u003C/a\u003E), as well as the parts that deal with the \u0022multi_revs\u0022 one. So with these constraints added, the Lambert solver in my script calculates one only possible orbit, whether the angle between the positions is greater or smaller than 180\u00B0.\n\u003C/p\u003E\n\u003Cp\u003E\nI of course tested \u003Cspan\u003Eit. For example, I gave the points \u003Cstrong\u003Er\u003Csub\u003E1\u003C/sub\u003E\u003C/strong\u003E = (R, 0, 0) and \u003Cstrong\u003Er\u003Csub\u003E2\u003C/sub\u003E\u003C/strong\u003E = (0, 0, -R) to the solver (y-axis is up), so the transfer angle between these two points is 270\u00B0 (if we consider the trigonometric convention for rotation). For the TOF, I gave 2/3 of the period of a circular orbit with radius R. What I expected is the solver to give me a circular orbit, with the arc going from \u003Cstrong\u003Er\u003Csub\u003E1\u003C/sub\u003E\u003C/strong\u003E to \u003Cstrong\u003Er\u003Csub\u003E2\u003C/sub\u003E\u003C/strong\u003E being 2/3 of the circular orbit. Which was indeed the case. And looking at the resulting velocity vectors computed by the solver also confirmed that the rotation was the right one (i.e. same as how planets rotate, and perfectly perpendicular to the orbit, which confirms again that it\u0027s a circular one). I have tested several configurations, with angles greater and smaller than 180\u00B0 and various TOF, and all seemed to give the expected result.\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cspan\u003EYou can also notice in the image on my very first post that the last arc, the pink one from Eve to Moho, has a transfer angle greater than 180\u00B0 (the DSM\u003C/span\u003E happens right after exiting Eve\u0027s \u003Cabbr title=\u0022Sphere of Influence\u0022\u003E\u003Cabbr title=\u0022Sphere of Influence\u0022\u003ESOI\u003C/abbr\u003E\u003C/abbr\u003E).\n\u003C/p\u003E\n\u003Cp\u003E\n(I don\u0027t know if you meant that I \u003Cem\u003Eshould check for both long and short way\u003C/em\u003E... but that seems useless because in that case, at least one of the two possible orbit is retrograde, which would required an insanely big \u003Cabbr title=\u0022Delta-V\u0022\u003E\u003Cabbr title=\u0022Delta-V\u0022\u003EdV\u003C/abbr\u003E\u003C/abbr\u003E to get to it... right?)\n\u003C/p\u003E\n\u003Cp\u003E\nYou can see my adapted script here: \u003Ca href=\u0022https://github.com/Krafpy/KSP-MGA-Planner/blob/master/src/dedicated-workers/libs/lambert.ts\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/Krafpy/KSP-MGA-Planner/blob/master/src/dedicated-workers/libs/lambert.ts\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00224022832\u0022 data-ipsquote-contentid=\u0022204391\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221629595105\u0022 data-ipsquote-userid=\u00222521\u0022 data-ipsquote-username=\u0022Arrowstar\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n10 hours ago, Arrowstar said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nIt can be hard to pick generalized bounds that work for all cases.\u00A0 It might be worthwhile allowing the user to specify the upper and lower bounds for time of flight between bodies.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nI wanted to have the most easy/straightforward to use tool, that\u0027s why I tried to look for automated bounds. I think that it may not be really obvious for all users which lower and upper bounds they must enter. But if it is not possible to find good automated bounds, I guess I\u0027ll have no choice than switch to user-defined ones, or at least make this option available.\n\u003C/p\u003E\n\u003Cp\u003E\nAs I described in my previous post, the bounds change for each agent in the population of the DE. This is probably a problem because this means that the variables of most of the agents are constantly clamped, probably to the upper or lower bound, at each new generation. There are definitely better automated bounds to look for before switching to user defined ones.\n\u003C/p\u003E\n\u003Cp\u003E\nFor example, instead of clamping the duration of each leg based on the resulting transfer orbit, which can cause good trajectories to not be considered (try a Mo-Ee trajectory with my tool, the result is really ridiculous), I am thinking of defining the upper and lower bound for that variable with the period of an elliptic orbit joining the exited body and the targeted one (like in a Hohmann transfer). So basically replacing the value of \u003Cem\u003EP\u003C/em\u003E introduced in my algorithm in step 5.2. with what I just descibed. That would at least give fixed bounds for each variables, and allows more trajectories to be considered.\n\u003C/p\u003E\n\u003Cp\u003E\nI also thought of removing the \u03B8 angle from the variables, and replacing it by the periapsis radius of the flyby. I think that we can compute \u03B8 knowing the incoming velocity and the periapsis radius. This would allow for a better control of the minimum and maximum radius of the flybys.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nI hope this helps. Do not hesitate to ask for more details or rephrasing if needed.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0I noticed one thing about your software, when looking closer at the drawn trajectory. Are you considering the flybys as instantaneous events ? Or that the bodies\u0027 \u003Cabbr title=\u0022Sphere of Influence\u0022\u003E\u003Cabbr title=\u0022Sphere of Influence\u0022\u003ESOI\u003C/abbr\u003E\u003C/abbr\u003E as infinitely small points ?\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222021-08-22T11:27:26Z\u0022 title=\u002208/22/2021 11:27  AM\u0022 data-short=\u00222 yr\u0022\u003EAugust 22, 2021\u003C/time\u003E by Krafpy\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Arrowstar","CreatedById":2521,"CreatedDateTime":"2021-08-22T18:42:59Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00224022918\u0022 data-ipsquote-contentid=\u0022204391\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221629623427\u0022 data-ipsquote-userid=\u0022213892\u0022 data-ipsquote-username=\u0022Krafpy\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n9 hours ago, Krafpy said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nI noticed one thing about your software, when looking closer at the drawn trajectory. Are you considering the flybys as instantaneous events ? Or that the bodies\u0027 \u003Cabbr title=\u0022Sphere of Influence\u0022\u003E\u003Cabbr title=\u0022Sphere of Influence\u0022\u003ESOI\u003C/abbr\u003E\u003C/abbr\u003E as infinitely small points ?\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nLocal gravity wells are modeled as zero radius \u003Cabbr title=\u0022Sphere of Influence\u0022\u003ESOI\u003C/abbr\u003E with instantaneous flybys.\u00A0 It simplifies the problem space down into a bunch of Lambert arcs while still producing reasonable results.\u00A0 If people want to model more accurate trajectories, that\u0027s what KSPTOT\u0027s Mission Architect (and really, Launch Vehicle Designer, which has mostly filled the role of MA for some time now) is for.\u00A0 LVD numerically integrates equations of motion to produce trajectories and can model discrete vehicle stages, tanks, engines, electrical systems, and can propagate forwards and backwards in time to help make it easier to find those multiple gravity assist trajectories.\n\u003C/p\u003E\n"},{"CreatedByName":"Krafpy","CreatedById":213892,"CreatedDateTime":"2021-08-23T08:33:24Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00224023073\u0022 data-ipsquote-contentid=\u0022204391\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221629657779\u0022 data-ipsquote-userid=\u00222521\u0022 data-ipsquote-username=\u0022Arrowstar\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n19 hours ago, Arrowstar said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nLocal gravity wells are modeled as zero radius \u003Cabbr title=\u0022Sphere of Influence\u0022\u003E\u003Cabbr title=\u0022Sphere of Influence\u0022\u003ESOI\u003C/abbr\u003E\u003C/abbr\u003E with instantaneous flybys.\u00A0 It simplifies the problem space down into a bunch of Lambert arcs while still producing reasonable results.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nSo it would be possible to compute a simplified model with zero radius \u003Cabbr title=\u0022Sphere of Influence\u0022\u003E\u003Cabbr title=\u0022Sphere of Influence\u0022\u003ESOI\u003C/abbr\u003E\u003C/abbr\u003E and instantaneous flybys to have better performance, and which would give the date of DSMs and encounters. And then run a more precise model from the best found solution in the DE considering \u003Cabbr title=\u0022Sphere of Influence\u0022\u003E\u003Cabbr title=\u0022Sphere of Influence\u0022\u003ESOI\u003C/abbr\u003E\u003C/abbr\u003E entrance point and non instantaneous flybys, but the parameters that configure the duration of each leg and the DSM date are fixed. That sounds interesting to try, but would that be efficient ?\n\u003C/p\u003E\n\u003Cp\u003E\nShouldn\u0027t it be at least considered that a planet moves during the time of flyby ? In all research papers I\u0027ve read about the subject, they consider instantenous flybys, which is valid in the case of our real solar system. But in KSP which is a lot smaller, bodies\u0027 motion on their orbits even during a single day looks non negligible. That\u0027s especially the case for Moho or moons.\n\u003C/p\u003E\n\u003Cp\u003E\nBut if we do consider the duration of the flyby, this at least requires us to calculate some more parameters of the orbit. We can consider that all flyby orbits would be hyperbolic.. which is still not always the case. In the case of Jool\u0027s moons for example, I think it is possible to have an elliptical orbit which apoapsis is outisde of the \u003Cabbr title=\u0022Sphere of Influence\u0022\u003E\u003Cabbr title=\u0022Sphere of Influence\u0022\u003ESOI\u003C/abbr\u003E\u003C/abbr\u003E of the moon.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222021-08-23T14:11:37Z\u0022 title=\u002208/23/2021 02:11  PM\u0022 data-short=\u00222 yr\u0022\u003EAugust 23, 2021\u003C/time\u003E by Krafpy\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Arrowstar","CreatedById":2521,"CreatedDateTime":"2021-08-23T18:28:31Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00224023274\u0022 data-ipsquote-contentid=\u0022204391\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221629707604\u0022 data-ipsquote-userid=\u0022213892\u0022 data-ipsquote-username=\u0022Krafpy\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n9 hours ago, Krafpy said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nSo it would be possible to compute a simplified model with zero radius \u003Cabbr title=\u0022Sphere of Influence\u0022\u003E\u003Cabbr title=\u0022Sphere of Influence\u0022\u003ESOI\u003C/abbr\u003E\u003C/abbr\u003E and instantaneous flybys to have better performance, and which would give the date of DSMs and encounters. And then run a more precise model from the best found solution in the DE considering \u003Cabbr title=\u0022Sphere of Influence\u0022\u003E\u003Cabbr title=\u0022Sphere of Influence\u0022\u003ESOI\u003C/abbr\u003E\u003C/abbr\u003E entrance point and non instantaneous flybys, but the parameters that configure the duration of each leg and the DSM date are fixed. That sounds interesting to try, but would that be efficient ?\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nYes, you can do that, but you\u0027ll need to be very careful about trajectory continuity.\u00A0 You\u0027ll also need to re-optimize your flyby times, DSM times and delta-vs, and the rest of it, using the lower fidelity model as a starting point, because once you introduce the higher fidelity models, the answer will change.\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nQuote\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nShouldn\u0027t it be at least considered that a planet moves during the time of flyby ? In all research papers I\u0027ve read about the subject, they consider instantenous flybys, which is valid in the case of our real solar system. But in KSP which is a lot smaller, bodies\u0027 motion on their orbits even during a single day looks non negligible. That\u0027s especially the case for Moho or moons.\n\u003C/p\u003E\n\u003Cp\u003E\nBut if we do consider the duration of the flyby, this at least requires us to calculate some more parameters of the orbit. We can consider that all flyby orbits would be hyperbolic.. which is still not always the case. In the case of Jool\u0027s moons for example, I think it is possible to have an elliptical orbit which apoapsis is outisde of the \u003Cabbr title=\u0022Sphere of Influence\u0022\u003E\u003Cabbr title=\u0022Sphere of Influence\u0022\u003ESOI\u003C/abbr\u003E\u003C/abbr\u003E of the moon.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nI think I maybe see a flaw in your thinking about this problem in general.\u00A0 Why do we use the zero radius \u003Cabbr title=\u0022Sphere of Influence\u0022\u003ESoI\u003C/abbr\u003E assumption, and the instantaneous flyby assumption, and Lambert arcs, and all that?\u00A0 It\u0027s because it lets us quickly explore the problem space, find reasonable trajectory \u003Cem\u003Econcepts\u003C/em\u003E, and then implement them in a higher fidelity tool.\u00A0 No one in the \u0022real world\u0022 uses software like yours or like my MFMS tool to actually plan a real mission: it\u0027s all about exploring the problem space.\u00A0 Once a trajectory engineer has identified a good trajectory, they always move up to tools that can provide higher fidelity dynamics, like my KSPTOT Mission Architect or Launch Vehicle Designer tools, and rework the trajectory there.\n\u003C/p\u003E\n\u003Cp\u003E\nBecause of all that, while you can certainly add more fidelity to your code, at some point you\u0027ll have to break away from the Lambert arc assumption.\u00A0 By all means, definitely dive into handling finite sized SOIs and celestial body motion and finite duration flybys and the like!\u00A0 I just don\u0027t know how long you\u0027ll be able to keep your tool \u0022simple\u0022 (and the underlying code simple!) if you do.\u00A0 It\u0027ll be an interesting science experiment to find out. \u003Cspan\u003E\u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u003C/span\u003E\n\u003C/p\u003E\n"},{"CreatedByName":"antipro","CreatedById":173370,"CreatedDateTime":"2021-08-25T14:22:05Z","Content":"\n\u003Cp\u003E\nhi, it\u0027s y179 d259 on my career and I\u0027m planning a new mission for a contract that asks for land on eeloo and return.\u003Cbr\u003E\nanyway I have calculated the total \u003Cabbr title=\u0022Delta-V\u0022\u003E\u003Cabbr title=\u0022Delta-V\u0022\u003EdV\u003C/abbr\u003E\u003C/abbr\u003E needed from a 120km \u003Cabbr title=\u0022Low Kerbin Orbit\u0022\u003E\u003Cabbr title=\u0022Low Kerbin Orbit\u0022\u003ELKO\u003C/abbr\u003E\u003C/abbr\u003E to a 100km LEO, using \u003Cabbr title=\u0022Mechjeb (mod)\u0022\u003E\u003Cabbr title=\u0022Mechjeb (mod)\u0022\u003EMJ\u003C/abbr\u003E\u003C/abbr\u003E adv transfer(Ke-Ee), is \u003Cstrong\u003E3508 \u003C/strong\u003Em/s, starting the burn at y180 d82.\n\u003C/p\u003E\n\u003Cp\u003E\nTrying a \u003Cspan lang=\u0022en\u0022 xml:lang=\u0022en\u0022\u003E\u003Cspan\u003E\u003Cspan\u003EKe-Ev-Jo-Ee seq. w\u003C/span\u003E\u003C/span\u003E\u003C/span\u003Eith the MGA Planner I only get a \u003Cabbr title=\u0022Delta-V\u0022\u003E\u003Cabbr title=\u0022Delta-V\u0022\u003EdV\u003C/abbr\u003E\u003C/abbr\u003E of \u003Cstrong\u003E\u003Cspan\u003E4162.3\u003C/span\u003E \u003C/strong\u003Em/s\u003Cstrong\u003E \u003C/strong\u003Eat Departure date:\u003Cstrong\u003E\u003Cspan\u003E \u003C/span\u003E\u003C/strong\u003E\u003Cspan\u003EYear 180 - Day 363 - 00:16:05\u003C/span\u003E UT,\u003Cbr\u003E\namong other things by \u003Cspan lang=\u0022en\u0022 xml:lang=\u0022en\u0022\u003E\u003Cspan\u003E\u003Cspan\u003Epassing through Eve\u0027s mantle.\u003C/span\u003E\u003C/span\u003E\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nnow, \u003Cspan lang=\u0022en\u0022 xml:lang=\u0022en\u0022\u003E\u003Cspan\u003E\u003Cspan\u003Ebased on the image below, if I\u0027ve understood it well, with a Ke-Ev-Jo-Ee maneuvers, it\u0027s possible to reach the eeloo orbit with only \u003Cstrong\u003E2500 \u003C/strong\u003Em/s.\u003Cbr\u003E\nMy question is: \u003C/span\u003E\u003C/span\u003E\u003Cspan\u003E\u003Cspan\u003Eassuming that I learn to install and use the \u0022Trajectory Optimization Tool\u0022 or \u0022Multi-Flyby Maneuver Sequencer\u0022 whatever it is called,\u003Cbr\u003E\u003Cstrong\u003Ethen does the tool interact with the game by creating the maneuvers itself?\u003C/strong\u003E\u003C/span\u003E\u003C/span\u003E\u003C/span\u003E\u003Cbr\u003E\u003Cbr\u003E\u003Cimg alt=\u0022WCnXKfV.png\u0022 class=\u0022ipsImage\u0022 data-ratio=\u002279.63\u0022 height=\u0022825\u0022 width=\u00221036\u0022 src=\u0022https://i.imgur.com/WCnXKfV.png\u0022\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222021-08-25T14:33:08Z\u0022 title=\u002208/25/2021 02:33  PM\u0022 data-short=\u00222 yr\u0022\u003EAugust 25, 2021\u003C/time\u003E by antipro\u003C/strong\u003E\n\u003C/span\u003E\n"}]}