{"TopicId":216462,"ForumId":198,"TopicTitle":"Wrong orbital elements on hyperbolic trajectories","CreatedByName":"schlosrat","CreatedById":141963,"CreatedDateTime":"2023-04-13T14:42:30Z","PageNum":1,"Articles":[{"CreatedByName":"schlosrat","CreatedById":141963,"CreatedDateTime":"2023-04-13T14:42:30Z","Content":"\n\u003Cp\u003E\nI\u0027ve noticed that in some cases the orbital information associated with the active vessel\u0027s current orbit is just dead wrong. This is bizzare, and I\u0027m not sure if it\u0027s related to the 0.1.2 patch, but I only just noticed it and hadn\u0027t checked for it previously in 0.1.1 or before. Here\u0027s an example of a craft on an obviously hyperbolic flyby trajectory about the Mun. I\u0027m using the Maneuver Node Controller mod to be able to see some of the orbital elements for the active vessel, but this is just displaying the information that\u0027s in game, not computing anything.\u003Cbr\u003E\n\u003Cbr\u003E\nIn this example, we see the craft with a \u003Cabbr title=\u0022Periapsis\u0022\u003E\u003Cabbr title=\u0022Periapsis\u0022\u003EPe\u003C/abbr\u003E\u003C/abbr\u003E of 163km and yet e = 0.966? That simply can\u0027t be true as for any hyperbolic orbit the e \u0026gt; 1\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u00220M6D11p.png\u0022 class=\u0022ipsImage\u0022 data-ratio=\u002259.52\u0022 height=\u0022594\u0022 width=\u0022998\u0022 src=\u0022https://i.imgur.com/0M6D11p.png\u0022\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nBy burning prograde and raising my \u003Cabbr title=\u0022Periapsis\u0022\u003E\u003Cabbr title=\u0022Periapsis\u0022\u003EPe\u003C/abbr\u003E\u003C/abbr\u003E I can get to a different hyperbolic flyby orbit where e is correctly \u0026gt; 1 (not claiming e is \u003Cem\u003Ecorrect\u003C/em\u003E, merely that it being \u0026gt;1 is correct...)\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cbr\u003E\n\u003Cimg alt=\u0022OEYa9sI.png\u0022 class=\u0022ipsImage\u0022 data-ratio=\u002271.59\u0022 height=\u0022630\u0022 width=\u0022880\u0022 src=\u0022https://i.imgur.com/OEYa9sI.png\u0022\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nThe mod I\u0027m using is simply obtaining and displaying activeVessel.Orbit.eccentricity, so apparently the game is incorrectly setting the orbital parameters for the active vessel\u0027s current orbit in some cases.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222023-04-13T16:39:54Z\u0022 title=\u002204/13/2023 04:39  PM\u0022 data-short=\u00221 yr\u0022\u003EApril 13, 2023\u003C/time\u003E by schlosrat\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Dunas Only Moon","CreatedById":224915,"CreatedDateTime":"2023-04-13T14:48:50Z","Content":"\n\u003Cp\u003E\nVery odd...\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"schlosrat","CreatedById":141963,"CreatedDateTime":"2023-04-13T15:46:39Z","Content":"\n\u003Cp\u003E\nPerhaps related to this, the info displayed below the Nav Ball for \u003Cabbr title=\u0022Apoapsis\u0022\u003E\u003Cabbr title=\u0022Apoapsis\u0022\u003EAp\u003C/abbr\u003E\u003C/abbr\u003E and \u003Cabbr title=\u0022Periapsis\u0022\u003E\u003Cabbr title=\u0022Periapsis\u0022\u003EPe\u003C/abbr\u003E\u003C/abbr\u003E conflict with what\u0027s shown on the orbit\u0027s \u003Cabbr title=\u0022Periapsis\u0022\u003E\u003Cabbr title=\u0022Periapsis\u0022\u003EPe\u003C/abbr\u003E\u003C/abbr\u003E tag, and there is no \u003Cabbr title=\u0022Apoapsis\u0022\u003E\u003Cabbr title=\u0022Apoapsis\u0022\u003EAp\u003C/abbr\u003E\u003C/abbr\u003E tag on a hyperbolic orbit (which is a good thing!). The orbit\u0027s \u003Cabbr title=\u0022Periapsis\u0022\u003E\u003Cabbr title=\u0022Periapsis\u0022\u003EPe\u003C/abbr\u003E\u003C/abbr\u003E tag agrees with the\u00A0\u003Cspan style=\u0022background-color:#1b1e1f;color:#c9c5be;font-size:15px;\u0022\u003EactiveVessel.Orbit.Periapsis, and clearly a hyperbolic orbit should have a negative \u003Cabbr title=\u0022Apoapsis\u0022\u003E\u003Cabbr title=\u0022Apoapsis\u0022\u003EAp\u003C/abbr\u003E\u003C/abbr\u003E - so the Nav Ball info is wrong even in this case where e is \u0026gt; 1. I suspect the topic should be changed to be: \u003C/span\u003E\u003Cspan style=\u0022background-color:rgb(27,30,31);font-size:22px;\u0022\u003E\u003Cfont color=\u0022#ffffff\u0022\u003EWrong Orbital Elements on Hyperbolic Orbits\u003C/font\u003E\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u0022MATyk6O.png\u0022 class=\u0022ipsImage\u0022 data-ratio=\u002282.42\u0022 height=\u0022947\u0022 width=\u00221149\u0022 src=\u0022https://i.imgur.com/MATyk6O.png\u0022\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nCuriously, the Nav Ball is showing the \u003Cabbr title=\u0022Periapsis\u0022\u003E\u003Cabbr title=\u0022Periapsis\u0022\u003EPe\u003C/abbr\u003E\u003C/abbr\u003E that was true PRIOR to the burn I made to raise \u003Cabbr title=\u0022Periapsis\u0022\u003E\u003Cabbr title=\u0022Periapsis\u0022\u003EPe\u003C/abbr\u003E\u003C/abbr\u003E! In the shot above (game paused, but \u003Cstrong\u003Epost burn\u003C/strong\u003E) the Nav Ball reported\u00A0\u003Cabbr title=\u0022Periapsis\u0022\u003E\u003Cabbr title=\u0022Periapsis\u0022\u003EPe\u003C/abbr\u003E\u003C/abbr\u003E is 163.410 km. In the first shot way above the \u003Cabbr title=\u0022Periapsis\u0022\u003E\u003Cabbr title=\u0022Periapsis\u0022\u003EPe\u003C/abbr\u003E\u003C/abbr\u003E was reading out as the same value! So I ran the game burning prograde to raise my \u003Cabbr title=\u0022Periapsis\u0022\u003E\u003Cabbr title=\u0022Periapsis\u0022\u003EPe\u003C/abbr\u003E\u003C/abbr\u003E, and at the end of that burn (throttle is zero above and I\u0027m coasting) the Nav Ball has the \u003Cabbr title=\u0022Periapsis\u0022\u003E\u003Cabbr title=\u0022Periapsis\u0022\u003EPe\u003C/abbr\u003E\u003C/abbr\u003E from before the burn.\u003Cbr\u003E\n\u003Cbr\u003E\nThere is clearly something wrong here!\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222023-04-13T15:53:52Z\u0022 title=\u002204/13/2023 03:53  PM\u0022 data-short=\u00221 yr\u0022\u003EApril 13, 2023\u003C/time\u003E by schlosrat\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"schlosrat","CreatedById":141963,"CreatedDateTime":"2023-04-13T16:43:04Z","Content":"\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/225122-dakota/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022225122\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/225122-dakota/\u0022 rel=\u0022\u0022\u003E@Dakota\u003C/a\u003E\u00A0I wanted to call this to your attention. It would seem there\u0027s something \u003Cem\u003Ereally \u003C/em\u003Ewrong in patch 0.1.2. There are also a lot of things really right, too; but I want to make sure you guys are aware of this so you can investigate.\n\u003C/p\u003E\n\u003Cp\u003E\nAre you guys already aware of this? It seems really serious to me and may have far ranging consequences.\n\u003C/p\u003E\n\u003Cp\u003E\nCloser inspection gives this clue. In the first image you can see that MNC reports the \u003Cabbr title=\u0022Periapsis\u0022\u003EPe\u003C/abbr\u003E as 163.410 km. That\u0027s the \u003Cabbr title=\u0022Periapsis\u0022\u003EPe\u003C/abbr\u003E before my burn. In the next image, the MNC \u003Cabbr title=\u0022Periapsis\u0022\u003EPe\u003C/abbr\u003E is reported as 246.611 km, which corresponds to what the KSP2 orbit PE tag shows, but the Nav Ball\u0027s reported \u003Cabbr title=\u0022Periapsis\u0022\u003EPe\u003C/abbr\u003E is 163.410! So, after having performed a seat of the pants burn (point prograde, press Z, wait till happy, press X), the Nav Ball is showing the pre-burn \u003Cabbr title=\u0022Periapsis\u0022\u003EPe\u003C/abbr\u003E.\n\u003C/p\u003E\n\u003Cp\u003E\nI suspect that the activeVessel.Orbit info is holding the previous orbit\u0027s info, so this \u003Cem\u003E\u003Cstrong\u003Emay not be limited to hyperbolic orbits\u003C/strong\u003E\u003C/em\u003E as I originally assumed. I suppose I may have entered the Mun\u0027s \u003Cabbr title=\u0022Sphere of Influence\u0022\u003ESOI\u003C/abbr\u003E on an orbit with e = 0.966 and \u003Cabbr title=\u0022Apoapsis\u0022\u003EAp\u003C/abbr\u003E 20,956.126 km, which was then being reported by activeVessel.Orbit as the current info. Then I performed my seat-of-the-pants \u003Cabbr title=\u0022Periapsis\u0022\u003EPe\u003C/abbr\u003E raising maneuver and I find that e = 1.056, \u003Cabbr title=\u0022Periapsis\u0022\u003EPe\u003C/abbr\u003E is what it was before the burn, and \u003Cabbr title=\u0022Apoapsis\u0022\u003EAp\u003C/abbr\u003E is at least negative as it should be.\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027m willing to bet that my mods are not the only thing in the game relying on activeVessel.Orbit to have the correct current orbit info. I would not be surprised to find that IG uses that info in lots of places. If it\u0027s stale, as I now suspect, you\u0027re going to have all sorts of issues popping up all over the place.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222023-04-13T16:55:26Z\u0022 title=\u002204/13/2023 04:55  PM\u0022 data-short=\u00221 yr\u0022\u003EApril 13, 2023\u003C/time\u003E by schlosrat\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"schlosrat","CreatedById":141963,"CreatedDateTime":"2023-04-13T17:13:27Z","Content":"\n\u003Cp\u003E\nScratch the previous hypothesis.\u00A0I went back to my save where I entered the Mun\u0027s \u003Cabbr title=\u0022Sphere of Influence\u0022\u003E\u003Cabbr title=\u0022Sphere of Influence\u0022\u003ESOI\u003C/abbr\u003E\u003C/abbr\u003E and played around with small seat-of-the-pants burns (no node), and a small burn using a node (in case the creation/deletion of the node had anything to do with it). Turns out, nope. But if I burn gently prograde and watch e (via either MNC or Micro Engineer, they report the same info) then it goes \u0026gt; 1 at about a \u003Cabbr title=\u0022Periapsis\u0022\u003E\u003Cabbr title=\u0022Periapsis\u0022\u003EPe\u003C/abbr\u003E\u003C/abbr\u003E of 199km as shown here. Once the e goes above 1 then things look OK (though they didn\u0027t in the shot above).\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u0022uWhtAsQ.png\u0022 class=\u0022ipsImage\u0022 data-ratio=\u002276.42\u0022 height=\u0022813\u0022 width=\u00221200\u0022 src=\u0022https://i.imgur.com/uWhtAsQ.png\u0022\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nNot sure now what\u0027s going on, but there are at least some conditions where the activeVessel.Orbit info is demonstrably wrong. I can supply a save file if you like.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222023-04-14T01:42:57Z\u0022 title=\u002204/14/2023 01:42  AM\u0022 data-short=\u00221 yr\u0022\u003EApril 14, 2023\u003C/time\u003E by schlosrat\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"schlosrat","CreatedById":141963,"CreatedDateTime":"2023-04-16T01:07:53Z","Content":"\n\u003Cp\u003E\nFurther inspection shows that the information being delivered for the orbit in the post-burn patch is actually the orbit info for the orbit you\u0027ll have once you leave the \u003Cabbr title=\u0022Sphere of Influence\u0022\u003ESOI\u003C/abbr\u003E you\u0027re in. So, if you\u0027re on a hyperbolic flyby orbit, then you will certainly be leaving the \u003Cabbr title=\u0022Sphere of Influence\u0022\u003ESOI\u003C/abbr\u003E at the end of your current patch. If you have a maneuver node to modify your flyby, for example to adjust your closest approach or change your inclination, then the information for the orbit you\u0027ll have after the burn is being set to the orbital info for your trajectory when you leave the \u003Cabbr title=\u0022Sphere of Influence\u0022\u003ESOI\u003C/abbr\u003E you\u0027re in.\n\u003C/p\u003E\n"},{"CreatedByName":"LeroyJenkins","CreatedById":227115,"CreatedDateTime":"2023-04-16T01:41:02Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00224273359\u0022 data-ipsquote-contentid=\u0022216462\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221681607273\u0022 data-ipsquote-userid=\u0022141963\u0022 data-ipsquote-username=\u0022schlosrat\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n33 minutes ago, schlosrat said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nFurther inspection shows that the information being delivered for the orbit in the post-burn patch is actually the orbit info for the orbit you\u0027ll have once you leave the \u003Cabbr title=\u0022Sphere of Influence\u0022\u003E\u003Cabbr title=\u0022Sphere of Influence\u0022\u003ESOI\u003C/abbr\u003E\u003C/abbr\u003E you\u0027re in.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThis makes me wonder how the activeVessel.Orbit data is organized and tracked for each patch. It would be good to be able to know which patch pre or post maneuver, and now inner \u003Cabbr title=\u0022Sphere of Influence\u0022\u003E\u003Cabbr title=\u0022Sphere of Influence\u0022\u003ESOI\u003C/abbr\u003E\u003C/abbr\u003E and after leaving \u003Cabbr title=\u0022Sphere of Influence\u0022\u003E\u003Cabbr title=\u0022Sphere of Influence\u0022\u003ESOI\u003C/abbr\u003E the current values are for\u003C/abbr\u003E. KSP1 had this a bit better organized in the orbit parameter readout, in the lower left hand corner of the UI, and one could select which parameters (before or after maneuvers). This would help with understanding the values when doing a gravity assist fly- by orbit planning.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222023-04-16T01:41:32Z\u0022 title=\u002204/16/2023 01:41  AM\u0022 data-short=\u00221 yr\u0022\u003EApril 16, 2023\u003C/time\u003E by LeroyJenkins\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"schlosrat","CreatedById":141963,"CreatedDateTime":"2023-04-16T03:23:14Z","Content":"\n\u003Cp\u003E\nYeah, it definitely seems odd in how its organized internally - perhaps due to the lack of docs for such things. It\u2019s pretty easy to get a list of all the patched conic sections associated with the active vessel, and patches have links for the next and previous patch, but when you go trolling through the data you find there\u2019s the current patch (which has info for when you leave the current \u003Cabbr title=\u0022Sphere of Influence\u0022\u003ESOI\u003C/abbr\u003E), but the patch that\u2019s prior to that one has nulls for all the info fields. So where does the info come from that the map is displaying? Could this have something to do with the bug where we can\u2019t get accurate return trajectories?\n\u003C/p\u003E\n"},{"CreatedByName":"schlosrat","CreatedById":141963,"CreatedDateTime":"2023-04-24T11:05:49Z","Content":"\n\u003Cp\u003E\nWell, this is embarrassing...\n\u003C/p\u003E\n\u003Cp\u003E\nOn further investigation the tools I was using to observe the orbital elements were looking in the wrong place. Apparently what I\u0027ve observed and reported is not a bug, but an aspect of a design decision that results in a fairly confusing way to store this information. One might *think* that since you can ordinarily get the orbital elements from the active vessels\u0027s Orbit class, then that would be to place to look for them when you\u0027re on a flyby, but apparently not. The correct information is in there, it\u0027s just really confusing and obscure to find it.\u003Cbr\u003E\n\u003Cbr\u003E\nI retract my bug report. Sorry for the confusion.\n\u003C/p\u003E\n"}]}