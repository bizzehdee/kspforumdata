{"TopicId":109249,"ForumId":69,"TopicTitle":"Unexplained Orbit Perturbation in 1.0.2 - With Log, Screenshots, Saves, and Reproduction Steps","CreatedByName":"conklech","CreatedById":140565,"CreatedDateTime":"2015-05-14T19:37:17Z","PageNum":1,"Articles":[{"CreatedByName":"conklech","CreatedById":140565,"CreatedDateTime":"2015-05-14T19:37:17Z","Content":"\n\u003Cp\u003EKSP 1.0.2, Linux, 64-bit, Steam edition. Running a normal Ubuntu installation with an nVidia graphics card, using the recommended proprietary drivers.\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003EExpected behavior: \u003C/strong\u003EAn unpowered, single-part craft in a circular orbit well outside the atmosphere will stay in the same, stable orbit when time acceleration is off, i.e. not \u0022on rails.\u0022 In reality, low earth orbits decay slightly. As I understood it, KSP orbits outside the atmosphere are expected to be perfectly stable.\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003EActual behavior:\u003C/strong\u003E Apoapsis, periapsis, and semi-major axis all vary noticeably. In this test, starting in a roughly circular orbit, the orbit does not decay. The apsides change visibly, a meter or two per minute; the SMA (in this test) increases by a few meters per hour; the other orbital parameters change slightly.\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003EImpact:\u003C/strong\u003E Maneuvers and intercepts are unpredictable unless you\u0027re constantly in timewarp. Physics feels broken. Trust issues. Fun level decreases.\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003EReproduction steps and test case:\u003C/strong\u003E\u003C/p\u003E\u003Cp\u003EDownload game from Steam. Launch and immediately begin a new sandbox save. Construct and launch something into orbit. \u003C/p\u003E\u003Cp\u003E(You can see in the first screenshot below that I forgot the coupler on the first launch. That vehicle exhibited the same problem, but I wanted a single-part craft for the test, so I launched again. That\u0027s why there are two launches in the log.)\u003C/p\u003E\u003Cp\u003E(While the batteries are still alive, turn the craft a bit and observe the orbit changing. AFAIK, that\u0027s a different, known bug, so that\u0027s not what this post is about.)\u003C/p\u003E\u003Cp\u003EDisable the reaction wheels and turn off SAS; step away from the controls. Do not turn on time warp. (\u003Cem\u003EPhysics \u003C/em\u003Ewarp also has different weird effects on the orbit. For this report I left physics warp off at all times.)\u003C/p\u003E\u003Cp\u003EObserve the orbit. Here are my observations. The apsides are from the screenshots; SMA is from the save file captured just after each screenshot, available below. (Apo\u002BPeri/2\u002B600 agrees to six figures.) If you look carefully you can see that the longitude of periapsis changes by a few degrees too. If you look in the saves, you\u0027ll see that all orbit parameters are changing.\u003C/p\u003E\u003Cp\u003EObservation 1: T\u002B07:33, Apo 113,136, Peri 106,336, SMA 709,736.286620452\u003C/p\u003E\u003Cp\u003EObservation 2: T\u002B32:57, Apo 113,070, Peri 106,405, SMA 709,737.294459971\u003C/p\u003E\u003Cp\u003EObservation 3: T\u002B52:18, Apo 113,194, Peri 106,284, SMA 709,739.000280522\u003C/p\u003E\u003Cp\u003EAnd here are the images. The apsides don\u0027t really show up in the Imgur preview, so there\u0027s not much to see.\u003C/p\u003E\u003Cblockquote lang=\u0022en\u0022\u003E\u003Ca href=\u0022//imgur.com/a/CIrmy\u0022 rel=\u0022external nofollow\u0022\u003EJavascript is disabled. View full album\u003C/a\u003E\u003C/blockquote\u003E\u003Cp\u003EThe KSP.log is \u003Ca href=\u0022https://drive.google.com/file/d/0B-o9qA-aAUb8b05FdFlBWTBkTVk/view?usp=sharing\u0022 rel=\u0022external nofollow\u0022\u003Ehere\u003C/a\u003E. I don\u0027t see anything interesting there; the NREs at the end are presumably because I Alt-F4\u0027d the game at the end of the test. The three save files, in addition to the screenshots and log, are available \u003Ca href=\u0022https://drive.google.com/folderview?id=0B-o9qA-aAUb8X1RDd1hqb1NtUTA\u0026amp;usp=sharing\u0022 rel=\u0022external nofollow\u0022\u003Ehere\u003C/a\u003E. In the save files, find the focused ship by searching for \u0022pid = aa0eed81e6014276a778da4d41b363ea\u0022.\u003C/p\u003E\u003Cp\u003EI don\u0027t know if any of the perturbations are periodic. Some of the effect could potentially be related to the craft\u0027s orientation relative to Kerbin or some such. I could run another test tonight if there\u0027s interest.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-05-14T20:20:43Z\u0022 title=\u002205/14/2015 08:20  PM\u0022 data-short=\u00229 yr\u0022\u003EMay 14, 2015\u003C/time\u003E by conklech\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Shrike99","CreatedById":101993,"CreatedDateTime":"2015-05-20T08:41:25Z","Content":"\n\u003Cp\u003EFirst up, this isnt an unexplained problem to my knowledge. My space-station gaining 10km to its appoapsis every second even with no thrust or torque active is unexplained.\u003C/p\u003E\u003Cp\u003EMy understanding is that it is because when you aren\u0027t time warping, which halts all rotation and puts you \u0022on rails\u0022, the craft will always either be applying some force via SAS, altering the orbit, or like you have done here if you disable the SAS and torque, there will be a minute amount of rotation no matter what, combining that with inaccuracies in the way ksp handles floating point calculations and you get some orbital \u0022wobble\u0022. Anyway, you could view it as realistic, as in real life spacecraft experience similar effects, as gravity is not perfect or constant around the earth, meaning that there are wobbles in the real world.\u003C/p\u003E\u003Cp\u003EAlso this problem isn\u0027t unique to 1.0.2, This has been here since the early days of ksp, although i seem to remember it got improved somewhat around 0.25?\u003C/p\u003E\n"},{"CreatedByName":"luizopiloto","CreatedById":97503,"CreatedDateTime":"2015-05-20T17:32:34Z","Content":"\n\u003Cp\u003EThis is an old problem, but it got a bit worse in KSP 1.0.2.\u003C/p\u003E\u003Cp\u003EI noticed my simple craft, with barely 12 parts was changing AP-PE by 1 meter each 2 seconds... on a 100.000m orbit.\u003C/p\u003E\u003Cp\u003E\u003Cem\u003EWindows 7, KSP 1.0.2 x86, Steam.\u003C/em\u003E\u003C/p\u003E\n"},{"CreatedByName":"conklech","CreatedById":140565,"CreatedDateTime":"2015-05-21T02:51:20Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Shrike99\u0022 data-cite=\u0022Shrike99\u0022\u003E\u003Cdiv\u003Ethere will be a minute amount of rotation no matter what, combining that with inaccuracies in the way ksp handles floating point calculations and you get some orbital \u0022wobble\u0022. Anyway, you could view it as realistic, as in real life spacecraft experience similar effects, as gravity is not perfect or constant around the earth, meaning that there are wobbles in the real world.\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYour explanation is consistent with my guess; roughly, that there\u0027s some accumulating floating-point error involving rotation. The Krakensbane solution didn\u0027t completely disconnect the local and accelerating frames of reference, it just factored it out to get some more precision. I wonder if this corner of the sim could be revisited during the Unity 5 transition?\u003C/p\u003E\u003Cp\u003EI\u0027ve done a similar test where I bounced in and out of (non-physics) warp to zero rotation; the same thing happens. The vessel of course rotates in the rotating OBT frame of reference shown on the navball; maybe some calculations are being done in that frame?\u003C/p\u003E\u003Cp\u003EIt\u0027s actually a much bigger problem when you\u0027re actually rotating, e.g. to align with a small-delta maneuver node that jumps all over the ball because your orbit is fluctuating by more than the desired change. Setting up synchronous orbits for RemoteTech networks is a pain; I dropped that mod in part because of this bug.\u003C/p\u003E\u003Cp\u003EI\u0027d be more willing to write this bug off as \u0022oh, orbits are unstable in real life\u0022 if the orbital energy were decreasing rather than increasing. Furthermore, there\u0027s now an un-fun incentive to spend as little time off-rails as possible if you want to have reliable maneuver predictions.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022luizopiloto\u0022 data-cite=\u0022luizopiloto\u0022\u003E\u003Cdiv\u003EThis is an old problem, but it got a bit worse in KSP 1.0.2.\u003Cp\u003EI noticed my simple craft, with barely 12 parts was changing AP-PE by 1 meter each 2 seconds... on a 100.000m orbit.\u003C/p\u003E\u003Cp\u003E\u003Cem\u003EWindows 7, KSP 1.0.2 x86, Steam.\u003C/em\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI agree that it\u0027s an existing problem that\u0027s gotten worse. I remember seeing jitters in 0.90, but I never watched long enough to notice whether there was a systematic error. These changes of a meter every few seconds are really disconcerting, especially in the stock game where you can\u0027t see that the semimajor axis is still sort of stable.\u003C/p\u003E\u003Cp\u003EThanks for confirming on Windows x86!\u003C/p\u003E\n"},{"CreatedByName":"luizopiloto","CreatedById":97503,"CreatedDateTime":"2015-05-23T00:10:11Z","Content":"\n\u003Cp\u003EAfter some observations, I have found orbits get more stable when AP \u0026amp; PE difference is around 400m.\u003C/p\u003E\n"},{"CreatedByName":"maltesh","CreatedById":17144,"CreatedDateTime":"2015-05-23T00:32:07Z","Content":"\n\u003Cp\u003EIt\u0027s an unavoidable consequence of the way KSP calculates orbits when you\u0027re off rails.\u003C/p\u003E\u003Cp\u003EWhen you\u0027re on-rails, KSP takes your velocity and distance from the central body, and solves the Keplerian equations as a function of time for the position your spacecraft will be in. As a result, your spacecraft effectively travels a perfect Keplerian orbit, and the parameters that describe your orbit\u0027s shape and orientation do not change.\u003C/p\u003E\u003Cp\u003EWhen you\u0027re off rails, things work differently. The game takes the position of your Root Part, its distance and direction from the center of the body you\u0027re orbiting, and its current velocity, and projects what the Keplerian orbit would be if it went on-rails at that very instant.\u003C/p\u003E\u003Cp\u003EThen it assumes that the acceleration due to gravity would be the constant over the next timestep, calculates where your spacecraft would be based on that constant gravity magnitude and direction, and moves your spacecraft to where it would be based on that timestep. And then, it recalculates the orbit. Since your spacecraft is not /actually/ travelling a Perfect Keplerian Orbit, but instead making a large number of tiny jumps that /approximate/ one, the orbital parameters are going to change after each timestep.\u003C/p\u003E\u003Cp\u003EIs this a big deal? On the whole...No. Yes, your orbital parameters are changing when you\u0027re in normal time. They\u0027re not changing much over the typical play time, and if you decide to kick back into timewarp, they\u0027ll stop changing. Yes, your Argument of Periapsis (The parameter the persistence file labels LPE ) changes. With an orbit as circular as the one you\u0027re using, the minor perturbations introduced by the timestep method are going to shift your line of apsides /because/ the orbit is so nearly circular.\u003C/p\u003E\n"},{"CreatedByName":"conklech","CreatedById":140565,"CreatedDateTime":"2015-05-23T04:37:04Z","Content":"\n\u003Cp\u003EThanks for the comprehensive explanation. Why does the orientation of the craft, even with one-piece crafts, seem to cause such large instantaneous changes? And do you agree with the casual observation that things are worse in 1.0.2? I think I have a 0.90 install lying around; maybe I can do a comparison test over the weekend.\u003C/p\u003E\n"},{"CreatedByName":"luizopiloto","CreatedById":97503,"CreatedDateTime":"2015-05-23T15:58:19Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022maltesh\u0022 data-cite=\u0022maltesh\u0022\u003E\u003Cdiv\u003E\u003Cp\u003E...\u003C/p\u003E\u003Cp\u003EWhen you\u0027re off rails, things work differently. The game takes the position of your Root Part, its distance and direction from the center of the body you\u0027re orbiting, and its current velocity, and projects what the Keplerian orbit would be if it went on-rails at that very instant.\u003C/p\u003E\u003Cp\u003E...\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EBut KSP uses PhysX functions in Unity... it just apply gravty to parts... what I think is affecting orbits is how game reads and apply tranformations to objects each cycle...\u003C/p\u003E\n"}]}