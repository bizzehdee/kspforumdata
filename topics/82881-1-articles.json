{"TopicId":82881,"ForumId":29,"TopicTitle":"Adding resource on vessel load","CreatedByName":"Sniperlrsw","CreatedById":113340,"CreatedDateTime":"2014-08-26T03:05:47Z","PageNum":1,"Articles":[{"CreatedByName":"Sniperlrsw","CreatedById":113340,"CreatedDateTime":"2014-08-26T03:05:47Z","Content":"\n\u003Cp\u003ESo i\u0027m working on addition to karbonite to allow mining while the vessel is unloaded. So i\u0027m looking for a way to add a resource to a tank on vessel load. The amount doesn\u0027t matter.\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-08-26T03:28:48Z","Content":"\n\u003Cp\u003EI think that the OnVesselUnpack game event will work. I\u0027m using this and it runs on vessels that come into range during flight, but it also runs for the vessel that has focus when the flightscene loads.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E//in a class that runs on during flight mode, either Scenario or KSPAddon.Flight work\u003Cbr\u003E\u003Cbr\u003Epublic void Start()\u003Cbr\u003E{\u003Cbr\u003EGameEvents.onVesselGoOffRails.Add(VesselOffRails);\u003Cbr\u003E}\u003Cbr\u003E\u003Cbr\u003Epublic void VesselOffRails(Vessel vsl) //this runs when Vessel vsl comes off rails and loads\u003Cbr\u003E{\u003Cbr\u003E//add code to add resource to Vessel vsl here\u003Cbr\u003E}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n"},{"CreatedByName":"Sniperlrsw","CreatedById":113340,"CreatedDateTime":"2014-08-26T03:57:26Z","Content":"\n\u003Cp\u003EDouble-Posted \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E Whoops\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-08-26T04:14:20Z\u0022 title=\u002208/26/2014 04:14  AM\u0022 data-short=\u00229 yr\u0022\u003EAugust 26, 2014\u003C/time\u003E by Sniperlrsw\u003C/strong\u003E\n\u003Cbr\u003Edouble posted\n\u003C/span\u003E\n"},{"CreatedByName":"Sniperlrsw","CreatedById":113340,"CreatedDateTime":"2014-08-26T03:58:30Z","Content":"\n\u003Cp\u003EThank you for that part but the part i was looking for more was the actual resource addition.\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-08-26T04:21:05Z","Content":"\n\u003Cp\u003EErg, I\u0027ve never dealt with resources myself.\u003C/p\u003E\u003Cp\u003EMaybe something like this?\u003C/p\u003E\u003Cp\u003EWarning: Pseudo-code ahead\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Epublic void VesselOffRails()\u003Cbr\u003E{\u003Cbr\u003Eforeach(Part p in vsl.Parts) //cycle through vessel parts\u003Cbr\u003E{\u003Cbr\u003Eif(p.hasResourceStorage == true \u0026amp;\u0026amp; p.resource.current \u0026lt; p.resource.max)\u003Cbr\u003E{\u003Cbr\u003Ep.resource.addToPart = Math.Max(p.resource.max - p.resource.current,resourceToAdd) //error trap so you never add more resources then you have left to add to vessel\u003Cbr\u003EresourceToAdd = resourceToAdd - (p.resource.max - p.resource.current) //resource amount to add to vessel is calculated elsewhere\u003Cbr\u003Eif(resourceToAdd \u0026lt;= 0) //check if we have any resources left to add, if not we are done so stop cycling through vessel parts\u003Cbr\u003E{\u003Cbr\u003Egoto BreakOut;\u003Cbr\u003E}\u003Cbr\u003E}\u003Cbr\u003E}\u003Cbr\u003E}\u003Cbr\u003EBreakOut:\u003Cbr\u003Eprint(\u0022Done Adding Resources\u0022);\u003Cbr\u003E//done cycling through all parts on vessel, if resourceToAdd \u0026gt; 0, those resource are lost due to lack of storage\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EI think that makes sense?\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-08-26T04:23:39Z\u0022 title=\u002208/26/2014 04:23  AM\u0022 data-short=\u00229 yr\u0022\u003EAugust 26, 2014\u003C/time\u003E by Diazo\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"NathanKell","CreatedById":75006,"CreatedDateTime":"2014-08-26T04:43:20Z","Content":"\n\u003Cp\u003EYou can either use a method like TaranisElsu does in TAC Life Support (i.e. do everything on unpack) or you can use a method like asmi does for ECLSS where resources are actually tracked and changed per tick for unloaded vessels.\u003C/p\u003E\n"}]}