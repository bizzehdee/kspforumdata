{"TopicId":105949,"ForumId":36,"TopicTitle":"Calculating the correct altitude over water","CreatedByName":"Nereid","CreatedById":68815,"CreatedDateTime":"2015-04-29T11:15:08Z","PageNum":1,"Articles":[{"CreatedByName":"Nereid","CreatedById":68815,"CreatedDateTime":"2015-04-29T11:15:08Z","Content":"\n\u003Cp\u003EI\u0027m still facing the problem to calculate the correct altitude for a radar altimeter in NanoGauges over see/water.\u003C/p\u003E\u003Cp\u003EOver terrain it\u0027s easy: subtract terrain height from altitude. Over water... well, this will create a desaster. In this case the radar altimeter should display the altitude above sea level.\u003C/p\u003E\u003Cp\u003ESo, question: Is there a way to detect if a vessel is flying over water? is there a better way to calculate the radar altitude?\u003C/p\u003E\u003Cp\u003EThanks for any tip.\u003C/p\u003E\n"},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2015-04-29T11:42:10Z","Content":"\n\u003Cp\u003EAssuming your issue is that radar alt is going to the seabed\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003EMath.Min(radarAlt, vessel.alt)\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n"},{"CreatedByName":"Daid","CreatedById":32171,"CreatedDateTime":"2015-04-29T11:42:12Z","Content":"\n\u003Cp\u003EI thought water was always at \u0022height\u0022 0? If it\u0027s not, then maybe you can check the RSS code to see what they change to get the water level to be at the proper height?\u003C/p\u003E\n"},{"CreatedByName":"Nereid","CreatedById":68815,"CreatedDateTime":"2015-04-29T12:13:47Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Crzyrndm\u0022 data-cite=\u0022Crzyrndm\u0022\u003E\u003Cdiv\u003EAssuming your issue is that radar alt is going to the seabed\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003EMath.Min(radarAlt, vessel.alt)\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EWell, this wont work, because on Mun there is no water and some terrain is below height 0. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_sad.gif\u0022 alt=\u0022:(\u0022\u003E\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022font-size:8px;\u0022\u003E\u003Cspan style=\u0022color:#C0C0C0;\u0022\u003E- - - Updated - - -\u003C/span\u003E\u003C/span\u003E\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Daid\u0022 data-cite=\u0022Daid\u0022\u003E\u003Cdiv\u003EI thought water was always at \u0022height\u0022 0? If it\u0027s not, then maybe you can check the RSS code to see what they change to get the water level to be at the proper height?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYes water height is 0. But if there is no water and terrain is below 0, we cant assume radar altitude = altitude (above sea level).\u003C/p\u003E\n"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2015-04-29T12:18:53Z","Content":"\n\u003Ca href=\u0022https://github.com/MuMech/MechJeb2/blob/master/MechJeb2/CelestialBodyExtensions.cs#L16-L24\u0022 rel=\u0022external nofollow\u0022\u003EThis\u003C/a\u003E may help\n"},{"CreatedByName":"Nereid","CreatedById":68815,"CreatedDateTime":"2015-04-29T12:42:13Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022sarbian\u0022 data-cite=\u0022sarbian\u0022\u003E\u003Cdiv\u003E\u003Ca href=\u0022https://github.com/MuMech/MechJeb2/blob/master/MechJeb2/CelestialBodyExtensions.cs#L16-L24\u0022 rel=\u0022external nofollow\u0022\u003EThis\u003C/a\u003E may help\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EAh! Cool. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E I will check it this evening. If it works, I will integrate this solution in NG. Thanks \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2015-04-29T14:30:19Z","Content":"\n\u003Cp\u003EThe fix to the Math.Min shown above is to gate it behind a CelestialBody.ocean check.\u003C/p\u003E\u003Cp\u003EIf .ocean is true, that body has a sea, if false it does not.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n"},{"CreatedByName":"Nereid","CreatedById":68815,"CreatedDateTime":"2015-04-29T15:01:55Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Diazo\u0022 data-cite=\u0022Diazo\u0022\u003E\u003Cdiv\u003EThe fix to the Math.Min shown above is to gate it behind a CelestialBody.ocean check.\u003Cp\u003EIf .ocean is true, that body has a sea, if false it does not.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThis will only work if no celestial body (with .ocean=true) has terrain below 0 without an ocean. But to be honest I don\u0027t know if KSP supports such strange terrain.\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2015-04-29T15:33:50Z","Content":"\n\u003Cp\u003EThat is one of the oddities of KSP.\u003C/p\u003E\u003Cp\u003EIf a body .ocean = true, that body has a \u0022water sphere\u0022 that is perfectly round at an ASL of 0 so you can never go to a \u0022negative\u0022 altitude, you hit water at ASL 0 first.\u003C/p\u003E\u003Cp\u003EIt\u0027s (one of) the reasons moving your camera so you can\u0027t see the ground during launch can result in such a large FPS increase, KSP is drawing two \u0022grounds\u0022, one is the terrain you can land on, one is the water \u0022ground\u0022 sphere. KSP draws both of them, you just see whichever one has a higher altitude.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n"},{"CreatedByName":"Nereid","CreatedById":68815,"CreatedDateTime":"2015-04-29T17:28:33Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Diazo\u0022 data-cite=\u0022Diazo\u0022\u003E\u003Cdiv\u003EThat is one of the oddities of KSP.\u003Cp\u003EIf a body .ocean = true, that body has a \u0022water sphere\u0022 that is perfectly round at an ASL of 0 so you can never go to a \u0022negative\u0022 altitude, you hit water at ASL 0 first.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EAh, ok. If this is true than we have a very simple way to calculate the true (radar) altitude. Thanks \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Capt. Hunt","CreatedById":97860,"CreatedDateTime":"2015-05-01T02:23:46Z","Content":"\n\u003Cp\u003EThis might be a stupid question, but why not just use the ASL altimeter over water? It\u0027s already calibrated to read altitude above sea level.\u003C/p\u003E\n"}]}