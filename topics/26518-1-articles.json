{"TopicId":26518,"ForumId":15,"TopicTitle":"Animations killing frame rate","CreatedByName":"SasquatchM","CreatedById":11888,"CreatedDateTime":"2013-05-12T12:39:26Z","PageNum":1,"Articles":[{"CreatedByName":"SasquatchM","CreatedById":11888,"CreatedDateTime":"2013-05-12T12:39:26Z","Content":"\n\u003Cp\u003EI have made a series of parts, a couple different intakes and an engine. All of them have an animation that is controlled by throttle. They were made in Blender and directly imported into unity as .blend files. Under the Inspector/Rig I set the animation type to legacy and can then access the \u0027Default Take\u0027 for use in game.\u003C/p\u003E\u003Cp\u003EI am using either\u003C/p\u003E\u003Cp\u003EMODULE\u003C/p\u003E\u003Cp\u003E{\u003C/p\u003E\u003Cp\u003E name = FXModuleAnimateThrottle\u003C/p\u003E\u003Cp\u003E animationName = Default Take\u003C/p\u003E\u003Cp\u003E dependOnEngineState = True\u003C/p\u003E\u003Cp\u003E responseSpeed = 0.1\u003C/p\u003E\u003Cp\u003E}\u003C/p\u003E\u003Cp\u003Eor\u003C/p\u003E\u003Cp\u003EMODULE\u003C/p\u003E\u003Cp\u003E{\u003C/p\u003E\u003Cp\u003E name = FXModuleAnimateThrottle\u003C/p\u003E\u003Cp\u003E animationName = Default Take\u003C/p\u003E\u003Cp\u003E dependOnEngineState = True\u003C/p\u003E\u003Cp\u003E }\u003C/p\u003E\u003Cp\u003Ein the part.cfg.\u003C/p\u003E\u003Cp\u003EWith all of that explained: Having more than say 4-6 of these parts does bad things to my frame rate. Any ideas?\u003C/p\u003E\n"},{"CreatedByName":"Xellith","CreatedById":35053,"CreatedDateTime":"2013-05-12T16:09:07Z","Content":"\n\u003Cp\u003EAre you giving these parts complex colliders? (and I know you prolly know this, but you can rename that \u0022Default Take\u0022 to something else)\u003C/p\u003E\n"},{"CreatedByName":"SasquatchM","CreatedById":11888,"CreatedDateTime":"2013-05-12T17:05:12Z","Content":"\n\u003Cp\u003EI found where to rename it in unity, but never could find it in blender\u003C/p\u003E\n"},{"CreatedByName":"SasquatchM","CreatedById":11888,"CreatedDateTime":"2013-05-12T17:05:46Z","Content":"\n\u003Cp\u003EI cetainly could limit the colliders, but they are less complex already thasn some i have used\u003C/p\u003E\n"},{"CreatedByName":"Xellith","CreatedById":35053,"CreatedDateTime":"2013-05-12T17:23:36Z","Content":"\n\u003Cp\u003EWell the general idea is that your entire animation in blender gets chopped up in unity allowing for multiple animations to be taken from the one blender file. Like animation 1 may use frames 0-200 where something jumps in the air and animation 2 uses frames 201-400. \u003C/p\u003E\u003Cp\u003EBut addressing colliders, a simpler collider or less tri\u0027s of your model tend to help with framerate. (I know that complex looking models with even simple colliders get lagged to crap when hit by lights)\u003C/p\u003E\u003Cp\u003EIf you want you can put the part in drop box and Ill try it out and see if I get the same framedrops or something.\u003C/p\u003E\n"},{"CreatedByName":"SasquatchM","CreatedById":11888,"CreatedDateTime":"2013-05-12T18:57:37Z","Content":"\n\u003Ca href=\u0022http://www./download.php?sb54gm3r1t5zrjm\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://www./download.php?sb54gm3r1t5zrjm\u003C/a\u003E\n"},{"CreatedByName":"Xellith","CreatedById":35053,"CreatedDateTime":"2013-05-12T19:09:48Z","Content":"\n\u003Cp\u003EYeah those parts do give a bit of lag dont they.\u003C/p\u003E\n"},{"CreatedByName":"Space gh\u00F6st","CreatedById":50704,"CreatedDateTime":"2013-05-13T01:04:47Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022SasquatchM\u0022 data-cite=\u0022SasquatchM\u0022\u003E\u003Cdiv\u003EHaving more than say 4-6 of these parts does bad things to my frame rate. Any ideas?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EDoes any of your parts have more then one animation? If that\u0027s the case, you can split the animation files into two (technically). If not, then that\u0027s a mystery. How many frames are you using for the animations? Not that I\u0027ve had much experience with the vanilla animation module, but it has acted wonky on me before, and neither Kreuzung\u0027s or JDP\u0027s animation plugins have given me that kind of trouble. \u003C/p\u003E\u003Cp\u003ENormally I just create a new animation clip in Unity and then attach it to the parent object of the group that I\u0027m animating. Although a simple singular animation I\u0027ll just do in Blender.\u003C/p\u003E\n"},{"CreatedByName":"Devo","CreatedById":22750,"CreatedDateTime":"2013-05-13T01:31:25Z","Content":"\n\u003Cp\u003EI have experimented alot, and it seems that if I make any animations more than 120 frames, I get the same lag as you Sasquatch, the best I could do was lower the frames used and make the animation play slower.\u003C/p\u003E\n"},{"CreatedByName":"InfiniteDice","CreatedById":57451,"CreatedDateTime":"2013-05-15T18:20:58Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022devogen\u0022 data-cite=\u0022devogen\u0022\u003E\u003Cdiv\u003EI have experimented alot, and it seems that if I make any animations more than 120 frames, I get the same lag as you Sasquatch, the best I could do was lower the frames used and make the animation play slower.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EMust be colliders... I have an animation with 1200 frames, I see no impact at all on performance. I even animated 7 separate 1200 frame animations at once.\u003C/p\u003E\n"},{"CreatedByName":"SasquatchM","CreatedById":11888,"CreatedDateTime":"2013-05-15T22:36:33Z","Content":"\n\u003Cp\u003EI\u0027ll limit some of the colliders and see if that helps. These are only 60 frame animations, since they are linked to throttle. I wondered if it was because of the throttle connection that it was hitting this hard\u003C/p\u003E\n"},{"CreatedByName":"SasquatchM","CreatedById":11888,"CreatedDateTime":"2013-05-15T23:03:35Z","Content":"\n\u003Cp\u003ESo, i simplified the colliders by about 50% and it had no effect at all. I turned off the animations and gained 36 fps which I\u0027m sure would be more but my vsync is set to 60hz\u003C/p\u003E\n"},{"CreatedByName":"Devo","CreatedById":22750,"CreatedDateTime":"2013-05-16T00:13:39Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022SasquatchM\u0022 data-cite=\u0022SasquatchM\u0022\u003E\u003Cdiv\u003ESo, i simplified the colliders by about 50% and it had no effect at all. I turned off the animations and gained 36 fps which I\u0027m sure would be more but my vsync is set to 60hz\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EColliders don\u0027t make any difference to the animation speed, not for me anyway. As I said, the only way to reduce the lag I found was to simply remove the amount of frames I am using.\u003C/p\u003E\u003Cp\u003ETake a look at the stock solar panel for example..\u003C/p\u003E\u003Cp\u003ECount in seconds how long it takes to unfold, 2 seconds maybe? 2.5 seconds? \u003C/p\u003E\u003Cp\u003E1 second = 30 frames of animation (default) so really, the solar panel should be between 60-90 frames maybe? \u003C/p\u003E\u003Cp\u003ENow one of them doesn\u0027t lag, but you put 6 on your ship and deploy them all at once, and walla, lag.\u003C/p\u003E\n"},{"CreatedByName":"SasquatchM","CreatedById":11888,"CreatedDateTime":"2013-05-16T00:45:32Z","Content":"\n\u003Cp\u003Eunfortunately the throttle animations are all set to 60 frames, 1 frame per position so that they move in concert with throttle position. I think I will try animating them directly in unity instead of importing a blender animation.\u003C/p\u003E\u003Cp\u003EInfiniteDice, what do you use for your animations?\u003C/p\u003E\u003Cp\u003EI stil lthink it may be tied into the throttle link.. effectively the animation is constantly playing and the position be recalculated\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-05-16T00:48:58Z\u0022 title=\u002205/16/2013 12:48  AM\u0022 data-short=\u002211 yr\u0022\u003EMay 16, 2013\u003C/time\u003E by SasquatchM\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Devo","CreatedById":22750,"CreatedDateTime":"2013-05-16T04:36:29Z","Content":"\n\u003Cp\u003Ethrottle animations? as in you have split animations for the throttle? have you tried not splitting if thats the case?\u003C/p\u003E\n"},{"CreatedByName":"SasquatchM","CreatedById":11888,"CreatedDateTime":"2013-05-16T11:21:35Z","Content":"\n\u003Cp\u003Eeach part has 1 60 frame animation, frame 1 being closed and frame 60 being fully open. I read \u003Cem\u003Esomewhere\u003C/em\u003E that FXModuleAnimateThrottle looked for 60 frames\u003C/p\u003E\n"},{"CreatedByName":"InfiniteDice","CreatedById":57451,"CreatedDateTime":"2013-05-16T18:38:10Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022SasquatchM\u0022 data-cite=\u0022SasquatchM\u0022\u003E\u003Cdiv\u003Eunfortunately the throttle animations are all set to 60 frames, 1 frame per position so that they move in concert with throttle position. I think I will try animating them directly in unity instead of importing a blender animation.\u003Cp\u003EInfiniteDice, what do you use for your animations?\u003C/p\u003E\u003Cp\u003EI stil lthink it may be tied into the throttle link.. effectively the animation is constantly playing and the position be recalculated\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI use moduleAnimateGeneric that I drive through my own code as far as I can recall, when I\u0027m home from work I\u0027ll check in detail. Like I said I have tripped 7 1200 frame duration animated parts at the same time 0 lag. Keep in mind my part has two colliders each with 6 faces, and the total part poly count is under 300.\u003C/p\u003E\u003Cp\u003ENow if you have any code checking the position of that animation, and it needs to talk back and forth with other code... it could cause lag. Straight up animation shouldn\u0027t. All it is is simple transform position data.\u003C/p\u003E\u003Cp\u003EMultiplayer games running at 30ms lag are transmitting way more than a simple transform position in 30 thousandths of a second. Not that that really has anything to do with this. But animation run times shouldn\u0027t cause lag.\u003C/p\u003E\u003Cp\u003ESome other thoughts...\u003C/p\u003E\u003Cp\u003EIf your animation is playing with anything physics it could cause lag, like altering COG or thrust position... I never thought of mentioning that before, also anything with lights or other fx...\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-05-16T18:50:11Z\u0022 title=\u002205/16/2013 06:50  PM\u0022 data-short=\u002211 yr\u0022\u003EMay 16, 2013\u003C/time\u003E by InfiniteDice\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"SasquatchM","CreatedById":11888,"CreatedDateTime":"2013-05-16T22:06:27Z","Content":"\n\u003Cp\u003EBasically the position of the throttle determines the position in the animation 50% throttle will set the animation to frame 30 out of the 60 frame animation. Basically I am using the throttle animation method from the ion engines but having the animation control rotation of a part through the animation instead of an emissive\u003C/p\u003E\n"},{"CreatedByName":"InfiniteDice","CreatedById":57451,"CreatedDateTime":"2013-05-17T17:08:29Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022SasquatchM\u0022 data-cite=\u0022SasquatchM\u0022\u003E\u003Cdiv\u003EBasically the position of the throttle determines the position in the animation 50% throttle will set the animation to frame 30 out of the 60 frame animation. Basically I am using the throttle animation method from the ion engines but having the animation control rotation of a part through the animation instead of an emissive\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003Emmm...\u003C/p\u003E\u003Cp\u003EYou might want to limit how many times it is trying to update this. It should be possible if you timed the refresh down a bit. So every second, update the position of the animation rather than 30\u002B times per second or whatever the frame rate is running at.\u003C/p\u003E\u003Cp\u003EThis would require a bit of code to function properly.\u003C/p\u003E\n"},{"CreatedByName":"SasquatchM","CreatedById":11888,"CreatedDateTime":"2013-05-17T22:01:34Z","Content":"\n\u003Cp\u003ENo idea how to do that, I just based it off of the existing module\u003C/p\u003E\n"},{"CreatedByName":"JDP","CreatedById":30775,"CreatedDateTime":"2013-05-18T07:51:27Z","Content":"\n\u003Cp\u003EAFAIK unchecking \u0022animate physics\u0022 helps a lot on framerates when you\u0027re animating objects with colliders.\u003C/p\u003E\u003Cp\u003EIt might not be that big of a lag factor any more though, since the bug of the debug spamming \u0022resetting inertial tensors\u0022 while animating colliders was removed somewhere between 0.18 and 0.19\u003C/p\u003E\n"},{"CreatedByName":"SasquatchM","CreatedById":11888,"CreatedDateTime":"2013-05-18T22:08:22Z","Content":"\n\u003Cp\u003EI\u0027ll try that and see what happens\u003C/p\u003E\n"},{"CreatedByName":"TG_bigboss","CreatedById":24189,"CreatedDateTime":"2013-05-19T06:23:37Z","Content":"\n\u003Cp\u003EI had this issue with my space capsule im working on. Found out that it was trying to animate to many parts at once. I had a hatch door with all separate parts on it like handles moving and gears and it became to complex for ksp and ended up just lagging. \u003C/p\u003E\u003Cp\u003EMoral of the stories is to combine parts so its just one solid part moving and not a parent with a bunch of children following it. If you need a picture for better explanation i will do so. Just fix your hierarchy.\u003C/p\u003E\n"},{"CreatedByName":"SasquatchM","CreatedById":11888,"CreatedDateTime":"2013-05-19T13:24:48Z","Content":"\n\u003Cp\u003EThere are just 4 separate parts moving and they can not be combined and still animated correctly\u003C/p\u003E\n"}]}