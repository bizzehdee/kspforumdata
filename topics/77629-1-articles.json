{"TopicId":77629,"ForumId":29,"TopicTitle":"Get the science value of an experiment before it is run?","CreatedByName":"WaveFunctionP","CreatedById":104784,"CreatedDateTime":"2014-07-14T19:41:19Z","PageNum":1,"Articles":[{"CreatedByName":"WaveFunctionP","CreatedById":104784,"CreatedDateTime":"2014-07-14T19:41:19Z","Content":"\n\u003Cp\u003EI\u0027m trying to do a check for an experiment\u0027s science values before the experiment is run to stop worthless science popups in my addon.\u003C/p\u003E\u003Cp\u003EI\u0027ve tried using getsciencevalue and getnextsicencevalue, but I just get some error about object state.\u003C/p\u003E\u003Cp\u003EAdditionally, how does one intact with the experiment dialog? I\u0027l like to be able to hide the results and/or condition execution based upon user input on the result page.\u003C/p\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2014-07-14T20:41:45Z","Content":"\n\u003Cp\u003EScienceAlert uses the following (experiment being a simple ResearchAndDevelopment.GetExperiment(expid)):\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Efloat CalculateNextReportValue(ScienceSubject subject, List\u0026lt;ScienceData\u0026gt; stored)\u003Cbr\u003E{\u003Cbr\u003E    if (stored.Count == 0)\u003Cbr\u003E        return ResearchAndDevelopment.GetScienceValue(experiment.baseValue * experiment.dataScale, subject);\u003Cbr\u003E\u003Cbr\u003E    float experimentValue = ResearchAndDevelopment.GetNextScienceValue(experiment.baseValue * experiment.dataScale, subject);\u003Cbr\u003E\u003Cbr\u003E    if (stored.Count == 1)\u003Cbr\u003E        return experimentValue;\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E    // for two or more, we\u0027ll have to estimate. Presumably there\u0027s some\u003Cbr\u003E    // kind of interpolation going on. I\u0027ve found that just dividing the previous\u003Cbr\u003E    // value by four is a good estimate.\u003Cbr\u003E    return experimentValue / Mathf.Pow(4f, stored.Count - 1);\u003Cbr\u003E}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EAs to the second question, I think a couple of \u003Ca href=\u0022https://github.com/DMagic1/Orbital-Science/blob/master/Source/DMBioDrill.cs#L587\u0022 rel=\u0022external nofollow\u0022\u003EDMagic\u0027s experiments\u003C/a\u003E change the results dialog callbacks and do the dialog display on their own. That\u0027d be a great place to start\u003C/p\u003E\n"},{"CreatedByName":"WaveFunctionP","CreatedById":104784,"CreatedDateTime":"2014-07-14T21:38:22Z","Content":"\n\u003Cp\u003EHmm, I\u0027ve tried that. At least, I think I\u0027m doing the same thing. I get data values of 1.5 for crew reports on the launchpad even when they have always been run. It looks like it always return the science cap. datascale returns 1, when it should be 0 for the crew report.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Evar currentScienceSubject = ResearchAndDevelopment.GetExperimentSubject(currentExperiment.experiment, currentSituation, currentBody, currentBiome);\u003Cbr\u003Evar currentScienceValue = ResearchAndDevelopment.GetScienceValue(currentExperiment.experiment.baseValue * currentExperiment.experiment.dataScale, currentScienceSubject);\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EcurrentExperiment is the current experiment module that I\u0027m checking. I run through them each time the plugin in activated or there is change in situation.\u003C/p\u003E\u003Cp\u003Eedit: nm, its not working.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-07-15T02:47:20Z\u0022 title=\u002207/15/2014 02:47  AM\u0022 data-short=\u00229 yr\u0022\u003EJuly 15, 2014\u003C/time\u003E by WaveFunctionP\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"WaveFunctionP","CreatedById":104784,"CreatedDateTime":"2014-07-15T02:48:03Z","Content":"\n\u003Cp\u003EIts not returning the proper values. I\u0027m getting the values that would be returned if the experiment had never been ran. I\u0027m looking for the number that would show up on the results dialog.\u003C/p\u003E\u003Cp\u003Eedit: I\u0027m an idiot as usual. was using getsciencevalue instead getnextsciencevalue.\u003C/p\u003E\u003Cp\u003Edoh!\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-07-15T03:10:47Z\u0022 title=\u002207/15/2014 03:10  AM\u0022 data-short=\u00229 yr\u0022\u003EJuly 15, 2014\u003C/time\u003E by WaveFunctionP\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"WaveFunctionP","CreatedById":104784,"CreatedDateTime":"2014-07-15T10:44:27Z","Content":"\n\u003Cp\u003EgetScienceValue always returns the full science value regardless of how many times you\u0027ve recovered data from that particular experiment and situation. getNextScienceData returns how much science you will get the next time you use the experiment after recovering the current value. At least, that is what is happening to me. I don\u0027t really need the actual value to be honest, simply knowing if it has been run before is good enough.\u003C/p\u003E\u003Cp\u003EIf I can\u0027t check the current experiment\u0027s value, is there a way to check the r\u0026amp;D facility for previously run experiments at least?\u003C/p\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2014-07-16T18:32:38Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022WaveFunctionP\u0022 data-cite=\u0022WaveFunctionP\u0022\u003E\u003Cdiv\u003EgetScienceValue always returns the full science value regardless of how many times you\u0027ve recovered data from that particular experiment and situation.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ENo, it returns the right value. There are a couple of less obvious things to watch out for.\u003C/p\u003E\u003Cp\u003EFirst, are you getting the subject correctly? If you\u0027re using \u003Cem\u003Ejust\u003C/em\u003E ScienceUtil.GetExperimentBiome to get the biome, that won\u0027t work if the vessel is landed on a static object like the launchpad, sph, runway, or other non-biomes that still qualify as valid locations.\u003C/p\u003E\u003Cp\u003ESecond, when are you testing the value? I say this because I spent at least 10 minutes trying to figure out why the values printed in my Start (or Awake? I forget which now) method were wrong while on the launchpad when first writing ScienceAlert. If the vessel hasn\u0027t been placed to pad yet, you might get a bogus result.\u003C/p\u003E\u003Cp\u003EHere is a snippet you can test. In a game without a crewReport recovered yet, launch a command pod. Check value while on launchpad\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Evar vessel = FlightGlobals.ActiveVessel;\u003Cbr\u003Evar situation = ScienceUtil.GetExperimentSituation(vessel);\u003Cbr\u003Evar experiment = ResearchAndDevelopment.GetExperiment(\u0022crewReport\u0022);\u003Cbr\u003Estring biome = string.Empty;\u003Cbr\u003E\u003Cbr\u003Eif (experiment.BiomeIsRelevantWhile(situation))\u003Cbr\u003E    biome = vessel.landedAt != string.Empty ? vessel.landedAt : ScienceUtil.GetExperimentBiome(vessel.mainBody, vessel.latitude, vessel.longitude);\u003Cbr\u003E\u003Cbr\u003Evar subject = ResearchAndDevelopment.GetExperimentSubject(experiment, situation, vessel.mainBody, biome);\u003Cbr\u003Efloat scienceValue = ResearchAndDevelopment.GetScienceValue(experiment.baseValue * experiment.dataScale, subject);\u003Cbr\u003E\u003Cbr\u003ELog.Write(\u0022Science Value of crewReport: {0}\u0022, scienceValue);\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EI get this:\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003E[Log]: ScienceAlert, Science Value of crewReport: 1.5\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ENow recover the pod. Launch another pod check results again. I get this:\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003E[Log]: ScienceAlert, Science Value of crewReport: 0\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EIf you just want to see if the player has gathered any science for that experiment \u002B situation \u002B biome combination at all, it\u0027s just a simple subject.science \u0026gt; 0 check\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-07-16T18:49:35Z\u0022 title=\u002207/16/2014 06:49  PM\u0022 data-short=\u00229 yr\u0022\u003EJuly 16, 2014\u003C/time\u003E by xEvilReeperx\u003C/strong\u003E\n\u003Cbr\u003EImproved snippet; now correctly handles biomeMask flag\n\u003C/span\u003E\n"},{"CreatedByName":"WaveFunctionP","CreatedById":104784,"CreatedDateTime":"2014-07-16T23:01:05Z","Content":"\n\u003Cp\u003ELooks like there is an issue with biomes. I do a running update on my vessel state, I save this state at certain points. It is how I detect transitions from one state to another. I\u0027ve added some additional logging and I\u0027ve notices utils was misreporting as you say. The good news is that your solution simplifies the search that I needed to do to find existing data on the vessel so that it is not rerun in a loop. I had been reconstructing the experiment masks by manually building a string for each possible situation mask. Now I can just do a contains check on the data and it appears to be working.\u003C/p\u003E\u003Cp\u003EIt is picking up an additional state on launch, where it thinks that the vessel is landed on shores. It still tries to return science values for invalid biomes.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E[LOG 16:34:09.192] [For Science] Vessel in new experimental situation.\u003Cbr\u003E[LOG 16:34:09.192] [For Science] Checking experiment: crewReport@KerbinInSpaceHighGrasslands\u003Cbr\u003E[LOG 16:34:09.193] [For Science] data.subjectid: barometerScan@KerbinFlyingLow\u003Cbr\u003E[LOG 16:34:09.194] [For Science] data.subjectid: atmosphereAnalysis@KerbinFlyingLowShores\u003Cbr\u003E[LOG 16:34:09.194] [For Science] data.subjectid: crewReport@KerbinFlyingHigh\u003Cbr\u003E[LOG 16:34:09.195] [For Science] data.subjectid: barometerScan@KerbinFlyingHigh\u003Cbr\u003E[LOG 16:34:09.195] [For Science] data.subjectid: temperatureScan@KerbinFlyingHigh\u003Cbr\u003E[LOG 16:34:09.196] [For Science] data.subjectid: crewReport@KerbinInSpaceLow\u003Cbr\u003E[LOG 16:34:09.197] [For Science] data.subjectid: temperatureScan@KerbinInSpaceLow\u003Cbr\u003E[LOG 16:34:09.197] [For Science] ScienceValue availible: 5\u003Cbr\u003E[LOG 16:34:09.198] [For Science] Running experiment: mk1pod (Untitled Space Craft)\u003Cbr\u003E[LOG 16:34:09.198] [Experiments]: Setting FX Modules to 1...\u003Cbr\u003E[LOG 16:34:09.199] [Experiments]: FX Modules set: 1\u003Cbr\u003E[LOG 16:34:09.200] [For Science] Checking experiment: barometerScan@KerbinInSpaceHighGrasslands\u003Cbr\u003E[LOG 16:34:09.200] [For Science] Skipping: Experiment is not available.\u003Cbr\u003E[LOG 16:34:09.201] [For Science] Checking experiment: temperatureScan@KerbinInSpaceHighGrasslands\u003Cbr\u003E[LOG 16:34:09.201] [For Science] Skipping: Experiment is not available.\u003Cbr\u003E[LOG 16:34:09.202] [For Science] Checking experiment: gravityScan@KerbinInSpaceHighGrasslands\u003Cbr\u003E[LOG 16:34:09.203] [For Science] Skipping: No more science is available.\u003Cbr\u003E[LOG 16:34:09.203] [For Science] Checking experiment: atmosphereAnalysis@KerbinInSpaceHighGrasslands\u003Cbr\u003E[LOG 16:34:09.204] [For Science] Skipping: Experiment is not available.\u003Cbr\u003E[LOG 16:34:09.239] [For Science] Tranfering science to container.\u003Cbr\u003E[LOG 16:34:09.328] [For Science] Tranfering science to container.\u003Cbr\u003E[LOG 16:34:09.329] [Experiments]: Setting FX Modules to 0...\u003Cbr\u003E[LOG 16:34:09.329] [Experiments]: FX Modules set: 0\u003Cbr\u003E[LOG 16:34:09.484] [For Science] Tranfering science to container.\u003Cbr\u003E[LOG 16:34:09.628] [For Science] Vessel in new experimental situation.\u003Cbr\u003E[LOG 16:34:09.628] [For Science] Checking experiment: crewReport@KerbinInSpaceHighShores\u003Cbr\u003E[LOG 16:34:09.629] [For Science] data.subjectid: barometerScan@KerbinFlyingLow\u003Cbr\u003E[LOG 16:34:09.630] [For Science] data.subjectid: atmosphereAnalysis@KerbinFlyingLowShores\u003Cbr\u003E[LOG 16:34:09.630] [For Science] data.subjectid: crewReport@KerbinFlyingHigh\u003Cbr\u003E[LOG 16:34:09.631] [For Science] data.subjectid: barometerScan@KerbinFlyingHigh\u003Cbr\u003E[LOG 16:34:09.631] [For Science] data.subjectid: temperatureScan@KerbinFlyingHigh\u003Cbr\u003E[LOG 16:34:09.632] [For Science] data.subjectid: crewReport@KerbinInSpaceLow\u003Cbr\u003E[LOG 16:34:09.633] [For Science] data.subjectid: temperatureScan@KerbinInSpaceLow\u003Cbr\u003E[LOG 16:34:09.633] [For Science]  Skipping: Found existing experiment data: crewReport@KerbinInSpaceHigh\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EThe data.subjectid is me searching the science container for existing experiments. the experiment mask generated by sciencesubject.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Evar currentScienceSubject = ResearchAndDevelopment.GetExperimentSubject(currentExperiment.experiment, currentSituation, currentBody, currentBiome);\u003Cbr\u003Evar currentScienceValue = ResearchAndDevelopment.GetScienceValue(currentExperiment.experiment.baseValue * currentExperiment.experiment.dataScale, currentScienceSubject);\u003Cbr\u003EDebug.Log(\u0022[For Science] Checking experiment: \u0022 \u002B currentScienceSubject.id);\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EI\u0027ve added a check for biomeisrelevant to string.empty the biome parameter for getexperimentsubject, which appears to resolve the issue of return invalid experiments. I\u0027ll need to test is more. I\u0027m not sure if I\u0027ll need to do the same for situation.\u003C/p\u003E\u003Cp\u003EThanks again, evil. I\u0027ve been banging my head on this too long. It\u0027s always something simple and thats the most frustrating part for me, because I know it. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif\u0022 alt=\u0022:P\u0022\u003E\u003C/p\u003E\n"}]}