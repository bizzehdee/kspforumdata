{"TopicId":97921,"ForumId":20,"TopicTitle":"Mod to make batteries drain on ships outside physics range.","CreatedByName":"Mulbin","CreatedById":55562,"CreatedDateTime":"2015-01-26T22:04:07Z","PageNum":1,"Articles":[{"CreatedByName":"Mulbin","CreatedById":55562,"CreatedDateTime":"2015-01-26T22:04:07Z","Content":"\n\u003Cp\u003ESo at the moment batteries don\u0027t drain on probes and ships if they are not the currently active vessel, or within 2km of the active vessel.\u003C/p\u003E\u003Cp\u003EI know asmi\u0027s life support mod fixed this but I\u0027d really like a mod that just fixes the batteries without adding O2, food etc (I already use IFLS). \u003C/p\u003E\u003Cp\u003EAny takers? Hoping its a small mod to fix a huge hole in gameplay... currently probes without solar panels have infinite power.\u003C/p\u003E\n"},{"CreatedByName":"hab136","CreatedById":75997,"CreatedDateTime":"2015-01-27T09:00:16Z","Content":"\n\u003Cp\u003EThe problem is not the batteries themselves but all the parts that drain power. You\u0027d have to change every part that consumes power, such as the probe cores.\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/98453\u0022 rel=\u0022external nofollow\u0022\u003EBackgroundProcessing\u003C/a\u003E is the closest thing I\u0027ve seen to a general-purpose solution.\u003C/p\u003E\n"},{"CreatedByName":"Mulbin","CreatedById":55562,"CreatedDateTime":"2015-01-27T12:16:21Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022hab136\u0022 data-cite=\u0022hab136\u0022\u003E\u003Cdiv\u003EThe problem is not the batteries themselves but all the parts that drain power. You\u0027d have to change every part that consumes power, such as the probe cores.\u003Cp\u003E\u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/98453\u0022 rel=\u0022external nofollow\u0022\u003EBackgroundProcessing\u003C/a\u003E is the closest thing I\u0027ve seen to a general-purpose solution.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EIs that how asmi\u0027s mod does it? It\u0027s not actually very many parts for a mod to effect... particularly if its a module. It takes minutes to write a module manager file for all pods and antennas.\u003C/p\u003E\u003Cp\u003Eno coders out there fancy tackling the module itself? Seems like a major flaw with ksp than can definitely be fixed (as mentioned its already part of asmis life support so is possible).\u003C/p\u003E\u003Cp\u003EI\u0027m happy to type out the MM file to add it to stock parts once the module exists!\u003C/p\u003E\n"},{"CreatedByName":"JDP","CreatedById":30775,"CreatedDateTime":"2015-01-30T21:26:16Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Mulbin\u0022 data-cite=\u0022Mulbin\u0022\u003E\u003Cdiv\u003E...no coders out there fancy tackling the module itself?...\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThe main problem here is that PartModules don\u0027t actually exist in unloaded vessels. The vessel itself only exists as a set of data, not much code is run. At a part and partmodule level, no code at all is run.\u003C/p\u003E\u003Cp\u003ESo for unloaded vessels you need a separate bit of code to run in the backbround and calculate changes in values such as electricCharge in batteries based on values of \u002B/- electric charge per second in probe cores, RTGs and solar panels. This is exactly what \u003Ca href=\u0022https://kerbalstuff.com/mod/302/BackgroundProcessing\u0022 rel=\u0022external nofollow\u0022\u003EBackgroundProcessing\u003C/a\u003E does.\u003C/p\u003E\u003Cp\u003EThis means that you don\u0027t need to add any modules to probe cores, RTGs and solar panels (in fact, doing so would get you nothing, since those modules would be destroyed the moment the vessel is unloaded). The plugin continuously runs in the background and takes over the power drain / generation functionality of those parts when they are unloaded.\u003C/p\u003E\u003Cp\u003EOf course you could also do it with a small plugin that remembers each vessel and how long it has been unloaded and then simply calculates the net value for electricCharge whenever a vessel gets loaded in pseudocode\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Efor each probe core:\u003Cbr\u003EnetPowerDrain = probe core power consumption per second * time since unload\u003Cbr\u003E\u003Cbr\u003Efor each RTG/solar panel\u003Cbr\u003EnetPowerGenerated = RTG/solar panel power production * time since unload\u003Cbr\u003E\u003Cbr\u003EnetPowerChange = netPowerDrain \u002B netPowerGenerated\u003Cbr\u003E\u003Cbr\u003EVesselTotalCharge = VesselTotalCharge \u002B netPowerChange\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EThis however has a few drawbacks. For example if you switch to your vessel while it is in the dark, behind a planet/moon, this method would assume that it was without sunlight the entire time and wouldn\u0027t calculate any power generated from the solar panels.\u003C/p\u003E\u003Cp\u003EAnother advantage of the way BackgroundProcessing does it, is that other mods can act on changes in unloaded vessels while they are unloaded. For example, if RemoteTech ever where to implement BackgroundProcessing, unloaded satellites could go out of power and the mod would actually know about it as it happened and remove that satellite from the relay network.\u003C/p\u003E\u003Cp\u003EHmm. That might be a good idea actually. I think I\u0027ll go implement BackgroundProcessing in RT \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 alt=\u0022:D\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"jamespicone","CreatedById":125714,"CreatedDateTime":"2015-01-31T01:59:49Z","Content":"\n\u003Cp\u003EI might just pipe in with a couple of the limitations of BackgroundProcessing as it stands at the moment:\u003C/p\u003E\u003Cp\u003E- It only handles electric charge for ModuleSolarPanels, ModuleCommands, and ModuleGenerators that have no input resources.\u003C/p\u003E\u003Cp\u003EAFAIK the only things that generates/uses electric charge and doesn\u0027t follow those rules in stock are consume-on-use like antennas, or are liquid fuel engines generating electric charge (and you can\u0027t have them on when you offload a vessel).\u003C/p\u003E\u003Cp\u003EBut this does mean that any mod you\u0027re using that adds something that generates or consumes electric charge and doesn\u0027t fit into those rules won\u0027t work. For example, a hydrogen fuel cell that consumes a hydrogen resource to produce electric charge. A scanner module that consumes charge over time to scan and doesn\u0027t do it using a ModuleGenerator that produces negative electric charge. They can be made to work, but it requires people to specifically take into account background processing, and as far as I\u0027m aware nobody does that yet.\u003C/p\u003E\u003Cp\u003E- It doesn\u0027t work for vessels that are prelaunch. This usually isn\u0027t a big deal. The reason is that vessels sometimes exist in a weird transient state when going from VAB to launchpad, and the easiest way to detect that state was to rule out all prelaunch vessels.\u003C/p\u003E\u003Cp\u003E- I\u0027ve had to essentially reimplement the resource generation code, as JDP notes above. I wouldn\u0027t be very confident it\u0027s an exact match to what Squad is doing. You may notice some differing resource consumption/generation rates backgrounded in some situations. I don\u0027t know of any off the top of my head, but I\u0027d be very surprised if they weren\u0027t there. I guess one big example is that solar panel tracking speed is ignored - I assume they\u0027ve tracked to perfect position every \u0027tick\u0027. A ship that was spinning fast enough that they couldn\u0027t do that would be an example then, I guess. Solar panels that don\u0027t have tracking don\u0027t have that behaviour, of course.\u003C/p\u003E\u003Cp\u003E- Keeping track of what partmodules are on a vessel when its been unloaded and is essentially just a ProtoVessel is a goddamn nightmare. If you\u0027ve changed your mods around with a vessel in the background, expect some stuff to not quite work right. I think I\u0027ve written defensively enough that nothing should explode, but you might, for example, end up with only some of the resource producers/consumers on the vessel being active.\u003C/p\u003E\u003Cp\u003E- I think the way I allocate resources to resource containers doesn\u0027t match what KSP does. Also I assume all resources can flow to all resource containers. That\u0027s true of electric charge, but if another mod decided to use background processing for something where that\u0027s not the case, there\u0027s a realism hole. That one is fixable, I guess, but it\u0027d be a lot of work.\u003C/p\u003E\u003Cp\u003E- BackgroundProcessing is very new, and I\u0027m quite new to KSP modding. There are almost certainly bugs I don\u0027t know about in it. JDP found one today that made background resource consumption/processing rates wrong.\u003C/p\u003E\n"}]}