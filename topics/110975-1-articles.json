{"TopicId":110975,"ForumId":29,"TopicTitle":"Pitch and Heading of Prograde vector","CreatedByName":"captncraig","CreatedById":144208,"CreatedDateTime":"2015-05-27T03:40:47Z","PageNum":1,"Articles":[{"CreatedByName":"captncraig","CreatedById":144208,"CreatedDateTime":"2015-05-27T03:40:47Z","Content":"\n\u003Cp\u003EI am wanting to make a more advanced navball that I can run in a browser for my physical console project.\u003C/p\u003E\u003Cp\u003EI am hoping to modify the navball code from \u003Ca href=\u0022https://github.com/creshal/telemachus-glass-cockpit\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/creshal/telemachus-glass-cockpit\u003C/a\u003E which is built on data from telemachus.\u003C/p\u003E\u003Cp\u003EIt is able to draw the navball by reading rawPitch, rawHeading and rawRoll from telemachus (calculated with this code: \u003Ca href=\u0022https://github.com/richardbunt/Telemachus/blob/master/Telemachus/src/DataLinkHandlers.cs#L1123\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/richardbunt/Telemachus/blob/master/Telemachus/src/DataLinkHandlers.cs#L1123\u003C/a\u003E)\u003C/p\u003E\u003Cp\u003EIn order to render prograde, retrograde, maneuver, etc.., I need to modify telemachus to give me raw pitch and heading data for those vectors.\u003C/p\u003E\u003Cp\u003EIf I take \u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E[COLOR=#333333]Vector3 prograde = this.vessel.GetObtVelocity();[/COLOR]\u003C/pre\u003E\u003Cp\u003E I get a vector in x,y,z space. That is about as far as I have gotten. I need to transform this into pitch and heading values relative to the current body in order to render them on the navball. \u003C/p\u003E\u003Cp\u003ECan anyone point me in the right direction?\u003C/p\u003E\n"},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2015-05-27T04:44:31Z","Content":"\n\u003Cp\u003ECalculate prograde pitch by the angle between prograde and \u003Ca href=\u0022https://github.com/Crzyrndm/Pilot-Assistant/blob/master/PilotAssistant/Utility/FlightData.cs#L47\u0022 rel=\u0022external nofollow\u0022\u003Esurface normal\u003C/a\u003E like \u003Ca href=\u0022https://github.com/Crzyrndm/Pilot-Assistant/blob/master/PilotAssistant/Utility/FlightData.cs#L57\u0022 rel=\u0022external nofollow\u0022\u003Ethis\u003C/a\u003E (substituting vessel.up (forward in KSP) for the prograde vector). Heading is a bit more complex, but you can also find the calculations required at that link\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-05-27T04:59:22Z\u0022 title=\u002205/27/2015 04:59  AM\u0022 data-short=\u00229 yr\u0022\u003EMay 27, 2015\u003C/time\u003E by Crzyrndm\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"captncraig","CreatedById":144208,"CreatedDateTime":"2015-05-27T18:52:58Z","Content":"\n\u003Cp\u003EI think the prograde heading is the same as the surface heading in your linked code, so thanks for that. The pitch is not working for me. I\u0027ll keep trying a few things and post my code in a bit.\u003C/p\u003E\n"},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2015-05-27T22:01:32Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022captncraig\u0022 data-cite=\u0022captncraig\u0022\u003E\u003Cdiv\u003EI think the prograde heading is the same as the surface heading in your linked code\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThey are very slightly different (surf\u003Cstrong\u003EVel\u003C/strong\u003EForward and surf\u003Cstrong\u003EVes\u003C/strong\u003EForward as the reference vector)\u003C/p\u003E\n"},{"CreatedByName":"captncraig","CreatedById":144208,"CreatedDateTime":"2015-05-28T04:19:21Z","Content":"\n\u003Cp\u003EYeah, I\u0027m having a bit of trouble with the pitch:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E[FONT=Menlo][COLOR=#009695]var [/COLOR][COLOR=#333333]planetUp[/COLOR][COLOR=#333333]=[/COLOR][COLOR=#333333]([/COLOR][COLOR=#333333]thisVessel[/COLOR][COLOR=#333333].[/COLOR][COLOR=#333333]rootPart[/COLOR][COLOR=#333333].[/COLOR][COLOR=#333333]transform[/COLOR][COLOR=#333333].[/COLOR][COLOR=#333333]position[/COLOR][COLOR=#333333]-[/COLOR][COLOR=#333333]thisVessel[/COLOR][COLOR=#333333].[/COLOR][COLOR=#333333]mainBody[/COLOR][COLOR=#333333].[/COLOR][COLOR=#333333]position[/COLOR][COLOR=#333333])[/COLOR][COLOR=#333333].[/COLOR][COLOR=#333333]normalized[/COLOR][COLOR=#333333];[/COLOR]\u003Cbr\u003E[COLOR=#009695]var [/COLOR][COLOR=#333333]pitch[/COLOR][COLOR=#333333]=[/COLOR][COLOR=#3364a4]Vector3d[/COLOR][COLOR=#333333].[/COLOR][COLOR=#333333]Angle[/COLOR][COLOR=#333333]([/COLOR][COLOR=#333333]planetUp[/COLOR][COLOR=#333333],[/COLOR][COLOR=#333333]thisVessel[/COLOR][COLOR=#333333].[/COLOR][COLOR=#333333]obt_velocity[/COLOR][COLOR=#333333].[/COLOR][COLOR=#333333]normalized[/COLOR][COLOR=#333333])[/COLOR][COLOR=#333333];[/COLOR]\u003Cbr\u003E[COLOR=#009695]return [/COLOR][COLOR=#333333]pitch[/COLOR][COLOR=#333333];[/COLOR][/FONT]\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EI would expect this to stay at or near 0 as I ascend pointing straight up. It starts at around 90 and shrinks gradually to around 11 or so degrees as I climb. This is obviously not correct. Thanks for your help. I got the heading working perfectly.\u003C/p\u003E\n"},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2015-05-28T04:21:23Z","Content":"\n\u003Cp\u003Epitch at launch would be zero relative to surface velocity, not orbital velocity (navball starts in surface mode). It starts at 90 degrees because the rotational velocity of the planet is perpendicular to the up vector, then shrinks as your vertical velocity increases.\u003C/p\u003E\n"},{"CreatedByName":"captncraig","CreatedById":144208,"CreatedDateTime":"2015-05-28T15:03:49Z","Content":"\n\u003Cp\u003EOk, that actually makes a lot of sense. I got it pretty good using surface velocity under 36000 and orbit velocity above that. \u003C/p\u003E\u003Cp\u003EIs there a table somewhere of altitudes for switching surface -\u0026gt; orbit mode for all bodies? Or even better a useful formula?\u003C/p\u003E\u003Cp\u003EThanks for all your help!\u003C/p\u003E\n"},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2015-05-28T21:46:32Z","Content":"\n\u003Cp\u003EGo by the display mode\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003EFlightUIController.speedDisplayMode\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n"}]}