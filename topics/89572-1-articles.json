{"TopicId":89572,"ForumId":29,"TopicTitle":"Is gameobject.SetActive broken?","CreatedByName":"AlphaAsh","CreatedById":105348,"CreatedDateTime":"2014-11-06T13:36:57Z","PageNum":1,"Articles":[{"CreatedByName":"AlphaAsh","CreatedById":105348,"CreatedDateTime":"2014-11-06T13:36:57Z","Content":"\n\u003Cp\u003EGleetings fellow codng type persons. I\u0027m trying to track down a bug in Kerbal Konstructs, specifically that sometimes when entering the flight scene or space center scene, third party statics fail to appear.\u003C/p\u003E\u003Cp\u003EHere\u0027s a nice chunk of code to consider:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\t\tpublic void updateCache(Vector3 playerPos)\u003Cbr\u003E\t\t{\u003Cbr\u003E\t\t\tforeach (StaticObject obj in childObjects)\u003Cbr\u003E\t\t\t{\u003Cbr\u003E\t\t\t\tfloat dist = Vector3.Distance(obj.gameObject.transform.position, playerPos);\u003Cbr\u003E\t\t\t\tDebug.Log(\u0022KK: Distance is \u0022 \u002B dist);\u003Cbr\u003E\t\t\t\tbool visible = (dist \u0026lt; (float) obj.getSetting(\u0022VisibilityRange\u0022));\u003Cbr\u003E\t\t\t\tif (visible != obj.gameObject.activeSelf)\u003Cbr\u003E\t\t\t\t{\u003Cbr\u003E\t\t\t\t\tDebug.Log(\u0022KK: Setting \u0022 \u002B obj.gameObject.name \u002B \u0022 to visible =\u0022 \u002B visible);\u003Cbr\u003E\t\t\t\t\t// obj.gameObject.renderer.renderer.enabled = true;\u003Cbr\u003E\t\t\t\t\tobj.gameObject.SetActive(visible);\u003Cbr\u003E\t\t\t\t\tDebug.Log(\u0022KK: .layer is \u0022 \u002B obj.gameObject.layer);\u003Cbr\u003E\t\t\t\t\tDebug.Log(\u0022KK: .activeInHierarchy is \u0022 \u002B obj.gameObject.activeInHierarchy);\u003Cbr\u003E\u003Cbr\u003E\t\t\t\t\t// ASH 06112014\u003Cbr\u003E\t\t\t\t\t// What if SetActive isn\u0027t actually properly activating children?\u003Cbr\u003E\t\t\t\t\tTransform[] gameObjectList = obj.gameObject.GetComponentsInChildren\u0026lt;Transform\u0026gt;();\u003Cbr\u003E\t\t\t\t\tList\u0026lt;GameObject\u0026gt; rendererList = (from t in gameObjectList where t.gameObject.renderer != null select t.gameObject).ToList();\u003Cbr\u003E\t\t\t\t\tforeach (GameObject renderer in rendererList)\u003Cbr\u003E\t\t\t\t\t{\u003Cbr\u003E\t\t\t\t\t\tDebug.Log(\u0022KK: Child renderer.visible is \u0022 \u002B renderer.renderer.isVisible);\u003Cbr\u003E\t\t\t\t\t\tDebug.Log(\u0022KK: Child renderer.enabled is \u0022 \u002B renderer.renderer.enabled);\u003Cbr\u003E\t\t\t\t\t}\u003Cbr\u003E\t\t\t\t}\u003Cbr\u003E\t\t\t}\u003Cbr\u003E\t\t}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EThe bug is difficult to reproduce but it involves hanging around a launch location and playing with the camera for a bit. Then reverting or recovering. This takes you to the space centre where the third party statics fail to appear. When the bug occurs, this suddenly decides that each gameobject doesn\u0027t have any children anymore:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003ETransform[] gameObjectList = obj.gameObject.GetComponentsInChildren\u0026lt;Transform\u0026gt;();\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EIt\u0027s almost as if all the poor little children have suddenly been disowned. It\u0027s a very inconsistent bug and I\u0027m out of ideas what to do next.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-11-06T13:57:17Z\u0022 title=\u002211/06/2014 01:57  PM\u0022 data-short=\u00229 yr\u0022\u003ENovember 6, 2014\u003C/time\u003E by AlphaAsh\u003C/strong\u003E\n\u003Cbr\u003ERemoved some redundant code that could confuse things\n\u003C/span\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2014-11-06T14:19:58Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022AlphaAsh\u0022 data-cite=\u0022AlphaAsh\u0022\u003E\u003Cdiv\u003EWhen the bug occurs, this suddenly decides that each gameobject doesn\u0027t have any children anymore:\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003ETransform[] gameObjectList = obj.gameObject.GetComponentsInChildren\u0026lt;Transform\u0026gt;();\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003EGameObject.SetActive will not enable children if they\u0027ve been disabled (activeSelf == false). The GetComponentsInChildren method you used won\u0027t return inactive components. That\u0027s probably why you think they vanished. Use the overload version\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-11-06T14:22:34Z\u0022 title=\u002211/06/2014 02:22  PM\u0022 data-short=\u00229 yr\u0022\u003ENovember 6, 2014\u003C/time\u003E by xEvilReeperx\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"AlphaAsh","CreatedById":105348,"CreatedDateTime":"2014-11-06T14:23:27Z","Content":"\n\u003Cp\u003EGotcha. So the fix looks like using the overloaded GetComponentsInChildren and then setting each child active. Sound about right?\u003C/p\u003E\u003Cp\u003EEDIT - Saw your edit. Cheers chap.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-11-06T14:27:19Z\u0022 title=\u002211/06/2014 02:27  PM\u0022 data-short=\u00229 yr\u0022\u003ENovember 6, 2014\u003C/time\u003E by AlphaAsh\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2014-11-06T14:30:31Z","Content":"\n\u003Cp\u003EThat might be a band-aid. Assuming StaticObject obj is a parent GO of a hierarchy of same-static related components like meshes, I\u0027d be wondering how the sub-GOs got disabled in the first place. You need only disable the parent to disable all children\u003C/p\u003E\n"},{"CreatedByName":"AlphaAsh","CreatedById":105348,"CreatedDateTime":"2014-11-06T14:44:00Z","Content":"\n\u003Cp\u003EThat\u0027s what\u0027s worrying me too. KK does only explicitly de-activate a parent and no-where does it purposefully de-activate children. More to the point, 99% of the time that code up there works fine. Actually reproducing the circumstances where it suddenly thinks all the children are inactive is proving problematic and therefore makes a band-aid the only thing I can think of atm.\u003C/p\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2014-11-06T14:58:39Z","Content":"\n\u003Cp\u003EWhat does this line return when the problem appears?:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003EDebug.Log(\u0022KK: .activeInHierarchy is \u0022 \u002B obj.gameObject.activeInHierarchy);\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n"},{"CreatedByName":"AlphaAsh","CreatedById":105348,"CreatedDateTime":"2014-11-06T15:51:25Z","Content":"\n\u003Cp\u003EComes back true even when the problem occurs.\u003C/p\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2014-11-06T16:43:57Z","Content":"\n\u003Cp\u003EThat torpedoes my theory, then. It\u0027s possible Squad is iterating over the GameDatabase model list and deactivating stuff themselves. Unlikely, but you could easily test it by detaching your static object model (specifically, the GO you get from GameDatabase.GetModel[in]) from its parent and possibly replacing its entry in GameDatabase.databaseModel with some fake GameObject (don\u0027t forget to DontDestroyOnLoad the fake one)\u003C/p\u003E\n"},{"CreatedByName":"AlphaAsh","CreatedById":105348,"CreatedDateTime":"2014-11-06T17:43:20Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022xEvilReeperx\u0022 data-cite=\u0022xEvilReeperx\u0022\u003E\u003Cdiv\u003EThat torpedoes my theory, then. It\u0027s possible Squad is iterating over the GameDatabase model list and deactivating stuff themselves. Unlikely, but you could easily test it by detaching your static object model (specifically, the GO you get from GameDatabase.GetModel[in]) from its parent and possibly replacing its entry in GameDatabase.databaseModel with some fake GameObject (don\u0027t forget to DontDestroyOnLoad the fake one)\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThat\u0027s a good idea. Thanks chap.\u003C/p\u003E\n"}]}