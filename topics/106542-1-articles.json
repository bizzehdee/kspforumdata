{"TopicId":106542,"ForumId":29,"TopicTitle":"this is a biggie, Where are the buildings kept in ksp and how can they be edited/replased","CreatedByName":"amankd","CreatedById":135588,"CreatedDateTime":"2015-05-01T12:04:20Z","PageNum":1,"Articles":[{"CreatedByName":"amankd","CreatedById":135588,"CreatedDateTime":"2015-05-01T12:04:20Z","Content":"\n\u003Cp\u003Espeaks for its self \u003C/p\u003E\u003Cp\u003Ep.s. #bringbackthebarn\u003C/p\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2015-05-01T16:04:40Z","Content":"\n\u003Cp\u003EI experimented with this in 0.90 but had to prioritize my time a bit so nothing ever came of it. It still works in 1.0. I\u0027m just going to barf it up in hopes it\u0027ll be useful\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E[KSPAddon(KSPAddon.Startup.MainMenu, true)]\u003Cbr\u003Epublic class Test_ChangeSpaceCenterBuildingsExternal : MonoBehaviour\u003Cbr\u003E{\u003Cbr\u003E\u003Cbr\u003E    private void Start()\u003Cbr\u003E    {\u003Cbr\u003E        Log.Debug(\u0022Testing building external changes\u0022);\u003Cbr\u003E\u003Cbr\u003E        var facility =\u003Cbr\u003E            FlightGlobals.Bodies.Where(cb =\u0026gt; cb.isHomeWorld)\u003Cbr\u003E                .SelectMany(cb =\u0026gt; cb.gameObject.GetComponentsInChildren\u0026lt;Upgradeables.UpgradeableFacility\u0026gt;(true))\u003Cbr\u003E                .FirstOrDefault(f =\u0026gt; f.id == \u0022SpaceCenter/VehicleAssemblyBuilding\u0022);\u003Cbr\u003E\u003Cbr\u003E        if (facility.IsNull()) throw new InvalidOperationException(\u0022facility\u0022);\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E        Log.Normal(\u0022UpgradeableFacility:\u0022);\u003Cbr\u003E        facility.gameObject.PrintComponents();\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E        var model = GameDatabase.Instance.databaseModel.Find(\u003Cbr\u003E            go =\u0026gt; go.name == \u0022BuildYourOwnSpaceCenter/structures/TestCube/TestCube\u0022);\u003Cbr\u003E\u003Cbr\u003E        if (model == null) Log.Error(\u0022failed to find model!\u0022);\u003Cbr\u003E        model.AddComponent\u0026lt;TestScale\u0026gt;();\u003Cbr\u003E        model.AddComponent\u0026lt;CrashObjectName\u0026gt;().objectName = \u0022That ugly box\u0022;\u003Cbr\u003E        model.SetLayerRecursive(15);\u003Cbr\u003E        model.SetActive(true);\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E        model.transform.parent = facility.GetUpgradeLevels()[0].facilityPrefab.transform;\u003Cbr\u003E        model.transform.localPosition = Vector3.zero;\u003Cbr\u003E\u003Cbr\u003E        DontDestroyOnLoad(model);\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E        var uft = facility.gameObject.AddComponent\u0026lt;UpgradeableFacilityTweakable\u0026gt;();\u003Cbr\u003E        uft.ImpersonateFacility(facility);\u003Cbr\u003E        uft.SetPrefab(0, model);\u003Cbr\u003E\u003Cbr\u003E        Destroy(facility);\u003Cbr\u003E    }\u003Cbr\u003E}\u003Cbr\u003Eclass UpgradeableFacilityTweakable : UpgradeableFacility\u003Cbr\u003E{\u003Cbr\u003E    public void ImpersonateFacility(UpgradeableFacility target)\u003Cbr\u003E    {\u003Cbr\u003E        upgradeLevels = target.GetUpgradeLevels();\u003Cbr\u003E        facilityTransform = target.GetFacilityTransform();\u003Cbr\u003E\u003Cbr\u003E        setup = false;\u003Cbr\u003E        preCompiledId = true;\u003Cbr\u003E        id = target.id;\u003Cbr\u003E        facilityLevel = target.FacilityLevel;\u003Cbr\u003E\u003Cbr\u003E        SetupLevels();\u003Cbr\u003E\u003Cbr\u003E        for (int i = 0; i \u0026lt; upgradeLevels.Length; \u002B\u002Bi)\u003Cbr\u003E            upgradeLevels[i].levelCost = 1000f * i;\u003Cbr\u003E\u003Cbr\u003E    }\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E    public void SetPrefab(int level, GameObject prefab)\u003Cbr\u003E    {\u003Cbr\u003E        upgradeLevels[level].facilityPrefab = prefab;\u003Cbr\u003E        setup = false;\u003Cbr\u003E        SetupLevels();\u003Cbr\u003E    }\u003Cbr\u003E}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EThose are the main pieces. The interiors are simpler (you can just swap the model right out). Not a complete solution (the structure can\u0027t be destroyed -- haven\u0027t investigated that yet) but should jumpstart anyone willing to make the effort\u003C/p\u003E\n"}]}