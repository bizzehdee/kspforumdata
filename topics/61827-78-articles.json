{"TopicId":61827,"ForumId":34,"TopicTitle":"[1.3] kOS Scriptable Autopilot System v1.1.3.0","CreatedByName":"erendrake","CreatedById":57164,"CreatedDateTime":"2014-02-01T16:40:58Z","PageNum":78,"Articles":[{"CreatedByName":"GabeTeuton","CreatedById":116756,"CreatedDateTime":"2014-11-03T21:32:54Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Steven Mading\u0022 data-cite=\u0022Steven Mading\u0022\u003E\u003Cdiv\u003EWhile that can be a problem, in this case even if that wasn\u0027t happening it\u0027s STILL a bad idea for @GabeTeuton to be checking for exactly zero. Because even without the artificial artifact of computer floating point precision problems, in the *real* world you\u0027re not going to get the system that accurate.\u003Cp\u003EGabe, imagine this: you work as a general errand runner and gopher in a chemistry lab where your boss has said, \u0022I\u0027m cooling this down until it\u0027s 30 degrees, then we can start. Your instructions are to look at this digital thermometer and tell me when it says the temperature is exactly 30 degrees.\u0022 You say \u0022okay, will do!\u0022\u003C/p\u003E\u003Cp\u003EThen you look at it and it says 35.21301.. then 34.2411... then 32.21623.. then 31.01835, then 30.51821, then 30.201262, then 30.013011, then 30.003151, then 30.000045, then 30.00010, then 29.99912, then 29.999941. then 30.00004, then 29.999910. then 30.00004, then 30.000012, then 29.99919.... etc.\u003C/p\u003E\u003Cp\u003EAt what point should you say \u0022okay that\u0027s close enough to 30 degrees that it counts? It\u0027s clearly unable to hold it at exactly 30 to more than about 0.001 accuracy.\u0022?\u003C/p\u003E\u003Cp\u003EThis is the problem with what you\u0027re doing. Even in the real world an autopilot cannot possibly get the climb rate as accurate as you\u0027re looking for here. It will inevitibly waver a bit above and below the desired number. Your job is to ensure that it wavers around that point by as small a margin as possible, not to do the impossible and make it stick to it so precisely that it\u0027s accurate up to 12 significant digits. That\u0027s utterly impossible.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003E(currently i\u0027m away from my computer so development stopped until tomorrow morning/afternoon)... I see your point, once again I\u0027m kind of amazed with what you present me, in a good way of course... (this way of thinking about it evaded me until now) So based on your thoughts and the fact that there is no workaround to such a true fact, i guess i will abandon this iteration and go back to the previous one, to try and make it wobble less, first i\u0027ll try to replicate the first iteration, in which the user had to adjust the value, i\u0027ll start by making that more precise, and then jump to the other iteration, the one that kind of automatically \u0022maintained\u0022 altitude with a small margin of error, and try to make that margin even smaller i was also suggested by a pm to make a PID controller instead of what i\u0027m trying to do, i\u0027ll check what that has to offer aswell...\u003C/p\u003E\u003Cp\u003Ethanks guys!\u003C/p\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2014-11-03T22:50:33Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022GabeTeuton\u0022 data-cite=\u0022GabeTeuton\u0022\u003E\u003Cdiv\u003E(currently i\u0027m away from my computer so development stopped until tomorrow morning/afternoon)... I see your point, once again I\u0027m kind of amazed with what you present me, in a good way of course... (this way of thinking about it evaded me until now) So based on your thoughts and the fact that there is no workaround to such a true fact, i guess i will abandon this iteration and go back to the previous one, to try and make it wobble less, first i\u0027ll try to replicate the first iteration, in which the user had to adjust the value, i\u0027ll start by making that more precise, and then jump to the other iteration, the one that kind of automatically \u0022maintained\u0022 altitude with a small margin of error, and try to make that margin even smaller i was also suggested by a pm to make a PID controller instead of what i\u0027m trying to do, i\u0027ll check what that has to offer aswell...\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThe general case solution is start by thinking this way:\u003C/p\u003E\u003Cp\u003E\u0022The amount by which I choose to push the controls to move toward my target number should depend on how far off I am from my target number.\u0022 If you are near the desired number, push less. If you are far away from it, push more. \u003C/p\u003E\u003Cp\u003EThat, is basically a P controller - positional only. In your case it would mean \u0022push more the farther from the programmed altitude I am\u0022.\u003C/p\u003E\u003Cp\u003EThen if that\u0027s not good enough then you add current velocity to the calculation. \u0022The amount by which I choose to push the controls to move toward my target number should depend on BOTH how far off I am AND my current velocity toward the desired number.\u0022 (my current climb rate). It depends on both current altitude AND the difference between current altitude and previous altitude (vertical speed).\u003C/p\u003E\u003Cp\u003EThen if THAT\u0027s not good enough, then you take the derivative of THAT and keep trying again, now take into account Position (altitude), AND Velocity (vertical velocity), AND Accelleration (change to vertical velocity), and so on.\u003C/p\u003E\u003Cp\u003EIt\u0027s how you keep dampening the oscillations more and more given that your computer isn\u0027t capable of doing its work with perfect instantaneous response.\u003C/p\u003E\u003Cp\u003EAnd that, in a nutshell, is what a PID controller is trying to do, although the fact that this is what it\u0027s trying to do is a bit hidden behind some confusing math terminology, but in a nutshell, it\u0027s what I described above. To control phenomenon X, remember the previous few measurements of X and you can get a crude approximation of the deltas of that phenomenon over the previous timestep, and therefore a crude approximation of the current derivatives of the phenomenon. For example the derivative, the approximate change in X over the last timestep is ((Current X minus previous X) / delta time ). You can get the change in the change in X (second derivative) by remembering the previously calculated first derivative and compare how IT changed in that delta time. Of course, the accuracy of these goes up the shorter the delta time is.\u003C/p\u003E\u003Cp\u003EBy using all this information together you can help make a much smoother control of your ship that wobbles and oscillates less.\u003C/p\u003E\n"},{"CreatedByName":"GabeTeuton","CreatedById":116756,"CreatedDateTime":"2014-11-03T23:25:36Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Steven Mading\u0022 data-cite=\u0022Steven Mading\u0022\u003E\u003Cdiv\u003EThe general case solution is start by thinking this way:\u003Cp\u003E\u0022The amount by which I choose to push the controls to move toward my target number should depend on how far off I am from my target number.\u0022 If you are near the desired number, push less. If you are far away from it, push more. \u003C/p\u003E\u003Cp\u003EThat, is basically a P controller - positional only. In your case it would mean \u0022push more the farther from the programmed altitude I am\u0022.\u003C/p\u003E\u003Cp\u003EThen if that\u0027s not good enough then you add current velocity to the calculation. \u0022The amount by which I choose to push the controls to move toward my target number should depend on BOTH how far off I am AND my current velocity toward the desired number.\u0022 (my current climb rate). It depends on both current altitude AND the difference between current altitude and previous altitude (vertical speed).\u003C/p\u003E\u003Cp\u003EThen if THAT\u0027s not good enough, then you take the derivative of THAT and keep trying again, now take into account Position (altitude), AND Velocity (vertical velocity), AND Accelleration (change to vertical velocity), and so on.\u003C/p\u003E\u003Cp\u003EIt\u0027s how you keep dampening the oscillations more and more given that your computer isn\u0027t capable of doing its work with perfect instantaneous response.\u003C/p\u003E\u003Cp\u003EAnd that, in a nutshell, is what a PID controller is trying to do, although the fact that this is what it\u0027s trying to do is a bit hidden behind some confusing math terminology, but in a nutshell, it\u0027s what I described above. To control phenomenon X, remember the previous few measurements of X and you can get a crude approximation of the deltas of that phenomenon over the previous timestep, and therefore a crude approximation of the current derivatives of the phenomenon. For example the derivative, the approximate change in X over the last timestep is ((Current X minus previous X) / delta time ). You can get the change in the change in X (second derivative) by remembering the previously calculated first derivative and compare how IT changed in that delta time. Of course, the accuracy of these goes up the shorter the delta time is.\u003C/p\u003E\u003Cp\u003EBy using all this information together you can help make a much smoother control of your ship that wobbles and oscillates less.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI always liked math, used to love the derivatives calculation, numerical integration, of course after years without practising it, (and the fact that i\u0027m kind of away from my degree [i mean i\u0027m not attending to university as usually as i should], as well as the fact that my career is not that related with hard math, being business management), i\u0027m kind of rusty in that matter... but till today those calculations still amaze and amuse me... And what you say once again is logical...\u003C/p\u003E\u003Cp\u003EOne question i wanted to ask since a long time ago, and didn\u0027t ask, is=\u003C/p\u003E\u003Cp\u003Ecan i set a condition for a number to be in between 2 numbers? like\u003C/p\u003E\u003Cp\u003Ethis is just an example of what i mean, not sure if it works and currently i can\u0027t test it, but i read on the docs that AND and OR is a possibility, though i didn\u0027t find much in terms of its usage...\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003ESET P TO 0.\u003Cbr\u003EIF P \u0026lt; 500 AND P \u0026gt; 400 THEN { PRINT \u0022P IS MORE THAN 400 AND LESS THAN 500\u0022 AT (0,0).\u003Cbr\u003EUNTIL P = 1000 { SET P TO P \u002B 1. WAIT 5. }.\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EI believe if this is possible i can narrow down the wobbling by setting a margin for both below and above of desired altitude, using also what you just added in the quoted comment to change the step size the closer you are to the target.\u003C/p\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2014-11-04T01:21:16Z","Content":"\n\u003Cp\u003EAND and OR work exactly as you expect. You can chain together any long number of conditions like that.\u003C/p\u003E\u003Cp\u003EThe only thing to remember is that when there\u0027s a chain of AND and OR conditions, the default is to assume all the ANDs happen before all the ORs. (AND is analagous to multiplication and OR is analagous to addition, in the sense that 1\u002B4*5 means \u0022do 4*5 first, then do \u002B1 to that\u0022, just like A OR B AND C means \u0022do B and C first, then \u0027OR\u0027 that with A\u0022.)\u003C/p\u003E\u003Cp\u003EYou can always override this with explicit parentheses, like so: (A OR \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_cool.png\u0022 alt=\u0022B)\u0022\u003E AND C \u003C/p\u003E\u003Cp\u003EThe reason for this nomenclature comes from the original concept of Boolean algebra, which preceeds the invention of computers by quite a bit. (Boolean algebra was published in 1847 as just a quirky way to mathematically express the language of logic. It was mostly ignored as just an interesting mathematical footnote until the invention of computers revived it to being quite useful.)\u003C/p\u003E\u003Cp\u003EIn Boolean algebra, you express the concept of \u0022true\u0022 with \u0022any number that isn\u0027t zero\u0022 (usually \u00271\u0027 but it doesn\u0027t have to be) and you express the concept of \u0022false\u0022 with zero.\u003C/p\u003E\u003Cp\u003EThen the rules of logic end up mapping exactly one-to-one with rules of algebra in a nice clean way when you do this, which is why the idea got a big boost when computers arrived, as it provided a way to map statements of logic into mathematical operations a computer can do.\u003C/p\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2014-11-04T01:26:44Z","Content":"\n\u003Cp\u003EIMO, for working with numbers within an epsilon tolerance it occurs to me that it would be a very useful shorthand for kOS to supply people with a function that works like so:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Eif WITHIN( x, 5.0, 0.1) { stuff }.\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EWhich means \u0022is x nearly 5.0, within a tolerance of plus or minus 0.1?\u0022, and would be the same as this:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Eif x \u0026gt;= (5.0-0.1) and x \u0026lt;= (5.0\u002B0.1) { stuff }.\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n"},{"CreatedByName":"GabeTeuton","CreatedById":116756,"CreatedDateTime":"2014-11-04T01:36:21Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Steven Mading\u0022 data-cite=\u0022Steven Mading\u0022\u003E\u003Cdiv\u003EIMO, for working with numbers within an epsilon tolerance it occurs to me that it would be a very useful shorthand for kOS to supply people with a function that works like so:\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Eif WITHIN( x, 5.0, 0.1) { stuff }.\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EWhich means \u0022is x nearly 5.0, within a tolerance of plus or minus 0.1?\u0022, and would be the same as this:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Eif x \u0026gt;= (5.0-0.1) and x \u0026lt;= (5.0\u002B0.1) { stuff }.\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI agree, good idea. Though this addition shouldn\u0027t remove the option of doing it both ways.-\u003C/p\u003E\n"},{"CreatedByName":"Cairan","CreatedById":85361,"CreatedDateTime":"2014-11-04T02:29:20Z","Content":"\n\u003Cp\u003EOne word: deadband.\u003C/p\u003E\u003Cp\u003EWhat you are describing with a tolerance margin is what we call a deadband, a zone where no further corrections are made but we keep an eye on the error trend.. if delta-error increases, it means you are starting to drift out ofyour deadband...\u003C/p\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2014-11-04T02:46:13Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Cairan\u0022 data-cite=\u0022Cairan\u0022\u003E\u003Cdiv\u003EOne word: deadband.\u003Cp\u003EWhat you are describing with a tolerance margin is what we call a deadband, a zone where no further corrections are made but we keep an eye on the error trend.. if delta-error increases, it means you are starting to drift out ofyour deadband...\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EBut that\u0027s waay too specific of a term that only applies to one use of it. I\u0027m just referring to the very generic test of \u0022is X within plus or minus Y of Z?\u0022, which can be done with ANDed conditions but it gets wordy and ugly after a bit and it\u0027s such a commonly needed operation that it makes sense to make it a function. It\u0027s a bit like MIN or MAX. It\u0027s trivially easy to write code that does the same thing with an if condition, but it gets wordy and makes the visual flow more clunky than just having a shorthand function for it.\u003C/p\u003E\n"},{"CreatedByName":"Camacha","CreatedById":59088,"CreatedDateTime":"2014-11-04T02:56:33Z","Content":"\n\u003Cp\u003EThat might be useful for mitigating noise in PID-controllers.\u003C/p\u003E\n"},{"CreatedByName":"Lorentz","CreatedById":123879,"CreatedDateTime":"2014-11-04T14:55:03Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Steven Mading\u0022 data-cite=\u0022Steven Mading\u0022\u003E\u003Cdiv\u003EIMO, for working with numbers within an epsilon tolerance it occurs to me that it would be a very useful shorthand for kOS to supply people with a function that works like so:\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Eif WITHIN( x, 5.0, 0.1) { stuff }.\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EWhich means \u0022is x nearly 5.0, within a tolerance of plus or minus 0.1?\u0022, and would be the same as this:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Eif x \u0026gt;= (5.0-0.1) and x \u0026lt;= (5.0\u002B0.1) { stuff }.\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI prefer this (pythonic) way if possible:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003EIF 4.9 \u0026lt; x \u0026lt; 5.1 { stuff. }\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EHowever, its pretty easy just to do this:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003EIF ABS(x - 5.0) \u0026lt; 0.1 { stuff. }\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n"},{"CreatedByName":"Hitokiri","CreatedById":85627,"CreatedDateTime":"2014-11-04T22:42:26Z","Content":"\n\u003Cp\u003EHi, anyone have idea why LOCK STEERING TO Heading (90,20) in atmosphere cause that roll control is oscillating?\u003C/p\u003E\n"},{"CreatedByName":"erendrake","CreatedById":57164,"CreatedDateTime":"2014-11-04T23:11:16Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Hitokiri\u0022 data-cite=\u0022Hitokiri\u0022\u003E\u003Cdiv\u003EHi, anyone have idea why LOCK STEERING TO Heading (90,20) in atmosphere cause that roll control is oscillating?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThe design of LOCK STEERING is to be a very basic algorithm that will get you more or less in the right direction. If you want finer control you can always use the raw controls \u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022http://ksp-kos.github.io/KOS_DOC/summary_topics/ship_control/index.html\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://ksp-kos.github.io/KOS_DOC/summary_topics/ship_control/index.html\u003C/a\u003E\u003C/p\u003E\n"},{"CreatedByName":"Hitokiri","CreatedById":85627,"CreatedDateTime":"2014-11-04T23:31:59Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022erendrake\u0022 data-cite=\u0022erendrake\u0022\u003E\u003Cdiv\u003EThe design of LOCK STEERING is to be a very basic algorithm that will get you more or less in the right direction. If you want finer control you can always use the raw controls \u003Cp\u003E\u003Ca href=\u0022http://ksp-kos.github.io/KOS_DOC/summary_topics/ship_control/index.html\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://ksp-kos.github.io/KOS_DOC/summary_topics/ship_control/index.html\u003C/a\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EWell, I read the most of documentation for KOS on github and my \u0022feeling\u0022 was that \u0022cooked\u0022 control was somehow preferred. (well the article about control starts with them, right?)\u003C/p\u003E\u003Cp\u003EIs there any tutorial how to use raw control? For example I can see that both Mechjeb and \u0022cooked\u0022 control in KOS will actually keep pitch to 1.0 in order to fly desired 20\u00C3\u201A\u00C2\u00B0 in high atmosphere supersonic flight (1300m/s @ 20k). So I assume that I have to write some subroutine that will actually change the Pitch inflight to keep desired heading...\u003C/p\u003E\n"},{"CreatedByName":"Cairan","CreatedById":85361,"CreatedDateTime":"2014-11-04T23:52:04Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Lorentz\u0022 data-cite=\u0022Lorentz\u0022\u003E\u003Cdiv\u003EI prefer this (pythonic) way if possible:\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003EIF 4.9 \u0026lt; x \u0026lt; 5.1 { stuff. }\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EHowever, its pretty easy just to do this:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003EIF ABS(x - 5.0) \u0026lt; 0.1 { stuff. }\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EAlbeit I do most of my paid-for coding in Python nowadays, I have to look at the overall feel of kOS syntax, I prefer the second implementation...\u003C/p\u003E\u003Cp\u003EWhile we are discussing new instructions (WITHIN), I\u0027d like to request a TIMER/SLEEP function in kOS... Most probes nowadays include a deep-sleep mode in which only the RTC and a couple of keepalive circuits are powered, and the rest of the probe is powered off... Most surface probes to Mars, Titan\u0027s Huygens, Pluto\u0027s New Horizons, are programmed with a timer which wakes up just before critical events are to be handled. No triggers (ON, WAIT, etc.) would be enabled during such a deep sleep mode.\u003C/p\u003E\u003Cp\u003ESay I launch a probe to Duna but I don\u0027t want to consume any power from a fuel cell on my way there:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003EUNTIL ENCOUNTER:NAME = \u0022Duna\u0022 {\u003Cbr\u003E... // Probe stuff goes here before we get in the cruise phase...\u003Cbr\u003E}\u003Cbr\u003ESLEEP ETA:TRANSITION. // Basically SHUTDOWN but with a restore of operation when we transition to another SOI...\u003Cbr\u003ERUN LanderProg. // Here we run the lander script much later only when we get in the SOI of Duna...\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EAnother use would be to save power during the Munar night:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003EWHEN SunElev \u0026lt; 0 { // When the sun sets below the horizon... Could very well be based on power drain threshold instead...\u003Cbr\u003E  LOCK WHEELTHROTTLE TO 0. \u003Cbr\u003E  SAS OFF.\u003Cbr\u003E  LIGHTS OFF.\u003Cbr\u003E  BRAKES ON.\u003Cbr\u003E  // ...other power saving actions here... ie. action groups triggers to shutdown instruments, etc.\u003Cbr\u003E  SLEEP 69492. // Half of Mun\u0027s rotation period, ie. from sunset to sunrise... the kOS CPU will resume the script when it wakes up at that time...\u003Cbr\u003E  SAS ON.\u003Cbr\u003E  LIGHTS ON.\u003Cbr\u003E  BRAKES OFF.\u003Cbr\u003E  // ... actions to resume science, processing, other operations...\u003Cbr\u003E  PRESERVE.\u003Cbr\u003E}.\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EJust to emphasize before I log off, this is \u003Cstrong\u003Enot\u003C/strong\u003E the same as the existing WAIT instruction. It is an hybrid of WAIT with SHUTDOWN... The power consumption of the kOS CPU could be set to 0 or some very small value while in the SLEEP mode. Both the Apollo AGC and the STS GPCs had such power saving CPU instructions.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-11-05T00:51:12Z\u0022 title=\u002211/05/2014 12:51  AM\u0022 data-short=\u00229 yr\u0022\u003ENovember 5, 2014\u003C/time\u003E by Cairan\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Trewor007","CreatedById":101021,"CreatedDateTime":"2014-11-05T07:40:38Z","Content":"\n\u003Cp\u003EHow can i check the current phase angle? There is tons of info how to calculate it for a transfer, but nothing about my current kerbin-duna phase angle.\u003C/p\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2014-11-05T08:59:07Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Trewor007\u0022 data-cite=\u0022Trewor007\u0022\u003E\u003Cdiv\u003EHow can i check the current phase angle? There is tons of info how to calculate it for a transfer, but nothing about my current kerbin-duna phase angle.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYou can get the following 3 positions in space:\u003C/p\u003E\u003Cp\u003EKerbin:Position\u003C/p\u003E\u003Cp\u003ESun:Position\u003C/p\u003E\u003Cp\u003EDuna:Position\u003C/p\u003E\u003Cp\u003ENow you\u0027ve got 3 points in space you can use to form the angle, and calculate it.\u003C/p\u003E\n"},{"CreatedByName":"madlemur","CreatedById":116597,"CreatedDateTime":"2014-11-05T16:30:52Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Steven Mading\u0022 data-cite=\u0022Steven Mading\u0022\u003E\u003Cdiv\u003EYou can get the following 3 positions in space:\u003Cp\u003EKerbin:Position\u003C/p\u003E\u003Cp\u003ESun:Position\u003C/p\u003E\u003Cp\u003EDuna:Position\u003C/p\u003E\u003Cp\u003ENow you\u0027ve got 3 points in space you can use to form the angle, and calculate it.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EHmmm... If we could just write our own functions... \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif\u0022 alt=\u0022;)\u0022\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-11-05T17:09:32Z\u0022 title=\u002211/05/2014 05:09  PM\u0022 data-short=\u00229 yr\u0022\u003ENovember 5, 2014\u003C/time\u003E by madlemur\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Trewor007","CreatedById":101021,"CreatedDateTime":"2014-11-05T17:35:36Z","Content":"\n\u003Cp\u003E\u003Cstrong\u003E Steven Mading\u003C/strong\u003E thanks! that was way more easy than my method, now my code is 50% time correct (and that\u0027s 49% increasement in accuracy). now I just need to figure out, a condition to tell apart when duna is behind and when in front of me.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022madlemur\u0022 data-cite=\u0022madlemur\u0022\u003E\u003Cdiv\u003E\u003Cp\u003EHmmm... If we could just write our own functions... \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif\u0022 alt=\u0022;)\u0022\u003E\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EWho needs functions when we have vectors \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif\u0022 alt=\u0022:P\u0022\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-11-05T17:40:32Z\u0022 title=\u002211/05/2014 05:40  PM\u0022 data-short=\u00229 yr\u0022\u003ENovember 5, 2014\u003C/time\u003E by Trewor007\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"SnappingTurtle","CreatedById":69795,"CreatedDateTime":"2014-11-05T19:23:45Z","Content":"\n\u003Cp\u003ECouple questions.\u003C/p\u003E\u003Cp\u003EIs there a command to quit a script?\u003C/p\u003E\u003Cp\u003EIs there a way to get the position of a part?\u003C/p\u003E\u003Cp\u003EAnd is there a way to tell what type the selected target is?\u003C/p\u003E\u003Cp\u003EAlso a sign function for the math lib would be nice \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-11-05T19:29:27Z\u0022 title=\u002211/05/2014 07:29  PM\u0022 data-short=\u00229 yr\u0022\u003ENovember 5, 2014\u003C/time\u003E by SnappingTurtle\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2014-11-05T19:28:45Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Trewor007\u0022 data-cite=\u0022Trewor007\u0022\u003E\u003Cdiv\u003E\u003Cstrong\u003E Steven Mading\u003C/strong\u003E thanks! that was way more easy than my method, now my code is 50% time correct (and that\u0027s 49% increasement in accuracy). now I just need to figure out, a condition to tell apart when duna is behind and when in front of me.\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EA normal vector of Kerbin\u0027s orbit plane:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Eset posKerbinFromSun to (kerbin:position - sun:position).\u003Cbr\u003Eset velKerbinFromSun to (kerbin:velocity:orbit - sun:velocity:orbit).\u003Cbr\u003Eset normKerbinOrbit to VCRS( velKerbinFromSun, posKerbinFromSun ).\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EA cross product of the position vectors kerbin-to-sun and kerbin-to-duna:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Eset posDunaFromKerbin to (duna:position - kerbin:position).\u003Cbr\u003Eset crossSunKerbinDuna to VCRS( (-1)*posKerbinFromSun, posDunaFromKerbin ).\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EIf Duna is ahead of Kerbin, the direction of the two cross products should be mostly the same.\u003C/p\u003E\u003Cp\u003EIf Duna is behind Kerbin, the direction of the two cross products should be mostly opposed.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Eset crossesAngle to VANG(normKerbinOrbit,crossSunKerbinDuna).\u003Cbr\u003Eif cos(crossesAngle) \u0026gt; 0 {\u003Cbr\u003E  print \u0022test: Duna is ahead of Kerbin\u0022.\u003Cbr\u003E} else {\u003Cbr\u003E  print \u0022test: Duna is behind Kerbin\u0022.\u003Cbr\u003E}.\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EI am doing this by picturing the vectors in my head and not testing it, so I might have the signs flipped. Give it a try. It should either be 100% right or 100% backward.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-11-05T20:05:22Z\u0022 title=\u002211/05/2014 08:05  PM\u0022 data-short=\u00229 yr\u0022\u003ENovember 5, 2014\u003C/time\u003E by Steven Mading\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2014-11-05T19:34:33Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022SnappingTurtle\u0022 data-cite=\u0022SnappingTurtle\u0022\u003E\u003Cdiv\u003ECouple questions.\u003Cp\u003EIs there a command to quit a script?\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ENo. There should be. It\u0027s sort of tied into how we\u0027ll eventually do functions though, and the relationship between an \u0022exit\u0022 and a \u0022return\u0022 should probably be established, and of course does \u0022exit\u0022 just quit the current RUN SCRIPTNAME or does it kill all the way to the interactive prompt?\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003E\u003Cp\u003EIs there a way to get the position of a part?\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYes .... but see here: \u003Ca href=\u0022https://github.com/KSP-KOS/KOS/issues/277\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/KSP-KOS/KOS/issues/277\u003C/a\u003E\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003E\u003Cp\u003EAnd is there a way to tell what type the selected target is?\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EIMO all objects should be able to print their KOS type. They curently can\u0027t because they aren\u0027t all wrapped inside a suffix-able type. Hmm... changing that would be a really good idea for the future.\u003C/p\u003E\n"},{"CreatedByName":"Trewor007","CreatedById":101021,"CreatedDateTime":"2014-11-05T19:40:13Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003EIs there a command to quit a script?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYes there is. \u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003EIs there a way to get the position of a part?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003Ethat depends.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003EAnd is there a way to tell what type the selected target is?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EGood question, not very specific but good.\u003C/p\u003E\u003Cp\u003EIf U R using a loop just use \u0022break.\u0022 if not use REBOOT or SHUTDOWN.\u003C/p\u003E\u003Cp\u003Eif it comes just to the facing of the part: \u003Ca href=\u0022http://ksp-kos.github.io/KOS_DOC/structure/part/index.html\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://ksp-kos.github.io/KOS_DOC/structure/part/index.html\u003C/a\u003E but if U want its position in the ship than probably no. (i have no idea really).\u003C/p\u003E\u003Cp\u003Ekos has hard coded names of the planets so its kinda see the difference between planet and a ship. however difference between a rover and a probe is, a no no.\u003C/p\u003E\n"},{"CreatedByName":"SnappingTurtle","CreatedById":69795,"CreatedDateTime":"2014-11-05T19:46:45Z","Content":"\n\u003Cp\u003EThanks for the replies. I\u0027m trying to write a script to dock with a target. Is this something that would have to wait for future updates?\u003C/p\u003E\u003Cp\u003EAlso is there a ternary operator like in C?\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-11-05T19:50:49Z\u0022 title=\u002211/05/2014 07:50  PM\u0022 data-short=\u00229 yr\u0022\u003ENovember 5, 2014\u003C/time\u003E by SnappingTurtle\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2014-11-05T20:11:22Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022SnappingTurtle\u0022 data-cite=\u0022SnappingTurtle\u0022\u003E\u003Cdiv\u003EThanks for the replies. I\u0027m trying to write a script to dock with a target. Is this something that would have to wait for future updates?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EIt\u0027s doable now, but the problem is that there isn\u0027t a good way to SET TARGET TO the docking port, just the vessel in general. So as long as your target docking port is aligned with the vessel\u0027s center of mass, you can sort of do it. But if it\u0027s offcenter it\u0027s a bit harder.\u003C/p\u003E\u003Cp\u003EThe big problem you\u0027ll encounter is that if you have the docking port in a variable, the position it returns to you is currently unusable because of this: \u003Ca href=\u0022https://github.com/KSP-KOS/KOS/issues/277\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/KSP-KOS/KOS/issues/277\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EI did have some success with a docking script, but it has to assume the target\u0027s docking port is aligned to its center of mass for now.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003E\u003Cp\u003EAlso is there a ternary operator like in C?\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EDo you mean \u0022X = cond ? val1 : val2\u0022 ? Not currently. It would be possible, though, if there\u0027s enough interest in it.\u003C/p\u003E\n"},{"CreatedByName":"Trewor007","CreatedById":101021,"CreatedDateTime":"2014-11-05T20:24:03Z","Content":"\n\u003Cp\u003E\u003Cstrong\u003ESnappingTurtle\u003C/strong\u003E Ive remember seeing on youtube docking with KOS. So You can try. a ternary operator? Nope ( but not 100% sure).\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003ESteven Mading\u003C/strong\u003E\u003C/p\u003E\u003Cp\u003EI donk know why but my KOS is protesting at this line;/\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Eset velKerbinFromSun to (kerbin:velocity:orbit - sun:velocity:orbit).\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EIts probably a glitch on my ksp side (I\u0027ve used :velocity:orbit literally yesterday).\u003C/p\u003E\u003Cp\u003EI\u0027ve done it, a little bit different ( read as: its more code, and its a mess.), in relation to sun position the plane is divided in 4 squares and im checking in witch one is kerbin and duna at one time. that\u0027s a lot of combinations but its working for now.\u003C/p\u003E\n"}]}