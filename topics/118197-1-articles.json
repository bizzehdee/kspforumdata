{"TopicId":118197,"ForumId":70,"TopicTitle":"comprehensive RAM testing points to 2 mods w/ large RAM use increase from 0.90","CreatedByName":"Drew Kerman","CreatedById":103177,"CreatedDateTime":"2015-08-11T11:57:35Z","PageNum":1,"Articles":[{"CreatedByName":"Drew Kerman","CreatedById":103177,"CreatedDateTime":"2015-08-11T11:57:35Z","Content":"\n\u003Cp\u003EThe thread was originally looking to figure out why I had such a nasty increase in RAM usage from 0.90 with 1.0.4 under similar installation conditions. \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/131251-Any-ideas-why-1-0-4-uses-more-RAM-than-0-90-w-a-smaller-GameData-folder?p=2135038\u0026amp;viewfull=1#post2135038\u0022 rel=\u0022external nofollow\u0022\u003EBetter testing has gotten this straightened out\u003C/a\u003E.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cblockquote\u003E\u003Cp\u003EHere\u0027s the comparison:\u003C/p\u003E\u003Cp\u003E0.90 w/ATM Basic - GameData folder size 631MB (ATM folder removed for size check)\u003C/p\u003E\u003Cp\u003E1.0.4 w/ATM Basic - GameData folder size 437MB (ATM folder removed for size check)\u003C/p\u003E\u003Cp\u003E[TABLE=class: grid, width: 450, align: left]\u003C/p\u003E\u003Cp\u003E[TR]\u003C/p\u003E\u003Cp\u003E[TD][/TD]\u003C/p\u003E\u003Cp\u003E[TD=align: center]\u003Cstrong\u003EKSP 0.90\u003C/strong\u003E[/TD]\u003C/p\u003E\u003Cp\u003E[TD=align: center]\u003Cstrong\u003EKSP 1.0.4\u003C/strong\u003E[/TD]\u003C/p\u003E\u003Cp\u003E[/TR]\u003C/p\u003E\u003Cp\u003E[TR]\u003C/p\u003E\u003Cp\u003E[TD]\u003Cstrong\u003EMain Menu\u003C/strong\u003E[/TD]\u003C/p\u003E\u003Cp\u003E[TD=align: center]2.965GB VRAM[/TD]\u003C/p\u003E\u003Cp\u003E[TD=align: center]3.286GB VRAM[/TD]\u003C/p\u003E\u003Cp\u003E[/TR]\u003C/p\u003E\u003Cp\u003E[TR]\u003C/p\u003E\u003Cp\u003E[TD]\u003Cstrong\u003ESpace Center\u003C/strong\u003E[/TD]\u003C/p\u003E\u003Cp\u003E[TD=align: center]3.307GB VRAM[/TD]\u003C/p\u003E\u003Cp\u003E[TD=align: center]3.602GB VRAM[/TD]\u003C/p\u003E\u003Cp\u003E[/TR]\u003C/p\u003E\u003Cp\u003E[TR]\u003C/p\u003E\u003Cp\u003E[TD]\u003Cstrong\u003EFlight Scene\u003C/strong\u003E[/TD]\u003C/p\u003E\u003Cp\u003E[TD=align: center]3.367GB VRAM[/TD]\u003C/p\u003E\u003Cp\u003E[TD=align: center]3.936GB VRAM[/TD]\u003C/p\u003E\u003Cp\u003E[/TR]\u003C/p\u003E\u003Cp\u003E[/TABLE]\u003C/p\u003E\u003Cp\u003EThe game crashes at just over 4GB VRAM as reported by Process Explorer. The game will also crash out of memory on load to the main menu if I don\u0027t use ATM. I haven\u0027t installed any mods in 1.0.4 that I don\u0027t also use in 0.90 except for RealHeat. Both installs are set up as similarly as possible - the only reason the 0.90 GameData is larger is because of the same part textures using larger file sizes.\u003C/p\u003E\u003Cp\u003EThis is rather disappointing :/\u003C/p\u003E\u003C/blockquote\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-08-13T04:01:50Z\u0022 title=\u002208/13/2015 04:01  AM\u0022 data-short=\u00228 yr\u0022\u003EAugust 13, 2015\u003C/time\u003E by Gaiiden\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"John FX","CreatedById":59415,"CreatedDateTime":"2015-08-11T12:16:41Z","Content":"\n\u003Cp\u003EInteresting. At least the game now does not crash at 3500MB and crashes instead at about 4000MB.\u003C/p\u003E\n"},{"CreatedByName":"Drew Kerman","CreatedById":103177,"CreatedDateTime":"2015-08-11T13:27:59Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022John FX\u0022 data-cite=\u0022John FX\u0022\u003E\u003Cdiv\u003EInteresting. At least the game now does not crash at 3500MB and crashes instead at about 4000MB.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003Eno, it crashes around 3.5GB of \u0022Working Set\u0022 RAM. I\u0027m quoting \u0022Virtual Size\u0022 RAM (as they are called by Process Explorer). VRAM has been a much more reliable indicator to me as to when the game is about to tank on the next scene switch\u003C/p\u003E\n"},{"CreatedByName":"ColKlonk","CreatedById":137078,"CreatedDateTime":"2015-08-11T17:55:50Z","Content":"\n\u003Cp\u003EI\u0027m of the opinion that Squad cannot solve this problem cos they don\u0027t know how too.. without breaking it.\u003C/p\u003E\u003Cp\u003EI suspect they\u0027re going full tilt for the 64 bit hoping this will get around the problem... but it won\u0027t.. and only will delay the impending fiasco..\u003C/p\u003E\u003Cp\u003EBy that time they will have moved on.. and say that you must buy a new KSP product... based on Win10..etc... but the problem won\u0027t go away...\u003C/p\u003E\u003Cp\u003EUltimately KSP will be dropped.\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue2.gif\u0022 alt=\u0022:sticktongue:\u0022\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-08-11T17:57:56Z\u0022 title=\u002208/11/2015 05:57  PM\u0022 data-short=\u00228 yr\u0022\u003EAugust 11, 2015\u003C/time\u003E by ColKlonk\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"mythbusters844","CreatedById":72313,"CreatedDateTime":"2015-08-11T23:55:01Z","Content":"\n\u003Cp\u003EIt\u0027s probably just some bloat from using 4k textures for icons or even more memory leaks in the game. It even might be a massively oversized sound clip in the game somewhere.\u003C/p\u003E\n"},{"CreatedByName":"Drew Kerman","CreatedById":103177,"CreatedDateTime":"2015-08-12T02:39:05Z","Content":"\n\u003Cp\u003Ewell I had to strip down to stock \u002B a small set of mods to look into a separate issue and I\u0027m no longer seeing an additional 300MB being allocated when the game loads into the flight scene, so yea it\u0027s def a mod or several. I\u0027ll get started with the bin sort to try and track it down...\u003C/p\u003E\n"},{"CreatedByName":"Drew Kerman","CreatedById":103177,"CreatedDateTime":"2015-08-13T03:55:53Z","Content":"\n\u003Cp\u003EOkay, first of all I realized my initial comparison test was not very well setup - I hadn\u0027t realized two mods I had installed in 1.0.4 were not being used in my 0.90 install (I had them moved out of GameData). Secondly, when I stripped to stock to test a separate issue I noticed my VRAM usage in the Flight Scene was actually \u003Cem\u003Eless\u003C/em\u003E than in the Space Center and got a better appreciation for how much mods can allocate additional memory when loading into the Flight Scene. So I did some more comprehensive testing, starting with a bin sort of my entire GameData folder (minus Squad of course) to see if I could track down any large memory hogs. Along the way I recorded several instances of the Flight Scene loading with less VRAM than the Space Center even as I put more and more mods back into the GameData folder. Two stood out however: SCANsat and HullCameraVDS. Here are the full results from Excel:\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://i.imgur.com/ofwR0hh.png\u0022 alt=\u0022ofwR0hh.png\u0022\u003E\u003C/p\u003E\u003Cp\u003EAs you can see, my 1.0.4 install now matches up properly with my 0.90 install for the Main Menu and Space Center (my 0.90 install has a larger GameData folder but I\u0027ve confirmed that the additional size is from textures, in which case ATM would treat them in 0.90 similar to how they are loaded in 1.0.4 so the GameData folder size difference is not a factor).\u003C/p\u003E\u003Cp\u003EMy 1.0.4 install is loading up an extra 200MB VRAM more than my 0.90 install, and removing HullCameraVDS and SCANsat confirm that they can more than make up for this difference, although interestingly when they are both taken out at the same time the RAM savings isn\u0027t quite as great as indicated, yet still substantial.\u003C/p\u003E\u003Cp\u003EDoing the same with my 0.90 install also provides some interesting results - most notably the fact that with both mods out of both installs, the VRAM usage in the Flight Scene is very close to identical, with 1.0.4 actually coming in slightly under 0.90.\u003C/p\u003E\u003Cp\u003EMy guesses are that for HullCameraVDS, the addition of the new camera filters and docking cam view are what bloated the mod in the Flight Scene. For SCANsat, DMagic came up with a way to have maps load faster, but I fear background loading of the maps is bumping up its RAM usage. I\u0027ll be addressing these issues in the appropriate threads. I know it doesn\u0027t seem like much, but 200MB of extra RAM is a couple of more scene changes before the game crashes.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-08-13T04:16:25Z\u0022 title=\u002208/13/2015 04:16  AM\u0022 data-short=\u00228 yr\u0022\u003EAugust 13, 2015\u003C/time\u003E by Gaiiden\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Wolf Baginski","CreatedById":138549,"CreatedDateTime":"2015-08-18T08:30:44Z","Content":"\n\u003Cp\u003EWhile SCANsat is one of the Mods that gives a good science return without being crazy, I can certainly see the point of not using it. I may be setting up a separate install for sandbox-style ops, without the extra Science stuff, though it does seem to rather miss the point. Maybe somebody should set up a decoration-only science mod which just has a few colorful boxes to stick on your craft?\u003C/p\u003E\u003Cp\u003EA quick check of the .cfg files shows that everything is done by the .dll, so just removing that folder would kill both the data collection and the part animations. I suppose the Module section would need deleting from the .cfg to stop any error messages. But that would give you a SCANsat lite as a placeholder, so that existing savefiles wouldn\u0027t be broken. The actual models and textures would still be there, referenced by the same internal name.\u003C/p\u003E\u003Cp\u003EAnd now I am wondering where SCANsat stores its data. It must store the locations scanned somewhere, even if the actual map data is generated from existing in-game sources.\u003C/p\u003E\u003Cp\u003EYep, that data is in persistent.sfs\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-08-18T08:33:59Z\u0022 title=\u002208/18/2015 08:33  AM\u0022 data-short=\u00228 yr\u0022\u003EAugust 18, 2015\u003C/time\u003E by Wolf Baginski\u003C/strong\u003E\n\u003Cbr\u003EAn obvious answer found...\n\u003C/span\u003E\n"},{"CreatedByName":"Drew Kerman","CreatedById":103177,"CreatedDateTime":"2015-08-18T09:00:34Z","Content":"\n\u003Cp\u003EDMagic has put in effort to reduce SCANsat\u0027s memory footprint, with good results too. No word yet from AlbertVDS, prob taking a needed break after the large update\u003C/p\u003E\n"},{"CreatedByName":"Wolf Baginski","CreatedById":138549,"CreatedDateTime":"2015-08-18T10:34:16Z","Content":"\n\u003Cp\u003EI\u0027m trying out my own Lite-version suggestion, since I\u0027m currently running games that are maxed out on Science, as far as the Tech Tree is concerned.\u003C/p\u003E\u003Cp\u003EIt does reduce memory usage enough to be making a difference, and I haven\u0027t seen any warnings. Sentinel hasn\u0027t flashed me any red-level memory warnings today, even when I was testing a very complicated situation that has been giving somebody else problems. (It\u0027s still maybe too-complicated but not hitting RAM limits.)\u003C/p\u003E\u003Cp\u003EIt\u0027s improved, and I\u0027d certainly use it were I starting a career or science game from scratch.\u003C/p\u003E\n"}]}