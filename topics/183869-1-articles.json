{"TopicId":183869,"ForumId":29,"TopicTitle":"Mods with wrong .NET Target Framework","CreatedByName":"Tonka Crash","CreatedById":189552,"CreatedDateTime":"2019-04-20T04:12:37Z","PageNum":1,"Articles":[{"CreatedByName":"Tonka Crash","CreatedById":189552,"CreatedDateTime":"2019-04-20T04:12:37Z","Content":"\n\u003Cp\u003E\nSince 1.6 I\u0027ve been seeing more frequent random crashes with really no clue where they come from, so I\u0027ve been spending time since 1.7 chasing exceptions in the KSP.log. Today I found a fix for a TypeLoadException I was getting during startup. I know KSP plugins should\u00A0target .NET 3.5, but how critical is this? Could this be a source of random crashes or is it just sloppy programming\u00A0by the modders?\u00A0\n\u003C/p\u003E\n\u003Cdiv class=\u0022ipsSpoiler\u0022 data-ipsspoiler=\u0022\u0022\u003E\n\u003Cdiv class=\u0022ipsSpoiler_header\u0022\u003E\n\u003Cspan\u003ESpoiler\u003C/span\u003E\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsSpoiler_contents\u0022\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\n\u003Cspan class=\u0022pln\u0022\u003E[EXC 22:11:47.643] TypeLoadException: Could not load type \u0027System.Runtime.Versioning.TargetFrameworkAttribute\u0027 from assembly \u0027DecouplerShroud\u0027.\n\tSystem.MonoCustomAttrs.GetCustomAttributesBase (ICustomAttributeProvider obj, System.Type attributeType)\n\tSystem.MonoCustomAttrs.GetCustomAttributes (ICustomAttributeProvider obj, System.Type attributeType, Boolean inherit)\n\tSystem.Reflection.Assembly.GetCustomAttributes (System.Type attributeType, Boolean inherit)\n\tKopernicus.LogAggregatorWorker.Awake ()\n\tUnityEngine.GameObject:AddComponent(Type)\n\tAddonLoader:StartAddon(LoadedAssembly, Type, KSPAddon, Startup)\n\tAddonLoader:StartAddons(Startup)\n\t\u003C/span\u003E\u003Cspan class=\u0022tag\u0022\u003E\u0026lt;LoadObjects\u0026gt;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Ec__Iterator1:MoveNext()\n\tUnityEngine.MonoBehaviour:StartCoroutine(IEnumerator)\n\t\u003C/span\u003E\u003Cspan class=\u0022tag\u0022\u003E\u0026lt;CreateDatabase\u0026gt;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Ec__Iterator0:MoveNext()\n\tUnityEngine.MonoBehaviour:StartCoroutine(IEnumerator)\n\tGameDatabase:StartLoad()\n\t\u003C/span\u003E\u003Cspan class=\u0022tag\u0022\u003E\u0026lt;LoadSystems\u0026gt;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Ec__Iterator0:MoveNext()\n\tUnityEngine.SetupCoroutine:InvokeMoveNext(IEnumerator, IntPtr)\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/div\u003E\n\u003Cp\u003E\nWhat I tracked down is:\n\u003C/p\u003E\n\u003Cul\u003E\u003Cli\u003E\nDecoupler Shroud was compiled against .NET 4.6.1 \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/180778-navot/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022180778\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/180778-navot/\u0022 rel=\u0022\u0022\u003E@navot\u003C/a\u003E\n\u003C/li\u003E\n\u003Cli\u003E\nDynamic Battery Storage (Near Future Electrical dependency) was compiled against .NET 4.0\u00A0 \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/83952-nertea/\u0026amp;do=hovercard\u0022 data-mentionid=\u002283952\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/83952-nertea/\u0022 rel=\u0022\u0022\u003E@Nertea\u003C/a\u003E\n\u003C/li\u003E\n\u003Cli\u003E\nDocking Port Sound FX was compiled against 4.5.2 \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/112361-tg626/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022112361\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/112361-tg626/\u0022 rel=\u0022\u0022\u003E@tg626\u003C/a\u003E\n\u003C/li\u003E\n\u003C/ul\u003E\u003Cp\u003E\nRecompiling locally against .NET 3.5 clears the exception. I found these by downloading the problem mods and checking the project properties in Visual Studio. I double checked the rest of my mods with\u00A0\u00A0\u003Ca href=\u0022https://www.jetbrains.com/decompiler/\u0022 rel=\u0022external nofollow\u0022\u003EdotPeek\u003C/a\u003E\u00A0and didn\u0027t find any other issues.\n\u003C/p\u003E\n\u003Cp\u003E\nIf a mod reads this: I\u0027m not sure where this topic should go.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222019-04-20T15:06:49Z\u0022 title=\u002204/20/2019 03:06  PM\u0022 data-short=\u00225 yr\u0022\u003EApril 20, 2019\u003C/time\u003E by Tonka Crash\u003C/strong\u003E\n\u003Cbr\u003Epinged affected mod writers.\n\u003C/span\u003E\n"},{"CreatedByName":"HebaruSan","CreatedById":156657,"CreatedDateTime":"2019-04-20T04:50:09Z","Content":"\n\u003Cp\u003E\nGood eye. Yes, I believe this could cause problems. I\u0027ve taken the liberty of reporting this on those mods\u0027 respective bug trackers, hopefully it\u0027ll be resolved.\n\u003C/p\u003E\n\u003Cul\u003E\u003Cli\u003E\n\u003Ca href=\u0022https://github.com/nav0t/DecouplerShroud/issues/6\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/nav0t/DecouplerShroud/issues/6\u003C/a\u003E\n\u003C/li\u003E\n\u003Cli\u003E\n\u003Ca href=\u0022https://github.com/ChrisAdderley/DynamicBatteryStorage/issues/17\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/ChrisAdderley/DynamicBatteryStorage/issues/17\u003C/a\u003E\n\u003C/li\u003E\n\u003Cli\u003E\n\u003Ca href=\u0022https://github.com/TedThompson/Docking-Sounds/issues/2\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/TedThompson/Docking-Sounds/issues/2\u003C/a\u003E\n\u003C/li\u003E\n\u003C/ul\u003E\n"},{"CreatedByName":"Tonka Crash","CreatedById":189552,"CreatedDateTime":"2019-04-20T04:52:49Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223586941\u0022 data-ipsquote-contentid=\u0022183869\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221555735809\u0022 data-ipsquote-userid=\u0022156657\u0022 data-ipsquote-username=\u0022HebaruSan\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n1 minute ago, HebaruSan said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nGood eye. Yes, I believe this could cause problems. I\u0027ve taken the liberty of reporting this on those mods\u0027 respective bug trackers, hopefully it\u0027ll be resolved.\n\u003C/p\u003E\n\u003Cul\u003E\u003Cli\u003E\n\u003Ca href=\u0022https://github.com/nav0t/DecouplerShroud/issues/6\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/nav0t/DecouplerShroud/issues/6\u003C/a\u003E\n\u003C/li\u003E\n\u003Cli\u003E\n\u003Ca href=\u0022https://github.com/ChrisAdderley/DynamicBatteryStorage/issues/17\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/ChrisAdderley/DynamicBatteryStorage/issues/17\u003C/a\u003E\n\u003C/li\u003E\n\u003Cli\u003E\n\u003Ca href=\u0022https://github.com/TedThompson/Docking-Sounds/issues/2\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/TedThompson/Docking-Sounds/issues/2\u003C/a\u003E\n\u003C/li\u003E\n\u003C/ul\u003E\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nYou beat me to it on two of the three \u003Cspan\u003E\u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u003C/span\u003E\n\u003C/p\u003E\n"},{"CreatedByName":"Lisias","CreatedById":187168,"CreatedDateTime":"2019-04-20T05:33:25Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223586931\u0022 data-ipsquote-contentid=\u0022183869\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221555733557\u0022 data-ipsquote-userid=\u0022189552\u0022 data-ipsquote-username=\u0022Tonka Crash\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n17 hours ago, Tonka Crash said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\n\u00A0I know KSP plugins should\u00A0target .NET 3.5, but how critical is this? Could this be a source of random crashes or is it just sloppy programming\u00A0by the modders?\u00A0\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nNot too much critical, as anything wrong would cause the exception you detected. DLL have this name for a good reason: they are Dynamic Linking Libraries, i.e., the code is linked in runtime, not on compile time (or even loading time).\n\u003C/p\u003E\n\u003Cp\u003E\nJumping over versions can be a problem when the interface is preserved (ie, the function has the same parameters and return type), but not the contract (the function does something different than expected). But this is not a problem while compiling, but while running - and Microsoft is not (too much) dumb, they preserve the function\u0027s contracts between major versions.\n\u003C/p\u003E\n\u003Cp\u003E\nOn this specific case, it\u0027s the compiler the source of the trouble - since it was told to target the 4.x version, the compiler generated code that relies on new classes and methods that are not available on the 3.x version.\n\u003C/p\u003E\n\u003Cp\u003E\nAbout the sloppiness\u2026 It\u0027s more a unattended mistake on what is called \u0022configuration management\u0022 than a\u00A0bad practice on programming. Microsoft Visual Studio automates everything it can to make the programmer\u0027s life easier, but now and then the defaults changes to newer versions of the libraries, and the programmer is not notified and the guy just realizes the problem on deploy.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222019-04-20T21:50:41Z\u0022 title=\u002204/20/2019 09:50  PM\u0022 data-short=\u00225 yr\u0022\u003EApril 20, 2019\u003C/time\u003E by Lisias\u003C/strong\u003E\n\u003Cbr\u003Ekrakens count the tyops!!!\n\u003C/span\u003E\n"},{"CreatedByName":"James Kerman","CreatedById":160462,"CreatedDateTime":"2019-04-20T11:52:14Z","Content":"\n\u003Cp\u003E\nHello \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/189552-tonka-crash/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022189552\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/189552-tonka-crash/\u0022 rel=\u0022\u0022\u003E@Tonka Crash\u003C/a\u003E.\n\u003C/p\u003E\n\u003Cp\u003E\nI have moved your thread to\u00A0C# Plugin Development Help and Support.\n\u003C/p\u003E\n"},{"CreatedByName":"tg626","CreatedById":112361,"CreatedDateTime":"2019-04-20T23:47:52Z","Content":"\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/189552-tonka-crash/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022189552\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/189552-tonka-crash/\u0022 rel=\u0022\u0022\u003E@Tonka Crash\u003C/a\u003E\u00A0what version of VS did you use?\u00A0 I\u0027ll have to reinstall it (system reformat) to recompile and release a bug fix.\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"Tonka Crash","CreatedById":189552,"CreatedDateTime":"2019-04-21T00:14:34Z","Content":"\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/112361-tg626/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022112361\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/112361-tg626/\u0022 rel=\u0022\u0022\u003E@tg626\u003C/a\u003E\u00A0I\u0027ve got VS 2017 I installed sometime last fall.\n\u003C/p\u003E\n"}]}