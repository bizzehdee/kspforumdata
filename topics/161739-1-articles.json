{"TopicId":161739,"ForumId":20,"TopicTitle":"[Mod Request] Monopropellant and Crossfeed!","CreatedByName":"Kage Sendo","CreatedById":116160,"CreatedDateTime":"2017-06-07T19:16:38Z","PageNum":1,"Articles":[{"CreatedByName":"Kage Sendo","CreatedById":116160,"CreatedDateTime":"2017-06-07T19:16:38Z","Content":"\n\u003Cp\u003E\nSo I\u00A0was in sandbox mode test out, how to setup Satellite\u00A0array\u00A0I\u00A0noticed that my \u003Cabbr title=\u0022Reaction Control System\u0022\u003ERcs\u003C/abbr\u003E ports on my launch craft\u00A0where pulling monopropellant from my Satellites\u00A0tanks first and not the one nearest to them\u00A0(they changed it to this in 0.23.5 and I\u00A0did not notice) and yes I\u00A0know you can disable the tanks so that fuel can not be pulled from them.\n\u003C/p\u003E\n\u003Cp\u003E\nI when\u0027t back\u00A0to the \u003Cabbr title=\u0022Vehicle Assembly Building\u0022\u003EVaB\u003C/abbr\u003E and did some testing using \u003Ca href=\u0022http://i.imgur.com/wWNlyQO.png\u0022 rel=\u0022external nofollow\u0022\u003EThis\u003C/a\u003E\u00A0and found out that 1. Monopropellant is pulled form the upper stages first 2. Even though you can do so, changing the fuel flow priority on\u00A0monopropellant tanks, does not change any thing\n\u003C/p\u003E\n\u003Cp\u003E\nand 3. Monopropellant does not obey the crossfeed rules on decouplers.\n\u003C/p\u003E\n\u003Cp\u003E\nSo I had some ideas for a\u00A0mod that would change this and if knew how to do so I would make it myself, but I do not, so I throw myself upon the tender mercies that are the great mod makers in this community.\n\u003C/p\u003E\n\u003Cp\u003E\n(these ideas are listed in what I\u00A0believe would be the most useful\u00A0to the least useful)\n\u003C/p\u003E\n\u003Cp\u003E\nIdea 1. For stock decouplers create an option in the\u00A0right click menu, i.e\u00A0when you right click a decoupler there would be an option below crossfeed, that would say Monopropellant Crossfeed and when you clicked it, it would enable/disable monopropellant crossfed and would prevent any \u003Cabbr title=\u0022Reaction Control System\u0022\u003Ercs\u003C/abbr\u003E ports below the decoupler from being able to pull fuel from the tanks above the decoupler, forcing the \u003Cabbr title=\u0022Reaction Control System\u0022\u003Ercs\u003C/abbr\u003E port to pull fuel from the neatest tank it can.\n\u003C/p\u003E\n\u003Cp\u003E\nIdea 2. Make it so that the fuel flow priority system works for monopropellant tanks.\u00A0i.e you could set, for example, a satellites monopropellant tanks to -1 and set the main crafts\u00A0monopropellant tanks to 0 and it would pull fuel from the main crafts tanks first.\n\u003C/p\u003E\n\u003Cp\u003E\nIdea 3. Change how monopropellant works back to how it was pre 0.23.5, which in and of it self has some problems and can annoy you just as bad, why am i even listing this one, oh well.\n\u003C/p\u003E\n\u003Cp\u003E\nI am not sure how difficult this would be, but I do hop someone takes up the challenge, if anyone has any questions leave a comment.\n\u003C/p\u003E\n\u003Cp\u003E\nThank you for reading this far\u00A0\u003Cimg alt=\u0022:D\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 title=\u0022:D\u0022\u003E, Kage Sendo.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222017-06-07T19:18:34Z\u0022 title=\u002206/07/2017 07:18  PM\u0022 data-short=\u00227 yr\u0022\u003EJune 7, 2017\u003C/time\u003E by Kage Sendo\u003C/strong\u003E\n\u003Cbr\u003ESpelling\n\u003C/span\u003E\n"},{"CreatedByName":"Streetwind","CreatedById":98962,"CreatedDateTime":"2017-06-08T07:01:29Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223083997\u0022 data-ipsquote-contentid=\u0022161739\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221496862998\u0022 data-ipsquote-userid=\u0022116160\u0022 data-ipsquote-username=\u0022Kage Sendo\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n11 hours ago, Kage Sendo said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nI when\u0027t back\u00A0to the \u003Cabbr title=\u0022Vehicle Assembly Building\u0022\u003EVaB\u003C/abbr\u003E and did some testing using \u003Ca href=\u0022http://i.imgur.com/wWNlyQO.png\u0022 rel=\u0022external nofollow\u0022\u003EThis\u003C/a\u003E\u00A0and found out that 1. Monopropellant is pulled form the upper stages first 2. Even though you can do so, changing the fuel flow priority on\u00A0monopropellant tanks, does not change any thing\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nMonopropellant doesn\u0027t drain from upper stages first; it drains from the tanks that the game thinks is going to be staged away the soonest, based on the staging order you have set. Whether that stage is \u0022above\u0022 or \u0022below\u0022 another one doesn\u0027t matter. In your picture, the \u003Cabbr title=\u0022Reaction Control System\u0022\u003ERCS\u003C/abbr\u003E tank on top of the rocket will drain first, because it is on a decoupler that is set to be staged next, and it does not have a probe core. In other words, the game does not identify it as a spacecraft capable of operation by itself, and therefore it must be an expendable stage that\u0027s okay to be drained.\n\u003C/p\u003E\n\u003Cp\u003E\nThe reason why changing the fuel flow priority does nothing, and decoupler crossfeed settings are ignored, is because monopropellant is (and has always been) a vessel-wide\u00A0resource, similar to EC. It has to be, otherwise placing \u003Cabbr title=\u0022Reaction Control System\u0022\u003ERCS\u003C/abbr\u003E thrusters would become a major hassle since you\u0027d have to paitr them with tanks that have the right amount of fuel to be balanced with the rest of the \u003Cabbr title=\u0022Reaction Control System\u0022\u003ERCS\u003C/abbr\u003E ports all over the spacecraft... it would render them borderline unusable for anything except the final, single stages.\n\u003C/p\u003E\n\u003Cp\u003E\nOriginally, this caused all \u003Cabbr title=\u0022Reaction Control System\u0022\u003ERCS\u003C/abbr\u003E tanks on the whole ship to drain at the same time. Squad at some point then added the logic with draining the tanks closest to being staged away first so that you don\u0027t run into a situation where you using \u003Cabbr title=\u0022Reaction Control System\u0022\u003ERCS\u003C/abbr\u003E drains tanks on upper stages and deployable satellites you carry. Which is, ironically, exactly the issue you experience now, \u003Cem\u003Ebecause\u003C/em\u003E of this stage priority flow. The system isn\u0027t perfect; it merely works better for 95% of the designs, and worse for the remaining 5%. Your vessel clearly falls into the latter category.\n\u003C/p\u003E\n\u003Cp\u003E\nTo fix this, you have two options:\u003Cbr\u003E\n1.) Change the way your vessel is built. Give the \u003Cabbr title=\u0022Reaction Control System\u0022\u003ERCS\u003C/abbr\u003E ports a tank to drain from that is staged away sooner than your deployable satellites - ideally on a stage with no probe control -\u00A0and it will draw from that one first.\u003Cbr\u003E\n2.) Use a simple Module Manager patch to change the RESOURCE_DEFINITION of monopropellant to a different fuel flow mode that better suits your needs.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222017-06-08T07:04:54Z\u0022 title=\u002206/08/2017 07:04  AM\u0022 data-short=\u00227 yr\u0022\u003EJune 8, 2017\u003C/time\u003E by Streetwind\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Kage Sendo","CreatedById":116160,"CreatedDateTime":"2017-06-08T15:47:34Z","Content":"\n\u003Cp\u003E\nThank you for reply.\n\u003C/p\u003E\n\u003Cp\u003E\nLet me start with this,\u00A0\u003Ca href=\u0022http://i.imgur.com/8uW7oaQ.png\u0022 rel=\u0022external nofollow\u0022\u003EThis\u003C/a\u003E\u00A0is the craft I\u00A0am using to launch my Satellites (at least the upper stage) and if you could tell me why it works the way it does as it pertains to my craft that would be great. \u00A0 \u00A0 \u00A0 \u00A0 \u00A0 \u00A0 \u00A0 \u00A0 \u00A0 \u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nLike I said, I\u00A0do know that in the \u003Cabbr title=\u0022Vehicle Assembly Building\u0022\u003EVaB\u003C/abbr\u003E i could right click a tank and disable it and\u00A0my radial tanks where placed with symmetry, so it would disable them all. The problem is however, after launch I\u00A0have to click on and re-enable each tank separately and having to do this for 3 or 4 satellites (each with one to 4 or 5 tank) gets a little annoying after awhile. I do use Part Commander, but it does not recognize Monopropellant tanks unfortunately, and that is when I\u00A0had the ideas that I\u00A0did.\n\u003C/p\u003E\n\u003Cp\u003E\nOn the subject of the ideas that I had, now that I\u00A0think about idea 1. could cause some issues of its own, idea 2. on the other hand has promise in the way it would allow you to define which tanks the \u003Cabbr title=\u0022Reaction Control System\u0022\u003ERCS\u003C/abbr\u003E ports would drain from first, if i knew how to create an \u003Cabbr title=\u0022Module Manager (mod)\u0022\u003EMM\u003C/abbr\u003E patch that would give me this functionality I\u00A0would do so (not to sound rude).\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222017-06-08T15:49:45Z\u0022 title=\u002206/08/2017 03:49  PM\u0022 data-short=\u00227 yr\u0022\u003EJune 8, 2017\u003C/time\u003E by Kage Sendo\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Streetwind","CreatedById":98962,"CreatedDateTime":"2017-06-09T06:58:16Z","Content":"\n\u003Cp\u003E\nI would wager your vessel works like that because the satellites are the next thing to be staged away.\n\u003C/p\u003E\n\u003Cp\u003E\nAs for how to make a patch: I don\u0027t have access to a KSP installation here, so I can\u0027t give you a full patch to copypaste, but I can tell you where to find the info you need.\n\u003C/p\u003E\n\u003Cp\u003E\nFirst, make an empty text file and save it somewhere in Gamedata or a subfolder thereof, with the extension of .cfg. Then, paste the following into the file:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode\u0022\u003E\n@RESOURCE_DEFINITION[MonoPropellant]:FINAL\n{\n\t\n}\u003C/pre\u003E\n\u003Cp\u003E\nNext, go into GameData/Squad/Resources and open ResourcesGeneric.cfg.\u00A0Find the entry for liquid fuel.\n\u003C/p\u003E\n\u003Cp\u003E\nOne of the data fields in Squad\u0027s resource definition will set the fuel flow mode - something like \u0022flowMode = SOMETHING\u0022. I don\u0027t fully remember how it looks, but it\u0027s the only thing remotely like it, so you can\u0027t miss it.\u00A0Copy the whole line over into your patch file, in the empty space between the curly brackets, and preface it with an @ symbol.\n\u003C/p\u003E\n\u003Cp\u003E\nSave your config and try it out ingame. Provided you have Module Manager installed,\u00A0your monopropellant should now flow exactly like liquid fuel does, including respecting crossfeed rules and obeying flow priorities. If it doesn\u0027t work, paste what you came up with here and I\u0027ll look for the error.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222017-06-09T07:13:47Z\u0022 title=\u002206/09/2017 07:13  AM\u0022 data-short=\u00227 yr\u0022\u003EJune 9, 2017\u003C/time\u003E by Streetwind\u003C/strong\u003E\n\u003C/span\u003E\n"}]}