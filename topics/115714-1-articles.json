{"TopicId":115714,"ForumId":29,"TopicTitle":"How to animate a part with multiple animations?","CreatedByName":"Enceos","CreatedById":110725,"CreatedDateTime":"2015-07-12T14:07:50Z","PageNum":1,"Articles":[{"CreatedByName":"Enceos","CreatedById":110725,"CreatedDateTime":"2015-07-12T14:07:50Z","Content":"\n\u003Cp\u003EI made a part with three animations:\u003C/p\u003E\u003Cp\u003E- Heating up\u003C/p\u003E\u003Cp\u003E- Working animation\u003C/p\u003E\u003Cp\u003E- Lights\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://giant.gfycat.com/SeriousNeighboringAmericanriverotter.gif\u0022 alt=\u0022SeriousNeighboringAmericanriverotter.gif\u0022\u003E\u003C/p\u003E\u003Cp\u003EI\u0027d like to group the first two animations and run them in sequence when a \u0022turn on\u0022 event occurs:\u003C/p\u003E\u003Cp\u003E- Heat up (till animation finishes)\u003C/p\u003E\u003Cp\u003E- Working (loop)\u003C/p\u003E\u003Cp\u003Eand then animator should loop the second animation until the \u0022turn off\u0022 event occurs after which it should end both animations simultaneously in this fashion:\u003C/p\u003E\u003Cp\u003E- Heat up (backwards animation)\u003C/p\u003E\u003Cp\u003E- Working (stop looping)\u003C/p\u003E\u003Cp\u003EThe key is blending them together.\u003C/p\u003E\u003Cp\u003EFor the \u0022lights\u0022 animation I wish it didn\u0027t interrupt the \u0022working\u0022 animation.\u003C/p\u003E\u003Cp\u003EI\u0027m searching for the code which my friend could implement into his plugin.\u003C/p\u003E\u003Cp\u003EIs there any mod that has a similar animation code? Where should we look?\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-07-12T14:13:45Z\u0022 title=\u002207/12/2015 02:13  PM\u0022 data-short=\u00228 yr\u0022\u003EJuly 12, 2015\u003C/time\u003E by Enceos\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"BahamutoD","CreatedById":72433,"CreatedDateTime":"2015-07-13T15:29:17Z","Content":"\n\u003Cp\u003EYou could have a startup coroutine and a shutdown coroutine. (using System.Collections)\u003C/p\u003E\u003Cp\u003EYou might need another animation that\u0027s just the slideythings sitting at their default position if you want to blend from their moving state smoothly into an idle state.\u003C/p\u003E\u003Cp\u003EFirst grab the AnimationStates from the animation then do something like this (pseudo-ish code):\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003EIEnumerator StartupRoutine()\u003Cbr\u003E{\u003Cbr\u003E    heatAnimState.enabled = true;\u003Cbr\u003E    heatAnimState.normalizedSpeed = 1;\u003Cbr\u003E    while(heatAnimState.normalizedTime \u0026lt; 1)\u003Cbr\u003E    {\u003Cbr\u003E        yield return null; //wait until animation is done.  its a coroutine so it won\u0027t freeze the game\u003Cbr\u003E    }\u003Cbr\u003E    heatAnimState.enabled = false;\u003Cbr\u003E    workingAnimState.enabled = true;\u003Cbr\u003E    workingAnimState.wrapMode = loop;\u003Cbr\u003E    workingAnimState.normalizedSpeed = 1;\u003Cbr\u003E}\u003Cbr\u003E\u003Cbr\u003EIEnumerator ShutdownRoutine()\u003Cbr\u003E{\u003Cbr\u003E    //start the heat anim at the end and play it backwards\u003Cbr\u003E    heatAnimState.enabled = true;\u003Cbr\u003E    heatAnimState.normalizedTime =1;\u003Cbr\u003E    heatAnimState.normalizedSpeed = -1; \u003Cbr\u003E\u003Cbr\u003E    workingAnimState.weight = 1;\u003Cbr\u003E    idleAnimState.weight = 0;\u003Cbr\u003E    idleAnimState.enabled = true;\u003Cbr\u003E    while(idleAnimState.weight \u0026lt; 1 || workingAnimState.weight \u0026gt; 0)\u003Cbr\u003E    {\u003Cbr\u003E        idleAnimState.weight = mathf.movetowards(idleAnimState.weight, 1, delta); //fading the weight of idle to one\u003Cbr\u003E        workingAnimState.weight = mathf.movetowards(workingAnimState.weight, 0, delta); //fading the weight of the working anim to zero\u003Cbr\u003E        yield return null;\u003Cbr\u003E    }\u003Cbr\u003E\u003Cbr\u003E    idleAnimState.enabled = false;\u003Cbr\u003E    workingAnimState.enabled = false; //these animations are done, turn them off\u003Cbr\u003E\u003Cbr\u003E    while(heatAnimState.normalizedTime \u0026gt; 0)\u003Cbr\u003E    {\u003Cbr\u003E        yield return null; //now wait for the reverse heating anim to finish\u003Cbr\u003E    }\u003Cbr\u003E    heatAnimState.enabled = false;\u003Cbr\u003E    //done!\u003Cbr\u003E}\u003Cbr\u003E\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EYou should make sure the heating animation doesn\u0027t have any keyframes for the positions of the other objects so it doesn\u0027t interfere.\u003C/p\u003E\u003Cp\u003EThen, for your turn on/turn off methods, start the respective coroutines\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Evoid TurnOn()\u003Cbr\u003E{\u003Cbr\u003E    StartCoroutine(StartupRoutine());\u003Cbr\u003E}\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EHope this helps..\u003C/p\u003E\u003Cp\u003EEdit: when you\u0027re initializing everything and getting the animationState from the animation, I think you have to do animation.blend(animationName) or something.\u003C/p\u003E\u003Cp\u003EHere\u0027s a snip of me setting up firing and reloading animations from my game:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E                if(GetComponent\u0026lt;Animation\u0026gt;())\u003Cbr\u003E\t\t{\u003Cbr\u003E\u003Cbr\u003E\t\t\t//animationSetup\u003Cbr\u003E\t\t\tfireAnim = GetComponent\u0026lt;Animation\u0026gt;()[\u0022fireAnimation\u0022];\u003Cbr\u003E\t\t\tfireAnimSpeed = (fireRateRPM*fireAnim.length)/60;\u003Cbr\u003E\t\t\tfireAnim.normalizedSpeed = 0;\u003Cbr\u003E\t\t\tfireAnim.enabled = true;\u003Cbr\u003E\t\t\tfireAnim.wrapMode = WrapMode.ClampForever;\u003Cbr\u003E\t\t\tGetComponent\u0026lt;Animation\u0026gt;().Blend(\u0022fireAnimation\u0022);\u003Cbr\u003E\u003Cbr\u003E\t\t\tif(!infiniteMag)\u003Cbr\u003E\t\t\t{\u003Cbr\u003E\t\t\t\treloadAnim = GetComponent\u0026lt;Animation\u0026gt;()[\u0022reloadAnimation\u0022];\u003Cbr\u003E\t\t\t\treloadAnimSpeed = reloadAnim.length/reloadTime;\u003Cbr\u003E\t\t\t\treloadAnim.normalizedTime = 1;\u003Cbr\u003E\t\t\t\treloadAnim.enabled = true;\u003Cbr\u003E\t\t\t\treloadAnim.wrapMode = WrapMode.ClampForever;\u003Cbr\u003E\t\t\t\tGetComponent\u0026lt;Animation\u0026gt;().Blend (\u0022reloadAnimation\u0022);\u003Cbr\u003E\t\t\t}\u003Cbr\u003E\t\t}\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-07-14T20:47:56Z\u0022 title=\u002207/14/2015 08:47  PM\u0022 data-short=\u00228 yr\u0022\u003EJuly 14, 2015\u003C/time\u003E by BahamutoD\u003C/strong\u003E\n\u003Cbr\u003Echanged \u0026amp;\u0026amp; to || in the weight fading \u0026#039;while loop\u0026#039; condition\n\u003C/span\u003E\n"},{"CreatedByName":"Enceos","CreatedById":110725,"CreatedDateTime":"2015-07-13T20:48:25Z","Content":"\n\u003Cp\u003EThank you very much, that was very informative!\u003C/p\u003E\n"},{"CreatedByName":"ObiVanDamme","CreatedById":136329,"CreatedDateTime":"2015-07-28T16:23:48Z","Content":"\n\u003Cp\u003EHey BahamutoD, thank you very much for your help. I managed to make these complex animations available and it looks very promising for the first shot.\u003C/p\u003E\u003Cp\u003EHere is what I did for start (no pseudo-code)\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003EheatAnimation.enabled = true;\u003Cbr\u003EheatAnimation.normalizedSpeed = 0.5f;\u003Cbr\u003Ewhile (heatAnimation.normalizedTime \u0026lt; 1)\u003Cbr\u003E{\u003Cbr\u003E    yield return null;\u003Cbr\u003E}\u003Cbr\u003EheatAnimation.enabled = false;\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003EworkAnimation.enabled = true;\u003Cbr\u003EworkAnimation.wrapMode = WrapMode.Loop;\u003Cbr\u003EworkAnimation.normalizedSpeed = 0.5f;\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003Eand for end\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003EheatAnimation.enabled = true;\u003Cbr\u003EheatAnimation.normalizedTime = 1;\u003Cbr\u003EheatAnimation.normalizedSpeed = -0.5f;\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003EworkAnimation.enabled = true;\u003Cbr\u003EworkAnimation.wrapMode = WrapMode.Loop;\u003Cbr\u003EworkAnimation.normalizedSpeed = 0.5f;\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003Ewhile (workAnimation.normalizedTime \u0026lt; 1)\u003Cbr\u003E{\u003Cbr\u003E    yield return null;\u003Cbr\u003E}\u003Cbr\u003EworkAnimation.enabled = false;\u003Cbr\u003E\u003Cbr\u003Ewhile (heatAnimation.normalizedTime \u0026gt; 0)\u003Cbr\u003E{\u003Cbr\u003E    yield return null;\u003Cbr\u003E}\u003Cbr\u003EheatAnimation.enabled = false;\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EThe only struggle I have currently is the setup for the animations. I already received bug reports with NullReferenceExceptions inside those two methods and I expect, that this is happening, because the animation states where not initialized but where \u003Cem\u003Enull. \u003C/em\u003E\u003C/p\u003E\u003Cp\u003EHere is the code i have. I currently call it inside the OnLoad method. Is that the correct way or should I call it from OnStart?\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Eforeach (var animator in part.FindModelAnimators(\u0022workshop_emissive\u0022))\u003Cbr\u003E{\u003Cbr\u003E    heatAnimation = animator[\u0022workshop_emissive\u0022];\u003Cbr\u003E    heatAnimation.speed = 0;\u003Cbr\u003E    heatAnimation.enabled = true;\u003Cbr\u003E    heatAnimation.wrapMode = WrapMode.ClampForever;\u003Cbr\u003E    animator.Blend(\u0022workshop_emissive\u0022);\u003Cbr\u003E    break;\u003Cbr\u003E}\u003Cbr\u003Eforeach (var animator in part.FindModelAnimators(\u0022work\u0022))\u003Cbr\u003E{\u003Cbr\u003E    workAnimation = animator[\u0022work\u0022];\u003Cbr\u003E    workAnimation.speed = 0;\u003Cbr\u003E    workAnimation.enabled = true;\u003Cbr\u003E    workAnimation.wrapMode = WrapMode.ClampForever;\u003Cbr\u003E    animator.Blend(\u0022work\u0022);\u003Cbr\u003E}\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EI cannot reproduce the exceptions and the reporter has a very heavily modded install. Can you tell me if this setup is right or do you have any Idea what could cause those exceptions based on the info you have?\u003C/p\u003E\n"},{"CreatedByName":"BahamutoD","CreatedById":72433,"CreatedDateTime":"2015-07-28T16:48:24Z","Content":"\n\u003Cp\u003EI\u0027ve never used OnLoad, so the first thing I would try is to put the animator setup in OnStart.\u003C/p\u003E\n"}]}