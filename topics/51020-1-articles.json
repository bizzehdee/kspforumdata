{"TopicId":51020,"ForumId":29,"TopicTitle":"KSPField, PartModule, and... Clones?","CreatedByName":"CelestialMechanic","CreatedById":63925,"CreatedDateTime":"2013-10-29T01:17:36Z","PageNum":1,"Articles":[{"CreatedByName":"CelestialMechanic","CreatedById":63925,"CreatedDateTime":"2013-10-29T01:17:36Z","Content":"\n\u003Cp\u003EI\u0027ve been writing a plugin for some time now, and I want to configure things like the power usage of a part from the part module definition.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003EPART\u003Cbr\u003E{\u003Cbr\u003E  //Some Part\u003Cbr\u003E  MODULE\u003Cbr\u003E  {\u003Cbr\u003E    name = ModuleKSPFieldTest\u003Cbr\u003E    powerConsumption = 65\u003Cbr\u003E  }\u003Cbr\u003E}\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EThe module looks something like this:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Epublic class ModuleKSPFieldTest : PartModule\u003Cbr\u003E{\u003Cbr\u003E  [KSPField(guiActive=true)]\u003Cbr\u003E  public float powerConsumption = 0f;\u003Cbr\u003E}\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EThe problem is, as far as I can tell, that the only instance of ModuleKSPFieldTest that recieves this data is the one that\u0027s loaded at startup (and filed away somewhere?), and any parts that actually use that module in flight only display the compile time default of 0. Does this have anything to do with the fact that the debug console displays the part as Part(Clone)?\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/7544-The-official-unoffical-help-a-fellow-plugin-developer-thread?p=650992\u0026amp;viewfull=1#post650992\u0022 rel=\u0022external nofollow\u0022\u003EArodang\u003C/a\u003E has asked for help about this before, and as far as I can tell hasn\u0027t even been acknowledged, so I\u0027m making this a proper post.\u003C/p\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2013-10-29T05:02:16Z","Content":"\n\u003Cp\u003EThis looks like something TaranisElsu (iirc) was working on a few days ago. You might look him up on IRC to see if he made any progress on it\u003C/p\u003E\n"},{"CreatedByName":"Faark","CreatedById":69775,"CreatedDateTime":"2013-10-29T08:57:24Z","Content":"\n\u003Cp\u003EYou usually load your part with all PartModules from a config, so it ends up in PartLoader.LoadedPartsList. All actual instance are clones from those and should also get the same values... as far as i understand KSP^^\u003C/p\u003E\n"},{"CreatedByName":"TaranisElsu","CreatedById":57742,"CreatedDateTime":"2013-10-31T01:20:08Z","Content":"\n\u003Cp\u003EI was trying to figure out everything that I could about KSPFields and how they work so that I could explain it to others. I am working on a set of examples that I hope others will find helpful: \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/56053-Example-plugin-projects-to-help-you-get-started\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://forum.kerbalspaceprogram.com/threads/56053-Example-plugin-projects-to-help-you-get-started\u003C/a\u003E\u003C/p\u003E\u003Cp\u003ETake a look at \u003Ca href=\u0022https://github.com/taraniselsu/TacExamples/blob/master/02-SimplePartModule/Source/SimplePartModule.cs\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/taraniselsu/TacExamples/blob/master/02-SimplePartModule/Source/SimplePartModule.cs\u003C/a\u003E where I worked out the object life cycle in KSP/Unity. And look at \u003Ca href=\u0022https://github.com/taraniselsu/TacExamples/blob/master/05-KspFields/Source/KspFieldsModule.cs\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/taraniselsu/TacExamples/blob/master/05-KspFields/Source/KspFieldsModule.cs\u003C/a\u003E where I am figuring out how KSPFields work -- not finished though.\u003C/p\u003E\u003Cp\u003EI did find that KSPFields declared as double\u0027s and long\u0027s do not work, only int\u0027s, float\u0027s, string\u0027s, and bool\u0027s. I also cannot get MyType to work even though it should \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_sad.gif\u0022 alt=\u0022:(\u0022\u003E.\u003C/p\u003E\u003Cp\u003EI don\u0027t see anything wrong with the code you posted, so I would add more logging to see what is happening.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Faark\u0022 data-cite=\u0022Faark\u0022\u003E\u003Cdiv\u003E... All actual instance are clones from those and \u003Cspan style=\u0022text-decoration:underline;\u0022\u003E\u003Cem\u003E\u003Cstrong\u003Eshould\u003C/strong\u003E\u003C/em\u003E\u003C/span\u003E also get the same values...\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EEmphasis is mine because I have had many issues with values not being copied from the prefab part to the clones \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_sad.gif\u0022 alt=\u0022:(\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"CelestialMechanic","CreatedById":63925,"CreatedDateTime":"2013-11-03T01:13:19Z","Content":"\n\u003Cp\u003EIt seems to be working (I used a double by mistake) on the primitive types, but IConfigNode implementing classes are still only being loaded once. I worked around this by copying the data manually from part.partInfo.partPrefab, which is the original part loaded by the PartLoader, and whose modules can be searched for the original IConfigNode implementing classes. You may want to make a copy of the data if you plan on changing it, since unless it\u0027s a struct, the copied objects are references.\u003C/p\u003E\n"}]}