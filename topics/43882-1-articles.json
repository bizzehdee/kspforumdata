{"TopicId":43882,"ForumId":36,"TopicTitle":"GameData/Squad/Spaces duplicate asset memory reduction","CreatedByName":"somnambulist","CreatedById":62108,"CreatedDateTime":"2013-08-25T23:47:44Z","PageNum":1,"Articles":[{"CreatedByName":"somnambulist","CreatedById":62108,"CreatedDateTime":"2013-08-25T23:47:44Z","Content":"\n\u003Cp\u003E\u003Ca href=\u0022https://forum.kerbalspaceprogram.com/showthread.php/47579-GameData-Squad-Spaces-duplicate-asset-memory-reduction?p=627152\u0026amp;viewfull=1#post627152\u0022 rel=\u0022external nofollow\u0022\u003E\u003Cstrong\u003E\u003Cspan style=\u0022font-size:8px;\u0022\u003ENow in testing -- see this post!\u003C/span\u003E\u003C/strong\u003E\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EHi all -\u003C/p\u003E\u003Cp\u003EI decided to look into reducing KSPs memory footprint by removing most of the duplicate textures in GameData/Squad/Spaces The approach is similar to what I did with KWRocketry\u002B -- load the assets with model nodes and then use much smaller placeholder textures to keep the part loader happy (see my sig). This would reduce KSP\u0027s overall memory footprint by about 100MB.\u003C/p\u003E\u003Cp\u003EI would, however, like to get some community and, hopefully, mod and dev feedback before I release the files. No Squad assets would be redistributed, but Squad CFGs and assets would be overwritten. My thinking is that it\u0027s no worse than a rescale of stock parts or even TouhouTorpedo\u0027s MK3 internals.\u003C/p\u003E\u003Cp\u003EThoughts?\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-09-01T05:03:00Z\u0022 title=\u002209/01/2013 05:03  AM\u0022 data-short=\u002210 yr\u0022\u003ESeptember 1, 2013\u003C/time\u003E by somnambulist\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"The Destroyer","CreatedById":36109,"CreatedDateTime":"2013-08-25T23:59:42Z","Content":"\n\u003Cp\u003EI would love this. I want MOAR MODS but stupid RAM limit is hindering.\u003C/p\u003E\n"},{"CreatedByName":"Faark","CreatedById":69775,"CreatedDateTime":"2013-08-26T00:39:44Z","Content":"\n\u003Cp\u003EPersonally, i would prefer to not alter files but try to fix things in memory, so you could easily uninstall it without having to reinstall everything from scratch. Have you ruled out this approach? Ofc i don\u0027t know what exactly you are going to do and if it is as easy as messing around with loaded PartModules.\u003C/p\u003E\n"},{"CreatedByName":"somnambulist","CreatedById":62108,"CreatedDateTime":"2013-08-26T00:48:58Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Faark\u0022 data-cite=\u0022Faark\u0022\u003E\u003Cdiv\u003EPersonally, i would prefer to not alter files but try to fix things in memory, so you could easily uninstall it without having to reinstall everything from scratch. Have you ruled out this approach? Ofc i don\u0027t know what exactly you are going to do and if it is as easy as messing around with loaded PartModules.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThere\u0027s really no way to do that outside of a plugin which unloads the assets (*well* beyond my abilities). The part loader loads every file type it recognizes in GameData so just removing references in the cfg isn\u0027t enough.\u003C/p\u003E\n"},{"CreatedByName":"kahlzun","CreatedById":39989,"CreatedDateTime":"2013-08-26T00:51:55Z","Content":"\n\u003Cp\u003Ei just tend to delete the items in spaces that i don\u0027t use.\u003C/p\u003E\u003Cp\u003EThe iva for the Mk2 cockpit is worse than useless.\u003C/p\u003E\n"},{"CreatedByName":"somnambulist","CreatedById":62108,"CreatedDateTime":"2013-08-31T21:27:23Z","Content":"\n\u003Cp\u003EUpdate on this project. I stumbled across a probable bug where trying to change the textures on certain internals prevents that internal from loading and also corrupts any other internal using model nodes to reference that texture (\u003Ca href=\u0022http://bugs.kerbalspaceprogram.com/issues/1256\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://bugs.kerbalspaceprogram.com/issues/1256\u003C/a\u003E in case anyone wants to take a look). Even with that setback, I\u0027ve been able to carve about 90MB out of Squad\u0027s internals without affecting the actual in-game appearance. I should have something releasable by the end of the weekend.\u003C/p\u003E\u003Cp\u003EAs part of this process I\u0027ve uncovered A LOT of textures, normal maps, etc. that could easily be reduced by 25% without affecting apparent in-game quality. I won\u0027t modify and distribute Squad\u0027s IP, but I can write-up a tutorial on how to do it yourself using Photoshop and your favorite text editor and provide a list of the suggested files to edit.\u003C/p\u003E\n"},{"CreatedByName":"Greys","CreatedById":57109,"CreatedDateTime":"2013-09-01T02:02:20Z","Content":"\n\u003Cp\u003EThat\u0027s not really a bug.\u003C/p\u003E\u003Cp\u003EMODEL{} is a config node that only exists in the context of PART{}, that would be to say, it\u0027s a function of PART{} not a concept that just exists.\u003C/p\u003E\u003Cp\u003EWhen you go to INTERNAL{}, MODEL{} isn\u0027t a thing, RESOURCE{} isn\u0027t either and I wouldn\u0027t expect MODULE{} to work either.\u003C/p\u003E\u003Cp\u003EUntil Squad includes MODEL{} in INTERNAL{}, or creates a similar feature in that context, you\u0027re not going to be able to simplify IVAs in that way.\u003C/p\u003E\u003Cp\u003EInstead you may be able to rename the .mu files and textures, dump them all into one folder, and do things that way.\u003C/p\u003E\n"},{"CreatedByName":"somnambulist","CreatedById":62108,"CreatedDateTime":"2013-09-01T02:23:03Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Greys\u0022 data-cite=\u0022Greys\u0022\u003E\u003Cdiv\u003E\u003Cp\u003EMODEL{} is a config node that only exists in the context of PART{}, that would be to say, it\u0027s a function of PART{} not a concept that just exists.\u003C/p\u003E\u003Cp\u003EWhen you go to INTERNAL{}, MODEL{} isn\u0027t a thing, RESOURCE{} isn\u0027t either and I wouldn\u0027t expect MODULE{} to work either.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI thought that, too, but then I reread \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/showthread.php/34013-0-20-PartTools-GameDatabase-and-new-features\u0022 rel=\u0022external nofollow\u0022\u003Emu\u0027s post\u003C/a\u003E\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022mu\u0022 data-cite=\u0022mu\u0022\u003E\u003Cdiv\u003E\u003Cp\u003EParts, Props and InternalSpaces can all use MODEL nodes instead of the traditional same-driectory loading system.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EWorks exactly like mu describes; I\u0027ve got \u0027Squad/Spaces/\u0027 slimmed down to about 184 MB using model nodes and overwriting duplicate textures with small placeholders. \u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://i.imgur.com/jBUx6ng.jpg\u0022 alt=\u0022jBUx6ng.jpg\u0022\u003E\u003C/p\u003E\u003Cp\u003EJust a teaser of the Mark 1-2 Pod running the model node \u0022optimized\u0022 IVA. Overall memory footprint is down ~~110 MB compared to stock with full res textures.\u003C/p\u003E\n"},{"CreatedByName":"somnambulist","CreatedById":62108,"CreatedDateTime":"2013-09-01T05:01:35Z","Content":"\n\u003Cp\u003E\u003Cstrong\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003Ev.1 test release\u003C/span\u003E\u003C/strong\u003E\u003C/p\u003E\u003Cp\u003EBetween thunderstorms and power outages I managed to cobble together an initial test release.\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://i.imgur.com/7wAmdkh.png\u0022 alt=\u00227wAmdkh.png\u0022\u003E\u003C/p\u003E\u003Cp\u003EIn the above screenshot the first instance of KSP is stock, the second instance is after installing the memory optimization. Both were launched at the same time and left to sit idle in the VAB screen for 30 minutes. The savings in that screenshot is about 108 MB -- KSP\u0027s memory use fluctuates a bit, but 110 MB is the average savings. Your savings may vary with lower texture resolution settings.\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003E\u003Cspan style=\u0022font-size:8px;\u0022\u003EInstallation\u003C/span\u003E\u003C/strong\u003E\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022color:#FF0000;\u0022\u003E\u003Cstrong\u003EWARNING: \u003C/strong\u003E\u003C/span\u003E\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cul\u003E\u003Cli\u003EThe Stock Memory Optimization pack overwrites Squad-supplied textures and CFGs. Uninstallation requires reinstalling the contents of \u0027GameData/Squad/Spaces/\u0027. Making a backup of your game folder before proceeding is strongly encouraged.\u003Cbr\u003E\u003C/li\u003E\u003Cli\u003EIf you\u0027ve deleted anything from \u0027GameData/Squad/Spaces/\u0027 you will be missing internal textures. \u003Cbr\u003E\u003C/li\u003E\u003Cli\u003EAdditional third-party internals *may* need to be reinstalled after you install the Stock Memory Optimization.\u003Cbr\u003E\u003C/li\u003E\u003C/ul\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003ETo install:\u003C/strong\u003E Merge the contents of the zip with your GameData folder. Overwrite existing files. \u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003EMac users:\u003C/strong\u003E Download the freeware \u003Ca href=\u0022http://subrosasoft.com/software/freeware/macmerger\u0022 rel=\u0022external nofollow\u0022\u003EMacMerger\u003C/a\u003E and use it to merge the folders. It\u0027s far more reliable than doing it in the Finder. \u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022https://www.dropbox.com/s/802gsijhjt4bkur/Somnambulic%20Aerospace%20Stock%20Memory%20Optimization.zip\u0022 rel=\u0022external nofollow\u0022\u003E\u003Cstrong\u003E\u003Cspan style=\u0022font-size:8px;\u0022\u003EDownload v.1\u003C/span\u003E\u003C/strong\u003E\u003C/a\u003E\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003E\u003Cspan style=\u0022font-size:8px;\u0022\u003EOutstanding issue\u003C/span\u003E\u003C/strong\u003E\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cul\u003E\u003Cli\u003EThe Hitchhiker and the mk1 Pod are not happy with model nodes. They\u0027ll have to remain unoptimized for now.\u003Cbr\u003E\u003C/li\u003E\u003C/ul\u003E\u003Cp\u003E\u003C/p\u003E\n"},{"CreatedByName":"Torminator","CreatedById":78617,"CreatedDateTime":"2013-09-01T05:41:56Z","Content":"\n\u003Cp\u003EThis makes me quite happy. I fully approve of a series of optimization mods.\u003C/p\u003E\n"},{"CreatedByName":"The Destroyer","CreatedById":36109,"CreatedDateTime":"2013-09-01T07:09:34Z","Content":"\n\u003Cp\u003ESo this reduces it by 100 MB, nice!\u003C/p\u003E\n"},{"CreatedByName":"Frogbull","CreatedById":70707,"CreatedDateTime":"2013-09-01T11:06:34Z","Content":"\n\u003Cp\u003EGood work!\u003C/p\u003E\u003Cp\u003EBut one of the most strange thing is that the game load all in one time; why it don\u0027t stream the files ?\u003C/p\u003E\n"},{"CreatedByName":"ahappydude","CreatedById":458,"CreatedDateTime":"2013-09-01T12:54:45Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Frogbull\u0022 data-cite=\u0022Frogbull\u0022\u003E\u003Cdiv\u003EGood work!\u003Cp\u003EBut one of the most strange thing is that the game load all in one time; why it don\u0027t stream the files ?\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EIts magic \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif\u0022 alt=\u0022;)\u0022\u003E This sounds like a great idea and plugin so i will try it today and report back =) Thanks for this, always get a high use of ksp.exe even with few mods, oh i remeber 0.13 i think or 0.12 run flawless\u003C/p\u003E\n"},{"CreatedByName":"somnambulist","CreatedById":62108,"CreatedDateTime":"2013-09-01T16:11:59Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Frogbull\u0022 data-cite=\u0022Frogbull\u0022\u003E\u003Cdiv\u003EBut one of the most strange thing is that the game load all in one time; why it don\u0027t stream the files ?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EHaving all the assets loaded makes switching between craft quicker.\u003C/p\u003E\n"},{"CreatedByName":"Greys","CreatedById":57109,"CreatedDateTime":"2013-09-01T16:36:41Z","Content":"\n\u003Cp\u003EYou still don\u0027t need all the assets loaded. At any given time the crafts that exist in a flight state are only making use of some fraction of the parts that the instance of KSP has access to, and there\u0027s no reason to have full resolution textures for the unused parts on hand when you only need to be able to render the VAB icon; then load better textures when the player actually grabs that part to be used. If you saw \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/showthread.php/35225-Some-lesser-known-bits-of-info-for-addon-developers?p=621957#post621957\u0022 rel=\u0022external nofollow\u0022\u003Emy post in that one thread about load times\u003C/a\u003E, it took about a second and a half to load 30 1024x textures, so loading single parts in step with a player building things in the VAB/SPH, shouldn\u0027t be any sort of problem.\u003C/p\u003E\n"},{"CreatedByName":"Galane","CreatedById":77949,"CreatedDateTime":"2014-06-12T03:56:34Z","Content":"\n\u003Cp\u003EKSP runs into the same problem old CP/M and DOS programs did with their limited amount of available RAM. The common solution was loading \u0022overlays\u0022 or modules with a small core program always loaded to manage it all.\u003C/p\u003E\u003Cp\u003EFor example a word processor would load the core part and the editor module. Then when you went to print it\u0027d kick the editor out and load the printing module. Spell check, word count and other functions all separate modules and if the document being worked on was too large for the remaining RAM (remember, 64 kilobytes for CP/M, the word processor program and the document!) it\u0027d get loaded in chunks from floppy disk then changes, if any, written back before loading the next chunk.\u003C/p\u003E\u003Cp\u003ESpeed wasn\u0027t too bad. If the computer had a hard drive it could be pretty darn quick since it was only displaying and working with plain text.\u003C/p\u003E\u003Cp\u003EProgrammers have gotten a bit soft and spoiled with gigahertz of speed and gigabytes of RAM and storage. The first hard drive I owned was five megabytes and with DOS and all the software I had installed it was only half full. I work with single images and documents every day that wouldn\u0027t fit on that hard drive.\u003C/p\u003E\u003Cp\u003EThis PC is a 2.5 Ghz AMD 7550 dual core with 6 gig RAM and a nVidia 9800 GT video card with a gig of RAM, running 64 bit Windows 7 - yet to get tolerable performance out of KSP I have to disable anti aliasing, disable the VAB/SPH crew and terrain scatter, use Active Texture Management and run at a lower resolution AND turn off the logging.\u003C/p\u003E\u003Cp\u003EBut as has been shown by various mods like ATM it is possible to help the performance. Would be nice if Squad would take a break from adding more features and do an optimization/performance release to clean up loose ends, shrink over-large textures and whatever else they can find to speed it up. I\u0027d bet they\u0027d find a lot of things to prune and tune.\u003C/p\u003E\n"},{"CreatedByName":"Justin Kerbice","CreatedById":101695,"CreatedDateTime":"2014-06-12T06:55:32Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Galane\u0022 data-cite=\u0022Galane\u0022\u003E\u003Cdiv\u003EBut as has been shown by various mods like ATM it is possible to help the performance. Would be nice if Squad would take a break from adding more features and do an optimization/performance release to clean up loose ends, shrink over-large textures and whatever else they can find to speed it up. I\u0027d bet they\u0027d find a lot of things to prune and tune.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EDon\u0027t want to be kind of \u0022rude\u0022 or something but it\u0027s not very relevant to the thread you\u0027ve just unburied \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E.\u003C/p\u003E\u003Cp\u003EI already wrote about this, big issue: mostly noisy morons wants more (see madness around 0.23.5 release !), they don\u0027t care about better, improved, optimized KSP \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_sad.gif\u0022 alt=\u0022:(\u0022\u003E.\u003C/p\u003E\u003Cp\u003EI\u0027m sure they prefer 30 new parts all buggy, badly integrated in career, 30 new bugs than 2 new parts only, 10 bugs fixed for good and better memory management.\u003C/p\u003E\u003Cp\u003EOne thing which could be try is adding one or more \u0022dummy\u0022/holder process(es) which will just keep textures in their own memory space (~4 GB each maybe), which could be at least nice for people who have a computer with more than 4 GB ram.\u003C/p\u003E\n"},{"CreatedByName":"Porkjet","CreatedById":92433,"CreatedDateTime":"2014-06-12T16:00:12Z","Content":"\n\u003Cp\u003EWait a minute... It\u0027s possible to use MODEL {} in an internal CFG??? That\u0027s awesome! Will help optimze my IVA\u0027s aswell.\u003C/p\u003E\n"},{"CreatedByName":"somnambulist","CreatedById":62108,"CreatedDateTime":"2014-06-13T01:11:33Z","Content":"\n\u003Cp\u003EGuessing this got necro\u0027d because I mentioned I might be reviving the work as a replacement for PolecatEZ\u0027s reduction pack. Just deduplification, no size reductions. Any work is going to have to wait a week as I\u0027m out of of town.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Porkjet\u0022 data-cite=\u0022Porkjet\u0022\u003E\u003Cdiv\u003EWait a minute... It\u0027s possible to use MODEL {} in an internal CFG??? That\u0027s awesome! Will help optimze my IVA\u0027s aswell.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EJah. It works just like it does on a part.\u003C/p\u003E\n"},{"CreatedByName":"nanowinner","CreatedById":100275,"CreatedDateTime":"2014-07-09T21:19:03Z","Content":"\n\u003Cp\u003EKeep it up!\u003C/p\u003E\n"},{"CreatedByName":"sharpspoonful","CreatedById":83734,"CreatedDateTime":"2014-07-09T21:44:49Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022somnambulist\u0022 data-cite=\u0022somnambulist\u0022\u003E\u003Cdiv\u003EGuessing this got necro\u0027d because I mentioned I might be reviving the work as a replacement for PolecatEZ\u0027s reduction pack. Just deduplification, no size reductions. Any work is going to have to wait a week as I\u0027m out of of town.\u003Cp\u003EJah. It works just like it does on a part.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI\u0027ve always been curious as to why the KSP preloaded all the texture files to RAM, when most games nowadays have placeholder textures that get swapped to full textures when needed. \u003C/p\u003E\u003Cp\u003EIt seems, and is, extremely inefficient.\u003C/p\u003E\n"}]}