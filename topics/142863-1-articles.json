{"TopicId":142863,"ForumId":29,"TopicTitle":"[SOLVED] Remove Module AnimateGeneric Buttons","CreatedByName":"Fengist","CreatedById":78435,"CreatedDateTime":"2016-06-30T18:30:37Z","PageNum":1,"Articles":[{"CreatedByName":"Fengist","CreatedById":78435,"CreatedDateTime":"2016-06-30T18:30:38Z","Content":"\n\u003Cp\u003E\nOk, so goofing off with a plugin and AnimateGeneric. \u00A0It appears my plugin won\u0027t run the animation unless it\u0027s defined in the part as AnimateGeneric. \u00A0So, here\u0027s the question. \u00A0Is there any way to turn off that \u0027toggle\u0027 button you get when you right click on a part? \u00A0I want the plugin to handle all of the animations and not the user.\n\u003C/p\u003E\n\u003Cp\u003E\nThanks\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-07-04T03:14:52Z\u0022 title=\u002207/04/2016 03:14  AM\u0022 data-short=\u00228 yr\u0022\u003EJuly 4, 2016\u003C/time\u003E by Fengist\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Shadowmage","CreatedById":138730,"CreatedDateTime":"2016-07-01T16:56:23Z","Content":"\n\u003Cp\u003E\nSome config fields are available in the stock ModuleAnimateGeneric; have never tried them myself (I use a custom animation handler in my plugin code), so not precisely sure what they all do:\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003E\t[KSPField]\n\tpublic bool actionAvailable = true;\n\n\t[KSPField]\n\tpublic bool eventAvailableEditor = true;\n\n\t[KSPField]\n\tpublic bool eventAvailableFlight = true;\n\n\t[KSPField]\n\tpublic bool eventAvailableEVA = true;\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nIt seems that those are likely intended for much what you are looking for -- disabling the right-click menu to let an external module handle the state changes.\n\u003C/p\u003E\n\u003Cp\u003E\nAction generally refers to action group (so actionAvailable determines if the action group should be enabled).\u00A0 Event generally refers to the right-click menu (so the eventAvailableXXX determines when the right-click button is present).\n\u003C/p\u003E\n"},{"CreatedByName":"Fengist","CreatedById":78435,"CreatedDateTime":"2016-07-01T20:34:15Z","Content":"\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/138730-shadowmage/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022138730\u0022 href=\u0022%7B___base_url___%7D/index.php?/profile/138730-shadowmage/\u0022 rel=\u0022\u0022\u003E@Shadowmage\u003C/a\u003E\u00A0Yep, tried all those, and while they remove the buttons, it then displays a huge box (12 animation) showing they\u0027re all locked.\n\u003C/p\u003E\n"},{"CreatedByName":"Shadowmage","CreatedById":138730,"CreatedDateTime":"2016-07-01T20:42:04Z","Content":"\n\u003Cp\u003E\nHave you tried manually disabling the ModuleAnimateGenerics \u0027status\u0027 field through your custom plugin?\n\u003C/p\u003E\n\u003Cp\u003E\nBasically doing:\n\u003C/p\u003E\n\u003Cp\u003E\nmoduleAnimateGeneric.Fields[\u0022status\u0022].guiActive = false;\u003Cbr\u003E\nmoduleAnimateGeneric.Fields[\u0022status\u0022].guiActiveEditor = false;\n\u003C/p\u003E\n\u003Cp\u003E\nfor each of your controlled animation modules.\u00A0 The best place to do this would probably be during the Unity Start() lifetime event/method.\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027ve certainly done similar for other stock modules while interfacing/interacting with my custom plugins; have not tried it on the stock MAG because I avoid where possible, but there is a chance it will work with that one as well.\n\u003C/p\u003E\n"},{"CreatedByName":"Fengist","CreatedById":78435,"CreatedDateTime":"2016-07-04T03:14:16Z","Content":"\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/138730-shadowmage/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022138730\u0022 href=\u0022%7B___base_url___%7D/index.php?/profile/138730-shadowmage/\u0022 rel=\u0022external\u0022\u003E@Shadowmage\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nThanks Shadow!\u00A0Worked like a charm. \u00A0Plopped it in the OnStart where I force all the animations to rewind and... no more annoying GUI,\u00A0in \u003Cabbr title=\u0022SpacePlane Hangar\u0022\u003E\u003Cabbr title=\u0022SpacePlane Hangar\u0022\u003ESPH\u003C/abbr\u003E\u003C/abbr\u003E or flight.\n\u003C/p\u003E\n\u003Cp\u003E\nAnd for anyone else who finds this and needs the solution for disabling the gui for multiple animations on one part (and for when I lose this chunk of code and forget how it\u0027s done), solution below.\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003E                List\u003C/span\u003E\u003Cspan class=\u0022tag\u0022\u003E\u0026lt;ModuleAnimateGeneric\u0026gt;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E MAGlist = part.FindModulesImplementing\u003C/span\u003E\u003Cspan class=\u0022tag\u0022\u003E\u0026lt;ModuleAnimateGeneric\u0026gt;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E();\n                foreach (ModuleAnimateGeneric MAG in MAGlist)\n                {\n                    MAG.Fields[\u0022status\u0022].guiActive = false;\n                    MAG.Fields[\u0022status\u0022].guiActiveEditor = false;\n                }\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nOne thing I didn\u0027t expect to have happen after running this code tho... \u00A0I still had to set all the flag in the .cfg. \u00A0If they\u0027re not set, it still shows them. \u00A0I guess I could have just set them in the plugin, but this works. \u00A0The user can remove them if they wanna play with the lights I guess.\n\u003C/p\u003E\n\u003Cp\u003E\nThanks again.\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003E     MODULE\n     {\n\t\tname = ModuleAnimateGeneric\n\t\tanimationName = Batt Red Anim\n\t\teventAvailableEditor=false\n\t\teventAvailableFlight=false\n\t\teventAvailableEVA=false\n\t\tallowManualControl=false\n     }\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-07-04T03:23:44Z\u0022 title=\u002207/04/2016 03:23  AM\u0022 data-short=\u00228 yr\u0022\u003EJuly 4, 2016\u003C/time\u003E by Fengist\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Stone Blue","CreatedById":77721,"CreatedDateTime":"2016-07-04T03:54:07Z","Content":"\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/78435-fengist/\u0026amp;do=hovercard\u0022 data-mentionid=\u002278435\u0022 href=\u0022%7B___base_url___%7D/index.php?/profile/78435-fengist/\u0022 rel=\u0022\u0022\u003E@Fengist\u003C/a\u003E Do you mind if I piggy back your topic, with a sort of connected question? (If so, LMK \u0026amp; I\u0027ll delete my post)\u003Cbr\u003E\u003Cbr\u003E\nI want to combine a ModuleAnimateGeneric, with a ModuleGenerator... Or I should say, I want to activate the Generator, behind the scenes, triggered by the toggling of the AnimateGeneric... Any idea how I would do that?\n\u003C/p\u003E\n\u003Cp\u003E\nHeres the \u0022Lights\u0022 module:\u003Cbr\u003E\u003Cbr\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003EMODULE\n{\n\tname = ModuleAnimateGeneric\n\tanimationName = lights\n\tactionGUIName = Toggle Lights\n\tstartEventGUIName =  Lights On\n\tendEventGUIName = Lights Off\n\tinstantAnimInEditor = false \n}\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nAnd heres the \u0022Power ON\u0022 module, I would like to trigger with the above \u0022Toggle Lights\u0022 animation:\u003Cbr\u003E\u003Cbr\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003EMODULE\n{\n\tname = ModuleGenerator\n\tactivateGUIName\t= \u0022Power suply ON\u0022\n\tshutdownGUIName = \u0022Power suply OFF\u0022\n\tINPUT_RESOURCE\n     {\n     \tname = ElectricCharge\n\t\trate = 0.02\n     }\n\tOUTPUT_RESOURCE\n\t{\n\t   name = GLight\n\t   rate = 0.1\n\t}\t \t\t  \n}\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"Fengist","CreatedById":78435,"CreatedDateTime":"2016-07-04T04:19:13Z","Content":"\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/77721-stone-blue/\u0026amp;do=hovercard\u0022 data-mentionid=\u002277721\u0022 href=\u0022%7B___base_url___%7D/index.php?/profile/77721-stone-blue/\u0022 rel=\u0022external\u0022\u003E@Stone Blue\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nNo, I don\u0027t mind at all, but I\u0027m not sure you\u0027ll get a decent answer.\n\u003C/p\u003E\n\u003Cp\u003E\nI can tell you how I\u0027d do it but you\u0027re going to need to write some C# code.\n\u003C/p\u003E\n\u003Cp\u003E\nI basically did just this with the Idiot Lights I just released, the only difference is, instead of waiting for a generator to turn on or off, it checks the levels of fuels. \u00A0You\u0027ll basically need to check the status of the ModuleGenerator to see if it\u0027s turned off or on. \u00A0Off the top of my head I\u0027m not positive how that\u0027s done.\u00A0I\u0027d have to dig to figure that out. \u00A0If that proves too difficult, you could check the part that contains the resource GLight and see if it\u0027s increasing, or decreasing. \u00A0Once you figure out if GLight is being made you can play an animation like this:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003Epublic void Play_Anim(string aname, float aspeed, float atime)\n            {\n                try\n                {\n                    Animation anim;\n                    Animation[] animators = part.FindModelAnimators(aname);\n                    if (animators.Length \u0026gt; 0)\n                    {\n                        anim = animators[0];\n                        anim.clip = anim.GetClip(animationName);\n                        anim[aname].speed = aspeed;\n                        anim[aname].normalizedTime = atime;\n                        anim.Play(aname);\n                    }\n                }\n                catch (Exception ex)\n                {\n                    MPLog.Writelog(\u0022[Idiot Lights] Exception in Play_Anim\u0022);\n                    MPLog.Writelog(\u0022[Idiot Lights]  Err: \u0022 \u002B ex);\n                }\n            }\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nWhen you call that function you pass it 3 paramaters\n\u003C/p\u003E\n\u003Col\u003E\u003Cli\u003E\nThe name of the animation. In your case lights.\n\u003C/li\u003E\n\u003Cli\u003E\nThe direction you want it to play. \u00A0This is a simple positive 1 for forward and negative 1 for reverse.\n\u003C/li\u003E\n\u003Cli\u003E\nThe speed in seconds.\n\u003C/li\u003E\n\u003C/ol\u003E\u003Cp\u003E\nSo it would look like this:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003EPlay_Anim(\u0022lights\u0022, 1.0f, 1.0f);\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nSo, when it turns on, you call it like above to turn the light on. \u00A0When it turns off, you play the animation in reverse:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003EPlay_Anim(\u0022lights\u0022, -1.0f, 1.0f);\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nWax on, wax off.\n\u003C/p\u003E\n\u003Cp\u003E\nHope that helps.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nUmmm ooops... I just read you wanna do it backwards!....\n\u003C/p\u003E\n\u003Cp\u003E\nYou wanna have the user turn the lights on and then fire up the generator.\n\u003C/p\u003E\n\u003Cp\u003E\nWell, that\u0027s a bit different but you\u0027ll still need some C# coding to do that. \u00A0I don\u0027t think there\u0027s any way to do it in just a .cfg file. \u00A0You\u0027re best be will probably be to create your own partmodule and put that in the .cfg file with the animation.\n\u003C/p\u003E\n\u003Cp\u003E\nThat way, you can check the status of the lights animation to determine if it\u0027s on or off and then, finding the part with the resource GLight, getting the id for that resource and then...\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003Epart.TransferResource(GetResourceID(mypart,\u0022GLight\u0022), amount);\n\npublic static int GetResourceID(this Part part, string resourceName)\n        {\n            PartResourceDefinition resource = PartResourceLibrary.Instance.GetDefinition(resourceName);\n            return resource.id;\n        }\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nBut, this gets even messier because you\u0027ll need to keep track of how much resource you have \u0026amp; the max amount you can have.\n\u003C/p\u003E\n\u003Cp\u003E\nPM me if you need help figuring it out.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-07-04T04:49:49Z\u0022 title=\u002207/04/2016 04:49  AM\u0022 data-short=\u00228 yr\u0022\u003EJuly 4, 2016\u003C/time\u003E by Fengist\u003C/strong\u003E\n\u003C/span\u003E\n"}]}