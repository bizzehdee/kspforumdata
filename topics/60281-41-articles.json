{"TopicId":60281,"ForumId":36,"TopicTitle":"[Hardware, Plugin] Arduino based physical display \u002B serial port io\u002B tutorial (24-11-19)","CreatedByName":"zitronen","CreatedById":11842,"CreatedDateTime":"2014-01-18T01:25:25Z","PageNum":41,"Articles":[{"CreatedByName":"Nuke","CreatedById":10883,"CreatedDateTime":"2015-06-02T10:31:13Z","Content":"\n\u003Cp\u003Ei was just playing around with one of those esp8266 boards. its pretty nifty. i was able to get it on my network in a single evening and got it talking to a lua script on another rig. it also only takes 5 connections to my arduino due (if you run a 3.3v board, 5v needs level conversion). it also has a very simple at command set over serial, so you dont need any libraries to use it. supposedly you can run the thing stand alone though the mcu on the module doesnt have a whole lot of i/o. anyone using these things yet?\u003C/p\u003E\u003Cp\u003Edid we ever get an over ip version of this interface?\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-06-02T10:35:49Z\u0022 title=\u002206/02/2015 10:35  AM\u0022 data-short=\u00229 yr\u0022\u003EJune 2, 2015\u003C/time\u003E by Nuke\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Freshmeat","CreatedById":111048,"CreatedDateTime":"2015-06-02T12:09:33Z","Content":"\n\u003Cp\u003EShort answer is no. You where able to acces KSP over http via Telemarchus, but it is out of date now. I do not think that zitronen has ever considered IP connectivity.\u003C/p\u003E\n"},{"CreatedByName":"zitronen","CreatedById":11842,"CreatedDateTime":"2015-06-06T22:27:11Z","Content":"\n\u003Cp\u003E\u003Cspan\u003EUpdate 0.17.3\u003C/span\u003E\u003C/p\u003E\u003Cp\u003EChanged:\u003C/p\u003E\u003Cp\u003EAdded max overheat (Sputnix request) - byte, reports the overheat percentage of the part mostly likely to explode \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 alt=\u0022:D\u0022\u003E\u003C/p\u003E\u003Cp\u003EAdded Mach number - float\u003C/p\u003E\u003Cp\u003EAdded indicated air speed (IAS) - float m/s\u003C/p\u003E\u003Cp\u003EPlugin:\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022https://sites.google.com/site/zitronfiles/KSPSerialIO_017_3.zip\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://sites.google.com/site/zitronfiles/KSPSerialIO_017_3.zip\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EArduino Code:\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022https://sites.google.com/site/zitronfiles/KSPIODemo12.zip\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://sites.google.com/site/zitronfiles/KSPIODemo12.zip\u003C/a\u003E\u003C/p\u003E\n"},{"CreatedByName":"cino","CreatedById":145619,"CreatedDateTime":"2015-06-07T04:19:30Z","Content":"\n\u003Cp\u003EHow do I Change the LED Pin 5 6 7\u003C/p\u003E\u003Cp\u003EI think it looks better when they are on and get off when fuel is empty.\u003C/p\u003E\n"},{"CreatedByName":"Freshmeat","CreatedById":111048,"CreatedDateTime":"2015-06-07T11:55:09Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022zitronen\u0022 data-cite=\u0022zitronen\u0022\u003E\u003Cdiv\u003E\u003Cspan\u003EUpdate 0.17.3\u003C/span\u003E\u003Cp\u003EChanged:\u003C/p\u003E\u003Cp\u003EAdded max overheat (Sputnix request) - byte, reports the overheat percentage of the part mostly likely to explode \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 alt=\u0022:D\u0022\u003E\u003C/p\u003E\u003Cp\u003EAdded Mach number - float\u003C/p\u003E\u003Cp\u003EAdded indicated air speed (IAS) - float m/s\u003C/p\u003E\u003Cp\u003EPlugin:\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022https://sites.google.com/site/zitronfiles/KSPSerialIO_017_3.zip\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://sites.google.com/site/zitronfiles/KSPSerialIO_017_3.zip\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EArduino Code:\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022https://sites.google.com/site/zitronfiles/KSPIODemo12.zip\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://sites.google.com/site/zitronfiles/KSPIODemo12.zip\u003C/a\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EWhat a coincidence, I finally assembled the joystick module of my new controller. Expect details soonish.\u003C/p\u003E\n"},{"CreatedByName":"Freshmeat","CreatedById":111048,"CreatedDateTime":"2015-06-08T07:06:54Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022cino\u0022 data-cite=\u0022cino\u0022\u003E\u003Cdiv\u003EHow do I Change the LED Pin 5 6 7\u003Cp\u003EI think it looks better when they are on and get off when fuel is empty.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThis is based on Demo10, I do not think it has changed line numbers in later versions\u003C/p\u003E\u003Cp\u003EIn the utilities code, exchange HIGH for LOW and LOW for HIGH in lines 11, 13, 16, 19:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Evoid Indicators() {\u003Cbr\u003E  caution = 0;\u003Cbr\u003E  warning = 0;\u003Cbr\u003E\u003Cbr\u003E  caution \u002B= VData.G \u0026gt; GCAUTION;\u003Cbr\u003E  warning \u002B= VData.G \u0026gt; GWARN;\u003Cbr\u003E  caution \u002B= VData.LiquidFuelS/VData.LiquidFuelTotS*100 \u0026lt; FUELCAUTION;\u003Cbr\u003E  warning \u002B= VData.LiquidFuelS/VData.LiquidFuelTotS*100 \u0026lt; FUELWARN;\u003Cbr\u003E\u003Cbr\u003E  if (caution != 0)\u003Cbr\u003E    digitalWrite(YLED,[B]LOW[/B]); //---used to be HIGH\u003Cbr\u003E  else\u003Cbr\u003E    digitalWrite(YLED,[B]HIGH[/B]); //---used to be LOW\u003Cbr\u003E\u003Cbr\u003E  if (warning != 0)\u003Cbr\u003E    digitalWrite(RLED,[B]LOW[/B]);  //---used to be HIGH\u003Cbr\u003E  else\u003Cbr\u003E    digitalWrite(RLED,[B]HIGH[/B]); //---used to be LOW\u003Cbr\u003E\u003Cbr\u003E  digitalWrite(SASLED,ControlStatus(AGSAS));\u003Cbr\u003E  digitalWrite(RCSLED,ControlStatus(AGRCS));\u003Cbr\u003E  digitalWrite(CG1LED,ControlStatus(AGCustom01));\u003Cbr\u003E}\u003Cbr\u003E......\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n"},{"CreatedByName":"jul3q","CreatedById":141642,"CreatedDateTime":"2015-06-08T17:24:34Z","Content":"\n\u003Cp\u003EI am in the process of constructing my KSP controller. I\u0027ve got everything planned out, I\u0027ve assembled most of it as a prototype but I can\u0027t really comprehend how to use this plugin. I don\u0027t get all those handshakes and weird communication functions in the example. I wouldn\u0027t be able to write those things. I have some knowledge of Arduino and C/C\u002B\u002B programming but how to approach this project? Should I copy the example and just change the Input and Output files or what? In the beginning I just want to achieve any form of communication programmed by me but I really don\u0027t know how to get started. Could someone please explain to me the first step using this plugin?\u003C/p\u003E\n"},{"CreatedByName":"Freshmeat","CreatedById":111048,"CreatedDateTime":"2015-06-08T17:53:05Z","Content":"\n\u003Cp\u003EThe only things you need to touch in the beginning are in the utilities (for indicators) and output (for controlling the vessel) files. I just comment out what I do not need and write new code as I go along, but the main structure is wholly taken from zitronens demos. Read through the KSPIODemo file to see what info you get and send each packet, and go from there.\u003C/p\u003E\u003Cp\u003EAnd ask questions here. People are likely to fall over one another to help, esp. if the find your problem a challenge. Be as specific when you ask as possible, post the code you tried and explain what you wanted it to do, and what it did.\u003C/p\u003E\n"},{"CreatedByName":"zitronen","CreatedById":11842,"CreatedDateTime":"2015-06-09T12:28:01Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022jul3q\u0022 data-cite=\u0022jul3q\u0022\u003E\u003Cdiv\u003EI am in the process of constructing my KSP controller. I\u0027ve got everything planned out, I\u0027ve assembled most of it as a prototype but I can\u0027t really comprehend how to use this plugin. I don\u0027t get all those handshakes and weird communication functions in the example. I wouldn\u0027t be able to write those things. I have some knowledge of Arduino and C/C\u002B\u002B programming but how to approach this project? Should I copy the example and just change the Input and Output files or what? In the beginning I just want to achieve any form of communication programmed by me but I really don\u0027t know how to get started. Could someone please explain to me the first step using this plugin?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYeah what freshmeat said. The documentation of the protocol is for people who want to roll their own thing. It\u0027s very easy to get the tutorial working and go from there.\u003C/p\u003E\n"},{"CreatedByName":"cino","CreatedById":145619,"CreatedDateTime":"2015-06-09T14:57:57Z","Content":"\n\u003Cp\u003EI have a Problem with my Uno. I upload the firmware but nothing will run. But I have several Nano\u00C3\u201A\u00C2\u00B4s and with them everything is ok.\u003C/p\u003E\u003Cp\u003EI gave the Uno Port No 4 and the Nano\u00C3\u201A\u00C2\u00B4s Port No 2.\u003C/p\u003E\u003Cp\u003EI checked the IO from the Uno with the Standard Firmata Firmware and their own Checkprogram. With this setup everything is ok.\u003C/p\u003E\u003Cp\u003EI would like to the my LCDKeypadshield but nothing happens with the Uno.\u003C/p\u003E\n"},{"CreatedByName":"Freshmeat","CreatedById":111048,"CreatedDateTime":"2015-06-09T16:07:07Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022cino\u0022 data-cite=\u0022cino\u0022\u003E\u003Cdiv\u003EI have a Problem with my Uno. I upload the firmware but nothing will run. But I have several Nano\u00C3\u201A\u00C2\u00B4s and with them everything is ok.\u003Cp\u003EI gave the Uno Port No 4 and the Nano\u00C3\u201A\u00C2\u00B4s Port No 2.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EHave you set the correct port number in the KSPSerialIO config file? My Mega is acting up if it does not get the correct port from the config file, even if it should autodetect.\u003C/p\u003E\n"},{"CreatedByName":"cino","CreatedById":145619,"CreatedDateTime":"2015-06-09T16:17:50Z","Content":"\n\u003Cp\u003EYes i wrote it into the file. I think it reads the config cause i must change it to use it with the nano.\u003C/p\u003E\n"},{"CreatedByName":"cino","CreatedById":145619,"CreatedDateTime":"2015-06-09T16:55:11Z","Content":"\n\u003Cp\u003EI must add that the rx led is flashing.\u003C/p\u003E\u003Cp\u003ELog with UNO it doesnt run\u003C/p\u003E\u003Cp\u003E[LOG 01:29:36.239] KSPSerialIO: Default Port = COM1\u003C/p\u003E\u003Cp\u003E[LOG 01:29:36.239] KSPSerialIO: Refreshrate = 0.08\u003C/p\u003E\u003Cp\u003E[LOG 01:29:36.240] KSPSerialIO: BaudRate = 38400\u003C/p\u003E\u003Cp\u003E[LOG 01:29:36.240] KSPSerialIO: Handshake Delay = 2500\u003C/p\u003E\u003Cp\u003E[LOG 01:29:36.240] KSPSerialIO: Pitch Enable = 2\u003C/p\u003E\u003Cp\u003E[LOG 01:29:36.241] KSPSerialIO: Roll Enable = 2\u003C/p\u003E\u003Cp\u003E[LOG 01:29:36.241] KSPSerialIO: Yaw Enable = 2\u003C/p\u003E\u003Cp\u003E[LOG 01:29:36.242] KSPSerialIO: Translate X Enable = 2\u003C/p\u003E\u003Cp\u003E[LOG 01:29:36.242] KSPSerialIO: Translate Y Enable = 2\u003C/p\u003E\u003Cp\u003E[LOG 01:29:36.242] KSPSerialIO: Translate Z Enable = 2\u003C/p\u003E\u003Cp\u003E[LOG 01:29:36.243] KSPSerialIO: Wheel Steering Enable = 2\u003C/p\u003E\u003Cp\u003E[LOG 01:29:36.243] KSPSerialIO: Throttle Enable = 2\u003C/p\u003E\u003Cp\u003E[LOG 01:29:36.244] KSPSerialIO: Wheel Throttle Enable = 2\u003C/p\u003E\u003Cp\u003E[LOG 01:29:36.244] KSPSerialIO: SAS Tol = 0.1\u003C/p\u003E\u003Cp\u003E[LOG 01:34:36.614] KSPSerialIO: Version 0.17.1\u003C/p\u003E\u003Cp\u003E[LOG 01:34:36.614] KSPSerialIO: Getting serial ports...\u003C/p\u003E\u003Cp\u003E[LOG 01:34:36.614] KSPSerialIO: Output packet size: 179/255\u003C/p\u003E\u003Cp\u003E[LOG 01:34:36.616] KSPSerialIO: Found 2 serial ports\u003C/p\u003E\u003Cp\u003E[LOG 01:34:36.617] KSPSerialIO: trying default port COM1\u003C/p\u003E\u003Cp\u003E[LOG 01:34:39.240] KSPSerialIO: found KSP Display at COM1\u003C/p\u003E\u003Cp\u003E[LOG 01:34:46.094] KSPSerialIO: Handshake received - 314\u003C/p\u003E\u003Cp\u003EWith Nano everything is ok\u003C/p\u003E\u003Cp\u003E[LOG 01:43:05.823] KSPSerialIO: Default Port = COM4\u003C/p\u003E\u003Cp\u003E[LOG 01:43:05.824] KSPSerialIO: Refreshrate = 0.08\u003C/p\u003E\u003Cp\u003E[LOG 01:43:05.824] KSPSerialIO: BaudRate = 38400\u003C/p\u003E\u003Cp\u003E[LOG 01:43:05.825] KSPSerialIO: Handshake Delay = 2500\u003C/p\u003E\u003Cp\u003E[LOG 01:43:05.825] KSPSerialIO: Pitch Enable = 2\u003C/p\u003E\u003Cp\u003E[LOG 01:43:05.825] KSPSerialIO: Roll Enable = 2\u003C/p\u003E\u003Cp\u003E[LOG 01:43:05.826] KSPSerialIO: Yaw Enable = 2\u003C/p\u003E\u003Cp\u003E[LOG 01:43:05.826] KSPSerialIO: Translate X Enable = 2\u003C/p\u003E\u003Cp\u003E[LOG 01:43:05.827] KSPSerialIO: Translate Y Enable = 2\u003C/p\u003E\u003Cp\u003E[LOG 01:43:05.827] KSPSerialIO: Translate Z Enable = 2\u003C/p\u003E\u003Cp\u003E[LOG 01:43:05.827] KSPSerialIO: Wheel Steering Enable = 2\u003C/p\u003E\u003Cp\u003E[LOG 01:43:05.828] KSPSerialIO: Throttle Enable = 2\u003C/p\u003E\u003Cp\u003E[LOG 01:43:05.828] KSPSerialIO: Wheel Throttle Enable = 2\u003C/p\u003E\u003Cp\u003E[LOG 01:43:05.828] KSPSerialIO: SAS Tol = 0.1\u003C/p\u003E\u003Cp\u003E[LOG 01:44:04.383] KSPSerialIO: Version 0.17.1\u003C/p\u003E\u003Cp\u003E[LOG 01:44:04.383] KSPSerialIO: Getting serial ports...\u003C/p\u003E\u003Cp\u003E[LOG 01:44:04.383] KSPSerialIO: Output packet size: 179/255\u003C/p\u003E\u003Cp\u003E[LOG 01:44:04.385] KSPSerialIO: Found 2 serial ports\u003C/p\u003E\u003Cp\u003E[LOG 01:44:04.386] KSPSerialIO: trying default port COM4\u003C/p\u003E\u003Cp\u003E[LOG 01:44:07.008] KSPSerialIO: found KSP Display at COM4\u003C/p\u003E\u003Cp\u003E[LOG 01:44:13.808] KSPSerialIO: Handshake received - 314\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-06-09T23:48:57Z\u0022 title=\u002206/09/2015 11:48  PM\u0022 data-short=\u00229 yr\u0022\u003EJune 9, 2015\u003C/time\u003E by cino\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"jul3q","CreatedById":141642,"CreatedDateTime":"2015-06-10T13:54:59Z","Content":"\n\u003Cp\u003Ezitronen. Would you consider giving us access to TWR reading in VesselData?\u003C/p\u003E\n"},{"CreatedByName":"Freshmeat","CreatedById":111048,"CreatedDateTime":"2015-06-10T18:14:26Z","Content":"\n\u003Cp\u003E@cino: According to the log, it finds the UNO. Have you tried running something else to get some LEDs showing, to test the pins?\u003C/p\u003E\n"},{"CreatedByName":"T.A.P.O.R.","CreatedById":137748,"CreatedDateTime":"2015-06-10T20:33:39Z","Content":"\n\u003Cp\u003EI had an issue with my PC constantly creating a new port every time I plugged/unplugged my uno.\u003C/p\u003E\u003Cp\u003EThe solution was to manually clear out the com ports through a tutorial like \u003Ca href=\u0022https://answers.microsoft.com/en-us/windows/forum/windows_7-hardware/how-do-i-delete-the-unused-com-ports-in-windows-7/4bb72733-1be0-4168-9ba5-68dcb72d31d9\u0022 rel=\u0022external nofollow\u0022\u003Ethis one\u003C/a\u003E.\u003C/p\u003E\n"},{"CreatedByName":"jandcando","CreatedById":66121,"CreatedDateTime":"2015-06-10T20:39:30Z","Content":"\n\u003Cp\u003EI have a question about action group behavior. For example, when using the standard action group code I set an action group to toggle a landing leg. But when I press the corresponding button on my controller, I need to hold the button down for the gear to stay extended. When I let go of the button, it retracts. I have coded a really messy solution to this problem in my code, but I want to know if any of you guys have an efficient way to solve this problem.\u003C/p\u003E\n"},{"CreatedByName":"stibbons","CreatedById":57865,"CreatedDateTime":"2015-06-11T00:45:48Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022jandcando\u0022 data-cite=\u0022jandcando\u0022\u003E\u003Cdiv\u003EFor example, when using the standard action group code I set an action group to toggle a landing leg. But when I press the corresponding button on my controller, I need to hold the button down for the gear to stay extended. When I let go of the button, it retracts. I have coded a really messy solution to this problem in my code, but I want to know if any of you guys have an efficient way to solve this problem.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EMy button handling uses some advanced concepts, but is fairly simple and, IMO, very efficient. It relies on storing button states as individual bits in larger numbers; an unsigned integer stores 16 inputs. This means a lot of bitwise math, which is hard for me to comprehend properly without my morning coffee. But it means I can latch all ten control group buttons in a few operations.\u003C/p\u003E\u003Cp\u003EFirst, reading in the inputs. Define a uint16_t buffer to hold the readings. Reading pins in to this buffer uses the same bit shifting code zitronen used in his example sketch. My live sketch is much more convoluted than this because I\u0027m reading 32 pins through a multiplexed shield, so I haven\u0027t actually tested the below code. But it\u0027ll be close to working!\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Euint16_t read_controlgroups() {\u003Cbr\u003E  uint16_t controlgroup_buf;\u003Cbr\u003E  for (int i=0; i\u0026lt;10; i\u002B\u002B) {\u003Cbr\u003E    if (digitalRead(16\u002Bi)) { // first action group is on pin 16, so add that to i\u003Cbr\u003E      controlgroup_buf |= 1 \u0026lt;\u0026lt; i; // bit-shift a 1 in to the buffer\u003Cbr\u003E    } else {\u003Cbr\u003E      controlgroup_buf \u0026amp;= ~(1 \u0026lt;\u0026lt; i); // bit-shift a 0 in to the buffer\u003Cbr\u003E  }\u003Cbr\u003E  i \u0026lt;\u0026lt; 6; // shift six more bits across so the first bit matches the first control group\u003Cbr\u003E  return controlgroup_buf;\u003Cbr\u003E}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003ETo do software debouncing, I cribbed a technique from \u003Ca href=\u0022https://www.embedded.com/electronics-blogs/break-points/4024981/My-favorite-software-debouncers\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://www.embedded.com/electronics-blogs/break-points/4024981/My-favorite-software-debouncers\u003C/a\u003E . Raw readings are placed in a circular buffer, and debouncing is done by a bitwise AND of all the buffer elements.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E#define NUM_READINGS 3\u003Cbr\u003Euint16_t raw_controlgroup[NUM_READINGS];\u003Cbr\u003Eint controlgroup_idx = 0; // current index in the raw controlgroup buffer\u003Cbr\u003E\u003Cbr\u003Euint16_t debounce_controlgroups() {\u003Cbr\u003E  // First, read current CG status in to the buffer\u003Cbr\u003E  raw_controlgroup[controlgroup_idx] = read_controlgroups();\u003Cbr\u003E  \u002B\u002Bcontrolgroup_idx;\u003Cbr\u003E  if (controlgroup_idx == NUM_READINGS) controlgroup_idx = 0;\u003Cbr\u003E\u003Cbr\u003E  uint16_t debounced = 0xffff;\u003Cbr\u003E  for (int i=0; i\u0026lt;NUM_READINGS; i\u002B\u002B) {\u003Cbr\u003E    debounced = debounced \u0026amp; raw_controlgroup[i];\u003Cbr\u003E  }\u003Cbr\u003E\u003Cbr\u003E  return debounced;\u003Cbr\u003E}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003ENow for the button latching. We need to keep the last debounced state and the current debounced state. When a button\u0027s state changes from low to high, we need to flip the latched state. To figure that out I had to draw up a Karnaugh map for the first time since the late 90s, but ended up doing it like this:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Euint16_t cur_controlgroup = 0; // The most recent debounced controlgroup reading\u003Cbr\u003Euint16_t last_controlgroup = 0; // The last debounced controlgroup reading\u003Cbr\u003Euint16_t latched_controlgroup = 0; // Controlgroup state after latching button presses\u003Cbr\u003E\u003Cbr\u003Evoid latch_controlgroups() {\u003Cbr\u003E  // rotate and get new controlgroup readings\u003Cbr\u003E  last_controlgroup = cur_controlgroup;\u003Cbr\u003E  cur_controlgroup = debounce_controlgroups();\u003Cbr\u003E\u003Cbr\u003E  uint16_t mask;\u003Cbr\u003E  mask = ~last_controlgroup \u0026amp; cur_controlgroup; // Mask of all inputs that have changed between last and current\u003Cbr\u003E  mask = mask \u0026amp; cur_controlgroup; // Mask now only contains changed inputs that are high in current reading (and low in last)\u003Cbr\u003E  latched_controlgroup = latched_controlgroup ^ mask; // Apply mask to flip controlgroups that have changed\u003Cbr\u003E}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003ESet up your sketch to call latch_controlgroups() every 5ms, and the latched_controlgroup variable will contain control group states that flip on and off every time the buttons are pressed. You can just copy latched_controlgroup in to the ControlPacket.ControlGroup when you send a packet.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-06-11T00:55:03Z\u0022 title=\u002206/11/2015 12:55  AM\u0022 data-short=\u00229 yr\u0022\u003EJune 11, 2015\u003C/time\u003E by stibbons\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"zitronen","CreatedById":11842,"CreatedDateTime":"2015-06-11T15:07:40Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022cino\u0022 data-cite=\u0022cino\u0022\u003E\u003Cdiv\u003EI must add that the rx led is flashing.\u003Cp\u003ELog with UNO it doesnt run\u003C/p\u003E\u003Cp\u003E[LOG 01:29:36.239] KSPSerialIO: Default Port = COM1\u003C/p\u003E\u003Cp\u003E[LOG 01:29:36.239] KSPSerialIO: Refreshrate = 0.08\u003C/p\u003E\u003Cp\u003E[LOG 01:29:36.240] KSPSerialIO: BaudRate = 38400\u003C/p\u003E\u003Cp\u003E[LOG 01:29:36.240] KSPSerialIO: Handshake Delay = 2500\u003C/p\u003E\u003Cp\u003E[LOG 01:29:36.240] KSPSerialIO: Pitch Enable = 2\u003C/p\u003E\u003Cp\u003E[LOG 01:29:36.241] KSPSerialIO: Roll Enable = 2\u003C/p\u003E\u003Cp\u003E[LOG 01:29:36.241] KSPSerialIO: Yaw Enable = 2\u003C/p\u003E\u003Cp\u003E[LOG 01:29:36.242] KSPSerialIO: Translate X Enable = 2\u003C/p\u003E\u003Cp\u003E[LOG 01:29:36.242] KSPSerialIO: Translate Y Enable = 2\u003C/p\u003E\u003Cp\u003E[LOG 01:29:36.242] KSPSerialIO: Translate Z Enable = 2\u003C/p\u003E\u003Cp\u003E[LOG 01:29:36.243] KSPSerialIO: Wheel Steering Enable = 2\u003C/p\u003E\u003Cp\u003E[LOG 01:29:36.243] KSPSerialIO: Throttle Enable = 2\u003C/p\u003E\u003Cp\u003E[LOG 01:29:36.244] KSPSerialIO: Wheel Throttle Enable = 2\u003C/p\u003E\u003Cp\u003E[LOG 01:29:36.244] KSPSerialIO: SAS Tol = 0.1\u003C/p\u003E\u003Cp\u003E[LOG 01:34:36.614] KSPSerialIO: Version 0.17.1\u003C/p\u003E\u003Cp\u003E[LOG 01:34:36.614] KSPSerialIO: Getting serial ports...\u003C/p\u003E\u003Cp\u003E[LOG 01:34:36.614] KSPSerialIO: Output packet size: 179/255\u003C/p\u003E\u003Cp\u003E[LOG 01:34:36.616] KSPSerialIO: Found 2 serial ports\u003C/p\u003E\u003Cp\u003E[LOG 01:34:36.617] KSPSerialIO: trying default port COM1\u003C/p\u003E\u003Cp\u003E[LOG 01:34:39.240] KSPSerialIO: found KSP Display at COM1\u003C/p\u003E\u003Cp\u003E[LOG 01:34:46.094] KSPSerialIO: Handshake received - 314\u003C/p\u003E\u003Cp\u003EWith Nano everything is ok\u003C/p\u003E\u003Cp\u003E[LOG 01:43:05.823] KSPSerialIO: Default Port = COM4\u003C/p\u003E\u003Cp\u003E[LOG 01:43:05.824] KSPSerialIO: Refreshrate = 0.08\u003C/p\u003E\u003Cp\u003E[LOG 01:43:05.824] KSPSerialIO: BaudRate = 38400\u003C/p\u003E\u003Cp\u003E[LOG 01:43:05.825] KSPSerialIO: Handshake Delay = 2500\u003C/p\u003E\u003Cp\u003E[LOG 01:43:05.825] KSPSerialIO: Pitch Enable = 2\u003C/p\u003E\u003Cp\u003E[LOG 01:43:05.825] KSPSerialIO: Roll Enable = 2\u003C/p\u003E\u003Cp\u003E[LOG 01:43:05.826] KSPSerialIO: Yaw Enable = 2\u003C/p\u003E\u003Cp\u003E[LOG 01:43:05.826] KSPSerialIO: Translate X Enable = 2\u003C/p\u003E\u003Cp\u003E[LOG 01:43:05.827] KSPSerialIO: Translate Y Enable = 2\u003C/p\u003E\u003Cp\u003E[LOG 01:43:05.827] KSPSerialIO: Translate Z Enable = 2\u003C/p\u003E\u003Cp\u003E[LOG 01:43:05.827] KSPSerialIO: Wheel Steering Enable = 2\u003C/p\u003E\u003Cp\u003E[LOG 01:43:05.828] KSPSerialIO: Throttle Enable = 2\u003C/p\u003E\u003Cp\u003E[LOG 01:43:05.828] KSPSerialIO: Wheel Throttle Enable = 2\u003C/p\u003E\u003Cp\u003E[LOG 01:43:05.828] KSPSerialIO: SAS Tol = 0.1\u003C/p\u003E\u003Cp\u003E[LOG 01:44:04.383] KSPSerialIO: Version 0.17.1\u003C/p\u003E\u003Cp\u003E[LOG 01:44:04.383] KSPSerialIO: Getting serial ports...\u003C/p\u003E\u003Cp\u003E[LOG 01:44:04.383] KSPSerialIO: Output packet size: 179/255\u003C/p\u003E\u003Cp\u003E[LOG 01:44:04.385] KSPSerialIO: Found 2 serial ports\u003C/p\u003E\u003Cp\u003E[LOG 01:44:04.386] KSPSerialIO: trying default port COM4\u003C/p\u003E\u003Cp\u003E[LOG 01:44:07.008] KSPSerialIO: found KSP Display at COM4\u003C/p\u003E\u003Cp\u003E[LOG 01:44:13.808] KSPSerialIO: Handshake received - 314\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYou are using version 0.17.1, which version of the arduino code are you using? The current version of the plugin is 0.17.3 and arduino code version 12. They are not compatible between versions.\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022font-size:8px;\u0022\u003E\u003Cspan style=\u0022color:#C0C0C0;\u0022\u003E- - - Updated - - -\u003C/span\u003E\u003C/span\u003E\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022jandcando\u0022 data-cite=\u0022jandcando\u0022\u003E\u003Cdiv\u003EI have a question about action group behavior. For example, when using the standard action group code I set an action group to toggle a landing leg. But when I press the corresponding button on my controller, I need to hold the button down for the gear to stay extended. When I let go of the button, it retracts. I have coded a really messy solution to this problem in my code, but I want to know if any of you guys have an efficient way to solve this problem.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThe action groups are designed to be operated with toggle switches. If you want to use buttons you can follow stibbon\u0027s method.\u003C/p\u003E\n"},{"CreatedByName":"jandcando","CreatedById":66121,"CreatedDateTime":"2015-06-11T16:03:03Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022stibbons\u0022 data-cite=\u0022stibbons\u0022\u003E\u003Cdiv\u003EMy button handling uses some advanced concepts, but is fairly simple and, IMO, very efficient. It relies on storing button states as individual bits in larger numbers; an unsigned integer stores 16 inputs. This means a lot of bitwise math, which is hard for me to comprehend properly without my morning coffee. But it means I can latch all ten control group buttons in a few operations.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThanks for all this help! Will this make it behave like keyboard buttons?, because that\u0027s what I\u0027m going for.\u003C/p\u003E\u003Cp\u003E--edit--\u003C/p\u003E\u003Cp\u003EI have started to integrate this code, but I\u0027m wondering about the line that says \u0022#define NUM_READINGS 3\u0022. Do I keep the 3 there, or is it supposed to be something else?\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-06-11T17:02:50Z\u0022 title=\u002206/11/2015 05:02  PM\u0022 data-short=\u00229 yr\u0022\u003EJune 11, 2015\u003C/time\u003E by jandcando\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"cino","CreatedById":145619,"CreatedDateTime":"2015-06-11T18:17:39Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022zitronen\u0022 data-cite=\u0022zitronen\u0022\u003E\u003Cdiv\u003EYou are using version 0.17.1, which version of the arduino code are you using? The current version of the plugin is 0.17.3 and arduino code version 12. They are not compatible between versions.\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThanks, this was the solution.\u003C/p\u003E\n"},{"CreatedByName":"stibbons","CreatedById":57865,"CreatedDateTime":"2015-06-12T04:17:23Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022jandcando\u0022 data-cite=\u0022jandcando\u0022\u003E\u003Cdiv\u003EThanks for all this help! Will this make it behave like keyboard buttons?, because that\u0027s what I\u0027m going for.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI\u0027m not sure what you mean. It\u0027s code that lets a momentary push button act as a toggle - pretty much exactly how the caps lock key on your keyboard works yes.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003EI have started to integrate this code, but I\u0027m wondering about the line that says \u0022#define NUM_READINGS 3\u0022. Do I keep the 3 there, or is it supposed to be something else?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ENUM_READINGS is used in the button debouncing routine. It defines how many consecutive readings need to be high before the debounced button state is considered to be high. For my hardware, 3 is a pretty good number for a 5ms polling interval.\u003C/p\u003E\u003Cp\u003EAlso, it\u0027s worth noting that this code is intended to be used for buttons that have pull-down resistors. If you\u0027re using the internal pull-up resistors on the arduino, it will only toggle state when the button is released not when it\u0027s pushed. Easiest thing to do for that sort of setup would be invert the result of the digitalRead.\u003C/p\u003E\n"},{"CreatedByName":"jandcando","CreatedById":66121,"CreatedDateTime":"2015-06-13T18:25:17Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022stibbons\u0022 data-cite=\u0022stibbons\u0022\u003E\u003Cdiv\u003EI\u0027m not sure what you mean. It\u0027s code that lets a momentary push button act as a toggle - pretty much exactly how the caps lock key on your keyboard works yes.\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EOh. I\u0027m looking for something that makes the buttons on my controller behave as if I was using the keyboard buttons to trigger action groups. I\u0027m not sure what the game does with keyboard input, but I want it to be the same behavior on my controller board.\u003C/p\u003E\n"},{"CreatedByName":"Freshmeat","CreatedById":111048,"CreatedDateTime":"2015-06-13T20:22:24Z","Content":"\n\u003Cp\u003EEssentially you get the same functionality as a key press. However, you need to send a command by KSPserialIO instead of a keyboard character. A single arduino cannot both be a keyboard emulator and communicate with KSP over serial.\u003C/p\u003E\n"},{"CreatedByName":"cino","CreatedById":145619,"CreatedDateTime":"2015-06-14T11:09:18Z","Content":"\n\u003Cp\u003EI have another Question. I have the AP on my LCD but it shows to many digits till down to meters. I want only km.\u003C/p\u003E\u003Cp\u003EThis is my Code\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Elcd.setCursor(0, 0);   lcd.print((long) VData.Alt);\u003Cbr\u003E  lcd.print(\u0022     \u0022);\u003Cbr\u003E  lcd.setCursor(7, 0); \u003Cbr\u003E  lcd.print((long) VData.AP);\u003Cbr\u003E  lcd.setCursor(0, 1); \u003Cbr\u003E  lcd.print((long) VData.LiquidFuel);\u003Cbr\u003E  lcd.print(\u0022   \u0022);\u003Cbr\u003E  lcd.setCursor(4, 1);\u003Cbr\u003E  lcd.print(\u0022/\u0022);\u003Cbr\u003E  lcd.setCursor(6, 1);\u003Cbr\u003E  lcd.print((long) VData.SolidFuel);\u003Cbr\u003E  lcd.print(\u0022   \u0022);\u003Cbr\u003E  lcd.setCursor(10, 1);\u003Cbr\u003E  lcd.print(\u0022/\u0022);\u003Cbr\u003E  lcd.print((long) VData.Vsurf);\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EEdit:\u003C/p\u003E\u003Cp\u003EI did it with\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E[FONT=Verdana]  lcd.print((long) VData.AP / 100);[/FONT]\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-06-14T11:43:02Z\u0022 title=\u002206/14/2015 11:43  AM\u0022 data-short=\u00229 yr\u0022\u003EJune 14, 2015\u003C/time\u003E by cino\u003C/strong\u003E\n\u003C/span\u003E\n"}]}