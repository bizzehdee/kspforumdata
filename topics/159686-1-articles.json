{"TopicId":159686,"ForumId":29,"TopicTitle":"How to calculate throttle to exactly counteract gravity?","CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2017-04-24T05:07:46Z","PageNum":1,"Articles":[{"CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2017-04-24T05:07:46Z","Content":"\n\u003Cp\u003E\nSubject says it. \u00A0I have the total thrust available, and the vessel mass. \u00A0What\u0027s the calculation to set the throttle to balance against gravity?\n\u003C/p\u003E\n\u003Cp\u003E\nThanks in advance\n\u003C/p\u003E\n"},{"CreatedByName":"HebaruSan","CreatedById":156657,"CreatedDateTime":"2017-04-24T05:11:15Z","Content":"\n\u003Cp\u003E\nYou want the force of the thrust\u00A0to exactly equal the force from gravity, which is\u00A0Mass * 9.81. If the available thrust is Fmax, the throttle should be 9.81 * Mass / Fmax as a percentage.\n\u003C/p\u003E\n\u003Cp\u003E\nOr have I misunderstood the question?\n\u003C/p\u003E\n"},{"CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2017-04-24T05:24:06Z","Content":"\n\u003Cp\u003E\nbut depends on the planet.\n\u003C/p\u003E\n\u003Cp\u003E\nJust got it working, here\u0027s the code if anyone else would be interested:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003Evar thrust = GetThrustInfo(FlightGlobals.ActiveVessel);\n\nVector3d \u003Cabbr title=\u0022Center of Mass\u0022\u003ECoM\u003C/abbr\u003E = FlightGlobals.ActiveVessel.GetWorldPos3D();\ndouble localg = FlightGlobals.getGeeForceAtPosition(\u003Cabbr title=\u0022Center of Mass\u0022\u003ECoM\u003C/abbr\u003E).magnitude;\nvar throttle =  (FlightGlobals.ActiveVessel.totalMass * localg) / thrust;\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"T-Bouw","CreatedById":21500,"CreatedDateTime":"2017-04-24T05:43:26Z","Content":"\n\u003Cp\u003E\nI\u0027m not familliar with all the terms in your calculation (KOS?) so I\u0027m not sure if you have it already, but it also depends on the angle your ship makes in relation to the planet.\u003Cbr\u003E\nVeer off for just a degree in any direction and the thrust won\u0027t be suffici\u00EBnt.\u003Cbr\u003E\nBetter to add some trigonometry to account for this.\n\u003C/p\u003E\n"},{"CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2017-04-24T10:34:12Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223032522\u0022 data-ipsquote-contentid=\u0022159686\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221493012606\u0022 data-ipsquote-userid=\u002221500\u0022 data-ipsquote-username=\u0022T-Bouw\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n4 hours ago, T-Bouw said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nI\u0027m not familliar with all the terms in your calculation (KOS?) so I\u0027m not sure if you have it already, but it also depends on the angle your ship makes in relation to the planet.\u003Cbr\u003E\nVeer off for just a degree in any direction and the thrust won\u0027t be suffici\u00EBnt.\u003Cbr\u003E\nBetter to add some trigonometry to account for this.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThis code is being used after a suicide burn, the velocity is minimal and the vessel is/should be upright\n\u003C/p\u003E\n"},{"CreatedByName":"Pand5461","CreatedById":172084,"CreatedDateTime":"2017-04-29T23:32:04Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223032509\u0022 data-ipsquote-contentid=\u0022159686\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221493011446\u0022 data-ipsquote-userid=\u0022129964\u0022 data-ipsquote-username=\u0022linuxgurugamer\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nOn 24.04.2017 at 8:24 AM, linuxgurugamer said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nbut depends on the planet.\n\u003C/p\u003E\n\u003Cp\u003E\nJust got it working, here\u0027s the code if anyone else would be interested:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\n\u003Cspan class=\u0022pln\u0022\u003Evar thrust = GetThrustInfo(FlightGlobals.ActiveVessel);\n\nVector3d \u003Cabbr title=\u0022Center of Mass\u0022\u003ECoM\u003C/abbr\u003E = FlightGlobals.ActiveVessel.GetWorldPos3D();\ndouble localg = FlightGlobals.getGeeForceAtPosition(\u003Cabbr title=\u0022Center of Mass\u0022\u003ECoM\u003C/abbr\u003E).magnitude;\nvar throttle =  (FlightGlobals.ActiveVessel.totalMass * localg) / thrust;\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/129964-linuxgurugamer/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022129964\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/129964-linuxgurugamer/\u0022 rel=\u0022\u0022\u003E@linuxgurugamer\u003C/a\u003E, is this code supposed to run in a loop? If yes, for the performance reasons, I\u0027d suggest calculating localg as mu/R^2, where mu is\u00A0\u003Ca href=\u0022https://en.wikipedia.org/wiki/Standard_gravitational_parameter\u0022 rel=\u0022external nofollow\u0022\u003Estandard gravitational parameter\u003C/a\u003E of the parent body, R is distance from body center. In kOS it\u0027s as follows:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode\u0022\u003E\nset rb to ship:position - body:position.\nset localg to body:mu / (rb:x*rb:x \u002B rb:y*rb:y \u002B rb:z*rb:z).\u003C/pre\u003E\n\u003Cp\u003E\nDon\u0027t know how it looks like for mod development though.\n\u003C/p\u003E\n\u003Cp\u003E\nFrom your code, it looks like that FlightGlobals.getGeeForceAtPosition is calculated as a vector, and only its magnitude is used. It adds a lot of unnecessary computations if you only need a scalar.\n\u003C/p\u003E\n"},{"CreatedByName":"Warezcrawler","CreatedById":145377,"CreatedDateTime":"2017-05-01T17:05:58Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223032502\u0022 data-ipsquote-contentid=\u0022159686\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221493010466\u0022 data-ipsquote-userid=\u0022129964\u0022 data-ipsquote-username=\u0022linuxgurugamer\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nOn 24/4/2017 at 7:07 AM, linuxgurugamer said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nSubject says it. \u00A0I have the total thrust available, and the vessel mass. \u00A0What\u0027s the calculation to set the throttle to balance against gravity?\n\u003C/p\u003E\n\u003Cp\u003E\nThanks in advance\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nMaybe this mod is one of the best resources to answer such a question\n\u003C/p\u003E\n\u003Ciframe data-embedcontent=\u0022\u0022 frameborder=\u00220\u0022 src=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/46647-12oct2316-automate-vertical-velocity-and-altitude-control/\u0026amp;do=embed\u0022\u003E\u003C/iframe\u003E\n\u003Cp\u003E\nThe mod is great for hovering. I use it for my suicide burns (timing is manual), and then soft landings.\n\u003C/p\u003E\n"},{"CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2017-05-01T17:28:21Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223041321\u0022 data-ipsquote-contentid=\u0022159686\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221493658358\u0022 data-ipsquote-userid=\u0022145377\u0022 data-ipsquote-username=\u0022Warezcrawler\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n22 minutes ago, Warezcrawler said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nMaybe this mod is one of the best resources to answer such a question\n\u003C/p\u003E\n\u003Ciframe data-embedcontent=\u0022\u0022 frameborder=\u00220\u0022 src=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/46647-12oct2316-automate-vertical-velocity-and-altitude-control/\u0026amp;do=embed\u0022\u003E\u003C/iframe\u003E\n\u003Cp\u003E\nThe mod is great for hovering. I use it for my suicide burns (timing is manual), and then soft landings.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nthanks, I got it solved a couple of weeks ago.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2017-05-02T15:17:59Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223032522\u0022 data-ipsquote-contentid=\u0022159686\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221493012606\u0022 data-ipsquote-userid=\u002221500\u0022 data-ipsquote-username=\u0022T-Bouw\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nOn 4/24/2017 at 1:43 AM, T-Bouw said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nI\u0027m not familliar with all the terms in your calculation (KOS?) so I\u0027m not sure if you have it already, but it also depends on the angle your ship makes in relation to the planet.\u003Cbr\u003E\nVeer off for just a degree in any direction and the thrust won\u0027t be suffici\u00EBnt.\u003Cbr\u003E\nBetter to add some trigonometry to account for this.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nAlready taken care of. \u00A0I calculate how much \u003Cabbr title=\u0022Delta-V\u0022\u003EdV\u003C/abbr\u003E is needed to stop the vessel, then calculate the distance to stop, and use the distance to the touchdown point to figure out when to start the burn.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nBelieve it or not, just pointing prograde will effectivaly zero out your horizontal velocity, no need for any really complex calculations.\n\u003C/p\u003E\n\u003Cp\u003E\nHowever, Mechjeb does essentially the same thing, but in a smoother way; \u00A0it doesn\u0027t use \u003Cabbr title=\u0022Stability Augmentation System\u0022\u003Esas\u003C/abbr\u003E, it does it\u0027s own calculations.\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223039363\u0022 data-ipsquote-contentid=\u0022159686\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221493508724\u0022 data-ipsquote-userid=\u0022172084\u0022 data-ipsquote-username=\u0022Pand5461\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nOn 4/29/2017 at 7:32 PM, Pand5461 said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/129964-linuxgurugamer/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022129964\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/129964-linuxgurugamer/\u0022 rel=\u0022\u0022\u003E@linuxgurugamer\u003C/a\u003E, is this code supposed to run in a loop? If yes, for the performance reasons, I\u0027d suggest calculating localg as mu/R^2, where mu is\u00A0\u003Ca href=\u0022https://en.wikipedia.org/wiki/Standard_gravitational_parameter\u0022 rel=\u0022external nofollow\u0022\u003Estandard gravitational parameter\u003C/a\u003E of the parent body, R is distance from body center. In kOS it\u0027s as follows:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode\u0022\u003E\n\nset rb to ship:position - body:position.\nset localg to body:mu / (rb:x*rb:x \u002B rb:y*rb:y \u002B rb:z*rb:z).\u003C/pre\u003E\n\u003Cp\u003E\nDon\u0027t know how it looks like for mod development though.\n\u003C/p\u003E\n\u003Cp\u003E\nFrom your code, it looks like that FlightGlobals.getGeeForceAtPosition is calculated as a vector, and only its magnitude is used. It adds a lot of unnecessary computations if you only need a scalar.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\n\u00A0 \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/172084-pand5461/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022172084\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/172084-pand5461/\u0022 rel=\u0022\u0022\u003E@Pand5461\u003C/a\u003E\u00A0 \u00A0 \u00A0\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nThat was an early calculation, when I first got it work.\n\u003C/p\u003E\n\u003Cp\u003E\nCurrently, this is what I\u0027m doing:\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003Efloat gravHeight = (float)this.vessel.altitude \u002B (float)vessel.mainBody.Radius; //gravity force at this altitude (not in m/s^2) \u00A0 \u00A0 \u00A0 \u00A0 \u00A0 \u00A0\n\ndouble localg = (float)vessel.mainBody.gMagnitudeAtCenter / (float)Math.Pow(gravHeight, 2); //accel down due to gravity in m/s^2\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\n\u003Cspan\u003EIt is faster. \u00A0 \u00A0 \u00A0 \u00A0\u00A0\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cspan\u003E\u00A0 \u00A0 \u00A0 \u00A0 \u00A0\u003C/span\u003E\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222017-05-02T15:23:11Z\u0022 title=\u002205/02/2017 03:23  PM\u0022 data-short=\u00227 yr\u0022\u003EMay 2, 2017\u003C/time\u003E by linuxgurugamer\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2017-05-02T15:26:00Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nQuote\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\n\u003Cspan class=\u0022pln\u0022\u003E(float)Math.Pow(gravHeight, 2)\u003C/span\u003E\u003C/pre\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nis slower than\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html\u0022\u003E\n gravHeight * gravHeight\u003C/pre\u003E\n"},{"CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2017-05-02T15:28:45Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223042427\u0022 data-ipsquote-contentid=\u0022159686\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221493738760\u0022 data-ipsquote-userid=\u002257146\u0022 data-ipsquote-username=\u0022sarbian\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n2 minutes ago, sarbian said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nis slower than\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\n\u003Cspan class=\u0022pln\u0022\u003E\u003Cspan class=\u0022pln\u0022\u003E gravHeight \u003C/span\u003E\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E\u003Cspan class=\u0022pln\u0022\u003E*\u003C/span\u003E\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\u003Cspan class=\u0022pln\u0022\u003E gravHeight\u003C/span\u003E\u003C/span\u003E\u003C/pre\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nTrue, and thanks for the nudge \u003Cimg alt=\u0022:D\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 title=\u0022:D\u0022\u003E\u003C/p\u003E\n"}]}