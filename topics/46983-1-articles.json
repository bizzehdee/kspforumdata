{"TopicId":46983,"ForumId":36,"TopicTitle":"Stock Debloating (WIP)","CreatedByName":"PolecatEZ","CreatedById":58008,"CreatedDateTime":"2013-09-30T13:10:22Z","PageNum":1,"Articles":[{"CreatedByName":"PolecatEZ","CreatedById":58008,"CreatedDateTime":"2013-09-30T13:10:22Z","Content":"\n\u003Cp\u003EThis is quick and dirty for a first post, and the release will get a better name, but here goes.\u003C/p\u003E\u003Cp\u003EI ran some scripting on the Squad Stock parts and internals and managed de-rezzed some bloated textures. My first pass I hit all the 4mb and 1mb textures, which knocked about 30% off the total load size. I have 2 problems:\u003C/p\u003E\u003Cp\u003E1 - My machine is too beefy with dual raid SSD and big fat processor, 30% off just isn\u0027t that noticeable for me on a basic install with no other mods.\u003C/p\u003E\u003Cp\u003E2 - Because the textures are .tga now, they don\u0027t overwrite the default textures, just add to them. I need a quick and dirty way to make a seek-and-destroy script (or upload the entire parts folder, even the parts without changes). If I can figure out how to get a printout of files in the \u0022Cooked\u0022 folder, I could definitely batch it that way. It does make install a little messy though (add in files AND run batch...maybe too much for most users to grasp).\u003C/p\u003E\u003Cp\u003EI also need the texture resolution settings for 12mb, 16mb (2048x2048 I assume), 3mb, 1.5mb, and 768kb so I can make heading swap files for the remaining textures. As well, nearly ALL textures in the internals folder are duplicated, if we could make reference configs instead, the internals folder could be shrinkalated by about 90%\u002B (no joke).\u003C/p\u003E\u003Cp\u003EHere\u0027s the shrunken textures that I have so far, its a tedious process.\u003C/p\u003E\u003Cp\u003EIf anyone wants to test or help out, feel free.\u003C/p\u003E\u003Cp\u003EAlso, if anything looks particularly like kerdoodoo, let me know and I\u0027ll shrink it less or not at all.\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022https://www.dropbox.com/s/vf9ie3siwjo5xsq/SquadMod%20Cooked%200.1a.rar\u0022 rel=\u0022external nofollow\u0022\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003E\u003Cstrong\u003EDOWNLOAD 0.1a texture pack\u003C/strong\u003E\u003C/span\u003E\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EMIT license (means do whatever you feel like, I\u0027m cool unless you aren\u0027t).\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-09-30T13:16:24Z\u0022 title=\u002209/30/2013 01:16  PM\u0022 data-short=\u002210 yr\u0022\u003ESeptember 30, 2013\u003C/time\u003E by PolecatEZ\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Greys","CreatedById":57109,"CreatedDateTime":"2013-09-30T16:55:16Z","Content":"\n\u003Cp\u003EHere\u0027s my 1.275 cents.\u003C/p\u003E\u003Cp\u003EIt might be against the rules to distribute modified Squad assets, and yes this would count. You might want to instead exclusively distribute the script that generates these.\u003C/p\u003E\u003Cp\u003EThe first thing I did was go and open /Squad/Parts/EngineliquidEngine2/model000.tga in GIMP and noticed two things\u003C/p\u003E\u003Cp\u003E- The resolution is 384 square\u003C/p\u003E\u003Cp\u003E- There is already an alpha channel on the file\u003C/p\u003E\u003Cp\u003EThese are both bad things\u003C/p\u003E\u003Cp\u003ETextures need to always be powers of 2, Unity will make sure of it happen if you don\u0027t. 384 on load gets expanded to the next largest power of 2, which happens to be 512. It does not get scaled, Unity just adds a bunch of empty space to it. The nearest power of 2 happens to be 512. Instantly that texture takes up 22% more memory than intended.\u003C/p\u003E\u003Cp\u003ETextures are also never put into memory in the format they\u0027re stored in. There\u0027s been a lot of misinformation about this lately, some from me, and wholly due to nobody actually looking. But KSP does compress textures. On load all textures are converted into DXT1 or DXT5 DDS format. This is good for us because these are very formulaic as to how much space they take up, DXT1 takes 4 bits per pixel, and DXT5 takes twice as much. What, you ask, is the difference between them? DXT5 has transparency, and KSP uses it for any texture files that have alpha channels in the file.\u003C/p\u003E\u003Cp\u003ESo now you\u0027ve got a texture sheet that due to a weird size contains a lot of empty space, and because of unnecessary transparency takes up 2 times more.\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003E(512 * 512) * 8 = 2,097,152\u003C/strong\u003E bits ram RAM\u003C/p\u003E\u003Cp\u003EAssuming the sheet was originally 1024 square without alpha channel\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003E(1024 * 1024) * 4 = 4,194,304\u003C/strong\u003E bits in ram\u003C/p\u003E\u003Cp\u003EThis is only a 50% reduction in memory usage, but now here\u0027s the useful information you\u0027re storing\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022font-size:8px;\u0022\u003E\u003Csup\u003Eif the original sheet was 512 then you\u0027re not saving a damn thing and actually taking double the ram\u003C/sup\u003E\u003C/span\u003E\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003E(384 * 384) * 4 = 589,824\u003C/strong\u003E bits in ram\u003C/p\u003E\u003Cp\u003EThat is to say, 28.125% of the memory you are now using, is useful to KSP.\u003C/p\u003E\u003Cp\u003EIf you only scaled the original file down to 512, you\u0027d be using the same amount of memory but you\u0027d have better texture resolution for it.\u003C/p\u003E\u003Cp\u003EIf you get rid of the alpha channel you will use one half the memory you currently are\u003C/p\u003E\u003Cp\u003EOr, you could get rid of the alpha channel and round down to 256x256, lose a bit more resolution, and only take up\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003E(256 * 256) * 4 = 262,144\u003C/strong\u003E bits in ram\u003C/p\u003E\u003Cp\u003Efor an overall savings vs the original 1024x1024 of 93.75%\u003C/p\u003E\u003Cp\u003ESo:\u003C/p\u003E\u003Cp\u003Estick to powers of 2 \u003Cspan style=\u0022font-size:8px;\u0022\u003E\u003Csup\u003E(2, 4, 8, 16, 32, 64, \u003C/sup\u003E\u003C/span\u003E\u003Cstrong\u003E\u003Cspan style=\u0022font-size:8px;\u0022\u003E\u003Csup\u003E128, 256, 512, 1024\u003C/sup\u003E\u003C/span\u003E\u003C/strong\u003E\u003Cspan style=\u0022font-size:8px;\u0022\u003E\u003Csup\u003E, 2048, 4096, etc)\u003C/sup\u003E\u003C/span\u003E\u003C/p\u003E\u003Cp\u003EDon\u0027t add alpha channels where they don\u0027t already exist, and MBMs don\u0027t have alpha channels because they\u0027re bitmaps.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-09-30T16:57:46Z\u0022 title=\u002209/30/2013 04:57  PM\u0022 data-short=\u002210 yr\u0022\u003ESeptember 30, 2013\u003C/time\u003E by Greys\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"PolecatEZ","CreatedById":58008,"CreatedDateTime":"2013-09-30T18:40:13Z","Content":"\n\u003Cp\u003EGood thing I saved the original swaps...now to figure out how to strip an alpha channel.\u003C/p\u003E\u003Cp\u003EI went with 384 because 256 was too fuzzy but 512 was too big. I can run back through and in my alpha stripping pass change them less.\u003C/p\u003E\u003Cp\u003ESo far as I know, anything from Squad in the /gamedata folder is fair game to do whatever, its the other stuff they don\u0027t want you modifying or mucking with. People wholly rip off the config templates for things and redistribute all the time, why would modified textures be different? I\u0027m not claiming the textures as my work, just the tedious process of converting them. Justice from the admins is generally swift and brutal if there is a violation.\u003C/p\u003E\u003Cp\u003EI also solved the installer problem. Seek and destroy batching is easy to construct now.\u003C/p\u003E\n"},{"CreatedByName":"Gaius","CreatedById":66495,"CreatedDateTime":"2013-09-30T18:58:27Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022PolecatEZ\u0022 data-cite=\u0022PolecatEZ\u0022\u003E\u003Cdiv\u003ESo far as I know, anything from Squad in the /gamedata folder is fair game to do whatever, its the other stuff they don\u0027t want you modifying or mucking with.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI believe that\u0027s correct. From the \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/7529-Plugin-Posting-Rules-And-Official-Documentation\u0022 rel=\u0022external nofollow\u0022\u003Eofficial rules\u003C/a\u003E:\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003EDo not decompile, modify or distribute any of the DLLs or other files KSP comes with beyond stuff in the Parts folder.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThey specifically except the \u0022stuff in the Parts folder\u0022. Unfortunately, they wrote that before reorganizing how parts and mods are organized on the disk with the new GameData folder, leaving it now somewhat ambiguous (which \u0022Parts\u0022 folder? The new one under GameData/Squad? Only the legacy one? Or do they really mean everything under GameData under the new scheme?), but I believe the intent is more or less as you describe.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-09-30T19:03:23Z\u0022 title=\u002209/30/2013 07:03  PM\u0022 data-short=\u002210 yr\u0022\u003ESeptember 30, 2013\u003C/time\u003E by Gaius\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"PolecatEZ","CreatedById":58008,"CreatedDateTime":"2013-09-30T19:51:51Z","Content":"\n\u003Cp\u003EAnyways, did everything nice and proper for the crewcabin, and here\u0027s a comparison in quality.\u003C/p\u003E\u003Cp\u003EThe top lander can has the old 4mb texture and 1 or 4mb shadow map or whatever that second file is.\u003C/p\u003E\u003Cp\u003EThe bottom cabin has his 4mb texture \u002B 4mb shadow map shrunk to 512x512 with no alpha for 768kb now, with a 256kb shadow map.\u003C/p\u003E\u003Cp\u003EMy settings are on the absolute highest levels for everything, people sporting lower resolutions or textures may not notice a difference.\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://s24.postimg.org/r5ukbqk2t/2013_09_30_00001.jpg\u0022 alt=\u00222013_09_30_00001.jpg\u0022\u003E\u003C/p\u003E\u003Cp\u003EIs this quality difference ok for the average user, or should I stick just to shrinkilating ridiculous things like the 8mb throttle handle?\u003C/p\u003E\u003Cp\u003E================\u003C/p\u003E\u003Cp\u003EAnd in an unrelated EUREKA moment, I just figured out how to ensmallen the /spaces folder to almost nothing, without applying any texture modifications. I can probably squeeze that down to 20% original size before texture shrinking.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-09-30T20:18:44Z\u0022 title=\u002209/30/2013 08:18  PM\u0022 data-short=\u002210 yr\u0022\u003ESeptember 30, 2013\u003C/time\u003E by PolecatEZ\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"NoMrBond","CreatedById":69263,"CreatedDateTime":"2013-09-30T20:13:42Z","Content":"\n\u003Cp\u003EFor stuff where the texture is identical, you could also change the part.cfg to use a MODEL{} call with the texture argument to call the other identical texture, and replace the unused redundant texture with a blank 4x4 px image.\u003C/p\u003E\n"},{"CreatedByName":"PolecatEZ","CreatedById":58008,"CreatedDateTime":"2013-09-30T21:38:45Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022NoMrBond\u0022 data-cite=\u0022NoMrBond\u0022\u003E\u003Cdiv\u003EFor stuff where the texture is identical, you could also change the part.cfg to use a MODEL{} call with the texture argument to call the other identical texture, and replace the unused redundant texture with a blank 4x4 px image.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EGreat, perhaps you can share how to do that with the spaces because I got it to work once, redid every space like that, and then it didn\u0027t work again at all. Hair-pulling.\u003C/p\u003E\u003Cp\u003ENow I can\u0027t tell if the model command is being ignored or the texture sub-command is being ignored.\u003C/p\u003E\n"},{"CreatedByName":"NoMrBond","CreatedById":69263,"CreatedDateTime":"2013-09-30T21:44:57Z","Content":"\n\u003Cp\u003EI\u0027ll check/test it when I get home and hopefully have some kind progress update later (at work now, still ~6 hours to go)\u003C/p\u003E\n"},{"CreatedByName":"WinkAllKerb\u0026#039;\u0026#039;","CreatedById":78047,"CreatedDateTime":"2013-12-05T12:24:26Z","Content":"\n\u003Cp\u003Ei m a bit late here but all this are an incredible amount of amazings benchies infos !!!!! (/worship mode on)\u003C/p\u003E\u003Cp\u003Ei m also wondering one thing:\u003C/p\u003E\u003Cp\u003Ehow could uv map transforms applied could impact the preload and then in game, i suppose that using the simpliest math transfo for applying texture is better for memory than using lot of weird uv transfo ? am i wrong with this or once the part is loaded it\u0027s no longer important at all, the way the uvmap been applied is complex or not with the use of many differents transfo ?\u003C/p\u003E\u003Cp\u003Echeers \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E :) \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"NathanKell","CreatedById":75006,"CreatedDateTime":"2013-12-05T18:19:49Z","Content":"\n\u003Cp\u003EIn the end, each vertex gets UV coords, and these are interpolated by the pixel shader. Doesn\u0027t matter how complex your mapping was.\u003C/p\u003E\n"},{"CreatedByName":"rbray89","CreatedById":48847,"CreatedDateTime":"2013-12-05T19:18:39Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Greys\u0022 data-cite=\u0022Greys\u0022\u003E\u003Cdiv\u003E\u003Cp\u003ETextures are also never put into memory in the format they\u0027re stored in. There\u0027s been a lot of misinformation about this lately, some from me, and wholly due to nobody actually looking. But KSP does compress textures. On load all textures are converted into DXT1 or DXT5 DDS format. This is good for us because these are very formulaic as to how much space they take up, DXT1 takes 4 bits per pixel, and DXT5 takes twice as much. What, you ask, is the difference between them? DXT5 has transparency, and KSP uses it for any texture files that have alpha channels in the file.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ENot correct actually. TGA\u0027s are not compressed at all currently. There are LOTS of MBMs that are not compressed (a flag in the header determines whether to compress them or not). PNGs are compressed, but no mip-maps are generated. \u003C/p\u003E\u003Cp\u003EHence why my Texture compressor mod works. I had been playing around with the idea of modifying the MBMs before they are loaded, forcing them to be readable textures, then manually reading them in, passing them through a bicubic re-size to lower resolutions. Then compressing them. This would save TONS of memory, and would still be a single dll that wouldn\u0027t violate SQUAD\u0027s IP.\u003C/p\u003E\n"},{"CreatedByName":"rbray89","CreatedById":48847,"CreatedDateTime":"2013-12-09T17:25:41Z","Content":"\n\u003Cp\u003ESo I found out that the reason *some* of the textures are not readable, is that they are MBMs that are set to be a normal/bump map (byte 12, 0-indexed). When I remove the flag, they load as readable textures (in RGB/RGBA format). I am currently working on a way to set the byte to tell KSP it is a normal texture, then load it up, then convert the byte back so we don\u0027t screw stuff up (closing during load could still mess stuff up). I should be able to scale the textures this way using a bicubic filter.\u003C/p\u003E\n"},{"CreatedByName":"Greys","CreatedById":57109,"CreatedDateTime":"2013-12-09T17:28:12Z","Content":"\n\u003Cp\u003EMake sure you add some way for users to disable that, compressing normalmaps will save a lot of space, but it will also have a bigger impact on visual fidelity than just about anything else.\u003C/p\u003E\n"},{"CreatedByName":"rbray89","CreatedById":48847,"CreatedDateTime":"2013-12-09T18:11:37Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Greys\u0022 data-cite=\u0022Greys\u0022\u003E\u003Cdiv\u003EMake sure you add some way for users to disable that, compressing normalmaps will save a lot of space, but it will also have a bigger impact on visual fidelity than just about anything else.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYeah, it looks like the KSP model loader doesn\u0027t like compressed normal maps much either. Instead of compressing, I will probably just re-size those.\u003C/p\u003E\n"}]}