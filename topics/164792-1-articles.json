{"TopicId":164792,"ForumId":29,"TopicTitle":"How to \u0026quot;create\u0026quot; a vessel","CreatedByName":"JediMasterSterling1","CreatedById":155361,"CreatedDateTime":"2017-08-25T04:48:36Z","PageNum":1,"Articles":[{"CreatedByName":"JediMasterSterling1","CreatedById":155361,"CreatedDateTime":"2017-08-25T04:48:36Z","Content":"\n\u003Cp\u003E\nI\u0027m fairly new in mod development, started playing around in with some code.\n\u003C/p\u003E\n\u003Cp\u003E\nI want to simulate a vessels trajectory in the background, and then display it on screen. I figure an easy way to do this would be to create a vessel, read the forces on it, move it to an updated location, repeat a sufficient number of times, and delete it before the game calculates the next frame.\n\u003C/p\u003E\n\u003Cp\u003E\nI figured I\u0027d start basic and build up from there so my first test was to save the active vessel to a ProtoVessel, delete the active vessel, and reload it from the ProtoVessel\n\u003C/p\u003E\n\u003Cp\u003E\nHere\u0027s the code.\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003EProtoVessel pv = FlightGlobals.ActiveVessel.BackupVessel();\n\nFlightGlobals.ActiveVessel.Unload();\nFlightGlobals.RemoveVessel(FlightGlobals.ActiveVessel);\nFlightGlobals.ActiveVessel.StartFromBackup(pv);\nFlightGlobals.ActiveVessel.Load();\nFlightGlobals.AddVessel(FlightGlobals.ActiveVessel);\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nUnfortunately it failed miserably. I\u0027ve tried several variations on this code, in case I\u0027m just getting the order wrong, but nothing works.\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027ve seen mods produce new functioning vessels in game, so it should be possible.\n\u003C/p\u003E\n\u003Cp\u003E\nAnyone know what I\u0027m missing?\n\u003C/p\u003E\n"},{"CreatedByName":"wasml","CreatedById":120438,"CreatedDateTime":"2017-08-28T00:55:59Z","Content":"\n\u003Cp\u003E\nAfter examining the code for \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/80225-13-hangar/\u0022 rel=\u0022\u0022\u003EHangar\u003C/a\u003E and \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/54284-13-extraplanetary-launchpads-v582/\u0022 rel=\u0022\u0022\u003EELP\u003C/a\u003E I managed to get the following working:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003E        public void LaunchEvent()\n        {\n            uint flightID = ShipConstruction.GetUniqueFlightID(HighLogic.CurrentGame.flightState);\n            ConfigNode[] partNodes = new ConfigNode[1];\n            partNodes[0] = ProtoVessel.CreatePartNode(\u0022KSI.FlareA\u0022, flightID, null);\n            ConfigNode[] additionalNodes = new ConfigNode[0];\n            ConfigNode protoVesselNode = ProtoVessel.CreateVesselNode(\u0022Flare\u0022, VesselType.Probe, part.vessel.GetCurrentOrbit(), 0, partNodes, additionalNodes);\n            protoVesselNode.SetValue(\u0022lon\u0022, vessel.mainBody.GetLongitude(launchPoint.position));\n            protoVesselNode.SetValue(\u0022lat\u0022, vessel.mainBody.GetLatitude(launchPoint.position));\n            protoVesselNode.SetValue(\u0022alt\u0022, vessel.mainBody.GetAltitude(launchPoint.position));\n\n            ProtoVessel protoVessel = HighLogic.CurrentGame.AddVessel(protoVesselNode);\n\n            flare = protoVessel.vesselRef;\n            if (flare != null)\n            {\n                flare.Load();\n                StartCoroutine(\u0022Spawn\u0022);\n            }\n        }\n\n        IEnumerator Spawn()\n        {\n            if ((flare.Parts[0] != null) \u0026amp;\u0026amp; (flare.Parts[0].Rigidbody != null))\n            {\n                flare.Parts[0].Rigidbody.isKinematic = true;\n            }\n\n            while ((flare.packed) \u0026amp;\u0026amp; (flare.acceleration.magnitude == 0))\n            {\n                flare.SetPosition(launchPoint.position);\n                yield return null;\n            }\n            flare.SetWorldVelocity(launchPoint.up * velocity);\n\n            flare.GoOffRails();\n            flare.IgnoreGForces(250);\n        }\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nThis would create a vessel from a part named \u0022KSI.FlareA\u0022.\n\u003C/p\u003E\n\u003Cp\u003E\nNotes: 1) this is a single part that gets created as a vessel 2) some of the lines may not be needed - got here by trial and error (lots of error) 3) it wasn\u0027t crashing the game but I didn\u0027t leave the game up very long - use at your own risk!\n\u003C/p\u003E\n"}]}