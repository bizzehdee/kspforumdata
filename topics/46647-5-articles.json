{"TopicId":46647,"ForumId":34,"TopicTitle":"[1.3](Jun04/17) Automate Vertical Velocity and Altitude Control","CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2013-09-27T01:22:59Z","PageNum":5,"Articles":[{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-07-09T03:29:11Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Voculus\u0022 data-cite=\u0022Voculus\u0022\u003E\u003Cdiv\u003EDiazo, I just found this mod today, and coupled with the Davon Throttle Control as you suggested, it opens up so many possibilities! The hamster wheel in my brain is only just beginning to turn. You sir, are a genius! From reading the threads, I found that MechJeb has something similar, but I found it to be lacking, compared to your mod. Very well done! I have one question, and forgive me if I accidentally skipped over it, but am I correct in understanding that the \u0022Control From Here\u0022 element must be pointing skyward, like a Munar lander, for instance? I\u0027ve taken to adding probe cores on my atmospheric VTOL ships for this purpose, but that leaves me unable to control the craft from the cockpit. Is there a workaround for that? In any case, thanks for the mod! \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EAt the moment, no, that is a hard limitation. \u003C/p\u003E\u003Cp\u003EAllowing the mod to function correctly from a horizontal cockpit is on the list for the next version but it is not here yet.\u003C/p\u003E\u003Cp\u003EThe best \u0022workaround\u0022 I can offer at the moment is to reach your desired height, cancel my Vertical Velocity control mod by click on the \u0022Vertical Velocity\u0022 text at the bottom of my mod\u0027s window. This will disengage my mod but leave the throttle where it is so you still hover. Then do a \u0022select from here\u0022 command on your cockpit to get the desired control reference. (And reverse order for landing.)\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n"},{"CreatedByName":"Kerba Fett","CreatedById":62292,"CreatedDateTime":"2014-07-09T04:12:55Z","Content":"\n\u003Cp\u003EI guess I wasn\u0027t thinking of the same type of VTOL\u0027s. I hadn\u0027t considered the effects of wing lift because I don\u0027t think I\u0027ve ever built a VTOL with wings. I normally use a lander configuration with a jet engine under a lander pod or I use a tricopter or quadcopter configuration with girders moving the engines away from a central pod. \u003C/p\u003E\u003Cp\u003EI suppose fuel burn changing the hover point would be a bit of an issue unless you retune the hover preset periodicly and shift all the other presets by the same ammount. \u003C/p\u003E\u003Cp\u003EAs for the pitch/roll thing, that idea came from how I do short range travel on the Mun. Rather than launching in a high ballistic arc, I usually climb to a few hundred meters then pitch forward 30 degrees. I usually want 100 to 150 m/s and I pay attention to how long it takes to get to that speed. Once I reach my desired speed I pitch back to vertical. At this point I check the map to eyeball my distance from where I started. Since there\u0027s no drag you continue over the surface at that same speed. \u003C/p\u003E\u003Cp\u003EIf you pitched forward 30 degrees to accelerate then it should take the same time and distance to stop if you pitch back 30 degrees. \u003C/p\u003E\u003Cp\u003EIf you have something to target where you started and where you\u0027re going you can use the labels to know exactly when to start slowing, otherwise you need to estimate it from the map. I find it works pretty good for moving at a decent speed for shorter trips. (10 to 50km)\u003C/p\u003E\u003Cp\u003EI also built a Munbase recently and found that I can get pretty close to vertical, but not quite exact. It will often start to slowly drift as I descend. Since your vertical control plugin makes it a lot easier I\u0027ve been placing stuff pretty close together and drift is bad. I\u0027ve been using the surface panel on MechJeb to keep myself completly vertical and it works pretty good but it also wants to control heading and that can be a bother. \u003C/p\u003E\u003Cp\u003EI also thought the pitch/roll plugin would act as sort of an easy mode for regular planes. After a turn as soon as you let go of the controls it returns to straight level flight. (assuming you set it that way before turning. \u003C/p\u003E\u003Cp\u003EI know just what you mean about hot summer weather. We get lots of that here in Vancouver too. Best investment I ever made was a $100 air conditioner. (too bad my worst investment was also to beat the summer heat. A sailboat)\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-07-09T04:31:01Z","Content":"\n\u003Cp\u003EOkay, can you drop \u003Ca href=\u0022https://drive.google.com/file/d/0B6-5UOjSWq7bMXlsakozUHkwZUE/edit?usp=sharing\u0022 rel=\u0022external nofollow\u0022\u003Ethis TWR1.dll file\u003C/a\u003E into the KSP-Install\\GameData\\Diazo\\TWR1 directory and see if that smooths out control of jet engines?\u003C/p\u003E\u003Cp\u003ENote that I will not be able to get rid of the bounce entirely, but the file I just linked to should significantly reduce it.\u003C/p\u003E\u003Cp\u003EI will not be able to get rid of the bounce because jet engines simply take a \u003Cem\u003Elong\u003C/em\u003E time to spool up. I timed it during one of my tests, it was 35 seconds from 0 to 100% thrust. \u003C/p\u003E\u003Cp\u003EOn the pitch/roll thing, the RCS mod I\u0027m thinking off will be the final 30-40m/s of sideways velocity that you have to get rid of, the cancellation of the majority of your sideways velocity will still be from your main engines during the drop phase as you angle in.\u003C/p\u003E\u003Cp\u003EI do more drops from orbit then suborbital hops as you just described, but I find that since I angle retrograde most of the way down, my sideways speed naturally slows itself as I am angled in my direction of horizontal travel and I only have that little bit of speed left to kill that can easily be handled by RCS.\u003C/p\u003E\u003Cp\u003E@Using mod on a cockpit: I actually had a brain wave on this, I think I can slap something together tomorrow night after work for this. If the jet engine tweak works out I\u0027ll make these two things the next official release.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-07-09T04:33:06Z\u0022 title=\u002207/09/2014 04:33  AM\u0022 data-short=\u002210 yr\u0022\u003EJuly 9, 2014\u003C/time\u003E by Diazo\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Voculus","CreatedById":85437,"CreatedDateTime":"2014-07-09T05:35:45Z","Content":"\n\u003Cp\u003EDiazo, I tried the new DLL file, and it failed to control the jets at all, once it got airborne. I clicked the \u002B1 velocity button, and the computer slowly advanced the throttle to about a 1.2 TWR, but trying to kill the speed, reduce the altitude, or lower it, did nothing after that point. The VTOL just continued to climb. I did make sure to have a probe core installed, so that the navball showed me pointing straight up. \u003C/p\u003E\u003Cp\u003EBy the way, if you manage to find a way to make this work from the cockpit, I will have your babies! \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue2.gif\u0022 alt=\u0022:sticktongue:\u0022\u003E For me, being able to control motion front to rear and side to side like a helicopter, is far easier than trying to kill speed by finding the retrograde marker in an atmospheric VTOL. Keeping my fingers crossed!\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://mykspcareer.com/wp-content/uploads/2013/08/navBall.jpg\u0022 alt=\u0022navBall.jpg\u0022\u003E \u0026lt;---That\u0027s the stuff!\u003C/p\u003E\n"},{"CreatedByName":"Voculus","CreatedById":85437,"CreatedDateTime":"2014-07-09T06:02:21Z","Content":"\n\u003Cp\u003EOK, Just tried it again with a brand new craft, and it works excellent. The first VTOL I tried had the engines mounted on Infernal Robotics Docking washers, although they were pointed straight up. I wonder if that was throwing it off.\u003C/p\u003E\u003Cp\u003EEDIT: I was fooling about, and managed to destroy one of my three jet engines. The SAS kept the vessel upright, and your mod automatically and instantly responded to the sudden loss of mass and thrust. I can\u0027t tell you how impressed I am! \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-07-09T06:21:55Z\u0022 title=\u002207/09/2014 06:21  AM\u0022 data-short=\u002210 yr\u0022\u003EJuly 9, 2014\u003C/time\u003E by Voculus\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Galane","CreatedById":77949,"CreatedDateTime":"2014-07-09T06:27:02Z","Content":"\n\u003Cp\u003EPID, Proportional Integral Derivative is what might be able to tame those sluggish jet engines for hovering. \u003Ca href=\u0022https://en.wikipedia.org/wiki/PID_controller\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://en.wikipedia.org/wiki/PID_controller\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EThe plugin would have to read the engine part CFG data to calculate the thrust/time curves then add those for all the engines on the craft (and as the people doing MechJeb found out, calculating thrust for off-axis pointing engines is a PITA). Combine that with the ever changing mass of the craft as fuel is burned and it should be possible to get the correct throttle adjustment to achieve the desired altitude change with little or no overshoot or bouncing.\u003C/p\u003E\u003Cp\u003ESome interesting info on real jet engines. \u003Ca href=\u0022http://boards.straightdope.com/sdmb/showthread.php?t=696218\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://boards.straightdope.com/sdmb/showthread.php?t=696218\u003C/a\u003E\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022http://www.airliners.net/aviation-forums/tech_ops/read.main/99094/\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://www.airliners.net/aviation-forums/tech_ops/read.main/99094/\u003C/a\u003E\u003C/p\u003E\u003Cp\u003ECurrent FAA regulations (linked in the straightdope one) require commercial turbofan jet engines to be able to spool up from \u0022flight idle\u0022 (which is higher than \u0022ground idle\u0022) to 95% power in no more than five seconds. Turbojet engines (without that big fan that\u0027s basically a multi-blade, shrouded propeller) can have a considerably faster throttle response.\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-07-09T13:40:29Z","Content":"\n\u003Cp\u003E@Galane: I did consider a PID controller way back when I started, but the rocket engines on my skycranes I was working with at the time have effectively instantaneous response so I did not need it and while I am familiar with them because the company I work for uses them all the time, I don\u0027t personally work with them and would have had to learn PID and programming at the same time. (This mod was effectively my first programming project ever when I started.)\u003C/p\u003E\u003Cp\u003E@Voculus: About an hour after I signed off for the night I realized I\u0027d screwed the math up on that .dll I linked to you. It might have a little better throttle control but it will probably be about the same as the official release.\u003C/p\u003E\u003Cp\u003EIt is a two second fix, but it will have to wait until I get home from work tonight before I can correct it.\u003C/p\u003E\u003Cp\u003E@Control from the cockpit: I also know how to make this work, but I will have to modify the UI to fit a couple more buttons it will require as the player needs to be able to control the switch between Rocket and Plane mode.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n"},{"CreatedByName":"Galane","CreatedById":77949,"CreatedDateTime":"2014-07-10T01:28:19Z","Content":"\n\u003Cp\u003EIsn\u0027t working for a company that uses PID technology an excellent reason to learn the deep down stuff on how they work? \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif\u0022 alt=\u0022;)\u0022\u003E Might gain yourself a pay increase or other perks...\u003C/p\u003E\u003Cp\u003EAdjusting the throttle response of the jet engines in KSP could be a useful method of simulation testing of PID algorithms. Tweak the throttle response to act like something that needs PID controlled, then write the code to work with it. Then the code can be tried on the real application the KSP engine was adjusted to mimic. Certainly cheap enough it won\u0027t break any budgets.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-07-10T01:31:09Z\u0022 title=\u002207/10/2014 01:31  AM\u0022 data-short=\u002210 yr\u0022\u003EJuly 10, 2014\u003C/time\u003E by Galane\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-07-10T03:46:56Z","Content":"\n\u003Cp\u003E@Jet engine throttle: I\u0027ve tweaked the compensation again and I think I have the bounce as low as it can go. It is still pretty bad but one of the fundamental assumptions my mod makes is that it will have instant (or close enough) throttle control. It would be a rewrite from the ground up at this point to fix that issue. (And so will almost certainly not happen.)\u003C/p\u003E\u003Cp\u003E@Control from cockpit: This is about half done. I\u0027ve not really worked with rotations before and so I\u0027m learning as I go here. I will offer control from all 6 directions however if for some reason you wanted to use a backwards cockpit or an upside down control module on a rocket.\u003C/p\u003E\u003Cp\u003E@Galane: Heh, I would like that. Not my job though, I\u0027m the draftsman, I just sit next to the programmers.....\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n"},{"CreatedByName":"Galane","CreatedById":77949,"CreatedDateTime":"2014-07-10T07:38:18Z","Content":"\n\u003Cp\u003EYou could casually mention this amazing simulation software program that is masquerading as a game...\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-07-11T04:13:14Z","Content":"\n\u003Cp\u003EVersion 1.11 Alpha release, not linked in first post.\u003C/p\u003E\u003Cp\u003EAlright, for those interested, \u003Ca href=\u0022https://drive.google.com/file/d/0B6-5UOjSWq7bbDBkQmFfZWx2MFU/edit?usp=sharing\u0022 rel=\u0022external nofollow\u0022\u003Ethe alpha version of 1.11 is available here.\u003C/a\u003E\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022text-decoration:underline;\u0022\u003EThis is not final, I have 2 things to fix.\u003C/span\u003E\u003C/p\u003E\u003Cp\u003EFor those that download this, it has yet another version of the Jet Engine spooling compensation code and the ability to change the Up direction to allow flying from a cockpit.\u003C/p\u003E\u003Cp\u003ETo change the Up direction, open the settings window.\u003C/p\u003E\u003Cp\u003EClick the \u0027Direction\u0027 button to display a red arrow in the current upwards direction. Click the Up, Down, Forward, Back, Left, Right (U D F B L R) buttons to change the direction until the red arrow points up.\u003C/p\u003E\u003Cp\u003EPeople launching rockets should be able to leave it at default, people launching planes will probably want Back.\u003C/p\u003E\u003Cp\u003EReason this version is still alpha:\u003C/p\u003E\u003Cp\u003EThe up direction does not save, it will reset to default (for rockets) every time you switch vessels. I want to get this saving on a per ship basis.\u003C/p\u003E\u003Cp\u003EI need to change the directions, planes should use Forward, not Back as they currently do.\u003C/p\u003E\u003Cp\u003EI want to go over the Jet Spooling compensation again. I know I won\u0027t get rid of the bounce but I think it could be better.\u003C/p\u003E\u003Cp\u003EIf you try it out, let me know what you think.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n"},{"CreatedByName":"Voculus","CreatedById":85437,"CreatedDateTime":"2014-07-11T06:22:55Z","Content":"\n\u003Cp\u003EFirst off, a thousand thanks, Diazo! I gave the new DLL a whirl, and found that while using jet engines, if I set a height of something like 1000 meters, it has a hard time settling in on that altitude, as it bobs up and down several hundred meters at a time. No doubt a limitation of the way jet engines spool up and down at different rates. I don\u0027t fault your mod for that at all. However, for my jet VTOLs, I prefer stepping up the climb rate in small increments, and it works flawlessly. The throttle is smooth and accurate, and compensates for changes in pitch and lift quite nicely. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E I did notice an odd quirk, however. If I\u0027m climbing, and click the zero vel. button, it smoothly stops the climb and levels out. If I use the keyboard, by pressing Z\u002BX, the engines cut out briefly, the ship will drop a couple meters, and then it will enter a hover.\u003C/p\u003E\u003Cp\u003ESecondly, being able to control from the cockpit is so frakkin\u0027 cool, I can\u0027t even tell you! Looking out the cockpit glass, or using the chase view from the aft, while being able to use the stick and rudder pedals like a conventional aircraft is incredibly fun.\u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cool.gif\u0022 alt=\u0022:cool:\u0022\u003E Also, showing the red direction indicator was brilliant!\u003C/p\u003E\u003Cp\u003ERight-click and \u0022view image\u0022, because it\u0027s so ridiculously large!\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022https://4q2bdq.bn1.livefilestore.com/y2pshQKRqeoprw7-VExh0i3oaghQs6ykw2QW2L7QgK75VXeFoGorA08yKkobO7EoFAp_5T5izs8uunlp6ZgXSyQaGiEINxIv460W0JBKyB-8M0/screenshot189.png?psid=1\u0022 alt=\u0022screenshot189.png?psid=1\u0022\u003E\u003C/p\u003E\u003Cp\u003EThis is a little light duty lifter VTOL I\u0027ve been trying to perfect these past few days. So far, it\u0027s shaping up very nicely, and thanks to your Vertical Speed mod, along with Davion\u0027s throttle mod, this ship one of my most favorite craft ever. You can see it carrying the \u0022New DLL Test Ship\u0022 below. That was the craft I used to test your new file. I hauled through the space center from the runway to the launch pad, killed the rear engines and forward velocity, hovered over the ship, and picked it up with the KAS magnets. I had planned to drop i t off at the island runway, to see how the ship would handle a swinging load, but as I was mashing away at the keyboard, the Windows Sticky Keys popped up! When I closed it and returned to the game, the ship spun out of control, and crashed, so then I decided to write this. Thanks again!\u003C/p\u003E\n"},{"CreatedByName":"Voculus","CreatedById":85437,"CreatedDateTime":"2014-07-11T07:38:22Z","Content":"\n\u003Cp\u003EOk, with a bit more testing, the X\u002BZ key combo is behaving nicely. Not sure what the deal was. Maybe just a quirk of the Gladius VTOL engines, which are awesome, by the way. The keyboard commands are a lifesaver, since I have one hand on the flight stick, and it\u0027s hard to let go to click with a mouse!\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-07-11T13:18:40Z\u0022 title=\u002207/11/2014 01:18  PM\u0022 data-short=\u002210 yr\u0022\u003EJuly 11, 2014\u003C/time\u003E by Voculus\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-07-11T13:47:48Z","Content":"\n\u003Cp\u003EGlad to hear it\u0027s working out for you!\u003C/p\u003E\u003Cp\u003EThe Z\u002BX dropping thing is cause by the fact that I don\u0027t actually stop the keyboard command so when you hit X KSP gets the \u0022cut throttle\u0022 command and for an instant your throttle drops to 0%. The mod bring it back up almost instantly, but only almost.\u003C/p\u003E\u003Cp\u003ENow that I\u0027m more familiar with how key bindings work, I\u0027ll go ahead and add an intercept so that when the Z key is held down, throttle commands are no longer passed to KSP. (The same thing happened to up and down throttle also but is unoticable due to how small an effect those have.)\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-07-12T03:26:24Z","Content":"\n\u003Cp\u003E\u003Cstrong\u003EVersion 1.11 Release\u003C/strong\u003E\u003C/p\u003E\u003Cp\u003E-Tweaked Jet Engine spooling compensation to reduce the bounce experienced when Jet Engines are the primary source of lift.\u003C/p\u003E\u003Cp\u003ENote that due to how the mod performs calculations this bounce can not be totally removed and so Height Control is not recommended when using Jet Engines.\u003C/p\u003E\u003Cp\u003E-Add the ability to select which axis is up.\u003C/p\u003E\u003Cp\u003ENow VTOL\u0027s with cockpits can use this mod to take off and land without having to put a secondary probe core on the vessel that is rotated as the mod expects.\u003C/p\u003E\u003Cp\u003EIf modulemanager is installed, this setting will be remembered on a per craft basis.\u003C/p\u003E\u003Cp\u003EThe mod will still work without modulemanager installed, but the up direction will reset each time a craft loads.\u003C/p\u003E\u003Cp\u003EAs always, feedback is appreciated, especially for those using this with the Davon Throttle Control. Would having the ability to select which throttle(s) are controlled by my mod be beneficial?\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n"},{"CreatedByName":"Voculus","CreatedById":85437,"CreatedDateTime":"2014-07-13T12:51:49Z","Content":"\n\u003Cp\u003EAlright, I\u0027ve been doing a lot more stress testing, and there\u0027s just one odd quirk that seems to be mostly related to mod part landing gear. For instance, the Firespitter tailwheel, when attached anywhere to the vehicle breaks the velocity and height modes. I can enter a height of 10m as an example, and the craft will throttle up enough to gain altitude at a pretty good speed, but the radar altimeter reads zero, and the ship keeps shooting straight up. I discovered by accident, when I broke off those wheels from a hard landing, that the plugin began working normally again, without having to reload the craft. Anyway, it\u0027s not a huge deal, since most of the B9 and TT wheels I tend to use work great with your mod.\u003C/p\u003E\u003Cp\u003ENow here\u0027s my other question: Is it possible to switch between two separate engine profiles? One for long-spooling engines like the jets and KAX props, and another, much more aggressive profile for near-instant engines like helicopter rotors and rockets? I ask this, because when I\u0027m using height control mode, the ships have a hard time compensating for somewhat medium variations in the terrain, even with plenty of reserve power to pull it off. I\u0027m going to try and whip up a video to show exactly what\u0027s happening.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-07-13T13:19:58Z\u0022 title=\u002207/13/2014 01:19  PM\u0022 data-short=\u00229 yr\u0022\u003EJuly 13, 2014\u003C/time\u003E by Voculus\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-07-13T16:01:00Z","Content":"\n\u003Cp\u003EFor those who are interested in the sideways velocity cancelling mod I\u0027ve talked about, \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/85838-0-23-5-%28Jul13-14%29-RCS-Landing-Aid-Kill-your-horizontal-velocity-to-land\u0022 rel=\u0022external nofollow\u0022\u003EI have the initial release of it here.\u003C/a\u003E\u003C/p\u003E\u003Cp\u003E@Firespitter tailwheel: Odd, that is really strange behavior. I\u0027ll look into it and see what is going on as I am now curious, I can think of anything that would make a part cause the behavior you describe.\u003C/p\u003E\u003Cp\u003E@Height control: It sounds like I need to take another look at the control math for this. I\u0027ve gone through a few different versions and what is in there now was the best I found at the time but I have yet to find the math that feels right for this, I\u0027ve only been able to get it close enough.\u003C/p\u003E\u003Cp\u003EI should have some time this afternoon to look into both of those.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\u003Cp\u003Eedit: Fix is in for the tailwheel breaking everything. It has its part collider defined in a non-standard way so my mod could not find it and as this had not come up before I did not have my error trap setup correctly.\u003C/p\u003E\u003Cp\u003ELooking at the height control now.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-07-13T20:58:53Z\u0022 title=\u002207/13/2014 08:58  PM\u0022 data-short=\u00229 yr\u0022\u003EJuly 13, 2014\u003C/time\u003E by Diazo\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Voculus","CreatedById":85437,"CreatedDateTime":"2014-07-13T20:58:28Z","Content":"\n\u003Cp\u003EOK, it takes Youtube ages to render the vid in HD, so you may need to rewind to see the throttle and mod window, but you can see it applying a bit of lift, but not enough to clear the deck without having to maneuver manually. Not that I\u0027m looking for a magical autopilot, but the idea of a kind of low and fast ground following radar type of flight control is just awesome! I\u0027m going to check out your newest mod. Your hard work is much appreciated. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E\n\u003C/p\u003E\u003Cdiv class=\u0022ipsEmbeddedVideo\u0022 contenteditable=\u0022false\u0022\u003E\u003Cdiv\u003E\u003Ciframe width=\u0022480\u0022 height=\u0022270\u0022 src=\u0022https://www.youtube.com/embed/AT0q-Dc9UGg?feature=oembed\u0022 frameborder=\u00220\u0022 allowfullscreen=\u0022true\u0022\u003E\u003C/iframe\u003E\u003C/div\u003E\u003C/div\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-07-14T02:09:26Z","Content":"\n\u003Cp\u003E\u003Cstrong\u003EVersion 1.12 Release\u003C/strong\u003E\u003C/p\u003E\u003Cp\u003E-Fix parts with non-standard colliders so they no longer lock the engines at max. (The firespitter tail wheel.)\u003C/p\u003E\u003Cp\u003E-Redo height control code from scratch to clean it up.\u003C/p\u003E\u003Cp\u003ELet me know how the height control now works. Once I started looking into it, I realized I\u0027d left it in quite a mess and so I just ripped it all out and redid everything.\u003C/p\u003E\u003Cp\u003ENote that due to the limitations I\u0027m working under, there is still overshoot present, but we are talking kilometers of vertical travel before you see more then a few meters of overshoot. This still means however that if you want to try landing on height control rather then velocity control, you need to pause and stabilize at 100 or 200 meters and then go down from there. It was reasonably reliable in my tests, but most of my tests use small, high TWR vessels so I will not guarantee a safe landing. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003ED\u0026gt;\u003C/p\u003E\n"},{"CreatedByName":"Voculus","CreatedById":85437,"CreatedDateTime":"2014-07-14T08:57:39Z","Content":"\n\u003Cp\u003EIt seems as if there\u0027s no change in behavior. For the last round of testing, I set the height to 20m, and approached a 30\u00C3\u201A\u00C2\u00B0 hill at about 30m/s. The throttle was at about 50% to maintain the height, but as the ground rose up, the throttle refused to move more than a hair, even though there was plenty of power for it to use. It seemed the rate at which the altitude above ground varied, was much higher than the throttle was allowed to change. Maybe I\u0027m just trying to make it do something other than what it was intended for. I feel bad about making you redo all of your work just on account of me.\u003C/p\u003E\u003Cp\u003EI\u0027m going to try some lighter ships, with a much higher TWR.\u003C/p\u003E\u003Cp\u003EEDIT: The higher TWR isn\u0027t doing the trick, either. The ship simply hovers with less throttle required, but will not change altitude above a certain rate.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-07-14T09:24:49Z\u0022 title=\u002207/14/2014 09:24  AM\u0022 data-short=\u00229 yr\u0022\u003EJuly 14, 2014\u003C/time\u003E by Voculus\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-07-14T14:12:25Z","Content":"\n\u003Cp\u003EHeh, no worries. \u003C/p\u003E\u003Cp\u003EWhen I looked back at it again, the code was a \u003Cem\u003Emess\u003C/em\u003E of if conditions and conditional statements that was just ugly and begging to be ripped out.\u003C/p\u003E\u003Cp\u003EIt calculated your desired velocity in 6 different ways depending on what the state of your vessel was, and then double that to 12 ways because I had to flip to a negative setpoint if the vessel was above your target altitude. I ripped all that out and replaced it with just 2 ways, one for above and one for below the height setpoint, with an exception if the vessel is really close to target altitude to mitigate bouncing.\u003C/p\u003E\u003Cp\u003EThe fact that it behaves the same after I\u0027ve gutted and rewritten everything is actually very good news as it means I got the rewrite correct.\u003C/p\u003E\u003Cp\u003EAnyways, wall of text time. Here\u0027s what\u0027s happening in the background that\u0027s making this so iffy.\u003C/p\u003E\u003Cp\u003EFirst, the way the mod works is that the actual control of the engines is done by velocity setpoint, even when in height control mode. When in height control mode I mask this by calculating a velocity setpoint based on how far you are from your target altitude, but I\u0027m still passing a velocity setpoint to the engines.\u003C/p\u003E\u003Cp\u003EAlso, this setpoint is done to the terrain straight down, I have no method for checking forward to see what terrain is coming up, just the terrain directly below the vessel. The mod does check each part\u0027s distance to ground so it should be using a part at the front of the vessel for distance, not center of mass, so it should start climbing as soon as the nose hits the hill.\u003C/p\u003E\u003Cp\u003EThen I have to contend with the acceleration delay, the mod is reactive, not predictive, so it can not start increasing the throttle until it sees the hill.\u003C/p\u003E\u003Cp\u003EThen there seems to be a fudge factor in KSP itself, I never see acceleration or velocity changes as fast as the math implies I should be seeing them.\u003C/p\u003E\u003Cp\u003EWhat this all means, is that if you are within the force of gravity as distance (so 9.8 meters on Kerbin), I\u0027ve put a limit on your velocity, otherwise the acceleration delay would cause you to bounce as the mod was effectively ahead of your vessel\u0027s situation and the engines were trying to catch up.\u003C/p\u003E\u003Cp\u003EI got around this by putting a hard limit on what your velocity can be near your target altitude, but it sounds like it is too restrictive for what you are trying to do. What your post has made me realize is I took the restriction for descending (that I made very restrictive to make sure skycranes were not overshooting and crashing) and copy-pasted it for the ascending limit when it does not need to be as restrictive since there is no danger to overshooting your target while ascending.\u003C/p\u003E\u003Cp\u003ESo, let\u0027s do some math on your example of 30\u00C3\u201A\u00C2\u00B0 at 30m/s. With that, the terrain rises 9m a second, so my mod has 2 seconds to avoid a crash if you start at 20m. (Technically 18m, but close enough).\u003C/p\u003E\u003Cp\u003EWith the current limits in place that\u0027s... \u003Cem\u003Eouch\u003C/em\u003E \u003C/p\u003E\u003Cp\u003ENever mind the time, the ground is climbing at 9 m/s, but for a height difference of 20m, the mod will only try to move upwards at 4.9 m/s.\u003C/p\u003E\u003Cp\u003EI can certainly relax that restriction when moving upwards, I\u0027ll have to test and see by how much though. \u003C/p\u003E\u003Cp\u003EThe ground climbing at 9m/s is fast though, I\u0027m not sure that can be compensated for without looking forward to predict the future terrain.\u003C/p\u003E\u003Cp\u003EI\u0027ll see what I can do.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n"},{"CreatedByName":"Voculus","CreatedById":85437,"CreatedDateTime":"2014-07-14T14:28:26Z","Content":"\n\u003Cp\u003EI didn\u0027t realize how taxing the flight regime was, that I was asking for. Putting math to it makes it a lot clearer. Thanks for shedding some light on your work. As always, it\u0027s very appreciated. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-07-15T01:23:02Z","Content":"\n\u003Cp\u003EAlright, \u003Ca href=\u0022https://drive.google.com/file/d/0B6-5UOjSWq7beG5MMkZTV2NTQ0k/edit?usp=sharing\u0022 rel=\u0022external nofollow\u0022\u003Ehere\u0027s a version of the .dll with tweaked height control.\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EIt is much more aggressive going up which means there is now some over shoot, but there should not be anything more then 5 meters in any flight profile I can imagine people using. (If I assumed wrong, make a comment with your flight profile and I\u0027ll look into it.\u003C/p\u003E\u003Cp\u003EOn the 30\u00C3\u201A\u00C2\u00B0 at 30 m/s example for 9m/s terrain height change, the mod will now try to rise at 9.8m/s (Kerbin\u0027s gravity) at 20m below target. This will be true until 14m below target at which point the mod will try to set the upwards velocity at 70% of the distance to go. (So an upwards velocity of 1.4m/s if you are 2m below target.)\u003C/p\u003E\u003Cp\u003EI\u0027m not sure this could handle the 9m/s example mind you, but it will come an awful lot closer now.\u003C/p\u003E\u003Cp\u003EI also tweaked the going down code and almost eliminated the overshoot going that way. Using Hyperedit I threw a ship at the moon from 200km up and 400m/s downwards. The new code stopped the ship at 1000m with only 5-6 meters of overshoot so I\u0027m going to call that acceptable.\u003C/p\u003E\u003Cp\u003EAs always, any comments are good comments.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-07-15T01:26:06Z\u0022 title=\u002207/15/2014 01:26  AM\u0022 data-short=\u00229 yr\u0022\u003EJuly 15, 2014\u003C/time\u003E by Diazo\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Galane","CreatedById":77949,"CreatedDateTime":"2014-07-15T03:32:46Z","Content":"\n\u003Cp\u003EA terrain following radar part that aims a \u0027radar beam\u0027 out would be a useful addition. Reading the angle the part is mounted at, relative to the straight down vector the mod uses for height control... I suspect would not be trivial. Perhaps a modification of a quantum strut?\u003C/p\u003E\u003Cp\u003EBut it would be cool. Could also open up the door to things like station or distance keeping in space, or triggering actions when a set distance from another object is reached.\u003C/p\u003E\u003Cp\u003EHmmm, instead of a single beam, how about an inline stack part that has several beams down at a fixed angle? For planes it could be a part that has a half circle of beams. Could end up with several parts for different ways of mounting and required to be attached upright to avoid calculations due to user placement at arbitrary angles.\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-07-15T04:22:45Z","Content":"\n\u003Cp\u003E@Galane: I don\u0027t think any of those things is going to happen with this mod.\u003C/p\u003E\u003Cp\u003EThe reason being that this mod is to land skycranes safely and for that all that is needed is the distance to terrain straight down.\u003C/p\u003E\u003Cp\u003EI enjoy tweaking features to help people out (this is a learning experience in programming for me), but I\u0027m not going to be adding new features that double (or triple) the size of the mod in terms of code.\u003C/p\u003E\u003Cp\u003EWhat you are talking about is a true autopilot really, that is well beyond the scope of what I want to attempt with this mod.\u003C/p\u003E\u003Cp\u003E@Dll I linked in the last post: I\u0027m going to give it a few more days for feedback (and tweaks if needed) before pushing that .dll as an official release.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n"}]}