{"TopicId":22972,"ForumId":34,"TopicTitle":"[0.90] ProgCom - CPU Emulator V0.11.1","CreatedByName":"SimplySimon","CreatedById":18291,"CreatedDateTime":"2013-04-19T22:57:47Z","PageNum":7,"Articles":[{"CreatedByName":"SimplySimon","CreatedById":18291,"CreatedDateTime":"2014-01-05T00:38:06Z","Content":"\n\u003Cp\u003EI thought I\u0027d give an update on what I have been working on.\u003C/p\u003E\u003Cp\u003EI have created a new system for adding hardware for ProgCom, which will be the backbone for all the hardware type stuff I add to the emulator. I have made some progress on moving over most of the current functionality over to the new system, the tape drive and data relating to orientation now use it, but there is still some things left to do, such as the display and the keyboard.\u003C/p\u003E\u003Cp\u003EI have also been working on a compiler. Since I decided to go with reverse polish notation rather than infix notation the syntax is somewhat different from c/c-derived languages. Here\u0027s an example of the syntax as well as the equivalent statements in c:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Edef main : int {//int main(void)\u003Cbr\u003E  int x y z;//int x, y, z;\u003Cbr\u003E  x 2 =;//x = 2;\u003Cbr\u003E  y 3 =;//y = 3;\u003Cbr\u003E\u003Cbr\u003E  z x y * =;//z = x * y;\u003Cbr\u003E  x y z add2 $ =;//x = add2(y, z);\u003Cbr\u003E\u003Cbr\u003E  y x x \u002B z z \u002B * =;//y = (x\u002Bx)*(z\u002Bz);\u003Cbr\u003E\u003Cbr\u003E  int# pointer;//int* pointer;\u003Cbr\u003E  pointer z@ =;//pointer = \u0026amp;z;\u003Cbr\u003E  x pointer# =;//x = *pointer;\u003Cbr\u003E  pointer x \u0026lt;-;//*pointer = x;\u003Cbr\u003E\u003Cbr\u003E  if x y \u0026lt;; {//if(x \u0026lt; y) {\u003Cbr\u003E    while x y \u0026lt;; x\u002B\u002B;//while(x \u0026lt; y) x\u002B\u002B;\u003Cbr\u003E  }\u003Cbr\u003E\u003Cbr\u003E  float f;//float f;\u003Cbr\u003E  f z (float) =;//f = (float)z;\u003Cbr\u003E\u003Cbr\u003E  \u0022Hello, World!\u0022 print$;//print(\u0022Hello, World!\u0022);\u003Cbr\u003E\u003Cbr\u003E  return 0;\u003Cbr\u003E}\u003Cbr\u003E\u003Cbr\u003Edef add2 int a b : int {//int add2(int a, int \u003Cbr\u003E  return a b \u002B;//return a \u002B b;\u003Cbr\u003E}\u003Cbr\u003E\u003Cbr\u003Edef print char# string:  {\u003Cbr\u003E  asm string;\u003Cbr\u003E  \u0022push ra\u0022\u003Cbr\u003E  \u0022call print_asm\u0022\u003Cbr\u003E  \u0022pop ra\u0022\u003Cbr\u003E  ;;\u003Cbr\u003E  return;\u003Cbr\u003E}\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EIt still needs a bit of work though, since it is quite buggy at the moment.\u003C/p\u003E\u003Cp\u003EOther misc changes:\u003C/p\u003E\u003Cp\u003EI moved the EX register into the range of registers addressable by normal operations. This made the ax, sx, bx and rdx instructions redundant and they have been removed.\u003C/p\u003E\u003Cp\u003EThe fp, sp, ra, ex, es, ea registers can no longer be accessed as r13, r14, r15, a13, a14 and a15. The only register that can be accessed by two names is r0, which can also be accessed as \u0027zero\u0027.\u003C/p\u003E\u003Cp\u003EI fixed the bootloader bug where the computer would not load a program if the tape was inserted after the computer was turned on.\u003C/p\u003E\u003Cp\u003EThe \u0022serial interface\u0022 stuff that was used for the keyboard and the tape drive in the previous few versions has been removed in favor of the new hardware system.\u003C/p\u003E\u003Cp\u003EI have updated the text printing library. The new version works a bit better.\u003C/p\u003E\u003Cp\u003EHopefully I can release the next update in a week or two, but given how large a rewrite this has turned out to be it could take longer.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-01-05T20:52:06Z\u0022 title=\u002201/05/2014 08:52  PM\u0022 data-short=\u002210 yr\u0022\u003EJanuary 5, 2014\u003C/time\u003E by SimplySimon\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"diomedea","CreatedById":93700,"CreatedDateTime":"2014-01-05T02:00:20Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022SimplySimon\u0022 data-cite=\u0022SimplySimon\u0022\u003E\u003Cdiv\u003E...\u003Cp\u003EI have also been working on a compiler. \u003C/p\u003E\u003Cp\u003E...\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EA compiler is exactly what I need. \u003C/p\u003E\u003Cp\u003EI used kOS till now, but it is too laggy with my \u0022real-time\u0022 closed-loop control algorithms (though my PC is pretty powerful), so much that I had to stop including further refinements. And beyond that, kOS script language is not being developed to support even basic control flow program structures that would mean more efficiency.\u003C/p\u003E\u003Cp\u003E Therefore, I will be waiting for your updated ProgCom.\u003C/p\u003E\n"},{"CreatedByName":"SimplySimon","CreatedById":18291,"CreatedDateTime":"2014-02-02T22:19:09Z","Content":"\n\u003Cp\u003EI have updated progcom with the compiler and a bunch of other changes \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E. Most of the stuff is pretty behind-the-scenes, but there are quite a few visible changes too. I have not tested this as thoroughly as I probably should have so there might still be a few bugs in there, but as far as I can tell it works correctly. If anyone finds a bug or something that does not seem to work as the documentation says it should, please inform me and I\u0027ll try to fix it as soon as possible.\u003C/p\u003E\u003Cp\u003EThe issues I currently know about are:\u003C/p\u003E\u003Cp\u003EThe compiler:\u003C/p\u003E\u003Cp\u003E* The \u0026amp;\u0026amp;, || and ^^ operators can produce the wrong value if you assign the result of the operation to a variable that was a part of the operation.\u003C/p\u003E\u003Cp\u003E* The syntax for assigning an initial value to a global variable in inconsistent with the rest of the language (infix instead of postfix)\u003C/p\u003E\u003Cp\u003E* Some error messages are not very helpful\u003C/p\u003E\u003Cp\u003E* There is no way to specify what files need to be included in the source code yet\u003C/p\u003E\u003Cp\u003EThe assembler:\u003C/p\u003E\u003Cp\u003E* If you include a file containing macros the macros might not get recognised properly, giving odd error messages.\u003C/p\u003E\u003Cp\u003E* Some error messages are very vague, bordering on useless\u003C/p\u003E\u003Cp\u003EThe emulator:\u003C/p\u003E\u003Cp\u003E* Some instructions seem to have strange execution times some of the time\u003C/p\u003E\u003Cp\u003EI\u0027m not sure if I\u0027ve done a good job explaining the compiler in the documentation, so if anyone has any questions feel free to ask.\u003C/p\u003E\n"},{"CreatedByName":"aeTIos","CreatedById":17032,"CreatedDateTime":"2014-02-02T22:41:08Z","Content":"\n\u003Cp\u003EMaybe I have a valid argument for learning assembly now ;D\u003C/p\u003E\n"},{"CreatedByName":"diomedea","CreatedById":93700,"CreatedDateTime":"2014-02-02T23:21:30Z","Content":"\n\u003Cp\u003ENow I have no more excuses, I have to dust off my ASM skills \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E.\u003C/p\u003E\u003Cp\u003EImpressive work. A lot of documentation with the download. Happy to see some example programs, really needed, and references. Lots of material to read carefully. And then try in practice.\u003C/p\u003E\u003Cp\u003EEDIT: I would suggest to repack the files for ease while installing. Now the package installable files are nested in \u0022ProgCom/GameData/Parts\u0022 and \u0022ProgCom/GameData/Plugins\u0022; if reversed in \u0022GameData/ProgCom/Parts\u0022 and \u0022GameData/ProgCom/Plugins\u0022 it would take just one step to install and have everything in order in its own subfolder (and, automatic mod installers would also work better).\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-02-03T08:08:45Z\u0022 title=\u002202/03/2014 08:08  AM\u0022 data-short=\u002210 yr\u0022\u003EFebruary 3, 2014\u003C/time\u003E by diomedea\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"SimplySimon","CreatedById":18291,"CreatedDateTime":"2014-02-03T13:09:13Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022diomedea\u0022 data-cite=\u0022diomedea\u0022\u003E\u003Cdiv\u003ENow I have no more excuses, I have to dust off my ASM skills \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E.\u003Cp\u003EImpressive work. A lot of documentation with the download. Happy to see some example programs, really needed, and references. Lots of material to read carefully. And then try in practice.\u003C/p\u003E\u003Cp\u003EEDIT: I would suggest to repack the files for ease while installing. Now the package installable files are nested in \u0022ProgCom/GameData/Parts\u0022 and \u0022ProgCom/GameData/Plugins\u0022; if reversed in \u0022GameData/ProgCom/Parts\u0022 and \u0022GameData/ProgCom/Plugins\u0022 it would take just one step to install and have everything in order in its own subfolder (and, automatic mod installers would also work better).\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI\u0027m glad you like it \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EI have fixed the folder structure in the new version I just uploaded. I also fixed a bug regarding reading from the last 8 addresses in memory as well as clarified parts of the documentation.\u003C/p\u003E\n"},{"CreatedByName":"diomedea","CreatedById":93700,"CreatedDateTime":"2014-02-05T20:29:51Z","Content":"\n\u003Cp\u003EI found what could be an issue with the ProgCom IC part.\u003C/p\u003E\u003Cp\u003EUnfortunately, I wasn\u0027t able to find exactly why. So, I can only report my finding, you probably know how to solve that.\u003C/p\u003E\u003Cp\u003EI use A LOT of mods with KSP. One of those is Ferram\u0027s Aerospace Research (FAR). So, I use to check while in the VAB how a ship would handle with aerodynamics, thanks to the analysis system that FAR provides. So, I build a ship with the ProgCom IC, and now that FAR analysis doesn\u0027t work right any more. As soon as I take the ProgCOm IC out, FAR works fine as usual. In KSP debug window, the LOG shows a \u0022NullReference Exception\u0022 everytime I run the analysis with ProgCom IC, instead of some nice data from FAR as it happens without the IC. Therefore, I am 100% sure this IC is responsible for this issue.\u003C/p\u003E\u003Cp\u003EI tried to see if there was anything in the part.config file clearly out, but couldn\u0027t tell. I am sure you know better, so please check it.\u003C/p\u003E\u003Cp\u003EBelow, if that may come useful, is the excerpt from the log that appears everytime FAR can\u0027t complete the analysis.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003ENullReferenceException: Object reference not set to an instance of an object\u003Cbr\u003E  at ferram4.FAREditorGUI.CalculateStabilityDerivs (Single u0, Single q, Single M, Single alpha, Single beta, Single phi) [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003Cbr\u003E\u003Cbr\u003E  at ferram4.FAREditorGUI.StabilityDerivativeGUI (Boolean tmp) [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003Cbr\u003E\u003Cbr\u003E  at ferram4.FAREditorGUI.ActualGUI (Int32 windowID) [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003Cbr\u003E\u003Cbr\u003E  at UnityEngine.GUILayout\u002BLayoutedWindow.DoWindow (Int32 windowID) [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003Cbr\u003E\u003Cbr\u003E  at UnityEngine.GUI.CallWindowDelegate (UnityEngine.WindowFunction func, Int32 id, UnityEngine.GUISkin _skin, Int32 forceRect, Single width, Single height, UnityEngine.GUIStyle style) [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n"},{"CreatedByName":"SimplySimon","CreatedById":18291,"CreatedDateTime":"2014-02-08T13:43:58Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022diomedea\u0022 data-cite=\u0022diomedea\u0022\u003E\u003Cdiv\u003EI found what could be an issue with the ProgCom IC part.\u003Cp\u003EUnfortunately, I wasn\u0027t able to find exactly why. So, I can only report my finding, you probably know how to solve that.\u003C/p\u003E\u003Cp\u003EI use A LOT of mods with KSP. One of those is Ferram\u0027s Aerospace Research (FAR). So, I use to check while in the VAB how a ship would handle with aerodynamics, thanks to the analysis system that FAR provides. So, I build a ship with the ProgCom IC, and now that FAR analysis doesn\u0027t work right any more. As soon as I take the ProgCOm IC out, FAR works fine as usual. In KSP debug window, the LOG shows a \u0022NullReference Exception\u0022 everytime I run the analysis with ProgCom IC, instead of some nice data from FAR as it happens without the IC. Therefore, I am 100% sure this IC is responsible for this issue.\u003C/p\u003E\u003Cp\u003EI tried to see if there was anything in the part.config file clearly out, but couldn\u0027t tell. I am sure you know better, so please check it.\u003C/p\u003E\u003Cp\u003EBelow, if that may come useful, is the excerpt from the log that appears everytime FAR can\u0027t complete the analysis.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003ENullReferenceException: Object reference not set to an instance of an object\u003Cbr\u003E  at ferram4.FAREditorGUI.CalculateStabilityDerivs (Single u0, Single q, Single M, Single alpha, Single beta, Single phi) [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003Cbr\u003E\u003Cbr\u003E  at ferram4.FAREditorGUI.StabilityDerivativeGUI (Boolean tmp) [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003Cbr\u003E\u003Cbr\u003E  at ferram4.FAREditorGUI.ActualGUI (Int32 windowID) [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003Cbr\u003E\u003Cbr\u003E  at UnityEngine.GUILayout\u002BLayoutedWindow.DoWindow (Int32 windowID) [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003Cbr\u003E\u003Cbr\u003E  at UnityEngine.GUI.CallWindowDelegate (UnityEngine.WindowFunction func, Int32 id, UnityEngine.GUISkin _skin, Int32 forceRect, Single width, Single height, UnityEngine.GUIStyle style) [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI think I\u0027ve found the problem, apparently the game doesn\u0027t like it when you try to activate fly-by-wire functions in the VAB. I have disabled that and will upload an update later today.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-02-08T18:48:21Z\u0022 title=\u002202/08/2014 06:48  PM\u0022 data-short=\u002210 yr\u0022\u003EFebruary 8, 2014\u003C/time\u003E by SimplySimon\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"SimplySimon","CreatedById":18291,"CreatedDateTime":"2014-02-08T19:37:07Z","Content":"\n\u003Cp\u003EOk, I have uploaded the new version. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E Please tell me if the problem persists.\u003C/p\u003E\n"},{"CreatedByName":"diomedea","CreatedById":93700,"CreatedDateTime":"2014-02-08T23:14:28Z","Content":"\n\u003Cp\u003EI am positive you solved that issue. Did exactly the same test as before, with the new version: no problem found.\u003C/p\u003E\u003Cp\u003EThank you.\u003C/p\u003E\n"},{"CreatedByName":"SimplySimon","CreatedById":18291,"CreatedDateTime":"2014-06-09T16:03:52Z","Content":"\n\u003Cp\u003EHello everyone! I have been busy for a while, but since I now have some time on my hands I thought I\u0027d start updating ProgCom again \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EThis version is mostly bug fixes, though it is fixes for fairly major issues:\u003C/p\u003E\u003Cp\u003E* The \u0026amp;\u0026amp;, ^^ and || operators in the compiler should now be working\u003C/p\u003E\u003Cp\u003E* I fixed a bug that would occasionally arise when calling functions in the compiler\u003C/p\u003E\u003Cp\u003E* The assembler was generating the wrong opcode for the inti instruction, this has been fixed\u003C/p\u003E\u003Cp\u003E* The monitor was taking too much processing time, it has now been optimised\u003C/p\u003E\u003Cp\u003E* The tape drive had a few bugs with writing data to the tape, these have now been resolved.\u003C/p\u003E\u003Cp\u003E* The BUSY flag of the tape drive status register now behaves a bit more consistently\u003C/p\u003E\u003Cp\u003E* Various smaller fixes\u003C/p\u003E\n"},{"CreatedByName":"mjsmith","CreatedById":115537,"CreatedDateTime":"2014-07-17T08:33:53Z","Content":"\n\u003Cp\u003EThis mod needs so much more love \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_ohmy.png\u0022 alt=\u0022:o\u0022\u003E\u003C/p\u003E\u003Cp\u003EI started on a pretty basic drawing library but ran into issues when trying to write an absolute value function. Is there something wrong with the shift right arithmetic instructions or am I just tired? \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 alt=\u0022:D\u0022\u003E\u003C/p\u003E\u003Cp\u003EThis has been fun to mess around with. Haven\u0027t done any assembly since my class last Fall and I\u0027ve never implemented stuff like Bresenham\u0027s algorithms in any language regardless.\u003C/p\u003E\n"},{"CreatedByName":"mjsmith","CreatedById":115537,"CreatedDateTime":"2014-07-17T18:04:10Z","Content":"\n\u003Cp\u003ELooked again today. Looks like the bl and ble instructions don\u0027t work for negative integers. Is this a bug or by design? Undocumented regardless (afaik).\u003C/p\u003E\u003Cp\u003E.text\u003C/p\u003E\u003Cp\u003E#include libText.txt\u003C/p\u003E\u003Cp\u003E#global main\u003C/p\u003E\u003Cp\u003Emain:\u003C/p\u003E\u003Cp\u003E movi r1, -5 ; r1 = -5\u003C/p\u003E\u003Cp\u003E movi r2, 7 ; r2 = 7\u003C/p\u003E\u003Cp\u003E bl r1, r2, less ; if (r1 \u0026lt; r2) goto: less\u003C/p\u003E\u003Cp\u003E movi r1, 70 ; r1 = F alse\u003C/p\u003E\u003Cp\u003E call putChar ; Print\u003C/p\u003E\u003Cp\u003E halt ; Halt\u003C/p\u003E\u003Cp\u003Eless:\u003C/p\u003E\u003Cp\u003E movi r1, 84 ; r1 = T rue\u003C/p\u003E\u003Cp\u003E call putChar ; Print\u003C/p\u003E\u003Cp\u003E halt ; Halt\u003C/p\u003E\u003Cp\u003EShould print T, prints F. Changing -5 to 5 will print True.\u003C/p\u003E\n"},{"CreatedByName":"SimplySimon","CreatedById":18291,"CreatedDateTime":"2014-07-19T23:35:53Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022mjsmith\u0022 data-cite=\u0022mjsmith\u0022\u003E\u003Cdiv\u003ELooked again today. Looks like the bl and ble instructions don\u0027t work for negative integers. Is this a bug or by design? Undocumented regardless (afaik).\u003Cp\u003E.text\u003C/p\u003E\u003Cp\u003E#include libText.txt\u003C/p\u003E\u003Cp\u003E#global main\u003C/p\u003E\u003Cp\u003Emain:\u003C/p\u003E\u003Cp\u003E movi r1, -5 ; r1 = -5\u003C/p\u003E\u003Cp\u003E movi r2, 7 ; r2 = 7\u003C/p\u003E\u003Cp\u003E bl r1, r2, less ; if (r1 \u0026lt; r2) goto: less\u003C/p\u003E\u003Cp\u003E movi r1, 70 ; r1 = F alse\u003C/p\u003E\u003Cp\u003E call putChar ; Print\u003C/p\u003E\u003Cp\u003E halt ; Halt\u003C/p\u003E\u003Cp\u003Eless:\u003C/p\u003E\u003Cp\u003E movi r1, 84 ; r1 = T rue\u003C/p\u003E\u003Cp\u003E call putChar ; Print\u003C/p\u003E\u003Cp\u003E halt ; Halt\u003C/p\u003E\u003Cp\u003EShould print T, prints F. Changing -5 to 5 will print True.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EHi, sorry for the late reply!\u003C/p\u003E\u003Cp\u003EAs far as I can tell bl and ble should work with negative integers, however \u0022movi r1, -5\u0022 will not do what you expect. movi puts a 16-bit value in the specified register, so while the instruction will gladly accept the value -5, it will in fact put the value 65531 in r1. The workaround for this currently is to use \u0022subi r1, r0, 5\u0022, which will subtract 5 from r0, which is always 0, and thus put the right value in r1. I think I might need to document this behavior better.\u003C/p\u003E\u003Cp\u003EI\u0027m glad you like the mod \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-07-20T08:24:09Z\u0022 title=\u002207/20/2014 08:24  AM\u0022 data-short=\u00229 yr\u0022\u003EJuly 20, 2014\u003C/time\u003E by SimplySimon\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"mjsmith","CreatedById":115537,"CreatedDateTime":"2014-07-21T02:30:20Z","Content":"\n\u003Cp\u003EHey thanks a bunch for the reply. That seemed to help quite a bit. I\u0027ve now implemented a few routines for a drawing library (drawPixel, fillScreen, clearScreen, and drawLine). drawLine is not really finished unfortunately. Seems to fail horribly with positive slope among others hehe.\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022http://pastebin.com/Nj09Cm73\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://pastebin.com/Nj09Cm73\u003C/a\u003E - There\u0027s my drawing library libDraw.\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022http://i.imgur.com/1WLXaKy.png\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://i.imgur.com/1WLXaKy.png\u003C/a\u003E - There\u0027s an example of it in action.\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022http://pastebin.com/BWuwLGSd\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://pastebin.com/BWuwLGSd\u003C/a\u003E - The code for that image.\u003C/p\u003E\u003Cp\u003EIt has a very very long way to go (and its not even remotely optimized) but I\u0027m pretty stoked for it to draw lines \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 alt=\u0022:D\u0022\u003E\u003C/p\u003E\u003Cp\u003EIf you have some free time and can figure out why it bombs out on certain coordinates let me know. The template algorithm pseudocode I used can be found here: \u003Ca href=\u0022https://en.wikipedia.org/wiki?title=Talk:Bresenham%27s_line_algorithm#General_Line_drawing_algorithm\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://en.wikipedia.org/wiki?title=Talk:Bresenham%27s_line_algorithm#General_Line_drawing_algorithm\u003C/a\u003E I\u0027m sure it has something to do with a poorly written branch \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 alt=\u0022:D\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"SimplySimon","CreatedById":18291,"CreatedDateTime":"2014-07-21T19:41:23Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022mjsmith\u0022 data-cite=\u0022mjsmith\u0022\u003E\u003Cdiv\u003EHey thanks a bunch for the reply. That seemed to help quite a bit. I\u0027ve now implemented a few routines for a drawing library (drawPixel, fillScreen, clearScreen, and drawLine). drawLine is not really finished unfortunately. Seems to fail horribly with positive slope among others hehe.\u003Cp\u003E\u003Ca href=\u0022http://pastebin.com/Nj09Cm73\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://pastebin.com/Nj09Cm73\u003C/a\u003E - There\u0027s my drawing library libDraw.\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022http://i.imgur.com/1WLXaKy.png\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://i.imgur.com/1WLXaKy.png\u003C/a\u003E - There\u0027s an example of it in action.\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022http://pastebin.com/BWuwLGSd\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://pastebin.com/BWuwLGSd\u003C/a\u003E - The code for that image.\u003C/p\u003E\u003Cp\u003EIt has a very very long way to go (and its not even remotely optimized) but I\u0027m pretty stoked for it to draw lines \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 alt=\u0022:D\u0022\u003E\u003C/p\u003E\u003Cp\u003EIf you have some free time and can figure out why it bombs out on certain coordinates let me know. The template algorithm pseudocode I used can be found here: \u003Ca href=\u0022https://en.wikipedia.org/wiki?title=Talk:Bresenham%27s_line_algorithm#General_Line_drawing_algorithm\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://en.wikipedia.org/wiki?title=Talk:Bresenham%27s_line_algorithm#General_Line_drawing_algorithm\u003C/a\u003E I\u0027m sure it has something to do with a poorly written branch \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 alt=\u0022:D\u0022\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ECool stuff! I took a look at the code, and I think I got it to work.\u003C/p\u003E\u003Cp\u003EThe problem is that instead of \u0022subi a7/a8, r0, 1\u0022 you have written \u0022subi a7/a8, a0, 1\u0022. a0 is used by the bootloader to store the start address of the program, so it will not contain 0 when the program starts.\u003C/p\u003E\u003Cp\u003EHere\u0027s the function I used to test the changes:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E.text\u003Cbr\u003E#include libText.txt\u003Cbr\u003E#include libDraw.txt\u003Cbr\u003E\u003Cbr\u003E#global main\u003Cbr\u003Emain:\u003Cbr\u003E\tmov\tfp, sp\u003Cbr\u003E\taddi\tsp, sp, 8\u003Cbr\u003E\tmovi\tr1, 128\u003Cbr\u003E\tmovi\tr2, 8\u003Cbr\u003EinitLoop:\u003Cbr\u003E\tsubi\tr2, r2, 1\u003Cbr\u003E\twrr\tr1, fp, r2\u003Cbr\u003E\tbne\tr2, r0, initLoop\u003Cbr\u003EmainLoop:\u003Cbr\u003E\tcall\tclearScreen\u003Cbr\u003E\u003Cbr\u003E\t;draw a square\u003Cbr\u003E\trd\tr1, fp, 0\u003Cbr\u003E\trd\tr2, fp, 1\u003Cbr\u003E\trd\tr3, fp, 2\u003Cbr\u003E\trd\tr4, fp, 3\u003Cbr\u003E\tcall\tdrawLine\u003Cbr\u003E\u003Cbr\u003E\trd\tr1, fp, 2\u003Cbr\u003E\trd\tr2, fp, 3\u003Cbr\u003E\trd\tr3, fp, 4\u003Cbr\u003E\trd\tr4, fp, 5\u003Cbr\u003E\tcall\tdrawLine\u003Cbr\u003E\u003Cbr\u003E\trd\tr1, fp, 4\u003Cbr\u003E\trd\tr2, fp, 5\u003Cbr\u003E\trd\tr3, fp, 6\u003Cbr\u003E\trd\tr4, fp, 7\u003Cbr\u003E\tcall\tdrawLine\u003Cbr\u003E\u003Cbr\u003E\trd\tr1, fp, 6\u003Cbr\u003E\trd\tr2, fp, 7\u003Cbr\u003E\trd\tr3, fp, 0\u003Cbr\u003E\trd\tr4, fp, 1\u003Cbr\u003E\tcall\tdrawLine\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E\t;draw inner square\u003Cbr\u003E\trd\tr1, fp, 0\u003Cbr\u003E\trd\tr2, fp, 1\u003Cbr\u003E\trd\tr3, fp, 2\u003Cbr\u003E\trd\tr4, fp, 3\u003Cbr\u003E\tadd\tr1, r1, r3\u003Cbr\u003E\tsri\tr1, r1, 1\u003Cbr\u003E\tadd\tr2, r2, r4\u003Cbr\u003E\tsri\tr2, r2, 1\u003Cbr\u003E\u003Cbr\u003E\trd\tr3, fp, 2\u003Cbr\u003E\trd\tr4, fp, 3\u003Cbr\u003E\trd\tr5, fp, 4\u003Cbr\u003E\trd\tr6, fp, 5\u003Cbr\u003E\tadd\tr3, r3, r5\u003Cbr\u003E\tsri\tr3, r3, 1\u003Cbr\u003E\tadd\tr4, r4, r6\u003Cbr\u003E\tsri\tr4, r4, 1\u003Cbr\u003E\tcall\tdrawLine\u003Cbr\u003E\u003Cbr\u003E\trd\tr1, fp, 2\u003Cbr\u003E\trd\tr2, fp, 3\u003Cbr\u003E\trd\tr3, fp, 4\u003Cbr\u003E\trd\tr4, fp, 5\u003Cbr\u003E\tadd\tr1, r1, r3\u003Cbr\u003E\tsri\tr1, r1, 1\u003Cbr\u003E\tadd\tr2, r2, r4\u003Cbr\u003E\tsri\tr2, r2, 1\u003Cbr\u003E\u003Cbr\u003E\trd\tr3, fp, 4\u003Cbr\u003E\trd\tr4, fp, 5\u003Cbr\u003E\trd\tr5, fp, 6\u003Cbr\u003E\trd\tr6, fp, 7\u003Cbr\u003E\tadd\tr3, r3, r5\u003Cbr\u003E\tsri\tr3, r3, 1\u003Cbr\u003E\tadd\tr4, r4, r6\u003Cbr\u003E\tsri\tr4, r4, 1\u003Cbr\u003E\tcall\tdrawLine\u003Cbr\u003E\u003Cbr\u003E\trd\tr1, fp, 4\u003Cbr\u003E\trd\tr2, fp, 5\u003Cbr\u003E\trd\tr3, fp, 6\u003Cbr\u003E\trd\tr4, fp, 7\u003Cbr\u003E\tadd\tr1, r1, r3\u003Cbr\u003E\tsri\tr1, r1, 1\u003Cbr\u003E\tadd\tr2, r2, r4\u003Cbr\u003E\tsri\tr2, r2, 1\u003Cbr\u003E\u003Cbr\u003E\trd\tr3, fp, 6\u003Cbr\u003E\trd\tr4, fp, 7\u003Cbr\u003E\trd\tr5, fp, 0\u003Cbr\u003E\trd\tr6, fp, 1\u003Cbr\u003E\tadd\tr3, r3, r5\u003Cbr\u003E\tsri\tr3, r3, 1\u003Cbr\u003E\tadd\tr4, r4, r6\u003Cbr\u003E\tsri\tr4, r4, 1\u003Cbr\u003E\tcall\tdrawLine\u003Cbr\u003E\u003Cbr\u003E\trd\tr1, fp, 6\u003Cbr\u003E\trd\tr2, fp, 7\u003Cbr\u003E\trd\tr3, fp, 0\u003Cbr\u003E\trd\tr4, fp, 1\u003Cbr\u003E\tadd\tr1, r1, r3\u003Cbr\u003E\tsri\tr1, r1, 1\u003Cbr\u003E\tadd\tr2, r2, r4\u003Cbr\u003E\tsri\tr2, r2, 1\u003Cbr\u003E\u003Cbr\u003E\trd\tr3, fp, 0\u003Cbr\u003E\trd\tr4, fp, 1\u003Cbr\u003E\trd\tr5, fp, 2\u003Cbr\u003E\trd\tr6, fp, 3\u003Cbr\u003E\tadd\tr3, r3, r5\u003Cbr\u003E\tsri\tr3, r3, 1\u003Cbr\u003E\tadd\tr4, r4, r6\u003Cbr\u003E\tsri\tr4, r4, 1\u003Cbr\u003E\tcall\tdrawLine\u003Cbr\u003E\u003Cbr\u003E\trd\tr1, fp, 0\u003Cbr\u003E\taddi\tr1, r1, 7\u003Cbr\u003E\tandi\tr1, r1, 255\u003Cbr\u003E\twr\tr1, fp, 0\u003Cbr\u003E\trd\tr1, fp, 1\u003Cbr\u003E\taddi\tr1, r1, 5\u003Cbr\u003E\tandi\tr1, r1, 255\u003Cbr\u003E\twr\tr1, fp, 1\u003Cbr\u003E\u003Cbr\u003E\trd\tr1, fp, 2\u003Cbr\u003E\taddi\tr1, r1, 5\u003Cbr\u003E\tandi\tr1, r1, 255\u003Cbr\u003E\twr\tr1, fp, 2\u003Cbr\u003E\trd\tr1, fp, 3\u003Cbr\u003E\tsubi\tr1, r1, 7\u003Cbr\u003E\tandi\tr1, r1, 255\u003Cbr\u003E\twr\tr1, fp, 3\u003Cbr\u003E\u003Cbr\u003E\trd\tr1, fp, 4\u003Cbr\u003E\tsubi\tr1, r1, 7\u003Cbr\u003E\tandi\tr1, r1, 255\u003Cbr\u003E\twr\tr1, fp, 4\u003Cbr\u003E\trd\tr1, fp, 5\u003Cbr\u003E\tsubi\tr1, r1, 5\u003Cbr\u003E\tandi\tr1, r1, 255\u003Cbr\u003E\twr\tr1, fp, 5\u003Cbr\u003E\u003Cbr\u003E\trd\tr1, fp, 6\u003Cbr\u003E\tsubi\tr1, r1, 5\u003Cbr\u003E\tandi\tr1, r1, 255\u003Cbr\u003E\twr\tr1, fp, 6\u003Cbr\u003E\trd\tr1, fp, 7\u003Cbr\u003E\taddi\tr1, r1, 7\u003Cbr\u003E\tandi\tr1, r1, 255\u003Cbr\u003E\twr\tr1, fp, 7\u003Cbr\u003E\u003Cbr\u003E\trd\tr5, r0, GLOBAL_NUMPAD_OUT\u003Cbr\u003E\taddi\tr5, r5, 1\u003Cbr\u003E\twr\tr5, r0, GLOBAL_NUMPAD_OUT\u003Cbr\u003E\u003Cbr\u003E\tmovi\tr6, 15000\u003Cbr\u003EdelayLoop:\u003Cbr\u003E\tsubi\tr6, r6, 1\u003Cbr\u003E\tbne\tr6, r0, delayLoop\u003Cbr\u003E\u003Cbr\u003E\tbr\tmainLoop\u003Cbr\u003E\thalt\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003ESome other minor stuff I noticed:\u003C/p\u003E\u003Cp\u003E* in the drawPixel function you have the instruction \u0022mov r0, r3\u0022 which will try to put the value of r3 into r0, not the other way around.\u003C/p\u003E\u003Cp\u003E* You seem to have a third condition in the line drawing code, but I think that part should add offsetX/offsetY to x/y instead of constant 1. I might be wrong though. Either way it does not seem to be needed, I commented it out and the code worked anyway.\u003C/p\u003E\u003Cp\u003E* Your line drawing function does not follow the example code calling convention, although it is up to you if you want to follow that or not.\u003C/p\u003E\n"},{"CreatedByName":"mjsmith","CreatedById":115537,"CreatedDateTime":"2014-07-22T16:59:03Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022SimplySimon\u0022 data-cite=\u0022SimplySimon\u0022\u003E\u003Cdiv\u003ECool stuff! I took a look at the code, and I think I got it to work.\u003Cp\u003EThe problem is that instead of \u0022subi a7/a8, r0, 1\u0022 you have written \u0022subi a7/a8, a0, 1\u0022. a0 is used by the bootloader to store the start address of the program, so it will not contain 0 when the program starts.\u003C/p\u003E\u003Cp\u003ESome other minor stuff I noticed:\u003C/p\u003E\u003Cp\u003E* in the drawPixel function you have the instruction \u0022mov r0, r3\u0022 which will try to put the value of r3 into r0, not the other way around.\u003C/p\u003E\u003Cp\u003E* You seem to have a third condition in the line drawing code, but I think that part should add offsetX/offsetY to x/y instead of constant 1. I might be wrong though. Either way it does not seem to be needed, I commented it out and the code worked anyway.\u003C/p\u003E\u003Cp\u003E* Your line drawing function does not follow the example code calling convention, although it is up to you if you want to follow that or not.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EHey thanks a bunch! After awhile r and a start to look the same \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EI went ahead and replaced all the muls/divs with shifts as well as hopefully made it compliant to your calling conventions. Also removed some unnecessary code. That third condition was one such, suggested as being needed on that talk page but it isnt. That drawPixel mov is also unnecessary and has been removed.\u003C/p\u003E\u003Cp\u003EYou\u0027ve been a huge help. I\u0027m still not sure what I will actually do with any of this but it\u0027s been fun nonetheless. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 alt=\u0022:D\u0022\u003E\u003C/p\u003E\u003Cp\u003EUpdated libDraw with some changes/optimizations. A call to initializeDraw is now required at the beginning to set the display mode. Not sure if I\u0027ll keep it this way but I wanted to move that out of clearScreen for performance reasons.\u003C/p\u003E\u003Cp\u003EAdded circles. Wohoo. Slightly modified your drawing test.\u003C/p\u003E\u003Cp\u003ElibDraw.txt - \u003Ca href=\u0022http://pastebin.com/jth4Bi4a\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://pastebin.com/jth4Bi4a\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EdrawTest.txt - \u003Ca href=\u0022http://pastebin.com/jYvD6cjE\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://pastebin.com/jYvD6cjE\u003C/a\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-07-22T19:38:16Z\u0022 title=\u002207/22/2014 07:38  PM\u0022 data-short=\u00229 yr\u0022\u003EJuly 22, 2014\u003C/time\u003E by mjsmith\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"SimplySimon","CreatedById":18291,"CreatedDateTime":"2014-07-24T01:34:10Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022mjsmith\u0022 data-cite=\u0022mjsmith\u0022\u003E\u003Cdiv\u003EHey thanks a bunch! After awhile r and a start to look the same \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003Cp\u003EI went ahead and replaced all the muls/divs with shifts as well as hopefully made it compliant to your calling conventions. Also removed some unnecessary code. That third condition was one such, suggested as being needed on that talk page but it isnt. That drawPixel mov is also unnecessary and has been removed.\u003C/p\u003E\u003Cp\u003EYou\u0027ve been a huge help. I\u0027m still not sure what I will actually do with any of this but it\u0027s been fun nonetheless. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 alt=\u0022:D\u0022\u003E\u003C/p\u003E\u003Cp\u003EUpdated libDraw with some changes/optimizations. A call to initializeDraw is now required at the beginning to set the display mode. Not sure if I\u0027ll keep it this way but I wanted to move that out of clearScreen for performance reasons.\u003C/p\u003E\u003Cp\u003EAdded circles. Wohoo. Slightly modified your drawing test.\u003C/p\u003E\u003Cp\u003ElibDraw.txt - \u003Ca href=\u0022http://pastebin.com/jth4Bi4a\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://pastebin.com/jth4Bi4a\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EdrawTest.txt - \u003Ca href=\u0022http://pastebin.com/jYvD6cjE\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://pastebin.com/jYvD6cjE\u003C/a\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ENeato! Glad I could help \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EAlso, I thought I\u0027d give an update on what I\u0027ve been working on for the next version:\u003C/p\u003E\u003Cp\u003E* Expanded instruction set: more comparison instructions, bit manipulation stuff and logical and/or instructions\u003C/p\u003E\u003Cp\u003E* Hardware support for text/bitmap scrolling\u003C/p\u003E\u003Cp\u003E* Some minor improvements to the text printing library\u003C/p\u003E\u003Cp\u003E* A BASIC interpreter\u003C/p\u003E\u003Cp\u003E* A simple operating system\u003C/p\u003E\n"},{"CreatedByName":"mjsmith","CreatedById":115537,"CreatedDateTime":"2014-07-25T03:44:37Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022SimplySimon\u0022 data-cite=\u0022SimplySimon\u0022\u003E\u003Cdiv\u003ENeato! Glad I could help \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003Cp\u003EAlso, I thought I\u0027d give an update on what I\u0027ve been working on for the next version:\u003C/p\u003E\u003Cp\u003E* Expanded instruction set: more comparison instructions, bit manipulation stuff and logical and/or instructions\u003C/p\u003E\u003Cp\u003E* Hardware support for text/bitmap scrolling\u003C/p\u003E\u003Cp\u003E* Some minor improvements to the text printing library\u003C/p\u003E\u003Cp\u003E* A BASIC interpreter\u003C/p\u003E\u003Cp\u003E* A simple operating system\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ESounds awesome. I\u0027d love to see the simple os (minix based?). Also as somewhat of a feature request, maybe page flipping if feasible. I implemented double buffering and while it works pretty well, there\u0027s definitely a performance hit \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 alt=\u0022:D\u0022\u003E\u003C/p\u003E\u003Cp\u003EAlso on that note, I had my back buffer mapped to a memory address range that should be way out of bounds (138265). I thought the max address (as defined in libLabel) is 65535 or am I missing something? Not sure how I came up with that address either.\u003C/p\u003E\n"},{"CreatedByName":"SimplySimon","CreatedById":18291,"CreatedDateTime":"2014-07-26T01:32:22Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022mjsmith\u0022 data-cite=\u0022mjsmith\u0022\u003E\u003Cdiv\u003ESounds awesome. I\u0027d love to see the simple os (minix based?). Also as somewhat of a feature request, maybe page flipping if feasible. I implemented double buffering and while it works pretty well, there\u0027s definitely a performance hit \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 alt=\u0022:D\u0022\u003E\u003Cp\u003EAlso on that note, I had my back buffer mapped to a memory address range that should be way out of bounds (138265). I thought the max address (as defined in libLabel) is 65535 or am I missing something? Not sure how I came up with that address either.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ESimple might have been the wrong word to describe the OS, rudimentary might be better. It\u0027s basically an interrupt handler with some task switching and IO functionality attached. It\u0027s not really based on anything.\u003C/p\u003E\u003Cp\u003EPage flipping could be implemented, but it would require me to double the memory attached to the monitor, which I\u0027m hesitant to do for various reasons. It would be very simple to implement however, so I might do it anyway. Regarding the performance hit, some of that might come from the memory access times being calculated badly. Currently writing to cacheable memory (ie memory that does not share a cache line with a memory mapped hardware device) can be a lot slower for random access than writing to uncacheable memory (random access to the monitor is currently about 3x faster than an offscreen buffer). This will be fixed in the next update. I\u0027m also considering increasing the clock rate again, but I\u0027m less sure about that.\u003C/p\u003E\u003Cp\u003ERegarding that address range: when reading from memory, only the lowest 16 bits of the address are considered. Therefore 138265 is treated the same as 7193. So 65535 is the highest address you can read from in memory, if you try to read one address past it you will end up reading from address 0.\u003C/p\u003E\n"},{"CreatedByName":"mjsmith","CreatedById":115537,"CreatedDateTime":"2015-03-05T23:16:38Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022SimplySimon\u0022 data-cite=\u0022SimplySimon\u0022\u003E\u003Cdiv\u003ESimple might have been the wrong word to describe the OS, rudimentary might be better. It\u0027s basically an interrupt handler with some task switching and IO functionality attached. It\u0027s not really based on anything.\u003Cp\u003EPage flipping could be implemented, but it would require me to double the memory attached to the monitor, which I\u0027m hesitant to do for various reasons. It would be very simple to implement however, so I might do it anyway. Regarding the performance hit, some of that might come from the memory access times being calculated badly. Currently writing to cacheable memory (ie memory that does not share a cache line with a memory mapped hardware device) can be a lot slower for random access than writing to uncacheable memory (random access to the monitor is currently about 3x faster than an offscreen buffer). This will be fixed in the next update. I\u0027m also considering increasing the clock rate again, but I\u0027m less sure about that.\u003C/p\u003E\u003Cp\u003ERegarding that address range: when reading from memory, only the lowest 16 bits of the address are considered. Therefore 138265 is treated the same as 7193. So 65535 is the highest address you can read from in memory, if you try to read one address past it you will end up reading from address 0.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EFell off the map here. Busy busy. Currently taking an operating systems class for college and was wondering how your progress on this and progcom has been? Thinking about making a simple OS myself given enough time (i.e. Summer). \u003C/p\u003E\u003Cp\u003EIts been quite awhile since I looked at the docs for progcom so I can\u0027t remember the major limitations but hopefully it would be preemptive not cooperatively driven. Like you described, interrupt handler, dispatcher/scheduler and maybe some i/o routines would be the goal.\u003C/p\u003E\u003Cp\u003E*edit*\u003C/p\u003E\u003Cp\u003EDid some basic investigation. I think this would be exceedingly time consuming without struct support in the compiler. Also I couldn\u0027t find documentation on if it supported macros or not (I know the assembler does). For now I might just start by seeing if I can add struct support. Then move onto writing a simple malloc/free.\u003C/p\u003E\u003Cp\u003E*edit2*\u003C/p\u003E\u003Cp\u003EAdded extremely rudamentary and incomplete struct support. It\u0027s basically variable renaming at this point. No global support, no pointer support or member pointer support. Probably numerous other limitations and will need a proper redo (a bit more comfortable with the compiler layout now). Fork here: \u003Ca href=\u0022https://github.com/mjsmith707/KSPCompiler\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/mjsmith707/KSPCompiler\u003C/a\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-03-06T10:46:53Z\u0022 title=\u002203/06/2015 10:46  AM\u0022 data-short=\u00229 yr\u0022\u003EMarch 6, 2015\u003C/time\u003E by mjsmith\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"SimplySimon","CreatedById":18291,"CreatedDateTime":"2015-03-09T16:50:45Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022mjsmith\u0022 data-cite=\u0022mjsmith\u0022\u003E\u003Cdiv\u003EFell off the map here. Busy busy. Currently taking an operating systems class for college and was wondering how your progress on this and progcom has been? Thinking about making a simple OS myself given enough time (i.e. Summer). \u003Cp\u003EIts been quite awhile since I looked at the docs for progcom so I can\u0027t remember the major limitations but hopefully it would be preemptive not cooperatively driven. Like you described, interrupt handler, dispatcher/scheduler and maybe some i/o routines would be the goal.\u003C/p\u003E\u003Cp\u003E*edit*\u003C/p\u003E\u003Cp\u003EDid some basic investigation. I think this would be exceedingly time consuming without struct support in the compiler. Also I couldn\u0027t find documentation on if it supported macros or not (I know the assembler does). For now I might just start by seeing if I can add struct support. Then move onto writing a simple malloc/free.\u003C/p\u003E\u003Cp\u003E*edit2*\u003C/p\u003E\u003Cp\u003EAdded extremely rudamentary and incomplete struct support. It\u0027s basically variable renaming at this point. No global support, no pointer support or member pointer support. Probably numerous other limitations and will need a proper redo (a bit more comfortable with the compiler layout now). Fork here: \u003Ca href=\u0022https://github.com/mjsmith707/KSPCompiler\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/mjsmith707/KSPCompiler\u003C/a\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI got a bit busy too, and haven\u0027t worked on progcom for a while.\u003C/p\u003E\u003Cp\u003EPreemptive multitasking, as long as I\u0027ve understood it correctly, is possible. There is a timer that can generate interrupts at certain intervals, so you can use that to switch tasks regularly. Of course, there is nothing keeping a task from stopping the timer, so any multitasking support is always going to be a bit odd.\u003C/p\u003E\u003Cp\u003EI was more-or-less done with the operating system. The major problem was the file system, which was tricky to get running properly. There were also some minor issues with how stack space for new threads was going to be allocated (I had no good solution) and I still needed to make sure that the floating point stack state got saved in the interrupt manager.\u003C/p\u003E\u003Cp\u003EI also did some improvements to the emulator: extended functionality for the monitor, GUI for the tape drive and some minor improvements I can\u0027t remember. I don\u0027t think I ever got around to testing them properly though.\u003C/p\u003E\u003Cp\u003EI\u0027ll probably finish up what I\u0027ve done so far and release it at some point.\u003C/p\u003E\u003Cp\u003ENice job implementing structs \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E I hadn\u0027t thought of that way of doing it before.\u003C/p\u003E\u003Cp\u003EAlthough since the compiler is basically a pile of hacks a proper implementation of structs might need a fairly major rewrite. For instance, currently all parameters to a function are passed in registers, so there is a maximum limit of 16 primitive-type parameters. A struct can grow larger than 16 words, and one would reasonably expect to be able to pass a copy to a function. Thus a rewrite of the calling convention would probably be needed. Also, there is currently no robust type system and various points of the compiler assumes that all variables are 1 word long and are of one of four types (int, float, char, pointer). For instance, if you add one to a pointer to a struct you\u0027d probably expect the compiler to add sizeof(struct) instead, so that if the pointer was pointing to an array it\u0027d now be pointing to the next entry, but that doesn\u0027t happen at the moment.\u003C/p\u003E\n"},{"CreatedByName":"mjsmith","CreatedById":115537,"CreatedDateTime":"2015-03-10T22:36:42Z","Content":"\n\u003Cp\u003EThanks for the reply and I\u0027d love to see the operating system. My original simple OS idea was something far more hardcoded. That is, every task was predefined, not dynamically loaded etc. It would have a hardcoded limit of something like 4 tasks and would switch on them. This way their program locations, state information, stacks etc. would all be known at compile time. Basically it would be an operating system from the 1940s lol. Yours sounds far more sophisticated.\u003C/p\u003E\u003Cp\u003EThe compiler design definitely seemed a bit odd but I can\u0027t blame you for that. See: \u003Ca href=\u0022https://github.com/mjsmith707/InterpretedCPU/tree/master/Assembler/Assembler\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/mjsmith707/InterpretedCPU/tree/master/Assembler/Assembler\u003C/a\u003E for a single night assembler implementation of dubious quality \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 alt=\u0022:D\u0022\u003E. Shortly after working on yours I realized how much modification would probably be needed to properly implement structs and others. I\u0027ll probably revisit writing code for ProgCom when I\u0027ve got some free time but I am highly allergic to large project assembly programming lol so instead of focusing on my weak point (compiler design) I decided to focus on something I\u0027m a bit more comfortable with:\u003C/p\u003E\u003Cp\u003EA MIPS32R2 emulator. Only been working on it for about 3 days now but it supports (albeit unverified, needs unit testing) roughly 65% of the ISA. It is about the most basic of designs at this point. A directly interpreted, single-cycle, non-pipelined, non-caching implementation. It can however decode and execute mips32r2 machine code (testing with GCC cross-compiler) so it\u0027s off to a good start in that respect. I\u0027m planning on implementing the coprocessor0 stuff in the near future and then interrupts. Both of those should be relatively easy. A proper MMU implementation will likely be a bit more difficult but I\u0027ll get to that, floating point and some basic device emulation later.\u003C/p\u003E\u003Cp\u003EThe ultimate goal is full compatibility but I\u0027d settle for just getting very very early Linux or NetBSD boot output as validation. Performance will certainly be lousy as its directly interpreted but as long as it\u0027s good enough to target with GCC I\u0027ll be happy. It\u0027s being written in C# (for eventual implementation as a KSP plugin) and all help is welcome if you\u0027re interested. I\u0027m using Xamarin and dumped the whole project on it. \u003Ca href=\u0022https://github.com/mjsmith707/Standalone_MIPS_Emulator\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/mjsmith707/Standalone_MIPS_Emulator\u003C/a\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-03-10T22:45:24Z\u0022 title=\u002203/10/2015 10:45  PM\u0022 data-short=\u00229 yr\u0022\u003EMarch 10, 2015\u003C/time\u003E by mjsmith\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"SimplySimon","CreatedById":18291,"CreatedDateTime":"2015-03-14T14:32:35Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022mjsmith\u0022 data-cite=\u0022mjsmith\u0022\u003E\u003Cdiv\u003EThanks for the reply and I\u0027d love to see the operating system. My original simple OS idea was something far more hardcoded. That is, every task was predefined, not dynamically loaded etc. It would have a hardcoded limit of something like 4 tasks and would switch on them. This way their program locations, state information, stacks etc. would all be known at compile time. Basically it would be an operating system from the 1940s lol. Yours sounds far more sophisticated.\u003Cp\u003EThe compiler design definitely seemed a bit odd but I can\u0027t blame you for that. See: \u003Ca href=\u0022https://github.com/mjsmith707/InterpretedCPU/tree/master/Assembler/Assembler\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/mjsmith707/InterpretedCPU/tree/master/Assembler/Assembler\u003C/a\u003E for a single night assembler implementation of dubious quality \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 alt=\u0022:D\u0022\u003E. Shortly after working on yours I realized how much modification would probably be needed to properly implement structs and others. I\u0027ll probably revisit writing code for ProgCom when I\u0027ve got some free time but I am highly allergic to large project assembly programming lol so instead of focusing on my weak point (compiler design) I decided to focus on something I\u0027m a bit more comfortable with:\u003C/p\u003E\u003Cp\u003EA MIPS32R2 emulator. Only been working on it for about 3 days now but it supports (albeit unverified, needs unit testing) roughly 65% of the ISA. It is about the most basic of designs at this point. A directly interpreted, single-cycle, non-pipelined, non-caching implementation. It can however decode and execute mips32r2 machine code (testing with GCC cross-compiler) so it\u0027s off to a good start in that respect. I\u0027m planning on implementing the coprocessor0 stuff in the near future and then interrupts. Both of those should be relatively easy. A proper MMU implementation will likely be a bit more difficult but I\u0027ll get to that, floating point and some basic device emulation later.\u003C/p\u003E\u003Cp\u003EThe ultimate goal is full compatibility but I\u0027d settle for just getting very very early Linux or NetBSD boot output as validation. Performance will certainly be lousy as its directly interpreted but as long as it\u0027s good enough to target with GCC I\u0027ll be happy. It\u0027s being written in C# (for eventual implementation as a KSP plugin) and all help is welcome if you\u0027re interested. I\u0027m using Xamarin and dumped the whole project on it. \u003Ca href=\u0022https://github.com/mjsmith707/Standalone_MIPS_Emulator\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/mjsmith707/Standalone_MIPS_Emulator\u003C/a\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI have uploaded the operating system with the latest update. It is not very sophisticated, it can basically only run one program at a time(though you can have many threads in that program) since there is no memory management stuff that ensures you don\u0027t try to load two programs into the same area of memory. You can also not give any starting parameters to a new process. Lots of other restrictions and missing features. I cut out most of the file system stuff since it wasn\u0027t working, it currently works for loading programs, but I\u0027m not sure if it works for anything else.\u003C/p\u003E\u003Cp\u003EYou\u0027ll find the OS source in the compiler folder.\u003C/p\u003E\u003Cp\u003EHow to use it:\u003C/p\u003E\u003Cp\u003E1: compile the os.pcc file into os.asm\u003C/p\u003E\u003Cp\u003E2: copy os.asm and osasm.asm into the progCom code directory\u003C/p\u003E\u003Cp\u003E3: assemble the osasm.asm file with \u0022asm osasm.asm\u0022\u003C/p\u003E\u003Cp\u003E4: due to the new tape drive interface you need to open the \u0022TAP\u0022 interface, enter \u0022osasm.pct\u0022 into the lower text box and press load\u003C/p\u003E\u003Cp\u003E5: operating system is up and running\u003C/p\u003E\u003Cp\u003EIf you want to use the basic interpreter, which is the only program that takes advantage of the operating system:\u003C/p\u003E\u003Cp\u003E6: compile the basic.pcc file into basic.asm\u003C/p\u003E\u003Cp\u003E7: copy the file to the progcom code directory\u003C/p\u003E\u003Cp\u003E8: assemble the file with \u0022asm basic.asm 6000\u0022 in order to set the program to start at address 6000, the lowest address the OS will permit a program to start at\u003C/p\u003E\u003Cp\u003E9: Press \u0022eject\u0022 on the \u0022TAP\u0022 interface\u003C/p\u003E\u003Cp\u003E10: load the assembled file the same way as the OS. Filename should be \u0022basic.pct\u0022.\u003C/p\u003E\u003Cp\u003E11: in order for the OS to load the program the tape needs to be formatted, open the keyboard and press enter to avoid a bug, then enter \u0022format\u0022 and press enter again.\u003C/p\u003E\u003Cp\u003E12: when prompted whether you want to keep the executable or not, type \u0022y\u0022\u003C/p\u003E\u003Cp\u003E13: Optional Step: Type \u0022list\u0022 and enter to see the files that are now on the tape. \u0022boot\u0022 should be the only file there.\u003C/p\u003E\u003Cp\u003E14: when the tape is formatted type \u0022boot\u0022 and press enter into the keyboard.\u003C/p\u003E\u003Cp\u003E15: you should now be able to use the basic interpreter, you can test this with the following program: PRINT \u0022Hello, World!\\n\\r\u0022\u003C/p\u003E\u003Cp\u003EThere is a bug with the interpreter that causes the program to crash if you type \u002210 IF (A/B)*B = A PRINT 11\u0022, just fyi. I have no idea what causes it.\u003C/p\u003E\u003Cp\u003EYeah, the compiler is pretty bad. It suffers from not being thought through enough beforehand, being hastily implemented and being the first (working) high[er]-level compiler I\u0027ve written. I also didn\u0027t really do a whole lot of research on how to code one, so it was mostly improvisation the whole way through. In the latest patch I added some very basic optimisations though so it should at least generate slightly more optimal code now.\u003C/p\u003E\u003Cp\u003EYour project sounds very interesting. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E I don\u0027t have any time to work on it right now though, but thanks for the offer. If you get around to implementing it in ksp, feel free to borrow any code from progCom if you can find anything that is of use.\u003C/p\u003E\u003Cp\u003EChanges in the new version:\u003C/p\u003E\u003Cp\u003E*Added a 4 color character mode for the monitor, as well as a 4-bit CLUT bitmap mode, 8-bit color monochrome bitmap mode, and a 16-bit color bitmap mode. You can also adjust the resolution of the monitor between 256x256, 128x256, 128x128 and 64x64 pixels now. I have only written rudimentary documentation for this yet though, will do that later. The old modes should still be usable, but since I expanded the screen ram to 4096 words instead of 2048 all older programs will need a recompile.\u003C/p\u003E\u003Cp\u003E*Added more instructions for boolean arithmetic, bit twiddling, and some other things I forget. \u003C/p\u003E\u003Cp\u003E*added the OS and BASIC interpreter I have been talking about\u003C/p\u003E\u003Cp\u003E*Added A GUI for the tape drive, programs are now loaded by entering \u0022tapeName.pct\u0022 into the lower text field of the \u0022TAP\u0022 interface and pressing \u0022load\u0022. If a tape is already in the tape drive, you need to press \u0022eject\u0022 first. If you want to save the changes made to a tape, press \u0022save\u0022. If you want to inster an empty tape, press the button called \u0022new\u0022 or something like that.\u003C/p\u003E\u003Cp\u003EMany of the new features are poorly documented since I wanted to release this update asap, and writing documentation is time consuming. I will do a pass on the documentation later. No previous features have been changed though (aside from how programs are loaded, see changelog above) so the current documentation should work just fine for most use cases. If anyone has any questions regarding how to use the new features, or about ProgCom in general, feel free to ask in this thread.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-03-14T19:09:58Z\u0022 title=\u002203/14/2015 07:09  PM\u0022 data-short=\u00229 yr\u0022\u003EMarch 14, 2015\u003C/time\u003E by SimplySimon\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"SimplySimon","CreatedById":18291,"CreatedDateTime":"2015-03-14T18:47:05Z","Content":"\n\u003Cp\u003EI added some rudimentary documentation regarding the new features. I might improve it at some point.\u003C/p\u003E\n"}]}