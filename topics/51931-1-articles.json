{"TopicId":51931,"ForumId":29,"TopicTitle":"What am I doing wrong?","CreatedByName":"SquirrelMan","CreatedById":90613,"CreatedDateTime":"2013-11-05T05:01:21Z","PageNum":1,"Articles":[{"CreatedByName":"SquirrelMan","CreatedById":90613,"CreatedDateTime":"2013-11-05T05:01:21Z","Content":"\n\u003Cp\u003EOk, so I\u0027m new to Unity development, and I can\u0027t figure out what I\u0027m doing wrong. I have the following code:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E [KSPAddon(KSPAddon.Startup.EditorVAB, false)]\u003Cbr\u003E    public class Class1 : MonoBehaviour\u003Cbr\u003E    {\u003Cbr\u003E        bool inQ = false;\u003Cbr\u003E\u003Cbr\u003E        public void Awake()\u003Cbr\u003E        {\u003Cbr\u003E            print(\u0022awake\u0022);\u003Cbr\u003E        }\u003Cbr\u003E\u003Cbr\u003E        public void Start()\u003Cbr\u003E        {\u003Cbr\u003E            print(\u0022Starting the test mod\u0022);\u003Cbr\u003E\u003Cbr\u003E        }\u003Cbr\u003E\u003Cbr\u003E        public void OnGUI()\u003Cbr\u003E        {\u003Cbr\u003E            if (!inQ)\u003Cbr\u003E            {\u003Cbr\u003E                RenderingManager.AddToPostDrawQueue(0, DrawGui);\u003Cbr\u003E                inQ = true;\u003Cbr\u003E            }\u003Cbr\u003E        }\u003Cbr\u003E\u003Cbr\u003E        public void DrawGui()\u003Cbr\u003E        {\u003Cbr\u003E            var r = new Rect(300, 50, 200, 200);\u003Cbr\u003E            GUI.Window(0, r, FillWindow, \u0022Test Window\u0022);\u003Cbr\u003E            }\u003Cbr\u003E\u003Cbr\u003E        public void FillWindow(int windowID)\u003Cbr\u003E        {\u003Cbr\u003E            GUILayout.BeginVertical();\u003Cbr\u003E            if (GUI.Button(new Rect(20, 20, 50, 50), \u0022Push\u0022))\u003Cbr\u003E            {\u003Cbr\u003E                print(\u0022Button pushed\u0022);\u003Cbr\u003E            }\u003Cbr\u003E            GUILayout.EndVertical();            \u003Cbr\u003E        }\u003Cbr\u003E    }\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EIt displays a small window with a button exactly as desired. However, in the VAB, when I hover over a part, the tooltip window is blank and I get a message in the log that says \u0022ArgumentException: Getting control 0\u0027s position in a group with only 0 controls when doing Repaint Aborting\u0022. It appears that somehow my plugin is interfering with the VAB tooltip window. Any ideas? I\u0027ve tried looking at the code for both Kerbal Alarm Clock, and Engineer Redux and, while I\u0027m not nearly as complex, am trying to follow the same pattern.\u003C/p\u003E\u003Cp\u003EAny help is greatly appreciated.\u003C/p\u003E\n"},{"CreatedByName":"TaranisElsu","CreatedById":57742,"CreatedDateTime":"2013-11-05T06:09:00Z","Content":"\n\u003Cp\u003EOne thing that I noticed is that you used GUI.Button instead of GUILayout.Button. Also, GUI.Window instead of GUILayout.Window. Any reason?\u003C/p\u003E\u003Cp\u003EOther than that, which is not wrong, I don\u0027t see anything that is obviously wrong and would be causing your issue. Are you sure it is your mod? Do you have any others installed? I know that an older version of Kerbal Engineer threw a lot of exceptions at various times.\u003C/p\u003E\u003Cp\u003EUnfortunately, I have not added a GUI example to \u003Ca href=\u0022https://github.com/taraniselsu/TacExamples\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/taraniselsu/TacExamples\u003C/a\u003E yet. In the mean time, feel free to look at \u003Ca href=\u0022https://github.com/taraniselsu/TacPartLister\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/taraniselsu/TacPartLister\u003C/a\u003E and \u003Ca href=\u0022https://github.com/taraniselsu/TacLib\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/taraniselsu/TacLib\u003C/a\u003E. My TAC Part Lister is a (fairly) simple mod that shows a window in the VAB and SPH.\u003C/p\u003E\n"},{"CreatedByName":"damny","CreatedById":78621,"CreatedDateTime":"2013-11-05T06:43:32Z","Content":"\n\u003Cp\u003EUnity calls GUI code in separate passes for layout and rendering. These are implemented as events. The error you\u0027re getting means that your (or some) GUI code gets called for repaint \u003Cem\u003Ebefore\u003C/em\u003E layout. Hence, it can\u0027t find the layout data for your first control...\u003C/p\u003E\u003Cp\u003EI\u0027m not sure if adding it in OnGUI like that is safe because I don\u0027t know when the addition to the queue will become effective. I looked at the source for Kerbal Alarm Clock and it looks like it only adds the GUI to the queue when a flag was set during a game world update. This means that unlike in your code, in KAC it actually happens at a defined time.\u003C/p\u003E\u003Cp\u003EYou can check Event.current.type to see which pass it\u0027s doing, e.g. for repaint Event.current.type == EventType.Repaint will be true. Maybe you can avoid adding things to the queue during a repaint event?\u003C/p\u003E\u003Cp\u003EEdit: And like TaranisElsu wrote, you probably want to use GUILayout. instead of GUI., since you do use GUILayout.BeginVertical(), which will only affect layout of GUILayout. elements.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-11-05T06:52:53Z\u0022 title=\u002211/05/2013 06:52  AM\u0022 data-short=\u002210 yr\u0022\u003ENovember 5, 2013\u003C/time\u003E by damny\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"SquirrelMan","CreatedById":90613,"CreatedDateTime":"2013-11-05T16:11:28Z","Content":"\n\u003Cp\u003EThank you both for your helpful hints. First, I\u0027m sure its my mod as its the only one I have installed on this instance of KSP. I made a separate copy of KSP and deleted all other mods, and about half of the SQUAD parts as well for fast loading. Everything is fine if I take out my mod. The only reason I was using GUI instead of GUILayout was lack of knowledge. Thank you for the pointers. Having read up on them now, I believe I understand the difference much better.\u003C/p\u003E\u003Cp\u003EUnfortunately, I tried changing that and it didn\u0027t help. I will take a look at TacPartLister and see if I can figure anything out. It\u0027s very strange.\u003C/p\u003E\n"},{"CreatedByName":"SquirrelMan","CreatedById":90613,"CreatedDateTime":"2013-11-08T01:57:51Z","Content":"\n\u003Cp\u003EOk, so I couldn\u0027t get my code to work no matter what I tried, but I downloaded and studied TacPartLister and TacLib and I got something to work following that code. Thank you so much, TaranisElsu. I greatly appreciate the help. \u003C/p\u003E\u003Cp\u003EOn a side note, when I first added your code, it wouldn\u0027t load at all. I had to re-target my library to .Net 3.5 and then it loaded fine. For some reason, on .Net 4.5, which is the default for Visual Studio 2012, I was getting assembly load errors. Does KSP have an official .Net target platform that I should make sure I use?\u003C/p\u003E\n"},{"CreatedByName":"damny","CreatedById":78621,"CreatedDateTime":"2013-11-08T08:11:26Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022SquirrelMan\u0022 data-cite=\u0022SquirrelMan\u0022\u003E\u003Cdiv\u003EDoes KSP have an official .Net target platform that I should make sure I use?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EUnity uses Mono. There is no direct relationship, but if you create a MonoDevelop project in Unity, it sets 3.5 as the target.\u003C/p\u003E\n"},{"CreatedByName":"MacTee","CreatedById":57891,"CreatedDateTime":"2013-11-12T19:04:57Z","Content":"\n\u003Cp\u003EI think this should help.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Epublic void DrawGui()\u003Cbr\u003E{\u003Cbr\u003E    var windowID = 123 // choose one you like (lower ones may interfere with KSP Window IDs).\u003Cbr\u003E    var r = new Rect(300, 50, 200, 200);\u003Cbr\u003E    GUI.Window(windowID, r, FillWindow, \u0022Test Window\u0022);\u003Cbr\u003E}\u003Cbr\u003E\u003Cbr\u003Epublic void FillWindow(int windowID)\u003Cbr\u003E{\u003Cbr\u003E    if (windowID == 123) // ID from above\u003Cbr\u003E    {\u003Cbr\u003E         GUILayout.BeginVertical();\u003Cbr\u003E         if (GUI.Button(new Rect(20, 20, 50, 50), \u0022Push\u0022))\u003Cbr\u003E         {\u003Cbr\u003E              print(\u0022Button pushed\u0022);\u003Cbr\u003E         }\u003Cbr\u003E         GUILayout.EndVertical();            \u003Cbr\u003E    }\u003Cbr\u003E}\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n"}]}