{"TopicId":116346,"ForumId":69,"TopicTitle":"Trajectory wobble bug - potential explanation (KSP 1.0.4)","CreatedByName":"xJammer","CreatedById":148343,"CreatedDateTime":"2015-07-19T20:13:22Z","PageNum":1,"Articles":[{"CreatedByName":"xJammer","CreatedById":148343,"CreatedDateTime":"2015-07-19T20:13:22Z","Content":"Prefix was required - In reality prefix is [ALL OS - Game Bug]\n\nI apologise in advance if this is a dupe report.\n\nI am sure a lot of people experienced an issue, when patched conics trajectory wobbles at warp x1. (in some cases predicted trajectory will wobble by hundreds of kilometres if multiple gravity assists are involved).\n\nI believe this is caused by the fact that the trajectory prediction is made by using the currently active probe/pod COM, rather than the entire craft\u0027s COM. Any rotation or vibration in the craft will add ~0.01 to 0.1m/s to the probe\u0027s COM and alter the predicted trajectory.\n\nThe way to check is to get one of those \u0022wobble\u0022 orbits and let your craft rotate freely in one direction (SAS off). You will notice that the wobble will repeat itself with the same frequency as the craft\u0027s rotation. The wobble will also immediately stop if you warp 5x. If you unwarp back to physics the wobble will be a lot lower or completely gone. (either FP errors or inherent wobble of clipped/large part craft, these errors cause significantly lower wobble and are not considered in this report).\n\nI am not sure if images would help here, I will try to create a twitch highlight showing the issue ASAP if required.\n\nSuggested fix is to calculate trajectory from the craft\u0027s COM rather than the control part\u0027s COM.\n\nxJ."},{"CreatedByName":"waterlubber","CreatedById":119333,"CreatedDateTime":"2015-07-22T23:17:52Z","Content":"This seems good. However, the game may have trouble re-computing CoM as fuel moves around. A simpler but less elegant solution would be to computer from the most massy part, likely a huge fuel tank."},{"CreatedByName":"Red Iron Crown","CreatedById":12858,"CreatedDateTime":"2015-07-23T02:05:13Z","Content":"As I understand it, trajectory is now calculated from the CoM rather than the root part as it was previously, which has greatly reduced wobble. There is still some due to floating point errors. Mentioned in the [changelog for 1.0.3](https://forum.kerbalspaceprogram.com/content/346-KSP-1-0-3-now-Available!): \u0022\\* Better compute various vessel values This should lower phantom orbit changing and wobble!\u0022\n\n**Edited \u003Ctime datetime=\u00222015-07-23T02:09:19Z\u0022 title=\u002207/23/2015 02:09  AM\u0022 data-short=\u00228 yr\u0022\u003EJuly 23, 2015\u003C/time\u003E by Red Iron Crown**"},{"CreatedByName":"xJammer","CreatedById":148343,"CreatedDateTime":"2015-07-29T00:23:21Z","Content":"That is a good point Red Iron, but unfortunately it does not appear to be the case! Unless FP errors go \u0022into the direction\u0022 of where the craft is rotating.\n\nWhat I mean is that I could start yawing my craft one way - the Duna Peri would go from 80 to 35km (for example). If I roll it the other way, Duna peri would go up to ~120km. This is of course only temporarily - as soon as the craft rotates past 90 degrees the trajectory proceeds changing.\n\nUnfortunately the effect seems to be too pronounced for it to be just an FP issue.\n\nEither I am misunderstanding and this is indeed caused by FP errors, or the COM calculation currently has a bug.\n\nI will do a stream highlight showing this issue in ~2 weeks (unable to stream right now)"},{"CreatedByName":"Claw","CreatedById":100668,"CreatedDateTime":"2015-07-29T01:55:18Z","Content":"It\u0027s definitely a known thing that I don\u0027t think has been resolved. I have some additional theories about wobbly orbits, but it sounds like your harmonic changes are pointing at CoM issues still.\n\nCheers,\n\n-Claw"},{"CreatedByName":"xJammer","CreatedById":148343,"CreatedDateTime":"2015-07-29T15:06:47Z","Content":"Here is a video link showing the bug.\n\nI claim that the tiny variations in the Pe values are to do with FP bug, and while I do think that it is partly to do with FP errors, I also think that it is further caused by SAS being turned on (but that is irrelevant to the actual bug where the orbit goes WHOOOSH around Jool)\n\n[http://www.twitch.tv/xjammer_/c/7000275](http://www.twitch.tv/xjammer_/c/7000275)"}]}