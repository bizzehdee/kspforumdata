{"TopicId":81396,"ForumId":36,"TopicTitle":"[WIP] Open Avionics","CreatedByName":"MeateaW","CreatedById":24950,"CreatedDateTime":"2014-08-11T10:12:36Z","PageNum":1,"Articles":[{"CreatedByName":"MeateaW","CreatedById":24950,"CreatedDateTime":"2014-08-11T10:12:36Z","Content":"\n\u003Cp\u003E\u003Cstrong\u003EOpen Avionics\u003C/strong\u003E\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003E2014-09-02\u003C/strong\u003E\u003C/p\u003E\u003Cp\u003EJust an update, I haven\u0027t stopped work.\u003C/p\u003E\u003Cp\u003EBut in case people are impatient I thought I should mention similar mods (that really should have popped up earlier in my searching!)\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/67270-Throttle-Controlled-Avionics-1-3-0-23-5-(April-6)\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://forum.kerbalspaceprogram.com/threads/67270-Throttle-Controlled-Avionics-1-3-0-23-5-(April-6)\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EI haven\u0027t downloaded it and tried it out, but it sounds like it is still working in 24.x\u003C/p\u003E\u003Cp\u003EThis sounds like it does at least two major components of what mine does (rotation torque control with variable engines). \u003C/p\u003E\u003Cp\u003EAnd it sounds like it does what I am currently calling \u0022thrust mode\u0022.\u003C/p\u003E\u003Cp\u003ESlightly disappointing that I didn\u0027t find this before starting work, but I am going to continue my work (since I find it actually fun, not work!).\u003C/p\u003E\u003Cp\u003EI am slowly cleaning up my code, with the intention of releasing a first version soon. My initial code was all over the place, and hosted on my works source repository, I have since separated it to my own personal repo, and am considering a github release repository.\u003C/p\u003E\u003Cp\u003EI can tell you it now takes into account engine ISP when deciding which engines to use, so when it is in hover mode you can be assured it is using the most efficient combination of engines to achieve it.\u003C/p\u003E\u003Cp\u003ENot to mention millions of bugs have met their end.\u003C/p\u003E\u003Cp\u003EOnce I have finished getting the code so that it implements all the features it used to.\u003C/p\u003E\u003Cp\u003EIE\u003C/p\u003E\u003Cp\u003EI killed position lock recently in my code-cleanup, it is now back, but I am going to do it better than ever.\u003C/p\u003E\u003Cp\u003EI plan to make it choose a velocity that best matches the available thrust, to minimise overshooting your target position.\u003C/p\u003E\u003Cp\u003EIt did a basic version of this in the past, but large displacement still ended up with big overshoot, which I hope to basically eliminate.\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003E2014-08-22\u003C/strong\u003E\u003C/p\u003E\u003Cp\u003EFought a lot with trying to implement altitude lock, before I realised that the world-space transform is at all kinds of wiggy angles, some dot products and unit vectors later it all works flawlessly.\u003C/p\u003E\u003Cp\u003EI now have Altitude lock, East-West lock and North-South lock. (obviously EW and NS locks aren\u0027t quite as useful, individually, but they aren\u0027t too bad).\u003C/p\u003E\u003Cp\u003ECombined they form 3D-space-surface-position-lock.\u003C/p\u003E\u003Cp\u003EI also have movement dampening mode, which holds you still*! \u003C/p\u003E\u003Cp\u003E* where still is defined as some velocity** at or below 0.1m/s.\u003C/p\u003E\u003Cp\u003E** Rotating isn\u0027t considered velocity. (but your SAS can help here)\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cblockquote\u003E\u003Cp\u003EI would like to apologize right now; for the horrible piloting, and pretty poor example of what everything is doing.\u003C/p\u003E\u003Cp\u003EI cut the building since it is less important.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E\n\u003C/p\u003E\u003Cdiv class=\u0022ipsEmbeddedVideo\u0022 contenteditable=\u0022false\u0022\u003E\u003Cdiv\u003E\u003Ciframe width=\u0022480\u0022 height=\u0022270\u0022 src=\u0022https://www.youtube.com/embed/zlbpePvdzAY?feature=oembed\u0022 frameborder=\u00220\u0022 allowfullscreen=\u0022true\u0022\u003E\u003C/iframe\u003E\u003C/div\u003E\u003C/div\u003E\u003Cp\u003E\u003Cstrong\u003EWhat you are seeing\u003C/strong\u003E\u003C/p\u003E\u003Cp\u003EMost of the video is showing the various position lock methods.\u003C/p\u003E\u003Cp\u003ENote the \u0022Movement Dampening\u0022 option, that doesn\u0027t lock you in a specific location, but does attempt to reduce your surface velocity (in all axes) to zero.\u003C/p\u003E\u003Cp\u003EWhen you hit a translation key, the dampening limits the maximum velocity you can get, and after letting go of the translation key the movement dampening halts your movement.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/blockquote\u003E\u003Cp\u003E\u003Cstrong\u003E2014-08-11\u003C/strong\u003E\u003C/p\u003E\u003Cp\u003EFirst post.\u003C/p\u003E\u003Cp\u003EI am working on remaking from scratch the KerbComAvionics module that appears no longer maintained. \u003C/p\u003E\u003Cp\u003Esee: \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/29387-0-21-x-KerbCom-Avionics-0-3-0-6-Alpha-(29-August)-now-with-video!\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://forum.kerbalspaceprogram.com/threads/29387-0-21-x-KerbCom-Avionics-0-3-0-6-Alpha-(29-August)-now-with-video!\u003C/a\u003E for the original.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cblockquote\u003E\u003Cp\u003EDue to the license around that module (CC no Derivatives); (and the complexity of the code) I have had to re-implement everything. (I had intended to refurbish, and contact ZRM to get permission to release, but I honestly couldn\u0027t figure out how to get the mod to work, and had literally no idea where it was actually doing anything)\u003C/p\u003E\u003Cp\u003EZRM had identified an open source solver, so I had a library to begin work with. And luckily about 7 years ago I took a single subject at uni that covered Linear Programming (the type of mathematics to solve this species of problem), so the whole concept wasn\u0027t foreign - and the library was doing the maths-heavy part. But; about 3 weeks of fairly solid development time (that have severely impacted my output at work! ssh don\u0027t tell!) the above is where I am at.\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003ESome history\u003C/strong\u003E\u003C/p\u003E\u003Cp\u003EZRM began his mod; as a way of simplifying RCS thruster placement. By automating the output intensity at each nozzle; he would ensure no errant torque from poorly or imbalanced RCS thruster placement. Eventually after ZRM completed these tasks, he moved on to balancing everything; from Gimballed engines, Reaction Wheels and RCS simultaneously. All whilst (apparently) taking the most fuel efficient route.\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003Ewhat I have right now\u003C/strong\u003E\u003C/p\u003E\u003Cp\u003EI am no where near the complexity of ZRMs implementation.\u003C/p\u003E\u003Cp\u003EI solve exclusively for Torque and Translation using Engines right now.\u003C/p\u003E\u003Cp\u003EI do take into account Solid Rocket Boosters (I don\u0027t believe ZRM ever bothered).\u003C/p\u003E\u003Cp\u003EI do take into account Gravity (this is useful for arresting translations)\u003C/p\u003E\u003Cp\u003EI \u003Cstrong\u003Edo not\u003C/strong\u003E take into account Gimbals.\u003C/p\u003E\u003Cp\u003EI \u003Cstrong\u003Edo not\u003C/strong\u003E take into account Reaction Wheels.\u003C/p\u003E\u003Cp\u003EI \u003Cstrong\u003Ehaven\u0027t even considered\u003C/strong\u003E what I am going to do about RCS yet.\u003C/p\u003E\u003Cp\u003EGimbals and Reaction Wheels are important when we start thinking about Fuel Efficiency. To be honest; I am not sure I can figure out how to plug efficiency numbers into the solver. And from the moment I decided to re-implement I have specifically avoided looking into ZRMs code.\u003C/p\u003E\u003Cp\u003EMy code is ugly right now, and I have only just today gotten it to do what I actually intend. (The above video was made about 1 hour after the maiden flight of the solver model that first actually worked as intended).\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003EDoes it really work yet?\u003C/strong\u003E\u003C/p\u003E\u003Cp\u003EMostly!\u003C/p\u003E\u003Cp\u003ESee (skip to 3:30 for the actually interesting part!)\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E\n\u003C/p\u003E\u003Cdiv class=\u0022ipsEmbeddedVideo\u0022 contenteditable=\u0022false\u0022\u003E\u003Cdiv\u003E\u003Ciframe width=\u0022480\u0022 height=\u0022270\u0022 src=\u0022https://www.youtube.com/embed/8JnDxThBc2g?start=206\u0026amp;feature=oembed\u0022 frameborder=\u00220\u0022 allowfullscreen=\u0022true\u0022\u003E\u003C/iframe\u003E\u003C/div\u003E\u003C/div\u003E\u003Cp\u003EWhat you are seeing here:\u003C/p\u003E\u003Cp\u003E The solver is currently configured to cancel gravity.\u003C/p\u003E\u003Cp\u003EWhen at full throttle there is a slight vertical acceleration (I think this is rounding error) \u003C/p\u003E\u003Cp\u003EI use the rotation and translation controls to modify the constraints of the model.\u003C/p\u003E\u003Cp\u003ESo; if I hit the RCS \u0027Translate Up\u0027 key; the model no longer solves for zero upward translation, and instead adds some amount of upward translation into the \u0022solution\u0022.\u003C/p\u003E\u003Cp\u003EA quirk you\u0027ll notice, is when I \u0022Translate Down\u0022 it turns out that gravity is still greater than the amount of translation I pass in. So there is no \u0022downward\u0022 thrust; just a massive reduction in the force counteracting gravity.\u003C/p\u003E\u003Cp\u003EIt is of course using infinite fuel - the only practical way to perform on-pad testing.\u003C/p\u003E\u003Cp\u003EI left the reaction wheels in place; but 99% of all rotations and translations are performed by the Rocket Engines.\u003C/p\u003E\u003Cp\u003EYou will notice that SAS performs amazingly well with the solver in place. SAS was a perfect fit for precisely calculated torques. It isn\u0027t great for the reaction model (you get lots of bouncing back and forth), but when your engines produce the exact torque required to right the ship; SAS has a firm grip and rarely gets it wrong.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/blockquote\u003E\u003Cp\u003E\u003Cstrong\u003EWhy am I making this? And what will I do with it\u003C/strong\u003E\u003C/p\u003E\u003Cp\u003EWell; think about all those times in vanilla KSP where you had an imbalanced rocket. There weren\u0027t many.\u003C/p\u003E\u003Cp\u003ENow think back to the first time you ever tried to perform an Asteroid Redirect, and how easy it was to just claw up and push in the direction you actually wanted to go.\u003C/p\u003E\u003Cp\u003EIt is the ARM that really got me to think about this.\u003C/p\u003E\u003Cp\u003EI intend to release this code under a very permissive, to near completely permissive license. \u003C/p\u003E\u003Cp\u003EI am thinking of something like a; Creative Commons - Attribution, (but maybe even less restrictive than that?)\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-09-02T07:32:04Z\u0022 title=\u002209/02/2014 07:32  AM\u0022 data-short=\u00229 yr\u0022\u003ESeptember 2, 2014\u003C/time\u003E by MeateaW\u003C/strong\u003E\n\u003Cbr\u003EProgress update\n\u003C/span\u003E\n"},{"CreatedByName":"blackheart612","CreatedById":42741,"CreatedDateTime":"2014-08-11T10:42:33Z","Content":"\n\u003Cp\u003EThat testing looked totally awesome I must say. Haha. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 alt=\u0022:D\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"MeateaW","CreatedById":24950,"CreatedDateTime":"2014-08-11T10:57:22Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022blackheart612\u0022 data-cite=\u0022blackheart612\u0022\u003E\u003Cdiv\u003EThat testing looked totally awesome I must say. Haha. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 alt=\u0022:D\u0022\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EWhen it finally did what I was hoping for it turned out quite fun!\u003C/p\u003E\u003Cp\u003EI did have one build that would always be moving sideways; but always at a stable altitude, I made a hover car and had some fun with that.\u003C/p\u003E\u003Cp\u003EWhich leads me to think that perhaps a few mode could be implemented - \u0022Stable Altitude\u0022 mode; where it tries to keep a craft x meters off the ground.\u003C/p\u003E\u003Cp\u003EI am also considering a \u0022landing mode\u0022 which uses your engines and evenly slows you down based on altitude, so you always get perfectly soft landings. The precision the solver lets you get is pretty good. In some tests I was controlling my speed down to 0.1 m/second, and that was without any guidance systems trying to keep me horizontally stationary.\u003C/p\u003E\n"},{"CreatedByName":"blackheart612","CreatedById":42741,"CreatedDateTime":"2014-08-11T11:08:17Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022MeateaW\u0022 data-cite=\u0022MeateaW\u0022\u003E\u003Cdiv\u003EWhen it finally did what I was hoping for it turned out quite fun!\u003Cp\u003EI did have one build that would always be moving sideways; but always at a stable altitude, I made a hover car and had some fun with that.\u003C/p\u003E\u003Cp\u003EWhich leads me to think that perhaps a few mode could be implemented - \u0022Stable Altitude\u0022 mode; where it tries to keep a craft x meters off the ground.\u003C/p\u003E\u003Cp\u003EI am also considering a \u0022landing mode\u0022 which uses your engines and evenly slows you down based on altitude, so you always get perfectly soft landings. The precision the solver lets you get is pretty good. In some tests I was controlling my speed down to 0.1 m/second, and that was without any guidance systems trying to keep me horizontally stationary.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ESounds neat, I like the hovering idea, dibs on it!\u003C/p\u003E\n"},{"CreatedByName":"MeateaW","CreatedById":24950,"CreatedDateTime":"2014-08-22T02:09:20Z","Content":"\n\u003Cp\u003E\u003Cstrong\u003E2014-08-22\u003C/strong\u003E\u003C/p\u003E\u003Cp\u003EUpdated!\u003C/p\u003E\u003Cp\u003EIncludes new video, and various position locking.\u003C/p\u003E\n"},{"CreatedByName":"NathanKell","CreatedById":75006,"CreatedDateTime":"2014-08-22T02:36:21Z","Content":"\n\u003Cp\u003EThis sounds awesome!\u003C/p\u003E\n"},{"CreatedByName":"MeateaW","CreatedById":24950,"CreatedDateTime":"2014-08-22T04:20:27Z","Content":"\n\u003Cp\u003EThanks Nathan, working on making it actually useful, right now it runs using MaxThrust and assumes maximum throttle, I need to get it to do its work based off real-time \u003Cem\u003Eavailable\u003C/em\u003E thrust, maybe with some smoothing or other special treatment for jet engines.\u003C/p\u003E\n"},{"CreatedByName":"NathanKell","CreatedById":75006,"CreatedDateTime":"2014-08-22T05:49:45Z","Content":"\n\u003Cp\u003EIt\u0027ll be engine.requestedThrust, multiplied by engine.velocityCurve.Evaluate(currentSurfaceVelocity.magnitude) if there\u0027s a velocityCurve.\u003C/p\u003E\n"},{"CreatedByName":"MK3424","CreatedById":19932,"CreatedDateTime":"2014-08-22T10:25:29Z","Content":"\n\u003Cp\u003ECan it also be used for RCS and/or with the new engine nacelles?\u003C/p\u003E\n"},{"CreatedByName":"MeateaW","CreatedById":24950,"CreatedDateTime":"2014-08-23T02:37:56Z","Content":"\n\u003Cp\u003ERCS is still on the to do list, and I haven\u0027t yet tackled it.\u003C/p\u003E\u003Cp\u003EIn a way however using real engines is better, since the ISP of RCS is pretty poor. (The biggest advantage it has is no worries about hooking up fuel)\u003C/p\u003E\u003Cp\u003EThe new engines should be working the same way as the older engines, the only proviso is I haven\u0027t confirmed what it does with the RAPIER yet, but since atmosphere mode of the RAPIER is similar to a jet engine it sort of isn\u0027t worth getting confused over till I have a better solution in place with them.\u003C/p\u003E\u003Cp\u003EAlso, with engines like the new cluster engines from the NASA pack it would be great if they were actually 4 separate engine modules, as then with those alone I could do some torque control with them, but sadly as far as I can tell they are ultimately throttleable only as a single unit.\u003C/p\u003E\u003Cp\u003EMaybe one day I\u0027ll override the engine module and split up each engine by its own nozzle, and vary the output independently , but that is a whole lot of work for a grand total of 2 parts. (Maybe 3 if the RAPIER is considered 4 thruster transforms... Sounds a little silly though)\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-08-23T02:39:42Z\u0022 title=\u002208/23/2014 02:39  AM\u0022 data-short=\u00229 yr\u0022\u003EAugust 23, 2014\u003C/time\u003E by MeateaW\u003C/strong\u003E\n\u003Cbr\u003Eauto correct failure\n\u003C/span\u003E\n"},{"CreatedByName":"NathanKell","CreatedById":75006,"CreatedDateTime":"2014-08-23T03:19:56Z","Content":"\n\u003Cp\u003EI too have been wishing I could specify the amount each thrust transform will add; right now it\u0027s a flat thrust = 1 / (num_transforms).\u003C/p\u003E\u003Cp\u003EWith that we could have the gas generator exhaust act as a vernier \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"MeateaW","CreatedById":24950,"CreatedDateTime":"2014-09-02T07:27:09Z","Content":"\n\u003Cp\u003EJust an update, I haven\u0027t stopped work.\u003C/p\u003E\u003Cp\u003EBut in case people are interested I thought I should mention mods (that really should have popped up earlier in my searching!)\u003C/p\u003E\u003Cp\u003EI have found this: \u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/67270-Throttle-Controlled-Avionics-1-3-0-23-5-(April-6)\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://forum.kerbalspaceprogram.com/threads/67270-Throttle-Controlled-Avionics-1-3-0-23-5-(April-6)\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EI haven\u0027t downloaded it and tried it out, but it sounds like it is still working in 24.x\u003C/p\u003E\u003Cp\u003EThis sounds like it does at least one major component of what mine does (rotation torque control with variable engines). \u003C/p\u003E\u003Cp\u003EAnd it sounds like it does what I am currently calling \u0022thrust mode\u0022.\u003C/p\u003E\u003Cp\u003EI am slowly cleaning up my code, with the intention of releasing a first version soon. My initial code was all over the place, and hosted on my works source repository, I have since separated it to my own personal repo, and am considering a github release repository.\u003C/p\u003E\u003Cp\u003EI can tell you it now takes into account engine ISP when deciding which engines to use, so when it is in hover mode you can be assured it is using the most efficient combination of engines to achieve it.\u003C/p\u003E\u003Cp\u003ENot to mention millions of bugs have met their end.\u003C/p\u003E\u003Cp\u003EOnce I have finished getting the code so that it implements all the features it used to (I killed position lock recently in my refactor, it is now back, but I am going to do it better than ever).\u003C/p\u003E\n"}]}