{"TopicId":89889,"ForumId":29,"TopicTitle":"Change existing actions from other mods","CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-11-10T03:34:27Z","PageNum":1,"Articles":[{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-11-10T03:34:27Z","Content":"\n\u003Cp\u003EEdit: Answered in last post.\u003C/p\u003E\u003Cp\u003EAlright.\u003C/p\u003E\u003Cp\u003EFor the simplest test case of what I\u0027m going, the existing ModuleGimbal used by engines has a single action, \u0022Toggle Gimbal\u0022.\u003C/p\u003E\u003Cp\u003EI am adding two more actions to this, \u0022Enable Gimbal\u0022 and \u0022Disable Gimbal\u0022. That is all straightforward and works fine.\u003C/p\u003E\u003Cp\u003EThe issue is that I have to use a different partModule so I have no control over where the actions appear in the editor. Currently the action list goes like this:\u003C/p\u003E\u003Cp\u003EToggle Gimbal\u003C/p\u003E\u003Cp\u003EJettison\u003C/p\u003E\u003Cp\u003EEnable Gimbal\u003C/p\u003E\u003Cp\u003EDisable Gimbal\u003C/p\u003E\u003Cp\u003ENow, I can easily add the Toggle Gimbal action to my partModule as well, but that would leave two Toggle Gimbal actions on the part. \u003C/p\u003E\u003Cp\u003EIs there any way I can prevent the existing Toggle Gimbal action from showing? I have not been able to find any methods or properties that would allow me to hide it, short of deleting it outright. However, I risk causing a cascade error if I delete an action someone else is linked to so I don\u0027t want to do this by deleting the action.\u003C/p\u003E\u003Cp\u003EAnyone have any ideas?\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-11-13T01:35:31Z\u0022 title=\u002211/13/2014 01:35  AM\u0022 data-short=\u00229 yr\u0022\u003ENovember 13, 2014\u003C/time\u003E by Diazo\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"JDP","CreatedById":30775,"CreatedDateTime":"2014-11-11T11:53:38Z","Content":"\n\u003Cp\u003EJust a quick example on how to modify actions on other modules:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Epublic class ModuleDoStuff : PartModule\u003Cbr\u003E    {\u003Cbr\u003E        public override void OnStart(StartState state)\u003Cbr\u003E        {\u003Cbr\u003E            //find any ModuleEngines within the same part as your module\u003Cbr\u003E            if (part.Modules.Contains(\u0022ModuleEngines\u0022)) {\u003Cbr\u003E                //clear any actions.\u003Cbr\u003E                part.Modules[\u0022ModuleEngines\u0022].Actions.Clear();\u003Cbr\u003E            }\u003Cbr\u003E        }\u003Cbr\u003E    }\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EThis will simply clear all actions, but you could just as easily remove specific actions.\u003C/p\u003E\u003Cp\u003EThe hitch is that your module would need to be started \u003Cstrong\u003Eafter\u003C/strong\u003E the ModuleEngines you wish to make changes to. IIRC, the modules are loaded in alphabetical order, but this might not be the case. Especially in case of modules added by ModuleManager.\u003C/p\u003E\u003Cp\u003EIn any case, this should be a starting place from which to do a bit of experimentation.\u003C/p\u003E\n"},{"CreatedByName":"Padishar","CreatedById":97386,"CreatedDateTime":"2014-11-11T12:21:38Z","Content":"\n\u003Cp\u003EIt would be (slightly) better to do this in Update with a flag so you only do it once but, it is really dangerous to mess with other parts\u0027 Actions lists in this way. E.g. if the PartModule in question tries to do something to one of its actions later and the code hasn\u0027t been written to assume the action may not be present then it could cause serious issues. Also, even if the PartModule does handle the action not being present, you would still have to duplicate any changes it would normally try to make and these changes may be controlled by private stuff you can\u0027t mess with (easily).\u003C/p\u003E\n"},{"CreatedByName":"JDP","CreatedById":30775,"CreatedDateTime":"2014-11-11T12:41:58Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Padishar\u0022 data-cite=\u0022Padishar\u0022\u003E\u003Cdiv\u003E...it is really dangerous to mess with other parts\u0027 Actions lists in this way. E.g. if the PartModule in question tries to do something to one of its actions later and the code hasn\u0027t been written to assume the action may not be present then it could cause serious issues...\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ETrue. Maybe it would be safer simply to deactivate the action:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003EActions[\u0022SomeNamedAction\u0022].active = false;\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EIf this will cause an update in the visual action list within the editor is a different question.\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-11-11T15:19:41Z","Content":"\n\u003Cp\u003EFirst, I\u0027m not messing with the action itself. That way lies nothing but a minefield of problems as I try to delete and then recreate the action.\u003C/p\u003E\u003Cp\u003ESecond, the BaseAction.active =false; does not hide the action in the editor GUI so it will not work for what I want.\u003C/p\u003E\u003Cp\u003EAt this point I think I\u0027m going to have to accept I can\u0027t change the action and accept the fact that actions effecting the same thing may not line up next to each other in the editor GUI.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2014-11-12T15:01:48Z","Content":"\n\u003Cp\u003EUse reflection. Get the the parmodule method list ( GetMethods(BindingFlags.Instance | BindingFlags.Public | BindingFlags.NonPublic) ), itteratate on it and check the attribute for each ( GetCustomAttributes(typeof(KSPEvent), true) ). Once you have that you should be able to change the guiActive of the action to false.\u003C/p\u003E\u003Cp\u003EGet me on IRC or PM me if you need more detailed steps.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-11-12T15:24:23Z\u0022 title=\u002211/12/2014 03:24  PM\u0022 data-short=\u00229 yr\u0022\u003ENovember 12, 2014\u003C/time\u003E by sarbian\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-11-12T16:42:23Z","Content":"\n\u003Cp\u003EBaseAction has a .guiActive?\u003C/p\u003E\u003Cp\u003EIt has a .guiName but I did not see a .guiActive, will test ASAP. (At work, several hours until I can test.)\u003C/p\u003E\u003Cp\u003EI started this thread because I thought BaseAction did not have a .guiActive.\u003C/p\u003E\u003Cp\u003EIf it does that solves my problems and I just can\u0027t read apparently.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n"},{"CreatedByName":"Padishar","CreatedById":97386,"CreatedDateTime":"2014-11-12T17:00:16Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Diazo\u0022 data-cite=\u0022Diazo\u0022\u003E\u003Cdiv\u003EBaseAction has a .guiActive?\u003Cp\u003EIt has a .guiName but I did not see a .guiActive, will test ASAP. (At work, several hours until I can test.)\u003C/p\u003E\u003Cp\u003EI started this thread because I thought BaseAction did not have a .guiActive.\u003C/p\u003E\u003Cp\u003EIf it does that solves my problems and I just can\u0027t read apparently.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ENot directly, you have to use reflection to access the KSPEvent attribute which is what has guiActive...\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-11-12T17:07:06Z","Content":"\n\u003Cp\u003EErm, I\u0027m not touching the Events, I\u0027m talking about Actions.\u003C/p\u003E\u003Cp\u003EAs in, in action assignment mode in the editor, I want to hide an action so it does not display in the available actions list for the selected part to assign in to an action group.\u003C/p\u003E\u003Cp\u003E(Random picture off the internet.)\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://i.imgur.com/Kz4S9NL.png\u0022 alt=\u0022Kz4S9NL.png\u0022\u003E\u003C/p\u003E\u003Cp\u003EThis shows where I want to hide the action, I want to be able to hide the \u0022Activate\u0022 action so it does not show in the \u0022Selection\u0022 column.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-11-13T01:37:21Z","Content":"\n\u003Cp\u003EOkay, apparently I botched my testing last night.\u003C/p\u003E\u003Cp\u003EBaseAction.active = false; does in fact hide the action in the editor. \u003C/p\u003E\u003Cp\u003EI\u0027m not sure why my tests last night showed otherwise, my best guess being I deactivated them too early and KSP set them back active on me between my active = false code running and checking their state in the editor.\u003C/p\u003E\u003Cp\u003ESo, issue is resolved.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\u003Cp\u003Eedit: Nope, baseaction.active=false will not work either. When baseaction.active=false, you can\u0027t activate the action so I get back into the same problem of removing the action so other code can\u0027t activate it. Effectively I\u0027ve deleted the action anyway using this method so meh.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-11-13T02:52:08Z\u0022 title=\u002211/13/2014 02:52  AM\u0022 data-short=\u00229 yr\u0022\u003ENovember 13, 2014\u003C/time\u003E by Diazo\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2014-11-13T10:37:44Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Diazo\u0022 data-cite=\u0022Diazo\u0022\u003E\u003Cdiv\u003EAs in, in action assignment mode in the editor, I want to hide an action so it does not display in the available actions list for the selected part to assign in to an action group.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EIf you\u0027re only hiding it in the editor, that\u0027s pretty straightforward: just grab the list and remove items/reorder it. This snippet alphabetizes part actions and hides any called \u0022Toggle\u0022\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E[KSPAddon(KSPAddon.Startup.EditorAny, false)]\u003Cbr\u003Eclass ToggleBegone : MonoBehaviour\u003Cbr\u003E{\u003Cbr\u003E    void Start()\u003Cbr\u003E    {\u003Cbr\u003E        EditorActionGroups.Instance.partActionList.AddValueChangedDelegate(ReorderList);\u003Cbr\u003E    }\u003Cbr\u003E\u003Cbr\u003E    void OnDestroy()\u003Cbr\u003E    {\u003Cbr\u003E        // assuming it\u0027s necessary anyway\u003Cbr\u003E        EditorActionGroups.Instance.partActionList.RemoveValueChangedDelegate(ReorderList);\u003Cbr\u003E    }\u003Cbr\u003E\u003Cbr\u003E    void ReorderList(IUIObject obj)\u003Cbr\u003E    {\u003Cbr\u003E        Log.Debug(\u0022Alphabetizing\u0022);\u003Cbr\u003E\u003Cbr\u003E        // Note: there are at least three types of UIListItems in this list:\u003Cbr\u003E        // 1) the \u0022title\u0022 entry, always first index, looks based off of 2) except named ActionPartTitle\u003Cbr\u003E        // 2) \u0022ActionPart\u0022 with a EditorActionPartItem component linking back to the relevant action\u003Cbr\u003E        // 3) \u0022ActionPartReset\u0022 which contains a EditorActionPartReset component. Always last, only appears\u003Cbr\u003E        //    if at least one action in the list was assigned to a group\u003Cbr\u003E\u003Cbr\u003E        List\u0026lt;IUIListObject\u0026gt; items = new List\u0026lt;IUIListObject\u0026gt;();\u003Cbr\u003E        var partActions = EditorActionGroups.Instance.partActionList;\u003Cbr\u003E\u003Cbr\u003E        while (partActions.Count \u0026gt; 1)\u003Cbr\u003E        {\u003Cbr\u003E            if (partActions.GetItem(1).gameObject.GetComponent\u0026lt;EditorActionPartReset\u0026gt;() != null) break;\u003Cbr\u003E\u003Cbr\u003E            items.Add(partActions.GetItem(1));\u003Cbr\u003E            partActions.RemoveItem(1, false, false);\u003Cbr\u003E        }\u003Cbr\u003E\u003Cbr\u003E        List\u0026lt;IUIListObject\u0026gt; goodItems = new List\u0026lt;IUIListObject\u0026gt;();\u003Cbr\u003E\u003Cbr\u003E        items.ForEach(lo =\u0026gt;\u003Cbr\u003E            {\u003Cbr\u003E                if (lo.gameObject.GetComponent\u0026lt;EditorActionPartItem\u0026gt;().evt.guiName != \u0022Toggle\u0022)\u003Cbr\u003E                    goodItems.Add(lo);\u003Cbr\u003E                else GameObject.Destroy(lo.gameObject);\u003Cbr\u003E            });\u003Cbr\u003E\u003Cbr\u003E        goodItems = items.OrderBy(o =\u0026gt; o.gameObject.GetComponent\u0026lt;EditorActionPartItem\u0026gt;().evt.guiName).ToList();\u003Cbr\u003E\u003Cbr\u003E        for (int i = 0; i \u0026lt; goodItems.Count; \u002B\u002Bi)\u003Cbr\u003E            partActions.InsertItem(goodItems[i], 1 \u002B i);\u003Cbr\u003E    }\u003Cbr\u003E}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-11-13T11:01:02Z\u0022 title=\u002211/13/2014 11:01  AM\u0022 data-short=\u00229 yr\u0022\u003ENovember 13, 2014\u003C/time\u003E by xEvilReeperx\u003C/strong\u003E\n\u003Cbr\u003EForgot to destroy excluded list items\n\u003C/span\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-11-13T15:14:07Z","Content":"\n\u003Cp\u003ENow that is an interesting bit of code EvilReeper and not one I had really considered.\u003C/p\u003E\u003Cp\u003EI\u0027ll going to have to decide how I proceed from here now, this opens up some options I had not considered.\u003C/p\u003E\u003Cp\u003EThanks for this.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n"}]}