{"TopicId":78154,"ForumId":36,"TopicTitle":"Contract Modding Information for Mod Authors","CreatedByName":"MrHappyFace","CreatedById":76365,"CreatedDateTime":"2014-07-18T09:00:31Z","PageNum":5,"Articles":[{"CreatedByName":"DMagic","CreatedById":57416,"CreatedDateTime":"2014-09-26T23:13:34Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022FlowerChild\u0022 data-cite=\u0022FlowerChild\u0022\u003E\u003Cdiv\u003EYou can directly modify contract payments per body through RecoveryValue, just keep in mind you will also be modifying the science payout for recovering a vessel after returning from that body at the same time. Bit messy, but at least there\u0027s a way to modify it.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYep, my [thread=80220]celestial body science parameter modifier[/thread] can be used to adjust this. I have a big warning on the thread about it affecting contract rewards though, since a few people discovered the hard way that this happens.\u003C/p\u003E\n"},{"CreatedByName":"FlowerChild","CreatedById":74289,"CreatedDateTime":"2014-09-27T00:13:22Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022DMagic\u0022 data-cite=\u0022DMagic\u0022\u003E\u003Cdiv\u003EYep, my [thread=80220]celestial body science parameter modifier[/thread] can be used to adjust this. I have a big warning on the thread about it affecting contract rewards though, since a few people discovered the hard way that this happens.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EAh, cool. I\u0027ve been editing those values forever both in BTSM and ATC, but never realized before today that RecoveryValue also affects the contract payouts \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Justin Kerbice","CreatedById":101695,"CreatedDateTime":"2014-10-15T18:38:13Z","Content":"\n\u003Cp\u003EDoes the info of 1st post still valid in 0.25 ?\u003C/p\u003E\u003Cp\u003ECause Generate is called AFTER getHashString !\u003C/p\u003E\u003Cp\u003E\u002B there is no help on objectives setup =\u0026gt; done with contract paremeter(s)\u003C/p\u003E\u003Cp\u003E\u002B using number\u003Cstrong\u003Ef\u003C/strong\u003E seems to be wrong, despite method parameter is \u0022float days\u0022 in SetDeadlineDays(), using \u0027f\u0027 suffix makes numbers misparsed/misinterpreted (8f for days = 1d, 5h, 59m, 58s !)\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003E\u003Cspan style=\u0022text-decoration:underline;\u0022\u003EEDIT:\u003C/span\u003E\u003C/strong\u003E\u003C/p\u003E\u003Cp\u003Edoes anyone know WHY MeetRequirements of a subclass of Contract class is called \u003Cstrong\u003EVERY OFTEN\u003C/strong\u003E ? (very often = \u003Cstrong\u003Eabout 30 times/sec\u003C/strong\u003E)\u003C/p\u003E\u003Cp\u003EAnd even in flight mode ?? How does a contract could be not offered in flight ? \u003C/p\u003E\u003Cp\u003EAs is this what MeetRequirements method is supposed to do, work on Mission Controller building to check if a contract is offered or not, according to\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003EIn MeetRequirements(), you can check if this contract should show up in mission control, and return false is it shouldn\u0027t and true if it should.\u003C/div\u003E\u003C/blockquote\u003E from 1st post\u003Cp\u003EAn empty contract example would have been better IMHO (EDIT: working on it)\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-10-18T10:22:36Z\u0022 title=\u002210/18/2014 10:22  AM\u0022 data-short=\u00229 yr\u0022\u003EOctober 18, 2014\u003C/time\u003E by Justin Kerbice\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"malkuth","CreatedById":57414,"CreatedDateTime":"2014-10-19T17:18:10Z","Content":"\n\u003Cp\u003EYes it is still valid. Not much has changed in contracts.\u003C/p\u003E\n"},{"CreatedByName":"malkuth","CreatedById":57414,"CreatedDateTime":"2014-11-13T19:57:03Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022FlowerChild\u0022 data-cite=\u0022FlowerChild\u0022\u003E\u003Cdiv\u003EOk, I hope people are still following this thread as I just figured out something rather crucial about the contract system \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003Cp\u003EI was noticing that as I was adding more and more contracts to the game, a lot of them were being generated only to be then removed by the contract system. There\u0027s a debug output that stock generates when this happens.\u003C/p\u003E\u003Cp\u003EPlaying around a bit, I figured out that the number of contracts *on offer* seems to be limited to a specific number per prestige level, that contracts above a certain prestige level are removed if the player\u0027s reputation is too low (I don\u0027t know the precise values involved as that would take a LOT of test cases to figure out), and that the number offered at a given prestige level seems to also be dependent on reputation.\u003C/p\u003E\u003Cp\u003ESo, with a bit of educated guess-work and a bunch of debugging output code, this is what I figured out:\u003C/p\u003E\u003Cp\u003EWhen a contract has its Generate() function called, it already has its prestige level set to the prestige level of contract the contract system wishes to generate. In other words, if a new trivial prestige contract would create a contract that would exceed the limit on the number of trivial contracts that should be present at any given time Generate() will NOT be called with the prestige level set to trivial.\u003C/p\u003E\u003Cp\u003EWhat this means is you should NOT return true from Generate() if you would be creating a contract at a prestige level other than the one specified. Either that, or you should tailor your contract generation so that it generates a contract only of the prestige level specified (i.e. you should NOT set it yourself).\u003C/p\u003E\u003Cp\u003EA simple example from my own code where I have a contract that I only want to generate at the trivial prestige level in case any of that wasn\u0027t clear:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E        protected override bool Generate()\u003Cbr\u003E        {\u003Cbr\u003E            if ( prestige != ContractPrestige.Trivial )\u003Cbr\u003E            {\u003Cbr\u003E                return false;\u003Cbr\u003E            }\u003Cbr\u003E\u003Cbr\u003E            // regular contract generation code here\u003Cbr\u003E        }\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EThis is probably also why when you create a bunch of custom contracts, certain stock ones stop being generated. The stock contracts are testing whether they should generate based on the prestige, while custom contracts that don\u0027t wind up saturating the system so that the stock ones no longer have room to generate in.\u003C/p\u003E\u003Cp\u003EAnyways, like I said, I really hope the other contract mod authors are still following this thread, as this seems to be a rather major thing about the way the system works, and I\u0027m still surprised I managed to figure it out given how less than obvious it is \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThanks flowerChild indeed I have not checked this thread for some time.. LOL I have set all my contracts to this, I had a large amount of things to help control the amount of spam already in my Mod and this will help even more. Something I can\u0027t stress enough is that its also a pretty good idea to be able to turn off all your contract types. In that case you give the player some pretty good control over what is showing up and what is not.\u003C/p\u003E\u003Cp\u003EOn a new note. Anyone yet figure out how to make a contract parameter dependent on another to be finished without using a static value to communicate hackery.\u003C/p\u003E\u003Cp\u003Ewhat I mean is if in the actual contract I have. Two parameters.. Lets say in my case.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Ethis.AddParameter(new GetCrewCount(crew), null);\u003Cbr\u003Ethis.AddParameter(new PreLaunch(), null);\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EIf I want GetCrewCount to only be checked when PreLaunch is Contract.state.complete anyone figure this out.\u003C/p\u003E\u003Cp\u003EI tried a few things and it usually ends up bad. Seems like once a contract is generated then nothing can change from the contract point of view, only from within the parameters themselves.\u003C/p\u003E\u003Cp\u003EDisableOnStateChange = false; seems to help within the parameters themselves if you want you State to change if something else changes while the player plays. But again this seems to be only effective if the code exist within the actual Parameter itself to take advantage of a DisableOnStateChange applied from within the contract itself. So far seems its the only thing that seems to work to effect an already generated contract. Again which would lead to a hack to get parameters to work with each other... Which is what I don\u0027t want to do at this point.\u003C/p\u003E\n"},{"CreatedByName":"Starman4308","CreatedById":122674,"CreatedDateTime":"2014-11-30T17:36:16Z","Content":"\n\u003Cp\u003EMy current effort is going to be the death of me. I\u0027m in the process of writing a mod which rescales contract payouts for RSS, to have a more sane accounting of delta-V requirements. I\u0027ve having trouble, though. I think I\u0027ve figured out how to do something when a new contract is offered, but I can\u0027t figure out how to find and modify the contract which was offered. I then thought of adding a dummy parameter to mark rescaled contracts, but that approach is creating duplicate contracts on me*.\u003C/p\u003E\u003Cp\u003E*I think what is going on is that I modify, say, the Orbit Kerbin contract, KSP no longer recognizes it as the Orbit Kerbin contract and re-offers it, it gets re-scaled, and this repeats each time the contract list changes.\u003C/p\u003E\u003Cp\u003EThus: does anybody know how to catch new contracts as they are offered, or a good way to prevent duplication of the scripted contracts after I give them a new parameter?\u003C/p\u003E\n"},{"CreatedByName":"Ser","CreatedById":104207,"CreatedDateTime":"2014-12-01T06:56:55Z","Content":"\n\u003Cp\u003EStarman4308, check out the source of this one:\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/101322-0-25-Contract-Science-Modifier-%28v0-1%29-2014-11-27\u0022 rel=\u0022external nofollow\u0022\u003Econtract science modifier\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EI\u0027m not adding a new parameter there but getting and changing attributes of an existing one without getting anything doubled. Brief and simple.\u003C/p\u003E\n"},{"CreatedByName":"Starman4308","CreatedById":122674,"CreatedDateTime":"2014-12-02T02:42:54Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Ser\u0022 data-cite=\u0022Ser\u0022\u003E\u003Cdiv\u003EStarman4308, check out the source of this one:\u003Cp\u003E\u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/101322-0-25-Contract-Science-Modifier-%28v0-1%29-2014-11-27\u0022 rel=\u0022external nofollow\u0022\u003Econtract science modifier\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EI\u0027m not adding a new parameter there but getting and changing attributes of an existing one without getting anything doubled. Brief and simple.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EAre you sure that works? I copied the logic, and while it worked for the first four contracts offered, it didn\u0027t do so for subsequent contracts. What I suspect may be happening is that the onDestroy() method is being called the moment you change scenes, and I suspect trying to fix that would just cause even worse problems, because you might get accumulation of multiple copies of your addon running around. In any case, I started my own thread, and it\u0027s back to \u0022make a log of previously encountered contract GUIDs, and skip those when iterating over contracts each time the list changes\u0022 for now.\u003C/p\u003E\u003Cp\u003EEDIT: Hallelujah, I\u0027ve gotten my dictionary to work. My thread (and the GitHub source) is \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/101688-Very-Early-WIP-Renegotiator-an-RSS-Payout-Adjuster\u0022 rel=\u0022external nofollow\u0022\u003Ehere\u003C/a\u003E: the mod still doesn\u0027t do anything useful, but AFAIK, it is functional and robust in modifying contracts once and only once. I swear I\u0027ll document it better later.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-12-02T04:19:03Z\u0022 title=\u002212/02/2014 04:19  AM\u0022 data-short=\u00229 yr\u0022\u003EDecember 2, 2014\u003C/time\u003E by Starman4308\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Ser","CreatedById":104207,"CreatedDateTime":"2014-12-02T06:47:32Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Starman4308\u0022 data-cite=\u0022Starman4308\u0022\u003E\u003Cdiv\u003EAre you sure that works? I copied the logic, and while it worked for the first four contracts offered, it didn\u0027t do so for subsequent contracts.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI\u0027m almost sure that works \u0027cause I use it personally for a couple of weeks having about 10 new contracts processed. May be there\u0027s something besides my logic like 64bit KSP? Would appreciate if you provided more detail about the case and contracts that failed to process in my post, some screenshots would be great.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-12-02T06:57:14Z\u0022 title=\u002212/02/2014 06:57  AM\u0022 data-short=\u00229 yr\u0022\u003EDecember 2, 2014\u003C/time\u003E by Ser\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"FlowerChild","CreatedById":74289,"CreatedDateTime":"2015-02-05T22:44:48Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022malkuth\u0022 data-cite=\u0022malkuth\u0022\u003E\u003Cdiv\u003E\u003Cp\u003EOn a new note. Anyone yet figure out how to make a contract parameter dependent on another to be finished without using a static value to communicate hackery.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EWell see, I haven\u0027t checked this thread in a long while either now \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EIf you\u0027re still having trouble with this, I can do a write up on how it to be sure, as I\u0027m already doing it in several BTSM contracts. Let me know if that\u0027s the case (probably best via PM so we don\u0027t miss it again), but I suspect a couple of months later you may have already sorted it.\u003C/p\u003E\u003Cp\u003EIt\u0027s a bit of a shame this thread has fallen into disuse and been unstickied as there\u0027s a lot of useful information contained within, and definitely room for ongoing conversation and knowledge sharing with the integration of Fine Print into stock.\u003C/p\u003E\u003Cp\u003EI actually just popped it open again to reference the table of relative values of contracts based on location and prestige value that DMagic posted earlier in the thread as I had forgotten something about it \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-02-05T22:55:47Z\u0022 title=\u002202/05/2015 10:55  PM\u0022 data-short=\u00229 yr\u0022\u003EFebruary 5, 2015\u003C/time\u003E by FlowerChild\u003C/strong\u003E\n\u003C/span\u003E\n"}]}