{"TopicId":103963,"ForumId":36,"TopicTitle":"[WIP][1.9.x-1.12.x] Scatterer-atmospheric scattering (0.0838 - 14/08/2022) Scattering improvements, in-game atmo generation and multi-sun support","CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-04-12T08:37:35Z","PageNum":327,"Articles":[{"CreatedByName":"Tahvohck","CreatedById":82067,"CreatedDateTime":"2020-01-24T06:38:04Z","Content":"Found my issue. \u003Cabbr title=\u0022Comprehensive Kerbal Archive Network (a KSP mod manager)\u0022\u003ECKAN\u003C/abbr\u003E is installing version 0.0540 instead of 0.0541, AKA it\u0027s installing the 1.7 version of the mod instead of version 1.8. This means the metadata on \u003Cabbr title=\u0022Comprehensive Kerbal Archive Network (a KSP mod manager)\u0022\u003ECKAN\u003C/abbr\u003E is probably incorrect.![unknown.png](https://cdn.discordapp.com/attachments/399706736375758859/670155163524268032/unknown.png)\n\nEdit: This was probably a misconfiguration in my \u003Cabbr title=\u0022Comprehensive Kerbal Archive Network (a KSP mod manager)\u0022\u003ECKAN\u003C/abbr\u003E.\n\n**Edited \u003Ctime datetime=\u00222020-01-24T08:37:55Z\u0022 title=\u002201/24/2020 08:37  AM\u0022 data-short=\u00224 yr\u0022\u003EJanuary 24, 2020\u003C/time\u003E by Tahvohck**"},{"CreatedByName":"Random Annoying Guy","CreatedById":202206,"CreatedDateTime":"2020-01-24T17:32:01Z","Content":"Disregard my last statement, the skybox turns white when one of Tantares Soyuz pods is the root part and the lens flare shader is turned on."},{"CreatedByName":"mindseyemodels","CreatedById":177219,"CreatedDateTime":"2020-02-04T00:51:34Z","Content":"is anyone else having the problem of the \u003Cabbr title=\u0022Kerbal Space Center\u0022\u003Eksc\u003C/abbr\u003E being underwater? I dont know what is going on"},{"CreatedByName":"Delay","CreatedById":173586,"CreatedDateTime":"2020-02-04T00:57:47Z","Content":"\u003E \n\u003E \n\u003E 5 minutes ago, mindseyemodels said:\n\u003E \n\u003E \n\u003E is anyone else having the problem of the \u003Cabbr title=\u0022Kerbal Space Center\u0022\u003Eksc\u003C/abbr\u003E being underwater? I dont know what is going on\n\u003E \n\nThat has been fixed a while ago. Simply update to the latest version of Scatterer and you should be good."},{"CreatedByName":"mindseyemodels","CreatedById":177219,"CreatedDateTime":"2020-02-04T01:27:31Z","Content":"\u003E \n\u003E \n\u003E 27 minutes ago, Delay said:\n\u003E \n\u003E \n\u003E That has been fixed a while ago. Simply update to the latest version of Scatterer and you should be good.\n\u003E \n\nhow long ago? because I just started ksp for the first time in a while and it is consistently underwater... plus I use \u003Cabbr title=\u0022Comprehensive Kerbal Archive Network (a KSP mod manager)\u0022\u003Eckan\u003C/abbr\u003E so any ways to update that version?"},{"CreatedByName":"Tahvohck","CreatedById":82067,"CreatedDateTime":"2020-02-04T02:42:55Z","Content":"[@mindseyemodels](https://forum.kerbalspaceprogram.com/index.php?/profile/177219-mindseyemodels/) That\u0027s the same issue I was having. Check the Versions tab in \u003Cabbr title=\u0022Comprehensive Kerbal Archive Network (a KSP mod manager)\u0022\u003ECKAN\u003C/abbr\u003E and make sure it\u0027s version \u003Cu\u003E\u003Cstrong\u003E2:v0.0541\u003C/strong\u003E\u003C/u\u003E that\u0027s installed. If not, you probably need to add KSP version 1.8 as a \u003Cabbr title=\u0022Comprehensive Kerbal Archive Network (a KSP mod manager)\u0022\u003ECKAN\u003C/abbr\u003E compatibility override."},{"CreatedByName":"steve_v","CreatedById":69272,"CreatedDateTime":"2020-02-04T07:12:40Z","Content":"I\u0027m reasonably sure this is a base game problem, but as it affects scatterer as well and all the shader gurus seem to hang out in this thread, I\u0027m posting it here too in the hopes of a nibble.\n\nKSP 1.7.3 looks just fine.  \n\nKSP 1.7.3 \u002B Scatterer 0.0540 looks even better, just how it should.  \n\nKSP 1.8.1 appears to have some acquired some funkiness, I swear the atmosphere shouldn\u0027t be shades of grey when seen from space:  \n![preview](https://damnation.dynu.net/nextcloud/index.php/s/gcAP8NWqtoMc7gT/preview)\n\nKSP 1.8.1 \u002B scatterer 0.0541 (or 0.0540) is even funkier:  \n![preview](https://damnation.dynu.net/nextcloud/index.php/s/p8Qp4MqjJrw6GBT/preview)\n\n[Here be KSP.log](https://damnation.dynu.net/nextcloud/index.php/s/eSBP6rKHHZkYCxS).  \n[Here be Player.log](https://damnation.dynu.net/nextcloud/index.php/s/K9CKrn95aNfAxHL).\n\nAnd here be a snippet from Player.log which appears in KSP 1.8.1, but not in 1.7.3:  \n\n    WARNING: Shader Unsupported: \u0027Hidden/Nature/Terrain/Utilities\u0027 - All passes removed\n    WARNING: Shader Did you use #pragma only_renderers and omit this platform?\n    ERROR: Shader Shader is not supported on this GPU (none of subshaders/fallbacks are suitable)WARNING: Shader Unsupported: \u0027Hidden/Nature/Terrain/Utilities\u0027 - Setting to default shader.\n\nAny thoughts, oh graphics gurus? KSP looking terrible I can handle, but scatter being upset is utterly depressing.\n\n**Edited \u003Ctime datetime=\u00222020-02-04T07:14:38Z\u0022 title=\u002202/04/2020 07:14  AM\u0022 data-short=\u00224 yr\u0022\u003EFebruary 4, 2020\u003C/time\u003E by steve\\_v**"},{"CreatedByName":"Drew Kerman","CreatedById":103177,"CreatedDateTime":"2020-02-04T07:58:29Z","Content":"[@steve_v](https://forum.kerbalspaceprogram.com/index.php?/profile/69272-steve_v/) you make it seem like this is an issue with the menu. Is it actually an in-game problem?"},{"CreatedByName":"steve_v","CreatedById":69272,"CreatedDateTime":"2020-02-04T09:59:27Z","Content":"\u003E \n\u003E \n\u003E 2 hours ago, Drew Kerman said:\n\u003E \n\u003E \n\u003E You make it seem like this is an issue with the menu. Is it actually an in-game problem?\n\u003E \n\nIt\u0027s much the same in every scene where kerbin is visible from space. But scratch all that, I have just discovered that the two problems are not related at all.\n\nActually scatterer related problem report follows:  \n\nIt would appear that scatterer is failing to resolve symbolic links properly when loading some of it\u0027s files. Why I don\u0027t know, Neither the base game nor any other mod I have ever used has this problem.\n\nNo revealing exception is generated until I load into the game proper, which I ran out of time to do earlier as a result of being called out to an instrumentation fault in the middle of a storm (yay).  \n\nSo here is the first and most handy clue:  \n\n    [Scatterer] Custom sunflare cannot be added to Sun System.IO.DirectoryNotFoundException: Could not find a part of the path \u0022/home/steve/Games/KSP_Linux_1.8.1/GameData_scatterer/config/Sunflares/Sun/sunSpikes.png\u0022.\n      at System.IO.FileStream..ctor (System.String path, System.IO.FileMode mode, System.IO.FileAccess access, System.IO.FileShare share, System.Int32 bufferSize, System.Boolean anonymous, System.IO.FileOptions options) [0x00164] in :0 \n      at System.IO.FileStream..ctor (System.String path, System.IO.FileMode mode, System.IO.FileAccess access, System.IO.FileShare share) [0x00000] in :0 \n      at (wrapper remoting-invoke-with-check) System.IO.FileStream..ctor(string,System.IO.FileMode,System.IO.FileAccess,System.IO.FileShare)\n      at System.IO.File.OpenRead (System.String path) [0x00000] in :0 \n      at System.IO.File.ReadAllBytes (System.String path) [0x00000] in :0 \n      at scatterer.SunFlare.start () [0x000ba] in :0 \n      at scatterer.Core.Update () [0x001d5] in :0 \n\nI don\u0027t know where it\u0027s getting \u0022KSP\\_Linux\\_1.8.1/GameData\\_scatterer\u0022, the real path is \u0022KSP\\_Linux\\_1.8.1/GameData\\_Testing/scatterer\u0022, where  GameData -\u003E GameData\\_Testing is a symlink:\n\n    readlink -e /home/steve/Games/KSP_Linux_1.8.1/GameData/scatterer\n    /home/steve/Games/KSP_Linux_1.8.1/GameData_Testing/scatterer\n\nSo, the pertinent question is: Why does every other plugin in the ~85 mods I\u0027m running find it\u0027s files just fine in this situation, while scatter comes up with a mangled path if a symlink is involved? What\u0027s different in the way scatterer resolves canonical file paths?  \n\nThis is the only time I have ever seen a problem like this with any application whatsoever, and that\u0027s why it didn\u0027t occur to me to test without the link in the first place. Most curious.\n\nAs for the original question - why the atmosphere halo in the stock game is messed up and what that new noise about an unsupported shader implies - that I\u0027d also like some input on. Now technically off-topic for this thread, but still... And this time I swear it\u0027s got nothing to do with symlinks or strange file paths. ![:P](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif \u0022:P\u0022)  \n\n**Edited \u003Ctime datetime=\u00222020-02-04T10:56:32Z\u0022 title=\u002202/04/2020 10:56  AM\u0022 data-short=\u00224 yr\u0022\u003EFebruary 4, 2020\u003C/time\u003E by steve\\_v**\n  \nAha. Now that I\u0027m not rushing, the situation becomes clear."},{"CreatedByName":"Arco123","CreatedById":201477,"CreatedDateTime":"2020-02-04T13:06:58Z","Content":"Reinstall Scatterer. This happened to me and you gotta reinstall correctly, sometimes it does this. It worked for me."},{"CreatedByName":"steve_v","CreatedById":69272,"CreatedDateTime":"2020-02-04T13:29:39Z","Content":"\u003E \n\u003E \n\u003E 7 minutes ago, Arco123 said:\n\u003E \n\u003E \n\u003E Reinstall Scatterer. This happened to me and you gotta reinstall correctly, sometimes it does this. It worked for me.\n\u003E \n\nI have, repeatedly. The problem is not that it\u0027s missing some files or in the wrong directory,  it\u0027s that it can\u0027t find its own stuff if the GameData directory is redirected with a symbolic link. All the other mods in there are perfectly happy with this situation.  \n\nThe game itself found and loaded scatterer through that same link, and from my admittedly very casual look at the source it appears scatterer is just using the standard methods shipped with the game for file I/O. Odd. I\u0027m missing something obvious, but a reinstall it is not."},{"CreatedByName":"Starwaster","CreatedById":71262,"CreatedDateTime":"2020-02-04T14:12:45Z","Content":"[@steve_v](https://forum.kerbalspaceprogram.com/index.php?/profile/69272-steve_v/) Scatterer is not \u0027resolving\u0027 any file paths. It has no idea about that. It just knows it ran into an exception and it\u0027s printing out the exception (System.IO.DirectoryNotFoundException) that it caught in its exception handling. \n\nEdit: Ok, not quite correct, sorry. There\u0027s some file handling going on elsewhere. It\u0027s fairly straightforward but it fully expects that the game data folder is named GameData and not GameData\\_testing - and the only way I see this happening is if the actual folder name of GameData\\_testing is being exposed to it.\n\nIf you absolutely have to have this current setup then move GameData\\_Testing to Testing/GameData (that is, make a folder named Testing and put your GameData\\_Testing in that folder but rename it GameData\n\n**Edited \u003Ctime datetime=\u00222020-02-04T14:34:44Z\u0022 title=\u002202/04/2020 02:34  PM\u0022 data-short=\u00224 yr\u0022\u003EFebruary 4, 2020\u003C/time\u003E by Starwaster**"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2020-02-04T17:38:12Z","Content":"[@steve_v](https://forum.kerbalspaceprogram.com/index.php?/profile/69272-steve_v/) That\u0027s poorly written code from my early days, it looks for GameData in your plugin path to find the GameData folder and then probably takes directly what\u0027s before or after. I will look into it but it should be easy to fix."},{"CreatedByName":"Beetlecat","CreatedById":92207,"CreatedDateTime":"2020-02-04T19:13:50Z","Content":"The trees / scatterer not being \u0022scattered\u0022 is on purpose, right? It looks a little funny when I dial them up to a high % and I see crisp, sharp trees way off in the hazy distance ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif \u0022:)\u0022)\n\nSo, instead I just turn around and stare at the GORGEOUS water. ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif \u0022:)\u0022)"},{"CreatedByName":"Likasombodee","CreatedById":119111,"CreatedDateTime":"2020-02-05T00:55:43Z","Content":"When I look at the sun from earth I see multiple little suns in a grid like pattern? Anyone know of this bug. tried googling."},{"CreatedByName":"Drew Kerman","CreatedById":103177,"CreatedDateTime":"2020-02-05T02:25:02Z","Content":"\u003E \n\u003E \n\u003E 7 hours ago, Beetlecat said:\n\u003E \n\u003E \n\u003E The trees / scatterer not being \u0022scattered\u0022 is on purpose, right?\n\u003E \n\nyes, but [@blackrack](https://forum.kerbalspaceprogram.com/index.php?/profile/104258-blackrack/) has said he would consider bringing it back as an option. I hope he does! I\u0027ve done it manually in screenshots in the past and it wasn\u0027t hard but still took up time"},{"CreatedByName":"steve_v","CreatedById":69272,"CreatedDateTime":"2020-02-05T04:39:09Z","Content":"\u003E \n\u003E \n\u003E 11 hours ago, blackrack said:\n\u003E \n\u003E \n\u003E That\u0027s poorly written code from my early days, it looks for GameData in your plugin path to find the GameData folder and then probably takes directly what\u0027s before or after. I will look into it but it should be easy to fix.\n\u003E \n\nThanks dude. To be fair, that kind of assumption is probably perfectly safe on Windows, It\u0027s just us \\*nixers who like to throw symlinks around like confetti. I really can\u0027t blame you for not anticipating it.\n\nI suspect it\u0027s actually easy enough to fix for even a complete .NET noob like myself to sort out if he could find the motivation, but it\u0027s your baby so it\u0027s probably better if you tickle it.\n\n**Edited \u003Ctime datetime=\u00222020-02-05T04:42:11Z\u0022 title=\u002202/05/2020 04:42  AM\u0022 data-short=\u00224 yr\u0022\u003EFebruary 5, 2020\u003C/time\u003E by steve\\_v**"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2020-02-05T08:38:02Z","Content":"\u003E \n\u003E \n\u003E 7 hours ago, Likasombodee said:\n\u003E \n\u003E \n\u003E When I look at the sun from earth I see multiple little suns in a grid like pattern? Anyone know of this bug. tried googling.\n\u003E \n\nI think you\u0027re using an older version of scatterer on a newer version of KSP.\n\n\u003E \n\u003E \n\u003E 3 hours ago, steve\\_v said:\n\u003E \n\u003E \n\u003E Thanks dude. To be fair, that kind of assumption is probably perfectly safe on Windows, It\u0027s just us \\*nixers who like to throw symlinks around like confetti. I really can\u0027t blame you for not anticipating it.\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E I suspect it\u0027s actually easy enough to fix for even a complete .NET noob like myself to sort out if he could find the motivation, but it\u0027s your baby so it\u0027s probably better if you tickle it.\n\u003E \n\nDoes \u003Cabbr title=\u0022Environmental Visual Enhancement (mod)\u0022\u003EEVE\u003C/abbr\u003E work fine with your setup? I thought it looks for \u0022GameData\u0022 also.\n\nEdited: Same for TexturesUnlimited\n\n**Edited \u003Ctime datetime=\u00222020-02-05T08:39:53Z\u0022 title=\u002202/05/2020 08:39  AM\u0022 data-short=\u00224 yr\u0022\u003EFebruary 5, 2020\u003C/time\u003E by blackrack**"},{"CreatedByName":"steve_v","CreatedById":69272,"CreatedDateTime":"2020-02-05T09:30:38Z","Content":"\u003E \n\u003E \n\u003E 17 minutes ago, blackrack said:\n\u003E \n\u003E \n\u003E Does \u003Cabbr title=\u0022Environmental Visual Enhancement (mod)\u0022\u003EEVE\u003C/abbr\u003E work fine with your setup?\n\u003E \n\nYurp.  \n![preview](https://damnation.dynu.net/nextcloud/index.php/s/6JLdjx6bdsiMeJP/preview)\n\n\u003E \n\u003E \n\u003E 31 minutes ago, blackrack said:\n\u003E \n\u003E \n\u003E Same for TexturesUnlimited\n\u003E \n\nI\u0027ve never used it so I\u0027m not sure how it\u0027s supposed to work (I hear Feline Utility rovers can use it, so loaded up some of those parts as a test), but it seems to me like it just flat doesn\u0027t, whether GameData is a symlink or not. No shiny shiny, textures look identical to me. ![:(](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_sad.gif \u0022:(\u0022)  \n\nWhat it does do is spam: \u0022OpenGL Error: Invalid texture unit!\u0022 in the log incessantly, but it throws no I/O related exceptions. A quick search throws that GL error up as a \u0022Known issue\u0022 for some releases of Unity 2019 on GNU/Linux, so I\u0027m guessing it\u0027s just the usual Unity borkage on this platform."},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2020-02-05T12:02:07Z","Content":"\u003E \n\u003E \n\u003E 2 hours ago, steve\\_v said:\n\u003E \n\u003E \n\u003E Yurp.  \n\u003E [![preview](https://damnation.dynu.net/nextcloud/index.php/s/6JLdjx6bdsiMeJP/preview)](https://damnation.dynu.net/nextcloud/index.php/s/6JLdjx6bdsiMeJP/preview \u0022Enlarge image\u0022)\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E I\u0027ve never used it so I\u0027m not sure how it\u0027s supposed to work (I hear Feline Utility rovers can use it, so loaded up some of those parts as a test), but it seems to me like it just flat doesn\u0027t, whether GameData is a symlink or not. No shiny shiny, textures look identical to me. ![:(](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_sad.gif \u0022:(\u0022)  \n\u003E \n\u003E What it does do is spam: \u0022OpenGL Error: Invalid texture unit!\u0022 in the log incessantly, but it throws no I/O related exceptions. A quick search throws that GL error up as a \u0022Known issue\u0022 for some releases of Unity 2019 on GNU/Linux, so I\u0027m guessing it\u0027s just the usual Unity borkage on this platform.\n\u003E \n\nNo idea about TU error, but I know what to do for the scatterer issue.\n\n**Edited \u003Ctime datetime=\u00222020-02-05T12:17:53Z\u0022 title=\u002202/05/2020 12:17  PM\u0022 data-short=\u00224 yr\u0022\u003EFebruary 5, 2020\u003C/time\u003E by blackrack**"},{"CreatedByName":"steve_v","CreatedById":69272,"CreatedDateTime":"2020-02-05T12:42:32Z","Content":"\u003E \n\u003E \n\u003E 37 minutes ago, blackrack said:\n\u003E \n\u003E \n\u003E I know what to do for the scatterer issue.\n\u003E \n\nExcellent...\n\nWait, It\u0027s not \u0022Hit Steve with a moist haddock for doing silly things with links\u0022 by chance, is it? ![:P](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif \u0022:P\u0022)"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2020-02-05T13:28:37Z","Content":"\u003E \n\u003E \n\u003E 45 minutes ago, steve\\_v said:\n\u003E \n\u003E \n\u003E Excellent...\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E Wait, It\u0027s not \u0022Hit Steve with a moist haddock for doing silly things with links\u0022 by chance, is it? ![:P](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif \u0022:P\u0022)\n\u003E \n\nNah, symlinks are cool"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2020-02-05T17:55:30Z","Content":"[@steve_v](https://forum.kerbalspaceprogram.com/index.php?/profile/69272-steve_v/) try this dll: [https://github.com/LGhassen/Scatterer/blob/7fc2f15092c33b688c2d02af24259473467589a6/scatterer/bin/Release/scatterer.dll?raw=true](https://github.com/LGhassen/Scatterer/blob/7fc2f15092c33b688c2d02af24259473467589a6/scatterer/bin/Release/scatterer.dll?raw=true)"},{"CreatedByName":"steve_v","CreatedById":69272,"CreatedDateTime":"2020-02-05T18:16:52Z","Content":"\u003E \n\u003E \n\u003E 11 minutes ago, blackrack said:\n\u003E \n\u003E \n\u003E try this\n\u003E \n\nTried, tested and very much working as it should. ![:D](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif \u0022:D\u0022)"},{"CreatedByName":"Starwaster","CreatedById":71262,"CreatedDateTime":"2020-02-07T01:03:25Z","Content":"\u003E \n\u003E \n\u003E On 2/4/2020 at 11:39 PM, steve\\_v said:\n\u003E \n\u003E \n\u003E Thanks dude. To be fair, that kind of assumption is probably perfectly safe on Windows, It\u0027s just us \\*nixers who like to throw symlinks around like confetti. I really can\u0027t blame you for not anticipating it.\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E I suspect it\u0027s actually easy enough to fix for even a complete .NET noob like myself to sort out if he could find the motivation, but it\u0027s your baby so it\u0027s probably better if you tickle it.\n\u003E \n\nActually, we have symlinks too. And, apparently, the latest update to Vortex decided (totally without my permission) that it was going to symlink my Subnautica mods instead of actually copying the files into Subnautica\u0027s folder and Subnautica really did not like that. NOT. ONE. BIT."}]}