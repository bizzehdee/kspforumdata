{"TopicId":103074,"ForumId":16,"TopicTitle":"Memory usage (no solution)","CreatedByName":"TC One","CreatedById":68439,"CreatedDateTime":"2015-03-31T22:00:54Z","PageNum":1,"Articles":[{"CreatedByName":"TC One","CreatedById":68439,"CreatedDateTime":"2015-03-31T22:00:54Z","Content":"\n\u003Cp\u003EHi all!\u003C/p\u003E\u003Cp\u003EDoes anyone know how to flush the memory used by the process \u0027on the fly\u0027?\u003C/p\u003E\u003Cp\u003EHere is my situation:\u003C/p\u003E\u003Cp\u003E - A lot of mods.\u003C/p\u003E\u003Cp\u003E - All memory conserving methods I managed to find on forums are used (Active Texture Management, force OpenGL, Half-Res textures setting)\u003C/p\u003E\u003Cp\u003E - I have about 2.2 to 2.5 Gb memory used by KSP when the title screen appears after game is loaded (depending on mods used, I am trying to trim my install, but don\u0027t want to get rid of all favorite parts)\u003C/p\u003E\u003Cp\u003E - Like 2.5 to 2.7 Gb used when I\u0027ve the savegame loaded\u003C/p\u003E\u003Cp\u003EWhile actually playing KSP with the memory usage as listed above I do not face any crashes and/or severe lags. By playing I mean - piloting my ships/planes/rovers. I happen to travel almost 100km across Mun surface on rover with a couple of quick loadings (due to rover crash), and didn\u0027t exceed the available memory. I\u0027ve also flew an atmospheric plane for more than 1000km (yes, not meters) at the Kerbin to complete the Temperature scan contract and had no issues with memory, I suppose that loading a new terrain while traveling that far is not a big deal for KSP.\u003C/p\u003E\u003Cp\u003EBut I do have a serious problem at VAB and SPH. While building a new vessel (especially a SpacePlane) I do a lot of tests to ensure that the new toy will fly (or roll, or whatever) as good as I want it to, after each testing launch memory usage is increasing, even if I\u0027m building a rover and the testing area is actually limited to SPH runway. Let\u0027s say I enter SPH with 2.7Gb loaded, I\u0027m starting the test run and memory usage comes to 2.8-2.9, then I revert and change a couple of parts, the process memory is still 2.8-2.9, running a next test will consume another 50-150mb, and so on, until I get 3.6-3.7 and a crush after all.\u003C/p\u003E\u003Cp\u003EI admit that my real problem is excessive mod usage and my issues can\u0027t be addressed to Squad. But maybe someone do know how to deal with the situation above? What actions in game can force the KSP to unload some unused stuff from active memory? Unloading the game back to title screen is not helping (100-200mb unloaded maximum).\u003C/p\u003E\u003Cp\u003EAny ideas or suggestions?\u003C/p\u003E\u003Cp\u003E\u003Cem\u003EUPDATE: Important thing to note that the memory doesn\u0027t leak while I do nothing on any screen. So, the problem is not an ordinary memory leak as we all might faced in some other games.\u003C/em\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-04-01T01:41:53Z\u0022 title=\u002204/01/2015 01:41  AM\u0022 data-short=\u00229 yr\u0022\u003EApril 1, 2015\u003C/time\u003E by TC One\u003C/strong\u003E\n\u003Cbr\u003Eadditional clarification\n\u003C/span\u003E\n"},{"CreatedByName":"eurybaric","CreatedById":33541,"CreatedDateTime":"2015-03-31T22:08:17Z","Content":"\n\u003Cp\u003EThe game in its current versions suffers from memory leaks. AFAIK no one has come up with a solution such as the one you propose.\u003C/p\u003E\u003Cp\u003EHOWEVER, in the last Squadcast Maxmaps confirmed that these have been worked on and there are major improvements on that front (memory usage) in the upcoming version.\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/114140-Squadcast-Summary-%282015-03-28%29-Back-With-A-Bang-Edition%21\u0022 rel=\u0022external nofollow\u0022\u003EHere\u003C/a\u003E\u0027s the Squadcast summary post with the relevant info.\u003C/p\u003E\u003Cp\u003ECheers!\u003C/p\u003E\n"},{"CreatedByName":"Taki117","CreatedById":89975,"CreatedDateTime":"2015-03-31T22:19:19Z","Content":"\n\u003Cp\u003EAs a stopgap what you can do is add -force-opengl to your shortcut which will save you about 1GB of ram.\u003C/p\u003E\n"},{"CreatedByName":"TC One","CreatedById":68439,"CreatedDateTime":"2015-03-31T22:21:31Z","Content":"\n\u003Cp\u003E@Taki117\u003C/p\u003E\u003Cp\u003EI\u0027ve already did that. I suppose my setup wouldn\u0027t even load without OpenGL forced \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cry.gif\u0022 alt=\u0022;.;\u0022\u003E\u003C/p\u003E\u003Cp\u003E@eurybaric\u003C/p\u003E\u003Cp\u003EThanks for the link, at least I do know that the leak is not my very own issue.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-03-31T22:24:41Z\u0022 title=\u002203/31/2015 10:24  PM\u0022 data-short=\u00229 yr\u0022\u003EMarch 31, 2015\u003C/time\u003E by TC One\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Fel","CreatedById":57121,"CreatedDateTime":"2015-04-01T00:45:02Z","Content":"\n\u003Cp\u003EMeh, opengl and directx really shouldn\u0027t make a difference which means you\u0027re doing something undocumented (i.e. unstable). Linux or FOSS insanity aside, we\u0027re only talking about different flavours of accessing the same hardware. Any \u0022memory savings\u0022 is likely to be caused from either texture compression (i.e. non-lossless textures) or not preconverting the textures into usable RAW data (which means you\u0027ll only crash later).\u003C/p\u003E\u003Cp\u003EEither way, you misunderstand memory usage if you think that it ends with textures. Applying bumpmaps, for instance, is dynamic; procedural generation is also dynamic (hence memory exhaustive). Mods may still be using WWW instead of file accessors, which loads more libraries into memory and has its own buffer (memory waste!). Other mods also follow the \u0022load everything at once\u0022 mantra (or worse, have a broken version of parallel processing which COPIES itself for each object rapidly chewing memory).\u003C/p\u003E\u003Cp\u003EAdd on that KSP cannot effectively garbage collect with very little memory available. (It\u0027s a problem with fragments, while you CAN create fragments in memory, it means garbage collection is going to fragment more than it defrags)\u003C/p\u003E\u003Cp\u003EMost effective solution would be to go through your mods and start reducing texture sizes down on a per part basis. (Of course, you might have to remap the part :S). If a part is basically like a backpack, it really doesn\u0027t need a 1024x1024 texture or larger; 128x128 is perfectly fine until you zoom all the way up. There are tricks you could do if you STREAM texture data, such as reading the pixels as a multiple of X, where X is proportional to the relative size of the object on the screen (Basically, the closer you get the bigger the texture that is loaded; but OTHER textures would decrease which saves memory when dealing with their mappings.); but KSP is unlikely to have that low level of optimizations... so it is a choice between what the provider thinks is \u0022omg awesome looking\u0022 or what you think is \u0022I just want this to work\u0022\u003C/p\u003E\n"},{"CreatedByName":"Claw","CreatedById":100668,"CreatedDateTime":"2015-04-01T01:10:14Z","Content":"\n\u003Cp\u003EAdditionally, there is a definite memory leak that occurs when doing the editor-fly-revert cycle. Hopefully that memory leak is also getting attention. I\u0027m not sure yet if going from the editor out to the KSC main complex and back helps clear out the loose memory, but if you get consistent crashes then it might be worth a try.\u003C/p\u003E\u003Cp\u003ECheers,\u003C/p\u003E\u003Cp\u003E-Claw\u003C/p\u003E\n"},{"CreatedByName":"NathanKell","CreatedById":75006,"CreatedDateTime":"2015-04-01T01:32:11Z","Content":"\n\u003Cp\u003E\u003Cspan style=\u0022font-family:\u0027Comic Sans MS\u0027;\u0022\u003EFel: that would be true...except the Unity 4.x D3D9 client (KSP\u0027s default) has a serious bug where it fails to unload textures from system RAM once they\u0027ve been uploaded to VRAM. That\u0027s why -force-opengl saves RAM, because the OpenGL client doesn\u0027t have that bug, so textures are properly unloaded from system RAM once shipped off to the GPU.\u003C/span\u003E\u003C/p\u003E\n"},{"CreatedByName":"TC One","CreatedById":68439,"CreatedDateTime":"2015-04-01T01:43:31Z","Content":"\n\u003Cp\u003EThanks to all for the answers. I will try to maintain some build/play balance - that minimize my crashes \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EFor the record: OpenGL saves almost 1Gb of loaded RAM on my setup.\u003C/p\u003E\n"},{"CreatedByName":"eddiew","CreatedById":127483,"CreatedDateTime":"2015-04-01T08:25:50Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022TC One\u0022 data-cite=\u0022TC One\u0022\u003E\u003Cdiv\u003EThanks to all for the answers. I will try to maintain some build/play balance - that minimize my crashes \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003E\u003Cspan style=\u0022color:#333333;\u0022\u003EI use Kerbal Construction Time, so like you, I have a lot of launch-revert-launch cycles. And about 2.4GB in use on the menu screen \u003C/span\u003E\u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EThe short version (as others have said) is that the memory leak is inevitable. The memory crash is also a guaranteed event past 3.7GB, and possible above 3.4 if you change scene.\u003C/p\u003E\u003Cp\u003EBut because of this predictability, you can...\u003C/p\u003E\u003Cp\u003E- play in a borderless windowed mode (add \u003Cspan style=\u0022color:#333333;\u0022\u003E-popupwindow to the shortcut) since this will make alt-tabbing instant and easy.\u003C/span\u003E\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022color:#333333;\u0022\u003E- keep windows task manager open and check KSP.exe\u0027s memory usage regularly. Perform a graceful restart before it hits 3.4GB, and you\u0027ll never see crashes.\u003C/span\u003E\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022color:#333333;\u0022\u003EI consider it KSP\u0027s way of making sure I go for drinks and snacks regularly. Dehydrated pilots don\u0027t fly well \u003C/span\u003E\u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"}]}