{"TopicId":43707,"ForumId":34,"TopicTitle":"kOS Scriptable Autopilot System 0.9","CreatedByName":"KevinLaity","CreatedById":68050,"CreatedDateTime":"2013-08-24T14:28:17Z","PageNum":40,"Articles":[{"CreatedByName":"Payload","CreatedById":4540,"CreatedDateTime":"2013-09-18T16:00:06Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Steven Mading\u0022 data-cite=\u0022Steven Mading\u0022\u003E\u003Cdiv\u003EThis does: \u003Cp\u003E// For prograde. The system insists on only\u003C/p\u003E\u003Cp\u003E// understanding steering by R()\u0027s and not by V()\u0027s.\u003C/p\u003E\u003Cp\u003E// So you turn a V() into an R() by just multiplying\u003C/p\u003E\u003Cp\u003E// it by the no-rotation rotation operator R(0,0,0)\u003C/p\u003E\u003Cp\u003E// to force the system to cast it to an R().\u003C/p\u003E\u003Cp\u003Eset mySteer to R(0,0,0) * velocity:surface.\u003C/p\u003E\u003Cp\u003Elock steering to mySteer.\u003C/p\u003E\u003Cp\u003E//for retrograde, multiply vector by -1 :\u003C/p\u003E\u003Cp\u003Eset vs to velocity:surface.\u003C/p\u003E\u003Cp\u003Eset vsx to 0 - vs:x.\u003C/p\u003E\u003Cp\u003Eset vsy to 0 - vs:y.\u003C/p\u003E\u003Cp\u003Evst vsz to 0 - vs:z.\u003C/p\u003E\u003Cp\u003Eset mySteer to R(0,0,0) * V(vsx, vsy, vsz).\u003C/p\u003E\u003Cp\u003Elock steering to mySteer.\u003C/p\u003E\u003Cp\u003EUsing R(0,0,0) * V(x,y,z) allows me to live entirely in the sensible world of vectors and 3D space and not use Euler rotations. The only hard part is finding the zero point of the \u0022universe\u0022 when I don\u0027t have access to the positional numbers, only the velocity. I\u0027ve been asking mod makers in the development forum how the game\u0027s coordinate system is laid out and it\u0027s messy. I\u0027ve got it worked out that the zero point of the universe is the center of your SOI planetary body, and that the universe\u0027s coordinates rotate with your SOI body, but only if you\u0027re lower than N (N changes depending on body), but when you\u0027re higher up than that, then the frame of reference changes such that the universe stays put and the planet starts rotating. All of that I can get, but then it turns out that for whatever strange reason SQUAD decided to make the axes of the system NOT extend through the prime meridian but at some oddball canted angle at about 100 degrees longitude or so... no idea why or how to query for \u0022where is the x axis on this planet?\u0022.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EExcellent, that is why I have been using V() as it is. I noticed that you can use R(180,0,0) \u002B velocity:surface to get the correct heading but I haven\u0027t been able to get pitch out of it. It seems now you cant use pure V() unless you have something that is rotation based first.\u003C/p\u003E\u003Cp\u003EI also wont let me add more than one vector and velocity surface is expressed as a vector.\u003C/p\u003E\u003Cp\u003EI think those are current issues that Kevin was talking about in his blog. However, if you are getting prograde by multiplying the vector to an empty R() set, do you think it is possible one could get retrograde by multiplying by R(180,0,0)?\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-09-18T16:04:18Z\u0022 title=\u002209/18/2013 04:04  PM\u0022 data-short=\u002210 yr\u0022\u003ESeptember 18, 2013\u003C/time\u003E by Payload\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"czokletmuss","CreatedById":28063,"CreatedDateTime":"2013-09-18T16:40:28Z","Content":"\n\u003Cp\u003EOkay, thanks for info! \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2013-09-24T00:55:32Z","Content":"\n\u003Cp\u003EI did this during the days the forum was down (and posted it right before the hack, so it got reverted. Here it is again:)\u003C/p\u003E\u003Cp\u003EThis should be handy to anyone who\u0027s been trying to work out various landing autopilots.\u003C/p\u003E\u003Cp\u003EThe vectors for velocity:orbit and velocity:surface are given in terms of the XYZ grid system that KSP uses natively behind the scenes.\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022text-decoration:underline;\u0022\u003EThe problem:\u003C/span\u003E\u003C/p\u003E\u003Cp\u003EBut users of KOSscript can\u0027t do much with that information other than use it precisely as-is, because we can\u0027t \u0022see\u0022 that XYZ system. We can\u0027t get the positions of things in those coordinates. We don\u0027t know where our own ship\u0027s position is in that system. If we want to LOCK STEERING TO *exactly* surface prograde or retrograde its fine, but if we want to do something like \u0022LOCK STEERING TO SOMETHING A LITTLE BIT WESTWARD OF RETROGRADE\u0022 there isn\u0027t a way to do that because we don\u0027t actually know which way is east, west, north, or south in the XYZ system. And we can\u0027t derive it either (or so I thought) because we can\u0027t see our own position. (For example, lets say you know you are going in V(50,0,50). You know that\u0027s going at a 45 degree angle from the grid lines, in the positive direction of the X axis and Z axis, but is that toward the planet? Away from it? Tangental to it? Dunno without the position information. If we assume the coordinate grid has an origin at the planet\u0027s center (it does but I only know that from asking other modders -KOS doesn\u0027t tell you that), then if my position was at X=100000 and Z=100000 then I\u0027d know that a velocity of V(50,0,50) is straight up. But if my position is X= -100000 and Z = 100000 then the same velocity is due west.)\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022text-decoration:underline;\u0022\u003EThe solution\u003C/span\u003E\u003C/p\u003E\u003Cp\u003EBut from experimentation I worked out that there is ONE way to figure it out. By reading what the angle of Up:yaw is, you can find out exactly how far around the planetary circle in the XZ plane you are from its zero point (its X axis intercept). Once you\u0027ve got that you can work out the rest of it.\u003C/p\u003E\u003Cp\u003ESo I made a small program file that if you pass in the XYZ coordinates of a vector, it will calculate for you the same vector in terms of a surface-relative frame of reference grid, using the three axes of East, North, and Up.\u003C/p\u003E\u003Cp\u003E(negative east is west, negative north is south, and negative up is down, obviously).\u003C/p\u003E\u003Cp\u003EBeware that this information is only correct at the instant it\u0027s derived. The further the craft moves from where it was at the moment you called the program, the more incorrect the data becomes, because East.North,Up is a polar coordinate system but your movement is linear.\u003C/p\u003E\u003Cp\u003EThe page has a lot of explanatory text but you can skip past it and just go to the bottom if you just want to snag the code:\u003C/p\u003E\u003Cp\u003EThe page is here: \u003Ca href=\u0022http://kos.wikia.com/wiki/Tutorial_-_KOS_0.65_and_above:_Finding_surface_dynamic_information\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://kos.wikia.com/wiki/Tutorial_-_KOS_0.65_and_above:_Finding_surface_dynamic_information\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EThis program uses the new parameter passing of 0.65. You will need version 0.65 before it will run.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-09-24T01:01:35Z\u0022 title=\u002209/24/2013 01:01  AM\u0022 data-short=\u002210 yr\u0022\u003ESeptember 24, 2013\u003C/time\u003E by Steven Mading\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2013-09-24T01:07:22Z","Content":"\n\u003Cp\u003E((In the fourm reboot my previous post seems to have been posted twice for some reason. Clobbering the repeat.))\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-09-24T01:26:11Z\u0022 title=\u002209/24/2013 01:26  AM\u0022 data-short=\u002210 yr\u0022\u003ESeptember 24, 2013\u003C/time\u003E by Steven Mading\u003C/strong\u003E\n\u003Cbr\u003EDuplicate of my prevoious post\n\u003C/span\u003E\n"},{"CreatedByName":"Sma","CreatedById":67377,"CreatedDateTime":"2013-09-24T01:15:12Z","Content":"\n\u003Cp\u003EI guess my reply didn\u0027t make it through the \u0022troubles\u0022...\u003C/p\u003E\u003Cp\u003ESoo how about that 0.65 update? I rewrote the launch program so now I can include the number of boosters (for asparagus staging) and desired orbital altitude. Not exactly the same as asking for the input when the program runs, but it works rather well. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EOn a different note, before the 0.65 update I could use filenames like \u0022orbit2.9\u0022. Now with .65 that gives a syntax error so I had to change the file names to be like \u0022orbit2-9\u0022 Not a big deal though, easy enough to do. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2013-09-24T01:32:11Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Sma\u0022 data-cite=\u0022Sma\u0022\u003E\u003Cdiv\u003EI guess my reply didn\u0027t make it through the \u0022troubles\u0022...\u003Cp\u003ESoo how about that 0.65 update? I rewrote the launch program so now I can include the number of boosters (for asparagus staging) and desired orbital altitude. Not exactly the same as asking for the input when the program runs, but it works rather well. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI had three different landing scripts called \u0022lander\u0022, \u0022hover\u0022, and \u0022skycrane\u0022 that I\u0027ve now merged together into one that just takes a parameter. Now I just call:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Erun descend(\u0022skycrane\u0022,0.2).\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EFor example. Since they all do the same thing up until the last moment. (The 0.2 is a slope parameter. The lander will attempt to wait until it sees that the terrain beneath it has a sope of 0.2 or less before descending all the way to drop the payload. It avoids dropping the payload on a hill slope.)\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003EOn a different note, before the 0.65 update I could use filenames like \u0022orbit2.9\u0022. Now with .65 that gives a syntax error so I had to change the file names to be like \u0022orbit2-9\u0022 Not a big deal though, easy enough to do. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EOh so dashes are allowed now? Good. I\u0027ve been trying to find a good word-separator in program names. I tried camel-casing it but that seems to cause trouble if I use mixed case in the program names.\u003C/p\u003E\n"},{"CreatedByName":"check","CreatedById":71875,"CreatedDateTime":"2013-09-24T02:14:47Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Steven Mading\u0022 data-cite=\u0022Steven Mading\u0022\u003E\u003Cdiv\u003E The 0.2 is a slope parameter. The lander will attempt to wait until it sees that the terrain beneath it has a sope of 0.2 or less before descending all the way to drop the payload. It avoids dropping the payload on a hill slope.)\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EOoo! How does it do that? Can I see the code?\u003C/p\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2013-09-24T03:01:50Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022check\u0022 data-cite=\u0022check\u0022\u003E\u003Cdiv\u003EOoo! How does it do that? Can I see the code?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EIt performs the following logic.\u003C/p\u003E\u003Cp\u003EYou can calculate the height above sea level of the terrain directly under the lander (assuming you\u0027re close enough to the ground for alt:radar to work right) like so:\u003C/p\u003E\u003Cp\u003ETerrain height = altitude - alt:radar.\u003C/p\u003E\u003Cp\u003EIf you remember the previous terrain height from the last time through the main loop, and compare it to the current terrain height, you have delta height. If you record the previous timestamp so you also know how long it took between iterations, you can get the horizontal distance traveled between those two samples as deltaTime * surfacespeed.\u003C/p\u003E\u003Cp\u003ESo the slope is deltaHeight / deltaHorizontalDist: Or in other words:\u003C/p\u003E\u003Cp\u003Ecur slope = (current terrain height - prev terrain height) / ( (curTime - prevTime)*surfacespeed ) \u003C/p\u003E\u003Cp\u003ESo as long as abs(cur slope) is too big, I don\u0027t entirely allow it to kill horizontal speed. I allow it to continue moving at 10 m/s sideways until it finds terrain with shallower slope and then I begin the last few meters of descent.\u003C/p\u003E\u003Cp\u003EI intend to post the code for it but not until I work out a few more bugs and land with it a few more times. I\u0027m certain in its current state its still a bit wrong.\u003C/p\u003E\n"},{"CreatedByName":"Sma","CreatedById":67377,"CreatedDateTime":"2013-09-24T03:54:52Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Steven Mading\u0022 data-cite=\u0022Steven Mading\u0022\u003E\u003Cdiv\u003EI had three different landing scripts called \u0022lander\u0022, \u0022hover\u0022, and \u0022skycrane\u0022 that I\u0027ve now merged together into one that just takes a parameter. Now I just call:\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Erun descend(\u0022skycrane\u0022,0.2).\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EFor example. Since they all do the same thing up until the last moment. (The 0.2 is a slope parameter. The lander will attempt to wait until it sees that the terrain beneath it has a sope of 0.2 or less before descending all the way to drop the payload. It avoids dropping the payload on a hill slope.)\u003C/p\u003E\u003Cp\u003EOh so dashes are allowed now? Good. I\u0027ve been trying to find a good word-separator in program names. I tried camel-casing it but that seems to cause trouble if I use mixed case in the program names.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EIt let me load/run it with a dash, think it did in 0.6 as well. Before that I was using underscore, because....well I\u0027m use to not using \u0022full stop\u0022 unless its to separate file name from extension. How ever I wanted to have different files as I made changes...you know just in case i totally mess something up lol. I finally decided to see how it handles using full stop in the name and it was fine, until now of course. \u003C/p\u003E\u003Cp\u003ENice work on detecting the slope, it\u0027s one I sort of understand actually...almost anyway. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E For now I think I\u0027m going to stick to perfecting my ascent and circulation and a \u0022kerbosync\u0022 program as well as one that can do automatic release of multi (at least 3) comm sats in kerbosync orbit. I\u0027m likely going to set the AP of my delivery craft to the kerbosync altitude, and adjust my PE to get the 1/3 phase orbit. Currently I\u0027m not too worried about if its directly over KSC, so long as its close enough to make a connection.\u003C/p\u003E\u003Cp\u003EOh, and now with the processing speed increased, my program is much more accurate, though needs some adjustments still I think. Changing the throttle to try and maintain 200m/s works a lot better now too. Can\u0027t wait to see what the next version will bring! \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Motokid600","CreatedById":66349,"CreatedDateTime":"2013-09-24T04:06:01Z","Content":"\n\u003Cp\u003EFew inquiries..\u003C/p\u003E\u003Cp\u003Ethis is the last segment of my code.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Ewait until apoapsis \u0026gt; 71500.\u003Cbr\u003Elock throttle to 0.\u003Cbr\u003Elock steering to prograde.\u003Cbr\u003Eprint \u0022MECO.\u0022\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003ECan someone tell me why the program is ending after MECO? The steering will not lock to prograde and the rocket tumbles wildly if I don\u0027t quickly set ASAS.\u003C/p\u003E\u003Cp\u003EWhich brings me to my next question. Is it possible to simply lock a crafts steering to a maneuver node? Nothing more.. After meco ill make the node then run it as a separate program. \u003C/p\u003E\u003Cp\u003EAnd finally the one that troubles me most. The shaking. Now this particular craft is rigid all the way up supported by an SRB so it shakes/oscillates from side to side instead of a wobble. I can see the gimbals working way to hard... almost as if kOS\u0027s \u0022built in asas\u0022 is pre .21. And the interesting thing is if I manually enable asas the shaking goes away and the rocket becomes as steady as can be. But kOS apparently cannot operate with it enabled.\u003C/p\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2013-09-24T04:08:19Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Sma\u0022 data-cite=\u0022Sma\u0022\u003E\u003Cdiv\u003EIt let me load/run it with a dash, think it did in 0.6 as well. Before that I was using underscore, because....well I\u0027m use to not using \u0022full stop\u0022 unless its to separate file name from extension. How ever I wanted to have different files as I made changes...you know just in case i totally mess something up lol. I finally decided to see how it handles using full stop in the name and it was fine, until now of course. \u003Cp\u003ENice work on detecting the slope, it\u0027s one I sort of understand actually...almost anyway. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E For now I think I\u0027m going to stick to perfecting my ascent and circulation and a \u0022kerbosync\u0022 program as well as one that can do automatic release of multi (at least 3) comm sats in kerbosync orbit. I\u0027m likely going to set the AP of my delivery craft to the kerbosync altitude, and adjust my PE to get the 1/3 phase orbit. Currently I\u0027m not too worried about if its directly over KSC, so long as its close enough to make a connection.\u003C/p\u003E\u003Cp\u003EOh, and now with the processing speed increased, my program is much more accurate, though needs some adjustments still I think. Changing the throttle to try and maintain 200m/s works a lot better now too. Can\u0027t wait to see what the next version will bring! \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EMy next project I\u0027ve set for myself is to make a little library routine to detect the current lat/long where on the surface the trajectory is predicting to hit the ground. It can\u0027t be as accurate as the blue line in the game because the blue line is done knowing the terrain of the planet surface, and I don\u0027t have that information so I\u0027ll just make an approximate guess that the height is probably about half the max height of the planet terrain (from the KSP wiki). But the idea is that this is a requirement if I want to try to make something land near a chosen target. I first have to be able to at least predict where freefall is taking it now\u003C/p\u003E\u003Cp\u003EIt all hinges on pulling out my old rusty math skills and finding the intercept point between an ellipse (your orbit) and a sphere (the planet surface) *, and working out how to get the parameters of those equations given what information is in KOS. The altitude of apoapsis and periapsis plus the planet\u0027s diameter give me the length of the major axis of the ellipse, and I know that Kepler\u0027s laws of motion say that one of the foci of the ellipse has to be the planet center (the focus closer to the periopsis side will be), which conveniently is the origin in the XYZ grid, and the difference between apiopsis and periopsis should be able to tell me how far apart the foci of the ellipse are, and the current altitude (from core so \u002B body radius) and current Up direction should get me the datapoint that I am currently on in the ellipse, so it seems to me the data to do it should all be there.. I just have to do some scratch-paper work to get it to come out.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-09-24T04:12:56Z\u0022 title=\u002209/24/2013 04:12  AM\u0022 data-short=\u002210 yr\u0022\u003ESeptember 24, 2013\u003C/time\u003E by Steven Mading\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"check","CreatedById":71875,"CreatedDateTime":"2013-09-24T04:13:00Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Steven Mading\u0022 data-cite=\u0022Steven Mading\u0022\u003E\u003Cdiv\u003EIt performs the following logic.\u003Cp\u003EYou can calculate the height above sea level of the terrain directly under the lander (assuming you\u0027re close enough to the ground for alt:radar to work right) like so:\u003C/p\u003E\u003Cp\u003ETerrain height = altitude - alt:radar.\u003C/p\u003E\u003Cp\u003EIf you remember the previous terrain height from the last time through the main loop, and compare it to the current terrain height, you have delta height. If you record the previous timestamp so you also know how long it took between iterations, you can get the horizontal distance traveled between those two samples as deltaTime * surfacespeed.\u003C/p\u003E\u003Cp\u003ESo the slope is deltaHeight / deltaHorizontalDist: Or in other words:\u003C/p\u003E\u003Cp\u003Ecur slope = (current terrain height - prev terrain height) / ( (curTime - prevTime)*surfacespeed ) \u003C/p\u003E\u003Cp\u003ESo as long as abs(cur slope) is too big, I don\u0027t entirely allow it to kill horizontal speed. I allow it to continue moving at 10 m/s sideways until it finds terrain with shallower slope and then I begin the last few meters of descent.\u003C/p\u003E\u003Cp\u003EI intend to post the code for it but not until I work out a few more bugs and land with it a few more times. I\u0027m certain in its current state its still a bit wrong.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EOh okay. I knew you could get a slope doing that, but it only gives you the slope in the direction of your horizontal velocity. I thought maybe you had figured out some otherway to get your absolute slope. Good job nonetheless.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003E But the idea is that this is a requirement if I want to try to make something land near a chosen target. I first have to be able to at least predict where freefall is taking it now\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThat\u0027s exactly what I\u0027m working on now. Land anywhere so long as your target latitude is within your orbital inclination. But the damn inverse trig is broken, so I\u0027ve hit a roadblock for now.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-09-24T04:15:19Z\u0022 title=\u002209/24/2013 04:15  AM\u0022 data-short=\u002210 yr\u0022\u003ESeptember 24, 2013\u003C/time\u003E by check\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Sma","CreatedById":67377,"CreatedDateTime":"2013-09-24T04:16:07Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Motokid600\u0022 data-cite=\u0022Motokid600\u0022\u003E\u003Cdiv\u003EFew inquiries..\u003Cp\u003Ethis is the last segment of my code.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Ewait until apoapsis \u0026gt; 71500.\u003Cbr\u003Elock throttle to 0.\u003Cbr\u003Elock steering to prograde.\u003Cbr\u003Eprint \u0022MECO.\u0022\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003ECan someone tell me why the program is ending after MECO? The steering will not lock to prograde and the rocket tumbles wildly if I don\u0027t quickly set ASAS.\u003C/p\u003E\u003Cp\u003EWhich brings me to my next question. Is it possible to simply lock a crafts steering to a maneuver node? Nothing more.. After meco ill make the node then run it as a separate program. \u003C/p\u003E\u003Cp\u003EAnd finally the one that troubles me most. The shaking. Now this particular craft is rigid all the way up supported by an SRB so it shakes/oscillates from side to side instead of a wobble. I can see the gimbals working way to hard... almost as if kOS\u0027s \u0022built in asas\u0022 is pre .21. And the interesting thing is if I manually enable asas the shaking goes away and the rocket becomes as steady as can be. But kOS apparently cannot operate with it enabled.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EWell, first off in your code, you\u0027re missing the full stop at the end, after the quote, but aside from that my program has been clearing the screen and printing \u0022program ended\u0022. I can see what I wanted it to say for a second, but then quickly clears the screen like I said. Didn\u0027t notice if it does that with 0.65 but I think it still does.\u003C/p\u003E\u003Cp\u003EAs for the shaking, I\u0027m pretty sure you can disable gimbal on the boosters. If you\u0027re craft is small enough/light enough SAS may be enough to keep it stable. Also if you don\u0027t have fins on it you could try that, maybe even static fins with no control surfaces, that way they sort of act like a keel on a boat or skegs i think they\u0027re called on surf boards.\u003C/p\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2013-09-24T04:19:39Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Motokid600\u0022 data-cite=\u0022Motokid600\u0022\u003E\u003Cdiv\u003EFew inquiries..\u003Cp\u003Ethis is the last segment of my code.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Ewait until apoapsis \u0026gt; 71500.\u003Cbr\u003Elock throttle to 0.\u003Cbr\u003Elock steering to prograde.\u003Cbr\u003Eprint \u0022MECO.\u0022\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003ECan someone tell me why the program is ending after MECO? \u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EWell.. you *did* describe that as being the last segment of your code. Is there anything that comes after it that you were expecting to execute that you didn\u0027t show us? Otherwise ending after the last statement seems perfectly normal to me.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003E\u003Cp\u003EThe steering will not lock to prograde and the rocket tumbles wildly if I don\u0027t quickly set ASAS.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThe program \u0022lets go\u0022 of the steering after it ends and you return to interactive mode. This is deliberate so you can have manual control back after the program is done. If the MECO line is the last line and it is ending there, then what happened is that it tried to steer toward prograde for just a moment and then stopped trying when the program ended.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003E\u003Cp\u003EWhich brings me to my next question. Is it possible to simply lock a crafts steering to a maneuver node? Nothing more.. After meco ill make the node then run it as a separate program. \u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ESupposedly you can:\u003C/p\u003E\u003Cp\u003E LOCK STEERING TO NODE.\u003C/p\u003E\u003Cp\u003EBut I haven\u0027t tried it to see if it works. And again, if your program ends it will stop trying to control the steering.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003E\u003Cp\u003EAnd finally the one that troubles me most. The shaking. Now this particular craft is rigid all the way up supported by an SRB so it shakes/oscillates from side to side instead of a wobble. I can see the gimbals working way to hard... almost as if kOS\u0027s \u0022built in asas\u0022 is pre .21. And the interesting thing is if I manually enable asas the shaking goes away and the rocket becomes as steady as can be. But kOS apparently cannot operate with it enabled.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThat\u0027s going to require information on the craft to diagnose.\u003C/p\u003E\n"},{"CreatedByName":"Sma","CreatedById":67377,"CreatedDateTime":"2013-09-24T04:33:10Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Steven Mading\u0022 data-cite=\u0022Steven Mading\u0022\u003E\u003Cdiv\u003EThe program \u0022lets go\u0022 of the steering after it ends and you return to interactive mode. This is deliberate so you can have manual control back after the program is done. If the MECO line is the last line and it is ending there, then what happened is that it tried to steer toward prograde for just a moment and then stopped trying when the program ended.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EIn one of the versions(dont remember which), at least for me, it seemed that if steering or location was locked and the program ended it would still be locked. At the end of my program I have it lock steering to prograde, fire off action group 1 (solar panels, dish/antenna etc) and wait a few seconds, then unlock all, just to be sure. Maybe the steering/throttle being locked after the program ended was a bug or something, and just in that one version.\u003C/p\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2013-09-24T04:36:09Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022check\u0022 data-cite=\u0022check\u0022\u003E\u003Cdiv\u003EOh okay. I knew you could get a slope doing that, but it only gives you the slope in the direction of your horizontal velocity. I thought maybe you had figured out some otherway to get your absolute slope. Good job nonetheless.\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYeah that is definitely a big problem. The craft can only \u0022see\u0022 the height where it is at the moment so to get a proper slope would require hovering and \u0022surveying\u0022 the terrain in several directions, which gets really messy and a good skycrane shouldn\u0027t have that much fuel to be puttering around like that. I tried having it veer a bit left and right and take samples that way to guess whether it can seek better ground to the left or to the right, but that was getting very messy and wasn\u0027t working well so I took it back out. I figure a better solution is working on the \u0022land at position lat,long\u0022 algorithm and say that the people designing the probe\u0027s mission surveyed a good landing spot for the craft ahead of time.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003E\u003Cp\u003EThat\u0027s exactly what I\u0027m working on now. Land anywhere so long as your target latitude is within your orbital inclination. But the damn inverse trig is broken, so I\u0027ve hit a roadblock for now.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI\u0027m going to work out the math for how to do it in polar coordinates because I suspect it will make some of the messy terms go away and also perhaps remove some of the trig until the end when converting back out to XYZ.\u003C/p\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2013-09-24T04:39:15Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Sma\u0022 data-cite=\u0022Sma\u0022\u003E\u003Cdiv\u003EIn one of the versions(dont remember which), at least for me, it seemed that if steering or location was locked and the program ended it would still be locked. At the end of my program I have it lock steering to prograde, fire off action group 1 (solar panels, dish/antenna etc) and wait a few seconds, then unlock all, just to be sure. Maybe the steering/throttle being locked after the program ended was a bug or something, and just in that one version.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EMaybe it\u0027s different when the program crashes with error than when it ends nicely. As you noted there was a missing period at the end. I could see it making sense to say that when there\u0027s an error that aborts the program things need to return to manual control right away just in case there\u0027s an emergency coming up and the user didn\u0027t expect the program to kick out at this point.\u003C/p\u003E\n"},{"CreatedByName":"Motokid600","CreatedById":66349,"CreatedDateTime":"2013-09-24T05:06:47Z","Content":"\n\u003Cp\u003ETy Sma and Steven. No there is no more after MECO. How is it I can get the program to continue running? Id just get rid of the MECO line, but something tells me that won\u0027t do it. Because I have tried a seperate, small script.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Eclearscreen.\u003Cbr\u003ELock steering to node.\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EAnd it did the same thing. It blurps the controls for a second then the program ends. \u003C/p\u003E\u003Cp\u003EAs for the shaking. The craft is great I don\u0027t think that\u0027s the issue. When under manual control there is no oscillations. But with kOS at the wheel its all over the place. Not crippling, but unsettling.\u003C/p\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2013-09-24T05:39:41Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Motokid600\u0022 data-cite=\u0022Motokid600\u0022\u003E\u003Cdiv\u003ETy Sma and Steven. No there is no more after MECO. How is it I can get the program to continue running? Id just get rid of the MECO line, but something tells me that won\u0027t do it. Because I have tried a seperate, small script.\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYou could put a do-nothing loop at the end to keep the program running:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E until 0 { wait 1. }.\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003ETo wait 1 second, then wait 1 second again, then wait 1 second again.. etc. When you want control back you\u0027ll have to bring up the terminal window and \u0022CONTROL-C\u0022 inside it. Obviously if you have something more sophisticated to check for to trigger the end use that instead.\u003C/p\u003E\u003Cp\u003EYou can\u0027t make a null loop body in KOSscript syntax so *something* has to go in there. It may as well be a wait statement. Besides, I can\u0027t shake the old UNIX programmer habit of considering all busy-loops with no blocking statements in them to be Very Bad Practice, even though in KOSscript you\u0027re not multitasking the SCS CPU with anything else so it doesn\u0027t matter. I just can\u0027t bring myself to do it , thus the wait statement in there.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003E\u003Cp\u003EAs for the shaking. The craft is great I don\u0027t think that\u0027s the issue. When under manual control there is no oscillations. But with kOS at the wheel its all over the place. Not crippling, but unsettling.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI haven\u0027t experienced this. Sorry I don\u0027t know what\u0027s happening.\u003C/p\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2013-09-24T05:43:28Z","Content":"\n\u003Cp\u003EHas anyone gotten wheelsteering to do anything? It seems to have no effect right now. I tried \u0022lock steering to 90 by 0\u0022 to get a rover to drive on a heading of 90, but all it does is just drive in circles when I do that.\u003C/p\u003E\n"},{"CreatedByName":"MorroW","CreatedById":76847,"CreatedDateTime":"2013-09-24T06:02:06Z","Content":"\n\u003Cp\u003E\u0022Lock \u003Cstrong\u003Ewheel\u003C/strong\u003Esteering\u0022?\u003C/p\u003E\n"},{"CreatedByName":"Arno Nyhm","CreatedById":80113,"CreatedDateTime":"2013-09-24T06:13:56Z","Content":"\n\u003Cp\u003E\u003Cspan style=\u0022color:#FF0000;\u0022\u003EIntentionally deleted. It was a double.\u003C/span\u003E\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022color:#FF0000;\u0022\u003ESorry, folks!\u003C/span\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-09-24T11:40:56Z\u0022 title=\u002209/24/2013 11:40  AM\u0022 data-short=\u002210 yr\u0022\u003ESeptember 24, 2013\u003C/time\u003E by Arno Nyhm\u003C/strong\u003E\n\u003Cbr\u003EDoublepost removed. @mods: should be deleted. Thanks in advance!\n\u003C/span\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2013-09-24T06:29:22Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022MorroW\u0022 data-cite=\u0022MorroW\u0022\u003E\u003Cdiv\u003E\u0022Lock \u003Cstrong\u003Ewheel\u003C/strong\u003Esteering\u0022?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThat\u0027s the thing I described as having no effect at all.\u003C/p\u003E\u003Cp\u003EI described two different things I\u0027d tried, although I admit I didn\u0027t say it very clearly.\u003C/p\u003E\u003Cp\u003ELet me try describing it again:\u003C/p\u003E\u003Cp\u003EThing 1 I tried: lock wheelsteering.\u003C/p\u003E\u003Cp\u003EWhat happened: Nothing at all. Drove in straight line on existing heading, ignoring the setting.\u003C/p\u003E\u003Cp\u003EThing 2 I tried: lock steering.\u003C/p\u003E\u003Cp\u003EWhat happened: Turned to heading but then kept on turning. Was not just a case of oversteering because it didn\u0027t turn back again. It just kept going in a circle.\u003C/p\u003E\n"},{"CreatedByName":"drtedastro","CreatedById":70911,"CreatedDateTime":"2013-09-24T06:46:43Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Steven Mading\u0022 data-cite=\u0022Steven Mading\u0022\u003E\u003Cdiv\u003EYeah that is definitely a big problem. The craft can only \u0022see\u0022 the height where it is at the moment so to get a proper slope would require hovering and \u0022surveying\u0022 the terrain in several directions, which gets really messy and a good skycrane shouldn\u0027t have that much fuel to be puttering around like that. I tried having it veer a bit left and right and take samples that way to guess whether it can seek better ground to the left or to the right, but that was getting very messy and wasn\u0027t working well so I took it back out. I figure a better solution is working on the \u0022land at position lat,long\u0022 algorithm and say that the people designing the probe\u0027s mission surveyed a good landing spot for the craft ahead of time.\u003Cp\u003EI\u0027m going to work out the math for how to do it in polar coordinates because I suspect it will make some of the messy terms go away and also perhaps remove some of the trig until the end when converting back out to XYZ.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ETake the data that you have gathered from your ISAMAP Sat survey. The whole idea of the pre-survey mapping is to have the body or at a minimum your landing site properly mapped. Then as you are making your approach, you can use the raw map data as a lookup. \u003C/p\u003E\u003Cp\u003EWell, that\u0027s what i am doing.... I use the data from the mapsat surveys to check and plan for landing site survey, slope verification, and terrain avoidance (on Minmus it is required when coming in low and hot..) Found too many mountains that were just a little bit higher than i thought....\u003C/p\u003E\u003Cp\u003ECheers.\u003C/p\u003E\n"},{"CreatedByName":"Arno Nyhm","CreatedById":80113,"CreatedDateTime":"2013-09-24T06:53:18Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Steven Mading\u0022 data-cite=\u0022Steven Mading\u0022\u003E\u003Cdiv\u003EYou can\u0027t make a null loop body in KOSscript syntax so *something* has to go in there. It may as well be a wait statement. Besides, I can\u0027t shake the old UNIX programmer habit of considering all busy-loops with no blocking statements in them to be Very Bad Practice, even though in KOSscript you\u0027re not multitasking the SCS CPU with anything else so it doesn\u0027t matter.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EWould you considder it a practical approach to use the state of an empty actiongroup as a blocking statement? Just wait for it to be fired and then exit that loop.\u003C/p\u003E\n"}]}