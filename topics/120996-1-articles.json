{"TopicId":120996,"ForumId":29,"TopicTitle":"NRE in ScenarioRunner.MoveNext","CreatedByName":"Ippo","CreatedById":107018,"CreatedDateTime":"2015-09-16T06:37:53Z","PageNum":1,"Articles":[{"CreatedByName":"Ippo","CreatedById":107018,"CreatedDateTime":"2015-09-16T06:37:53Z","Content":"\n\u003Cp\u003EHi guys, I\u0027m seeing a strange issue.\u003C/p\u003E\u003Cp\u003EI have this simple \u003Ca href=\u0022https://github.com/Ippo343/ScienceFunding/blob/master/ScienceFunding/ScienceFunding.cs\u0022 rel=\u0022external nofollow\u0022\u003EScenarioModule\u003C/a\u003E.\u003C/p\u003E\u003Cp\u003EIt throws a NRE immediately after Awake() finishes: using darklight\u0027s ExceptionDetector, I see that the exception is thrown in ScenarioRunner.MoveNext, but I have no idea what I\u0027m doing wrong... has anybody seen something like this?\u003C/p\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2015-09-16T07:42:24Z","Content":"\n\u003Cp\u003EIs there any more of the stack trace to go on? You usually see this kind of exception when something bad has happened in ScenarioModule.OnLoad and it\u0027s doubly-bad because any ScenarioModule that comes after yours won\u0027t be loaded.\u003C/p\u003E\u003Cp\u003EAt a guess and with no other info, I\u0027d say the ConfigNode you tried to load in ScienceFunding.GetConfig doesn\u0027t exist or doesn\u0027t have a node called SCIENCE_FUNDING_SETTINGS -- you try to use it immediately after loading it without checking that the file exists and without checking that it was loaded or has such a node, and it\u0027s out of your general try...catch so a NRE in there will unwind back to the caller (ScenarioRunner)\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2015-09-18T00:51:46Z","Content":"\n\u003Cp\u003EYou say it is thrown after the Awake() method on your scenario module. I can\u0027t find the code where your scenario is loaded by KSP, doesn\u0027t it need a [scenario] attribute of some sort, the same way the [KSPAddon] works?\u003C/p\u003E\u003Cp\u003EThe reason I ask that is that if the .MoveNext is throwing a nullref, somethings gone wrong in the \u0022loaded scenarios\u0022 list because it can\u0027t move from your scenario to the next, and I wonder if how you are loading your scenario is generating issues.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n"},{"CreatedByName":"NathanKell","CreatedById":75006,"CreatedDateTime":"2015-09-18T02:20:17Z","Content":"\n\u003Cp\u003EI think you want to use OnAwake, not Awake...\u003C/p\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2015-09-18T03:36:45Z","Content":"\n\u003Cp\u003ENice eyes there NK, I didn\u0027t even notice \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_embarrassed.gif\u0022 alt=\u0022:blush:\u0022\u003E. Yes I think that\u0027s the most likely issue\u003C/p\u003E\n"},{"CreatedByName":"DMagic","CreatedById":57416,"CreatedDateTime":"2015-09-18T04:02:44Z","Content":"\n\u003Cp\u003EIt\u0027s not necessary to use the scenario attribute, you can add your Scenario Module to the list manually, but using the attribute is the simplest way.\u003C/p\u003E\u003Cp\u003EAnd even if using OnAwake fixes the problem you should still make sure that absolutely any exceptions in the loading process be handled. Blowing up the Scenario Module loading process is about the worst thing a mod can do since it cascades down to all subsequent Scenario Modules.\u003C/p\u003E\n"},{"CreatedByName":"nightingale","CreatedById":119307,"CreatedDateTime":"2015-09-18T05:00:15Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022DMagic\u0022 data-cite=\u0022DMagic\u0022\u003E\u003Cdiv\u003EIt\u0027s not necessary to use the scenario attribute, you can add your Scenario Module to the list manually, but using the attribute is the simplest way.\u003Cp\u003EAnd even if using OnAwake fixes the problem you should still make sure that absolutely any exceptions in the loading process be handled. Blowing up the Scenario Module loading process is about the worst thing a mod can do since it cascades down to all subsequent Scenario Modules.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EAgree 100% - having try/catch blocks in the OnSave, OnLoad (and anywhere else that gets invoked from Squad code) in the ScenarioModules, contracts (and anywhere else where mod code can get loaded) is pretty much essential to not stomp on each other stuff when things go wrong.\u003C/p\u003E\u003Cp\u003EOr perhaps it\u0027s time we get our resident Squad assistant (contractor? collaborator? I\u0027m not really sure the right term) to push in a change to get the exception handling logic put in the places that can potentially call into mod code (particularly from a loop) so that mods can\u0027t inadvertently cause havok. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif\u0022 alt=\u0022;)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"magico13","CreatedById":73338,"CreatedDateTime":"2015-09-18T14:33:22Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022nightingale\u0022 data-cite=\u0022nightingale\u0022\u003E\u003Cdiv\u003E\u003Cp\u003EOr perhaps it\u0027s time we get our resident Squad assistant (contractor? collaborator? I\u0027m not really sure the right term) to push in a change to get the exception handling logic put in the places that can potentially call into mod code (particularly from a loop) so that mods can\u0027t inadvertently cause havok. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif\u0022 alt=\u0022;)\u0022\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThis would be wonderful! It\u0027s been bad enough that KCT now has a check for if the OnLoad process fails (due to KCT or another mod). A vast majority of the reports I get regarding that error check are from other mods encountering an issue during OnLoad which then makes KCT not get a chance to load. Occasionally they\u0027re KCT\u0027s fault, so I should probably increase my error handling to catch those. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif\u0022 alt=\u0022:P\u0022\u003E Contract Configurator used to do it pretty badly \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif\u0022 alt=\u0022;)\u0022\u003E but has since improved substantially, but it really doesn\u0027t help either that the Contracts system completely explodes if it stubs its toe (I\u0027m pretty sure the Contracts system is made of nitroglycerin).\u003C/p\u003E\u003Cp\u003EOnLoad and Contracts are the two places I\u0027d like to see better error handling in Stock. It\u0027s also on us modders to A) not make code that has errors and \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_cool.png\u0022 alt=\u0022B)\u0022\u003E have proper error handling in sensitive areas, but not having those areas be that sensitive to minor issues would be nice \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif\u0022 alt=\u0022;)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"nightingale","CreatedById":119307,"CreatedDateTime":"2015-09-18T15:39:20Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022magico13\u0022 data-cite=\u0022magico13\u0022\u003E\u003Cdiv\u003E\u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif\u0022 alt=\u0022:P\u0022\u003E Contract Configurator used to do it pretty badly \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif\u0022 alt=\u0022;)\u0022\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EOh this is so true - I was once so naive! On top of the error handling I now have that prevents other mods from getting borked, I also have pop up errors for the *really* bad stuff (in particular, anything that is potentially save breaking for the player).\u003C/p\u003E\n"},{"CreatedByName":"Ippo","CreatedById":107018,"CreatedDateTime":"2015-09-18T20:37:29Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022NathanKell\u0022 data-cite=\u0022NathanKell\u0022\u003E\u003Cdiv\u003EI think you want to use OnAwake, not Awake...\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EAh, that was it \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EOriginally it was a MonoBehaviour, so I forgot to update it to override OnAwake when I switched to a scenario.\u003C/p\u003E\u003Cp\u003EI didn\u0027t congratulate you on the promotion yet, by the way: great job Nathan! \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EThanks everyone for helping!\u003C/p\u003E\n"}]}