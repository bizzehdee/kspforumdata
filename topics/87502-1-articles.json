{"TopicId":87502,"ForumId":29,"TopicTitle":"[RESOLVED] How to Play Individual Animation Clips from an FBX Imported Animation.","CreatedByName":"Apollo13","CreatedById":74572,"CreatedDateTime":"2014-10-16T04:08:30Z","PageNum":1,"Articles":[{"CreatedByName":"Apollo13","CreatedById":74572,"CreatedDateTime":"2014-10-16T04:08:30Z","Content":"\n\u003Cp\u003EApparently, nobody at the Unity forums (including a couple Unity engine developers) knows how to do this or has never done it themselves. So, if you can answer this, you need to go work at Unity.\u003C/p\u003E\u003Cp\u003EI have a single, baked, FBX animation that I imported from Blender with 110 frames. The animation contains two separate actions: Deploy (frames 1-70) and Scan(70-110). When the user clicks the context-menu button that says Deploy, I want to play the first 70 frames of the animation. I would think this would be defined with AddClip(). However, when I display the length of the AddClip() result, it shows 1. when I attempt to play it, it does not play.\u003C/p\u003E\u003Cp\u003EHere\u0027s the code. the \u0022anim.Play(\u0022Deploy\u0022);\u0022 fails to play. However, \u0022anim.Play();\u0022 works, but that plays the entire 110 frames, of course.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E        private Animation anim;\u003Cbr\u003E        private AnimationClip clipDeploy;\u003Cbr\u003E        private AnimationClip clipScan;\u003Cbr\u003E\u003Cbr\u003E        public override void OnStart(PartModule.StartState state)\u003Cbr\u003E        {\u003Cbr\u003E            anim = part.FindModelAnimators(\u0022Scene\u0022)[0];\u003Cbr\u003E            clipDeploy = new AnimationClip();\u003Cbr\u003E            anim.AddClip(clipDeploy, \u0022Deploy\u0022, 0, 70);\u003Cbr\u003E            clipScan = new AnimationClip();\u003Cbr\u003E            anim.AddClip(clipScan, \u0022Scan\u0022, 70, 109);\u003Cbr\u003E            Debug.Log(\u0022clipDeploy=\u0022 \u002B clipDeploy.length);\u003Cbr\u003E            Debug.Log(\u0022clipScan=\u0022 \u002B clipScan.length);\u003Cbr\u003E            base.OnStart(state);\u003Cbr\u003E        }\u003Cbr\u003E\u003Cbr\u003E//toggles deployment\u003Cbr\u003E        [KSPEvent(active = true, guiActive = true, guiActiveEditor = true, guiName = \u0022Deploy\u0022)]\u003Cbr\u003E        public void ToggleDeploy()\u003Cbr\u003E        {\u003Cbr\u003E            Deploy(!isDeployed);\u003Cbr\u003E        }\u003Cbr\u003E\u003Cbr\u003E        private void Deploy(bool status)\u003Cbr\u003E        {\u003Cbr\u003E            isDeployed = status;\u003Cbr\u003E\u003Cbr\u003E            if(isDeployed)  // deploy\u003Cbr\u003E            {\u003Cbr\u003E                anim[\u0022Scene\u0022].speed = 1f;\u003Cbr\u003E                anim[\u0022Scene\u0022].normalizedTime = 0f;\u003Cbr\u003E            }\u003Cbr\u003E            else  // retract\u003Cbr\u003E            {\u003Cbr\u003E                anim[\u0022Scene\u0022].speed = -1f;\u003Cbr\u003E                anim[\u0022Scene\u0022].normalizedTime = 1f;\u003Cbr\u003E            }\u003Cbr\u003E            anim.Play(\u0022Deploy\u0022);\u003Cbr\u003E            Events[\u0022ToggleScan\u0022].active = isDeployed;\u003Cbr\u003E            Events[\u0022ToggleScan\u0022].guiActive = isDeployed; \u003Cbr\u003E            Events[\u0022ToggleDeploy\u0022].guiName = (isDeployed ? \u0022Retract\u0022 : \u0022Deploy\u0022);\u003Cbr\u003E            return;\u003Cbr\u003E        }\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EWhat am I doing wrong? I\u0027ve also tried defining clips in the Unity Animations Inspector using the same names and frame numbers. No joy.\u003C/p\u003E\u003Cp\u003EDoes nobody do this? If not, how do you play individual pieces of an animation? Or, do you somehow bring multiple animations into Unity and magically select them to play? Is there a tutroial you know of? I\u0027ve googled until my fingers bled. Do you know a github piece of code you can point me to?\u003C/p\u003E\u003Cp\u003EI\u0027ve spent several days on this simple, very frustrating task. Your help is appreciated. And, if you hav a solution, please teach the developers on the Unity forum.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-10-16T23:37:09Z\u0022 title=\u002210/16/2014 11:37  PM\u0022 data-short=\u00229 yr\u0022\u003EOctober 16, 2014\u003C/time\u003E by Apollo13\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"philotical","CreatedById":109390,"CreatedDateTime":"2014-10-16T05:02:48Z","Content":"\n\u003Cp\u003Edidn\u0027t I answer this allready?\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/94011-RESOLVED-Unity-animation-Play-Problem?p=1422843\u0026amp;viewfull=1#post1422843\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://forum.kerbalspaceprogram.com/threads/94011-RESOLVED-Unity-animation-Play-Problem?p=1422843\u0026amp;viewfull=1#post1422843\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EI assume, you try to play animation from the wrong gameobject/model..\u003C/p\u003E\u003Cp\u003Eyou still need to loop through them as I said back then..\u003C/p\u003E\u003Cp\u003E(with evil\u0027s code snippet, you can find out in what go/model)\u003C/p\u003E\u003Cp\u003EThe downside is the animation state will not be as expected..\u003C/p\u003E\u003Cp\u003Eso if you run the scan-animation, the deploy will allways be at \u0022end\u0022-state =\u0026gt; deployed\u003C/p\u003E\u003Cp\u003ESome one posted a plugin last week that shall fix that issue..\u003C/p\u003E\u003Cp\u003Ebut I didn\u0027t follow up after initial post..\u003C/p\u003E\n"},{"CreatedByName":"Apollo13","CreatedById":74572,"CreatedDateTime":"2014-10-16T12:26:34Z","Content":"\n\u003Cp\u003E@philotical: Thanks. I previously tried anim.Rewind() followed by anim.Play(). But, I\u0027ll tinker with that a bit more. At this point, I\u0027LL TRY ANYTHING.\u003C/p\u003E\u003Cp\u003EEvery time the game enters a scene, does it not \u0022rewind\u0022 the animation?\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-10-16T12:51:05Z\u0022 title=\u002210/16/2014 12:51  PM\u0022 data-short=\u00229 yr\u0022\u003EOctober 16, 2014\u003C/time\u003E by Apollo13\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"philotical","CreatedById":109390,"CreatedDateTime":"2014-10-16T12:38:46Z","Content":"\n\u003Cp\u003EI have no idea..\u003C/p\u003E\u003Cp\u003EI googled for days to find the snippet I\u0027m using, it works, that\u0027s all I know... :-)\u003C/p\u003E\u003Cp\u003EUnity is much more intuitive if you don\u0027t try to understand it hahahah\u003C/p\u003E\u003Cp\u003Ebtw - PlayedQueued (or so) is the only one that worked for me..\u003C/p\u003E\n"},{"CreatedByName":"Apollo13","CreatedById":74572,"CreatedDateTime":"2014-10-16T12:50:50Z","Content":"\n\u003Cp\u003EThe revised code didn\u0027t work:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E            anim = part.FindModelAnimators(\u0022Deploy\u0022)[0];\u003Cbr\u003E            anim.Rewind();\u003Cbr\u003E            anim.Play(\u0022Deploy\u0022);\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003Enor this:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E            anim = part.FindModelAnimators(\u0022Deploy\u0022)[0];\u003Cbr\u003E            anim.Rewind();\u003Cbr\u003E            anim.PlayQueued(\u0022Deploy\u0022);\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EI use index = 0 because there is only one part on the entire vessel. In your example, you\u0027re searching for all the landing gears on a vessel.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-10-16T12:55:10Z\u0022 title=\u002210/16/2014 12:55  PM\u0022 data-short=\u00229 yr\u0022\u003EOctober 16, 2014\u003C/time\u003E by Apollo13\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"philotical","CreatedById":109390,"CreatedDateTime":"2014-10-16T13:01:48Z","Content":"\n\u003Cp\u003Enot quite - my example code is from the belerophon..\u003C/p\u003E\u003Cp\u003Esee my signature..\u003C/p\u003E\u003Cp\u003Eit\u0027s a one part vessel with 25 animations in it.. - also the landing legs are the same part.. - just an animation\u003C/p\u003E\u003Cp\u003Ewhat I do is loop through all of the animations and find the one with the \u0022right\u0022 name - that one I play queued.\u003C/p\u003E\u003Cp\u003Eyou can go with 0 as long as you like - it\u0027s a time waste - you most likely won\u0027t get around that loop - I tried quite some time..\u003C/p\u003E\n"},{"CreatedByName":"Apollo13","CreatedById":74572,"CreatedDateTime":"2014-10-16T15:19:17Z","Content":"\n\u003Cp\u003Ethis didn\u0027t work and I get a NullReference Exception:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E            foreach (Animation animation in this.vessel.rootPart.FindModelAnimators(\u0022Deploy\u0022))\u003Cbr\u003E            {\u003Cbr\u003E                animation.Rewind();\u003Cbr\u003E                animation.PlayQueued(\u0022Deploy\u0022);\u003Cbr\u003E            }\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EIn my Unity Animations Inspector, I\u0027ve defined:\u003C/p\u003E\u003Cp\u003EElement 0 : Scene (imported in FBX file)\u003C/p\u003E\u003Cp\u003EElement 1 : Deploy 0-70\u003C/p\u003E\u003Cp\u003EElement 2: Scan 70-110\u003C/p\u003E\u003Cp\u003EHow does yours look?\u003C/p\u003E\u003Cp\u003EFinally, I don\u0027t know how to use xEvilreeper\u0027s snippet\u003C/p\u003E\n"},{"CreatedByName":"philotical","CreatedById":109390,"CreatedDateTime":"2014-10-16T16:05:48Z","Content":"\n\u003Cp\u003EMine has 25 lines and each one is a clip like your\u0027s in Element 1\u0026amp;2..\u003C/p\u003E\u003Cp\u003Ethe scene I don\u0027t have - it\u0027s not needed..\u003C/p\u003E\u003Cp\u003EMaybe you need it because it\u0027s fbx, I don\u0027t know, never used fbx - I usually import my blend directly through the assets forder and I get \u0022default_clip\u0022 with the full length of all animations combined..\u003C/p\u003E\u003Cp\u003EI simply overwrite that with my name and limit it to the needed frames..\u003C/p\u003E\u003Cp\u003Ethan I add an other one and do the same..\u003C/p\u003E\u003Cp\u003Ebut keep in mind, I get it to work, because I do what they said - but I don\u0027t know what I\u0027m doing as much as evil would know..\u003C/p\u003E\u003Cp\u003ESo - don\u0027t blame me if I missed a difference here - haha\u003C/p\u003E\u003Cp\u003Ebut I doubt it - you just stand on your own tube as I did for days..\u003C/p\u003E\u003Cp\u003EA null ref is something to debug - find out what value/ref it is and fix it..\u003C/p\u003E\u003Cp\u003EI can\u0027t debug your NullRef from the posted code..\u003C/p\u003E\u003Cp\u003EEvil\u0027s snip:\u003C/p\u003E\u003Cp\u003EPut this in your name space, just above your class definition..\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E    public delegate void GameObjectVisitor(GameObject go, int indent);\u003Cbr\u003E\u003Cbr\u003E    public static class DebugExtensions\u003Cbr\u003E    {\u003Cbr\u003E        private static void internal_PrintComponents(GameObject go, int indent)\u003Cbr\u003E        {\u003Cbr\u003E            Debug.Log((indent \u0026gt; 0 ? new string(\u0027-\u0027, indent) \u002B \u0022\u0026gt;\u0022 : \u0022\u0022)\u002B\u0022 \u0022\u002Bgo.name\u002B\u0022 has components:\u0022);\u003Cbr\u003E\u003Cbr\u003E            var components = go.GetComponents\u0026lt;Component\u0026gt;();\u003Cbr\u003E            foreach (var c in components)\u003Cbr\u003E                Debug.Log(new string(\u0027.\u0027, indent \u002B 3) \u002B \u0022c\u0022\u002B \u0022: \u0022\u002Bc.GetType().FullName);\u003Cbr\u003E        }\u003Cbr\u003E\u003Cbr\u003E        public static void PrintComponents(this UnityEngine.GameObject go)\u003Cbr\u003E        {\u003Cbr\u003E            go.TraverseHierarchy(internal_PrintComponents);\u003Cbr\u003E        }\u003Cbr\u003E\u003Cbr\u003E        public static void TraverseHierarchy(this UnityEngine.GameObject go, GameObjectVisitor visitor, int indent = 0)\u003Cbr\u003E        {\u003Cbr\u003E            visitor(go, indent);\u003Cbr\u003E\u003Cbr\u003E            for (int i = 0; i \u0026lt; go.transform.childCount; \u002B\u002Bi)\u003Cbr\u003E                go.transform.GetChild(i).gameObject.TraverseHierarchy(visitor, indent \u002B 3);\u003Cbr\u003E        }\u003Cbr\u003E    }\u003Cbr\u003E\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003Ethan put this, where ever you got the data to read out:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E                DebugExtensions.PrintComponents(v.gameObject);\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003Ev is a vessel in my case..\u003C/p\u003E\u003Cp\u003E..should be in your\u0027s too..\u003C/p\u003E\u003Cp\u003EIt is a class with the static keyword in front of it, that means you must not use it with a instance but with it\u0027s classname..\u003C/p\u003E\u003Cp\u003EDebugExtensions. - after that you just add the functionname you want to call..\u003C/p\u003E\u003Cp\u003Ethat function has to be static too..\u003C/p\u003E\u003Cp\u003EIn this case, that one function does the whole job..\u003C/p\u003E\n"},{"CreatedByName":"Apollo13","CreatedById":74572,"CreatedDateTime":"2014-10-16T16:38:17Z","Content":"\n\u003Cp\u003Ehere\u0027s the code I used\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E            try\u003Cbr\u003E            {\u003Cbr\u003E            foreach (Animation animx in this.vessel.rootPart.FindModelAnimators(\u0022Deploy\u0022))\u003Cbr\u003E            {\u003Cbr\u003E                animx.Rewind();\u003Cbr\u003E                animx.PlayQueued(\u0022Deploy\u0022);\u003Cbr\u003E            }\u003Cbr\u003E            }\u003Cbr\u003E            catch(NullReferenceException e)\u003Cbr\u003E            {\u003Cbr\u003E                DebugExtensions.PrintComponents(vessel.gameObject);\u003Cbr\u003E            }\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EI did not get the dump like xEvil shows.\u003C/p\u003E\n"},{"CreatedByName":"philotical","CreatedById":109390,"CreatedDateTime":"2014-10-16T17:03:50Z","Content":"\n\u003Cp\u003Eif evils snip wasn\u0027t executed, it\u0027s because you locked it out..\u003C/p\u003E\u003Cp\u003Eit only happens IF you have an exception and you obviousely didn\u0027t have a null ref.\u003C/p\u003E\u003Cp\u003Edo this:\u003C/p\u003E\u003Cp\u003E DebugExtensions.PrintComponents(\u003Cstrong\u003Ethis.\u003C/strong\u003Evessel.gameObject);\u003C/p\u003E\u003Cp\u003E foreach (Animation animx in this.vessel.rootPart.FindModelAnimators(\u0022Deploy\u0022))\u003C/p\u003E\u003Cp\u003E {\u003C/p\u003E\u003Cp\u003E animx.Rewind();\u003C/p\u003E\u003Cp\u003E animx.PlayQueued(\u0022Deploy\u0022);\u003C/p\u003E\u003Cp\u003E }\u003C/p\u003E\u003Cp\u003Eopen the log and check where your animations are, than you will probbably see why you get a null ref \u003C/p\u003E\u003Cp\u003EAre you sure it\u0027s the rootpart where your animations are?!?!\u003C/p\u003E\u003Cp\u003EThat could only be if your part was a command pod afaik\u003C/p\u003E\u003Cp\u003EIs it?\u003C/p\u003E\n"},{"CreatedByName":"Apollo13","CreatedById":74572,"CreatedDateTime":"2014-10-16T17:12:57Z","Content":"\n\u003Cp\u003Ethis is the statement causing the NullReferenceException:\u003C/p\u003E\u003Cp\u003Eforeach (Animation animx in this.vessel.rootPart.FindModelAnimators(\u0022Deploy\u0022))\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003EI tried:\u003Cbr\u003Eforeach (Animation animx in part.FindModelAnimators(\u0022Deploy\u0022))\u003Cbr\u003E\u003Cbr\u003EI also tried:\u003Cbr\u003Eforeach (Animation animx in this.part.FindModelAnimators(\u0022Deploy\u0022))\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003Ei don\u0027t get the exception. But, I still get no animation.\u003C/p\u003E\u003Cp\u003EI\u0027m getting the \u0022no animation\u0022 problem in the VAB, where I have only two parts: command probe, my part\u003C/p\u003E\u003Cp\u003EBTW: I use FBX import, because when I tried importing the .BLEND file, I would get an error message that \u0022Blender has stopped working\u0022 even when Blender wasn\u0027t running. That may have been a problem with Blender v 2.71\u003C/p\u003E\u003Cp\u003EJust yesterday, I tried a direct .blend import again, and it worked. I\u0027m using Blender v 2.72. So, I may try that instead of FBX.\u003C/p\u003E\u003Cp\u003EEDIT: just tried importing .BLEND file. Import worked. I generated the .MU file and Unity did not complain. However, the file was not loaded into KSP. KSP.log says \u0022model does not exist\u0022. Yet, the .MU file is there. in the parts directory.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-10-16T17:41:05Z\u0022 title=\u002210/16/2014 05:41  PM\u0022 data-short=\u00229 yr\u0022\u003EOctober 16, 2014\u003C/time\u003E by Apollo13\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"philotical","CreatedById":109390,"CreatedDateTime":"2014-10-16T19:14:05Z","Content":"\n\u003Cp\u003Eit would help if you posted the output of evil\u0027s snip..\u003C/p\u003E\n"},{"CreatedByName":"Apollo13","CreatedById":74572,"CreatedDateTime":"2014-10-16T20:08:25Z","Content":"\n\u003Cp\u003EResolved\u003C/p\u003E\u003Cp\u003ExEvilReepers snippet showed nothing.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-10-17T00:11:30Z\u0022 title=\u002210/17/2014 12:11  AM\u0022 data-short=\u00229 yr\u0022\u003EOctober 17, 2014\u003C/time\u003E by Apollo13\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2014-10-16T22:57:06Z","Content":"\n\u003Cp\u003EDo you have the part and config you could post? My snippet only prints which components are attached to a GameObject and its children, nothing more. If you\u0027re getting an animation to play at all then it won\u0027t help you and you\u0027re already past the \u0022are we sure this part HAS an animation?\u0022 part of debugging\u003C/p\u003E\n"},{"CreatedByName":"philotical","CreatedById":109390,"CreatedDateTime":"2014-10-17T01:27:36Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Apollo13\u0022 data-cite=\u0022Apollo13\u0022\u003E\u003Cdiv\u003EResolved\u003Cp\u003ExEvilReepers snippet showed nothing.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003Ecan you share the solution if it\u0027s resolved? Would be benefitial to all here..\u003C/p\u003E\u003Cp\u003Eevery solution matters..\u003C/p\u003E\n"},{"CreatedByName":"Apollo13","CreatedById":74572,"CreatedDateTime":"2014-10-17T01:41:01Z","Content":"\n\u003Cp\u003EI went back to a solution I used a month ago. I wanted to use AddClip() so I could set AnimationEvents. After much frustration, decided to drop that effort and go old school. BTW: this is still WIP. I\u0027m using OnFixedUpdate because I have other changes planned that require that.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Eusing System;\u003Cbr\u003Eusing System.Collections;\u003Cbr\u003Eusing UnityEngine;\u003Cbr\u003E\u003Cbr\u003Enamespace orbitalscanner2\u003Cbr\u003E{\u003Cbr\u003E    public class orbitscan : PartModule\u003Cbr\u003E    {\u003Cbr\u003E        [KSPField(isPersistant = true, guiActive = false)]\u003Cbr\u003E        public bool isDeployed = false;\u003Cbr\u003E\u003Cbr\u003E        [KSPField(isPersistant = true, guiActive = false)]\u003Cbr\u003E        public bool isScanning = false;\u003Cbr\u003E\u003Cbr\u003E        private Animation anim;\u003Cbr\u003E\u003Cbr\u003E        public override void OnStart(PartModule.StartState state)\u003Cbr\u003E        {\u003Cbr\u003E            anim = part.FindModelAnimators(\u0022Scene\u0022)[0];\u003Cbr\u003E            base.OnStart(state);\u003Cbr\u003E        }\u003Cbr\u003E\u003Cbr\u003E//toggles deployment\u003Cbr\u003E        [KSPEvent(active = true, guiActive = true, guiActiveEditor = false, guiName = \u0022Deploy\u0022)]\u003Cbr\u003E        public void ToggleDeploy()\u003Cbr\u003E        {\u003Cbr\u003E            Deploy(!isDeployed);\u003Cbr\u003E            return;\u003Cbr\u003E        }\u003Cbr\u003E\u003Cbr\u003E        public void Deploy(bool status)\u003Cbr\u003E        {\u003Cbr\u003E            isDeployed = status;\u003Cbr\u003E\u003Cbr\u003E            if (isDeployed)     // deploy, start scanning\u003Cbr\u003E            {\u003Cbr\u003E                anim.Rewind();\u003Cbr\u003E                anim[\u0022Deploy\u0022].speed = 1f;\u003Cbr\u003E                anim[\u0022Deploy\u0022].normalizedTime = 0f;\u003Cbr\u003E                anim.Play(\u0022Deploy\u0022);\u003Cbr\u003E                isScanning = true;\u003Cbr\u003E            }\u003Cbr\u003E            else  // stop scanning, retract\u003Cbr\u003E            {\u003Cbr\u003E                isScanning = false;\u003Cbr\u003E                anim.Stop();\u003Cbr\u003E                anim.Rewind();\u003Cbr\u003E                anim[\u0022Deploy\u0022].speed = -1f;\u003Cbr\u003E                anim[\u0022Deploy\u0022].normalizedTime = 1f;\u003Cbr\u003E                anim.Play(\u0022Deploy\u0022);\u003Cbr\u003E            }\u003Cbr\u003E\u003Cbr\u003E            Events[\u0022ToggleDeploy\u0022].guiName = (isDeployed ? \u0022Retract\u0022 : \u0022Deploy\u0022);\u003Cbr\u003E            return;\u003Cbr\u003E        }\u003Cbr\u003E\u003Cbr\u003E// to test OnFixedUpdate, you MUST have at least one stage and Launch!!!\u003Cbr\u003E        public override void OnFixedUpdate()\u003Cbr\u003E        {\u003Cbr\u003E            if (isScanning \u0026amp;\u0026amp; !anim.isPlaying)  //restart scanner if playing\u003Cbr\u003E            {\u003Cbr\u003E                anim.Rewind();\u003Cbr\u003E                anim[\u0022Scan\u0022].speed = 1f;\u003Cbr\u003E                anim[\u0022Scan\u0022].normalizedTime = 0f;\u003Cbr\u003E                anim.Play(\u0022Scan\u0022);\u003Cbr\u003E            }\u003Cbr\u003E            base.OnFixedUpdate();\u003Cbr\u003E        }\u003Cbr\u003E    }\u003Cbr\u003E}\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-10-17T01:43:47Z\u0022 title=\u002210/17/2014 01:43  AM\u0022 data-short=\u00229 yr\u0022\u003EOctober 17, 2014\u003C/time\u003E by Apollo13\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2014-10-17T06:09:26Z","Content":"\n\u003Cp\u003EYou were pretty close, though. You built your new AnimationStates out of empty clips so naturally you won\u0027t be seeing any animation. It works as expected, with the single gotcha being that since your PartModule isn\u0027t attached to the same GO as the Animation you\u0027re messing with, the message sent from an AnimationEvent won\u0027t go to your script automatically.\u003C/p\u003E\u003Cp\u003EHere\u0027s an example that tweaks the Communotron for fun:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Eclass JellyListener : MonoBehaviour\u003Cbr\u003E{\u003Cbr\u003E    private void MethodSentOnAnimationsGameObject()\u003Cbr\u003E    {\u003Cbr\u003E        // just forward it\u003Cbr\u003E        GetComponentInParent\u0026lt;JellyfishDish\u0026gt;().SendMessage(\u0022JellyfishOpen\u0022);\u003Cbr\u003E    }\u003Cbr\u003E}\u003Cbr\u003E\u003Cbr\u003Eclass JellyfishDish : PartModule\u003Cbr\u003E{\u003Cbr\u003E    new Animation animation;\u003Cbr\u003E\u003Cbr\u003E    public override void OnAwake()\u003Cbr\u003E    {\u003Cbr\u003E        base.OnAwake();\u003Cbr\u003E        print(\u0022Jellyfish awake\u0022);\u003Cbr\u003E\u003Cbr\u003E        animation = part.FindModelAnimators().SingleOrDefault();\u003Cbr\u003E        int frames = (int)(animation.clip.length * animation.clip.frameRate);\u003Cbr\u003E\u003Cbr\u003E        animation.AddClip(animation.clip, \u0022Jellyfish\u0022, (int)(frames * 0.7) /* selected arbitrarily */, frames);\u003Cbr\u003E\u003Cbr\u003E        AnimationState jellyfish = animation[\u0022Jellyfish\u0022];\u003Cbr\u003E\u003Cbr\u003E        jellyfish.normalizedSpeed *= 3f;\u003Cbr\u003E        jellyfish.clip.AddEvent(new AnimationEvent()\u003Cbr\u003E        {\u003Cbr\u003E            time = 0f,\u003Cbr\u003E            functionName = \u0022MethodSentOnAnimationsGameObject\u0022\u003Cbr\u003E        });\u003Cbr\u003E\u003Cbr\u003E        jellyfish.wrapMode = WrapMode.PingPong;\u003Cbr\u003E        animation.gameObject.AddComponent\u0026lt;JellyListener\u0026gt;(); // listens for our event\u003Cbr\u003E    }\u003Cbr\u003E\u003Cbr\u003E    [KSPEvent(active = true, guiActive = true, guiActiveEditor = true, guiName = \u0022Deploy the Jellyfish\u0022)]\u003Cbr\u003E    public void JellyfishDeploy()\u003Cbr\u003E    {\u003Cbr\u003E        animation.Play(\u0022Jellyfish\u0022);\u003Cbr\u003E    }\u003Cbr\u003E\u003Cbr\u003E    private void JellyfishOpen()\u003Cbr\u003E    {\u003Cbr\u003E        ScreenMessages.PostScreenMessage(\u0022Jellyfish!\u0022, .5f, (ScreenMessageStyle)UnityEngine.Random.Range(0, 3));\u003Cbr\u003E        print(\u0022JellyfishOpen event\u0022);\u003Cbr\u003E    }\u003Cbr\u003E}\u003Cbr\u003E\u003Cbr\u003E[KSPAddon(KSPAddon.Startup.MainMenu, true)]\u003Cbr\u003Eclass InsertPartModule : MonoBehaviour\u003Cbr\u003E{\u003Cbr\u003E    private void Start()\u003Cbr\u003E    {\u003Cbr\u003E        PartLoader.getPartInfoByName(\u0022commDish\u0022).partPrefab.AddModule(\u0022JellyfishDish\u0022);\u003Cbr\u003E    }\u003Cbr\u003E}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n"},{"CreatedByName":"Apollo13","CreatedById":74572,"CreatedDateTime":"2014-10-17T13:00:57Z","Content":"\n\u003Cp\u003E@\u003Cstrong\u003ExEvilReeperx\u003C/strong\u003E: thanks for that code. I\u0027ll use that in the future and ask you a few questions as well. Sent you a forum Rep point. I had asked for AddClip() help in the Unity forums. the only response I got back was some guy saying \u0022You\u0027re creating an empty clip, and that just seems wrong.\u0022 Three times. Mind you, he didn\u0027t offer any assistance to make it right. He sure as HEII didn\u0027t offer a specific coding example (I did ask). Nope, just told me I was doing it wrong.\u003C/p\u003E\u003Cp\u003E@\u003Cstrong\u003Ephilotical\u003C/strong\u003E: Thanks for your assistance and patience. Sent you a Rep point as well.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-10-17T13:09:13Z\u0022 title=\u002210/17/2014 01:09  PM\u0022 data-short=\u00229 yr\u0022\u003EOctober 17, 2014\u003C/time\u003E by Apollo13\u003C/strong\u003E\n\u003C/span\u003E\n"}]}