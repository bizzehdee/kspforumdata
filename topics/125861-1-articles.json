{"TopicId":125861,"ForumId":29,"TopicTitle":"New SAS buttons?","CreatedByName":"Xyphos","CreatedById":139010,"CreatedDateTime":"2015-11-18T22:44:09Z","PageNum":1,"Articles":[{"CreatedByName":"Xyphos","CreatedById":139010,"CreatedDateTime":"2015-11-18T22:44:09Z","Content":"\nFirst, I know C#\u003Cbr\u003E\nSecond, I DO NOT know about the KSP Plugin API, a walk-through would be great.\u003Cbr\u003E\n\u003Cbr\u003E\nWhat I want to do:\u003Cbr\u003E\nturning on SAS enables buttons that orient the current vessel in that particular direction, but I want to add 4 new buttons for North, East, South, West - to be used for asssisting rover and spaceplane piloting.\u003Cbr\u003E\n\u003Cbr\u003E\nwhenever these buttons are active, it should only control the yaw of the vessel, roll and pitch should remain unaffected.\u003Cbr\u003E\n\u003Cbr\u003E\n\u003Cbr\u003E\nin addition, should I succeed in this, I\u0026#39;d also like some information about releasing the mod on CKAN.\u003Cbr\u003E\n\u003Cbr\u003E\n---thanks in advance!\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-11-18T23:05:28Z\u0022 title=\u002211/18/2015 11:05  PM\u0022 data-short=\u00228 yr\u0022\u003ENovember 18, 2015\u003C/time\u003E by Xyphos\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"simon56modder","CreatedById":119640,"CreatedDateTime":"2015-11-19T16:50:32Z","Content":"\nI don\u0026#39;t know if you\u0026#39;ll find what you want here :\u003Cbr\u003E\n[url]http://anatid.github.io/XML-Documentation-for-the-KSP-API/annotated.html[/url]\n"},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2015-11-19T20:46:19Z","Content":"\nThis could easily be one heck of a way to get started :P\u003Cbr\u003E\n\u003Cbr\u003E\n1) Starting with the basics, getting setup for compilation of plugins for KSP is covered on the [URL=\u0022http://wiki.kerbalspaceprogram.com/wiki/Plugins\u0022]wiki[/URL] (NOTE: Compiling against .NET 3.5 is [B]NOT[/B] outdated information). It also has some vector math that\u0026#39;ll give you your direction vectors in the examples.\u003Cbr\u003E\n2) There are two types of plugins that would be suited to this, depending on whether you require control for all loaded vessels or only the active one. A single instance plugin (best used for controlling only the active vessel) Inherits from MonoBehaviour and is tagged with the KSP addon attribute like so:\u003Cbr\u003E\n[code][KSPAddon(KSPAddon.Startup.Flight, false)] // KSP will create and call an instance every time you enter the flight scene\u003Cbr\u003E\npublic class ExampleClass : MonoBehaviour { }[/code]\u003Cbr\u003E\n\u003Cbr\u003E\nFor multi vessel control, it\u0026#39;s best to use a class inheriting [URL=\u0022http://forum.kerbalspaceprogram.com/threads/126229-Vessel-Modules-Discussion\u0022]VesselModule[/URL]. Behaviour is near identical, but you get an instance per vessel instead of an instance per scene.\u003Cbr\u003E\n\u003Cbr\u003E\n3) To control just one axis, you need to write your own control system that takes in an angle in some form (rad/deg/dot) and outputs a float between 1 and -1 that represents how much yaw authority will be used. Stock SAS controls all three axes as one and deactivates if it receives any user input (May or may not apply to the rover driving / translation bindings) so probably isn\u0026#39;t suitable for the task.\u003Cbr\u003E\n\u003Cbr\u003E\n4) GUI\u0026#39;s are typically created using Unity\u0026#39;s [URL=\u0022http://docs.unity3d.com/ScriptReference/GUI.Button.html\u0022]GUI[/URL] or [URL=\u0022http://docs.unity3d.com/ScriptReference/GUILayout.Button.html\u0022]GUILayout[/URL] classes. I don\u0026#39;t know any scripter who likes GUI work, so uh, good luck...\u003Cbr\u003E\n\u003Cbr\u003E\nI should note here that if you just want the functionality, Pilot Assistant\u0026#39;s SSAS system should do the job (and if not it should be easy enough for me to make it work)\n"},{"CreatedByName":"Xyphos","CreatedById":139010,"CreatedDateTime":"2015-11-23T23:33:00Z","Content":"\nOh wow, THANKS MAN!\u003Cbr\u003E\nthat helped me ALOT.\n"},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2015-11-24T01:58:11Z","Content":"\nThat\u0026#39;s something I\u0026#39;ve not seen before. I would check to see if other things from Assembly-C# are resolving (eg. see if it knows about the classes Part, Vessel, and/or FlightGlobals), but if that works and the attribute doesn\u0026#39;t I really have no idea\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-11-24T02:03:15Z\u0022 title=\u002211/24/2015 02:03  AM\u0022 data-short=\u00228 yr\u0022\u003ENovember 24, 2015\u003C/time\u003E by Crzyrndm\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Xyphos","CreatedById":139010,"CreatedDateTime":"2015-11-24T02:27:49Z","Content":"\nnvm, fixed it. I had the wrong DLL referenced.\u003Cbr\u003E\nderp. pay attention!\n"},{"CreatedByName":"Xyphos","CreatedById":139010,"CreatedDateTime":"2015-11-24T08:23:08Z","Content":"\nOK, I fixed the reference error, but I\u0026#39;m still confused as to what I need to do to make it work.\u003Cbr\u003E\n\u003Cbr\u003E\nI want to add a button to the stock toolbar, like the other mods do, toolbar mod isnt required, but would be nice.\u003Cbr\u003E\nI want that toolbar button to open a window, that window should have a label top center, and 9 radio/option buttons in a 3x3 grid, center being \u0022off\u0022 or \u0022disabled\u0022 state.\u003Cbr\u003E\nthe others should direct SAS to turn to that direction when depressed.\u003Cbr\u003E\nwhen the window is closed, the disabled option should automatically selected.\u003Cbr\u003E\n\u003Cbr\u003E\n\u003Cbr\u003E\n..at least, that\u0026#39;s how I envisioned things.\u003Cbr\u003E\nplease bear in mind that this will be my first KSP plugin so excuse my noobishness.\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-11-24T08:26:07Z\u0022 title=\u002211/24/2015 08:26  AM\u0022 data-short=\u00228 yr\u0022\u003ENovember 24, 2015\u003C/time\u003E by Xyphos\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2015-11-25T14:59:49Z","Content":"\nAs we don\u0026#39;t really have a documented API, the most common way of figuring stuff out is to look at another mod\u0026#39;s code.\u003Cbr\u003E\n\u003Cbr\u003E\nI load my stock toolbar button for AGX this way: [url]https://github.com/SirDiazo/AGExt/blob/master/AGExt/Editor.cs#L456[/url]\u003Cbr\u003E\n\u003Cbr\u003E\nThe rest I\u0026#39;m not sure how to go about, maybe see how MechJeb does it\u0026#39;s headings and vessel control stuff?\u003Cbr\u003E\n\u003Cbr\u003E\nD.\n"},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2015-11-25T20:00:26Z","Content":"\nHere\u0026#39;s an [URL=\u0022https://github.com/Crzyrndm/Pilot-Assistant/blob/master/PilotAssistant/PilotAssistantFlightCore.cs#L61-L64\u0022]example[/URL] using [URL=\u0022https://github.com/Crzyrndm/Pilot-Assistant/blob/master/PilotAssistant/Toolbar/AppLauncherFlight.cs\u0022]Stock[/URL] or [URL=\u0022https://github.com/Crzyrndm/Pilot-Assistant/blob/master/PilotAssistant/Toolbar/ToolbarMod.cs\u0022]Blizzy Toolbar[/URL].\u003Cbr\u003E\n\u003Cbr\u003E\nWindow with a label top center =\u0026gt; That normally comes from the text field of the window functions (eg. the blank string [URL=\u0022https://github.com/Crzyrndm/Pilot-Assistant/blob/master/PilotAssistant/PilotAssistantFlightCore.cs#L212\u0022]here[/URL])\u003Cbr\u003E\nArray of buttons =\u0026gt; You want the [URL=\u0022http://docs.unity3d.com/ScriptReference/GUILayout.SelectionGrid.html\u0022]selection grid[/URL]. [URL=\u0022https://github.com/Crzyrndm/Pilot-Assistant/blob/master/PilotAssistant/FlightModules/PilotAssistant.cs#L1311-L1313\u0022]Some example usage[/URL].\u003Cbr\u003E\n\u003Cbr\u003E\nThe control part is where things get fun. Simplest system is just some p-control (output = constant * error). Getting your current heading is done like [URL=\u0022https://github.com/Crzyrndm/Pilot-Assistant/blob/master/PilotAssistant/FlightModules/VesselData.cs#L77\u0022]this[/URL] (backtrack a little in that function for the planet vectors), and subtract from your target heading for an error. Feed that error through the p-control, clamp it to \u0026lt;-1 - 1\u0026gt; and pass the output to the vessel.ctrlstate(.yaw or .wheelyaw, I don\u0026#39;t know which will work here)\u003Cbr\u003E\n\u003Cbr\u003E\nSetting Stock SAS is a little more complex, because it requires using Quats. These [URL=\u0022https://github.com/Crzyrndm/Pilot-Assistant/blob/master/PilotAssistant/FlightModules/SurfSAS.cs#L156-L157\u0022]two lines[/URL] will generate a Quat facing the heading you want parallel to the surface which you then repeatedly assign to the [URL=\u0022http://vesModule.vesselRef.Autopilot.SAS.currentRotation\u0022]SAS target[/URL] from memory. I remember there being a number of frames required between updates, but I\u0026#39;ve never actually dealt with this directly\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-11-25T20:08:05Z\u0022 title=\u002211/25/2015 08:08  PM\u0022 data-short=\u00228 yr\u0022\u003ENovember 25, 2015\u003C/time\u003E by Crzyrndm\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Xyphos","CreatedById":139010,"CreatedDateTime":"2015-11-26T12:25:43Z","Content":"\nAWESOME! I\u0026#39;d rep you a second time if I could :/\u003Cbr\u003E\n\u003Cbr\u003E\n\u003Cbr\u003E\nbut going from your example code, I ran into a snag:\u003Cbr\u003E\n[IMG]http://i.imgur.com/8S1OxyI.png[/IMG]\n"},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2015-11-26T19:55:59Z","Content":"\nThat\u0026#39;s because [URL=\u0022https://github.com/Crzyrndm/Pilot-Assistant/blob/master/PilotAssistant/Utility/GeneralUI.cs\u0022]GeneralUI[/URL] is my static data store that I create when the player goes through the main menu the first time. I use it for storing a handful of custom skins so I can have things like [URL=\u0022https://github.com/Crzyrndm/Pilot-Assistant/blob/master/PilotAssistant/FlightModules/PilotAssistant.cs#L1296\u0022]a toggle that looks like a button[/URL] without going through all the fuss of creating a GUIStyle to suit inline a dozen times (really, I ended up using it a lot less than I could have though. I could probably shift quite a few things into that class now I think about it).\n"},{"CreatedByName":"Xyphos","CreatedById":139010,"CreatedDateTime":"2015-11-27T02:31:53Z","Content":"\nso that part isn\u0026#39;t required to show the window?\u003Cbr\u003E\nalso, toggle buttons sounds neat, where can I get the code for that?\n"},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2015-11-27T04:01:00Z","Content":"\nNot required at all. GUI.Skin holds all the styles used for the default appearances of the various UI elements and defaults to the Unity skin (mildly transparent fairly dark grey \u002B white text). There is also the skin Squad uses (opaque medium grey \u002B white/green text) which you can find at Highlogic.Skin IIRC (so GUI.Skin = Highlogic.skin; makes all your UI elements use squad\u0026#39;s style).\u003Cbr\u003E\n\u003Cbr\u003E\nToggles that look like buttons is done by telling it to use the button style instead of the default style (you can actually do this with any of the controls, just not much use having a button look like a text box most of the time \u0026gt;.\u0026gt;)\u003Cbr\u003E\n[code]state = GUILayout.Toggle(state, \u0022text\u0022, GUI.Skin.button)[/code]\u003Cbr\u003E\nI\u0026#39;m not really a fan of the default button style for buttons (the white background for selected just doesn\u0026#39;t work for me), so I made a [URL=\u0022https://github.com/Crzyrndm/Pilot-Assistant/blob/master/PilotAssistant/Utility/GeneralUI.cs#L74-L81\u0022]custom toggle style[/URL] that uses some colours that stand out nicely and the nice opaque background from the Highlogic skin\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-11-27T04:04:27Z\u0022 title=\u002211/27/2015 04:04  AM\u0022 data-short=\u00228 yr\u0022\u003ENovember 27, 2015\u003C/time\u003E by Crzyrndm\u003C/strong\u003E\n\u003C/span\u003E\n"}]}