{"TopicId":110338,"ForumId":29,"TopicTitle":"How to tell if a part will be visible in the editor","CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2015-05-22T04:44:18Z","PageNum":1,"Articles":[{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2015-05-22T04:44:18Z","Content":"\n\u003Cp\u003EBefore you say \u0022category = none\u0022, the issue is at hand is that the category is no longer a reliable method of determining visibility with the proliferation of custom subcategories, hence my issue.\u003C/p\u003E\u003Cp\u003EStock parts are no problem, I can easily filter those out by name. However, I know in the past there has been some mods which have used dummy parts for various reasons that also shouldn\u0027t be visible in the editor. I was wondering if the existing dummy parts share a common attribute that I can check to prevent them being visible in the editor categories.\u003C/p\u003E\u003Cp\u003E1) What mods make use of these dummy parts?\u003C/p\u003E\u003Cp\u003E2) What common attributes are likely to set them apart from parts that should be visible?\u003C/p\u003E\n"},{"CreatedByName":"stupid_chris","CreatedById":62017,"CreatedDateTime":"2015-05-22T05:53:53Z","Content":"\n\u003Cp\u003EI\u0027m fairly sure you\u0027re going to have to loop through all the subcategory filters and idewntify the parts that never show up. You could optimize that by simply keeping the list of parts that didn\u0027t show up yet from the whole list of known parts. Beucase there\u0027s no flag for an invisible parts. There are only filters for the parts :/\u003C/p\u003E\n"},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2015-05-22T06:23:20Z","Content":"\n\u003Cp\u003EThat is the method of last resort which is looking increasingly likely the more I look into this. Optimising it isn\u0027t really an issue, it\u0027s just a really awkward way to do things (and prone to issues when people do something unexpected)\u003C/p\u003E\n"},{"CreatedByName":"stupid_chris","CreatedById":62017,"CreatedDateTime":"2015-05-23T04:32:10Z","Content":"\n\u003Cp\u003EWell the fact is that the available parts in each category are not kept anywhere (public), they\u0027re filtered out, and as you mentioned, the availability of custom made filters kinda prevents relying on the part category.\u003C/p\u003E\n"},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2015-05-24T02:22:13Z","Content":"\n\u003Cp\u003EIncase anyone else ever needs this\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Epublic static HashSet\u0026lt;string\u0026gt; blackListedParts;\u003Cbr\u003Evoid Init() {\u003Cbr\u003E    ///\u003Cbr\u003E    if (blackListedParts == null)\u003Cbr\u003E        findPartsToBlock();\u003Cbr\u003E    ///\u003Cbr\u003E}\u003Cbr\u003E\u003Cbr\u003Evoid findPartsToBlock()\u003Cbr\u003E{\u003Cbr\u003E[COLOR=#008000]    // all parts that may not be visible[/COLOR]\u003Cbr\u003E    List\u0026lt;AvailablePart\u0026gt; partsToCheck = PartLoader.Instance.parts.FindAll(ap =\u0026gt; ap.category == PartCategories.none);\u003Cbr\u003E [COLOR=#008000]    // Only checking the category which should be Filter by Function[/COLOR]\u003Cbr\u003E    PartCategorizer.Category mainCat = PartCategorizer.Instance.filters[0];\u003Cbr\u003E [COLOR=#008000]    // has a reference to all the subcats that FE added to the category[/COLOR]\u003Cbr\u003E    customCategory customMainCat = Core.Instance.Categories.Find(C =\u0026gt; C.categoryName == mainCat.button.categoryName);\u003Cbr\u003E [COLOR=#008000]    // loop through the subcategories. Mark FE ones as seen incase of duplication and check the parts in mod categories for visibility[/COLOR]\u003Cbr\u003E    HashSet\u0026lt;string\u0026gt; subCatsSeen = new HashSet\u0026lt;string\u0026gt;();\u003Cbr\u003E    for (int i = 0; i \u0026lt; mainCat.subcategories.Count; i\u002B\u002B)\u003Cbr\u003E    {\u003Cbr\u003E        PartCategorizer.Category subCat = mainCat.subcategories[i];\u003Cbr\u003E [COLOR=#008000]        // if the name is an FE subcat and the category should have that FE subcat and it\u0027s not the duplicate of one already seen created by another mod, mark it seen and move on[/COLOR]\u003Cbr\u003E        if (Core.Instance.subCategoriesDict.ContainsKey(subCat.button.categoryName) \u0026amp;\u0026amp; customMainCat.subCategories.Contains(subCat.button.categoryName) \u0026amp;\u0026amp; !subCatsSeen.Contains(subCat.button.categoryName))\u003Cbr\u003E            subCatsSeen.Add(subCat.button.categoryName);\u003Cbr\u003E        else[COLOR=#008000] // subcat created by another mod[/COLOR]\u003Cbr\u003E        {\u003Cbr\u003E [COLOR=#008000]            // can\u0027t remove parts from a collection being looped over, need to remember the visible parts[/COLOR]\u003Cbr\u003E            List\u0026lt;AvailablePart\u0026gt; visibleParts = new List\u0026lt;AvailablePart\u0026gt;();\u003Cbr\u003E            for (int j = 0; j \u0026lt; partsToCheck.Count; j\u002B\u002B)\u003Cbr\u003E            {\u003Cbr\u003E                AvailablePart AP = partsToCheck[j];\u003Cbr\u003E                if (subCat.exclusionFilter.FilterCriteria.Invoke(AP)) // if visible\u003Cbr\u003E                    visibleParts.Add(AP); // add to visible list\u003Cbr\u003E            }\u003Cbr\u003E [COLOR=#008000]            // remove all visible parts from the list to block[/COLOR]\u003Cbr\u003E            foreach (AvailablePart ap in visibleParts)\u003Cbr\u003E                partsToCheck.Remove(ap);\u003Cbr\u003E        }\u003Cbr\u003E    }\u003Cbr\u003E    [COLOR=#008000] // add the blocked parts to a hashset for later lookup[/COLOR]\u003Cbr\u003E    blackListedParts = new HashSet\u0026lt;string\u0026gt;();\u003Cbr\u003E    foreach (AvailablePart ap in partsToCheck)\u003Cbr\u003E        blackListedParts.Add(ap.name);\u003Cbr\u003E}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003Eparts that are not visible can then be filtered out by\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Eif (part.category == PartCategories.none \u0026amp;\u0026amp; blackListedParts.Contains(part.name))\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EThe faults I see in the above method would be that it assumes all parts will show up in the first category (Filter by Function by default) if they should be visible, or if they create a subcat before FE that duplicates the name of the FE subcat to be added it will assume the mod one to be the FE subcat and break horribly on the FE subcat.\u003C/p\u003E\u003Cp\u003ENOTE: findPartsToBlock has to be delayed significantly to ensure all categories are created. FE creates categories between 1 and 4 frames after the categorizer is initialised, the event used by most mods fires somewhere between 5 and 8 frames after categorizer init. The search needs to be delayed atleast that much\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-05-24T12:35:51Z\u0022 title=\u002205/24/2015 12:35  PM\u0022 data-short=\u00229 yr\u0022\u003EMay 24, 2015\u003C/time\u003E by Crzyrndm\u003C/strong\u003E\n\u003C/span\u003E\n"}]}