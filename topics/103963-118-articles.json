{"TopicId":103963,"ForumId":36,"TopicTitle":"[WIP][1.9.x-1.12.x] Scatterer-atmospheric scattering (0.0838 - 14/08/2022) Scattering improvements, in-game atmo generation and multi-sun support","CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-04-12T08:37:35Z","PageNum":118,"Articles":[{"CreatedByName":"Nhawks17","CreatedById":32999,"CreatedDateTime":"2016-01-03T19:46:46Z","Content":"Oh well look at that... It does seem to be happening even with EVE removed... Lemme grab a fresh copy and make sure this one didn\u0027t break or something.\n\nEdit: Should\u0027ve done more troubleshooting before reporting.... Fresh copy fixed it. Sorry about that blackrack ![:P](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif \u0022:P\u0022)\n\n**Edited \u003Ctime datetime=\u00222016-01-03T19:49:47Z\u0022 title=\u002201/03/2016 07:49  PM\u0022 data-short=\u00228 yr\u0022\u003EJanuary 3, 2016\u003C/time\u003E by Nhawks17**"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2016-01-03T20:31:07Z","Content":"\u003E \n\u003E \n\u003E 44 minutes ago, Nhawks17 said:\n\u003E \n\u003E \n\u003E Oh well look at that... It does seem to be happening even with EVE removed... Lemme grab a fresh copy and make sure this one didn\u0027t break or something.\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E  \n\u003E \n\u003E \n\u003E \n\u003E \n\u003E Edit: Should\u0027ve done more troubleshooting before reporting.... Fresh copy fixed it. Sorry about that blackrack ![:P](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif \u0022:P\u0022)\n\u003E \n\nNo worries."},{"CreatedByName":"Poodmund","CreatedById":128643,"CreatedDateTime":"2016-01-04T14:42:35Z","Content":"\u003E \n\u003E \n\u003E On 12/19/2015 at 1:19 AM, Nhawks17 said:\n\u003E \n\u003E \n\u003E I get this sometimes, especially when I load Laythe and Jool, the game slows to a crawl. I usually just reboot the game and it sorts itself out next time I load the scene.\n\u003E \n\n[@blackrack](https://forum.kerbalspaceprogram.com/index.php?/profile/104258-blackrack/) I am experience NullRefs when inside the loading distance for Jool. I first noticed it when I was trying to apply Scatterer effects to an OPM Gas Giant and it was NullRef\u0027ing and slowly the game down to a couple of FPS. In the same install I thought, maybe its the same around Jool and it was. Created a clean Vanilla install and installed Scatterer, MM and HyperEdit, threw a capsule in orbit around Jool and the same thing was happening.\n\nIt shows in the log that Laythe is loading correctly but not Jool. Logs attached: [http://pastebin.com/qUmmzcJS](http://pastebin.com/qUmmzcJS)\n\nIt seems that this is tied to Gas Giants only?"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2016-01-04T18:42:34Z","Content":"\u003E \n\u003E \n\u003E 3 hours ago, Poodmund said:\n\u003E \n\u003E \n\u003E [@blackrack](https://forum.kerbalspaceprogram.com/index.php?/profile/104258-blackrack/) I am experience NullRefs when inside the loading distance for Jool. I first noticed it when I was trying to apply Scatterer effects to an OPM Gas Giant and it was NullRef\u0027ing and slowly the game down to a couple of FPS. In the same install I thought, maybe its the same around Jool and it was. Created a clean Vanilla install and installed Scatterer, MM and HyperEdit, threw a capsule in orbit around Jool and the same thing was happening.\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E It shows in the log that Laythe is loading correctly but not Jool. Logs attached: [http://pastebin.com/qUmmzcJS](http://pastebin.com/qUmmzcJS)\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E It seems that this is tied to Gas Giants only?\n\u003E \n\nIs this a new bug or new to the latest version only? Does it happen with gas giants every single time?"},{"CreatedByName":"Poodmund","CreatedById":128643,"CreatedDateTime":"2016-01-04T19:02:47Z","Content":"I honestly cannot comment as to whether it is new or not but it is using v0.02182 but it would appear that GregroxMun and NHawks17 experienced something similar, posts dated 18th/19th Dec. 15. It does happen every single time I enter an orbit around a Gas Giant within its loading distance.\n\nCould it be something to do with the fact they have no PQS for Scatterer to affect? No idea... at this stage I am just leaving Scatterer off Gas Giants and removing the included Jool configs for the time being as, like was said, it tanks FPS down to like 1 or 2.\n\nMight be worth asking [@GregroxMun](https://forum.kerbalspaceprogram.com/index.php?/profile/36077-gregroxmun/) and [@Nhawks17](https://forum.kerbalspaceprogram.com/index.php?/profile/32999-nhawks17/) if it was an \u0027identical\u0027 issue."},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2016-01-04T20:18:43Z","Content":"\u003E \n\u003E \n\u003E 1 hour ago, Poodmund said:\n\u003E \n\u003E \n\u003E I honestly cannot comment as to whether it is new or not but it is using v0.02182 but it would appear that GregroxMun and NHawks17 experienced something similar, posts dated 18th/19th Dec. 15. It does happen every single time I enter an orbit around a Gas Giant within its loading distance.\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E Could it be something to do with the fact they have no PQS for Scatterer to affect? No idea... at this stage I am just leaving Scatterer off Gas Giants and removing the included Jool configs for the time being as, like was said, it tanks FPS down to like 1 or 2.\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E Might be worth asking [@GregroxMun](https://forum.kerbalspaceprogram.com/index.php?/profile/36077-gregroxmun/) and [@Nhawks17](https://forum.kerbalspaceprogram.com/index.php?/profile/32999-nhawks17/) if it was an \u0027identical\u0027 issue.\n\u003E \n\nThat\u0027s what I was thinking too.\n\nI can\u0027t test it myself right now but could you give this quick .dll a try? [https://mega.nz/#!HBRDUagB!eMI3cHpBsPSeZltbRshNCgVGr9HWGXYUynme_oZo2CU](https://mega.nz/#!HBRDUagB!eMI3cHpBsPSeZltbRshNCgVGr9HWGXYUynme_oZo2CU)\n\nCould you also check if it fixes the black sun during sunsets/sunrises that looks like an eclipse?"},{"CreatedByName":"Nhawks17","CreatedById":32999,"CreatedDateTime":"2016-01-04T20:36:16Z","Content":"Can confirm, I\u0027m getting this issue on 0.02182 as well when I\u0027m in the Joolian system ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif \u0022:)\u0022) I\u0027ll be able to test that .dll in a little bit myself."},{"CreatedByName":"Nhawks17","CreatedById":32999,"CreatedDateTime":"2016-01-04T22:04:03Z","Content":"Didn\u0027t fix the Gas Giant bug but I didn\u0027t see any black sun during a sunrise or sunset so success?"},{"CreatedByName":"Poodmund","CreatedById":128643,"CreatedDateTime":"2016-01-04T22:07:54Z","Content":"I can also confirm that it did not fix the Gas Giant issue. With regards to Kerbol rise/set issue, I did not notice this before but here is a video of a rise on the pad using the above .dll at 10x warp.\n\n**[https://vimeo.com/150721127](https://vimeo.com/150721127)**\n\n**Edited \u003Ctime datetime=\u00222016-01-04T22:09:01Z\u0022 title=\u002201/04/2016 10:09  PM\u0022 data-short=\u00228 yr\u0022\u003EJanuary 4, 2016\u003C/time\u003E by Poodmund**"},{"CreatedByName":"Nhawks17","CreatedById":32999,"CreatedDateTime":"2016-01-04T23:36:39Z","Content":"Yeah I should also add that I never noticed the sun bug before on any version I\u0027ve used, but all that matters is that it isn\u0027t there now ![:P](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif \u0022:P\u0022)"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2016-01-04T23:43:19Z","Content":"Alright, will have to look into this gas giant issue more."},{"CreatedByName":"Murdox","CreatedById":148129,"CreatedDateTime":"2016-01-05T00:14:37Z","Content":"\u003E \n\u003E \n\u003E 5 hours ago, Poodmund said:\n\u003E \n\u003E \n\u003E at this stage I am just leaving Scatterer off Gas Giants and removing the included Jool configs for the time being as, like was said, it tanks FPS down to like 1 or 2.\n\u003E \n\nJust tested with stock 0.02182 and with \u0022fixed\u0022 .dll and same results with Jool... NullRefs marathon with fps ~0-2. Is there any other temporary tricks than removing Jool config or what does this exactly mean \u0022leaving scatterer off for Gas Giants\u0022? Thanks! ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif \u0022:)\u0022)\n\n**Edited \u003Ctime datetime=\u00222016-01-05T00:25:50Z\u0022 title=\u002201/05/2016 12:25  AM\u0022 data-short=\u00228 yr\u0022\u003EJanuary 5, 2016\u003C/time\u003E by Murdox**"},{"CreatedByName":"SkyKaptn","CreatedById":153990,"CreatedDateTime":"2016-01-05T05:18:21Z","Content":"There is another problem with gas giants that have rings. I am Running Outer Planets Mod, and scatterer makes the planets appear in front of the rings as shown in the pictures below. Did not know what settings to apply, if any. Removing the entire scatterer folder fixed the problem though.\n\n\u003Ciframe class=\u0022imgur-album\u0022 frameborder=\u00220\u0022 height=\u0022550\u0022 src=\u0022//imgur.com/a/F9bE0/embed?background=ffffff\u0026text=1a1a1a\u0026link=4e76c9\u0022 width=\u0022100%\u0022\u003E\u003C/iframe\u003E"},{"CreatedByName":"drswagboss","CreatedById":67950,"CreatedDateTime":"2016-01-05T08:15:12Z","Content":"\u003E \n\u003E \n\u003E 13 hours ago, blackrack said:\n\u003E \n\u003E \n\u003E Is this a new bug or new to the latest version only? Does it happen with gas giants every single time?\n\u003E \n\nI\u0027m working on a kopernicus pack, and my game is almost running with negative fps when i try to apply scatterer to a gas gaint."},{"CreatedByName":"Paul_Sawyer","CreatedById":152646,"CreatedDateTime":"2016-01-06T19:24:10Z","Content":"\u003E \n\u003E \n\u003E On 04.01.2016 at 1:36 AM, Nhawks17 said:\n\u003E \n\u003E \n\u003E Yeah I should also add that I never noticed the sun bug before on any version I\u0027ve used, but all that matters is that it isn\u0027t there now ![:P](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif \u0022:P\u0022)\n\u003E \n\nI\u0027ve seen this bug, and I confirm, that with new dll it is fixed.\n\nBTW, Another minor glitch related to EVE: Scatterer disables city lights at 160 km:  \n\nSpoiler\n\n![GlHj4q6.png](http://i.imgur.com/GlHj4q6.png)\n\nInteresting thing about it is that [Dynamic Texture Loader](https://forum.kerbalspaceprogram.com/index.php?/topic/128660-1051-41-dec-31-2015-dynamic-texture-loader/\u0026page=1) solves the problem. Here are two logs of what\u0027s going on, in case you have a possibility to look at it:  \n[Without DTL](https://www.dropbox.com/s/7ah8edzwdbwn1b9/output_log%20EVE%2BScatterer.txt?dl=0)  \n[And with it](https://www.dropbox.com/s/b4dktahfzeje06e/output_log%20EVE%2BScatterer%2BDTL.txt?dl=0)"},{"CreatedByName":"PyroSA","CreatedById":149718,"CreatedDateTime":"2016-01-06T21:18:48Z","Content":"\u003E \n\u003E \n\u003E On 1/4/2016 at 9:02 PM, Poodmund said:\n\u003E \n\u003E \n\u003E I honestly cannot comment as to whether it is new or not but it is using v0.02182 but it would appear that GregroxMun and NHawks17 experienced something similar, posts dated 18th/19th Dec. 15. It does happen every single time I enter an orbit around a Gas Giant within its loading distance.\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E Could it be something to do with the fact they have no PQS for Scatterer to affect? No idea... at this stage I am just leaving Scatterer off Gas Giants and removing the included Jool configs for the time being as, like was said, it tanks FPS down to like 1 or 2.\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E Might be worth asking [@GregroxMun](https://forum.kerbalspaceprogram.com/index.php?/profile/36077-gregroxmun/) and [@Nhawks17](https://forum.kerbalspaceprogram.com/index.php?/profile/32999-nhawks17/) if it was an \u0027identical\u0027 issue.\n\u003E \n\nSame issue. Loaded my ship orbiting Laythe, and the framerate drops to some powerpoint-styled.\n\nDisabled Laythe, and no change.\n\nDisabled Jool, and everything is smooth again."},{"CreatedByName":"lajoswinkler","CreatedById":79159,"CreatedDateTime":"2016-01-06T22:09:37Z","Content":"I got these gaps in Eve\u0027s ocean.\n\n![34F984ABE810ECABE61BCAF1A50C90059F93B7B0](http://images.akamai.steamusercontent.com/ugc/367407720932495540/34F984ABE810ECABE61BCAF1A50C90059F93B7B0/)\n\nI\u0027ve solved them by raising the ocean level but then the game crashed. LOL"},{"CreatedByName":"sashan","CreatedById":98897,"CreatedDateTime":"2016-01-07T10:55:55Z","Content":"\u003E \n\u003E \n\u003E 12 hours ago, lajoswinkler said:\n\u003E \n\u003E \n\u003E I got these gaps in Eve\u0027s ocean.\n\u003E \n\nThat\u0027s the stock ocean not being disabled."},{"CreatedByName":"m4ti140","CreatedById":67296,"CreatedDateTime":"2016-01-07T15:18:23Z","Content":"So, since this thread severely lacked images of Eve, I sent a probe there specifically to observe the famous emerald sunset with Scatterer enabled. Here are the results:\n\n\u003Ciframe class=\u0022imgur-album\u0022 frameborder=\u00220\u0022 height=\u0022550\u0022 src=\u0022//imgur.com/a/qyqMv/embed?background=ffffff\u0026text=1a1a1a\u0026link=4e76c9\u0022 width=\u0022100%\u0022\u003E\u003C/iframe\u003E\n\nYou hear that? That\u0027s my jaw shattering against the floor. Now with some fiddling with EVE I\u0027m sure we can obtain this sort of sunrise:\n\n\u003Ciframe allowfullscreen=\u0022true\u0022 frameborder=\u00220\u0022 height=\u0022270\u0022 src=\u0022https://www.youtube.com/embed/8QztOaO45mM?start=614\u0026feature=oembed\u0022 width=\u0022480\u0022\u003E\u003C/iframe\u003E\n\nNow, how to change the way the effects scale with altitude? Is changing config point altitudes enough? I want to get the effect from picture 2 and 4 to show up at 1 bar altitude instead of ground level (approx 10-12 km)."},{"CreatedByName":"lajoswinkler","CreatedById":79159,"CreatedDateTime":"2016-01-07T15:46:37Z","Content":"\u003E \n\u003E \n\u003E 4 hours ago, sashan said:\n\u003E \n\u003E \n\u003E That\u0027s the stock ocean not being disabled.\n\u003E \n\nHow do we do that?"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2016-01-07T16:15:54Z","Content":"\u003E \n\u003E \n\u003E On 5/1/2016 at 6:18 AM, SkyKaptn said:\n\u003E \n\u003E \n\u003E There is another problem with gas giants that have rings. I am Running Outer Planets Mod, and scatterer makes the planets appear in front of the rings as shown in the pictures below. Did not know what settings to apply, if any. Removing the entire scatterer folder fixed the problem though.\n\u003E \n\nI will fix this soon.\n\n\u003E \n\u003E \n\u003E 59 minutes ago, m4ti140 said:\n\u003E \n\u003E \n\u003E So, since this thread severely lacked images of Eve, I sent a probe there specifically to observe the famous emerald sunset with Scatterer enabled. Here are the results:\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E You hear that? That\u0027s my jaw shattering against the floor. Now with some fiddling with EVE I\u0027m sure we can obtain this sort of sunrise:\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E Now, how to change the way the effects scale with altitude? Is changing config point altitudes enough? I want to get the effect from picture 2 and 4 to show up at 1 bar altitude instead of ground level (approx 10-12 km).\n\u003E \n\nGreat screenshots, well done. It\u0027s also pretty cool that nassault gave Eve green sunrises in that old video from way before we had atmospheric scattering.\n\nAnyway, not sure which effect you\u0027re talking about but if you\u0027re talking about the really intense fog-like haze that\u0027s mie scattering, if you want to change at which altitude it shows up you\u0027ll have to fiddle with the config tool and change particle height. Keep in mind however it will cause plenty of artifact lines unless you get the values right, also, what may look right at 10 kms high will look like total overkill at sea level, but you\u0027re welcome to try anyway, config tool is linked in the OP, you\u0027ll have to copy the .raw files generated to scatterer\u0027s folder and the settings into the planet config file. In the future I may have a solution to generate configs directly ingame which should make fiddling with this sort of thing much easier. You can change the mie scattering general strength (mie G) and directions (beta\\_msca) too\n\n\u003E \n\u003E \n\u003E 31 minutes ago, lajoswinkler said:\n\u003E \n\u003E \n\u003E How do we do that?\n\u003E \n\nNot sure why that happens but sometimes switching ships or reloading a game fixes it. And sometimes it\u0027s the EVE ocean shaders interfering with it.\n\n**Edited \u003Ctime datetime=\u00222016-01-07T16:19:30Z\u0022 title=\u002201/07/2016 04:19  PM\u0022 data-short=\u00228 yr\u0022\u003EJanuary 7, 2016\u003C/time\u003E by blackrack**"},{"CreatedByName":"m4ti140","CreatedById":67296,"CreatedDateTime":"2016-01-07T17:15:24Z","Content":"\u003E \n\u003E \n\u003E 56 minutes ago, blackrack said:\n\u003E \n\u003E \n\u003E Great screenshots, well done. It\u0027s also pretty cool that nassault gave Eve green sunrises in that old video from way before we had atmospheric scattering.\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E Anyway, not sure which effect you\u0027re talking about but if you\u0027re talking about the really intense fog-like haze that\u0027s mie scattering, if you want to change at which altitude it shows up you\u0027ll have to fiddle with the config tool and change particle height. Keep in mind however it will cause plenty of artifact lines unless you get the values right, also, what may look right at 10 kms high will look like total overkill at sea level, but you\u0027re welcome to try anyway, config tool is linked in the OP, you\u0027ll have to copy the .raw files generated to scatterer\u0027s folder and the settings into the planet config file. In the future I may have a solution to generate configs directly ingame which should make fiddling with this sort of thing much easier. You can change the mie scattering general strength (mie G) and directions (beta\\_msca) too\n\u003E \n\nOk, got one more question then: what are the physical meanings of HR and HM exactly (the half heights)? I suppose one of them is the altitude at which pressure drops by 1/2 (that is 50% of mass is below it and 50% above it) but what about the other one?"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2016-01-07T17:20:13Z","Content":"\u003E \n\u003E \n\u003E 2 minutes ago, m4ti140 said:\n\u003E \n\u003E \n\u003E Ok, got one more question then: what are the physical meanings of HR and HM exactly (the half heights)? I suppose one of them is the altitude at which pressure drops by 1/2 (that is 50% of mass is below it and 50% above it) but what about the other one?\n\u003E \n\nThe other one is for aerosol particles, the particles that scatter light uniformly at any wavelength, the mie scattering thing we were talking about."},{"CreatedByName":"m4ti140","CreatedById":67296,"CreatedDateTime":"2016-01-07T17:46:01Z","Content":"OK, I get it.\n\nI tried to recreate the Emerald Sunrise with EVE\u002BScatterer but for now EVE 2D cloud layers render in front of Scatterer\u0027s effects and are not subjected to them, so it looks like I\u0027ll have to wait."},{"CreatedByName":"Poodmund","CreatedById":128643,"CreatedDateTime":"2016-01-07T18:39:15Z","Content":"\u003E \n\u003E \n\u003E 2 hours ago, blackrack said:\n\u003E \n\u003E \n\u003E Not sure why that happens but sometimes switching ships or reloading a game fixes it. And sometimes it\u0027s the EVE ocean shaders interfering with it.\n\u003E \n\nI was encountering this \u0027glitch\u0027 if my first loaded, active vessel was one that was landed by ocean. However, if I loaded a craft in orbit first and then switched to the landed craft, the ocean behaved fine. It can be solved as you say above though, just switch craft and then come back and its fine."}]}