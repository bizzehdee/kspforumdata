{"TopicId":132500,"ForumId":29,"TopicTitle":"[SOLVED] Dynamic run-time rescaling of effects (for a Semi-Procedural SRB)","CreatedByName":"Shadowmage","CreatedById":138730,"CreatedDateTime":"2016-02-19T21:11:16Z","PageNum":1,"Articles":[{"CreatedByName":"Shadowmage","CreatedById":138730,"CreatedDateTime":"2016-02-19T21:11:16Z","Content":"\n\u003Cp\u003E\nHi all,\n\u003C/p\u003E\n\u003Cp\u003E\nWas curious if anyone had any experience or knowledge regarding rescaling of engine effects at run-time?\n\u003C/p\u003E\n\u003Cp\u003E\nI have a modular-SRB system, where the user can select the diameter, number of segments, nozzle, and nosecone type for a single-part SRB.\u00A0 That end of things all works great so far;\u00A0 the one problem I have not yet been able to tackle is how to get the effects to properly scale with the size (and power) of the SRB.\u00A0 These parts use the standard ModuleEnginesFX for the engine module (with a second custom module to do rescaling of the thrust and update resources), and uses standard EFFECTS definitions (and/or Real-Plume if installed).\n\u003C/p\u003E\n\u003Cp\u003E\nCurrently they all use the same effects regardless of SRB diameter/scale/number of segments.\u00A0 This results in the offset position of the plume being incorrect for non-default diameters (due to scaling), as well as the overall size of the effects being wrong for non-default diameters (due to size and scale).\n\u003C/p\u003E\n\u003Cp\u003E\nLooking at the FXGroup code briefly, I noticed it has a SetPower(float) method, but I\u0027m unsure if this is the proper method to set the scale of them, or if it is the method that the engine-module uses to update the -current- visual status based on throttle.\n\u003C/p\u003E\n\u003Cp\u003E\nI could also potentially modify the part ConfigNode data for the effects, but I\u0027m unsure of how / if you can make a part re-initialize effects entirely (seems like it would cause problems for any modules already referencing those effects).\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nAny insight or knowledge towards this problem would be much appreciated;\n\u003C/p\u003E\n\u003Cp\u003E\nShadowmage\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-02-20T02:17:56Z\u0022 title=\u002202/20/2016 02:17  AM\u0022 data-short=\u00228 yr\u0022\u003EFebruary 20, 2016\u003C/time\u003E by Shadowmage\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2016-02-19T21:16:26Z","Content":"\n\u003Cp\u003E\nI would be looking through \u003Ca href=\u0022https://github.com/KSP-RO/RealPlume\u0022 rel=\u0022external nofollow\u0022\u003EReal Plume\u003C/a\u003E to work out how they do it (EDIT looks like the plugin may actually be\u00A0\u003Ca href=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/64987-105-smokescreen-2613-extended-fx-plugin-februaryr-15th/\u0022\u003Esmokescreen\u003C/a\u003E)\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-02-19T21:17:58Z\u0022 title=\u002202/19/2016 09:17  PM\u0022 data-short=\u00228 yr\u0022\u003EFebruary 19, 2016\u003C/time\u003E by Crzyrndm\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Shadowmage","CreatedById":138730,"CreatedDateTime":"2016-02-19T21:34:49Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222419364\u0022 data-ipsquote-contentid=\u0022132500\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221455916586\u0022 data-ipsquote-userid=\u002292871\u0022 data-ipsquote-username=\u0022Crzyrndm\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n3 minutes ago, Crzyrndm said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nI would be looking through \u003Ca href=\u0022https://github.com/KSP-RO/RealPlume\u0022 rel=\u0022external nofollow\u0022\u003EReal Plume\u003C/a\u003E to work out how they do it (EDIT looks like the plugin may actually be\u00A0\u003Ca href=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/64987-105-smokescreen-2613-extended-fx-plugin-februaryr-15th/\u0022\u003Esmokescreen\u003C/a\u003E)\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThanks for the suggestion.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nSadly, from looking at the SmokeScreen code, Sarbian uses a special particle emitter with built-in support for run-time reloading (\u003Ca href=\u0022https://github.com/sarbian/SmokeScreen/blob/master/ModelMultiParticlePersistFX.cs#L922-L1002\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/sarbian/SmokeScreen/blob/master/ModelMultiParticlePersistFX.cs#L922-L1002)\u003C/a\u003E.\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027m looking for a method that can be used equally for both stock effects or real-plume effects (works on the FXGroup level, rather than on the emitter level).\u00A0 Will do some investigation to see if I have access to any of those methods for generic FX group use / stock emitters.\u00A0 They all derive from EffectBehaviour, so there might be something usable there.\u00A0 I might be able to use something similar, if I can find the base effects emitters from the FXGroup, force-re-loading the config from nodes with modified values.\n\u003C/p\u003E\n\u003Cp\u003E\nHmm... going to require some testing and poking about to see what is going on with effects / if it\u0027ll crash things.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"Shadowmage","CreatedById":138730,"CreatedDateTime":"2016-02-20T02:17:40Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222419364\u0022 data-ipsquote-contentid=\u0022132500\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221455916586\u0022 data-ipsquote-userid=\u002292871\u0022 data-ipsquote-username=\u0022Crzyrndm\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n4 hours ago, Crzyrndm said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nI would be looking through \u003Ca href=\u0022https://github.com/KSP-RO/RealPlume\u0022 rel=\u0022external nofollow\u0022\u003EReal Plume\u003C/a\u003E to work out how they do it (EDIT looks like the plugin may actually be\u00A0\u003Ca href=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/64987-105-smokescreen-2613-extended-fx-plugin-februaryr-15th/\u0022\u003Esmokescreen\u003C/a\u003E)\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nIt took a bit of work, but editing and reloading the config nodes does seem to work.\u00A0 Sadly, I have to special-case support for real-plumes and stock effects separately, but at least it is all config-node based data so I don\u0027t need any reflection/etc.\n\u003C/p\u003E\n\u003Cp\u003E\nThanks for the suggestion \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022true\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nWill update with sample code as soon as I have it all cleaned up and implemented.\n\u003C/p\u003E\n"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2016-02-20T10:42:06Z","Content":"\n\u003Cp\u003E\nSmokeScreen already has \u003Ca href=\u0022https://github.com/sarbian/SmokeScreen/blob/master/ModelMultiParticlePersistFX.cs#L538-L544\u0022 rel=\u0022external nofollow\u0022\u003Esome code\u003C/a\u003E for the \u0022old\u0022\u00A0ProceduralSRB so I could easily add something for yours if you want.\n\u003C/p\u003E\n"},{"CreatedByName":"Shadowmage","CreatedById":138730,"CreatedDateTime":"2016-02-21T18:50:23Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222420351\u0022 data-ipsquote-contentid=\u0022132500\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221455964926\u0022 data-ipsquote-userid=\u002257146\u0022 data-ipsquote-username=\u0022sarbian\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nOn Saturday, February 20, 2016 at 3:42 AM, sarbian said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nSmokeScreen already has \u003Ca href=\u0022https://github.com/sarbian/SmokeScreen/blob/master/ModelMultiParticlePersistFX.cs#L538-L544\u0022 rel=\u0022external nofollow\u0022\u003Esome code\u003C/a\u003E for the \u0022old\u0022\u00A0ProceduralSRB so I could easily add something for yours if you want.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThanks for the offer, but I appear to have it worked out at the moment, at least for Real-Plumes (and hopefully stock).\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nCode is a bit rough at the moment, and could certainly be cleaned up a bit, but is functional.\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://github.com/shadowmage45/SSTULabs/blob/master/Source/Module/SSTUModularBooster.cs#L801-L915\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/shadowmage45/SSTULabs/blob/master/Source/Module/SSTUModularBooster.cs#L801-L915\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nResults in a pretty decent scaling for my needs; and I can always adjust it later if needed.\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u0022NsSVqoZ.png\u0022 class=\u0022ipsImage\u0022 height=\u0022562\u0022 src=\u0022http://i.imgur.com/NsSVqoZ.png\u0022 width=\u00221000\u0022\u003E\u003C/p\u003E\n"}]}