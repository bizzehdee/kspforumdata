{"TopicId":135036,"ForumId":44,"TopicTitle":"looking for help getting terminator projection onto a map like kerbalmaps.com","CreatedByName":"Drew Kerman","CreatedById":103177,"CreatedDateTime":"2016-03-27T04:21:10Z","PageNum":1,"Articles":[{"CreatedByName":"Drew Kerman","CreatedById":103177,"CreatedDateTime":"2016-03-27T04:21:10Z","Content":"\n\u003Cp\u003E\nAnyone willing to help save me some trouble working through all the math? I want to be able to do \u003Ca href=\u0022http://joergdietrich.github.io/Leaflet.Terminator/\u0022 rel=\u0022external nofollow\u0022\u003Ethis\u003C/a\u003E for bodies in the game. I have a website that uses the same library that runs \u003Ca href=\u0022http://www.kerbalmaps.com/\u0022 rel=\u0022external nofollow\u0022\u003Ekerbalmaps.com\u003C/a\u003E and can modify the Leaflet application to create terminators if I knew how to calculate and project them onto the map. I have this plugin to start with but the author has already told me he is too busy to assist with converting it for use with KSP bodies\n\u003C/p\u003E\n"},{"CreatedByName":"K^2","CreatedById":57710,"CreatedDateTime":"2016-03-27T07:16:58Z","Content":"\n\u003Cp\u003E\nThere are several ways to do this. Lets start with a simple question. Do you want an equation for the curve that marks terminator itself, or do you want to tell for each pixel on the map if it should be drawn light or dark?\n\u003C/p\u003E\n\u003Cp\u003E\nAlso, which projection are you using for the map? Simple equirectangular projection or something like Mercator?\n\u003C/p\u003E\n"},{"CreatedByName":"Drew Kerman","CreatedById":103177,"CreatedDateTime":"2016-03-29T02:46:17Z","Content":"\n\u003Cp\u003E\nthe way the Earth terminator plugin I linked to works is to draw a polygon, so could I use the curve equation to create points that can be turned into a poly?\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://github.com/saik0/Leaflet.KSP/blob/b27565804474f3fd9171e53616dccbbecc628f75/src/geo/crs/CRS.js\u0022 rel=\u0022external nofollow\u0022\u003EEPSG:4326\u003C/a\u003E is what is defined for the map projection in the Leaflet.KSP library\n\u003C/p\u003E\n\u003Cp\u003E\nThanks\n\u003C/p\u003E\n"},{"CreatedByName":"cantab","CreatedById":104935,"CreatedDateTime":"2016-03-29T12:16:15Z","Content":"\n\u003Cp\u003E\nIn the stock system, on most bodies the terminator will be nearly parallel to the lines of longitude. Moho will be the biggest exception.\n\u003C/p\u003E\n"},{"CreatedByName":"Drew Kerman","CreatedById":103177,"CreatedDateTime":"2016-03-30T08:23:44Z","Content":"\n\u003Cp\u003E\nyes, the lack of planetary tilt for any bodies and the minor orbital tilt of most bodies does make things easier. It\u0027s my one hope if I have to do most of this on my own haha \u003Cimg alt=\u0022:P\u0022 data-emoticon=\u0022true\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif\u0022 title=\u0022:P\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Bill Phil","CreatedById":127797,"CreatedDateTime":"2016-03-30T12:22:44Z","Content":"\n\u003Cp\u003E\nNone of the planets or moons are tilted on their axes, correct? Then you should just need a starting time and the rotation rate.\n\u003C/p\u003E\n"},{"CreatedByName":"cantab","CreatedById":104935,"CreatedDateTime":"2016-03-30T13:59:44Z","Content":"\n\u003Cp\u003E\nAll bodies have their spin axes aligned the same way. Another way of thinking of it is they all share the same North Star. However the orbital inclinations vary and that allows the spin axes to be tilted relative to the orbital plane.\n\u003C/p\u003E\n"},{"CreatedByName":"lajoswinkler","CreatedById":79159,"CreatedDateTime":"2016-03-31T06:53:54Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222478489\u0022 data-ipsquote-contentid=\u0022135036\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221459253775\u0022 data-ipsquote-userid=\u0022104935\u0022 data-ipsquote-username=\u0022cantab\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nOn 29.03.2016. at 2:16 PM, cantab said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nIn the stock system, on most bodies the terminator will be nearly parallel to the lines of longitude. Moho will be the biggest exception.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nKerbol is a point-like source of radiation, not a disk, therefore Moho will not be an exception.\n\u003C/p\u003E\n"},{"CreatedByName":"Drew Kerman","CreatedById":103177,"CreatedDateTime":"2016-03-31T12:08:09Z","Content":"\n\u003Cp\u003E\nIdeally I would like to do a proper calculation so I could draw the terminator like this (I assume Moho would look similar with a slightly more dark/light areas at the poles depending on its mean anomaly):\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u0022twjIuSO.png\u0022 class=\u0022ipsImage\u0022 src=\u0022http://i.imgur.com/twjIuSO.png\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nBut I wouldn\u0027t be averse to just fudging it and doing this (which I understand how to calculate since I know the starting rotation of the bodies):\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u0022UDNwNf3.png\u0022 class=\u0022ipsImage\u0022 height=\u0022500\u0022 src=\u0022http://i.imgur.com/UDNwNf3.png\u0022 width=\u00221000\u0022\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-03-31T12:09:51Z\u0022 title=\u002203/31/2016 12:09  PM\u0022 data-short=\u00228 yr\u0022\u003EMarch 31, 2016\u003C/time\u003E by Gaiiden\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Bill Phil","CreatedById":127797,"CreatedDateTime":"2016-03-31T12:23:56Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222484887\u0022 data-ipsquote-contentid=\u0022135036\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221459426089\u0022 data-ipsquote-userid=\u0022103177\u0022 data-ipsquote-username=\u0022Gaiiden\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n15 minutes ago, Gaiiden said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nIdeally I would like to do a proper calculation so I could draw the terminator like this (I assume Moho would look similar with a slightly more dark/light areas at the poles depending on its mean anomaly):\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022http://i.imgur.com/twjIuSO.png\u0022 title=\u0022Enlarge image\u0022 rel=\u0022external nofollow\u0022\u003E\u003Cimg alt=\u0022twjIuSO.png\u0022 class=\u0022ipsImage ipsImage_thumbnailed\u0022 src=\u0022http://i.imgur.com/twjIuSO.png\u0022\u003E\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nBut I wouldn\u0027t be averse to just fudging it and doing this (which I understand how to calculate since I know the starting rotation of the bodies):\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022http://i.imgur.com/UDNwNf3.png\u0022 title=\u0022Enlarge image\u0022 rel=\u0022external nofollow\u0022\u003E\u003Cimg alt=\u0022UDNwNf3.png\u0022 class=\u0022ipsImage ipsImage_thumbnailed\u0022 height=\u0022500\u0022 src=\u0022http://i.imgur.com/UDNwNf3.png\u0022 width=\u00221000\u0022\u003E\u003C/a\u003E\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThe first one assumes an axial tilt. The Earth\u0027s projection looks like that but it changes over time.\n\u003C/p\u003E\n"},{"CreatedByName":"Drew Kerman","CreatedById":103177,"CreatedDateTime":"2016-03-31T14:48:39Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222484909\u0022 data-ipsquote-contentid=\u0022135036\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221459427036\u0022 data-ipsquote-userid=\u0022127797\u0022 data-ipsquote-username=\u0022Bill Phil\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n2 hours ago, Bill Phil said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nThe first one assumes an axial tilt. The Earth\u0027s projection looks like that but it changes over time.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\neven without the tilt though wouldn\u0027t the curve still happen near the poles?\n\u003C/p\u003E\n"},{"CreatedByName":"Bill Phil","CreatedById":127797,"CreatedDateTime":"2016-03-31T21:40:41Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222485170\u0022 data-ipsquote-contentid=\u0022135036\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221459435719\u0022 data-ipsquote-userid=\u0022103177\u0022 data-ipsquote-username=\u0022Gaiiden\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n6 hours ago, Gaiiden said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\neven without the tilt though wouldn\u0027t the curve still happen near the poles?\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nI don\u0027t think so. In that projection the North Pole is in its longer night part (on Earth it\u0027s 6 months of night at some areas).\n\u003C/p\u003E\n\u003Cp\u003E\nThe geoscape of the game xenonauts is pretty cool at showing the effect.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-03-31T21:41:14Z\u0022 title=\u002203/31/2016 09:41  PM\u0022 data-short=\u00228 yr\u0022\u003EMarch 31, 2016\u003C/time\u003E by Bill Phil\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Drew Kerman","CreatedById":103177,"CreatedDateTime":"2016-04-01T07:18:55Z","Content":"\n\u003Cp\u003E\nok here\u0027s what I have so far:\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u0022bXR0fBP.png\u0022 class=\u0022ipsImage\u0022 src=\u0022http://i.imgur.com/bXR0fBP.png\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nAll I\u0027m missing right now is the proper sun position. Here\u0027s what I\u0027m currently doing:\n\u003C/p\u003E\n\u003Cp\u003E\ninitialRotationDegree - (((currentTime / siderealRotationPeriod) % 1) * 360)\n\u003C/p\u003E\n\u003Cp\u003E\nso I get a fraction of the number of times the planet has rotated and then use that to see how far along the circle it has traveled from its starting position.\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan\u003EcurrLng = -90 - (((66975144 / 21549.425183090) % 1) * 360);\nif (currLng \u0026lt; -180) { currLng \u002B= 360; }\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nthe initialRotation and siderealRotationPeriod values I\u0027m using are taken from the game via KSPTOT, and the currentTime value I\u0027m using corresponds to sunrise at KSC (as in, when the sun is just visible over the horizon). Then I convert it to a value between -180 \u0026lt;=\u0026gt; 180 for display on the map.\n\u003C/p\u003E\n\u003Cp\u003E\nAs you can see, sunrise is nowhere near the KSC by my calculations.\n\u003C/p\u003E\n\u003Cp\u003E\nI think I\u0027m not factoring in the body\u0027s position in its orbit around the sun?\n\u003C/p\u003E\n\u003Cp\u003E\nEdit: Oops! I originally had the longitude for the sun\u0027s initial position at 90, but then I realized the body started rotated 90 degrees at the start of the game which means the sun would be 90 degrees \u003Cem\u003Ewest\u003C/em\u003E of the meridian. Still, that correction doesn\u0027t make things totally right\n\u003C/p\u003E\n\u003Cp\u003E\nEdit2: Damn, I originally was saying initialRotationDegree \u003Cstrong\u003E\u002B\u003C/strong\u003E (((currentTime / siderealRotationPeriod) % 1) * 360), which meant the sun was moving west to east *facepalm* unfortunately that didn\u0027t fix things completely either\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-04-01T07:50:58Z\u0022 title=\u002204/01/2016 07:50  AM\u0022 data-short=\u00228 yr\u0022\u003EApril 1, 2016\u003C/time\u003E by Gaiiden\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Drew Kerman","CreatedById":103177,"CreatedDateTime":"2016-04-01T22:34:40Z","Content":"\n\u003Cp\u003E\nok, I think I have it - I should be using the solar day time (21600) instead of the sidereal time. I actually previously did try to use the solar day time and didn\u0027t get a proper result because it was before I took into account the two mistakes I had also made in my calculations that I point out in the edits for the previous post. Here\u0027s the result:\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u002216NYBA3.png\u0022 class=\u0022ipsImage\u0022 src=\u0022http://i.imgur.com/16NYBA3.png\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u0022m0uyVWl.png\u0022 class=\u0022ipsImage\u0022 src=\u0022http://i.imgur.com/m0uyVWl.png\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nSo yea. Wheeeee!!! Thx to all for the guidance, much appreciated\n\u003C/p\u003E\n\u003Cp\u003E\nActually I do have one more question - the moons in the KSP wiki don\u0027t have values for solar days. Are their solar days the same as their sidereal rotation period? Or has no one just bothered to calculate their solar days?\n\u003C/p\u003E\n\u003Cp\u003E\nOh and you can all check it out yourself \u003Ca href=\u0022http://www.kerbalspace.agency/Tracker/body.asp?db=bodies\u0026amp;body=Kerbin\u0026amp;map=true\u0026amp;layers=sun,moon\u0022 rel=\u0022external nofollow\u0022\u003Ehere\u003C/a\u003E.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-04-02T03:22:25Z\u0022 title=\u002204/02/2016 03:22  AM\u0022 data-short=\u00228 yr\u0022\u003EApril 2, 2016\u003C/time\u003E by Gaiiden\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"K^2","CreatedById":57710,"CreatedDateTime":"2016-04-02T22:55:16Z","Content":"\n\u003Cp\u003E\nSorry, I\u0027ve been busy throughout the week. Do you still care about getting this to work for non-zero inclination, or did you ever only need this to work for Kerbin?\n\u003C/p\u003E\n\u003Cp\u003E\nSolar days on moons can get pretty complicated in general, but if all of the inclinations nearly match, id est, most of the rotations are nearly in the same plane, they work pretty much the same as for the planets. Except the orbital period you care about is still that of the planet, while sidereal rotational period is taken from the moon. The general formula is T\u003Csub\u003ED\u003C/sub\u003E\u00A0= 1/(1/T\u003Csub\u003ES\u003C/sub\u003E\u00A0- 1/T\u003Csub\u003EO\u003C/sub\u003E), where T\u003Csub\u003ED\u003C/sub\u003E\u00A0is solar day, T\u003Csub\u003ES\u003C/sub\u003E\u00A0is sidereal rotation period, and T\u003Csub\u003EO\u003C/sub\u003E\u00A0is the orbital period. This assumes that all of the rotations are in prograde. If one of them is retrograde, flip the sign of corresponding T. Likewise, if T\u003Csub\u003ED\u003C/sub\u003E\u00A0you get is negative, sunrise will happen on the \u0022wrong\u0022 side of the moon/planet.\n\u003C/p\u003E\n"},{"CreatedByName":"Drew Kerman","CreatedById":103177,"CreatedDateTime":"2016-04-03T11:16:39Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222490971\u0022 data-ipsquote-contentid=\u0022135036\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221459637716\u0022 data-ipsquote-userid=\u002257710\u0022 data-ipsquote-username=\u0022K^2\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n12 hours ago, K^2 said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nSorry, I\u0027ve been busy throughout the week. Do you still care about getting this to work for non-zero inclination, or did you ever only need this to work for Kerbin?\n\u003C/p\u003E\n\u003Cp\u003E\nSolar days on moons can get pretty complicated in general, but if all of the inclinations nearly match, id est, most of the rotations are nearly in the same plane, they work pretty much the same as for the planets. Except the orbital period you care about is still that of the planet, while sidereal rotational period is taken from the moon. The general formula is T\u003Csub\u003ED\u003C/sub\u003E\u00A0= 1/(1/T\u003Csub\u003ES\u003C/sub\u003E\u00A0- 1/T\u003Csub\u003EO\u003C/sub\u003E), where T\u003Csub\u003ED\u003C/sub\u003E\u00A0is solar day, T\u003Csub\u003ES\u003C/sub\u003E\u00A0is sidereal rotation period, and T\u003Csub\u003EO\u003C/sub\u003E\u00A0is the orbital period. This assumes that all of the rotations are in prograde. If one of them is retrograde, flip the sign of corresponding T. Likewise, if T\u003Csub\u003ED\u003C/sub\u003E\u00A0you get is negative, sunrise will happen on the \u0022wrong\u0022 side of the moon/planet.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nthanks for the equation!\n\u003C/p\u003E\n\u003Cp\u003E\nI only need this working for Kerbin for starters, but eventually I\u0027ll want it for any and all bodies. I\u0027m starting to question though whether it\u0027s worth taking the orbital inclination into account if the effect isn\u0027t going to be all that big a deal really. I would be happy with the simple approximation I have now.\n\u003C/p\u003E\n"},{"CreatedByName":"K^2","CreatedById":57710,"CreatedDateTime":"2016-04-04T01:24:15Z","Content":"\n\u003Cp\u003E\nInclinations will matter a lot for some bodies in KSP. What you really want to do is project a great circle corresponding to real terminator onto a map. I\u0027m going to edit in a brief walk-through on how to handle this in general.\n\u003C/p\u003E\n"}]}