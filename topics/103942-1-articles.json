{"TopicId":103942,"ForumId":29,"TopicTitle":"How to add a key binding?","CreatedByName":"_selfishPerson","CreatedById":104366,"CreatedDateTime":"2015-04-11T22:18:31Z","PageNum":1,"Articles":[{"CreatedByName":"_selfishPerson","CreatedById":104366,"CreatedDateTime":"2015-04-11T22:18:31Z","Content":"\n\u003Cp\u003EI\u0027m trying to create a mod that adds a keybinding to toggle brakes, but I\u0027m not sure how to add one. I\u0027ve found a KeyBinding class, but it doesn\u0027t seem immediately obvious how to use it. Can someone please enlighten me? Thanks \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2015-04-11T22:53:03Z","Content":"\n\u003Cp\u003EWrite your own code to monitor for the keypress and toggle the action group\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E// put this in Update\u003Cbr\u003Eif (Input.GetKeyDown(KeyCode.Key)) // put your KeyCode here\u003Cbr\u003E{\u003Cbr\u003E    vessel.ActionGroups.ToggleGroup(KSPActionGroup.Brakes)\u003Cbr\u003E}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n"},{"CreatedByName":"_selfishPerson","CreatedById":104366,"CreatedDateTime":"2015-04-12T06:17:25Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Crzyrndm\u0022 data-cite=\u0022Crzyrndm\u0022\u003E\u003Cdiv\u003EWrite your own code to monitor for the keypress and toggle the action group\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E// put this in Update\u003Cbr\u003Eif (Input.GetKeyDown(KeyCode.Key)) // put your KeyCode here\u003Cbr\u003E{\u003Cbr\u003E    vessel.ActionGroups.ToggleGroup(KSPActionGroup.Brakes)\u003Cbr\u003E}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EIs there any way to integrate this to the KSP key binding system or do I need to create my own?\u003C/p\u003E\n"},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2015-04-12T06:41:15Z","Content":"\n\u003Cp\u003EIf you want to tie it to a KSP binding (yaw left, brakes, etc.) instead of a specific key, you use\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Eif (GameSettings.*Action*.GetKeyDown()) // where action would probably be brakes in your case\u003Cbr\u003E// do things\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-04-12T06:43:42Z\u0022 title=\u002204/12/2015 06:43  AM\u0022 data-short=\u00229 yr\u0022\u003EApril 12, 2015\u003C/time\u003E by Crzyrndm\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"_selfishPerson","CreatedById":104366,"CreatedDateTime":"2015-04-12T07:16:58Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Crzyrndm\u0022 data-cite=\u0022Crzyrndm\u0022\u003E\u003Cdiv\u003EIf you want to tie it to a KSP binding (yaw left, brakes, etc.) instead of a specific key, you use\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Eif (GameSettings.*Action*.GetKeyDown()) // where action would probably be brakes in your case\u003Cbr\u003E// do things\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI mean, is there a way to add my keybinding to the KSP keybinding system? Or do I just have to make my own keybinding system?\u003C/p\u003E\n"},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2015-04-12T07:37:24Z","Content":"\n\u003Cp\u003ETo my knowledge, no, you can only add a bunch of your own monitoring code. Even if you could, there isn\u0027t much/any chance of it being simpler than the first snippet above.\u003C/p\u003E\u003Cp\u003EIf the issue is making it configurable, yes, you\u0027re going to have to write your own save/load method to remember which KeyCode was needed.\u003C/p\u003E\n"},{"CreatedByName":"_selfishPerson","CreatedById":104366,"CreatedDateTime":"2015-04-12T07:41:24Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Crzyrndm\u0022 data-cite=\u0022Crzyrndm\u0022\u003E\u003Cdiv\u003ETo my knowledge, no, you can only add a bunch of your own monitoring code. Even if you could, there isn\u0027t much/any chance of it being simpler than the first snippet above.\u003Cp\u003EIf the issue is making it configurable, yes, you\u0027re going to have to write your own save/load method to remember which KeyCode was needed.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EAlright, thanks!\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2015-04-12T14:52:47Z","Content":"\n\u003Cp\u003EWelcome to my world. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif\u0022 alt=\u0022:P\u0022\u003E\u003C/p\u003E\u003Cp\u003EI can confirm that there is no way to add your own stuff to KSP\u0027s keybinding system, you have to write your own system completely if you want to do this.\u003C/p\u003E\u003Cp\u003EI\u0027ve done this to differently levels for 3 different mods if you want to check those out.\u003C/p\u003E\u003Cp\u003EThe trickiest thing is that you have to save KeyCode data to disk as strings, so when you save use \u0022KeyCodeObject.ToString()\u0022 and then convert that from a string back to a KeyCode when loading with \u0022KeyCodeObject = (KeyCode)Enum.Parse(typeof(KeyCode), KeyCodeObejctString);\u003C/p\u003E\u003Cp\u003EHope that helps,\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-04-12T14:55:25Z\u0022 title=\u002204/12/2015 02:55  PM\u0022 data-short=\u00229 yr\u0022\u003EApril 12, 2015\u003C/time\u003E by Diazo\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2015-04-12T20:22:49Z","Content":"\n\u003Cp\u003EOne trick with types that implement IConfigNode is that you can get persistence practically for free inside certain types (ScenarioModules and PartModules):\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E[KSPScenario(ScenarioCreationOptions.AddToAllGames, new[] { GameScenes.SPACECENTER })]\u003Cbr\u003Epublic class ScenarioModuleKeyBindingPersistence : ScenarioModule\u003Cbr\u003E{\u003Cbr\u003E    [KSPField(isPersistant = true)] // note: must be marked KSPField, persistent\u003Cbr\u003E    private KeyBinding myBinding = new KeyBinding();\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E    // note: none of the persistent fields have been set yet\u003Cbr\u003E    public override void OnAwake()\u003Cbr\u003E    {\u003Cbr\u003E        base.OnAwake();\u003Cbr\u003E    }\u003Cbr\u003E\u003Cbr\u003E    // persistent fields have been serialized by now\u003Cbr\u003E    private void Start()\u003Cbr\u003E    {\u003Cbr\u003E        print(\u0022Start - KeyBindingPersistence - key is set to \u0022 \u002B myBinding.primary);\u003Cbr\u003E    }\u003Cbr\u003E}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EOtherwise you\u0027d want to be using KeyBinding.Save/Load. A verbose example:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cblockquote\u003E\u003Cdiv\u003E\u003Cbr\u003Epublic class AddonKeyBindingPersistence : MonoBehaviour\u003Cbr\u003E{\u003Cbr\u003E private KeyBinding myBinding = new KeyBinding();\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E private void Start()\u003Cbr\u003E {\u003Cbr\u003E if (File.Exists(GetConfigFilePath()))\u003Cbr\u003E LoadSettings();\u003Cbr\u003E\u003Cbr\u003E print(\u0022myBinding is currently \u0022 \u002B myBinding);\u003Cbr\u003E }\u003Cbr\u003E\u003Cbr\u003E private void OnDestroy()\u003Cbr\u003E {\u003Cbr\u003E SaveSettings();\u003Cbr\u003E }\u003Cbr\u003E\u003Cbr\u003E private void LoadSettings()\u003Cbr\u003E {\u003Cbr\u003E var config = ConfigNode.Load(GetConfigFilePath());\u003Cbr\u003E myBinding.Load(config.GetNode(\u0022MyBinding\u0022) ?? DefaultKeyBindingNode()); // KeyBinding will throw an exception on badly formed ConfigNodes\u003Cbr\u003E }\u003Cbr\u003E\u003Cbr\u003E private void SaveSettings()\u003Cbr\u003E {\u003Cbr\u003E var config = new ConfigNode(\u0022MyAddonSettings\u0022);\u003Cbr\u003E myBinding.Save(config.AddNode(\u0022MyBinding\u0022));\u003Cbr\u003E }\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E private string GetConfigFilePath()\u003Cbr\u003E {\u003Cbr\u003E var dllDir = Path.GetDirectoryName(AssemblyLoader.GetPathByType(typeof(AddonKeyBindingPersistence)));\u003Cbr\u003E\u003Cbr\u003E if (!Directory.Exists(dllDir))\u003Cbr\u003E Directory.CreateDirectory(dllDir);\u003Cbr\u003E\u003Cbr\u003E return Path.Combine(dllDir, \u0022settings.cfg\u0022);\u003Cbr\u003E }\u003Cbr\u003E\u003Cbr\u003E private static ConfigNode DefaultKeyBindingNode()\u003Cbr\u003E {\u003Cbr\u003E var node = new ConfigNode();\u003Cbr\u003E new KeyBinding(KeyCode.None).Save(node);\u003Cbr\u003E return node;\u003Cbr\u003E }\u003Cbr\u003E}\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E[KSPAddon(KSPAddon.Startup.SpaceCentre, false)]\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003C/blockquote\u003E\n"},{"CreatedByName":"_selfishPerson","CreatedById":104366,"CreatedDateTime":"2015-04-12T21:27:11Z","Content":"\n\u003Cp\u003EWhy can\u0027t you cast it to an int and then save that? That\u0027s what I was thinking of doing!!!\u003C/p\u003E\n"}]}