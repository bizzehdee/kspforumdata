{"TopicId":103942,"ForumId":29,"TopicTitle":"How to add a key binding?","CreatedByName":"_selfishPerson","CreatedById":104366,"CreatedDateTime":"2015-04-11T22:18:31Z","PageNum":1,"Articles":[{"CreatedByName":"_selfishPerson","CreatedById":104366,"CreatedDateTime":"2015-04-11T22:18:31Z","Content":"I\u0027m trying to create a mod that adds a keybinding to toggle brakes, but I\u0027m not sure how to add one. I\u0027ve found a KeyBinding class, but it doesn\u0027t seem immediately obvious how to use it. Can someone please enlighten me? Thanks ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)"},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2015-04-11T22:53:03Z","Content":"Write your own code to monitor for the keypress and toggle the action group\n\n    // put this in Updateif (Input.GetKeyDown(KeyCode.Key)) // put your KeyCode here{    vessel.ActionGroups.ToggleGroup(KSPActionGroup.Brakes)}"},{"CreatedByName":"_selfishPerson","CreatedById":104366,"CreatedDateTime":"2015-04-12T06:17:25Z","Content":"\u003E \n\u003E Write your own code to monitor for the keypress and toggle the action group\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E \n\u003E     // put this in Updateif (Input.GetKeyDown(KeyCode.Key)) // put your KeyCode here{    vessel.ActionGroups.ToggleGroup(KSPActionGroup.Brakes)}\n\nIs there any way to integrate this to the KSP key binding system or do I need to create my own?"},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2015-04-12T06:41:15Z","Content":"If you want to tie it to a KSP binding (yaw left, brakes, etc.) instead of a specific key, you use\n\n    if (GameSettings.*Action*.GetKeyDown()) // where action would probably be brakes in your case// do things\n\n**Edited \u003Ctime datetime=\u00222015-04-12T06:43:42Z\u0022 title=\u002204/12/2015 06:43  AM\u0022 data-short=\u00229 yr\u0022\u003EApril 12, 2015\u003C/time\u003E by Crzyrndm**"},{"CreatedByName":"_selfishPerson","CreatedById":104366,"CreatedDateTime":"2015-04-12T07:16:58Z","Content":"\u003E \n\u003E If you want to tie it to a KSP binding (yaw left, brakes, etc.) instead of a specific key, you use\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E \n\u003E     if (GameSettings.*Action*.GetKeyDown()) // where action would probably be brakes in your case// do things\n\nI mean, is there a way to add my keybinding to the KSP keybinding system? Or do I just have to make my own keybinding system?"},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2015-04-12T07:37:24Z","Content":"To my knowledge, no, you can only add a bunch of your own monitoring code. Even if you could, there isn\u0027t much/any chance of it being simpler than the first snippet above.\n\nIf the issue is making it configurable, yes, you\u0027re going to have to write your own save/load method to remember which KeyCode was needed."},{"CreatedByName":"_selfishPerson","CreatedById":104366,"CreatedDateTime":"2015-04-12T07:41:24Z","Content":"\u003E \n\u003E To my knowledge, no, you can only add a bunch of your own monitoring code. Even if you could, there isn\u0027t much/any chance of it being simpler than the first snippet above.\n\u003E If the issue is making it configurable, yes, you\u0027re going to have to write your own save/load method to remember which KeyCode was needed.\n\nAlright, thanks!"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2015-04-12T14:52:47Z","Content":"Welcome to my world. ![:P](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif)\n\nI can confirm that there is no way to add your own stuff to KSP\u0027s keybinding system, you have to write your own system completely if you want to do this.\n\nI\u0027ve done this to differently levels for 3 different mods if you want to check those out.\n\nThe trickiest thing is that you have to save KeyCode data to disk as strings, so when you save use \u0022KeyCodeObject.ToString()\u0022 and then convert that from a string back to a KeyCode when loading with \u0022KeyCodeObject = (KeyCode)Enum.Parse(typeof(KeyCode), KeyCodeObejctString);\n\nHope that helps,\n\nD.\n\n**Edited \u003Ctime datetime=\u00222015-04-12T14:55:25Z\u0022 title=\u002204/12/2015 02:55  PM\u0022 data-short=\u00229 yr\u0022\u003EApril 12, 2015\u003C/time\u003E by Diazo**"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2015-04-12T20:22:49Z","Content":"One trick with types that implement IConfigNode is that you can get persistence practically for free inside certain types (ScenarioModules and PartModules):\n\n    [KSPScenario(ScenarioCreationOptions.AddToAllGames, new[] { GameScenes.SPACECENTER })]public class ScenarioModuleKeyBindingPersistence : ScenarioModule{    [KSPField(isPersistant = true)] // note: must be marked KSPField, persistent    private KeyBinding myBinding = new KeyBinding();    // note: none of the persistent fields have been set yet    public override void OnAwake()    {        base.OnAwake();    }    // persistent fields have been serialized by now    private void Start()    {        print(\u0022Start - KeyBindingPersistence - key is set to \u0022 \u002B myBinding.primary);    }}\n\nOtherwise you\u0027d want to be using KeyBinding.Save/Load. A verbose example:\n\n\u003E \n\u003E public class AddonKeyBindingPersistence : MonoBehaviour  \n\u003E {  \n\u003E  private KeyBinding myBinding = new KeyBinding();  \n\u003E   \n\u003E   \n\u003E  private void Start()  \n\u003E  {  \n\u003E  if (File.Exists(GetConfigFilePath()))  \n\u003E  LoadSettings();  \n\u003E   \n\u003E  print(\u0022myBinding is currently \u0022 \u002B myBinding);  \n\u003E  }  \n\u003E   \n\u003E  private void OnDestroy()  \n\u003E  {  \n\u003E  SaveSettings();  \n\u003E  }  \n\u003E   \n\u003E  private void LoadSettings()  \n\u003E  {  \n\u003E  var config = ConfigNode.Load(GetConfigFilePath());  \n\u003E  myBinding.Load(config.GetNode(\u0022MyBinding\u0022) ?? DefaultKeyBindingNode()); // KeyBinding will throw an exception on badly formed ConfigNodes  \n\u003E  }  \n\u003E   \n\u003E  private void SaveSettings()  \n\u003E  {  \n\u003E  var config = new ConfigNode(\u0022MyAddonSettings\u0022);  \n\u003E  myBinding.Save(config.AddNode(\u0022MyBinding\u0022));  \n\u003E  }  \n\u003E   \n\u003E   \n\u003E  private string GetConfigFilePath()  \n\u003E  {  \n\u003E  var dllDir = Path.GetDirectoryName(AssemblyLoader.GetPathByType(typeof(AddonKeyBindingPersistence)));  \n\u003E   \n\u003E  if (!Directory.Exists(dllDir))  \n\u003E  Directory.CreateDirectory(dllDir);  \n\u003E   \n\u003E  return Path.Combine(dllDir, \u0022settings.cfg\u0022);  \n\u003E  }  \n\u003E   \n\u003E  private static ConfigNode DefaultKeyBindingNode()  \n\u003E  {  \n\u003E  var node = new ConfigNode();  \n\u003E  new KeyBinding(KeyCode.None).Save(node);  \n\u003E  return node;  \n\u003E  }  \n\u003E }\n\u003E \n\u003E \n\u003E     [KSPAddon(KSPAddon.Startup.SpaceCentre, false)]\n\u003E \n\u003E \n\u003E"},{"CreatedByName":"_selfishPerson","CreatedById":104366,"CreatedDateTime":"2015-04-12T21:27:11Z","Content":"Why can\u0027t you cast it to an int and then save that? That\u0027s what I was thinking of doing!!!"}]}