{"TopicId":151384,"ForumId":29,"TopicTitle":"ApplicationLauncher mod button with KSP 1.2","CreatedByName":"Wheffle","CreatedById":74893,"CreatedDateTime":"2016-11-03T04:08:04Z","PageNum":1,"Articles":[{"CreatedByName":"Wheffle","CreatedById":74893,"CreatedDateTime":"2016-11-03T04:08:04Z","Content":"\n\u003Cp\u003E\nMy code seemed to be working fine for KSP 1.1, but now the stock app toolbar stuff is all wonky. Buttons are appearing in scenes that they shouldn\u0027t and stuff like that.\n\u003C/p\u003E\n\u003Cp\u003E\nCode for KSP 1.1:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode\u0022\u003E\n// a MonoBehavior class\n\npublic void Awake()\n{\n    appButton = ApplicationLauncher.Instance.AddModApplication(\n        ButtonPressed,\n        ButtonReleased,\n        null,\n        null,\n        null,\n        null,\n        ApplicationLauncher.AppScenes.MAPVIEW | ApplicationLauncher.AppScenes.TRACKSTATION,\n        GameDatabase.Instance.GetTexture(\u0022PATH_GOES_HERE\u0022, false)\n        );\n}\u003C/pre\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nFrom what I understand, the ApplicationLauncher should do all the showing/hiding based on the AppScene parameter. This worked fine for 1.1, but in 1.2 it\u0027s showing the button in scenes where it doesn\u0027t belong, including the main menu sometimes.\n\u003C/p\u003E\n\u003Cp\u003E\nI looked through the forums and other source code, and it looks like people are using event callback functions from the application launcher to add and remove their buttons based on those. So I changed my code to this:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode\u0022\u003E\n//a MonoBehavior class\npublic void Awake()\n{\n\tGameEvents.onGUIApplicationLauncherReady.Add(AddAppButtons);\n    GameEvents.onGUIApplicationLauncherDestroyed.Add(RemoveAppButtons);\n}\n\npublic static void AddAppButtons()\n{\n\tif (ApplicationLauncher.Ready)\n    {\n        appButton = ApplicationLauncher.Instance.AddModApplication(\n            ButtonPressed,\n            ButtonReleased,\n            null,\n            null,\n            null,\n            null,\n            ApplicationLauncher.AppScenes.MAPVIEW | ApplicationLauncher.AppScenes.TRACKSTATION,\n            GameDatabase.Instance.GetTexture(\u0022PATH_GOES_HERE\u0022, false)\n            );\n    }\n}\n\npublic static void RemoveAppButtons()\n{\n\tApplicationLauncher.Instance.RemoveModApplication(appButton);\n    Destroy(appButton);\n}\u003C/pre\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nSomething like that. I tried to mimic what I saw.\n\u003C/p\u003E\n\u003Cp\u003E\nI don\u0027t understand why you\u0027d have to manually add and remove buttons, I thought the point of the ApplicationLauncher was to remove that kind of tedium. I also can\u0027t find any documented changes made going into 1.2 with the way the ApplicationLauncher works, so I\u0027m thoroughly confused. Maybe my code before was flawed and it just happened to work anyway. Any help would be greatly appreciated!\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cu\u003E\u003Cstrong\u003EUpdate\u003C/strong\u003E\u003C/u\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nSo it looks like the callback functions can\u0027t be static or else it throws a null pointer exception and nothing happens. I made the callback functions non-static, but I\u0027m still having MAJOR issues getting my button to NOT appear in scenes where it doesn\u0027t belong. I moved my code around, and now it looks like this:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode\u0022\u003E\n[KSPAddon(KSPAddon.Startup.AllGameScenes, false)]  //Does this need to be something specific? Removing it seems to make it never load\nclass MyClass : MonoBehavior\n{\n\tApplicationLauncherButton button = null;\n\n\tprotected virtual void Awake()\n\t{\n\t\tGameEvents.onGUIApplicationLauncherReady.Add(AppLancherReadyCallback);\n        GameEvents.onGUIApplicationLauncherUnreadifying.Add(AppLauncherUnreadifyingCallback);\n\t}\n\n\tprotected virtual void OnDestroy()\n\t{\n\t\tGameEvents.onGUIApplicationLauncherReady.Remove(AppLancherReadyCallback);\n        GameEvents.onGUIApplicationLauncherUnreadifying.Remove(AppLauncherUnreadifyingCallback);\n\t}\n\n    public void AppLancherReadyCallback()\n    {\n\t\tif (ApplicationLauncher.Ready)\n\t\t{\n            button = ApplicationLauncher.Instance.AddModApplication(\n                ButtonPressed,\n                ButtonReleased,\n                null,\n                null,\n                null,\n                null,\n                ApplicationLauncher.AppScenes.MAPVIEW | ApplicationLauncher.AppScenes.TRACKSTATION,\n                icon\n            );   \n\t\t}\n    }\n\n    public void AppLauncherUnreadifyingCallback(GameScenes scene)\n    {\n        if (ApplicationLauncher.Instance != null \u0026amp;\u0026amp; button != null)\n        {\n        \tApplicationLauncher.Instance.RemoveApplication(appButtonBiomeOverlay);\n        }\n    }\n}\u003C/pre\u003E\n\u003Cp\u003E\nAt first it seems to work (no button shows up until I\u0027m either in the tracking station or map view in flight), but when I return to the main menu, and sometimes when I go to the space center, the button shows up. Not always, just under specific circumstances. I\u0027m very confused and getting pretty frustrated that I can\u0027t get a simple application launcher button to behave like it used to before the update.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-11-04T00:03:19Z\u0022 title=\u002211/04/2016 12:03  AM\u0022 data-short=\u00227 yr\u0022\u003ENovember 4, 2016\u003C/time\u003E by Wheffle\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Ger_space","CreatedById":167349,"CreatedDateTime":"2016-11-14T14:18:19Z","Content":"\n\u003Cp\u003E\nit looks like the ApplicationLauncher.AppScenes Switches are broken with 1.2. But you could try to add and remove the buttons at the following Gameevents:\n\u003C/p\u003E\n\u003Ctable\u003E\u003Ctbody\u003E\u003Ctr\u003E\u003Ctd\u003E\n\u00A0\n\u003C/td\u003E\n\u003C/tr\u003E\u003C/tbody\u003E\u003C/table\u003E\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003EGameEvents.OnMapEntered.Add(add_my_button);\n\nGameEvents.OnMapExited.Add(remove_my_button);\n\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n"}]}