{"TopicId":57742,"ForumId":34,"TopicTitle":"[0.23] Alternis Kerbol - Release thread - [v0.1, Jan. 3] (development halted)","CreatedByName":"NovaSilisko","CreatedById":3897,"CreatedDateTime":"2013-12-26T01:48:36Z","PageNum":12,"Articles":[{"CreatedByName":"cttw","CreatedById":2670,"CreatedDateTime":"2014-01-05T21:12:53Z","Content":"\n\u003Cp\u003EHi, I am trying to use this mod and I am not sure what I am doing wrong but it changes nothing. I put the right folder in gamedata, I see the menu on startup and enable the mod and click apply, but then I start a new game, and the map view and tracking station views show the same old kerbal system. No errors are displayed.\u003C/p\u003E\n"},{"CreatedByName":"hrhtml99","CreatedById":65955,"CreatedDateTime":"2014-01-05T21:13:26Z","Content":"\n\u003Cp\u003ELooks amazing Nova! You continue to impress me! \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 alt=\u0022:D\u0022\u003E Good work!\u003C/p\u003E\n"},{"CreatedByName":"restordoc","CreatedById":70262,"CreatedDateTime":"2014-01-05T21:30:21Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Spartan125\u0022 data-cite=\u0022Spartan125\u0022\u003E\u003Cdiv\u003EIf I am in a high Bop orbit I seem to lag a lot but not in map view.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI\u0027ve noticed that the texture for Bop switches to a darker one when one gets close to it. The lag seems to come from the gradual switch from one texture to another that starts in a high orbit. I don\u0027t know if this texture switching happens in the stock game, since I\u0027ve never been to Bop in it.\u003C/p\u003E\n"},{"CreatedByName":"NathanKell","CreatedById":75006,"CreatedDateTime":"2014-01-05T21:45:48Z","Content":"\n\u003Cp\u003EIt\u0027s not switching textures, it\u0027s switching from the scaledspace model to the PQS (the procedural terrain). That\u0027s true for all CBs except Jool (which doesn\u0027t have a PQS).\u003C/p\u003E\n"},{"CreatedByName":"restordoc","CreatedById":70262,"CreatedDateTime":"2014-01-05T22:08:40Z","Content":"\n\u003Cp\u003EOh, I see. Well, the switching from scaledspace to PQS is lagging the game considerably.\u003C/p\u003E\n"},{"CreatedByName":"Hotblack Desiato","CreatedById":93895,"CreatedDateTime":"2014-01-05T22:11:18Z","Content":"\n\u003Cp\u003EI accidentally sent jeb on an escape trajectory out of the kerbol-system (close encounter with laythe, and that shot him out there).\u003C/p\u003E\u003Cp\u003Ebut when he changed from jool-SOI to sun-SOI, the craft started to rotate at high (1000x) warp, the rotation was proportional to the warp-factor.\u003C/p\u003E\u003Cp\u003Ewhen I switched to KSC and then back to jebs ship, the rotation stopped, it works just fine again.\u003C/p\u003E\u003Cp\u003E(sadly, I use TAC life support, and he has food/water/air for just another 220 days).\u003C/p\u003E\n"},{"CreatedByName":"NovaSilisko","CreatedById":3897,"CreatedDateTime":"2014-01-05T22:42:09Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022NathanKell\u0022 data-cite=\u0022NathanKell\u0022\u003E\u003Cdiv\u003EIt\u0027s not switching textures, it\u0027s switching from the scaledspace model to the PQS (the procedural terrain). That\u0027s true for all CBs except Jool (which doesn\u0027t have a PQS).\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI get the opposite sometimes. Periodically when leaving Kerbin\u0027s SOI into Jool orbit, I get a ton of FPS issues... a quicksave and quickload usually fixes it, though.\u003C/p\u003E\u003Cp\u003ENo idea about the rotation thing, Hotblack. Dunno anything I\u0027ve done that could possibly do that... How much rotation was it? Could it have been a side effect of perhaps having free camera mode on the sun?\u003C/p\u003E\n"},{"CreatedByName":"NathanKell","CreatedById":75006,"CreatedDateTime":"2014-01-05T22:58:40Z","Content":"\n\u003Cp\u003EWhen PQS is unloaded, there\u0027s a LOT of stuff to be freed by the next garbage collection pass.\u003C/p\u003E\n"},{"CreatedByName":"eggrobin","CreatedById":4680,"CreatedDateTime":"2014-01-05T23:48:53Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Mattasmack\u0022 data-cite=\u0022Mattasmack\u0022\u003E\u003Cdiv\u003EHooray! I went ahead and did an n-body simulation of the updated system, but so far only the case where Bop is still a moon of Jool. This time around, Mun gets ejected very quickly, by about 1.5 Ms (illustrated here: \u003Ca href=\u0022https://youtu.be/aGvYWqj7dfk\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://youtu.be/aGvYWqj7dfk\u003C/a\u003E ) Pol gets ejected later, around 560 Ms (animation to come). But after that, I ran the simulation out to 3 Gs and saw no other changes.\u003C/div\u003E\u003C/blockquote\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Mattasmack\u0022 data-cite=\u0022Mattasmack\u0022\u003E\u003Cdiv\u003EIt turns out to be very stable! (at least through 100 years) You put it into a low enough orbit around Kerbin that I think it would take another body passing by pretty closely to do much to it.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI switched to doing the simulation using a fifth order symplectic integrator (coefficients from \u003Cem\u003EThe accuracy of symplectic integrators\u003C/em\u003E, Robert I. McLachlan and Pau Atela (1992)) that I just wrote in C#: it\u0027s faster, 1 year in 149 s with a 10 s timestep, and it\u0027s symplectic, which can\u0027t be a bad thing.\u003C/p\u003E\u003Cp\u003EBelow are some results from a 1-year simulation with a constant 1 s time step, downsampled to 100 s for plotting due to memory usage.\u003C/p\u003E\u003Cp\u003EThe Mun hasn\u0027t quite escaped, as seen from the kinetic energy plot, but is well on its way.\u003C/p\u003E\u003Cp\u003EThe Mun\u0027s trajectory is highly chaotic: in a previous simulation where I encountered some issues with the sun (my integrator doesn\u0027t like stuff that has velocities/positions close to 0), the Mun made a close Kerbin encounter (certainly below the Roche limit, probably a collision). While Boepli (this is what I called the small version of Bop) had its inclination significantly altered (last picture in the album), it fared pretty well despite the close encounter with such a large body. Similar conclusions hold for the 5t satellite in equatorial circular 100km Kerbin orbit that NovaSilisko asked me to add to the simulation. It seems Kerbin orbit is a very safe place.\u003C/p\u003E\u003Cblockquote lang=\u0022en\u0022\u003E\u003Ca href=\u0022//imgur.com/a/8axGv\u0022 rel=\u0022external nofollow\u0022\u003EJavascript is disabled. View full album\u003C/a\u003E\u003C/blockquote\u003E\u003Cp\u003EFinding a configuration for the Jool system that makes the Mun more stable would be an interesting exercise.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-01-06T00:05:41Z\u0022 title=\u002201/06/2014 12:05  AM\u0022 data-short=\u002210 yr\u0022\u003EJanuary 6, 2014\u003C/time\u003E by eggrobin\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Hotblack Desiato","CreatedById":93895,"CreatedDateTime":"2014-01-06T00:18:24Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022NovaSilisko\u0022 data-cite=\u0022NovaSilisko\u0022\u003E\u003Cdiv\u003EI get the opposite sometimes. Periodically when leaving Kerbin\u0027s SOI into Jool orbit, I get a ton of FPS issues... a quicksave and quickload usually fixes it, though.\u003Cp\u003ENo idea about the rotation thing, Hotblack. Dunno anything I\u0027ve done that could possibly do that... How much rotation was it? Could it have been a side effect of perhaps having free camera mode on the sun?\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003Eapproximately one revolution per two second at 10000x timewarp. so it was quite slow. at lower timewarp, it was basically not visible.\u003C/p\u003E\n"},{"CreatedByName":"lantay77","CreatedById":94971,"CreatedDateTime":"2014-01-06T00:40:28Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Mattasmack\u0022 data-cite=\u0022Mattasmack\u0022\u003E\u003Cdiv\u003EHooray! I went ahead and did an n-body simulation of the updated system, but so far only the case where Bop is still a moon of Jool. This time around, Mun gets ejected very quickly, by about 1.5 Ms (illustrated here: \u003Ca href=\u0022https://youtu.be/aGvYWqj7dfk\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://youtu.be/aGvYWqj7dfk\u003C/a\u003E ) Pol gets ejected later, around 560 Ms (animation to come). But after that, I ran the simulation out to 3 Gs and saw no other changes.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EDid you write your own program to do these simulations? They are awesome.\u003C/p\u003E\n"},{"CreatedByName":"NovaSilisko","CreatedById":3897,"CreatedDateTime":"2014-01-06T01:21:01Z","Content":"\n\u003Cp\u003EMaking the ambient and sun light mod now. It will work off a preset system. Fairly minimalist normally, unless you enable the editor. Just a text box and a button to load the preset. When in-game, you can hit a hotkey to open up an editor GUI to play with values. Not made the GUI yet though, just working on the preset load/save options. Also, Alternis will have its own lightshifter embedded by default, but it can be disabled with the same options screen it uses to configure other stuff.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-01-06T01:26:06Z\u0022 title=\u002201/06/2014 01:26  AM\u0022 data-short=\u002210 yr\u0022\u003EJanuary 6, 2014\u003C/time\u003E by NovaSilisko\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Mattasmack","CreatedById":62809,"CreatedDateTime":"2014-01-06T03:52:16Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022eggrobin\u0022 data-cite=\u0022eggrobin\u0022\u003E\u003Cdiv\u003EI switched to doing the simulation using a fifth order symplectic integrator (coefficients from \u003Cem\u003EThe accuracy of symplectic integrators\u003C/em\u003E, Robert I. McLachlan and Pau Atela (1992)) that I just wrote in C#: it\u0027s faster, 1 year in 149 s with a 10 s timestep, and it\u0027s symplectic, which can\u0027t be a bad thing.\u003Cp\u003EBelow are some results from a 1-year simulation with a constant 1 s time step, downsampled to 100 s for plotting due to memory usage.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EVery nice! I commend you for your decision to go your own way -- as you\u0027ve already found, writing your own program specially to solve a particular problem usually gives you much better performance than very-general-purpose software. Plus, you become intimately familiar with the numerical method being used and better able to judge when its results are reliable.\u003C/p\u003E\u003Cp\u003EYour relative errors look to be between one and two orders of magnitude lower than mine. And I can\u0027t make mine much smaller by adjusting the time step size; they seem to bottom out at around 10\u003Csup\u003E-14\u003C/sup\u003E - 10\u003Csup\u003E-13\u003C/sup\u003E regardless of the step size or local error limits I set. So I would say you\u0027ve made a good choice of integrator to use.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003E\u003Cp\u003EThe Mun hasn\u0027t quite escaped, as seen from the kinetic energy plot, but is well on its way.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EWhich version of the Alternis system are you showing here? A number of bodies changed from v0.0 to v0.1.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003E\u003Cp\u003E...\u003C/p\u003E\u003Cp\u003EFinding a configuration for the Jool system that makes the Mun more stable would be an interesting exercise.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI think a good first step would be to not put it in a resonant orbit with Kerbin and Laythe!\u003C/p\u003E\n"},{"CreatedByName":"Mattasmack","CreatedById":62809,"CreatedDateTime":"2014-01-06T03:57:45Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022lantay77\u0022 data-cite=\u0022lantay77\u0022\u003E\u003Cdiv\u003EDid you write your own program to do these simulations? They are awesome.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYes, thanks! And, I\u0027ve just cleaned it up to make it publicly available: \u003Ca href=\u0022https://www.dropbox.com/s/39mi6hqq3ve73vt/MLROrbit-v0_1.zip\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://www.dropbox.com/s/39mi6hqq3ve73vt/MLROrbit-v0_1.zip\u003C/a\u003E . It\u0027s a command-line program, not interactive at all. To make the animations, I use the .m files included in that zip file to read the results into Octave and generate a series of plots to be frames for the animation. Then Gimp and it\u0027s animation plugin (GAP) to crop them to the proper size, then ffmpeg to encode them into a movie. I am halfway tempted to put code in the simulator itself to generate the frames directly, but it sounds like a pain and I\u0027m not frustrated enough by the Octave-\u0026gt;Gimp-\u0026gt;ffmpeg process yet to do it.\u003C/p\u003E\u003Cp\u003EIncluded in that zip file are input files for simulating Alternis Kerbol versions 0.0 and 0.1a and 0.1b. I call 0.1a the version with Bop a moon of Jool and 0.1b the version with Bop as a moonlet of Kerbin.\u003C/p\u003E\n"},{"CreatedByName":"Zeggpold","CreatedById":74133,"CreatedDateTime":"2014-01-06T07:23:40Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022cttw\u0022 data-cite=\u0022cttw\u0022\u003E\u003Cdiv\u003EHi, I am trying to use this mod and I am not sure what I am doing wrong but it changes nothing. I put the right folder in gamedata, I see the menu on startup and enable the mod and click apply, but then I start a new game, and the map view and tracking station views show the same old kerbal system. No errors are displayed.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI had the same problem here, running on Linux. Looking though the log files, I found this suspicious looking line:\u003C/p\u003E\u003Cp\u003E[EXC 22:52:45.984] IsolatedStorageException: Could not find a part of the path \u0022/home/player/GameData/AlternisKerbol/PluginData/Heightmaps/tylo_newheight.png\u0022.\u003C/p\u003E\u003Cp\u003EThis is the wrong directory (the file is in the appropriate KSP_linux/GameData/... directory). Some the other textures load correctly, so it looks like the tylo_newheight.png is being loaded differently from the others, and looking at the source I see that it and some other textures are loaded with System.IO.File.ReadAllBytes. And indeed, if I run KSP directly from the KSP_linux directory, everything works. Not sure if that has anything to do with your problem, but I thought I\u0027d mention it.\u003C/p\u003E\n"},{"CreatedByName":"NovaSilisko","CreatedById":3897,"CreatedDateTime":"2014-01-06T08:09:04Z","Content":"\n\u003Cp\u003EWell, what\u0027s different about the heightmaps is they\u0027re loaded using System.IO as opposed to GameDatabase. I guess something about that doesn\u0027t work on linux... (cttw, are you on linux too?)\u003C/p\u003E\n"},{"CreatedByName":"cttw","CreatedById":2670,"CreatedDateTime":"2014-01-06T18:02:27Z","Content":"\n\u003Cp\u003EYes I am on Linux too.\u003C/p\u003E\n"},{"CreatedByName":"cttw","CreatedById":2670,"CreatedDateTime":"2014-01-06T18:05:21Z","Content":"\n\u003Cp\u003EAlso it seems running it from the KSP_linux folder does not work for me or I am doing something subtly wrong. I start KSP with this script\u003C/p\u003E\u003Cp\u003E#!/bin/bash\u003C/p\u003E\u003Cp\u003Ecd /home/username/games/KSP/23/KSP_linux/\u003C/p\u003E\u003Cp\u003E./KSP.x86_64\u003C/p\u003E\u003Cp\u003Ecd -\u003C/p\u003E\n"},{"CreatedByName":"eggrobin","CreatedById":4680,"CreatedDateTime":"2014-01-06T18:17:39Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Mattasmack\u0022 data-cite=\u0022Mattasmack\u0022\u003E\u003Cdiv\u003EVery nice! I commend you for your decision to go your own way -- as you\u0027ve already found, writing your own program specially to solve a particular problem usually gives you much better performance than very-general-purpose software. Plus, you become intimately familiar with the numerical method being used and better able to judge when its results are reliable.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYes, and for once, I have a \u003Cem\u003Ereason\u003C/em\u003E to write an integrator (something that was severely lacking from my Numerical Mathematics courses).\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003E\u003Cp\u003EYour relative errors look to be between one and two orders of magnitude lower than mine. And I can\u0027t make mine much smaller by adjusting the time step size; they seem to bottom out at around 10\u003Csup\u003E-14\u003C/sup\u003E - 10\u003Csup\u003E-13\u003C/sup\u003E regardless of the step size or local error limits I set. So I would say you\u0027ve made a good choice of integrator to use.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EHow do you deal with the accumulation of unit roundoffs? On this kind of number of steps, this can become very significant... I use simple compensated summation when accumulating the steps, but not within the actual Runge Kutta stages. Depending on your number of steps, perhaps doubly compensated summation might be worthwile. I\u0027m very worried about the outliers in the errors in H, p and L though (bear in mind that this is sampled down by a factor of 100, so there are probably more of those). I suspect something is coming to close to 0, though I\u0027m not sure why my integrator goes mad in those circumstances.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003E\u003Cp\u003EWhich version of the Alternis system are you showing here? A number of bodies changed from v0.0 to v0.1.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThis is v0.1, with an added satellite and \u003Cem\u003Eboth\u003C/em\u003E Bop and Boepli. Again, the Mun\u0027s trajectory is highly chaotic, it changes significantly over a year between a 10s and a 1s time step, so I\u0027m not sure much can be deduced from that.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003E\u003Cp\u003EI think a good first step would be to not put it in a resonant orbit with Kerbin and Laythe!\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI think the intent was to replicate the Io-Europa-Ganymede resonance, but that would probably help.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-01-06T18:24:00Z\u0022 title=\u002201/06/2014 06:24  PM\u0022 data-short=\u002210 yr\u0022\u003EJanuary 6, 2014\u003C/time\u003E by eggrobin\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Motokid600","CreatedById":66349,"CreatedDateTime":"2014-01-06T19:01:00Z","Content":"\n\u003Cp\u003EAny update on the stand alone lighting?\u003C/p\u003E\n"},{"CreatedByName":"eggrobin","CreatedById":4680,"CreatedDateTime":"2014-01-06T21:15:47Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Mattasmack\u0022 data-cite=\u0022Mattasmack\u0022\u003E\u003Cdiv\u003EYes, thanks! And, I\u0027ve just cleaned it up to make it publicly available: \u003Ca href=\u0022https://www.dropbox.com/s/39mi6hqq3ve73vt/MLROrbit-v0_1.zip\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://www.dropbox.com/s/39mi6hqq3ve73vt/MLROrbit-v0_1.zip\u003C/a\u003E . \u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI just looked through your code and unless I\u0027m missing something it doesn\u0027t seem like you\u0027re implementing compensated summation. That means you\u0027ll get a very significant accumulation of unit roundoffs, which would explain the higher errors. I would suggest taking a look at \u003Ca href=\u0022http://reference.wolfram.com/mathematica/tutorial/NDSolveSPRK.html#1464293172\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://reference.wolfram.com/mathematica/tutorial/NDSolveSPRK.html#1464293172\u003C/a\u003E (this article is about SPRK methods, but it can also be applied to your integrator; basically, you run your Runge-Kutta step to compute the increments instead of the actual state, and you use compensated summation to add up the increments). There are also a few places where you could shave off an unit roundoff or two, e.g.,\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E      r = 1.0/(dx*dx \u002B dy*dy \u002B dz*dz);\u003Cbr\u003E      r *= sqrt(r);\u003Cbr\u003E      tmp = sys[j].mu*r;\u003Cbr\u003E// Could be:\u003Cbr\u003E      r = (dx*dx \u002B dy*dy \u002B dz*dz);\u003Cbr\u003E      r *= sqrt(r);\u003Cbr\u003E      tmp = sys[j].mu/r;\u003Cbr\u003E// That will cost you a division, as you also do that with sys[i], but you gain an unit roundoff by doing a division instead of an inversion followed by a multiplication.\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003Ebut this is minor.\u003C/p\u003E\u003Cp\u003EIn my simulation over 10 years with a constant 1 s time step (downsampled to 1 ks for plotting), Minmus and Pol escape (Boepli and the satellite are still happily watching the show in highly stable orbits). I\u0027m not sure simulations make much sense with such a chaotic Mun though.\u003C/p\u003E\u003Cp\u003EI looked at the positions and velocities when I get outliers in H, p and L, and they don\u0027t seem to be near 0. I have no idea where these outliers are coming from...\u003C/p\u003E\u003Cp\u003EThere are some close Kerbin approaches by the Mun and Pol. I think the closest Mun approach is either a collision or a Mun-shattering encounter: the closest distance I have is 1351 km center-to-center, which is above the Roche limit of 921 km, but I only sample every 1 ks, so the distances at the datapoints either side of the minimum are 2360 km and 2480 km. A collision is well within the uncertainty.\u003C/p\u003E\u003Cblockquote lang=\u0022en\u0022\u003E\u003Ca href=\u0022//imgur.com/a/l2nW1\u0022 rel=\u0022external nofollow\u0022\u003EJavascript is disabled. View full album\u003C/a\u003E\u003C/blockquote\u003E\n"},{"CreatedByName":"NovaSilisko","CreatedById":3897,"CreatedDateTime":"2014-01-06T21:55:47Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Motokid600\u0022 data-cite=\u0022Motokid600\u0022\u003E\u003Cdiv\u003EAny update on the stand alone lighting?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EWatching SpaceX launch, work will resume after that \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif\u0022 alt=\u0022:P\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Mattasmack","CreatedById":62809,"CreatedDateTime":"2014-01-06T22:59:43Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022eggrobin\u0022 data-cite=\u0022eggrobin\u0022\u003E\u003Cdiv\u003EI just looked through your code and unless I\u0027m missing something it doesn\u0027t seem like you\u0027re implementing compensated summation. That means you\u0027ll get a very significant accumulation of unit roundoffs, which would explain the higher errors. I would suggest taking a look at \u003Ca href=\u0022http://reference.wolfram.com/mathematica/tutorial/NDSolveSPRK.html#1464293172\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://reference.wolfram.com/mathematica/tutorial/NDSolveSPRK.html#1464293172\u003C/a\u003E (this article is about SPRK methods, but it can also be applied to your integrator; basically, you run your Runge-Kutta step to compute the increments instead of the actual state, and you use compensated summation to add up the increments).\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ECorrect, I don\u0027t have any roundoff compensation. I wrote this code initially to simulate ships moving around the KSP solar system with the planets still on rails. \u0027Common wisdom\u0027 on the forum was that this was too computationally intensive to do in the game, and I wanted to put that to the test. So, my focus was on speed and large time steps (so that trajectories could be pre-calculated and then stored), and accuracy just had to be good enough to not produce obviously wrong results in the game. Now I\u0027m using it for something else and these little errors that didn\u0027t matter before ... start to matter. If I do much more with this code I will definitely look into roundoff compensation, but I don\u0027t know if there is enough interest to justify spending much time on it. I\u0027d had a few requests for the code, but now that it\u0027s released I doubt more than 5 or 10 people will care.\u003C/p\u003E\n"},{"CreatedByName":"NovaSilisko","CreatedById":3897,"CreatedDateTime":"2014-01-06T23:21:49Z","Content":"\n\u003Cp\u003ELighting mod now loading values properly, woo\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://i.imgur.com/jf2Edgd.png\u0022 alt=\u0022jf2Edgd.png\u0022\u003E\u003C/p\u003E\u003Cp\u003ESo that makes it saving and loading correctly. Next up: sun lens flare color, then loader GUI, then editor GUI\u003C/p\u003E\n"},{"CreatedByName":"team.leit","CreatedById":68347,"CreatedDateTime":"2014-01-06T23:26:47Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022NovaSilisko\u0022 data-cite=\u0022NovaSilisko\u0022\u003E\u003Cdiv\u003ELighting mod now loading values properly, woo\u003Cp\u003E\u003Ca href=\u0022http://i.imgur.com/jf2Edgd.png\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://i.imgur.com/jf2Edgd.png\u003C/a\u003E\u003C/p\u003E\u003Cp\u003ESo that makes it saving and loading correctly. Next up: sun lens flare color, then loader GUI, then editor GUI\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ENice choice of colors, but I think it proves your point\u003C/p\u003E\n"}]}