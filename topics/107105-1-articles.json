{"TopicId":107105,"ForumId":36,"TopicTitle":"[1.0.2] Sentinel Memory Monitoring Utility (v0.3 Beta)","CreatedByName":"Zeenobit","CreatedById":125578,"CreatedDateTime":"2015-05-03T07:35:23Z","PageNum":1,"Articles":[{"CreatedByName":"Zeenobit","CreatedById":125578,"CreatedDateTime":"2015-05-03T07:35:23Z","Content":"**Sentinel Memory Monitoring Utility**\n\n**Version 0.3 Beta for KSP 1.0.2**\n\n*Brought to you by the Kerbal Space Exploration Agency:*\n\n![L7rpnwm.png](http://i.imgur.com/L7rpnwm.png)\n\nThis lightweight utility mod simply monitors your KSP memory usage and if it crosses pre-defined percentages, it slaps a warning text on your screen. This way you can save your progress and restart KSP, or do anything else you need to do before KSP just gives up and ruins your perfect rescue mission.\n\nInspired by [GCMonitor](https://forum.kerbalspaceprogram.com/threads/92907-GCMonitor-1-2-3-A-graphic-Memory-monitor-%28Feb-22th%29), which is a much more elaborate tool (and definitely recommended if you\u0027re looking for a more elaborate memory monitoring utility), Sentinel also uses the same native library to grab the KSP process memory usage. All credit goes to [sarbian](https://forum.kerbalspaceprogram.com/members/58857-sarbian) and the original author for this method.\n\nThe differences between Sentinel and GCMonitor are:\n\n- Sentinel is much more lightweight without any additional changes other than the warning messages.\n- Sentinel is also a developers tool that can notify other plugins when memory limits are being reached.\n\n**Please do keep in mind that this mod is not currently compatible with GCMonitor. You can have one or the other, not both.**\n\n**Download:** \u003Clink snipped=\u0022\u0022 pending=\u0022\u0022 source=\u0022\u0022 availability=\u0022\u0022\u003E\n\n**License:** [GNU General Public License](https://www.gnu.org/copyleft/gpl.html)\n\n\u003E \n\u003E **Sentinel Version 0.3 Beta**\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E \n\u003E - Full re-write of the code for a more data-driven approach\n\u003E - Custom situation support\n\u003E - Automatic game pause support during flight\n\u003E - Custom notification settings\n\u003E - Settings file version tracking\n\u003E - Launcher button to suppress notifications and indicate situation\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E \n\nInstallation:\n\n1. Download the zip file from the link above\n2. Unzip the contents into your KSP installation directory\n\n**Notification Mechanism**\n\n\u003E [Javascript is disabled. View full album](//imgur.com/a/5SCcK)\n\nIn order to notify players when they should prepare for exceeding the memory limit, Sentinel can warn the user when they approach pre-defined situations. By default, Sentinel has two situations: Distressed (usage over 70%), and Critical (usage over 80%). You can define custom situations or tweak existing ones using the settings file.\n\nWhen memory usage is over the situation percentage value, depending on the situation configuration, Sentinel performs various actions. These actions may include showing a notification text or pausing the game while in flight.\n\nThe settings file is located in *GameData\\KSEA\\Sentinel\\Sentinel.cfg*.\n\n**Events**\n\nSentinel is designed to allow other mod developers to easy perform tasks when memory usage reaches player-defined levels. For example, a plugin could perform any last minute saves and prepare for a shutdown or free up unnecessary resources to lower memory usage.\n\nIn order to listen to Sentinel memory events, you must first reference *GameData/KSEA/Sentinel/Sentinel.dll* in your project. Then, listening to the event is simply a matter of registering a delegate to the *KSEA.Sentinel.OnSituation* event.\n\nExample:\n\n    using UnityEngine;using KSEA;namespace Sample{    public class Sample    {        public Sample()        {            Sentinel.OnSituation \u002B= Sentinel_OnSituation;        }        private void Sentinel_OnSituation(Sentinel.Situation situation)        {            // ...        }    }}\n\n**Planned Features:**\n\n- Potentially a GUI configuration interface, although that might go against the intended design of this mod being lightweight.\n- Compatibility with GCMonitor\n\n**Disclaimer:** This is my first mod, and I\u0027m hoping to help the community as best as I can, because without the modding community, KSP means very little to me. It is more of a learning experience rather than the next hit mod. Any feedback would be much appreciated, and use it at your own risk. ![:P](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif)\n\n**Edited \u003Ctime datetime=\u00222015-07-22T12:06:54Z\u0022 title=\u002207/22/2015 12:06  PM\u0022 data-short=\u00228 yr\u0022\u003EJuly 22, 2015\u003C/time\u003E by Red Iron Crown**"},{"CreatedByName":"Nansuchao","CreatedById":135151,"CreatedDateTime":"2015-05-03T07:50:34Z","Content":"This will be very useful, congratulations. The new KSP uses much less memory, so it\u0027s easy to add more and more mods until it becomes unplayable."},{"CreatedByName":"Zeenobit","CreatedById":125578,"CreatedDateTime":"2015-05-03T16:00:22Z","Content":"\u003E \n\u003E This will be very useful, congratulations. The new KSP uses much less memory, so it\u0027s easy to add more and more mods until it becomes unplayable.\n\nThank you! ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\n**Version 0.2** Uploaded (Check OP for Download):\n\n- Adjusted the notification text to be less verbose and more noticeable\n- Changed default refresh period to 1 second\n- Added to KerbalStuff"},{"CreatedByName":"Nansuchao","CreatedById":135151,"CreatedDateTime":"2015-05-03T16:47:51Z","Content":"Ok, I tried hit, and it works as said. If I can suggest something, it will be good to stop the message of warning if willed. I received the Critical Warning and I finished my mission (dock, transfer crew and re-entry on Kerbin from LKO) with the red message in the center of my screen. When it was displayed at first, I made a Quicksave but was unable a way to hide the message.\n\nBtw, very good work!"},{"CreatedByName":"Zeenobit","CreatedById":125578,"CreatedDateTime":"2015-05-03T17:14:35Z","Content":"\u003E \n\u003E Ok, I tried hit, and it works as said. If I can suggest something, it will be good to stop the message of warning if willed. I received the Critical Warning and I finished my mission (dock, transfer crew and re-entry on Kerbin from LKO) with the red message in the center of my screen. When it was displayed at first, I made a Quicksave but was unable a way to hide the message.\n\u003E Btw, very good work!\n\nThat\u0027s a good idea. Although I want to avoid having any GUI elements to make it as minimal as possible. I\u0027ll see if I can work in a customization shortcut key to disable it."},{"CreatedByName":"Nansuchao","CreatedById":135151,"CreatedDateTime":"2015-05-03T18:06:50Z","Content":"Maybe an icon on the stock toolbar that appears on alarm on. You click on hit and disable the warning message."},{"CreatedByName":"SpeedyB","CreatedById":76386,"CreatedDateTime":"2015-05-03T18:11:49Z","Content":"It might be good to have an option for message position. Middle of the screen is attention grabbing but a little annoying. A good place for it would be near the top of the screen just below the gauges, that way its out of your main view and still super visible."},{"CreatedByName":"talung","CreatedById":121133,"CreatedDateTime":"2015-05-04T15:18:20Z","Content":"I have been using this mod today for a number of hours.. and I think it might have its own memory leak. I was hitting up to 3.5GB usage (Task Manager) with it.. and tended to hover around 2.7GB to 3GB without it. Same mods, same career path with same ships.\n\nCould just be my setup. If you need any logs etc. I could probably send it to you.. but I am not using your addon atm. \n\nExcellent and most wanted mod of course. ![:D](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif)"},{"CreatedByName":"Zeenobit","CreatedById":125578,"CreatedDateTime":"2015-05-05T00:54:52Z","Content":"\u003E \n\u003E Maybe an icon on the stock toolbar that appears on alarm on. You click on hit and disable the warning message.\n\nI might try that. I\u0027m thinking of having the text message show up, but then changing the color of the toolbar icon to indicate the situation after you dismiss the text.\n\n\u003E \n\u003E It might be good to have an option for message position. Middle of the screen is attention grabbing but a little annoying. A good place for it would be near the top of the screen just below the gauges, that way its out of your main view and still super visible.\n\nThat\u0027s on my To Do list already. I\u0027m thinking making it configurable with 33% from the top of the screen by default.\n\n\u003E \n\u003E I have been using this mod today for a number of hours.. and I think it might have its own memory leak. I was hitting up to 3.5GB usage (Task Manager) with it.. and tended to hover around 2.7GB to 3GB without it. Same mods, same career path with same ships.\n\u003E Could just be my setup. If you need any logs etc. I could probably send it to you.. but I am not using your addon atm. \n\u003E \n\u003E Excellent and most wanted mod of course. ![:D](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif)\n\nI\u0027m not quite sure how this is possible since the mod does next-to-nothing until the memory usage crosses the limits. Even if it does leak, the leak wouldn\u0027t be noticeable at all, let alone 0.5 GB. I\u0027ll investigate it before the next update, but did you get this behavior consistently with multiple tries?"},{"CreatedByName":"talung","CreatedById":121133,"CreatedDateTime":"2015-05-05T01:22:26Z","Content":"\u003E \n\u003E I\u0027m not quite sure how this is possible since the mod does next-to-nothing until the memory usage crosses the limits. Even if it does leak, the leak wouldn\u0027t be noticeable at all, let alone 0.5 GB. I\u0027ll investigate it before the next update, but did you get this behavior consistently with multiple tries?\n\nUnfortunately yes.. I got it with multiple tries until I removed it.. and then my memory stayed down. Again, could be an interaction of another addon and this, but the problem did resolve after I removed Sentinel. If you would like I could share (privately) my GameData and Career Save I was using for your testing."},{"CreatedByName":"Zeenobit","CreatedById":125578,"CreatedDateTime":"2015-05-05T05:22:22Z","Content":"\u003E \n\u003E Unfortunately yes.. I got it with multiple tries until I removed it.. and then my memory stayed down. Again, could be an interaction of another addon and this, but the problem did resolve after I removed Sentinel. If you would like I could share (privately) my GameData and Career Save I was using for your testing.\n\nSure. PM me with what you can. So far, I can\u0027t reproduce this leak on my end."},{"CreatedByName":"Zeenobit","CreatedById":125578,"CreatedDateTime":"2015-05-06T04:29:56Z","Content":"**Version 0.3 Beta** Uploaded. Click the link in OP to download.\n\n- Full re-write of the code for a more data-driven approach\n- Custom situation support\n- Automatic game pause support during flight\n- Custom notification settings\n- Settings file version tracking\n- Launcher button to suppress notifications and indicate situation\n\nI haven\u0027t been able to reproduce any memory leak issues so far. So nothing to fix on that front! ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)"},{"CreatedByName":"talung","CreatedById":121133,"CreatedDateTime":"2015-05-06T07:54:15Z","Content":"\u003E \n\u003E **Version 0.3 Beta** Uploaded. Click the link in OP to download.\n\u003E \n\u003E \n\u003E - Full re-write of the code for a more data-driven approach\n\u003E - Custom situation support\n\u003E - Automatic game pause support during flight\n\u003E - Custom notification settings\n\u003E - Settings file version tracking\n\u003E - Launcher button to suppress notifications and indicate situation\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E I haven\u0027t been able to reproduce any memory leak issues so far. So nothing to fix on that front! ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\nThanks. I have been messing around with addons.. again... and will try this version out. Let you know if I discover anything new.. Chances are it was just a fluke on my side with one of the other addons. Unfortunate that we cannot get a detailed list of memory usage."},{"CreatedByName":"talung","CreatedById":121133,"CreatedDateTime":"2015-05-08T10:45:14Z","Content":"Quick Update. \n\nIt appears that the heat gauges and \u0022science alert\u0022 have memory leaks. This is probably what I was seeing and not your addon. Maybe I was just doing slightly different things that was causing it when I was playing with and without your addon.\n\nJust thought you should know.\n\nCheers"},{"CreatedByName":"Akira_R","CreatedById":117470,"CreatedDateTime":"2015-05-08T23:19:41Z","Content":"Any chance you can implement the ability to have it do an automatic quicksave if you are in flight and in a situation where you can quick save? I really like the configure ability of this and having this option as well as the pause option would be great!"},{"CreatedByName":"mrsnoid","CreatedById":104715,"CreatedDateTime":"2015-05-09T03:44:45Z","Content":"Nice mod, I\u0027ve experimented with an old ram optimizer and whenever Sentinel changes in the yellow alert, I push a hotkey and the optimizer (RAMRush) does its job and bring Sentinel back in white safety. No yellow or red warnings anymore! No crashes, stable for a few hours with 70% of RAM during the start KSP and after the clean-up RAM of less than 70% for hours."},{"CreatedByName":"Zeenobit","CreatedById":125578,"CreatedDateTime":"2015-05-09T04:28:44Z","Content":"\u003E \n\u003E Quick Update. \n\u003E It appears that the heat gauges and \u0022science alert\u0022 have memory leaks. This is probably what I was seeing and not your addon. Maybe I was just doing slightly different things that was causing it when I was playing with and without your addon.\n\u003E \n\u003E Just thought you should know.\n\u003E \n\u003E Cheers\n\nGood to hear. More for myself than you. ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\n\u003E \n\u003E Any chance you can implement the ability to have it do an automatic quicksave if you are in flight and in a situation where you can quick save? I really like the configure ability of this and having this option as well as the pause option would be great!\n\nThat\u0027s actually a big feature I\u0027m trying to implement. Unfortunately, it\u0027s being a lot trickier than I thought. Mainly because KSP doesn\u0027t really enjoy kicking a quicksave immediately when you load into flight mode (which is when the biggest memory fluctuations happen). I\u0027d have to somehow add strict conditions to only quick save if you\u0027ve been X minutes into flight or something along those lines.\n\n\u003E \n\u003E Nice mod, I\u0027ve experimented with an old ram optimizer and whenever Sentinel changes in the yellow alert, I push a hotkey and the optimizer (RAMRush) does its job and bring Sentinel back in white safety. No yellow or red warnings anymore! No crashes, stable for a few hours with 70% of RAM during the start KSP and after the clean-up RAM of less than 70% for hours.\n\nExcellent! ![:D](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif)"},{"CreatedByName":"Zeenobit","CreatedById":125578,"CreatedDateTime":"2015-05-12T03:53:17Z","Content":"\u003E \n\u003E Nice mod, I\u0027ve experimented with an old ram optimizer and whenever Sentinel changes in the yellow alert, I push a hotkey and the optimizer (RAMRush) does its job and bring Sentinel back in white safety. No yellow or red warnings anymore! No crashes, stable for a few hours with 70% of RAM during the start KSP and after the clean-up RAM of less than 70% for hours.\n\nJust wanted to re-quote this post. I do not intend to update this mod anymore as it\u0027s made obsolete by RAMRush. I searched for this RAMRush utility and it is astonishingly effective.\n\nCurrently, with a very mod-heavy load out (82 folders under GameData, yes, that\u0027s my metric for mod density), at the main menu, I\u0027m at 2 GB memory usage with ATM and OpenGL.\n\nThen I simply open RAMRush and let it do its thing.\n\nIt drops my usage to exactly 130 MB. ![:confused:](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_huh.gif)\n\nThat\u0027s all you have to do. During normal gameplay, my memory never goes over 1.5 GB usage. I\u0027m not quite sure how RAMRush works, but I know that Unity is rather generous when it comes to garbage collection in favour of runtime performance. It is entirely possible this program forces a GC cycle. But this entirely a speculation.\n\nYou can download the application here:\n\n[http://www.fcleaner.com/ramrush.htm](http://www.fcleaner.com/ramrush.htm)\n\nI suggest anyone frustrated of memory issues in KSP to try it. All credit goes to **mrsnoid** for finding this gem. ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)"},{"CreatedByName":"smunisto","CreatedById":57789,"CreatedDateTime":"2015-05-12T07:06:03Z","Content":"It is a bit unclear what RamRush does and how exactly does it find KSP in order to optimize it\u0027s RAM usage. Does it tap into Unity or hook into KSP somehow? Do you point it to the program you want optimized? Are you sure it doesn\u0027t do this by unloading assets that are otherwise needed?"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2015-05-12T08:18:33Z","Content":"Those soft have nothing to do with Garbage Collection. They just push memory to the swap. If you look at KSP virtual memory instead of the resident use you see that the memory is still here. It is pure snake oil."},{"CreatedByName":"smunisto","CreatedById":57789,"CreatedDateTime":"2015-05-12T08:36:17Z","Content":"Yeah, that is what I thought, it can\u0027t tap into KSP directly. It\u0027s probably just pushing stuff to the pagefile. I remember we used such stuff back when Win 98 was still a thing."},{"CreatedByName":"Zeenobit","CreatedById":125578,"CreatedDateTime":"2015-05-12T18:47:46Z","Content":"\u003E \n\u003E Those soft have nothing to do with Garbage Collection. They just push memory to the swap. If you look at KSP virtual memory instead of the resident use you see that the memory is still here. It is pure snake oil.\n\nResults suggest it\u0027s not though. I managed to play over 5 hours continuously yesterday with just running RAMRush once at the start of KSP, which is something I was never able to do with KSP always crashing after one or two missions with my heavy mod loadout. I was very skeptical myself at first. If it\u0027s .NET based, it is entirely possible that it kicks off the GC. If it pushes physical memory to virtual, it would make a lot of sense. And it would reduce performance if it actually does that, unless you are running on a high performance SSD as I am.\n\nIn regards to unloading any assets that are actually needed by KSP, I have not seen it, and I\u0027m not sure that\u0027s possible, with GC or without. Unity manages the assets, and it has it\u0027s own rules on what to keep or not to keep. Unless the third party software communicates directly with Unity, it has no way of locating assets generically, causing immediate memory corruption if it tried it.\n\n- - - Updated - - -\n\nAnother possibility might have to with the \\*.dds texture format. If the textures are pushed directly to GPU memory, there is no reason why they should take up space on the system RAM and they might just be garbage waiting to be collected after they were loaded in and processed by Unity. I\u0027m not expert on GPU memory though, so this is just a guess."},{"CreatedByName":"Kolago","CreatedById":103729,"CreatedDateTime":"2015-05-14T14:39:35Z","Content":"Is this normal?\n\n    Failed to load assembly C:\\Kerbal Space Program 1.0\\GameData\\KSEA\\Sentinel\\Native\\getRSS_x86.dll:System.BadImageFormatException: Format of the executable (.exe) or library (.dll) is invalid.  at Mono.Cecil.PE.ImageReader.ReadOptionalHeaders (System.UInt16\u0026 subsystem, System.UInt16\u0026 dll_characteristics) [0x00000] in :0   at Mono.Cecil.PE.ImageReader.ReadImage () [0x00000] in :0   at Mono.Cecil.PE.ImageReader.ReadImageFrom (System.IO.Stream stream) [0x00000] in :0   at Mono.Cecil.ModuleDefinition.ReadModule (System.IO.Stream stream, Mono.Cecil.ReaderParameters parameters) [0x00000] in :0   at Mono.Cecil.ModuleDefinition.ReadModule (System.String fileName, Mono.Cecil.ReaderParameters parameters) [0x00000] in :0   at Mono.Cecil.ModuleDefinition.ReadModule (System.String fileName) [0x00000] in :0   at AssemblyLoader.ScanForBadTypeRefs (System.String file) [0x00000] in :0   at AssemblyLoader.LoadExternalAssembly (System.String file) [0x00000] in :0"},{"CreatedByName":"smunisto","CreatedById":57789,"CreatedDateTime":"2015-05-14T15:02:52Z","Content":"\u003E \n\u003E Results suggest it\u0027s not though. I managed to play over 5 hours continuously yesterday with just running RAMRush once at the start of KSP, which is something I was never able to do with KSP always crashing after one or two missions with my heavy mod loadout. I was very skeptical myself at first. If it\u0027s .NET based, it is entirely possible that it kicks off the GC. If it pushes physical memory to virtual, it would make a lot of sense. And it would reduce performance if it actually does that, unless you are running on a high performance SSD as I am.\n\u003E In regards to unloading any assets that are actually needed by KSP, I have not seen it, and I\u0027m not sure that\u0027s possible, with GC or without. Unity manages the assets, and it has it\u0027s own rules on what to keep or not to keep. Unless the third party software communicates directly with Unity, it has no way of locating assets generically, causing immediate memory corruption if it tried it.\n\u003E \n\u003E - - - Updated - - -\n\u003E \n\u003E Another possibility might have to with the \\*.dds texture format. If the textures are pushed directly to GPU memory, there is no reason why they should take up space on the system RAM and they might just be garbage waiting to be collected after they were loaded in and processed by Unity. I\u0027m not expert on GPU memory though, so this is just a guess.\n\nAfter some tests, RamRush does not stop the game from crashing, and also distorts some planets ground textures. My Kerbin\u0027s grass texture became wavy."},{"CreatedByName":"Muhahahahaz","CreatedById":144234,"CreatedDateTime":"2015-05-17T03:13:07Z","Content":"Is there a way to have it constantly display the memory usage? Maybe with a toggle?\n\nOtherwise, I still need to switch to Windows Task Manager."}]}