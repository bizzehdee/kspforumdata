{"TopicId":103963,"ForumId":36,"TopicTitle":"[WIP][1.9.x-1.12.x] Scatterer-atmospheric scattering (0.0838 - 14/08/2022) Scattering improvements, in-game atmo generation and multi-sun support","CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-04-12T08:37:35Z","PageNum":122,"Articles":[{"CreatedByName":"Errol","CreatedById":118622,"CreatedDateTime":"2016-01-23T20:53:12Z","Content":"Does this also mean we can have shadows on rings, like for OPM or something?"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2016-01-23T21:07:20Z","Content":"\u003E \n\u003E \n\u003E 2 hours ago, Errol said:\n\u003E \n\u003E \n\u003E Does this also mean we can have shadows on rings, like for OPM or something?\n\u003E \n\nWell, rbray was working on a \u0022universal\u0022 planet shadows shader, however they don\u0027t work with the scatterer atmospheres which why I\u0027m doing these now. You could check with him If his implementation works with rings.\n\nHowever I was also experimenting with my own rings shader a while back which handles it\u0027s planet shadow internally. This was a quick try and I haven\u0027t finished it yet but I plan to get back to it\n\n[http://i.imgur.com/b0UR1Xc.png](http://i.imgur.com/b0UR1Xc.png)\n\n [http://i.imgur.com/0BkSC62.png](http://i.imgur.com/0BkSC62.png) (ignore the clipped polygon up top)\n\nEdited: Progress on the eclipse shader\n\nHere are what eclipses in the kerbin-mun system look like with different size settings for the mun and the sun\n\n\u003Ciframe class=\u0022imgur-album\u0022 frameborder=\u00220\u0022 height=\u0022550\u0022 src=\u0022//imgur.com/a/YMxcB/embed?background=ffffff\u0026text=1a1a1a\u0026link=4e76c9\u0022 width=\u0022100%\u0022\u003E\u003C/iframe\u003E\n\n**Edited \u003Ctime datetime=\u00222016-01-23T23:46:40Z\u0022 title=\u002201/23/2016 11:46  PM\u0022 data-short=\u00228 yr\u0022\u003EJanuary 23, 2016\u003C/time\u003E by blackrack**"},{"CreatedByName":"skykooler","CreatedById":60459,"CreatedDateTime":"2016-01-24T03:00:35Z","Content":"Wow! The second-to-last picture looks amazingly ominous, I suppose because the sky is dark but the ground lighting is still full-power."},{"CreatedByName":"TyrannoFan","CreatedById":87395,"CreatedDateTime":"2016-01-24T17:20:04Z","Content":"Amazing! I\u0027ve always wanted eclipse shadows, they just look so epic. I assume that there needs to be more tweaking before it\u0027s ready, and of course making the terrain darken under the eclipse shadow. EVE darkens the terrain under cloud shadows, so I\u0027m sure it\u0027s possible. Would it work together with EVE though? For example, would eclipse shadows also darken cloud layers and would their ground shadows smoothly mesh together with cloud shadows?"},{"CreatedByName":"Poodmund","CreatedById":128643,"CreatedDateTime":"2016-01-24T18:21:58Z","Content":"\u003E \n\u003E \n\u003E On 1/23/2016 at 11:47 AM, blackrack said:\n\u003E \n\u003E \n\u003E Here we go, gas giants bug fix: [https://mega.nz/#!XY5TEYoa!wy6lgQT5VFPRfjPSEOK8NsKOd8ZWsDZq6B6WVz0PkI0](https://mega.nz/#!XY5TEYoa!wy6lgQT5VFPRfjPSEOK8NsKOd8ZWsDZq6B6WVz0PkI0)\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E I\u0027ll try to fix a few other bugs then put up a proper release.\n\u003E \n\nSeems to be working fine. ![:D](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif \u0022:D\u0022)"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2016-01-24T18:47:37Z","Content":"\u003E \n\u003E \n\u003E 43 minutes ago, Poodmund said:\n\u003E \n\u003E \n\u003E Seems to be working fine. ![:D](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif \u0022:D\u0022)\n\u003E \n\nGreat, does the rim fix also work?\n\nEdited:\n\n\u003E \n\u003E \n\u003E 1 hour ago, TyrannoFan said:\n\u003E \n\u003E \n\u003E Amazing! I\u0027ve always wanted eclipse shadows, they just look so epic. I assume that there needs to be more tweaking before it\u0027s ready, and of course making the terrain darken under the eclipse shadow. EVE darkens the terrain under cloud shadows, so I\u0027m sure it\u0027s possible. Would it work together with EVE though? For example, would eclipse shadows also darken cloud layers and would their ground shadows smoothly mesh together with cloud shadows?\n\u003E \n\nNot sure how to handle this yet. The terrain isn\u0027t currenlty darkened and since I\u0027m planning to add planetshine/multiple suns pretty sure the best way to do both is to somehow obtain the original terrain shaders and modify them or build some new terrain shaders. Rbray was also working on something like this [https://www.reddit.com/r/KerbalSpaceProgram/comments/3s3m9g/working_on_celestial_shadows/](https://www.reddit.com/r/KerbalSpaceProgram/comments/3s3m9g/working_on_celestial_shadows/) , and his approach is different and handles terrain darkening but also doesn\u0027t work with the scatterer atmospheres. Not sure if he got it working with clouds though at the time. I can make the EVE clouds go dark when seen from orbit but ground view remains a problem. I could also add the code I\u0027m using to the EVE clouds shader, it\u0027d result in some calculations being done twice but it\u0027d work.\n\n\u003E \n\u003E \n\u003E 16 hours ago, skykooler said:\n\u003E \n\u003E \n\u003E Wow! The second-to-last picture looks amazingly ominous, I suppose because the sky is dark but the ground lighting is still full-power.\n\u003E \n\nWell the ground (PQS) isn\u0027t affected yet so there\u0027s that. The scaledspace darkening is faked in the extinction shader, I suppose a similar approach would also work for the the PQS if I was to try it but it\u0027d also be depth-buffer based.\n\n**Edited \u003Ctime datetime=\u00222016-01-24T19:05:31Z\u0022 title=\u002201/24/2016 07:05  PM\u0022 data-short=\u00228 yr\u0022\u003EJanuary 24, 2016\u003C/time\u003E by blackrack**"},{"CreatedByName":"skykooler","CreatedById":60459,"CreatedDateTime":"2016-01-25T19:02:22Z","Content":"Using the depth buffer might be a good idea, because it would also darken things using shaders other than the terrain shader (e.g. the KSC, or vessels)."},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2016-01-25T19:45:36Z","Content":"\u003E \n\u003E \n\u003E 2 hours ago, skykooler said:\n\u003E \n\u003E \n\u003E Using the depth buffer might be a good idea, because it would also darken things using shaders other than the terrain shader (e.g. the KSC, or vessels).\n\u003E \n\nYeah but so far using the depth buffer has also been causing lots of artifacts and other precision issues.\n\nEdited: First try at godrays.\n\nI obviously messed up a few important things but still, it kind of works. \n\n![pvRS8Wc.jpg](http://i.imgur.com/pvRS8Wc.jpg)\n\n**Edited \u003Ctime datetime=\u00222016-01-25T21:05:58Z\u0022 title=\u002201/25/2016 09:05  PM\u0022 data-short=\u00228 yr\u0022\u003EJanuary 25, 2016\u003C/time\u003E by blackrack**"},{"CreatedByName":"Nhawks17","CreatedById":32999,"CreatedDateTime":"2016-01-25T23:24:19Z","Content":"My heart can only take so much from this mod. For the love of all that is good and kerbal Blackrack you are absolutely a miracle worker. To think this is all happening in KSP is astonishing."},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2016-01-25T23:25:44Z","Content":"Here are some fresh screens for you, still a lot to figure out and many issues to fix though.\n\n\u003Ciframe class=\u0022imgur-album\u0022 frameborder=\u00220\u0022 height=\u0022550\u0022 src=\u0022//imgur.com/a/ESc0l/embed?background=ffffff\u0026text=1a1a1a\u0026link=4e76c9\u0022 width=\u0022100%\u0022\u003E\u003C/iframe\u003E\n\nEdited: Images are a bit dark so the effect may not be visible depending on your screen brightness.\n\n**Edited \u003Ctime datetime=\u00222016-01-26T12:05:26Z\u0022 title=\u002201/26/2016 12:05  PM\u0022 data-short=\u00228 yr\u0022\u003EJanuary 26, 2016\u003C/time\u003E by blackrack**"},{"CreatedByName":"RaffaCT14","CreatedById":152708,"CreatedDateTime":"2016-01-26T00:00:36Z","Content":"Hi guys, I have this problem.\n\n![image.jpg](http://s7.postimg.org/zg2o1kta3/image.jpg)\n\n![image.jpg](http://s18.postimg.org/mmquih2x5/image.jpg)\n\n![image.jpg](http://s7.postimg.org/j57m2dn3v/image.jpg)\n\n![image.jpg](http://s7.postimg.org/ttbd17x2z/image.jpg)\n\nToo much resolution for the ocean, I see all the detailed waves even at maximum height. I have the 1.0.5 version clean with only scattered, opengl and popup window. Can you help me?\n\n**Edited \u003Ctime datetime=\u00222016-01-26T00:03:04Z\u0022 title=\u002201/26/2016 12:03  AM\u0022 data-short=\u00228 yr\u0022\u003EJanuary 26, 2016\u003C/time\u003E by RaffaCT14**"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2016-01-26T00:09:10Z","Content":"\u003E \n\u003E \n\u003E 7 minutes ago, RaffaCT14 said:\n\u003E \n\u003E \n\u003E Hi guys, I have this problem.\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E [![image.jpg](http://s7.postimg.org/zg2o1kta3/image.jpg)](http://s7.postimg.org/zg2o1kta3/image.jpg \u0022Enlarge image\u0022)\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E [![image.jpg](http://s18.postimg.org/mmquih2x5/image.jpg)](http://s18.postimg.org/mmquih2x5/image.jpg \u0022Enlarge image\u0022)\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E [![image.jpg](http://s7.postimg.org/j57m2dn3v/image.jpg)](http://s7.postimg.org/j57m2dn3v/image.jpg \u0022Enlarge image\u0022)\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E [![image.jpg](http://s7.postimg.org/ttbd17x2z/image.jpg)](http://s7.postimg.org/ttbd17x2z/image.jpg \u0022Enlarge image\u0022)\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E  \n\u003E \n\u003E \n\u003E \n\u003E \n\u003E Too much resolution for the ocean, I see all the detailed waves even at maximum height. I have the 1.0.5 version clean with only scattered, opengl and popup window. Can you help me?\n\u003E \n\nThere\u0027s a variable in one of the config files that says fakeoceanaltitude or oceandeactivatealtitude, try changing its value and see if it does anything."},{"CreatedByName":"RaffaCT14","CreatedById":152708,"CreatedDateTime":"2016-01-26T00:15:48Z","Content":"Thank you very much for the fast reply!\n\nI have the same problem, but now the ocean disappears at a lower altitude than before.\n\n![image.jpg](http://s10.postimg.org/ejf2o07i1/image.jpg)"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2016-01-26T00:39:25Z","Content":"\u003E \n\u003E \n\u003E 21 minutes ago, RaffaCT14 said:\n\u003E \n\u003E \n\u003E Thank you very much for the fast reply!\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E I have the same problem, but now the ocean disappears at a lower altitude than before.\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E [![image.jpg](http://s10.postimg.org/ejf2o07i1/image.jpg)](http://s10.postimg.org/ejf2o07i1/image.jpg \u0022Enlarge image\u0022)\n\u003E \n\nWell my idea was to make it higher so they have more room to merge \u0022smoothly\u0022. Other than that I\u0027m not sure what\u0027s going on, it looks like you\u0027re getting some kind of \u0022noise\u0022 which I haven\u0027t seen before."},{"CreatedByName":"V8jester","CreatedById":136093,"CreatedDateTime":"2016-01-26T01:21:18Z","Content":"\u003E \n\u003E \n\u003E 1 hour ago, blackrack said:\n\u003E \n\u003E \n\u003E Here are some fresh screens for you, still a lot to figure out and many issues to fix though.\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E \u003Ciframe class=\u0022imgur-album\u0022 frameborder=\u00220\u0022 height=\u0022550\u0022 src=\u0022//imgur.com/a/ESc0l/embed?background=ffffff\u0026text=1a1a1a\u0026link=4e76c9\u0022 width=\u0022100%\u0022\u003E\u003C/iframe\u003E\n\u003E \n\nThis looks outstanding! Shadows behind the mountains! I can\u0027t believe how far Scatterer has come man."},{"CreatedByName":"daniel l.","CreatedById":57763,"CreatedDateTime":"2016-01-26T11:25:44Z","Content":"Any plans on making the foamy frothy turbulent waters that you find on the shore? like this?\n\n![shoreline-cr.jpg](http://artistinoz.com/wp-content/uploads/2012/10/shoreline-cr.jpg)\n\nit would certainly be cool."},{"CreatedByName":"sashan","CreatedById":98897,"CreatedDateTime":"2016-01-26T11:35:35Z","Content":"\u003E \n\u003E \n\u003E 12 hours ago, blackrack said:\n\u003E \n\u003E \n\u003E Here are some fresh screens for you, still a lot to figure out and many issues to fix though.\n\u003E \n\nThat just screams for dynamically adjusting ambient lightning level for crafts basing on current light level in the atmosphere at the spot where the craft is."},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2016-01-26T12:07:14Z","Content":"\u003E \n\u003E \n\u003E 40 minutes ago, daniel l. said:\n\u003E \n\u003E \n\u003E Any plans on making the foamy frothy turbulent waters that you find on the shore? like this?\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E it would certainly be cool.\n\u003E \n\nMaybe later on. Don\u0027t have any good ideas for this right now."},{"CreatedByName":"Poodmund","CreatedById":128643,"CreatedDateTime":"2016-01-26T13:30:51Z","Content":"Using the latest dev build and files that you have posted here, Blackrack, I have just noticed I am getting this old bug again: [http://i.imgur.com/2WFN83j.png](http://i.imgur.com/2WFN83j.png), where the Scatterer effect renders ahead of any planets in front. I though that this got squished a while back?\n\nEDIT: After a little poking (and I know this is technically outside your remit but) this seems to be happening when orbiting Urlum (Outer Planets Mod) and a body is passed between it and the camera. When I switch the craft to orbit Polta the \u0027mask\u0027 effect immediately disappears. Is there something that should be added to any further added bodies to remedy this?\n\n**Edited \u003Ctime datetime=\u00222016-01-26T13:41:36Z\u0022 title=\u002201/26/2016 01:41  PM\u0022 data-short=\u00228 yr\u0022\u003EJanuary 26, 2016\u003C/time\u003E by Poodmund**"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2016-01-26T14:25:24Z","Content":"\u003E \n\u003E \n\u003E 54 minutes ago, Poodmund said:\n\u003E \n\u003E \n\u003E Using the latest dev build and files that you have posted here, Blackrack, I have just noticed I am getting this old bug again: [http://i.imgur.com/2WFN83j.png](http://i.imgur.com/2WFN83j.png), where the Scatterer effect renders ahead of any planets in front. I though that this got squished a while back?\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E EDIT: After a little poking (and I know this is technically outside your remit but) this seems to be happening when orbiting Urlum (Outer Planets Mod) and a body is passed between it and the camera. When I switch the craft to orbit Polta the \u0027mask\u0027 effect immediately disappears. Is there something that should be added to any further added bodies to remedy this?\n\u003E \n\nDoes this happen outside the map view?"},{"CreatedByName":"Poodmund","CreatedById":128643,"CreatedDateTime":"2016-01-26T15:03:27Z","Content":"I couldn\u0027t test that situation (I couldn\u0027t set up an orbit/alignment case to test ![:(](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_sad.gif \u0022:(\u0022) ), I would think its almost very-improbably as what I found is that it depends on altitude of orbit/proximity to body???\n\nHeres a video of whats going on: [https://vimeo.com/153108435](https://vimeo.com/153108435)"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2016-01-26T15:05:33Z","Content":"\u003E \n\u003E \n\u003E 1 minute ago, Poodmund said:\n\u003E \n\u003E \n\u003E I couldn\u0027t test that situation (I couldn\u0027t set up an orbit/alignment case to test ![:(](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_sad.gif \u0022:(\u0022) ), I would think its almost very-improbably as what I found is that it depends on altitude of orbit/proximity to body???\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E Heres a video of whats going on: [https://vimeo.com/153108435](https://vimeo.com/153108435)\n\u003E \n\nAlright, I think I know what it is, I\u0027ll have it fixed shortly."},{"CreatedByName":"SkyKaptn","CreatedById":153990,"CreatedDateTime":"2016-01-26T15:18:57Z","Content":"[@Poodmund](https://forum.kerbalspaceprogram.com/index.php?/profile/128643-poodmund/) [@blackrack](https://forum.kerbalspaceprogram.com/index.php?/profile/104258-blackrack/) Latest dev build: I still get the planetary rings drawn behind the gas giants. (OPM)\n\nPictures on page 118 from previous report."},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2016-01-26T15:35:07Z","Content":"\u003E \n\u003E \n\u003E 55 minutes ago, SkyKaptn said:\n\u003E \n\u003E \n\u003E [@Poodmund](https://forum.kerbalspaceprogram.com/index.php?/profile/128643-poodmund/) [@blackrack](https://forum.kerbalspaceprogram.com/index.php?/profile/104258-blackrack/) Latest dev build: I still get the planetary rings drawn behind the gas giants. (OPM)\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E Pictures on page 118 from previous report.\n\u003E \n\nYes, I said nothing about this being fixed, I might have it fixed soon though.\n\nEdited: [@Poodmund](https://forum.kerbalspaceprogram.com/index.php?/profile/128643-poodmund/) try this fix for the mapview atmosphere drawing on top of other planets:  [https://mega.nz/#!CNAwFC7a!JlosJLmYp8jnT8peg2Ctw5UT25nj7AGHzArHsSumre8](https://mega.nz/#!CNAwFC7a!JlosJLmYp8jnT8peg2Ctw5UT25nj7AGHzArHsSumre8)\n\n**Edited \u003Ctime datetime=\u00222016-01-26T16:15:39Z\u0022 title=\u002201/26/2016 04:15  PM\u0022 data-short=\u00228 yr\u0022\u003EJanuary 26, 2016\u003C/time\u003E by blackrack**"},{"CreatedByName":"RaffaCT14","CreatedById":152708,"CreatedDateTime":"2016-01-26T22:36:34Z","Content":"\u003E \n\u003E \n\u003E 21 hours ago, blackrack said:\n\u003E \n\u003E \n\u003E Well my idea was to make it higher so they have more room to merge \u0022smoothly\u0022. Other than that I\u0027m not sure what\u0027s going on, it looks like you\u0027re getting some kind of \u0022noise\u0022 which I haven\u0027t seen before.\n\u003E \n\nThat problem appears only with opengl, when I play without it there are only a lot of artifacts. ![:D](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif \u0022:D\u0022)\n\n![image.jpg](http://s16.postimg.org/mrznpaqtx/image.jpg)\n\n![image.jpg](http://s16.postimg.org/aouc1qfrp/image.jpg)\n\nI\u0027ll wait the new version of the mod. Thank you for the help yesterday! ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif \u0022:)\u0022)"}]}