{"TopicId":146572,"ForumId":69,"TopicTitle":"Game [1.1.3] segfaults on stage separation with this craft","CreatedByName":"CorvusCorax","CreatedById":134756,"CreatedDateTime":"2016-08-26T09:23:15Z","PageNum":1,"Articles":[{"CreatedByName":"CorvusCorax","CreatedById":134756,"CreatedDateTime":"2016-08-26T09:23:15Z","Content":"\n\u003Cp\u003E\nHi, I built a craft for use with dark multiplayer, but every time I hit space to engage the 3rd stage, the game segfaults.\n\u003C/p\u003E\n\u003Cp\u003E\nThe craft was created and edited in the \u003Cabbr title=\u0022Vehicle Assembly Building\u0022\u003EVAB\u003C/abbr\u003E only, using subassemblies that had previously flown on other craft without issues.\n\u003C/p\u003E\n\u003Cp\u003E\nTo rule out the dmp mod as the culprit, I copied the craft file over to a stock game, stock also segfaults.\n\u003C/p\u003E\n\u003Cp\u003E\nI was running KSP_linux.x86_64 on a gentoo linux with Kernel 3.17.7\n\u003C/p\u003E\n\u003Cp\u003E\nI then started the x86 version of the game instead of x86_64 and it also segfaults\n\u003C/p\u003E\n\u003Cp\u003E\nGame reports as version v1.1.3.1289\n\u003C/p\u003E\n\u003Cp\u003E\nHere\u0027s the craft file: \u003Ca href=\u0022http://www.cybertrench.com/ksp/station%20booster2.craft\u0022 rel=\u0022external nofollow\u0022\u003Elink to craft file\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nI tried to backtrace the segfault with gdb, but its not very useful:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode\u0022\u003E\n\tProgram received signal SIGSEGV, Segmentation fault.\n[Switching to Thread 0x7ffff7fbd740 (LWP 5934)]\n0x00000000401a62bf in ?? ()\n(gdb) bt\n#0\u00A0 0x00000000401a62bf in ?? ()\n#1\u00A0 0x00007ffeff342800 in ?? ()\n#2\u00A0 0x00000000401a61e3 in ?? ()\n#3\u00A0 0x00007fff10fee0b8 in ?? ()\n#4\u00A0 0x00007ffefe052000 in ?? ()\n#5\u00A0 0x00007ffeff342800 in ?? ()\n#6\u00A0 0x00007fff0e297800 in ?? ()\n#7\u00A0 0x0000000016bb5dc0 in ?? ()\n#8\u00A0 0x00000000401a613f in ?? ()\n#9\u00A0 0x0000000000000000 in ?? ()\n\t\u003C/pre\u003E\n\u003Cp\u003E\n\u003Cstrong\u003Ehow to reproduce:\u003C/strong\u003E\n\u003C/p\u003E\n\u003Col\u003E\u003Cli\u003E\ncopy craft file into savegame on stock KSP 1.1.3\n\u003C/li\u003E\n\u003Cli\u003E\nstart the game and load the craft unto the launchpad\n\u003C/li\u003E\n\u003Cli\u003E\nengage the TR-38-D decoupler between core booster and 3rd stage - either by right-click -\u0026gt; decouple or by going through the staging sequence\n\u003C/li\u003E\n\u003Cli\u003E\ngame segfaults without writing any messages in KSP.log - instead of separating the stages as it should\n\u003C/li\u003E\n\u003C/ol\u003E\u003Cp\u003E\n\u003Cimg alt=\u0022ksp_crash.jpg\u0022 class=\u0022ipsImage\u0022 height=\u0022520\u0022 src=\u0022http://www.cybertrench.com/ksp/ksp_crash.jpg\u0022 width=\u00221000\u0022\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-08-26T09:26:37Z\u0022 title=\u002208/26/2016 09:26  AM\u0022 data-short=\u00227 yr\u0022\u003EAugust 26, 2016\u003C/time\u003E by CorvusCorax\u003C/strong\u003E\n\u003Cbr\u003Esecond half was cut off for some reason, re-added\n\u003C/span\u003E\n"},{"CreatedByName":"sal_vager","CreatedById":16426,"CreatedDateTime":"2016-08-26T09:32:12Z","Content":"\n\u003Cp\u003E\nHi \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/134756-corvuscorax/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022134756\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/134756-corvuscorax/\u0022 id=\u0022ips_uid_5816_6\u0022 rel=\u0022\u0022\u003E@CorvusCorax\u003C/a\u003E, this is likely the known issue with the TR-38-D.\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nQuote\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents ipsClearfix\u0022\u003E\n\u003Cp\u003E\n\u003Cstrong\u003E* OSX crash on decoupling the TR-38-D decoupler.\u003C/strong\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cstrong\u003EKSP crashes to desktop when decoupling a TR-38-D decoupler.\u003C/strong\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nThe TR-38-D decoupler is the only physicsless decoupler in the game, to help reduce wobble on large vessels, but while this decoupler is fine on Windows and Linux it will cause a crash on OSX.\n\u003C/p\u003E\n\u003Cp\u003E\nNo cause for this crash is known.\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cem\u003EWorkaround\u003C/em\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nEdit the part.cfg file in GameData/Squad/Parts/Structural/Size3Decoupler in any text editor.\n\u003C/p\u003E\n\u003Cp\u003E\nChange PhysicsSignificance = 1 to PhysicsSignificance = 0\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nIt\u0027s rare on Linux, but happens on OSX all the time.\n\u003C/p\u003E\n"},{"CreatedByName":"CorvusCorax","CreatedById":134756,"CreatedDateTime":"2016-08-26T10:13:12Z","Content":"\n\u003Cp\u003E\nThe workaround indeed makes the segfault disappear.\n\u003C/p\u003E\n\u003Cp\u003E\nI also noticed that the game does not crash if I decouple the payload from the upper stage before I activate the TR-38-D (it\u0027s a docking port sr, so it can be reattached to the upper stage for circularisation on a trajectory thats lofted enough)\n\u003C/p\u003E\n\u003Cp\u003E\nIt seems to be one of those rare segfault conditions that are hard to reproduce, changing anything makes it vanish as its delicate conditions are no longer met. I hate those when they happen in my own code \u003Cimg alt=\u0022:wink:\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif\u0022 title=\u0022;)\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nThat makes me wonder though if this segfault could be used with a carefully generated craft file to execute arbitrary machinecode on the client - might be mean when sharing crafts on the net or with dark multiplayer and similar mods \u003Cimg alt=\u0022:wink:\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif\u0022 title=\u0022;)\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nwould likely be better to get it fixed in the next version before anyone finds out if its exploitable that way\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-08-26T10:17:02Z\u0022 title=\u002208/26/2016 10:17  AM\u0022 data-short=\u00227 yr\u0022\u003EAugust 26, 2016\u003C/time\u003E by CorvusCorax\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"CorvusCorax","CreatedById":134756,"CreatedDateTime":"2016-08-26T10:39:24Z","Content":"\n\u003Cp\u003E\nit should be noted that the workaround needs another workaround. Any craft with the TR-28 d becomes almost unflyable with the workaround applied due to wobble. The fix: add struts around the TR-38 D\u0027s bottom (connecting to the auto-interstage / engine)\n\u003C/p\u003E\n"},{"CreatedByName":"sal_vager","CreatedById":16426,"CreatedDateTime":"2016-08-26T17:05:03Z","Content":"\n\u003Cp\u003E\nYeah it needs struts, but don\u0027t attach struts to the TR-38-D, that summons the Kraken.\n\u003C/p\u003E\n\u003Cp\u003E\nThe \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/145282-devnotes-tuesday%C2%A0two-sprints-down-one-to-go/#comment-2702101\u0022 rel=\u0022\u0022\u003Eautostruts\u003C/a\u003E planned for 1.2 should alleviate this as you won\u0027t need a strut on the TR-38-D, or to have them physicsless.\n\u003C/p\u003E\n"}]}