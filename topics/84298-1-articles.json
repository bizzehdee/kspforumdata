{"TopicId":84298,"ForumId":29,"TopicTitle":"Beginning mod maker and developer, requesting assistance on first plugin code","CreatedByName":"al.bebop","CreatedById":118310,"CreatedDateTime":"2014-09-10T18:46:26Z","PageNum":1,"Articles":[{"CreatedByName":"al.bebop","CreatedById":118310,"CreatedDateTime":"2014-09-10T18:46:26Z","Content":"\n\u003Cp\u003EHi everyone! I\u0027m new to C# (though I studied Java in the past) and KSP mod making; and I\u0027m unfortunately stuck already! I\u0027ve got a simple goal in mind to start me off:\u003C/p\u003E\u003Cp\u003EI\u0027ve created a \u0022PartKannister\u0022 part which uses the Kerbal Attachment System module \u0022KASModuleContainer\u0022 in the .cfg to allow storage of extra solar panels, batteries, etc. This function works fine.\u003C/p\u003E\u003Cp\u003EI\u0027ve also setup a simple door-opening animation which uses the built-in \u0022ModuleAnimateGeneric\u0022 to allow you to toggle the doors on the launchpad.\u003C/p\u003E\u003Cp\u003EBoth of these functions work currently, but there are two separate action buttons in the right-click menu and of course I\u0027d like to tie the actions together, such that when a Kerbal on EVA accesses the contents the doors will open, and when you close the container GUI the doors would then close.\u003C/p\u003E\u003Cp\u003EIt seems like I need to write a plugin to override the \u0022ViewContents\u0022 action for KAS for this part. I\u0027ve tried looking into how the stock Materials Bay and Goo Cannister work, as the functionality of these parts is similar to what I hope to accomplish, but have run into dead ends here as well.\u003C/p\u003E\u003Cp\u003EI\u0027m sure an experienced KSP mod developer will find this task laughably simple (at least that is my hope!) so please forgive my nubbish post. Any pointers or suggestions on where to look for further inspiration on this is greatly appreciated!\u003C/p\u003E\u003Cp\u003EHeck if someone could even just suggest the correct logic to accomplish this in a plugin I will work out the code needed! I just need to make sure I\u0027m at least following the right track here.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-09-10T20:18:59Z\u0022 title=\u002209/10/2014 08:18  PM\u0022 data-short=\u00229 yr\u0022\u003ESeptember 10, 2014\u003C/time\u003E by al.bebop\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"al.bebop","CreatedById":118310,"CreatedDateTime":"2014-09-10T22:25:35Z","Content":"\n\u003Cp\u003EPerhaps it would be easier to go ahead and keep the animation separate from the KAS container module, but maybe I could \u0022lock\u0022 the container plugin when the doors are closed?\u003C/p\u003E\n"},{"CreatedByName":"Apollo13","CreatedById":74572,"CreatedDateTime":"2014-09-13T12:25:41Z","Content":"\n\u003Cp\u003EYou really don\u0027t need KASModuleContainer. I just finished a part similar to what you describe. The animation opens and closes the door in the VAB/SPH (requires FSanimateGeneric in firespitter.dll). I then store parts within it. Each part has the KAS module in its part.cfg file (or you can just add it to the the KAS addModule.cfg file). While in flight, a Kerbal can open the container to view and retrieve the parts.\u003C/p\u003E\u003Cp\u003EIMPORTANT: the collision mesh (node_collider) must extend inside the container and must be continuous.\u003C/p\u003E\u003Cp\u003ENo additional plugin needed.\u003C/p\u003E\u003Cp\u003Epart.cfg contains:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E    MODULE\u003Cbr\u003E    {\u003Cbr\u003E        name = FSanimateGeneric\u003Cbr\u003E        animationName = doors\u003Cbr\u003E        startEventGUIName = Open\u003Cbr\u003E        endEventGUIName = Close\u003Cbr\u003E        toggleActionName = Toggle\u003Cbr\u003E        availableInEVA = True\u003Cbr\u003E        EVArange = 10\u003Cbr\u003E    }\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003ENote that this contains only one context menu button which automatically toggles \u0022Open\u0022 and \u0022Close\u0022 in the menu . This functionality is the same for ModuleAnimateGeneric and FSanimateGeneric. You do NOT need two buttons defined in Unity.\u003C/p\u003E\u003Cp\u003EEach of the parts you see in there (batteries, solar panel, etc.) can be retrieved by Kerbal on EVA.\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://i.imgur.com/xJt2N1k.jpg\u0022 alt=\u0022xJt2N1k.jpg\u0022\u003E\u003C/p\u003E\u003Cp\u003EThis is a cargo container I created for SpeedyB\u0027s Hex Truss System (a great mod; check it out).\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-09-13T12:39:41Z\u0022 title=\u002209/13/2014 12:39  PM\u0022 data-short=\u00229 yr\u0022\u003ESeptember 13, 2014\u003C/time\u003E by Apollo13\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"al.bebop","CreatedById":118310,"CreatedDateTime":"2014-09-16T21:15:26Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Apollo13\u0022 data-cite=\u0022Apollo13\u0022\u003E\u003Cdiv\u003Esnippy snip\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EVery cool stuff! Thanks for this; I\u0027ll definitely consider implementing this same technique for my part; with a little re-working it will definitely work as a small \u0022miscellaneous science/utility\u0022 part container. Two questions about the part you\u0027ve shown above (very cool btw!):\u003C/p\u003E\u003Cp\u003E1) Regarding the collision mesh, do you mean it should fill the entire internal space? (because your screenshot seems to negate that, unless the animation plugin works around that) or is it instead a \u0022sleeve\u0022 that occupies the same space as the walls of the container, with a void in the middle where the cargo/kerbals fit above? If you can provide a SS or further elaboration I\u0027d greatly appreciate it!\u003C/p\u003E\u003Cp\u003E2) Do you know if this implementation shields internal items from Deadly Reentry and FAR effects or does that require an additional module? Thanks and great work once again!\u003C/p\u003E\u003Cp\u003Eedit: Remembered what #2 was \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-09-16T21:28:36Z\u0022 title=\u002209/16/2014 09:28  PM\u0022 data-short=\u00229 yr\u0022\u003ESeptember 16, 2014\u003C/time\u003E by al.bebop\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"al.bebop","CreatedById":118310,"CreatedDateTime":"2014-09-19T20:45:43Z","Content":"\n\u003Cp\u003EI think I figured it all out, except for the reentry/FAR shielding, but I know there\u0027s another module for that available. For the collision mesh, I actually omitted the separate mesh normally used for the collider in Unity, and added a Mesh Collider component to the model parts instead, seems to work! Thanks again for the help!\u003C/p\u003E\n"},{"CreatedByName":"artwhaley","CreatedById":118388,"CreatedDateTime":"2014-09-20T04:37:53Z","Content":"\n\u003Cp\u003EI\u0027ve run into a problem before when trying to make cargo bays that even if you follow the shape of the hull with the collider the missing side gets \u0027filled in\u0027 when you check the \u0027convex\u0027 button in unity... and if you DON\u0027T check the convex button in Unity bad things can happen... from your part not loading, to the whole screen going black when physics activates, to your part sinking into the ground for no good reason. \u003C/p\u003E\u003Cp\u003EThe way I solved this was to use multiple collision meshes in the model - one for each wall of the cargo bay. That way each wall can be convex while the overall shape is still concave. \u003C/p\u003E\u003Cp\u003ETurning the actual model on as a \u0027mesh collider\u0027 works fine with really simple models, but constantly checking every face of a complicated collision mesh puts a lot of load on the CPU. So if you can aproximate your mesh\u0027s shape with less polygons, it\u0027s worth it to try. I think 256 poly\u0027s is a hard limit for collision mesh\u0027s... but I haven\u0027t tried that, I\u0027m just repeating what I\u0027ve read here on the forum. Could be more of a rule than a guideline?\u003C/p\u003E\u003Cp\u003EOne easy Blender trick that frequently works... If you duplicate the model (in object mode) and then apply the Decimation modifier, you can wiggle the settings until Blender automatically creates a low poly mesh that mostly keeps your part\u0027s shape. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EApollo13, that cargo carrier piece is really awesome! Have you released it yet?\u003C/p\u003E\u003Cp\u003EAnd al.bebop, if I were you, I\u0027d look at the KAS code and see if there\u0027s a way to add the functionality you need into it, and then request a pull and let them add your changes back to the main codebase, as I can see how that would be a really cool feature for KAS to just have. An optional \u003Cspan style=\u0022color:#333333;\u0022\u003EKASModuleContainer parameter to include an animation, so you don\u0027t have to use a separate animation module at all? (You could look at how firespitter\u0027s landing gear module includes an animation without a dedicated animation module.)\u003C/span\u003E\u003C/p\u003E\u003Cp\u003EOr if you want the simple answer... you could always just do it with two parts -an outer bay that has an animation module and an inner container with the KAS module. With well-placed nodes the inner container could snap in place in the VAB easily, and then it all just works. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Apollo13","CreatedById":74572,"CreatedDateTime":"2014-09-20T20:15:20Z","Content":"\n\u003Cp\u003EHey guys,\u003C/p\u003E\u003Cp\u003ESorry I haven\u0027t been back to this thread to answer earlier.\u003C/p\u003E\u003Cp\u003EThe collision mesh actually follows the inside of the bay. I tried the technique of creating a collision mesh for each face inside, but found it too laborious. Each of the walls of the bay has a thickness. So, I just duplicated the entire bay (without the doors) (SHIFT-D in Blender), and that became the collision mesh. Quick and easy.\u003C/p\u003E\u003Cp\u003ETo make ANY part KAS compliant, so you can remove it and place it on another vehicle, add this code to that part: (change the parameters to suit your needs).\u003C/p\u003E\u003Cp\u003EMODULE\u003C/p\u003E\u003Cp\u003E{\u003C/p\u003E\u003Cp\u003E name = KASModuleGrab\u003C/p\u003E\u003Cp\u003E evaPartPos = (0.0, 0.0, -0.15)\u003C/p\u003E\u003Cp\u003E evaPartDir = (0,0,-1)\u003C/p\u003E\u003Cp\u003E storable = true\u003C/p\u003E\u003Cp\u003E storedSize = 2\u003C/p\u003E\u003Cp\u003E attachOnPart = True\u003C/p\u003E\u003Cp\u003E attachOnEva = True\u003C/p\u003E\u003Cp\u003E attachOnStatic = False\u003C/p\u003E\u003Cp\u003E}\u003C/p\u003E\u003Cp\u003EIf you want to make any part into a KAS container and behave like it, just add this to the part.cfg:\u003C/p\u003E\u003Cp\u003EMODULE\u003C/p\u003E\u003Cp\u003E{\u003C/p\u003E\u003Cp\u003E name = KASModuleContainer\u003C/p\u003E\u003Cp\u003E maxSize = 40\u003C/p\u003E\u003Cp\u003E}\u003C/p\u003E\u003Cp\u003EThat will call the KAS.dll. Of course, you can\u0027t distro KAS.dll with your mod part. Just let the user know it\u0027s needed.\u003C/p\u003E\u003Cp\u003EThanks for the compliment on the JebEx part. I\u0027m releasing it as part of SpeedyB\u0027s incredible Hex Truss System. JebEx can be found at: \u003Ca href=\u0022https://www.dropbox.com/s/n506755f5zukgu4/JebExHexTruss.zip?dl=0\u0022 rel=\u0022external nofollow\u0022\u003EJebEx Cargo Bay\u003C/a\u003E. License is the same as SpeedyB\u0027s Hex Truss System\u003C/p\u003E\u003Cp\u003EJebEx works with FAR. I don\u0027t use Deadly Reentry, so I\u0027m not certain of the effects.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-09-20T20:18:03Z\u0022 title=\u002209/20/2014 08:18  PM\u0022 data-short=\u00229 yr\u0022\u003ESeptember 20, 2014\u003C/time\u003E by Apollo13\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"al.bebop","CreatedById":118310,"CreatedDateTime":"2014-09-29T19:04:40Z","Content":"\n\u003Cp\u003EThanks to both of you for the continued discussion! I particularly appreciate the info regarding collision meshes; I think I was able to use a low-poly version of the model in this case for the collision mesh, with animations. And regarding KAS container animations, KospY himself actually responded to my inquiry to confirm he intends to include an animation component in the container module for the next version, with exactly the functionality I was asking for XD. Still, your discussion is invaluable as it\u0027s helped me to look at creating solutions from multiple approaches rather than just getting frustrated when the first plan hits a snag.\u003C/p\u003E\n"},{"CreatedByName":"Apollo13","CreatedById":74572,"CreatedDateTime":"2014-09-29T21:32:42Z","Content":"\n\u003Cp\u003EFor some models, you don\u0027t need to create a separate collision mesh. Rather, simply add \u0022Mesh collider\u0022 component in Unity. Be sure to set the \u0022Convex\u0022 attribute for the Mesh Collider.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-10-01T13:43:57Z\u0022 title=\u002210/01/2014 01:43  PM\u0022 data-short=\u00229 yr\u0022\u003EOctober 1, 2014\u003C/time\u003E by Apollo13\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"al.bebop","CreatedById":118310,"CreatedDateTime":"2014-10-04T20:43:03Z","Content":"\n\u003Cp\u003EThanks again! If you happen to check back here and see this; are you able to confirm what cases not setting the \u0022convex\u0022 to active will break things? I probably shouldn\u0027t be monkeying around with it since everyone seems to say the same as you, but I\u0027ve found it doesn\u0027t always seem to cause problems when I don\u0027t do this; though I\u0027ll grant none of my parts have been really rigorously tested, just enough to make sure nothing explodes on the launchpad or on its way to orbit.\u003C/p\u003E\n"},{"CreatedByName":"Apollo13","CreatedById":74572,"CreatedDateTime":"2014-10-07T15:41:39Z","Content":"\n\u003Cp\u003EThere are cases for odd-shaped meshes where I don\u0027t set Convex. Best thing to do is to experiment with each project. If you test it without Convex and it works and that\u0027s what you need, then go for it.\u003C/p\u003E\n"},{"CreatedByName":"philotical","CreatedById":109390,"CreatedDateTime":"2014-10-07T16:05:48Z","Content":"\n\u003Cp\u003Emy 2 cents, maybe someone finds it usefull..\u003C/p\u003E\u003Cp\u003Efrom what I can tell, convex does only one thing different then \u0022normal\u0022 mesh collider:\u003C/p\u003E\u003Cp\u003EIt prevents the object from falling through the ground/terrain..\u003C/p\u003E\u003Cp\u003ESo in case of your box, you\u0027d need only some seperated corner peaces as convex and the rest could be a simple mesh-collider that can easely be concave without problems..\u003C/p\u003E\u003Cp\u003Ejust eight square boxes, one at each corner, would be minimum..\u003C/p\u003E\u003Cp\u003Eif you land on a hilltop, it can look awekward if the hill shifts through a large wall peaces, so just slap some flat square colliders in the center of each side.. \u003C/p\u003E\u003Cp\u003Ethey don\u0027t need to span the whole area - just 1 sqare meter in the middle.\u003C/p\u003E\u003Cp\u003EI\u0027ve made complete star trek ships with several decks and had only 8 or 9 tiny convex colliders at logical points to stay above terrain \u003C/p\u003E\u003Cp\u003Emesh collider work for ship2ship collisions and for EVA as advertized - no issues..\u003C/p\u003E\u003Cp\u003EI\u0027m not sure if this is the best way to go - but that is what I figured as working in the last few weeks..\u003C/p\u003E\n"},{"CreatedByName":"michaelhester07","CreatedById":96470,"CreatedDateTime":"2014-10-07T18:22:48Z","Content":"\n\u003Cp\u003ELol so that\u0027s why people can\u0027t use my stanford torus as a gigantic wheel \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E.\u003C/p\u003E\u003Cp\u003EAs for the plugin itself. If you add a reference to the original plugin you can use it as the module you inherit settings from. \u003C/p\u003E\u003Cp\u003EIn visual studio under your project right click the references folder and click \u0022Add Reference\u0022, then find the .dll from KAS.\u003C/p\u003E\u003Cp\u003EIn your c# you do this for your module class to \u0022inherit\u0022 methods and features from the KASModuleContainer module.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Epublic class MyPartContainer : KASModuleContainer\u003Cbr\u003E{\u003Cbr\u003E     //define things...\u003Cbr\u003E}\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EThen you overload the events that you need. In visual studio (even the express versions) you can right click the KASModuleContainer after you\u0027ve added it and go to definition. From there you can see all the events they added and find which ones you want to override. Play your animation in the overridden event, then call the base method. Be sure to play the animation in reverse or add a new close animation when you close the container. This is how I did my resource science system.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E\u003Cbr\u003E[KspEvent(...)]  //replace the ellipsis with the parameters you need\u003Cbr\u003Enew void OpenContainer()  //the new part is necessary so you can intercept the event\u003Cbr\u003E{\u003Cbr\u003E     animate(OpenContainerAnimation);  //you can write this function yourself\u003Cbr\u003E    base.OpenContainer(); //call the base method to invoke the original module\u0027s code\u003Cbr\u003E}\u003Cbr\u003E\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-10-07T18:27:16Z\u0022 title=\u002210/07/2014 06:27  PM\u0022 data-short=\u00229 yr\u0022\u003EOctober 7, 2014\u003C/time\u003E by michaelhester07\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"al.bebop","CreatedById":118310,"CreatedDateTime":"2014-10-14T03:09:48Z","Content":"\n\u003Cp\u003EThanks so much for the continued replies, you guys are awesome! If I understand you right Michael, I think my problem was trying to use the \u0022override\u0022 in the function declaration; I guess the \u0022override\u0022 function is only for adding to the base game functions? Sorry if I\u0027m messing up the terminology here, and thanks again for the insight into C#! I hope to get back to seriously studying it for the purposes of mod-making soon!\u003C/p\u003E\n"}]}