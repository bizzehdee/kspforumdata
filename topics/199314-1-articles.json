{"TopicId":199314,"ForumId":29,"TopicTitle":"How to save vessel position, and then teleport back to that position?","CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2021-01-04T20:22:48Z","PageNum":1,"Articles":[{"CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2021-01-04T20:22:48Z","Content":"\n\u003Cp\u003E\nI\u0027m working an old mod, AirPart.\u00A0 Turns out the mod works, but has had a bug when changing scenes.\n\u003C/p\u003E\n\u003Cp\u003E\nParking a vessel at altitude, jumping to the Space Center scene and then returning will return the vessel to the same location, but at 0 altitude\n\u003C/p\u003E\n\u003Cp\u003E\nSo, digging into the code, I find that it does this to get the\u00A0 current vessel position:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003E...\nParkPosition = GetVesselPosition()\n...\n\n// Following code from Hyperedit\n\n        private Vector3d GetVesselPosition()\n        {\n            var pqs = vessel.mainBody.pqsController;\n            if (pqs == null)\n            {\n                Destroy(this);\n                return zeroVector;\n            }\n\n            alt = pqs.GetSurfaceHeight(vessel.mainBody.GetRelSurfaceNVector(Latitude, Longitude)) - vessel.mainBody.Radius;\n            alt = Math.Max(alt, 0); // Underwater!\n\n            teleportPosition = vessel.mainBody.GetRelSurfacePosition(Latitude, Longitude, alt \u002B Altitude);\n\n            return teleportPosition;\n        }\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nSo, in Start, I have the following:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003E                if (Parked)\n                {\n                    vessel.SetPosition(ParkPosition);\n                }\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nand it doesn\u0027t do anything.\n\u003C/p\u003E\n\u003Cp\u003E\nI tried as a test putting this into FixedUpdate():\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003E                if (Parked)\n                {\n                    vessel.SetPosition(ParkPosition);\n                }\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nand it ended up 1000km high.\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027m pretty sure this is something to do with the multiple points of origin, but no idea where to go.\u00A0 Would appreciate a pointer or two, thanks\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nHappy\u00A0 New Year\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nLGG\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222021-01-04T20:59:17Z\u0022 title=\u002201/04/2021 08:59  PM\u0022 data-short=\u00223 yr\u0022\u003EJanuary 4, 2021\u003C/time\u003E by linuxgurugamer\u003C/strong\u003E\n\u003C/span\u003E\n"}]}