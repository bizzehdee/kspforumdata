{"TopicId":82004,"ForumId":29,"TopicTitle":"Get terrain height from NOT directly under the craft","CreatedByName":"milbournosphere","CreatedById":81059,"CreatedDateTime":"2014-08-17T23:49:36Z","PageNum":1,"Articles":[{"CreatedByName":"milbournosphere","CreatedById":81059,"CreatedDateTime":"2014-08-17T23:49:36Z","Content":"\n\u003Cp\u003EIs there a way to get information about terrain that is not directly under the vessel in question? I see that one can easily get the terrainAltitude via the value in this.vessel, but I was hoping to be able to that information for a few terrain points near the vessel. In anybody aware of how to get terrain data in the vicinity of one\u0027s vessel?\u003C/p\u003E\n"},{"CreatedByName":"Wanderfound","CreatedById":112611,"CreatedDateTime":"2014-08-17T23:51:37Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022milbournosphere\u0022 data-cite=\u0022milbournosphere\u0022\u003E\u003Cdiv\u003EIs there a way to get information about terrain that is not directly under the vessel in question? I see that one can easily get the terrainAltitude via the value in this.vessel, but I was hoping to be able to that information for a few terrain points near the vessel. In anybody aware of how to get terrain data in the vicinity of one\u0027s vessel?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EApart from Googling \u0022Kerbal Topology Map\u0022, not that I know of.\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-08-18T00:19:27Z","Content":"\n\u003Cp\u003E\u003Cspan style=\u0022text-decoration:line-through;\u0022\u003EIt would be tricky, but the only method I know of is to use a raycast.\u003C/span\u003E\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022text-decoration:line-through;\u0022\u003EFind the Vector3, raycast to the center of the planet and the distance you hit would be your altitude.\u003C/span\u003E\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022text-decoration:line-through;\u0022\u003EMy landing height mod would have the raycast code for reference. Not sure how you\u0027d go about getting the Vector3 postion to raycast from though.\u003C/span\u003E\u003C/p\u003E\u003Cp\u003EActually, this does not apply to this question as outside the 2.5km physics bubble, ray casts can get weird and I don\u0027t consider them reliable.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-08-18T13:35:06Z\u0022 title=\u002208/18/2014 01:35  PM\u0022 data-short=\u00229 yr\u0022\u003EAugust 18, 2014\u003C/time\u003E by Diazo\u003C/strong\u003E\n\u003Cbr\u003EChange my mind\n\u003C/span\u003E\n"},{"CreatedByName":"NathanKell","CreatedById":75006,"CreatedDateTime":"2014-08-18T02:19:06Z","Content":"\n\u003Cp\u003EYou can also check the surfaceheight of the PQS of the body you\u0027re near.\u003C/p\u003E\u003Cp\u003EI.e. vessel.mainbody.pqsController.GetSurfaceHeight( some_pos_in_worldspace )\u003C/p\u003E\u003Cp\u003ENote that you should verify pqsController is not null first (Jool doesn\u0027t have one).\u003C/p\u003E\n"},{"CreatedByName":"stupid_chris","CreatedById":62017,"CreatedDateTime":"2014-08-18T04:19:20Z","Content":"\n\u003Cp\u003EYeah, you can do it threough the PQSController, but that is incredibely slow. Though it\u0027s the easiest way to not get the altitude directly below you.\u003C/p\u003E\n"},{"CreatedByName":"DMagic","CreatedById":57416,"CreatedDateTime":"2014-08-18T04:29:10Z","Content":"\n\u003Cp\u003EPQScontroller is fine as long as you aren\u0027t trying to do it several hundred thousand times at once like SCANsat does. If you\u0027re doing it once per frame, or once every time onGUI runs it should be fine. \u003C/p\u003E\u003Cp\u003EAnd note that you\u0027ll also need to subtract the planet\u0027s radius from the resulting value coming from pqsController.GetSurfaceHeight(); use body.pqsController.radius, otherwise you\u0027ll get the terrain height above the center of the planet.\u003C/p\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2014-08-18T08:09:33Z","Content":"\n\u003Cp\u003EIt\u0027s a mess, a real big mess.\u003C/p\u003E\u003Cp\u003EWhy? Because KSP doesn\u0027t load real polygons for ground that\u0027s far away from you, so raycasting only works on nearby ground. For far away ground you have to use the PQScontroller, and it\u0027s not well documented what its actual coordinate system is meant to be - you have to fiddle with it a while with trial and error to work out what it is.\u003C/p\u003E\u003Cp\u003EI\u0027m in the middle of trying to create a raycast solver for PQS terrain and it\u0027s really messy if you want it to run fast enough to give you an answer in one update and yet at the same time not have the chance of error. (It has to work by a numerical approximation algorithm cutting the ray into sample points and looking for a spot where one point is above ground and a neighboring point on the line is below ground. Knowing that the answer must lay between those two points, it takes that smaller line segment and runs it through the same algorithm, recursively. The problem is that to avoid the case where the line segment of the sample might miss a mountain entirely, both endpoints being outside the mountain, you need to make sure you use a lot of small slices, and then you\u0027re starting to do too much work in one Update call and causing KSP to lag. I\u0027m going to be trying to solve this by cutting up the algorithm into pieces that can be run\u003C/p\u003E\u003Cp\u003Espread across multiple updates, so you get an answer without lagging the game, but the answer might take a half second or so.\u003C/p\u003E\n"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2014-08-18T10:00:48Z","Content":"\n\u003Cp\u003EIt\u0027s not well documented but some mods already use it. Just have a look.\u003C/p\u003E\u003Cp\u003Ealtitude = body.pqsController.GetSurfaceHeight(QuaternionD.AngleAxis( longitude, Vector3d.down) * QuaternionD.AngleAxis( latitude, Vector3d.forward ) * Vector3d.right)\u003C/p\u003E\u003Cp\u003EYou may have to add or substract body.pqsController.radius, I forgot \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"}]}