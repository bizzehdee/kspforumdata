{"TopicId":102909,"ForumId":29,"TopicTitle":"KSP Plugin debugging and profiling for Visual Studio and Monodevelop on all OS","CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2015-03-29T11:09:00Z","PageNum":1,"Articles":[{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2015-03-29T11:09:00Z","Content":"\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nEdit: Those instruction are partially outdated for KSP 1.8. Have a look at the post following \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/102909-ksp-plugin-debugging-and-profiling-for-visual-studio-and-monodevelop-on-all-os/\u0026amp;do=findComment\u0026amp;comment=3688332\u0022 rel=\u0022\u0022\u003Ethis one\u003C/a\u003E\u00A0and specifically\u00A0\u003Ca href=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/102909-ksp-plugin-debugging-and-profiling-for-visual-studio-and-monodevelop-on-all-os/\u0026amp;do=findComment\u0026amp;comment=3703964\u0022 rel=\u0022\u0022\u003Ethis one\u003C/a\u003E if you are on Windows.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nAs we all know debugging plugin in KSP is mostly done with endless spam of Debug.Log or a bunch of custom windows we have to build. We also have \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/73586\u0022 rel=\u0022\u0022\u003Eangavrilov method\u003C/a\u003E but it require to recompile the whole mono and is a bit scary. So here is the result of a couple of days of experiment on my side to get a simple method working.\n\u003C/p\u003E\n\u003Cp\u003E\nSo how do we get debugging to work for KSP ? Simply by using the tool that unity provides us. Unity has a debugging system for games that runs in development mode, which is not the case of KSP by default.\n\u003C/p\u003E\n\u003Cp\u003E\nSo here is how to get that (Linux\u00A0users read that part and I will explain the difference for you further down.\u00A0OSX user read \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/102909-ksp-plugin-debugging-and-profiling-for-visual-studio-and-monodevelop-on-all-os/\u0026amp;do=findComment\u0026amp;comment=3628143\u0022 rel=\u0022\u0022\u003Ethis post\u003C/a\u003E)\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cstrong\u003E\u003Cspan style=\u0022font-size:12px;\u0022\u003EKSP\u003C/span\u003E\u003C/strong\u003E\n\u003C/p\u003E\n\u003Cul\u003E\u003Cli\u003E\nFirst you need a \u003Ca href=\u0022http://unity3d.com/get-unity/download/archive\u0022 rel=\u0022external nofollow\u0022\u003EUnity installation\u003C/a\u003E\u00A0(or \u003Ca href=\u0022https://unity3d.com/fr/unity/qa/patch-releases\u0022 rel=\u0022external nofollow\u0022\u003Ehere\u003C/a\u003E if the version ends with px) using the exact same version as your current KSP (For 1.1 you need Unity 5.2.4f1). That version is in the first line of the output_log.txt/Player.log.\n\u003C/li\u003E\n\u003Cli\u003E\nGo to your Unity install for that version ( \u0022C:\\Program Files\\Unity\\Editor\u0022 most likely) and then go in the \u0022Data\\PlaybackEngines\\windowsstandalonesupport\\Variations\\win64_development_mono\u0022 sub-directory. Copy the \u0022player_win.exe\u0022 file to your KSP dev install (next to KSP.exe)\n\u003C/li\u003E\n\u003Cli\u003E\nRename that \u0022player_win.exe\u0022 to \u0022KSP_x64_Dbg.exe\u0022\n\u003C/li\u003E\n\u003Cli\u003E\nOpen a command prompt in that directory (shift right clic in the empty space of the explorer\u00A0and select \u0022open command window here\u0022. In it enter the command\u00A0\u0022mklink /J KSP_x64_Dbg_Data KSP_x64_Data\u0022. You will now have a\u00A0KSP_x64_Dbg_Data that points to the stock\u00A0KSP_x64_Data.\n\u003C/li\u003E\n\u003Cli\u003E\nGet this \u003Ca href=\u0022https://www.sarbian.com/sarbian/PlayerConnectionConfigFile\u0022 rel=\u0022external nofollow\u0022\u003Efile\u003C/a\u003E and put it in the\u00A0KSP_x64_Data\u00A0directory (it makes the mono debugger starts its listening port)\n\u003C/li\u003E\n\u003C/ul\u003E\u003Cul\u003E\u003Cli\u003E\nLaunch KSP with the KSP_x64_Dbg.exe\u00A0and check that you have \u0022Development Build\u0022 in your lower right corner\n\u003C/li\u003E\n\u003Cli\u003E\nGet this \u003Ca href=\u0022https://www.sarbian.com/sarbian/pdb2mdb.zip\u0022 rel=\u0022external nofollow\u0022\u003Ezip\u003C/a\u003E and put its content somewhere. For\u00A0me it will be \u0022C:\\Games\\Tools\\pdb2mdb\u0022\n\u003C/li\u003E\n\u003Cli\u003E\nIf you compile with VS you have to generate the mono debug information. To generate them I add some command in the project post-build event command line. Here is what mine looks like for \u003Cabbr title=\u0022Mechjeb (mod)\u0022\u003EMJ\u003C/abbr\u003E\n\u003C/li\u003E\n\u003C/ul\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\n\u0022C:\\Games\\Tools\\pdb2mdb\\pdb2mdb.exe\u0022 \u0022$(TargetFileName)\u0022\nxcopy /Y \u0022$(TargetPath)\u0022 \u0022C:\\Games\\ksp-win_dev\\GameData\\MechJeb2\\Plugins\\\u0022\nxcopy /Y \u0022$(TargetDir)$(TargetName).pdb\u0022 \u0022C:\\Games\\ksp-win_dev\\GameData\\MechJeb2\\Plugins\\\u0022\nxcopy /Y \u0022$(TargetDir)$(TargetName).dll.mdb\u0022 \u0022C:\\Games\\ksp-win_dev\\GameData\\MechJeb2\\Plugins\\\u0022\u003C/pre\u003E\n\u003Cul\u003E\u003Cli\u003E\nCompile your plugin in \u0022Debug\u0022 configuration to get the \u0022MyPlugin.dll\u0022 \u003Cstrong\u003EAND\u003C/strong\u003E the \u0022MyPlugin.dll.mdb\u0022 (Generated with pdb2mdb from \u0022MyPlugin.pdb\u0022 if you use VS. Or by mono if you use\u00A0MonoDevelop or mono cmd line). Copy them in your usual GameData dir if your post build command does not already do it\n\u003C/li\u003E\n\u003C/ul\u003E\u003Cp\u003E\nWe are now ready on KSP side.\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cstrong\u003E\u003Cspan style=\u0022font-size:12px;\u0022\u003EVisual Studio \u003C/span\u003E\u003C/strong\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nYou need a version that allows plugin. So either a VS\u00A0Pro\u002B or \u003Ca href=\u0022https://www.visualstudio.com/en-us/products/visual-studio-community-vs.aspx\u0022 rel=\u0022external nofollow\u0022\u003EVisual Studio Community\u003C/a\u003E (it is free and Unity most likely already installed it). Make sure you check the\u00A0\u003Ca href=\u0022https://www.visualstudio.com/features/unitytools-vs\u0022 rel=\u0022external nofollow\u0022\u003ETools for Unity\u003C/a\u003E\u00A0and NET\u00A03.5 options in the install.\n\u003C/p\u003E\n\u003Cp\u003E\nOnce you have that you will have a \u0022Attach Unity Debugger\u0022 in the Debug menu. So launch KSP and use that menu to attach VS to it. You should get an orange bar at the bottom of VS and the context should switch to debugging. You now have all the usual debugging tools (breakpoints, step by step, watches). You may want to activate \u0022exception support\u0022 to have a the debugger break on exception (Tools =\u0026gt; Options =\u0026gt; \u0022Tools for Unity\u0022 =\u0026gt; \u0022Exception Support\u0022)\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cstrong\u003E\u003Cspan style=\u0022font-size:12px;\u0022\u003EMonoDevelop\u003C/span\u003E\u003C/strong\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nIn the \u0022Run\u0022 menu you have \u0022Attach to Process\u0022. It opens a windows where you should have \u0022Unity Debugger\u0022 selected on the lower part and you can select your KSP process to attach to. It should switch to the debugging context\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cstrong\u003E\u003Cspan style=\u0022font-size:12px;\u0022\u003EProfiling\u003C/span\u003E\u003C/strong\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nNow that KSP use Unity 5 we can use the Unity Profiler for free. Launch\u00A0KSP in d\u00E9velopper mode and launch an empty Unity project. In the \u0022Window\u0022 menu select Profiler. The profiler\u00A0opens and in the \u0022Active Profiler\u0022 at the top of the window you can select your running KSP instance.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nBy default you will only see the MonoBehavior\u00A0methods (Update, FixedUpdate, ...) but you can add calls in your code to profile anything. First make sure your code is compiled with the \u0022ENABLE_PROFILER\u0022 conditional (add it in the build config). Then in your code add pairs of \u0022Profiler.BeginSample(\u0022MyLabel\u0022);\u0022 and \u0022Profiler.EndSample();\u0022. Be aware that if a frame take too long the profiler skip it, so you can\u0027t profile really slow\u00A0method that last a single frame.An example from \u003Cabbr title=\u0022Mechjeb (mod)\u0022\u003EMJ\u003C/abbr\u003E :\u00A0\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint prettyprinted\u0022\u003E\n\u003Cspan\u003EProfiler\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan\u003EBeginSample\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan class=\u0022str\u0022\u003E\u0022vesselState\u0022\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E);\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\nready\u00A0\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E=\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\u00A0vesselState\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan\u003EUpdate\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Evessel\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E);\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n\u003C/span\u003E\u003Cspan\u003EProfiler\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan\u003EEndSample\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E();\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nThe profiler will now show you info for this exact call somewhere in its hierarchy. (there is a search field to find it).\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u0022Profiler.png\u0022 class=\u0022ipsImage\u0022 src=\u0022https://www.sarbian.com/sarbian/Profiler.png\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nA warning : profiling is complex and result are often more complex to interpret than you may think.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cstrong\u003E\u003Cspan style=\u0022font-size:12px;\u0022\u003ELinux and OSX\u003C/span\u003E\u003C/strong\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nThe steps are the same. The only difference is the directory where you get the executable. If you are on Linux you will just need to copy some files, so use a VM to install Unity or ask a friend.\n\u003C/p\u003E\n\u003Cp\u003E\n- OSX : \u00A0\u0026lt;Unity.app\u0026gt;/Contents/PlaybackEngines/MacStandaloneSupport/Variations/universal_development_mono/UnityPlayer.app\n\u003C/p\u003E\n\u003Cp\u003E\n- Linux : \u0026lt;Unity\u0026gt;/Data/PlaybackEngines/linuxstandalonesupport/linux32_withgfx_development or linux64_withgfx_development. Get the LinuxPlayer file, copy it to your KSP install and rename it KSP.x86 or KSP.x86_64 depending on the directory you got it from and make sure you set it \u002Bx\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cstrong\u003E\u003Cspan style=\u0022font-size:12px;\u0022\u003EMissing Unity debugger for MonoDevelop (Custom install or Linux)\u003C/span\u003E\u003C/strong\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nIf you installed MonoDevelop yourself you most likely do not have the Unity Debugger installed.\n\u003C/p\u003E\n\u003Cp\u003E\nGo in Tools-\u0026gt;Addin Manager and install the Unity Soft Debugger addon\n\u003C/p\u003E\n\u003Cp\u003E\n(I did not test those steps so I would like some feedback)\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222019-11-18T21:02:21Z\u0022 title=\u002211/18/2019 09:02  PM\u0022 data-short=\u00224 yr\u0022\u003ENovember 18, 2019\u003C/time\u003E by sarbian\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"godarklight","CreatedById":92588,"CreatedDateTime":"2015-03-29T11:14:18Z","Content":"\n\u003Cp\u003EI for one welcome our new debugging overlord.\u003C/p\u003E\u003Cp\u003EThanks, may this type of code be gone forever!\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cblockquote\u003E\u003Cp\u003E private void ProcessNewVesselMessages()\u003C/p\u003E\u003Cp\u003E {\u003C/p\u003E\u003Cp\u003E int throwLine = 0;\u003C/p\u003E\u003Cp\u003E try\u003C/p\u003E\u003Cp\u003E {\u003C/p\u003E\u003Cp\u003E throwLine = 1;\u003C/p\u003E\u003Cp\u003E Dictionary\u0026lt;Guid, double\u0026gt; removeList = new Dictionary\u0026lt;Guid, double\u0026gt;();\u003C/p\u003E\u003Cp\u003E throwLine = 2;\u003C/p\u003E\u003Cp\u003E lock (vesselRemoveQueue)\u003C/p\u003E\u003Cp\u003E {\u003C/p\u003E\u003Cp\u003E throwLine = 3;\u003C/p\u003E\u003Cp\u003E foreach (KeyValuePair\u0026lt;Guid, Queue\u0026lt;VesselRemoveEntry\u0026gt;\u0026gt; vesselRemoveSubspace in vesselRemoveQueue)\u003C/p\u003E\u003Cp\u003E {\u003C/p\u003E\u003Cp\u003E throwLine = 4;\u003C/p\u003E\u003Cp\u003E while (vesselRemoveSubspace.Value.Count \u0026gt; 0 ? (vesselRemoveSubspace.Value.Peek().planetTime \u0026lt; Planetarium.GetUniversalTime()) : false)\u003C/p\u003E\u003Cp\u003E {\u003C/p\u003E\u003Cp\u003E throwLine = 5;\u003C/p\u003E\u003Cp\u003E VesselRemoveEntry removeVessel = vesselRemoveSubspace.Value.Dequeue();\u003C/p\u003E\u003Cp\u003E throwLine = 6;\u003C/p\u003E\u003Cp\u003E RemoveVessel(removeVessel.vesselID, removeVessel.isDockingUpdate, removeVessel.dockingPlayer);\u003C/p\u003E\u003Cp\u003E throwLine = 7;\u003C/p\u003E\u003Cp\u003E removeList[removeVessel.vesselID] = removeVessel.planetTime;\u003C/p\u003E\u003Cp\u003E throwLine = 8;\u003C/p\u003E\u003Cp\u003E }\u003C/p\u003E\u003Cp\u003E }\u003C/p\u003E\u003Cp\u003E }\u003C/p\u003E\u003Cp\u003E throwLine = 9;\u003C/p\u003E\u003Cp\u003E foreach (KeyValuePair\u0026lt;string, Queue\u0026lt;KerbalEntry\u0026gt;\u0026gt; kerbalProtoSubspace in kerbalProtoQueue)\u003C/p\u003E\u003Cp\u003E {\u003C/p\u003E\u003Cp\u003E throwLine = 10;\u003C/p\u003E\u003Cp\u003E while (kerbalProtoSubspace.Value.Count \u0026gt; 0 ? (kerbalProtoSubspace.Value.Peek().planetTime \u0026lt; Planetarium.GetUniversalTime()) : false)\u003C/p\u003E\u003Cp\u003E {\u003C/p\u003E\u003Cp\u003E throwLine = 11;\u003C/p\u003E\u003Cp\u003E KerbalEntry kerbalEntry = kerbalProtoSubspace.Value.Dequeue();\u003C/p\u003E\u003Cp\u003E throwLine = 12;\u003C/p\u003E\u003Cp\u003E LoadKerbal(kerbalEntry.kerbalNode);\u003C/p\u003E\u003Cp\u003E throwLine = 13;\u003C/p\u003E\u003Cp\u003E }\u003C/p\u003E\u003Cp\u003E }\u003C/p\u003E\u003Cp\u003E throwLine = 14;\u003C/p\u003E\u003Cp\u003E foreach (KeyValuePair\u0026lt;Guid, Queue\u0026lt;VesselProtoUpdate\u0026gt;\u0026gt; vesselQueue in vesselProtoQueue)\u003C/p\u003E\u003Cp\u003E {\u003C/p\u003E\u003Cp\u003E throwLine = 15;\u003C/p\u003E\u003Cp\u003E VesselProtoUpdate vpu = null;\u003C/p\u003E\u003Cp\u003E throwLine = 16;\u003C/p\u003E\u003Cp\u003E //Get the latest proto update\u003C/p\u003E\u003Cp\u003E while (vesselQueue.Value.Count \u0026gt; 0 ? (vesselQueue.Value.Peek().planetTime \u0026lt; Planetarium.GetUniversalTime()) : false)\u003C/p\u003E\u003Cp\u003E {\u003C/p\u003E\u003Cp\u003E throwLine = 17;\u003C/p\u003E\u003Cp\u003E VesselProtoUpdate newVpu = vesselQueue.Value.Dequeue();\u003C/p\u003E\u003Cp\u003E throwLine = 18;\u003C/p\u003E\u003Cp\u003E if (newVpu != null)\u003C/p\u003E\u003Cp\u003E {\u003C/p\u003E\u003Cp\u003E throwLine = 19;\u003C/p\u003E\u003Cp\u003E //Skip any protovessels that have been removed in the future\u003C/p\u003E\u003Cp\u003E if (removeList.ContainsKey(vesselQueue.Key) ? removeList[vesselQueue.Key] \u0026lt; vpu.planetTime : true)\u003C/p\u003E\u003Cp\u003E {\u003C/p\u003E\u003Cp\u003E throwLine = 20;\u003C/p\u003E\u003Cp\u003E vpu = newVpu;\u003C/p\u003E\u003Cp\u003E throwLine = 21;\u003C/p\u003E\u003Cp\u003E }\u003C/p\u003E\u003Cp\u003E }\u003C/p\u003E\u003Cp\u003E }\u003C/p\u003E\u003Cp\u003E throwLine = 22;\u003C/p\u003E\u003Cp\u003E //Apply it if there is any\u003C/p\u003E\u003Cp\u003E if (vpu != null ? vpu.vesselNode != null : false)\u003C/p\u003E\u003Cp\u003E {\u003C/p\u003E\u003Cp\u003E throwLine = 23;\u003C/p\u003E\u003Cp\u003E LoadVessel(vpu.vesselNode, vpu.vesselID);\u003C/p\u003E\u003Cp\u003E throwLine = 24;\u003C/p\u003E\u003Cp\u003E }\u003C/p\u003E\u003Cp\u003E }\u003C/p\u003E\u003Cp\u003E throwLine = 25;\u003C/p\u003E\u003Cp\u003E foreach (KeyValuePair\u0026lt;Guid, Queue\u0026lt;VesselUpdate\u0026gt;\u0026gt; vesselQueue in vesselUpdateQueue)\u003C/p\u003E\u003Cp\u003E {\u003C/p\u003E\u003Cp\u003E throwLine = 26;\u003C/p\u003E\u003Cp\u003E VesselUpdate vu = null;\u003C/p\u003E\u003Cp\u003E throwLine = 27;\u003C/p\u003E\u003Cp\u003E if (vesselQueue.Value == null)\u003C/p\u003E\u003Cp\u003E {\u003C/p\u003E\u003Cp\u003E Debug.Log(\u0022LINE27THROW vesselQueue.Value is null!\u0022);\u003C/p\u003E\u003Cp\u003E }\u003C/p\u003E\u003Cp\u003E if (vesselQueue.Value.Count \u0026gt; 0)\u003C/p\u003E\u003Cp\u003E {\u003C/p\u003E\u003Cp\u003E if (vesselQueue.Value.Peek() == null)\u003C/p\u003E\u003Cp\u003E {\u003C/p\u003E\u003Cp\u003E Debug.Log(\u0022LINE27THROW vesselQueue.Value.Peek() is null!\u0022);\u003C/p\u003E\u003Cp\u003E continue;\u003C/p\u003E\u003Cp\u003E }\u003C/p\u003E\u003Cp\u003E }\u003C/p\u003E\u003Cp\u003E //Get the latest position update\u003C/p\u003E\u003Cp\u003E while (vesselQueue.Value.Count \u0026gt; 0 ? (vesselQueue.Value.Peek().planetTime \u0026lt; Planetarium.GetUniversalTime()) : false)\u003C/p\u003E\u003Cp\u003E {\u003C/p\u003E\u003Cp\u003E throwLine = 28;\u003C/p\u003E\u003Cp\u003E vu = vesselQueue.Value.Dequeue();\u003C/p\u003E\u003Cp\u003E throwLine = 29;\u003C/p\u003E\u003Cp\u003E }\u003C/p\u003E\u003Cp\u003E throwLine = 30;\u003C/p\u003E\u003Cp\u003E //Apply it if there is any\u003C/p\u003E\u003Cp\u003E if (vu != null)\u003C/p\u003E\u003Cp\u003E {\u003C/p\u003E\u003Cp\u003E throwLine = 31;\u003C/p\u003E\u003Cp\u003E HackyInAtmoLoader.fetch.SetVesselUpdate(vesselQueue.Key, vu);\u003C/p\u003E\u003Cp\u003E throwLine = 32;\u003C/p\u003E\u003Cp\u003E vu.Apply();\u003C/p\u003E\u003Cp\u003E throwLine = 33;\u003C/p\u003E\u003Cp\u003E }\u003C/p\u003E\u003Cp\u003E }\u003C/p\u003E\u003Cp\u003E }\u003C/p\u003E\u003Cp\u003E catch (Exception e)\u003C/p\u003E\u003Cp\u003E {\u003C/p\u003E\u003Cp\u003E DarkLog.Debug(\u0022VESSEL UPDATE THROW: Threw on line \u0022 \u002B throwLine \u002B \u0022, exception: \u0022 \u002B e);\u003C/p\u003E\u003Cp\u003E }\u003C/p\u003E\u003Cp\u003E }\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/blockquote\u003E\n"},{"CreatedByName":"taniwha","CreatedById":57176,"CreatedDateTime":"2015-03-29T11:18:42Z","Content":"\n\u003Cp\u003Eheh, I do similar with Debug.Log(\u0022a\u0022) b c d...\u003C/p\u003E\u003Cp\u003Ebtw, for those compiling using gmcs (usually using Makefiles: just add -debug to the gmcs command line).\u003C/p\u003E\n"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2015-03-29T13:14:02Z","Content":"\n\u003Cp\u003EEdited to show that the command line for the mdb generation must be launched from the dll dir (thanks ilo)\u003C/p\u003E\n"},{"CreatedByName":"ilo","CreatedById":130783,"CreatedDateTime":"2015-03-29T13:21:20Z","Content":"\n\u003Cp\u003EThis will definitelly change and improve the addon development a lot! thank you Sarbian\u003C/p\u003E\n"},{"CreatedByName":"NathanKell","CreatedById":75006,"CreatedDateTime":"2015-03-29T18:46:32Z","Content":"\n\u003Cp\u003EWell dang, that\u0027s pretty awesome indeed! Kudos sarbian!\u003C/p\u003E\n"},{"CreatedByName":"Teknoman117","CreatedById":53200,"CreatedDateTime":"2015-03-29T22:15:06Z","Content":"\n\u003Cp\u003EOh wow. This will be absolutely fantastic. So much better than that old project where you had to build a modified version of the Mono libraries. \u003C/p\u003E\u003Cp\u003EEdit: I\u0027m stupid. You linked the archives.\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022font-size:8px;\u0022\u003E\u003Cspan style=\u0022color:#C0C0C0;\u0022\u003E- - - Updated - - -\u003C/span\u003E\u003C/span\u003E\u003C/p\u003E\u003Cp\u003EActually, could you email me the linux executables? I\u0027m in the middle of a project with Unity 4.6 and don\u0027t particularly want to risk breaking my dev environment by reverting Unity and then going back\u003C/p\u003E\n"},{"CreatedByName":"Teknoman117","CreatedById":53200,"CreatedDateTime":"2015-03-29T23:01:10Z","Content":"\n\u003Cp\u003EOkay, so, just my luck it doesn\u0027t work for me...\u003C/p\u003E\u003Cp\u003EDid everything you said, got the \u0022development version\u0022 watermark in the KSP window and everything. However, nothing happens when I try to attach to the process (I\u0027m guessing it failed to attach). However, it sometimes opens the developer console with a long list of the same message about failing to wait on a semaphore (something which seemed to be mentioned in angavrilov\u0027s commit log for his debugger. If i try to set a breakpoint anywhere, a couple seconds later mono pops up a dialog with \u0022Debug operation failed.\u0022 I verfied that in this case I hit attach before the connection timed out.\u003C/p\u003E\u003Cp\u003EThis is what the executable spits out for me as well.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003ESet current directory to /home/nathaniel/Projects/ksp/0.90.0\u003Cbr\u003EFound path: /home/nathaniel/Projects/ksp/0.90.0/KSP.x86_64\u003Cbr\u003EMono path[0] = \u0027/home/nathaniel/Projects/ksp/0.90.0/KSP_Data/Managed\u0027\u003Cbr\u003EMono path[1] = \u0027/home/nathaniel/Projects/ksp/0.90.0/KSP_Data/Mono\u0027\u003Cbr\u003EMono config path = \u0027/home/nathaniel/Projects/ksp/0.90.0/KSP_Data/Mono/etc\u0027\u003Cbr\u003EPlayerConnection initialized from /home/nathaniel/Projects/ksp/0.90.0/KSP_Data (debug = 0)\u003Cbr\u003EPlayerConnection initialized network socket : 0.0.0.0 55502\u003Cbr\u003EMulti-casting \u0022[IP] 192.168.1.69 [Port] 55502 [Flags] 3 [Guid] 661409256 [EditorId] 803286173 [Version] 1048832 [Id] LinuxPlayer(192.168.1.69) [Debug] 1\u0022 to [225.0.0.222:54997]...\u003Cbr\u003EWaiting for connection from host on [192.168.1.69:55502]...\u003Cbr\u003ETimed out. Continuing without host connection.\u003Cbr\u003EUsing monoOptions --debugger-agent=transport=dt_socket,embedding=1,defer=y,address=0.0.0.0:56256\u003Cbr\u003EPlayerConnection already initialized - listening to [192.168.1.69:55502]\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-03-29T23:03:33Z\u0022 title=\u002203/29/2015 11:03  PM\u0022 data-short=\u00229 yr\u0022\u003EMarch 29, 2015\u003C/time\u003E by Teknoman117\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2015-03-30T12:10:54Z","Content":"\n\u003Cp\u003EI am afraid I can\u0027t help much here. Others reported that it works for them on Linux. Try switching the mono lib for the one that angavrilov built, his fix may help and you should still get the easier debugging.\u003C/p\u003E\n"},{"CreatedByName":"TriggerAu","CreatedById":57838,"CreatedDateTime":"2015-04-06T07:19:54Z","Content":"\n\u003Cp\u003EExcellent stuff Sarbian, worked first time for me - after I got the right Unity version (facepalm). Thanks heaps\u003C/p\u003E\n"},{"CreatedByName":"FreeThinker","CreatedById":117389,"CreatedDateTime":"2015-04-29T09:04:18Z","Content":"\n\u003Cp\u003EThis should be a sticky\u003C/p\u003E\n"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2015-04-29T10:36:51Z","Content":"\n\u003Cp\u003ENo point to sticky it since it does not seems to work with 1.0 (at least it did not in exp, I did not test with the release). I\u0027ll have a go at making it work again soonish since it is hard to got back to printing stuff once you had better.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-04-29T10:43:57Z\u0022 title=\u002204/29/2015 10:43  AM\u0022 data-short=\u00229 yr\u0022\u003EApril 29, 2015\u003C/time\u003E by sarbian\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Slother","CreatedById":142925,"CreatedDateTime":"2015-05-03T18:48:19Z","Content":"\n\u003Cp\u003EHas someone managed to get it working again?\u003C/p\u003E\u003Cp\u003EUsing the development version of the unity player causes a bunch of errors on startup and prevents ksp from starting up.\u003C/p\u003E\u003Cp\u003EI tried it on KSP version 1.0.2.842 with Unity version 4.6.4f1.\u003C/p\u003E\u003Cp\u003EError messages:\u003C/p\u003E\u003Cp\u003ESerialization depth limit exceeded at \u0027ThermalLink\u0027. There may be an object composition cycle in one or more of your serialized classes.\u003C/p\u003E\u003Cp\u003ESerialization depth limit exceeded at \u0027OcclusionData\u0027. There may be an object composition cycle in one or more of your serialized classes.\u003C/p\u003E\u003Cp\u003Eand lots of these:\u003C/p\u003E\u003Cp\u003EArgumentException: PropertyToID can only be called from the main thread.\u003C/p\u003E\u003Cp\u003EConstructors and field initializers will be executed from the loading thread when loading a scene.\u003C/p\u003E\u003Cp\u003EDon\u0027t use this function in the constructor or field initializers, instead move initialization code to the Awake or Start function.\u003C/p\u003E\u003Cp\u003E at (wrapper managed-to-native) UnityEngine.Shader:PropertyToID (string)\u003C/p\u003E\u003Cp\u003E at HighLogic..cctor () [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003C/p\u003E\u003Cp\u003ERethrow as TypeInitializationException: An exception was thrown by the type initializer for HighLogic\u003C/p\u003E\n"},{"CreatedByName":"TAz00","CreatedById":41667,"CreatedDateTime":"2015-05-06T09:39:52Z","Content":"\n\u003Cp\u003EAnyone get this to work with 1.0 yet?\u003C/p\u003E\n"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2015-05-06T12:29:52Z","Content":"\n\u003Cp\u003ENo. I will post if I make it work, don\u0027t worry.\u003C/p\u003E\n"},{"CreatedByName":"parachutingturtle","CreatedById":113739,"CreatedDateTime":"2015-05-06T13:03:43Z","Content":"\n\u003Cp\u003EI\u0027m getting the same kinds of errors as Slother \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_sad.gif\u0022 alt=\u0022:(\u0022\u003E\u003C/p\u003E\u003Cp\u003EI was so excited when I saw this thread, what a bummer.\u003C/p\u003E\n"},{"CreatedByName":"FW Industries","CreatedById":76529,"CreatedDateTime":"2015-05-07T22:29:21Z","Content":"\n\u003Cp\u003EHoly crap, I got it to work. I used Cecil to patch the assembly and fix the exceptions. Removed the static initializers and moved them to Awake() like the exceptions suggested. I still can\u0027t quite believe that actually worked.\u003C/p\u003E\u003Cp\u003ERun this in KSP_Data\\Managed, it will patch Assembly-CSharp.dll: \u003Ca href=\u0022https://dl.dropboxusercontent.com/u/7121093/ksp-mods/KSP%5B1.0.2%5DKspDevModePatcher%5BMay07%5D.zip\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://dl.dropboxusercontent.com/u/7121093/ksp-mods/KSP%5B1.0.2%5DKspDevModePatcher%5BMay07%5D.zip\u003C/a\u003E\u003C/p\u003E\u003Cp\u003ESource and license included.\u003C/p\u003E\u003Cp\u003EAfter that it just works as described in OP. The errors about deserialization with ThermalLink and OcclusionData are probably just red herrings. I get those even in release mode.\u003C/p\u003E\u003Cp\u003EThere were a few more exceptions that only popped up later in-game. So there might be a few more I didn\u0027t run into yet, but they can probably be fixed the same way.\u003C/p\u003E\n"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2015-05-07T22:50:17Z","Content":"\n\u003Cp\u003EI was just looking into doing that ! Great to see that it works. I know where the other change are needed and I ll have an other look tomorrow \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EThanks !\u003C/p\u003E\u003Cp\u003EEdit : You missed MapView ModuleAblator PQSMod_MaterialQuadRelative SkySphereControl. I ll fix that \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EThe deserialization errors are real problems but as you said they are in release too.\u003C/p\u003E\u003Cp\u003EEdit2 : I could not go to sleep with so near. Get the updated full \u003Ca href=\u0022https://www.sarbian.com/sarbian/KspDevModePatcher.zip\u0022 rel=\u0022external nofollow\u0022\u003Etool to patch the dll\u003C/a\u003E.\u003C/p\u003E\u003Cp\u003EAgain many thanks to FW Industries \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-05-08T00:00:57Z\u0022 title=\u002205/08/2015 12:00  AM\u0022 data-short=\u00229 yr\u0022\u003EMay 8, 2015\u003C/time\u003E by sarbian\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2015-05-08T11:27:10Z","Content":"\n\u003Cp\u003EI updated the patching exe again and it seems to work fine on my end now.\u003C/p\u003E\n"},{"CreatedByName":"TAz00","CreatedById":41667,"CreatedDateTime":"2015-05-08T12:17:19Z","Content":"\n\u003Cp\u003EAmazing, testing asap. \u003C/p\u003E\u003Cp\u003EKSP loads into development build now on 1.0. \u003C/p\u003E\u003Cp\u003ECan\u0027t wait to test out when i get home. Attach unity debugger atleast connects in VSS.\u003C/p\u003E\u003Cp\u003E*Edit, my god, it\u0027s full of breakpoints \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 alt=\u0022:D\u0022\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-05-08T14:13:39Z\u0022 title=\u002205/08/2015 02:13  PM\u0022 data-short=\u00229 yr\u0022\u003EMay 8, 2015\u003C/time\u003E by TAz00\u003C/strong\u003E\n\u003Cbr\u003ETested it\n\u003C/span\u003E\n"},{"CreatedByName":"TAz00","CreatedById":41667,"CreatedDateTime":"2015-05-08T15:36:55Z","Content":"\n\u003Cp\u003EIt sort of works alright. I did get an error whenever i try to step into this piece of code. I can break on the function call, but it errors out in the debug log as soon as you step into it. And code just continues without input. Until function breakpoint is triggered again.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E  private void CloneCurrentVessel()\u003Cbr\u003E            {\u003Cbr\u003E                Vessel original = FlightGlobals.ActiveVessel;\u003Cbr\u003E                ProtoVessel pv = new ProtoVessel(original);\u003Cbr\u003E                Guid vesselId = pv.vesselID;\u003Cbr\u003E                //Offending line \u003Cbr\u003E                Vessel newVessel = FlightGlobals.Vessels.Where(i =\u0026gt; i.protoVessel.vesselID.Equals(vesselId)).First();\u003Cbr\u003E\u003Cbr\u003E            }\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022color:#FF0000;\u0022\u003E\u003Cstrong\u003E[Exception]: TypeLoadException: Could not load type \u0027System.Func\u00602\u0027 from assembly \u0027mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089\u0027.\u003C/strong\u003E\u003C/span\u003E\u003C/p\u003E\u003Cp\u003EI\u0027ve tried compiling with the modified assembly and using the regular one. All in Visual Studio 2013 sp4.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-05-08T15:56:20Z\u0022 title=\u002205/08/2015 03:56  PM\u0022 data-short=\u00229 yr\u0022\u003EMay 8, 2015\u003C/time\u003E by TAz00\u003C/strong\u003E\n\u003Cbr\u003EProcess of elimination found 1 line of code\n\u003C/span\u003E\n"},{"CreatedByName":"parachutingturtle","CreatedById":113739,"CreatedDateTime":"2015-05-08T16:19:51Z","Content":"\n\u003Cp\u003Ehmmm, is this fix targeted at .NET 4.0 by any chance?\u003C/p\u003E\u003Cp\u003EI\u0027m getting this in my .NET 3.5 project:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Ewarning MSB3258: The primary reference \u0022Assembly-CSharp, Version=1.0.0.0, Culture=neutral, processorArchitecture=MSIL\u0022 could not be resolved because it has an indirect dependency on the .NET Framework assembly \u0022mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089\u0022 which has a higher version \u00224.0.0.0\u0022 than the version \u00222.0.0.0\u0022 in the current target framework.\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003Eand then a bunch of KSP types won\u0027t load\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Eerror CS0246: The type or namespace name \u0027PartModule\u0027 could not be found (are you missing a using directive or an assembly reference?)\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E(etc etc.)\u003C/p\u003E\u003Cp\u003EIf I target .NET 4.0, it builds fine, but then KSP won\u0027t load my plugin.\u003C/p\u003E\u003Cp\u003EEDIT: recompiled the patcher for .net3.5 and it works like a charm \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-05-08T16:41:45Z\u0022 title=\u002205/08/2015 04:41  PM\u0022 data-short=\u00229 yr\u0022\u003EMay 8, 2015\u003C/time\u003E by parachutingturtle\u003C/strong\u003E\n\u003Cbr\u003Eadded details\n\u003C/span\u003E\n"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2015-05-08T17:07:10Z","Content":"\n\u003Cp\u003EStrange I did not have that. But I rebuilt it for 3.5 and uploaded a new version anyway.\u003C/p\u003E\n"},{"CreatedByName":"TAz00","CreatedById":41667,"CreatedDateTime":"2015-05-08T20:42:11Z","Content":"\n\u003Cp\u003ESeems to have fixed it. I was compiling for 4.0\u003C/p\u003E\n"},{"CreatedByName":"Slother","CreatedById":142925,"CreatedDateTime":"2015-05-09T02:16:27Z","Content":"\n\u003Cp\u003EI can confirm that the patch is working for me too, awesome stuff!\u003C/p\u003E\n"}]}