{"TopicId":43707,"ForumId":34,"TopicTitle":"kOS Scriptable Autopilot System 0.9","CreatedByName":"KevinLaity","CreatedById":68050,"CreatedDateTime":"2013-08-24T14:28:17Z","PageNum":85,"Articles":[{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2013-11-27T22:20:32Z","Content":"\n\u003Cp\u003EFor those who don\u0027t believe me:\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://i.imgur.com/pRSrTTt.jpg\u0022 alt=\u0022pRSrTTt.jpg\u0022\u003E\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://i.imgur.com/zjHdt8F.jpg\u0022 alt=\u0022zjHdt8F.jpg\u0022\u003E\u003C/p\u003E\u003Cp\u003EI started from the first image, then burned slowly to the second image while printing my apoapsis as I burned. Note it stopped giving me negative numbers *before* I was captured. Therefore the thing that began the entire bug report, that being the fact that the numbers do NOT in fact tell me if I\u0027m going to escape or not, is true.\u003C/p\u003E\u003Cp\u003EAddendum: checking for STATUS=\u0022ESCAPING\u0022 has the same problem. It will claim I\u0027ve been captured (STATUS=\u0022ORBITING\u0022) when in fact I haven\u0027t been. It\u0027s reporting numbers as if KSP\u0027s concept of an SOI radius didn\u0027t exist.\u003C/p\u003E\u003Cp\u003EIf you want to roll back the changes to re-instate this behavior, then please explain an alternate way to get this data. I don\u0027t know how to query the game for the body\u0027s SOI radius. If there was a way to do that, that could provide an alternate way to get this information (\u003Cem\u003Eif apoapsis \u0026lt; 0 or apoapsis \u0026gt; Mun:SOI\u003C/em\u003E would work for example, if there was such a thing in the language as Mun:SOI).\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-11-27T22:43:51Z\u0022 title=\u002211/27/2013 10:43  PM\u0022 data-short=\u002210 yr\u0022\u003ENovember 27, 2013\u003C/time\u003E by Steven Mading\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2013-11-27T22:53:50Z","Content":"\n\u003Cp\u003EOn another front, I\u0027ve found a much easier way to work-around the craft loading bug.\u003C/p\u003E\u003Cp\u003EBefore you leave a craft that you intend to come back to later, issue this command on the KOS part (or all the KOS parts) that ever ran any KOS code:\u003C/p\u003E\u003Cp\u003ESHUTDOWN.\u003C/p\u003E\u003Cp\u003EThen when you reload the craft you can turn the KOS unit back on from the toggle power option on the rightclick menu..\u003C/p\u003E\u003Cp\u003EThe fact that the craft was shut off when it went onto rails means the KOS mod didn\u0027t try to save its variable context in the persistence file.\u003C/p\u003E\n"},{"CreatedByName":"KvickFlygarn87","CreatedById":76314,"CreatedDateTime":"2013-11-27T23:13:19Z","Content":"\n\u003Cp\u003EWhere is Kevin Laity? This could need some attention, with updates and such.\u003C/p\u003E\n"},{"CreatedByName":"mordieth","CreatedById":94668,"CreatedDateTime":"2013-11-28T00:16:11Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Camacha\u0022 data-cite=\u0022Camacha\u0022\u003E\u003Cdiv\u003EIt seems that the Infernal Robotics way of intercepting keypresses messes with the normal action groups. However, if you set the action groups in the editor (\u003Cem\u003Emove -\u003C/em\u003E to ag1 and \u003Cem\u003Emove \u002B\u003C/em\u003E to ag2) it is possible to use them through kOS.\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Eag1 off.\u003Cbr\u003Eag2 off.\u003Cbr\u003Eag9 off.\u003Cbr\u003E\u003Cbr\u003Euntil ag9 = \u0022True\u0022 {\u003Cbr\u003E  if ag1 = \u0022True\u0022 {wait 2. ag1 off.}.\u003Cbr\u003E  if ag2 = \u0022True\u0022 {wait 2. ag2 off.}.\u003Cbr\u003E}.\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EDownside when using this method is that the timing in kOS is not highly accurate, so when you press 4 and 5 a number of times, the neutral position might be different than the starting position. The same goes for when your hinge meets an end stop. Until we get real IR support that is how it is.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ESorry if i\u0027m being dense here but, for me that code doesn\u0027t do anything for me except complete when i press the key for ag9. am i missing something?\u003C/p\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2013-11-28T03:12:42Z","Content":"\n\u003Cp\u003EI keep having this happen in my script and I can\u0027t figure out why. It just started happening recently. When the script gets to the part where it hits \u0022stage\u0022 the first time, it completely ruins KSP, doing THIS to it:\u003C/p\u003E\u003Cp\u003E(Note the weird values for altitude and velocity. Most properties I attempt to print after the entire scree blacks out like that end up being bogus NaN values. They weren\u0027t prior to the blackout.)\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://i.imgur.com/uGBDJR4.jpg\u0022 alt=\u0022uGBDJR4.jpg\u0022\u003E\u003C/p\u003E\u003Cp\u003EThe only recourse at this point is to kill KSP from the task manager.\u003C/p\u003E\u003Cp\u003EAs near as I can tell this happens as soon as I execute \u0022stage\u0022. I\u0027m still trying to trace down the conditions that cause it. Every time I try making a reduced version of the ascent program that removes everything except the problem lines, it runs fine.\u003C/p\u003E\n"},{"CreatedByName":"KvickFlygarn87","CreatedById":76314,"CreatedDateTime":"2013-11-28T06:34:08Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Steven Mading\u0022 data-cite=\u0022Steven Mading\u0022\u003E\u003Cdiv\u003EI keep having this happen in my script and I can\u0027t figure out why. It just started happening recently. When the script gets to the part where it hits \u0022stage\u0022 the first time, it completely ruins KSP, doing THIS to it:\u003Cp\u003E(Note the weird values for altitude and velocity. Most properties I attempt to print after the entire scree blacks out like that end up being bogus NaN values. They weren\u0027t prior to the blackout.)\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://i.imgur.com/uGBDJR4.jpg\u0022 alt=\u0022uGBDJR4.jpg\u0022\u003E\u003C/p\u003E\u003Cp\u003EThe only recourse at this point is to kill KSP from the task manager.\u003C/p\u003E\u003Cp\u003EAs near as I can tell this happens as soon as I execute \u0022stage\u0022. I\u0027m still trying to trace down the conditions that cause it. Every time I try making a reduced version of the ascent program that removes everything except the problem lines, it runs fine.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EGood morning, Hell Kraken!\u003C/p\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2013-11-28T07:01:12Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022KvickFlygarn87\u0022 data-cite=\u0022KvickFlygarn87\u0022\u003E\u003Cdiv\u003EGood morning, Hell Kraken!\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EApparently the expression I was trying to lock the throttle to was producing a value of Infinity while maxthrust was zero, which it temporarily is for just an instant during the staging process. So I unlock the throttle, then do the stage, then relock the throttle and the problem seems to have gone away.\u003C/p\u003E\n"},{"CreatedByName":"Garek","CreatedById":73214,"CreatedDateTime":"2013-11-28T08:42:51Z","Content":"\n\u003Cp\u003ESo if you throttle to infinity, the Hell Kraken eats you? seems kind of appropriate Oo\u003C/p\u003E\n"},{"CreatedByName":"Sacred Aardvark","CreatedById":85856,"CreatedDateTime":"2013-11-28T09:34:27Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Garek\u0022 data-cite=\u0022Garek\u0022\u003E\u003Cdiv\u003ESo if you throttle to infinity, the Hell Kraken eats you? seems kind of appropriate Oo\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003E\u0022To Infinity... and beyond!\u0022 \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif\u0022 alt=\u0022:wink:\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"wingnut","CreatedById":57702,"CreatedDateTime":"2013-11-28T12:44:17Z","Content":"\n\u003Cp\u003ECould someone please review a script for me which is supposed to calculate true anomaly in an eccentric orbit and after that the altitude and speed at this true anomaly.\u003C/p\u003E\u003Cp\u003EThe script seems to deliver results which are not completely wrong but I can\u0027t verify that the calculated true anomaly is correct. Further to this, the calculated altitude and speed always seem to be corresponding to the periapsis even when I enter different mean anomalies.\u003C/p\u003E\u003Cp\u003EMy script is based on the algorithm found on \u003Ca href=\u0022http://www.jgiesen.de/kepler/kepler.html\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://www.jgiesen.de/kepler/kepler.html\u003C/a\u003E as well as the equations and example problems of the Orbital Mechanics page on \u003Ca href=\u0022http://www.braeunig.us/space/\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://www.braeunig.us/space/\u003C/a\u003E.\u003C/p\u003E\u003Cp\u003EThis is the script:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E// True anomaly\u003Cbr\u003Eset mu to 3.5316000*10^12.  // gravitational parameter\u003Cbr\u003Eset rb to 600000.           // radius of body\u003Cbr\u003Edeclare parameter tof.\u003Cbr\u003Eset a to (rb*2 \u002B periapsis \u002B apoapsis)/2. //SMa\u003Cbr\u003Eset ec to ((rb\u002Bapoapsis) - (rb\u002Bperiapsis))/((rb\u002Bapoapsis) \u002B (rb\u002Bperiapsis)). //eccentricity\u003Cbr\u003Eset t to 2*3.14159*sqrt(a^3/mu). //orbital period\u003Cbr\u003Eset n to sqrt(mu/a^3). //mean motion\u003Cbr\u003Eset M to n * tof. //mean anomaly at tof seconds after periapsis\u003Cbr\u003E\u003Cbr\u003Eset maxiter to 30.\u003Cbr\u003Eset delta to 10^-3.\u003Cbr\u003Eset i to 0.\u003Cbr\u003E\u003Cbr\u003Eif ec \u0026lt; 0.8 {set E to m.} //eccentric anomaly\u003Cbr\u003Eif ec \u0026gt;= 0.8 {set E to 3.14159.}\u003Cbr\u003E\u003Cbr\u003Eset F to E - ec * sin(m) - m.\u003Cbr\u003Eset absF to F.\u003Cbr\u003Eif absF \u0026lt; 0 {set absF to F * (-1).}\u003Cbr\u003E\u003Cbr\u003Euntil absF \u0026lt;= delta OR i \u0026lt; maxiter {\u003Cbr\u003E\tset E to E - F / (1.0 - ec * cos(E)).\u003Cbr\u003E\tset F to E - ec * sin(E) - m.\u003Cbr\u003E\tset absF to F.\u003Cbr\u003E\tif absF \u0026lt; 0 {set absF to F * (-1).}\u003Cbr\u003E\tset i to i \u002B 1.\u003Cbr\u003E}\u003Cbr\u003E\u003Cbr\u003E//set E to E / (3.14159 / 180). // convert to degree\u003Cbr\u003E\u003Cbr\u003Eset fak to sqrt(1.0 - ec^2).\u003Cbr\u003Eset phi to arctan2(fak * sin(E), cos(E) - ec).\u003Cbr\u003E\u003Cbr\u003Eset r to a * (1 - ec^2) / (1 \u002B ec * cos(phi)). // altitude at true anomaly\u003Cbr\u003Eset v to sqrt(mu * (2 / r - 1 / a)). // velocity at true anomaly\u003Cbr\u003E\u003Cbr\u003Eprint \u0022Elements for \u0022 \u002B multi \u002B \u0022 seconds after periapsis\u0022.\u003Cbr\u003Elog \u0022Elements for \u0022 \u002B multi \u002B \u0022 seconds after periapsis\u0022 to orblog.\u003Cbr\u003Eprint \u0022True anomaly: \u0022 \u002B phi.\u003Cbr\u003Elog \u0022True anomaly: \u0022 \u002B phi to orblog.\u003Cbr\u003Eprint \u0022Mean anomaly: \u0022 \u002B M.\u003Cbr\u003Elog \u0022Mean anomaly: \u0022 \u002B M to orblog.\u003Cbr\u003Eprint \u0022Eccentric anomaly: \u0022 \u002B E.\u003Cbr\u003Elog \u0022Eccentric anomaly: \u0022 \u002B E to orblog.\u003Cbr\u003Eprint \u0022Radius: \u0022 \u002B r.\u003Cbr\u003Elog \u0022Radius: \u0022 \u002B r to orblog.\u003Cbr\u003Eprint \u0022Speed: \u0022 \u002B v.\u003Cbr\u003Elog \u0022Speed: \u0022 \u002B v to orblog.\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EThis is output created by the script for a ca. 80km x 1,000 km Kerbin orbit:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003EElements for 3037.5 seconds after periapsis\u003Cbr\u003ETrue anomaly: 5.77998497874809\u003Cbr\u003EMean anomaly: 3.14123160679727\u003Cbr\u003EEccentric anomaly: 3.14123160679727\u003Cbr\u003ERadius: 679672.744713293\u003Cbr\u003ESpeed: 2832.04616886257\u003Cbr\u003E\u003Cbr\u003EElements for 0 seconds after periapsis\u003Cbr\u003ETrue anomaly: 0\u003Cbr\u003EMean anomaly: 0\u003Cbr\u003EEccentric anomaly: 0\u003Cbr\u003ERadius: 678454.711152033\u003Cbr\u003ESpeed: 2835.3381463772\u003Cbr\u003E\u003Cbr\u003EElements for 1518.75 seconds after periapsis\u003Cbr\u003ETrue anomaly: 2.89128867366892\u003Cbr\u003EMean anomaly: 1.57061583805724\u003Cbr\u003EEccentric anomaly: 1.57061583805724\u003Cbr\u003ERadius: 678759.294063534\u003Cbr\u003ESpeed: 2834.51419835746\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-11-28T12:46:31Z\u0022 title=\u002211/28/2013 12:46  PM\u0022 data-short=\u002210 yr\u0022\u003ENovember 28, 2013\u003C/time\u003E by wingnut\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Bizz Keryear","CreatedById":68896,"CreatedDateTime":"2013-11-28T14:41:31Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022KvickFlygarn87\u0022 data-cite=\u0022KvickFlygarn87\u0022\u003E\u003Cdiv\u003EWhere is Kevin Laity? This could need some attention, with updates and such.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EFunny you ask... He made me become an internet stalker of him ... Last sign of life: (I found so far) 17 hours ago ... source: *secret* ... Bad enough that I stalk.\u003C/p\u003E\u003Cp\u003EEdit: frighting how public live has become ... now I know things about him I never wanted to know...\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-11-28T15:11:02Z\u0022 title=\u002211/28/2013 03:11  PM\u0022 data-short=\u002210 yr\u0022\u003ENovember 28, 2013\u003C/time\u003E by Bizz Keryear\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"AbeS","CreatedById":80644,"CreatedDateTime":"2013-11-28T15:22:48Z","Content":"\n\u003Cp\u003E@wingnut, why don\u0027t you just: set r to rb \u002B altitude ? it\u0027s easier \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif\u0022 alt=\u0022:P\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"asdfCYBER","CreatedById":94319,"CreatedDateTime":"2013-11-28T15:48:21Z","Content":"\n\u003Cp\u003EThis is absolutely a fantastic mod! I always wanted something like this!\u003C/p\u003E\n"},{"CreatedByName":"wingnut","CreatedById":57702,"CreatedDateTime":"2013-11-28T16:21:10Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022AbeS\u0022 data-cite=\u0022AbeS\u0022\u003E\u003Cdiv\u003E@wingnut, why don\u0027t you just: set r to rb \u002B altitude ? it\u0027s easier \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif\u0022 alt=\u0022:P\u0022\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EBecause you need the True Anomaly to calculate your altitude and speed at any point in the orbit in contrast to Altitude and velocity:orbit:mag only returning the current values.\u003C/p\u003E\u003Cp\u003EI think the discrepancies may have something to do with the way Sin and Cos are calculated but I\u0027m not sure. I\u0027ve setup virtually the same script in a Java class and I get accurate results there...\u003C/p\u003E\n"},{"CreatedByName":"AbeS","CreatedById":80644,"CreatedDateTime":"2013-11-28T16:30:32Z","Content":"\n\u003Cp\u003EOh I get it! I\u0027ve always wanted such a script! \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Camacha","CreatedById":59088,"CreatedDateTime":"2013-11-28T16:42:57Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Steven Mading\u0022 data-cite=\u0022Steven Mading\u0022\u003E\u003Cdiv\u003EIf you want to roll back the changes to re-instate this behavior, then please explain an alternate way to get this data. I don\u0027t know how to query the game for the body\u0027s SOI radius. If there was a way to do that, that could provide an alternate way to get this information (\u003Cem\u003Eif apoapsis \u0026lt; 0 or apoapsis \u0026gt; Mun:SOI\u003C/em\u003E would work for example, if there was such a thing in the language as Mun:SOI).\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI feel this is a different matter. If a number is useful, it should not be removed from the code. If that causes other problems they should be solved in their own way.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022mordieth\u0022 data-cite=\u0022mordieth\u0022\u003E\u003Cdiv\u003ESorry if i\u0027m being dense here but, for me that code doesn\u0027t do anything for me except complete when i press the key for ag9. am i missing something?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EDid you set the \u003Ca href=\u0022http://wiki.kerbalspaceprogram.com/wiki/Action_group\u0022 rel=\u0022external nofollow\u0022\u003Eactions groups\u003C/a\u003E in the editor/VAB for the Infernal Robotics part you are trying to control? After adding the part to your construction, set \u003Cem\u003Emove -\u003C/em\u003E to ag1 and \u003Cem\u003Emove\u003C/em\u003E \u002B to ag2. Note, this is something different than setting the keys in the Infernal Robotics pop-up.\u003C/p\u003E\u003Cp\u003EWithout an Infernal Robotics part or setting the correct action groups in the VAB for that part not much will happen \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-11-28T16:48:07Z\u0022 title=\u002211/28/2013 04:48  PM\u0022 data-short=\u002210 yr\u0022\u003ENovember 28, 2013\u003C/time\u003E by Camacha\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"baloan","CreatedById":91670,"CreatedDateTime":"2013-11-28T21:16:13Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003EI started from the first image, then burned slowly to the second image while printing my apoapsis as I burned. Note it stopped giving me negative numbers *before* I was captured. Therefore the thing that began the entire bug report, that being the fact that the numbers do NOT in fact tell me if I\u0027m going to escape or not, is true.\u003Cp\u003E Addendum: checking for STATUS=\u0022ESCAPING\u0022 has the same problem. It will claim I\u0027ve been captured (STATUS=\u0022ORBITING\u0022) when in fact I haven\u0027t been. It\u0027s reporting numbers as if KSP\u0027s concept of an SOI radius didn\u0027t exist.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EHi Steven, \u003C/p\u003E\u003Cp\u003EWorks as designed.\u003C/p\u003E\u003Cp\u003EOne thing in advance. We have\u003C/p\u003E\u003Cp\u003E1. orbital energy which is invariant and does only change when burning the engine (or thrusters),\u003C/p\u003E\u003Cp\u003E2. how KSP approximates the laws of gravity. It uses patched conics. This is were SOI comes from\u003C/p\u003E\u003Cp\u003Eand 1. and 2. are two different things.\u003C/p\u003E\u003Cp\u003EWhen we look at apoapsis we look at 1. To better understand what happens we also look at specific orbital energy soe. \u003C/p\u003E\u003Cp\u003Esoe is defined like this:\u003C/p\u003E\u003Cp\u003Ea) negative while captured (elliptic)\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_cool.png\u0022 alt=\u0022B)\u0022\u003E 0 for parabolic escape \u003C/p\u003E\u003Cp\u003Ec) positive for hyperbolic escape\u003C/p\u003E\u003Cp\u003Esoe = - mu / sma // sma being the semi-major axis\u003C/p\u003E\u003Cp\u003Esma = (rper \u002B 2*rmun \u002B rapo)/2 // with periapsis, the bodies\u0027 radius and apoapsis, respectively.\u003C/p\u003E\u003Cp\u003EWhen you burn prograde you add energy to soe, retrograde you remove energy.\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003EHow to explain the apoapsis values?\u003C/strong\u003E\u003C/p\u003E\u003Cp\u003EOn the picture it looks like your starting orbit was probably circular, i.e. periapsis ~230km as well. I use that number - and rmun = 200km - to compute soe.\u003C/p\u003E\u003Cp\u003Eapoapsis: 229198, soe ~ -60000 (using mu for Mun with 6E\u002B10)\u003C/p\u003E\u003Cp\u003ENow you have burned prograde, added lots of energy and produced a hyperbolic escape trajectory. soe has become positive. \u003C/p\u003E\u003Cp\u003Eapoapsis: -1722155, soe ~ 1022155 (hyperbolic escape)\u003C/p\u003E\u003Cp\u003EHow much energy you added to soe? Calculate for yourself: deltasoe = (v2^2 - v1^2)/2\u003C/p\u003E\u003Cp\u003EAs long as you don\u0027t burn here, no energy added or removed, soe remains constant and apoapsis doesn\u0027t change (have you checked?)\u003C/p\u003E\u003Cp\u003EHere you have started burning retrograde, removing energy, soe gets smaller, sma and apoapsis greater.\u003C/p\u003E\u003Cp\u003Eapoapsis: -4018355\u003C/p\u003E\u003Cp\u003Eapoapsis: -5677602\u003C/p\u003E\u003Cp\u003Eapoapsis: -79147548\u003C/p\u003E\u003Cp\u003Euntil soe crosses 0 and becomes negative, apoapsis starts to come down from infinity.\u003C/p\u003E\u003Cp\u003Eapoapsis: \u002B3312767, soe \u0026lt; 0 again\u003C/p\u003E\u003Cp\u003Eapoapsis: \u002B2342288\u003C/p\u003E\u003Cp\u003EOnce your apoapsis becomes smaller than soi KSP will show you a closed orbit.\u003C/p\u003E\u003Cp\u003EGeometrically apoapsis flip to the opposite side of the opening of the \u003Ca href=\u0022https://en.wikipedia.org/wiki/Hyperbola\u0022 rel=\u0022external nofollow\u0022\u003Ehyperbola\u003C/a\u003E. That and due to the maths it becomes negative.\u003C/p\u003E\u003Cp\u003EThe vertex at the end of the blue line is the soi. It is due to KSP\u0027s approach on how to deal with gravity that the soi differs from the physics of an escape orbit. periapsis, apoapsis, velocity:orbit:mag, altitude are all about the potential and kinetic energy in the system. \u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003ESo why is soi so different from the energy escape orbit?\u003C/strong\u003E\u003C/p\u003E\u003Cp\u003EThe soi radius is used in KSP to simplify calculating gravitation. Within the soi only the body inside pulls at your ship (simple to calculate two body problem). All others planets, moon like Kerbin or the Sun are ignored. This is grossly wrong but good enough for the game and good enough for estimating transfers in reality. The soi is the boundary where Mun and Kerbin\u0027s gravitational force are equal. At the soi - in reality - your vessel will not move, in the game it falls to one of the bodies. That is why the game does not have Lagrange points.\u003C/p\u003E\u003Cp\u003EEssentially that is why physics and the soi vertex on the blue trajectory line do not match.\u003C/p\u003E\u003Cp\u003EActually the guys who coded KSP obviously used the physical properties to determine status and not the soi. \u003C/p\u003E\u003Cp\u003EFor getting the soi (or the radius) of a body you need to build a database - or better: we make those constants available in kOS.\u003C/p\u003E\u003Cp\u003EBtw: I agree with Camacha on: as a rule in a software system you should not change existing variables because it will break existing code. Instead add a new one. (Unless there is a very good reason to change it...)\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-11-28T21:37:32Z\u0022 title=\u002211/28/2013 09:37  PM\u0022 data-short=\u002210 yr\u0022\u003ENovember 28, 2013\u003C/time\u003E by baloan\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"baloan","CreatedById":91670,"CreatedDateTime":"2013-11-28T21:22:41Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022wingnut\u0022 data-cite=\u0022wingnut\u0022\u003E\u003Cdiv\u003ECould someone please review a script\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EDouble check the loop variables.\u003C/p\u003E\n"},{"CreatedByName":"baloan","CreatedById":91670,"CreatedDateTime":"2013-11-28T21:34:06Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Steven Mading\u0022 data-cite=\u0022Steven Mading\u0022\u003E\u003Cdiv\u003EOn another front, I\u0027ve found a much easier way to work-around the craft loading bug.\u003Cp\u003EBefore you leave a craft that you intend to come back to later, issue this command on the KOS part (or all the KOS parts) that ever ran any KOS code:\u003C/p\u003E\u003Cp\u003ESHUTDOWN.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThat\u0027s a nice workaround. I\u0027ll try that next time.\u003C/p\u003E\u003Cp\u003EShould be fixed next time we get a release nonetheless.\u003C/p\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2013-11-28T22:53:34Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022baloan\u0022 data-cite=\u0022baloan\u0022\u003E\u003Cdiv\u003EHi Steven, \u003Cp\u003EWorks as designed.\u003C/p\u003E\u003Cp\u003EOne thing in advance. We have\u003C/p\u003E\u003Cp\u003E1. orbital energy which is invariant and does only change when burning the engine (or thrusters),\u003C/p\u003E\u003Cp\u003E2. how KSP approximates the laws of gravity. It uses patched conics. This is were SOI comes from\u003C/p\u003E\u003Cp\u003Eand 1. and 2. are two different things.\u003C/p\u003E\u003Cp\u003EWhen we look at apoapsis we look at 1. To better understand what happens we also look at specific orbital energy soe. \u003C/p\u003E\u003Cp\u003Esoe is defined like this:\u003C/p\u003E\u003Cp\u003Ea) negative while captured (elliptic)\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_cool.png\u0022 alt=\u0022B)\u0022\u003E 0 for parabolic escape \u003C/p\u003E\u003Cp\u003Ec) positive for hyperbolic escape\u003C/p\u003E\u003Cp\u003Esoe = - mu / sma // sma being the semi-major axis\u003C/p\u003E\u003Cp\u003Esma = (rper \u002B 2*rmun \u002B rapo)/2 // with periapsis, the bodies\u0027 radius and apoapsis, respectively.\u003C/p\u003E\u003Cp\u003EWhen you burn prograde you add energy to soe, retrograde you remove energy.\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003EHow to explain the apoapsis values?\u003C/strong\u003E\u003C/p\u003E\u003Cp\u003EOn the picture it looks like your starting orbit was probably circular, i.e. periapsis ~230km as well. I use that number - and rmun = 200km - to compute soe.\u003C/p\u003E\u003Cp\u003Eapoapsis: 229198, soe ~ -60000 (using mu for Mun with 6E\u002B10)\u003C/p\u003E\u003Cp\u003ENow you have burned prograde, added lots of energy and produced a hyperbolic escape trajectory. soe has become positive. \u003C/p\u003E\u003Cp\u003Eapoapsis: -1722155, soe ~ 1022155 (hyperbolic escape)\u003C/p\u003E\u003Cp\u003EHow much energy you added to soe? Calculate for yourself: deltasoe = (v2^2 - v1^2)/2\u003C/p\u003E\u003Cp\u003EAs long as you don\u0027t burn here, no energy added or removed, soe remains constant and apoapsis doesn\u0027t change (have you checked?)\u003C/p\u003E\u003Cp\u003EHere you have started burning retrograde, removing energy, soe gets smaller, sma and apoapsis greater.\u003C/p\u003E\u003Cp\u003Eapoapsis: -4018355\u003C/p\u003E\u003Cp\u003Eapoapsis: -5677602\u003C/p\u003E\u003Cp\u003Eapoapsis: -79147548\u003C/p\u003E\u003Cp\u003Euntil soe crosses 0 and becomes negative, apoapsis starts to come down from infinity.\u003C/p\u003E\u003Cp\u003Eapoapsis: \u002B3312767, soe \u0026lt; 0 again\u003C/p\u003E\u003Cp\u003Eapoapsis: \u002B2342288\u003C/p\u003E\u003Cp\u003EOnce your apoapsis becomes smaller than soi KSP will show you a closed orbit.\u003C/p\u003E\u003Cp\u003EGeometrically apoapsis flip to the opposite side of the opening of the \u003Ca href=\u0022https://en.wikipedia.org/wiki/Hyperbola\u0022 rel=\u0022external nofollow\u0022\u003Ehyperbola\u003C/a\u003E. That and due to the maths it becomes negative.\u003C/p\u003E\u003Cp\u003EThe vertex at the end of the blue line is the soi. It is due to KSP\u0027s approach on how to deal with gravity that the soi differs from the physics of an escape orbit. periapsis, apoapsis, velocity:orbit:mag, altitude are all about the potential and kinetic energy in the system. \u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003ESo why is soi so different from the energy escape orbit?\u003C/strong\u003E\u003C/p\u003E\u003Cp\u003EThe soi radius is used in KSP to simplify calculating gravitation. Within the soi only the body inside pulls at your ship (simple to calculate two body problem). All others planets, moon like Kerbin or the Sun are ignored. This is grossly wrong but good enough for the game and good enough for estimating transfers in reality. The soi is the boundary where Mun and Kerbin\u0027s gravitational force are equal. At the soi - in reality - your vessel will not move, in the game it falls to one of the bodies. That is why the game does not have Lagrange points.\u003C/p\u003E\u003Cp\u003EEssentially that is why physics and the soi vertex on the blue trajectory line do not match.\u003C/p\u003E\u003Cp\u003EActually the guys who coded KSP obviously used the physical properties to determine status and not the soi. \u003C/p\u003E\u003Cp\u003EFor getting the soi (or the radius) of a body you need to build a database - or better: we make those constants available in kOS.\u003C/p\u003E\u003Cp\u003EBtw: I agree with Camacha on: as a rule in a software system you should not change existing variables because it will break existing code. Instead add a new one. (Unless there is a very good reason to change it...)\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI\u0027m aware of everything you said here. It does not cause the problem to go away, nor does it make it magically stop being a problem no matter how much you keep repeating the mantra that it \u0022works as designed\u0022. You just accurately described what\u0027s wrong, which is, in a nutshell, that what the laws of physics claims your apoapsis is, is not in agreement with what it actually is in the simulation, and for the sake of an autopilot, what we need to know is what the simulation thinks it is, not what the laws of physics claims it is. If I want to burn retrograde until captured, I have no choice but to use what the KSP simulation thinks of as escaping, which is not what physics claims is escaping, nor is it what status=\u0022ESCAPING\u0027 claims is escaping.\u003C/p\u003E\u003Cp\u003EAnd there is a difference between a number that happens to work in a degenerate case and a number that means what it\u0027s defined as. A negative apoapsis violates the definition of what an apoapsis IS.\u003C/p\u003E\u003Cp\u003EA far better solution is to get the eccentricity as a direct query, rather than to falsify the apoapsis to let you calculate eccentricity from it and in so doing to break the ability to detect whether or not you\u0027re going to exit the SOI.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-11-28T22:58:53Z\u0022 title=\u002211/28/2013 10:58  PM\u0022 data-short=\u002210 yr\u0022\u003ENovember 28, 2013\u003C/time\u003E by Steven Mading\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2013-11-28T23:04:04Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022wingnut\u0022 data-cite=\u0022wingnut\u0022\u003E\u003Cdiv\u003E\u003Cp\u003EThe script seems to deliver results which are not completely wrong but I can\u0027t verify that the calculated true anomaly is correct. Further to this, the calculated altitude and speed always seem to be corresponding to the periapsis even when I enter different mean anomalies.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI frequently find that I get numbers that are close to correct but not exactly correct when trying to use inverse trig functions like arctan.\u003C/p\u003E\u003Cp\u003ETrying to calculate where the ascending and descending nodes were between me and a target for the sake of doing an inclination correction had the same problem, where it was always off by just a degree or so, untill I used larger vectors for it. (i.e. finding the dot product of two unit vectors and then getting the cosine from that dot product seems to be rather error prone, whereas doing it with the full length vectors instead of with unit vectors, gets a far more accurate answer.)\u003C/p\u003E\n"},{"CreatedByName":"Camacha","CreatedById":59088,"CreatedDateTime":"2013-11-29T00:06:58Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Steven Mading\u0022 data-cite=\u0022Steven Mading\u0022\u003E\u003Cdiv\u003EAnd there is a difference between a number that happens to work in a degenerate case and a number that means what it\u0027s defined as. A negative apoapsis violates the definition of what an apoapsis IS.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI get the feeling this naming thing is important to you, possibly too important. In itself it is no reason to remove the variable from the system. It could be called \u003Cem\u003EFluxorp517394negative\u003C/em\u003E, if it is useful, it should be retained. If there is no pull request to implement a better variable, is should be left alone.\u003C/p\u003E\u003Cp\u003EBreaking something that is possibly broken - \u003Cem\u003Ebut useful\u003C/em\u003E - is not the right way to go without providing a viable alternative.\u003C/p\u003E\n"},{"CreatedByName":"Sacred Aardvark","CreatedById":85856,"CreatedDateTime":"2013-11-29T10:16:52Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Camacha\u0022 data-cite=\u0022Camacha\u0022\u003E\u003Cdiv\u003EBreaking something that is possibly broken - \u003Cem\u003Ebut useful\u003C/em\u003E - is not the right way to go without providing a viable alternative.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI can\u0027t understand half the things you guys are talking about most of the time, so I\u0027ll just settle for QFT \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003ELot of the stuff I do in kOS probably doesn\u0027t work like its supposed to, and I\u0027ve done stuff that definitely doesn\u0027t work like it\u0027s supposed to, but it does work \u003Cem\u003Efor what I use it for\u003C/em\u003E which is all that matters in the end, to me anyway. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif\u0022 alt=\u0022:P\u0022\u003E\u003C/p\u003E\u003Cp\u003Eedit: Just to clarify a bit, I\u0027m all for fixing broken stuff if there\u0027s a viable alternative to whatever can be done with the broken thing. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-11-29T11:20:26Z\u0022 title=\u002211/29/2013 11:20  AM\u0022 data-short=\u002210 yr\u0022\u003ENovember 29, 2013\u003C/time\u003E by Sacred Aardvark\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"baloan","CreatedById":91670,"CreatedDateTime":"2013-11-29T18:02:06Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Steven Mading\u0022 data-cite=\u0022Steven Mading\u0022\u003E\u003Cdiv\u003EI\u0027m aware of everything you said here. It does not cause the problem to go away, nor does it make it magically stop being a problem no matter how much you keep repeating the mantra that it \u0022works as designed\u0022. You just accurately described what\u0027s wrong, which is, in a nutshell, that what the laws of physics claims your apoapsis is, is not in agreement with what it actually is in the simulation, and for the sake of an autopilot, what we need to know is what the simulation thinks it is, not what the laws of physics claims it is. If I want to burn retrograde until captured, I have no choice but to use what the KSP simulation thinks of as escaping, which is not what physics claims is escaping, nor is it what status=\u0022ESCAPING\u0027 claims is escaping.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYes, right. I don\u0027t see the discrepancy between two models in KSP (patched conics, Kepler orbits) as a problem but as a feature. That\u0027s why it is really hard for me to follow your reasoning. The problem does not go away as long as KSP is based on those models to build its universe. And while you are within the SOI everything matches.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003EAnd there is a difference between a number that happens to work in a degenerate case and a number that means what it\u0027s defined as. A negative apoapsis violates the definition of what an apoapsis IS.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI agree that apoapsis does not make sense as \u0022highest point of orbit\u0022 in all cases. But I care a lot about mathematical consistency. A negative apoapsis goes nicely with conservation of energy and the mathematical construct around it. And here apoapsis, periapsis, semi-major axis, eccentricity, specific orbital energy are all well defined. \u003C/p\u003E\u003Cp\u003EInstead of touching any of those variables apoapsis, periapsis, altitude, velocity:orbit I\u0027d rather see new ones added, for example with a prefix. Gets the best of both views.\u003C/p\u003E\n"},{"CreatedByName":"Kass","CreatedById":91615,"CreatedDateTime":"2013-11-29T19:45:59Z","Content":"\n\u003Cp\u003ESorry if this has already been asked but what does the \u0022^\u0022 symbol mean? I\u0027ve seen it in a few example scripts and have no idea.\u003C/p\u003E\u003Cp\u003EPlease be gentle in your explanations, I\u0027ve never coded anything before, although I\u0027m currently trying to write a PID script for my skycrane (and failing).\u003C/p\u003E\u003Cp\u003EThanks in advance \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EI totally love this mod. My install with KOS, RT, RSS, FAR, ScanSat and a few other mods takes everything to a whole new level.\u003C/p\u003E\n"}]}