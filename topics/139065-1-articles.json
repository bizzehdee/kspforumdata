{"TopicId":139065,"ForumId":29,"TopicTitle":"Stock toolbar","CreatedByName":"Warezcrawler","CreatedById":145377,"CreatedDateTime":"2016-05-05T17:50:02Z","PageNum":1,"Articles":[{"CreatedByName":"Warezcrawler","CreatedById":145377,"CreatedDateTime":"2016-05-05T17:50:02Z","Content":"\n\u003Cp\u003E\nHi\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027m working on getting AutoRove to work again, and I think I have the core up and running. But the stock toolbar is playing a trick on me.\n\u003C/p\u003E\n\u003Cp\u003E\nI have succeeded in adding the button\u00A0\u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nBut when game scene load, the button keeps replicating. So the question is, how can I make sure that I\u0027m not creating the button if it already exists, or at least have it removed before the scene changes or something?\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003Eprivate static ApplicationLauncherButton appButton = null;\n\n        private void createStockButton()\n        {\n            Texture icon = GameDatabase.Instance.GetTexture(\u0022AutoRove/appLauncherButton\u0022, false);\n            ApplicationLauncher.AppScenes visibility = ApplicationLauncher.AppScenes.MAPVIEW | ApplicationLauncher.AppScenes.SPACECENTER | ApplicationLauncher.AppScenes.TRACKSTATION | ApplicationLauncher.AppScenes.FLIGHT;\n            // registering the button\n            if (ApplicationLauncher.Ready \u0026amp;\u0026amp; appButton == null)\n            {\n                removeStockButton();\n                ApplicationLauncherButton appButton = ApplicationLauncher.Instance.AddModApplication(toggleAppLauncher, toggleAppLauncher, null, null, null, null, visibility, icon);\n            }\n        }\n        private void callRemoveStockButton(GameScenes scene) { removeStockButton(); }\n        private void removeStockButton()\n        {\n            if (appButton != null)\n            {\n                ApplicationLauncher.Instance.RemoveModApplication(appButton);\n                appButton = null;\n            }\n        }\n\n        void Start()\n        {\n            GameEvents.onGUIApplicationLauncherReady.Add(new EventVoid.OnEvent(createStockButton));\n            GameEvents.onGUIApplicationLauncherUnreadifying.Add(new EventData\u003C/span\u003E\u003Cspan class=\u0022tag\u0022\u003E\u0026lt;GameScenes\u0026gt;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E.OnEvent(callRemoveStockButton));\n\n            DontDestroyOnLoad(this);\n        }\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nI found this, but it seems I\u0027m missing something -\u00A0\u003Ca href=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/78231-application-launcher-and-mods/#post1303921\u0022 rel=\u0022\u0022\u003E/topic/78231-application-launcher-and-mods\u003C/a\u003E\n\u003C/p\u003E\n"},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2016-05-05T19:44:54Z","Content":"\n\u003Cp\u003E\ndont bother removing it and setting the reference to null\n\u003C/p\u003E\n\u003Cp\u003E\nSimple toolbar template: \u003Ca href=\u0022https://github.com/Crzyrndm/Pilot-Assistant/blob/master/PilotAssistant/Toolbar/AppLauncherFlight.cs\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/Crzyrndm/Pilot-Assistant/blob/master/PilotAssistant/Toolbar/AppLauncherFlight.cs\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nCalled from: \u003Ca href=\u0022https://github.com/Crzyrndm/Pilot-Assistant/blob/master/PilotAssistant/PilotAssistantFlightCore.cs#L61-L64\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/Crzyrndm/Pilot-Assistant/blob/master/PilotAssistant/PilotAssistantFlightCore.cs#L61-L64\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nNote how the button is only ever created once (when the static var is null), even though I can (and do) call create a number of times\n\u003C/p\u003E\n"},{"CreatedByName":"Warezcrawler","CreatedById":145377,"CreatedDateTime":"2016-05-06T08:22:46Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222563422\u0022 data-ipsquote-contentid=\u0022139065\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221462477494\u0022 data-ipsquote-userid=\u002292871\u0022 data-ipsquote-username=\u0022Crzyrndm\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n12 hours ago, Crzyrndm said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\ndont bother removing it and setting the reference to null\n\u003C/p\u003E\n\u003Cp\u003E\nSimple toolbar template: \u003Ca href=\u0022https://github.com/Crzyrndm/Pilot-Assistant/blob/master/PilotAssistant/Toolbar/AppLauncherFlight.cs\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/Crzyrndm/Pilot-Assistant/blob/master/PilotAssistant/Toolbar/AppLauncherFlight.cs\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nCalled from: \u003Ca href=\u0022https://github.com/Crzyrndm/Pilot-Assistant/blob/master/PilotAssistant/PilotAssistantFlightCore.cs#L61-L64\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/Crzyrndm/Pilot-Assistant/blob/master/PilotAssistant/PilotAssistantFlightCore.cs#L61-L64\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nNote how the button is only ever created once (when the static var is null), even though I can (and do) call create a number of times\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThanks...\n\u003C/p\u003E\n\u003Cp\u003E\nI will try that.\n\u003C/p\u003E\n"},{"CreatedByName":"Morse","CreatedById":154930,"CreatedDateTime":"2016-05-06T08:41:49Z","Content":"\n\u003Cp\u003E\nThe adding and removing of the button itself is pretty trivial. To add:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint prettyprinted\u0022\u003E\n\u003Cspan class=\u0022kwd\u0022\u003Eif\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan\u003EApplicationLauncher\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan\u003EInstance\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E!=\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E null\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E)\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n\tappButton \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E=\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan\u003EApplicationLauncher\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan\u003EInstance\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan\u003EAddModApplication\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan\u003EOnTrue\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E,\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan\u003EOnFalse\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E,\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan\u003EOnHover\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E,\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan\u003EOnHoverOut\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E,\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan\u003EEnable\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E,\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan\u003EDisable\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E,\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n\t\t\u003C/span\u003E\u003Cspan\u003EApplicationLauncher\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan\u003EAppScenes\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u0026lt;\u003C/span\u003E\u003Cspan\u003ETheScene\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E\u0026gt;,\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E appButtonTexture\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E);\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nTo remove:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint prettyprinted\u0022\u003E\n\u003Cspan class=\u0022kwd\u0022\u003Eif\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan\u003EApplicationLauncher\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan\u003EInstance\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E!=\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E null \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E\u0026amp;\u0026amp;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E appButton \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E!=\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E null\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E)\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n\t\u003C/span\u003E\u003Cspan\u003EApplicationLauncher\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan\u003EInstance\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan\u003ERemoveModApplication\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003EappButton\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E);\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nBut the trick is WHEN to add and to remove. And there you have two solutions based on whether your plugin is persistent or not. If it\u0027s\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pun\u0022\u003E[\u003C/span\u003E\u003Cspan\u003EKSPAddon\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan\u003EKSPAddon\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan\u003EStartup\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u0026lt;\u003C/span\u003E\u003Cspan\u003EWhatever\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E\u0026gt;,\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Efalse\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E)]\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nThat means the plugin is NOT persistent, and is instantiated every time the relevant scene is loaded, and destroyed every time the scene is exited. In this case the good idea would be to create the button in Awake and remove it in Destroy:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint prettyprinted\u0022\u003E\n\u003Cspan class=\u0022kwd\u0022\u003Epublic\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Evoid\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan\u003EAwake\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E()\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E{\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n  \u003C/span\u003E\u003Cspan\u003EGameEvents\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003EonGUIApplicationLauncherReady\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan\u003EAdd\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan\u003EAddButton\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E);\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n  \u003C/span\u003E\u003Cspan\u003EGameEvents\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003EonGUIApplicationLauncherUnreadifying\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan\u003EAdd\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan\u003ERemoveButton\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E);\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E}\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n\n\u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Epublic\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Evoid\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan\u003EOnDestroy\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E()\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E{\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n  \u003C/span\u003E\u003Cspan\u003EGameEvents\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003EonGUIApplicationLauncherReady\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan\u003ERemove\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan\u003EAddButton\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E);\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n  \u003C/span\u003E\u003Cspan\u003EGameEvents\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003EonGUIApplicationLauncherUnreadifying\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan\u003ERemove\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan\u003ERemoveButton\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E);\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E}\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nBut if there is \u0022true\u0022 in the persistent state, then it means that the plugin won\u0027t be created and destroyed every time the scene changes, and you should probably listen to the SceneChanged GameEvent.\n\u003C/p\u003E\n"},{"CreatedByName":"stupid_chris","CreatedById":62017,"CreatedDateTime":"2016-05-06T19:03:52Z","Content":"\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022http://forum.kerbalspaceprogram.com/index.php?/profile/154930-morse/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022154930\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/154930-morse/\u0022 rel=\u0022\u0022\u003E@Morse\u003C/a\u003E\u00A0That is an awfully complex way to do it. You only ever need to load the buttons once, and you shouldn\u0027t need to ever destroy it.... You should be adding your buttons through the onGUIApplicationLauncherReady event, and add methods to this event in the main menu scene, a bit like what is done \u003Ca href=\u0022https://github.com/StupidChris/RealChute/blob/master/RealChute/RCToolbarManager.cs\u0022 rel=\u0022external nofollow\u0022\u003Ehere\u003C/a\u003E. If you\u0027re removing adding it each time you enter each scene, you\u0027re disregarding the scene restriction parameter. Not only that, but the only time that event launches is in the main menu now.\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://github.com/StupidChris/RealChute/blob/master/RealChute/RCToolbarManager.cs#L58-L77\u0022 rel=\u0022external nofollow\u0022\u003EHere \u003C/a\u003EI\u0027m checking if the launcher is ready and if the button has been added, but this check is not necessary and only there as a \u0022safety\u0022 in case something in KSP goes horribly wrong.\n\u003C/p\u003E\n"}]}