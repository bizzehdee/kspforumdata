{"TopicId":103963,"ForumId":36,"TopicTitle":"[WIP][1.9.x-1.12.x] Scatterer-atmospheric scattering (0.0838 - 14/08/2022) Scattering improvements, in-game atmo generation and multi-sun support","CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-04-12T08:37:35Z","PageNum":123,"Articles":[{"CreatedByName":"V8jester","CreatedById":136093,"CreatedDateTime":"2016-01-26T22:39:05Z","Content":"\u003E \n\u003E \n\u003E 1 minute ago, RaffaCT14 said:\n\u003E \n\u003E \n\u003E ![image.jpg](http://s16.postimg.org/mrznpaqtx/image.jpg)\n\u003E \n\nAHHH!!! Attack of the eel thingy\u0027s! As if the Kraken wasn\u0027t bad enough"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2016-01-26T23:18:03Z","Content":"\u003E \n\u003E \n\u003E 1 hour ago, RaffaCT14 said:\n\u003E \n\u003E \n\u003E That problem appears only with opengl, when I play without it there are only a lot of artifacts. ![:D](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif \u0022:D\u0022)\n\u003E \n\u003E \n\u003E \n\u003E [![image.jpg](http://s16.postimg.org/mrznpaqtx/image.jpg)](http://s16.postimg.org/mrznpaqtx/image.jpg \u0022Enlarge image\u0022)\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E  \n\u003E \n\u003E \n\u003E \n\u003E \n\u003E I\u0027ll wait the new version of the mod. Thank you for the help yesterday! ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif \u0022:)\u0022)\n\u003E \n\nThose are just tears in the fabric of space and time. KSP was not meant mean to have this kind of shader, the space-time continuum has been broken... But seriously, I don\u0027t know what\u0027s causing these yet but the good thing is that I now get them from time to time so I might be able to fix them one of these days.\n\nEdited: I\u0027ll just leave this here:\n\n![U8XzNIp.png](http://i.imgur.com/U8XzNIp.png)\n\n**Edited \u003Ctime datetime=\u00222016-01-27T00:09:27Z\u0022 title=\u002201/27/2016 12:09  AM\u0022 data-short=\u00228 yr\u0022\u003EJanuary 27, 2016\u003C/time\u003E by blackrack**"},{"CreatedByName":"V8jester","CreatedById":136093,"CreatedDateTime":"2016-01-27T00:12:33Z","Content":"\u003E \n\u003E \n\u003E 52 minutes ago, blackrack said:\n\u003E \n\u003E \n\u003E Those are just tears in the fabric of space and time. KSP was not meant mean to have this kind of shader, the space-time continuum has been broken... But seriously, I don\u0027t know what\u0027s causing these yet but the good thing is that I now get them from time to time so I might be able to fix them one of these days.\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E  \n\u003E \n\u003E \n\u003E \n\u003E \n\u003E Edited: I\u0027ll just leave this here:\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E ![U8XzNIp.png](http://i.imgur.com/U8XzNIp.png)\n\u003E \n\nI think I love you......\n\nNope I thought about it, just very platonic affection."},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2016-01-27T01:05:24Z","Content":"Here are some more cherrypicked screens\n\n\u003Ciframe class=\u0022imgur-album\u0022 frameborder=\u00220\u0022 height=\u0022550\u0022 src=\u0022//imgur.com/a/KilWM/embed?background=ffffff\u0026text=1a1a1a\u0026link=4e76c9\u0022 width=\u0022100%\u0022\u003E\u003C/iframe\u003E"},{"CreatedByName":"Nhawks17","CreatedById":32999,"CreatedDateTime":"2016-01-27T01:23:32Z","Content":"Soon enough \u0022Scatterer\u0022 is going to need a new name ![:P](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif \u0022:P\u0022) Feel like you\u0027re going beyond just atmo scattering now ![:D](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif \u0022:D\u0022)"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2016-01-27T01:39:51Z","Content":"\u003E \n\u003E \n\u003E 9 minutes ago, Nhawks17 said:\n\u003E \n\u003E \n\u003E Soon enough \u0022Scatterer\u0022 is going to need a new name ![:P](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif \u0022:P\u0022) Feel like you\u0027re going beyond just atmo scattering now ![:D](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif \u0022:D\u0022)\n\u003E \n\nWell, I thought about it, but couldn\u0027t come up with a name catchier than scatterer ![:P](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif \u0022:P\u0022) suggestions welcome.\n\nBtw I\u0027m gonna need some opinions here.\n\nHere are godrays rendered at 1/4 resolution and upscaled: [http://i.imgur.com/mRb54bZ.jpg](http://i.imgur.com/mRb54bZ.jpg) [http://i.imgur.com/rwq9WoX.jpg](http://i.imgur.com/rwq9WoX.jpg) (ignore the topmost aliasing artifacts)\n\nAnd here rendered at native resolution: [http://i.imgur.com/aHBRtCn.jpg](http://i.imgur.com/aHBRtCn.jpg) [http://i.imgur.com/jeUv8ap.jpg](http://i.imgur.com/jeUv8ap.jpg)\n\nSomehow I find the lower resolution gives them a more volumetric and natural feel while the crisp high resolution betrays their polygonal nature and takes away from the effect. Opinions?"},{"CreatedByName":"Errol","CreatedById":118622,"CreatedDateTime":"2016-01-27T01:45:03Z","Content":"The real question is will eve clouds cause god rays?"},{"CreatedByName":"Drew Kerman","CreatedById":103177,"CreatedDateTime":"2016-01-27T02:19:46Z","Content":"\u003E \n\u003E \n\u003E 39 minutes ago, blackrack said:\n\u003E \n\u003E \n\u003E Somehow I find the lower resolution gives them a more volumetric and natural feel while the crisp high resolution betrays their polygonal nature and takes away from the effect. Opinions?\n\u003E \n\nlower res definitely gives off a \u0022softer\u0022 look that feels more natural to me"},{"CreatedByName":"Nhawks17","CreatedById":32999,"CreatedDateTime":"2016-01-27T03:10:12Z","Content":"I too prefer the low res version better, like Gaiiden pointed out the higher resolution definitely looks kinda rough compared to the low res."},{"CreatedByName":"Proteus","CreatedById":140980,"CreatedDateTime":"2016-01-27T04:56:47Z","Content":"this is what happens when you play with eve and scatter setting too much\n\ni turned kebrin into small gas giant \n\n![34xizoh.png](http://i64.tinypic.com/34xizoh.png)![069.jpg](http://i0.kym-cdn.com/photos/images/original/000/471/542/069.jpg)"},{"CreatedByName":"m4ti140","CreatedById":67296,"CreatedDateTime":"2016-01-27T07:43:15Z","Content":"Without the proper terrain shading (i.e. with sun side of mountains still alit despite being in the shadow of bigger mountains) the godrays look a bit out of place"},{"CreatedByName":"Paul_Sawyer","CreatedById":152646,"CreatedDateTime":"2016-01-27T07:49:56Z","Content":"I vote for 1/4 resolution too, it definitely looks much more natural."},{"CreatedByName":"Val","CreatedById":126227,"CreatedDateTime":"2016-01-27T09:11:01Z","Content":"\u003E \n\u003E \n\u003E 7 hours ago, blackrack said:\n\u003E \n\u003E \n\u003E Somehow I find the lower resolution gives them a more volumetric and natural feel while the crisp high resolution betrays their polygonal nature and takes away from the effect. Opinions?\n\u003E \n\nThe quarter res, does look softer. Is it not possible to increase the width of the fuzziness on the high res ones, to make them similarly soft?\n\nEither way. Amazing work, blackrack."},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2016-01-27T10:55:47Z","Content":"\u003E \n\u003E \n\u003E 9 hours ago, Errol said:\n\u003E \n\u003E \n\u003E The real question is will eve clouds cause god rays?\n\u003E \n\nWell this only works with geometry and also assumes any point in the screen will only go once into the light and once into the shadow, i.e objects in mid-air will break it.\n\n\u003E \n\u003E \n\u003E 3 hours ago, m4ti140 said:\n\u003E \n\u003E \n\u003E Without the proper terrain shading (i.e. with sun side of mountains still alit despite being in the shadow of bigger mountains) the godrays look a bit out of place\n\u003E \n\nYou\u0027re totally right but there is nothing I can do about the terrain shading right now. These godrays are based on shadow volumes (think shadows in doom3) which I guess I could use for shadows but I\u0027m not sure how to do that.\n\n\u003E \n\u003E \n\u003E 1 hour ago, Val said:\n\u003E \n\u003E \n\u003E The quarter res, does look softer. Is it not possible to increase the width of the fuzziness on the high res ones, to make them similarly soft?\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E Either way. Amazing work, blackrack.\n\u003E \n\nCurrently there isn\u0027t, but I\u0027ll try to come up with something. I was just experimenting with this to see if a little blurriness would help."},{"CreatedByName":"sashan","CreatedById":98897,"CreatedDateTime":"2016-01-27T20:17:35Z","Content":"Could you adjust the craft ambient illumination amount depending on where it is? If it\u0027s inside one of the shadows it should be darker."},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2016-01-27T20:18:42Z","Content":"\u003E \n\u003E \n\u003E Just now, sashan said:\n\u003E \n\u003E \n\u003E Could you adjust the craft ambient illumination amount depending on where it is? If it\u0027s inside one of the shadows it should be darker.\n\u003E \n\nWhen I figure out terrain shadows this should be easy."},{"CreatedByName":"HafCoJoe","CreatedById":80363,"CreatedDateTime":"2016-01-27T21:14:44Z","Content":"Lol - Seeing all these artifact posts is reminding me of [this](https://youtu.be/KGcat9tGZVU?t=36) one Princess Bride scene. ^-^"},{"CreatedByName":"V8jester","CreatedById":136093,"CreatedDateTime":"2016-01-27T21:32:03Z","Content":"\u003E \n\u003E \n\u003E 16 minutes ago, Avera9eJoe said:\n\u003E \n\u003E \n\u003E Lol - Seeing all these artifact posts is reminding me of [this](https://youtu.be/KGcat9tGZVU?t=36) one Princess Bride scene. ^-^\n\u003E \n\nThat\u0027s completely Inconceivable!"},{"CreatedByName":"sashan","CreatedById":98897,"CreatedDateTime":"2016-01-27T22:16:36Z","Content":"\u003E \n\u003E \n\u003E 1 hour ago, blackrack said:\n\u003E \n\u003E \n\u003E When I figure out terrain shadows this should be easy.\n\u003E \n\nI mean, besides butting a shadow on it and \u0022turning off\u0022 the sunlight the ambient lightning level should become darker. I mean the lightning that is used to render the ships in planet shadow, for example."},{"CreatedByName":"Mad Rocket Scientist","CreatedById":139256,"CreatedDateTime":"2016-01-28T02:20:46Z","Content":"\u003E \n\u003E \n\u003E On 1/27/2016 at 5:39 PM, blackrack said:\n\u003E \n\u003E \n\u003E Well, I thought about it, but couldn\u0027t come up with a name catchier than scatterer ![:P](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif \u0022:P\u0022) suggestions welcome.\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E Btw I\u0027m gonna need some opinions here.\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E Here are godrays rendered at 1/4 resolution and upscaled: [http://i.imgur.com/mRb54bZ.jpg](http://i.imgur.com/mRb54bZ.jpg) [http://i.imgur.com/rwq9WoX.jpg](http://i.imgur.com/rwq9WoX.jpg) (ignore the topmost aliasing artifacts)\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E And here rendered at native resolution: [http://i.imgur.com/aHBRtCn.jpg](http://i.imgur.com/aHBRtCn.jpg) [http://i.imgur.com/jeUv8ap.jpg](http://i.imgur.com/jeUv8ap.jpg)\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E Somehow I find the lower resolution gives them a more volumetric and natural feel while the crisp high resolution betrays their polygonal nature and takes away from the effect. Opinions?\n\u003E \n\n1/4 res, definitely!"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2016-01-28T16:45:03Z","Content":"So unfortunately, the method I\u0027m using for extruding volumes for the godrays doesn\u0027t play well with all meshes resulting in many \u0022holes\u0022 and instability in the geometry. This would be easily fixed if there was a possibility to access neighboring normals in a vertex shader but as far as I know this isn\u0027t possible. Extruding the terrain geometry on the CPU is also out of the question for terrain of that scale and especially for KSP\u0027s tight CPU budget.  This is unfortunate as this method is very fast, I might still release but it will always have holes and artifacts in it.\n\nThe issue can be seen in these screens on the box on the left.\n\n\u003Ciframe class=\u0022imgur-album\u0022 frameborder=\u00220\u0022 height=\u0022550\u0022 src=\u0022//imgur.com/a/rUIvL/embed?background=ffffff\u0026text=1a1a1a\u0026link=4e76c9\u0022 width=\u0022100%\u0022\u003E\u003C/iframe\u003E\n\nIn the end I might give shadow maps a try and then I\u0027ll be able to use them for terrain and for godrays (as per this paper [http://www.moving-picture.com/documents/VolumetricShadowMapping.pdf](http://www.moving-picture.com/documents/VolumetricShadowMapping.pdf)) but I feel it\u0027s going to be much slower for real-time. On the upside it will look fuzzier and \u0022more volumetric\u0022 than current method.\n\n**Edited \u003Ctime datetime=\u00222016-01-28T16:48:47Z\u0022 title=\u002201/28/2016 04:48  PM\u0022 data-short=\u00228 yr\u0022\u003EJanuary 28, 2016\u003C/time\u003E by blackrack**"},{"CreatedByName":"Proot","CreatedById":98932,"CreatedDateTime":"2016-01-28T17:04:12Z","Content":"If may I ask... from where you \u0022take\u0022 the terrain volumes?\n\nMaybe... could you \u0022fill\u0022 the geometry gaps using the low poly model used in scaled space? Probably the result will be not acurate, but nearest to the real mesh? Just an idea, I don\u0027t know if it is possible.\n\nEDIT: btw, with Kopernicus you can generate a .bin with the lowpoly mesh of the bodies. ![;)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif \u0022;)\u0022)\n\n**Edited \u003Ctime datetime=\u00222016-01-28T17:06:09Z\u0022 title=\u002201/28/2016 05:06  PM\u0022 data-short=\u00228 yr\u0022\u003EJanuary 28, 2016\u003C/time\u003E by Proot**"},{"CreatedByName":"rbray89","CreatedById":48847,"CreatedDateTime":"2016-01-28T17:05:00Z","Content":"\u003E \n\u003E \n\u003E 17 minutes ago, blackrack said:\n\u003E \n\u003E \n\u003E So unfortunately, the method I\u0027m using for extruding volumes for the godrays doesn\u0027t play well with all meshes resulting in many \u0022holes\u0022 and instability in the geometry. This would be easily fixed if there was a possibility to access neighboring normals in a vertex shader but as far as I know this isn\u0027t possible. Extruding the terrain geometry on the CPU is also out of the question for terrain of that scale and especially for KSP\u0027s tight CPU budget.  This is unfortunate as this method is very fast, I might still release but it will always have holes and artifacts in it.\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E The issue can be seen in these screens on the box on the left.\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E  \n\u003E \n\u003E \n\u003E \n\u003E \n\u003E \u003Ciframe class=\u0022imgur-album\u0022 frameborder=\u00220\u0022 height=\u0022550\u0022 src=\u0022//imgur.com/a/rUIvL/embed?background=ffffff\u0026text=1a1a1a\u0026link=4e76c9\u0022 width=\u0022100%\u0022\u003E\u003C/iframe\u003E\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E  \n\u003E \n\u003E \n\u003E \n\u003E \n\u003E In the end I might give shadow maps a try and then I\u0027ll be able to use them for terrain and for godrays (as per this paper [http://www.moving-picture.com/documents/VolumetricShadowMapping.pdf](http://www.moving-picture.com/documents/VolumetricShadowMapping.pdf)) but I feel it\u0027s going to be much slower for real-time. On the upside it will look fuzzier and \u0022more volumetric\u0022 than current method.\n\u003E \n\nCool! I was wondering how you were doing that. I assume you extrude vertices that maintain normal perpendicular to the ray?"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2016-01-28T17:34:31Z","Content":"\u003E \n\u003E \n\u003E 30 minutes ago, Proot said:\n\u003E \n\u003E \n\u003E If may I ask... from where you \u0022take\u0022 the terrain volumes?\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E Maybe... could you \u0022fill\u0022 the geometry gaps using the low poly model used in scaled space? Probably the result will be not acurate, but nearest to the real mesh? Just an idea, I don\u0027t know if it is possible.\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E EDIT: btw, with Kopernicus you can generate a .bin with the lowpoly mesh of the bodies. ![;)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif \u0022;)\u0022)\n\u003E \n\nWell, the problem is, these gaps only appear after extrusion and there is no real way to check for them. Besides, the geometry is taken directly from a duplicate camera using a replacement shader, so I don\u0027t really pass the geometry around or anything, it\u0027s why it\u0027s fast.\n\nEdited: the gaps actually appear in the godrays, the objects are not a problem, gaps also \u0022fill\u0022 and \u0022empty\u0022 with a moving light source.\n\n\u003E \n\u003E \n\u003E 30 minutes ago, rbray89 said:\n\u003E \n\u003E \n\u003E Cool! I was wondering how you were doing that. I assume you extrude vertices that maintain normal perpendicular to the ray?\n\u003E \n\nExactly, the code is very simple:\n\n        \t    float backFactor = dot( toLight, v.normal );\n        \t    float extrude = (backFactor \u003C 0.0) ? 1.0 : 0.0;\n        \t    v.vertex.xyz -= toLight * (extrude * extrusionLength);\n\nBut as you can see it doesn\u0027t work well for all meshes. It\u0027s enough to introduce distracting gaps in the effect. Some people may not notice though and it may look good in some screenshots so I\u0027ll probably still release it as an option ![:P](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif \u0022:P\u0022)\n\nI\u0027ve looked around and basically the only way to fix this is to check neighboring edges and faces which can\u0027t be done in the vertex shader or alter the geometry by adding additional quads, which also can\u0027t be done in the vertex shader. Not sure if there is something else I\u0027m missing.\n\n**Edited \u003Ctime datetime=\u00222016-01-28T17:35:55Z\u0022 title=\u002201/28/2016 05:35  PM\u0022 data-short=\u00228 yr\u0022\u003EJanuary 28, 2016\u003C/time\u003E by blackrack**"},{"CreatedByName":"sidfu","CreatedById":70409,"CreatedDateTime":"2016-01-28T17:53:34Z","Content":"so eve and scatter are no longer compatiable since they both use shaders?"}]}