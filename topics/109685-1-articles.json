{"TopicId":109685,"ForumId":29,"TopicTitle":"Stock Aero Drag Curves: How do they work?","CreatedByName":"atomicfury","CreatedById":120037,"CreatedDateTime":"2015-05-17T17:53:48Z","PageNum":1,"Articles":[{"CreatedByName":"atomicfury","CreatedById":120037,"CreatedDateTime":"2015-05-17T17:53:48Z","Content":"\n\u003Cp\u003EI\u0027m trying to figure out the new drag system, specifically for simulation and trajectory plotting. The simulation part is why I can\u0027t just pull the info I want right off the parts, I need to simulate a future vessel/part state. (I think.)\u003C/p\u003E\u003Cp\u003ESo Physics.cfg defines four drag curves, among other things, which get put into PhysicsGlobals in KSP.\u003C/p\u003E\u003Cp\u003EThe four float curves I\u0027m interested in are:\u003C/p\u003E\u003Cp\u003EDragCurveMultiplier\u003C/p\u003E\u003Cp\u003EDragCurveSurface\u003C/p\u003E\u003Cp\u003EDragCurveTail\u003C/p\u003E\u003Cp\u003EDragCurveTip\u003C/p\u003E\u003Cp\u003EYou can look at the curves in the aero debug menu.\u003C/p\u003E\u003Cp\u003EThe four of which get evaluated against mach and combined somehow to get a multiplier on area from a part\u0027s dragcubes. Anybody know what it is doing?\u003C/p\u003E\u003Cp\u003EWell, someone does, the mechjeb source reads that you normalize the dot product of the cube face direction and the drag vector like so: (dragdot\u002B1)*0.5, which I don\u0027t know why it does that. Trig identify?\u003C/p\u003E\u003Cp\u003EMechjeb then does two different interpolations on the tip or tail drag depending on that normalization.\u003C/p\u003E\u003Cp\u003EAnyone have any clues for me?\u003C/p\u003E\n"},{"CreatedByName":"cybersol","CreatedById":81136,"CreatedDateTime":"2015-05-18T08:17:37Z","Content":"\n\u003Cp\u003EGreat to see a thread specifically about this. I remember seeing at least a qualitative explanation about the drag cube calculations on the forums. I\u0027ll poke around to try to find it... \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/119108-Overhauls-for-1-0\u0022 rel=\u0022external nofollow\u0022\u003Ehere\u003C/a\u003E is the main thread I remembered. On page 5 OhioBob, Claw, and Gfurst start to get into more rigorous mathematical detail.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-05-18T08:30:27Z\u0022 title=\u002205/18/2015 08:30  AM\u0022 data-short=\u00229 yr\u0022\u003EMay 18, 2015\u003C/time\u003E by cybersol\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2015-05-18T09:37:54Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022atomicfury\u0022 data-cite=\u0022atomicfury\u0022\u003E\u003Cdiv\u003EWell, someone does, the mechjeb source reads that you normalize the dot product of the cube face direction and the drag vector like so: (dragdot\u002B1)*0.5, which I don\u0027t know why it does that. Trig identify?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThe normalized dot is in the -1 \u002B1 range so by doing that you get a value in the 0 1 range that you can use for the curve. With a value lower than 0.5 the drag in the same direction as the back of the face and with more than 0.5 it is in the front. \u003C/p\u003E\u003Cp\u003EWhat the code do in layman term is for each face : \u003C/p\u003E\u003Cp\u003E - if the air come from the front interpolate from the tipDrag (full frontal) to surfaceDrag (fully parallel) \u003C/p\u003E\u003Cp\u003E - if the air come from the front interpolate from the tailDrag (full reverse) to surfaceDrag (fully parallel) \u003C/p\u003E\u003Cp\u003E - multiply the result by the multiplierCurve\u003C/p\u003E\u003Cp\u003EWhat do you need the info for ?\u003C/p\u003E\n"},{"CreatedByName":"cybersol","CreatedById":81136,"CreatedDateTime":"2015-05-18T10:41:45Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022sarbian\u0022 data-cite=\u0022sarbian\u0022\u003E\u003Cdiv\u003EWhat do you need the info for ?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI think he wants to help with a possible stock aero update for the Trajectories mod.\u003C/p\u003E\n"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2015-05-18T11:21:23Z","Content":"\n\u003Cp\u003EI want to point out that the DragCube class has method that do that easily. I implemented those in MJ because the stock method is not thread safe.\u003C/p\u003E\u003Cp\u003EAlso I am not sure the MJ implementation is fine since it seems to underestimate the drag/lift a bit. It may be that the vector I input are not correctly oriented or something else.\u003C/p\u003E\n"},{"CreatedByName":"atomicfury","CreatedById":120037,"CreatedDateTime":"2015-05-18T11:32:38Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022sarbian\u0022 data-cite=\u0022sarbian\u0022\u003E\u003Cdiv\u003EI want to point out that the DragCube class has method that do that easily. I implemented those in MJ because the stock method is not thread safe.\u003Cp\u003EAlso I am not sure the MJ implementation is fine since it seems to underestimate the drag/lift a bit. It may be that the vector I input are not correctly oriented or something else.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EWhich method in DragCube? Or is it in DragCubeList?\u003C/p\u003E\u003Cp\u003EI had pulled out your code (MJ 2.5.0) and implemented it in a test plugin and I\u0027ve been compared to readouts from NathanKell\u0027s AeroGUI. I\u0027m seeing more drag and less lift than stock, but part of that could me porting to code over to a tiny plugin.\u003C/p\u003E\n"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2015-05-18T12:11:22Z","Content":"\n\u003Cp\u003Eyes, it is DragCubeList. sorry. The relevant call is AddSurfaceDragDirection and the GetCubeXXXX calls are also useful.\u003C/p\u003E\u003Cp\u003EMake sure you use the code from the dev branch (master uses the same code since yesterday)\u003C/p\u003E\u003Cp\u003EI\u0027ll have to redo some comparaison check myself. At one point the result was good by I made so much change to that code that I am not sure it is working. \u003C/p\u003E\u003Cp\u003EBut I won\u0027t do that now. I already spent far too much time on that and I need to work on my other projects and deal with some RL time sink.\u003C/p\u003E\n"}]}