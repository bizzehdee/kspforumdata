{"TopicId":91064,"ForumId":39,"TopicTitle":"[Hardware, Custom] KSP flight panel, with flight computer","CreatedByName":"AmeliaEatyaheart","CreatedById":115681,"CreatedDateTime":"2014-11-23T15:07:36Z","PageNum":1,"Articles":[{"CreatedByName":"AmeliaEatyaheart","CreatedById":115681,"CreatedDateTime":"2014-11-23T15:07:36Z","Content":"\n\u003Cp\u003EHey everyone! \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EI\u0027m still new to the forums, but been playing KSP for a while now. As a space nerd and electronics nerd, I wanted to combine my two interests, and deign a flight computer, partly to clear the screen from display mods. They work great, but take up precious screen space! however, I know sweet stuff-all about how to write mods for the game.\u003C/p\u003E\u003Cp\u003EThankfully, there are people out there with more/greater talents, and someone had already written a plugin to add external hardware - and they wrote it for Arduino! That suited me rather well, as I\u0027ve made a few Arduino projects in the past \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003ESo, without much further ado, the flight panel to date! \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://i133.photobucket.com/albums/q80/LordPhobos6920/20140722_160355.jpg\u0022 alt=\u002220140722_160355.jpg\u0022\u003E\u003C/p\u003E\u003Cp\u003ECurrent flight / orbital parameters output, and proposed 7 segment board - I need to re-do that though, as those modules EAT power...\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://i133.photobucket.com/albums/q80/LordPhobos6920/20140808_143325.jpg\u0022 alt=\u002220140808_143325.jpg\u0022\u003E\u003C/p\u003E\u003Cp\u003ECardboardian template for the control panel\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://i133.photobucket.com/albums/q80/LordPhobos6920/kerbal_panel_fuelgauges.jpg\u0022 alt=\u0022kerbal_panel_fuelgauges.jpg\u0022\u003E\u003C/p\u003E\u003Cp\u003EFuel gauges - won\u0027t help for ion drives, but is otherwise helpful and fun - especially when firing those lovely 3.75m engines! \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 alt=\u0022:D\u0022\u003E\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://i133.photobucket.com/albums/q80/LordPhobos6920/20141112_220438.jpg\u0022 alt=\u002220141112_220438.jpg\u0022\u003E\u003C/p\u003E\u003Cp\u003EThe cardboardian front panel got upgraded to \u0022let\u0027s add some not-quite-dodgy wiring and see if it works\u0022... I\u0027d like to believe Jeb would approve of the bare wire and spit-polish approach \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://i133.photobucket.com/albums/q80/LordPhobos6920/20141122_010559.jpg\u0022 alt=\u002220141122_010559.jpg\u0022\u003E\u003C/p\u003E\u003Cp\u003EAnd just this week, recieved a bunch of those playstation-type thumbsticks for flight control! I was hoping to get an old-skool gamepad joystick working, but the springs are broke, and I kept spinning out of control.\u003C/p\u003E\u003Cp\u003EI was planning on treating this primarily as a flight readout panel, but after going through zitronen\u0027s code and realising how much spaceship controls I could add, it was too much to resist! So now I have to get/make a nice case for it all \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003E-----\u003C/p\u003E\u003Cp\u003EAlso, many thanks to both zitronen for writing this awesome plugin, and Mulbin for collecting a bunch of other hardware projects that other awesome people have made, that helped to inspire me \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/66393-Hardware-Plugin-Arduino-based-physical-display-serial-port-io-tutorial-%2808-Oct%29\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://forum.kerbalspaceprogram.com/threads/66393-Hardware-Plugin-Arduino-based-physical-display-serial-port-io-tutorial-%2808-Oct%29\u003C/a\u003E\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/66763-Custom-hardware-simpit-repository-For-people-who-take-KSP-a-little-too-far\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://forum.kerbalspaceprogram.com/threads/66763-Custom-hardware-simpit-repository-For-people-who-take-KSP-a-little-too-far\u003C/a\u003E\u003C/p\u003E\n"},{"CreatedByName":"Kartoffelkuchen","CreatedById":108501,"CreatedDateTime":"2014-11-23T15:30:26Z","Content":"\n\u003Cp\u003EMy god...thats fantastic!\u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_shocked.gif\u0022 alt=\u0022:0.0:\u0022\u003E:0.0:\u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_shocked.gif\u0022 alt=\u0022:0.0:\u0022\u003E Yeah, have fun with your new hardware...\u003C/p\u003E\n"},{"CreatedByName":"AmeliaEatyaheart","CreatedById":115681,"CreatedDateTime":"2014-11-23T15:48:57Z","Content":"\n\u003Cp\u003EThanks guys! \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EI plan to update this thread sporadically as updates happen - while I\u0027m more keen to make the readouts happen, I haven\u0027t been able to get the circuit boards made yet, so I\u0027ve concentrated on getting the switch panel finished \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EI added some flickering lights code to the switch panel, so if the ElectricCharge drops to less than 5 units, the lights start flightering, if the power drops to 0, most of the buttons will just flat-out stop working \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif\u0022 alt=\u0022:P\u0022\u003E\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E\n\u003C/p\u003E\u003Cdiv class=\u0022ipsEmbeddedVideo\u0022 contenteditable=\u0022false\u0022\u003E\u003Cdiv\u003E\u003Ciframe width=\u0022480\u0022 height=\u0022270\u0022 src=\u0022https://www.youtube.com/embed/9CbCLuZgffI?feature=oembed\u0022 frameborder=\u00220\u0022 allowfullscreen=\u0022true\u0022\u003E\u003C/iframe\u003E\u003C/div\u003E\u003C/div\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-11-23T15:49:33Z\u0022 title=\u002211/23/2014 03:49  PM\u0022 data-short=\u00229 yr\u0022\u003ENovember 23, 2014\u003C/time\u003E by AmeliaEatyaheart\u003C/strong\u003E\n\u003Cbr\u003EReason: I\u0026#039;m bad at typing and spelling :P\n\u003C/span\u003E\n"},{"CreatedByName":"MrOnak","CreatedById":104432,"CreatedDateTime":"2014-11-23T16:13:43Z","Content":"\n\u003Cp\u003ESubscribed!\u003C/p\u003E\n"},{"CreatedByName":"zitronen","CreatedById":11842,"CreatedDateTime":"2014-11-24T16:06:29Z","Content":"\n\u003Cp\u003E\u002B1 10 out of 10 will stage again\u003C/p\u003E\n"},{"CreatedByName":"ChikkaChiChi","CreatedById":126031,"CreatedDateTime":"2014-11-25T00:54:07Z","Content":"\n\u003Cp\u003EThis went from nice to fraktastic on your idea to add light flicker. Pure genius.\u003C/p\u003E\u003Cp\u003EI\u0027m suddenly inspired to invest in a hamster, a hamster wheel, and a way to push values back into KSP to recharge electricity...\u003C/p\u003E\n"},{"CreatedByName":"AmeliaEatyaheart","CreatedById":115681,"CreatedDateTime":"2014-11-25T09:51:29Z","Content":"\n\u003Cp\u003EThe hamster wheel might go faster if you get one of those goo pod creatures...\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E\n\u003C/p\u003E\u003Cdiv class=\u0022ipsEmbeddedVideo\u0022 contenteditable=\u0022false\u0022\u003E\u003Cdiv\u003E\u003Ciframe width=\u0022480\u0022 height=\u0022270\u0022 src=\u0022https://www.youtube.com/embed/tu9eoD1ot0A?feature=oembed\u0022 frameborder=\u00220\u0022 allowfullscreen=\u0022true\u0022\u003E\u003C/iframe\u003E\u003C/div\u003E\u003C/div\u003E\n"},{"CreatedByName":"AmeliaEatyaheart","CreatedById":115681,"CreatedDateTime":"2014-11-26T01:12:24Z","Content":"\n\u003Cp\u003EI wrote some Arduino code to calculate what SOI you fall under - I\u0027m pretty sure it will fail if eccentricity is EXACTLY 1.00000000 (overflow error possibly?), but for any other orbit (elliptical, circular, hyperbolic) this will calculate what you\u0027re falling around \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E    #define NoSOI         -1\u003Cbr\u003E    #define KerbolSOI      0\u003Cbr\u003E    #define KerbinSOI      1\u003Cbr\u003E    #define MunSOI         2\u003Cbr\u003E    #define MinmusSOI      3\u003Cbr\u003E    #define MohoSOI        4\u003Cbr\u003E    #define EveSOI         5\u003Cbr\u003E    #define DunaSOI        6\u003Cbr\u003E    #define IkeSOI         7\u003Cbr\u003E    #define JoolSOI        8\u003Cbr\u003E    #define LaytheSOI      9\u003Cbr\u003E    #define VallSOI       10\u003Cbr\u003E    #define BopSOI        11\u003Cbr\u003E    #define TyloSOI       12\u003Cbr\u003E    #define GillySOI      13\u003Cbr\u003E    #define PolSOI        14\u003Cbr\u003E    #define DresSOI       15\u003Cbr\u003E    #define EElooSOI      16\u003Cbr\u003E    //same codes as in a savefile\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003Edouble Oldecc=-1;//keep value of orbital eccentricity for comparison next loop\u003Cbr\u003Eint currentSOI=-1;\u003Cbr\u003E\u003Cbr\u003Evoid UpdateDisplayOnNewPacket()\u003Cbr\u003E{\u003Cbr\u003E    if (Oldecc==-1 || currentSOI==-1) currentSOI=resolveSOI();//force refresh if SOI unknown.\u003Cbr\u003E    else if (Oldecc\u0026lt;=1 \u0026amp;\u0026amp; VData.e\u0026gt;1)  currentSOI=resolveSOI();//force refresh of SOI if orbit jumps to  hyperbolic (e.g. entering a smaller SOI)\u003Cbr\u003E    else if (Oldecc\u0026gt;=1 \u0026amp;\u0026amp; VData.e\u0026lt;1) currentSOI=resolveSOI();//e.g. jumping to solar from planetary\u003Cbr\u003E    else if ( (VData.e\u0026gt;(Oldecc*1.05) ) || (VData.e\u0026lt;(Oldecc*0.95) ) ) currentSOI=resolveSOI();\u003Cbr\u003E    //force refresh if the eccentricity \u0027jumps\u0027; indicates an SOI change  without a hyperbolic orbit (e.g. Laythe horseshoe orbit)\u003Cbr\u003E    //\u0027resolveSOI\u0027 could be run every loop, but conditional states used to save some processor time.\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E    //add more display update code here\u003Cbr\u003E    ...\u003Cbr\u003E    Oldecc=VData.e; //preserve data for next run through loop\u003Cbr\u003E}   \u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E//--------//\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003Edouble resolveSOI()\u003Cbr\u003E{\u003Cbr\u003E    //will attempt to find mu, and from that, figure out which world we\u0027re orbiting.\u003Cbr\u003E\u003Cbr\u003E    //eqn: mu=v^2 / ( (2/OrbRad)-(1/SMA) ) for e\u0026lt;\u0026gt;1.\u003Cbr\u003E    //eqn: mu=(V^2 * OrbRad)/2 for e==1 aka parabolic orbit.\u003Cbr\u003E    //all distances in this function are expressed in km, not m, hence a lot of n/1000.\u003Cbr\u003E    //references- http://en.wikipedia.org/wiki/Hyperbolic_trajectory#Velocity\u003Cbr\u003E    //http://en.wikipedia.org/wiki/Orbital_mechanics#Formulae_for_free_orbits\u003Cbr\u003E\u003Cbr\u003E    double SemiMajorKm=VData.SemiMajorAxis/1000;\u003Cbr\u003E    double mu=0;\u003Cbr\u003E    double _BodyRadius=0;\u003Cbr\u003E\u003Cbr\u003E    if (VData.e\u0026gt;1 \u0026amp;\u0026amp; SemiMajorKm\u0026gt;0) SemiMajorKm=-SemiMajorKm;//SMA must be a negative figure for e\u0026gt;1.\u003Cbr\u003E        //this is a catch-all - hyper orbits in KSP always have a -ive SMA.\u003Cbr\u003E    _BodyRadius=((SemiMajorKm*2)-(VData.AP/1000)-(VData.PE/1000))/2;\u003Cbr\u003E    double vsquared=(VData.VOrbit/1000)*(VData.VOrbit/1000);\u003Cbr\u003E    if (VData.e!=1) mu=(vsquared)/( (2/(VData.Alt/1000 \u002B _BodyRadius))-(1/SemiMajorKm) );\u003Cbr\u003E    else mu=(vsquared)*(2/(VData.Alt/1000 \u002B _BodyRadius))/2;\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E//value will be comparable to wiki mu values, divide 10^10 (conversion factor of m^3 -\u0026gt; km^3\u003Cbr\u003E\u003Cbr\u003E    if (mu\u0026lt;=0) return -1;//calculation error\u003Cbr\u003E    if ( (3531.6*0.95)\u0026lt;mu \u0026amp;\u0026amp; mu\u0026lt;(3531.6*1.05) )            return KerbinSOI;\u003Cbr\u003E    else if ( (65.138398*0.95)\u0026lt;mu \u0026amp;\u0026amp; mu\u0026lt;(65.138398*1.05) ) return MunSOI;\u003Cbr\u003E    else if ( (1.7658*0.95)\u0026lt;mu \u0026amp;\u0026amp; mu\u0026lt;(1.7658*1.05) )       return MinmusSOI;\u003Cbr\u003E    else if ( (168.60938*0.95)\u0026lt;mu \u0026amp;\u0026amp; mu\u0026lt;(168.60938*1.05) ) return MohoSOI; \u003Cbr\u003E    else if ( (8171.7302*0.95)\u0026lt;mu \u0026amp;\u0026amp; mu\u0026lt;(8171.7302*1.05) ) return EveSOI;   \u003Cbr\u003E    else if ( (301.36321*0.95)\u0026lt;mu \u0026amp;\u0026amp; mu\u0026lt;(301.36321*1.05) ) return DunaSOI;\u003Cbr\u003E    else if ( (18.568369*0.95)\u0026lt;mu \u0026amp;\u0026amp; mu\u0026lt;(18.568369*1.05) ) return IkeSOI;\u003Cbr\u003E    else if ( (282528*0.95)\u0026lt;mu \u0026amp;\u0026amp; mu\u0026lt;(282528*1.05) )       return JoolSOI;\u003Cbr\u003E    else if ( (1962*0.95)\u0026lt;mu \u0026amp;\u0026amp; mu\u0026lt;(1962*1.05) )           return LaytheSOI;\u003Cbr\u003E    else if ( (207.48150*0.95)\u0026lt;mu \u0026amp;\u0026amp; mu\u0026lt;(207.48150*1.05) ) return VallSOI;\u003Cbr\u003E    else if ( (2.4868349*0.95)\u0026lt;mu \u0026amp;\u0026amp; mu\u0026lt;(2.4868349*1.05) ) return BopSOI;\u003Cbr\u003E    else if ( (2825.2800*0.95)\u0026lt;mu \u0026amp;\u0026amp; mu\u0026lt;(2825.2800*1.05) ) return TyloSOI;\u003Cbr\u003E    else if ( (0.0082894498*0.95)\u0026lt;mu \u0026amp;\u0026amp; mu\u0026lt;(0.0082894498*1.05) ) return GillySOI;\u003Cbr\u003E    else if ( (0.72170208*0.95)\u0026lt;mu \u0026amp;\u0026amp; mu\u0026lt;(0.72170208*1.05) ) return PolSOI;\u003Cbr\u003E    else if ( (21.484489*0.95)\u0026lt;mu \u0026amp;\u0026amp; mu\u0026lt;(21.484489*1.05) ) return DresSOI;\u003Cbr\u003E    else if ( (74.410815*0.95)\u0026lt;mu \u0026amp;\u0026amp; mu\u0026lt;(74.410815*1.05) ) return EElooSOI;\u003Cbr\u003E    else if ( (1172332800*0.95)\u0026lt;mu \u0026amp;\u0026amp; mu\u0026lt;(1172332800*1.05) ) return KerbolSOI;\u003Cbr\u003E\u003Cbr\u003E    return mu; //catch-all line - unknown value, returning calc result for analysis.\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EIf I update it, it\u0027ll get reposted here. But I\u0027m pretty happy with it, and it\u0027s worked cleanly so far \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EEdit: This function actually calculates the gravitational constant * planet mass (\u00C3\u201A\u00C2\u00B5, or GM) for a given body, so who knows, this might be useful for other orbital calculations as well \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EMore edit: Also calculates things like distance to CENTRE of planetary body, which comes up a lot in equations as well.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-11-26T01:30:14Z\u0022 title=\u002211/26/2014 01:30  AM\u0022 data-short=\u00229 yr\u0022\u003ENovember 26, 2014\u003C/time\u003E by AmeliaEatyaheart\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"hakan","CreatedById":92934,"CreatedDateTime":"2014-11-26T10:49:51Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022AmeliaEatyaheart\u0022 data-cite=\u0022AmeliaEatyaheart\u0022\u003E\u003Cdiv\u003EI wrote some Arduino code to calculate what SOI you fall under - I\u0027m pretty sure it will fail if eccentricity is EXACTLY 1.00000000 (overflow error possibly?), but for any other orbit (elliptical, circular, hyperbolic) this will calculate what you\u0027re falling around \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003Cp\u003E...\u003C/p\u003E\u003Cp\u003EIf I update it, it\u0027ll get reposted here. But I\u0027m pretty happy with it, and it\u0027s worked cleanly so far \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EEdit: This function actually calculates the gravitational constant * planet mass (\u00C3\u201A\u00C2\u00B5, or GM) for a given body, so who knows, this might be useful for other orbital calculations as well \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EMore edit: Also calculates things like distance to CENTRE of planetary body, which comes up a lot in equations as well.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI \u003Cstrong\u003Eabsolutely\u003C/strong\u003E love this piece of code. Is it possible at all for you to put it on github? Even just a text file, or a gist ( \u003Ca href=\u0022https://gist.github.com/\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://gist.github.com/\u003C/a\u003E ) would be wonderful to make sure that it get all the attention it deserves \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cool.gif\u0022 alt=\u0022:cool:\u0022\u003E\u003C/p\u003E\u003Cp\u003EThat being said, I really might borrow / steal / adapt it for my own controller, I just hope that the Mega2560 will be fast enough to recalculate it all the time \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"MrOnak","CreatedById":104432,"CreatedDateTime":"2014-11-26T14:42:22Z","Content":"\n\u003Cp\u003EHeh, the processing power of the Atmel microprocessors is vastly underestimated usually. Don\u0027t worry, it should be fine. And besides... you don\u0027t change your SOI 99% of the time anyway, running the resolveSoi() once per second is MORE than good enough.\u003C/p\u003E\n"},{"CreatedByName":"hakan","CreatedById":92934,"CreatedDateTime":"2014-11-26T14:46:35Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022MrOnak\u0022 data-cite=\u0022MrOnak\u0022\u003E\u003Cdiv\u003EHeh, the processing power of the Atmel microprocessors is vastly underestimated usually. Don\u0027t worry, it should be fine. And besides... you don\u0027t change your SOI 99% of the time anyway, running the resolveSoi() once per second is MORE than good enough.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ETrue, I just have to put some variable somewhere in my code... lastSOICalculated() or something. Or I need to learn how to do event-based programming in C \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cry.gif\u0022 alt=\u0022;.;\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"MrOnak","CreatedById":104432,"CreatedDateTime":"2014-11-26T14:56:52Z","Content":"\n\u003Cp\u003EInterrupts are your friend for stuff like that.\u003C/p\u003E\n"},{"CreatedByName":"AmeliaEatyaheart","CreatedById":115681,"CreatedDateTime":"2014-11-27T04:48:54Z","Content":"\n\u003Cp\u003EThere are several ways to ration out how often the function is called; the code block I wrote will only call ResolveSOI() when it has changed enough to warrant a re-calc (eccentricity changes from hyperbolic to elliptical, visa-versa, makes a sudden jump, or is unknown). But it\u0027s not a really intense subroutine either. So far I have not had any false reportings of SOI with this code block, so do feel free to use it \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EI\u0027d honestly be shocked if it slowed the mega2560 down, even if it was called every loop. It\u0027s a floating point function, sure, but... it\u0027s not super-complicated \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EI\u0027ll have to have a look at github, to be honest this is the first Arduino code I felt was of value to share, so haven\u0027t really thought of all that stuff - I consider it released on a \u0027have fun with it, no restrictions, just give me name credit\u0027 type basis \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-11-27T04:52:11Z\u0022 title=\u002211/27/2014 04:52  AM\u0022 data-short=\u00229 yr\u0022\u003ENovember 27, 2014\u003C/time\u003E by AmeliaEatyaheart\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"MrOnak","CreatedById":104432,"CreatedDateTime":"2014-11-27T07:25:32Z","Content":"\n\u003Cp\u003E@Amelia, yeah you\u0027re probably right. After all, Zitronen\u0027s plugin updates the Microcontroller only a few times per second (forgot how quickly, exactly), which leaves quite a lot of time for the microcontroller to \u0022do stuff\u0022 in between.\u003C/p\u003E\u003Cp\u003EOne thing to keep in mind though is that floating point math is \u003Cem\u003Ereally\u003C/em\u003E expensive on an Atmel microcontroller. Not that it will be cheaper on controllers from other brands, just comparing it to integer math. Here\u0027s someone who tested it with some dramatic results:\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022http://www.avrfreaks.net/forum/multiply-divide-add-performance-various-data-types\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://www.avrfreaks.net/forum/multiply-divide-add-performance-various-data-types\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EHe basically generated two random numbers of float, int_8, int_16, ... each, and multiplied them, measuring the time it took. Results on the bottom of the first post \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif\u0022 alt=\u0022;)\u0022\u003E.\u003C/p\u003E\u003Cp\u003ESo yeah.. I\u0027m a bit hesitant with floating point math since I know that but it\u0027s pretty much unavoidable in KSP where we deal with planetary masses and gravitational pulls at the same time. But beware that floating point error \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 alt=\u0022:D\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"_Augustus_","CreatedById":115084,"CreatedDateTime":"2014-11-27T12:23:31Z","Content":"\n\u003Cp\u003EERSUM!\u003C/p\u003E\u003Cp\u003EIf only I had more than 1 Arduino.... and all that other stuff\u003C/p\u003E\n"},{"CreatedByName":"zitronen","CreatedById":11842,"CreatedDateTime":"2014-11-27T18:12:35Z","Content":"\n\u003Cp\u003ESo I was thinking about finally implementing sending the SOI, but if people are happy with Amelia\u0027s implementation I won\u0027t need to any more?\u003C/p\u003E\n"},{"CreatedByName":"stibbons","CreatedById":57865,"CreatedDateTime":"2014-11-28T06:28:56Z","Content":"\n\u003Cp\u003EI think that occasionally calculating SOI with Amelia\u0027s code is preferable to resending it every 25 milliseconds.\u003C/p\u003E\u003Cp\u003EAll I need to do now is figure out how to calculate velocity vectors.\u003C/p\u003E\n"},{"CreatedByName":"hakan","CreatedById":92934,"CreatedDateTime":"2014-11-28T08:48:22Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022zitronen\u0022 data-cite=\u0022zitronen\u0022\u003E\u003Cdiv\u003ESo I was thinking about finally implementing sending the SOI, but if people are happy with Amelia\u0027s implementation I won\u0027t need to any more?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EHonestly, I would prefer the SOI to be sent from the plugin. On the KSP side, you have a much better idea of which body we are orbiting (it is the \u0022REF\u0022 attribute of the \u0022ORBIT\u0022 element in persistent.sfs), especially if the planetary bodies are modded in some way (Real Solar System, anyone?).\u003C/p\u003E\u003Cp\u003EAmelia\u0027s implementation, on the other hand, without wanting to belittle the hard work that went into it, relies on quite a bit of guesswork. It might break anytime with a mod or an update to the core (0.90?)\u003C/p\u003E\n"},{"CreatedByName":"MrOnak","CreatedById":104432,"CreatedDateTime":"2014-11-28T09:45:47Z","Content":"\n\u003Cp\u003EI\u0027d second Hakans opinion on this. Providing the SOI from KSP itself is inherently more reliable and stable. And with \u0022reliable\u0022 I don\u0027t mean to imply that Amelias code has issues, but that it will invariably fail is SQUAD changes a parameter on one of the bodies that is involved in the calculations whereas the KSP-side of things would simply continue to work.\u003C/p\u003E\n"},{"CreatedByName":"AmeliaEatyaheart","CreatedById":115681,"CreatedDateTime":"2014-11-28T13:01:40Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022MrOnak\u0022 data-cite=\u0022MrOnak\u0022\u003E\u003Cdiv\u003E@Amelia, yeah you\u0027re probably right. After all, Zitronen\u0027s plugin updates the Microcontroller only a few times per second (forgot how quickly, exactly), which leaves quite a lot of time for the microcontroller to \u0022do stuff\u0022 in between.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThe default packet delay is 80ms, which seems fine for most things. I\u0027m not even running any switch debouncing code with a delay like that, and not had any problems.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003EBut beware that floating point error \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 alt=\u0022:D\u0022\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003Etell me about it \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif\u0022 alt=\u0022;)\u0022\u003E Had a few FP projects with borked maths. I\u0027ve given up testing for x==0 now, just test for x\u0026lt;0.001 or something like that \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif\u0022 alt=\u0022:P\u0022\u003E\u003C/p\u003E\u003Cp\u003EMy SOI code would break if the planetary parameter for mass (GM) changed, or had two bodies with the same GM value. Otherwise, it looks up craft orbital velocity, semi-major axis, apoapsis, and periapsis from the KSPplugin \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-11-28T15:14:00Z\u0022 title=\u002211/28/2014 03:14  PM\u0022 data-short=\u00229 yr\u0022\u003ENovember 28, 2014\u003C/time\u003E by AmeliaEatyaheart\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"MrOnak","CreatedById":104432,"CreatedDateTime":"2014-11-28T13:07:11Z","Content":"\n\u003Cp\u003EYes that\u0027s more or less the standard way of validating against zero with floating point math \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EI like using things like (fabs(result - expectedResult) \u0026lt; 0.0001) or something to that effect. fabs() is part of math.h\u003C/p\u003E\n"},{"CreatedByName":"Pondafarr","CreatedById":99169,"CreatedDateTime":"2014-11-28T13:29:01Z","Content":"\n\u003Cp\u003EYou can easily add Fuel gauge to the ion by changing the following section\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003EPROPELLANT\u003Cbr\u003E\t{\u003Cbr\u003E\t\tname = XenonGas\u003Cbr\u003E\t\tratio = 0.1\u003Cbr\u003E\t}\u003Cbr\u003E\u003Cbr\u003Eto \u003Cbr\u003E\u003Cbr\u003EPROPELLANT\u003Cbr\u003E\t{\u003Cbr\u003E\t\tname = XenonGas\u003Cbr\u003E\t\tratio = 0.1\u003Cbr\u003E                      DrawGauge = True\u003Cbr\u003E\t}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E won\u0027t help for ion drives, but is otherwise helpful and fun - especially when firing those lovely 3.75m engines!\u003C/p\u003E\n"},{"CreatedByName":"AmeliaEatyaheart","CreatedById":115681,"CreatedDateTime":"2014-11-28T17:08:50Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Pondafarr\u0022 data-cite=\u0022Pondafarr\u0022\u003E\u003Cdiv\u003EYou can easily add Fuel gauge to the ion by changing the following section\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EHmm! Maybe I\u0027ll have to modify the fuel gauge to do both after all! \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 alt=\u0022:D\u0022\u003E\u003C/p\u003E\u003Cp\u003EMrOnak, ty! I do need to learn more about some (i.e. A LOT) of the internal Arduino library functions - it\u0027s not uncommon for me to write a function and find out later that there\u0027s an inbuilt version of the same thing.\u003C/p\u003E\n"},{"CreatedByName":"AmeliaEatyaheart","CreatedById":115681,"CreatedDateTime":"2014-12-01T02:11:23Z","Content":"\n\u003Cp\u003EMini update:\u003C/p\u003E\u003Cp\u003EBeen working on the PCBs of late, so I thought I\u0027d show em off \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://i133.photobucket.com/albums/q80/LordPhobos6920/Flightcomputerpaneldecember2014.png\u0022 alt=\u0022Flightcomputerpaneldecember2014.png\u0022\u003E\u003C/p\u003E\u003Cp\u003Ethe flight readout will have a stupid amount of 7 segment displays, a small graphic LED which I hope to use to show a navball, or a simple orbital map, and a character LCD for any extra info that doesn\u0027t fit on the 7-seg\u0027s such as current SOI, Terminal velocity indicator, various alarm statuses...\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://i133.photobucket.com/albums/q80/LordPhobos6920/PCBpaneldecember2014.png\u0022 alt=\u0022PCBpaneldecember2014.png\u0022\u003E\u003C/p\u003E\u003Cp\u003EAnd the reason it\u0027s taking so long to get made \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif\u0022 alt=\u0022:P\u0022\u003E\u003C/p\u003E\u003Cp\u003EThere\u0027s a few different projects on that panel, the two bigger boards to the upper right and the small shield lower right are for the mass 7-segment display (6 rows by 8 digits, plus indicator LEDs)\u003C/p\u003E\u003Cp\u003EThe driver board will run two of those with a bit of greenwiring \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EIt\u0027s an expensive project, and it won\u0027t get done before the end of the summer break (southern hemisphere, so... end of jan maybe?) so I thought I\u0027d make a post and show that this project may be running on slow, but not forgotten \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"MrOnak","CreatedById":104432,"CreatedDateTime":"2014-12-01T04:28:18Z","Content":"\n\u003Cp\u003EHoly crap \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 alt=\u0022:D\u0022\u003E thats impressive\u003C/p\u003E\u003Cp\u003EAre you using super low power 7-segments? The normal ones are quite the Ampere-hog.\u003C/p\u003E\n"}]}