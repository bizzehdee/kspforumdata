{"TopicId":140822,"ForumId":16,"TopicTitle":"How is asteroid mass calculated?","CreatedByName":"ferrer","CreatedById":161724,"CreatedDateTime":"2016-05-30T16:30:39Z","PageNum":1,"Articles":[{"CreatedByName":"ferrer","CreatedById":161724,"CreatedDateTime":"2016-05-30T16:30:39Z","Content":"\n\u003Cp\u003E\nI recently attempted my first-ever asteroid redirect, with an A-class asteroid that was approaching Kerbin. Rendezvous was successful, but once I was attached to the asteroid, I realised that its mass was 150 tonnes - far more than my expected maximum of 10 tonnes.\u00A0I found that this is a bug that was already on the tracker (\u003Ca href=\u0022http://bugs.kerbalspaceprogram.com/issues/9392\u0022 rel=\u0022external nofollow\u0022\u003EBug #9392\u003C/a\u003E) -\u00A0it seems that all asteroids are spawning with a mass of 150 tonnes regardless of physical dimensions.\n\u003C/p\u003E\n\u003Cp\u003E\nWith little information available, I want to have a go at\u00A0diagnosing\u00A0the problem, and possibly at\u00A0creating\u00A0a mod to remedy it. My question is, how is the mass of an asteroid calculated? How is it dependent on class/size/shape, what algorithm is used to come up with it? I can see in the PotatoRoid part.cfg file that the default mass is 150 tonnes, so presumably something that used to happen on asteroid generation is no longer happening.\n\u003C/p\u003E\n\u003Cp\u003E\n(As a secondary question, have many people noticed this bug before? I feel like if it was a widespread problem I would have found more threads\u00A0about it.)\n\u003C/p\u003E\n"},{"CreatedByName":"EmpCris","CreatedById":96984,"CreatedDateTime":"2016-06-02T04:29:38Z","Content":"\n\u003Cp\u003E\nI have the same problem with asteroids.\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"monophonic","CreatedById":76902,"CreatedDateTime":"2016-06-02T06:47:18Z","Content":"\n\u003Cp\u003E\nAnother possible cause is something new overwriting the mass after the asteroid has been generated. Did they mention something about reloading assets while the game is running to speed up development and testing in dev notes before 1.1? Such a feature could do it.\n\u003C/p\u003E\n\u003Cp\u003E\nAs to how the mass is calculated, I would hazard a guess that they would calculate the volume of the asteroid and multiply it by a constant density. Throw in a random factor for ore content and you are all set. One could calculate the exact volume from the generated mesh, but since real asteroids are not all exactly the same density you would get away with estimating it from the average radius with the sphere volume formula. If you cannot access the average radius used to generate the mesh you may have to estimate that too. Averaging a few random vertices from the mesh should get you close enough.\n\u003C/p\u003E\n"},{"CreatedByName":"Snark","CreatedById":125662,"CreatedDateTime":"2016-06-02T14:59:31Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222612586\u0022 data-ipsquote-contentid=\u0022140822\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221464850038\u0022 data-ipsquote-userid=\u002276902\u0022 data-ipsquote-username=\u0022monophonic\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n8 hours ago, monophonic said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nAs to how the mass is calculated, I would hazard a guess that they would calculate the volume of the asteroid and multiply it by a constant density.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nMy own guess (based on no information whatsoever, other than that it\u0027s how I would code it if I were the one writing the feature) is that you\u0027ve got it backwards, and that the mass isn\u0027t \u003Cem\u003E\u003Cu\u003Ecalculated\u003C/u\u003E\u003C/em\u003E, it\u0027s \u003Cem\u003E\u003Cu\u003Eassigned\u003C/u\u003E\u003C/em\u003E.\n\u003C/p\u003E\n\u003Cp\u003E\nIn other words, an algorithm something like this:\n\u003C/p\u003E\n\u003Col\u003E\u003Cli\u003E\nOh, I need to generate a new random asteroid.\n\u003C/li\u003E\n\u003Cli\u003E\nPick an asteroid class.\n\u003C/li\u003E\n\u003Cli\u003E\nFor that asteroid class, randomly pick a mass, based on some allowed range that\u0027s configured somewhere.\n\u003C/li\u003E\n\u003Cli\u003E\nHaving picked a mass, now generate a mesh for it, based on the physical size defined for that asteroid class, and \u003Cem\u003E\u003Cu\u003Emaybe\u003C/u\u003E\u003C/em\u003E taking the mass into account as a scale multiplier.\n\u003C/li\u003E\n\u003C/ol\u003E\u003Cp\u003E\nOf course, that doesn\u0027t explain how you could get a Class A asteroid with a mass of 150 tons.\u00A0 That sounds like a bug to me.\u00A0 Have you \u003Ca href=\u0022http://bugs.kerbalspaceprogram.com/projects/ksp\u0022 rel=\u0022external nofollow\u0022\u003Ereported it\u003C/a\u003E?\n\u003C/p\u003E\n"},{"CreatedByName":"Geschosskopf","CreatedById":69507,"CreatedDateTime":"2016-06-02T15:20:47Z","Content":"\n\u003Cp\u003E\nI would ask \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/104043-starstrider42/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022104043\u0022 href=\u0022%7B___base_url___%7D/index.php?/profile/104043-starstrider42/\u0022 rel=\u0022\u0022\u003E@Starstrider42\u003C/a\u003E, the author of the lovely CustomAsteroids mod. \u00A0If anybody knows how baby asteroids are made, it\u0027s him.\n\u003C/p\u003E\n"},{"CreatedByName":"Just Jim","CreatedById":148725,"CreatedDateTime":"2016-06-02T15:25:50Z","Content":"\n\u003Cp\u003E\nI\u0027m encountering the same issue, and I was going to report it, but I wasn\u0027t sure where you go now to report bugs.\n\u003C/p\u003E\n\u003Cp\u003E\nI can add something to this, it did NOT effect my Emiko Station Asteroid! \u00A0I just went and rechecked and that one is\u00A0still weighing in at well over 3,000t. But when I checked a couple newly discovered dres-deroids, no matter what the class, they weighed in at 150t. \u00A0So this makes me think\u00A0it\u0027s only happening to newly spawned asteroids.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-06-02T15:27:07Z\u0022 title=\u002206/02/2016 03:27  PM\u0022 data-short=\u00228 yr\u0022\u003EJune 2, 2016\u003C/time\u003E by Just Jim\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"ferrer","CreatedById":161724,"CreatedDateTime":"2016-06-02T15:47:48Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222612586\u0022 data-ipsquote-contentid=\u0022140822\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221464850038\u0022 data-ipsquote-userid=\u002276902\u0022 data-ipsquote-username=\u0022monophonic\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n8 hours ago, monophonic said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nAs to how the mass is calculated, I would hazard a guess that they would calculate the volume of the asteroid and multiply it by a constant density. Throw in a random factor for ore content and you are all set. One could calculate the exact volume from the generated mesh, but since real asteroids are not all exactly the same density you would get away with estimating it from the average radius with the sphere volume formula. If you cannot access the average radius used to generate the mesh you may have to estimate that too. Averaging a few random vertices from the mesh should get you close enough.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222613012\u0022 data-ipsquote-contentid=\u0022140822\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221464879571\u0022 data-ipsquote-userid=\u0022125662\u0022 data-ipsquote-username=\u0022Snark\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n37 minutes ago, Snark said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nMy own guess (based on no information whatsoever, other than that it\u0027s how I would code it if I were the one writing the feature) is that you\u0027ve got it backwards, and that the mass isn\u0027t \u003Cem\u003E\u003Cu\u003Ecalculated\u003C/u\u003E\u003C/em\u003E, it\u0027s \u003Cem\u003E\u003Cu\u003Eassigned\u003C/u\u003E\u003C/em\u003E.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThough I initially thought that it would be assigned, I did see the following lines in the config file:\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nQuote\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nMODULE\u003Cbr\u003E\n{\u003Cbr\u003E\n\u00A0\u00A0 \u00A0name = ModuleAsteroid\u00A0\u00A0 \u00A0\u003Cbr\u003E\n\u00A0\u00A0 \u00A0density = 0.03\u003Cbr\u003E\n}\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThat might indicate that an actual calculation takes place, but I\u0027m not an expert so I don\u0027t know how/whether that\u0027s used.\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222613012\u0022 data-ipsquote-contentid=\u0022140822\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221464879571\u0022 data-ipsquote-userid=\u0022125662\u0022 data-ipsquote-username=\u0022Snark\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n41 minutes ago, Snark said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nThat sounds like a bug to me.\u00A0 Have you \u003Ca href=\u0022http://bugs.kerbalspaceprogram.com/projects/ksp\u0022 rel=\u0022external nofollow\u0022\u003Ereported it\u003C/a\u003E?\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nIt\u0027s already on the tracker (linked in the OP). My experiences match exactly those described in the bug report (all asteroids of all classes spawn with mass 150t), so I didn\u0027t have any information to add.\n\u003C/p\u003E\n"},{"CreatedByName":"ColKlonk","CreatedById":137078,"CreatedDateTime":"2016-06-02T19:29:25Z","Content":"\n\u003Cp\u003E\nNope it\u0027s not a bug.. it\u0027s a feature !!\n\u003C/p\u003E\n\u003Cp\u003E\nLook in the folder:- GameData\\Squad\\Parts\\Misc\\PotatoRoid\n\u003C/p\u003E\n\u003Cp\u003E\nYou\u0027ll find only one asteroid \u0027part\u0027 file.. and it\u0027s mass is set to 150 tons\n\u003C/p\u003E\n\u003Cp\u003E\n...\n\u003C/p\u003E\n\u003Cp\u003E\n// --- standard part parameters ---\u003Cbr\u003E\nmass = 150\u003Cbr\u003E\ndragModelType = default\n\u003C/p\u003E\n\u003Cp\u003E\n...\n\u003C/p\u003E\n"},{"CreatedByName":"EmpCris","CreatedById":96984,"CreatedDateTime":"2016-06-02T19:44:21Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222613431\u0022 data-ipsquote-contentid=\u0022140822\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221464895765\u0022 data-ipsquote-userid=\u0022137078\u0022 data-ipsquote-username=\u0022ColKlonk\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n11 minutes ago, ColKlonk said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nNope it\u0027s not a bug.. it\u0027s a feature !!\n\u003C/p\u003E\n\u003Cp\u003E\nLook in the folder:- GameData\\Squad\\Parts\\Misc\\PotatoRoid\n\u003C/p\u003E\n\u003Cp\u003E\nYou\u0027ll find only one asteroid \u0027part\u0027 file.. and it\u0027s mass is set to 150 tons\n\u003C/p\u003E\n\u003Cp\u003E\n...\n\u003C/p\u003E\n\u003Cp\u003E\n// --- standard part parameters ---\u003Cbr\u003E\nmass = 150\u003Cbr\u003E\ndragModelType = default\n\u003C/p\u003E\n\u003Cp\u003E\n...\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nok, but I have an installation of 0.90 and the parameter is the same, but the asteroids appeared in various sizes and masses, not now\n\u003C/p\u003E\n"},{"CreatedByName":"ferrer","CreatedById":161724,"CreatedDateTime":"2016-06-02T19:56:45Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222613431\u0022 data-ipsquote-contentid=\u0022140822\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221464895765\u0022 data-ipsquote-userid=\u0022137078\u0022 data-ipsquote-username=\u0022ColKlonk\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n23 minutes ago, ColKlonk said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nNope it\u0027s not a bug.. it\u0027s a feature !!\n\u003C/p\u003E\n\u003Cp\u003E\nLook in the folder:- GameData\\Squad\\Parts\\Misc\\PotatoRoid\n\u003C/p\u003E\n\u003Cp\u003E\nYou\u0027ll find only one asteroid \u0027part\u0027 file.. and it\u0027s mass is set to 150 tons\n\u003C/p\u003E\n\u003Cp\u003E\n...\n\u003C/p\u003E\n\u003Cp\u003E\n// --- standard part parameters ---\u003Cbr\u003E\nmass = 150\u003Cbr\u003E\ndragModelType = default\n\u003C/p\u003E\n\u003Cp\u003E\n...\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThat\u0027s what I was referencing in my original post. It definitely is a bug, asteroids have previously always generated with different masses.\n\u003C/p\u003E\n"},{"CreatedByName":"Starstrider42","CreatedById":104043,"CreatedDateTime":"2016-06-03T05:57:11Z","Content":"\n\u003Cp\u003E\nAs far as I know, the asteroid mass is always calculated based on the density and a rough estimate of the asteroid volume*. I don\u0027t think the resource content is taken into account.\n\u003C/p\u003E\n\u003Cp\u003E\nI have not (yet) seen the always-150-tons bug myself; in my tests asteroids always had generated-looking masses.\n\u003C/p\u003E\n\u003Cp\u003E\n* I should add an extra comment based on the bug report linked from the OP: the asteroid mass is calculated when the asteroid first enters physics range. \u003Cem\u003EUnloaded\u003C/em\u003E asteroids will always mass 150 tons, because the asteroid\u0027s shape hasn\u0027t been generated yet. Hope this clarifies the \u0022is it/isn\u0027t it a bug\u0022 questions.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-06-03T08:00:31Z\u0022 title=\u002206/03/2016 08:00  AM\u0022 data-short=\u00228 yr\u0022\u003EJune 3, 2016\u003C/time\u003E by Starstrider42\u003C/strong\u003E\n\u003C/span\u003E\n"}]}