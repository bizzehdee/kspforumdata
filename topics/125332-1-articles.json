{"TopicId":125332,"ForumId":36,"TopicTitle":"Mouseless Keyboardless MechJeb, or Directly Control Ship","CreatedByName":"Keith Young","CreatedById":152980,"CreatedDateTime":"2015-11-13T20:21:54Z","PageNum":1,"Articles":[{"CreatedByName":"Keith Young","CreatedById":152980,"CreatedDateTime":"2015-11-13T20:21:54Z","Content":"\n\u003Cp\u003EI\u0027m new to C#, and I\u0027m finding the lack of KSP API documentation crippling.\u003C/p\u003E\u003Cp\u003EI want to find a way to call for certain MechJeb actions without using a mouse. I currently have a system that can recognize when I want something to happen. What I don\u0027t know is how to ask my ship to do something, or ask MechJeb.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003EDeclare Secret Way To Talk To MechJeb //This probably requires multiple lines of stuff, and even likely settings in Visual Studio\u003Cbr\u003EI_Want_To_Kill_Rot = true\u003Cbr\u003Eif (I_Want_To_Kill_Rot)\u003Cbr\u003E\u003Cbr\u003E     MechJeb.secretThing.greek.KillRot()\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003ESo what do I need to substitute for \u0022Declare Secret Way To Talk To MechJeb\u0022 and \u0022MechJeb.secretThing.greek.KillRot()\u0022?\u003C/p\u003E\u003Cp\u003EOr, is there a way to just directly tell the ship what I want? I already know how to do SAS on my own, so let\u0027s say I want the ship to point in a direction and burn.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Eship.magic.pointindirection(vectorthing)\u003Cbr\u003Ewhile vel \u0026lt; 2000\u003Cbr\u003E    ship.magic.full_throttle\u003Cbr\u003Eship.magic.cut_throttle\u003Cbr\u003EdarnIt.prepare.rescue.Jeb.AGAIN(location, velocity, float facepalm)\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003ESorry if this question seems really basic. I\u0027ve Googled to no avail, and trying to decipher the thousands of lines of MechJeb to find answers is proving to be very difficult.\u003C/p\u003E\u003Cp\u003EThanks for any help!\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2015-11-13T20:44:48Z","Content":"\n\u003Cp\u003EUnfortunately, none of what you are asking is really easy or straight forward.\u003C/p\u003E\u003Cp\u003E1) To reference MechJeb from code, you need to find the reference. You can either do so via a hard dependancy where you add MechJeb.dll as a reference and add the Using MechJeb; line to the start of your code. The downside to this method is that if MechJeb is not present, your mod will not load. The upside is you can just call MechJeb\u0027s stuff the same way you do Part or Vessel.\u003C/p\u003E\u003Cp\u003EIf you want your mod to load regardless of if MechJeb is installed or not, you need to use reflection. \u003Ca href=\u0022https://github.com/SirDiazo/AGExt/blob/master/AGExt/External.cs#L946\u0022 rel=\u0022external nofollow\u0022\u003EI use reflection here in my mod to talk to RemoteTech.\u003C/a\u003E You\u0027ll have to find the correct values for MechJeb to use it for your purposes. \u003C/p\u003E\u003Cp\u003E2) If you want to point the vessel in a specific direction, the easiest way is to put the SAS system in hold mode, then override the hold vector. This is dealing with quaternions though so it gets confusing fast. \u003Ca href=\u0022https://github.com/SirDiazo/AGExt/blob/master/AGExt/External.cs#L946\u0022 rel=\u0022external nofollow\u0022\u003EHere\u0027s the actual command to do this,\u003C/a\u003E you will have to backtrack up my code to see how I get the values I plug into said command.\u003C/p\u003E\u003Cp\u003E3) Throttle is the easy part of all this, if you are working with the currently focused vessel, it is FlightInputHandle.fetch.mainThrottle\u003C/p\u003E\u003Cp\u003EHope that helps,\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n"},{"CreatedByName":"Keith Young","CreatedById":152980,"CreatedDateTime":"2015-11-13T21:55:09Z","Content":"\n\u003Cp\u003EThanks Diazo, will give this a try!\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022font-size:8px;\u0022\u003E\u003Cspan style=\u0022color:#C0C0C0;\u0022\u003E- - - Updated - - -\u003C/span\u003E\u003C/span\u003E\u003C/p\u003E\u003Cp\u003EI think you pasted in the RemoteTech hook twice. The quaternion wasn\u0027t linked.\u003C/p\u003E\u003Cp\u003EThanks for the help Diazo!\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2015-11-13T22:04:14Z","Content":"\n\u003Cp\u003EBah, try \u003Ca href=\u0022https://github.com/SirDiazo/RCSLandAid/blob/master/RCSLandAid/RCSLandAidModule.cs#L140\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/SirDiazo/RCSLandAid/blob/master/RCSLandAid/RCSLandAidModule.cs#L140\u003C/a\u003E\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n"},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2015-11-16T03:11:59Z","Content":"\nWithout taking a proper look, I would just about guarantee SetFlightCtrlState is what controls the ship (One I can guarantee completely is the control [URL=\u0022https://github.com/Crzyrndm/Pilot-Assistant/blob/master/PilotAssistant/FlightModules/PilotAssistant.cs#L711\u0022]function[/URL] from Pilot Assistant. [URL=\u0022https://github.com/Crzyrndm/Pilot-Assistant/blob/master/PilotAssistant/FlightModules/PilotAssistant.cs#L745-L746\u0022]Yaw/Roll[/URL], [URL=\u0022https://github.com/Crzyrndm/Pilot-Assistant/blob/master/PilotAssistant/FlightModules/PilotAssistant.cs#L764\u0022]Pitch[/URL], [URL=\u0022https://github.com/Crzyrndm/Pilot-Assistant/blob/master/PilotAssistant/FlightModules/PilotAssistant.cs#L780\u0022]Throttle[/URL]). All that\u0026#39;s done for the actual turning is feeding the FlightCtrlState the percent (0 -\u0026gt; \u002B/-1) deflection on each axis. KSP handles updating each of the relevant parts (RCS, control surfaces, gimbals, reaction wheels)\u003Cbr\u003E\n\u003Cbr\u003E\nEDIT\u003Cbr\u003E\n\u003Cbr\u003E\nA simpler [URL=\u0022https://github.com/Crzyrndm/Analog-Control/blob/master/Analog%20Control/AnalogControl.cs#L299\u0022]example[/URL] (NOTE: since FlightCtrlState is a class (passed by reference) I really don\u0026#39;t need to be returning the output here...)\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-11-16T03:14:54Z\u0022 title=\u002211/16/2015 03:14  AM\u0022 data-short=\u00228 yr\u0022\u003ENovember 16, 2015\u003C/time\u003E by Crzyrndm\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Keith Young","CreatedById":152980,"CreatedDateTime":"2015-11-16T19:12:12Z","Content":"\nThanks Crzyrndm! I ended up getting that to work.\u003Cbr\u003E\n\u003Cbr\u003E\nSo my main class uses Monobehaviour. I\u0026#39;m trying to call a method that is in another class (in another cs file in the same project using the same namespace).\u003Cbr\u003E\n\u003Cbr\u003E\nI can\u0026#39;t get my code to call it. The main way I\u0026#39;d see it working is:\u003Cbr\u003E\n\u003Cbr\u003E\n\u003Cbr\u003E\n[CODE]\u003Cbr\u003E\n\u003Cbr\u003E\nnamespace same\u003Cbr\u003E\n{\u003Cbr\u003E\npublic class mainclass : MonoBehaviour\u003Cbr\u003E\n{\u003Cbr\u003E\npublic otherclass oc;\u003Cbr\u003E\nvoid Update()\u003Cbr\u003E\n{\u003Cbr\u003E\ndo some other stuff //--------this stuff works\u003Cbr\u003E\noc.justworkforchristssake();\u003Cbr\u003E\ndo more stuff //-------------this stuff never works\u003Cbr\u003E\n} \u003Cbr\u003E\n}\u003Cbr\u003E\n}\u003Cbr\u003E\n\u003Cbr\u003E\n\u003Cbr\u003E\n//-----------------OTHER CS FILE-----------------------\u003Cbr\u003E\n\u003Cbr\u003E\nnamespace same\u003Cbr\u003E\n{\u003Cbr\u003E\npublic class otherclass\u003Cbr\u003E\n{\u003Cbr\u003E\npublic void justworkforchristssake()\u003Cbr\u003E\n{\u003Cbr\u003E\nDebug.Log(\u0022IT FINALLY WORKED TIME TO SWEEP UP ALL MY HAIR I\u0026#39;VE PULLED OUT\u0022); //----this never get in to the log\u003Cbr\u003E\n}\u003Cbr\u003E\n}\u003Cbr\u003E\n}\u003Cbr\u003E\n\u003Cbr\u003E\n[/CODE]\u003Cbr\u003E\n\u003Cbr\u003E\nI\u0026#39;ve tried static, override, I\u0026#39;ve been all over StackFlow and haven\u0026#39;t found anything that works yet.\u003Cbr\u003E\n\u003Cbr\u003E\nCan someone please help me just manage to call a method from another class? I really don\u0026#39;t want it all in a single cs file and get thousands of lines of code when I can just have a new class in a new cs file.\u003Cbr\u003E\n\u003Cbr\u003E\nThanks for any help!\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2015-11-16T19:48:45Z","Content":"\nYou need to reference the other file at run time somehow, either by initializing an instance of it, or declaring it static so that only a single instance of it can exist.\u003Cbr\u003E\n\u003Cbr\u003E\nUntil you do this, the other class doesn\u0026#39;t actually exist, it is just a template used to make instances. The static keyword cheats and initialized a single copy of the class on launch for you so you don\u0026#39;t have to do it yourself for static objects.\u003Cbr\u003E\n\u003Cbr\u003E\n[code]namespace same\u003Cbr\u003E\n{\u003Cbr\u003E\npublic class mainclass : MonoBehaviour\u003Cbr\u003E\n{\u003Cbr\u003E\npublic otherclass oc;\u003Cbr\u003E\nvoid Update()\u003Cbr\u003E\n{\u003Cbr\u003E\ndo some other stuff //--------this stuff works\u003Cbr\u003E\n[U][COLOR=\u0022#FF0000\u0022]othercalss oc = new otherclass();[/COLOR][/U] \u0026lt;- initialize a new instance of your class\u003Cbr\u003E\noc.justworkforchristssake();\u003Cbr\u003E\ndo more stuff //-------------this stuff never works\u003Cbr\u003E\n} \u003Cbr\u003E\n}\u003Cbr\u003E\n}\u003Cbr\u003E\n\u003Cbr\u003E\n\u003Cbr\u003E\n//-----------------OTHER CS FILE-----------------------\u003Cbr\u003E\n\u003Cbr\u003E\nnamespace same\u003Cbr\u003E\n{\u003Cbr\u003E\npublic class otherclass\u003Cbr\u003E\n{\u003Cbr\u003E\npublic void justworkforchristssake()\u003Cbr\u003E\n{\u003Cbr\u003E\nDebug.Log(\u0022IT FINALLY WORKED TIME TO SWEEP UP ALL MY HAIR I\u0026#39;VE PULLED OUT\u0022); //----this never get in to the log\u003Cbr\u003E\n}\u003Cbr\u003E\n}\u003Cbr\u003E\n}[/code]\u003Cbr\u003E\n\u003Cbr\u003E\nor\u003Cbr\u003E\n\u003Cbr\u003E\n[code]namespace same\u003Cbr\u003E\n{\u003Cbr\u003E\npublic class mainclass : MonoBehaviour\u003Cbr\u003E\n{\u003Cbr\u003E\npublic otherclass oc;\u003Cbr\u003E\nvoid Update()\u003Cbr\u003E\n{\u003Cbr\u003E\ndo some other stuff //--------this stuff works\u003Cbr\u003E\n[COLOR=\u0022#FF0000\u0022][U] otherclass[/U][/COLOR].justworkforchristssake(); //static is directly referenced\u003Cbr\u003E\ndo more stuff //-------------this stuff never works\u003Cbr\u003E\n} \u003Cbr\u003E\n}\u003Cbr\u003E\n}\u003Cbr\u003E\n\u003Cbr\u003E\n\u003Cbr\u003E\n//-----------------OTHER CS FILE-----------------------\u003Cbr\u003E\n\u003Cbr\u003E\nnamespace same\u003Cbr\u003E\n{\u003Cbr\u003E\npublic [COLOR=\u0022#FF0000\u0022][U]static[/U][/COLOR] class otherclass //the static keyword tells the program this is the only instance of this class that will ever exist, so you don\u0026#39;t need to initialise it\u003Cbr\u003E\n{\u003Cbr\u003E\npublic void justworkforchristssake()\u003Cbr\u003E\n{\u003Cbr\u003E\nDebug.Log(\u0022IT FINALLY WORKED TIME TO SWEEP UP ALL MY HAIR I\u0026#39;VE PULLED OUT\u0022); //----this never get in to the log\u003Cbr\u003E\n}\u003Cbr\u003E\n}\u003Cbr\u003E\n}[/code]\u003Cbr\u003E\n\u003Cbr\u003E\nThese concepts are part of the basic core that you need to know in order to work with C#. I\u0026#39;d recommend googling C# tutorials, you are going to keep banging your head against the wall on basic stuff like this until you do.\u003Cbr\u003E\n\u003Cbr\u003E\nD.\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-11-16T19:51:11Z\u0022 title=\u002211/16/2015 07:51  PM\u0022 data-short=\u00228 yr\u0022\u003ENovember 16, 2015\u003C/time\u003E by Diazo\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2015-11-16T19:57:51Z","Content":"\nYou either need an instance of otherclass to call the method on, or both otherclass and its methods need to be static.\u003Cbr\u003E\n\u003Cbr\u003E\nTo get an instance of otherclass, you either need to create it or find it somehow. Creating an instance is very easy:\u003Cbr\u003E\n[code]// instance of otherclass\u003Cbr\u003E\npublic void Start()\u003Cbr\u003E\n{\u003Cbr\u003E\noc = new OtherClass(); // calls the constructor for OtherClass\u003Cbr\u003E\n}\u003Cbr\u003E\n// Update() as per above[/code]\u003Cbr\u003E\n\u003Cbr\u003E\nIf you want to go the static method, you don\u0026#39;t use your instance variable, oc, at all\u003Cbr\u003E\n[code]public static class OtherClass\u003Cbr\u003E\n{\u003Cbr\u003E\npublic static void JustWork...();\u003Cbr\u003E\n}\u003Cbr\u003E\n\u003Cbr\u003E\n// In Update\u003Cbr\u003E\nOtherClass.JustWork...() \u0026lt;= Note using the class name, not an instance variable. [/code]\u003Cbr\u003E\n\u003Cbr\u003E\nThis stuff is some fairly basic C#. You would be better served running yourself through a general C# tutorial at the moment I think\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-11-16T20:01:10Z\u0022 title=\u002211/16/2015 08:01  PM\u0022 data-short=\u00228 yr\u0022\u003ENovember 16, 2015\u003C/time\u003E by Crzyrndm\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Keith Young","CreatedById":152980,"CreatedDateTime":"2015-11-16T20:00:40Z","Content":"\nThere we go. I was saying otherclass oc = new otherclass(); in the class, and not inside void Update().\u003Cbr\u003E\n\u003Cbr\u003E\nThanks Diazo.\u003Cbr\u003E\n\u003Cbr\u003E\nI\u0026#39;ve looked at tutorials but seeing where to find this without watching 40 hours of video is tough. I don\u0026#39;t know where I would have found that I have to create the \u0022instance?\u0022 inside the method itself rather than just in the class.\u003Cbr\u003E\n\u003Cbr\u003E\nI am going through tutorials as I develop this, but there are a lot of specific problems I\u0026#39;m running in to which are hard to find without already knowing the specific terminology etc.\u003Cbr\u003E\n\u003Cbr\u003E\nThanks again Diazo!\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2015-11-16T20:10:08Z","Content":"\n[quote name=\u0027Keith Young\u0027]There we go. I was saying otherclass oc = new otherclass(); in the class, and not inside void Update().[/QUOTE]\u003Cbr\u003E\n\u003Cbr\u003E\nYikes, careful here.\u003Cbr\u003E\n\u003Cbr\u003E\nYou are creating (and then destroying) a instance of the otherclass every update here. That\u0026#39;s bad form as it exert a lot of extra overhead on the CPU in terms of load. It also does not persist data across Update frames.\u003Cbr\u003E\n\u003Cbr\u003E\nAll objects created inside a method are destroyed when that method finishes running, so you need to create the instance elsewhere.\u003Cbr\u003E\n\u003Cbr\u003E\nIn this case, I would use the class constructor. (Google \u0022c# class constructor\u0022) Short form is that the constructor method is a method that automatically runs once when the class is created. So:\u003Cbr\u003E\n\u003Cbr\u003E\n[code]namespace same\u003Cbr\u003E\n{\u003Cbr\u003E\npublic class mainclass : MonoBehaviour\u003Cbr\u003E\n{\u003Cbr\u003E\npublic otherclass oc;\u003Cbr\u003E\n\u003Cbr\u003E\n[U][COLOR=\u0022#FF0000\u0022]publc mainclass() //constructor class that runs once when this instance of mainclass is created. Check the exact syntax with google, I\u0026#39;m on my mobile.\u003Cbr\u003E\n{\u003Cbr\u003E\noc = new otherclass();\u003Cbr\u003E\n} [/COLOR][/U]\u003Cbr\u003E\n\u003Cbr\u003E\nvoid Update()\u003Cbr\u003E\n{\u003Cbr\u003E\ndo some other stuff //--------this stuff works\u003Cbr\u003E\noc.justworkforchristssake(); [COLOR=\u0022#FF0000\u0022][U]this is now valid since the constructor has initialized the oc object.[/U][/COLOR]\u003Cbr\u003E\ndo more stuff //-------------this stuff never works\u003Cbr\u003E\n} \u003Cbr\u003E\n}\u003Cbr\u003E\n}[/code]\u003Cbr\u003E\n\u003Cbr\u003E\nThis way, the oc object will stay in existence as long as this instance of mainclass exists and you aren\u0026#39;t wasting processing power destroying and recreating it every Update() frame and any data changes made to the oc object will persist across Update frames.\u003Cbr\u003E\n\u003Cbr\u003E\nD.\n"},{"CreatedByName":"Keith Young","CreatedById":152980,"CreatedDateTime":"2015-11-16T22:20:57Z","Content":"\nThat makes sense. Fixed that. Thank you!\n"}]}