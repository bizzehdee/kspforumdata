{"TopicId":139484,"ForumId":34,"TopicTitle":"[1.1.2] GrumpyCollector 1.0.1 - Stutter ? What Stutter","CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2016-05-10T21:04:20Z","PageNum":1,"Articles":[{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2016-05-10T21:04:20Z","Content":"\n\u003Cp\u003E\nThis is an experiment. Some people keep complaining about stutter in the game and other don\u0027t get this problem. This addon is for the first category.\n\u003C/p\u003E\n\u003Cp\u003E\nIf you have stutter in gamer please install this and tell us if things are better or worse. You even have a amazing UI that you can open with Ctrl \u002B * (the one on the numpad). Faster may lower stutter but also lower the frame rate. Slower may make the stutter come back but has less impact on the frame rate.\n\u003C/p\u003E\n\u003Cp\u003E\nPlease share your experience with using\u00A0this and if it make the stutter better or worse.\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://ksp.sarbian.com/jenkins/job/GrumpyCollector/lastSuccessfulBuild/artifact/GrumpyCollector-1.0.1.0.zip\u0022 rel=\u0022external nofollow\u0022\u003EGrumpyCollector-1.0.1.0.zip\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nLicense MIT\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://github.com/sarbian/GrumpyCollector\u0022 rel=\u0022external nofollow\u0022\u003ESource\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-05-10T21:13:29Z\u0022 title=\u002205/10/2016 09:13  PM\u0022 data-short=\u00228 yr\u0022\u003EMay 10, 2016\u003C/time\u003E by sarbian\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"JPLRepo","CreatedById":114736,"CreatedDateTime":"2016-05-10T21:11:50Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222573768\u0022 data-ipsquote-contentid=\u0022139484\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221462914260\u0022 data-ipsquote-userid=\u002257146\u0022 data-ipsquote-username=\u0022sarbian\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n7 minutes ago, sarbian said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nThis is an experiment. Some people keep complaining about stutter in the game and other don\u0027t get this problem. This addon is for the first category.\n\u003C/p\u003E\n\u003Cp\u003E\nIf you have stutter in gamer please install this and tell us if things are better or worse. You even have a amazing UI that you can open with Ctrl \u002B * (the one on the numpad). Faster may lower stutter but also lower the frame rate. Slower may make the stutter come back but has less impact on the frame rate.\n\u003C/p\u003E\n\u003Cp\u003E\nPlease share your experience with using\u00A0this and if it make the stutter better or worse.\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://ksp.sarbian.com/jenkins/job/GrumpyCollector/1/artifact/GrumpyCollector-1.0.0.0.zip\u0022 rel=\u0022external nofollow\u0022\u003EGrumpyCollector-1.0.0.0.zip\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nLicense MIT\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nAssume this is an aggressive Garbage Collector... is there source?\n\u003C/p\u003E\n"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2016-05-10T21:13:37Z","Content":"\n\u003Cp\u003E\nOf course. You even have a 1.0.1 since I forgot to remove some debug spam \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-05-10T21:13:54Z\u0022 title=\u002205/10/2016 09:13  PM\u0022 data-short=\u00228 yr\u0022\u003EMay 10, 2016\u003C/time\u003E by sarbian\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Chris97b","CreatedById":2686,"CreatedDateTime":"2016-05-11T02:28:14Z","Content":"\n\u003Cp\u003E\nI\u0027ve been having the stuttering issue pretty badly, so I figured I\u0027d give this a try. Basically what I\u0027m seeing with this mod is the game stutters every time the GC runs, no matter how fast I set the GC interval. Basically if I set it very low, the game simply stutters every time GC runs. If anything, faster GC has made things worse, as it means the game stutters more frequently.\n\u003C/p\u003E\n"},{"CreatedByName":"ve7oko","CreatedById":145848,"CreatedDateTime":"2016-05-11T03:22:11Z","Content":"\n\u003Cp\u003E\nTried it but it made it much worse...\n\u003C/p\u003E\n"},{"CreatedByName":"drtedastro","CreatedById":70911,"CreatedDateTime":"2016-05-11T04:46:15Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222573768\u0022 data-ipsquote-contentid=\u0022139484\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221462914260\u0022 data-ipsquote-userid=\u002257146\u0022 data-ipsquote-username=\u0022sarbian\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n7 hours ago, sarbian said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nThis is an experiment. Some people keep complaining about stutter in the game and other don\u0027t get this problem. This addon is for the first category.\n\u003C/p\u003E\n\u003Cp\u003E\nIf you have stutter in gamer please install this and tell us if things are better or worse. You even have a amazing UI that you can open with Ctrl \u002B * (the one on the numpad). Faster may lower stutter but also lower the frame rate. Slower may make the stutter come back but has less impact on the frame rate.\n\u003C/p\u003E\n\u003Cp\u003E\nPlease share your experience with using\u00A0this and if it make the stutter better or worse.\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://ksp.sarbian.com/jenkins/job/GrumpyCollector/lastSuccessfulBuild/artifact/GrumpyCollector-1.0.1.0.zip\u0022 rel=\u0022external nofollow\u0022\u003EGrumpyCollector-1.0.1.0.zip\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nLicense MIT\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://github.com/sarbian/GrumpyCollector\u0022 rel=\u0022external nofollow\u0022\u003ESource\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nWould this be considered the \u0022Gunther\u0022 effect, perhaps?\n\u003C/p\u003E\n\u003Cp\u003E\nCheers.\n\u003C/p\u003E\n"},{"CreatedByName":"stk2008","CreatedById":162264,"CreatedDateTime":"2016-05-11T07:00:15Z","Content":"\n\u003Cp\u003E\n\u003Cimg alt=\u0022:(\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_sad.gif\u0022 title=\u0022:(\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nWhen i went to bed last night i see this and thought wow i am going to try this in the morning.\n\u003C/p\u003E\n\u003Cp\u003E\nBut reading replies it may not work?.\n\u003C/p\u003E\n\u003Cp\u003E\nThanks op for attempting to fix this though if you manage to then we all owe you big time.\n\u003C/p\u003E\n\u003Cp\u003E\nOther than stutter when unity does GC the game runs ok for me even with 50 mods \u003Cimg alt=\u0022:P\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif\u0022 title=\u0022:P\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"nedlee","CreatedById":107646,"CreatedDateTime":"2016-05-11T13:03:03Z","Content":"\n\u003Cp\u003E\nI\u0027ve had this problem for years, and the game\u0027s lagging even worse in 1.1.2. I\u0027m glad someone is looking for a solution, but the fix is making it worse for me, unfortunately.\n\u003C/p\u003E\n"},{"CreatedByName":"stk2008","CreatedById":162264,"CreatedDateTime":"2016-05-11T13:28:54Z","Content":"\n\u003Cp\u003E\nYep tryed it and its worse.\n\u003C/p\u003E\n\u003Cp\u003E\nAs said adjust it to lowest just makes it skip every second\n\u003C/p\u003E\n"},{"CreatedByName":"Padishar","CreatedById":97386,"CreatedDateTime":"2016-05-11T14:23:51Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222574968\u0022 data-ipsquote-contentid=\u0022139484\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221462971783\u0022 data-ipsquote-userid=\u0022107646\u0022 data-ipsquote-username=\u0022nedlee\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n1 hour ago, nedlee said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nI\u0027m glad someone is looking for a solution, but the fix is making it worse for me, unfortunately.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nPeople have been looking for a solution for years, the problem is that the only practical solution is to reduce the rate of memory allocation by both core KSP code and mods.\n\u003C/p\u003E\n\u003Cp\u003E\nAlso, I don\u0027t see any mention by \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022http://forum.kerbalspaceprogram.com/index.php?/profile/57146-sarbian/\u0026amp;do=hovercard\u0022 data-mentionid=\u002257146\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/57146-sarbian/\u0022 rel=\u0022\u0022\u003E@sarbian\u003C/a\u003E\u00A0that this was any sort of \u0022fix\u0022. \u00A0He clearly stated it was an experiment and also clearly stated it could make things better or worse.\n\u003C/p\u003E\n\u003Cp\u003E\nI have also tried various things along these lines (including patching mscorlib.dll to be able to profile exactly how long a manual run of the GC takes)\u00A0but they do not help. \u00A0The frequency of the pauses is directly related to the rate of garbage creation, the collector runs automatically when the Mono\u00A0heap doesn\u0027t have enough space when some C# code tries to allocate some memory. \u00A0The length of the pauses depends on a number of factors but the amount of garbage to be cleaned up is quite a minor one. \u00A0The total number of allocated blocks of memory is the main factor as the collection basically works as follows:\n\u003C/p\u003E\n\u003Cul\u003E\u003Cli\u003E\nStep 1, loop through every block of memory allocated on the heap and mark it as unreachable.\n\u003C/li\u003E\n\u003Cli\u003E\nStep 2, loop through every global and stack reference variable and mark the memory block as reachable. \u00A0If the block contains any references to other blocks (that are still marked as unreachable)\u00A0then mark those as reachable and continue recursively.\n\u003C/li\u003E\n\u003Cli\u003E\nStep 3, loop through every block and collect any that are still marked as unreachable. \u00A0The collection usually involves moving the memory blocks down to fill up the collected spaces as this greatly increases the allocation\u00A0efficiency.\n\u003C/li\u003E\n\u003C/ul\u003E\u003Cp\u003E\nIt should be obvious that, even if there are no unreachable blocks at all (no garbage to be collected), running the collection will still take a considerable time as the entire heap is still scanned through twice plus the entire recursive \u0022reachable\u0022 scan still has to run. \u00A0The only bit you save on is the shuffling around of the still-allocated blocks and fixing up of the references.\n\u003C/p\u003E\n\u003Cp\u003E\nSo, the only sensible ways to reduce the severity of this issue are:\n\u003C/p\u003E\n\u003Cul\u003E\u003Cli\u003E\nReduce the overall number of \u0022live\u0022 memory blocks. \u00A0Various parts of KSP (and mods) use significantly more memory (or more complex data structures) to represent things than is required. \u00A0E.g. the PartResource class is a simple class used to represent a resource in a part but it is derived from MonoBehaviour which is a complex Unity class that has many other reference members. \u00A0No base class would make this much simpler and would reduce the number of memory blocks used by loaded vessels considerably (and making it a struct instead along with some tweaks to the Part class would make it even better still).\u00A0 This would reduce the length of each pause but would have no direct effect on the frequency.\n\u003C/li\u003E\n\u003Cli\u003E\nReduce the amount of garbage being created, especially on a regular basis (e.g. in Update/FixedUpdate). \u00A0As stated before, the collection runs when the free space in the heap runs out. \u00A0If the game is allocating 10 MB/s then the free space in the heap will run out much sooner than if it were only allocating 10 KB/s and hence the collections would be happening much more often. \u00A0Reducing the amount of garbage created has the potential to reduce the collection frequency to such an extent that the collections could be triggered at times when the user is unlikely to notice the pause, e.g. switching to/from map view, pausing the game, etc. or to attribute it to something, e.g. run it after every\u00A0save and load.\n\u003C/li\u003E\n\u003C/ul\u003E\u003Cp\u003E\nUnity do recommend manually running the garbage collection at a high rate as a way of preventing this issue but, only in games where the total heap size is small (I seem to recall it mentions \u0026lt; 50 or 100 MB). \u00A0KSP uses several times this just getting to the main menu and the GC runs simply take too long to be deliberately triggering them during scenes.\n\u003C/p\u003E\n\u003Cp\u003E\nEven Unity upgrading the version of Mono used to a version that has a much more efficient garbage collector would not eliminate the problem though it should reduce the length of the pauses. \u00A0I have numerous saves where the memory allocation rate is constantly over 50 MB/s which results in the GC running every 2-3 seconds. \u00A0Even the latest version of Mono (or the very latest version of .NET)\u00A0would have problems collecting the garbage from that without causing any delays longer than a frame or two.\n\u003C/p\u003E\n\u003Cp\u003E\nEdit: one other thing, to eliminate the somewhat garbage happy GUILayout code in this mod I recommend you make sure the window is closed before evaluating the stutter.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-05-11T14:28:14Z\u0022 title=\u002205/11/2016 02:28  PM\u0022 data-short=\u00228 yr\u0022\u003EMay 11, 2016\u003C/time\u003E by Padishar\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"stk2008","CreatedById":162264,"CreatedDateTime":"2016-05-11T14:31:25Z","Content":"\n\u003Cp\u003E\nWow thats a details explanation.\n\u003C/p\u003E\n\u003Cp\u003E\nAlso I was in no way expecting the OP\u0060s program to fully fix the issue nor do I expect him to.\n\u003C/p\u003E\n\u003Cp\u003E\nwas just excited to see some one was dabbling with the possiblitys of such.\n\u003C/p\u003E\n\u003Cp\u003E\nAny way all we can do is prey and hope Squad or unity fix this...other than the GC issues the game runs good for me....untill I try to use an 800 part rocket that is \u003Cimg alt=\u0022:P\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif\u0022 title=\u0022:P\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2016-05-11T14:49:58Z","Content":"\n\u003Cp\u003E\nWell, it was worth trying. I don\u0027t have any stutter on my system so it is kinda hard to know how it will react.\n\u003C/p\u003E\n"},{"CreatedByName":"Padishar","CreatedById":97386,"CreatedDateTime":"2016-05-11T14:52:18Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222575151\u0022 data-ipsquote-contentid=\u0022139484\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221462978198\u0022 data-ipsquote-userid=\u002257146\u0022 data-ipsquote-username=\u0022sarbian\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nJust now, sarbian said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nWell, it was worth trying. I don\u0027t have any stutter on my system so it is kinda hard to know how it will react.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nCan you try loading the Platonic Stations save in my MemGraph thread and flying the KerbalX and then just holding down left cursor to rotate the view continuously?\u00A0 If you really can\u0027t see any stutter in that then I will be very surprised...\n\u003C/p\u003E\n"},{"CreatedByName":"LordAssault","CreatedById":162727,"CreatedDateTime":"2016-05-11T15:18:20Z","Content":"\n\u003Cp\u003E\nI\u0027m not expert at this, but there was something similar with mods for other game Cities Skylines it\u0027s using Unity 5 too. One of the modmakers did a great job with his own mod and posted solution here:\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://www.reddit.com/r/CitiesSkylinesModding/comments/2zk3ys/bordercities_2_edge_detection_done_right/cpjnweb\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://www.reddit.com/r/CitiesSkylinesModding/comments/2zk3ys/bordercities_2_edge_detection_done_right/cpjnweb\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nMaybe that will give you some ideas :/\n\u003C/p\u003E\n"},{"CreatedByName":"genericeventhandler","CreatedById":149557,"CreatedDateTime":"2016-05-11T15:49:28Z","Content":"\n\u003Cp\u003E\nHi,\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nForcing a garbage collect is a very brute force way of freeing up memory, but the whole .net stack will pause when you do it, so that\u0027s not what you want.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nSimple rules to follow,\u00A0\n\u003C/p\u003E\n\u003Cul\u003E\u003Cli\u003E\nAvoid huge arrays of objects, use arrays of\u00A0primative types instead.\u00A0\n\u003C/li\u003E\n\u003Cli\u003E\nDon\u0027t create List\u0026lt;T\u0026gt; before you use them, if a list is in memory for a long time, it skips the first (quick) garbage collect and goes straight to the slow jerky version\u00A0\n\u003C/li\u003E\n\u003Cli\u003E\nWhen you have done with an object set it to null as soon as possible, don\u0027t hold onto it if you don\u0027t need it, a method that takes 2 seconds to fall out of scope means that that object is in memory for 2seconds longer than needed and will probably be slow garbage collected.\n\u003C/li\u003E\n\u003Cli\u003E\nIf the object you are using supports IDisposeable wrap it in a using block to close and free it as fast as possible..\n\u003C/li\u003E\n\u003Cli\u003E\nIf you are using an IDisposeable interface, implement it correctly and call GC.SuppressFinalize(this) after you cleaned all references\n\u003C/li\u003E\n\u003Cli\u003E\nAvoid Statics,\u00A0\n\u003C/li\u003E\n\u003Cli\u003E\nSee previous rule\n\u003C/li\u003E\n\u003Cli\u003E\nSeriously avoid statics\n\u003C/li\u003E\n\u003C/ul\u003E\u003Cp\u003E\nGE.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222575100\u0022 data-ipsquote-contentid=\u0022139484\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221462976631\u0022 data-ipsquote-userid=\u002297386\u0022 data-ipsquote-username=\u0022Padishar\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n1 hour ago, Padishar said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nSo, the only sensible ways to reduce the severity of this issue are:\n\u003C/p\u003E\n\u003Cul\u003E\u003Cli\u003E\nReduce the overall number of \u0022live\u0022 memory blocks. \u00A0Various parts of KSP (and mods) use significantly more memory (or more complex data structures) to represent things than is required. \u00A0E.g. the PartResource class is a simple class used to represent a resource in a part but it is derived from MonoBehaviour which is a complex Unity class that has many other reference members. \u00A0No base class would make this much simpler and would reduce the number of memory blocks used by loaded vessels considerably (and making it a struct instead along with some tweaks to the Part class would make it even better still).\u00A0 This would reduce the length of each pause but would have no direct effect on the frequency.\n\u003C/li\u003E\n\u003Cli\u003E\nReduce the amount of garbage being created, especially on a regular basis (e.g. in Update/FixedUpdate). \u00A0As stated before, the collection runs when the free space in the heap runs out. \u00A0If the game is allocating 10 MB/s then the free space in the heap will run out much sooner than if it were only allocating 10 KB/s and hence the collections would be happening much more often. \u00A0Reducing the amount of garbage created has the potential to reduce the collection frequency to such an extent that the collections could be triggered at times when the user is unlikely to notice the pause, e.g. switching to/from map view, pausing the game, etc. or to attribute it to something, e.g. run it after every\u00A0save and load.\n\u003C/li\u003E\n\u003C/ul\u003E\u003C/div\u003E\n\u003C/blockquote\u003E\n"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2016-05-11T15:55:19Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222575280\u0022 data-ipsquote-contentid=\u0022139484\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221462981768\u0022 data-ipsquote-userid=\u0022149557\u0022 data-ipsquote-username=\u0022genericeventhandler\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n4 minutes ago, genericeventhandler said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nForcing a garbage collect is a very brute force way of freeing up memory, but the whole .net stack will pause when you do it, so that\u0027s not what you want.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nJust to be clear I know that calling the GC manually is an heresy but given the limited option we have with Unity I wanted to see if it helped for those with the problem.\n\u003C/p\u003E\n"},{"CreatedByName":"Padishar","CreatedById":97386,"CreatedDateTime":"2016-05-11T15:58:51Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222575216\u0022 data-ipsquote-contentid=\u0022139484\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221462979900\u0022 data-ipsquote-userid=\u0022162727\u0022 data-ipsquote-username=\u0022LordAssault\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n44 minutes ago, LordAssault said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nMaybe that will give you some ideas :/\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nIt appears to me that the mod in question was doing something incorrectly with shaders and materials causing a memory leak which he then fixed (and, by the look of it, not by a particularly sensible method). \u00A0Why is he creating and destroying a shader and material instance on every frame?\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222575280\u0022 data-ipsquote-contentid=\u0022139484\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221462981768\u0022 data-ipsquote-userid=\u0022149557\u0022 data-ipsquote-username=\u0022genericeventhandler\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n13 minutes ago, genericeventhandler said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nForcing a garbage collect is a very brute force way of freeing up memory, but the whole .net stack will pause when you do it, so that\u0027s not what you want.\u00A0\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nYes, but it isn\u0027t really about freeing up memory, it is more about splitting up the work required into smaller packages so the pauses they cause are less noticeable.\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222575280\u0022 data-ipsquote-contentid=\u0022139484\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221462981768\u0022 data-ipsquote-userid=\u0022149557\u0022 data-ipsquote-username=\u0022genericeventhandler\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n13 minutes ago, genericeventhandler said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nDon\u0027t create List\u0026lt;T\u0026gt; before you use them, if a list is in memory for a long time, it skips the first (quick) garbage collect and goes straight to the slow jerky version\u00A0\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThere is no \u0022first (quick)\u0022 garbage collect in the version of Mono used by Unity (as far as I am aware). \u00A0In fact, the only one of your points that really makes sense is the first one...\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-05-11T16:02:54Z\u0022 title=\u002205/11/2016 04:02  PM\u0022 data-short=\u00228 yr\u0022\u003EMay 11, 2016\u003C/time\u003E by Padishar\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"genericeventhandler","CreatedById":149557,"CreatedDateTime":"2016-05-11T16:17:27Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222575297\u0022 data-ipsquote-contentid=\u0022139484\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221462982331\u0022 data-ipsquote-userid=\u002297386\u0022 data-ipsquote-username=\u0022Padishar\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n16 minutes ago, Padishar said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nThere is no \u0022first (quick)\u0022 garbage collect in the version of Mono used by Unity (as far as I am aware). \u00A0In fact, the only one of your points that really makes sense is the first one...\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022http://www.mono-project.com/docs/advanced/garbage-collector/sgen/\u0022 rel=\u0022external nofollow\u0022\u003EMono garbage collection\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nYou need to aim all objects at what the article describes the \u0022Nursury\u0022 level 0 garbage collect, Nulling objects will qualify them for quick collect.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nGE\n\u003C/p\u003E\n"},{"CreatedByName":"Padishar","CreatedById":97386,"CreatedDateTime":"2016-05-11T16:19:09Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222575328\u0022 data-ipsquote-contentid=\u0022139484\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221462983447\u0022 data-ipsquote-userid=\u0022149557\u0022 data-ipsquote-username=\u0022genericeventhandler\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n1 minute ago, genericeventhandler said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022http://www.mono-project.com/docs/advanced/garbage-collector/sgen/\u0022 rel=\u0022external nofollow\u0022\u003EMono garbage collection\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nYou need to aim all objects at what the article describes the \u0022Nursury\u0022 level 0 garbage collect, Nulling objects will qualify them for quick collect.\u00A0\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThat article describes the generational collector in recent versions of Mono, not the collector in the old version of Mono that Unity uses...\n\u003C/p\u003E\n"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2016-05-11T16:31:18Z","Content":"\n\u003Cp\u003E\nTo be precise Unity uses the\u00A0Boehm GC. So if you have some magical trick to make it work please enlighten those who have been looking into it for month.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"Blacks","CreatedById":145137,"CreatedDateTime":"2016-05-11T16:34:12Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222575297\u0022 data-ipsquote-contentid=\u0022139484\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221462982331\u0022 data-ipsquote-userid=\u002297386\u0022 data-ipsquote-username=\u0022Padishar\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n28 minutes ago, Padishar said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nYes, but it isn\u0027t really about freeing up memory, it is more about splitting up the work required into smaller packages so the pauses they cause are less noticeable.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\no yees what result in better comunication between hardware \u0026amp; soft IF request are made proper, on a simple test lower Grumpy to 0.250 you will see straight / instant in MemGraph efect, then up rise to \u002B2 or more depend by each rig configuration agen effect it will be seen instant to MemGraph\n\u003C/p\u003E\n\u003Cp\u003E\nby the way GrumpyCollector \u002B MemGraph work perfect to see result how it goo \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"LordAssault","CreatedById":162727,"CreatedDateTime":"2016-05-11T17:05:53Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222575297\u0022 data-ipsquote-contentid=\u0022139484\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221462982331\u0022 data-ipsquote-userid=\u002297386\u0022 data-ipsquote-username=\u0022Padishar\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n42 minutes ago, Padishar said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nIt appears to me that the mod in question was doing something incorrectly with shaders and materials causing a memory leak which he then fixed (and, by the look of it, not by a particularly sensible method). \u00A0Why is he creating and destroying a shader and material instance on every frame?\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nHis mod had many options of changing shaders(as i can understand) \u003Ca href=\u0022http://steamcommunity.com/sharedfiles/filedetails/?id=410196151\u0026amp;searchtext=border\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://steamcommunity.com/sharedfiles/filedetails/?id=410196151\u003C/a\u003E It\u0027s easier to see, than explain.\n\u003C/p\u003E\n\u003Cp\u003E\nBut this isn\u0027t the only mod, which had this issue, every mod which worked with shaders was causing this leaks i remember at least 5 mods from 4 different authors with same issues. So i would blame Unity \u003Cimg alt=\u0022:P\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif\u0022 title=\u0022:P\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nI remember how you can diagnose this issue(because this doesn\u0027t make any exceptions) just install mod with custom shaders save game and reload it 5-10-20 times based on how heavy mod is, your framerate will drop for 1-60 fps.\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027m not a modmaker, neither programmer, just a mod user and maybe a beta tester, so i\u0027m not 100% sure that this will be helpful for KSP modmakers. :/\n\u003C/p\u003E\n\u003Cp\u003E\nP.S. I\u0027m not native English speaker, so i\u0027m sorry. \u003Cimg alt=\u0022:P\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif\u0022 title=\u0022:P\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Maars","CreatedById":125934,"CreatedDateTime":"2016-05-11T17:10:35Z","Content":"\n\u003Cp\u003E\nSarbian, thank you for thinking of the community and coming up with this experiment\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2016-05-11T17:22:51Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222575425\u0022 data-ipsquote-contentid=\u0022139484\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221462986353\u0022 data-ipsquote-userid=\u0022162727\u0022 data-ipsquote-username=\u0022LordAssault\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n12 minutes ago, LordAssault said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nSo i would blame Unity \u003Cimg alt=\u0022:P\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif\u0022 title=\u0022:P\u0022\u003E\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nI would blame bad mod code. The coder in that thread\u00A0clearly did not understand how Unity object works and that would not be an isolated case.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"Jansn67","CreatedById":158367,"CreatedDateTime":"2016-05-11T17:58:46Z","Content":"\n\u003Cp\u003E\nSarbian, thanks you very much for letting us experimenting with and initiation to make an amazing and hyperfun game \u0022betaR than evaR\u0022.\n\u003C/p\u003E\n\u003Cp\u003E\nTried GrumpyCollector with a copy of my 1.112-longtime-savegame (including around 90 mods).\n\u003C/p\u003E\n\u003Cp\u003E\nWant to tell my personal experience (Lubuntu 16.04, KSP64, Intel \u003Ca href=\u0022/cdn-cgi/l/email-protection\u0022 class=\u0022__cf_email__\u0022 data-cfemail=\u002282b6b5bbb2c9c2b6acb6c5caf8\u0022\u003E[email\u0026#160;protected]\u003C/a\u003E -\u0026gt; Hyper Threading off, nVidia 560TI, 32GB Ram@2400):\n\u003C/p\u003E\n\u003Cp\u003E\nIngame Time (upper left corner) runs faster, quite earth realtime, but stuttering feels unusual and strange.\n\u003C/p\u003E\n\u003Cp\u003E\nI tried settings 0.3, 1 and 5 in settings file. I started KSP with and without the wiki-Linux-Launcher-script.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nPS: i would say, also that \u0022hacking around\u0022 in cfgs, trying different mod mixtures, keep an installation cosy, makes that game so much \u0022fun\u0022 too.\n\u003C/p\u003E\n\u003Cp\u003E\nAnd yes, over the times and years, i learn/ed a lot of \u0022handling ksp\u0022 :-) (It sometimes really can be a.. \u0022poodley and uptight\u0022, specially heavy modded.)\n\u003C/p\u003E\n\u003Cp\u003E\nBut now, MINE actually runs really smooth.\n\u003C/p\u003E\n\u003Cp\u003E\nThanks again and keep up your important business. Without your participation KSP would never got so great how it is today.\n\u003C/p\u003E\n"}]}