{"TopicId":194533,"ForumId":32,"TopicTitle":"Help on KSP stock aerodynamic model","CreatedByName":"aerozine-50","CreatedById":205216,"CreatedDateTime":"2020-06-07T11:58:04Z","PageNum":1,"Articles":[{"CreatedByName":"aerozine-50","CreatedById":205216,"CreatedDateTime":"2020-06-07T11:58:04Z","Content":"\n\u003Cp\u003E\nHello,\u003Cbr\u003E\u003Cbr\u003E\nI\u0027ve been planning to write a program to optimize ascent profiles but without running KSP.\n\u003C/p\u003E\n\u003Cp\u003E\nMy idea is to write a genetic algrorithm, similar to the work of CheersKevin (\u003Ca href=\u0022https://youtu.be/IQP1nmYJLWE\u0022 rel=\u0022external nofollow\u0022\u003E[YT Link]),\u00A0 \u003C/a\u003Ebut it should simulate the dynamic equations without running KSP so the optimization can be faster. While KSP provides straightfoward modeling of the propulsion and masses, I can\u0027t wrap my head around the aerodynamics. In order to be able to properly simulate the aerodynamic forces, I need to model both drag (C\u003Csub\u003ED\u003C/sub\u003E) and lift (C\u003Csub\u003EL\u003C/sub\u003E)\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nFrom what I\u0027ve read it uses this \u0022cubedrag\u0022 modeling where each component has a drag area (C\u003Csub\u003Ed\u003C/sub\u003EA) for each direction. The full drag area is a weighted sum of all the faces depending on the relative wind. For instance in a 2D plane, if the relative wind is at 2 degrees of incidence you would have something like: C\u003Csub\u003Ed\u003C/sub\u003EA = C\u003Csub\u003Ed\u003C/sub\u003EA\u003Csub\u003Ex\u003C/sub\u003E cos(2\u00B0) \u002B C\u003Csub\u003Ed\u003C/sub\u003EA\u003Csub\u003Ey\u003C/sub\u003E sin(2\u00B0).\u003Cbr\u003E\nWhile this makes kinda sense, I am not sure if the game just accounts for the drag areas that are exposed to the air, or all of them (so including the opposite faces). This is important because in Physics.cfg you can find a set of curves used to correct the aerodynamic data, and some involve the drag areas of faces opposite of the flow.\u003Cbr\u003E\u003Cbr\u003E\nI\u0027ve tried to reverse-engineer the code in Kerbal Wind Tunnel mod to better understand the stock aerodynamics, but I\u0027m still confused.\u003Cbr\u003E\nIt would be very helpful if you could also explain me the lift model. While the drag data is in the parts file, I can\u0027t find anything about the lift data.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nThank you very much for your help.\n\u003C/p\u003E\n"},{"CreatedByName":"Cavscout74","CreatedById":181783,"CreatedDateTime":"2020-06-07T18:10:54Z","Content":"\n\u003Cp\u003E\nI\u0027m hardly an expert but as far as I am aware, exposed faces are calculated (including the opposite face) while ones covered by other parts (of the same size) are not.\u00A0 That is why have open nodes front or back are so bad when building spaceplanes.\n\u003C/p\u003E\n"},{"CreatedByName":"OHara","CreatedById":162784,"CreatedDateTime":"2020-06-08T07:35:09Z","Content":"\n\u003Cp\u003E\nThe Physics.cfg has \u0027LIFTING_SURFACE_CURVES\u0027 that give lift for the airfoils that use\u00A0ModuleLiftingSurface.\u00A0 The lift as a function of angle-of-attack is given by a table\u00A0of \u0027key\u0027s and KSP interpolates between them with piece-wise cubic polynomials.\u00A0 \u00A0The only relevant parameter for each part is the area of the wing, with the (inappropriate) name \u0027deflectionLiftCoeff\u0027 in each configuration file.\n\u003C/p\u003E\n\u003Cp\u003E\nThere is an introductory post about the aerodynamics model \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/107254-overhauls-for-10/page/4/\u0022 rel=\u0022\u0022\u003Ehere\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nI posted my reverse-engineering about how drag of parts combine, to give KSP\u0027s approximation to drag of the whole\u003Cbr\u003E\ncraft, \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/182616-the-drag-of-parts/\u0022 rel=\u0022\u0022\u003Ehere\u003C/a\u003E\n\u003C/p\u003E\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223798757\u0022 data-ipsquote-contentid=\u0022194533\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221591531084\u0022 data-ipsquote-userid=\u0022205216\u0022 data-ipsquote-username=\u0022aerozine-50\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n19 hours ago, aerozine-50 said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nyou would have something like: C\u003Csub\u003Ed\u003C/sub\u003EA = C\u003Csub\u003Ed\u003C/sub\u003EA\u003Csub\u003Ex\u003C/sub\u003E cos(2\u00B0) \u002B C\u003Csub\u003Ed\u003C/sub\u003EA\u003Csub\u003Ey\u003C/sub\u003E sin(2\u00B0).\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nKSP does this, but why did you expect a sine and not cos\u00B2(2\u00B0) and sin\u00B2(2\u00B0) ?\u00A0 I am wondering where KSP got that formula.\u00A0 The force on a face goes as the sine of the angle, yes, but there is another factor of the sine of the angle to take the component of that force in the direction that we call \u0027drag\u0027.\u00A0 The drag goes as sine-squared of the angle giving a nice smooth curve (in real life, though not in KSP).\n\u003C/p\u003E\n"},{"CreatedByName":"aerozine-50","CreatedById":205216,"CreatedDateTime":"2020-06-08T22:51:00Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223799178\u0022 data-ipsquote-contentid=\u0022194533\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221591601709\u0022 data-ipsquote-userid=\u0022162784\u0022 data-ipsquote-username=\u0022OHara\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n11 hours ago, OHara said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nI posted my reverse-engineering about how drag of parts combine, to give KSP\u0027s approximation to drag of the whole\u003Cbr\u003E\ncraft, \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/182616-the-drag-of-parts/\u0022 rel=\u0022\u0022\u003Ehere\u003C/a\u003E\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThank you very much for your help. I remember reading your post before making this thread. One thing I haven\u0027t understood well is if bodies in KSP generate lift too (like cylindrcal bodies of rockets).\u003Cbr\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223799178\u0022 data-ipsquote-contentid=\u0022194533\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221591601709\u0022 data-ipsquote-userid=\u0022162784\u0022 data-ipsquote-username=\u0022OHara\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n11 hours ago, OHara said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nKSP does this, but why did you expect a sine and not cos\u00B2(2\u00B0) and sin\u00B2(2\u00B0) ?\u00A0 I am wondering where KSP got that formula.\u00A0 The force on a face goes as the sine of the angle, yes, but there is another factor of the sine of the angle to take the component of that force in the direction that we call \u0027drag\u0027.\u00A0 The drag goes as sine-squared of the angle giving a nice smooth curve (in real life, though not in KSP).\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nI think there\u0027s a bit of confusion here, but you pointed out I, indeed, forgot the squared term.\u003Cbr\u003E\nI derived that formula from the one you wrote in your thread:\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nQuote\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nD = \u00BD \u03C1 ( V\u003Csub\u003Ex\u003C/sub\u003E\u00B2 A\u003Csub\u003Ex\u003C/sub\u003E C\u003Csub\u003Ed,x\u003C/sub\u003E \u002B V\u003Csub\u003Ey\u003C/sub\u003E\u00B2 A\u003Csub\u003Ey\u003C/sub\u003E C\u003Csub\u003Ed,y\u003C/sub\u003E \u002B V\u003Csub\u003Ez\u003C/sub\u003E\u00B2 A\u003Csub\u003Ez\u003C/sub\u003E C\u003Csub\u003Ed,z\u003C/sub\u003E )\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nIn a 2D plane you could rewrite that formula as (by looking at the image, assuming a dragcube with only \u002Bx and \u002By faces)\n\u003C/p\u003E\n\u003Cp\u003E\nD = \u00BD \u03C1 ( V\u00B2 cos\u003Csup\u003E2\u003C/sup\u003E(\u003Cspan\u003E\u003Cem\u003E\u03B1\u003C/em\u003E\u003C/span\u003E) A\u003Csub\u003Ex\u003C/sub\u003E C\u003Csub\u003Ed,x\u003C/sub\u003E \u002B V\u00B2 sin\u003Csup\u003E2\u003C/sup\u003E(\u003Cspan\u003E\u003Cem\u003E\u03B1\u003C/em\u003E\u003C/span\u003E) A\u003Csub\u003Ey\u003C/sub\u003E C\u003Csub\u003Ed,y\u003C/sub\u003E ) = \u00BD \u03C1 V\u00B2 (cos\u003Csup\u003E2\u003C/sup\u003E(\u003Cspan\u003E\u003Cem\u003E\u03B1\u003C/em\u003E\u003C/span\u003E) A\u003Csub\u003Ex\u003C/sub\u003E C\u003Csub\u003Ed,x\u003C/sub\u003E \u002B sin\u003Csup\u003E2\u003C/sup\u003E(\u003Cspan\u003E\u003Cem\u003E\u03B1\u003C/em\u003E\u003C/span\u003E) A\u003Csub\u003Ey\u003C/sub\u003E C\u003Csub\u003Ed,y\u003C/sub\u003E)\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u00226KKLDem.png\u0022 class=\u0022ipsImage\u0022 data-ratio=\u002255.52\u0022 height=\u0022166\u0022 width=\u0022299\u0022 src=\u0022https://i.imgur.com/6KKLDem.png\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nRegarding real life, in my aerodynamics course I never heard about a sine-squared tendency of C\u003Csub\u003Ed\u003C/sub\u003E with respect to angle of attack. For airfoils the behaviour is pseudo-polynomial, similar to x\u003Csup\u003E2\u003C/sup\u003E . For instance for the NACA 0015:\u003Cbr\u003E\u003Cimg alt=\u00220015.jpg\u0022 class=\u0022ipsImage\u0022 data-ratio=\u0022119.41\u0022 height=\u0022768\u0022 width=\u0022643\u0022 src=\u0022https://userpages.umbc.edu/~squire/images/0015.jpg\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nOther arifoils may have a low near-constant drag region (called laminar bucket) followed by a steep increase of drag outside of it.\u003Cbr\u003E\nWhile induced drag (which afaik is not modeled by stock aerodynamics, but Ferram does) is proportional to the square of the generated lift.\u003Cbr\u003E\u003Cbr\u003E\n\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"OHara","CreatedById":162784,"CreatedDateTime":"2020-06-09T05:35:56Z","Content":"\n\u003Cp\u003E\nKSP simulates body lift.\u00A0 There are additional lift vectors, in light blue, visible from the body of a rocket when you enable alt-F12-\u0026gt;physics-\u0026gt;aero-\u0026gt;aeroGui.\u00A0 \u00A0There is also a section \u0027name = bodyLift\u0027\u00A0\u00A0in Physics.cfg.\u00A0 \u00A0I never experimented to find exactly which parts have body lift applied, nor what surface-area is used.\n\u003C/p\u003E\n\u003Cp\u003E\nKSP does estimate the induced drag.\u00A0 You can see its value as \u0027L-I-D\u0027 (lift-induced drag) in the \u0027aero-Gui\u0027.\u00A0 \u00A0This appears to be proportional to the square of the \u003Cem\u003Etotal\u003C/em\u003E lift of the craft, so represents the energy lost to the wake of the whole craft.\u00A0 The amount of energy lost, and thus drag, depends on the wingspan of the craft, which KSP does not compute for any other reason.\u00A0 I remember concluding that KSP uses some approximation that is close to the theory for craft with wings with aspect ratio around 5.\u00A0 \u00A0Surely Boots has induced drag in his Kerbal-Wind-Tunnel mod, so he must have computed it or found the API function that returns the KSP\u0027s\u00A0computation.\n\u003C/p\u003E\n"},{"CreatedByName":"KerikBalm","CreatedById":91917,"CreatedDateTime":"2020-06-09T07:26:07Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223799772\u0022 data-ipsquote-contentid=\u0022194533\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221591680956\u0022 data-ipsquote-userid=\u0022162784\u0022 data-ipsquote-username=\u0022OHara\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n1 hour ago, OHara said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nThe amount of energy lost, and thus drag, depends on the wingspan of the craft, which KSP does not compute for any other reason.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nWait, so KSP does computer wingspan, and it does matter for aerodynamic drag or L/D?\n\u003C/p\u003E\n\u003Cp\u003E\nHigher wingspan = better in KSP?\n\u003C/p\u003E\n"},{"CreatedByName":"OHara","CreatedById":162784,"CreatedDateTime":"2020-06-10T16:11:14Z","Content":"\n\u003Cp\u003E\nNo, you would expect the lift-induced drag to depend on wingspan,\u003Cbr\u003E\n\u00A0 \u00A0 L-I-D\u00A0 =\u00A0 Lift\u00B2 /Q /\u03C0 /span\u00B2\u003Cbr\u003E\nwhere Q is the dynamic pressure, but KSP \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/107254-overhauls-for-10/\u0022 rel=\u0022\u0022\u003Edoes not consider the shapes of wings\u003C/a\u003E.\n\u003C/p\u003E\n\u003Cp\u003E\nIt looks like KSP uses the total \u003Cem\u003Earea\u003C/em\u003E\u00A0of the wing parts as a quantity that scales as length\u00B2.\u00A0 In a single wing\u00A0area = chord \u00D7 span,\u00A0 so if \u003Cspan style=\u0022background-color:#ffffff;color:#4d5156;font-size:14px;text-align:left;\u0022\u003E\u03B7 =\u00A0\u003C/span\u003Espan/chord is the aspect ratio of that wing, then span\u00B2 = \u003Cspan style=\u0022background-color:#ffffff;color:#4d5156;font-size:14px;text-align:left;\u0022\u003E\u03B7 \u00D7 area, so they could do\u003Cbr\u003E\n\u00A0 \u00A0\u00A0\u003C/span\u003E\u00A0 L-I-D\u00A0 =\u00A0 Lift\u00B2 /Q /\u03C0 /\u003Cspan style=\u0022background-color:#ffffff;color:#4d5156;font-size:14px;text-align:left;\u0022\u003E\u03B7\u003C/span\u003E /area\u003Cbr\u003E\nfor some estimated \u003Cspan style=\u0022background-color:#ffffff;color:#4d5156;font-size:14px;text-align:left;\u0022\u003E\u03B7,\u00A0\u003C/span\u003Eand then they can figure this type of drag for each individual wing component.\u00A0 \u00A0Experimentally, KSP does make this type of drag depend on Lift\u00B2 and Q and total wing-area in this way.\n\u003C/p\u003E\n\u003Cp\u003E\nLooking at L-I-D in the aero gui, KSP acts as if\u00A0\u003Cspan style=\u0022background-color:#ffffff;color:#4d5156;font-size:14px;text-align:left;\u0022\u003E\u03B7 is a function of the mach number, going from about 5 at low speed down to about 1 at mach-1.\u00A0 I can\u0027t find any aspect-ratio-versus-mach curves in the configuration files, though. The induced drag is only noticeable at low speed, parasitic drag dominates when you fly faster,\u00A0so I just say KSP uses an aspect ratio about 5 to estimate L-I-D whenever I might notice it.\u003C/span\u003E\n\u003C/p\u003E\n"},{"CreatedByName":"OHara","CreatedById":162784,"CreatedDateTime":"2020-06-10T16:25:39Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223799579\u0022 data-ipsquote-contentid=\u0022194533\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221591656660\u0022 data-ipsquote-userid=\u0022205216\u0022 data-ipsquote-username=\u0022aerozine-50\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nOn 6/8/2020 at 3:51 PM, aerozine-50 said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nRegarding real life, in my aerodynamics course I never heard about a sine-squared tendency of C\u003Csub\u003Ed\u003C/sub\u003E with respect to angle of attack. For airfoils the behaviour is pseudo-polynomial, similar to x\u003Csup\u003E2\u003C/sup\u003E\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nMy thinking here is that \u0027x\u0027 is proportional to the angle of attack \u03B8 for small angles, as is sin \u03B8.\u00A0 \u00A0Wings can have a very flat drag bucket in C\u003Csub\u003Ed\u003C/sub\u003E versus \u03B8,\u00A0 or a parabolic \u03B8\u00B2 shape like the NACA airfoil you showed.\u00A0 \u00A0KSP\u0027s physics.cfg has curves that look parabolic for small angles, and KSP uses\u00A0sin \u03B8 as the independent variable here.\n\u003C/p\u003E\n\u003Cp\u003E\nI\u00A0would expect other parts to also have drag that goes roughly as x\u00B2 or \u03B8\u00B2 or sin\u00B2\u03B8 for small deviations from the cardinal directions.\u00A0 For large angles, a simple sin\u00B2\u03B8 is reasonable, is written very simply in terms of componenets, and transitions naturally into the drag for the other cardinal directions.\n\u003C/p\u003E\n\u003Cp\u003E\nThe v-shaped drag curves we see for fuselage parts seems to be a mistake in KSP, which makes mk2 fuselages very draggy unless we fly them strictly prograde.\u00A0 I suppose you will need to replicate this mistake to write your optimizer -- unless the optimal ascents always have zero angle of attack.\u00A0\n\u003C/p\u003E\n"}]}