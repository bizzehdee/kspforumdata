{"TopicId":110075,"ForumId":32,"TopicTitle":"Memory leak \u0026 Memory cap Crash to desktop workarounds","CreatedByName":"Samlow","CreatedById":144473,"CreatedDateTime":"2015-05-20T07:59:38Z","PageNum":1,"Articles":[{"CreatedByName":"Samlow","CreatedById":144473,"CreatedDateTime":"2015-05-20T07:59:38Z","Content":"So in another thread I posted a concrete sollution to the current memory leak with temperature gauges. Since that thread was indeed a troll/whine thread, the fix probably deserves its own thread, and possibly a temporary sticky till its fixed.\n\n**The Problem**\n\nThe problem stems from multiple causes.\n\n- KSP 32 Bit has a memory limit of\u002B-3.8 gigabytes of ram\n\nThis is a lmitation of 32 Bit programs.\n\nKSP stock comes in at \u002B-3.0 gigabytes of ram\n\n- There is a memory leak involving temperature gauges\n\nWhich will slowly but steadily increase the allocated ram while you play.\n\nWhilst the game itself plays stable, after a while (depending on your play session lenght) you will inevatibly crash to desktop. The error log will tell you that the game was not allowed to write to memory.\n\n**Plug that leak**\n\nSimple! Install the Temperature Gauge Killer\n\n[https://kerbalstuff.com/mod/775/Temperature%20Gauge%20Killer](https://kerbalstuff.com/mod/775/Temperature%20Gauge%20Killer)\n\nThis greatly reduces the rate at which KSP builds up RAM usage.\n\nAs sal\\_vagar pointed out as well, another way to fix this is by turning PPFX edge highlighting off (haven\u0027t tested this myself)\n\n**But Samlow! With mods I already start at 3.7 gigabytes!**\n\nJust like I did. Basically, if you play heavily modded (for an interstellar experience for example) you will be close to max ram usage even with the memory leak greatly reduced.\n\nThe sollution to this is to run the game in OpenGL. Yes, it will reduce your eye candy a bit, and doesn\u0027t like alt tabbing as much as windowed DirectX.\n\nPlease note, OpenGL is not the native running environment of Unity (the KSP game engine). \n\nTo run the game in OpenGL:\n\n1 - Create a shortcut to KSP\n\n2 - Open the shortcut properties\n\n3 - add -force-opengl to the target line, all the way at the end, behind the bracket.\n\nYour Target will end like this now:\n\n    KSP.exe\u0022 -force-opengl\n\n**But Samlow! Now its not as pretty and I dont have smooth edges!**\n\nWell, thats a result of the OpenGL render not having the high end settings that Direct X does. \n\nThe way to work around this is pretty simple too.\n\n1 - Open your graphics driver software (Catalyst / Nvidia software)\n\n2 - Find whatever tab controlls 3D program / game settings\n\n3 - Add KSP to the list of custom settings\n\n4 - Tweak the settings to be nice! (especialy Anti-Aliasing maxes a difference)\n\nAnd youre done. The OpenGL version of KSP runs stock at about 2 Gigabyte of RAM, giving you a whole 1.8 Gigs of headroom before it will crash to the memory leak. Youd have to keep the game running for a day or two to do this. If you run modded, the game will not crash after 30 minutes anymore (unless you got buggy addons).\n\n**Edited \u003Ctime datetime=\u00222015-05-20T08:24:04Z\u0022 title=\u002205/20/2015 08:24  AM\u0022 data-short=\u00229 yr\u0022\u003EMay 20, 2015\u003C/time\u003E by Samlow**\n  \nTitle reflecting actual content now"},{"CreatedByName":"sal_vager","CreatedById":16426,"CreatedDateTime":"2015-05-20T08:08:41Z","Content":"This is nice Samlow, [**but turning off the PPFX edge highlighting will stop the leak too**](https://forum.kerbalspaceprogram.com/threads/118658-New-Heat-System-causes-memory-leak?p=1938584\u0026viewfull=1#post1938584), and leaves you with a visual indication that you\u0027re getting hot before you blow up ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\nAlso, [**-force-opengl is an unsupported Unity3D game engine command**](http://docs.unity3d.com/Manual/CommandLineArguments.html) which [**many players have found to be broken in the latest Unity4x release**](https://forum.kerbalspaceprogram.com/threads/117307-OpenGL-Mode-Doesn-t-Work), so it is not recommended.\n\nSome players have more luck with -force-d3d11 but expect weirdness.\n\n**Edited \u003Ctime datetime=\u00222015-05-20T08:11:08Z\u0022 title=\u002205/20/2015 08:11  AM\u0022 data-short=\u00229 yr\u0022\u003EMay 20, 2015\u003C/time\u003E by sal\\_vager**"},{"CreatedByName":"Samlow","CreatedById":144473,"CreatedDateTime":"2015-05-20T08:18:28Z","Content":"Thanks for that PPFX link, that will help a lot too!\n\nBut for me Im already running close to CTD due to heavy mod usage, so Im kind of forced into OpenGL. I have tried the d3d11 force as well, but that doesnt reduce memory load. Ill slightly adjust the title to reflect your suggestions!"},{"CreatedByName":"KerbMav","CreatedById":70338,"CreatedDateTime":"2015-05-20T10:21:51Z","Content":"It might not look as good as before - although I have yet to compare screenshots, did not care just yet - but reducing the texture quality (correct text in the settings menu eludes me right now) by one step brought my game from 3.2GB at start (!) to 1.9GB and only climbing to 2.5GB after hours of playing.\n\n(Using TemperatureGageKiller for now, but will try PPFX off today.)\n\nStill, 3.2GB without that many part/beauty mods (KSPX, KAS, IR, USI LS, couple Kerbal heads, three suits, a simple galaxy and a new Kerbin texture, EVE, HotRockets) still frightens me!"},{"CreatedByName":"Gkirmathal","CreatedById":135480,"CreatedDateTime":"2015-05-20T10:38:53Z","Content":"Thanks for the workaround OP!\n\nBut to be honest...in my opinion, a version 1.0 release hould never ever have had such a major issue with memory consumption/leakage! This should have been rammed out in a beta/alpha stage. But hell us spewing this on the forums was like preaching to the choire or talking to a wall."},{"CreatedByName":"ToddEth","CreatedById":141196,"CreatedDateTime":"2015-05-20T10:49:22Z","Content":"\u003E \n\u003E Thanks for the workaround OP!\n\u003E But to be honest...in my opinion, a version 1.0 release hould never ever have had such a major issue with memory consumption/leakage! This should have been rammed out in a beta/alpha stage. But hell us spewing this on the forums was like preaching to the choire or talking to a wall.\n\n1.0.x is what it is. There are solutions like the above or move to Linux and install more ram. The more people whine about what should of been and what should not have been unless you are develop of the game in question."},{"CreatedByName":"Gkirmathal","CreatedById":135480,"CreatedDateTime":"2015-05-20T11:39:43Z","Content":"To be helpful, rather than bitter (excuses for thah! ![;)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif) ), could this very helpful topic by the OP be stickied by a moderator?\n\nThis will will help a lot of players who run into this issue and do not know that this is causing it or how to fix it.\n\n\u003E \n\u003E 1.0.x is what it is. There are solutions like the above or move to Linux and install more ram. The more people whine about what should of been and what should not have been unless you are develop of the game in question.\n\nOff topic: we, and you sir ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif), are entitled to voice our own opinions, wheter they are harse, whiny, bitter or sweet ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\n**Edited \u003Ctime datetime=\u00222015-05-20T12:38:15Z\u0022 title=\u002205/20/2015 12:38  PM\u0022 data-short=\u00229 yr\u0022\u003EMay 20, 2015\u003C/time\u003E by Gkirmathal**\n  \nto end positively"},{"CreatedByName":"xtoro","CreatedById":79015,"CreatedDateTime":"2015-05-20T14:08:56Z","Content":"\u003E \n\u003E 1.0.x is what it is. There are solutions like the above or move to Linux and install more ram. The more people whine about what should of been and what should not have been unless you are develop of the game in question.\n\nI strongly disagree with you, but partially agree. I agree that people shouldn\u0027t whine about features like the new aero, it\u0027s just game advancement. However, as a programmer myself, I think 1.0 was released too early. And as paying customers, it\u0027s expected that an out-of-beta 1.0 release be generally bug-free. A memory leak is a huge problem that should have been found during a testing period.\n\nAnd while on the subject of memory issues; A 32-bit program that is limited by its own memory limitation should have much better memory management, especially since it\u0027s so easy to build huge ships that can bloat the address space available using only the stock game. Unloading unused objects out of memory, compression, loading on demand and disk caching methods should all be heavily used in order to avoid this problem. \n\nI personally use the 64-bit Linux version, but I\u0027ve been trying to use the Windows version because I expected it to be much more stable. Throwing workarounds at the game, and disabling things should not be a solution for a full release. Just like forcing someone to install Linux in order to play crash-free is also not a solution as some people just aren\u0027t that computer savvy, or they don\u0027t have the disk space, or whatever. I have suggested that people install Linux in the past, but again, that\u0027s not a solution, it\u0027s a workaround.\n\nLike I said before, paying customers have every right to complain about an out-of-beta full version game that\u0027s still not stable. As for the previous Alpha and Beta versions, bugs were to be expected, that\u0027s why they were in Alpha and Beta, so there was nothing to complain about because you knew what you were downloading and paying for. Squad should have continued on with Beta versions 0.91, 0.92 etc until stability and memory issues were at least in the high 99%-ish range of fixes.\n\nIf a game developer wants to be in the business, they need to take care of their product. What do you think would happen if another big game dev came out with the next Halo, or Call of Duty or whatever and it kept crashing?\n\n**Edited \u003Ctime datetime=\u00222015-05-20T14:37:12Z\u0022 title=\u002205/20/2015 02:37  PM\u0022 data-short=\u00229 yr\u0022\u003EMay 20, 2015\u003C/time\u003E by xtoro**"},{"CreatedByName":"Arsonik","CreatedById":79705,"CreatedDateTime":"2015-05-20T14:42:50Z","Content":"\u003E \n\u003E What do you think would happen if another big game dev came out with the next Halo, or Call of Duty or whatever and it kept crashing?\n\nCharge you $25 for DLC that fixes it. Or make you wait until it is fixed in Call of Duty 15 Modern Warfare 7 Ultimate DLC Bundle Pack"},{"CreatedByName":"OddFunction","CreatedById":143805,"CreatedDateTime":"2015-05-20T15:04:20Z","Content":"Eh. I feel like people have selective memory. So many major games have issues when they are released, you can never really cover every hypothetical situation without a truly stupid number of testers. It\u0027s very easy to look at a finished game and be critical of its flaws, yes, but can we at least admit that its practically impossible to code a game that will satisfy everybody? \n\nGames that were released broken:\n\nHalo 2 - Too many glitches to name. Some of those glitches turned out to be an instrumental part of gameplay.\n\nBattlefield 4 - Crashed the game more times than I crashed a helicopter, for weeks and even months into the release\n\nSkyrim \u0026 Oblivion - Need I say more ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\nFallout New Vegas - This is Oblivion level glitching. Falling through the surface of the planet? That\u0027s one of the nicer glitches.\n\nRed Dead Redemption - 10/10 Horse Physics, 2/10 bugtesting\n\nand thats just off the top of my head. How many of those games went on to become game of the year? Game of MULTIPLE years?\n\nPatch 1.1 will come to fix the temp gauges if we\u0027re patient. Then we\u0027ll get Unity 5 for 64bit, multiplayer to spice things up, and hopefully a contract system that makes sense. Until then, workaround and carry on ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\n**Edited \u003Ctime datetime=\u00222015-05-20T15:15:00Z\u0022 title=\u002205/20/2015 03:15  PM\u0022 data-short=\u00229 yr\u0022\u003EMay 20, 2015\u003C/time\u003E by OddFunction**"},{"CreatedByName":"match","CreatedById":91708,"CreatedDateTime":"2015-05-20T15:16:30Z","Content":"I hope the leak is plugged rather than the feature (temperature gauges) killed. I rather like monitoring the dissipation of heat. The feedback during re-entry is welcome and thought provoking."},{"CreatedByName":"xtoro","CreatedById":79015,"CreatedDateTime":"2015-05-20T15:23:49Z","Content":"For the record, I\u0027m not bashing KSP for having bugs, I\u0027m saying it wasn\u0027t ready to be out of Beta yet. A memory leak is a huge problem that\u0027s easy to detect and should definitely be sought out in a program that already has \u0022out of memory\u0022 crashes several versions back."},{"CreatedByName":"OddFunction","CreatedById":143805,"CreatedDateTime":"2015-05-20T15:28:07Z","Content":"\u003E \n\u003E For the record, I\u0027m not bashing KSP for having bugs, I\u0027m saying it wasn\u0027t ready to be out of Beta yet. A memory leak is a huge problem that\u0027s easy to detect and should definitely be sought out in a program that already has \u0022out of memory\u0022 crashes several versions back.\n\nYou didn\u0027t come across as bashing to me. Your post looked thought out and your points are all valid. I just prefer to remain stupidly optimistic until I get obviously burned, and with SQUAD at least its worked out so far ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\nEdit: Super early in the morning here so sorry if I screwed up the thread lol"},{"CreatedByName":"Terwin","CreatedById":139655,"CreatedDateTime":"2015-05-20T16:11:54Z","Content":"\u003E \n\u003E For the record, I\u0027m not bashing KSP for having bugs, I\u0027m saying it wasn\u0027t ready to be out of Beta yet. A memory leak is a huge problem that\u0027s easy to detect and should definitely be sought out in a program that already has \u0022out of memory\u0022 crashes several versions back.\n\nAs the primary memory leak that I am aware of(heat bars) was not in the 1.0 release, but in a later release, it does not seem fair to use that particular memory leak as an indicator that 1.0 was ready or not.\n\nAny time you add features, there is a risk of unforeseen problems, and as this added feature has a work-around(it can be disabled), and they had limited time before a planned code-freeze(aka the few days off to celebrate 1.0), I do not have a problem with the much-demanded feature being added, or that other, non-toggleable features might have received a greater portion of the available testing time.\n\nSure I have had my games crash from time to time(last night just after landing for example), but this is because I consider this feature more useful than the bother of re-loading the game.\n\n(on the other hand, I have strongly considered removing a few mods, and possibly even using the \u0027unsupported\u0027 OpenGL flag to reduce memory usage)"},{"CreatedByName":"xtoro","CreatedById":79015,"CreatedDateTime":"2015-05-20T16:57:22Z","Content":"\u003E \n\u003E As the primary memory leak that I am aware of(heat bars) was not in the 1.0 release, but in a later release, it does not seem fair to use that particular memory leak as an indicator that 1.0 was ready or not.\n\u003E Any time you add features, there is a risk of unforeseen problems, and as this added feature has a work-around(it can be disabled), and they had limited time before a planned code-freeze(aka the few days off to celebrate 1.0), I do not have a problem with the much-demanded feature being added, or that other, non-toggleable features might have received a greater portion of the available testing time.\n\u003E \n\u003E Sure I have had my games crash from time to time(last night just after landing for example), but this is because I consider this feature more useful than the bother of re-loading the game.\n\u003E \n\u003E (on the other hand, I have strongly considered removing a few mods, and possibly even using the \u0027unsupported\u0027 OpenGL flag to reduce memory usage)\n\nThere are other memory management issues other than the temp gauge memory leak.\n\nFor example, here\u0027s my usage (number in megabytes of RAM KSP is using):\n\n1-Load the game : 1463\n\n2-Load my save : 1630\n\n3-Return to main menu : 1575 (why not the same as #1?)\n\n4-Load save, go to SPH, load 95 part ship : 1795\n\n5-Launch, revert to SPH, clear SPH (press new button), return to Space Center : 1838\n\n6-Back to SPH, load same ship : 1880 (Why not same as #4?)\n\n7-Launch, revert to SPH, clear SPH (press new button), return to Space Center : 1918 (Why not same as #5?)\n\n8-Return to main menu : 1850 (Even more than #1 and #3, why?)\n\nAs you can see, the memory space is not being cleaned up. #1,3 and 8 should be much closer to the same memory usage. As well, 4 and 6 should be the same, and 5 and 7 should be the same. This may seem like small increments but they keep going up and up every time. Same goes with switching ships back and forth; the RAM usage keeps going up, so things aren\u0027t being cleaned up properly.\n\nAnother issue that I mentioned before is something as simple as [Active Texture Management](https://forum.kerbalspaceprogram.com/threads/59005-1-0-Release-5-0-April-28-2015-Active-Texture-Management-Save-RAM!). It\u0027s a mod that compresses the textures used by the game. ATM has been around for a while and does a great job of reducing RAM usage simply by compressing the images. Why hasn\u0027t this been implemented yet into the stock game? There\u0027s still lots of very basic memory management and optimization methods that have yet to be implemented that would make the game more stable."},{"CreatedByName":"Samlow","CreatedById":144473,"CreatedDateTime":"2015-05-21T08:45:31Z","Content":"Im actually using Active texture management as well, and that still put me with just 200 mb headroom in directX, as I said, I run a lot of mods.\n\nIt is a good place to start if you\u0027re using a lot of parts mods though."},{"CreatedByName":"selfish_meme","CreatedById":125899,"CreatedDateTime":"2015-05-21T08:53:21Z","Content":"Squad adopted Sarbians DSS loader method that is even better than Active Texture Management, thats why the 1.\u002B versions of KSP are so much better on the memory front. I don\u0027t even know if ATM would do anything anymore on the stock game."},{"CreatedByName":"Murph","CreatedById":90837,"CreatedDateTime":"2015-05-21T09:03:05Z","Content":"\u003E \n\u003E As you can see, the memory space is not being cleaned up. #1,3 and 8 should be much closer to the same memory usage. As well, 4 and 6 should be the same, and 5 and 7 should be the same. This may seem like small increments but they keep going up and up every time. Same goes with switching ships back and forth; the RAM usage keeps going up, so things aren\u0027t being cleaned up properly.\n\nProcess memory usage isn\u0027t quite as simple as that. When the application code frees memory (or it is garbage collected due to having reached a 0 reference count), it is not necessarily returned to the OS. The first step is that it is returned to the application\u0027s \u0022free list\u0022 (often much more complex than a simple single free list these days, with several pools for different size allocations). The application\u0027s memory management will only return memory to the OS in certain circumstances, otherwise it will keep the OS allocation and reuse it when it next needs memory for something. Also, with a language that uses garbage collection, the collection is not instant on every unload. Bottom line, while sustained growth over time probably is a memory leak, some of your observations may not be indicative of a memory leak, since you\u0027re using the OS allocation, not the application\u0027s internal memory allocator to measure it.\n\n(load X; unload X) is not expected to necessarily return to the OS memory usage before X was loaded.\n\n(for (i = 0; i \u003C 1000; i\u002B\u002B) { load X; unload X; }) OS memory usage with X loaded should not grow with every iteration of the loop, significant repeated growth on every iteration indicates a possible memory leak, but it doesn\u0027t necessarily follow that the memory usage should be exactly flat over every iteration of the loop, as things like fragmentation of the free memory may require the application\u0027s allocator to request more memory from the OS to make a suitable size block available for an object (despite the application overall having sufficient free memory for the object)."},{"CreatedByName":"Jarin","CreatedById":71395,"CreatedDateTime":"2015-05-21T19:42:47Z","Content":"\u003E \n\u003E Eh. I feel like people have selective memory. So many major games have issues when they are released, you can never really cover every hypothetical situation without a truly stupid number of testers. It\u0027s very easy to look at a finished game and be critical of its flaws, yes, but can we at least admit that its practically impossible to code a game that will satisfy everybody? \n\u003E Games that were released broken:\n\u003E \n\u003E Halo 2 - Too many glitches to name. Some of those glitches turned out to be an instrumental part of gameplay.\n\u003E \n\u003E Battlefield 4 - Crashed the game more times than I crashed a helicopter, for weeks and even months into the release\n\u003E \n\u003E Skyrim \u0026 Oblivion - Need I say more ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\u003E \n\u003E Fallout New Vegas - This is Oblivion level glitching. Falling through the surface of the planet? That\u0027s one of the nicer glitches.\n\u003E \n\u003E Red Dead Redemption - 10/10 Horse Physics, 2/10 bugtesting\n\nGames that release full of bees happen fairly often... but those games also get called out on it (and die horribly if it\u0027s bad enough; see: Assassin\u0027s Creed: Unity). It doesn\u0027t usually make them bad games overall, but it IS bad development practices. I love KSP. I\u0027ll still call out problems like this. I\u0027m hoping 1.0.3 will fix this next week."},{"CreatedByName":"kurdain","CreatedById":154984,"CreatedDateTime":"2016-01-12T18:00:09Z","Content":"I\u0027d pay $5 or $10 for a 64-bit DLC that also included some new parts and visual enhancements...."},{"CreatedByName":"DoctorDavinci","CreatedById":150019,"CreatedDateTime":"2016-01-12T19:53:45Z","Content":"\u003E \n\u003E \n\u003E On 2015-05-20 at 10:42 AM, Arsonik said:\n\u003E \n\u003E \n\u003E Charge you $25 for DLC that fixes it. Or make you wait until it is fixed in Call of Duty 15 Modern Warfare 7 Ultimate DLC Bundle Pack\n\u003E \n\nExactly\n\nLet alone, show me a game that hasn\u0027t been released with bugs in the past few years"},{"CreatedByName":"godefroi","CreatedById":101728,"CreatedDateTime":"2016-01-12T20:00:26Z","Content":"Please close this necro, the thread topic itself is no longer useful."},{"CreatedByName":"sal_vager","CreatedById":16426,"CreatedDateTime":"2016-01-12T20:06:18Z","Content":"Closing as this bug was fixed quite a while ago."}]}