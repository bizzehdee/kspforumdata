{"TopicId":85966,"ForumId":36,"TopicTitle":"[WIP] KSPPluginReload, reload plugins without rebooting","CreatedByName":"m1nd0","CreatedById":69328,"CreatedDateTime":"2014-10-03T11:15:14Z","PageNum":1,"Articles":[{"CreatedByName":"m1nd0","CreatedById":69328,"CreatedDateTime":"2014-10-03T11:15:14Z","Content":"\n\u003Cp\u003EI started developing KSP this week and one of the things I hated most about it was rebooting KSP constantly.\u003C/p\u003E\u003Cp\u003ESo before I actually developed a plugin I developed a plugin-reloader.\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003EDescription\u003C/strong\u003E\u003C/p\u003E\u003Cp\u003EThis tool allows you to reload plugins without the need for restarting KSP. \u003C/p\u003E\u003Cp\u003EThere are some downsides:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cul\u003E\u003Cli\u003EOnly classes which inherit MonoBehaviour and include the attribute KSPAddon will be reloaded. Parts \u0026amp; partmodules will not be reloaded.\u003Cbr\u003E\u003C/li\u003E\u003Cli\u003ECustom parts and partmodules won\u0027t work when loading a DLL with this (see note1)\u003Cbr\u003E\u003C/li\u003E\u003Cli\u003EOnly use this for developing/debugging. Since KSP doesn\u0027t allow AppDomains each reload loads a second instance of the plugin, therefore increasing the memory usage.\u003Cbr\u003E\u003C/li\u003E\u003C/ul\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EBut even without part reloading, my development speed is now over 9000.\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003EInstallation\u003C/strong\u003E\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Col style=\u0022list-style-type:decimal;\u0022\u003E\u003Cli\u003Edownload latest build or build from source and extract to ksp directory\u003Cbr\u003E\u003C/li\u003E\u003Cli\u003Eremove your plugin.dll from \\GameData\\YourPlugins\\plugins\\ (see note1, bottom of this page for part \u0026amp; partmodule code)\u003Cbr\u003E\u003C/li\u003E\u003Cli\u003Eedit Settings.cfg in \u0022\\GameData\\PluginReload\u0022.\u003Cbr\u003E\u003C/li\u003E\u003Cli\u003Eopen AssemblyInfo.cs in your project and change AssemblyVersion \u0026amp; AssemblyFileVersion to \u00221.0.0.*\u0022. Visual Studio will auto-increment your build, this is the only way to allow reloading of a DLL.\u003Cbr\u003E\u003C/li\u003E\u003C/ol\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003EUsage\u003C/strong\u003E\u003C/p\u003E\u003Cp\u003ELaunch your game. Test something. Rebuild the dll, press Reload plugins to reload plugins. ALT\u002BP opens/closes the rebuild menu.\u003C/p\u003E\u003Cp\u003EExample of settings.cfg\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003EPluginSetting\u003Cbr\u003E{\u003Cbr\u003E    name = Myplugginname\u003Cbr\u003E    path = C:\\develop\\myplugin\\debug\\myplugin.dll\u003Cbr\u003E    loadOnce = false\u003Cbr\u003E    methodsAllowedToFail = false\u003Cbr\u003E}\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003EKnown issues\u003C/strong\u003E\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cul\u003E\u003Cli\u003EIf your mod uses KSPAddon.Startup.PSystemSpawn this may issues since the solar system is already created at reload. (untested)\u003Cbr\u003E\u003C/li\u003E\u003Cli\u003EProbably more\u003Cbr\u003E\u003C/li\u003E\u003C/ul\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003ECredits\u003C/strong\u003E\u003C/p\u003E\u003Cp\u003EEzriilc (\u003Ca href=\u0022http://www.kerbaltekaerospace.com/\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://www.kerbaltekaerospace.com/\u003C/a\u003E). Used hyperedit GUI code as base for GUI.\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003ETerms of Use\u003C/strong\u003E\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022http://creativecommons.org/licenses/by-nc-sa/3.0/\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://creativecommons.org/licenses/by-nc-sa/3.0/\u003C/a\u003E\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003EDownload\u003C/strong\u003E\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022http://tawot.com/KSPPluginReload.zip\u0022 rel=\u0022external nofollow\u0022\u003EBinaries\u003C/a\u003E\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022https://github.com/m1ndst0rm/KSPPluginReload\u0022 rel=\u0022external nofollow\u0022\u003EGithub\u003C/a\u003E\u003C/p\u003E\u003Cp\u003ENote1:\u003C/p\u003E\u003Cp\u003EYou can leave your plugin in \\GameData\\ if you need your parts/partmodules in your code. However you MUST put your parts and modules inside a different DLL which loads them. If you place any code that launches (KSPAddon) it won\u0027t be unloaded when all plugins are reloaded, and you will wind up with duplicated code being executing.\u003C/p\u003E\u003Cp\u003ESo far I\u0027ve only testes this with my own plugin and hyperedit. If you experience issues please use github or this forum to report bugs.\u003C/p\u003E\n"},{"CreatedByName":"nli2work","CreatedById":106805,"CreatedDateTime":"2014-10-03T12:05:18Z","Content":"\n\u003Cp\u003EALT-F12 will bring up Squad\u0027s debug panel that reloads game database; ModuleManager also includes improved reloader since 2.3.x. ALT-F11.\u003C/p\u003E\n"},{"CreatedByName":"wasmic","CreatedById":64885,"CreatedDateTime":"2014-10-03T12:14:22Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022nli2work\u0022 data-cite=\u0022nli2work\u0022\u003E\u003Cdiv\u003EALT-F12 will bring up Squad\u0027s debug panel that reloads game database; ModuleManager also includes improved reloader since 2.3.x. ALT-F11.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EBut it can\u0027t reload plugins. Until now, you\u0027d have to restart KSP t reload the plugins.\u003C/p\u003E\n"},{"CreatedByName":"Gaalidas","CreatedById":111158,"CreatedDateTime":"2014-10-03T12:18:39Z","Content":"\n\u003Cp\u003EWell, it\u0027s a start anyway. This is an annoyance for me as well.\u003C/p\u003E\n"},{"CreatedByName":"nli2work","CreatedById":106805,"CreatedDateTime":"2014-10-03T12:20:24Z","Content":"\n\u003Cp\u003EModuleManager reloads plugins I think. I could be mistaken.\u003C/p\u003E\n"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2014-10-03T12:43:08Z","Content":"\n\u003Cp\u003EThe plugin are reloaded but since you can\u0027t replace the dll while they are opened (on Windows) it does not help much.\u003C/p\u003E\n"},{"CreatedByName":"m1nd0","CreatedById":69328,"CreatedDateTime":"2014-10-03T13:12:00Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022sarbian\u0022 data-cite=\u0022sarbian\u0022\u003E\u003Cdiv\u003EThe plugin are reloaded but since you can\u0027t replace the dll while they are opened (on Windows) it does not help much.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThey don\u0027t reload dlls. And even if they did they actually don\u0027t use different AppDomains for loading assemblies this means:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cul\u003E\u003Cli\u003EThe current assembly will not unload\u003Cbr\u003E\u003C/li\u003E\u003Cli\u003ECreated classes won\u0027t be destroyed and will keep running (duplicated code)\u003Cbr\u003E\u003C/li\u003E\u003C/ul\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EEven if they were to replace their current method:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003EAssembly.LoadFrom(this.path);\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003Eby a version which would not lock the file (for example):\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003EAssembly.Load(File.ReadBytes(this.path));\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EThe new DLL would still not be used for parts and code because the current domain still has the old dll reference.\u003C/p\u003E\n"},{"CreatedByName":"nli2work","CreatedById":106805,"CreatedDateTime":"2014-10-03T13:20:22Z","Content":"\n\u003Cp\u003EI see. my mistake. Thanks for the clarification!\u003C/p\u003E\n"}]}