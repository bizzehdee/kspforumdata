{"TopicId":102712,"ForumId":36,"TopicTitle":"[WIP] MSI\u0027s Infernal Robotics - Plugin Rework (Updated: 05/04/2015)","CreatedByName":"erendrake","CreatedById":57164,"CreatedDateTime":"2015-03-26T04:27:56Z","PageNum":5,"Articles":[{"CreatedByName":"ZodiusInfuser","CreatedById":76163,"CreatedDateTime":"2015-04-06T18:39:57Z","Content":"\u003E \n\u003E Probably to soon to ask but a \u0022Wait\u0022 waits until the joint gets to it\u0027s set position? If it is will it wait until all the above joints have reached there position? Is this what kOS will be able to access? Looks like fun.\n\nIndeed it does. Any joints that were triggered to move before the wait will have to finish before the sequence will advance to the next instruction. We may change the name to clarify this.\n\n\u003E \n\u003E I hope it\u0027s not an actual wait, since that suspends all KOS processing. You\u0027d want to be able to do other stuff while the joints move.\n\nThis is completely separate to KOS, but it makes use of the same in-development API for robotics parts that KOS will eventually get support for."},{"CreatedByName":"Ziw","CreatedById":135292,"CreatedDateTime":"2015-04-06T19:13:26Z","Content":"\u003E \n\u003E Probably to soon to ask but a \u0022Wait\u0022 waits until the joint gets to it\u0027s set position? If it is will it wait until all the above joints have reached there position? Is this what kOS will be able to access? Looks like fun.\n\n\u0027Wait\u0027 functionality is coded in the addon, along with other stuff. But IR API lets you access Servos and Groups, move servos to presets/arbitrary positions/direction and groups to Presets/direction."},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2015-04-06T21:17:14Z","Content":"Just wanted to saw I\u0027m really happy all this is being done. When erendrake and ziw diverted their time from kOS over to \u0022an IR rework\u0022, I stayed over in the kOS world, and hadn\u0027t been watching what they were doing. I just noticed this thread today.\n\nI really hope I can get the kOS function re-work fixed along the same time this goes out of pre-release. The two releases together would be a nice combination.\n\n(The biggest problem is that LOCKs are essentially callback functions and therefore they violate all the nice scoping rules, and therefore need closures implemented for them to not blow things up. That\u0027s the main reason why the release got delayed a bit.)"},{"CreatedByName":"INSULINt","CreatedById":104803,"CreatedDateTime":"2015-04-06T21:34:45Z","Content":"When I install even just the basic plugin and legacy parts from the download in the OP, all my other parts disappear from the editor, except KIS/KAS, KER, and the Dr.Pepper fuel tank from DasValdez.\n\nLogs: [https://www./folder/u9427ap71qatd/IR_part_killer_logs](https://www./folder/u9427ap71qatd/IR_part_killer_logs) All I have do to reproduce is copy the MSI folder from the IR.Rework.P3.zip into my KSP GameData folder."},{"CreatedByName":"ZodiusInfuser","CreatedById":76163,"CreatedDateTime":"2015-04-06T22:01:39Z","Content":"\u003E \n\u003E When I install even just the basic plugin and legacy parts from the download in the OP, all my other parts disappear from the editor, except KIS/KAS, KER, and the Dr.Pepper fuel tank from DasValdez.\n\u003E Logs: [https://www./folder/u9427ap71qatd/IR_part_killer_logs](https://www./folder/u9427ap71qatd/IR_part_killer_logs) All I have do to reproduce is copy the MSI folder from the IR.Rework.P3.zip into my KSP GameData folder.\n\nThere\u0027s no errors in the log related to Infernal Robotics directly, but there are a fair number of NullReferenceExceptions that mention clouds. Not sure how that would be the cause, but I\u0027d suggest you try to see if they still appear without IR. If so they whatever mod is causing it could be the problem."},{"CreatedByName":"INSULINt","CreatedById":104803,"CreatedDateTime":"2015-04-06T22:33:52Z","Content":"EVE has created null refs for a few versions of KSP now..... either way, I remove MSI and my parts are back...\n\nLogs from booting w/o MSI: [https://www./folder/9pv37nz13ov91/Logs%2C_sans_IR](https://www./folder/9pv37nz13ov91/Logs%2C_sans_IR)"},{"CreatedByName":"sumghai","CreatedById":66272,"CreatedDateTime":"2015-04-06T23:12:26Z","Content":"\u003E \n\u003E As for the other one, for me personally I\u0027d like to see a use-case where preventing the user from changing presets would be wanted, baring in mind they\u0027re able to manually move the part between positions using the normal control buttons anyway.\n\n\u003E \n\u003E As described in issue #40, basically, I have a warehouse part with a KAS/KIS payload rack carousel that can move between 0, 90, 180 and 270 degrees. Due to space restrictions, the bay doors only cover 1/4 of the circumference.\n\u003E I don\u0027t want people to fiddle with the preset positions for this part, because if someone changed any of the values, the carousel would end up stopping in a position where it would be impossible to grab a payload rack.\n\nAs requested, I\u0027ve described a use case for preventing user changes to servo position presets within third-party IR-powered parts.\n\nIs there any further information you and Ziw need?"},{"CreatedByName":"The Space Man","CreatedById":73734,"CreatedDateTime":"2015-04-07T05:36:32Z","Content":"Is anyone else noticing severe memory leak when the servo configurator window is open?\n\nGCMonitor showed ram was increasing about 2.0MB/sec. I let it climb from 2.0GB until the game crashed at 3.7GB."},{"CreatedByName":"Ziw","CreatedById":135292,"CreatedDateTime":"2015-04-07T06:57:55Z","Content":"\u003E \n\u003E Is anyone else noticing severe memory leak when the servo configurator window is open?\n\u003E GCMonitor showed ram was increasing about 2.0MB/sec. I let it climb from 2.0GB until the game crashed at 3.7GB.\n\nThat is something new. Was it in Flight or in Editor?\n\n- - - Updated - - -\n\n\u003E \n\u003E When I install even just the basic plugin and legacy parts from the download in the OP, all my other parts disappear from the editor, except KIS/KAS, KER, and the Dr.Pepper fuel tank from DasValdez.\n\u003E Logs: [https://www./folder/u9427ap71qatd/IR_part_killer_logs](https://www./folder/u9427ap71qatd/IR_part_killer_logs) All I have do to reproduce is copy the MSI folder from the IR.Rework.P3.zip into my KSP GameData folder.\n\nI found this during part loading\n\n    (Filename: C:/BuildAgent/work/d63dfc6385190b60/artifacts/StandalonePlayerGenerated/UnityEngineDebug.cpp Line: 49)Cannot find a PartModule of typename \u0027TweakScale\u0027(Filename: C:/BuildAgent/work/d63dfc6385190b60/artifacts/StandalonePlayerGenerated/UnityEngineDebug.cpp Line: 49)FileNotFoundException: Could not load file or assembly \u0027KSPAPIExtensions, Version=1.7.2.0, Culture=neutral, PublicKeyToken=null\u0027 or one of its dependencies.  at (wrapper managed-to-native) System.MonoCustomAttrs:GetCustomAttributesInternal (System.Reflection.ICustomAttributeProvider,System.Type,bool)  at System.MonoCustomAttrs.GetCustomAttributesBase (ICustomAttributeProvider obj, System.Type attributeType) [0x00000] in :0   at System.MonoCustomAttrs.GetCustomAttributes (ICustomAttributeProvider obj, System.Type attributeType, Boolean inherit) [0x00000] in :0   at System.Reflection.MonoField.GetCustomAttributes (System.Type attributeType, Boolean inherit) [0x00000] in :0   at BaseFieldList.CreateList (System.Type type, System.Object instance) [0x00000] in :0   at BaseFieldList..ctor (UnityEngine.Component host) [0x00000] in :0   at PartModule.ModularSetup () [0x00000] in :0   at PartModule.Awake () [0x00000] in :0 UnityEngine.GameObject:Internal_AddComponentWithType(Type)UnityEngine.GameObject:AddComponent(Type)Part:AddModule(String)Part:AddModule(ConfigNode)PartLoader:ParsePart(UrlConfig, ConfigNode):MoveNext()UnityEngine.MonoBehaviour:StartCoroutine_Auto(IEnumerator)UnityEngine.MonoBehaviour:StartCoroutine(IEnumerator):MoveNext()UnityEngine.MonoBehaviour:StartCoroutine_Auto(IEnumerator)UnityEngine.MonoBehaviour:StartCoroutine(IEnumerator)PartLoader:StartLoad():MoveNext()(Filename:  Line: -1)\n\nEDIT: It\u0027s our fault - the latest pre-release did not have all the dependencies in archive -let me re-upload it in a bit\n\nPlease re-download the P3 again, it should contain all the necessary files now.\n\n- - - Updated - - -\n\n\u003E \n\u003E As requested, I\u0027ve described a use case for preventing user changes to servo position presets within third-party IR-powered parts.\n\u003E Is there any further information you and Ziw need?\n\nDo you want users at least see the available presets and just not able to edit them, or you want this window to be inaccessible to them?\n\n**Edited \u003Ctime datetime=\u00222015-04-07T06:56:16Z\u0022 title=\u002204/07/2015 06:56  AM\u0022 data-short=\u00229 yr\u0022\u003EApril 7, 2015\u003C/time\u003E by Ziw**"},{"CreatedByName":"The Space Man","CreatedById":73734,"CreatedDateTime":"2015-04-07T09:11:16Z","Content":"\u003E \n\u003E That is something new. Was it in Flight or in Editor?\n\nIt was in the Editor. I\u0027ll do some more testing later today to see if it happens during flight, and also try with no other mods installed.\n\nI wouldn\u0027t be surprised if it turns out to be a ksp bug [http://bugs.kerbalspaceprogram.com/issues/3926](http://bugs.kerbalspaceprogram.com/issues/3926)"},{"CreatedByName":"INSULINt","CreatedById":104803,"CreatedDateTime":"2015-04-07T09:51:53Z","Content":"\u003E \n\u003E Please re-download the P3 again, it should contain all the necessary files now.\n\nAh, the ol\u0027 kspapiextensions thing. It\u0027s been some time since I\u0027ve had to read a ksp log that I must have breezed by it. It doesn\u0027t help that EVE null refs like a mofo :/ I remember it being the cause of many weird things a while back when I had multiple mods that used it. I think parts \u0022disappearing\u0022 was one sign of multiple versions or it not being up to date.\n\nI\u0027ll have to try it the next time I\u0027m at my comp later tho. Thanks for looking into it tho ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif) I really dig the work that\u0027s been put into this!"},{"CreatedByName":"Ziw","CreatedById":135292,"CreatedDateTime":"2015-04-07T10:08:57Z","Content":"\u003E \n\u003E It was in the Editor. I\u0027ll do some more testing later today to see if it happens during flight, and also try with no other mods installed.\n\u003E I wouldn\u0027t be surprised if it turns out to be a ksp bug [http://bugs.kerbalspaceprogram.com/issues/3926](http://bugs.kerbalspaceprogram.com/issues/3926)\n\nI\u0027ll look into it later today. I have some areas of code where I wanted to optimise the memory usage anyway."},{"CreatedByName":"allmhuran","CreatedById":66124,"CreatedDateTime":"2015-04-07T14:05:00Z","Content":"Got a bit of a bug but I don\u0027t think it\u0027s new in this version.\n\nIn this video I have a docking washer standard, with a probe cores attached on each of the opposing nodes. When I command it to rotate it... well... sorta rotates. The video shows that the little red mark isn\u0027t leaving its centre position, but, uh, things are happening XD\n\nThere are no other parts connected to the washer, and no struts anywhere.\n\n[https://www.youtube.com/watch?v=9y62SbAwDvI](https://www.youtube.com/watch?v=9y62SbAwDvI)"},{"CreatedByName":"INSULINt","CreatedById":104803,"CreatedDateTime":"2015-04-07T21:08:16Z","Content":"All the parts are back! Thanks again, looking forward to making some stuff that moves ![:D](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif)"},{"CreatedByName":"Rybec","CreatedById":76947,"CreatedDateTime":"2015-04-07T23:13:39Z","Content":"I can confirm the memory leak when servo config is open in Editor, and not in Flight.\n\nYou can watch the memory usage climb at nearly 1mb/s. Close the servo config, leak immediately stops. Open it back up, starts again. Debug log shows no errors while this occurs. Only way to get the memory back is to restart the game.\n\nI believe this issue has been around for a while, pre-rework. I remember noticing it months ago but for some reason never reported it. I wasn\u0027t really using the parts at the time so I just removed them and paid it no mind..."},{"CreatedByName":"rasta013","CreatedById":140002,"CreatedDateTime":"2015-04-07T23:34:10Z","Content":"First off, before anything and everything else - THANK YOU FOR THIS MOD!!! This is one of the reasons I play KSP and the game is a much dimmer place without this package. Now on to the report/confirm...\n\nAt first, I wasn\u0027t sure if it was just my setup or KSP in general but I\u0027ve also experienced the memory leak with the servo config open. I saw it happening before the rework and still see it happening but haven\u0027t had the time to test it independent of all other mods. I do know that I can open the servo editor and watch either GC or the external Memory Usage utility to watch it spool away. I can also confirm that I\u0027ve watched the memory remain stable without it open, or closing it and watching it stop. That said, I see no information in a log file or, exception monitor or anywhere else that points to a definitive source but thought that I would relay the same thing I\u0027ve been watching and wondering about for a while. Will be interested to see the results of where it\u0027s coming from and would be more than happy to try and help find some time to test it out in varying setups if needs be.\n\nAgain, great job everyone on this mod - hands down my favorite thing to play with in KSP. Keep up all the great work!"},{"CreatedByName":"Ziw","CreatedById":135292,"CreatedDateTime":"2015-04-08T06:35:38Z","Content":"Thank you for comments! I have some vague ideas on what could be the the problem and will try to fix it for release\n\nUPDATE: after some brief experiments with GCMonitor I begin to suspect that memory leak is somewhere in TextField GUI element code and is outside of my reach. Our Servo Configuration window employs a bunch of TextFields multiplying the effect. I can try switching to TextArea and see whether it would help\n\nEDIT2: there is a Unity bug similar to what I see, but it is related to 5.0 beta\n\n[http://forum.unity3d.com/threads/ui-text-memory-leak.289845/](http://forum.unity3d.com/threads/ui-text-memory-leak.289845/)\n\n**Edited \u003Ctime datetime=\u00222015-04-08T09:53:05Z\u0022 title=\u002204/08/2015 09:53  AM\u0022 data-short=\u00229 yr\u0022\u003EApril 8, 2015\u003C/time\u003E by Ziw**"},{"CreatedByName":"allmhuran","CreatedById":66124,"CreatedDateTime":"2015-04-08T06:51:10Z","Content":"Update on the weird washer behaviour: I took the probes off and put them back on a bunch of times. Sometimes it behaved, other times it didn\u0027t move, and still other times it behaved as per the video.\n\nI tried to be very careful to ensure that the node connection wasn\u0027t actually reversed (particularly common with skinny parts, where they actually clip through to their parent\u0027s backside node... extremely common with structural panels which are almost impossible to get attached to the correct node.)."},{"CreatedByName":"Ziw","CreatedById":135292,"CreatedDateTime":"2015-04-08T18:40:51Z","Content":"Update on memory leaks:\n\nIt is in the legacy code handling drag-and-drop functionality for servos. Problem is that I don\u0027t see anything wrong with it. It must be some weird Unity interaction, I need to read up on the problem.\n\nFor now If the leak is too severe, we can disable it in an intermediate pre-release, while we try to fix it. Let me know how critical it is for you."},{"CreatedByName":"allmhuran","CreatedById":66124,"CreatedDateTime":"2015-04-09T09:58:23Z","Content":"Right now it doesn\u0027t seem possible (or I don\u0027t know how) to change the position of uncontrolled joint rotatron or pivotrons in the VAB/SPH. \n\nAm I just not seeing part of the GUI or is this in fact not possible?"},{"CreatedByName":"Ziw","CreatedById":135292,"CreatedDateTime":"2015-04-09T13:10:28Z","Content":"\u003E \n\u003E Right now it doesn\u0027t seem possible (or I don\u0027t know how) to change the position of uncontrolled joint rotatron or pivotrons in the VAB/SPH. \n\u003E Am I just not seeing part of the GUI or is this in fact not possible?\n\nIt is uncontrolled, how are you supposed to rotate it?\n\n**Edited \u003Ctime datetime=\u00222015-04-09T13:13:41Z\u0022 title=\u002204/09/2015 01:13  PM\u0022 data-short=\u00229 yr\u0022\u003EApril 9, 2015\u003C/time\u003E by Ziw**"},{"CreatedByName":"allmhuran","CreatedById":66124,"CreatedDateTime":"2015-04-09T13:41:03Z","Content":"I\u0027m talking about in the editor, not after launch.\n\nI want to align something in the editor, but I want it to move freely when launched.\n\nSpecifically, I want to rotate the free joints in order to strut and dock-on-physics-load the joints as shown by the red lines here:\n\n![UD37Xgk.png](http://i.imgur.com/UD37Xgk.png)"},{"CreatedByName":"Ziw","CreatedById":135292,"CreatedDateTime":"2015-04-09T14:14:05Z","Content":"\u003E \n\u003E I\u0027m talking about in the editor, not after launch.\n\u003E I want to align something in the editor, but I want it to move freely when launched.\n\u003E \n\u003E Specifically, I want to rotate the free joints in order to strut and dock-on-physics-load the joints as shown by the red lines here:\n\u003E \n\u003E [http://i.imgur.com/UD37Xgk.png](http://i.imgur.com/UD37Xgk.png)\n\nHmm, I see now, it is a valid request. Unfortunately this will have to wait until next week, as I need to consult with Zodius whether or not allowing Editor movement of uncontrolled parts can break anything and he is away. Uncontrolled parts are slightly different in handling from what I\u0027ve heard."},{"CreatedByName":"allmhuran","CreatedById":66124,"CreatedDateTime":"2015-04-09T14:23:36Z","Content":"No worries, thanks for taking it on! \n\nI figured it might be a bit harder than it sounds, since the position editor is now tied in with presets and so on, and presets don\u0027t make sense for an uncontrolled part."},{"CreatedByName":"allmhuran","CreatedById":66124,"CreatedDateTime":"2015-04-09T15:57:56Z","Content":"Well, kinda works in theory... [http://gfycat.com/HorribleLonelyAlaskankleekai](http://gfycat.com/HorribleLonelyAlaskankleekai)"}]}