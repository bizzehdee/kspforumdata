{"TopicId":103963,"ForumId":36,"TopicTitle":"[WIP][1.9.x-1.12.x] Scatterer-atmospheric scattering (0.0838 - 14/08/2022) Scattering improvements, in-game atmo generation and multi-sun support","CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-04-12T08:37:35Z","PageNum":51,"Articles":[{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-07-27T07:47:17Z","Content":"\u003E \n\u003E Ah right, yeah that makes sense, I had the stock atmosphere turned off as it was replaced by the Eve atmo shader. Oh and regarding the atmosphere height I was referring to its entire vertical scale essentially not so much to the altitude of its start point. Maybe it\u0027s something that could be edited in the configuration editor? Or is it hard limited to being proportionate to a planets radius?\n\nNot sure what you mean, are you referring to the horizon line being higher than the actual horizon? Or do you find the default atmospehre height setting too high in RSS?"},{"CreatedByName":"Ralathon","CreatedById":71537,"CreatedDateTime":"2015-07-27T15:58:52Z","Content":"Very minor little bug: The scattering effect does not show up on the IVA RasterProp Monitors if you look at it via a camera."},{"CreatedByName":"pingopete","CreatedById":74168,"CreatedDateTime":"2015-07-27T17:00:51Z","Content":"\u003E \n\u003E Not sure what you mean, are you referring to the horizon line being higher than the actual horizon? Or do you find the default atmospehre height setting too high in RSS?\n\nYeah the latter, is there any way of altering that? Thanks ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\n**Edited \u003Ctime datetime=\u00222015-07-27T17:23:59Z\u0022 title=\u002207/27/2015 05:23  PM\u0022 data-short=\u00228 yr\u0022\u003EJuly 27, 2015\u003C/time\u003E by pingopete**"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-07-27T17:40:40Z","Content":"\u003E \n\u003E Yeah the latter, is there any way of altering that? Thanks ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\nThe default atmosphere size is taken off of earth\u0027s so I\u0027d have thought it\u0027d look perfect with RSS. Anyway, you can do it with the config tool, there\u0027s a short explanation in the OP on how not to get artifacts, if you get problems just send me a message."},{"CreatedByName":"pingopete","CreatedById":74168,"CreatedDateTime":"2015-07-27T20:05:23Z","Content":"\u003E \n\u003E The default atmosphere size is taken off of earth\u0027s so I\u0027d have thought it\u0027d look perfect with RSS. Anyway, you can do it with the config tool, there\u0027s a short explanation in the OP on how not to get artifacts, if you get problems just send me a message.\n\nAwesome thanks for the help man!"},{"CreatedByName":"Xenro66","CreatedById":123894,"CreatedDateTime":"2015-07-28T13:03:05Z","Content":"I installed scatterer via CKAN, and it also installed clouds from the Astronomer\u0027s pack... But it causes this when I load up. If I reload, the same thing happens. If I go to the tracking station and look in map view, the skybox is gone and replaced with this weird red texture. Can anyone explain what this is and how to fix it?\n\n![2ioVNMuk.png](https://cdn.pbrd.co/images/2ioVNMuk.png)"},{"CreatedByName":"_Augustus_","CreatedById":115084,"CreatedDateTime":"2015-07-28T13:05:36Z","Content":"\u003E \n\u003E I installed scatterer via CKAN, and it also installed clouds from the Astronomer\u0027s pack... But it causes this when I load up. If I reload, the same thing happens. If I go to the tracking station and look in map view, the skybox is gone and replaced with this weird red texture. Can anyone explain what this is and how to fix it?\n\u003E [https://cdn.pbrd.co/images/2ioVNMuk.png](https://cdn.pbrd.co/images/2ioVNMuk.png)\n\n That\u0027s the result of installing any cloud mod through CKAN. Scatterer should install fine through CKAN."},{"CreatedByName":"gkorgood","CreatedById":124879,"CreatedDateTime":"2015-07-28T13:06:06Z","Content":"\u003E \n\u003E I installed scatterer via CKAN, and it also installed clouds from the Astronomer\u0027s pack... But it causes this when I load up. If I reload, the same thing happens. If I go to the tracking station and look in map view, the skybox is gone and replaced with this weird red texture. Can anyone explain what this is and how to fix it?\n\u003E [https://cdn.pbrd.co/images/2ioVNMuk.png](https://cdn.pbrd.co/images/2ioVNMuk.png)\n\nyou might be out of memory. try reinstalling EVE and AVP manually (yes it\u0027s a lot to do. such is life ![:(](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_sad.gif) )"},{"CreatedByName":"SmallFatFetus","CreatedById":137860,"CreatedDateTime":"2015-07-28T13:53:59Z","Content":"\u003E \n\u003E I installed scatterer via CKAN, and it also installed clouds from the Astronomer\u0027s pack... But it causes this when I load up. If I reload, the same thing happens. If I go to the tracking station and look in map view, the skybox is gone and replaced with this weird red texture. Can anyone explain what this is and how to fix it?\n\u003E [https://cdn.pbrd.co/images/2ioVNMuk.png](https://cdn.pbrd.co/images/2ioVNMuk.png)\n\nThis is an AVP bug. It\u0027s not an easy mod to install."},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-07-28T14:28:06Z","Content":"So, can anybody think of an easy way to detect an eclipse? I need to hide the sunflare I\u0027m adding when on laythe and jool occludes the sun.\n\nIf I cast a ray, will it work in scaledspace? Do the scaledspace objects have colliders?\n\n**Edited \u003Ctime datetime=\u00222015-07-28T15:01:11Z\u0022 title=\u002207/28/2015 03:01  PM\u0022 data-short=\u00228 yr\u0022\u003EJuly 28, 2015\u003C/time\u003E by blackrack**"},{"CreatedByName":"Xenro66","CreatedById":123894,"CreatedDateTime":"2015-07-28T15:21:02Z","Content":"\u003E \n\u003E That\u0027s the result of installing any cloud mod through CKAN. Scatterer should install fine through CKAN.\n\nOh right. I can\u0027t remove the clouds and keep scatterer with CKAN, so I guess I\u0027ll have to do a manual install.\n\n\u003E \n\u003E you might be out of memory. try reinstalling EVE and AVP manually (yes it\u0027s a lot to do. such is life ![:(](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_sad.gif) )\n\nI run at 2.7GB in the main menu, so I\u0027m definitely not out of memory (yet). But yeah, I\u0027ll attempt a manual install.\n\n\u003E \n\u003E This is an AVP bug. It\u0027s not an easy mod to install.\n\nWell, I thought CKAN was meant to make it easier?! xD"},{"CreatedByName":"rbray89","CreatedById":48847,"CreatedDateTime":"2015-07-28T15:29:39Z","Content":"\u003E \n\u003E So, can anybody think of an easy way to detect an eclipse? I need to hide the sunflare I\u0027m adding when on laythe and jool occludes the sun.\n\u003E If I cast a ray, will it work in scaledspace? Do the scaledspace objects have colliders?\n\nThey should. I believe that is how the existing sun flare system works. \n\nThe only other way I have is using spherical intersection models in my shaders ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif) You\u0027d have to pass in the body origin and the radius however."},{"CreatedByName":"HafCoJoe","CreatedById":80363,"CreatedDateTime":"2015-07-28T16:29:44Z","Content":"Dude you have no clue how hyped I am for this xD just the weekly updates are getting me all riled up!"},{"CreatedByName":"rbray89","CreatedById":48847,"CreatedDateTime":"2015-07-28T17:23:25Z","Content":"\u003E \n\u003E They should. I believe that is how the existing sun flare system works. \n\u003E The only other way I have is using spherical intersection models in my shaders ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif) You\u0027d have to pass in the body origin and the radius however.\n\nActually, Now that I think about it, this would actually probably be much less computationally intensive than a ray-trace. \n\nTo detect if you hit the sphere:\n\n    float3 L = _PlanetOrigin - _WorldSpaceCameraPos; // Vector to Center of body from camerafloat3 La = normalize(_SunOrigin - _WorldSpaceCameraPos); // Vector to the Center of the Sun (might also be able to use Vector3 La = Vector3.Normalize(Sun.Instance.sunDirection)float tc = dot(L, La); // Component of L that is parallel to the view directionfloat d = sqrt(dot(IN.L,IN.L)-dot(tc,tc)); //dot(x,x) gets magnitude squared. This just uses Pythagorean\u0027s theorem to get the distance from the center to the tangent of the view.if ( _SphereRadius \u003E= d \u0026\u0026 tc \u003E 0) // Check to ensure tangent distance is less than sphere and that we are looking in the right direction.{  Collision = true;}\n\nI apologize for just using pseudo code here. Couldn\u0027t remember all the references to the math functions."},{"CreatedByName":"Red Iron Crown","CreatedById":12858,"CreatedDateTime":"2015-07-28T17:30:07Z","Content":"If either of you figure out how to have a moon cast a shadow on a planet I will buy you a beverage of your choice. ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)"},{"CreatedByName":"_Augustus_","CreatedById":115084,"CreatedDateTime":"2015-07-28T17:36:50Z","Content":"\u003E \n\u003E If either of you figure out how to have a moon cast a shadow on a planet I will buy you a beverage of your choice. ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\n Agreed!"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-07-28T17:48:53Z","Content":"\u003E \n\u003E Actually, Now that I think about it, this would actually probably be much less computationally intensive than a ray-trace. \n\u003E To detect if you hit the sphere:\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E \n\u003E \n\u003E     float3 L = _PlanetOrigin - _WorldSpaceCameraPos; // Vector to Center of body from camerafloat3 La = normalize(_SunOrigin - _WorldSpaceCameraPos); // Vector to the Center of the Sun (might also be able to use Vector3 La = Vector3.Normalize(Sun.Instance.sunDirection)float tc = dot(L, La); // Component of L that is parallel to the view directionfloat d = sqrt(dot(IN.L,IN.L)-dot(tc,tc)); //dot(x,x) gets magnitude squared. This just uses Pythagorean\u0027s theorem to get the distance from the center to the tangent of the view.if ( _SphereRadius \u003E= d \u0026\u0026 tc \u003E 0) // Check to ensure tangent distance is less than sphere and that we are looking in the right direction.{  Collision = true;}\n\u003E \n\u003E \n\u003E  \n\u003E \n\u003E I apologize for just using pseudo code here. Couldn\u0027t remember all the references to the math functions.\n\nI might be saying something stupid here, but if you do that whole check in the shader won\u0027t the same calculation be done over and over again for every pixel in the image? Isn\u0027t better to just compute it once per frame outside of the shader?\n\nAlso, what would make this less performance-intensive? Is the raycast checking for all colliders while this basically checks intersection with one body?\n\n\u003E \n\u003E If either of you figure out how to have a moon cast a shadow on a planet I will buy you a beverage of your choice. ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\nI believe rbray already has a good idea on how to do this."},{"CreatedByName":"rbray89","CreatedById":48847,"CreatedDateTime":"2015-07-28T17:49:47Z","Content":"\u003E \n\u003E If either of you figure out how to have a moon cast a shadow on a planet I will buy you a beverage of your choice. ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\nAlready working on it. I\u0027m re-jiggering the shadow mechanism I created for the clouds to work for moons as well ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)"},{"CreatedByName":"Red Iron Crown","CreatedById":12858,"CreatedDateTime":"2015-07-28T17:51:40Z","Content":"\\*Hype intensifies\\*\n\nWill definitely put my money where my mouth is. ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)"},{"CreatedByName":"HafCoJoe","CreatedById":80363,"CreatedDateTime":"2015-07-28T18:00:12Z","Content":"\u003E \n\u003E \\*Hype intensifies\\*\n\u003E Will definitely put my money where my mouth is. ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\nYou know I haven\u0027t given you a tip yet either. That will have to change soon."},{"CreatedByName":"rbray89","CreatedById":48847,"CreatedDateTime":"2015-07-28T18:02:02Z","Content":"\u003E \n\u003E I might be saying something stupid here, but if you do that whole check in the shader won\u0027t the same calculation be done over and over again for every pixel in the image? Isn\u0027t better to just compute it once per frame outside of the shader?\n\nI\u0027m using it to actually perform depth checking on oceans, so it is required that I do this for the pixel shader.\n\n\u003E \n\u003E Also, what would make this less performance-intensive? Is the raycast checking for all colliders while this basically checks intersection with one body?\n\nThere are a couple implementations of ray-casting that could be used... but they are all iterative and can be pretty performance hungry. I don\u0027t think 1 raycast will make a huge difference, but many would. \n\n[https://unity3d.com/learn/tutorials/modules/intermediate/physics/physics-best-practices](https://unity3d.com/learn/tutorials/modules/intermediate/physics/physics-best-practices)\n\nBasically, ray casting has to loop over all the verticies/triangles in range and somehow determine which intersect the ray\u0027s path, and which is closest. My solution is an O(1) solution, ray tracing would be at BEST O(Log n) if it was heavily optimized in Unity.\n\nSo you would end up just doing this once for the center of the body each update of course ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\n**Edited \u003Ctime datetime=\u00222015-07-28T18:04:43Z\u0022 title=\u002207/28/2015 06:04  PM\u0022 data-short=\u00228 yr\u0022\u003EJuly 28, 2015\u003C/time\u003E by rbray89**"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-07-28T18:25:02Z","Content":"\u003E \n\u003E I\u0027m using it to actually perform depth checking on oceans, so it is required that I do this for the pixel shader.\n\u003E There are a couple implementations of ray-casting that could be used... but they are all iterative and can be pretty performance hungry. I don\u0027t think 1 raycast will make a huge difference, but many would. \n\u003E \n\u003E [https://unity3d.com/learn/tutorials/modules/intermediate/physics/physics-best-practices](https://unity3d.com/learn/tutorials/modules/intermediate/physics/physics-best-practices)\n\u003E \n\u003E Basically, ray casting has to loop over all the verticies/triangles in range and somehow determine which intersect the ray\u0027s path, and which is closest. My solution is an O(1) solution, ray tracing would be at BEST O(Log n) if it was heavily optimized in Unity.\n\u003E \n\u003E So you would end up just doing this once for the center of the body each update of course ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\nGot it, but I just looked it up and it\u0027s possible to set a layer \u0022mask\u0022 for raycasting so it shouldn\u0027t be much of a problem. Plus if I do it this way it will be compatible with multiple moons, mods that add custom systems etc... So it looks like I\u0027ll use the built-in raycasting."},{"CreatedByName":"rbray89","CreatedById":48847,"CreatedDateTime":"2015-07-28T19:11:04Z","Content":"\u003E \n\u003E Got it, but I just looked it up and it\u0027s possible to set a layer \u0022mask\u0022 for raycasting so it shouldn\u0027t be much of a problem. Plus if I do it this way it will be compatible with multiple moons, mods that add custom systems etc... So it looks like I\u0027ll use the built-in raycasting.\n\nAh, true... I\u0027ve been trying to figure out how to \\*Efficiently\\* do the shadows on bodies. I\u0027m pretty sure I want to keep using the projectors, but I\u0027m afraid multiple bodies will eat up all my interpolators."},{"CreatedByName":"HafCoJoe","CreatedById":80363,"CreatedDateTime":"2015-07-28T19:29:44Z","Content":"\u003E \n\u003E If either of you figure out how to have a moon cast a shadow on a planet I will buy you a beverage of your choice. ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\nI want to add that SQUAD might also buy you guys your beverage of choice... They have yet to add true eclipses to stock and if either of you gets it working, I bet there is a high chance that they would look into adding it to stock. Or at least something similar. ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\nWe could finally see something like this:\n\n![jupiter-moons_3175749c.jpg](http://i.telegraph.co.uk/multimedia/archive/03175/jupiter-moons_3175749c.jpg)\n\n**Edited \u003Ctime datetime=\u00222015-07-28T19:33:31Z\u0022 title=\u002207/28/2015 07:33  PM\u0022 data-short=\u00228 yr\u0022\u003EJuly 28, 2015\u003C/time\u003E by Avera9eJoe**"},{"CreatedByName":"Drew Kerman","CreatedById":103177,"CreatedDateTime":"2015-07-28T19:30:13Z","Content":"This conversation is epic"}]}