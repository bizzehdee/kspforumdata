{"TopicId":74221,"ForumId":29,"TopicTitle":"ConfgNodes: why, when and how do I use them exactly?","CreatedByName":"Ippo","CreatedById":107018,"CreatedDateTime":"2014-06-05T16:54:51Z","PageNum":1,"Articles":[{"CreatedByName":"Ippo","CreatedById":107018,"CreatedDateTime":"2014-06-05T16:54:51Z","Content":"\n\u003Cp\u003EPretty much the title says it all.\u003C/p\u003E\u003Cp\u003EI have a basic understanding of what they are, but for the sake of the thread, let\u0027s pretend I don\u0027t (it\u0027s not a big leap).\u003C/p\u003E\u003Cp\u003ESo, yeah:\u003C/p\u003E\u003Cp\u003E- in what scenarios would I need to work with config nodes?\u003C/p\u003E\u003Cp\u003E- and how do I do that?\u003C/p\u003E\u003Cp\u003EBasically, AFAIK: a config node is, essentially, what you find in a cfg file. It\u0027s pretty much structured like an xml file and I receive one during the OnLoad event.\u003C/p\u003E\u003Cp\u003EBut what node do I get during OnLoad? How do I parse that information? And how does it work during OnSave?\u003C/p\u003E\u003Cp\u003ESorry for the noobness.\u003C/p\u003E\n"},{"CreatedByName":"blizzy78","CreatedById":68543,"CreatedDateTime":"2014-06-05T19:12:58Z","Content":"\n\u003Cp\u003EOnLoad/Save of what?\u003C/p\u003E\u003Cp\u003EI use ConfigNode directly to load/save my configuration files, which is not the same as part.cfg files.\u003C/p\u003E\n"},{"CreatedByName":"Ippo","CreatedById":107018,"CreatedDateTime":"2014-06-05T19:51:58Z","Content":"\n\u003Cp\u003ESorry, I am talking about a PartModule.\u003C/p\u003E\u003Cp\u003EWhat do you mean with \u0022\u003Cspan style=\u0022color:#333333;\u0022\u003EI use ConfigNode directly to load/save my configuration files, which is not the same as part.cfg files.\u0022 ?\u003C/span\u003E\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-06-05T19:56:56Z","Content":"\n\u003Cp\u003EI think he is referring to those methods in PartModule.\u003C/p\u003E\u003Cp\u003EIf in a partModule, you call either\u003C/p\u003E\u003Cp\u003EOnLoad(ConfigNode node)\u003C/p\u003E\u003Cp\u003EOnSave(ConfigNode node)\u003C/p\u003E\u003Cp\u003EThose methods will execute whenever KSP does a read/write to the persistence file so you can be compatible with the persistence system.\u003C/p\u003E\u003Cp\u003EThe way I have used it I create my persistence KSPFields in my partModule to create the values in the persistence.sfs file as part of the vessel.\u003C/p\u003E\u003Cp\u003EI then use OnLoad(ConfigNode node) to call node.getValue(\u0022ValueName\u0022) and KSP handles all the background stuff to read the value from the persistent.sfs file. \u003C/p\u003E\u003Cp\u003EI add a matching OnSave(ConfigNode node) with node.SetValue(\u0022ValueName\u0022, Value) to write the value to the persistent.sfs file.\u003C/p\u003E\u003Cp\u003ECode:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Epublic class ModuleAGExtData : PartModule\u003Cbr\u003E    {\u003Cbr\u003E[KSPField(isPersistant = true, guiActive = false)]\u003Cbr\u003Epublic string AGXData;\u003Cbr\u003E}\u003C/pre\u003E\u003Cp\u003E \u003C/p\u003E\u003Cp\u003Ecreates the AGXData string that I want to persist.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E--in the same PartModule\u003Cbr\u003Epublic override void OnSave(ConfigNode node)\u003Cbr\u003E{\u003Cbr\u003Enode.SetValue(\u0022AGXData\u0022, \u0022StringToSave\u0022);\u003Cbr\u003E}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003Esaves the value to the persistent.sfs file specific to this partModule on its part on its vessel whenever KSP calls it\u0027s save routine such as when a scene changes or the QuickSave button is hit.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E--in the same PartModule\u003Cbr\u003Epublic override void OnLoad(ConfigNode node)\u003Cbr\u003E{\u003Cbr\u003EReadString = node.GetValue(\u0022AGXData\u0022);\u003Cbr\u003E}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003Epulls the saved string from the persistent.sfs file when KSP calls it\u0027s load routine.\u003C/p\u003E\u003Cp\u003EAnd KSP handles all the stuff in the background for the management of the persistent.sfs file, such as deleting old data when a vessel is destroyed, all partModules assigned to that vessel are also deleted from the persistent .sfs file by KSP automatically.\u003C/p\u003E\u003Cp\u003ENote that one big limitation of this method is that you can \u003Cem\u003Eonly\u003C/em\u003E save/load when KSP calls for it, you can\u0027t save/load yourself.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-06-05T20:08:12Z\u0022 title=\u002206/05/2014 08:08  PM\u0022 data-short=\u002210 yr\u0022\u003EJune 5, 2014\u003C/time\u003E by Diazo\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Ippo","CreatedById":107018,"CreatedDateTime":"2014-06-05T20:00:33Z","Content":"\n\u003Cp\u003EWell, if you can spare the time, I\u0027ll gladly wait a couple hours, or more if needed \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-06-05T20:06:28Z","Content":"\n\u003Cp\u003EGot stuck on hold, grabbed some examples from my AGX mod.\u003C/p\u003E\u003Cp\u003EDoes that make sense?\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n"},{"CreatedByName":"blizzy78","CreatedById":68543,"CreatedDateTime":"2014-06-05T20:10:38Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Ippo\u0022 data-cite=\u0022Ippo\u0022\u003E\u003Cdiv\u003EWhat do you mean with \u0022\u003Cspan style=\u0022color:#333333;\u0022\u003EI use ConfigNode directly to load/save my configuration files, which is not the same as part.cfg files.\u0022 ?\u003C/span\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI load/save files directly using ConfigNode.Load()/Save(). I don\u0027t have a PartModule that does it for me, because my plugins don\u0027t have parts.\u003C/p\u003E\n"},{"CreatedByName":"Ippo","CreatedById":107018,"CreatedDateTime":"2014-06-05T20:10:54Z","Content":"\n\u003Cp\u003EYes, a lot more, thank you \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-06-05T20:16:50Z","Content":"\n\u003Cp\u003EAh, I suppose what Blizzy is talking about also counts as ConfigNode.\u003C/p\u003E\u003Cp\u003EThat method is great for saving mod settings as it does \u003Cem\u003Enot\u003C/em\u003E respect the persistence system.\u003C/p\u003E\u003Cp\u003EFirst, create your .cfg file with your values, in this example I am loading TWR1.cfg from my mod\u0027s sub-directory in GameData.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Epublic void Start()\u003Cbr\u003E{\u003Cbr\u003ETWR1Node = ConfigNode.Load(KSPUtil.ApplicationRootPath \u002B \u0022GameData/Diazo/TWR1/TWR1.cfg\u0022); //load .cfg file\u003Cbr\u003ETWR1KeyCodeString = TWR1Node.GetValue(\u0022TWR1Key\u0022); //read keybind from .cfg, no functionality to set keybind from ingame exists yet\u003Cbr\u003E}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003ELoads the key that the player has bound for controlling my Vertical Velocity mod.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003ETWR1Node.SetValue(\u0022TWR1Key\u0022, TWR1KeyCodeString);//set the new Keybind to the ConfigNode in memory\u003Cbr\u003ETWR1Node.Save(KSPUtil.ApplicationRootPath \u002B \u0022GameData/Diazo/TWR1/TWR1.cfg\u0022);//save the ConfigNode in memory to the .cfg file on disk.\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EAnd saving a new KeyBinding to the .cfg file on disk.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-06-05T20:19:55Z\u0022 title=\u002206/05/2014 08:19  PM\u0022 data-short=\u002210 yr\u0022\u003EJune 5, 2014\u003C/time\u003E by Diazo\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Ippo","CreatedById":107018,"CreatedDateTime":"2014-06-05T20:22:36Z","Content":"\n\u003Cp\u003EOk, I guess this covers all my questions, thanks you guys \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EJust one small doubt: I guess I can only read / write strings, is that correct?\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-06-05T20:27:33Z","Content":"\n\u003Cp\u003ENo, you can read/write a limited number of types.\u003C/p\u003E\u003Cp\u003EHowever, the KeyCode type is not supported which is why my example converts it to a string.\u003C/p\u003E\u003Cp\u003EThe official documentation states that string, bool, int, float, Vector2, Vector3, Vector4 or Quaternion data types are supports, but I have not actively tested this.\u003C/p\u003E\u003Cp\u003ENotably from other posts I\u0027ve seen, double is \u003Cem\u003Enot\u003C/em\u003E supported.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n"},{"CreatedByName":"Ippo","CreatedById":107018,"CreatedDateTime":"2014-06-05T20:30:26Z","Content":"\n\u003Cp\u003EOk, perfect. Thanks guys, I owe you some beer \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"}]}