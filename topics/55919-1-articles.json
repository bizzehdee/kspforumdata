{"TopicId":55919,"ForumId":29,"TopicTitle":"CPU Load of a Raycast","CreatedByName":"SiliconPyro","CreatedById":19734,"CreatedDateTime":"2013-12-12T17:51:11Z","PageNum":1,"Articles":[{"CreatedByName":"SiliconPyro","CreatedById":19734,"CreatedDateTime":"2013-12-12T17:51:11Z","Content":"\n\u003Cp\u003EI\u0027m thinking of creating a plugin that would be calling several raycasts at once, up to a couple dozen. I\u0027m not sure on the refresh rate or the exact number, but how much of an impact would that have on someone\u0027s framerate? Would it be more beneficial to decrease the number of raycasts, or their frequency in order to improve framerate?\u003C/p\u003E\n"},{"CreatedByName":"Greys","CreatedById":57109,"CreatedDateTime":"2013-12-12T18:26:11Z","Content":"\n\u003Cp\u003EI can\u0027t say directly; but under normal circumstances KSP already runs a lot of raycasts every physics frame. They\u0027re used for determining if most engines are permitted to create thrust, if solar panels are in sunlight, and the entire wheel collider system is based off a raycast through the bottom of the wheel.\u003C/p\u003E\n"},{"CreatedByName":"SiliconPyro","CreatedById":19734,"CreatedDateTime":"2013-12-12T18:32:39Z","Content":"\n\u003Cp\u003EOkay, thanks, Greys. I assume those update every tick as well, so adding my own probably should be too demanding. I think I can get by with only nine, but 25 would be ideal.\u003C/p\u003E\n"},{"CreatedByName":"Nertea","CreatedById":83952,"CreatedDateTime":"2013-12-12T18:43:42Z","Content":"\n\u003Cp\u003EI asked this question on some Unity forums a while back and got an answer of \u0022it depends\u0022. Primarily on:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cul\u003E\u003Cli\u003ERange of raycast: minimize it for improved performance\u003Cbr\u003E\u003C/li\u003E\u003Cli\u003EComplexity of colliders in the scene. Apparently number isn\u0027t too important, but loads of mesh colliders in a scene will be slower than loads of boxes. Same as the rest of the physics, really\u003Cbr\u003E\u003C/li\u003E\u003Cli\u003ECollision mask of raycast versus colliders: probably not too applicable in KSP, but only raycast against the layers you really need.\u003Cbr\u003E\u003C/li\u003E\u003C/ul\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EOne solution is to raycast every nth physics frame, or spread your casts out over several physics steps (5 per frame for 5 frames maybe, then loop back) if you can. Essentialy, does it really need to run constantly?\u003C/p\u003E\n"},{"CreatedByName":"SiliconPyro","CreatedById":19734,"CreatedDateTime":"2013-12-12T18:58:38Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Nertea\u0022 data-cite=\u0022Nertea\u0022\u003E\u003Cdiv\u003EI asked this question on some Unity forums a while back and got an answer of \u0022it depends\u0022. Primarily on:\u003Cp\u003E\u003C/p\u003E\u003Cul\u003E\u003Cli\u003ERange of raycast: minimize it for improved performance \u003Cbr\u003E\u003C/li\u003E\u003Cli\u003EComplexity of colliders in the scene. Apparently number isn\u0027t too important, but loads of mesh colliders in a scene will be slower than loads of boxes. Same as the rest of the physics, really \u003Cbr\u003E\u003C/li\u003E\u003Cli\u003ECollision mask of raycast versus colliders: probably not too applicable in KSP, but only raycast against the layers you really need. \u003Cbr\u003E\u003C/li\u003E\u003C/ul\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EOne solution is to raycast every nth physics frame, or spread your casts out over several physics steps (5 per frame for 5 frames maybe, then loop back) if you can. Essentialy, does it really need to run constantly?\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EFor the purposes of this plugin, it is essential that they run constantly, but the range would never need to be more than 500m. You could even get away with 100m. I think a slower refresh would be acceptable though, down to about five per second (per raycast). That\u0027s a bare minimum though.\u003C/p\u003E\n"},{"CreatedByName":"Nertea","CreatedById":83952,"CreatedDateTime":"2013-12-12T19:30:32Z","Content":"\n\u003Cp\u003EWhoa, what is this? \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif\u0022 alt=\u0022:P\u0022\u003E\u003C/p\u003E\u003Cp\u003EWell, I\u0027m not sure what the exact physics timestep KSP uses is, the Unity default is 10 ticks per simulated second I think. So refreshing 5 per second is every second tick. I\u0027d test that withrather complex ships with lots of colliders and see what kind of performance penalty it gives.\u003C/p\u003E\n"},{"CreatedByName":"SiliconPyro","CreatedById":19734,"CreatedDateTime":"2013-12-12T19:37:35Z","Content":"\n\u003Cp\u003ENo point in keeping it a secret, I suppose. I want to make a terrain radar that is visible while in the cockpit for IVA landing. The idea is that each raycast would show up as a dot. Their size, relative to the size of the center dot that represents actual height above terrain, would increase or decrease. This would give the pilot an idea of the terrain\u0027s slope. A field of 25 would get the job done fine.\u003C/p\u003E\n"},{"CreatedByName":"Jordanpumah","CreatedById":47395,"CreatedDateTime":"2013-12-12T19:46:55Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022norcalairman\u0022 data-cite=\u0022norcalairman\u0022\u003E\u003Cdiv\u003Elovely jubly words\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003Ethat is actually a really neat idea, when tweakables come in, you think it would be possible to have it as a separate option?\u003C/p\u003E\u003Cp\u003Ethink the radar thingy from Half-Life 2 episode 2, in the muscle car\u003C/p\u003E\n"},{"CreatedByName":"SiliconPyro","CreatedById":19734,"CreatedDateTime":"2013-12-12T20:02:00Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Jordanpumah\u0022 data-cite=\u0022Jordanpumah\u0022\u003E\u003Cdiv\u003Ethat is actually a really neat idea, when tweakables come in, you think it would be possible to have it as a separate option?\u003Cp\u003Ethink the radar thingy from Half-Life 2 episode 2, in the muscle car\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThanks, but I don\u0027t know how it would integrate with tweakables. I was thinking of having a few switches on the GUI to activate/deactivate it, change scan area, etc. Then, if a crapton of raycasts doesn\u0027t bog down framerate, there could be an \u0022advanced\u0022 version later in the tech tree with more points scanned.\u003C/p\u003E\n"},{"CreatedByName":"Nertea","CreatedById":83952,"CreatedDateTime":"2013-12-12T20:10:04Z","Content":"\n\u003Cp\u003EShiny! If you\u0027re doing this, and if you could find out if KSP uses layer tags differentiating terrain and parts, you could easily raycast just against the terrain layer. This would allow you tons more headroom in performance!\u003C/p\u003E\n"},{"CreatedByName":"SiliconPyro","CreatedById":19734,"CreatedDateTime":"2013-12-12T20:21:22Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Nertea\u0022 data-cite=\u0022Nertea\u0022\u003E\u003Cdiv\u003EShiny! If you\u0027re doing this, and if you could find out if KSP uses layer tags differentiating terrain and parts, you could easily raycast just against the terrain layer. This would allow you tons more headroom in performance!\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThat sounds like what I want to do. I have some learning to do though.\u003C/p\u003E\n"},{"CreatedByName":"asmi","CreatedById":59068,"CreatedDateTime":"2013-12-12T20:37:38Z","Content":"\n\u003Cp\u003EYou can height directly from pqs. No need to do raycasts.\u003C/p\u003E\n"},{"CreatedByName":"SiliconPyro","CreatedById":19734,"CreatedDateTime":"2013-12-12T20:40:38Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022asmi\u0022 data-cite=\u0022asmi\u0022\u003E\u003Cdiv\u003EYou can height directly from pqs. No need to do raycasts.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EOkay, is there a method for altitude above terrain? On \u003Ca href=\u0022http://wiki.kerbalspaceprogram.com/wiki/API:CelestialBody\u0022 rel=\u0022external nofollow\u0022\u003ETHIS PAGE\u003C/a\u003E I only see altitude above sea level.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-12-12T20:46:01Z\u0022 title=\u002212/12/2013 08:46  PM\u0022 data-short=\u002210 yr\u0022\u003EDecember 12, 2013\u003C/time\u003E by norcalairman\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2013-12-13T02:59:58Z","Content":"\n\u003Cp\u003EI know you can height from sea level (vessel.altitude) and from terrain (vessel.heightFromTerrain) to directly below your ship.\u003C/p\u003E\u003Cp\u003ENote that vessel.heightFromTerrain returns from the seabed if you are over water on Kerbin. I had to implement a check to use the smallest of those two values when in Kerbin\u0027s SOI for my mod.\u003C/p\u003E\u003Cp\u003EI don\u0027t know how to reference any other place on terrain other then directly below your ship however.\u003C/p\u003E\u003Cp\u003EMaybe you can do something with relative lat/longs?\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n"},{"CreatedByName":"numerobis","CreatedById":62016,"CreatedDateTime":"2013-12-15T22:25:56Z","Content":"\n\u003Cp\u003ERaycast onto the terrain is going to be pretty cheap, normally, so you should be able to do a bunch without noticing. Try it out, benchmark, see if it\u0027s acceptable. But my bet is that with \u0026lt; 100 per frame you won\u0027t be suffering.\u003C/p\u003E\u003Cp\u003EIn my work window I\u0027m raycasting left and right without suffering any visible degradation in performance on an old iPad.\u003C/p\u003E\n"},{"CreatedByName":"SiliconPyro","CreatedById":19734,"CreatedDateTime":"2013-12-16T13:06:32Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022numerobis\u0022 data-cite=\u0022numerobis\u0022\u003E\u003Cdiv\u003ERaycast onto the terrain is going to be pretty cheap, normally, so you should be able to do a bunch without noticing. Try it out, benchmark, see if it\u0027s acceptable. But my bet is that with \u0026lt; 100 per frame you won\u0027t be suffering.\u003Cp\u003EIn my work window I\u0027m raycasting left and right without suffering any visible degradation in performance on an old iPad.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThanks. From what I\u0027m seeing, I think a raycast is the way to go since I can specify an offset from the craft\u0027s CoM. Glad to hear it won\u0027t be too taxing.\u003C/p\u003E\n"},{"CreatedByName":"Camacha","CreatedById":59088,"CreatedDateTime":"2013-12-20T17:17:12Z","Content":"\n\u003Cp\u003EIt would be pretty neat to have a laser ranger part for kOS. Combining more or less of those will give you very flexible configuration and usage options \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022font-size:8px;\u0022\u003EThere are more sensors I would love to see, but having laser rangers is the primary wish.\u003C/span\u003E\u003C/p\u003E\n"},{"CreatedByName":"TheAwer","CreatedById":91122,"CreatedDateTime":"2013-12-20T22:20:54Z","Content":"\n\u003Cp\u003EThis sounds like a great tool! When will you alpha/beta/release it?\u003C/p\u003E\u003Cp\u003EFlying at night just got a LOT more exciting. Make sure that this is usable not just when landing, too. Some kind of futuristic 3D HUD in the cockpit would also be awesome.\u003C/p\u003E\n"}]}