{"TopicId":76324,"ForumId":55,"TopicTitle":"Rework Intake Air logic","CreatedByName":"Red Iron Crown","CreatedById":12858,"CreatedDateTime":"2014-06-30T10:54:26Z","PageNum":1,"Articles":[{"CreatedByName":"Red Iron Crown","CreatedById":12858,"CreatedDateTime":"2014-06-30T10:54:26Z","Content":"\n\u003Cp\u003EInspired by Kasuha\u0027s analysis of intake air in his \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/64362-Fuel-Flow-Rules-%280-23-5%29\u0022 rel=\u0022external nofollow\u0022\u003EFuel Flow thread\u003C/a\u003E and the discussion \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/84217-Explaining-burnout-asymetry\u0022 rel=\u0022external nofollow\u0022\u003Ehere\u003C/a\u003E, I suggest that the way intake air is calculated and allocated should be reworked.\u003C/p\u003E\u003Cp\u003ECurrently, the order in which intakes and air-breathing engines are placed when constructing a craft has a large effect on how the engines receive intake air. That means that two craft with the same parts in the same locations can behave very differently depending on how they were built.\u003C/p\u003E\u003Cp\u003EFurthermore, the current behavior makes the use of symmetry in craft construction less useful. Air-breathing engines should never be placed by themselves using symmetry, because the intake air supply to each will be very different.\u003C/p\u003E\u003Cp\u003EThe way it works now is a bit counterintuitive and non-obvious, and it complicates both construction of air-breathing ships and troubleshooting asymmetric flameout problems.\u003C/p\u003E\u003Cp\u003ESo my suggestion is that rather than calculating intake air production and consumption part by part based on the order in the .craft description, instead calculate the sum of intake air produced and divide it among all the active air-breathing engines. Perhaps allocated in proportion to each engine\u0027s requirements (this would accomodate different types of engines or engines with output restricted via tweakables).\u003C/p\u003E\n"},{"CreatedByName":"Kasuha","CreatedById":81781,"CreatedDateTime":"2014-06-30T11:33:54Z","Content":"\n\u003Cp\u003EThe current behavior is clearly an artifact of implementation which was not meant for running engines starving for air - but it is actually very common state for all spaceplanes designed to reach orbit. So I definitely agree.\u003C/p\u003E\u003Cp\u003EI would also propose that similar, yet maybe more sophisticated method should be applied to electricity. \u003C/p\u003E\u003Cp\u003EIn that case, also all electricity production should be calculated first, then the consumption should be distributed based on part priority - probe cores going first, then reaction wheels, then ion engines, then everything else. And if there is not enough electricity to match needs of the whole group (e.g. all ion engines) then neither gets any and the leftover is stored in batteries.\u003C/p\u003E\n"},{"CreatedByName":"Moss","CreatedById":106413,"CreatedDateTime":"2014-06-30T11:45:57Z","Content":"\n\u003Cp\u003EGreat suggestion, Mr. Crown.\u003C/p\u003E\n"},{"CreatedByName":"Red Iron Crown","CreatedById":12858,"CreatedDateTime":"2014-06-30T13:07:38Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Kasuha\u0022 data-cite=\u0022Kasuha\u0022\u003E\u003Cdiv\u003EThe current behavior is clearly an artifact of implementation which was not meant for running engines starving for air - but it is actually very common state for all spaceplanes designed to reach orbit. So I definitely agree.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EAgreed, the current implementation has somewhat of a \u0022quick and dirty\u0022 feel to it. Though there may be underlying performance reasons for the way it is, I don\u0027t know enough about the internals of KSP to really say.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003EI would also propose that similar, yet maybe more sophisticated method should be applied to electricity. \u003Cp\u003EIn that case, also all electricity production should be calculated first, then the consumption should be distributed based on part priority - probe cores going first, then reaction wheels, then ion engines, then everything else. And if there is not enough electricity to match needs of the whole group (e.g. all ion engines) then neither gets any and the leftover is stored in batteries.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThat\u0027s an excellent idea, probably worthy of its own thread. I particularly like prioritizing probe cores and reaction wheels, makes it less likely that poor solar panel orientation will render a ship useless.\u003C/p\u003E\n"},{"CreatedByName":"Sky_walker","CreatedById":113214,"CreatedDateTime":"2014-06-30T13:42:54Z","Content":"\n\u003Cp\u003ELooks like a great idea.\u003C/p\u003E\u003Cp\u003ECurrent implementation doesn\u0027t make any sense, so anything that improves on that is most welcome \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"LethalDose","CreatedById":92657,"CreatedDateTime":"2014-06-30T18:27:11Z","Content":"\n\u003Cp\u003EWhat RIC has proposed above is way better than what is currently implemented, and as Kashua indicates, could be applicable to other resources. \u003C/p\u003E\u003Cp\u003EI feel like the whole issue could actually be side-stepped if \u003Cem\u003Ethe players\u003C/em\u003E were able to set the priorities for resource usage. E.g. all engines that were assigned to \u0022IntakeAir Priority 1\u0022 would get all air distributed amongst them. The same could be done for fuel tanks, setting some fuel tanks to be drained first, or all fuel tanks with the same priority to be drained at the same time. In these cases, all the fuel duct would do (and, IMO, all it \u003Cem\u003Eshould\u003C/em\u003E do) is act as a part to create a \u0022fuel crossfeed\u0022 link between two parts. If the players can set the usage priorities, all this goofy flow logic just disappears.\u003C/p\u003E\u003Cp\u003EThe game would just look at all the parts that are crosslinked and draw from the ones with the highest priority first, and send that resource to the highest priority engine/consumer. If those needs are met, then it flows to the next highest, and so on.\u003C/p\u003E\n"},{"CreatedByName":"Javster","CreatedById":74613,"CreatedDateTime":"2014-06-30T19:01:45Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Red Iron Crown\u0022 data-cite=\u0022Red Iron Crown\u0022\u003E\u003Cdiv\u003EAgreed, the current implementation has somewhat of a \u0022quick and dirty\u0022 feel to it\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ENow you mention it, so do many things in KSP somehow...\u003C/p\u003E\n"},{"CreatedByName":"Vaporo","CreatedById":110800,"CreatedDateTime":"2014-06-30T19:12:00Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Kasuha\u0022 data-cite=\u0022Kasuha\u0022\u003E\u003Cdiv\u003EAnd if there is not enough electricity to match needs of the whole group (e.g. all ion engines) then neither gets any and the leftover is stored in batteries.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI think that it would be better to set it up so that ion engines could continue to operate if the total electric charge requirements are not being met, but at a reduced power level (all ion engines would operate at the same level of course. Otherwise we just have the same problem that we have now with jet engines).\u003C/p\u003E\n"},{"CreatedByName":"Kasuha","CreatedById":81781,"CreatedDateTime":"2014-06-30T19:57:51Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Vaporo\u0022 data-cite=\u0022Vaporo\u0022\u003E\u003Cdiv\u003EI think that it would be better to set it up so that ion engines could continue to operate if the total electric charge requirements are not being met, but at a reduced power level (all ion engines would operate at the same level of course. Otherwise we just have the same problem that we have now with jet engines).\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EWe \u003Cem\u003Edo\u003C/em\u003E have the same problem with Ion engines as with jets. My idea is that they either all thrust, or are all off due to insufficient charge. With storing the leftover to battery it may mean that they will thrust every other frame, but they will still thrust all at once, not just a few of them which are first in the craft file.\u003C/p\u003E\n"},{"CreatedByName":"ialdabaoth","CreatedById":57270,"CreatedDateTime":"2014-06-30T20:27:25Z","Content":"\n\u003Cp\u003ESimpler solution: Parts which are part of the same symmetry group generate and deplete resources as a group.\u003C/p\u003E\u003Cp\u003EI.e., if you have a 3-fold cluster of engines, they all pull 3x the resources of a single engine as a single resource pull, and then divide whatever they get evenly between them.\u003C/p\u003E\n"},{"CreatedByName":"Kasuha","CreatedById":81781,"CreatedDateTime":"2014-06-30T21:05:52Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022ialdabaoth\u0022 data-cite=\u0022ialdabaoth\u0022\u003E\u003Cdiv\u003ESimpler solution: Parts which are part of the same symmetry group generate and deplete resources as a group.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI\u0027m not sure it would be any easier to implement (maybe, maybe not) and with current bugs related to symmetric parts placed in symmetry once again it may lead to some rather nasty problems.\u003C/p\u003E\n"},{"CreatedByName":"ialdabaoth","CreatedById":57270,"CreatedDateTime":"2014-06-30T21:09:43Z","Content":"\n\u003Cp\u003EYeah, nested symmetry is problematic. The solution might require a rewrite of the craft tree \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_sad.gif\u0022 alt=\u0022:(\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Red Iron Crown","CreatedById":12858,"CreatedDateTime":"2014-06-30T22:47:58Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022LethalDose\u0022 data-cite=\u0022LethalDose\u0022\u003E\u003Cdiv\u003EI feel like the whole issue could actually be side-stepped if \u003Cem\u003Ethe players\u003C/em\u003E were able to set the priorities for resource usage. E.g. all engines that were assigned to \u0022IntakeAir Priority 1\u0022 would get all air distributed amongst them. The same could be done for fuel tanks, setting some fuel tanks to be drained first, or all fuel tanks with the same priority to be drained at the same time. In these cases, all the fuel duct would do (and, IMO, all it \u003Cem\u003Eshould\u003C/em\u003E do) is act as a part to create a \u0022fuel crossfeed\u0022 link between two parts. If the players can set the usage priorities, all this goofy flow logic just disappears.\u003Cp\u003EThe game would just look at all the parts that are crosslinked and draw from the ones with the highest priority first, and send that resource to the highest priority engine/consumer. If those needs are met, then it flows to the next highest, and so on.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThat\u0027s not a bad idea at all. It would need some revised default logic for when new players don\u0027t know to set priorities, but otherwise I think this would add some flexibility to the resource system by allowing more complex drain arrangements. How were you thinking the interface would work? Through tweakables or something new?\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Javster\u0022 data-cite=\u0022Javster\u0022\u003E\u003Cdiv\u003ENow you mention it, so do many things in KSP somehow...\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EInsert obligatory \u0022It\u0027s in alpha response\u0022 here. Seriously though, the game still has many rough edges that I expect will be refined once the scope is complete.\u003C/p\u003E\n"},{"CreatedByName":"Vaporo","CreatedById":110800,"CreatedDateTime":"2014-06-30T22:58:11Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Kasuha\u0022 data-cite=\u0022Kasuha\u0022\u003E\u003Cdiv\u003EWe \u003Cem\u003Edo\u003C/em\u003E have the same problem with Ion engines as with jets. My idea is that they either all thrust, or are all off due to insufficient charge. With storing the leftover to battery it may mean that they will thrust every other frame, but they will still thrust all at once, not just a few of them which are first in the craft file.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ESounds like you hate epileptic people (all those flashing engines...).\u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E I think that it would be better to just limit the thrust of all engines, that way people can say \u0022all right, I am getting exactly 75% thrust. I need 133% of the electricity that I have now for full thrust.\u0022 It\u0027s a more elegant solution, one that\u0027s already partially implemented (ion engines will currently limit thrust if there is not enough electric charge, they just limit it unevenly), and takes some of the guesswork out of construction.\u003C/p\u003E\u003Cp\u003EEDIT:\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022LethalDose\u0022 data-cite=\u0022LethalDose\u0022\u003E\u003Cdiv\u003EI feel like the whole issue could actually be side-stepped if \u003Cem\u003Ethe players\u003C/em\u003E were able to set the priorities for resource usage. \u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYeah that\u0027s a good idea too. It would get kind of frustrating remembering which engine you set to what priority, though. Maybe the current fuel lines should stay, but there is also the fuel link that you suggested.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-07-01T00:37:15Z\u0022 title=\u002207/01/2014 12:37  AM\u0022 data-short=\u002210 yr\u0022\u003EJuly 1, 2014\u003C/time\u003E by Vaporo\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Kasuha","CreatedById":81781,"CreatedDateTime":"2014-06-30T23:38:55Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Vaporo\u0022 data-cite=\u0022Vaporo\u0022\u003E\u003Cdiv\u003ESounds like you hate epileptic people (all those flashing engines...).\u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ESounds like you ran out of reasonable arguments.\u003C/p\u003E\u003Cp\u003EI\u0027m pretty sure epileptic people are sane enough to switch off any disturbing light sources they have under control. Also, we\u0027re discussing \u003Cem\u003Eion engines\u003C/em\u003E. The have \u003Cem\u003Eno flame\u003C/em\u003E and produce \u003Cem\u003Eno sound\u003C/em\u003E. And nobody \u003Cem\u003Eforces\u003C/em\u003E you to look at them from below during burns.\u003C/p\u003E\u003Cp\u003EBesides, it will be still up to developers to decide whether and how they will implement it. Pulling such arguments on me is pointless. I\u0027m not the one who will be making decisions.\u003C/p\u003E\n"},{"CreatedByName":"Eric S","CreatedById":57117,"CreatedDateTime":"2014-07-01T00:21:22Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Kasuha\u0022 data-cite=\u0022Kasuha\u0022\u003E\u003Cdiv\u003ESounds like you ran out of reasonable arguments.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EAs someone that is susceptible (though not exactly mainstream epileptic), you\u0027re right that I\u0027m going to take whatever steps I feel necessary to avoid the situation, and I don\u0027t think I\u0027m susceptible enough to have issues from ion engines. However, until you can show at least some advantage to doing it this way, it feels like you can\u0027t be bothered to consider my situation.\u003C/p\u003E\u003Cp\u003EIf you know that you don\u0027t have enough electricity to run at the user-set thrust level, you probably know how short you are and could run the engines at a percentage of that level, similar to how a single engine jet works when resource starved. I\u0027ll confess that it would take more work than the current system (probably two passes through the parts as mentioned above, one to collect resources, one to consume them, though if that\u0027s too processor intensive, remembering how much they wanted to consume last tick might work but you\u0027d have to cover corner cases), but so would the all or nothing method.\u003C/p\u003E\u003Cp\u003EThat said, I\u0027m in favor of the proposal. Intake air has the advantage that without mods, jet engines are the only things that consume intake air, so the process would be simpler for intake air than for electricity. For the difference, you\u0027d want some kind of priority system, either a fixed one or one that the user can alter as discussed.\u003C/p\u003E\n"},{"CreatedByName":"LethalDose","CreatedById":92657,"CreatedDateTime":"2014-07-01T00:37:37Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Red Iron Crown\u0022 data-cite=\u0022Red Iron Crown\u0022\u003E\u003Cdiv\u003EThat\u0027s not a bad idea at all. It would need some revised default logic for when new players don\u0027t know to set priorities, but otherwise I think this would add some flexibility to the resource system by allowing more complex drain arrangements. How were you thinking the interface would work? Through tweakables or something new?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYarp, just tweakables. Each part that stores or consumes a resource can get assigned a \u0022priority group\u0022 (separately for storage and consumption) in the VAB. For example, right clicking on a LF/Ox tank would show the current tweakable interface (a row for each LF \u0026amp; Ox) and the \u0022stop/go\u0022 toggle, plus something like a:\u003C/p\u003E\u003Cp\u003E[up arrow] [Value] [Down arrow]\u003C/p\u003E\u003Cp\u003Eclick the \u0022up\u0022 arrow to make it a \u0022higher\u0022 priority source/consumer, contra for the \u0022down\u0022 arrow. The Value displays the \u0027priority\u0027 group.\u003C/p\u003E\u003Cp\u003EThe \u0022default\u0022 logic would just be everything in same group. Maybe it would do the same \u0022top to bottom\u0022 logic it uses now /shrug. It\u0027s a minor detail.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-07-01T17:00:44Z\u0022 title=\u002207/01/2014 05:00  PM\u0022 data-short=\u002210 yr\u0022\u003EJuly 1, 2014\u003C/time\u003E by LethalDose\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Vaporo","CreatedById":110800,"CreatedDateTime":"2014-07-01T00:46:13Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Kasuha\u0022 data-cite=\u0022Kasuha\u0022\u003E\u003Cdiv\u003ESounds like you ran out of reasonable arguments.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI was joking.\u003C/p\u003E\u003Cp\u003EI just think that \u0022flashing\u0022 ion engines would seem more artificial and unrealistic than ion engines that are automatically thrust limited to meet fuel limitations, almost like the game is breaking rather than the fuel flow. It comes down to personal preference, I guess.\u003C/p\u003E\u003Cp\u003EEDIT: Maybe xenon fuel flow could remain the same for electric charge starved ion engines, as realistically they still have propellant, just not enough power to propel it at maximum velocity. Just a thought.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-07-01T00:56:27Z\u0022 title=\u002207/01/2014 12:56  AM\u0022 data-short=\u002210 yr\u0022\u003EJuly 1, 2014\u003C/time\u003E by Vaporo\u003C/strong\u003E\n\u003C/span\u003E\n"}]}