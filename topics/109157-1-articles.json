{"TopicId":109157,"ForumId":16,"TopicTitle":"Thrust/Isp curve calcuations?","CreatedByName":"UmbralRaptor","CreatedById":2767,"CreatedDateTime":"2015-05-14T05:18:19Z","PageNum":1,"Articles":[{"CreatedByName":"UmbralRaptor","CreatedById":2767,"CreatedDateTime":"2015-05-14T05:18:19Z","Content":"I\u0027m trying to (manually) work out the curve for the LV-909 engine. From the CFG files:\n\n    \t\tatmosphereCurve\t\t{\t\t\tkey = 0 345\t\t\tkey = 1 85\t\t\tkey = 3 0.001\t\t}\n\nI\u0027ve already done some searching, and the following links helped some:\n\n[http://answers.unity3d.com/questions/464782/t-is-the-math-behind-animationcurveevaluate.html#](http://answers.unity3d.com/questions/464782/t-is-the-math-behind-animationcurveevaluate.html#)\n\n[http://forum.kerbalspaceprogram.com/threads/93332-INFO-KSP-floatCurves-and-you-the-magic-of-tangents](https://forum.kerbalspaceprogram.com/threads/93332-INFO-KSP-floatCurves-and-you-the-magic-of-tangents)\n\n[https://en.wikipedia.org/wiki/Cubic_Hermite_spline](https://en.wikipedia.org/wiki/Cubic_Hermite_spline)\n\nBut using them generates the wrong curve. Using some values obtained ingame with an LV-909 and a presmat barometer:\n\n    Pressure        Thrust  Isp     Linear fit      Spline, m0=m1=0     Spline, m0=1, m1=0.58100.2133        15.1    86.7    87.8526722      85.0932069515       86.68066721598.2507         15.6    89.8    92.8887038      85.703524446        89.773423622895.422          16.5    94.8    100.147148      87.5445044298       94.504977074692.0828         17.5    100.5   108.7155352     91.0948924821       100.489177388185.493          19.7    113.5   125.624962      102.0592627423      113.477901217371.9826         25.1    144.4   160.2926484     137.7831098736      144.332958106556.4051         32.2    185.3   200.2645134     192.9913911189      185.26251431326.1866         47.4    272.4   277.8051844     301.8783387706      272.396470488318.1095         51.4    295.7   298.531023      323.0529758471      295.666242827411.3536         54.7    314.7   315.8666624     335.9382785966      314.64922551087.8583          56.4    324.2   324.8356022     340.5509970732      324.22971789975.8834          57.3    329.6   329.9031956     342.4720256559      329.55640213862.6333          58.8    338.2   338.2429522     344.4823077964      338.1711129210.9397          59.6    342.6   342.5887298     344.9333275577      342.57942422920.3279          59.9    344.2   344.1586086     344.9918490872      344.1574685440.0938          60      344.8   344.7593092     344.9993319654      344.75921565780.0198          60      344.9   344.9491932     344.9999702193      344.94918902120.0027          60      345     344.9930718     344.9999994462      344.99307172110               60      345     345             345                 345\n\nWhere are these tangents coming from? Is there some way to generalize this to other engines (and presumably higher pressures for Eve ascents etc)?"},{"CreatedByName":"Starfang42","CreatedById":143979,"CreatedDateTime":"2015-05-14T06:45:58Z","Content":"I\u0027ve recently spent some time looking for an answer to this myself, and after getting where you are right now (more or less), [this](https://forum.kerbalspaceprogram.com/threads/67606-Fuel-consumption-as-a-function-of-atmospheric-pressure?p=938324\u0026viewfull=1#post938324) post gave me the final piece, at least as far as I can tell. Basically:\n\n1) A point\u0027s incoming and outgoing tangent is the same\n\n2) The two end points use the slope between that endpoint and its connected inner point.\n\n3) Other points average the incoming and outgoing slope\n\nTo use the 909 as an example, the first point is [0, 345], the second is [1,85], and the third is [3,0.001]\n\nthe tangent for the first point would be (85-345)/(1-0), the third would be (0.001-85)/(3-1), and the second would be the average of the third and the first. \n\nDone a bit of basic testing with this using the TV-30 and now your data from the 909, and it seems to fit. I\u0027m assuming your listed pressures are in KPa, and switched it back to atm since that\u0027s what the pressure numbers for the atmospherecurve are given in."},{"CreatedByName":"Northlight","CreatedById":142232,"CreatedDateTime":"2015-05-14T08:43:20Z","Content":"If you want a closer fit using regression, try a logarithmic regression. LnReg.\n\n[http://forum.kerbalspaceprogram.com/threads/120256-ISP-Graphs](https://forum.kerbalspaceprogram.com/threads/120256-ISP-Graphs)\n\nThere I tried the same as you, but with LnReg. Then NathanKell said that KSP uses the NASA standard atmospheric model,\n\nbut at 80%. (As in 8km on Kerbin = 10km on Earth).\n\nThe formulas for getting atmospheric pressure in the NASA standard atmospheric model are:\n\n![NAM.png](http://tunefix.net/img/NAM.png)\n\n(These are corrected for the Kerbin 80% atmosphere, so h is kerbin-altitude in meters)\n\nNASA model source: [https://www.grc.nasa.gov/www/k-12/airplane/atmosmet.html](https://www.grc.nasa.gov/www/k-12/airplane/atmosmet.html)\n\n**Edited \u003Ctime datetime=\u00222015-05-14T09:11:14Z\u0022 title=\u002205/14/2015 09:11  AM\u0022 data-short=\u00229 yr\u0022\u003EMay 14, 2015\u003C/time\u003E by Northlight**"},{"CreatedByName":"OhioBob","CreatedById":128005,"CreatedDateTime":"2015-05-14T14:19:18Z","Content":"\u003E \n\u003E Then NathanKell said that KSP uses the NASA standard atmospheric model,\n\u003E but at 80%. (As in 8km on Kerbin = 10km on Earth).\n\nKerbin\u0027s atmosphere is *based* on an 80% US Standard Atmosphere model, but it doesn\u0027t match it exactly. It uses a series of points taken from the standard model but, to estimate values in between, those points are connected with splines. Therefore, there will be some deviation between what KSP computes and what your equations will yield. Should be pretty close, though.\n\n(EDIT)\n\nSomething else that will throw off the results is that the standard model uses [geopotential height](https://en.wikipedia.org/wiki/Geopotential_height) (h), while KSP altitudes are geometric height (z). A conversion must be made before using your equations.\n\n**Edited \u003Ctime datetime=\u00222015-05-14T16:47:35Z\u0022 title=\u002205/14/2015 04:47  PM\u0022 data-short=\u00229 yr\u0022\u003EMay 14, 2015\u003C/time\u003E by OhioBob**"},{"CreatedByName":"UmbralRaptor","CreatedById":2767,"CreatedDateTime":"2015-05-17T00:10:21Z","Content":"@Starfang42: That solves it, thanks! As for pressures, I read them off the presmat barometer, which seems to use kPa now.\n\n@OhioBob, Northlight: I decided to avoid altitude entirely for the near-term, but that\u0027ll also help. It does explain why the old 5 km isothermal scale height was obviously off, though."},{"CreatedByName":"OhioBob","CreatedById":128005,"CreatedDateTime":"2015-05-17T01:06:23Z","Content":"\u003E \n\u003E @OhioBob, Northlight: I decided to avoid altitude entirely for the near-term, but that\u0027ll also help. It does explain why the old 5 km isothermal scale height was obviously off, though.\n\nIt appears that none of the atmospheres follow the old isothermal/constant scale height model anymore. I\u0027ve got the Kerbin atmosphere figured out pretty close if you ever need it. It\u0027s described in the following thread:\n\n[http://forum.kerbalspaceprogram.com/threads/117069-Great-New-Physics-Thread%21?p=1940443\u0026viewfull=1#post1940443](https://forum.kerbalspaceprogram.com/threads/117069-Great-New-Physics-Thread%21?p=1940443\u0026viewfull=1#post1940443)"}]}