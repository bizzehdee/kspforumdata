{"TopicId":53399,"ForumId":16,"TopicTitle":"Finding the best ascent path for rockets","CreatedByName":"mhoram","CreatedById":78756,"CreatedDateTime":"2013-11-17T08:13:41Z","PageNum":1,"Articles":[{"CreatedByName":"mhoram","CreatedById":78756,"CreatedDateTime":"2013-11-17T08:13:41Z","Content":"\n\u003Cp\u003EIn the \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/55615-Payload-Fraction-Challenge\u0022 rel=\u0022external nofollow\u0022\u003EPayload Fraction Challenge\u003C/a\u003E Thread \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/55615-Payload-Fraction-Challenge?p=782350\u0026amp;viewfull=1#post782350\u0022 rel=\u0022external nofollow\u0022\u003Ecame up\u003C/a\u003E a \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/55615-Payload-Fraction-Challenge?p=784110\u0026amp;viewfull=1#post784110\u0022 rel=\u0022external nofollow\u0022\u003Ediscussion about\u003C/a\u003E finding the optimal ascent strategy for rockets.\u003C/p\u003E\u003Cp\u003EWell here is my take on this problem.\u003C/p\u003E\u003Cp\u003EA perl program simulating the physics of KSP (implementation was based on V 0.21.1).\u003C/p\u003E\u003Cp\u003EAt the moment it is missing documentation, but it consists of different modules like Rocket \u0026amp; Stage design, Physic constants, gravity turn handling, Kepler and Cartesian coordinates.\u003C/p\u003E\u003Cp\u003EThe basic way it works is that the ascent profile is parameterized by\u003C/p\u003E\u003Cp\u003E- pirchover altitude\u003C/p\u003E\u003Cp\u003E- pitch angle\u003C/p\u003E\u003Cp\u003E- pitchover duration\u003C/p\u003E\u003Cp\u003E- twr during downrange\u003C/p\u003E\u003Cp\u003E- target orbit radius\u003C/p\u003E\u003Cp\u003EThe program does not find the best ascent profiles yet, as some details are still missing in the implementation, like elevated pitch during the LV-N-phase.\u003C/p\u003E\u003Cp\u003EOther details are simplified like orientation can change instantly without delay. No time-delay at the end of a stage.\u003C/p\u003E\u003Cp\u003EUsing this simulator with multiple sets of random values the results are compared by\u003C/p\u003E\u003Cp\u003E1. Is the orbit reached?\u003C/p\u003E\u003Cp\u003E2a. If yes, remaining fuel\u003C/p\u003E\u003Cp\u003E2b. If no, highest Periapsis\u003C/p\u003E\u003Cp\u003EThe best set of paramerers is kept and partially randomized for the next set of random values to be tested.\u003C/p\u003E\u003Cp\u003EThis procedure is iterated until one is content with the results.\u003C/p\u003E\u003Cp\u003EYou can find the code (released under GPL V3) here:\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022https://github.com/mhoram-kerbin/ascent-optimizer\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/mhoram-kerbin/ascent-optimizer\u003C/a\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-11-17T09:25:07Z\u0022 title=\u002211/17/2013 09:25  AM\u0022 data-short=\u002210 yr\u0022\u003ENovember 17, 2013\u003C/time\u003E by mhoram\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Vanamonde","CreatedById":27914,"CreatedDateTime":"2013-11-17T08:56:22Z","Content":"\n\u003Cp\u003E(Thread moved to gameplay questions, where it\u0027s more likely to receive helpful attention.)\u003C/p\u003E\n"},{"CreatedByName":"Kasuha","CreatedById":81781,"CreatedDateTime":"2013-11-17T19:31:13Z","Content":"\n\u003Cp\u003EI don\u0027t know perl so the code is not very readable to me but it seems to me you assume some predefined ascent trajectories and in general you work with very few parameters. If that\u0027s true (I may be wrong) it\u0027s scanning just a very small subspace of all possible ascents and while it may be near the optimum there\u0027s rather high chance the optimum will not lie in the subspace you scan. For instance I am very uncertain whether offcenter thrust will be only limited to the LV-N phase. Also there\u0027s no point to make LV-Ns any special, it\u0027s always possible certain stage will be underpowered or overpowered so at least each stage could likely use its own approach. Or there may be need for previous stage to prepare conditions for the next stage so the granularity could be even higher.\u003C/p\u003E\u003Cp\u003EI also wonder which ascent trajectory you assume for non-equatorial liftoff point. It would probably to make sense to add liftoff azimuzh or inclination as one of initial parameters (unless it\u0027s already there, I can\u0027t read the code well).\u003C/p\u003E\n"},{"CreatedByName":"Seanner","CreatedById":91816,"CreatedDateTime":"2013-11-17T23:50:52Z","Content":"\n\u003Cp\u003EI\u0027m working on the exact same thing. Currently in the testing phase for 1d motion to confirm that my algorithm comes up with terminal velocity ascent.\u003C/p\u003E\n"},{"CreatedByName":"numerobis","CreatedById":62016,"CreatedDateTime":"2013-11-18T00:16:48Z","Content":"\n\u003Cp\u003EMy \u003Ca href=\u0022https://github.com/numerobis/KSP-scripts\u0022 rel=\u0022external nofollow\u0022\u003EKSP-scripts\u003C/a\u003E have this ascent.py module that is relevant... I haven\u0027t touched it in a year.\u003C/p\u003E\u003Cp\u003EPerhaps more important than that is the engine.py and planet.py modules. I use those all the time when designing spacecraft.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-11-18T00:19:35Z\u0022 title=\u002211/18/2013 12:19  AM\u0022 data-short=\u002210 yr\u0022\u003ENovember 18, 2013\u003C/time\u003E by numerobis\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"tavert","CreatedById":57383,"CreatedDateTime":"2013-11-18T02:31:04Z","Content":"\n\u003Cp\u003EI recommend you folks read through this thread from a few months back: \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/46194-I-need-someone-help-me-do-some-math-for-launch-optimization?highlight=launch\u002Boptimization\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://forum.kerbalspaceprogram.com/threads/46194-I-need-someone-help-me-do-some-math-for-launch-optimization?highlight=launch\u002Boptimization\u003C/a\u003E\u003C/p\u003E\u003Cp\u003E3 main approaches for this optimization problem: pseudospectral methods, local discretization, or using the Pontryagin principle to express the solution in terms of a boundary value problem. Alterbaron got a pseudospectral method using PSOPT (and possibly local discretization via an option setting with the same software?) working for the single-stage problem, fixed design. Multiple stages are trickier, you have to split up the time horizon for each stage, scale the time variable by a different interval in each stage, and stitch together the dynamic conditions between the end of one stage and the start of the next.\u003C/p\u003E\n"},{"CreatedByName":"mhoram","CreatedById":78756,"CreatedDateTime":"2013-11-18T22:53:16Z","Content":"\n\u003Cp\u003E\u003Cstrong\u003E@Kasuha\u003C/strong\u003E you are right, that I only look at a small fraction of all possible ascents.\u003C/p\u003E\u003Cp\u003EIn the current sourcecode the same ship as in \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/39196-Launch-Efficiency-Exercise-Updated-for-0-21-1\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://forum.kerbalspaceprogram.com/threads/39196-Launch-Efficiency-Exercise-Updated-for-0-21-1\u003C/a\u003E is tested for it\u0027s optimal ascent and I get a remaining fuel of about 8.1 while the best in the challenge has 10.55 left. So yes there is improvement possible. To test the result, \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/47399-kOS-Scriptable-Autopilot-System-0-9\u0022 rel=\u0022external nofollow\u0022\u003EkOS\u003C/a\u003E seems to be an interesting addon.\u003C/p\u003E\u003Cp\u003EOffcenter thrust is probably necessary in the downrange phase whenever the TWR is low.\u003C/p\u003E\u003Cp\u003ENon-equatorial liftoff is an issue that I did not adress yet.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003E@Seanner\u003C/strong\u003E I found most information about KSP physics in the Wiki and some forum posts,\u003C/p\u003E\u003Cp\u003EFor general physics I found \u003Ca href=\u0022https://downloads.rene-schwarz.com/dc/category/19\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://downloads.rene-schwarz.com/dc/category/19\u003C/a\u003E and \u003Ca href=\u0022https://downloads.rene-schwarz.com/dc/category/20\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://downloads.rene-schwarz.com/dc/category/20\u003C/a\u003E very helpful.\u003C/p\u003E\u003Cp\u003EThe only thing that seems to be unknown is the handling of rotation by torque and gimbaling.\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003E@tavert\u003C/strong\u003E Thanks for the link. The thread is a treasure trove friom before my KSP-time! PSOPT looks very promising. I think I will have sometime soon a deeper look at it.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-11-18T23:34:34Z\u0022 title=\u002211/18/2013 11:34  PM\u0022 data-short=\u002210 yr\u0022\u003ENovember 18, 2013\u003C/time\u003E by mhoram\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"numerobis","CreatedById":62016,"CreatedDateTime":"2013-11-18T23:01:22Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003Ethe handling of rotation by torque and gimbaling.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThe gimbals max out at 1 degree. You can largely ignore the effect of off-center thrust in practice, it\u0027s less than a part in a thousand. How does command-pod torque matter to the question at hand?\u003C/p\u003E\n"},{"CreatedByName":"Seanner","CreatedById":91816,"CreatedDateTime":"2013-11-19T01:50:11Z","Content":"\n\u003Cp\u003EThanks I\u0027ve got most of it now, but I\u0027m ignoring centripetal and Coriolis for the time being.\u003C/p\u003E\u003Cp\u003EBy the way, I wasted a lot of time figuring out why my algorithm got progressively worse over increasing iterations and generally performing horribly until I realized that I was returning the minimum instead of maximum performer at the end. (WHY DOES MAX HEIGHT ARE ZERO?!?) True story...\u003C/p\u003E\u003Cp\u003Eedit: Found another problem...incorrect fuel calculation was causing excessive fuel burn. I was using altitude-dependent real g instead of 9.81...survival of the fittest now produces nearly perfect throttle genes. Now that this garbage works, I\u0027m going to try to evolve genes for a neural net to fly it instead of directly encoding throttle. Hopefully this results in a brain that can fly any craft instead of the specifically-solved-for one\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-11-19T02:46:51Z\u0022 title=\u002211/19/2013 02:46  AM\u0022 data-short=\u002210 yr\u0022\u003ENovember 19, 2013\u003C/time\u003E by Seanner\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"mhoram","CreatedById":78756,"CreatedDateTime":"2013-11-21T01:43:58Z","Content":"\n\u003Cp\u003EPSOPT is a bit tricky to install because of it\u0027s dependencies. Will report back, when I got it running.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022numerobis\u0022 data-cite=\u0022numerobis\u0022\u003E\u003Cdiv\u003EThe gimbals max out at 1 degree. You can largely ignore the effect of off-center thrust in practice, it\u0027s less than a part in a thousand. How does command-pod torque matter to the question at hand?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI think there are two different applications of off-center thrust in this discussion: thrust caused by gimbaling and thrust while the orientation is different from prograde. While the effects of gimbaling should be quite low, the other must be taken into account, especially since the angle betweeen orientation and prograde can be large.\u003C/p\u003E\u003Cp\u003ETorque is the only physical property, that I was unable to model correctly because there is no information about it anywhere to be found.\u003C/p\u003E\n"},{"CreatedByName":"numerobis","CreatedById":62016,"CreatedDateTime":"2013-11-21T14:09:09Z","Content":"\n\u003Cp\u003ESeanner: g0 is exactly 9.82 in KSP (but gravity at sea level is about 9.81).\u003C/p\u003E\n"},{"CreatedByName":"Camacha","CreatedById":59088,"CreatedDateTime":"2013-11-21T17:06:42Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Seanner\u0022 data-cite=\u0022Seanner\u0022\u003E\u003Cdiv\u003ENow that this garbage works, I\u0027m going to try to evolve genes for a neural net to fly it instead of directly encoding throttle. Hopefully this results in a brain that can fly any craft instead of the specifically-solved-for one\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI try to code my scripts to be as universal as possible, usings sensor where possible and assuming nothing that does not have to be assumed. But what you are doing is in another league.\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022http://i926.photobucket.com/albums/ad104/tuffguy1979/0gNvwh.jpg\u0022 rel=\u0022external nofollow\u0022\u003E\u0026lt;Appropiate pic\u0026gt;\u003C/a\u003E\u003C/p\u003E\n"},{"CreatedByName":"Seanner","CreatedById":91816,"CreatedDateTime":"2013-11-21T18:07:31Z","Content":"\n\u003Cp\u003EBut why would they make it 9.82?! This throws off everything. I don\u0027t even know which way is up. Launch angle = -pi/2 from now on.\u003C/p\u003E\n"},{"CreatedByName":"numerobis","CreatedById":62016,"CreatedDateTime":"2013-11-21T18:27:20Z","Content":"\n\u003Cp\u003EAs long as you mount the rockets on the opposite side of the rocket, that launch angle works fine.\u003C/p\u003E\n"},{"CreatedByName":"mhoram","CreatedById":78756,"CreatedDateTime":"2013-12-23T14:49:36Z","Content":"\n\u003Cp\u003EFinally I got PSOPT running thanks to alterbaron. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EFirst I will have a look at alterbaron\u0027s \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/46194-I-need-someone-help-me-do-some-math-for-launch-optimization?p=620581\u0026amp;viewfull=1#post620581\u0022 rel=\u0022external nofollow\u0022\u003Eformulation\u003C/a\u003E and solution - and have a look at how it might be extended: the multistage-problem is very appealing to me.\u003C/p\u003E\n"},{"CreatedByName":"tavert","CreatedById":57383,"CreatedDateTime":"2013-12-23T21:55:00Z","Content":"\n\u003Cp\u003ECool, did you take notes about what you had to tweak to get it to run? I never actually ran alterbaron\u0027s PSOPT code, but I have tried implementing something similar off-and-on in various other tools (ACADO, Pyomo, Mathematica, custom OSiL) and nothing has quite worked yet.\u003C/p\u003E\n"},{"CreatedByName":"mhoram","CreatedById":78756,"CreatedDateTime":"2013-12-27T20:25:14Z","Content":"\n\u003Cp\u003ESorry no, but feel free to ask if you run into any problems. There were some manual adjustments needed.\u003C/p\u003E\n"},{"CreatedByName":"mhoram","CreatedById":78756,"CreatedDateTime":"2013-12-27T23:25:55Z","Content":"\n\u003Cp\u003EThis project kind of resulted in another ...\u003C/p\u003E\u003Cp\u003ESince I need the KSP physics as part of the PSOPT source code, I have to implement the physics of KSP ... again in C/C\u002B\u002B.\u003C/p\u003E\u003Cp\u003EIt is time to gather all physics-related information in a single document.\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022https://www.dropbox.com/sh/jobzpt7feosc3rt/b4PwI_5WXi\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://www.dropbox.com/sh/jobzpt7feosc3rt/b4PwI_5WXi\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EAnd here is the repository for the documentation: \u003Ca href=\u0022https://github.com/mhoram-kerbin/ksp-physics-documentation\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/mhoram-kerbin/ksp-physics-documentation\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EBe aware ... it is still work in progress.\u003C/p\u003E\n"},{"CreatedByName":"mhoram","CreatedById":78756,"CreatedDateTime":"2013-12-31T18:50:06Z","Content":"\n\u003Cp\u003EI managed to implement my first testrocket in PSOPT.\u003C/p\u003E\u003Cp\u003EIn contrast to \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/46194-I-need-someone-help-me-do-some-math-for-launch-optimization?p=632024\u0026amp;viewfull=1#post632024\u0022 rel=\u0022external nofollow\u0022\u003Ealterbarons implementation\u003C/a\u003E I use a full 3d coordinate representation.\u003C/p\u003E\u003Cp\u003EThe target was to optimize the thrust in such a way that maximizes the rocket\u0027s mass at the point in time where the orbit\u0027s periapsis reaches 75km.\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022text-decoration:underline;\u0022\u003EEdit: These results are based on a wrong implementation of the KSP physics and should be ignored\u003C/span\u003E\u003C/p\u003E\u003Cblockquote lang=\u0022en\u0022\u003E\u003Ca href=\u0022//imgur.com/a/9IwyN\u0022 rel=\u0022external nofollow\u0022\u003EJavascript is disabled. View full album\u003C/a\u003E\u003C/blockquote\u003E\u003Cp\u003ELaunches at 0\u00C3\u201A\u00C2\u00B05\u002749\u0022 South like the Kerbal Space Port and has two stages\u003C/p\u003E\u003Cp\u003EAccording to the theoretical results, it has a final mass of 1880 kg.\u003C/p\u003E\u003Cp\u003EMechjeb (10, 70, 0 40) performed worse with a final mass of 1814 kg. (these are my default values and I did not try to optimize them for this rocket)\u003C/p\u003E\u003Cp\u003EOne thing I find strange and can not explain is why the gravity turn starts directly after liftoff. Orientation-pitch is near 80\u00C3\u201A\u00C2\u00B0 at the time of liftoff.\u003C/p\u003E\u003Cp\u003ESource: \u003Ca href=\u0022https://github.com/mhoram-kerbin/ksp-launch-optimizer/tree/38d382fba55b5e54a913c217f9988f9998d2caf1\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/mhoram-kerbin/ksp-launch-optimizer/tree/38d382fba55b5e54a913c217f9988f9998d2caf1\u003C/a\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-01-08T23:11:52Z\u0022 title=\u002201/08/2014 11:11  PM\u0022 data-short=\u002210 yr\u0022\u003EJanuary 8, 2014\u003C/time\u003E by mhoram\u003C/strong\u003E\n\u003Cbr\u003Ewrong results\n\u003C/span\u003E\n"},{"CreatedByName":"Kasuha","CreatedById":81781,"CreatedDateTime":"2013-12-31T19:30:29Z","Content":"\n\u003Cp\u003EInteresting.\u003C/p\u003E\u003Cp\u003ERegarding the pitch, probably the benefit of extra horizontal speed exceeds the loss of longer travel in thicker atmosphere.\u003C/p\u003E\u003Cp\u003EAnother thing that came to my mind was that upper atmosphere is moving at higher speed than surface. But the difference is not that big - at 10 km it\u0027s just about 3 m/s.\u003C/p\u003E\u003Cp\u003EIt might be interesting to see the angular difference between motion vector and thrust vector over the ascent.\u003C/p\u003E\u003Cp\u003EThe thing that I find strange is that it is increasing thrust right before the staging.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-12-31T19:50:27Z\u0022 title=\u002212/31/2013 07:50  PM\u0022 data-short=\u002210 yr\u0022\u003EDecember 31, 2013\u003C/time\u003E by Kasuha\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"tavert","CreatedById":57383,"CreatedDateTime":"2014-01-01T08:57:14Z","Content":"\n\u003Cp\u003EWell, for one thing your drag force is being applied in the direction opposite to orbital velocity instead of surface velocity.\u003C/p\u003E\n"},{"CreatedByName":"mhoram","CreatedById":78756,"CreatedDateTime":"2014-01-01T15:08:07Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022tavert\u0022 data-cite=\u0022tavert\u0022\u003E\u003Cdiv\u003EWell, for one thing your drag force is being applied in the direction opposite to orbital velocity instead of surface velocity.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYou are so right. Thanks for the review! Now the pitch seems much more reasonable.\u003C/p\u003E\u003Cp\u003EFinal mass: 1856 kg\u003C/p\u003E\u003Cp\u003EI should add that for the implementation I assume that above 70km there is still an atmosphere that causes drag. Using a density of 0 caused inconsistencies in the calculations. Perhaps I will multiply it with a modified arctan(altitude) function - tests will follow.\u003C/p\u003E\u003Cblockquote lang=\u0022en\u0022\u003E\u003Ca href=\u0022//imgur.com/a/ZAhQr\u0022 rel=\u0022external nofollow\u0022\u003EJavascript is disabled. View full album\u003C/a\u003E\u003C/blockquote\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Kasuha\u0022 data-cite=\u0022Kasuha\u0022\u003E\u003Cdiv\u003EIt might be interesting to see the angular difference between motion vector and thrust vector over the ascent.\u003Cp\u003EThe thing that I find strange is that it is increasing thrust right before the staging.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI added pitch of motion (ground vel and orbit vel) to the graphs - and also the thrust.\u003C/p\u003E\u003Cp\u003EAnd the increase in thrust before staging is quite simple: at that altitude that atmospheric drag decreases and allows a faster velocity, so the thrust increases. At this altitude the terminal velocity increases faster than the rocket can increase it\u0027s velocity.\u003C/p\u003E\u003Cp\u003Esource: \u003Ca href=\u0022https://github.com/mhoram-kerbin/ksp-launch-optimizer/tree/a97d823df7b5ae7ae1bd8c9de0ecf79ed992ef97\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/mhoram-kerbin/ksp-launch-optimizer/tree/a97d823df7b5ae7ae1bd8c9de0ecf79ed992ef97\u003C/a\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-01-08T23:13:13Z\u0022 title=\u002201/08/2014 11:13  PM\u0022 data-short=\u002210 yr\u0022\u003EJanuary 8, 2014\u003C/time\u003E by mhoram\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"tavert","CreatedById":57383,"CreatedDateTime":"2014-01-01T15:51:18Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022mhoram\u0022 data-cite=\u0022mhoram\u0022\u003E\u003Cdiv\u003EYou are so right. Thanks for the review! Now the pitch seems much more reasonable.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThanks for posting your source. Linus\u0027 law, given enough eyeballs all bugs are shallow. Looks like you\u0027re getting closer to something usable and useful here. Just needs some setup guidance for anyone other than you or alterbaron to get PSOPT working from a clean slate. Have you ever used Travis CI? Could be worth setting up here, gives you free testing and helps you establish a blueprint for how to set up the dependencies in a controlled environment.\u003C/p\u003E\u003Cp\u003EIt\u0027s a pretty minor difference, but I recommend using the gravitational parameter (aka mu or G*M) instead of G and M individually, since I believe planet mass is a derived quantity in the game. The product is the value that really matters.\u003C/p\u003E\u003Cp\u003EMakes no difference for Kerbin, but the wiki\u0027s a bit confusing on atmosphere height - you should use the version that does not depend on sea-level pressure. The second equation on the wiki that depends on sea-level pressure gives the wrong values. On Eve for example, the atmosphere ends just under 97 km, or ln(10^6) = 13.8 times the scale height.\u003C/p\u003E\u003Cp\u003EFor handling the atmosphere cutoff you could either try a sigmoidal function (arctan, or tanh, or erf, or a logistic function - watch out for overflow though) to smooth out the small discontinuity in pressure, or make 2 assumptions: that the last staging event happens before the craft leaves the atmosphere, and the craft only leaves the atmosphere once (doesn\u0027t reach apoapsis then start falling back into the atmosphere before it gets into orbit, might happen for low TWR). With those assumptions, you could add another problem phase for the final portion of the trajectory that happens in vacuum.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022mhoram\u0022 data-cite=\u0022mhoram\u0022\u003E\u003Cdiv\u003EAnd the increase in thrust before staging is quite simple: at that altitude that atmospheric drag decreases and allows a faster velocity, so the thrust increases. At this altitude the terminal velocity increases faster than the rocket can increase it\u0027s velocity.\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EIt\u0027s started to pitch over by that point so the story\u0027s a little more complicated than that I suspect.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-01-01T16:30:06Z\u0022 title=\u002201/01/2014 04:30  PM\u0022 data-short=\u002210 yr\u0022\u003EJanuary 1, 2014\u003C/time\u003E by tavert\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"mhoram","CreatedById":78756,"CreatedDateTime":"2014-01-02T21:06:37Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022tavert\u0022 data-cite=\u0022tavert\u0022\u003E\u003Cdiv\u003EJust needs some setup guidance for anyone other than you or alterbaron to get PSOPT working from a clean slate. Have you ever used Travis CI? Could be worth setting up here, gives you free testing and helps you establish a blueprint for how to set up the dependencies in a controlled environment.\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EHave not yet used Travid CI. Looks interesting - but with that much theory during the last few days, I would like to get back playing a little bit ;-)\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022tavert\u0022 data-cite=\u0022tavert\u0022\u003E\u003Cdiv\u003E\u003Cp\u003EThe second equation on the wiki that depends on sea-level pressure gives the wrong values.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYou are right that the wiki contradicts itself on the same page.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022tavert\u0022 data-cite=\u0022tavert\u0022\u003E\u003Cdiv\u003E\u003Cp\u003EFor handling the atmosphere cutoff you could either try a sigmoidal function (arctan, or tanh, or erf, or a logistic function - watch out for overflow though) to smooth out the small discontinuity in pressure, or make 2 assumptions: that the last staging event happens before the craft leaves the atmosphere, and the craft only leaves the atmosphere once (doesn\u0027t reach apoapsis then start falling back into the atmosphere before it gets into orbit, might happen for low TWR). With those assumptions, you could add another problem phase for the final portion of the trajectory that happens in vacuum.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EFirst I will test the sigmodial functions, because setting up an additional phase in PSOPT is more complicated.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-01-02T21:15:41Z\u0022 title=\u002201/02/2014 09:15  PM\u0022 data-short=\u002210 yr\u0022\u003EJanuary 2, 2014\u003C/time\u003E by mhoram\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"mhoram","CreatedById":78756,"CreatedDateTime":"2014-01-06T00:12:46Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022mhoram\u0022 data-cite=\u0022mhoram\u0022\u003E\u003Cdiv\u003EFirst I will test the sigmodial functions, because setting up an additional phase in PSOPT is more complicated.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EAs it seems PSOPT has problems finding a solution when the pressure is multiplied with a logistic function.\u003C/p\u003E\u003Cp\u003EMultiplying it with (1 / (1 \u002B exp(f * (altitude - AtmosphericHeight)))) makes the solving-algorithm not converge for f \u0026gt; 0.001.\u003C/p\u003E\u003Cp\u003ESo I will stick with the unmodified (wrong) pressure function, since this modified version causes a considerable amount of approximation error for f = 0.001.\u003C/p\u003E\u003Cp\u003EAs an input for the calculation one needs mass, propellant mass, ISP_1ATM and ISP_VAC for each stage. Since there is no easy way to get these infos from an existing rocket (MechJeb and Engineer redux lack this functionality for getting ISP), I am currently writing a plugin in the very early stages to get these infos directly from the VAB. It is available under GPLV3 at \u003Ca href=\u0022https://github.com/mhoram-kerbin/psopt-integrator\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/mhoram-kerbin/psopt-integrator\u003C/a\u003E.\u003C/p\u003E\n"}]}