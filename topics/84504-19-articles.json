{"TopicId":84504,"ForumId":34,"TopicTitle":"[old thread] Trajectories : atmospheric predictions","CreatedByName":"Youen","CreatedById":116909,"CreatedDateTime":"2014-09-13T15:42:57Z","PageNum":19,"Articles":[{"CreatedByName":"Baythan","CreatedById":18815,"CreatedDateTime":"2014-12-18T04:11:24Z","Content":"\n\u003Cp\u003EI too am hoping this gets updated to 0.90, but the changes to the tracking station probably made it harder to implement this feature. Patched conics is unavailable at the start, so my guess is that there was a major change to the code this plugin runs on. We should give Youen plenty of time to look into things and see what it will take to update. I might be wrong and it\u0027s an easy fix... but it would surprise me if it is simple.\u003C/p\u003E\n"},{"CreatedByName":"Ald","CreatedById":121195,"CreatedDateTime":"2014-12-18T10:53:01Z","Content":"\n\u003Cp\u003EThere was a similar problem with Enhanced Navball. All markers glued to the heading pointer untill you\u0027ve upgraded tracking station from lvl1 to lvl2. Yet still it did produce quite a bit of warnings while functioning.\u003C/p\u003E\n"},{"CreatedByName":"Spheniscine","CreatedById":125755,"CreatedDateTime":"2014-12-19T12:13:00Z","Content":"\n\u003Cp\u003EIt does seem to work correctly once you get Tracking Station 2.\u003C/p\u003E\n"},{"CreatedByName":"jlcarneiro","CreatedById":79196,"CreatedDateTime":"2014-12-19T14:00:43Z","Content":"\n\u003Cp\u003ESo all is needed is to code some kind of test do make it unavailable until the player has bought Tracking Station Tier 2. Am I right?\u003C/p\u003E\n"},{"CreatedByName":"mic_e","CreatedById":60757,"CreatedDateTime":"2014-12-19T15:04:10Z","Content":"\n\u003Cp\u003E@jlcarneiro: It _does_ make sense from the gameplay perspective, and sounds about right.\u003C/p\u003E\u003Cp\u003EI wonder how many mods will disable parts of their functionality depending on carreer progress...\u003C/p\u003E\n"},{"CreatedByName":"theersink","CreatedById":130163,"CreatedDateTime":"2014-12-20T07:23:54Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Spheniscine\u0022 data-cite=\u0022Spheniscine\u0022\u003E\u003Cdiv\u003EIt does seem to work correctly once you get Tracking Station 2.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ENot for me no trajectory lines at Lvl 2, I can pull up the menu but no overlay on the orbit.\u003C/p\u003E\n"},{"CreatedByName":"balaji.g","CreatedById":132714,"CreatedDateTime":"2014-12-20T07:26:09Z","Content":"\n\u003Cp\u003EYeah good tool\u003C/p\u003E\n"},{"CreatedByName":"Youen","CreatedById":116909,"CreatedDateTime":"2014-12-20T10:30:59Z","Content":"\n\u003Cp\u003EI wasn\u0027t even aware a new version of KSP was out :-/\u003C/p\u003E\u003Cp\u003E I\u0027ve stopped playing KSP for some time now. I\u0027ll take a look if I find some time and motivation, but honestly, if someone wants to take over the development of this mod, let me know :-)\u003C/p\u003E\u003Cp\u003ESome info if anyone is interested:\u003C/p\u003E\u003Cp\u003E- there are a few modifications that are already on gihub but not released as a binary yet\u003C/p\u003E\u003Cp\u003E- I\u0027d suggest to drop the automated testing part, it\u0027s already broken and requires too much work to upgrade to new KSP versions\u003C/p\u003E\u003Cp\u003E- Compiling the code should be simple in visual studio : clone the repository, set the references to kerbal DLLs depending on where you installed the game, and build.\u003C/p\u003E\u003Cp\u003E- To speed up the development cycle, you can set the path of your game in the .csproj file, then pressing ctrl\u002Bf5 in visual studio (while in debug mode) will compile, place the mod in the game, start the game, and automatically load the default save game and fly the first ship in the list\u003C/p\u003E\u003Cp\u003E- the version of the assembly must be incremented before each release, updated on \u003Ca href=\u0022http://ksp-avc.cybutek.net\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://ksp-avc.cybutek.net\u003C/a\u003E, and the Trajectories.version file must be overwriten by the new one\u003C/p\u003E\u003Cp\u003E- when building in release mode (visual studio), a zip is automatically created, next to the sln file, that can be uploaded as a new release on github and kerbal stuff\u003C/p\u003E\n"},{"CreatedByName":"Kobymaru","CreatedById":107372,"CreatedDateTime":"2014-12-20T13:47:55Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Youen\u0022 data-cite=\u0022Youen\u0022\u003E\u003Cdiv\u003EI wasn\u0027t even aware a new version of KSP was out :-/\u003Cp\u003E I\u0027ve stopped playing KSP for some time now. I\u0027ll take a look if I find some time and motivation, but honestly, if someone wants to take over the development of this mod, let me know :-)\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThat\u0027s not-so-great news. Your mod was a nice alternative to MechJebs landing predictions.\u003C/p\u003E\u003Cp\u003EAnyway, I\u0027m a programmer myself, and I have interest in getting involved with KSP mods. I am a complete Unity/C#/Modding noob however. I wanted to start out easy and contribute to existing mods, but your mod might be a good a starting point as any.\u003C/p\u003E\u003Cp\u003EIf you could stick around a while and give me some pointers, I could try getting it to work for .90. Interested?\u003C/p\u003E\u003Cp\u003EEdit:\u003C/p\u003E\u003Cp\u003EOk, so I \u003C/p\u003E\u003Cp\u003E - forked your Repo\u003C/p\u003E\u003Cp\u003E - disabled AutomatedTesting and TestAutomation\u003C/p\u003E\u003Cp\u003E - Bumped the version number\u003C/p\u003E\u003Cp\u003E - Recompiled and uploaded to here: \u003Ca href=\u0022https://github.com/fat-lobyte/KSPTrajectories/releases/download/v1.1.0.0-pre3/Trajectories-1.1.0.0-pre.zip\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/fat-lobyte/KSPTrajectories/releases/download/v1.1.0.0-pre3/Trajectories-1.1.0.0-pre.zip\u003C/a\u003E\u003C/p\u003E\u003Cp\u003E - Tested it.\u003C/p\u003E\u003Cp\u003EAll seems to work. No crashes, no errors in the log file, all GUI is available and since I figured out that you should check \u0022Body-Fixed mode\u0022, it\u0027s even super-accurate (landed at the KSC after making a deorbit burn at phase angle ~330\u00C3\u201A\u00C2\u00B0) \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EI don\u0027t know how this AVC / CKAN busyness all works, but since it\u0027s working nicely, I\u0027d recommend that you upload it so people can make use of it.\u003C/p\u003E\u003Cp\u003EEdit 2: Does not work with Ferram Aerospace yet.\u003C/p\u003E\u003Cp\u003EModerator edit:\u003C/p\u003E\u003Cp\u003ESource: \u003Ca href=\u0022https://github.com/fat-lobyte/KSPTrajectories\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/fat-lobyte/KSPTrajectories\u003C/a\u003E\u003C/p\u003E\u003Cp\u003ELicense: \u003Ca href=\u0022https://github.com/fat-lobyte/KSPTrajectories/blob/master/License.txt\u0022 rel=\u0022external nofollow\u0022\u003EMIT\u003C/a\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-12-21T21:50:53Z\u0022 title=\u002212/21/2014 09:50  PM\u0022 data-short=\u00229 yr\u0022\u003EDecember 21, 2014\u003C/time\u003E by Master Tao\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Youen","CreatedById":116909,"CreatedDateTime":"2014-12-20T14:22:14Z","Content":"\n\u003Cp\u003ESure, sounds good :-)\u003C/p\u003E\u003Cp\u003ELet me know if you have issues getting the code, building it, etc.\u003C/p\u003E\u003Cp\u003EI don\u0027t have any clue as to what goes wrong with 0.90 though. Also, I\u0027m afraid debugging KSP mods is really a pain, because there is no debugger that works (as far as I know). So you have to write stuff in the log file, or on the screen.\u003C/p\u003E\n"},{"CreatedByName":"BSimmons4Prez","CreatedById":98933,"CreatedDateTime":"2014-12-20T15:32:53Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Kobymaru\u0022 data-cite=\u0022Kobymaru\u0022\u003E\u003Cdiv\u003EThat\u0027s not-so-great news. Your mod was a nice alternative to MechJebs landing predictions.\u003Cp\u003EEdit:\u003C/p\u003E\u003Cp\u003EOk, so I \u003C/p\u003E\u003Cp\u003E - forked your Repo\u003C/p\u003E\u003Cp\u003EAll seems to work. No crashes, no errors in the log file, all GUI is available and since I figured out that you should check \u0022Body-Fixed mode\u0022, it\u0027s even super-accurate (landed at the KSC after making a deorbit burn at phase angle ~330\u00C3\u201A\u00C2\u00B0) \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EEdit 2: Does not work with Ferram Aerospace yet.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EAwesome news. I\u0027ll keep my eye on this for when it has FAR support\u003C/p\u003E\n"},{"CreatedByName":"Geschosskopf","CreatedById":69507,"CreatedDateTime":"2014-12-20T15:50:39Z","Content":"\n\u003Cp\u003EKobymaru\u0027s version seems to work perfectly with stock air at least. Thanks for keeping this going.\u003C/p\u003E\n"},{"CreatedByName":"Kobymaru","CreatedById":107372,"CreatedDateTime":"2014-12-20T16:18:25Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022BSimmons4Prez\u0022 data-cite=\u0022BSimmons4Prez\u0022\u003E\u003Cdiv\u003EAwesome news. I\u0027ll keep my eye on this for when it has FAR support\u003C/div\u003E\u003C/blockquote\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Geschosskopf\u0022 data-cite=\u0022Geschosskopf\u0022\u003E\u003Cdiv\u003EKobymaru\u0027s version seems to work perfectly with stock air at least. Thanks for keeping this going.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThanks guys. Don\u0027t expect to much though, I don\u0027t have any Aerodynamics knowledge \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_sad.gif\u0022 alt=\u0022:(\u0022\u003E\u003C/p\u003E\u003Cp\u003EAnd now for some tech talk... Do we have an Add-On development Thread for this?\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Youen\u0022 data-cite=\u0022Youen\u0022\u003E\u003Cdiv\u003ELet me know if you have issues getting the code, building it, etc.\u003Cp\u003EI don\u0027t have any clue as to what goes wrong with 0.90 though. Also, I\u0027m afraid debugging KSP mods is really a pain, because there is no debugger that works (as far as I know). So you have to write stuff in the log file, or on the screen.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E \u003Cp\u003EAbout FAR: \u003C/p\u003E\u003Cp\u003ESo I fixed the obvious method loading error in \u003Ca href=\u0022https://github.com/fat-lobyte/KSPTrajectories/commit/b1e5a9ccfc724adac9b18ac58c5f8bc61037fd78\u0022 rel=\u0022external nofollow\u0022\u003Eb1e5a9 \u003C/a\u003E. Now it \u0022kinda\u0022 works. That means that as long as you\u0027re suborbital, you get a nice trajectory. But:\u003C/p\u003E\u003Cp\u003E- If the trajectories are enabled, I get tons of \u0022FAR Error: Aerodynamic force = NaN \u0022. What\u0027s up with that?\u003C/p\u003E\u003Cp\u003E- When you are Orbital and either actually go Suborbital or make a Maneuver node that does that and having Trajectories active, the game freezes up without any errors in the logs. Not cool. Any Idea how to debug this?\u003C/p\u003E\n"},{"CreatedByName":"spaceman_spff","CreatedById":131218,"CreatedDateTime":"2014-12-20T16:23:14Z","Content":"\n\u003Cp\u003EThanks for this Kobymaru, I\u0027m testing it out now. I\u0027ll be attempting a landing on Eve this morning.\u003C/p\u003E\n"},{"CreatedByName":"theersink","CreatedById":130163,"CreatedDateTime":"2014-12-20T17:37:35Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Kobymaru\u0022 data-cite=\u0022Kobymaru\u0022\u003E\u003Cdiv\u003EThanks guys. Don\u0027t expect to much though, I don\u0027t have any Aerodynamics knowledge \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_sad.gif\u0022 alt=\u0022:(\u0022\u003E\u003Cp\u003EAnd now for some tech talk... Do we have an Add-On development Thread for this?\u003C/p\u003E\u003Cp\u003EAbout FAR: \u003C/p\u003E\u003Cp\u003ESo I fixed the obvious method loading error in \u003Ca href=\u0022https://github.com/fat-lobyte/KSPTrajectories/commit/b1e5a9ccfc724adac9b18ac58c5f8bc61037fd78\u0022 rel=\u0022external nofollow\u0022\u003Eb1e5a9 \u003C/a\u003E. Now it \u0022kinda\u0022 works. That means that as long as you\u0027re suborbital, you get a nice trajectory. But:\u003C/p\u003E\u003Cp\u003E- If the trajectories are enabled, I get tons of \u0022FAR Error: Aerodynamic force = NaN \u0022. What\u0027s up with that?\u003C/p\u003E\u003Cp\u003E- When you are Orbital and either actually go Suborbital or make a Maneuver node that does that and having Trajectories active, the game freezes up without any errors in the logs. Not cool. Any Idea how to debug this?\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EMight shoot a PM to ferram and see if he has any ideas. Perhaps post something in general development thread. Sounds like it is not interpreting the data from FAR correctly.\u003C/p\u003E\n"},{"CreatedByName":"Cydonian Monk","CreatedById":69224,"CreatedDateTime":"2014-12-20T19:27:06Z","Content":"\n\u003Cp\u003EKobymaru,\u003C/p\u003E\u003Cp\u003EThanks for picking this up. And thanks Youen for allowing such a transition. \u003C/p\u003E\u003Cp\u003EYour rebuild works well for me on everything except early career when Patched Conics haven\u0027t been unlocked in the Tracking Station due to an existing bug exposed by the new Upgradeable Facilities. In Trajectory.cs, Line #228 \u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Ebool finished = !partialComputation_.MoveNext();\u003C/pre\u003E\u003Cp\u003E attempts to do a MoveNext() on partialComputation_, in a situation where partialComputation_ has already been Dispose()ed (3 lines above, #225). (At least I think that\u0027s what\u0027s up based on my quick skimming of the code.) I fixed this by repeating the null check on partialComputation_ after exiting the block that Dispose()ed it, returning if null, but there might be a more elegant or correct solution.\u003C/p\u003E\u003Cp\u003EA different issue occurs when pressing the \u0022Update Now\u0022 button, MapGUI.cs in MainWindow line #152 where it performs an InvalidateAerodynamicModel(). I\u0027ve not looked into why, but it would appear aerodynamicModel_ is null at that point. (Possibly because it was never instantiated because it wasn\u0027t valid for the vessel? (Trajectory.cs, line #253.))\u003C/p\u003E\u003Cp\u003EThe above two can be replicated by starting a fresh Career game, launching a vessel, going to the Map View and enabling Trajectories. I can send you an output log if you need it, but it was a reliably repeatable NRE for me.\u003C/p\u003E\u003Cp\u003EI\u0027m wondering if most of the plugin should be disabled when Patched Conics haven\u0027t been unlocked through TrackingStation upgrades, and got as much working last night, but doing that might be adding complexity to solve a problem that goes away on its own. The code seems robust enough to handle such a situation already. \u003C/p\u003E\u003Cp\u003EAnyway, hope that helps.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-12-20T19:31:47Z\u0022 title=\u002212/20/2014 07:31  PM\u0022 data-short=\u00229 yr\u0022\u003EDecember 20, 2014\u003C/time\u003E by Cydonian Monk\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"theersink","CreatedById":130163,"CreatedDateTime":"2014-12-20T20:37:56Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Kobymaru\u0022 data-cite=\u0022Kobymaru\u0022\u003E\u003Cdiv\u003EThat\u0027s not-so-great news. Your mod was a nice alternative to MechJebs landing predictions.\u003Cp\u003EAnyway, I\u0027m a programmer myself, and I have interest in getting involved with KSP mods. I am a complete Unity/C#/Modding noob however. I wanted to start out easy and contribute to existing mods, but your mod might be a good a starting point as any.\u003C/p\u003E\u003Cp\u003EIf you could stick around a while and give me some pointers, I could try getting it to work for .90. Interested?\u003C/p\u003E\u003Cp\u003EEdit:\u003C/p\u003E\u003Cp\u003EOk, so I \u003C/p\u003E\u003Cp\u003E - forked your Repo\u003C/p\u003E\u003Cp\u003E - disabled AutomatedTesting and TestAutomation\u003C/p\u003E\u003Cp\u003E - Bumped the version number\u003C/p\u003E\u003Cp\u003E - Recompiled and uploaded to here: \u003Ca href=\u0022https://github.com/fat-lobyte/KSPTrajectories/releases/download/v1.1.0.0-pre1/Trajectories-v1.1.0.0.zip\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/fat-lobyte/KSPTrajectories/releases/download/v1.1.0.0-pre1/Trajectories-v1.1.0.0.zip\u003C/a\u003E\u003C/p\u003E\u003Cp\u003E - Tested it.\u003C/p\u003E\u003Cp\u003EAll seems to work. No crashes, no errors in the log file, all GUI is available and since I figured out that you should check \u0022Body-Fixed mode\u0022, it\u0027s even super-accurate (landed at the KSC after making a deorbit burn at phase angle ~330\u00C3\u201A\u00C2\u00B0) \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EI don\u0027t know how this AVC / CKAN busyness all works, but since it\u0027s working nicely, I\u0027d recommend that you upload it so people can make use of it.\u003C/p\u003E\u003Cp\u003EEdit 2: Does not work with Ferram Aerospace yet.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI noticed you are packaging this with MM 2.5.1. That version is not compatible with KSP .90. Might want to update that.\u003C/p\u003E\n"},{"CreatedByName":"Baythan","CreatedById":18815,"CreatedDateTime":"2014-12-20T20:54:33Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022theersink\u0022 data-cite=\u0022theersink\u0022\u003E\u003Cdiv\u003EI noticed you are packaging this with MM 2.5.1. That version is not compatible with KSP .90. Might want to update that.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI\u0027d noticed this as well, my GameData folder has both MM 2.5.1 and 2.5.4 because one or two mods (this being one) comes with the 2.5.1 instead of the 2.5.4 version.\u003C/p\u003E\n"},{"CreatedByName":"Kobymaru","CreatedById":107372,"CreatedDateTime":"2014-12-20T23:31:46Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Cydonian Monk\u0022 data-cite=\u0022Cydonian Monk\u0022\u003E\u003Cdiv\u003EKobymaru,\u003Cp\u003EThanks for picking this up. And thanks Youen for allowing such a transition. \u003C/p\u003E\u003Cp\u003EYour rebuild works well for me on everything except early career when Patched Conics haven\u0027t been unlocked in the Tracking Station due to an existing bug exposed by the new Upgradeable Facilities. In Trajectory.cs, Line #228 \u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Ebool finished = !partialComputation_.MoveNext();\u003C/pre\u003E\u003Cp\u003E attempts to do a MoveNext() on partialComputation_, in a situation where partialComputation_ has already been Dispose()ed (3 lines above, #225). (At least I think that\u0027s what\u0027s up based on my quick skimming of the code.) I fixed this by repeating the null check on partialComputation_ after exiting the block that Dispose()ed it, returning if null, but there might be a more elegant or correct solution.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EOkay, now what the heck?\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cblockquote\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003Cbr\u003E\u003Cbr\u003E if (partialComputation_ == null)\u003Cbr\u003E UnityEngine.Debug.LogError(\u0022Trajectories: partialComputation_ is null but shouldnt be\u0022);\u003Cbr\u003E else\u003Cbr\u003E UnityEngine.Debug.LogWarning(\u0022Trajectories: partialComputation_ is not null\u0022);\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E bool finished = !partialComputation_.MoveNext();\u003Cbr\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003C/blockquote\u003E\u003Cp\u003Eproduces\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cblockquote\u003E\u003Cp\u003ETrajectories: partialComputation_ is not null\u003C/p\u003E\u003Cp\u003E(Filename: C:/BuildAgent/work/d63dfc6385190b60/artifacts/StandalonePlayerGenerated/UnityEngineDebug.cpp Line: 49)\u003C/p\u003E\u003Cp\u003ETrajectories: partialComputation_ is not null\u003C/p\u003E\u003Cp\u003E(Filename: C:/BuildAgent/work/d63dfc6385190b60/artifacts/StandalonePlayerGenerated/UnityEngineDebug.cpp Line: 49)\u003C/p\u003E\u003Cp\u003ENullReferenceException: Object reference not set to an instance of an object\u003C/p\u003E\u003Cp\u003E at Trajectories.Trajectory\u002B\u0026lt;computeTrajectoryIncrement\u0026gt;d__7.MoveNext () [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003C/p\u003E\u003Cp\u003E at Trajectories.Trajectory.ComputeTrajectory (.Vessel vessel, Trajectories.DescentProfile profile, Boolean incremental) [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003C/p\u003E\u003Cp\u003E(Filename: Line: -1)\u003C/p\u003E\u003C/blockquote\u003E\u003Cp\u003EHow is that even possible? What is going on? NRE if its not even Null? SEND HELP \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_huh.gif\u0022 alt=\u0022:confused:\u0022\u003E\u003C/p\u003E\u003Cp\u003EI would give my firstborn to the Devil for a working debugger \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_sad.gif\u0022 alt=\u0022:(\u0022\u003E\u003C/p\u003E\u003Cp\u003EWhere exactly did you put the return statement?\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Cydonian Monk\u0022 data-cite=\u0022Cydonian Monk\u0022\u003E\u003Cdiv\u003E A different issue occurs when pressing the \u0022Update Now\u0022 button, MapGUI.cs in MainWindow line #152 where it performs an InvalidateAerodynamicModel(). I\u0027ve not looked into why, but it would appear aerodynamicModel_ is null at that point. (Possibly because it was never instantiated because it wasn\u0027t valid for the vessel? (Trajectory.cs, line #253.))\u003Cp\u003EThe above two can be replicated by starting a fresh Career game, launching a vessel, going to the Map View and enabling Trajectories. I can send you an output log if you need it, but it was a reliably repeatable NRE for me.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E Can\u0027t reproduce the second one (or It\u0027s so spammed with the first one that even Ctrl-F can\u0027t find it in the log \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif\u0022 alt=\u0022;)\u0022\u003E ) A log would actually be nice.\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Cydonian Monk\u0022 data-cite=\u0022Cydonian Monk\u0022\u003E\u003Cdiv\u003EI\u0027m wondering if most of the plugin should be disabled when Patched Conics haven\u0027t been unlocked through TrackingStation upgrades, and got as much working last night, but doing that might be adding complexity to solve a problem that goes away on its own. The code seems robust enough to handle such a situation already. \u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThat might be a good idea. What do you by mean \u0022a problem that goes away on its own\u0022? Since I am not familiar with the code, you will probably have better ideas than me.\u003C/p\u003E\u003Cp\u003EYour help is very appreciated, by the way!\u003C/p\u003E\n"},{"CreatedByName":"Kobymaru","CreatedById":107372,"CreatedDateTime":"2014-12-20T23:44:38Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022theersink\u0022 data-cite=\u0022theersink\u0022\u003E\u003Cdiv\u003EI noticed you are packaging this with MM 2.5.1. That version is not compatible with KSP .90. Might want to update that.\u003C/div\u003E\u003C/blockquote\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Baythan\u0022 data-cite=\u0022Baythan\u0022\u003E\u003Cdiv\u003EI\u0027d noticed this as well, my GameData folder has both MM 2.5.1 and 2.5.4 because one or two mods (this being one) comes with the 2.5.1 instead of the 2.5.4 version.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EFinally something I can fix \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 alt=\u0022:D\u0022\u003E\u003C/p\u003E\u003Cp\u003EThanks for the note, I updated the MM version in the latest build.\u003C/p\u003E\u003Cp\u003EDo not use with FAR, it will freeze up your game though.\u003C/p\u003E\n"},{"CreatedByName":"theersink","CreatedById":130163,"CreatedDateTime":"2014-12-21T01:06:28Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Kobymaru\u0022 data-cite=\u0022Kobymaru\u0022\u003E\u003Cdiv\u003EFinally something I can fix \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 alt=\u0022:D\u0022\u003E\u003Cp\u003EThanks for the note, I updated the MM version in the latest build.\u003C/p\u003E\u003Cp\u003EDo not use with FAR, it will freeze up your game though.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EHmm that could have been the reason it was freezing with FAR? Worth a shot.\u003C/p\u003E\n"},{"CreatedByName":"Cydonian Monk","CreatedById":69224,"CreatedDateTime":"2014-12-21T05:53:05Z","Content":"\n\u003Cp\u003EDebugging without a debugger is one of those joys those of us that do lots of embedded development get to practice. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif\u0022 alt=\u0022;)\u0022\u003E It\u0027s a good day when the system has gdb, and gdb actually works. Anyway....\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Kobymaru\u0022 data-cite=\u0022Kobymaru\u0022\u003E\u003Cdiv\u003E\u003Cp\u003EWhere exactly did you put the return statement?\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ELet me preface this by saying that caffeine should not be used as a replacement for sleep. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif\u0022 alt=\u0022;)\u0022\u003E Apparently I was skipping out of that code when partialComputation_ was not null, opposed to what I claimed this morning. (Doing that might cause other issues by not cleaning up the partial computations?) I blame 0.90 and some glitchy RFID stuff at work.\u003C/p\u003E\u003Cp\u003ESo, working through this....\u003C/p\u003E\u003Cp\u003EI split up the block of code that checks if partialComputation_ is null or if the vessel has changed to see if that would tell me more. Not really - every time it was null (as expected), and only when patched conics aren\u0027t unlocked does the MoveNext() cause the NRE. So then the issue is in the execution of computeTrajectoryIncrement performed by the MoveNext(). Digging into that revealed an issue in that function\u0027s for() loop.\u003C/p\u003E\u003Cp\u003EThere\u0027s a line in computeTrajectoryIncrement that attempts to get the Vessel.patchedConicSolver.maneuverNodes (line #267), yet patchedConicSolver is null. Makes sense as we\u0027re not even supposed to have Patched Conics yet. No reason for the game to instantiate that object. The most direct fix from there is self-evident:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cblockquote\u003E\u003Cp\u003ETrajectory.cs Line#267-278 get wrapped in a null check as such:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003Cbr\u003E if (null != vessel_.patchedConicSolver)\u003Cbr\u003E {\u003Cbr\u003E var maneuverNodes = vessel_.patchedConicSolver.maneuverNodes;\u003Cbr\u003E foreach (var node in maneuverNodes)\u003Cbr\u003E {\u003Cbr\u003E if (node.UT == state.time)\u003Cbr\u003E {\u003Cbr\u003E state.velocity \u002B= node.GetBurnVector(createOrbitFromState(state));\u003Cbr\u003E break;\u003Cbr\u003E }\u003Cbr\u003E }\u003Cbr\u003E foreach (var result in AddPatch(state, profile))\u003Cbr\u003E yield return false;\u003Cbr\u003E }\u003Cbr\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/blockquote\u003E\u003Cp\u003EThere is a similar issue in AddPatch, so that call must also be protected. Yet let\u0027s go ahead and fix that issue too instead of just hiding it. To do that, I added a check to the start of AddPatch() to see if the patchedConicsSolver exists, as such:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cblockquote\u003E\u003Cp\u003ETrajectory.cs code added above Line#325: \u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003Cbr\u003E if (null == vessel_.patchedConicSolver)\u003Cbr\u003E {\u003Cbr\u003E UnityEngine.Debug.LogWarning(\u0022Trajectories: AddPatch() attempted when patchedConicsSolver is null; Skipping.\u0022);\u003Cbr\u003E yield break;\u003Cbr\u003E }\u003Cbr\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/blockquote\u003E\u003Cp\u003EThere are still the usual number of executions on Update(), so this fix doesn\u0027t help so much with the (admittedly negligible) CPU load, but at least it resolves the logspam and the NREs.\u003C/p\u003E\u003Cp\u003EFeel free to use the above code snippets however you like. \u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Kobymaru\u0022 data-cite=\u0022Kobymaru\u0022\u003E\u003Cdiv\u003E\u003Cp\u003E Can\u0027t reproduce the second one (or It\u0027s so spammed with the first one that even Ctrl-F can\u0027t find it in the log \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif\u0022 alt=\u0022;)\u0022\u003E ) A log would actually be nice.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThat issue seems to have resolved itself by patching one of the other two functions.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Kobymaru\u0022 data-cite=\u0022Kobymaru\u0022\u003E\u003Cdiv\u003E\u003Cp\u003EThat might be a good idea. What do you by mean \u0022a problem that goes away on its own\u0022?\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EWell, the problem as I see it are the NREs that end up causing the logspam. If we resolve the NREs, which in turn prevents the trajectory from being displayed when PatchedConics aren\u0027t unlocked, then there\u0027s no need to disable the plugin. The \u0022problem\u0022 at that point becomes one of feedback to the user, who probably just wants to know why their trajectory isn\u0027t being displayed. A simple message in either the Trajectories window or an on-screen message might be enough to fix that.\u003C/p\u003E\u003Cp\u003EIf you want to start checking facility status, you\u0027re looking at some checks along the lines of:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003EGameVariables.OrbitDisplayMode.PatchedConics.Equals(ScenarioUpgradeableFacilities.GetFacilityLevel(SpaceCenterFacility.TrackingStation))\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EThat probably needs to be a range check though, for states that exist beyond PatchedConics. I\u0027ve not done much with the facility upgrade checks yet, so others might have better pointers. \u003C/p\u003E\u003Cp\u003EHope that helps.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-12-21T05:58:46Z\u0022 title=\u002212/21/2014 05:58  AM\u0022 data-short=\u00229 yr\u0022\u003EDecember 21, 2014\u003C/time\u003E by Cydonian Monk\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Youen","CreatedById":116909,"CreatedDateTime":"2014-12-21T10:07:26Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Kobymaru\u0022 data-cite=\u0022Kobymaru\u0022\u003E\u003Cdiv\u003Esince I figured out that you should check \u0022Body-Fixed mode\u0022, it\u0027s even super-accurate\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI\u0027m not sure to understand what you mean here. Body-fixed mode only changes how the trajectory is displayed (relative to the rotating frame of the body, instead of the inertial frame), but doesn\u0027t change the impact position (indicated by the red cross which is at the same place in both cases).\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Kobymaru\u0022 data-cite=\u0022Kobymaru\u0022\u003E\u003Cdiv\u003E\u003Cp\u003EI don\u0027t know how this AVC / CKAN busyness all works, but since it\u0027s working nicely, I\u0027d recommend that you upload it so people can make use of it.\u003C/p\u003E\u003Cp\u003EEdit 2: Does not work with Ferram Aerospace yet. \u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EMaybe would be worth waiting for it to work with FAR before releasing on AVC and Kerbal Stuff ? (people can still download version 1.1 on github in the meantime).\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Kobymaru\u0022 data-cite=\u0022Kobymaru\u0022\u003E\u003Cdiv\u003E\u003Cp\u003EAnd now for some tech talk... Do we have an Add-On development Thread for this?\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ENot yet, feel free to create one :-)\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Kobymaru\u0022 data-cite=\u0022Kobymaru\u0022\u003E\u003Cdiv\u003E\u003Cp\u003EAbout FAR: \u003C/p\u003E\u003Cp\u003ESo I fixed the obvious method loading error in \u003Ca href=\u0022https://github.com/fat-lobyte/KSPTrajectories/commit/b1e5a9ccfc724adac9b18ac58c5f8bc61037fd78\u0022 rel=\u0022external nofollow\u0022\u003Eb1e5a9 \u003C/a\u003E. Now it \u0022kinda\u0022 works. That means that as long as you\u0027re suborbital, you get a nice trajectory. But:\u003C/p\u003E\u003Cp\u003E- If the trajectories are enabled, I get tons of \u0022FAR Error: Aerodynamic force = NaN \u0022. What\u0027s up with that?\u003C/p\u003E\u003Cp\u003E- When you are Orbital and either actually go Suborbital or make a Maneuver node that does that and having Trajectories active, the game freezes up without any errors in the logs. Not cool. Any Idea how to debug this?\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ENo idea yet... Didn\u0027t have these issues with previous versions of FAR. The mod should not try to call FAR functions with out-of-atmosphere parameters, but maybe something changed and now it fails with almost 0 or 0 air density ?\u003C/p\u003E\n"},{"CreatedByName":"Youen","CreatedById":116909,"CreatedDateTime":"2014-12-21T10:28:48Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Kobymaru\u0022 data-cite=\u0022Kobymaru\u0022\u003E\u003Cdiv\u003E\u003Cp\u003EI would give my firstborn to the Devil for a working debugger \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_sad.gif\u0022 alt=\u0022:(\u0022\u003E\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003E\u003Ca href=\u0022http://buttersafe.com/2014/12/02/afairtrade/\u0022 rel=\u0022external nofollow\u0022\u003EYou might actually get him back in the end\u003C/a\u003E ;-)\u003C/p\u003E\n"},{"CreatedByName":"Youen","CreatedById":116909,"CreatedDateTime":"2014-12-21T10:33:34Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Cydonian Monk\u0022 data-cite=\u0022Cydonian Monk\u0022\u003E\u003Cdiv\u003E\u003Cp\u003EThere are still the usual number of executions on Update(), so this fix doesn\u0027t help so much with the (admittedly negligible) CPU load, but at least it resolves the logspam and the NREs.\u003C/p\u003E\u003Cp\u003EFeel free to use the above code snippets however you like. \u003C/p\u003E\u003Cp\u003EThat issue seems to have resolved itself by patching one of the other two functions.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EGlad you found the root cause :-) I don\u0027t think the CPU load is an issue, because it doesn\u0027t degrade the worst case (which is when trajectories are actually displayed).\u003C/p\u003E\n"}]}