{"TopicId":104535,"ForumId":34,"TopicTitle":"1.1.2 Magic Smoke Industries Infernal Robotics 2.0.2","CreatedByName":"sirkut","CreatedById":57229,"CreatedDateTime":"2015-04-20T21:18:38Z","PageNum":32,"Articles":[{"CreatedByName":"allmhuran","CreatedById":66124,"CreatedDateTime":"2016-03-05T19:10:11Z","Content":"\n\u003Cp\u003E\nI don\u0027t know of any way to make the joints themselves less wobbly. I know the IR peeps have looked at it a few times over many months\u00A0and there doesn\u0027t seem to be a solution, it\u0027s a KSP/unity engine thing as I recall. Something about the servo having to use a type of joint whose properties are set at a level that is inaccessible to modders.\n\u003C/p\u003E\n"},{"CreatedByName":"allmhuran","CreatedById":66124,"CreatedDateTime":"2016-03-06T06:08:37Z","Content":"\n\u003Cp\u003E\nI\u0027ve rewritten my code to use the KOS API and it is much nicer to read, but I have a problem:\u00A0There doesn\u0027t seem to be a way to disengage limits when using the API, so calls to :moveto() always result in \u0022snapping\u0022 when the target position is approached at high accelerations \u00A0Example at end of post.\n\u003C/p\u003E\n\u003Cp\u003E\nI fear that the\u00A0moveto() function is setting the limit and then just moving towards it, so disabling the limit wouldn\u0027t be possible, meaning there isn\u0027t a way to avoid the snapping when using the API.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nI know high accelerations are \u0022weird\u0022, but I don\u0027t think they should cause a problem. There\u0027s no problem when servos are starting to move, only when they are stopping.\u00A0When decelerating to a limit, can\u0027t the speed of the servo calculated by the acceleration behaviour\u00A0be clamped to a maximum no higher than the current speed? Maybe I should inform myself of the actual IR code. In any case, if there\u0027s no solution to be found then maybe an option to \u0022disable\u0022 the acceleration behaviour for a servo via the API/tweakable if desired?\u003Cbr\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan\u003Eif acceleration = -1 {\u00A0 // decelerating\n   servoSpeed = max(calculateAcceleratedSpeed(), currentServoSpeed); \n}\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nHere\u0027s the code:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan\u003Edeclare s is addons:ir:allservos[0].\n\ndeclare ms is list(list(0, 1), list(90, 2), list(45, 1), list(-45, 2)).\ndeclare i is 0.\n\nset s:acceleration to 500.\nset s:speed to 1.\n\nuntil false {\t\n\tif not s:ismoving {\n\t\ts:moveto(ms[i][0], ms[i][1]).\n\t\tset i to i \u002B 1.\n\t\tif i = 3 { set i to 0. }\n\t}\n}\n\t\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cdiv class=\u0022ipsEmbeddedOther\u0022 contenteditable=\u0022false\u0022\u003E\n\u003Ciframe data-controller=\u0022core.front.core.autoSizeIframe\u0022 src=\u0022https://forum.kerbalspaceprogram.com/?app=core\u0026amp;module=system\u0026amp;controller=embed\u0026amp;url=https%3A%2F%2Fgfycat.com%2FPoliticalSnarlingAztecant\u0026amp;key=PoliticalSnarlingAztecant\u0022\u003E\u003C/iframe\u003E\n\u003C/div\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-03-06T07:06:22Z\u0022 title=\u002203/06/2016 07:06  AM\u0022 data-short=\u00228 yr\u0022\u003EMarch 6, 2016\u003C/time\u003E by allmhuran\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Ziw","CreatedById":135292,"CreatedDateTime":"2016-03-06T07:38:44Z","Content":"\n\u003Cp\u003E\nInterpolator that accounts for acceleration has an edge case when servo approaches target position. Its not my code, but I\u0027ll take a look. For now you can try lower acceleration.\n\u003C/p\u003E\n"},{"CreatedByName":"allmhuran","CreatedById":66124,"CreatedDateTime":"2016-03-06T07:46:04Z","Content":"\n\u003Cp\u003E\nI hope a simple fix is as above.... ie, clamp the\u00A0result of the declerated speed calculation to a maximum of the current speed (obv not for acceleration since that would clamp the speed to 0 and it would never accelerate!)\u00A0\u003Cbr\u003E\u003Cbr\u003E\nUnfortunately I can\u0027t use a lower acceleration. I need the servo speeds to move from point A to point B in a known time T (because I\u0027m trying to keep several servos in synch), which means I need to call moveto(B, abs(B - A) / T). If the servos have any appreciable acceleration or deceleration, then the calculation doesn\u0027t work. I could try to factor the acceleration and deceleration into the calculation but I expect this will be more work than KOS can do in one frame (especially since it introduces\u00A0a dependency\u00A0where the timing depends on the acceleration of the servo that will take the longest to accelerate/declerate, and... well it\u0027s just really complicated), which makes the point moot since the timing will be out if update ticks occur while the calculation is being done.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-03-06T07:56:46Z\u0022 title=\u002203/06/2016 07:56  AM\u0022 data-short=\u00228 yr\u0022\u003EMarch 6, 2016\u003C/time\u003E by allmhuran\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Ziw","CreatedById":135292,"CreatedDateTime":"2016-03-06T08:01:29Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222444251\u0022 data-ipsquote-contentid=\u0022104535\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221457250364\u0022 data-ipsquote-userid=\u002266124\u0022 data-ipsquote-username=\u0022allmhuran\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n11 minutes ago, allmhuran said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nI hope a simple fix is as above.... ie, clamp the\u00A0result of the declerated speed calculation to a maximum of the current speed (obv not for acceleration since that would clamp the speed to 0 and it would never accelerate!)\u00A0\u003Cbr\u003E\u003Cbr\u003E\nUnfortunately I can\u0027t use a lower acceleration. I need the servo speeds to move from point A to point B in a known time T (because I\u0027m trying to keep several servos in synch), which means I need to call moveto(B, abs(B - A) / T). If the servos have any appreciable acceleration or deceleration, then the calculation doesn\u0027t work. I could try to factor the acceleration and deceleration into the calculation but I expect this will be more work than KOS can do in one frame (especially since it introduces\u00A0a dependency\u00A0where the timing depends on the acceleration of the servo that will take the longest to accelerate/declerate, and... well it\u0027s just really complicated), which makes the point moot since the timing will be out if update ticks occur while the calculation is being done.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThere is also a problem of a Physics tick\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://github.com/MagicSmokeIndustries/InfernalRobotics/blob/develop/InfernalRobotics/InfernalRobotics/Command/Interpolator.cs#L133\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/MagicSmokeIndustries/InfernalRobotics/blob/develop/InfernalRobotics/InfernalRobotics/Command/Interpolator.cs#L133\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nAs you see here there is plenty of clamping but i believe the problem is with this 10% overhead, which gets noticeable at you level of acceleration\n\u003C/p\u003E\n"},{"CreatedByName":"allmhuran","CreatedById":66124,"CreatedDateTime":"2016-03-06T08:04:58Z","Content":"\n\u003Cp\u003E\nAww crap.\u00A0Those damn physics ticks.\u003Cbr\u003E\u003Cbr\u003E\nEdit: Hang on, that\u0027s just the returning out of the\u00A0tick for the interpolator itself... surely a return from interpolator\u0027s update() doesn\u0027t force a return from the whole IR update(), preventing any other IR operations from occurring during that physics tick.... Again, I should probably look at the code myself to see all of this. But yeah, I definitely need to be able to move multiple servos in one tick.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-03-06T08:07:24Z\u0022 title=\u002203/06/2016 08:07  AM\u0022 data-short=\u00228 yr\u0022\u003EMarch 6, 2016\u003C/time\u003E by allmhuran\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Ziw","CreatedById":135292,"CreatedDateTime":"2016-03-06T08:06:47Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222444268\u0022 data-ipsquote-contentid=\u0022104535\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221457251498\u0022 data-ipsquote-userid=\u002266124\u0022 data-ipsquote-username=\u0022allmhuran\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nJust now, allmhuran said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nAww crap.\u00A0Those damn physics ticks.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nYou see from the line I linked that \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022http://forum.kerbalspaceprogram.com/index.php?/profile/85299-pellinor/\u0026amp;do=hovercard\u0022 data-mentionid=\u002285299\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/85299-pellinor/\u0022\u003E@pellinor\u003C/a\u003E\u00A0left a very generous margin for edge case - I can lower it and give you a custom dll to test out\n\u003C/p\u003E\n"},{"CreatedByName":"allmhuran","CreatedById":66124,"CreatedDateTime":"2016-03-06T08:09:58Z","Content":"\n\u003Cp\u003E\nYeah I see the problem. It is being overly careful about overshooting. Erm, one sec, let me think on that for a moment.\n\u003C/p\u003E\n"},{"CreatedByName":"Ziw","CreatedById":135292,"CreatedDateTime":"2016-03-06T08:13:17Z","Content":"\n\u003Cp\u003E\nhe uses mavDeltaVel (derived from max acceleration) instead of current velocity, I think that is where the problem lies\n\u003C/p\u003E\n"},{"CreatedByName":"allmhuran","CreatedById":66124,"CreatedDateTime":"2016-03-06T08:17:46Z","Content":"\n\u003Cp\u003E\nYeah, it looks backwards. A higher acceleration should allow it to get \u003Cem\u003Ecloser \u003C/em\u003Eto the limit before having to say \u0022I\u0027m probably going to cross the limit next frame, so just jump to the limit now\u0022. Ie, The better your brakes, the later you can hit them.\u00A0But instead, a higher acceleration is causing it to jump to the limit earlier.\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"Ziw","CreatedById":135292,"CreatedDateTime":"2016-03-06T08:37:50Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222444275\u0022 data-ipsquote-contentid=\u0022104535\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221457252266\u0022 data-ipsquote-userid=\u002266124\u0022 data-ipsquote-username=\u0022allmhuran\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n19 minutes ago, allmhuran said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nYeah, it looks backwards. A higher acceleration should allow it to get \u003Cem\u003Ecloser \u003C/em\u003Eto the limit before having to say \u0022I\u0027m probably going to cross the limit next frame, so just jump to the limit now\u0022. Ie, The better your brakes, the later you can hit them.\u00A0But instead, a higher acceleration is causing it to jump to the limit earlier.\u00A0\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nTry this build (re-uploaded the new dll)\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://github.com/MagicSmokeIndustries/InfernalRobotics/releases/tag/0.21.5-pre\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/MagicSmokeIndustries/InfernalRobotics/releases/tag/0.21.5-pre\u003C/a\u003E\n\u003C/p\u003E\n"},{"CreatedByName":"allmhuran","CreatedById":66124,"CreatedDateTime":"2016-03-06T08:40:44Z","Content":"\n\u003Cp\u003E\nRoger, grabbing it now. I have an intuition that this can all be much simpler and yet\u00A0more accurate, I\u0027m just trying to figure out the best solution \u003Cimg alt=\u0022:D\u0022 data-emoticon=\u0022true\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 title=\u0022:D\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"allmhuran","CreatedById":66124,"CreatedDateTime":"2016-03-06T08:49:32Z","Content":"\n\u003Cp\u003E\nYep, that fixes it for arbitrarily large accelerations!\n\u003C/p\u003E\n"},{"CreatedByName":"Ziw","CreatedById":135292,"CreatedDateTime":"2016-03-06T08:50:47Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222444295\u0022 data-ipsquote-contentid=\u0022104535\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221457254172\u0022 data-ipsquote-userid=\u002266124\u0022 data-ipsquote-username=\u0022allmhuran\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nJust now, allmhuran said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nYep, that fixes it for arbitrarily large accelerations!\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nGreat. If you come up with a better algo feel free post here or as a github issue.\n\u003C/p\u003E\n"},{"CreatedByName":"allmhuran","CreatedById":66124,"CreatedDateTime":"2016-03-06T08:54:28Z","Content":"\n\u003Cp\u003E\nIt doesn\u0027t seem necessary anymore \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022true\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E But I might think about it for fun anyway.\n\u003C/p\u003E\n\u003Cp\u003E\nThanks yet again, by the way.\n\u003C/p\u003E\n"},{"CreatedByName":"allmhuran","CreatedById":66124,"CreatedDateTime":"2016-03-06T09:15:08Z","Content":"\n\u003Cp\u003E\nLet me show you how much that helps with servo synchronization. Here\u0027s three quick clips back to back. First the old code with 500 acceleration (lol), then the old code with 50 acceleration (wobbly because servos aren\u0027t synched), finally the new code with acceleration 2000 (smooooth).\u003Cbr\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cdiv class=\u0022ipsEmbeddedOther\u0022 contenteditable=\u0022false\u0022\u003E\n\u003Ciframe data-controller=\u0022core.front.core.autoSizeIframe\u0022 src=\u0022https://forum.kerbalspaceprogram.com/?app=core\u0026amp;module=system\u0026amp;controller=embed\u0026amp;url=http%3A%2F%2Fgfycat.com%2FSereneNaughtyAdmiralbutterfly\u0026amp;key=SereneNaughtyAdmiralbutterfly\u0022\u003E\u003C/iframe\u003E\n\u003C/div\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-03-06T09:15:54Z\u0022 title=\u002203/06/2016 09:15  AM\u0022 data-short=\u00228 yr\u0022\u003EMarch 6, 2016\u003C/time\u003E by allmhuran\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"pellinor","CreatedById":85299,"CreatedDateTime":"2016-03-06T14:58:45Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222444270\u0022 data-ipsquote-contentid=\u0022104535\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221457251798\u0022 data-ipsquote-userid=\u002266124\u0022 data-ipsquote-username=\u0022allmhuran\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n6 hours ago, allmhuran said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nYeah I see the problem. It is being overly careful about overshooting. Erm, one sec, let me think on that for a moment.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nIn my understanding the underlying problem is that you are doing the interpolation yourself, and then the result is streamed to the IR interpolator which is told to come to a stop at each position.\n\u003C/p\u003E\n\u003Cp\u003E\nI think a cleaner way to handle this would be to offer a mode that tries to keep its target speed until reaching the target position, assuming he will get new commands on the fly. It would only brake after overshooting, or when approaching a hard limit. This could actually work without the realtime requirement of getting new positions every physics tick.\n\u003C/p\u003E\n\u003Cp\u003E\nAnother way is to disable/bypass the interpolation entirely (i.e. write positions directly). This is more or less what happens when you set huge acceleration values. There might still be a bit of weirdness here and there because it was not an intended use case when I wrote the interpolation code.\n\u003C/p\u003E\n\u003Cp\u003E\nOf course the silver bullet would be true synchronous interpolation, i.e. only one interpolator for a set of servos. You would give it a list of positions, then it would calculate its dynamics (maxSpeed/maxAcc) based on the distance and dynamics of the involved servos, and move them all in sync. This is pretty straightforward for basic linear motion, but can become a huge can of worms once you get nonlinear (e.g. change \u0027direction\u0027 without stopping).\n\u003C/p\u003E\n\u003Cp\u003E\nEdit: one more remark to the braking code: when determining maxSpeed from the distance to the limit, we are working on a SQRT curve, close to zero where it has a vertical tangent. So the problem is badly conditioned and the code for the last tick was done more or less by trial and error.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-03-06T15:12:06Z\u0022 title=\u002203/06/2016 03:12  PM\u0022 data-short=\u00228 yr\u0022\u003EMarch 6, 2016\u003C/time\u003E by pellinor\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Ziw","CreatedById":135292,"CreatedDateTime":"2016-03-06T15:05:07Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222444566\u0022 data-ipsquote-contentid=\u0022104535\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221457276325\u0022 data-ipsquote-userid=\u002285299\u0022 data-ipsquote-username=\u0022pellinor\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n6 minutes ago, pellinor said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nIn my understanding the underlying problem is that you are doing the interpolation yourself, and then the result is streamed to the IR interpolator which is told to come to a stop at each position.\n\u003C/p\u003E\n\u003Cp\u003E\nI think a cleaner way to handle this would be to offer a mode that tries to keep its target speed until reaching the target position, assuming he will get new commands on the fly. It would only brake after overshooting, or when approaching a hard limit. This could actually work without the realtime requirement of getting new positions every physics tick.\n\u003C/p\u003E\n\u003Cp\u003E\nAnother way is to disable/bypass the interpolation entirely (i.e. write positions directly). This is more or less what happens when you set huge acceleration values. There might still be a bit of weirdness here and there because it was not an intended use case when I wrote the interpolation code.\n\u003C/p\u003E\n\u003Cp\u003E\nOf course the silver bullet would be true synchronous interpolation, i.e. only one interpolator for a set of servos. You would give it a list of positions, then it would calculate its dynamics (maxSpeed/maxAcc) based on the distance and dynamics of the involved servos, and move them all in sync. This is pretty straightforward for basic linear motion, but can become a huge can of worms once you get nonlinear (e.g. change \u0027direction\u0027 without stopping).\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nHi, long time no see \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022true\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u00A0Here are the changes I made:\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://github.com/MagicSmokeIndustries/InfernalRobotics/pull/74/files#diff-e2ca92d8a9e6bebed32c75d95e97a475L133\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/MagicSmokeIndustries/InfernalRobotics/pull/74/files#diff-e2ca92d8a9e6bebed32c75d95e97a475L133\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nI moved the edge case check after the newVel is calculated and performed the check against it versus raw maxDeltaVel, which was too high in \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022http://forum.kerbalspaceprogram.com/index.php?/profile/66124-allmhuran/\u0026amp;do=hovercard\u0022 data-mentionid=\u002266124\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/66124-allmhuran/\u0022\u003E@allmhuran\u003C/a\u003E\u0027s case\n\u003C/p\u003E\n\u003Cp\u003E\nAs for option to disable the acceleration completely - I\u0027ll see whether it is possible to untie interpolation easily.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-03-06T15:06:25Z\u0022 title=\u002203/06/2016 03:06  PM\u0022 data-short=\u00228 yr\u0022\u003EMarch 6, 2016\u003C/time\u003E by Ziw\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"pellinor","CreatedById":85299,"CreatedDateTime":"2016-03-06T15:30:45Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222444576\u0022 data-ipsquote-contentid=\u0022104535\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221457276707\u0022 data-ipsquote-userid=\u0022135292\u0022 data-ipsquote-username=\u0022Ziw\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n15 minutes ago, Ziw said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nHi, long time no see \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022true\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u00A0Here are the changes I made:\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://github.com/MagicSmokeIndustries/InfernalRobotics/pull/74/files#diff-e2ca92d8a9e6bebed32c75d95e97a475L133\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/MagicSmokeIndustries/InfernalRobotics/pull/74/files#diff-e2ca92d8a9e6bebed32c75d95e97a475L133\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nI moved the edge case check after the newVel is calculated and performed the check against it versus raw maxDeltaVel, which was too high in \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022http://forum.kerbalspaceprogram.com/index.php?/profile/66124-allmhuran/\u0026amp;do=hovercard\u0022 data-mentionid=\u002266124\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/66124-allmhuran/\u0022\u003E@allmhuran\u003C/a\u003E\u0027s case\n\u003C/p\u003E\n\u003Cp\u003E\nAs for option to disable the acceleration completely - I\u0027ll see whether it is possible to untie interpolation easily.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\u003Cp\u003E\nActually this is not an edge case but the end condition, i.e. the regular way of a servo to stop.\n\u003C/p\u003E\n\u003Cp\u003E\nIf maxDeltaVel was high, this means that the servo jumped to its commandPos in the old version. If the new version behaves differently, it does not consider the movement finished, and will be interrupted later by the next command. I guess this invalidates some of my considerations, in this case bypassing the interpolator will behave like the old version before your change.\n\u003C/p\u003E\n"},{"CreatedByName":"allmhuran","CreatedById":66124,"CreatedDateTime":"2016-03-06T16:07:45Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222444566\u0022 data-ipsquote-contentid=\u0022104535\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221457276325\u0022 data-ipsquote-userid=\u002285299\u0022 data-ipsquote-username=\u0022pellinor\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n58 minutes ago, pellinor said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222444566\u0022 data-ipsquote-contentid=\u0022104535\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221457276325\u0022 data-ipsquote-userid=\u002285299\u0022 data-ipsquote-username=\u0022pellinor\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n58 minutes ago, pellinor said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nI think a cleaner way to handle this would be to offer a mode that tries to keep its target speed until reaching the target position, assuming he will get new commands on the fly. It would only brake after overshooting, or when approaching a hard limit. This could actually work without the realtime requirement of getting new positions every physics tick.\n\u003C/p\u003E\n\u003Cp\u003E\nAnother way is to disable/bypass the interpolation entirely (i.e. write positions directly). This is more or less what happens when you set huge acceleration values. There might still be a bit of weirdness here and there because it was not an intended use case when I wrote the interpolation code.\n\u003C/p\u003E\n\u003Cp\u003E\nOf course the silver bullet would be true synchronous interpolation, i.e. only one interpolator for a set of servos. You would give it a list of positions, then it would calculate its dynamics (maxSpeed/maxAcc) based on the distance and dynamics of the involved servos, and move them all in sync. This is pretty straightforward for basic linear motion, but can become a huge can of worms once you get nonlinear (e.g. change \u0027direction\u0027 without stopping).\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nYep, the non-linearity of the problem is what makes it very expensive to try to handle in kOS, hence the choice to turn in into a linear problem with a really high acceleration value - an unaccelerated mode, just as you\u0027ve described.\u003Cbr\u003E\u003Cbr\u003E\nFor controlling the servos, my own algorithm takes a set of positions which it is going to cycle through. But before anything starts, I first create a smoothed set to use as the first argument for the move command: If the previous target, current target, and next target are all in order, I push the current target out to the next target. So, for example, an original set of positions\u00A0{0, 20, 40, 50, 20, 30} is turned into {0, 40, 50, 50, 20, 30}, but the speed component still uses the orignal set. Ie, when moveto() is called, the speed is set so that the servo reaches the position of the original set in a specified time, but the servo \u0022limit\u0022 itself is set out beyond that point, so that if it gets there a little \u0022early\u0022 it is allowed to overshoot. In situations where it has to reverse, though, an overshoot is prevented. This can cause a slight jitter as a servo stops for a frame or two, but it\u0027s not too bad.\u003Cbr\u003E\u003Cbr\u003E\n\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"wjb55","CreatedById":149860,"CreatedDateTime":"2016-03-06T21:43:21Z","Content":"\n\u003Cp\u003E\nHello, I was wondering if there was a chance for a variable geometry hinge like in the original damned robotics (I think it was that pack) so that aircraft such as the b1 or f14 become more viable\n\u003C/p\u003E\n"},{"CreatedByName":"V8jester","CreatedById":136093,"CreatedDateTime":"2016-03-06T22:36:03Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222445129\u0022 data-ipsquote-contentid=\u0022104535\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221457300601\u0022 data-ipsquote-userid=\u0022149860\u0022 data-ipsquote-username=\u0022wjb55\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n52 minutes ago, wjb55 said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nHello, I was wondering if there was a chance for a variable geometry hinge like in the original damned robotics (I think it was that pack) so that aircraft such as the b1 or f14 become more viable\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nWelcome to the forum.\n\u003C/p\u003E\n\u003Cp\u003E\nYou can make a swept wing aircraft using the \u0022Docking washer\u0022 from the main IR Pack found \u003Cstrong\u003E\u003Ca href=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/104535-105-magic-smoke-industries-infernal-robotics-0214/\u0022\u003EHere\u003C/a\u003E\u003C/strong\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nWhat I did in this video was, use a Docking Washer on each wing (Assembled one at a time. Docking washer\u0027s don\u0027t work using symmetry). Then I also used \u003Cstrong\u003E\u003Ca href=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/84630-105-quantumstrutscontinued-14-magical-struts-for-rigidifying-outside-the-vab/\u0022\u003EQuantum Struts\u003C/a\u003E\u00A0\u003C/strong\u003Eto secure the wings in either swept or forward positions.\n\u003C/p\u003E\n\u003Cdiv class=\u0022ipsEmbeddedVideo\u0022 contenteditable=\u0022false\u0022\u003E\n\u003Cdiv\u003E\n\u003Ciframe allowfullscreen=\u0022true\u0022 frameborder=\u00220\u0022 height=\u0022270\u0022 src=\u0022https://www.youtube.com/embed/3yGxv_NeJVM?feature=oembed\u0022 width=\u0022480\u0022\u003E\u003C/iframe\u003E\n\u003C/div\u003E\n\u003C/div\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-03-06T22:37:11Z\u0022 title=\u002203/06/2016 10:37  PM\u0022 data-short=\u00228 yr\u0022\u003EMarch 6, 2016\u003C/time\u003E by V8jester\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"wjb55","CreatedById":149860,"CreatedDateTime":"2016-03-06T22:40:03Z","Content":"\n\u003Cp\u003E\nAh thank you I will try that tomorrow as I used just the regular hinges you can probably guess how that turned out\n\u003C/p\u003E\n"},{"CreatedByName":"ss8913","CreatedById":94747,"CreatedDateTime":"2016-03-07T00:30:59Z","Content":"\n\u003Cp\u003E\nI\u0027m having a lot of trouble with the structural strength of these parts.\u00A0 I wanted to make a crane that could load/unload a 3.75m Kontainer of heavy goods from a spaceplane to a mining base.\u00A0 I counterweighted it with a big tank of water for ballast.\u00A0 looked great in VAB.\u00A0 When I launched it, all of the telescopic pistons just collapsed under the weight and the whole thing, plus the launchpad, just exploded.\u00A0 The rotatrons also seem to have very weak structural strength.\u00A0 I\u0027m already using Kerbal Joint Reinforcement.\u00A0 Is there any solution to this?\u00A0 I need a *heavy* cargo crane, we\u0027re talking about moving 200t of cargo at a time here (3.75m Kontainers hold a lot!)\n\u003C/p\u003E\n"},{"CreatedByName":"Ziw","CreatedById":135292,"CreatedDateTime":"2016-03-07T07:56:00Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222445380\u0022 data-ipsquote-contentid=\u0022104535\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221457310659\u0022 data-ipsquote-userid=\u002294747\u0022 data-ipsquote-username=\u0022ss8913\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n7 hours ago, ss8913 said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nI\u0027m having a lot of trouble with the structural strength of these parts.\u00A0 I wanted to make a crane that could load/unload a 3.75m Kontainer of heavy goods from a spaceplane to a mining base.\u00A0 I counterweighted it with a big tank of water for ballast.\u00A0 looked great in VAB.\u00A0 When I launched it, all of the telescopic pistons just collapsed under the weight and the whole thing, plus the launchpad, just exploded.\u00A0 The rotatrons also seem to have very weak structural strength.\u00A0 I\u0027m already using Kerbal Joint Reinforcement.\u00A0 Is there any solution to this?\u00A0 I need a *heavy* cargo crane, we\u0027re talking about moving 200t of cargo at a time here (3.75m Kontainers hold a lot!)\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nPlease try using Zodius reworked parts (linked multiple times here), they are reported to be a bit less wonky. Also you may want\u00A0to scale\u00A0up some parts, because original ones are not designed to hold such weights.\n\u003C/p\u003E\n"}]}