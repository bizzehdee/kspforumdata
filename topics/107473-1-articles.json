{"TopicId":107473,"ForumId":29,"TopicTitle":"[Help] Spawning parts beginning from specific node","CreatedByName":"TAz00","CreatedById":41667,"CreatedDateTime":"2015-05-04T18:20:11Z","PageNum":1,"Articles":[{"CreatedByName":"TAz00","CreatedById":41667,"CreatedDateTime":"2015-05-04T18:20:11Z","Content":"Hi there,\n\n \\*\u0022Solved\u0022 the problems, ie. found workarounds\n\n \\*Edit, I made a github [https://github.com/TAz00/Mod-KSPSmelter](https://github.com/TAz00/Mod-KSPSmelter)\n\nI\u0027m new to unity, and I\u0027m having quite a bit of troubles with some code.\n\nWhat I wan\u0027t to create is a way to create fuel canisters from ore. Think 3D laser metal printing ![:P](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif) But a fuelcan is useless in itself, so it must have docking nodes to be picked up, attached to a rocket and sent into orbit. \n\nSo i\u0027m making a crude cloning vat.\n\nMy current approach is to clone the 2,5M service bay, and try to create a new vessel from everything that is attached to the top node inside.\n\nCurrently it can spawn the parts which are placed inside, but they are in no way attached to each other. I have a feeling there is a much smarter way to go about it, than recreating the algorithm for cloning ships. (maybe clone the entire vessel and remove everything but the parts i want?)\n\nIf anyone could care to take a gander, that would be much appreciated.\n\n[https://www.dropbox.com/s/8f65dk4uew9iccr/KSPSmelter.v0.2.7z?dl=0](https://www.dropbox.com/s/8f65dk4uew9iccr/KSPSmelter.v0.2.7z?dl=0)\n\n[https://github.com/TAz00/Mod-KSPSmelter](https://github.com/TAz00/Mod-KSPSmelter)\n\n![8R1Uuop.jpg](http://i.imgur.com/8R1Uuop.jpg)\n\n    #removed code for brevity, also, it was flawed and a working copy is on github\n\nBest Regards\n\n**Edited \u003Ctime datetime=\u00222015-05-29T19:28:54Z\u0022 title=\u002205/29/2015 07:28  PM\u0022 data-short=\u00229 yr\u0022\u003EMay 29, 2015\u003C/time\u003E by TAz00**\n  \ngithub, new version, solved!"},{"CreatedByName":"TAz00","CreatedById":41667,"CreatedDateTime":"2015-05-10T19:31:03Z","Content":"So I\u0027ve been trying for an untold number of hours, and the closest I have come is the following.\n\nI abandonded my attempt to create a vessel from a node, and instead created a small vessel of two docking ports and an FL-400 tank in between. And then load the craft from disk and spawn it next to my current vessel:\n\n     private void AlmostSpawnCraftFromFile()        {            Quaternion rotation = this.part.transform.rotation;             Vector3 position = this.part.transform.position;             Int32 OffsetX = 03;            Int32 OffsetY = 00;            Int32 OffsetZ = 00;            position \u002B= new Vector3(OffsetX, OffsetY, OffsetZ);            //Posistion is unused for now            Vessel FirstVessel = Utility.TheThingThatAlmostWorked(\u0022FL-T400.craft\u0022, position, rotation, this.part);        }///         /// //http://forum.kerbalspaceprogram.com/threads/7544-The-official-unoffical-help-a-fellow-plugin-developer-thread/page129        ///         ///         ///         ///         ///         ///         ///         public static Vessel SpawnCraftFromCraftFile(string FileName, Vector3 Position, Quaternion Rotation, Part SourcePart)        {            string BasePath = Environment.CurrentDirectory \u002B \u0022\\\\..\\\\PluginData\\\\\u0022;            string path = BasePath \u002B FileName;            ProtoVessel protoVessel = null;            //Make a clone of the orbit            //https://github.com/Ezriilc/HyperEdit/blob/master/Model/OrbitEditor.cs            Orbit o = SourcePart.vessel.orbitDriver.orbit;            Orbit cloneOrbit = new Orbit(o.inclination, o.eccentricity, o.semiMajorAxis, o.LAN,                o.argumentOfPeriapsis, o.meanAnomalyAtEpoch, o.epoch, o.referenceBody);            //cloneOrbit = SourcePart.vessel.orbitDriver.orbit;            ConfigNode VesselConfigNode = ProtoVessel.CreateVesselNode(\u0022Fuuuuck\u0022, VesselType.Debris, cloneOrbit, 0, new ConfigNode[1] { ConfigNode.Load(path) });            //ConfigNodeFree / Debugger Lagg free way            protoVessel = new ProtoVessel(VesselConfigNode, HighLogic.CurrentGame);            //Set posistion, maybe: untested            protoVessel.position = Position;            //Seemed sensible            protoVessel.LoadObjects();            //Load vessel, if we leave it here, vessel gets destroyed on rails at 100.2 atm pressure with no crew            protoVessel.Load(HighLogic.CurrentGame.flightState);            return protoVessel.vesselRef;        }\n\nThis results in the vessel being destroyed at 100.2 atm with no crew on rails.\n\nNo exception errors this time.\n\nNow please contain yourselves with responses ![:D](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif)"},{"CreatedByName":"TAz00","CreatedById":41667,"CreatedDateTime":"2015-05-14T21:09:36Z","Content":"Alright, so I sort of got it to work. And it\u0027s all I ever dreamed of ![:D](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif)\n\n[http://i.imgur.com/MO61VpT.jpg](http://i.imgur.com/MO61VpT.jpg)\n\nTheres a problem with positioning. When my vessel spawns, it start\u0027s in one posistion, but as soon as physics kick in, it warps to a different location, in height, and then either bounces up from the ground or dangles down. \n\nHere\u0027s a screenshot of it spawning in the air, and the second one is where physics get enabled, and it warps to/into the ground and bounces up.\n\n[http://i.imgur.com/K2llEYT.jpg](http://i.imgur.com/K2llEYT.jpg)\n\nSee log info\n\n[http://i.imgur.com/kwUyQgm.jpg](http://i.imgur.com/kwUyQgm.jpg)\n\nOtherwise everything is fine, spawning in the right location. And then physics ruin it. Why do I get ground contact error -x.xxx meters?\n\n    //Get root index part            Part rootIndexPart = _shipConstruct.parts[0];            Vector3 flipOffset = rootIndexPart.transform.localPosition;            //Sets source part spawn posistion to exact center of current vessel (this explodes the craft)            //Translate rootIndexPart (this applies the posistion to the rootpart)            rootIndexPart.transform.Translate(-flipOffset);            //Apply spawn offset            //ship.Parts[0].transform.Translate(_newVesselSpawnOffset);            //float size = ship.shipSize.magnitude / 2.0f;            //Create backup values            ShipConstruction.CreateBackup(_shipConstruct);            //Transform to ground            Transform launchTransform = Utility.GetLanchTransform(_srcPart.transform);            //Get localRoot root part            Part localRootPart = _shipConstruct.parts[0].localRoot;            //Angle            float angle;            //Axis            Vector3 axis;            //Extract ToAngleAxis data from selected spawning location            launchTransform.rotation.ToAngleAxis(out angle, out axis);            //Transform localRootPart posistion and apply offset            localRootPart.transform.Translate(launchTransform.position \u002B _newVesselSpawnOffset, Space.World);            //Rotate localRootPart in relation to root            localRootPart.transform.RotateAround(launchTransform.position, axis, angle);"},{"CreatedByName":"MatterBeam","CreatedById":133334,"CreatedDateTime":"2015-05-16T17:22:52Z","Content":"\u003E \n\u003E Alright, so I sort of got it to work. And it\u0027s all I ever dreamed of ![:D](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif)\n\u003E [http://i.imgur.com/MO61VpT.jpg](http://i.imgur.com/MO61VpT.jpg)\n\u003E \n\u003E Theres a problem with positioning. When my vessel spawns, it start\u0027s in one posistion, but as soon as physics kick in, it warps to a different location, in height, and then either bounces up from the ground or dangles down. \n\u003E \n\u003E Here\u0027s a screenshot of it spawning in the air, and the second one is where physics get enabled, and it warps to/into the ground and bounces up.\n\u003E \n\u003E [http://i.imgur.com/K2llEYT.jpg](http://i.imgur.com/K2llEYT.jpg)\n\u003E \n\u003E See log info\n\u003E \n\u003E [http://i.imgur.com/kwUyQgm.jpg](http://i.imgur.com/kwUyQgm.jpg)\n\u003E \n\u003E Otherwise everything is fine, spawning in the right location. And then physics ruin it. Why do I get ground contact error -x.xxx meters?\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E \n\u003E \n\u003E     //Get root index part            Part rootIndexPart = _shipConstruct.parts[0];            Vector3 flipOffset = rootIndexPart.transform.localPosition;            //Sets source part spawn posistion to exact center of current vessel (this explodes the craft)            //Translate rootIndexPart (this applies the posistion to the rootpart)            rootIndexPart.transform.Translate(-flipOffset);            //Apply spawn offset            //ship.Parts[0].transform.Translate(_newVesselSpawnOffset);            //float size = ship.shipSize.magnitude / 2.0f;            //Create backup values            ShipConstruction.CreateBackup(_shipConstruct);            //Transform to ground            Transform launchTransform = Utility.GetLanchTransform(_srcPart.transform);            //Get localRoot root part            Part localRootPart = _shipConstruct.parts[0].localRoot;            //Angle            float angle;            //Axis            Vector3 axis;            //Extract ToAngleAxis data from selected spawning location            launchTransform.rotation.ToAngleAxis(out angle, out axis);            //Transform localRootPart posistion and apply offset            localRootPart.transform.Translate(launchTransform.position \u002B _newVesselSpawnOffset, Space.World);            //Rotate localRootPart in relation to root            localRootPart.transform.RotateAround(launchTransform.position, axis, angle);\n\nCan you add costs to the created parts?"},{"CreatedByName":"TAz00","CreatedById":41667,"CreatedDateTime":"2015-05-23T22:24:29Z","Content":"Bit late on the reply.\n\nBut why yes I could. As in, they would take ore and electricity to manufacture. \n\nHere\u0027s an incredibly boring video of me having an \u0027all in one craft\u0027 mine, build and launch supply ships. \n\n\u003Ciframe width=\u0022480\u0022 height=\u0022270\u0022 src=\u0022https://www.youtube.com/embed/HSTACqerUeA?feature=oembed\u0022 frameborder=\u00220\u0022 allowfullscreen=\u0022true\u0022\u003E\u003C/iframe\u003E\n\nI\u0027m just currently bogged down in posistioning.\n\n    //This function is inconsistent, input is the same every time, yet it returns 0 0 0 when resuming from cache/save, instead of //returning correct valueVector3 calculatedPosWhenResume = this.part.vessel.mainBody.GetWorldSurfacePosition(this.part.vessel.latitude, this.part.vessel.longitude, this.part.vessel.altitude);//Same goes forVector3 worldPos = this.part.vessel.GetWorldPos3D();"},{"CreatedByName":"TAz00","CreatedById":41667,"CreatedDateTime":"2015-05-24T12:49:26Z","Content":"Updated github and added a new dropbox link : [https://www.dropbox.com/s/4mrdcna8nzipnib/KSPSmelter.v0.1.7z?dl=0](https://www.dropbox.com/s/4mrdcna8nzipnib/KSPSmelter.v0.1.7z?dl=0)\n\nNow has resource usage. Ore / ElectricCharge\n\nIt will pause the print if you run out of ore, and slow down if electricity drops.\n\n**Edited \u003Ctime datetime=\u00222015-05-24T13:15:44Z\u0022 title=\u002205/24/2015 01:15  PM\u0022 data-short=\u00229 yr\u0022\u003EMay 24, 2015\u003C/time\u003E by TAz00**"},{"CreatedByName":"MatterBeam","CreatedById":133334,"CreatedDateTime":"2015-05-24T13:26:41Z","Content":"Just a few questions:\n\nCan you spawn entire sub-assemblies?\n\nCan you spawn parts like solar panels or landing legs?\n\nCan the spawned parts be attached to an existent ship using KAS/KIS?"},{"CreatedByName":"TAz00","CreatedById":41667,"CreatedDateTime":"2015-05-24T13:42:03Z","Content":"Yes, if you save them as a craft from the VAB and move the saved .craft file to PluginData and replace one of the existing .craft files. \n\nIndividually? maybe, if they can be saved as a .craft in the VAB \n\nYes, havn\u0027t tried KAS yet, but it should work aswell as Infernal robotics. I\u0027m not familiar enough with KIS to say."},{"CreatedByName":"MatterBeam","CreatedById":133334,"CreatedDateTime":"2015-05-24T14:21:15Z","Content":"\u003E \n\u003E Yes, if you save them as a craft from the VAB and move the saved .craft file to PluginData and replace one of the existing .craft files. \n\u003E Individually? maybe, if they can be saved as a .craft in the VAB \n\u003E \n\u003E Yes, havn\u0027t tried KAS yet, but it should work aswell as Infernal robotics. I\u0027m not familiar enough with KIS to say.\n\nThat sounds a bit... complicated?\n\nOh, and if something works with KAS, it\u0027ll 100% work with KIS."},{"CreatedByName":"TAz00","CreatedById":41667,"CreatedDateTime":"2015-05-29T19:26:44Z","Content":"So I think I\u0027ve fixed the position warping. Although spawning an entire craft was not my original goal, this works well enough for what I had in mind. \n\nTo be able to build and launch refuel missions on another planet. \n\nHere\u0027s the latest version, and I also updated the github sources\n\n[https://www.dropbox.com/s/8f65dk4uew9iccr/KSPSmelter.v0.2.7z?dl=0](https://www.dropbox.com/s/8f65dk4uew9iccr/KSPSmelter.v0.2.7z?dl=0)\n\nAnyone know a good modeler / animator ![:D](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif)"},{"CreatedByName":"MatterBeam","CreatedById":133334,"CreatedDateTime":"2015-05-30T21:55:14Z","Content":"\u003E \n\u003E So I think I\u0027ve fixed the position warping. Although spawning an entire craft was not my original goal, this works well enough for what I had in mind. \n\u003E To be able to build and launch refuel missions on another planet. \n\u003E \n\u003E Here\u0027s the latest version, and I also updated the github sources\n\u003E \n\u003E [https://www.dropbox.com/s/8f65dk4uew9iccr/KSPSmelter.v0.2.7z?dl=0](https://www.dropbox.com/s/8f65dk4uew9iccr/KSPSmelter.v0.2.7z?dl=0)\n\u003E \n\u003E Anyone know a good modeler / animator ![:D](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif)\n\nWhile developing my own career mod, Project ROCK, I found that I needed to use something to build rockets outside of Kerbin. You can read more about it in the link in my sig, but my line of thought is the following:\n\n-Extraplanetary Launchpads does everything I\u0027m asking for, but it is very complex and not at all compatible with Project\u0027s ROCK\u0027s Ore-to-everything philosophy. \n\n-I can slim down EPL to fit my own mod, but it would take a lot of work and discussions with the original creator on a bloated thread, plus there are lots of things that can go wrong.\n\n-You mod, however, should work perfectly for what I have in mind ( a simple rocket building tool), but I have a few questions:\n\nCan the player use this mod without exiting the KSP client?\n\nCan the player reasonably expect the spawn an entire spaceship on the surface of another planet without having to break it up into small pieces and dock each piece together (part count would explode)?\n\nCan I define the Ore consumption ratio using .cfg files? The previous video doesn\u0027t seem to use any Ore or Electricity to spawn parts.\n\nIn return, I can create a model for your spawner in blender and port it over to KSP. I\u0027ll install a simple texture, but I can\u0027t do animations yet ![:(](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_sad.gif)"},{"CreatedByName":"TAz00","CreatedById":41667,"CreatedDateTime":"2015-06-10T12:33:24Z","Content":"The ore consumption is defined in CFG, \n\nTime to build it, 30 secs, is defined in code.\n\nYou could modify it to spawn an entire ship, but I went with realism, and tried make somehting which could be possible IRL. Spawning a whole ship would not be possible irl ![:P](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif), but the mod does not place any restrictions on it.\n\nAnd it \u0022should\u0022 not explode, but it might ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\nThanks for the offer, if you whip something up, ill be sure to include it. \n\nAlso, upon further testing, spawn position is still not correct ![:(](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_sad.gif) I dno where to go from here."}]}