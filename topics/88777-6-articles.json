{"TopicId":88777,"ForumId":34,"TopicTitle":"[1.1.3] BackgroundProcessing","CreatedByName":"jamespicone","CreatedById":125714,"CreatedDateTime":"2014-10-28T18:40:42Z","PageNum":6,"Articles":[{"CreatedByName":"Merill","CreatedById":136069,"CreatedDateTime":"2015-05-29T20:26:03Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022jamespicone\u0022 data-cite=\u0022jamespicone\u0022\u003E\u003Cdiv\u003E\u003Cp\u003ESnacks doesn\u0027t appear to be using Background Processing the mod, although it does look like they\u0027re trying to do processing in the background for snacks.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003E\u003Cspan style=\u0022text-decoration:line-through;\u0022\u003EMy fork use background processing. I change the code. It\u0027s not really snacks anymore.\u003C/span\u003E\u003C/p\u003E\u003Cp\u003EFor the meal-based, it\u0027s just a if() in the update function (vs constant update that use a delta time).\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022text-decoration:line-through;\u0022\u003EI post the link to the code just in case you want to see how I deal/kill eva kerbals / use background processing with kerbals in vessels.\u003C/span\u003E\u003C/p\u003E\u003Cp\u003EEdit: Ouuups, i forgot to push my code on the repo (or link the right branch). \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_embarrassed.gif\u0022 alt=\u0022:blush:\u0022\u003E\u003C/p\u003E\u003Cp\u003EIt\u0027s here now.\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022https://github.com/supermerill/Snacks/blob/backgroundProcessing/Snacks/Snacks/SnackConsumer.cs\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/supermerill/Snacks/blob/backgroundProcessing/Snacks/Snacks/SnackConsumer.cs\u003C/a\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-05-29T21:52:34Z\u0022 title=\u002205/29/2015 09:52  PM\u0022 data-short=\u00229 yr\u0022\u003EMay 29, 2015\u003C/time\u003E by Merill\u003C/strong\u003E\n\u003Cbr\u003Emy bad\n\u003C/span\u003E\n"},{"CreatedByName":"FlowerChild","CreatedById":74289,"CreatedDateTime":"2015-05-30T19:29:26Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022jamespicone\u0022 data-cite=\u0022jamespicone\u0022\u003E\u003Cdiv\u003Ealso there\u0027s a config file which allows setting which factors affect solar panel output and a fix for locked tanks draining (So BSTM\u0027s changed version is now out of date and unnecessary).\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThat\u0027s good news James! So far I\u0027ve just been using a recompiled version of the last one I rigged up for 0.9, but that\u0027s only because I\u0027ve yet to get to the point where solar panels are unlocked in the mod.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003EFuel cells and ISRUs still won\u0027t work in the background, and I\u0027m not certain what to do about them. Neither will resource extraction stuff.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI don\u0027t envy that task man, as I could see it getting messy real quick. I\u0027m actually ditching both of them for BTSM, as well as solar panel heat affecting energy output.\u003C/p\u003E\n"},{"CreatedByName":"FlowerChild","CreatedById":74289,"CreatedDateTime":"2015-06-12T21:46:50Z","Content":"\n\u003Cp\u003EHey James, I\u0027m finally getting to integrating the newest version of BP with my slow process of porting BTSM over to KSP 1.0, and looking over some of the code, I\u0027m getting a little worried about the performance impact of some of the newer stuff.\u003C/p\u003E\u003Cp\u003EIn particular, with SolarPanel.cs I\u0027m a bit concerned over the number of conditions that have been added to what is essentially a tight inner loop. Like, with all the Addon.Debug() statements, each of those involves a condition testing if the message is above the current debug level set in the config file. Now, with that one, hopefully branch prediction will minimize the impact of it, but it still seems rather excessive to include that kind of thing in such a performance sensitive portion of the code.\u003C/p\u003E\u003Cp\u003EAlso, with stuff like this:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E\t\t\t\tif (!Addon.config.solarOrientationMatters) { orientationFactor = 1; Addon.Debug(\u0022Orientation disabled in config file\u0022, DebugLevel.ALL); }\u003Cbr\u003E\t\t\t\tif (!Addon.config.solarTemperatureMatters) { tempFactor = 1; Addon.Debug(\u0022Temperature disabled in config file\u0022, DebugLevel.ALL); }\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EIt worries me that regardless of the settings, the full calculations for orientation and temperature are performed first, and only afterwards are those values overridden depending on the options. In other words, even if the computed values aren\u0027t used, they\u0027re still being calculated, when whether they should be calculated or not could just as easily be tested beforehand.\u003C/p\u003E\u003Cp\u003EObviously, speed of execution is a big concern with something like BP, and solar panels are probably the biggest potential issue there.\u003C/p\u003E\n"},{"CreatedByName":"jamespicone","CreatedById":125714,"CreatedDateTime":"2015-06-13T02:07:59Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022FlowerChild\u0022 data-cite=\u0022FlowerChild\u0022\u003E\u003Cdiv\u003EHey James, I\u0027m finally getting to integrating the newest version of BP with my slow process of porting BTSM over to KSP 1.0, and looking over some of the code, I\u0027m getting a little worried about the performance impact of some of the newer stuff.\u003Cp\u003EIn particular, with SolarPanel.cs I\u0027m a bit concerned over the number of conditions that have been added to what is essentially a tight inner loop. Like, with all the Addon.Debug() statements, each of those involves a condition testing if the message is above the current debug level set in the config file. Now, with that one, hopefully branch prediction will minimize the impact of it, but it still seems rather excessive to include that kind of thing in such a performance sensitive portion of the code.\u003C/p\u003E\u003Cp\u003EAlso, with stuff like this:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E                if (!Addon.config.solarOrientationMatters) { orientationFactor = 1; Addon.Debug(\u0022Orientation disabled in config file\u0022, DebugLevel.ALL); }\u003Cbr\u003E                if (!Addon.config.solarTemperatureMatters) { tempFactor = 1; Addon.Debug(\u0022Temperature disabled in config file\u0022, DebugLevel.ALL); }\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EIt worries me that regardless of the settings, the full calculations for orientation and temperature are performed first, and only afterwards are those values overridden depending on the options. In other words, even if the computed values aren\u0027t used, they\u0027re still being calculated, when whether they should be calculated or not could just as easily be tested beforehand.\u003C/p\u003E\u003Cp\u003EObviously, speed of execution is a big concern with something like BP, and solar panels are probably the biggest potential issue there.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EPremature optimisation is the root of all evil. This is all constant-factor stuff, barely worth caring about from a performance perspective, tbh. I\u0027ll move the orientationFactor stuff, because that at least takes two-digit amounts of floating point. The temperature factor stuff is almost unnoticeable - it\u0027s a single floatcurve.evaluate().\u003C/p\u003E\u003Cp\u003EI feel pretty confident noting that all of this should have next to no noticeable performance impact.\u003C/p\u003E\n"},{"CreatedByName":"FlowerChild","CreatedById":74289,"CreatedDateTime":"2015-06-13T05:35:06Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022jamespicone\u0022 data-cite=\u0022jamespicone\u0022\u003E\u003Cdiv\u003EPremature optimisation is the root of all evil.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EWhile I agree, I will also note that not addressing such low hanging fruit that has no impact on code readability or maintainability is probably a close second in the evil department \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EI also have no idea what you\u0027re planning in terms of expanding on the code in question that would make it \u0022premature\u0022.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022jamespicone\u0022 data-cite=\u0022jamespicone\u0022\u003E\u003Cdiv\u003E\u003Cp\u003EI feel pretty confident noting that all of this should have next to no noticeable performance impact.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EPerhaps, but I think what was more concerning to me was the overall trend there. There was really no solid reason that I could discern for the stuff I mentioned.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-06-13T05:38:52Z\u0022 title=\u002206/13/2015 05:38  AM\u0022 data-short=\u00229 yr\u0022\u003EJune 13, 2015\u003C/time\u003E by FlowerChild\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"jamespicone","CreatedById":125714,"CreatedDateTime":"2015-06-13T05:56:03Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022FlowerChild\u0022 data-cite=\u0022FlowerChild\u0022\u003E\u003Cdiv\u003E but I think what was more concerning to me was the overall trend there. There was really no solid reason that I could discern for the stuff I mentioned.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EDebugging info is pretty important, not dumping debug info at incredible rates into everybody\u0027s logs is also important (and actually firing the logging info is much slower than a /single boolean test that almost always fails/). The \u0027inside-out\u0027 version where I have different versions of the same function depending on the logging level is worse for maintainability and readability.\u003C/p\u003E\u003Cp\u003EI consider the no-orientation and no-temperature paths to be \u0027not the main line\u0027, and as a result the code ended up being written so that they were spurs off the main path instead of testing for orientation/temperature relevance before doing the calculations. I honestly don\u0027t think the performance impact here is relevant. This code isn\u0027t cycle-counting levels of performance critical.\u003C/p\u003E\n"},{"CreatedByName":"FlowerChild","CreatedById":74289,"CreatedDateTime":"2015-06-13T10:35:47Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022jamespicone\u0022 data-cite=\u0022jamespicone\u0022\u003E\u003Cdiv\u003EThis code isn\u0027t cycle-counting levels of performance critical.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EFair enough man. When a code segment can easily be run a couple of thousand times a second though, I just tend to wince when I see unnecessary conditionals thrown into the mix \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"almagnus1","CreatedById":78068,"CreatedDateTime":"2015-08-06T04:34:05Z","Content":"\n\u003Cp\u003EHave you done any testing with either TAC-LS or USI Kolonization System?\u003C/p\u003E\u003Cp\u003ERE: Debug stuff, you might want to take a look at this article, and consider wrapping it in a while where the compiler will remove the code during an optimization pass:\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003EC# \u00C3\u00A2\u00E2\u201A\u00AC\u00C5\u201CDebug only\u00C3\u00A2\u00E2\u201A\u00AC\u00C2 code that should run only when \u00C3\u00A2\u00E2\u201A\u00AC\u00C5\u201Cturned on\u00C3\u00A2\u00E2\u201A\u00AC\u00C2\u003C/strong\u003E\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022http://stackoverflow.com/questions/5080477/c-sharp-debug-only-code-that-should-run-only-when-turned-on\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://stackoverflow.com/questions/5080477/c-sharp-debug-only-code-that-should-run-only-when-turned-on\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EIt\u0027s the same basic idea s the C\u002B\u002B #ifdef __DEBUG__ preprocessor flag, just .NET-ified.\u003C/p\u003E\n"},{"CreatedByName":"jamespicone","CreatedById":125714,"CreatedDateTime":"2015-08-23T07:14:04Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022almagnus1\u0022 data-cite=\u0022almagnus1\u0022\u003E\u003Cdiv\u003EHave you done any testing with either TAC-LS or USI Kolonization System?\u003Cp\u003ERE: Debug stuff, you might want to take a look at this article, and consider wrapping it in a while where the compiler will remove the code during an optimization pass:\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003EC# \u00C3\u00A2\u00E2\u201A\u00AC\u00C5\u201CDebug only\u00C3\u00A2\u00E2\u201A\u00AC\u00C2 code that should run only when \u00C3\u00A2\u00E2\u201A\u00AC\u00C5\u201Cturned on\u00C3\u00A2\u00E2\u201A\u00AC\u00C2\u003C/strong\u003E\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022http://stackoverflow.com/questions/5080477/c-sharp-debug-only-code-that-should-run-only-when-turned-on\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://stackoverflow.com/questions/5080477/c-sharp-debug-only-code-that-should-run-only-when-turned-on\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EIt\u0027s the same basic idea s the C\u002B\u002B #ifdef __DEBUG__ preprocessor flag, just .NET-ified.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI haven\u0027t tested against either of those mods. Some people above apparently have, and I don\u0027t think they were having any problems.\u003C/p\u003E\u003Cp\u003EI don\u0027t want to remove the debug code in release versions. It\u0027s turned on or off by a configuration file, with the point being that if someone is having a problem I can have them turn on logging info and then tell me what is output.\u003C/p\u003E\n"},{"CreatedByName":"Gryphon","CreatedById":58513,"CreatedDateTime":"2015-08-23T15:30:34Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022jamespicone\u0022 data-cite=\u0022jamespicone\u0022\u003E\u003Cdiv\u003EI haven\u0027t tested against either of those mods. Some people above apparently have, and I don\u0027t think they were having any problems.\u003Cp\u003EI don\u0027t want to remove the debug code in release versions. It\u0027s turned on or off by a configuration file, with the point being that if someone is having a problem I can have them turn on logging info and then tell me what is output.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYup. There\u0027s a difference between debug code that only needs to exist for the dev, and debug code that needs to run in the production code, but only when you need it. Clearly, KSP mods have to do a LOT of that. It\u0027s a WILD mod ecosystem out there.\u003C/p\u003E\n"},{"CreatedByName":"DocMop","CreatedById":125896,"CreatedDateTime":"2015-12-09T12:39:52Z","Content":"\n\u003Cp\u003E\nIs this 1.05 compatible?\n\u003C/p\u003E\n"},{"CreatedByName":"panzerwaffe044","CreatedById":143917,"CreatedDateTime":"2016-02-14T18:05:11Z","Content":"\n\u003Cp\u003E\nDoes anyone still use it? Does it work with 1.0.5?\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-02-14T18:07:56Z\u0022 title=\u002202/14/2016 06:07  PM\u0022 data-short=\u00228 yr\u0022\u003EFebruary 14, 2016\u003C/time\u003E by panzerwaffe044\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"jamespicone","CreatedById":125714,"CreatedDateTime":"2016-02-27T05:12:29Z","Content":"\n\u003Cp\u003E\nI haven\u0027t tested against versions of KSP more recent than 1.0.2, but I\u0027ve been told that it functions with 1.0.5. It probably won\u0027t blow up your save, but maybe backup just in case.\n\u003C/p\u003E\n"},{"CreatedByName":"ShotgunNinja","CreatedById":159391,"CreatedDateTime":"2016-02-27T09:17:42Z","Content":"\n\u003Cp\u003E\nHey James, I\u0027m developing a mod that use your awesome BackgroundProcessing and have found some problems in the code, that went on and fixed in my version:\n\u003C/p\u003E\n\u003Cul\u003E\u003Cli\u003E\noff-rail vessels position must be converted to\u00A0ScaledSpace (maybe this changed recently...)\n\u003Cul\u003E\u003Cli\u003E\nfix: in solar panel HandleResource(), replace any occurence of \u0027v.GetWorldPos3D()\u0027 with \u0027ScaledSpace.LocalToScaledSpace(v.GetWorldPos3D()) \u0027\n\u003C/li\u003E\n\u003C/ul\u003E\u003C/li\u003E\n\u003Cli\u003E\nPhysicsGlobal.SolarLuminosity is 0 (zero) before loading first\u00A0vessel in a game session\n\u003Cul\u003E\u003Cli\u003E\nfix: hard-code solar luminosity value (3.1609409786213E\u002B24)\n\u003C/li\u003E\n\u003C/ul\u003E\u003C/li\u003E\n\u003Cli\u003E\nload-only-most-recent-version machinery doesn\u0027t work if the MonoBehaviour class names are the same\n\u003Cul\u003E\u003Cli\u003E\nfix: rename the MonoBehaviour class \u0027BackgroundProcessing\u0027 to \u0027BackgroundProcessing_MAJOR_MINOR_REVISION_BUILD\u0027\n\u003C/li\u003E\n\u003C/ul\u003E\u003C/li\u003E\n\u003C/ul\u003E\u003Cp\u003E\nIn any case, I want to take the chance to thank you for your work. Best regards!\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-02-27T09:41:03Z\u0022 title=\u002202/27/2016 09:41  AM\u0022 data-short=\u00228 yr\u0022\u003EFebruary 27, 2016\u003C/time\u003E by ShotgunNinja\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"KvaNTy","CreatedById":157178,"CreatedDateTime":"2016-02-27T11:02:48Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222431928\u0022 data-ipsquote-contentid=\u002288777\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221456564662\u0022 data-ipsquote-userid=\u0022159391\u0022 data-ipsquote-username=\u0022ShotgunNinja\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n1 hour ago, ShotgunNinja said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cul\u003E\u003Cli\u003E\nPhysicsGlobal.SolarLuminosity is 0 (zero) before loading first\u00A0vessel in a game session\n\u003Cul\u003E\u003Cli\u003E\nfix: hard-code solar luminosity value (3.1609409786213E\u002B24)\n\u003C/li\u003E\n\u003C/ul\u003E\u003C/li\u003E\n\u003C/ul\u003E\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nSolar luminosity can change at some day. You forget about tons of planetary/scaling/rebalance mods that can alter such things.\u003Cbr\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222431928\u0022 data-ipsquote-contentid=\u002288777\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221456564662\u0022 data-ipsquote-userid=\u0022159391\u0022 data-ipsquote-username=\u0022ShotgunNinja\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n1 hour ago, ShotgunNinja said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cul\u003E\u003Cli\u003E\noff-rail vessels position must be converted to\u00A0ScaledSpace (maybe this changed recently...)\n\u003Cul\u003E\u003Cli\u003E\nfix: in solar panel HandleResource(), replace any occurence of \u0027v.GetWorldPos3D()\u0027 with \u0027ScaledSpace.LocalToScaledSpace(v.GetWorldPos3D()) \u0027\n\u003C/li\u003E\n\u003C/ul\u003E\u003C/li\u003E\n\u003C/ul\u003E\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nCan you explain why?\u003Cbr\u003E\nI use my own fork of BackgroundProcessing, and that\u0027s why interested in enhancing it.\n\u003C/p\u003E\n"},{"CreatedByName":"ShotgunNinja","CreatedById":159391,"CreatedDateTime":"2016-02-27T11:22:51Z","Content":"\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022http://forum.kerbalspaceprogram.com/index.php?/profile/157178-kvanty/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022157178\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/157178-kvanty/\u0022\u003E@KvaNTy\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nI understand hard-coding the solar luminosity is not ideal, but right now you notice that there is no EC generation after starting/loading a game session (because PhysicsGlobal.SolarLuminosity is set to 0). Only after a\u00A0vessel (any vessel) became active that constant is set by the game engine. Maybe a compromise may be to use the\u00A0hard-coded SolarLuminosity only if the game engine is returning 0 for it.\u00A0In this way there is only the minor inconvenience that the value is wrong (but still some EC is generated) only if these two conditions are met:\n\u003C/p\u003E\n\u003Cul\u003E\u003Cli\u003E\nno vessel was ever active from the start of the game session\n\u003C/li\u003E\n\u003Cli\u003E\nanother \u003Cspan style=\u0022color:rgb(39,42,52);font-family:\u0027Helvetica Neue\u0027, Helvetica, Arial, sans-serif;font-size:14px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:22.4px;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;float:none;background-color:rgb(255,255,255);\u0022\u003Eplanetary/scaling/rebalance\u003C/span\u003E mod is used\n\u003C/li\u003E\n\u003C/ul\u003E\u003Cp\u003E\nI think it is a good compromise.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nFor your second question, honestly I\u0027m not sure myself. But you can verify this\u00A0by orbiting a vessel with a solar panel and printing the EC amount in the log. You\u0027ll notice that the sun raycasting isn\u0027t really working unless you convert the vessel position to scaled space.\n\u003C/p\u003E\n"},{"CreatedByName":"jamespicone","CreatedById":125714,"CreatedDateTime":"2016-02-27T11:28:25Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222431928\u0022 data-ipsquote-contentid=\u002288777\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221456564662\u0022 data-ipsquote-userid=\u0022159391\u0022 data-ipsquote-username=\u0022ShotgunNinja\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n2 hours ago, ShotgunNinja said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nHey James, I\u0027m developing a mod that use your awesome BackgroundProcessing and have found some problems in the code, that went on and fixed in my version:\n\u003C/p\u003E\n\u003Cul\u003E\u003Cli\u003E\noff-rail vessels position must be converted to\u00A0ScaledSpace (maybe this changed recently...)\n\u003Cul\u003E\u003Cli\u003E\nfix: in solar panel HandleResource(), replace any occurence of \u0027v.GetWorldPos3D()\u0027 with \u0027ScaledSpace.LocalToScaledSpace(v.GetWorldPos3D()) \u0027\n\u003C/li\u003E\n\u003C/ul\u003E\u003C/li\u003E\n\u003Cli\u003E\nPhysicsGlobal.SolarLuminosity is 0 (zero) before loading first\u00A0vessel in a game session\n\u003Cul\u003E\u003Cli\u003E\nfix: hard-code solar luminosity value (3.1609409786213E\u002B24)\n\u003C/li\u003E\n\u003C/ul\u003E\u003C/li\u003E\n\u003Cli\u003E\nload-only-most-recent-version machinery doesn\u0027t work if the MonoBehaviour class names are the same\n\u003Cul\u003E\u003Cli\u003E\nfix: rename the MonoBehaviour class \u0027BackgroundProcessing\u0027 to \u0027BackgroundProcessing_MAJOR_MINOR_REVISION_BUILD\u0027\n\u003C/li\u003E\n\u003C/ul\u003E\u003C/li\u003E\n\u003C/ul\u003E\u003Cp\u003E\nIn any case, I want to take the chance to thank you for your work. Best regards!\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nScaledSpaces: can you explain that one? I haven\u0027t seen any issues in prior releases, but I haven\u0027t looked into later-than-1.0.2.\u003Cbr\u003E\u003Cbr\u003E\nSolarLuminosity initialisation: My in-dev code has a fix in the works.\u003Cbr\u003E\u003Cbr\u003E\nSingle-instance behaviour: Noted, will fix.\n\u003C/p\u003E\n"},{"CreatedByName":"jamespicone","CreatedById":125714,"CreatedDateTime":"2016-02-27T11:34:48Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222432012\u0022 data-ipsquote-contentid=\u002288777\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221456572171\u0022 data-ipsquote-userid=\u0022159391\u0022 data-ipsquote-username=\u0022ShotgunNinja\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n12 minutes ago, ShotgunNinja said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nMaybe a compromise may be to use the\u00A0hard-coded SolarLuminosity only if the game engine is returning 0 for it.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThat\u0027s my intended fix. \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022true\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"ShotgunNinja","CreatedById":159391,"CreatedDateTime":"2016-02-27T11:38:47Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222432022\u0022 data-ipsquote-contentid=\u002288777\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221456572888\u0022 data-ipsquote-userid=\u0022125714\u0022 data-ipsquote-username=\u0022jamespicone\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n1 minute ago, jamespicone said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nThat\u0027s my intended fix. \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022true\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nGreat! By the way I\u0027ve done some painfull extensive testing in 1.0.5 and except for the previous things I reported this is a pretty solid piece of work.\n\u003C/p\u003E\n"},{"CreatedByName":"KvaNTy","CreatedById":157178,"CreatedDateTime":"2016-02-27T11:46:31Z","Content":"\n\u003Cp\u003E\nBtw, \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022http://forum.kerbalspaceprogram.com/index.php?/profile/125714-jamespicone/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022125714\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/125714-jamespicone/\u0022\u003E@jamespicone\u003C/a\u003E, I had a question for you. \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022true\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u003Cbr\u003E\nWhat is the purpose of enumerating all part\u0027s modules(in the middle of VesselData.GetVesselData()) and just spaming logs with \u0022Expected: ModuleName...\u0022 and \u0022Found: AnotherModuleName...\u0022?\n\u003C/p\u003E\n"},{"CreatedByName":"jamespicone","CreatedById":125714,"CreatedDateTime":"2016-02-27T11:58:39Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222432025\u0022 data-ipsquote-contentid=\u002288777\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221456573591\u0022 data-ipsquote-userid=\u0022157178\u0022 data-ipsquote-username=\u0022KvaNTy\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n6 minutes ago, KvaNTy said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nBtw, \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022http://forum.kerbalspaceprogram.com/index.php?/profile/125714-jamespicone/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022125714\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/125714-jamespicone/\u0022\u003E@jamespicone\u003C/a\u003E, I had a question for you. \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022true\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u003Cbr\u003E\nWhat is the purpose of enumerating all part\u0027s modules(in the middle of VesselData.GetVesselData()) and just spaming logs with \u0022Expected: ModuleName...\u0022 and \u0022Found: AnotherModuleName...\u0022?\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThe code is attempting to match up modules in ProtoPartSnapshots with the associated module in the prefab part. We need both of them to do background processing properly, and there\u0027s no easier way to figure out which one of them is which than walking both lists finding which ones match up.\u003Cbr\u003E\u003Cbr\u003E\nThose debug messages should only be printed if the lists are out of sync - they should be giving you indexes. That\u0027ll happen if the prefabs PartModules don\u0027t match the ProtoPartSnapshot\u0027s PartModules, which is usually caused by things adding PartModules at runtime. The messages are there so that if someone has an error caused by PartModules being added at runtime I\u0027ll be able to figure it out.\u003Cbr\u003E\u003Cbr\u003E\nThe messages should be printed at WARNING level; you can turn them off in the config file.\n\u003C/p\u003E\n"},{"CreatedByName":"KvaNTy","CreatedById":157178,"CreatedDateTime":"2016-02-27T12:27:52Z","Content":"\n\u003Cp\u003E\nI suspected something like that. I just thinks its doing useless actions most of the time. No matter whether you do want to see those log or you don\u0027t.\u003Cbr\u003E\nMaybe it would be better to check if LogLevel.Warning first, and if so let it iterate ship\u0027s modules? Cos with size of the ship and number of installed mods the total number of modules grows almost exponentially.\n\u003C/p\u003E\n"},{"CreatedByName":"jamespicone","CreatedById":125714,"CreatedDateTime":"2016-02-27T14:34:19Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222432045\u0022 data-ipsquote-contentid=\u002288777\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221456576072\u0022 data-ipsquote-userid=\u0022157178\u0022 data-ipsquote-username=\u0022KvaNTy\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n2 hours ago, KvaNTy said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nI suspected something like that. I just thinks its doing useless actions most of the time. No matter whether you do want to see those log or you don\u0027t.\u003Cbr\u003E\nMaybe it would be better to check if LogLevel.Warning first, and if so let it iterate ship\u0027s modules? Cos with size of the ship and number of installed mods the total number of modules grows almost exponentially.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nWe have to iterate through the modules regardless of the log level.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-02-27T14:34:32Z\u0022 title=\u002202/27/2016 02:34  PM\u0022 data-short=\u00228 yr\u0022\u003EFebruary 27, 2016\u003C/time\u003E by jamespicone\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Svm420","CreatedById":136047,"CreatedDateTime":"2016-03-03T17:43:09Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222432024\u0022 data-ipsquote-contentid=\u002288777\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221456573127\u0022 data-ipsquote-userid=\u0022159391\u0022 data-ipsquote-username=\u0022ShotgunNinja\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nOn 2/27/2016 at 6:38 AM, ShotgunNinja said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nGreat! By the way I\u0027ve done some painfull extensive testing in 1.0.5 and except for the previous things I reported this is a pretty solid piece of work.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nWould you mind sharing your improved dll?\n\u003C/p\u003E\n"},{"CreatedByName":"ShotgunNinja","CreatedById":159391,"CreatedDateTime":"2016-03-04T21:56:00Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222439943\u0022 data-ipsquote-contentid=\u002288777\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221457026989\u0022 data-ipsquote-userid=\u0022136047\u0022 data-ipsquote-username=\u0022Svm420\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nOn 3/3/2016 at 6:43 PM, Svm420 said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nWould you mind sharing your improved dll?\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nSure. This is my interim version of BackgroundProcessing with some fixes for KSP 1.0.5. All credits goes to the original author, @jamespicone.\u00A0Please report any problems you may found.\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cs\u003EBackgroundProcessing for KSP 1.0.5\u003C/s\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nEDIT [March 07 2016]: updated, now do ad-hoc\u00A0raycasting of celestial bodies, instead of using KSP game engine\n\u003C/p\u003E\n\u003Cp\u003E\nEDIT [July 26 2016]: obsolete link removed\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-07-26T20:26:16Z\u0022 title=\u002207/26/2016 08:26  PM\u0022 data-short=\u00227 yr\u0022\u003EJuly 26, 2016\u003C/time\u003E by ShotgunNinja\u003C/strong\u003E\n\u003Cbr\u003Eobsolete link removed\n\u003C/span\u003E\n"}]}