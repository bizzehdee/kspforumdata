{"TopicId":102909,"ForumId":29,"TopicTitle":"KSP Plugin debugging and profiling for Visual Studio and Monodevelop on all OS","CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2015-03-29T11:09:00Z","PageNum":2,"Articles":[{"CreatedByName":"Valerian","CreatedById":124076,"CreatedDateTime":"2015-05-09T09:14:54Z","Content":"That\u0027s amazing, thank you!"},{"CreatedByName":"rhjoerg","CreatedById":147022,"CreatedDateTime":"2015-06-26T16:52:05Z","Content":"Thanks alot for the KspDevModPatcher.\n\nThe following changes are required for 1.0.4 :\n\n- Patching MapView is no longer needed (has no .cctor anymore)\n\n- Patching PhysicsGlobals changed to \u0022\\u0013\\u0002\u0022 (was \u0022\\u000A\\u0002\u0022)"},{"CreatedByName":"Teknoman117","CreatedById":53200,"CreatedDateTime":"2015-07-10T01:30:45Z","Content":"What version of Unity does KSP 1.0.4 use? Also, at this point, do we still need to use the angrilov mono lib?"},{"CreatedByName":"DMagic","CreatedById":57416,"CreatedDateTime":"2015-07-10T01:47:06Z","Content":"\u003E \n\u003E What version of Unity does KSP 1.0.4 use? Also, at this point, do we still need to use the angrilov mono lib?\n\nInitialize engine version: 4.6.4f1\n\nIt\u0027s always the first line in the output\\_log file."},{"CreatedByName":"Teknoman117","CreatedById":53200,"CreatedDateTime":"2015-07-10T04:13:43Z","Content":"Could someone upload the 1.0.4 compatible patcher tool? I\u0027m having trouble building it myself. It keeps throwing exceptions when running the patches on HighLogic..."},{"CreatedByName":"seanmcdougall","CreatedById":143691,"CreatedDateTime":"2015-07-10T14:04:40Z","Content":"\u003E \n\u003E Could someone upload the 1.0.4 compatible patcher tool? I\u0027m having trouble building it myself. It keeps throwing exceptions when running the patches on HighLogic...\n\nYou can grab a copy from my GitHub repo at [https://github.com/seanmcdougall/KspDevModePatcher/releases/download/v1.0.4/KspDevModePatcher.zip](https://github.com/seanmcdougall/KspDevModePatcher/releases/download/v1.0.4/KspDevModePatcher.zip) \n\nIt contains [**rhjoerg**](https://forum.kerbalspaceprogram.com/members/150676-rhjoerg)\u0027s changes, and I\u0027ve used it successfully with 1.0.4."},{"CreatedByName":"Teknoman117","CreatedById":53200,"CreatedDateTime":"2015-07-11T21:44:15Z","Content":"Thanks, but still having issues. Doesn\u0027t seem to work under Mono on Linux, even if I recompile it in .NET 3.5 mode and link against the version of Mono.Cecil that comes with KSP.\n\nEdit: Log - [http://pastebin.com/HGEy9K6Y](http://pastebin.com/HGEy9K6Y)\n\n**Edited \u003Ctime datetime=\u00222015-07-11T21:47:28Z\u0022 title=\u002207/11/2015 09:47  PM\u0022 data-short=\u00228 yr\u0022\u003EJuly 11, 2015\u003C/time\u003E by Teknoman117**"},{"CreatedByName":"seanmcdougall","CreatedById":143691,"CreatedDateTime":"2015-07-12T22:00:11Z","Content":"Weird... I haven\u0027t tried compiling it under Linux yet, just through VS 2013 on Windows 7. Hopefully someone else has some suggestions."},{"CreatedByName":"Alshain","CreatedById":110959,"CreatedDateTime":"2015-08-12T22:12:37Z","Content":"I\u0027m a bit new to this and I followed the instruction step by step (including the 1.0 patcher tool) but when I go to create my mdb it fails. Can anyone help me out with this?\n\n    C:\\Kerbal Space Program Dev\\GameData\u003E\u0022C:\\Program Files (x86)\\Unity\\Editor\\Data\\MonoBleedingEdge\\bin\\cli.bat\u0022  \u0022C:\\Program Files (x86)\\Unity\\Editor\\Data\\MonoBleedingEdge\\lib\\mono\\4.0\\pdb2mdb.exe\u0022 Categories.dllFatal error:Microsoft.Cci.Pdb.PdbDebugException: Unknown custom metadata item kind: 6  at Microsoft.Cci.Pdb.PdbFunction.ReadCustomMetadata (Microsoft.Cci.Pdb.BitAccess bits) [0x00000] in :0  at Microsoft.Cci.Pdb.PdbFunction..ctor (System.String module, ManProcSym proc, Microsoft.Cci.Pdb.BitAccess bits) [0x00000] in :0  at Microsoft.Cci.Pdb.PdbFunction.LoadManagedFunctions (System.String module, Microsoft.Cci.Pdb.BitAccess bits, UInt32 limit, Boolean readStrings) [0x00000] in :0  at Microsoft.Cci.Pdb.PdbFile.LoadFuncsFromDbiModule (Microsoft.Cci.Pdb.BitAccess bits, Microsoft.Cci.Pdb.DbiModuleInfo info, Microsoft.Cci.Pdb.IntHashTable names, System.Collections.ArrayList funcList, Boolean readStrings, Microsoft.Cci.Pdb.MsfDirectory dir, System.Collections.Generic.Dictionary\u00602 nameIndex, Microsoft.Cci.Pdb.PdbReader reader) [0x00000] in :0  at Microsoft.Cci.Pdb.PdbFile.LoadFunctions (System.IO.Stream read, Microsoft.Cci.Pdb.BitAccess bits, Boolean readAllStrings) [0x00000] in :0  at Microsoft.Cci.Pdb.PdbFile.LoadFunctions (System.IO.Stream read, Boolean readAllStrings) [0x00000] in :0  at Pdb2Mdb.Driver.Convert (Mono.Cecil.AssemblyDefinition assembly, System.IO.Stream pdb, Mono.CompilerServices.SymbolWriter.MonoSymbolWriter mdb) [0x00000] in :0\n\n**Edited \u003Ctime datetime=\u00222015-08-12T22:16:42Z\u0022 title=\u002208/12/2015 10:16  PM\u0022 data-short=\u00228 yr\u0022\u003EAugust 12, 2015\u003C/time\u003E by Alshain**"},{"CreatedByName":"seanmcdougall","CreatedById":143691,"CreatedDateTime":"2015-08-12T22:30:50Z","Content":"\u003E \n\u003E I\u0027m a bit new to this and I followed the instruction step by step (including the 1.0 patcher tool) but when I go to create my mdb it fails. Can anyone help me out with this?\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E \n\u003E     C:\\Kerbal Space Program Dev\\GameData\u003E\u0022C:\\Program Files (x86)\\Unity\\Editor\\Data\\MonoBleedingEdge\\bin\\cli.bat\u0022  \u0022C:\\Program Files (x86)\\Unity\\Editor\\Data\\MonoBleedingEdge\\lib\\mono\\4.0\\pdb2mdb.exe\u0022 Categories.dllFatal error:Microsoft.Cci.Pdb.PdbDebugException: Unknown custom metadata item kind: 6  at Microsoft.Cci.Pdb.PdbFunction.ReadCustomMetadata (Microsoft.Cci.Pdb.BitAccess bits) [0x00000] in :0  at Microsoft.Cci.Pdb.PdbFunction..ctor (System.String module, ManProcSym proc, Microsoft.Cci.Pdb.BitAccess bits) [0x00000] in :0  at Microsoft.Cci.Pdb.PdbFunction.LoadManagedFunctions (System.String module, Microsoft.Cci.Pdb.BitAccess bits, UInt32 limit, Boolean readStrings) [0x00000] in :0  at Microsoft.Cci.Pdb.PdbFile.LoadFuncsFromDbiModule (Microsoft.Cci.Pdb.BitAccess bits, Microsoft.Cci.Pdb.DbiModuleInfo info, Microsoft.Cci.Pdb.IntHashTable names, System.Collections.ArrayList funcList, Boolean readStrings, Microsoft.Cci.Pdb.MsfDirectory dir, System.Collections.Generic.Dictionary\u00602 nameIndex, Microsoft.Cci.Pdb.PdbReader reader) [0x00000] in :0  at Microsoft.Cci.Pdb.PdbFile.LoadFunctions (System.IO.Stream read, Microsoft.Cci.Pdb.BitAccess bits, Boolean readAllStrings) [0x00000] in :0  at Microsoft.Cci.Pdb.PdbFile.LoadFunctions (System.IO.Stream read, Boolean readAllStrings) [0x00000] in :0  at Pdb2Mdb.Driver.Convert (Mono.Cecil.AssemblyDefinition assembly, System.IO.Stream pdb, Mono.CompilerServices.SymbolWriter.MonoSymbolWriter mdb) [0x00000] in :0\n\nAre you using Visual Studio 2015 by any chance? There seems to be [an incompatibility between VS 2015 and pdb2mdb.exe](https://forum.kerbalspaceprogram.com/threads/129573-pdb2mdb-bit-error-in-Visual-Studio-2015). I\u0027m using VS 2013 Community Edition and it works great, so it looks like you might have to downgrade."},{"CreatedByName":"Alshain","CreatedById":110959,"CreatedDateTime":"2015-08-12T22:36:30Z","Content":"\u003E \n\u003E Are you using Visual Studio 2015 by any chance? There seems to be [an incompatibility between VS 2015 and pdb2mdb.exe](https://forum.kerbalspaceprogram.com/threads/129573-pdb2mdb-bit-error-in-Visual-Studio-2015). I\u0027m using VS 2013 Community Edition and it works great, so it looks like you might have to downgrade.\n\nYes, I am using 2015. That is unfortunate, I really don\u0027t want to downgrade for other reasons outside of KSP. I may just have to wait, presumably an updated converter is in the Unity 5 package.\n\n**Edited \u003Ctime datetime=\u00222015-08-12T22:56:01Z\u0022 title=\u002208/12/2015 10:56  PM\u0022 data-short=\u00228 yr\u0022\u003EAugust 12, 2015\u003C/time\u003E by Alshain**"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2015-08-13T10:13:14Z","Content":"Try with the one here : [https://gist.github.com/jbevain/ba23149da8369e4a966f](https://gist.github.com/jbevain/ba23149da8369e4a966f)\n\nI did not try it much myself but I\u0027ll have a look soonish."},{"CreatedByName":"Alshain","CreatedById":110959,"CreatedDateTime":"2015-08-13T20:12:19Z","Content":"\u003E \n\u003E Try with the one here : [https://gist.github.com/jbevain/ba23149da8369e4a966f](https://gist.github.com/jbevain/ba23149da8369e4a966f)\n\u003E I did not try it much myself but I\u0027ll have a look soonish.\n\nI tried it but got an Unhandled Exception error. Though the description says the Visual Studio tools for Unity can do this automatically? I have those installed."},{"CreatedByName":"belpyro","CreatedById":120761,"CreatedDateTime":"2015-09-03T17:58:22Z","Content":"I use last Mono installer from Mono site and use pdb2mdb.bat from Mono folder. It wrks for me with Visual Studio 2015 Ent."},{"CreatedByName":"Fwiffo","CreatedById":148084,"CreatedDateTime":"2015-09-11T11:09:29Z","Content":"Just want to say thanks to everyone here. I was able to grab the Advanced Fly-By-Wire mod\u0027s source code and get it to run with VS2015 debug capabilities using the tips in this thread and belpyro\u0027s other reply [here](https://forum.kerbalspaceprogram.com/threads/129573-pdb2mdb-bit-error-in-Visual-Studio-2015?p=2144973\u0026viewfull=1#post2144973).\n\nOne small deviation - instead of using pdb2mdb.bat my build events look something like this:\n\n...\n\n\u0022C:\\Program Files (x86)\\mono\\bin\\mono.exe\u0022 \u0022C:\\Program Files (x86)\\mono\\lib\\mono\\4.5\\pdb2mdb.exe\u0022 ksp-advanced-flybywire.dll\n\nxcopy /Y ksp-advanced-flybywire.pdb \u0022C:\\Program Files (x86)\\Games\\Kerbal Space Program\\GameData\\ksp-advanced-flybywire\\\u0022\n\nxcopy /Y ksp-advanced-flybywire.dll.mdb \u0022C:\\Program Files (x86)\\Games\\Kerbal Space Program\\GameData\\ksp-advanced-flybywire\\\u0022\n\nWhen I referenced the bat file, I think it wasn\u0027t waiting for the command to complete before moving onto the next one (or something like that - no time to investigate - did try using start /wait).\n\n**Now a question:** I don\u0027t suppose anyone\u0027s figured out a way to achieve Edit-And-Continue capabilities?\n\nI know that feature is precluded when you attach to processes. I don\u0027t know much about Unity, but came across this link talking about some kind of ability to serialize game-state, recompile, then deserialize, to effectively achieve on-the-fly code updates:\n\n[http://answers.unity3d.com/questions/532242/editing-code-in-debug-mode.html](http://answers.unity3d.com/questions/532242/editing-code-in-debug-mode.html)\n\nWondering if there\u0027s any hope here, e.g. some wild ideas...\n\n- load a DLL that\u0027s hosted in Visual Studio devenv\n\n- dynamically load a new version of a DLL into the game without restarting it\n\n- write a clever DLL that can then dynamically load/unload a child one (or delegate the bulk of the code to some kind of embedded scripting language)\n\n**Edited \u003Ctime datetime=\u00222015-09-11T11:16:59Z\u0022 title=\u002209/11/2015 11:16  AM\u0022 data-short=\u00228 yr\u0022\u003ESeptember 11, 2015\u003C/time\u003E by Fwiffo**"},{"CreatedByName":"EladDv","CreatedById":118368,"CreatedDateTime":"2015-09-11T12:26:56Z","Content":"i guess if you reload the database it would load the dll again but i am not 100% sure"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2015-09-11T15:02:07Z","Content":"it does reload the dlls but since you can\u0027t write over them while they are open...\n\nHarvester said KSP 1.1 will use shadow copy so we may be able to hot load/reload mods dll. We will have to wait before we see how/if we can use it for that."},{"CreatedByName":"Fwiffo","CreatedById":148084,"CreatedDateTime":"2015-09-24T05:41:33Z","Content":"\u003E \n\u003E it does reload the dlls but since you can\u0027t write over them while they are open...\n\u003E Harvester said KSP 1.1 will use shadow copy so we may be able to hot load/reload mods dll. We will have to wait before we see how/if we can use it for that.\n\nCool! I realize this isn\u0027t a high priority for the developers but it sure would be convenient. In the meantime I was pondering writing a \u0022shim\u0022 DLL that delegates the heavy lifting out to some other module (e.g. DLL loaded in a separate AppDomain so we can tear it down and load in a new version, scripting language with the shim using Reflection to ferry SDK calls between the module and the API, etc). But it\u0027s all kind of pie in the sky at the moment.\n\n(ps. On another note - I\u0027m a bit wary of Shadow Copy ever since having all kinds of VSS issues on servers with various backup software we use. In the early days it just seemed to get corrupted a lot and required a bunch of manual intervention to sort out and get working again. Hope they\u0027ve fixed the problems. I do believe .NET can load / unload assemblies dynamically though and release the file locks without requiring VSS)"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2015-09-24T12:29:41Z","Content":"Unity still uses Mono (and an old one) so some .Net tricks may not work"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2015-09-24T17:16:25Z","Content":"\u003E \n\u003E In the meantime I was pondering writing a \u0022shim\u0022 DLL that delegates the heavy lifting out to some other module (e.g. DLL loaded in a separate AppDomain so we can tear it down and load in a new version, scripting language with the shim using Reflection to ferry SDK calls between the module and the API, etc).\n\nI was working on something along these lines when I had my eureka moment that lead to the birth of [AssemblyReloader](https://forum.kerbalspaceprogram.com/threads/134879). Have a look at the WIP thread if you\u0027re interested, I\u0027d love any feedback"},{"CreatedByName":"JPLRepo","CreatedById":114736,"CreatedDateTime":"2015-10-01T03:44:45Z","Content":"Does anyone know how to get Xamarin on OSX to connect to unity runtime to debug?\n\nI have got all this working under a Windows 7 VM and I have successfully got the DEV mode KSP to work, but I can\u0027t get Xamarin to connect to it (there doesn\u0027t seem to be a way?). I found tools for Xamarin to do this that work with Unity 5, but has anyone got this working under OSX to connect Xamarin to the runtime unity for current version (4.6.4)?"},{"CreatedByName":"MrHappyFace","CreatedById":76365,"CreatedDateTime":"2015-10-01T04:06:22Z","Content":"\u003E \n\u003E Does anyone know how to get Xamarin on OSX to connect to unity runtime to debug?\n\nI second this. It would be really helpful if this could work for Xamarin."},{"CreatedByName":"pulp_user","CreatedById":88024,"CreatedDateTime":"2015-11-08T15:31:25Z","Content":"Everything works for me, except the Debugging itself. I don\u0027t get any errors creating the mdb file or something like this, and attaching the unity debugger also works fine. But it simply does not debug. It doesn\u0027t care about breaking points, or doesnt even show function calls, or values of variables. Do I miss something obvius here? what I have done so far:\n\n I followed you instructions on installing (I guess nothing has gone wrong here, since I would have problems earlier)\n\n1. Set breaking points in my mod.cs file\n\n2. Build the Project, and get a dll and pdb file\n\n3. Build the dll.mdb file using this line in a bat file: \u0022D:\\Programme\\Unity4\\_6\\_4f1\\Editor\\Data\\MonoBleedingEdge\\bin\\cli.bat\u0022 \u0022D:\\Programme\\Unity4\\_6\\_4f1\\Editor\\Data\\MonoBleedingEdge\\lib\\mono\\4.0\\pdb2mdb.exe\u0022 mod.dll\n\n4. Copy dll ptb and mdb files into GameData/Mod/Plugins\n\n5. start the game\n\n6 attach debugger\n\nKSP runs normal, the mod functionality works normal, I just can\u0027t debug stuff. Do I set the Breakpoints right? I can bring the whole game to a halt btw, but that isnt very usefull ![:D](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif)"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2015-11-08T16:45:38Z","Content":"You will have to provide more info. VS version, unity VS version and a log. I m not sure I have time to look into it much today but I ll do soon.\n\nYou do attach with the \u0022Attach Unity debugger\u0022 option right ?\n\nEdit : if you use VS 2015 make sure to install Mono 4 somewhere and read [this post](https://forum.kerbalspaceprogram.com/threads/114241-KSP-Plugin-debugging-for-Visual-Studio-and-Monodevelop-on-all-OS?p=2189873\u0026viewfull=1#post2189873) to change how the mdb is generated\n\n**Edited \u003Ctime datetime=\u00222015-11-08T16:47:46Z\u0022 title=\u002211/08/2015 04:47  PM\u0022 data-short=\u00228 yr\u0022\u003ENovember 8, 2015\u003C/time\u003E by sarbian**"},{"CreatedByName":"pulp_user","CreatedById":88024,"CreatedDateTime":"2015-11-08T19:18:03Z","Content":"The post you linked solved the issue. Thanks! Works great!"}]}