{"TopicId":143249,"ForumId":20,"TopicTitle":"kOS Script not Working","CreatedByName":"Battledamaged10","CreatedById":156736,"CreatedDateTime":"2016-07-07T00:14:40Z","PageNum":1,"Articles":[{"CreatedByName":"Battledamaged10","CreatedById":156736,"CreatedDateTime":"2016-07-07T00:14:40Z","Content":"\n\u003Cp\u003E\nHi there, I\u0027m playing around with kOS in KSP and I keep getting an error whenever I try to run it. I\u0027ve made sure there is periods when needed (at least I hope there\u0027s periods where needed). I get this error: Syntax: Unexpected token \u0027{\u0027 found. Expected EOI at line 11.\n\u003C/p\u003E\n\u003Cp\u003E\nHere is my script:\n\u003C/p\u003E\n\u003Cdiv class=\u0022ipsSpoiler\u0022 data-ipsspoiler=\u0022\u0022\u003E\n\u003Cdiv class=\u0022ipsSpoiler_header\u0022\u003E\n\u003Cspan\u003ESpoiler\u003C/span\u003E\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsSpoiler_contents\u0022\u003E\n\u003Cp\u003E\n//engine and clamps on same stage.\n\u003C/p\u003E\n\u003Cp\u003E\n//launch.\u003Cbr\u003E\nclearscreen.\u003Cbr\u003E\nlock throttle to 1.\u003Cbr\u003E\nlock steering to up \u002B R(0,0,180).\u003Cbr\u003E\nwait 1.\u003Cbr\u003E\nstage.\n\u003C/p\u003E\n\u003Cp\u003E\n//gravity turn.\u003Cbr\u003E\nwait until altitude \u0026gt; 2000 {\u003Cbr\u003E\n\u00A0\u00A0 \u00A0lock steering to up \u002B R(0,-60,180).\u003Cbr\u003E\n}\n\u003C/p\u003E\n\u003Cp\u003E\n//fairing jettison.\u003Cbr\u003E\nwait until altitude \u0026gt; 50000 {\u003Cbr\u003E\n\u00A0\u00A0 \u00A0stage.\u003Cbr\u003E\n}\n\u003C/p\u003E\n\u003Cp\u003E\n//second stage.\u003Cbr\u003E\nwait until apoapsis = 120000 {\u003Cbr\u003E\n\u00A0\u00A0 \u00A0lock throttle to 0.\u003Cbr\u003E\n\u00A0\u00A0 \u00A0wait 1.\u003Cbr\u003E\n\u00A0\u00A0 \u00A0stage.\u003Cbr\u003E\n\u00A0\u00A0 \u00A0wait 1.\u003Cbr\u003E\n\u00A0\u00A0 \u00A0stage.\u003Cbr\u003E\n\u00A0\u00A0 \u00A0\u003Cabbr title=\u0022Reaction Control System\u0022\u003ERCS\u003C/abbr\u003E on.\u003Cbr\u003E\n\u00A0\u00A0 \u00A0lock steering to prograde.\u003Cbr\u003E\n}\n\u003C/p\u003E\n\u003Cp\u003E\n//orbit burn.\u003Cbr\u003E\nwait until eta:apoapsis \u0026lt; 25 {\u003Cbr\u003E\n\u00A0\u00A0 \u00A0lock throttle to 1.\u003Cbr\u003E\n}\u003Cbr\u003E\nwait until periapsis \u0026gt;= 120000 {\u003Cbr\u003E\n\u00A0\u00A0 \u00A0lock throttle to 0.\u003Cbr\u003E\n}\n\u003C/p\u003E\n\u003Cp\u003E\n//check orbit.\u003Cbr\u003E\nif apoapsis \u0026gt; 150000 {\u003Cbr\u003E\n\u00A0\u00A0 \u00A0wait until eta:periapsis \u0026lt; 35 {\u003Cbr\u003E\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0lock steering to retrograde.\u003Cbr\u003E\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0wait 5.\u003Cbr\u003E\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0lock throttle to 0.5.\u003Cbr\u003E\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0wait until apoapsis = 120000 {\u003Cbr\u003E\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0lock throttle to 0.\u003Cbr\u003E\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0}\u003Cbr\u003E\n\u00A0\u00A0 \u00A0}\u003Cbr\u003E\n\u00A0\u00A0 \u00A0else {\u003Cbr\u003E\n\u00A0\u00A0 \u00A0\u00A0\u00A0 \u00A0break.\u003Cbr\u003E\n\u00A0\u00A0 \u00A0}\u003Cbr\u003E\n}\n\u003C/p\u003E\n\u003Cp\u003E\n//payload deploy and finish.\u003Cbr\u003E\nwait 5.\u003Cbr\u003E\nstage.\u003Cbr\u003E\nAG1 on.\u003Cbr\u003E\nset ship:control:pilotmainthrottle to 0.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/div\u003E\n\u003Cp\u003E\nIt found the \u0022unexpected token\u0022 here: wait until altitude \u0026gt; 2000 {\n\u003C/p\u003E\n\u003Cp\u003E\nThanks \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2016-07-07T11:26:10Z","Content":"\n\u003Cp\u003E\nDelete the word \u0022wait\u0022 from the loops like this:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode\u0022\u003E\nwait until altitude \u0026gt; 2000 {\n    lock steering to up \u002B R(0,-60,180).\n} \u003C/pre\u003E\n\u003Cp\u003E\nso they become like this:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003Euntil altitude \u0026gt; 2000 {\n    lock steering to up \u002B R(0,-60,180).\n} \u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nThe command \u0022wait until\u0022 isn\u0027t a loop header.\u00A0 It\u0027s just a single line statement that says \u0022the program will do nothing and be stuck on this line until the condition is true.\u0022\n\u003C/p\u003E\n\u003Cp\u003E\nThe command \u0022until\u0022, on the other hand, is a loop header.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nThat being said, there\u0027s some other problems in the code, but you haven\u0027t encountered them yet because of that syntax error.\u00A0 When you get rid of those syntax errors, you\u0027ll run into the following issues next:\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n(1) \u003Cspan style=\u0022color:#4B0082;\u0022\u003Econstantly re-running lock steering\u003C/span\u003E: \u00A0 There\u0027s no point in (and it\u0027s actually detrimental to be) re-running the lock statement again and again inside a loop if you\u0027re not actually changing the formula you\u0027re using.\u00A0 The whole point of \u0022lock\u0022 is that you give it a formula and it can re-run it when it needs to.\u00A0 When using lock steering, re-running the lock statement again and again essentially turns kOS\u0027s PID controller into just a dumb \u0022P\u0022 controller, since you keep telling it to make a fresh start with a \u0022new\u0022 steering formula, so it clears its memory of how it\u0027s been behaving under the \u0022old\u0022 one.\u00A0 (It doesn\u0027t realize the \u0022new\u0022 and the \u0022old\u0022 one are identical and it didn\u0027t need to do that.)\n\u003C/p\u003E\n\u003Cp\u003E\n(2) \u003Cspan style=\u0022color:#4B0082;\u0022\u003Ebusy looping fast without an explicit wait:\u003C/span\u003E The loop you are trying to run, not only re-locks the steering again and again unnecessarily, but also pointlessly re-executes it *multiple times per game-engine update*, even though it can\u0027t have any effect until the next \u0027physics tick\u0027 of the game engine anyway.\u00A0 Usually when you do have a loop like this, you want to explicitly allow a \u0027tick\u0027 to pass in between iterations by inserting a \u0027wait 0.\u0027 (wait the minimum possible wait time, which is just until the next \u0027tick\u0027.) into the loop body.\n\u003C/p\u003E\n\u003Cp\u003E\nBut that being said, I only mention (1) and (2) for your future information in situations where you do use loops, because what you *probably* really want to do in this specific instance is just get rid of this loop entirely and turn this:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode\u0022\u003E\nwait until altitude \u0026gt; 2000 {\n    lock steering to up \u002B R(0,-60,180).\n} \u003C/pre\u003E\n\u003Cp\u003E\ninto this:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode\u0022\u003E\nlock steering to up \u002B R(0,-60,180). // no need to loop this - it will keep being re-run in the background by the kOS steering manager.\nwait until altitude \u0026gt; 2000. // just do nothing and sit here until the condition is true.\u003C/pre\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"boa3532","CreatedById":57325,"CreatedDateTime":"2016-07-07T21:10:32Z","Content":"\n\u003Cp\u003E\nCould a THEN statement be added instead? Sorry, still learning kOS as well.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nwait until altitude \u0026gt; 2000 { then\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nlock steering to up \u002B R(0,-60,180).\n\u003C/p\u003E\n\u003Cp\u003E\n}\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"kcs123","CreatedById":127158,"CreatedDateTime":"2016-07-07T21:31:27Z","Content":"\n\u003Cp\u003E\nRather use structure like this:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode\u0022\u003E\nlock steering to up \u002B R(0,-60,180). // you don\u0027t need it inside loop if you don\u0027t want to change direction\n\nuntil altitude \u0026gt; 2000 {\n// execute some other commands if needed\nwait 0.1.\n}. // don\u0027t foreget \u0022.\u0022 after closed bracket - main reason for your previous error\u003C/pre\u003E\n\u003Cp\u003E\nEDIT:\n\u003C/p\u003E\n\u003Cp\u003E\nSteven have probably provided better answer, forgot to read whole thread before posting.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-07-07T21:34:15Z\u0022 title=\u002207/07/2016 09:34  PM\u0022 data-short=\u00228 yr\u0022\u003EJuly 7, 2016\u003C/time\u003E by kcs123\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2016-07-08T03:28:03Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222665783\u0022 data-ipsquote-contentid=\u0022143249\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221467927087\u0022 data-ipsquote-userid=\u0022127158\u0022 data-ipsquote-username=\u0022kcs123\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n5 hours ago, kcs123 said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode\u0022\u003E\n\n\n}. // don\u0027t foreget \u0022.\u0022 after closed bracket - main reason for your previous error\u003C/pre\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nNot true.\u00A0 Period at the end of a bracketed section is optional.\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"kcs123","CreatedById":127158,"CreatedDateTime":"2016-07-08T15:11:05Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222666244\u0022 data-ipsquote-contentid=\u0022143249\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221467948483\u0022 data-ipsquote-userid=\u002263481\u0022 data-ipsquote-username=\u0022Steven Mading\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n11 hours ago, Steven Mading said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nNot true.\u00A0 Period at the end of a bracketed section is optional.\u00A0\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nDon\u0027t know why I thought that is needed to be. Probably I got confused with different programing languages and my old habit to put \u0022.\u0022 or \u0022;\u0022 after each command or block. Perhaps jumping from one language to other on daily basis have left some marks on brain \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u003C/p\u003E\n"}]}