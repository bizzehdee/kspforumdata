{"TopicId":60281,"ForumId":36,"TopicTitle":"[Hardware, Plugin] Arduino based physical display \u002B serial port io\u002B tutorial (24-11-19)","CreatedByName":"zitronen","CreatedById":11842,"CreatedDateTime":"2014-01-18T01:25:25Z","PageNum":34,"Articles":[{"CreatedByName":"T.A.P.O.R.","CreatedById":137748,"CreatedDateTime":"2015-02-10T09:02:35Z","Content":"\n\u003Cp\u003EHi Everyone,\u003C/p\u003E\u003Cp\u003EA big thanks to \u003Cstrong\u003Ezitronen\u003C/strong\u003E for developing the demo code \u0026amp; plugin as well as thanks to everyone else who has posted in this thread.\u003C/p\u003E\u003Cp\u003EIt has been most helpful and has answered all of my questions up to now.\u003C/p\u003E\u003Cp\u003EOrdinarily I\u0027d just keep at it, but I have other things that demand my attention (family/education) and I want to get this working so that I can move on to the fun stuff \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003ESo far I managed to get all the basics going, the 3 basic lights and some switches.\u003C/p\u003E\u003Cp\u003EThat much I understand, but I\u0027m stuck on the MAX7219 8 Digit 7 Segment Display code.\u003C/p\u003E\u003Cp\u003EI added the library \u0026amp; defined my pins at the beginning of the KSPIODemo10 tab. Not sure if that\u0027s the place to do it, but I\u0027m a total novice with this stuff \u0026amp; seems to work.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003C/pre\u003E\u003Cdiv\u003E[INDENT]\u003C/div\u003E\u003Cdiv\u003E#include \u0026lt;LedControl.h\u0026gt;\u003C/div\u003E\u003Cdiv\u003E[/INDENT]\u003C/div\u003E\u003Cp\u003E\u003Cbr\u003E\u003Cbr\u003E\u003C/p\u003E\u003Cdiv\u003E #define LEDClkPin 11\u003C/div\u003E\u003Cbr\u003E\u003Cdiv\u003E #define LEDChipSel 10 \u003C/div\u003E\u003Cbr\u003E\u003Cdiv\u003E #define LEDDatain 12\u003C/div\u003E\u003Cbr\u003E\u003Cbr\u003E\u003Cdiv\u003E LedControl lc=LedControl(LEDDatain,LEDClkPin,LEDChipSel,2);//1==num of 8x8pixel arrays in line. can be up to 8.\u003C/div\u003E\u003Cbr\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EMy guess is that I need to disable some other functions that want to use pins 10, 11 \u0026amp; 12\u003C/p\u003E\u003Cp\u003EBut when I added // to skip the existing lines the sketch threw up errors on another tab.\u003C/p\u003E\u003Cp\u003EI used the following Void Loop() code as \u003Cstrong\u003EMulbin \u003C/strong\u003Eseemed to have some luck with it after correcting a wiring error:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022AmeliaEatyaheart\u0022 data-cite=\u0022AmeliaEatyaheart\u0022\u003E\u003Cdiv\u003E\u003Cdiv\u003EReplace the example numbers in the sketch with flight data \u003C/div\u003E\u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003EBadly typed example:\u003C/div\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003C/pre\u003E\u003Cdiv\u003Evoid loop()\u003C/div\u003E\u003Cbr\u003E\u003Cdiv\u003E{\u003C/div\u003E\u003Cbr\u003E\u003Cdiv\u003Einput();\u003C/div\u003E\u003Cbr\u003E\u003Cdiv\u003Eoutput();\u003C/div\u003E\u003Cbr\u003E\u003Cdiv\u003EprintNumLED(0, (long)(VData.Alt/100), \u0027 \u0027,2);//will print the altimeter with 2 decimal places (i.e. 12345.67 metres)\u003C/div\u003E\u003Cbr\u003E\u003Cdiv\u003EprintNumLED(0, (long)(VData.AP/1000), \u0027A\u0027,3);//will print the apoapsis as kilometers, with 3 dp (i.e. \u0027A 96.321\u0027 km)\u003C/div\u003E\u003Cbr\u003E\u003Cbr\u003E\u003Cdiv\u003E}//end loop\u003C/div\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E//note: adding things into mainloop is not the best, but makes for quick examples.\u003C/div\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EI also included the \u0022LedControlFunctions\u0022 tab from\u003Cstrong\u003E AmeliaEatyaheart\u0027s\u003C/strong\u003E sketch and it sort of works, displaying 0000 on the right hand side and seems to handshake with the plugin, but the numbers don\u0027t change.\u003C/p\u003E\u003Cp\u003EDo I need to add another bit of code to the void setup(), or am I in for some editing to get the pins to do what I want?\u003C/p\u003E\u003Cp\u003ESorry if I\u0027m missing something obvious, but my only code experience is VB Script in Excel.\u003C/p\u003E\n"},{"CreatedByName":"zitronen","CreatedById":11842,"CreatedDateTime":"2015-02-11T16:18:16Z","Content":"\n\u003Cp\u003EUm I think Mulbin would be the one to help you, since he has basically asked all the questions. See if you can PM him and get his working code.\u003C/p\u003E\n"},{"CreatedByName":"Mulbin","CreatedById":55562,"CreatedDateTime":"2015-02-11T17:06:20Z","Content":"\n\u003Cp\u003EI\u0027ll dig out my code later and share it, can\u0027t remember off the top of my head!\u003C/p\u003E\n"},{"CreatedByName":"T.A.P.O.R.","CreatedById":137748,"CreatedDateTime":"2015-02-11T20:09:34Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022zitronen\u0022 data-cite=\u0022zitronen\u0022\u003E\u003Cdiv\u003EUm I think Mulbin would be the one to help you, since he has basically asked all the questions. See if you can PM him and get his working code.\u003C/div\u003E\u003C/blockquote\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Mulbin\u0022 data-cite=\u0022Mulbin\u0022\u003E\u003Cdiv\u003EI\u0027ll dig out my code later and share it, can\u0027t remember off the top of my head!\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThanks guys,\u003C/p\u003E\u003Cp\u003EI eagerly (but not too eagerly, as I know you have things to do) await your response.\u003C/p\u003E\u003Cp\u003EMy project initially started out as a physical keyboard hack, but came undone when I accidentally ripped the trace off the USB board.\u003C/p\u003E\u003Cp\u003EThen I found a cheap Arduino Uno \u0026amp; this thread \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EAdded A Gif of my display troubles.\u003C/p\u003E\u003Cp\u003EThis is what happens with \u003Cstrong\u003EAmeliaEatyaheart\u0027s \u003C/strong\u003Ein the Void Loop after loading the sketch or pressing the reset switch.\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022https://lh3.googleusercontent.com/-WIcqP646pNo/VOlSGYtwLUI/AAAAAAAABiI/vdCl_9a7qPg/s480/8segLed.gif\u0022 alt=\u00228segLed.gif\u0022\u003E\u003C/p\u003E\u003Cp\u003EWhen I place the same code in Void Setup, the Numbers are Static eg: A 0.000\u003C/p\u003E\u003Cp\u003EI did get the Altimeter working with a regular 16*2 LCD panel, but this has me scratching my head.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-02-22T04:01:16Z\u0022 title=\u002202/22/2015 04:01  AM\u0022 data-short=\u00229 yr\u0022\u003EFebruary 22, 2015\u003C/time\u003E by T.A.P.O.R.\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"marzubus","CreatedById":68021,"CreatedDateTime":"2015-02-21T14:05:15Z","Content":"\n\u003Cp\u003EHi guys, \u003C/p\u003E\u003Cp\u003EI have merged my Cross Platform code-base with 0.17.1 upstream, so there is a testable Mac / Linux binary now up at\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022https://github.com/unixunion/KSPSerialIO/tree/master/release/0.17.1\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/unixunion/KSPSerialIO/tree/master/release/0.17.1\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EI have only done the most basic of tests since my control panel is still under construction. If someone wants to test some of the new features on Mac or Linux.\u003C/p\u003E\n"},{"CreatedByName":"Freshmeat","CreatedById":111048,"CreatedDateTime":"2015-02-22T09:52:10Z","Content":"\n\u003Cp\u003E@T.A.P.O.R. Setup is only run once. Anything that should change needs to be in the Void Loop(), which is run over and over continuously while the Arduino receives power.\u003C/p\u003E\n"},{"CreatedByName":"T.A.P.O.R.","CreatedById":137748,"CreatedDateTime":"2015-02-22T19:29:12Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Freshmeat\u0022 data-cite=\u0022Freshmeat\u0022\u003E\u003Cdiv\u003E@T.A.P.O.R. Setup is only run once. Anything that should change needs to be in the Void Loop(), which is run over and over continuously while the Arduino receives power.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThanks Freshmeat,\u003C/p\u003E\u003Cp\u003EWhile I didn\u0027t know that about the setup, the image comes from the loop.\u003C/p\u003E\u003Cp\u003EIt only runs once (per reset) then goes dark.\u003C/p\u003E\n"},{"CreatedByName":"MrOnak","CreatedById":104432,"CreatedDateTime":"2015-02-23T08:38:32Z","Content":"\n\u003Cp\u003EIf you post your sourcecode I\u0027m pretty sure we can help\u003C/p\u003E\n"},{"CreatedByName":"T.A.P.O.R.","CreatedById":137748,"CreatedDateTime":"2015-02-23T20:10:57Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022MrOnak\u0022 data-cite=\u0022MrOnak\u0022\u003E\u003Cdiv\u003EIf you post your sourcecode I\u0027m pretty sure we can help\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EIf you say so \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EThere have been a few variations on this, but the result is pretty much the same.\u003C/p\u003E\u003Cp\u003EI\u0027ve called the Led Control Library and placed it at the very top of KSPIODemo10\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E#include \u0026lt;LedControl.h\u0026gt;\u003Cbr\u003E\u003Cbr\u003E//Test sketch for MAX7219 module 7 segment displays.\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E#include \u0026lt;LedControl.h\u0026gt;    \u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E        #define    LEDClkPin   11\u003Cbr\u003E        #define    LEDChipSel  10  \u003Cbr\u003E        #define    LEDDatain   12\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E        LedControl lc=LedControl(LEDDatain,LEDClkPin,LEDChipSel,12);\u003Cbr\u003E\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EThe only other changes I made were in the setup \u0026amp; loop and including the LedControlFunctions tab from \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/66393-Hardware-Plugin-Arduino-based-physical-display-serial-port-io-tutorial-%2817-Dec%29?p=1664438\u0026amp;viewfull=1#post1664438\u0022 rel=\u0022external nofollow\u0022\u003E\u003Cstrong\u003Ethis post\u003C/strong\u003E\u003C/a\u003E\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E\u003Cbr\u003Evoid setup()\u003C/pre\u003E\u003Cp\u003E[INDENT]{[/INDENT]\u003C/p\u003E\u003Cp\u003E\u003Cbr\u003E[INDENT=2] Serial.begin(38400);\u003Cbr\u003E blankLEDscreens();[/INDENT]\u003Cbr\u003E\u003C/p\u003E\u003Cp\u003E[INDENT]}[/INDENT]\u003C/p\u003E\u003Cp\u003E\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003Evoid loop()\u003C/p\u003E\u003Cp\u003E[INDENT]{\u003Cbr\u003E[/INDENT]\u003C/p\u003E\u003Cp\u003E\u003Cbr\u003E[INDENT=2]input();\u003Cbr\u003Eoutput(); [/INDENT]\u003Cbr\u003E[INDENT=2]printNumLED(0, (long)(VData.Alt/100), \u0027A\u0027,2);[/INDENT]\u003Cbr\u003E[INDENT=2]printNumLED(1, (long)(VData.AP/1000), \u0027B\u0027,3);[/INDENT]\u003Cbr\u003E\u003C/p\u003E\u003Cp\u003E[INDENT]}[/INDENT]\u003C/p\u003E\u003Cp\u003E\u003Cbr\u003E\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\n"},{"CreatedByName":"stibbons","CreatedById":57865,"CreatedDateTime":"2015-02-25T11:04:16Z","Content":"\n\u003Cp\u003EHey zitronen, sorry I threw a bunch of code your way and then disappeared. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E Life got in the way there for a while.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022zitronen\u0022 data-cite=\u0022zitronen\u0022\u003E\u003Cdiv\u003EHey Stibbons, your fork still seems to be using \u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003EActiveVessel.Autopilot.SAS.ManualOverride(true);\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EI\u0027m trying to figure out what you did to change over to the new 0.90 autopilot stuff. I see you added some more options to the settings and rover stuff, so that\u0027s cool.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYou\u0027re right, I didn\u0027t have a full understanding of how the new autopilot code is supposed to work. I did update the callback handler the plugin was using to the new 0.90 input chain, but that\u0027s minor at best. Glad you liked the other changes enough to merge them though!\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022zitronen\u0022 data-cite=\u0022zitronen\u0022\u003E\u003Cdiv\u003EIntegrated new axes WheelSteer and WheelThrottle using code from Stibbons, now you can drive your rovers from your control panel!\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EAND IT IS AWESOME.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E\n\u003C/p\u003E\u003Cdiv class=\u0022ipsEmbeddedVideo\u0022 contenteditable=\u0022false\u0022\u003E\u003Cdiv\u003E\u003Ciframe width=\u0022480\u0022 height=\u0022270\u0022 src=\u0022https://www.youtube.com/embed/NA06_JjOKro?feature=oembed\u0022 frameborder=\u00220\u0022 allowfullscreen=\u0022true\u0022\u003E\u003C/iframe\u003E\u003C/div\u003E\u003C/div\u003E\u003Cp\u003E(ignore the forward/reverse directions being back to front in that video, it\u0027s what happens when you install the probe core in your unmanned rover upside down \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_sad.gif\u0022 alt=\u0022:(\u0022\u003E )\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022MrOnak\u0022 data-cite=\u0022MrOnak\u0022\u003E\u003Cdiv\u003EIn other news @Zitronen, the config.xml file has ThrottleEnable set to 2, which seems to require a \u0022throttle-off\u0022 (\u0022x\u0022 key) upon launch, in order to make the hardware throttle actually able to put the throttle in game to zero. Without the \u0022x\u0022 the game throttle simply jumps back to the 50% that it was at launch when the hardware throttle goes to zero. I\u0027ve changed the ThrottleEnable to 1, which seems to work better.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThe new options are great for the other axes (and I love that zitronen\u0027s set defaults that work for most use cases). But I don\u0027t think they\u0027re ideal for the throttle. I agree that setting it to 1 is usually the best option if you have a hardware throttle. 1 is identical to the old enabled option - the plugin will always use the value sent by the arduino, and ignore keyboard input.\u003C/p\u003E\u003Cp\u003EMy use case for the new options is the same pair of sticks that are in the above video. For general flight I use a USB joystick for rotation control, which has a little digital hat for translation. During docking maneuvres I use the sticks on my controller for translational control, but at the flip of a conveniently-located switch they can make rotational changes instead. I\u0027ve docked with that setup a couple times, and it\u0027s also pretty awesome.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-02-25T11:17:46Z\u0022 title=\u002202/25/2015 11:17  AM\u0022 data-short=\u00229 yr\u0022\u003EFebruary 25, 2015\u003C/time\u003E by stibbons\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"marzubus","CreatedById":68021,"CreatedDateTime":"2015-02-25T11:12:24Z","Content":"\n\u003Cp\u003EHi Guys, Just thought id show you what I am working on with KSP Serial IO.\u003C/p\u003E\u003Cp\u003EIntroducing the CS40, telemetric joystick\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://i.imgur.com/CAqlzxZl.jpg\u0022 alt=\u0022CAqlzxZl.jpg\u0022\u003E\u003C/p\u003E\u003Cp\u003EIts still WIP, but getting there for sure! More details over at: \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/111724-Psimax-CS40-Telemetric-Joystick?p=1757734#post1757734\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://forum.kerbalspaceprogram.com/threads/111724-Psimax-CS40-Telemetric-Joystick?p=1757734#post1757734\u003C/a\u003E\u003C/p\u003E\n"},{"CreatedByName":"PsYcHo80","CreatedById":138397,"CreatedDateTime":"2015-02-26T17:44:16Z","Content":"\n\u003Cp\u003E\u003Cspan style=\u0022color:#333333;\u0022\u003EHi everyone, it\u0027s my first post here. I\u0027m making a control panel made of 2 arduinos, lcd, 2 sets of 8x7 segment displays, switches and propably 2 joysticks. The reason I need 2 arduinos is that the displays alone take up all pins on one arduino. Zitronen already suggested me to buy Mega, but right now I don\u0027t have funds for it and it will be a good prooving ground for me \u003C/span\u003E\u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 alt=\u0022:D\u0022\u003E. \u003Cspan style=\u0022color:#333333;\u0022\u003EI figured out the comunication between arduinos with SoftSerial and EasyTransfer, but it seems somewhat laggy. I forward every packet of VData to the second arduino but it looks like it\u0027s loosing sometimes even half a second of data. Does anyone know a way to help me? Maybe EasyTransferI2C will work faster? Any help will be appretiated. And Zitronen, thanks again for fast replies and an awesome plugin, you\u0027re the boss \u003C/span\u003E\u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 alt=\u0022:D\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"marzubus","CreatedById":68021,"CreatedDateTime":"2015-02-26T20:52:51Z","Content":"\n\u003Cp\u003EHow are using a stage shift like a SX1509 for adding more pins to your Arduino over i2c? \u003C/p\u003E\u003Cp\u003EThere are plenty of expansion IO options from spark fun for cheaper than a MEGA. \u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022PsYcHo80\u0022 data-cite=\u0022PsYcHo80\u0022\u003E\u003Cdiv\u003E\u003Cspan style=\u0022color:#333333;\u0022\u003EHi everyone, it\u0027s my first post here. I\u0027m making a control panel made of 2 arduinos, lcd, 2 sets of 8x7 segment displays, switches and propably 2 joysticks. The reason I need 2 arduinos is that the displays alone take up all pins on one arduino. Zitronen already suggested me to buy Mega, but right now I don\u0027t have funds for it and it will be a good prooving ground for me \u003C/span\u003E\u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 alt=\u0022:D\u0022\u003E. \u003Cspan style=\u0022color:#333333;\u0022\u003EI figured out the comunication between arduinos with SoftSerial and EasyTransfer, but it seems somewhat laggy. I forward every packet of VData to the second arduino but it looks like it\u0027s loosing sometimes even half a second of data. Does anyone know a way to help me? Maybe EasyTransferI2C will work faster? Any help will be appretiated. And Zitronen, thanks again for fast replies and an awesome plugin, you\u0027re the boss \u003C/span\u003E\u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 alt=\u0022:D\u0022\u003E\u003C/div\u003E\u003C/blockquote\u003E\n"},{"CreatedByName":"MrOnak","CreatedById":104432,"CreatedDateTime":"2015-02-27T06:27:26Z","Content":"\n\u003Cp\u003E@Psycho80: You can use really cheap ICs 74HC595 or 74HCT595 to expand your output ports. They are addressable over SPI and you\u0027ll need only a fixed number of pins (4 for output-only) on your arduino, no matter now many ICs you\u0027re addressing. Each 74595 will add eight output pins and you can chain them together. \u003C/p\u003E\u003Cp\u003EI\u0027m using 6 of them chained together to give me 48 outputs to drive 37 7-segment displays and 30 standard-LEDs in my work-in-progress controller. Soon I\u0027ll add another two 74595s for another 10 LEDs. All that requires 4 pins on the microcontroller. There\u0027s a schematic in the thread linked in my footer.\u003C/p\u003E\u003Cp\u003ENote that the 74595 provides only outputs. If you need inputs the 74HC165 is your friend. It works pretty much like the 74595 but provides 8 inputs per chip. And yes you can chain the 165s and the 595 together pretty much endlessly, requiring a fixed 5 pins (you need one more for the input line, which you don\u0027t need for output-only operation).\u003C/p\u003E\n"},{"CreatedByName":"PsYcHo80","CreatedById":138397,"CreatedDateTime":"2015-02-27T12:10:47Z","Content":"\n\u003Cp\u003EThanks for the replies, I might try that when I\u0027ll have money, but I\u0027m trying to work it out with what I\u0027ve got. Do you think that hardware I2C would work faster than software serial?\u003C/p\u003E\n"},{"CreatedByName":"MrOnak","CreatedById":104432,"CreatedDateTime":"2015-02-27T12:48:24Z","Content":"\n\u003Cp\u003Ehardware SPI is orders of magnitude faster, I remember 400kbps or something, but I might be wrong\u003C/p\u003E\u003Cp\u003EOh and about the money: A 74595 costs around 30 cents in a local shop, much less if you order online. buy one and see what it does for you.\u003C/p\u003E\n"},{"CreatedByName":"zitronen","CreatedById":11842,"CreatedDateTime":"2015-02-27T15:29:51Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022PsYcHo80\u0022 data-cite=\u0022PsYcHo80\u0022\u003E\u003Cdiv\u003EThanks for the replies, I might try that when I\u0027ll have money, but I\u0027m trying to work it out with what I\u0027ve got. Do you think that hardware I2C would work faster than software serial?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYes it probably will. Make sure you are using the \u0022fast\u0022 400kHz ic2 speed. SPI is faster, but I don\u0027t know if there\u0027s an easy to use library for sending data structures.\u003C/p\u003E\n"},{"CreatedByName":"MrOnak","CreatedById":104432,"CreatedDateTime":"2015-02-27T16:02:12Z","Content":"\n\u003Cp\u003ESPI sends one byte at a time by definition of the protocol but as usual you can make up your own \u0022protocol\u0022 (big word for that) quite easily if you know what comes when. the KSPSerialIO communication between KSP and the microcontroller itself isn\u0027t much else tbh.\u003C/p\u003E\n"},{"CreatedByName":"MrOnak","CreatedById":104432,"CreatedDateTime":"2015-02-27T16:26:44Z","Content":"\n\u003Cp\u003EI just found this:\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022http://arduino.cc/en/Reference/SPISetClockDivider\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://arduino.cc/en/Reference/SPISetClockDivider\u003C/a\u003E\u003C/p\u003E\u003Cp\u003ESeems the default is 4Mhz, or 500kbit per second. However you might want to check the maximum ratings on the receiving end of the connection to avoid some nasty debugging (not an issue with the 74595s).\u003C/p\u003E\n"},{"CreatedByName":"PsYcHo80","CreatedById":138397,"CreatedDateTime":"2015-02-27T17:52:07Z","Content":"\n\u003Cp\u003EThe problem is, no matter what I try, single Uno is not enough for my configuration. LCD, 7 segment module on TM1638 and 7segment module on 73HC595 take up 12 lines of IO, and I need at least 7 or more of analog inputs, so I have two options, buying Mega, which will be possible in a month or so, or using two arduinos. I hope to figure out the \u0022dual arduino\u0022 thing before I get to buy Mega because I dont like to abandon an idea before I do everything I can, so I\u0027m open for suggestions.\u003C/p\u003E\n"},{"CreatedByName":"stibbons","CreatedById":57865,"CreatedDateTime":"2015-02-28T00:56:31Z","Content":"\n\u003Cp\u003EStop using softserial for comms between your arduino. It\u0027s slow, and the UART emulation is expensive and unnecessary. \u003C/p\u003E\u003Cp\u003ETry out SPI. I\u0027ve never tried it between two arduinos myself, but seems easy enough. You should get much faster data transfer without unduly burning CPU cycles.\u003C/p\u003E\n"},{"CreatedByName":"MrOnak","CreatedById":104432,"CreatedDateTime":"2015-02-28T09:18:23Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022PsYcHo80\u0022 data-cite=\u0022PsYcHo80\u0022\u003E\u003Cdiv\u003EThe problem is, no matter what I try, single Uno is not enough for my configuration. LCD, 7 segment module on TM1638 and 7segment module on 73HC595 take up 12 lines of IO, and I need at least 7 or more of analog inputs, so I have two options, buying Mega, which will be possible in a month or so, or using two arduinos. I hope to figure out the \u0022dual arduino\u0022 thing before I get to buy Mega because I dont like to abandon an idea before I do everything I can, so I\u0027m open for suggestions.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI think you still have a few options here.\u003C/p\u003E\u003Cp\u003EFirst, you could ditch the TM1638 - although I see its charm - and chain all 7 segments and LEDs over SPI. 5 pins total, plus whatever is needed to run the LCD.\u003C/p\u003E\u003Cp\u003ESecond, there are analog-to-digital converter chips which are addressable over SPI. That way you\u0027d get ADC without using more pins. The MCP3208 is one example that gives you 8 analogue pins over SPI. But then I don\u0027t think the analogue pins are your problem?\u003C/p\u003E\u003Cp\u003EThird, I mentioned this already, if you need more digital \u003Cstrong\u003Ein\u003C/strong\u003Eputs, the 74165 family of chips gives you those, over SPI. Again, no additional pins required once you have SPI set up.\u003C/p\u003E\u003Cp\u003EFourth, I really like the idea of communication between Arduinos and it will be possible if you have the pins for the rest. That said you could perfectly well ditch the idea of having the 2 arduinos talk to each other and run them independently. Sure, KSP can only talk to one of them but you can make the other one be recognized as an USB joystick using VUSB: \u003Ca href=\u0022http://www.obdev.at/products/vusb/index.html\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://www.obdev.at/products/vusb/index.html\u003C/a\u003E - I\u0027ve done exactly that and have a single microcontroller run 6 analogue axis and something in the order of 60 buttons. My computer thinks its a joystick/keyboard combo-device. You\u0027ll actually find my code in the VUSB forums. KSP has no idea that microcontroller even exists - the one \u0022my\u0022 KSP talks to only handles a few buttons through a R2R ladder config and lots and lots of outputs. If you click the link in my footer I hope my initial post does a decent job of describing my approach.\u003C/p\u003E\u003Cp\u003EAll that said, I really hope you find a way to pull this off. It\u0027d be awesome. Free those pins! \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 alt=\u0022:D\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Nuke","CreatedById":10883,"CreatedDateTime":"2015-02-28T11:58:19Z","Content":"\n\u003Cp\u003Ewhat i like to do is union my structure with a byte array, so that anything you put in there is instantly serialized for you. \u003C/p\u003E\u003Cp\u003Ethe library for either protocol (serial too, software or otherwise) will provide functions to allow you to transmit or receive any byte array, usually with just a pointer and a size. you might have endianness issues if going between an avr and a pc though (so on one end or the other you will need to do a lot of shifting oring and masking). \u003C/p\u003E\u003Cp\u003Ealso now there are a number of very cheap wireless modules such as ESP8266 (wifi), and nrf24l01\u002B (ism) you can also use. former is serial and latter is spi. great little devices and you can get them under $5 each. \u003C/p\u003E\u003Cp\u003Ealso skip the mega and get the due, its faster (80 mhz), and also 32 bit. i haven\u0027t used mine yet but it has an impressive spec sheet. 8 bit micros are going out soon.\u003C/p\u003E\n"},{"CreatedByName":"zitronen","CreatedById":11842,"CreatedDateTime":"2015-02-28T15:58:36Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Nuke\u0022 data-cite=\u0022Nuke\u0022\u003E\u003Cdiv\u003Ewhat i like to do is union my structure with a byte array, so that anything you put in there is instantly serialized for you. \u003Cp\u003Ethe library for either protocol (serial too, software or otherwise) will provide functions to allow you to transmit or receive any byte array, usually with just a pointer and a size. you might have endianness issues if going between an avr and a pc though (so on one end or the other you will need to do a lot of shifting oring and masking). \u003C/p\u003E\u003Cp\u003Ealso now there are a number of very cheap wireless modules such as ESP8266 (wifi), and nrf24l01\u002B (ism) you can also use. former is serial and latter is spi. great little devices and you can get them under $5 each. \u003C/p\u003E\u003Cp\u003Ealso skip the mega and get the due, its faster (80 mhz), and also 32 bit. i haven\u0027t used mine yet but it has an impressive spec sheet. 8 bit micros are going out soon.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EBe careful if you are going 32bit: \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/66393-Hardware-Plugin-Arduino-based-physical-display-serial-port-io-tutorial-%2817-Dec%29?p=1544333\u0026amp;viewfull=1#post1544333\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://forum.kerbalspaceprogram.com/threads/66393-Hardware-Plugin-Arduino-based-physical-display-serial-port-io-tutorial-%2817-Dec%29?p=1544333\u0026amp;viewfull=1#post1544333\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EIt\u0027s still not clear if the code will run properly without massive changes due to struct padding.\u003C/p\u003E\n"},{"CreatedByName":"marzubus","CreatedById":68021,"CreatedDateTime":"2015-03-02T11:53:43Z","Content":"\n\u003Cp\u003EHey Folks!\u003C/p\u003E\u003Cp\u003EI have released the 0.17.1-2 version of the Mac / Linux / Win Port of KSPSerialIO.\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022https://kerbalstuff.com/mod/540/KSPSerialIO%20Mac/Linux/Win\u0022 rel=\u0022external nofollow\u0022\u003ELink\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EChangelog: \u003C/p\u003E\u003Cp\u003E* major cleanup and rebase\u003C/p\u003E\u003Cp\u003E* merge with 0.17.1 upstream code\u003C/p\u003E\u003Cp\u003E* fixed autodetection\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-03-03T10:40:36Z\u0022 title=\u002203/03/2015 10:40  AM\u0022 data-short=\u00229 yr\u0022\u003EMarch 3, 2015\u003C/time\u003E by marzubus\u003C/strong\u003E\n\u003C/span\u003E\n"}]}