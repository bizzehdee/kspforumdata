{"TopicId":61584,"ForumId":34,"TopicTitle":"Timewarp Rotation Fix","CreatedByName":"skykooler","CreatedById":60459,"CreatedDateTime":"2014-01-30T12:01:59Z","PageNum":4,"Articles":[{"CreatedByName":"skykooler","CreatedById":60459,"CreatedDateTime":"2014-05-02T03:19:26Z","Content":"\n\u003Cp\u003EAll: I\u0027ve been rather busy the past month, hopefully I\u0027ll have more time the next few weeks to fix this up.\u003C/p\u003E\n"},{"CreatedByName":"xrayfishx","CreatedById":76147,"CreatedDateTime":"2014-05-09T20:40:57Z","Content":"\n\u003Cp\u003EAny hope of seeing the next update soon?\u003C/p\u003E\n"},{"CreatedByName":"Dominiquini","CreatedById":110408,"CreatedDateTime":"2014-05-23T19:36:08Z","Content":"\n\u003Cp\u003EIs there any plans for an update?\u003C/p\u003E\n"},{"CreatedByName":"skykooler","CreatedById":60459,"CreatedDateTime":"2014-05-24T04:06:44Z","Content":"\n\u003Cp\u003EYes, there is. I\u0027ve been putting it off because dealing with quaternions hurts my brain. That said, I have two major goals for the next release:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Col style=\u0022list-style-type:decimal;\u0022\u003E\u003Cli\u003EFix rotational speed accumulation\u003Cbr\u003E\u003C/li\u003E\u003Cli\u003EMake SAS planet-synchronous (i.e. enable orb-rate rotation). This one is the one I am having a hard time with due to the aformentioned quaternions. Anyone who has a background in physics, I\u0027d appreciate your help!\u003Cbr\u003E\u003C/li\u003E\u003C/ol\u003E\u003Cp\u003E\u003C/p\u003E\n"},{"CreatedByName":"NathanKell","CreatedById":75006,"CreatedDateTime":"2014-05-24T05:34:07Z","Content":"\n\u003Cp\u003ESounds like you need to rotate around the normal vector of your orbit. So each tick do maybe (spitballing, pseudocode inside the AngleAxis() )\u003C/p\u003E\u003Cp\u003Evessel.orientation *= Quaternion.AngleAxis(360 / orbit.period * deltaTime, orbit.normal)\u003C/p\u003E\n"},{"CreatedByName":"HoneyFox","CreatedById":19237,"CreatedDateTime":"2014-05-24T06:16:57Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022NathanKell\u0022 data-cite=\u0022NathanKell\u0022\u003E\u003Cdiv\u003ESounds like you need to rotate around the normal vector of your orbit. So each tick do maybe (spitballing, pseudocode inside the AngleAxis() )\u003Cp\u003Evessel.orientation *= Quaternion.AngleAxis(360 / orbit.period * deltaTime, orbit.normal)\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThis will be useful for long ion engine burn (with close-to-reality thrust of course)... mmm...\u003C/p\u003E\n"},{"CreatedByName":"skykooler","CreatedById":60459,"CreatedDateTime":"2014-05-26T02:43:54Z","Content":"\n\u003Cp\u003ESo, I\u0027ve spent about five hours today trying to get orb-rate rotation to work, and so far everything either is completely wrong or only works if your ship starts out in a certain orientation. Not really sure what to do at this point; if anyone has any ideas, please PM me.\u003C/p\u003E\n"},{"CreatedByName":"HoneyFox","CreatedById":19237,"CreatedDateTime":"2014-05-26T05:16:12Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022skykooler\u0022 data-cite=\u0022skykooler\u0022\u003E\u003Cdiv\u003ESo, I\u0027ve spent about five hours today trying to get orb-rate rotation to work, and so far everything either is completely wrong or only works if your ship starts out in a certain orientation. Not really sure what to do at this point; if anyone has any ideas, please PM me.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003Eperhaps you need to swap x \u0026amp; y axes (or perhaps x \u0026amp; z or y \u0026amp; z axes, I don\u0027t remember that clearly) for the rotation because the coordinate system used by orbit is different from the one used by vessel.GetWorldPosition() IIRC.\u003C/p\u003E\n"},{"CreatedByName":"NathanKell","CreatedById":75006,"CreatedDateTime":"2014-05-26T05:21:36Z","Content":"\n\u003Cp\u003EOH CRAP you\u0027re totally right, I forgot all about that. Wish I could remember *what* crazy coord system orbit uses, but yes it\u0027s definitely not the same as worldspace.\u003C/p\u003E\n"},{"CreatedByName":"skykooler","CreatedById":60459,"CreatedDateTime":"2014-05-26T14:22:38Z","Content":"\n\u003Cp\u003Eyes, I did see that in \u003Ca href=\u0022https://raw.githubusercontent.com/Anatid/XML-Documentation-for-the-KSP-API/eb0d5c609fd34acdee7f4b54409e48c07b80de97/src/Orbit.cs\u0022 rel=\u0022external nofollow\u0022\u003Ethe documentation\u003C/a\u003E, but even after swapping y and z axes it isn\u0027t working right - it will work if you are pointing prograde and are level to the horizon, but if you\u0027re pointed any other way it rotates in some crazy direction. It\u0027s like it\u0027s mixing up world-space and local-space rotations somehow.\u003C/p\u003E\n"},{"CreatedByName":"BahamutoD","CreatedById":72433,"CreatedDateTime":"2014-05-26T18:53:35Z","Content":"\n\u003Cp\u003EI spent alot of time fiddling with it, and I got it to work while facing in any direction. Now, the only problem is that if the warp rate is less than 50x, the rotation between updates is so small that it just registers as zero. I\u0027ll post the code once I figure that bit out.\u003C/p\u003E\u003Cp\u003Eedit: In case it helps, here\u0027s the important bit:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003EVector3 rotAxis = Quaternion.Inverse (activeVessel.transform.rotation) * activeVessel.orbit.GetOrbitNormal().xzy;\u003Cbr\u003EactiveVessel.SetRotation (activeVessel.transform.rotation * Quaternion.AngleAxis(-deltaRotAngle, rotAxis));\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003Eedit 2: Strange.. this only works in equatorial orbit. In a polar orbit, it works fine until you cross over the pole, then it goes crazy.\u003C/p\u003E\u003Cp\u003Eedit 3: Nevermind, I think it does totally work. It just looked weird because of the way the camera and navball orientation rotates when you cross a pole. Also, the delta rotation angle issue I mentioned had to do with the way I was calculating the angle. I went back to use the method that NathanKell suggested and it works better.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Evoid FixedUpdate()\u003Cbr\u003E\t\t{\u003Cbr\u003E\t\t\tactiveVessel = FlightGlobals.ActiveVessel;\u003Cbr\u003E\u003Cbr\u003E\t\t\tif(TimeWarp.CurrentRate \u0026gt; 1 \u0026amp;\u0026amp; TimeWarp.WarpMode == TimeWarp.Modes.HIGH)\u003Cbr\u003E\t\t\t{\u003Cbr\u003E\t\t\t\tfloat deltaRotAngle = (float) (360/activeVessel.orbit.period * TimeWarp.fixedDeltaTime);\u003Cbr\u003E\t\t\t\tVector3 rotAxis = Quaternion.Inverse (activeVessel.transform.rotation) * activeVessel.orbit.GetOrbitNormal().xzy;\u003Cbr\u003E\t\t\t\tactiveVessel.SetRotation (activeVessel.transform.rotation * Quaternion.AngleAxis(-deltaRotAngle, rotAxis));\u003Cbr\u003E\t\t\t}\u003Cbr\u003E\t\t}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EIt shakes alot in Update; works better in FixedUpdate\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-05-26T19:27:33Z\u0022 title=\u002205/26/2014 07:27  PM\u0022 data-short=\u002210 yr\u0022\u003EMay 26, 2014\u003C/time\u003E by BahamutoD\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"skykooler","CreatedById":60459,"CreatedDateTime":"2014-05-26T23:12:55Z","Content":"\n\u003Cp\u003E\u003Cstrong\u003EVersion 0.3 released!\u003C/strong\u003E\u003C/p\u003E\u003Cp\u003EOrb-rate rotation has been added! This means, if you turn on SAS, you will now complete one rotation per orbit. If you are in a roughly circular orbit, this means you will stay in the same orientation relative to the planet (and to your navball); however if you are in an eccentric orbit the planet will appear to move back and forth relative to you.\u003C/p\u003E\n"},{"CreatedByName":"BahamutoD","CreatedById":72433,"CreatedDateTime":"2014-05-27T02:48:50Z","Content":"\n\u003Cp\u003EDid you stick the latest source code in the download? I want to see if I can look into the rotation speed accumulation issue.\u003C/p\u003E\n"},{"CreatedByName":"MK3424","CreatedById":19932,"CreatedDateTime":"2014-05-27T11:43:48Z","Content":"\n\u003Cp\u003EI have a request: can you make this option toggleable?\u003C/p\u003E\u003Cp\u003EBy using a toolbar icon, so that you can select wich craft should rotate and wich ones shouldn\u0027t.\u003C/p\u003E\n"},{"CreatedByName":"Subcidal","CreatedById":20751,"CreatedDateTime":"2014-05-29T18:35:38Z","Content":"\n\u003Cp\u003EJust to clarify the speed increase when coming out of warp bug hasn\u0027t been solved right?\u003C/p\u003E\n"},{"CreatedByName":"skykooler","CreatedById":60459,"CreatedDateTime":"2014-05-29T20:04:31Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022BahamutoD\u0022 data-cite=\u0022BahamutoD\u0022\u003E\u003Cdiv\u003EDid you stick the latest source code in the download? I want to see if I can look into the rotation speed accumulation issue.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EErm, oops, I left the old source code in there; I\u0027ll fix it when I get home this evening.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022MK3424\u0022 data-cite=\u0022MK3424\u0022\u003E\u003Cdiv\u003EI have a request: can you make this option toggleable?\u003Cp\u003EBy using a toolbar icon, so that you can select wich craft should rotate and wich ones shouldn\u0027t.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EGood idea. I\u0027ll look into that for v0.4.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Subcidal\u0022 data-cite=\u0022Subcidal\u0022\u003E\u003Cdiv\u003EJust to clarify the speed increase when coming out of warp bug hasn\u0027t been solved right?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ENo, not yet. I\u0027m still not sure what\u0027s causing it.\u003C/p\u003E\n"},{"CreatedByName":"MK3424","CreatedById":19932,"CreatedDateTime":"2014-05-29T21:50:41Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022skykooler\u0022 data-cite=\u0022skykooler\u0022\u003E\u003Cdiv\u003EErm, oops, I left the old source code in there; I\u0027ll fix it when I get home this evening.\u003Cp\u003EGood idea. I\u0027ll look into that for v0.4.\u003C/p\u003E\u003Cp\u003ENo, not yet. I\u0027m still not sure what\u0027s causing it.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThanks for the reply, while this is a great realism mod, i found that it\u0027s interfering with MechJeb\u0027s way of executing maneuver notes.\u003C/p\u003E\n"},{"CreatedByName":"curiousepic","CreatedById":60039,"CreatedDateTime":"2014-05-30T01:48:08Z","Content":"\n\u003Cp\u003EGlad this mod hasn\u0027t dissolved in the ether; still hoping for the time warp fix before I start using it though.\u003C/p\u003E\n"},{"CreatedByName":"skykooler","CreatedById":60459,"CreatedDateTime":"2014-05-30T03:48:47Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022MK3424\u0022 data-cite=\u0022MK3424\u0022\u003E\u003Cdiv\u003EThanks for the reply, while this is a great realism mod, i found that it\u0027s interfering with MechJeb\u0027s way of executing maneuver notes.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThis is a known issue; MechJeb abuses the timewarp system to halt rotation. I talked to the maintainer several months ago, but I forget what the consensus was.\u003C/p\u003E\u003Cp\u003EAlso: I\u0027ve fixed the .zip in the first post to have the new source code, if anyone wants to try and figure out what\u0027s causing the acceleration.\u003C/p\u003E\n"},{"CreatedByName":"IPster","CreatedById":77193,"CreatedDateTime":"2014-05-30T04:40:47Z","Content":"\n\u003Cp\u003EI am so glad this mod is fixed, adding rotation was not fun. I do have one small complaint though :S \u003C/p\u003E\u003Cp\u003EWhen I come out of time warp with SAS on, the SAS system suddenly decides it is not pointing the right direction and takes evasive action. If I tap the \u0022F\u0022 key immediately out of warp there is little consequence. I would recommend having the mod do this (reset the SAS orientation, or momentarily disable it out of time warp) automatically if possible. \u003C/p\u003E\u003Cp\u003EOther than that, I am super glad to have this mod; as I have been playing with greatly reduced pod torque and the temptation to abuse time warp has caught me off guard sometimes.\u003C/p\u003E\n"},{"CreatedByName":"BahamutoD","CreatedById":72433,"CreatedDateTime":"2014-05-30T06:45:00Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022skykooler\u0022 data-cite=\u0022skykooler\u0022\u003E\u003Cdiv\u003EThis is a known issue; MechJeb abuses the timewarp system to halt rotation. I talked to the maintainer several months ago, but I forget what the consensus was.\u003Cp\u003EAlso: I\u0027ve fixed the .zip in the first post to have the new source code, if anyone wants to try and figure out what\u0027s causing the acceleration.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ECool. Not sure I\u0027d be able to figure it out but I\u0027ll try.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022IPster\u0022 data-cite=\u0022IPster\u0022\u003E\u003Cdiv\u003EI am so glad this mod is fixed, adding rotation was not fun. I do have one small complaint though :S \u003Cp\u003EWhen I come out of time warp with SAS on, the SAS system suddenly decides it is not pointing the right direction and takes evasive action. If I tap the \u0022F\u0022 key immediately out of warp there is little consequence. I would recommend having the mod do this (reset the SAS orientation, or momentarily disable it out of time warp) automatically if possible.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003E(edited)\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003EactiveVessel.vesselSAS.LockHeading(activeVessel.rotation, true);\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E Will set the sas target to wherever it is currently facing, to prevent the jerk when coming out of timewarp after rotating.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-05-30T06:47:59Z\u0022 title=\u002205/30/2014 06:47  AM\u0022 data-short=\u002210 yr\u0022\u003EMay 30, 2014\u003C/time\u003E by BahamutoD\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"fibonatic","CreatedById":73180,"CreatedDateTime":"2014-06-11T16:07:58Z","Content":"\n\u003Cp\u003EI really like this mod.\u003C/p\u003E\u003Cp\u003EJust tested to see if it also does the \u003Ca href=\u0022https://en.wikipedia.org/wiki/Tennis_racket_theorem\u0022 rel=\u0022external nofollow\u0022\u003EDzhanibekov effect (a.k.a. the tennis racket theorem)\u003C/a\u003E during time warp. I did not expected it to work and it did not, as can be seen in this video:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E\n\u003C/p\u003E\u003Cdiv class=\u0022ipsEmbeddedVideo\u0022 contenteditable=\u0022false\u0022\u003E\u003Cdiv\u003E\u003Ciframe width=\u0022480\u0022 height=\u0022270\u0022 src=\u0022https://www.youtube.com/embed/PZrxulJOs7I?feature=oembed\u0022 frameborder=\u00220\u0022 allowfullscreen=\u0022true\u0022\u003E\u003C/iframe\u003E\u003C/div\u003E\u003C/div\u003E\u003Cp\u003EI also do not think that this mod should though, because I do not think it has any real applications and most crafts might not even have an unstable axis of rotation.\u003C/p\u003E\n"},{"CreatedByName":"skykooler","CreatedById":60459,"CreatedDateTime":"2014-06-11T16:28:31Z","Content":"\n\u003Cp\u003EInteresting! I\u0027d never heard of the Dzhanibekov effect before. I don\u0027t think I\u0027ll include it for the reasons you\u0027ve mentioned, but it\u0027s a good thing to know about.\u003C/p\u003E\n"},{"CreatedByName":"TrekkieBro","CreatedById":112897,"CreatedDateTime":"2014-06-13T18:55:44Z","Content":"\n\u003Cp\u003ERegarding the angular momentum glitch. Is the math wrong somewhere or is floating point demons the culprit? \u003C/p\u003E\u003Cp\u003EI have a bat-guano crazy thought that could address both and don\u0027t even know if it\u0027s practical or even possible. The idea involves pointing forces applied to the physical parts in the direction of the origin of dummy objects corresponding to the same objects on rails (a duplicate in empty form, a collection of origins). Instead of trying to distribute momentum manually this would use information from an on rails object to drag the craft and parts until they matched rotation speed (when the origins line up and become stable).\u003C/p\u003E\n"},{"CreatedByName":"MK3424","CreatedById":19932,"CreatedDateTime":"2014-06-22T17:40:37Z","Content":"\n\u003Cp\u003EAny news on new builds?\u003C/p\u003E\n"}]}