{"TopicId":163004,"ForumId":29,"TopicTitle":"Help with GameParameters","CreatedByName":"Alshain","CreatedById":110959,"CreatedDateTime":"2017-07-07T19:25:27Z","PageNum":1,"Articles":[{"CreatedByName":"Alshain","CreatedById":110959,"CreatedDateTime":"2017-07-07T19:25:27Z","Content":"\n\u003Cp\u003E\nI\u0027m trying to migrate some of AGM\u0027s settings to the GameParameters window, I\u0027ve been using \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/57416-dmagic/\u0026amp;do=hovercard\u0022 data-mentionid=\u002257416\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/57416-dmagic/\u0022 rel=\u0022\u0022\u003E@DMagic\u003C/a\u003E\u0027s Maneuver Node Evolved as guidance and thought it looked pretty straight forward.\u00A0 My mod, strangely enough, is doing exactly what I wanted, but when it\u0027s present KSP is freaking out.\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u0022zb3Chdl.png\u0022 class=\u0022ipsImage\u0022 height=\u0022576\u0022 src=\u0022http://i.imgur.com/zb3Chdl.png\u0022 width=\u00221024\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nFor the life of me, I can\u0027t figure out what I am doing to cause that.\u00A0 I\u0027ve been staring at it for an hour and don\u0027t know what I did wrong.\u00A0 Please help!\n\u003C/p\u003E\n\u003Cp\u003E\nStartup:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003Eusing UnityEngine;\n\nnamespace ActionGroupManager\n{\n    [KSPAddon(KSPAddon.Startup.MainMenu, true)]\n    public class Core\n    {\n        CareerParameters careerSettings;\n        static DebugParameters debugSettings;\n        public const string ModPath = \u0022AquilaEnterprises/ActionGroupManager/\u0022;\n\n        private void Start()\n        {\n            careerSettings = HighLogic.CurrentGame.Parameters.CustomParams\u003C/span\u003E\u003Cspan class=\u0022tag\u0022\u003E\u0026lt;CareerParameters\u0026gt;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E();\n            debugSettings = HighLogic.CurrentGame.Parameters.CustomParams\u003C/span\u003E\u003Cspan class=\u0022tag\u0022\u003E\u0026lt;DebugParameters\u0026gt;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E();\n        }\n\n        static public void AddDebugLog(string message, bool verbose = false)\n        {\n            if (debugSettings.basicLogging)\n                if (!verbose || debugSettings.verboseLogging)\n                    Debug.Log(\u0022\u003C/span\u003E\u003Cspan class=\u0022tag\u0022\u003E\u0026lt;color\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E=\u003C/span\u003E\u003Cspan class=\u0022atv\u0022\u003E#800000ff\u003C/span\u003E\u003Cspan class=\u0022tag\u0022\u003E\u0026gt;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E[Action Group Manager]\u003C/span\u003E\u003Cspan class=\u0022tag\u0022\u003E\u0026lt;/color\u0026gt;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u0022 \u002B message);\n        }\n    }\n}\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nParameters:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003Eusing KSP.Localization;\n\nnamespace ActionGroupManager\n{\n    class CareerParameters : GameParameters.CustomParameterNode\n    {\n        // #autoLOC_AGM_060 = Enable Career Mode\n        // #autoLOC_AGM_114 = Action Groups may only be modified if either the \u003Cabbr title=\u0022Vehicle Assembly Building\u0022\u003EVAB\u003C/abbr\u003E or \u003Cabbr title=\u0022SpacePlane Hangar\u0022\u003ESPH\u003C/abbr\u003E have been upgraded to the correct tier.\n        [GameParameters.CustomParameterUI(\u0022#autoLOC_AGM_060\u0022, toolTip = \u0022#autoLOC_AGM_114\u0022, autoPersistance = true)]\n        public bool enableCareer = true;\n\n        public override GameParameters.GameMode GameMode\n        {\n            get { return GameParameters.GameMode.CAREER; }\n        }\n\n        public override string Section\n        {\n            get { return \u0022AGM\u0022; }\n        }\n\n        public override string DisplaySection\n        {\n            get {\n                // #autoLOC_AGM_004 = Action Group Manager\n                return Localizer.GetStringByTag(\u0022#autoLOC_AGM_004\u0022);\n            }\n        }\n\n        public override int SectionOrder\n        {\n            get { return 1; }\n        }\n\n        public override string Title\n        {\n            get\n            {\n                // #autoLOC_AGM_005 = Career Settings\n                return Localizer.GetStringByTag(\u0022#autoLOC_AGM_005\u0022);\n            }\n        }\n\n        public override bool HasPresets\n        {\n            get { return false; }\n        }\n    }\n\n    class DebugParameters : GameParameters.CustomParameterNode\n    {\n        // #autoLOC_AGM_066 = Basic Logging\n        // #autoLOC_AGM_115 = Enable to show code event logs in the console and output file.\n        [GameParameters.CustomParameterUI(\u0022#autoLOC_AGM_066\u0022, toolTip = \u0022#autoLOC_AGM_115\u0022, autoPersistance = true)]\n        public bool basicLogging = false;\n\n        // #autoLOC_AGM_066 = Verbose Logging\n        // #autoLOC_AGM_116 = Enable to show code loop logs in the console and output file. WARNING: This creates a large number of log messages!\n        [GameParameters.CustomParameterUI(\u0022#autoLOC_AGM_067\u0022, toolTip = \u0022#autoLOC_AGM_116\u0022, autoPersistance = true)]\n        public bool verboseLogging = false;\n\n        public override GameParameters.GameMode GameMode\n        {\n            get { return GameParameters.GameMode.ANY; }\n        }\n\n        public override string Section\n        {\n            get { return \u0022AGM\u0022; }\n        }\n\n        public override string DisplaySection\n        {\n            get\n            {\n                // #autoLOC_AGM_004 = Action Group Manager\n                return Localizer.GetStringByTag(\u0022#autoLOC_AGM_004\u0022);\n            }\n        }\n\n        public override int SectionOrder\n        {\n            get { return 3; }\n        }\n\n        public override string Title\n        {\n            get\n            {\n                // #autoLOC_AGM_007 = Debug Settings\n                return Localizer.GetStringByTag(\u0022#autoLOC_AGM_007\u0022);\n            }\n        }\n\n        public override bool HasPresets\n        {\n            get { return false; }\n        }\n\n        public override bool Enabled(System.Reflection.MemberInfo member, GameParameters parameters)\n        {\n            if (member.Name == \u0022verboseLogging\u0022)\n                return basicLogging;\n\n            return true;\n        }\n    }\n}\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"DMagic","CreatedById":57416,"CreatedDateTime":"2017-07-07T20:53:49Z","Content":"\n\u003Cp\u003E\nI don\u0027t think you can initialize your settings in the main menu like that, since there is no current game. That might be wreaking havoc with the stock parameters somehow. Try waiting for another scene once the game has loaded.\n\u003C/p\u003E\n\u003Cp\u003E\nOther than that, maybe the static for DebugParameters in the Core class, or maybe make sure the parameter classes are public.\u00A0I can\u0027t see anything obviously wrong with anything else.\n\u003C/p\u003E\n"},{"CreatedByName":"Alshain","CreatedById":110959,"CreatedDateTime":"2017-07-07T21:22:15Z","Content":"\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/57416-dmagic/\u0026amp;do=hovercard\u0022 data-mentionid=\u002257416\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/57416-dmagic/\u0022 rel=\u0022\u0022\u003E@DMagic\u003C/a\u003E\u003Cs\u003E Thanks, but that actually works fine.\u00A0 I suspect GameParameters are loaded before Start is executed. \u003C/s\u003EYou were right you can\u0027t but that wasn\u0027t the issue, it just caused NullRefs down the road.\u00A0 Also, inheriting MonoBehaviour helps (just a wee bit).\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nI actually just now found the problem though and it would be funny if it weren\u0027t so sad how much time I wasted on it.\n\u003C/p\u003E\n\u003Cp\u003E\nSo, yesterday my SSD started to get full, so I moved my KSP dev test environment to my HDD.\u00A0 Then I had to re-reference UnityEngine and Assembly-CSharp, which had their Copy Local turned back on.\u00A0 Then my post build event copied everything off to the GameData Folder and I didn\u0027t bother to go look at it and... here we are.\u00A0 \u003Cs\u003EThere was never anything wrong with the code.\u003C/s\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nSome days I just want to go back to bed.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222017-07-07T21:55:55Z\u0022 title=\u002207/07/2017 09:55  PM\u0022 data-short=\u00227 yr\u0022\u003EJuly 7, 2017\u003C/time\u003E by Alshain\u003C/strong\u003E\n\u003C/span\u003E\n"}]}