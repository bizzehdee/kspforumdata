{"TopicId":97129,"ForumId":20,"TopicTitle":"Memory cleaner/leak plugger","CreatedByName":"Major999","CreatedById":131827,"CreatedDateTime":"2015-01-19T02:47:44Z","PageNum":1,"Articles":[{"CreatedByName":"Major999","CreatedById":131827,"CreatedDateTime":"2015-01-19T02:47:44Z","Content":"\n\u003Cp\u003EFirst of all, I have virtually no experience with coding so I don\u0027t know if this is possible.\u003C/p\u003E\u003Cp\u003EWhat I\u0027m asking for is a mod that forcefully cleans the memory that KSP is using, to alleviate issues with RAM leaks. I know that there are apps that can do that for a whole computer, (FreeRamBooster on a mac for example) but I am unaware of a way to do this within an app. \u003C/p\u003E\u003Cp\u003ESo essentially I\u0027m asking for a big red button that will collect all of the memory that has leaked into no-man\u0027s-land and make it useable again.\u003C/p\u003E\u003Cp\u003ETo be clear I don\u0027t want to reduce the initial RAM use of my KSP, merely reduce it incrementally while I am playing, to stop the RAM use from creeping up to that critical limit.\u003C/p\u003E\u003Cp\u003EAny help would be great.\u003C/p\u003E\n"},{"CreatedByName":"Greys","CreatedById":57109,"CreatedDateTime":"2015-01-19T03:26:49Z","Content":"\n\u003Cp\u003EMemory is occupied by objects and references to objects; but predominantly objects. An object is mostly anything that gets stored, so like, variables and whatnot. In order to free up memory you must destroy objects.\u003C/p\u003E\u003Cp\u003EThis means you must have a reference to an object and be permitted to cause it\u0027s destruction, but furthermore you must know that it is safe to be destroyed.\u003C/p\u003E\u003Cp\u003EWhile you may be able to make a mod that reaches into KSP and deals with leaked objects (objects which have completed their lifespan tasks but have not been deleted because they were forgotten), and there is currently a situation where a lot of objects are being leaked quickly so that\u0027d be kinda nice; as far as mods are concerned the mod itself should be fixed.\u003C/p\u003E\u003Cp\u003EThis is not something that can be done generically, it will need to be a custom coded solution for every leak.\u003C/p\u003E\n"},{"CreatedByName":"Major999","CreatedById":131827,"CreatedDateTime":"2015-01-19T04:07:57Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003E\u003Cspan style=\u0022color:#333333;\u0022\u003EThis is not something that can be done generically, it will need to be a custom coded solution for every leak.\u003C/span\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EDamn. (Ten character limit)\u003C/p\u003E\n"},{"CreatedByName":"rynak","CreatedById":115092,"CreatedDateTime":"2015-01-19T04:15:12Z","Content":"\n\u003Cp\u003EBy the very nature of how an operating system works, you cannot simply \u0022take\u0022 memory which an app requested... at the most you can nicely ASK it to give back memory. So, the application needs to support it... and even then, the application usually can only do this, for memory which it doesnt strictly need.\u003C/p\u003E\u003Cp\u003EA memory leak usually occurs, when an application continiously requests new memory, while forgetting to \u0022free\u0022 the memory it previously used. This might be difficult to understand to non-coders, so here\u0027s a very quick explanation of what \u0022memory management\u0022 means: Say an application wants to read a textfile... do something with it... then read another textfile and again do something with it. Furthermore, for simplicity lets assume both textfiles are of the same size. Now, let\u0027s go through this step by step: The app requests memory, so that it can store the red textfile in it. Then it does its processing. What happens next?\u003C/p\u003E\u003Cp\u003EIt is about to read another textfile, so does it give back the memory for the previous textfile? After all, why give it back, only to then again request new memory again for the next textfile? Answer: For this to work, the app would have to \u0022manage\u0022 its memory itself. That might be trivial in this example, but for anything more complex, it is a giant headache to keep track of everything. So, what instead happens is the application indeed gives back the memory, only to then right away ask for new memory again.\u003C/p\u003E\u003Cp\u003EBut what if said app forgets the step of returning memory? That\u0027s called a memory leak. Everything i thus far explained is how this works in C and other lowlevel langs. In languages like .NET, those kinds of memleaks do not happen at all - thats because the step of giving back memory, once something is no longer used, is done automatically... the coder doesn\u0027t even have to worry about it.\u003C/p\u003E\u003Cp\u003EOr does he? It turns out, something very similiar can still happen - by forgetting to mark data as no longer needed. See, this automatic step of giving back mem, relies on this \u0022garbage collector\u0022 knowing when something is no longer needed - after all, while data is still needed, you can\u0027t just give that memory back - the app would crash at best. Memleaks in HL langs like .NET happen when something is actually no longer needed, but said \u0022garbage collector\u0022 has no way of knowing that\u0027s the case.\u003C/p\u003E\u003Cp\u003ENow, if the application\u0027s own GC doesn\u0027t even know, how is the OS supposed to know? It doesn\u0027t. All it can do is terminate the app, then reclaim everything that was marked as the reserved for that app.\u003C/p\u003E\u003Cp\u003EWhat those \u0022RAM boosters\u0022 and similiar apps do, have nothing to do with memory leaks. Usually, what they do is to empty/reduce caches (which after all aren\u0027t strictly needed), or to swap data out into the pagefile.\u003C/p\u003E\n"},{"CreatedByName":"blizzy78","CreatedById":68543,"CreatedDateTime":"2015-01-19T12:17:55Z","Content":"\n\u003Cp\u003EIncidentally, in languages that have automatic garbage collection, it isn\u0027t called \u0022memory leak\u0022, but \u0022unintentional object retention\u0022.\u003C/p\u003E\n"},{"CreatedByName":"Superfluous J","CreatedById":73725,"CreatedDateTime":"2015-01-19T14:22:16Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022blizzy78\u0022 data-cite=\u0022blizzy78\u0022\u003E\u003Cdiv\u003E\u0022unintentional object retention\u0022.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EEw. I had that once. Worst week of my life.\u003C/p\u003E\n"},{"CreatedByName":"Space Cadet","CreatedById":130826,"CreatedDateTime":"2015-01-28T04:54:30Z","Content":"\n\u003Cp\u003EThe memory leak seems to have little to do with retained data about objects in play. I have always noticed with KSP, even with stock, that when I launch a ship that memory use goes up and even when I revert to the assembly building this memory is not freed up. When you do this a few more times the extra memory used can creep up to 200mb or more - play for a few hours and it can be close to half a gigabyte of ram that is \u0027stolen\u0027. Frequently this leads to a crash when I have several mods in use. Save the game and restart and the game runs fine for a while until this happens again.\u003C/p\u003E\n"},{"CreatedByName":"Greys","CreatedById":57109,"CreatedDateTime":"2015-01-28T07:44:46Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Space Cadet\u0022 data-cite=\u0022Space Cadet\u0022\u003E\u003Cdiv\u003EThe memory leak seems to have little to do with retained data about objects in play. I have always noticed with KSP, even with stock, that when I launch a ship that memory use goes up and even when I revert to the assembly building this memory is not freed up. When you do this a few more times the extra memory used can creep up to 200mb or more - play for a few hours and it can be close to half a gigabyte of ram that is \u0027stolen\u0027. Frequently this leads to a crash when I have several mods in use. Save the game and restart and the game runs fine for a while until this happens again.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThat\u0027s exactly what retained objects is. In scene change KSP creates a bunch of objects and then leaves them there taking up space when they\u0027re no longer needed; and because it does this every scene change, the more times you change scenes the faster you will crash. As well KSP creats a hell of a lot of objects that do get disposed of correctly during scene change, which is why memory spikes during scene change and then comes down to a bit more than it used to be, which makes it even easier for KSP to crash.\u003C/p\u003E\n"},{"CreatedByName":"Enceos","CreatedById":110725,"CreatedDateTime":"2015-02-04T12:49:06Z","Content":"\n\u003Cp\u003EI developed a habbit of exiting my game to main menu after 12-15 scene changes, and loading back again. Works for me.\u003C/p\u003E\n"},{"CreatedByName":"Zorbaq","CreatedById":134243,"CreatedDateTime":"2015-02-09T11:59:20Z","Content":"\n\u003Cp\u003EGiven enough system RAM, you can run two instances of KSP simultaneously and have one sitting \u0022on stand-by\u0022. When KSP crashes you quickly switch to the second one and load the savegame, without wasting time on waiting for the application to launch again. Once the game loads, you fire-up another KSP and let it boot up in the background. I\u0027ve been doing that for a week or two and had no issues. Just make sure you leave your \u0022stand-by\u0022 KSP idle on the menu screen, else you risk borking your savegames. You can also try lowering the priority of the process to conserve CPU time or suspending it entirely (google pssuspend.exe from sysinternals/microsoft) but Windows may spam you with \u0022Program is not responding\u0022 messages.\u003C/p\u003E\u003Cp\u003ERemember though that you need a computer with a memory capable of handling two instances of KSP. My heavily modded KSP loads at 2.8 Gig working set and the crash occurs at 3.7 Gig. Thus, 3.7 \u002B 2.8 \u002B the rest for OS stuff...\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-02-09T12:03:34Z\u0022 title=\u002202/09/2015 12:03  PM\u0022 data-short=\u00229 yr\u0022\u003EFebruary 9, 2015\u003C/time\u003E by Zorbaq\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Armarnis","CreatedById":134739,"CreatedDateTime":"2015-02-09T22:11:42Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Zorbaq\u0022 data-cite=\u0022Zorbaq\u0022\u003E\u003Cdiv\u003EGiven enough system RAM, you can run two instances of KSP simultaneously and have one sitting \u0022on stand-by\u0022. When KSP crashes you quickly switch to the second one and load the savegame, without wasting time on waiting for the application to launch again. Once the game loads, you fire-up another KSP and let it boot up in the background. I\u0027ve been doing that for a week or two and had no issues. Just make sure you leave your \u0022stand-by\u0022 KSP idle on the menu screen, else you risk borking your savegames. You can also try lowering the priority of the process to conserve CPU time or suspending it entirely (google pssuspend.exe from sysinternals/microsoft) but Windows may spam you with \u0022Program is not responding\u0022 messages.\u003Cp\u003ERemember though that you need a computer with a memory capable of handling two instances of KSP. My heavily modded KSP loads at 2.8 Gig working set and the crash occurs at 3.7 Gig. Thus, 3.7 \u002B 2.8 \u002B the rest for OS stuff...\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003Emost useful post, thank you for that its a great idea, my ksp loads up to 3 gig (and that is not even with all the mods i want to try out!) so i have pretty much around half an hour at max before i have to kick up another instance, but i never thought about starting it twice \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 alt=\u0022:D\u0022\u003E hope one time they get this sorted out, or better said unity engine gets it sorted -.-\u003C/p\u003E\n"},{"CreatedByName":"DaniDE","CreatedById":130484,"CreatedDateTime":"2015-02-10T10:31:40Z","Content":"\n\u003Cp\u003EIf you play on windows, I suggest you use OpenGL with KSP and 32 Bit and use the ActiveTextureManagement Mod. You can play pretty much uninterrupted for hours then. I crashed once in the last week, using 65 Mods. Also the ActiveTextureManagement Mod helps in a variety of ways not only by converting textures in a format that uses less memory footprint but also is most compatible with Unity.\u003C/p\u003E\n"},{"CreatedByName":"Armarnis","CreatedById":134739,"CreatedDateTime":"2015-02-10T12:43:03Z","Content":"\n\u003Cp\u003Eso, how do i set ksp up to use opengl?\u003C/p\u003E\n"},{"CreatedByName":"Master Tao","CreatedById":110410,"CreatedDateTime":"2015-02-10T13:29:59Z","Content":"\n\u003Cp\u003EFair warning: OpenGL doesn\u0027t work well for everyone, and it\u0027s not supported since it\u0027s a Unity feature.\u003C/p\u003E\u003Cp\u003EYou\u0027ll need to run KSP using two command line flags: \u003Cspan style=\u0022font-family:\u0027courier new\u0027;\u0022\u003E-force-opengl\u003C/span\u003E and \u003Cspan style=\u0022font-family:\u0027courier new\u0027;\u0022\u003E-nopopup\u003C/span\u003E. The second prevents KSP from using true fullscreen, preventing an OpenGL-specific related to the current version of Unity.\u003C/p\u003E\n"},{"CreatedByName":"Armarnis","CreatedById":134739,"CreatedDateTime":"2015-02-10T13:35:09Z","Content":"\n\u003Cp\u003Ethanks, i will try this out!\u003C/p\u003E\u003Cp\u003Ehmmm, already got it working, instead of being around 3gb of ram usage i have now only 1.4gb, lets see if it stays stable. would be soo cool \u0026lt;3\u003C/p\u003E\u003Cp\u003Efunny sideeffect of this: i finally learned how to deactivate that windows attach at the top of the screen so the titlebar is always visible. but no more, finally! \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 alt=\u0022:D\u0022\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-02-10T13:47:33Z\u0022 title=\u002202/10/2015 01:47  PM\u0022 data-short=\u00229 yr\u0022\u003EFebruary 10, 2015\u003C/time\u003E by Armarnis\u003C/strong\u003E\n\u003C/span\u003E\n"}]}