{"TopicId":142947,"ForumId":20,"TopicTitle":"[SOLVED] ModuleScienceExperiment.DeployExperiment with multiple experiments?","CreatedByName":"Superfluous J","CreatedById":73725,"CreatedDateTime":"2016-07-02T01:55:10Z","PageNum":1,"Articles":[{"CreatedByName":"Superfluous J","CreatedById":73725,"CreatedDateTime":"2016-07-02T01:55:10Z","Content":"\n\u003Cp\u003E\ntl;dr: I can\u0027t figure out how to - in code - automatically kick off more than one experiment per part.\n\u003C/p\u003E\n\u003Cp\u003E\nI got it in my head to make a single part that can do all science experiments. Because I\u0027m lazy. I mean efficient. Anyway. I want - say - the Gravioli Detector to just have all the other experiments in it so I don\u0027t have to have to bring all the other stuff too. I used ModuleManager to add the other 4 \u0022simple\u0022 experiments (temperature, barometer, seismic, and atmosphere) to the Gravioli Detector and sure enough, in the game the buttons show up and work without a hitch. I can via the (many) buttons execute all 5 experiments, review them, remove them, etc. However, it\u0027s clunkly to do so, clunkier than just bringing the other 5 experiment parts along in the first place.\n\u003C/p\u003E\n\u003Cp\u003E\nWell lucky for me I wrote All Y\u0027All, which automatically kicks off experiments. So I right clicked the part, selected \u0022Perform All Science\u0022 and... it only ran the Gravioli Detector. Looks like the moron who wrote this mod set it up to only run whatever experiment it found in the part first.\n\u003C/p\u003E\n\u003Cp\u003E\nSo I dug into the code to see what I could do, and (as is common for me) I couldn\u0027t figure it out. I am by no means an expert but it looks to me like it\u0027s not even possible to do, though I tend to doubt anything I think about coding.\n\u003C/p\u003E\n\u003Cp\u003E\nHere\u0027s my code as it stands (0.3 version of AYA):\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003E    public class AYA_Science : PartModule\n    {\n        [KSPEvent(guiActive = true, guiActiveEditor = false, guiName = \u0022Perform All Science\u0022)]\n        public void DoAllScience()\n        {\n            foreach (Part eachPart in vessel.Parts)\n            {\n                var thisPart = eachPart.FindModuleImplementing\u003C/span\u003E\u003Cspan class=\u0022tag\u0022\u003E\u0026lt;ModuleScienceExperiment\u0026gt;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E();\n                if (thisPart != null) thisPart.DeployExperiment();\n            }\n        }\n    }\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nAnd here\u0027s what I changed it to that doesn\u0027t work:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003E    public class AYA_Science : PartModule\n    {\n        [KSPEvent(guiActive = true, guiActiveEditor = false, guiName = \u0022Perform All Science\u0022)]\n        public void DoAllScience()\n        {\n            foreach (Part eachPart in vessel.Parts)\n            {\n                var thisPart = eachPart.FindModuleImplementing\u003C/span\u003E\u003Cspan class=\u0022tag\u0022\u003E\u0026lt;ModuleScienceExperiment\u0026gt;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E();\n                foreach (KSPModule eachModule in thisPart.Modules)\n                {\n                    if (thisPart != null) thisPart.DeployExperiment(something_clever);\n                }\n            }\n        }\n    }\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nThere are 2 things wrong with the above code:\n\u003C/p\u003E\n\u003Col\u003E\u003Cli\u003E\nThere is no \u0022thisPart.Modules\u0022 list. I don\u0027t know how to get the list of all modules in a part, or even if that\u0027s what I need to do here. But it seems like a reasonable thing to want.\n\u003C/li\u003E\n\u003Cli\u003E\nWhere I put \u0022something_clever\u0022 I have no idea what to put. If anything CAN even be put there. All the examples I\u0027ve found, that\u0027s blank. It seems though with it being blank, the game itself is never expecting a part to have more than one science experiment.\n\u003C/li\u003E\n\u003C/ol\u003E\u003Cp\u003E\nSo am I just boned? No clever shortcuts for me? Or can someone cleverer than I help a poor scripter-turning-coder out?\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-07-04T02:41:37Z\u0022 title=\u002207/04/2016 02:41  AM\u0022 data-short=\u00228 yr\u0022\u003EJuly 4, 2016\u003C/time\u003E by 5thHorseman\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Superfluous J","CreatedById":73725,"CreatedDateTime":"2016-07-02T02:23:50Z","Content":"\n\u003Cp\u003E\nUpdate to this: I found a flaw in my thinking (no surprise there). The variable I had named \u0022thisPart\u0022 is not a part at all, but a module. So it appears that the line:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003Evar thisPart = eachPart.FindModuleImplementing\u003C/span\u003E\u003Cspan class=\u0022tag\u0022\u003E\u0026lt;ModuleScienceExperiment\u0026gt;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E();\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nis the culprit. It\u0027s just finding the first experiment. However, I don\u0027t know how to tell it to loop through each experiment. Below I have a nonworking line where I renamed thisPart to thisExperiment so it\u0027s easier for me to read:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003Eforeach (ModuleScienceExperiment thisExperiment in eachPart.FindModulesImplementing\u003C/span\u003E\u003Cspan class=\u0022tag\u0022\u003E\u0026lt;ModuleScienceExperiment\u0026gt;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E)\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nhowever this fails with the error:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003ESeverity\tCode\tDescription\nError\tCS0446\tForeach cannot operate on a \u0027method group\u0027. Did you intend to invoke the \u0027method group\u0027?\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nTo which I answer... \u0022I didn\u0027t intend anything. I don\u0027t even know what that means.\u0022\n\u003C/p\u003E\n"},{"CreatedByName":"wasml","CreatedById":120438,"CreatedDateTime":"2016-07-02T04:24:02Z","Content":"\n\u003Cp\u003E\nTry this - quick test looks like it works\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003E        [KSPEvent(active = true, guiActive = true)]\n        public void OnPress()\n        {\n            ModuleScienceExperiment[] MSEList = vessel.GetComponentsInChildren\u003C/span\u003E\u003Cspan class=\u0022tag\u0022\u003E\u0026lt;ModuleScienceExperiment\u0026gt;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E();\n            for (int i=0;i\u0026lt;MSEList.Length;i\u002B\u002B)\n            {\n                MSEList[i].DeployExperiment();\n            }\n        }\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nYou may need list and loop through the parts on the vessel - not sure.\n\u003C/p\u003E\n\u003Cp\u003E\nEdit: Another quick test - you will need to list and loop through the parts - this only fires the experiments if they\u0027re on the root part.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-07-02T04:30:05Z\u0022 title=\u002207/02/2016 04:30  AM\u0022 data-short=\u00228 yr\u0022\u003EJuly 2, 2016\u003C/time\u003E by wasml\u003C/strong\u003E\n\u003Cbr\u003Eadditional info\n\u003C/span\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2016-07-02T23:36:12Z","Content":"\n\u003Cp\u003E\nYour logic is right in that FindModuleImplementing\u0026lt;\u0026gt; only returns the first module of that type.\n\u003C/p\u003E\n\u003Cp\u003E\nIt\u0027s a pretty simple fix though:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003Epublic class AYA_Science : PartModule\n    {\n        [KSPEvent(guiActive = true, guiActiveEditor = false, guiName = \u0022Perform All Science\u0022)]\n        public void DoAllScience()\n        {\n            foreach (Part eachPart in vessel.Parts) //cycle through all parts\n            {\n                foreach (PartModule pm in eachPart.modules) //cycle through all partModules on the current part\n\t\t\t\t{\n\t\t\t\t\tif(pm is ModuleScienceExperiment) //check if current partModule is a ModuleScienceExperiment, or inherited from one. \u0027is\u0027 is a C# keyword for this.\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t(ModuleScienceExperimet)pm.DeployExpriment(); //since the current partModule is a ModuleScienceExperiment, cast from type PartModule to type ModuleScienceExperiment so we can call .DeployExperiment.\n\t\t\t\t\t\t{\n\t\t\t\t}\n            }\n        }\n    }\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nThere is probably ways using the shortcut methods Squad supplies for working with modules that would accomplish this in fewer lines of code, but this makes it clear what is going on.\n\u003C/p\u003E\n\u003Cp\u003E\nOn the error you don\u0027t understand in your second post, I\u0027m pretty sure all you need to do is add a second set of empty brackets at the end of the line.\n\u003C/p\u003E\n\u003Cp\u003E\nD.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-07-02T23:38:02Z\u0022 title=\u002207/02/2016 11:38  PM\u0022 data-short=\u00228 yr\u0022\u003EJuly 2, 2016\u003C/time\u003E by Diazo\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Superfluous J","CreatedById":73725,"CreatedDateTime":"2016-07-04T02:08:49Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222657983\u0022 data-ipsquote-contentid=\u0022142947\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221467433442\u0022 data-ipsquote-userid=\u0022120438\u0022 data-ipsquote-username=\u0022wasml\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nOn 7/2/2016 at 0:24 AM, wasml said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nTry this - quick test looks like it works\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThank you both! Having solid code examples works wonders for me. However it probably shows how new I am at this whole coding thing that this suggestion:\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222658979\u0022 data-ipsquote-contentid=\u0022142947\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221467502572\u0022 data-ipsquote-userid=\u002281549\u0022 data-ipsquote-username=\u0022Diazo\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nOn 7/2/2016 at 7:36 PM, Diazo said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nOn the error you don\u0027t understand in your second post, I\u0027m pretty sure all you need to do is add a second set of empty brackets at the end of the line.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nwas actually all I needed. \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E Adding those parenthesis at the end not only cleared up the compile error, but now triggers all the experiments!\n\u003C/p\u003E\n"}]}