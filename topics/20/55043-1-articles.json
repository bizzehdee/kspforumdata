{"TopicId":55043,"ForumId":20,"TopicTitle":"[Linux] Managing addons \u0026amp; saving disk space with UnionFS/AuFS","CreatedByName":"Fail-Man 3D","CreatedById":67177,"CreatedDateTime":"2013-12-03T05:39:07Z","PageNum":1,"Articles":[{"CreatedByName":"Fail-Man 3D","CreatedById":67177,"CreatedDateTime":"2013-12-03T05:39:07Z","Content":"\n\u003Cp\u003EI\u0027ve recently started using unionfs-fuse to manage addons, it helps take the pain out of keeping multiple modded copies of KSP up to date and in sync with each other. It also eliminates the overhead (on non-deduplicating filesystems) of having multiple copies of KSP.\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003EExample:\u003C/strong\u003E I have one KSP prefix with regular ModularFuels (to build stuff for release on Spaceport), and another with Realistic ModularFuels (for actually playing the game). The directory structure would be set up as follows:\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Ebases/\u003Cbr\u003Ebases/KSP_linux/#contents of Squad\u0027s ksp-linux-$version.zip, the KSP executable lives here\u003Cbr\u003Ebases/ModularFuels-regular/GameData/ModularFuels/ # contents of the Modular Fuels distribution zip\u003Cbr\u003Ebases/ModularFuels-realistic/GameData/ModularFuels/ # contents of the Realistic Modular Fuels distribution zip\u003Cbr\u003Eprefixes/realistic/ # UnionFS storage dir for KSP with realistic modular fuels\u003Cbr\u003Eprefixes/normal/ # UnionFS storage dir for KSP with normal modular fuels\u003Cbr\u003Emounts/realistic/ # mountpoint for realistic\u003Cbr\u003Emounts/normal/ # mountpoint for normal\u003Cbr\u003Erealistic.sh # bash script to handle RealisticFuels mounting\u003Cbr\u003Enormal.sh # another one for normal ModularFuels\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EThe source of realistic.sh (public-domain):\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E#!/bin/bash\u003Cbr\u003EKSPPREFIX=\u0022realistic\u0022\u003Cbr\u003EKSPDIR=\u0022${HOME}/.local/ksp022\u0022\u003Cbr\u003E\u003Cbr\u003E# initial read-write entry for the prefix must NOT be the same as the mountpoint or *BAD THINGS* HAPPEN!\u003Cbr\u003EKSPPATH=\u0022${KSPDIR}/prefixes/${KSPPREFIX}=RW\u0022 # UnionFS writes all changes to this dir, if this==mountpoint then an infinite loop happens \u0026amp; hangs the unionfs driver (requires reboot to fix)\u003Cbr\u003EKSPPATH\u002B=\u0022:${KSPDIR}/bases/ModularFuels-realistic=RO\u0022 # load realistic modular fuels overlay\u003Cbr\u003EKSPPATH\u002B=\u0022:${KSPDIR}/bases/KSP_linux=RO\u0022 # apply all the previous lines to this base...\u003Cbr\u003E\u003Cbr\u003E/usr/bin/unionfs -o default_permissions,use_ino \\\u003Cbr\u003E    -o cow,statfs_omit_ro \\\u003Cbr\u003E    \u0022${KSPPATH}\u0022 \\\u003Cbr\u003E    \u0022${KSPDIR}/mounts/${KSPPREFIX}\u0022 # ...and mount it here (must NOT be the same as the read-write prefix!)\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EWhen done, I unmount with \u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Efusermount -u ~/.local/ksp022/mounts/realistic\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n"}]}