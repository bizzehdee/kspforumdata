{"TopicId":132948,"ForumId":20,"TopicTitle":"Gravity turn maths","CreatedByName":"RizzoTheRat","CreatedById":123362,"CreatedDateTime":"2016-02-26T10:57:51Z","PageNum":1,"Articles":[{"CreatedByName":"RizzoTheRat","CreatedById":123362,"CreatedDateTime":"2016-02-26T10:57:51Z","Content":"\n\u003Cp\u003E\nI\u0027ve started\u00A0fiddling\u00A0with kOS and my usual programming technique is to look at what other people have done first and then pinch bits of various people\u0027s ideas to do what I want.\u00A0\u00A0So far all the launch scripts I\u0027ve seen work by pointing the ship at a specific angle rather than doing a real gravity turn.\n\u003C/p\u003E\n\u003Cp\u003E\nI would like to programme a proper gravity turn, and then keep the ship pointing prograde, only making adjustments if it falls outside specified thresholds, which is kind of what I do when launching manually.\u00A0 My understanding is the initial turn will be dependant on TWR and drag.\u00A0 TWR I can easily calculate, presumably I could calculate a drag factor by comparing actually acceleration with the acceleration my TWR would produce in a vacuum?\n\u003C/p\u003E\n\u003Cp\u003E\nAnyone done anything similar?\u00A0 Anyone got any thoughts on working out the relationship between TWR, drag and the initial turn angle?\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"meyerweb","CreatedById":135212,"CreatedDateTime":"2016-02-26T16:41:38Z","Content":"\n\u003Cp\u003E\nI\u2019d like to know the same thing, for exactly the same reasons!\n\u003C/p\u003E\n"},{"CreatedByName":"John FX","CreatedById":59415,"CreatedDateTime":"2016-02-26T17:45:46Z","Content":"\n\u003Cp\u003E\nThere is a mod that does a primary tipping initially and then adjusts throttle to try to keep a gravity turn going and only when that is not enough will it try to use control surfaces. That might be a good start.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-02-26T18:00:05Z\u0022 title=\u002202/26/2016 06:00  PM\u0022 data-short=\u00228 yr\u0022\u003EFebruary 26, 2016\u003C/time\u003E by John FX\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Jim DiGriz","CreatedById":92465,"CreatedDateTime":"2016-02-27T00:33:30Z","Content":"\n\u003Cp\u003E\nHere\u0027s my attempt at doing the GravityTurn mods approach in kOS:\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://gist.github.com/lamont-granquist/e26279492ec020f711d2\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://gist.github.com/lamont-granquist/e26279492ec020f711d2\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nI believe if you want to do the most optimized gravity turn that the problem you are trying to solve is that you want to dump as much delta-V as possible while you are horizontal to minimize the gravity drag losses.\n\u003C/p\u003E\n\u003Cp\u003E\nIf you\u0027re too low and you burn horizontal you burn up, so you first have to reach an altitude of around 40,000-45,000m\n\u003C/p\u003E\n\u003Cp\u003E\nIf your horizontal velocity is too low when you reach an apoapsis of around 40,000m then you won\u0027t be able to circularize and maintain your 45,000m apoapsis, so you need to have some significant horizontal delta-v there.\n\u003C/p\u003E\n\u003Cp\u003E\nThe way that GT does this is by keeping the apoapsis around 30 seconds ahead of you.\n\u003C/p\u003E\n\u003Cp\u003E\nThere\u0027s probably an optimal trajectory where at the apoapsis you have a horizontal velocity of around 600-800m/s at around 40,000m-ish.\n\u003C/p\u003E\n\u003Cp\u003E\nIdeally you would burn your fuel in a single instant (at infinite TWR) to shoot yourself into that trajectory (taking account for how much drag you\u0027ll have, which alone is a hard problem to solve -- it\u0027d be simpler on an airless world -- although the GT module itself shows that drag is not that large of a loss with most halfway sanely constructed rockets).\n\u003C/p\u003E\n\u003Cp\u003E\nSo the problem to solve is to burn at full throttle, and immediately tip over just enough so that when your heading is locked to your surface vector, and after drag is subtracted that you wind up on that trajectory that takes you to around 600-800m/s at 40-45k\n\u003C/p\u003E\n\u003Cp\u003E\nThen once you can burn horizontal, burn all your fuel to circularize (at a safe altitude without burning up), and then further burn to raise your apoapsis up to your target orbit.\n\u003C/p\u003E\n\u003Cp\u003E\nOne problem to solve is that high altitude circularization burn at around 45k needs to be a bit more controlled so that you don\u0027t exceed certain speeds at certain altitudes (but you do punch it up to the max that you can). \u00A0Instead of trying to solve the problem of steering a rocket analytically to hit that curve there\u0027s probably a way to write down function of max velocity as it depends on height (or air density which you then plug in the bodies air density as a function of height) and then write a PID controller that feathers the throttle and/or attitude to try to hit that curve.\n\u003C/p\u003E\n\u003Cp\u003E\nThen I think on an airless world you could actually work backwards from a desired trajectory and work out the GT starting angle that would get you there for a given TWR. \u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://www.amazon.com/Introduction-Space-Dynamics-Aeronautical-Engineering/dp/0486651134/\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://www.amazon.com/Introduction-Space-Dynamics-Aeronautical-Engineering/dp/0486651134/\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nThere\u0027s some math in there which is about as accessible as I\u0027ve found so far.\n\u003C/p\u003E\n"},{"CreatedByName":"RizzoTheRat","CreatedById":123362,"CreatedDateTime":"2016-02-27T12:42:12Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222431570\u0022 data-ipsquote-contentid=\u0022132948\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221456533210\u0022 data-ipsquote-userid=\u002292465\u0022 data-ipsquote-username=\u0022Jim DiGriz\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n12 hours ago, Jim DiGriz said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nHere\u0027s my attempt at doing the GravityTurn mods approach in kOS:\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://gist.github.com/lamont-granquist/e26279492ec020f711d2\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://gist.github.com/lamont-granquist/e26279492ec020f711d2\u003C/a\u003E\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nInteresting, thanks. \u00A0So if I\u0027m reading that right, you\u0027re setting of at a TWR of 2.8 (so presumably always designing for a bit more than that?), climbing straight up to 50m/s, then pitching down 17 degrees and then trying to maintain 40 seconds to Ap?\n\u003C/p\u003E\n\u003Cp\u003E\nI can\u0027t quite work out what the end_surface bit is about, you\u0027re sticking to prograde when within the Q bounds, but how does that tie in with the ETA to Ap?\n\u003C/p\u003E\n"},{"CreatedByName":"Jim DiGriz","CreatedById":92465,"CreatedDateTime":"2016-02-27T18:33:53Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222432054\u0022 data-ipsquote-contentid=\u0022132948\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221456576932\u0022 data-ipsquote-userid=\u0022123362\u0022 data-ipsquote-username=\u0022RizzoTheRat\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n5 hours ago, RizzoTheRat said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nInteresting, thanks. \u00A0So if I\u0027m reading that right, you\u0027re setting of at a TWR of 2.8 (so presumably always designing for a bit more than that?), climbing straight up to 50m/s, then pitching down 17 degrees and then trying to maintain 40 seconds to Ap?\n\u003C/p\u003E\n\u003Cp\u003E\nI can\u0027t quite work out what the end_surface bit is about, you\u0027re sticking to prograde when within the Q bounds, but how does that tie in with the ETA to Ap?\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nAll the code that depends on TWR is commented out so at one point I was playing around with a rocket with 2.8 TWR and was using those startSpeed and startTurn calculations. \u00A0But yeah you\u0027re right that\u0027s the initiation of the gravity turn and its just hardcoded. \u00A0Those are the numbers that last worked for the last rocket I was playing with. \u00A0I don\u0027t know why all of the Ascent Guidance autopilots use a startSpeed and don\u0027t just tip over a bit right at the start, I keep shaving that down and it doesn\u0027t seem to make a difference, but I never played with it at exactly zero. \u00A0I think we\u0027re may be trying to act like real rocket launches but there\u0027s no reason in kerbal to do that? \u00A0Not sure...\n\u003C/p\u003E\n\u003Cp\u003E\nThe end_surface bit is when we stop setting our steering locked to the surface vector (AoA is zero) and when we start tracking prograde instead. \u00A0 We do that when Q is less than 2.5 kPa which happens when we start hitting the upper atmosphere and I think are pretty much horizontal. \u00A0Of course Q is also less than 2.5 kPa at the start of the launch so we need to make sure that we\u0027re coming down off of max Q rather than climbing up to it, which is what the check is that Q is less than max Q / 2 -- on ascent Q is very unlikely to be half of the max Q that we\u0027ve already seen since we don\u0027t throttle back for quite some time.\n\u003C/p\u003E\n\u003Cp\u003E\nAnd we end_surface because Q has dropped enough that drag has dropped enough that we\u0027re basically \u0027out\u0027 of the atmosphere and drag is low and we no longer care about drag loss, and we don\u0027t care about the possibility that we might flip over if our AoA isn\u0027t zero.\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027m pretty sure that \u0022maintaining time to Ap\u0022 is a bit of a (useful)\u00A0hack -- what its trying to do is make it so that you burn a lot of fuel immediately to push that Ap out, and then by maintaining the Ap slightly ahead of you when you hit horizontal flight it minimizes your gravity losses there. \u00A0It\u00A0keeps you burning horizontal so that you don\u0027t pass through the Ap and start having a large deviation between your prograde and your burn (which causes losses) and you don\u0027t get too ahead of yourself and push the Ap out too far and again your burn would not be in line with your prograde which would not be horizontal. \u00A0 There\u0027s dV losses that come in when you don\u0027t burn horizontal and dV losses that come in when you don\u0027t burn along your prograde vector -- when your prograde vector is horizontal and you\u0027re burning along it is when you have zero dV losses.\n\u003C/p\u003E\n\u003Cp\u003E\nAnd if you want to see improvements in delta-V getting to orbit build some bigger rockets using jumbo-64s and plenty of TWR (like 2.8 or so). \u00A0If you build a 1.25m rocket with a 1.4 TWR you won\u0027t see much improvement because your drag losses will be higher (bigger rockets punch through the atmosphere better -- kerbal gets this right). \u00A0Also if you build upper stages without enough TWR this code doesn\u0027t do any pitching up, so you\u0027ll just fail to maintain time to Ap and crash. \u00A0Upper stages for this code need a decent amount of TWR.\n\u003C/p\u003E\n\u003Cp\u003E\n(and the drag losses in this code are all wrong, its a long story....)\n\u003C/p\u003E\n"},{"CreatedByName":"RizzoTheRat","CreatedById":123362,"CreatedDateTime":"2016-02-29T13:05:00Z","Content":"\n\u003Cp\u003E\nIf you turn right off the pad presumably you\u0027re having you use the reaction wheels to keep it pointed in a sensible direction, if you let it get up some speed first the aerodynamics will keep it pointed the right way.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027m thinking I might just spend some time experimenting with turn altitudes and angles for different TWR/drag craft and see if there\u0027s any obvious relationship.\n\u003C/p\u003E\n"}]}