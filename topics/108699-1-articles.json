{"TopicId":108699,"ForumId":29,"TopicTitle":"Spawning from a ProtoCrewMember","CreatedByName":"rhoark","CreatedById":57151,"CreatedDateTime":"2015-05-11T00:46:02Z","PageNum":1,"Articles":[{"CreatedByName":"rhoark","CreatedById":57151,"CreatedDateTime":"2015-05-11T00:46:02Z","Content":"\n\u003Cp\u003EI\u0027m trying to put a kerbal in the world given a ProtoCrewMember. Doing some cargo cult programming looking at \u003Ca href=\u0022https://github.com/jrossignol/ContractConfigurator/blob/master/source/ContractConfigurator/ContractBehaviour/SpawnKerbal.cs\u0022 rel=\u0022external nofollow\u0022\u003Ewhat ContractConfigurator does\u003C/a\u003E, I came up with this:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003EProtoCrewMember protocrew = [etc...]\u003Cbr\u003Evar flight = ShipConstruction.GetUniqueFlightID(HighLogic.CurrentGame.flightState);\u003Cbr\u003Evar crew = new ProtoCrewMember[1];\u003Cbr\u003Ecrew[0] = protocrew;\u003Cbr\u003Evar parts = new ConfigNode[1];\u003Cbr\u003Eparts[0] = ProtoVessel.CreatePartNode(\u0022kerbalEVA\u0022, flight, crew);\u003Cbr\u003Evar nothing = new ConfigNode[0];\u003Cbr\u003Evar orbit = new Orbit(0,0,0,0,0,0,0,vessel.mainBody);\u003Cbr\u003Evar position = vessel.GetWorldPos3D();\u003Cbr\u003Eorbit.UpdateFromStateVectors(position, vessel.mainBody.getRFrmVel(position), vessel.mainBody, Planetarium.GetUniversalTime());\u003Cbr\u003Evar vesselConfig = ProtoVessel.CreateVesselNode(protocrew.name, VesselType.EVA, orbit, 0, parts, nothing);\u003Cbr\u003Evar protoVessel = HighLogic.CurrentGame.AddVessel(vesselConfig);\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003ETrying this from the launchpad, the result is always a message in the log \u0022Vessel Jebediah Kerman crashed through terrain on Kerbin\u0022. I\u0027m guessing that means something is wrong with the orbit I\u0027m providing, or the position it is based on, but I don\u0027t see how that could be since they\u0027re constructed based on a vessel not crashing through terrain.\u003C/p\u003E\n"},{"CreatedByName":"TAz00","CreatedById":41667,"CreatedDateTime":"2015-05-11T06:17:50Z","Content":"\n\u003Cp\u003ECheck this out : \u003Ca href=\u0022https://github.com/godarklight/DarkMultiPlayer/blob/master/Client/ScenarioWorker.cs\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/godarklight/DarkMultiPlayer/blob/master/Client/ScenarioWorker.cs\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EThere\u0027s a \u0027GenerateStrandedKerbal\u0027 method\u003C/p\u003E\n"},{"CreatedByName":"rhoark","CreatedById":57151,"CreatedDateTime":"2015-05-11T14:47:46Z","Content":"\n\u003Cp\u003ESpawning in a random orbit like DarkMultiplayer does seems to go fine. I need a landed kerbal, though.\u003C/p\u003E\n"},{"CreatedByName":"rhoark","CreatedById":57151,"CreatedDateTime":"2015-05-12T01:17:44Z","Content":"\n\u003Cp\u003EGetting closer - I now have a landed kerbal. However, it doesn\u0027t seem to actually initialize gender, trait, or personality from the provided ProtoCrewMember.\u003C/p\u003E\u003Cp\u003EHere\u0027s what I\u0027m doing:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Euint LetThereBeKerbal(ProtoCrewMember protocrew) {\u003Cbr\u003E\tvar body = vessel.mainBody;\u003Cbr\u003E\tvar flight = ShipConstruction.GetUniqueFlightID(HighLogic.CurrentGame.flightState);\u003Cbr\u003E\tvar crew = new ProtoCrewMember[1];\u003Cbr\u003E\tcrew[0] = protocrew;\u003Cbr\u003E\tvar parts = new ConfigNode[1];\u003Cbr\u003E\tparts[0] = ProtoVessel.CreatePartNode(\u0022kerbalEVA\u0022, flight, crew);\u003Cbr\u003E\tvar extra = new ConfigNode[0];\u003Cbr\u003E\tvar orbit = Orbit.CreateRandomOrbitAround(body);\u003Cbr\u003E\tvar vesselConfig = ProtoVessel.CreateVesselNode(protocrew.name, VesselType.EVA, orbit, 0, parts, extra);\u003Cbr\u003E\tvar position = part.transform.position;\u003Cbr\u003E\tposition \u002B= (position-body.position).normalized * 5.0;\u003Cbr\u003E\tvesselConfig.SetValue(\u0022sit\u0022, Vessel.Situations.LANDED.ToString());\u003Cbr\u003E\tvesselConfig.SetValue(\u0022landed\u0022, true.ToString());\u003Cbr\u003E\tvesselConfig.SetValue(\u0022lat\u0022, (body.GetLatitude(position)).ToString());\u003Cbr\u003E\tvesselConfig.SetValue(\u0022lon\u0022, (body.GetLongitude(position)).ToString());\u003Cbr\u003E\tvesselConfig.SetValue(\u0022alt\u0022, (body.GetAltitude(position)).ToString());\u003Cbr\u003E\tvar protoVessel = HighLogic.CurrentGame.AddVessel(vesselConfig);\u003Cbr\u003E\treturn flight;\u003Cbr\u003E}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n"}]}