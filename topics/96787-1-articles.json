{"TopicId":96787,"ForumId":29,"TopicTitle":"Run code once per game session on loading space center.","CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2015-01-15T19:02:06Z","PageNum":1,"Articles":[{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2015-01-15T19:02:06Z","Content":"\n\u003Cp\u003EAlright.\u003C/p\u003E\u003Cp\u003EIn the mod in question, I do not have a master module that runs in all scenes, I have modules specific to each scene that only run in that scene.\u003C/p\u003E\u003Cp\u003EI currently have a piece of code that runs in the GameScene.SpaceCenter OnStart method, so it runs everytime the player switches back from the VAB/SPH or flight scenes to the space center, as well as running when you load the game and switch from the Main Menu to the space center.\u003C/p\u003E\u003Cp\u003EHow would I go about running this code only when switching from the MainMenu to the space center, so once per game session? There is no \u0022switching from (scene)\u0022 variable that I am aware of that I can query, and without a master module, I don\u0027t have the data persistence across scenes to save a value. I also don\u0027t want to write this to my config file as I specifically want it to reset when you quit the game.\u003C/p\u003E\u003Cp\u003EAnyone have any ideas?\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n"},{"CreatedByName":"philotical","CreatedById":109390,"CreatedDateTime":"2015-01-15T19:13:04Z","Content":"\n\u003Cp\u003EI\u0027m not aware of such an event either..\u003C/p\u003E\u003Cp\u003EBut here\u0027s somewhat of a work around\u003C/p\u003E\u003Cp\u003ELet your mod run also in main menu \u003C/p\u003E\u003Cp\u003Ein al scenes, you save a var named \u0022current_scene_backup\u0022 or so with the name of the current scene..\u003C/p\u003E\u003Cp\u003Eif your actual scene is space center AND current_scene_backup is \u0022mainmenu\u0022 you have at least skipped all other scene changes..\u003C/p\u003E\u003Cp\u003EAdditionally, you can there set an other bool-var named \u0022spacecenter_done\u0022 to true, this could be checked in main menu =\u0026gt; if a user switches back to main menu to reenter the game, the code will not run again.\u003C/p\u003E\u003Cp\u003EI\u0027m sure this will still leave some holes - but you might be better off allready..\u003C/p\u003E\u003Cp\u003EOr try to write a \u0022onSceneChange\u0022 event with the same methode to determine a changed scene in it..\u003C/p\u003E\u003Cp\u003Eyou could share it as a \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/97751-PLUGIN-0-25-Texture-Animation-Util\u0022 rel=\u0022external nofollow\u0022\u003ECommunityUtil\u003C/a\u003E\u003C/p\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2015-01-15T19:23:11Z","Content":"\n\u003Cp\u003EWhy not something like this?:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E[KSPAddon(KSPAddon.Startup.MainMenu, false)]\u003Cbr\u003Eclass MainMenuSentinel : MonoBehaviour\u003Cbr\u003E{\u003Cbr\u003E    public static bool JustRan = true;\u003Cbr\u003E\u003Cbr\u003E    private void Awake() { JustRan = true; }\u003Cbr\u003E}\u003Cbr\u003E\u003Cbr\u003E[KSPAddon(KSPAddon.Startup.SpaceCentre, false)]\u003Cbr\u003Eclass RunIfJustEnteredSpaceCenter : MonoBehaviour\u003Cbr\u003E{\u003Cbr\u003E    private void Start()\u003Cbr\u003E    {\u003Cbr\u003E        if (MainMenuSentinel.JustRan)\u003Cbr\u003E        {\u003Cbr\u003E            MainMenuSentinel.JustRan = false;\u003Cbr\u003E\u003Cbr\u003E            /* your logic */\u003Cbr\u003E        }\u003Cbr\u003E    }\u003Cbr\u003E}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n"},{"CreatedByName":"stupid_chris","CreatedById":62017,"CreatedDateTime":"2015-01-15T19:30:50Z","Content":"\n\u003Cp\u003EDoesn\u0027t GameEvents.onGameSceneLoadRequested fire before HighLogic.LoadedGameScene changes? All you have to do is drop something like \u0022public static bool run = false;\u0022 in your KSPAddon that needs to run when doing MainMenu-\u0026gt;SpaceCenter. Then, when the game launches, you can simply add a method to onGameSceneLoadRequested that checks which scene it is changing to, and which is the current scene. Probably something like this:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Epublic void OnSceneChange(GameScene scene)\u003Cbr\u003E{\u003Cbr\u003E    if (scene == GameScenes.SpaceCenter \u0026amp;\u0026amp; HighLogic.LoadedScene == GameScenes.MainMenu)\u003Cbr\u003E    {\u003Cbr\u003E         SpaceCenterAddon.run = true;\u003Cbr\u003E    }\u003Cbr\u003E}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2015-01-15T19:40:19Z","Content":"\n\u003Cp\u003E@xEvilReeperx: So making the bool static does some trickery that keeps it in existence so the MainMenu start method can see it? I assumed that because it was running as a KSPAddon.MainMenu, it would be destroyed when leaving the main menu and so not available to the SpaceCenter Start code.\u003C/p\u003E\u003Cp\u003E@stupid_chris: That sounds like while there is no variable for last loaded scene I can check, that GameEvent would work essentially the same from a logic perspective.\u003C/p\u003E\u003Cp\u003EI\u0027ll run some tests and see what happens, thanks for the suggestions all.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n"},{"CreatedByName":"stupid_chris","CreatedById":62017,"CreatedDateTime":"2015-01-15T19:45:08Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Diazo\u0022 data-cite=\u0022Diazo\u0022\u003E\u003Cdiv\u003E@xEvilReeperx: So making the bool static does some trickery that keeps it in existence so the MainMenu start method can see it? I assumed that because it was running as a KSPAddon.MainMenu, it would be destroyed when leaving the main menu and so not available to the SpaceCenter Start code.\u003Cp\u003E@stupid_chris: That sounds like while there is no variable for last loaded scene I can check, that GameEvent would work essentially the same from a logic perspective.\u003C/p\u003E\u003Cp\u003EI\u0027ll run some tests and see what happens, thanks for the suggestions all.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ETo answer two of your questions: static variables are constant to all the objects of a same type, if you modify it in one, it\u0027s modified for all the other objects fo the same type, as well as for all the objects of the same type that /will/ be created. Theres no real concept of loading/unloading with static variables. It\u0027s essentially a memory slot pinned to an object.\u003C/p\u003E\u003Cp\u003EFor the second part, as I said, there is no reference to the previous scene, but I\u0027m pretty sure that the HighLogic.LoadedGameScene property is changed /after/ the GameEvent is fired, while the GameEvent. The GameEvent triggers in my experience a request to load a new scene. Since the scene isn\u0027t changed yet and the event passes the scene to be loaded as a variable, you can check where you are right now and where you\u0027re going, opposite to where you were, which is pretty much the same thing in terms of information.\u003C/p\u003E\n"}]}