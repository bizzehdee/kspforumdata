{"TopicId":176157,"ForumId":55,"TopicTitle":"Thoughts and suggestions on multi-thread performance (and lack of)","CreatedByName":"eddiew","CreatedById":127483,"CreatedDateTime":"2018-06-24T21:31:44Z","PageNum":1,"Articles":[{"CreatedByName":"eddiew","CreatedById":127483,"CreatedDateTime":"2018-06-24T21:31:44Z","Content":"\n\u003Cp\u003E\nHey folks,\n\u003C/p\u003E\n\u003Cp\u003E\nSo yeah, I\u0027m grumbling because my 103 part ship gets yellow clocks at 1x timewarp.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nOn a Ryzen 1600X with 32gb memory and an m.2 Samsung 960 Pro. This is not a slow PC. Most often my task manager says 11-13% of CPU and 30-40% of GPU in use. We are\u00A0\u003Cem\u003Eso badly\u003C/em\u003E\u00A0bound by single core performance that I can\u0027t help but wonder if this is even on the developer\u0027s roadmap for things to review?\n\u003C/p\u003E\n\u003Cp\u003E\nI mean, I think I get it; you initiate a force from an engine or a wing or an impact, and the game then propagates that force up all the linkages and sees what bends and what breaks and what generates lift or drag. I get that that has to be done linearly, but... is it \u003Cem\u003Eall\u003C/em\u003E required, and is it optimised? I\u0027m just looking to explore questions like:\n\u003C/p\u003E\n\u003Col\u003E\u003Cli\u003E\nFor regular flight (non-impact scenarios), does the game identify the weakest load-bearing part and stop when it gets to and clears\u00A0it (on the assumption that all other parts beyond must be fine)?\n\u003Col\u003E\u003Cli\u003E\nDoes it split the vessel into three around the weakest part, test the links either side as if the segments were rigid, and stop there if nothing breaks?\n\u003C/li\u003E\n\u003C/ol\u003E\u003C/li\u003E\n\u003Cli\u003E\nDo parts in cargo bays (which are not load-bearing) get properly ignored by the physics calcs unless that bay is open or a new collision is detected?\n\u003C/li\u003E\n\u003Cli\u003E\nDo this expensive set of physics calcs actually add to the game? What if all vessels\u00A0were simply assumed rigid unless colliding with another vessel/astronomical body? Do we love noodle rockets and explosions \u003Cem\u003Eso much \u003C/em\u003Ethat it\u0027s worth the fps drop of \u003Cem\u003Enot\u003C/em\u003E treating them as rigid bodies that do not bend or flex ever?\n\u003C/li\u003E\n\u003Cli\u003E\nHas there been any thought of grouping parts into groups of N, tackling the physics as if they were a single part with the structural strength of \u0026lt;minimum segment\u0026gt; and only breaking the calculation down further if something causes issues, and only in the section that broke?\n\u003C/li\u003E\n\u003Cli\u003E\nDoes the game separate calculations like lift from bending/breaking forces? Spaceplanes are particularly laggy and I can\u0027t help wonder if we (do/could do) frame-by-frame calculations for the bending forces, and the lift and the drag in separate threads, with the lift and drag\u0027s calc\u0027s taking the previous frame\u0027s bending outputs. Yes the lift would be a frame behind, but would the player notice at 25\u002B fps that would result from threading it? Or even at 2 fps.\n\u003C/li\u003E\n\u003C/ol\u003E\u003Cp\u003E\nIntended to be constructive! I am a little tipsy so this may not be the best organised list, but\u00A0I\u0027m genuinely interested whether performance is at all on the radar.\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027m also debating whether or not to swap my Ryzen 1600X for an Intel 8086K with it\u0027s 5ghz single-thread boost. Which would be about 25% more performance. Which I would quite like. Because yes I am that dedicated to KSP that I will spend hundreds of english pounds to make it run better.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222018-06-24T21:32:58Z\u0022 title=\u002206/24/2018 09:32  PM\u0022 data-short=\u00226 yr\u0022\u003EJune 24, 2018\u003C/time\u003E by eddiew\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Hotaru","CreatedById":135669,"CreatedDateTime":"2018-06-24T21:53:12Z","Content":"\n\u003Cp\u003E\nI wonder if it would be possible to have a \u0022simplified connection physics\u0022 mode where all connections are treated as perfectly rigid, as if the whole ship was welded. It might remove a little of the challenge--you could build any old ridiculous contraption and have it be perfectly solid--but on machines that have trouble with part counts it\u0027d absolutely be worth it. If my experience with welded torus stations is anything to go on, such a mode would make a \u003Cem\u003Ehuge\u003C/em\u003E difference in playability.\n\u003C/p\u003E\n"},{"CreatedByName":"Boris-Barboris","CreatedById":133181,"CreatedDateTime":"2018-06-24T22:11:54Z","Content":"\n\u003Cp\u003E\n6. Do devs posess actual profiling data for the large vessel case? Can they publish it here?\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cbr\u003E\nTo the \u003Cabbr title=\u00221. Original Post(er). The first post in a thread, or the person who posted it. 2. Overpowered. A part or mechanic that upsets game balance by being too powerful.\u0022\u003EOP\u003C/abbr\u003E:\u003Cbr\u003E\n3). You would get another game, though it would indeed perform better. Joints are integral part of KSP from the very beginning, a lot of players like it, it will not change. What you propose is the path Space Engineers took btw. Space Engineers performance may be assessed by this meme (rather old though, but you get the idea, there is always trouble when game has any physics): \u003Ca href=\u0022https://imgur.com/PetIf9p\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://imgur.com/PetIf9p\u003C/a\u003E\u003Cbr\u003E\n4). \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/96670-14-253-2018-04-06-ubiozur-welding-ltd-continued/\u0022 rel=\u0022\u0022\u003Ehttps://forum.kerbalspaceprogram.com/index.php?/topic/96670-14-253-2018-04-06-ubiozur-welding-ltd-continued/\u003C/a\u003E\u003Cbr\u003E\n5).\n\u003C/p\u003E\n\u003Cp\u003E\n\u0026gt; Does the game separate calculations like lift from bending/breaking forces?\u003Cbr\u003E\nyes. Before the integration step is made, KSP game code appends forces (drag, lift, gravity) and torques (\u003Cabbr title=\u0022Stability Augmentation System\u0022\u003ESAS\u003C/abbr\u003E) to rigid bodies that will be accounted for by PhysX iterative solver. All that and joints and collisions on top of it are then calculated in said PhysX iterative solver under no direct control of KSP devs.\n\u003C/p\u003E\n\u003Cp\u003E\n\u0026gt; I can\u0027t help wonder if we (do/could do) frame-by-frame calculations for the bending forces\uFEFF, and the lift and the drag in separate threads, with the lift and drag\u0027s calc\u0027s taking the previous frame\u0027s bending outputs.\u003Cbr\u003E\nyes, though Unity makes multithreading unreasonably hard. Measures that make it possible under Unity may well outslog the benefit of threading. Profiling is king here. Also, it implies devs caring at this point. Game\u0027s life cycle is far from it\u0027s zenith.\n\u003C/p\u003E\n\u003Cp\u003E\n\u0026gt; Yes the lift would be a frame behind, but would the player notice at 25\u002B fps that would result from threading it? Or even at 2 fps.\u003Cbr\u003E\nyes. Such integration scheme is not physically correct and makes little sense. There will be planes that should fly and wich will not fly under such physical laws, they will become unstable. Control code will stop working as it is now. Manual control will feel unnatural with additional lag. It would be a nightmare.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222018-06-24T22:12:30Z\u0022 title=\u002206/24/2018 10:12  PM\u0022 data-short=\u00226 yr\u0022\u003EJune 24, 2018\u003C/time\u003E by Boris-Barboris\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"eddiew","CreatedById":127483,"CreatedDateTime":"2018-06-24T22:50:00Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223404803\u0022 data-ipsquote-contentid=\u0022176157\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221529877192\u0022 data-ipsquote-userid=\u0022135669\u0022 data-ipsquote-username=\u0022Hotaru\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n53 minutes ago, Hotaru said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nI wonder if it would be possible to have a \u0022simplified connection physics\u0022 mode where all connections are treated as perfectly rigid, as if the whole ship was welded. It might remove a little of the challenge--you could build any old ridiculous contraption and have it be perfectly solid--but on machines that have trouble with part counts it\u0027d absolutely be worth it. If my experience with welded torus stations is anything to go on, such a mode would make a \u003Cem\u003Ehuge\u003C/em\u003E difference in playability.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nAll machines have trouble with part counts, the question is whether the player builds things big enough to notice \u003Cspan\u003E\u003Cimg alt=\u0022:/\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/ZNGIcon1.png\u0022 title=\u0022:/\u0022\u003E\u00A0 I find it frustrating that on my old 2500K I used to try to keep spaceplanes below 80 parts, and on my new 1600X I try to keep spaceplanes below 80 parts. This... has got to be tackled at some point for the game to progress...\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cspan\u003EAnd yeah, I\u0027ve welded many things in the past, but the mission in question with it\u0027s just-over-100 didn\u0027t feel worth the effort... until it was yellow clocking for 5 RL hours. The big silly stations in my current playthrough/comic strip are a single part with the exception of whatever\u0027s been docked to them at a later date \u003Cspan\u003E\u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u00A0\u003C/span\u003E\u003C/span\u003E\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223404813\u0022 data-ipsquote-contentid=\u0022176157\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221529878314\u0022 data-ipsquote-userid=\u0022133181\u0022 data-ipsquote-username=\u0022Boris-Barboris\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n38 minutes ago, Boris-Barboris said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\n6. Do devs posess actual profiling data for the large vessel case? Can they publish it here?\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cbr\u003E\nTo the \u003Cabbr title=\u00221. Original Post(er). The first post in a thread, or the person who posted it. 2. Overpowered. A part or mechanic that upsets game balance by being too powerful.\u0022\u003EOP\u003C/abbr\u003E:\u003Cbr\u003E\n3). You would get another game, though it would indeed perform better. Joints are integral part of KSP from the very beginning, a lot of players like it, it will not change. What you propose is the path Space Engineers took btw. Space Engineers performance may be assessed by this meme (rather old though, but you get the idea, there is always trouble when game has any physics): \u003Ca href=\u0022https://imgur.com/PetIf9p\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://imgur.com/PetIf9p\u003C/a\u003E\u003Cbr\u003E\n4). \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/96670-14-253-2018-04-06-ubiozur-welding-ltd-continued/\u0022 rel=\u0022\u0022\u003Ehttps://forum.kerbalspaceprogram.com/index.php?/topic/96670-14-253-2018-04-06-ubiozur-welding-ltd-continued/\u003C/a\u003E\u003Cbr\u003E\n5).\n\u003C/p\u003E\n\u003Cp\u003E\n\u0026gt; Does the game separate calculations like lift from bending/breaking forces?\u003Cbr\u003E\nyes. Before the integration step is made, KSP game code appends forces (drag, lift, gravity) and torques (\u003Cabbr title=\u0022Stability Augmentation System\u0022\u003ESAS\u003C/abbr\u003E) to rigid bodies that will be accounted for by PhysX iterative solver. All that and joints and collisions on top of it are then calculated in said PhysX iterative solver under no direct control of KSP devs.\n\u003C/p\u003E\n\u003Cp\u003E\n\u0026gt; I can\u0027t help wonder if we (do/could do) frame-by-frame calculations for the bending forces\uFEFF, and the lift and the drag in separate threads, with the lift and drag\u0027s calc\u0027s taking the previous frame\u0027s bending outputs.\u003Cbr\u003E\nyes, though Unity makes multithreading unreasonably hard. Measures that make it possible under Unity may well outslog the benefit of threading. Profiling is king here. Also, it implies devs caring at this point. Game\u0027s life cycle is far from it\u0027s zenith.\n\u003C/p\u003E\n\u003Cp\u003E\n\u0026gt; Yes the lift would be a frame behind, but would the player notice at 25\u002B fps that would result from threading it? Or even at 2 fps.\u003Cbr\u003E\nyes. Such integration scheme is not physically correct and makes little sense. There will be planes that should fly and wich will not fly under such physical laws, they will become unstable. Control code will stop working as it is now. Manual control will feel unnatural with additional lag. It would be a nightmare.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nI\u0027m aware of and do use the welding mod \u003Cspan\u003E\u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u00A0 I just didn\u0027t expect to be needing it with 103 parts\u00A0\u003Cimg alt=\u0022:huh:\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_undecided.gif\u0022 title=\u0022:huh:\u0022\u003E\u00A0\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cspan\u003EThanks for the info how how the game code runs \u003Cspan\u003E\u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u00A0 Sounds like Unity really needs to get a grip on threading, since it\u00A0\u003Cem\u003Eis\u003C/em\u003E\u00A0the future. And the present, if we\u0027re honest.\u00A0\u003C/span\u003E\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cspan\u003E\u003Cspan\u003ENot sure I understand why having the lift/drag a frame behind the bending is a particular problem... does it result in runaway forces because the next frame\u0027s bending is calculated based on the previous frame\u0027s drag\u002Blift? I\u0027m not a game coder, I\u0027m basically just chucking out ideas that seem sane on the surface but may not pass inspection \u003Cspan\u003E\u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u00A0\u003C/span\u003E\u003C/span\u003E\u003C/span\u003E\n\u003C/p\u003E\n"}]}