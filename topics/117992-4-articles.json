{"TopicId":117992,"ForumId":34,"TopicTitle":"[1.7-1.9] SMURFF: Simple Module adjUstments for Real-ish Fuel-mass Fractions 1.9.1 (02019 Nov 12)","CreatedByName":"Kerbas_ad_astra","CreatedById":126593,"CreatedDateTime":"2015-08-08T22:30:00Z","PageNum":4,"Articles":[{"CreatedByName":"Kerbas_ad_astra","CreatedById":126593,"CreatedDateTime":"2016-01-14T04:58:10Z","Content":"Heat shield testing, the Kerbal way:\n\n1. Take a rocket used for suborbital launches (3-5 km/s of delta-V).\n2. HyperEdit into orbit.\n3. Burn downward at 45 degrees until atmospheric periapsis and velocity are similar to lunar return (10.5-11 km/s, 40-50 km).\n4. Decouple the rocket and assume the retrograde attitude.\n5. Repeat, reverting failures as necessary.\n\nTo compensate for the reduction in heat shield Ablator capacity, I\u0027ve had to increase pyrolysisLossFactor -- I assume that this scales the amount of energy carried away per unit of Ablator ablated.  Keeping the product the same (halving Ablator -\u003E doubling pyrolysisLossFactor) should therefore keep constant the total amount of energy that the shield can dissipate.  [@NathanKell](https://forum.kerbalspaceprogram.com/index.php?/profile/75006-nathankell/), is this correct?\n\nI\u0027ve also come up with a way to catalogue the \u0022reserved mass\u0022 to set aside for tanks and batteries, so pod and engine buffs now only remove 62.5% and 50% of mass that isn\u0027t allocated for any of those things.  This means that the Twin-Boar LFB is viable again.\n\n**Edited \u003Ctime datetime=\u00222016-01-14T05:04:35Z\u0022 title=\u002201/14/2016 05:04  AM\u0022 data-short=\u00228 yr\u0022\u003EJanuary 14, 2016\u003C/time\u003E by Kerbas\\_ad\\_astra**"},{"CreatedByName":"NathanKell","CreatedById":75006,"CreatedDateTime":"2016-01-14T20:16:00Z","Content":"[@Kerbas_ad_astra](https://forum.kerbalspaceprogram.com/index.php?/profile/126593-kerbas_ad_astra/) You assume correctly!\n\nAlso it\u0027s heat shield testing the real way too: [https://en.wikipedia.org/wiki/Project_FIRE](https://en.wikipedia.org/wiki/Project_FIRE)"},{"CreatedByName":"komodo","CreatedById":102065,"CreatedDateTime":"2016-01-17T23:18:51Z","Content":"\u003E \n\u003E \n\u003E On 1/8/2016 at 9:27 PM, NathanKell said:\n\u003E \n\u003E \n\u003E [@Kerbas_ad_astra](https://forum.kerbalspaceprogram.com/index.php?/profile/126593-kerbas_ad_astra/) [@komodo](https://forum.kerbalspaceprogram.com/index.php?/profile/102065-komodo/) I just realized I should mention. I don\u0027t think ROMini does this, either. Need to rescale any override drag cubes when the parts rescale.\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E Happily I wrote some code in RO to do this, which you\u0027re both free to use ( [@komodo](https://forum.kerbalspaceprogram.com/index.php?/profile/102065-komodo/) you should do it in a script, since that avoids having to pre-specify the number of cubes ). [https://github.com/KSP-RO/RealismOverhaul/blob/master/GameData/RealismOverhaul/DragCubeRescaler.cfg](https://github.com/KSP-RO/RealismOverhaul/blob/master/GameData/RealismOverhaul/DragCubeRescaler.cfg)\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E Note relevant to present-SMURFF since you don\u0027t rescale, though, right?\n\u003E \n\n[@NathanKell](https://forum.kerbalspaceprogram.com/index.php?/profile/75006-nathankell/): I... Well, i\u0027ve been out of KSP land for a bit, new job and all that. I think I grasp what this is doing, in theory at least. I\u0027m unsure where the rescalex/y/z variables come in from though. Scripting it looks no difficult than the prior patches that i\u0027ve made, but i\u0027m going to play with it to see what it actually does, haha.\n\nThanks for the heads up though, this might explain some oddities i\u0027ve seen. (Does FAR even care about drag cubes? That is one i\u0027ve wondered for a while...)"},{"CreatedByName":"NathanKell","CreatedById":75006,"CreatedDateTime":"2016-01-18T05:41:22Z","Content":"They come from adding them at the same time you do the rescale. I.e. in RO when we patch a part we change its visual scale and then (instead of manually changing the drag cube in that patch, as we used to) we drop a rescale-cube marker for that rescale script to handle later. There are three separate dimensions because RO often needs to do non-uniform scaling.\n\nFAR doesn\u0027t care about cubes for aero, but FAR doesn\u0027t replace any thermo code (or buoyancy) so cubes definitely still matter.\n\n[@komodo](https://forum.kerbalspaceprogram.com/index.php?/profile/102065-komodo/)"},{"CreatedByName":"raxo2222","CreatedById":110750,"CreatedDateTime":"2016-01-23T15:23:20Z","Content":"This is so smurftastic mod ![:D](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif \u0022:D\u0022)\n\nFun to play with RSS, can we also get some real world rocket replicas?\n\nAnd why this mod isn\u0027t in CKAN?"},{"CreatedByName":"Kerbas_ad_astra","CreatedById":126593,"CreatedDateTime":"2016-01-23T16:01:19Z","Content":"It\u0027s not on CKAN because I don\u0027t use it, so I\u0027ve felt no particular urgency to get it listed.  I understand that the process is straightforward, so after the latest work crunch has passed next week, I\u0027ll see about changing that.\n\nAs for real world rocket replicas, there are already mods that do that, and I don\u0027t yet have the skills for modeling parts.  What are you looking for?"},{"CreatedByName":"raxo2222","CreatedById":110750,"CreatedDateTime":"2016-01-23T16:44:15Z","Content":"\u003E \n\u003E \n\u003E 40 minutes ago, Kerbas\\_ad\\_astra said:\n\u003E \n\u003E \n\u003E It\u0027s not on CKAN because I don\u0027t use it, so I\u0027ve felt no particular urgency to get it listed.  I understand that the process is straightforward, so after the latest work crunch has passed next week, I\u0027ll see about changing that.\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E As for real world rocket replicas, there are already mods that do that, and I don\u0027t yet have the skills for modeling parts.  What are you looking for?\n\u003E \n\nAh okay.\n\nAnd I meant rockets made from stock parts, that can launch satellite on Earth in RSS."},{"CreatedByName":"Joco223","CreatedById":92530,"CreatedDateTime":"2016-01-23T21:29:33Z","Content":"[@raxo2222](https://forum.kerbalspaceprogram.com/index.php?/profile/110750-raxo2222/) You can use this mod in RSS and it does it job very well I can say ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif \u0022:)\u0022) . I\u0027m playing with it right now and its pretty awesome. But be sure your PC can handle the rockets if you don\u0027t use procedural parts. Rockets need to be pretty big for manned missions. Unmanned missions are fine with fps for me"},{"CreatedByName":"Kerbas_ad_astra","CreatedById":126593,"CreatedDateTime":"2016-01-24T18:08:44Z","Content":"\u003E \n\u003E \n\u003E On 1/23/2016 at 11:44 AM, raxo2222 said:\n\u003E \n\u003E \n\u003E Ah okay.\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E And I meant rockets made from stock parts, that can launch satellite on Earth in RSS.\n\u003E \n\nOnce my new patch is released (with the mass reduction for command pods), the Kerbal X will actually be capable of reaching LEO (provided you take the legs and ladders off first), though I wouldn\u0027t recommend actually trying it, since it doesn\u0027t come with a heat shield.  Take the landing parts off, add a heat shield, and extend the upper stage with another X200-16 fuel tank, though, and you\u0027ll be in business!  You\u0027ll be able to launch anything that weighs a few tons with a rocket about that size.  I\u0027ll see about putting together a craft library on KerbalX or something, and maybe even with the download (though this will delay the CKAN release even further).\n\nOne more upcoming feature: \u0022overdraft\u0022 protection.  Since SMURFF works by (among other things) subtracting the mass corresponding to the excess weight of a stock tank, parts with mass ratios significantly better than stock can have their masses sent into the negatives.  In my testing, I have found three parts in this category -- the adapter tanks from [@Orionkermin](https://forum.kerbalspaceprogram.com/index.php?/profile/91013-orionkermin/)\u0027s Home Grown Rockets and the big xenon tank from [@NecroBones](https://forum.kerbalspaceprogram.com/index.php?/profile/105424-necrobones/)\u0027s Modular Rocket Systems (though his Real-Scale Boosters will probably be the same way) -- so there will be a second-to-last pass that will flip the sign of any modified parts which have negative masses.  Since the \u0022most negative\u0022 that a part\u0027s mass could be is if it were massless in the first place, and I\u0027m subtracting less than a stockalike tank\u0027s mass, this means that, at worst, parts in this boat will have better performance than an unmodified stock part, though it\u0027s generally impossible to say by how much.\n\nFinally, much like I tested SMURFF 1.1 with a moon rocket (see **[this post](https://forum.kerbalspaceprogram.com/index.php?/topic/117992-104-5-smurff-simple-mass-adjustments-for-real-ish-fuel-mass-fractions-114-2015-jan-08/\u0026do=findComment\u0026comment=2183298)** for a blueprint, and **[this one](https://forum.kerbalspaceprogram.com/index.php?/topic/117992-104-5-smurff-simple-mass-adjustments-for-real-ish-fuel-mass-fractions-114-2015-jan-08/\u0026do=findComment\u0026comment=2210996)** for the mission album), I just got done with another test for SMURFF 1.2.  Having the lighter command pods helped make the rocket smaller -- the \u0022Uranus V\u0022 only weighs 1640 tons vs. 2470 tons for the Sarnus VII (and the 2970-ton Saturn V and 2750-ton N-1), mostly because it only has four boosters instead of six (which was in turn enabled by the lighter lander and command pod) -- but it\u0027s still a massive beast.  The launch was not without unexpected issues, but the lower stages successfully placed the CSM and LM on a trans-lunar injection, the lunar segment of the mission happened without a hitch, and the reentry was successful the first time -- in fact, Trajectories\u0027s prediction was within ~10 kilometers of where the actual landing occurred, so three cheers for [@Youen](https://forum.kerbalspaceprogram.com/index.php?/profile/116909-youen/)!\n\nSpoiler\n\n![NsWgG5U.png](http://i.imgur.com/NsWgG5U.png)\n\nI promise, it\u0027s shorter than the Sarnus VII -- 56 m vs 78 (vs. 110 for the Saturn V and 105 for the N-1).  Still brakes for nobody, though.\n\nNow, all I need to do is put together a new logo to include the command pod, and I\u0027ll have 1.2 out before too long."},{"CreatedByName":"NecroBones","CreatedById":105424,"CreatedDateTime":"2016-01-24T21:41:11Z","Content":"\u003E \n\u003E \n\u003E 3 hours ago, Kerbas\\_ad\\_astra said:\n\u003E \n\u003E \n\u003E Modular Rocket Systems (though his Real-Scale Boosters will probably be the same way)\n\u003E \n\nYep, just something to keep in mind there. RSB is already starting with realistic mass ratios (to the best numbers I can find by googling for those particular rockets)."},{"CreatedByName":"Kerbas_ad_astra","CreatedById":126593,"CreatedDateTime":"2016-01-25T04:19:27Z","Content":"You\u0027re splitting fuel tanks and engines, right?  If a standard fuel tank has a mass of 1, then a realistic fuel tank has a mass generally around 0.25.  I knock 0.75 off the mass of LFO tanks, so if the RSB tanks start with mass 0.25, they\u0027ll get knocked down to -0.5, and then inverted to 0.5.  Not as good as they should be, but not bad (that\u0027s still a mass ratio of 94% fuel).  Engines will get insane TWRs, but that\u0027s mostly going to be from mass reduction, which doesn\u0027t bother me too much, since most of the mass of a booster is in the tanks (and RSB\u0027s tanks are going to be too heavy).  The 50% boost to thrust will let a Saturn V get away with 4 engines instead of 5, which doesn\u0027t terribly offend me either.\n\nI could define a \u0022ModuleSMURFFExclude\u0022 and not buff any parts with that module (and then apply that module to any parts that start with \u0022RSB\u0022, assuming you name them in a pattern like your other mods), but I\u0027d really rather not take that step -- that starts to get too far into per-mod and per-part tinkering than I think SMURFF should go.\n\nBy the way, thanks for MRS and SpaceY!  I plan to make a stock-parts-only version of the Uranus V (and a couple of smaller lifting rockets) to complement the stock rockets, and I\u0027m certainly going to miss them.  Having to use the lander as a structural element (seriously looking forward to the built-in-struts for interstage fairings coming with 1.1), no fuel-tank nose cones, radial control panels or sepratron-decouplers...shivers me timbers just thinking about it!"},{"CreatedByName":"NathanKell","CreatedById":75006,"CreatedDateTime":"2016-01-25T18:35:10Z","Content":"Probably easier to just check for a value on the part itself, i.e.\n\n@PART[\\*]:HAS[~SMURFFExclude[True],other\\_has\\_checks]:FOR[....\n\nand then in a PART {} you do SMURFFExclude = True\n\nTo avoid logspam, you also do:\n\n@PART[\\*]:FINAL\n\n{\n\n!SMURFFExclude = DEL\n\n}\n\nsince any extra values in a part will trigger logspam on part compile."},{"CreatedByName":"Kerbas_ad_astra","CreatedById":126593,"CreatedDateTime":"2016-01-25T21:33:04Z","Content":"Since tanks are the only parts that have mass subtracted from them (and thus are the only parts at risk of being sent into the negatives), I\u0027ve made a change so that I bookkeep their initial mass and roll back any that get sent below 0.  So, no need to worry about marking fuel tanks or LFBs.\n\nFor engines, I can maybe do an initial pass and filter by TWR, say cut off at 55 to ensure that SpaceY engines get buffed (could even do 50, but that\u0027s cutting it close), but this one is a little trickier.  Since there aren\u0027t many engines that need to be excluded (engines that have realistic performance metrics while burning stock Oxidizer -- zero, by my limited sampling, until RSB is released), there\u0027s an argument to be made that it\u0027s okay to put the burden on the mod maker to mark engines for exclusion, but I\u0027m opposed to burdening other mod makers for the sake of some nobody\u0027s addon which is used by a fraction of a fraction of players.  On the other hand, without any marking, with the TWR cutoff at 55, the RS-68 (since I see the Delta IV is on the docket for RSB) is going to get stupendously buffed.\n\n[@NecroBones](https://forum.kerbalspaceprogram.com/index.php?/profile/105424-necrobones/), your mod is the number-one beneficiary/victim of whatever gets implemented (or doesn\u0027t get implemented, if SMURFF stays as it is) -- thoughts?"},{"CreatedByName":"NecroBones","CreatedById":105424,"CreatedDateTime":"2016-01-25T22:15:51Z","Content":"\u003E \n\u003E \n\u003E 40 minutes ago, Kerbas\\_ad\\_astra said:\n\u003E \n\u003E \n\u003E [@NecroBones](https://forum.kerbalspaceprogram.com/index.php?/profile/105424-necrobones/), your mod is the number-one beneficiary/victim of whatever gets implemented (or doesn\u0027t get implemented, if SMURFF stays as it is) -- thoughts?\n\u003E \n\nI\u0027d say go ahead and add the flag. I\u0027ll be happy to add it to my engines (assuming it doesn\u0027t cause other problems, but I don\u0027t see why it would). Plus, it\u0027ll add lots of flexibility, not just for other modders who want to exclude parts if they notice a problem with the mod interaction, but also for yourself, since you\u0027ll be able to exclude entire mods or specific engines by setting flags yourself before the pass that reduces the mass. Seems pretty win/win to me."},{"CreatedByName":"Kerbas_ad_astra","CreatedById":126593,"CreatedDateTime":"2016-01-25T23:18:05Z","Content":"\u003E \n\u003E \n\u003E 35 minutes ago, NecroBones said:\n\u003E \n\u003E \n\u003E I\u0027d say go ahead and add the flag. I\u0027ll be happy to add it to my engines (assuming it doesn\u0027t cause other problems, but I don\u0027t see why it would). Plus, it\u0027ll add lots of flexibility, not just for other modders who want to exclude parts if they notice a problem with the mod interaction, but also for yourself, since you\u0027ll be able to exclude entire mods or specific engines by setting flags yourself before the pass that reduces the mass. Seems pretty win/win to me.\n\u003E \n\nAlright, I\u0027ll add the flag.  Put \u0022SMURFFExclude = true\u0022 in the part config to exclude a part from getting buffed.  Or \u0022True\u0022, or \u0022supercalifrue\u0022, or anything that ends in \u0022rue\u0022.\n\nIt\u0027s only going to be necessary for engines in your case, but I\u0027ll also make it apply to tanks and pods (and any future buffs I dream up).\n\nRelease coming after the major RL crunch this week!"},{"CreatedByName":"NecroBones","CreatedById":105424,"CreatedDateTime":"2016-01-25T23:31:39Z","Content":"\u003E \n\u003E \n\u003E 12 minutes ago, Kerbas\\_ad\\_astra said:\n\u003E \n\u003E \n\u003E Alright, I\u0027ll add the flag.  Put \u0022SMURFFExclude = true\u0022 in the part config to exclude a part from getting buffed.  Or \u0022True\u0022, or \u0022supercalifrue\u0022, or anything that ends in \u0022rue\u0022.\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E It\u0027s only going to be necessary for engines in your case, but I\u0027ll also make it apply to tanks and pods (and any future buffs I dream up).\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E Release coming after the major RL crunch this week!\n\u003E \n\nOK cool. I\u0027ve added it to all the liquid fuel engines in RSB. I\u0027ll probably put up a 0.2 download link tomorrow."},{"CreatedByName":"Kerbas_ad_astra","CreatedById":126593,"CreatedDateTime":"2016-01-27T16:33:35Z","Content":"**[Version 1.2](https://github.com/Kerbas-ad-astra/SMURFF/releases/tag/v1.2) is released!**\n\n2016 01 27 (1.2): Entry, Descent, and Landing\n\n- Masses of crew containers and heat shields are reduced by half, to permit reduced (and reasonable) capsule ballistic coefficients. Now pods are more likely slow down in time to get their chutes open.\n- Added a \u0022reserved mass\u0022 system so that engines and pods only modify mass which is not accounted for by fuel tanks and batteries.\n- Added a \u0022SMURFFCONFIG\u0022 section -- adjust the \u0022tanklever\u0022, \u0022enginelever\u0022, and \u0022podlever\u0022 variables to control how much of a buff is applied. 1 for real-ish performance (default), 0 to leave stock values alone, and everything in between is in between. Try 0.5 for the likes of 64k or SKY.\n- Changed patches to run FOR[zSMURFF], so that the patches run later. SpaceY\u0027s engines now get properly buffed when Cryogenic Engines is installed. (SpaceY replaces the ModuleEnginesFX modules of some engines in that circumstance, and since SpaceY comes after SMURFF, the thrust buff was being overwritten.)\n- Added a \u0022fix\u0022 for parts whose mass gets sent into the negatives (i.e. any part which weighs less than it \u0022should\u0022 by stockalike standards): their masses get restored to their initial values.\n- Added support for \u0022SMURFFExclude\u0022 -- add \u0022SMURFFExclude = true\u0022 to any part you don\u0027t want to get buffed.\n\nAlso, check out the snazzy new logo:\n\n![SMURFF%20logo.png](https://raw.githubusercontent.com/Kerbas-ad-astra/SMURFF/master/SMURFF%20logo.png)"},{"CreatedByName":"Joco223","CreatedById":92530,"CreatedDateTime":"2016-01-28T17:42:08Z","Content":"Why does Module Manager give me 2 errors when loading SMURFF.cfg? Latest version of MM and SMURFF"},{"CreatedByName":"Kerbas_ad_astra","CreatedById":126593,"CreatedDateTime":"2016-01-28T18:03:08Z","Content":"That must be from a bad interaction with another mod -- what else do you have installed?  I know that I need to make an update to deal with the new version of Cryogenic Engines (in particular, the tanks have changed)."},{"CreatedByName":"Joco223","CreatedById":92530,"CreatedDateTime":"2016-01-28T18:10:11Z","Content":"I have Cryo engines installed. Should I remove them?"},{"CreatedByName":"Kerbas_ad_astra","CreatedById":126593,"CreatedDateTime":"2016-01-28T19:01:37Z","Content":"The error should be harmless, since (if I\u0027m reading Interstellar Fuel Switch\u0027s source code correctly) IFS uses the list of resources to decide how many tanks to make, so there shouldn\u0027t be any problems in flight.  That said I should get a fix out the door sooner rather than later.  (Then I\u0027ll have to get some serious balance work in on the cryo-tanks\u0027 actual contents and mass fractions, because they got reduced in the latest update, so the LH2 tanks are actually a little too light...)"},{"CreatedByName":"Kerbas_ad_astra","CreatedById":126593,"CreatedDateTime":"2016-01-28T19:17:54Z","Content":"Actually, testing it myself just now, I\u0027m not getting any errors from SMURFF and CryoTanks.  (I\u0027ll still have to make an update, but that\u0027s because the variables CryoTanks uses have changed such that SMURFF just isn\u0027t acting on LH2 tanks at all.) Could you give me your log please?"},{"CreatedByName":"Joco223","CreatedById":92530,"CreatedDateTime":"2016-01-28T19:18:17Z","Content":"[@Kerbas_ad_astra](https://forum.kerbalspaceprogram.com/index.php?/profile/126593-kerbas_ad_astra/) The errors are harmless because I tested a few rockets with it and it seems all fine ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif \u0022:)\u0022)"},{"CreatedByName":"Kerbas_ad_astra","CreatedById":126593,"CreatedDateTime":"2016-01-28T19:24:03Z","Content":"\u003E \n\u003E \n\u003E 5 minutes ago, Joco223 said:\n\u003E \n\u003E \n\u003E [@Kerbas_ad_astra](https://forum.kerbalspaceprogram.com/index.php?/profile/126593-kerbas_ad_astra/) The errors are harmless because I tested a few rockets with it and it seems all fine ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif \u0022:)\u0022)\n\u003E \n\nIn case our notifications crossed -- when I tried using CryoEngines myself, I didn\u0027t reproduce any errors like I expected I would.  I\u0027d like to get your log because there\u0027s something else causing trouble."},{"CreatedByName":"Joco223","CreatedById":92530,"CreatedDateTime":"2016-01-28T20:18:43Z","Content":"[@Kerbas_ad_astra](https://forum.kerbalspaceprogram.com/index.php?/profile/126593-kerbas_ad_astra/) I\u0027ll look into it because I have about 20-30 mods"}]}