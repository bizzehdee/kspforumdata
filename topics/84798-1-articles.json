{"TopicId":84798,"ForumId":29,"TopicTitle":"[RESOLVED] Unity animation.Play Problem","CreatedByName":"Apollo13","CreatedById":74572,"CreatedDateTime":"2014-09-17T04:52:38Z","PageNum":1,"Articles":[{"CreatedByName":"Apollo13","CreatedById":74572,"CreatedDateTime":"2014-09-17T04:52:38Z","Content":"\n\u003Cp\u003EUnity\u0027s animation.Play() is not playing my clips. What am I missing?\u003C/p\u003E\u003Cp\u003Ethis is the beginning of a part\u0027s plugin. Click the part, select \u0022Red down\u0022, and the lever rotates down. right-click again, select \u0022Red up\u0022, and the lever rotates up. Or, that\u0027s what is supposed to do.\u003C/p\u003E\u003Cp\u003ECurrently, it does change the command in the context menu. However, the lever does not move.\u003C/p\u003E\u003Cp\u003EI verified in Unity\u0027s preview window that that entire scene does play. I cannot use ModuleAnimateGeneric, because I\u0027ll be using more than a single animation from the Scene animation. This is just a simple example to demonstrate my problem.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Eusing UnityEngine;\u003Cbr\u003E\u003Cbr\u003Enamespace Animate\u003Cbr\u003E{\u003Cbr\u003E    public class Animate : PartModule\u003Cbr\u003E    {\u003Cbr\u003E        private bool redUp = true;\u003Cbr\u003E\u003Cbr\u003E        public override void OnStart(PartModule.StartState state)\u003Cbr\u003E        {\u003Cbr\u003E        }\u003Cbr\u003E\u003Cbr\u003E        [KSPEvent(active = true, guiActive = true, guiActiveEditor = false, guiName = \u0022Red down\u0022)]\u003Cbr\u003E        public void LeverRed()\u003Cbr\u003E        {\u003Cbr\u003E            redUp = !redUp;\u003Cbr\u003E            Events[\u0022LeverRed\u0022].guiName = (redUp ? \u0022Red down\u0022 : \u0022Red up\u0022);\u003Cbr\u003E            if (redUp)\u003Cbr\u003E                animation.Play(\u0022redup\u0022);\u003Cbr\u003E            else\u003Cbr\u003E                animation.Play(\u0022reddown\u0022);\u003Cbr\u003E        }\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E        public override void OnUpdate()\u003Cbr\u003E        {\u003Cbr\u003E            base.OnUpdate();\u003Cbr\u003E        }\u003Cbr\u003E    }\u003Cbr\u003E}\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://i.imgur.com/EQNfvg5.jpg\u0022 alt=\u0022EQNfvg5.jpg\u0022\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-09-18T16:50:05Z\u0022 title=\u002209/18/2014 04:50  PM\u0022 data-short=\u00229 yr\u0022\u003ESeptember 18, 2014\u003C/time\u003E by Apollo13\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"DMagic","CreatedById":57416,"CreatedDateTime":"2014-09-17T05:19:45Z","Content":"\n\u003Cp\u003EYou need to tell Unity what animation it\u0027s supposed to be playing by creating an instance of the animation class.\u003C/p\u003E\u003Cp\u003EIs that lowercase animation in your example supposed to be an instance of Animation? Because those methods aren\u0027t static, so it wouldn\u0027t work or compile otherwise.\u003C/p\u003E\u003Cp\u003EA common way of initializing the Animation instance is something like this:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003EAnimation anim;\u003Cbr\u003E\u003Cbr\u003Eprivate void Start()\u003Cbr\u003E{\u003Cbr\u003E    anim = part.FindModelAnimators(Scene)[0];\u003Cbr\u003E}\u003Cbr\u003E\u003Cbr\u003E[KSPEvent(...)]\u003Cbr\u003Epublic void play()\u003Cbr\u003E{\u003Cbr\u003E    anim.Play(Scene);\u003Cbr\u003E}\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n"},{"CreatedByName":"Apollo13","CreatedById":74572,"CreatedDateTime":"2014-09-17T12:49:27Z","Content":"\n\u003Cp\u003EIt compiles (without errors) and executes. The context menu is displayed. When I click the button, the giuName changes.\u003C/p\u003E\u003Cp\u003EHere is the Unity reference page I used: \u003Ca href=\u0022http://docs.unity3d.com/ScriptReference/Animation.Play.html\u0022 rel=\u0022external nofollow\u0022\u003EAnimation Play method\u003C/a\u003E\u003C/p\u003E\u003Cp\u003Ewhich contains this code example, not requiring instantiation of a class:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Eusing UnityEngine;\u003Cbr\u003Eusing System.Collections;\u003Cbr\u003E\u003Cbr\u003Epublic class ExampleClass : MonoBehaviour {\u003Cbr\u003E    void Example() {\u003Cbr\u003E        animation.Play(\u0022walk\u0022);\u003Cbr\u003E    }\u003Cbr\u003E}\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003ENote that \u0022walk\u0022 is not the entire Scene, but a clip from within.\u003C/p\u003E\u003Cp\u003EI just now looked at Debug Log, and I saw this upon clicking the \u0022Red down\u0022, \u0022Red up\u0022 button:\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003E[Exception]: NullReferenceException: Object reference not set to an instance of an object\u003C/strong\u003E\u003C/p\u003E\u003Cp\u003EHere is my project file. The File contains: \u003Ca href=\u0022https://www.dropbox.com/s/dtg9rgp22xwhsaa/AnimateTest.zip?dl=0\u0022 rel=\u0022external nofollow\u0022\u003Eproject file\u003C/a\u003E\u003C/p\u003E\u003Cp\u003E1) Blender project files, with .blend file, UV map textures, FBX export\u003C/p\u003E\u003Cp\u003E2) Unity project files: Models, Texture\u003C/p\u003E\u003Cp\u003E3) KSP GameData: with MU, MBMs, cfg\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-09-17T13:51:00Z\u0022 title=\u002209/17/2014 01:51  PM\u0022 data-short=\u00229 yr\u0022\u003ESeptember 17, 2014\u003C/time\u003E by Apollo13\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Apollo13","CreatedById":74572,"CreatedDateTime":"2014-09-17T23:16:20Z","Content":"\n\u003Cp\u003EAnybody got any idea what that NulllReferenceexception might be referring to? Or, any other ideas concerning my problem?\u003C/p\u003E\u003Cp\u003Ethanks\u003C/p\u003E\n"},{"CreatedByName":"Greys","CreatedById":57109,"CreatedDateTime":"2014-09-18T02:38:24Z","Content":"\n\u003Cp\u003EI can\u0027t really contribute to the problem at hand, but I recommend you switch to .Blend, .Play doesn\u0027t play nice, only one .Play can be operating on an object at a time, this is why KSP partmodules don\u0027t play well together. .Blend is functionally the same as .Play but it\u0027s totally cool with multiple animations playing at once; it might not matter to what you\u0027re doing, but it\u0027ll make your stuff play well with other people\u0027s stuff, as long as they use .Blend too.\u003C/p\u003E\n"},{"CreatedByName":"Apollo13","CreatedById":74572,"CreatedDateTime":"2014-09-18T03:13:03Z","Content":"\n\u003Cp\u003EI\u0027ll give .Blend a try. thanks\u003C/p\u003E\n"},{"CreatedByName":"philotical","CreatedById":109390,"CreatedDateTime":"2014-09-18T03:31:47Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Apollo13\u0022 data-cite=\u0022Apollo13\u0022\u003E\u003Cdiv\u003EAnybody got any idea what that NulllReferenceexception might be referring to? Or, any other ideas concerning my problem?\u003Cp\u003Ethanks\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003Emy best guess is:\u003C/p\u003E\u003Cp\u003Eyou fall for the unity documentation scam!\u003C/p\u003E\u003Cp\u003Eyou went there and naively thought \u0022Hey example code\u0022 - but naaahhh..\u003C/p\u003E\u003Cp\u003Eit\u0027s just \u0022dummy code\u0022 - or at least not copy paste code..\u003C/p\u003E\u003Cp\u003Ethe example uses a object with the name \u0022animation\u0022 - that is NOT there from it\u0027s own..\u003C/p\u003E\u003Cp\u003E=\u0026gt; null ref\u003C/p\u003E\u003Cp\u003Ethe documentation didn\u0027t mention the fact, that thi code will only work, IF there is an object \u0022animation\u0022..\u003C/p\u003E\u003Cp\u003EThe above code works for me only inside a foreach loop made on every animation in the model and additionally an if-statement to filter the right one by name..\u003C/p\u003E\u003Cp\u003ETo me, that doesn\u0027t seem logic that way - but it\u0027s the only way I got it to work..\u003C/p\u003E\u003Cp\u003Ehth\u003C/p\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2014-09-18T04:40:11Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Apollo13\u0022 data-cite=\u0022Apollo13\u0022\u003E\u003Cdiv\u003EIt compiles (without errors) and executes. The context menu is displayed. When I click the button, the giuName changes.\u003Cp\u003EHere is the Unity reference page I used: \u003Ca href=\u0022http://docs.unity3d.com/ScriptReference/Animation.Play.html\u0022 rel=\u0022external nofollow\u0022\u003EAnimation Play method\u003C/a\u003E\u003C/p\u003E\u003Cp\u003Ewhich contains this code example, not requiring instantiation of a class:\u003C/p\u003E\u003Cp\u003E[snip]\u003C/p\u003E\u003Cp\u003ENote that \u0022walk\u0022 is not the entire Scene, but a clip from within.\u003C/p\u003E\u003Cp\u003EI just now looked at Debug Log, and I saw this upon clicking the \u0022Red down\u0022, \u0022Red up\u0022 button:\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003E[Exception]: NullReferenceException: Object reference not set to an instance of an object\u003C/strong\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EPartModules inherit from \u003Ca href=\u0022http://docs.unity3d.com/ScriptReference/MonoBehaviour.html\u0022 rel=\u0022external nofollow\u0022\u003EMonoBehaviour\u003C/a\u003E which comes with some conveniences, like the member variables \u003Ca href=\u0022http://docs.unity3d.com/ScriptReference/Component-animation.html\u0022 rel=\u0022external nofollow\u0022\u003Eanimation\u003C/a\u003E, \u003Ca href=\u0022http://docs.unity3d.com/ScriptReference/Component-collider.html\u0022 rel=\u0022external nofollow\u0022\u003Ecollider\u003C/a\u003E, \u003Ca href=\u0022http://docs.unity3d.com/ScriptReference/Component-renderer.html\u0022 rel=\u0022external nofollow\u0022\u003Erenderer\u003C/a\u003E, etc. They\u0027re shortcuts for \u003Cem\u003Ecomponents attached to the same GameObject as the script\u003C/em\u003E. The example assumes the simplest case: a user will create a new GO with some kind of animation on it and then attach their script directly to it.\u003C/p\u003E\u003Cp\u003EIf we dump the contents of your Part ingame, you\u0027ll see this:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E[LOG 20:43:11.152] DebugTools, Levers has components:\u003Cbr\u003E[B][LOG 20:43:11.152] DebugTools, ...c: UnityEngine.Transform\u003Cbr\u003E[LOG 20:43:11.153] DebugTools, ...c: Part\u003Cbr\u003E[LOG 20:43:11.154] DebugTools, ...c: Animate.Animate[/B] \u0026lt;------------\u003Cbr\u003E[LOG 20:43:11.154] DebugTools, ---\u0026gt;model has components:\u003Cbr\u003E[LOG 20:43:11.155] DebugTools, ......c: UnityEngine.Transform\u003Cbr\u003E[LOG 20:43:11.155] DebugTools, ------\u0026gt;animate has components:\u003Cbr\u003E[LOG 20:43:11.156] DebugTools, .........c: UnityEngine.Transform\u003Cbr\u003E[LOG 20:43:11.156] DebugTools, .........c: [I][U]UnityEngine.Animation[/U][/I]\u003Cbr\u003E[LOG 20:43:11.157] DebugTools, ---------\u0026gt;Cube has components:\u003Cbr\u003E[LOG 20:43:11.158] DebugTools, ............c: UnityEngine.Transform\u003Cbr\u003E[LOG 20:43:11.158] DebugTools, ............c: UnityEngine.MeshFilter\u003Cbr\u003E[LOG 20:43:11.159] DebugTools, ............c: UnityEngine.MeshRenderer\u003Cbr\u003E[LOG 20:43:11.159] DebugTools, ---------\u0026gt;Cube.001 has components:\u003Cbr\u003E[LOG 20:43:11.160] DebugTools, ............c: UnityEngine.Transform\u003Cbr\u003E[LOG 20:43:11.160] DebugTools, ............c: UnityEngine.MeshFilter\u003Cbr\u003E[LOG 20:43:11.161] DebugTools, ............c: UnityEngine.MeshRenderer\u003Cbr\u003E[LOG 20:43:11.162] DebugTools, ---------\u0026gt;Plane has components:\u003Cbr\u003E[LOG 20:43:11.162] DebugTools, ............c: UnityEngine.Transform\u003Cbr\u003E[LOG 20:43:11.163] DebugTools, ............c: UnityEngine.MeshCollider\u003Cbr\u003E[LOG 20:43:11.163] DebugTools, ............c: UnityEngine.MeshFilter\u003Cbr\u003E[LOG 20:43:11.164] DebugTools, ............c: UnityEngine.MeshRenderer\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EYou can see that PartTools has taken the entire Unity hierarchy and moved it under a GO called \u0022model\u0022. Your script, marked with the arrow, tries to access \u003Cem\u003Eanimation\u003C/em\u003E which returns null because the GameObject called \u0022Levers\u0022 has no Animation component in it. This is where you need to follow DMagic\u0027s advice: when your PartModule starts you need to go find and store a reference to the animation; use that stored reference to play your clips\u003C/p\u003E\n"},{"CreatedByName":"philotical","CreatedById":109390,"CreatedDateTime":"2014-09-18T05:16:27Z","Content":"\n\u003Cp\u003Ethis is actually what I ment - but as allways, if xEvil explains it, it sounds like a valid doc..\u003C/p\u003E\u003Cp\u003Eamazing..\u003C/p\u003E\u003Cp\u003EEinstein said \u0022If you can\u0027t explain it to a child within 2 minutes, you didn\u0027t understand it your selfe\u0022..\u003C/p\u003E\u003Cp\u003Eguilty as charged..\u003C/p\u003E\u003Cp\u003Eback on topic, here\u0027s the code that works for me..\u003C/p\u003E\u003Cp\u003Ethis is called if the radar altitude get\u0027s below 100 and it toggles the landing gears automatically\u003C/p\u003E\u003Cp\u003EI\u0027m sure someone could write this with 20 lines less - but well..\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E        void runLegAnimations()\u003Cbr\u003E        {\u003Cbr\u003E            if (legState == 0)\u003Cbr\u003E            {\u003Cbr\u003E                if (legAction==\u0022down\u0022)\u003Cbr\u003E                {\u003Cbr\u003E                    legState = 1;\u003Cbr\u003E                    foreach (Animation animation in this.vessel.rootPart.FindModelAnimators(\u0022LandingLegsLower\u0022))\u003Cbr\u003E                    {\u003Cbr\u003E                        animation.Rewind();\u003Cbr\u003E                        animation.PlayQueued(\u0022LandingLegsLower\u0022);\u003Cbr\u003E                    }\u003Cbr\u003E                }\u003Cbr\u003E            }\u003Cbr\u003E            else\u003Cbr\u003E            {\u003Cbr\u003E                if (legState == 1)\u003Cbr\u003E                {\u003Cbr\u003E                    if (legAction == \u0022up\u0022)\u003Cbr\u003E                    {\u003Cbr\u003E                        legState = 2;\u003Cbr\u003E                        foreach (Animation animation in this.vessel.rootPart.FindModelAnimators(\u0022LandingLegsRaise\u0022))\u003Cbr\u003E                        {\u003Cbr\u003E                             animation.Rewind();\u003Cbr\u003E                            animation.PlayQueued(\u0022LandingLegsRaise\u0022);\u003Cbr\u003E                          }\u003Cbr\u003E                    }\u003Cbr\u003E                }\u003Cbr\u003E                else\u003Cbr\u003E                {\u003Cbr\u003E                    legState = 0;\u003Cbr\u003E                }\u003Cbr\u003E            }\u003Cbr\u003E        }\u003Cbr\u003E\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003Ehint: if your part is not the root part in any case, modify the code accordingly..\u003C/p\u003E\u003Cp\u003Ehth\u003C/p\u003E\n"},{"CreatedByName":"Apollo13","CreatedById":74572,"CreatedDateTime":"2014-09-18T06:56:44Z","Content":"\n\u003Cp\u003EFolks,\u003C/p\u003E\u003Cp\u003EThanks for those very detailed explanations. I appreciate that you took the time (and with editing, a long time), to draft your responses. Also, every time the game enters a scene, it calls OnStart(). Does that not rewind the animation?\u003C/p\u003E\u003Cp\u003E@xEvilReeperx: how did you get that debug dump?\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-10-16T12:30:30Z\u0022 title=\u002210/16/2014 12:30  PM\u0022 data-short=\u00229 yr\u0022\u003EOctober 16, 2014\u003C/time\u003E by Apollo13\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2014-09-18T07:56:05Z","Content":"\n\u003Cp\u003EIt\u0027s just a little extension I wrote to GameObject, part of a set of handy snippets I share between all projects. It\u0027s not very clean but it does the job\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Epublic delegate void GameObjectVisitor(GameObject go, int indent);\u003Cbr\u003E\u003Cbr\u003Epublic static class DebugExtensions\u003Cbr\u003E{\u003Cbr\u003E    private static void internal_PrintComponents(GameObject go, int indent)\u003Cbr\u003E    {\u003Cbr\u003E        Log.Debug(\u0022{0}{1} has components:\u0022, indent \u0026gt; 0 ? new string(\u0027-\u0027, indent) \u002B \u0022\u0026gt;\u0022 : \u0022\u0022, go.name);\u003Cbr\u003E\u003Cbr\u003E        var components = go.GetComponents\u0026lt;Component\u0026gt;();\u003Cbr\u003E        foreach (var c in components)\u003Cbr\u003E            Log.Debug(\u0022{0}: {1}\u0022, new string(\u0027.\u0027, indent \u002B 3) \u002B \u0022c\u0022, c.GetType().FullName);\u003Cbr\u003E    }\u003Cbr\u003E\u003Cbr\u003E    public static void PrintComponents(this UnityEngine.GameObject go)\u003Cbr\u003E    {\u003Cbr\u003E        go.TraverseHierarchy(internal_PrintComponents);\u003Cbr\u003E    }\u003Cbr\u003E\u003Cbr\u003E    public static void TraverseHierarchy(this UnityEngine.GameObject go, GameObjectVisitor visitor, int indent = 0)\u003Cbr\u003E    {\u003Cbr\u003E        visitor(go, indent);\u003Cbr\u003E\u003Cbr\u003E        for (int i = 0; i \u0026lt; go.transform.childCount; \u002B\u002Bi)\u003Cbr\u003E            go.transform.GetChild(i).gameObject.TraverseHierarchy(visitor, indent \u002B 3);\u003Cbr\u003E    }\u003Cbr\u003E}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EIt comes in handy in all sorts of situations\u003C/p\u003E\n"},{"CreatedByName":"Apollo13","CreatedById":74572,"CreatedDateTime":"2014-09-18T12:15:51Z","Content":"\n\u003Cp\u003EThank you all, again, for your help. I used DMagic\u0027s magic code snippet, and everything works like a bloody charmer. With the code provided by Philotical and the debug dump from xEvilreeper, I\u0027m well on my way.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022philoticol\u0022 data-cite=\u0022philoticol\u0022\u003E\u003Cdiv\u003Emy best guess is:\u003Cp\u003Eyou fall for the unity documentation scam!\u003C/p\u003E\u003Cp\u003Eyou went there and naively thought \u0022Hey example code\u0022 - but naaahhh..\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYep, I fell for that internet scam. Kinda like the time that Nigerian banker promised to send me 5.4 million dollars if i sent him $5,000 to to bribe the Nigerian bank. I\u0027m still waiting.\u003C/p\u003E\u003Cp\u003E@\u003Cstrong\u003ExEvilReeperx\u003C/strong\u003E: thanks for sharing that code. that\u0027s now a part of all my projects.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-09-18T13:24:12Z\u0022 title=\u002209/18/2014 01:24  PM\u0022 data-short=\u00229 yr\u0022\u003ESeptember 18, 2014\u003C/time\u003E by Apollo13\u003C/strong\u003E\n\u003C/span\u003E\n"}]}