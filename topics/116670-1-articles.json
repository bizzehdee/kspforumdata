{"TopicId":116670,"ForumId":29,"TopicTitle":"pdb2mdb bit error in Visual Studio 2015","CreatedByName":"ziporama","CreatedById":97320,"CreatedDateTime":"2015-07-23T16:53:01Z","PageNum":1,"Articles":[{"CreatedByName":"ziporama","CreatedById":97320,"CreatedDateTime":"2015-07-23T16:53:01Z","Content":"\n\u003Cp\u003EI have VS 2015 RTM (released July 20) and also the new Unity tools for Visual Studio 2015 released along with it.\u003C/p\u003E\u003Cp\u003EThe Unity mono tool pdb2mdb fails with a bit error:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003EFatal error : \u003Cbr\u003E1\u0026gt;  Microsoft.Cci.Pdb.PdbDebugException: Unknown custom metadata item kind: 6\u003Cbr\u003E1\u0026gt;    at Microsoft.Cci.Pdb.PdbFunction.ReadCustomMetadata (Microsoft.Cci.Pdb.BitAccess bits) [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003Cbr\u003E1\u0026gt;    at Microsoft.Cci.Pdb.PdbFunction..ctor (System.String module, ManProcSym proc, Microsoft.Cci.Pdb.BitAccess bits) [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003Cbr\u003E1\u0026gt;    at Microsoft.Cci.Pdb.PdbFunction.LoadManagedFunctions (System.String module, Microsoft.Cci.Pdb.BitAccess bits, UInt32 limit, Boolean readStrings) [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003Cbr\u003E1\u0026gt;    at Microsoft.Cci.Pdb.PdbFile.LoadFuncsFromDbiModule (Microsoft.Cci.Pdb.BitAccess bits, Microsoft.Cci.Pdb.DbiModuleInfo info, Microsoft.Cci.Pdb.IntHashTable names, System.Collections.ArrayList funcList, Boolean readStrings, Microsoft.Cci.Pdb.MsfDirectory dir, System.Collections.Generic.Dictionary\u00602 nameIndex, Microsoft.Cci.Pdb.PdbReader reader) [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003Cbr\u003E1\u0026gt;    at Microsoft.Cci.Pdb.PdbFile.LoadFunctions (System.IO.Stream read, Microsoft.Cci.Pdb.BitAccess bits, Boolean readAllStrings) [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003Cbr\u003E1\u0026gt;    at Microsoft.Cci.Pdb.PdbFile.LoadFunctions (System.IO.Stream read, Boolean readAllStrings) [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003Cbr\u003E1\u0026gt;    at Pdb2Mdb.Driver.Convert (Mono.Cecil.AssemblyDefinition assembly, System.IO.Stream pdb, Mono.CompilerServices.SymbolWriter.MonoSymbolWriter mdb) [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EThe rest of it works, the conversion from the pdb output to mdb just fails. \u003C/p\u003E\u003Cp\u003EI tried downloading the current version of Mono (4.0.2 release which has the 4.5 release of pdb2mdb) however this runs into another issue in that the release of Unity 4.x doesn\u0027t work with that (Cecil library dependency is the wrong version).\u003C/p\u003E\u003Cp\u003EUnsure if anyone has run into this and solved it.\u003C/p\u003E\u003Cp\u003EThe same code works fine with Visual Studio 2013 btw so it\u0027s a tool/version issue as far as I can tell. There is a note on the Mono source for pdb2mdb that says there was a problem reading bits dated sometime in May which was fixed, I however conclude that the fix is definitely not in the version of Mono included with Unity 4.6.x - that uses the 4.0 Mono library. Unsure if this has anything to do with the error I\u0027m getting above when running pdb2mdb. I would however think that the 4.5 release of pdb2mdb requires the 4.5 runtime which is fine, however once the mdb file is output, it should work with the 4.0 runtime for the purpose of guiding the debugger. Assumption there of course as I can\u0027t get pdb2mdb 4.5 to work at all right now.\u003C/p\u003E\u003Cp\u003EThanks!\u003C/p\u003E\u003Cp\u003EZ.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-07-23T17:08:18Z\u0022 title=\u002207/23/2015 05:08  PM\u0022 data-short=\u00228 yr\u0022\u003EJuly 23, 2015\u003C/time\u003E by ziporama\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2015-07-23T17:07:01Z","Content":"\n\u003Cp\u003E1) Are you sure you compiled for .NET 3.5 ? \u003C/p\u003E\u003Cp\u003E2) Mono 4.0 drops support for .NET 2.0 and 3.5 so you should keep using 3.8 or earlier\u003C/p\u003E\n"},{"CreatedByName":"ziporama","CreatedById":97320,"CreatedDateTime":"2015-07-23T17:14:59Z","Content":"\n\u003Cp\u003EYes, the output is 3.5 (again, code runs just fine in Unity, it\u0027s just the pdb2mdb tool that bombs so that means debugging is a pain as there is no mdb created from the .NET 3.5 pdb file).\u003C/p\u003E\n"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2015-07-23T18:20:08Z","Content":"\n\u003Cp\u003EStay on VS 2013 then\u003C/p\u003E\n"},{"CreatedByName":"belpyro","CreatedById":120761,"CreatedDateTime":"2015-08-18T16:53:47Z","Content":"\n\u003Cp\u003ETry to install last release of \u003Ca href=\u0022http://www.mono-project.com/download/\u0022 rel=\u0022external nofollow\u0022\u003EMono \u003C/a\u003Eand call \u0022%MONO_PATH%\\bin\\pdb2mdb.bat\u0022 with path to dll as first parameter. It has been resolved this issue for me. Enjoy! ))\u003C/p\u003E\n"},{"CreatedByName":"ziporama","CreatedById":97320,"CreatedDateTime":"2016-05-02T16:16:10Z","Content":"\n\u003Cp\u003E\nMoving ahead to almost a year later, under Unity 5.2.4f1 (for the KSP 1.1 update), the current release of\u00A0Mono 4.5 is compatible with VS2015 so the bit error goes away when compiling under VS2015. \u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nAlas, only to be replaced with the new issue that Unity 5.2.4f1 only goes up to Mono 4.0 and KSP 1.1 requires 5.2.4f1. \u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nSo, when compiling now, pdbtomdb issue is gone, but replaced by a Mono.Cecil version issue (4.x vs 4.5x).\n\u003C/p\u003E\n\u003Cp\u003E\nWill this ever end?\n\u003C/p\u003E\n\u003Cp\u003E\nI guess we\u0027re still using VS2013 4 years later \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-05-02T16:16:56Z\u0022 title=\u002205/02/2016 04:16  PM\u0022 data-short=\u00228 yr\u0022\u003EMay 2, 2016\u003C/time\u003E by ziporama\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2016-05-02T17:35:55Z","Content":"\n\u003Cp\u003E\nYou may want to read the updated version of the debugging post since I lined a version that works. And no, the mono shipped with the game is still .NET 3.5 only (2.0 CLI)\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-05-02T17:36:08Z\u0022 title=\u002205/02/2016 05:36  PM\u0022 data-short=\u00228 yr\u0022\u003EMay 2, 2016\u003C/time\u003E by sarbian\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"ziporama","CreatedById":97320,"CreatedDateTime":"2016-05-03T11:27:22Z","Content":"\n\u003Cp\u003E\n@sarbian Thanks! \u00A0Your\u00A0\u003Ca href=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/102909-ksp-plugin-debugging-and-profiling-for-visual-studio-and-monodevelop-on-all-os/\u0022 rel=\u0022\u0022\u003Einstructions\u003C/a\u003E\u00A0fill\u00A0such a gap for\u00A0what is otherwise a near total vacuum of information - this is great.\n\u003C/p\u003E\n\u003Cp\u003E\nI see your tools zip file contains\u00A0Mono.Cecil 0.9.5\u00A0whereas the version in Unity 5.2.4f1 is 0.9.4. \u00A0 I was able to compile just fine with your version of pdb2mdb and cecil 0.9.5 under\u00A0VS2015. \u00A0Unfortunately, pdb2mdb.exe doesn\u0027t have a file version (0.0.0.0) so i can\u0027t tell the difference outside that it\u0027s a different file size so different file from the one shipped in Unity - I assume this is the current release. \u00A0\u00A0Found some more information here:\u00A0\u003Ca href=\u0022https://gist.github.com/jbevain/ba23149da8369e4a966f\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://gist.github.com/jbevain/ba23149da8369e4a966f\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nIn conclusion, KSP 1.1 plugins\u00A0written in Visual Studio 2015, and specifically, the pdb (debug) files\u00A0can only be converted to Unity debug files (mdb) by Mono.Cecil 0.9.5 and above.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-05-03T11:33:06Z\u0022 title=\u002205/03/2016 11:33  AM\u0022 data-short=\u00228 yr\u0022\u003EMay 3, 2016\u003C/time\u003E by ziporama\u003C/strong\u003E\n\u003Cbr\u003Etypeo\n\u003C/span\u003E\n"}]}