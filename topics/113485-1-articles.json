{"TopicId":113485,"ForumId":29,"TopicTitle":"GUIs: which system to use; best practices?","CreatedByName":"beabop","CreatedById":128715,"CreatedDateTime":"2015-06-20T05:04:05Z","PageNum":1,"Articles":[{"CreatedByName":"beabop","CreatedById":128715,"CreatedDateTime":"2015-06-20T05:04:05Z","Content":"We have a [total clustereffup of three different GUI systems](https://forum.kerbalspaceprogram.com/content/345-KSP-and-Unity-5) in stock, with yet another on its way with the Unity 5 port. Do mods use yet another system at all? Which one do you recommend?\n\nAlso, could we share some best practices for GUIs? Which toolbar do you put your mod\u0027s menu button on and why? What are some anti-patterns and pitfalls that experience modders all know about?"},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2015-06-20T05:15:09Z","Content":"The GUI systems the devs refer to are not really relevant to plugin developers unless trying to edit stock UI elements (which is normally a huge PITA). Creating a completely new UI element goes through the Unity [legacy GUI scripting system](http://docs.unity3d.com/Manual/GUIScriptingGuide.html) which lives in OnGUI, or if you\u0027re feeling really adventurous the new Unity system that Squad are shifting all their GUI to (which isn\u0027t particularly script friendly, although in syaing that, GUI scripting sucks either way). [Tutorial](http://chikkooos.blogspot.jp/2015/03/new-ui-implementation-using-c-scripts.html), and the only [KSP plugin example](https://forum.kerbalspaceprogram.com/threads/120731-1-0-2-DMagic-s-Modlets-Latest-Update-Portrait-Stats-v3-0-6-10-2015) AFAIK is the building shortcut buttons)\n\n**Edited \u003Ctime datetime=\u00222015-06-20T05:18:38Z\u0022 title=\u002206/20/2015 05:18  AM\u0022 data-short=\u00229 yr\u0022\u003EJune 20, 2015\u003C/time\u003E by Crzyrndm**"},{"CreatedByName":"Ser","CreatedById":104207,"CreatedDateTime":"2015-07-01T17:16:49Z","Content":"Did I understood right that OnGUI() mod interfaces will all die on the next release?"},{"CreatedByName":"smjjames","CreatedById":134004,"CreatedDateTime":"2015-07-01T17:22:39Z","Content":"\u003E \n\u003E Did I understood right that OnGUI() mod interfaces will all die on the next release?\n\nThere will probably be an equivalent to replace it, but yes the current OnGUI thing will die because those three systems will be scrapped completely and replaced by a single unified GUI system.\n\nI\u0027m sure they\u0027ll try to make the transition as easy as possible though."},{"CreatedByName":"Ser","CreatedById":104207,"CreatedDateTime":"2015-07-01T17:37:56Z","Content":"And is it possible to start programming GUI in a new way right now for not having to redo all this pain from scratch later? Does KSP support it?"},{"CreatedByName":"smjjames","CreatedById":134004,"CreatedDateTime":"2015-07-01T17:43:51Z","Content":"\u003E \n\u003E And is it possible to start programming GUI in a new way right now for not having to redo all this pain from scratch later? Does KSP support it?\n\nI would think that you\u0027d need to know what SQUAD is replacing the OnGUI module with in order to do that. EVERYTHING is likely to break in 1.1 with Unity 5, even part only mods."},{"CreatedByName":"Ser","CreatedById":104207,"CreatedDateTime":"2015-07-01T17:58:29Z","Content":"Seems that 1.1 release is much like visiting a dentist."},{"CreatedByName":"Nertea","CreatedById":83952,"CreatedDateTime":"2015-07-01T18:06:49Z","Content":"Squad has nothing to do with OnGUI. I\u0027m pretty sure that it would take a lot of work to leave a Unity system out of the finished game. It still exists in U5, though it\u0027s legacy, and I doubt that it will disappear for a Unity version or so.\n\nNow, they might not include their custom libraries like.. EZGUI I think. But I don\u0027t think too many mods use that?"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2015-07-01T19:01:06Z","Content":"For GUI system to use, it\u0027s what you are familiar with. It\u0027s probably worth looking at using the new GUI system if you can though.\n\nHaving said that, I\u0027m staying with onGUI as long as I can simply because (across all my mods) I\u0027m pretty sure I have more then 2000 lines of GUI code and I\u0027m not looking forward to having to redo those.\n\nHowever, on the \u0022which toolbar to use\u0022 question, it\u0027s easy enough to detect the Toolbar mod and use that if present, and if not use the stock toolbar. \n\n[https://github.com/SirDiazo/TWR1/blob/master/TWR1/TWR1.cs#L258-L275](https://github.com/SirDiazo/TWR1/blob/master/TWR1/TWR1.cs#L258-L275) is one of the places I do this.\n\nD."},{"CreatedByName":"Ser","CreatedById":104207,"CreatedDateTime":"2015-07-01T19:27:31Z","Content":"\u003E \n\u003E Now, they might not include their custom libraries like.. EZGUI I think. But I don\u0027t think too many mods use that?\n\nYou hit it ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif) Mine do. Even rely on that."},{"CreatedByName":"DMagic","CreatedById":57416,"CreatedDateTime":"2015-07-01T19:34:41Z","Content":"OnGUI isn\u0027t going anywhere and doesn\u0027t have anything to do with KSP. The most that might be said is that the RenderingManager might not accept legacy Unity GUI Windows anymore, though I doubt it. But in any case you can always just use OnGUI directly and handle hiding/showing your UI manually.\n\nAnd yes KSP can use the new UI system right now. The latest version of KSP (from 1.0 up) uses Unity 4.6, which includes the new UI system. There might be some additional functions added in Unity 5, but the bulk of the change was in 4.6. \n\nThat said, creating a UI that has the standard KSP look would be difficult right now. You would have to create all of the UI assets yourself. Mu said that we would be able to use all of the KSP style assets in the new UI system (the font styling and color, the button images, sliders, etc...) so you might not want to deal with the new system until KSP 1.1 comes out.\n\nWhether you *should* use the new system is mostly a matter of how complex your UI is, and whether it\u0027s meant to be displayed all of the time. \n\nEvery UI element (buttons, labels, sliders, textures, etc...) produces multiple draw calls when using GUILayout, and elements can be drawn even if they are off screen or hidden in a scroll menu (try putting 1000 labels in a scroll menu that only shows 10 at a time, KSP will slow to a crawl). Manually positioning things with GUI can alleviate some of the problems, but it\u0027s a lot of trouble and doesn\u0027t help that much in most cases.\n\nBut if your UI is only really meant as a configuration window, or something not meant to be shown a lot then those performance issues aren\u0027t really a big deal.\n\nSomething like Contracts Window \u002B, which is designed to be shown all of the time and can display a huge number of elements, is something that could really benefit from using a more efficient UI system. Which is why I\u0027ll probably end up spending a lot of time porting it over."},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2015-07-01T20:36:36Z","Content":"DMagic said most of the useful stuff but I want to add this : don\u0027t jump on the new UI wagon too soon. While you convert your whole UI right now you would also miss any helper class that Squad may add for their use (and ours). The Unity New UI is quite verbose to code but other games (City Skylines) made some nice API to lower the amount of code by a **lot**.\n\nSer : your mod use EZGUI to interact with the stock UI. Squad is currently replacing that UI so you would have to redo your mod anyway.\n\n**Edited \u003Ctime datetime=\u00222015-07-01T20:38:55Z\u0022 title=\u002207/01/2015 08:38  PM\u0022 data-short=\u00229 yr\u0022\u003EJuly 1, 2015\u003C/time\u003E by sarbian**"},{"CreatedByName":"Ser","CreatedById":104207,"CreatedDateTime":"2015-07-02T05:36:58Z","Content":"DMagic, I agree with you, the OnGUI method is a kind of a Rect-al way of GUI programming.\n\nsarbian, yes, I\u0027ve already realized that I\u0027ll have to redo, but fortunately I don\u0027t have as much GUI as say SCANsat by the moment.\n\n- - - Updated - - -\n\nHave a qustion, though: seems like in the new version it will be possible to draw GUI by Unity editor and export to use as a prefab. Is that possible for legacy GUI for not to draw it in code?"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2015-07-02T08:44:28Z","Content":"Exporting the UI in an asset bundle may be possible but I don\u0027t know how easy it would be to interact with those once you load them. Since you would may not have your callback available in the Editor it may make things complex, or not ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)"},{"CreatedByName":"Ser","CreatedById":104207,"CreatedDateTime":"2015-07-02T09:15:13Z","Content":"\u003E \n\u003E Exporting the UI in an asset bundle may be possible but I don\u0027t know how easy it would be to interact with those once you load them. Since you would may not have your callback available in the Editor it may make things complex, or not ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\nAs long as we are able to get a component by its name or some known id, it shouldn\u0027t be a problem to add a hook into it, I hope. And it would be wonderful to design your GUI visually and then import it to your assembly instead of trying to guess pixel by pixel.\n\n**Edited \u003Ctime datetime=\u00222015-07-02T09:19:48Z\u0022 title=\u002207/02/2015 09:19  AM\u0022 data-short=\u00229 yr\u0022\u003EJuly 2, 2015\u003C/time\u003E by Ser**"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2015-07-02T09:34:48Z","Content":"I am one of those evil dev that wrote Swing/AWT UI by hands so I am not that afraid ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif) But yeah, it would be nice."},{"CreatedByName":"Ser","CreatedById":104207,"CreatedDateTime":"2015-07-02T11:49:51Z","Content":"sarbian, sounds like \u0022I know what the pain is, I was married... three times...\u0022 ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\nNow you have a great opportunity to code JavaFX GUI by hands instead. Hands are our best tool ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\n**Edited \u003Ctime datetime=\u00222015-07-02T12:05:23Z\u0022 title=\u002207/02/2015 12:05  PM\u0022 data-short=\u00229 yr\u0022\u003EJuly 2, 2015\u003C/time\u003E by Ser**"},{"CreatedByName":"ziporama","CreatedById":97320,"CreatedDateTime":"2015-07-14T15:22:54Z","Content":"I can share my experience:\n\nUnity deprecated the old GUI (onGUI) calls with 4.6.x and IIRC indicated it would be completely gone in 5.x. GUI calls in Unity have very little to do with KSP and the exposed API by Squad, it\u0027s squarely a Unity scope.\n\nI can tell from the last two months in the trenches with the new UI and figuring this out that the new UI is much better thought out than the old GUI and feels almost \u0022normal\u0022 if you\u0027re used to UI development, although it still lacks many of the expected UI objects, so doing a toolbar for example is not in the box, but it can be built. It\u0027s got great flexibility and potential however as you can build just about anything you want from very raw and basic components. If you\u0027re used to .NET components, Unity feels more like the assembly language version and barebones beginnings. \n\nAs was mentioned above, the main problem from the plugin standpoint is that Unity wants you to develop any new UI objects and libraries exclusively from within the Unity editor/designer and not from scripting. As this is not an available mode or option for KSP plugin development.\n\nThere is virtually no documentation from Unity at all on how the new UI works from scripting and this is unfortunately by design. It is clear to me that Unity does not want you to write UI code from scripting at all. This said, you can figure it out by trial and error, which takes an enormous amount of time and can be an exercise in frustration culminating with \u0022so, this is HOW it works!\u0022. The new UI completely work from scripting, however the work is 95% investigating how the various Unity objects \u0022fit\u0022 together, in what order, as well as what to use for API calls. The editor of course knows how to do all this, and you can do all of this inside the editor, however the output is not a script, it\u0027s compiled modules that are designed to be packaged with the game, not at all packaged as an add-on.\n\nWhat I ended up doing is working in the design environment to mock up my UI and making it work (primarily for positioning), then analyze how it does things (so what object is the parent of what, what hidden components get added to make the thing work, and how that impacts the objects, particularly relating to the new rectangle and positioning). The primary issue I ran into is with loading textures at runtime in various resolutions so they show up correctly in the ui (essentially, loading a png into a texture and then into a sprite), and finding what the heck happened with my object positioning relative to one another, as well as stacking (front to back) so that UI elements show up properly. You cannot believe how many times things disappear from the screen just because an anchor is off, or the parenting of an object (or the order of parenting) messes something up with canvas objects and canvas groups. \n\nSo between Unity not wanting you to do UI outside of the editor, and you not able to write KSP modules inside the editor, quite the interesting dilemma this.\n\nSo yes, based on my testing to date, you can indeed use the new UI (available with 4.6.x and above) to do UI items in KSP, be ready for absolutely no help from Unity documentation from a script standpoint (even though it works, as the Unity designer internally does this), and little help from the global Unity user community as they are in the same boat as we are. All references you will find online are mostly all about how to do something in the editor, and at least currently, has next to nothing from the scripting angle although there are a few gems out there.\n\nQuite the challenge this, although it\u0027s also a significant way to learn the ins and outs of Unity under the hood, and at least for me, understand how stuff works using elemental building blocks. The editor does a lot for you - it\u0027s dreadful from scripting and very repetitive too.\n\nMy recommendation: wait until Squad has KSP ported to 5.x, or buy a case of scotch, you will need it.\n\nZ"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2015-07-14T19:26:55Z","Content":"\u003E \n\u003E Unity deprecated the old GUI (onGUI) calls with 4.6.x and IIRC indicated it would be completely gone in 5.x.\n\nPlease give a source for that because I never saw anything like that mentioned anywhere.\n\nAnd the whole Unity UI is [open source](https://bitbucket.org/Unity-Technologies/ui/src). They stated on their forum that they have no problem about scripting the UI but that they won\u0027t add helper call because there are too many case with all the available variables. Other games have a lib that provide some common elements (CS) so I hope KSP will have the same.\n\n**Edited \u003Ctime datetime=\u00222015-07-16T12:34:05Z\u0022 title=\u002207/16/2015 12:34  PM\u0022 data-short=\u00228 yr\u0022\u003EJuly 16, 2015\u003C/time\u003E by sarbian**"},{"CreatedByName":"ziporama","CreatedById":97320,"CreatedDateTime":"2015-07-16T11:15:56Z","Content":"Yes, the new UI source code is available which is great. At the same time, the code is rather poorly commented (no surprise there, it\u0027s like turn signals, I know where I\u0027m going, why use them?), and the documentation is non-existent. Using the new UI from scripting only is a significant spelunking expedition that I think could be alleviated by a little more documentation. While I am confident this will eventually come, the materials available are squarely on the side that this stuff should only be used from within the provided editor, and not from scripting, and that\u0027s fine. The source code is a trove of goodies.\n\nZ."},{"CreatedByName":"Ser","CreatedById":104207,"CreatedDateTime":"2015-07-22T16:36:41Z","Content":"ziporama, Have been nearly excited when I read [this](http://chikkooos.blogspot.jp/2015/03/new-ui-implementation-using-c-scripts.html), a bunch of stuff but at least doable. Now you\u0027ve almost made me cry. I think if that is true then we have two hopes: Squad creates a handy toolkit for creating a KSP GUI or someone creates a software that would be able to export GUI design as xml and than import it to build a view in a runtime. That would be cool."},{"CreatedByName":"ziporama","CreatedById":97320,"CreatedDateTime":"2015-07-23T17:02:47Z","Content":"I have not been able to make Instantiate work inside KSP as the path looks to be all wrong - I get an I/O error with a not found - I think that\u0027s because it\u0027s looking for the prefab in the game package file, not in the standalone plugin folder.\n\nI\u0027ve seen some tools that load the prefab using an async web call using a file::// as the URI instead of the usual http::// - it seemed very convoluted.\n\nAny examples anyone can post loading a prefab inside a KSP plugin would be great (and apologies if it\u0027s blatantly easy to use - I am not there yet and still learning!)\n\nZ."},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2015-07-23T17:08:22Z","Content":"Did you use a Bundle ? If not then it s normal, unity loads its content from its asset files or bundles."},{"CreatedByName":"ziporama","CreatedById":97320,"CreatedDateTime":"2015-07-23T17:13:28Z","Content":"\\*edit\\* I have not tried a bundle. I take it you\u0027re recommending the editor output to a bundle file, then loading the file using Instantiate from within the plugin in the Start() call?\n\nJust tried a bundle: Looks like it requires a Pro version of Unity 4.x to do that (5.x not a problem as that is now a feature of 5.x without the pro license apparently).\n\n...\n\n**Edited \u003Ctime datetime=\u00222015-07-23T17:44:34Z\u0022 title=\u002207/23/2015 05:44  PM\u0022 data-short=\u00228 yr\u0022\u003EJuly 23, 2015\u003C/time\u003E by ziporama**"},{"CreatedByName":"ziporama","CreatedById":97320,"CreatedDateTime":"2015-07-23T17:47:41Z","Content":"So the good answer to this thread seems to be addressed here that I just discovered:\n\n[http://forum.kerbalspaceprogram.com/content/345-KSP-and-Unity-5](https://forum.kerbalspaceprogram.com/content/345-KSP-and-Unity-5)\n\nI\u0027m waiting for the port to 5.x.\n\nZ."}]}