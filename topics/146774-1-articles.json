{"TopicId":146774,"ForumId":69,"TopicTitle":"Bugged Linux CPU usage","CreatedByName":"Tim_p","CreatedById":168222,"CreatedDateTime":"2016-08-29T19:30:12Z","PageNum":1,"Articles":[{"CreatedByName":"Tim_p","CreatedById":168222,"CreatedDateTime":"2016-08-29T19:30:12Z","Content":"\n\u003Cp\u003E\nHello all!\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027m running a clean install of KSP 1.1.3 on Ubuntu 16.04, kernel version 4.4.0. I\u0027ve got dual Xeon E5-2670s, a GTX 1060 6gb and 64gb of ram, so I don\u0027t think my problem is a hardware limitation.\u00A0Any scene with any 3D\u00A0rendering, regardless of graphics settings, (including the kerbals floating in space on the main menu) uses 100% CPU (100% of all 32 cores!) and I\u0027m getting terrible frame rates. I\u0027m getting 10-40fps on different scenes, with terrible stuttering.\n\u003C/p\u003E\n\u003Cp\u003E\nIs there a fix for this unreasonable cpu usage?\n\u003C/p\u003E\n"},{"CreatedByName":"sal_vager","CreatedById":16426,"CreatedDateTime":"2016-08-29T19:39:57Z","Content":"\n\u003Cp\u003E\nHi \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/168222-tim_p/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022168222\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/168222-tim_p/\u0022 rel=\u0022\u0022\u003E@Tim_p\u003C/a\u003E, to offer any sort of fix we\u0027d have to first know what is going wrong here, it\u0027s certainly not normal, I also use Linux and KSP doesn\u0027t use 100% cpu even on my really old PC.\n\u003C/p\u003E\n\u003Cp\u003E\nPlease upload your KSP.log, Player.log and hardinfo report to a site like dropbox.com and I\u0027ll take a look.\n\u003C/p\u003E\n"},{"CreatedByName":"radonek","CreatedById":84077,"CreatedDateTime":"2016-08-30T09:00:17Z","Content":"\n\u003Cp\u003E\n...and output of glxinfo\n\u003C/p\u003E\n"},{"CreatedByName":"Tim_p","CreatedById":168222,"CreatedDateTime":"2016-08-30T16:58:27Z","Content":"\n\u003Cp\u003E\nI\u0027ve linked to\u00A0the requested info on my gdrive:\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://drive.google.com/open?id=0B3g1vpogtsOIa3pVTDJMRllwOG8\u0022 rel=\u0022external nofollow\u0022\u003EPlayer.log\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://drive.google.com/open?id=0B3g1vpogtsOIWmpOWnppb2NjNEU\u0022 rel=\u0022external nofollow\u0022\u003Ehardinfo\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://drive.google.com/open?id=0B3g1vpogtsOIVEdsRUJTWDYxSEk\u0022 rel=\u0022external nofollow\u0022\u003EKSP.log\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://drive.google.com/open?id=0B3g1vpogtsOIN3pJZVc4c19aQzA\u0022 rel=\u0022external nofollow\u0022\u003Eglxinfo\u003C/a\u003E\n\u003C/p\u003E\n"},{"CreatedByName":"sal_vager","CreatedById":16426,"CreatedDateTime":"2016-08-30T22:11:25Z","Content":"\n\u003Cp\u003E\nCan you try KSP without -force-glcore please, it should not be required with Nvidia and the proprietary drivers.\n\u003C/p\u003E\n\u003Cp\u003E\nIt might be why KSP is having trouble setting the resolution as can be seen in the player.log\n\u003C/p\u003E\n\u003Cdiv class=\u0022ipsSpoiler\u0022 data-ipsspoiler=\u0022\u0022\u003E\n\u003Cdiv class=\u0022ipsSpoiler_header\u0022\u003E\n\u003Cspan\u003ESpoiler\u003C/span\u003E\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsSpoiler_contents\u0022\u003E\n\u003Cp\u003E\nChanging real window size to 1920 x 1080\u003Cbr\u003E\nIgnoring window size change to 1920x1080 : waiting for fullscreen at 1920x1080\u003Cbr\u003E\nChanging real window size to 1920 x 1080\u003Cbr\u003E\nChanging real window size to 1920 x 1080\u003Cbr\u003E\nChanging real window size to 1855 x 1056\u003Cbr\u003E\nIgnoring window size change to 1855x1056 : waiting for fullscreen at 1920x1080\u003Cbr\u003E\nChanging real window size to 1855 x 1056\u003Cbr\u003E\nChanging real window size to 1855 x 1056\u003Cbr\u003E\nChanging real window size to 1920 x 1080\u003Cbr\u003E\nIgnoring window size change to 1920x1080 : waiting for fullscreen at 1920x1080\u003Cbr\u003E\nChanging real window size to 1920 x 1080\u003Cbr\u003E\nChanging real window size to 1920 x 1080\u003Cbr\u003E\nChanging real window size to 1920 x 1080\u003Cbr\u003E\nChanging real window size to 1920 x 1080\u003Cbr\u003E\nChanging real window size to 1920 x 1080\u003Cbr\u003E\nMainCanvas MASK: 3458764513820540928\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/div\u003E\n\u003Cp\u003E\nAnd 8 threads for \u003Ca href=\u0022http://www.geomerics.com/enlighten/\u0022 rel=\u0022external nofollow\u0022\u003EEnlighten\u003C/a\u003E.\n\u003C/p\u003E\n\u003Cdiv class=\u0022ipsSpoiler\u0022 data-ipsspoiler=\u0022\u0022\u003E\n\u003Cdiv class=\u0022ipsSpoiler_header\u0022\u003E\n\u003Cspan\u003ESpoiler\u003C/span\u003E\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsSpoiler_contents\u0022\u003E\n\u003Cp\u003E\nSetting up 8 worker threads for Enlighten.\u003Cbr\u003E\n\u00A0 Thread -\u0026gt; id: 7f6d43fff700 -\u0026gt; priority: 1\u003Cbr\u003E\n\u00A0 Thread -\u0026gt; id: 7f6d437fe700 -\u0026gt; priority: 1\u003Cbr\u003E\n\u00A0 Thread -\u0026gt; id: 7f6d3affd700 -\u0026gt; priority: 1\u003Cbr\u003E\n\u00A0 Thread -\u0026gt; id: 7f6d42ffd700 -\u0026gt; priority: 1\u003Cbr\u003E\n\u00A0 Thread -\u0026gt; id: 7f6d427fc700 -\u0026gt; priority: 1\u003Cbr\u003E\n\u00A0 Thread -\u0026gt; id: 7f6d40ff9700 -\u0026gt; priority: 1\u003Cbr\u003E\n\u00A0 Thread -\u0026gt; id: 7f6d417fa700 -\u0026gt; priority: 1\u003Cbr\u003E\n\u00A0 Thread -\u0026gt; id: 7f6d41ffb700 -\u0026gt; priority: 1\u003Cbr\u003E\nrequesting resize 1920 x 1080\u003Cbr\u003E\nrequesting fullscreen 1920 x 1080 at 60 Hz\u003Cbr\u003E\nDesktop is 1920 x 1080 @ 60 Hz\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/div\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"Tim_p","CreatedById":168222,"CreatedDateTime":"2016-08-30T23:59:16Z","Content":"\n\u003Cp\u003E\nMy apologies, I thought I had uploaded a Player.log without cli options.\u00A0\u003Ca href=\u0022https://drive.google.com/open?id=0B3g1vpogtsOIYktaOG9oTHJqdTQ\u0022 rel=\u0022external nofollow\u0022\u003EPlayer.log w/o -force-glcore\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nWithout -force-glcore\u00A0resolution sets without problems/retries,\u00A0while Enlighten still starts 8 threads. The 100% cpu usage issue still occurs.\n\u003C/p\u003E\n"},{"CreatedByName":"sal_vager","CreatedById":16426,"CreatedDateTime":"2016-08-31T10:42:07Z","Content":"\n\u003Cp\u003E\nOkay this is just really strange, I also use Nvidia but I have an AMD A10 apu, I have one enlighten thread and the resolution is set in one action.\n\u003C/p\u003E\n\u003Cp\u003E\nDoes running KSP with -force-gfx-direct improve things for you?\n\u003C/p\u003E\n"},{"CreatedByName":"Tim_p","CreatedById":168222,"CreatedDateTime":"2016-08-31T18:49:18Z","Content":"\n\u003Cp\u003E\nNo luck with that option either. I even tried a fresh install of ubuntu with the graphics card manufacturer\u0027s supported driver (v367.35)--rather than nvidia\u0027s newest driver--with the same results, including the eight threads for Enlighten.\n\u003C/p\u003E\n"},{"CreatedByName":"Tim_p","CreatedById":168222,"CreatedDateTime":"2016-08-31T22:19:27Z","Content":"\n\u003Cp\u003E\nI tested KSP 1.0.5 on the same fresh\u00A0ubuntu install. 1.0.5 works well without any cpu usage issues (though it does seem to have some minor v-sync related quirks). Is 1.0.5 older than the inclusion of Enlighten?\n\u003C/p\u003E\n"},{"CreatedByName":"sal_vager","CreatedById":16426,"CreatedDateTime":"2016-09-01T16:00:11Z","Content":"\n\u003Cp\u003E\nYes, 1.0.5 is made in Unity3D version 4, while 1.1 and newer use Unity3D version 5, Enlighten was \u003Ca href=\u0022https://blogs.unity3d.com/2014/09/18/global-illumination-in-unity-5/\u0022 rel=\u0022external nofollow\u0022\u003Eadded to the Unity3D engine\u003C/a\u003E to provide dynamic lighting and can\u0027t be removed.\n\u003C/p\u003E\n\u003Cp\u003E\nThis might be a driver bug, I have not tried the Nvidia 370.23 driver yet, I\u0027m using 367 from the Ubuntu repository, but am thinking of downgrading because it\u0027s caused the colours to be incorrectly displayed when running Quake 2.\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cstrong\u003E\u003Ca href=\u0022https://imgur.com/a/nEkP3\u0022 rel=\u0022external nofollow\u0022\u003EThis doesn\u0027t happen\u003C/a\u003E\u003C/strong\u003E with nouveau on my GTX650 or the radeonSI driver on my AMD A10\u0027s HD7880.\n\u003C/p\u003E\n"},{"CreatedByName":"Tim_p","CreatedById":168222,"CreatedDateTime":"2016-09-02T01:24:31Z","Content":"\n\u003Cp\u003E\nAfter searching through the Unity forums:\u00A0It seems that this is a known problem on systems with lots of cores--especially dual Xeon systems. Probably a problem\u00A0with the multithreading code in Unity5. It\u00A0affects\u00A0all OSes and many games built on Unity5. So there\u0027s no way to fix it except to wait for the Unity devs to push out a new version with a fix, and from there to wait for the KSP devs to build KSP with that version.\n\u003C/p\u003E\n\u003Cp\u003E\nDo you know if the KSP devs plan to keep up with Unity\u0027s minor version updates?\n\u003C/p\u003E\n"},{"CreatedByName":"sal_vager","CreatedById":16426,"CreatedDateTime":"2016-09-02T09:28:03Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222739011\u0022 data-ipsquote-contentid=\u0022146774\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221472779471\u0022 data-ipsquote-userid=\u0022168222\u0022 data-ipsquote-username=\u0022Tim_p\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n7 hours ago, Tim_p said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents ipsClearfix\u0022\u003E\n\u003Cp\u003E\nAfter searching through the Unity forums:\u00A0It seems that this is a known problem on systems with lots of cores--especially dual Xeon systems. Probably a problem\u00A0with the multithreading code in Unity5. It\u00A0affects\u00A0all OSes and many games built on Unity5. So there\u0027s no way to fix it except to wait for the Unity devs to push out a new version with a fix, and from there to wait for the KSP devs to build KSP with that version.\n\u003C/p\u003E\n\u003Cp\u003E\nDo you know if the KSP devs plan to keep up with Unity\u0027s minor version updates?\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nYou reminded me of something, we used to have to restrict KSP to one or two cores on Phenom cpu\u0027s, Windows users did this in the taskmanager and we can do this using the \u003Cstrong\u003E\u003Ca href=\u0022http://manpages.ubuntu.com/manpages/trusty/man1/taskset.1.html\u0022 rel=\u0022external nofollow\u0022\u003Etaskset\u003C/a\u003E\u003C/strong\u003E command.\n\u003C/p\u003E\n\u003Cp\u003E\nAnd yes, Squad will update Unity during each release cycle, though the actual release may be one or two behind Unity, this may not result in a fix however as the multithreading is handled by \u003Cstrong\u003E\u003Ca href=\u0022https://blogs.unity3d.com/2014/07/08/high-performance-physics-in-unity-5/\u0022 rel=\u0022external nofollow\u0022\u003ENvidia\u0027s PhysX engine built into Unity\u003C/a\u003E\u003C/strong\u003E which is currently on 3.3, so it will rely on Nvidia to provide an update for Unity to fix this.\n\u003C/p\u003E\n"},{"CreatedByName":"Tim_p","CreatedById":168222,"CreatedDateTime":"2016-09-02T19:26:21Z","Content":"\n\u003Cp\u003E\nYeah, already tried taskset. Unfortunately, even limited to running on one core the problem persists, even the eight enlighten threads. I guess even if the scheduler restricts the process to one core, it can still see that there are more cores.\n\u003C/p\u003E\n\u003Cp\u003E\nOther users on other games have reported that disabling cores in the BIOS works, but that\u0027s a pretty messy solution.\n\u003C/p\u003E\n"},{"CreatedByName":"sal_vager","CreatedById":16426,"CreatedDateTime":"2016-09-06T10:22:39Z","Content":"\n\u003Cp\u003E\nDo you have a link to a Unity thread on this \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/168222-tim_p/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022168222\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/168222-tim_p/\u0022 rel=\u0022\u0022\u003E@Tim_p\u003C/a\u003E? I wasn\u0027t able to find one.\n\u003C/p\u003E\n"},{"CreatedByName":"Tim_p","CreatedById":168222,"CreatedDateTime":"2016-09-06T22:16:31Z","Content":"\n\u003Cp\u003E\nThese three threads (all started by the same person) are the most informative I could find:\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022http://forum.unity3d.com/threads/unity-games-consume-100-cpu-on-many-titles.380442/\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://forum.unity3d.com/threads/unity-games-consume-100-cpu-on-many-titles.380442/\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://hardforum.com/threads/xeon-owners-i-need-your-help.1889547/\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://hardforum.com/threads/xeon-owners-i-need-your-help.1889547/\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://community.unity.com/t5/Editor/Unity-games-consume-100-CPU-on-MANY-titles/td-p/2481927\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://community.unity.com/t5/Editor/Unity-games-consume-100-CPU-on-MANY-titles/td-p/2481927\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0Maplesyrupghost seems to be having the same problem I am, and a few volunteers checked their systems and some had similar problems as well.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nEdit: two and a half threads. Two are\u00A0mirrors of each other, but imperfectly synced (one is missing the newest posts), at least when I last accessed them.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-09-06T22:18:33Z\u0022 title=\u002209/06/2016 10:18  PM\u0022 data-short=\u00227 yr\u0022\u003ESeptember 6, 2016\u003C/time\u003E by Tim_p\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"sal_vager","CreatedById":16426,"CreatedDateTime":"2016-09-06T23:34:40Z","Content":"\n\u003Cp\u003E\nInteresting read \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/168222-tim_p/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022168222\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/168222-tim_p/\u0022 id=\u0022ips_uid_5414_6\u0022 rel=\u0022\u0022\u003E@Tim_p\u003C/a\u003E, it\u0027s good news if it\u0027s really fixed in Unity 5.4, you should find that KSP 1.2 doesn\u0027t have this problem.\n\u003C/p\u003E\n"},{"CreatedByName":"Tim_p","CreatedById":168222,"CreatedDateTime":"2016-09-14T01:34:06Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222744908\u0022 data-ipsquote-contentid=\u0022146774\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221473204880\u0022 data-ipsquote-userid=\u002216426\u0022 data-ipsquote-username=\u0022sal_vager\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nOn 06/09/2016 at 5:34 PM, sal_vager said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nInteresting read \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/168222-tim_p/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022168222\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/168222-tim_p/\u0022 rel=\u0022\u0022\u003E@Tim_p\u003C/a\u003E, it\u0027s good news if it\u0027s really fixed in Unity 5.4, you should find that KSP 1.2 doesn\u0027t have this problem.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nI\u0027m very happy to report that this issue does not exist in the prerelease KSP 1.2. Performance for me is excellent\u00A0and cpu usage is\u00A0reasonable.\n\u003C/p\u003E\n"}]}