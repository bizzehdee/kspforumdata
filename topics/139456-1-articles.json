{"TopicId":139456,"ForumId":29,"TopicTitle":"How to trap or know when Gizmo selected in Editor","CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2016-05-10T13:30:54Z","PageNum":1,"Articles":[{"CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2016-05-10T13:30:54Z","Content":"\n\u003Cp\u003E\nSubject says it all. \u00A0Is there any way to do so?\n\u003C/p\u003E\n\u003Cp\u003E\nthanks\n\u003C/p\u003E\n"},{"CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2016-05-11T02:55:18Z","Content":"\n\u003Cp\u003E\nI found the answer: To know if a gizmo is active, use the following:\n\u003C/p\u003E\n\u003Cp\u003E\nif (HighLogic.FindObjectsOfType\u0026lt;EditorGizmos.GizmoOffset\u0026gt; ().Length \u0026gt; 0)\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2016-05-14T23:16:03Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222574359\u0022 data-ipsquote-contentid=\u0022139456\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221462935318\u0022 data-ipsquote-userid=\u0022129964\u0022 data-ipsquote-username=\u0022linuxgurugamer\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nOn 5/11/2016 at 10:55 PM, linuxgurugamer said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nI found the answer: To know if a gizmo is active, use the following:\n\u003C/p\u003E\n\u003Cp\u003E\nif (HighLogic.FindObjectsOfType\u0026lt;EditorGizmos.GizmoOffset\u0026gt; ().Length \u0026gt; 0)\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThis is a very expensive call, especially if called every frame. So I\u0027d like to be able to get a callback whenever either the translate or rotate gizmo is clicked.\n\u003C/p\u003E\n\u003Cp\u003E\nI haven\u0027t found any way yet, anybody have any ideas?\n\u003C/p\u003E\n\u003Cp\u003E\nThanks in advance\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2016-05-15T04:10:52Z","Content":"\n\u003Cp\u003E\nFindObjectsOfType is a just a method Unity exposes, you can cache the result so:\n\u003C/p\u003E\n\u003Cp\u003E\nEditorGizmos.GizmoOffest myGizmo = FindObjectsOfType\u0026lt;EditorGizmos.GizmoOffset\u0026gt;......\n\u003C/p\u003E\n\u003Cp\u003E\nThen just refer to myGizmo instead of using the FindObejctsOfType call again.\n\u003C/p\u003E\n\u003Cp\u003E\nD.\n\u003C/p\u003E\n"},{"CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2016-05-15T04:12:21Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222582569\u0022 data-ipsquote-contentid=\u0022139456\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221463285452\u0022 data-ipsquote-userid=\u002281549\u0022 data-ipsquote-username=\u0022Diazo\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nJust now, Diazo said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nFindObjectsOfType is a just a method Unity exposes, you can cache the result so:\n\u003C/p\u003E\n\u003Cp\u003E\nEditorGizmos.GizmoOffest myGizmo = FindObjectsOfType\u0026lt;EditorGizmos.GizmoOffset\u0026gt;......\n\u003C/p\u003E\n\u003Cp\u003E\nThen just refer to myGizmo instead of using the FindObejctsOfType call again.\n\u003C/p\u003E\n\u003Cp\u003E\nD.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThe problem is that the gizmo object is only there when it\u0027s selected. \u00A0So when you select another gizmo, it goes away and the caching is stale.\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027m already doing that, have managed to reduce the calls a lot, but would like to get rid of them totally.\n\u003C/p\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2016-05-15T05:11:49Z","Content":"\n\u003Cp\u003E\nYou could add a little script to the gizmo prefabs that fires an event when they\u0027re created. You can avoid any FindObjectsOfType calls entirely that way\n\u003C/p\u003E\n"},{"CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2016-05-15T12:09:49Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222582624\u0022 data-ipsquote-contentid=\u0022139456\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221463289109\u0022 data-ipsquote-userid=\u002275857\u0022 data-ipsquote-username=\u0022xEvilReeperx\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n6 hours ago, xEvilReeperx said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nYou could add a little script to the gizmo prefabs that fires an event when they\u0027re created. You can avoid any FindObjectsOfType calls entirely that way\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThat would work.\n\u003C/p\u003E\n\u003Cp\u003E\nHow?\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-05-15T12:10:22Z\u0022 title=\u002205/15/2016 12:10  PM\u0022 data-short=\u00228 yr\u0022\u003EMay 15, 2016\u003C/time\u003E by linuxgurugamer\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2016-05-15T13:50:43Z","Content":"\n\u003Cp\u003E\nSo, would it be something like this (not exactly sure about the names, not at my dev system now):\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003EGizmoOffset ego;\n\nego.AddComponent(\u0022localscriptname\u0022);\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nor this:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003EEditorGizmos.GizmoOffset.Attach(.....)\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-05-15T14:10:05Z\u0022 title=\u002205/15/2016 02:10  PM\u0022 data-short=\u00228 yr\u0022\u003EMay 15, 2016\u003C/time\u003E by linuxgurugamer\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2016-05-15T14:24:41Z","Content":"\n\u003Cp\u003E\nYou essentially have the right idea on the first one. The idea is to add a script onto \u003Cu\u003Eprefab\u003C/u\u003E the game will use for each gizmo so that when the game clones it, your script will get cloned too. Then the usual MonoBehaviour methods will start running which is your chance to fire an event, add the gizmo to a list of opened gizmos, or whatever you want to do with it. Here\u0027s a self-contained example in the style of GameEvents:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode\u0022\u003E\n[KSPAddon(KSPAddon.Startup.EditorAny, true)]\n    class GizmoEvents : MonoBehaviour\n    {\n        public static readonly EventData\u0026lt;GizmoRotate\u0026gt; onRotateGizmoSpawned = new EventData\u0026lt;GizmoRotate\u0026gt;(\u0022onRotateGizmoSpawned\u0022);\n        public static readonly EventData\u0026lt;GizmoOffset\u0026gt; onOffsetGizmoSpawned = new EventData\u0026lt;GizmoOffset\u0026gt;(\u0022onOffsetGizmoSpawned\u0022);\n\n        class GizmoCreationListener : MonoBehaviour\n        {\n            private void Start()\n                // I use Start instead of Awake because whatever setup the editor does to the gizmo won\u0027t be done yet\n            {\n                GizmoRotate rotate = null;\n                GizmoOffset offset = null;\n\n                if (gameObject.GetComponentCached(ref rotate) != null)\n                {\n                    onRotateGizmoSpawned.Fire(rotate);\n                }\n                else if (gameObject.GetComponentCached(ref offset) != null)\n                {\n                    onOffsetGizmoSpawned.Fire(offset);\n                }\n                else Debug.LogError(\u0022Didn\u0027t find a gizmo on this GameObject -- something has broken\u0022);\n\n                // could destroy this MB now, unless you wanted to use OnDestroy to sent an event\n            }\n\n            private void OnDestroy()\n            {\n                // could also send an event on despawn here\n            }\n        }\n\n \n        private void Awake()\n        {\n            AddListenerToGizmo(\u0022RotateGizmo\u0022);\n            AddListenerToGizmo(\u0022OffsetGizmo\u0022);\n\n            Destroy(gameObject);\n        }\n\n\n        private static void AddListenerToGizmo(string prefabName)\n        {\n            var prefab = AssetBase.GetPrefab(prefabName);\n\n            if (prefab == null)\n            {\n                Debug.LogError(\u0022Couldn\u0027t find gizmo \u0027\u0022 \u002B prefabName \u002B \u0022\u0027\u0022);\n                return;\n            }\n\n            prefab.AddOrGetComponent\u0026lt;GizmoCreationListener\u0026gt;();\n\n#if DEBUG\n            Debug.Log(\u0022Added listener to \u0022 \u002B prefabName);\n#endif\n        }\n    }\u003C/pre\u003E\n\u003Cp\u003E\n\u003Cspan\u003E\u003C/span\u003E\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode\u0022\u003E\n    [KSPAddon(KSPAddon.Startup.EditorAny, false)]\n    class TestGizmoEvents : MonoBehaviour\n    {\n        private void Start()\n        {\n            GizmoEvents.onRotateGizmoSpawned.Add(RotateGizmoSpawned);\n            GizmoEvents.onOffsetGizmoSpawned.Add(OffsetGizmoSpawned);\n        }\n\n\n        private void OnDestroy()\n        {\n            GizmoEvents.onRotateGizmoSpawned.Remove(RotateGizmoSpawned);\n            GizmoEvents.onOffsetGizmoSpawned.Remove(OffsetGizmoSpawned);\n        }\n\n\n        private void RotateGizmoSpawned(GizmoRotate data)\n        {\n            print(\u0022Rotate gizmo was spawned\u0022);\n        }\n\n\n        private void OffsetGizmoSpawned(GizmoOffset data)\n        {\n            print(\u0022Offset gizmo was spawned\u0022);\n        }\n    }\u003C/pre\u003E\n\u003Cp\u003E\n\u003Cspan\u003E\u003C/span\u003E\n\u003C/p\u003E\n"},{"CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2016-05-15T22:25:10Z","Content":"\n\u003Cp\u003E\nThis is SO cool!\n\u003C/p\u003E\n\u003Cp\u003E\nThank you very much, I learned a lot, and would not have figured this out myself.\n\u003C/p\u003E\n"},{"CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2016-05-19T13:28:28Z","Content":"\n\u003Cp\u003E\nJust implemented this, works great\n\u003C/p\u003E\n\u003Cp\u003E\nThanks\n\u003C/p\u003E\n"}]}