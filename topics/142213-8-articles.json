{"TopicId":142213,"ForumId":34,"TopicTitle":"PEGAS - Powered Explicit Guidance Ascent System - devlog","CreatedByName":"Reddy","CreatedById":124298,"CreatedDateTime":"2016-06-22T01:03:11Z","PageNum":8,"Articles":[{"CreatedByName":"Kurld","CreatedById":79950,"CreatedDateTime":"2023-01-19T16:09:22Z","Content":"\n\u003Cp\u003E\nOK so I started messing around with a kOSDelegate function to try and keep a constant acceleration.\u00A0 I tried adding the function declaration and an event to call it in the SEQUENCE part of the boot file for the craft, but this just gives me a message about a dead delegate.\u003Cbr\u003E\n\u003Cbr\u003E\nI think I understand why (it\u0027s out of scope after the craft is loaded during boot) but... where do I put the function declaration and the instruction to add it into the sequence?\n\u003C/p\u003E\n"},{"CreatedByName":"Razgriz1","CreatedById":88541,"CreatedDateTime":"2023-01-20T15:47:40Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00224221454\u0022 data-ipsquote-contentid=\u0022142213\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221674133504\u0022 data-ipsquote-userid=\u002279950\u0022 data-ipsquote-username=\u0022Kurld\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nOn 1/19/2023 at 7:05 AM, Kurld said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nWell I messed around with setting up a pitch program this morning.\u00A0 Maybe I don\u0027t really understand \u0022gravity turn\u0022 but in no case have I been able to hand things over to active guidance and not have it pitch up to nearly vertical and reset throttle to 100%.\u00A0 This results in the apo being 600 to 700km on a planned 115 km flight path (remember I am in vanilla KSP.)\u00A0 At the handoff I am somewhere around 60km altitude and nearly horizontal with a predicted APO of about 90km\u00A0 I can\u0027t recall what my velocity was but I\u0027m guessing the algorithm must feel it is much too low to continue on to the planned orbit.\u003Cbr\u003E\n\u003Cbr\u003E\nI also made PEGAS crash.\u00A0 If it gets to the end of the pitch program before handing over, it blows up with another index out of bounds error.\u00A0 I\u0027ll try to make a more full report on github after work.\u003Cbr\u003E\n\u00A0\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nTo be honest, PEGAS isn\u0027t actually particularly well suited for stock KSP, as it can\u0027t do a coast. Stock rockets generally have fairly high \u003Cabbr title=\u0022Thrust-to-weight ratio\u0022\u003ETWR\u003C/abbr\u003E, which when combined with the Earth-like atmospheric density and the relatively low orbital velocity, often makes a coast to apoapsis the best ascent path. The RP-1 wiki actually has a section on MechJeb\u0027s PVG, which is a similar algorithm to PEGAS (though it can incorporate a coast) and it explains a bit why the rocket it doing what it is:\u00A0\u003Ca href=\u0022https://github.com/KSP-RO/RP-0/wiki/TroubleshootingMechJebPVG#my-rocket-is-burning-down-not-a-problem\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/KSP-\u003Cabbr title=\u0022Realism Overhaul (mod)\u0022\u003ERO\u003C/abbr\u003E/RP-0/wiki/TroubleshootingMechJebPVG#my-rocket-is-burning-down-not-a-problem\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nYou could probably fudge it a little bit by either setting a pretty low g-limiter in PEGAS, or actually set the throttle limiter on the engine to a lower value, just don\u0027t forget to tell PEGAS what the maximum limited throttle is.\n\u003C/p\u003E\n"},{"CreatedByName":"Kurld","CreatedById":79950,"CreatedDateTime":"2023-01-21T13:57:34Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00224221867\u0022 data-ipsquote-contentid=\u0022142213\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221674229660\u0022 data-ipsquote-userid=\u002288541\u0022 data-ipsquote-username=\u0022Razgriz1\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n22 hours ago, Razgriz1 said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nThe RP-1 wiki actually has a section on MechJeb\u0027s PVG, which is a similar algorithm to PEGAS (though it can incorporate a coast) and it explains a bit why the rocket it doing what it is:\u00A0\u003Ca href=\u0022https://github.com/KSP-RO/RP-0/wiki/TroubleshootingMechJebPVG#my-rocket-is-burning-down-not-a-problem\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/KSP-\u003Cabbr title=\u0022Realism Overhaul (mod)\u0022\u003E\u003Cabbr title=\u0022Realism Overhaul (mod)\u0022\u003ERO\u003C/abbr\u003E\u003C/abbr\u003E/RP-0/wiki/TroubleshootingMechJebPVG#my-rocket-is-burning-down-not-a-problem\u003C/a\u003E\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThanks, lots of material to digest there.\u003Cbr\u003E\n\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"Reddy","CreatedById":124298,"CreatedDateTime":"2023-02-24T17:33:22Z","Content":"\n\u003Cp\u003E\nSome errors you\u0027ve encountered have been fixed (e.g. the one\u00A0\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/224867-asdasdgf/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022224867\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/224867-asdasdgf/\u0022 rel=\u0022\u0022\u003E@asdasdgf\u003C/a\u003E\u00A0pointed out). If PEGAS behaves weirdly, always check github for the freshest code - I sometimes push fixes which can only be grabbed if you download the code directly (i.e. not as a release). The plan is to fix several outstanding problems and package them as a v1.3.1 in the near future.\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027m aware of the pitch program \u0022issue\u0022 you mention \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/79950-kurld/\u0026amp;do=hovercard\u0022 data-mentionid=\u002279950\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/79950-kurld/\u0022 rel=\u0022\u0022\u003E@Kurld\u003C/a\u003E, but haven\u0027t yed decided whether that\u0027s a bug or a feature (and it should be the user\u0027s job to specify proper control points). Perhaps it would be nicer if the script didn\u0027t crash...\n\u003C/p\u003E\n\u003Cp\u003E\nAs to tuning PEGAS to vanilla atmosphere - I don\u0027t have a clue; haven\u0027t played vanilla in over 6 years, don\u0027t remember how the atmosphere looks. But \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/88541-razgriz1/\u0026amp;do=hovercard\u0022 data-mentionid=\u002288541\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/88541-razgriz1/\u0022 rel=\u0022\u0022\u003E@Razgriz1\u003C/a\u003E\u00A0is right: surprisingly, you will likely have a harder time launching in vanilla than in \u003Cabbr title=\u0022Realism Overhaul (mod)\u0022\u003ERO\u003C/abbr\u003E. The idea to set the engine thrust limiter is good, just remember to change the thrust value in your vehicle configuration accordingly.\n\u003C/p\u003E\n\u003Cp\u003E\nIf you spot any other problems, please do keep updating me via github or this thread (I\u0027ve fixed the email notifications for the forum which I haven\u0027t previously been receiving) \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\n\u003C/p\u003E\n"},{"CreatedByName":"Kurld","CreatedById":79950,"CreatedDateTime":"2023-02-25T01:15:36Z","Content":"\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/124298-reddy/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022124298\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/124298-reddy/\u0022 rel=\u0022\u0022\u003E@Reddy\u003C/a\u003E\u00A0 I wound up punting on the stock-size system and have been playing 2.5x\u00A0 \u00A0Things are a lot more balanced as to performance in that it actually takes most of the big orange tank to get into orbit, etc.\u00A0 I haven\u0027t loaded up kOS or PEGAS yet, as the ascent guidance in \u003Cabbr title=\u0022Mechjeb (mod)\u0022\u003EMJ\u003C/abbr\u003E seems to work well enough there.\u00A0 I do intend to get back to it at some point becuase there is some other stuff I want to try to use kOS to automate, and \u003Cabbr title=\u0022Mechjeb (mod)\u0022\u003EMJ\u003C/abbr\u003E has it\u0027s own set of challenges.\n\u003C/p\u003E\n"},{"CreatedByName":"Reddy","CreatedById":124298,"CreatedDateTime":"2023-02-25T14:46:49Z","Content":"\n\u003Cp\u003E\nI have \u0022fixed\u0022 the pitch program issue. The problem was that PEGAS crashed when altitude exceeded the final keypoint in your pitch program. I say \u0022fix\u0022 not \u003Ci\u003Efix\u003C/i\u003E, because I made it no longer crash in this situation, but emit a critical error instead - your flight will probably still be doomed. You should never allow this situation to happen, and in order to help people understand why, I added \u003Ca href=\u0022https://github.com/Noiredd/PEGAS/blob/9ce1e9a0e54407ae8c2f8bfaa7a215dae101ea26/docs/reference.md#pitchprogram\u0022 rel=\u0022external nofollow\u0022\u003Ethis extra bit of documentation\u003C/a\u003E. Give me a thumb up if this makes sense.\n\u003C/p\u003E\n"},{"CreatedByName":"Kurld","CreatedById":79950,"CreatedDateTime":"2023-02-25T16:18:00Z","Content":"\n\u003Cp\u003E\nIt does. Thanks.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"Reddy","CreatedById":124298,"CreatedDateTime":"2023-02-25T18:35:00Z","Content":"\n\u003Cp\u003E\nGlad to hear that, thanks. Well, that\u0027s one bug swatted off the v1.3.1 list \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\n\u003C/p\u003E\n"},{"CreatedByName":"Jim DiGriz","CreatedById":92465,"CreatedDateTime":"2023-09-28T18:08:37Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00224240196\u0022 data-ipsquote-contentid=\u0022142213\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221677260002\u0022 data-ipsquote-userid=\u0022124298\u0022 data-ipsquote-username=\u0022Reddy\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nOn 2/24/2023 at 9:33 AM, Reddy said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\n\u00A0But \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/88541-razgriz1/\u0026amp;do=hovercard\u0022 data-mentionid=\u002288541\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/88541-razgriz1/\u0022 rel=\u0022\u0022\u003E@Razgriz1\u003C/a\u003E\u00A0is right: surprisingly, you will likely have a harder time launching in vanilla than in \u003Cabbr title=\u0022Realism Overhaul (mod)\u0022\u003E\u003Cabbr title=\u0022Realism Overhaul (mod)\u0022\u003ERO\u003C/abbr\u003E\u003C/abbr\u003E.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nPEG assumes a flat linear gravity model and then tries to correct for that, which works for Earth, but Kerbin is made of some substance that is 1,000x denser than Earth so that a 600km ball has a gravity of 1g, which means that space is more curved, which means PEG doesn\u0027t work as well.\n\u003C/p\u003E\n\u003Cp\u003E\nPlus the delta-V requirements to orbit are lower while the high-\u003Cabbr title=\u0022Thrust-to-weight ratio\u0022\u003ETWR\u003C/abbr\u003E rockets that people build will cause burntimes to hit that delta-V to be much lower which mandates a coast, and the coast needs to be placed somewhat optimally.\n\u003C/p\u003E\n\u003Cp\u003E\nAt some point I want to wrap PVG with a SQP solver that marries a zero-lift gravity turn with PVG on the \u0022top\u0022 for insertion into the orbit, along with supporting a single optimal stage at an arbitrary time (rather than just at stage jettison) which would solve a lot of these problems.\n\u003C/p\u003E\n"},{"CreatedByName":"TrabantDeLuxe","CreatedById":132222,"CreatedDateTime":"2024-02-04T17:38:48Z","Content":"\n\u003Cp\u003E\nHello, hope it isn\u0027t frowned upon to necro this old thread - but I have some questions that I consider relevant.\u003Cbr\u003E\n\u003Cbr\u003E\nSo, in the interest of farming contracts in my JSNQ (2.7x scale) playthrough, I\u0027ve been developing ascent guidance algorithms. I have implemented the guidance algorithm outlined in Teren (1966) with some simplifications (I keep seeing this referred to as Linear Tangent Guidance, but is that the correct name for this scheme?), allowing me to launch into an orbit with specified eccentricity, apsis, and argument of periapse. The yaw control in Teren (1966) however doesn\u0027t allow precise control over the orbital plane and as such I have been working on my own implementation of UPFG. The work outlined in Noiredd\u0027s GitHub has been of great value and my main loop is basically a copy of his work. I did add a method for controlling the argument of periapse:\u003Cbr\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cul\u003E\n\u003Cli\u003E\nAfter establishing the projected burnout position\u00A0\u003Cstrong\u003Er\u003Csub\u003Ep\u003C/sub\u003E\u003C/strong\u003E, we project\u00A0it onto the plane defined by \u003Cstrong\u003Ei\u003Csub\u003Ey\u003C/sub\u003E\u003C/strong\u003E. Basically a vector-exlude.\n\u003C/li\u003E\n\u003Cli\u003E\nWe find the true anomaly of \u003Cstrong\u003Er\u003Csub\u003Ep\u003C/sub\u003E\u003C/strong\u003E. This is done using a vector angle (and sign check!) of a vector pointing towards desired periapse and \u003Cstrong\u003Er\u003Csub\u003Ep\u003C/sub\u003E\u003C/strong\u003E.\u00A0\n\u003C/li\u003E\n\u003Cli\u003E\nThe desired velocity\u00A0and position \u003Cstrong\u003Ev\u003Csub\u003Ed\u003C/sub\u003E\u003C/strong\u003E and \u003Cstrong\u003Er\u003Csub\u003Ed\u003C/sub\u003E\u003C/strong\u003E are then updated, to reflect the desired velocity and position of the desired orbit at burnout conditions.\n\u003C/li\u003E\n\u003C/ul\u003E\n\u003Cp\u003E\nThe cutoff criterion is to watch for the desired magnitude of orbital velocity to be reached.\u003Cbr\u003E\n\u003Cbr\u003E\n\u003Cimg alt=\u0022image.png\u0022 class=\u0022ipsImage\u0022 data-ratio=\u002281.44\u0022 height=\u0022329\u0022 width=\u0022404\u0022 src=\u0022https://i.postimg.cc/VLc41WXT/image.png\u0022\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nGenerally, this works. Injection takes place at the desired altitude, however, I\u0027ve noticed that the radial (vertical) velocity is nearly always off. Is this a \u0027feature\u0027 of UPFG? My implementation of Teren\u0027s algorithm seemed to handle this quite well, even with some gross simplifications in estimates of T-to-go and burnout position (both do converge to correct values near the end of the burn). See attached a screenshot of my console - and note that while most parameters do match the desired values quite closely, the vertical velocity (vr) is off and this causes a slight deviation in apses as well as a 15 degree shift in the argument of periapse.\n\u003C/p\u003E\n"}]}