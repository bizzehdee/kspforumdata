{"TopicId":100505,"ForumId":20,"TopicTitle":"Proximity Sensor For Switching Action Groups","CreatedByName":"Azimech","CreatedById":50750,"CreatedDateTime":"2015-02-23T08:23:50Z","PageNum":1,"Articles":[{"CreatedByName":"Azimech","CreatedById":50750,"CreatedDateTime":"2015-02-23T08:23:50Z","Content":"Want to go down in modding history as the one who brought a whole new dimension of gameplay into KSP? Then think about \n\n**The Proximity Sensor**\n\nWith a proximity sensor you can do at least the following:\n\n- Automatically open and close doors - great for cinematics!\n- Switch lights on and off - again, great for cinematics! Imagine slowly drifting into this gigantic space station ... and the lights switch on down that corridor, one set at a time. Or even disco lights!\n- Play a sound - or even build an instrument that plays a tune!\n- Automatically Fire missiles \u0026 detonate mines\n- Build yourself a dynamic pressure sensor: a plate connected to a spring. If the plate is moved backwards enough due to high dynamic pressure, some engines could be switched off until pressure drops enough and the engines switch on again.\n- Build a crude mechanical computer\n- Create a magneto - the thing that produces a spark at the right time, in the right cylinder, in an old fashioned piston engine.\n- Security doors - they open for some but not for others! Great for multiplayer! You\u0027ve got a ship in orbit and you don\u0027t want it commandeered by a different player? Lock the doors and take the right transmitter with ya!\n- Many more things ... post your ideas!\n\nIdeally such a system would have the following: One part is the sensor, which would have an ID to be set by the user. The other part is a transmitter. They can have a single ID or multiple ID\u0027s, to be set by the user.\n\nThe sensors would have options to \n\n- Activate when coming into range, set between 1 cm and 2.5km\n- De-activate when out of range, set between 1 cm and 2.5km\n- Option to activate not the first but the second time, then reset\n- Option not to deactivate when transmitter goes out of range\n- Set to activate on a single transmitter ID, a group, a range or set to ignore a range\n- Able to interface with action group managers.\n\nThis is an example of needing it badly but not knowing it until it\u0027s there.\n\nWho would love to build it? And post what you would do with such a switch, the more ideas, the greater the chance someone will code it!\n\n**Edited \u003Ctime datetime=\u00222015-02-24T01:53:27Z\u0022 title=\u002202/24/2015 01:53  AM\u0022 data-short=\u00229 yr\u0022\u003EFebruary 24, 2015\u003C/time\u003E by Azimech**"},{"CreatedByName":"hab136","CreatedById":75997,"CreatedDateTime":"2015-02-23T13:41:35Z","Content":"This sounds like it would fit right in with [Smart Parts](https://forum.kerbalspaceprogram.com/threads/64227) (which already has a radio)."},{"CreatedByName":"Azimech","CreatedById":50750,"CreatedDateTime":"2015-02-23T14:06:02Z","Content":"There are some similarities, true. Then again, there are similarities with BD Armory as well. Maybe some code from either is usable."},{"CreatedByName":"Azimech","CreatedById":50750,"CreatedDateTime":"2015-03-08T14:17:59Z","Content":"A friend of mine came up with another use: he wants to use it on his walking robots. This means: able to automate walking without kOS scripts."},{"CreatedByName":"GusTurbo","CreatedById":57552,"CreatedDateTime":"2015-03-16T12:46:23Z","Content":"Great idea. I would love to see something like this. If I had the ability, I would do it myself."},{"CreatedByName":"Yukon0009","CreatedById":109376,"CreatedDateTime":"2015-03-16T12:52:26Z","Content":"Welp, nice idea but I suck at modding- hell, just persistence file editing/CFG changes is annoying."},{"CreatedByName":"Azimech","CreatedById":50750,"CreatedDateTime":"2015-03-16T12:56:15Z","Content":"Oh I can help with config files, if you need help, just yell :-)"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2015-03-16T13:30:03Z","Content":"\u003E \n\u003E Welp, nice idea but I suck at modding- hell, just persistence file editing/CFG changes is annoying.\n\nuh ? How are you doing it ? KSP handle most of the work once you use the proper tools. Post in the[Dev help section](https://forum.kerbalspaceprogram.com/forums/30-Plugin-Development-Help-and-Support) if you have trouble"},{"CreatedByName":"Majorjim!","CreatedById":61954,"CreatedDateTime":"2015-03-16T13:41:47Z","Content":"Hey man, this is a great idea! I can think of a million applications for this but I have no idea how to write code for this..\n\n Try sending a PM to some well known modders, they may be able to help you. \n\nMJ"},{"CreatedByName":"Yukon0009","CreatedById":109376,"CreatedDateTime":"2015-03-16T14:22:13Z","Content":"\u003E \n\u003E uh ? How are you doing it ? KSP handle most of the work once you use the proper tools. Post in the[Dev help section](https://forum.kerbalspaceprogram.com/forums/30-Plugin-Development-Help-and-Support) if you have trouble\n\nI don\u0027t mod, but thanks anyways."},{"CreatedByName":"katateochi","CreatedById":35181,"CreatedDateTime":"2015-03-27T23:24:31Z","Content":"This could be a really cool concept. I like it! \n\nSo is the idea (as I\u0027m understanding it) to have two parts and have the trigger based of the distance between the parts? I could see uses for that, particularly as you\u0027ve said in cinematic filming. But could it work with just a single part? Could the sensor part also work like a laser trip beam so that it could be triggered by the presence of any part, or the ground, or perhaps a hapless Kerbal walking into some horrific automated trap system!?\n\nThe two part idea is really nice for ship-ship interaction. having things like docking port covers open automatically as a ship approaches (and as you say having it so that only ships with the right ID on their transmitter would trigger that). \n\nBut I\u0027d also really like ship-terrain interaction. for things like automatically lowering landing gears when approaching the ground, or sounding a proximity alert sound (I\u0027m thinking of some extra aids to automate things when doing an IVA landing). \n\nAnd if ship-terrain interaction was possible, ship-kerbal interaction would also be very cool (and not just for building Kerbal traps!). For cinematic things like a Kerbal walking along and having doors open automatically or having lights come on.\n\nAnyway I think this is a great idea with some interesting potential to harm kerbals for interesting automation. Unfortunately I have no experience with writing mods for KSP (something I want to remedy)."},{"CreatedByName":"Stone Blue","CreatedById":77721,"CreatedDateTime":"2015-03-28T01:01:35Z","Content":"When docking, (especially manually), I always have to close solar panels, heat radiators, antennas, etc, before getting too close to another ship...My manual docking is sometimes laughable, and MechJeb sometimes likes to freak out and screw up docking...Too many times I have broken off antennas and solar panels with close calls...Also, having lights and docking bays/ports turn on and open would be handy as well..."},{"CreatedByName":"esinohio","CreatedById":57681,"CreatedDateTime":"2015-03-28T12:11:34Z","Content":"\u003E \n\u003E When docking, (especially manually), I always have to close solar panels, heat radiators, antennas, etc, before getting too close to another ship...My manual docking is sometimes laughable, and MechJeb sometimes likes to freak out and screw up docking...Too many times I have broken off antennas and solar panels with close calls...Also, having lights and docking bays/ports turn on and open would be handy as well...\n\nI really liked your last idea there! Of course I can just switch to the other craft and turn everything on... but having it auto turn on via proximity would keep the stream of play a bit better. Help keep the illusion alive I think."},{"CreatedByName":"Azimech","CreatedById":50750,"CreatedDateTime":"2015-03-28T15:28:25Z","Content":"It\u0027s not a two-part solution, the idea is to have a receiver that looks at a whole range of transmitter ID\u0027s. Could even have the following format:\n\nID 1 to 5: when in range activate action group 1 (further notation: #1-5 \u003E \u002BAG1)\n\nID 6: when going out of range, deactivate action group 9 (#6 \u003C -AG9)\n\nNow the rest:\n\n#8 \u003C -AG9, \u003E-AG0\n\n#9 \u003C =AG9, \u003E-AG1 \u003E\u002BAG3\n\n#10-15 ignore\n\n#16 ignore unless #8 is in range, \u003E-AG1 if #9 is out of range\n\netc.\n\nNot only that, it would be fun to have the ability to set certain transmitters to work as receivers as well! \n\nThis way you can ... \n\nAutomate a whole range of machines, even build a guidance system.\n\n**And have a bunch of robots doing a dance.**"},{"CreatedByName":"Mad Rocket Scientist","CreatedById":139256,"CreatedDateTime":"2015-04-23T20:13:24Z","Content":"I hereby show my support for this idea."},{"CreatedByName":"agent_0004","CreatedById":111700,"CreatedDateTime":"2015-04-24T08:08:00Z","Content":"I think i could get this done with Unity\u0027s Ray System. Pretty much the same way BD Armory works, The tricky part for me would be the Kerbal Integration. It might take me a bit to figure out all the different options inside kerbal i.e.(What to look for, how far away. That kinda thing) other than some bumps this should be a pretty smooth ride. PM me if you want me to help.\n\nEDIT: Forgot to mention, this method should not require any parts or planets to be modified. just the prox sensor.\n\n**Edited \u003Ctime datetime=\u00222015-04-24T08:09:39Z\u0022 title=\u002204/24/2015 08:09  AM\u0022 data-short=\u00229 yr\u0022\u003EApril 24, 2015\u003C/time\u003E by agent\\_0004**\n  \nDerp moment"},{"CreatedByName":"z26","CreatedById":91677,"CreatedDateTime":"2015-04-25T22:18:14Z","Content":"This sounds nice, I think the lazor mod already has support to send a ray and mesure how far it gets before colliding. Maybe reverse engineer that? Integrating this with smartparts would be better than making this a standalone mod."},{"CreatedByName":"Azimech","CreatedById":50750,"CreatedDateTime":"2015-04-26T12:07:28Z","Content":"\u003E \n\u003E I think i could get this done with Unity\u0027s Ray System. Pretty much the same way BD Armory works, The tricky part for me would be the Kerbal Integration. It might take me a bit to figure out all the different options inside kerbal i.e.(What to look for, how far away. That kinda thing) other than some bumps this should be a pretty smooth ride. PM me if you want me to help.\n\u003E EDIT: Forgot to mention, this method should not require any parts or planets to be modified. just the prox sensor.\n\nExcellent! I\u0027ll start drawing a schematic on my white board soon.\n\n- - - Updated - - -\n\n\u003E \n\u003E This sounds nice, I think the lazor mod already has support to send a ray and mesure how far it gets before colliding. Maybe reverse engineer that? Integrating this with smartparts would be better than making this a standalone mod.\n\nAs far as we know, development of Smart Parts has halted. I did suggest it to them but got no response and the topic is lying on it\u0027s back."},{"CreatedByName":"agent_0004","CreatedById":111700,"CreatedDateTime":"2015-04-26T22:04:47Z","Content":"I could make the part scripts compatible with Smart Parts if you can find an up to date version of it. before it was compiled\n\n- - - Updated - - -\n\nI can start working on the code for the part when you finish the model."},{"CreatedByName":"Whizzkid","CreatedById":126892,"CreatedDateTime":"2015-05-08T16:12:35Z","Content":"I like this idea! ![:D](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif)"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2015-05-08T17:39:47Z","Content":"As it looks like I\u0027ll probably taking over Smart Parts at this point, I\u0027m interested in looking at seeing the possibilities of this.\n\nThe biggest hurdle is that action groups are one-shot and proximity is an on-going status. I would look at the altimeter part for how to handle that probably.\n\nThe other thing is \u0022Kerbal Integration\u0022 is mentioned earlier, using Smart Parts would not allow a Kerbal on EVA to trigger this as you would need a two Parts to create a distance between them.\n\nThe other-other thing is how to handle multiple sensors. It would probably be limited to only using the closest sensor. (On that channel of course so you can control which sensors activate each other.)\n\nThoughts?\n\nD."},{"CreatedByName":"Firov","CreatedById":57445,"CreatedDateTime":"2015-05-11T16:58:50Z","Content":"\u003E \n\u003E The biggest hurdle is that action groups are one-shot and proximity is an on-going status. I would look at the altimeter part for how to handle that probably.\n\u003E The other-other thing is how to handle multiple sensors. It would probably be limited to only using the closest sensor. (On that channel of course so you can control which sensors activate each other.)\n\nFor those who haven\u0027t noticed yet, this feature has been added as part of the latest SmartParts, starting in v1.6.0. It\u0027s still a bit experimental, but feel free to give it a try and post any feedback. It works with multiple channels out to 2000 meters, and allows triggering actions on approach, departure, or either. Like the altimeter smart part, it\u0027s also able to reset/rearm itself.\n\nIn reference to Diazo\u0027s post above, this was definitely an interesting challenge to create. In the end, it turned into a bit of a hybrid of the altimeter and radio smart parts. Much like the radio, each proximity smart part registers itself to a globally accessible list, which allows easy detection by other proximity alarm parts without having to iterate through all local vessel part lists, which would add potentially crippling overhead for larger vessels (ie space stations). I also use this list to determine the channel the remote proxmity part is operating on. With this info, it\u0027s a relatively simple matter to iterate through the list and find the closest proximity sensor that\u0027s on the same channel as the local part, as well as it\u0027s distance and velocity relative to the local vessel (important for altimeter/trigger logic below).\n\nFrom there, I wanted it to be able to trigger actions on approach, departure, or either, while also allowing the trigger to automatically reset. That last bit is the tricky part because, as Diazo pointed out, proximity to something, be it the ground or another ship, is a constant status. With the part having the ability to reset itself, you could potentially fire the action constantly when the distance conditions are met. \n\nIdeally, you could fire at exactly the specified distance, but in practice, that\u0027s not possible due to floating point errors as well as the fact that KSP only calculates physics at a specific time interval, .02 seconds per frame, in my case. So you would almost certainly never actually hit the exact distance the part is looking for. The solution is to calculate a sliding window that scales based on the relative velocity between the ship and the target (ground or other ship) as well as the current KSP physics calculation time. The faster your ship moves, the larger the sliding window has to be in order to ensure that the action is triggered. \n\nThis window is then used in conjunction with the user configured target distance to establish the endpoints of the window. If the sensor detects that it\u0027s inside of this window, it triggers the action. The next physics frame, it recalculates the window, and upon discovering that it is now outside of the window, resets the smart part so it can be triggered again when it re-enters the calculated window, assuming that auto-reset is enabled. Fortunately, I\u0027d already worked through all of this with my altimeter smart part (after much frustration), so I was able to just copy that logic for the proximity detector with a very minor rework."},{"CreatedByName":"Qigon","CreatedById":141819,"CreatedDateTime":"2015-06-10T23:33:52Z","Content":"\u003E \n\u003E For those who haven\u0027t noticed yet, this feature has been added as part of the latest SmartParts, starting in v1.6.0. It\u0027s still a bit experimental, but feel free to give it a try and post any feedback. It works with multiple channels out to 2000 meters, and allows triggering actions on approach, departure, or either. Like the altimeter smart part, it\u0027s also able to reset/rearm itself.\n\u003E In reference to Diazo\u0027s post above, this was definitely an interesting challenge to create. In the end, it turned into a bit of a hybrid of the altimeter and radio smart parts. Much like the radio, each proximity smart part registers itself to a globally accessible list, which allows easy detection by other proximity alarm parts without having to iterate through all local vessel part lists, which would add potentially crippling overhead for larger vessels (ie space stations). I also use this list to determine the channel the remote proxmity part is operating on. With this info, it\u0027s a relatively simple matter to iterate through the list and find the closest proximity sensor that\u0027s on the same channel as the local part, as well as it\u0027s distance and velocity relative to the local vessel (important for altimeter/trigger logic below).\n\u003E \n\u003E From there, I wanted it to be able to trigger actions on approach, departure, or either, while also allowing the trigger to automatically reset. That last bit is the tricky part because, as Diazo pointed out, proximity to something, be it the ground or another ship, is a constant status. With the part having the ability to reset itself, you could potentially fire the action constantly when the distance conditions are met. \n\u003E \n\u003E Ideally, you could fire at exactly the specified distance, but in practice, that\u0027s not possible due to floating point errors as well as the fact that KSP only calculates physics at a specific time interval, .02 seconds per frame, in my case. So you would almost certainly never actually hit the exact distance the part is looking for. The solution is to calculate a sliding window that scales based on the relative velocity between the ship and the target (ground or other ship) as well as the current KSP physics calculation time. The faster your ship moves, the larger the sliding window has to be in order to ensure that the action is triggered. \n\u003E \n\u003E This window is then used in conjunction with the user configured target distance to establish the endpoints of the window. If the sensor detects that it\u0027s inside of this window, it triggers the action. The next physics frame, it recalculates the window, and upon discovering that it is now outside of the window, resets the smart part so it can be triggered again when it re-enters the calculated window, assuming that auto-reset is enabled. Fortunately, I\u0027d already worked through all of this with my altimeter smart part (after much frustration), so I was able to just copy that logic for the proximity detector with a very minor rework.\n\nVery cool! \n\nIs there a chance to use that to trigger kis explosives? For... reasons...."}]}