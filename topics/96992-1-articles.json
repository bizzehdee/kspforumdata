{"TopicId":96992,"ForumId":36,"TopicTitle":"Tearing my hair out trying to import Class from another DLL and use it","CreatedByName":"marzubus","CreatedById":68021,"CreatedDateTime":"2015-01-17T20:43:07Z","PageNum":1,"Articles":[{"CreatedByName":"marzubus","CreatedById":68021,"CreatedDateTime":"2015-01-17T20:43:07Z","Content":"\n\u003Cp\u003EHi,\u003C/p\u003E\u003Cp\u003ESummary: TypeLoadException: A type load exception has occurred. when I try to instantiate an object from a Dll compiled for .NET 3.5\u003C/p\u003E\u003Cp\u003EI have a simple hello-world style plugin I am trying to load, and then instantiate a instance of a SerialTransport class from CmdMessenger in order to talk to a arduino. Im on MAC. My module and the DLL for CmdMessenger are both built for .NET 3.5. I am copying my main application DLL and the CmdCommand DLL to the plugin dir in KSP\u0027s GameData dir. ( Not sure if I need other DLL\u0027s or not, but trying to copy ALL of them doenst change anything)\u003C/p\u003E\u003Cp\u003EI am using KSPPluginFramework from: \u003Ca href=\u0022https://github.com/TriggerAu/KSPPluginFramework\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/TriggerAu/KSPPluginFramework\u003C/a\u003E \u003C/p\u003E\u003Cp\u003EAnd CmdMessenger for communicating via Serial to the Arduino. \u003C/p\u003E\u003Cp\u003EMy module (PsimaxAerospaceControlSystems ) Source and dependencies is up at \u003Ca href=\u0022https://github.com/unixunion/CmdMessenger\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/unixunion/CmdMessenger\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EThe Problem: \u003C/p\u003E\u003Cp\u003EThe second I try and allocate a new instance of the serial transport class via _serialTransport = new SerialTransport(); the module crashes with\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E[LOG 21:12:03.553] AddonLoader: Instantiating addon \u0027PsimaxAerospace\u0027 from assembly \u0027PsimaxAerospaceControlSystems\u0027\u003Cbr\u003E[LOG 21:12:03.568] 1/17/2015 9:12:03 PM,PsimaxAerospaceControlSystems,PACS is awake\u003Cbr\u003E[EXC 21:12:03.578] TypeLoadException: A type load exception has occurred.\u003Cbr\u003E\tUnityEngine.GameObject:AddComponent()\u003Cbr\u003E\tPsimaxAerospace.PsimaxAerospace:Awake()\u003Cbr\u003E\tUnityEngine.GameObject:AddComponent(Type)\u003Cbr\u003E\tAddonLoader:StartAddon(LoadedAssembly, Type, KSPAddon, Startup)\u003Cbr\u003E\tAddonLoader:StartAddons(Startup)\u003Cbr\u003E\tAddonLoader:OnLevelWasLoaded(Int32)\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EIts strange because it also doesn\u0027t even attempt to print out the Print statement in the line above the instantiation. \u003C/p\u003E\u003Cp\u003EAm I trying to do the impossible or how can I load my Serial Comms DLL into my plugin? \u003C/p\u003E\u003Cp\u003E/Kegan\u003C/p\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2015-01-17T21:32:55Z","Content":"\n\u003Cp\u003EHave a look inside the detailed output/player log. CommandMessenger.dll references System.Diagnostics.Process:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E[LOG 13:22:37.605] AssemblyLoader: Loading assembly at \\Kerbal Space Program\\GameData\\CommandMessenger.dll\u003Cbr\u003E[ERR 13:22:37.653] Failed to load assembly \\Kerbal Space Program\\GameData\\CommandMessenger.dll:\u003Cbr\u003ESystem.Security.SecurityException: Assembly \\Kerbal Space Program\\GameData\\CommandMessenger.dll tried to use forbidden type System.Diagnostics.Process!\u003Cbr\u003EAllows launching of external processes.\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EYou\u0027ll either need to find a way to remove that reference or use an alternative method of loading CommandMessenger.dll\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-01-17T21:45:24Z\u0022 title=\u002201/17/2015 09:45  PM\u0022 data-short=\u00229 yr\u0022\u003EJanuary 17, 2015\u003C/time\u003E by xEvilReeperx\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"marzubus","CreatedById":68021,"CreatedDateTime":"2015-01-17T21:44:51Z","Content":"\n\u003Cp\u003EI have tried to remove those entries but there are some in the upstream dep DLL\u0027s which I cannot remove. I have also tried just doing the simple:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Eusing System.IO.Ports;\u003Cbr\u003Epublic static SerialPort _serialPort;\u003Cbr\u003E_serialPort = new SerialPort(\u0022/dev/tty.usbmodem621\u0022, 115200, Parity.None, 8, StopBits.One);\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EBut then I get a new error:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E[ERR 22:38:44.978] AssemblyLoader: Exception loading \u0027PACS\u0027: System.Reflection.ReflectionTypeLoadException: The classes in the module cannot be loaded.\u003Cbr\u003E  at (wrapper managed-to-native) System.Reflection.Assembly:GetTypes (bool)\u003Cbr\u003E  at System.Reflection.Assembly.GetTypes () [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003Cbr\u003E  at AssemblyLoader.LoadAssemblies () [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003Cbr\u003E\u003Cbr\u003EAdditional information about this exception:\u003Cbr\u003E\u003Cbr\u003E System.TypeLoadException: Could not load type \u0027PACS.PACS\u0027 from assembly \u0027PACS, Version=1.0.5495.40685, Culture=neutral, PublicKeyToken=null\u0027.\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EDo you know if I can somehow push data to my Arduino via USB or Serial? Im building a force-feedback joystick with readouts on it.\u003C/p\u003E\u003Cp\u003E/K\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022xEvilReeperx\u0022 data-cite=\u0022xEvilReeperx\u0022\u003E\u003Cdiv\u003EHave a look inside the detailed output/player log. CommandMessenger.dll references System.Diagnostics.Process:\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E[LOG 13:22:37.605] AssemblyLoader: Loading assembly at \\Kerbal Space Program\\GameData\\CommandMessenger.dll\u003Cbr\u003E[ERR 13:22:37.653] Failed to load assembly \\Kerbal Space Program\\GameData\\CommandMessenger.dll:\u003Cbr\u003ESystem.Security.SecurityException: Assembly \\Kerbal Space Program\\GameData\\CommandMessenger.dll tried to use forbidden type System.Diagnostics.Process!\u003Cbr\u003EAllows launching of external processes.\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EYou\u0027ll either need to remove that reference, do your serial stuff without it or find an alternative method of loading CommandMessenger.dll\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\n"},{"CreatedByName":"Agathorn","CreatedById":99662,"CreatedDateTime":"2015-01-17T21:47:11Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022xEvilReeperx\u0022 data-cite=\u0022xEvilReeperx\u0022\u003E\u003Cdiv\u003EHave a look inside the detailed output/player log. CommandMessenger.dll references System.Diagnostics.Process:\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E[LOG 13:22:37.605] AssemblyLoader: Loading assembly at \\Kerbal Space Program\\GameData\\CommandMessenger.dll\u003Cbr\u003E[ERR 13:22:37.653] Failed to load assembly \\Kerbal Space Program\\GameData\\CommandMessenger.dll:\u003Cbr\u003ESystem.Security.SecurityException: Assembly \\Kerbal Space Program\\GameData\\CommandMessenger.dll tried to use forbidden type System.Diagnostics.Process!\u003Cbr\u003EAllows launching of external processes.\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EYou\u0027ll either need to find a way to remove that reference or use an alternative method of loading CommandMessenger.dll\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EConsidering System.Diagnostic.Process is blacklisted because it could be used to do severe nasty to someones computer from an AddOn, I hope there is no alternative way to load it!\u003C/p\u003E\n"},{"CreatedByName":"marzubus","CreatedById":68021,"CreatedDateTime":"2015-01-17T21:54:31Z","Content":"\n\u003Cp\u003EAny ideas at all on how I can send data to my arduino? Can I do it over USB instead of Serial?\u003C/p\u003E\n"},{"CreatedByName":"Agathorn","CreatedById":99662,"CreatedDateTime":"2015-01-17T22:01:19Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022marzubus\u0022 data-cite=\u0022marzubus\u0022\u003E\u003Cdiv\u003EAny ideas at all on how I can send data to my arduino? Can I do it over USB instead of Serial?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI don\u0027t, as I know nothing about the process, but i\u0027m fairly certain i\u0027ve seen Arduino mods on here before, so there must be a way. Maybe check out how some of the others are doing it?\u003C/p\u003E\n"},{"CreatedByName":"marzubus","CreatedById":68021,"CreatedDateTime":"2015-01-17T22:18:26Z","Content":"\n\u003Cp\u003EIve seen some using a http service of sorts which is updated from Unity / KSP and then another daemon updates the actual arduino. I found one guy who managed to get serial and arduino working but on Windows, and I can\u0027t use windows since I am going to be having more Joystick axis that windows can handle. \u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022https://github.com/zitron-git/KSPSerialIO\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/zitron-git/KSPSerialIO\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EHe used what seems like an arcade serial library and I\u0027ve seen attempts in the forums over the span of a year to get it working on *nix but no luck.\u003C/p\u003E\u003Cp\u003EI was wondering if there is some other more unity approved method of talking with hardware, even perhaps full on PID / HID integration on joystick level? though I have no idea how to write the structs for the HID/PID reports to achieve this.\u003C/p\u003E\u003Cp\u003E/K\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022font-size:8px;\u0022\u003E\u003Cspan style=\u0022color:#C0C0C0;\u0022\u003E- - - Updated - - -\u003C/span\u003E\u003C/span\u003E\u003C/p\u003E\u003Cp\u003EI also found this, but I do not know if it can be loaded up into just any Unity game? \u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022https://www.assetstore.unity3d.com/en/#!/content/6804\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://www.assetstore.unity3d.com/en/#!/content/6804\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EIf it can be that would rock!\u003C/p\u003E\n"},{"CreatedByName":"marzubus","CreatedById":68021,"CreatedDateTime":"2015-01-21T13:27:48Z","Content":"\n\u003Cp\u003EI have managed to put together my own serial library for Mac, Linux and possible Windows too. Its up at: \u003Ca href=\u0022https://github.com/unixunion/PsimaxSerial\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/unixunion/PsimaxSerial\u003C/a\u003E if anyone is interested in pure serial comms from KSP to Arduino ( or other serial devices ). \u003C/p\u003E\u003Cp\u003EI also modded KSPSerialIO to use my library and it works at least for me: \u003Ca href=\u0022https://github.com/unixunion/KSPSerialIO\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/unixunion/KSPSerialIO\u003C/a\u003E\u003C/p\u003E\u003Cp\u003E/K\u003C/p\u003E\n"}]}