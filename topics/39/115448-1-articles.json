{"TopicId":115448,"ForumId":39,"TopicTitle":"Summer KSP controller : Arduino \u002B KSP Serial IO \u002B Joystick","CreatedByName":"Cbrollin","CreatedById":147536,"CreatedDateTime":"2015-07-09T01:20:00Z","PageNum":1,"Articles":[{"CreatedByName":"Cbrollin","CreatedById":147536,"CreatedDateTime":"2015-07-09T01:20:00Z","Content":"So this summer, I and a fellow grad student decided to both work on making a controller for Kerbal Space Program. My controller has all of the main functions working now, so I thought I would post the progress so far.\n\n**Current Progress**\n\n![l6tuzDWl.jpg?1](http://i.imgur.com/l6tuzDWl.jpg?1)\n\n**Credit**\n\nI have [zitronen](https://forum.kerbalspaceprogram.com/members/11850-zitronen) to thank for his excellent plugin and tutorial on the arduino working with KSP. You can find his page [here](https://forum.kerbalspaceprogram.com/threads/66393-Hardware-Plugin-Arduino-based-physical-display-serial-port-io-tutorial-%2817-Dec%29).\n\nI was very much inspired by the [K.E.E.B.](https://forum.kerbalspaceprogram.com/threads/72254-K-E-E-B-I-m-finally-prepared-to-show-my-hardware-mod) controller made by [Luis](https://forum.kerbalspaceprogram.com/members/56597-Luis), and took many of my ideas from his design. \n\nI took a look at [Odysseus](https://forum.kerbalspaceprogram.com/threads/121245-Arduino-KSP_Serial_IO-Odysseus) by [Sputnix](https://forum.kerbalspaceprogram.com/members/145010-Sputnix). It is very clean and an excellent design. I will probably implement some of his design elements in my controller as it progresses. I also liked the form of Sputnix\u0027s forum post, and I am trying to emulate that here.\n\nAlso, thanks to all on the forums for all your wonderful ideas and knowledge, especially in C# and arduino coding.\n\n* * *\n**Functions**\nThe main joystick is just a Saitek ST290 chopped in half. I figured it was easier to use an existing joystick than having to wire it up to the arduino and code it. This handles main flight, rotation, yaw and pitch. This also handles the throttle. It also means this will take up 2 USB ports instead of 1. Thank goodness for powered USB hubs.\n\nThe small center joystick is a work in progress. It is the only thing currently not wired up. It is a small hat switch that will be used for translation movements for docking.\n\nThe 5 red buttons handle SAS, RCS, Lights, gears, and brakes. They are backlit by LEDs and display the current in game status, regardless of the switch position.\n\nThe red arm switch is essentially a stage lock. The yellow staging button is only active when the arm switch is armed.\n\nThe yellow staging button launches and stages the rocket. It blinks similar to the LED on the in game staging panel. It blinks when the rocket is on the launch pad. When in flight it is solid until there are no stages left. When there are no stages left, or the arming switch isnt armed, the light is off.\n\nThe blue switch opens Map View, and is lit up when in Map View.\n\nFinally, the LCD displays information from the game. I currently have it only displaying altitude and velocity. I would like to add a selector switch to change between different information. I would also like to add the functionality to display sci notation with units instead of a very large number.\n\nThe next things I am going to add are a few buttons to switch between staging, docking, and maybe horizontal flight modes. I also need to add a handle for the top of the throttle.\n\n**Parts**\n\n1x Arduino Uno R3\n\n1x Saitek St290\n\n1x old computer case (for the metal)\n\n1x MCP23017 I/O expander - adding another later, [link](http://www.adafruit.com/products/732), [arduino code library](https://github.com/adafruit/Adafruit-MCP23017-Arduino-Library), you can also get them cheaper [here](http://store.cutedigi.com/mcp23017-i2c-16-input-output-port-expander/)\n\n5x Red Latching Illuminated buttons - [link](https://www.amazon.com/Light-Locking-Button-Switch-R16-503/dp/B00ARBVB50/ref=pd_sbs_328_2?ie=UTF8\u0026refRID=13QYM2G1AEQFXEBKRGP0)\n\n1x Toggle switch with Missile cover - [here](https://www.sparkfun.com/products/9278) and [here](https://www.sparkfun.com/products/9276)\n\n1x Yellow momentary illuminated button - [link](http://www.adafruit.com/products/1441)\n\n1x Blue momentary illuminated button - [link](http://www.adafruit.com/products/1477)\n\n1x hat switch - salvaged from another old joystick\n\n1x 16x2 LCD screen\n\n I will add links to these and to the other things that I used\n\n**Edited \u003Ctime datetime=\u00222015-07-09T21:46:40Z\u0022 title=\u002207/09/2015 09:46  PM\u0022 data-short=\u00229 yr\u0022\u003EJuly 9, 2015\u003C/time\u003E by Cbrollin**"},{"CreatedByName":"stibbons","CreatedById":57865,"CreatedDateTime":"2015-07-09T04:44:44Z","Content":"Very nice work. I like how you\u0027re using the indicator LED on the stage button, think I might have to borrow that idea for my controller. ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\nWhat\u0027s the enclosure built from? I\u0027m also curious about how you got the Saitek mounted, just disassemble the original box and screw it in to the panel?"},{"CreatedByName":"Sputnix","CreatedById":141420,"CreatedDateTime":"2015-07-09T07:01:13Z","Content":"Looks like a very neat project! Good start! \n\nI would recommend to anyone that can afford it, to go with a Mega 2560. You run out of pins very quickly (depending on what exactly you want to do - that is).\n\nAlthough, bit-registers are fun to use too ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\n(Clone-Duino\u0027s are quite affordable -- even down under with the distance-tax).\n\n\u003E \n\u003E I took a look at [Odysseus](https://forum.kerbalspaceprogram.com/threads/121245-Arduino-KSP_Serial_IO-Odysseus) by [Sputnix](https://forum.kerbalspaceprogram.com/members/145010-Sputnix). It is very clean and an excellent design. I will probably implement some of his design elements in my controller as it progresses. I also liked the form of Sputnix\u0027s forum post, and I am trying to emulate that here.\n\nAww shucks. Thanks ![:blush:](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_embarrassed.gif)\n\nIf you\u0027re interested in how to do the spoiler tags -- here\u0027s the code (with the content going between the blocks):\n\nJust replace the opening / closing parenthesis ( ) with brackets [ ]\n\n(spoiler=Click to see the full log )\n\n(/spoiler)\n\n**Edited \u003Ctime datetime=\u00222015-07-09T07:05:13Z\u0022 title=\u002207/09/2015 07:05  AM\u0022 data-short=\u00229 yr\u0022\u003EJuly 9, 2015\u003C/time\u003E by Sputnix**"},{"CreatedByName":"Cbrollin","CreatedById":147536,"CreatedDateTime":"2015-07-09T15:17:48Z","Content":"\u003E \n\u003E Very nice work. I like how you\u0027re using the indicator LED on the stage button, think I might have to borrow that idea for my controller. ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\u003E What\u0027s the enclosure built from? I\u0027m also curious about how you got the Saitek mounted, just disassemble the original box and screw it in to the panel?\n\nYeah, I really wanted the staging button to do that. The button was hard to find though. Not many people selling yellow. Got it from [adafruit](http://www.adafruit.com/products/1441).\n\nSo the enclosure is built from the metal sides of an old computer case and some wood. Just what I had laying around. I just had to cut the Saitek in half, and solder some longer wires to the potentiometer for the throttle. \n\nThen I just put some screws straight into the plastic of the controller. I will try to get some pictures of the inside later, though it isnt pretty.\n\n\u003E \n\u003E Looks like a very neat project! Good start! \n\u003E I would recommend to anyone that can afford it, to go with a Mega 2560. You run out of pins very quickly (depending on what exactly you want to do - that is).\n\nYeah. The other student that is also doing a controller got a Due to do his project. A lot more I/O pins. Im kinda jealous. I have limited funds though, with a wife and kid, so I had to work with what I had laying around at first. I already had an Uno, and the MCP23017 chips give me 16 more IO pins per chip at about 3 dollars a chip. So that was cheaper for me.\n\nThe only thing is that I am not sure how the code is gonna look once I add the second IO chip. I am currently using an [MCP library](https://github.com/adafruit/Adafruit-MCP23017-Arduino-Library) from adafruit.\n\nNext time I post some code, I will go for the spoiler look. More clean for sure."},{"CreatedByName":"Sputnix","CreatedById":141420,"CreatedDateTime":"2015-07-10T11:24:21Z","Content":"\u003E \n\u003E Yeah. The other student that is also doing a controller got a Due to do his project. A lot more I/O pins. Im kinda jealous. I have limited funds though, with a wife and kid, so I had to work with what I had laying around at first. I already had an Uno, and the MCP23017 chips give me 16 more IO pins per chip at about 3 dollars a chip. So that was cheaper for me.\n\u003E \n\u003E The only thing is that I am not sure how the code is gonna look once I add the second IO chip. I am currently using an [MCP library](https://github.com/adafruit/Adafruit-MCP23017-Arduino-Library) from adafruit.\n\u003E \n\u003E Next time I post some code, I will go for the spoiler look. More clean for sure.\n\nYou can go back to clean it up ![;)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif)\n\nI completely understand the funding thing. I actually looked into using a bit-shift register (And combining three of them together). In the end I decided to go a simpler route, and because I *just* had enough on the mega, figured I\u0027d save myself a bit of heartache with another level of complexity ![:P](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif)\n\nI\u0027m not completely foreign to electronics (and have more of a programming background) -- but this Arduino thing is a whole new minefield to navigate.\n\nI look forward to seeing your progress ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\nPS - I like your re-purposing of the computer case. I almost went down that route - but I don\u0027t have the necessary metal-work tools to do that."},{"CreatedByName":"Freshmeat","CreatedById":111048,"CreatedDateTime":"2015-07-10T18:49:20Z","Content":"I have gotten nice results using CD4021 shift registers. They are about a dollar apiece on ebay. You might also be able to multiplex your inputs, but I do not know how you IO expander plays along with that."}]}