{"TopicId":103164,"ForumId":39,"TopicTitle":"KAPCOM - Arduino\u002BPython\u002BTelemachus modular hardware controller","CreatedByName":"lawnmowerlatte","CreatedById":112768,"CreatedDateTime":"2015-04-01T19:01:52Z","PageNum":1,"Articles":[{"CreatedByName":"lawnmowerlatte","CreatedById":112768,"CreatedDateTime":"2015-04-01T19:01:52Z","Content":"I don\u0027t usually post on the forums, but I\u0027ve been working on my controller for a while and thought I\u0027d share. I started about a year ago and have been working in bursts when I have time and energy, but it\u0027s finally coming together. Unlike most projects I\u0027ve seen, I\u0027m using PyKSP and Telemachus to send fly by wire and receive telemetry directly from the game rather than using keypresses or KSP Serial IO. The primary reason for this was to accomplish cross platform support since I use both Mac and Linux.\n\nOne of the things I\u0027ve tried to focus on is making this as modular and reusable as possible so other DIYers can use this as a base. Included in this project is an Arduino shield which can be used on a Mega 2560 or Uno to expose GVS (Ground-Vcc-Signal) headers which can be connected up to buttons, switches, etc. without the need for a custom board for each individual project. The Arduino sketch is close to zero configuration, it acts as a dumb hardware controller reading and writing pins based on serial input. The serial input is directed by a Python program which manages the flow of information from Telemachus to Arduino. The Python script is strongly OOP and uses a configuration file to create objects to control the hardware. Anything that Telemachus can read or write is available to have buttons or switches control it. Eventually this configuration file will be generated by an interactive script to make things even easier.\n\nIt\u0027s still a work in progress. I\u0027m currently moving from Proof of Concept to Prototype stage. This means wiring up all my buttons and switches while I\u0027m waiting for my PCBs to arrive and then mounting everything in a bigger shoebox. I\u0027ve ordered 10 in case anyone is interested.\n\nThis is my first project like this and I\u0027ve been learning on the fly, so I\u0027m really excited to see it approaching something useful. It may not look as polished as some of the other projects I\u0027ve seen posted on here, but it\u0027s still very much a work in progress. I\u0027d love some feedback on how I can better make reusing my work easier for someone without an electronics/programming background.\n\n\u003E [Javascript is disabled. View full album](//imgur.com/a/gaUa1)\n\n[KAPCOM on Hackaday](https://hackaday.io/project/3723-kapcom)\n\n[KAPCOM on GitHub](https://github.com/lawnmowerlatte/KAPCOM)\n\n[KAPCOM on imgur](http://imgur.com/a/gaUa1)\n\n\u003Ciframe width=\u0022480\u0022 height=\u0022270\u0022 src=\u0022https://www.youtube.com/embed/videoseries?list=PLcpVGk2nlVJtqhojDHBkW2NuxhSqCbz5_\u0022 frameborder=\u00220\u0022 allowfullscreen=\u0022true\u0022\u003E\u003C/iframe\u003E\n\nFull Demonstration:\n\n\u003Ciframe width=\u0022480\u0022 height=\u0022270\u0022 src=\u0022https://www.youtube.com/embed/8netBhx9yzQ?feature=oembed\u0022 frameborder=\u00220\u0022 allowfullscreen=\u0022true\u0022\u003E\u003C/iframe\u003E\n\nGetting Started:\n\n\u003Ciframe width=\u0022480\u0022 height=\u0022270\u0022 src=\u0022https://www.youtube.com/embed/hdV6y_QB6h0?feature=oembed\u0022 frameborder=\u00220\u0022 allowfullscreen=\u0022true\u0022\u003E\u003C/iframe\u003E\n\n**Edited \u003Ctime datetime=\u00222015-04-30T20:47:51Z\u0022 title=\u002204/30/2015 08:47  PM\u0022 data-short=\u00229 yr\u0022\u003EApril 30, 2015\u003C/time\u003E by lawnmowerlatte**\n  \nAdded more links"},{"CreatedByName":"Climberfx","CreatedById":57126,"CreatedDateTime":"2015-04-01T19:43:02Z","Content":"Wow man. Is that all functional for KSP? WOW!"},{"CreatedByName":"lawnmowerlatte","CreatedById":112768,"CreatedDateTime":"2015-04-01T20:12:52Z","Content":"\u003E \n\u003E Wow man. Is that all functional for KSP? WOW!\n\nTo varying degrees. The joysticks work (except for 1 axis, there\u0027s a bad trace on the protoboard) and the buttons and displays are drivable from Python, but I haven\u0027t tested it with data from Telemachus yet. I had everything working about 3 months ago, but it was all written for the Arduino and I was using too much RAM when I added all of the devices together. I ended up scrapping/rewriting it all into Python. It\u0027s actually more functional now in some ways (it\u0027s more configurable, easier to work with and debug), but still a bit rough around the edges."},{"CreatedByName":"T.A.P.O.R.","CreatedById":137748,"CreatedDateTime":"2015-04-09T09:53:43Z","Content":"I\u0027d seen examples of other folks using Telemachus, but could\u0027t make it work.\n\nGlad somebody can figure it out and share ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\nWhere\u0027d you get the green 7 segs?"},{"CreatedByName":"lawnmowerlatte","CreatedById":112768,"CreatedDateTime":"2015-04-09T13:58:53Z","Content":"I\u0027m actually using [602p\u0027s pyksp module](https://github.com/602p/pyksp) (with a few minor changes; I really have to send a pull request one of these days) to do the Telemachus interaction. My code basically binds the Arduino pin to an API call and defines specific behaviors for easily dealing with buttons, indicators, joysticks, displays, etc. I\u0027m planning on making a video once I get my PCBs delivered and assembled, hopefully this weekend.\n\nThe green 7-segments come from a seller on [Tindie](https://www.tindie.com/products/rajbex/spi7segdisp856-kit-eight-digit-serial-spi-seven-segment-led-display-blue/). However, he\u0027s out of stock of the green ones at the moment. I actually was going to buy another, but he told me he is still waiting on his order of displays."},{"CreatedByName":"lawnmowerlatte","CreatedById":112768,"CreatedDateTime":"2015-04-18T06:05:26Z","Content":"I just got the PCBs in from [Seeed Studio Fusion](http://www.seeedstudio.com/service/)! I attached all the headers and it\u0027s ready for testing. I think I should have a video ready to show by the end of the weekend.\n\n[![Zl8GGiL.jpg](http://i.imgur.com/Zl8GGiL.jpg)](http://imgur.com/a/gaUa1#24)"},{"CreatedByName":"T.A.P.O.R.","CreatedById":137748,"CreatedDateTime":"2015-04-19T08:24:10Z","Content":"Self designed PCB? \n\nNice!"},{"CreatedByName":"lawnmowerlatte","CreatedById":112768,"CreatedDateTime":"2015-04-21T05:46:40Z","Content":"Thanks! I designed it with Fritzing.\n\nJust posted a video overview of my project. The audio came out bad in some spots, so I might re-do it at some point. Either that or I\u0027ll caption it.\n\n\u003Ciframe width=\u0022480\u0022 height=\u0022270\u0022 src=\u0022https://www.youtube.com/embed/8netBhx9yzQ?feature=oembed\u0022 frameborder=\u00220\u0022 allowfullscreen=\u0022true\u0022\u003E\u003C/iframe\u003E\n\n**Edited \u003Ctime datetime=\u00222015-04-21T06:22:27Z\u0022 title=\u002204/21/2015 06:22  AM\u0022 data-short=\u00229 yr\u0022\u003EApril 21, 2015\u003C/time\u003E by lawnmowerlatte**"},{"CreatedByName":"stibbons","CreatedById":57865,"CreatedDateTime":"2015-04-21T06:06:03Z","Content":"Video still isn\u0027t loading for me. ![:(](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_sad.gif) Still uploading? typo in the link?"},{"CreatedByName":"lawnmowerlatte","CreatedById":112768,"CreatedDateTime":"2015-04-21T06:23:16Z","Content":"Fixed it. For some reason, the editor kept adding COLOR tags in my YouTube code."},{"CreatedByName":"lawnmowerlatte","CreatedById":112768,"CreatedDateTime":"2015-04-30T19:56:35Z","Content":"I just posted a series of videos showing how to get started with your hardware controller using KAPCOM software. I cover software prerequisites, loading the Arduino sketch, connecting via serial, using the included Python modules, setting up a configuration file and finally connecting to Kerbal Space Program and launching a rocket. I hope this is helpful!\n\n\u003Ciframe width=\u0022480\u0022 height=\u0022270\u0022 src=\u0022https://www.youtube.com/embed/hdV6y_QB6h0?feature=oembed\u0022 frameborder=\u00220\u0022 allowfullscreen=\u0022true\u0022\u003E\u003C/iframe\u003E"},{"CreatedByName":"Freshmeat","CreatedById":111048,"CreatedDateTime":"2015-05-02T20:10:00Z","Content":"That is a very neat setup you have there. Props to you."},{"CreatedByName":"lawnmowerlatte","CreatedById":112768,"CreatedDateTime":"2015-05-02T23:17:29Z","Content":"Thanks! I\u0027m trying to keep it modular and easily configurable so others can use it as a basis."},{"CreatedByName":"Sputnix","CreatedById":141420,"CreatedDateTime":"2015-05-15T08:09:12Z","Content":"Kudos on going down a completely different route. ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\nI know some python - not much - so I think it\u0027s brave to go down a path that [comparatively] has little support.\n\nDo you have any plans / vision for the final controller layout / enclosure?\n\n**Edited \u003Ctime datetime=\u00222015-05-15T08:24:32Z\u0022 title=\u002205/15/2015 08:24  AM\u0022 data-short=\u00229 yr\u0022\u003EMay 15, 2015\u003C/time\u003E by Sputnix**\n  \nleft out some grammar xD"},{"CreatedByName":"lawnmowerlatte","CreatedById":112768,"CreatedDateTime":"2015-05-15T14:00:47Z","Content":"Thanks! I don\u0027t know if I\u0027d call it brave, so much as stubborn. At the time I started working, there were no cross-platform options available other than Telemachus. I knew I wanted to support Linux and Mac primarily, so I just ran with it. Despite major overhauls of how my code worked, I never switched for another mod. In retrospect, I\u0027m glad I went this way; it is more flexible since it can be run on a remote machine. I\u0027m going to set mine up on a Raspberry Pi so I can play on my TV wirelessly.\n\nI do have a plan for an enclosure, but at this stage it\u0027s just a 3D model. Eventually I\u0027ll get around to mounting it all, but it hasn\u0027t been a priority. However, my shoebox is showing signs of strain, so I think I\u0027ll be working on this sooner rather than later."},{"CreatedByName":"Benji","CreatedById":116398,"CreatedDateTime":"2016-02-16T06:42:48Z","Content":"It\u0027s a while since the last post/edit.\n\nIs it still working with the current version of telemachus and ksp?"},{"CreatedByName":"Benji","CreatedById":116398,"CreatedDateTime":"2016-02-18T18:46:26Z","Content":"Hi.\n\nThanks for this great mod. I\u0027m very thrilled by the capabilities and the easy configuration, but stumbled over some obstacles.\n\nThe Arduino Mega 2560 has 54 digital pins, so I thought Pin 54 has to be A0. I found it at 160. Seems odd, but who really cares?\n\nThanks again.\n\nI have an 3.2\u0022 LCDisplay connected.\n\nCan you give me a hint on how to display information on that.\n\n~~I managed to get everything working until Video Part3 2:18. There you lost me.~~\n\n~~In my little test-setup I got only one thing. A poti to throttle at Analog-0. Worked fine in Part 2, p.getAnalog(), and the Pin set as 0xA0.~~\n\n~~In your .json file, why is the PIN set to 164. In Part 2 it was at Analog-2.~~\n\n~~I tried to understand, but gave up at some point and just configured mine like this:~~\n\n~~{              \u0022api\u0022: \u0022set\\_throttle\u0022,              \u0022type\u0022: \u0022analogIn\u0022,              \u0022name\u0022: \u0022Throttle\u0022,              \u0022pin\u0022: 0,              \u0022options\u0022: {                  \u0022format\u0022: \u0022floatpoint\u0022,                  \u0022deadzone\u0022: 0.05,                  \u0022invert\u0022: \u0022False\u0022              }~~\n\n~~}~~\n\n~~Also tried \u0022pin\u0022: 0xA0,~~\n\n~~...~~\n\n~~I started ksp, put some telemachus antenna at Kerbal-Xs hull. Then weird things happened. Telemachus works fine. I get a connection to the browser, giving me all infos, etc.~~\n\n~~But as I try starting python kapcom.py via the command-shell, at nearly every try I get this:~~\n\n~~Traceback (most recent call last):    File \u0022kapcom.py\u0022, line 429, in \u003Cmodule\u003E\u003Cbr\u003E    main()\u003Cbr\u003E  File \u0022kapcom.py\u0022, line 402, in main\u003Cbr\u003E    k = kapcom()\u003Cbr\u003E  File \u0022kapcom.py\u0022, line 144, in __init__\u003Cbr\u003E    j   =   json.load(file)\u003Cbr\u003E  File \u0022C:\\Python27\\lib\\json\\__init__.py\u0022, line 291, in load\u003Cbr\u003E    **kw)\u003Cbr\u003E  File \u0022C:\\Python27\\lib\\json\\__init__.py\u0022, line 339, in loads\u003Cbr\u003E    return _default_decoder.decode(s)\u003Cbr\u003E  File \u0022C:\\Python27\\lib\\json\\decoder.py\u0022, line 364, in decode\u003Cbr\u003E    obj, end = self.raw_decode(s, idx=_w(s, 0).end())\u003Cbr\u003E  File \u0022C:\\Python27\\lib\\json\\decoder.py\u0022, line 382, in raw_decode\u003Cbr\u003E    raise ValueError(\u0022No JSON object could be decoded\u0022)\u003Cbr\u003EValueError: No JSON object could be decoded\u003C/module\u003E~~\n\n~~=======[ Stats ]=======  Cycles:        0~~\n\n~~Only one time, I absolutely don\u0027t know, if I had done something different it worked and I got it started...fly by wire...OK....Waiting for input. But the Poit wasn\u0027t affecting the games throttle value. Tried for about half an hour, but can\u0027t reproduce it.~~\n\n~~You have any guess?~~\n\nBenji\n\n**Edited \u003Ctime datetime=\u00222016-02-18T19:13:05Z\u0022 title=\u002202/18/2016 07:13  PM\u0022 data-short=\u00228 yr\u0022\u003EFebruary 18, 2016\u003C/time\u003E by Benji**\n  \ntyped localhost, not \u0022localhost\u0022. One problem solved"},{"CreatedByName":"Benji","CreatedById":116398,"CreatedDateTime":"2016-02-18T20:58:15Z","Content":"Tried to do something about the lag and got the baud up to 250000. But still lagged.\n\nAll my input devices will be hooked up to analog inputs. But I would like to display informations on an 3.2\u0022 LCDisplay. You think I can try to comment out some code in your python-files to speed things up?"},{"CreatedByName":"MarcRan17","CreatedById":59722,"CreatedDateTime":"2016-06-16T07:11:02Z","Content":"Hey, sorry for resurrecting this, just wanted to know if it was still an active project, whether it works with the latest KSP, etc. Also, Sorry if this is a dumb question, I haven\u0027t looked too thoroughly at the files, but how do toggle switches work with this system? Buttons are fairly self explanatory, they work just like a keypress, but is a toggle switch input any different? (Think old style, shiny silver, guarded toggle switches.)\n\n**Edited \u003Ctime datetime=\u00222016-06-16T10:27:28Z\u0022 title=\u002206/16/2016 10:27  AM\u0022 data-short=\u00228 yr\u0022\u003EJune 16, 2016\u003C/time\u003E by MarcRan17**"},{"CreatedByName":"lawnmowerlatte","CreatedById":112768,"CreatedDateTime":"2016-07-05T15:41:45Z","Content":"\u003E \n\u003E \n\u003E On February 18, 2016 at 3:58 PM, Benji said:\n\u003E \n\u003E \n\u003E Tried to do something about the lag and got the baud up to 250000. But still lagged.\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E All my input devices will be hooked up to analog inputs. But I would like to display informations on an 3.2\u0022 LCDisplay. You think I can try to comment out some code in your python-files to speed things up?\n\u003E \n\nYeah, I\u0027m sure you can, there are definitely some optimizations that could be made. If you make any changes you think would be generally good, send me a pull request on GitHub."},{"CreatedByName":"lawnmowerlatte","CreatedById":112768,"CreatedDateTime":"2016-07-05T15:52:57Z","Content":"\u003E \n\u003E \n\u003E On June 16, 2016 at 3:11 AM, MarcRan17 said:\n\u003E \n\u003E \n\u003E Hey, sorry for resurrecting this, just wanted to know if it was still an active project, whether it works with the latest KSP, etc. Also, Sorry if this is a dumb question, I haven\u0027t looked too thoroughly at the files, but how do toggle switches work with this system? Buttons are fairly self explanatory, they work just like a keypress, but is a toggle switch input any different? (Think old style, shiny silver, guarded toggle switches.)\n\u003E \n\nSorry, I\u0027ve been away from the board for a while and haven\u0027t done much work on this lately. Since this project mainly depends on Telemachus, as long as that is updated it should be okay.\n\nA toggle switch is a type of DigitalIn button, but the format would be either \u0022true\u0022, \u0022false\u0027, \u0022zero\u0022 or \u0022one\u0022 \u2014 that way it only triggers on on or off and sends a \u0027True\u0027, \u0027False\u0027, \u00270\u0027 or \u00271\u0027. If you need to add something new, it\u0027s in \u0060libraries/pin.py\u0060 under \u0060_Pin.__str__()\u0060"}]}