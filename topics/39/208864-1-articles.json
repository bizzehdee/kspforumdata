{"TopicId":208864,"ForumId":39,"TopicTitle":"Programming Starship (work in progress)","CreatedByName":"Ferranis","CreatedById":222049,"CreatedDateTime":"2022-07-06T17:33:57Z","PageNum":1,"Articles":[{"CreatedByName":"Ferranis","CreatedById":222049,"CreatedDateTime":"2022-07-06T17:33:57Z","Content":"\n\u003Cdiv class=\u0022ipsEmbeddedVideo\u0022\u003E\n\u003Cdiv\u003E\n\u003Ciframe allowfullscreen=\u0022\u0022 frameborder=\u00220\u0022 height=\u0022150\u0022 src=\u0022https://www.youtube-nocookie.com/embed/4xjPhx6cc-4?feature=oembed\u0022 title=\u0022From Flop To Flip\u0022 width=\u0022200\u0022\u003E\u003C/iframe\u003E\n\u003C/div\u003E\n\u003C/div\u003E\n\u003Cp\u003E\nHello all! Will make it quick:\u003Cbr\u003E\u003Cbr\u003E\n* Programmer by trade (but completely unrelated to spaceflight)\u003Cbr\u003E\n* Absolutely fascinated by the tvc and flaps control of starship\u003Cbr\u003E\n* But absolutely no idea how this could be achieved in code\u003Cbr\u003E\n* But spaceflight noob\u003Cbr\u003E\n* But\u00A0 ksp noob\n\u003C/p\u003E\n\u003Cp\u003E\nTook the last year to \u003Cspan\u003E\u003Cspan\u003Egradually\u003C/span\u003E\u003C/span\u003E learn how to control starship using my own plugin written in C#.\u003Cbr\u003E\nThe video above shows my current progress. Ascent, flop, descent, flip work roughly. Landing left.\u003Cbr\u003E\nFull code can be found here: \u003Ca href=\u0022https://github.com/xgleich1/starship\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/xgleich1/starship \u003C/a\u003E\u003Cbr\u003E\u003Cbr\u003E\nWould like to describe my yourney from the beginning\u00A0 and in detail once this post is approved and if you are interested.\u003Cbr\u003E\nCould contain hints on how the real flight software \u003Cspan\u003E\u003Cspan\u003Epotentially\u003C/span\u003E\u003C/span\u003E \u003Cspan\u003E\u003Cspan\u003E \u003C/span\u003E\u003C/span\u003Ecould look like.\u003Cbr\u003E\nExample: How can you make\u00A0 sure that you can yaw/roll/pitch at the same time with the flaps?\u003Cbr\u003E\u003Cbr\u003E\nFinally and \u003Cspan\u003E\u003Cspan\u003Emost importantly\u003C/span\u003E\u003C/span\u003E: Big thanks to ksp and the whole ksp community, without you I could have never done this. Special mentions:\u003Cbr\u003E\u003Cbr\u003E\u003Ca href=\u0022https://kerbalx.com/\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://kerbalx.com/\u003C/a\u003E\u00A0\u003Cbr\u003E\n-\u0026gt; For providing the means to find a starship vehicle for a complete builder noob\u003Cbr\u003E\u003Cbr\u003E\u003Ca href=\u0022https://www.kerbalspaceprogram.com/ksp/api/index.html#details\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://www.kerbalspaceprogram.com/ksp/api/index.html#details\u003C/a\u003E\u00A0\u003Cbr\u003E\n-\u0026gt; Documentation which helped a lot while coding\u003Cbr\u003E\u003Cbr\u003E\u003Ca href=\u0022https://wiki.kerbalspaceprogram.com/wiki/Plugins\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://wiki.kerbalspaceprogram.com/wiki/Plugins\u003C/a\u003E\u00A0\u003Cbr\u003E\n-\u0026gt; For teaching the basics in making a plugin\u003Cbr\u003E\u003Cbr\u003E\u003Ca href=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/182622-19x-aecs-motion-suppressor-air-brake-engine-control-surfaces/\u0022 rel=\u0022\u0022\u003Ehttps://forum.kerbalspaceprogram.com/index.php?/topic/182622-19x-aecs-motion-suppressor-air-brake-engine-control-surfaces/\u003C/a\u003E\u003Cbr\u003E\u003Ca href=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/124417-180-1123-atmosphereautopilot-160/\u0022 rel=\u0022\u0022\u003Ehttps://forum.kerbalspaceprogram.com/index.php?/topic/124417-180-1123-atmosphereautopilot-160/\u003C/a\u003E\u003Cbr\u003E\u003Ca href=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/180725-112x-attitudeadjuster-v12-set-control-point-via-action-group-variable-pitch-control-point-for-spaceplane-reentry/\u0022 rel=\u0022\u0022\u003Ehttps://forum.kerbalspaceprogram.com/index.php?/topic/180725-112x-attitudeadjuster-v12-set-control-point-via-action-group-variable-pitch-control-point-for-spaceplane-reentry/\u003C/a\u003E\u003Cbr\u003E\u003Ca href=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/196642-18-19-110-davon-throttle-control-systems-mod-renewed/\u0022 rel=\u0022\u0022\u003Ehttps://forum.kerbalspaceprogram.com/index.php?/topic/196642-18-19-110-davon-throttle-control-systems-mod-renewed/\u003C/a\u003E\u003Cbr\u003E\u003Ca href=\u0022https://github.com/RichTeaMan/JebNet\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/RichTeaMan/JebNet\u003C/a\u003E\u003Cbr\u003E\u003Ca href=\u0022https://spacedock.info/mod/2643/Kerbal%20Telemetry\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://spacedock.info/mod/2643/Kerbal Telemetry\u003C/a\u003E\u003Cbr\u003E\u003Ca href=\u0022https://ksp-kos.github.io/KOS/\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://ksp-kos.github.io/KOS/\u003C/a\u003E\u003Cbr\u003E\u003Ca href=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/162324-18-112x-trajectories-v241-2021-06-27-atmospheric-predictions/\u0022 rel=\u0022\u0022\u003Ehttps://forum.kerbalspaceprogram.com/index.php?/topic/162324-18-112x-trajectories-v241-2021-06-27-atmospheric-predictions/\u003C/a\u003E\u003Cbr\u003E\u003Ca href=\u0022https://github.com/MuMech/MechJeb2\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/MuMech/MechJeb2\u003C/a\u003E\u003Cbr\u003E\u003Ca href=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/90252-13-pilot-assistant-atmospheric-piloting-aids-1132-may-28/\u0022 rel=\u0022\u0022\u003Ehttps://forum.kerbalspaceprogram.com/index.php?/topic/90252-13-pilot-assistant-atmospheric-piloting-aids-1132-may-28/\u003C/a\u003E\u003Cbr\u003E\u003Ca href=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/139167-111-remotetech-v199-2020-12-19/\u0022 rel=\u0022\u0022\u003Ehttps://forum.kerbalspaceprogram.com/index.php?/topic/139167-111-remotetech-v199-2020-12-19/\u003C/a\u003E\u003Cbr\u003E\u003Ca href=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/97154-19-110-throttle-controlled-avionics/\u0022 rel=\u0022\u0022\u003Ehttps://forum.kerbalspaceprogram.com/index.php?/topic/97154-19-110-throttle-controlled-avionics/\u003C/a\u003E\u003Cbr\u003E\n-\u0026gt; For being an awesome reference on how things could be done with a plugin\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222022-07-07T21:23:39Z\u0022 title=\u002207/07/2022 09:23  PM\u0022 data-short=\u00222 yr\u0022\u003EJuly 7, 2022\u003C/time\u003E by Ferranis\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Vanamonde","CreatedById":27914,"CreatedDateTime":"2022-07-07T19:33:00Z","Content":"\n\u003Cp\u003E\nWay more complex than anything I\u0027ve ever done in KSP. You should send this to SpaceX. If you can make it work in the game I imagine you have the skills to make it work in the real world, so maybe they\u0027d give you a job. \u003Cspan\u003E\u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u003C/span\u003E\n\u003C/p\u003E\n"},{"CreatedByName":"Ferranis","CreatedById":222049,"CreatedDateTime":"2022-07-07T20:43:39Z","Content":"\n\u003Cp\u003E\nBig thanks Vanamonde! I am just glad KSP exists, its an amazing game and even makes stuff like this possible!\u003Cbr\u003E\nWill continue now with my first step in this project.\n\u003C/p\u003E\n"},{"CreatedByName":"Ferranis","CreatedById":222049,"CreatedDateTime":"2022-07-07T21:23:06Z","Content":"\n\u003Cdiv class=\u0022ipsEmbeddedVideo\u0022\u003E\n\u003Cdiv\u003E\n\u003Ciframe allowfullscreen=\u0022\u0022 frameborder=\u00220\u0022 height=\u0022150\u0022 src=\u0022https://www.youtube-nocookie.com/embed/6YdI_ebkmwI?feature=oembed\u0022 title=\u0022Step 1, Control The General Throttle\u0022 width=\u0022200\u0022\u003E\u003C/iframe\u003E\n\u003C/div\u003E\n\u003C/div\u003E\n\u003Cp\u003E\n\u003Cstrong\u003EStep 1, Control The General Throttle\u003C/strong\u003E\u003Cbr\u003E\u003Cbr\u003E\nInitial consideration: How to even start with this?\u003Cbr\u003E\u003Cbr\u003E\nTwo things must be possible: Starship needs to be controlled via code and it must roughly adhere to physics.\u003Cbr\u003E\nBuilding an own graphics and physics engine is out of the question. Luckily I heard of MechJeb and that ksp\u003Cbr\u003E\nis pretty accurate physics-wise.\u003Cbr\u003E\u003Cbr\u003E\nLearning the very basics of plugin development via the wiki was next. Even though the wiki is good this\u003Cbr\u003E\nwas a lot of trial and error, not helped by plugin-development being done in C# (never programmed in C#).\u003Cbr\u003E\u003Cbr\u003E\nThe main takeaway was how to integrate a plugin into ksp, which is to create a PartModule\u003Cbr\u003E\n(current iteration: \u003Ca href=\u0022https://github.com/xgleich1/starship/blob/master/Starship/FlightComputer.cs\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/xgleich1/starship/blob/master/Starship/FlightComputer.cs\u003C/a\u003E)\u003Cbr\u003E\nand to integrate it into a Part (current iteration: \u003Ca href=\u0022https://github.com/xgleich1/starship/blob/master/meta/Integration/navLight1.cfg\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/xgleich1/starship/blob/master/meta/Integration/navLight1.cfg\u003C/a\u003E)\u003Cbr\u003E\nwhich then can be added to the vessel.\u003Cbr\u003E\u003Cbr\u003E\nWith this knowledge I build\u00A0(with lot\u0027s of trial and error!) the code to control the general throttle. Which is the same as when you throttle ingame.\u003Cbr\u003E\nTo no ones surprise this leads to a crash, since there is no gimbaling yet.\u003Cbr\u003E\u003Cbr\u003E\u003Cstrong\u003EInsights which might be applicable to the real thing:\u003C/strong\u003E\u003Cbr\u003E\u003Cbr\u003E\n* Without gimbaling starship crashes shortly after liftof f [snip]\u003Cbr\u003E\n* You have to lock the flaps in deployed position. Flaps back make the ship very instable, especially in pitch\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222022-07-08T17:24:47Z\u0022 title=\u002207/08/2022 05:24  PM\u0022 data-short=\u00222 yr\u0022\u003EJuly 8, 2022\u003C/time\u003E by Vanamonde\u003C/strong\u003E\n\u003Cbr\u003EMind the language, please.\n\u003C/span\u003E\n"},{"CreatedByName":"Ferranis","CreatedById":222049,"CreatedDateTime":"2022-07-08T20:26:52Z","Content":"\n\u003Cdiv class=\u0022ipsEmbeddedVideo\u0022\u003E\n\u003Cdiv\u003E\n\u003Ciframe allowfullscreen=\u0022\u0022 frameborder=\u00220\u0022 height=\u0022150\u0022 src=\u0022https://www.youtube-nocookie.com/embed/f-WyRGjpoTw?feature=oembed\u0022 title=\u0022Step 2, Control The Engines Throttle\u0022 width=\u0022200\u0022\u003E\u003C/iframe\u003E\n\u003C/div\u003E\n\u003C/div\u003E\n\u003Cp\u003E\n\u003Cstrong\u003EStep 2, Control The Engines Throttle\u003C/strong\u003E\u003Cbr\u003E\u003Cbr\u003E\nThe goal for this project is to be as close to reality as possible. Meaning we have to control everything fine grained and can\u0027t rely\u003Cbr\u003E\non the convenience ksp provides for us. In this step it was the throttling of the engines. Each of the three engines need to be \u003Cspan\u003E\u003Cspan\u003Ethrottled\u003C/span\u003E\u003C/span\u003E \u003Cspan\u003E\u003Cspan\u003E \u003C/span\u003E\u003C/span\u003E \u003Cspan\u003E\u003Cspan\u003Eindividually\u003C/span\u003E\u003C/span\u003E\u003Cspan\u003E\u003Cspan\u003E.\u003C/span\u003E\u003C/span\u003E\u003Cbr\u003E\u003Cbr\u003E\nAlready existing ksp plugins helped tremendously and showed me how to first find the engine in code via vessel.FindPartModulesImplementing\u0026lt;ModuleEngines\u0026gt;()\u003Cbr\u003E\nand then to individually throttle them via engine.useEngineResponseTime = true (current iteration: \u003Ca href=\u0022https://github.com/xgleich1/starship/blob/master/Starship/Control/Throttle/Main/MainEnginesThrottleControl.cs\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/xgleich1/starship/blob/master/Starship/Control/Throttle/Main/MainEnginesThrottleControl.cs\u003C/a\u003E).\u003Cbr\u003E\u003Cbr\u003E\nDifficult was to find the right code abstraction for the engine control, meaning I want the low level details of the control as far away as possible from my \u0022business logic\u0022 of controlling starship.\u003Cbr\u003E\nThis helps to make the business logic clear and easily testable, since you don\u0027t have to meddle with low level details and \u003Cspan\u003E\u003Cspan\u003Epotentially\u003C/span\u003E\u003C/span\u003E \u003Cspan\u003E\u003Cspan\u003E \u003C/span\u003E\u003C/span\u003Euntestable classes from ksp.\u003Cbr\u003E\u003Cbr\u003E\nThe result is shown in the video above. A single engine is throttled to the max. You have to be careful though, when you throttle more than the max it just explodes!\u003Cbr\u003E\u003Cbr\u003E\u003Cstrong\u003EInsights which might be applicable to the real thing:\u003Cbr\u003E\n- \u003C/strong\u003E\n\u003C/p\u003E\n"},{"CreatedByName":"Ferranis","CreatedById":222049,"CreatedDateTime":"2022-07-10T18:16:10Z","Content":"\n\u003Cdiv class=\u0022ipsEmbeddedVideo\u0022\u003E\n\u003Cdiv\u003E\n\u003Ciframe allowfullscreen=\u0022\u0022 frameborder=\u00220\u0022 height=\u0022150\u0022 src=\u0022https://www.youtube-nocookie.com/embed/IxNJHagwKbI?feature=oembed\u0022 title=\u0022Step 3, Control The Ascent Naively\u0022 width=\u0022200\u0022\u003E\u003C/iframe\u003E\n\u003C/div\u003E\n\u003C/div\u003E\n\u003Cp\u003E\n\u003Cstrong\u003EStep 3, Control The Ascent Naively\u003C/strong\u003E\u003Cbr\u003E\u003Cbr\u003E\nContinuing the goal to control everything as fine grained as possible with gimbaling the engines. Sadly, I could not meet this goal here.\u003Cbr\u003E\nThere seems to be no way to gimbal each engine individually with code, you have to simulate player inputs and let ksp figure out how to gimbal in response.\u003Cbr\u003E\u003Cbr\u003E\nAfter figuring this out I used simulated player inputs to build a very naive control algorithm: Steer a fixed amount left when starship steers right and vice versa\u003Cbr\u003E\nin all directions (with other words, not even proportional control, where you steer in relation to the deviation). Unsurprisingly the ship becomes unstable very fast.\u003Cbr\u003E\u003Cbr\u003E\nHere one of the most complicated problems started: How to figure out the attitude of starship (its current yaw/roll/pitch). I tried nearly every solution\u003Cbr\u003E\nout there in other plugins, but neither gave me the values I want: signed and \u003Cspan\u003E\u003Cspan\u003Eindependent \u003C/span\u003E\u003C/span\u003Eyaw/roll/pitch. At the end I settled with using the angular velocity\u003Cbr\u003E\nksp provides and from there calculating the current yaw/roll/pitch in degrees (current itetation: \u003Ca href=\u0022https://github.com/xgleich1/starship/blob/master/Starship/Sensor/Attitude/AttitudeSensor.cs\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/xgleich1/starship/blob/master/Starship/Sensor/Attitude/AttitudeSensor.cs\u003C/a\u003E).\u003Cbr\u003E\nThis seems to be good enough for the current flight path.\u003Cbr\u003E\u003Cbr\u003E\u003Cstrong\u003EInsights which might be applicable to the real thing:\u003C/strong\u003E\u003Cbr\u003E\n-\u003Cbr\u003E\u003Cbr\u003E\u003Cstrong\u003EBonus:\u003C/strong\u003E\u003Cbr\u003E\u003Cbr\u003E\nI tried to gimbal each engine individually by putting them on hinges...\n\u003C/p\u003E\n\u003Cdiv class=\u0022ipsEmbeddedOther\u0022\u003E\n\u003Ciframe allowfullscreen=\u0022\u0022 data-controller=\u0022core.front.core.autosizeiframe\u0022 data-embedid=\u0022embed3393247256\u0022 scrolling=\u0022no\u0022 src=\u0022https://forum.kerbalspaceprogram.com/index.php?app=core\u0026amp;module=system\u0026amp;controller=embed\u0026amp;url=https://twitter.com/i/status/1404022837749370882\u0022 style=\u0022height:812px;\u0022\u003E\u003C/iframe\u003E\n\u003C/div\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222022-07-10T18:20:36Z\u0022 title=\u002207/10/2022 06:20  PM\u0022 data-short=\u00222 yr\u0022\u003EJuly 10, 2022\u003C/time\u003E by Ferranis\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Ferranis","CreatedById":222049,"CreatedDateTime":"2022-07-17T19:06:24Z","Content":"\n\u003Cdiv class=\u0022ipsEmbeddedVideo\u0022\u003E\n\u003Cdiv\u003E\n\u003Ciframe allowfullscreen=\u0022\u0022 frameborder=\u00220\u0022 height=\u0022150\u0022 src=\u0022https://www.youtube-nocookie.com/embed/U_IBYCrLumE?feature=oembed\u0022 title=\u0022Step 4, Control The Ascent Proportionally\u0022 width=\u0022200\u0022\u003E\u003C/iframe\u003E\n\u003C/div\u003E\n\u003C/div\u003E\n\u003Cp\u003E\n\u003Cstrong\u003EStep 4, Control The Ascent Proportionally\u003C/strong\u003E\u003Cbr\u003E\u003Cbr\u003E\nThe goal in this step was to have a stable ascent, meaning no change in yaw/roll/pitch.\u003Cbr\u003E\u003Cbr\u003E\nTo achieve those I used the simplest regulator, since I did not know much about regulators and even less about their math:\u003Cbr\u003E\nA proportional regulator. Today the regulator got to a point of being\u00A0 a full blown PID regulator\u003Cbr\u003E\n(current iteration: \u003Ca href=\u0022https://github.com/xgleich1/starship/blob/master/Starship/Flight/Regulator/PidRegulator.cs\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/xgleich1/starship/blob/master/Starship/Flight/Regulator/PidRegulator.cs\u003C/a\u003E),\u003Cbr\u003E\nbut this was the beginning.\u003Cbr\u003E\u003Cbr\u003E\nA proportional regulator does the following: If there is a very small deviation from the flight path - gimbal only a small amount,\u003Cbr\u003E\nif there is a big deviation, gimbal a large amount. This is achieved by multiplying the current flight path error with a fixed\u003Cbr\u003E\nconstant. For example: Error = 10 degrees * fixed constant = 0.1 -\u0026gt; 1% gimbal. The constant was derived by trial and error.\u003Cbr\u003E\nGoing too less results in the error never vanishing and going too much makes the ship swing wildly, since the gimbaling overcorrects.\u003Cbr\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cstrong\u003EInsights which might be applicable to the real thing:\u003C/strong\u003E\u003Cbr\u003E\u003Cbr\u003E\n- The ascent of starship can be controlled by a very simple proportional controller, if you don\u0027t have large interfering forces, like engine outs or wind.\n\u003C/p\u003E\n"},{"CreatedByName":"Ferranis","CreatedById":222049,"CreatedDateTime":"2022-08-14T10:50:25Z","Content":"\n\u003Cp\u003E\nThe updates will continue shortly, was bit busy the last weeks!\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222022-11-27T20:20:25Z\u0022 title=\u002211/27/2022 08:20  PM\u0022 data-short=\u00221 yr\u0022\u003ENovember 27, 2022\u003C/time\u003E by Ferranis\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Ferranis","CreatedById":222049,"CreatedDateTime":"2022-09-06T18:51:31Z","Content":"\n\u003Cp\u003E\nOptimized!\n\u003C/p\u003E\n\u003Cdiv class=\u0022ipsEmbeddedVideo\u0022\u003E\n\u003Cdiv\u003E\n\u003Ciframe allowfullscreen=\u0022\u0022 frameborder=\u00220\u0022 height=\u0022150\u0022 src=\u0022https://www.youtube-nocookie.com/embed/fT6DhKBfA5Q?feature=oembed\u0022 title=\u0022Step 12 Control The Landing Properly\u0022 width=\u0022200\u0022\u003E\u003C/iframe\u003E\n\u003C/div\u003E\n\u003C/div\u003E\n\u003Cp\u003E\nNow for real, the updates will continue.\n\u003C/p\u003E\n"},{"CreatedByName":"Ferranis","CreatedById":222049,"CreatedDateTime":"2022-09-15T18:54:39Z","Content":"\n\u003Cp\u003E\nBonus angle\n\u003C/p\u003E\n\u003Cdiv class=\u0022ipsEmbeddedVideo\u0022\u003E\n\u003Cdiv\u003E\n\u003Ciframe allowfullscreen=\u0022\u0022 frameborder=\u00220\u0022 height=\u0022150\u0022 src=\u0022https://www.youtube-nocookie.com/embed/gh6tWmk3iCw?feature=oembed\u0022 title=\u0022Step 12 Control The Landing Properly - Bonus Angle\u0022 width=\u0022200\u0022\u003E\u003C/iframe\u003E\n\u003C/div\u003E\n\u003C/div\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"Ferranis","CreatedById":222049,"CreatedDateTime":"2022-09-18T15:37:43Z","Content":"\n\u003Cdiv class=\u0022ipsEmbeddedVideo\u0022\u003E\n\u003Cdiv\u003E\n\u003Ciframe allowfullscreen=\u0022\u0022 frameborder=\u00220\u0022 height=\u0022150\u0022 src=\u0022https://www.youtube-nocookie.com/embed/Uo68DOP5c3E?feature=oembed\u0022 title=\u0022Step 5, Control The Belly Flop Naively\u0022 width=\u0022200\u0022\u003E\u003C/iframe\u003E\n\u003C/div\u003E\n\u003C/div\u003E\n\u003Cp\u003E\n\u003Cstrong\u003EStep 5, Control The Belly Flop Naively\u003C/strong\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nThe goal in this step was to bring starship into belly flop position.\n\u003C/p\u003E\n\u003Cp\u003E\nTo achieve this, I first build the infrastructure to control the flaps. For \u0022finding\u0022 them in code, KSP provides a method\u00A0 which\u003Cbr\u003E\nallows searching for all vessel-parts which implement so called \u003Cem\u003Emodules\u003C/em\u003E.\u00A0 A flap implements a \u003Cem\u003EModuleRoboticServoHinge\u003C/em\u003E, for example.\n\u003C/p\u003E\n\u003Cp\u003E\nOnce found, I extracted the minimum and maximum angle of the hinges. With them it was possible to deploy the hinge to my linking,\u003Cbr\u003E\nwhich is as a percentage (example: deploy flaps 50%). Deploying as a percentage allows changing of the minimum and maximum angle\u003Cbr\u003E\nin the \u003Cabbr title=\u0022Vehicle Assembly Building\u0022\u003E\u003Cabbr title=\u0022Vehicle Assembly Building\u0022\u003Evab\u003C/abbr\u003E\u003C/abbr\u003E, without changes in the code. The absolute deployed angle might change, but 50% is always 50%:\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cem\u003Eprivate static void ActuateFlap(ModuleRoboticServoHinge flap, float deployPercent)\u003Cbr\u003E\n{\u003Cbr\u003E\n\u00A0\u00A0\u00A0 var minimumAngle = flap.softMinMaxAngles.x;\u003Cbr\u003E\n\u00A0\u00A0\u00A0 var maximumAngle = flap.softMinMaxAngles.y;\u003C/em\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cem\u003E\u00A0\u00A0\u00A0 var deployedAngle = (maximumAngle - minimumAngle) * deployPercent;\u003C/em\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cem\u003E\u00A0\u00A0\u00A0 flap.targetAngle = minimumAngle \u002B deployedAngle;\u003Cbr\u003E\n}\u003C/em\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nThe full code to find and control the flaps can be found here:\u003Cbr\u003E\n\u003Ca href=\u0022https://github.com/xgleich1/starship/blob/master/Starship/Control/Actuation/Flap/FlapsActuationControl.cs\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/xgleich1/starship/blob/master/Starship/Control/Actuation/Flap/FlapsActuationControl.cs\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nIt\u0027s used to retract the aft flaps when flipping and to deploy them in a centered position afterwards.\u003Cbr\u003E\nIn the next step this position will be the starting point to achieve a controlled descent by moving the flaps.\n\u003C/p\u003E\n\u003Cp\u003E\nFinally, I used the engines to gimbal violently for a second or so to rotate starship into belly flop position.\u00A0 \u003Cabbr title=\u0022Reaction Control System\u0022\u003E\u003Cabbr title=\u0022Reaction Control System\u0022\u003ERCS\u003C/abbr\u003E\u003C/abbr\u003E firings, like on the real thing, were not needed in KSP.\u003Cbr\u003E\nIn these cases I follow the strict rule to only build what I really need (and I have barely the skill to do what is needed :D).\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cstrong\u003EInsights which might be applicable to the real thing:\u003C/strong\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n- When the flaps are not fully deployed on ascent we get a very unstable flight. Especially in yaw, as far as I remember.\u00A0 Complicated aerodynamics, for sure\u003Cbr\u003E\n- When the front flaps are not fully deployed when flipping we get a very unstable flip. Especially in roll, as far as I remember.\u003Cbr\u003E\n\u00A0\u00A0 Front flaps fully deployed, aft flaps fully retracted seems to be naturally stable\u003Cbr\u003E\n- Rotating starship into belly flop position is very hard when the aft flaps are not retracted. They seem to \u0022push\u0022 starship back into vertical\u003Cbr\u003E\n- The gimbaling for the belly flop is deceptively simple. It is literally: Max pitch gimbal for a second. No fine grained gimbal regulation needed\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222022-09-18T15:45:20Z\u0022 title=\u002209/18/2022 03:45  PM\u0022 data-short=\u00221 yr\u0022\u003ESeptember 18, 2022\u003C/time\u003E by Ferranis\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Ferranis","CreatedById":222049,"CreatedDateTime":"2022-10-03T18:33:09Z","Content":"\n\u003Cdiv class=\u0022ipsEmbeddedVideo\u0022\u003E\n\u003Cdiv\u003E\n\u003Ciframe allowfullscreen=\u0022\u0022 frameborder=\u00220\u0022 height=\u0022150\u0022 src=\u0022https://www.youtube-nocookie.com/embed/LaeH3lpMghg?feature=oembed\u0022 title=\u0022Step 6, Control The Aerodynamic Descent Naively\u0022 width=\u0022200\u0022\u003E\u003C/iframe\u003E\n\u003C/div\u003E\n\u003C/div\u003E\n\u003Cp\u003E\n\u003Cstrong\u003EStep 6, Control The Aerodynamic Descent Naively\u003C/strong\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nThe goal in this step was to control starship with the flaps after flipping it horizontally.\u003Cbr\u003E\n\u003Cbr\u003E\nThe first major question to answer now was which flap position leads to which attitude change.\u003Cbr\u003E\nPitch is straightforward. Retracting the bottom flaps to pitch up and retracting the top flaps to pitch down.\u003Cbr\u003E\nRoll is straightforward too. Retracting the left flaps to roll to the left and vice versa.\u003Cbr\u003E\nYaw is tricky. The faps need to be retracted opposite of each other.\u003Cbr\u003E\n\u003Cbr\u003E\nThe second major question to answer was how much to retract each flap. Example:\u003Cbr\u003E\nShould the top flaps be retracted fully when going for a pitch down manoeuvre?\u003Cbr\u003E\nSince when you retract them fully, you lose the ability to roll or yaw with them.\u003Cbr\u003E\n\u003Cbr\u003E\nIn the end, though, I decided against full retraction to always have full control and because\u003Cbr\u003E\nagressive \u003Cspan\u003E\u003Cspan\u003Emaneuvers\u003C/span\u003E\u003C/span\u003E were not needed, which would warrant full retraction of the flaps.\u003Cbr\u003E\n\u003Cbr\u003E\nIn code, this looks very simple. The yaw/roll/pitch pid-regulators are only allowed an output of 1/3 of the full retraction\u003Cbr\u003E\n(current iteration:\u00A0 \u003Ca href=\u0022https://github.com/xgleich1/starship/blob/master/Starship/Flight/Segment/Actuation/Flap/FlapsActuationSegmentCommander.cs\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/xgleich1/starship/blob/master/Starship/Flight/Segment/Actuation/Flap/FlapsActuationSegmentCommander.cs\u003C/a\u003E).\u003Cbr\u003E\n\u003Cbr\u003E\nStill, even with these questions answered, a stable descent could not be achieved due to several major problems, which became apparent:\u003Cbr\u003E\n\u003Cbr\u003E\n* I was unable to make quick adjustments to constants (for example the pid-regulator gains). I always had to rebuild the code and restart ksp\u003Cbr\u003E\n* I was unable to counteract starships habit to spin after flipping. The reason for the spin was the remaining upward velocity during the flip and the missing forward velocity after the flip\u003Cbr\u003E\n\u003Cbr\u003E\nBoth will be addressed in the next steps.\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cstrong\u003EInsights which might be applicable to the real thing:\u003C/strong\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n- Navively assigning each attitude pid-regulator 1/3 of the available flap retraction works surprisingly well and makes it possible to yaw/roll/pitch at the same time\u003Cbr\u003E\n- Starship cannot have excess upward velocity when flipping, otherwise all hell breaks loose aerodynamically\u003Cbr\u003E\n- Starship needs forward velocity after flipping horizontally, otherwise it goes into a flat-spin (this is probably a KSP thing)\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222022-10-03T18:39:06Z\u0022 title=\u002210/03/2022 06:39  PM\u0022 data-short=\u00221 yr\u0022\u003EOctober 3, 2022\u003C/time\u003E by Ferranis\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Ferranis","CreatedById":222049,"CreatedDateTime":"2022-10-24T21:08:37Z","Content":"\n\u003Cp\u003E\nIntermission:\u003Cbr\u003E\n\u003Cbr\u003E\nFigured out I need \u003Cabbr title=\u0022Reaction Control System\u0022\u003E\u003Cabbr title=\u0022Reaction Control System\u0022\u003Ercs\u003C/abbr\u003E\u003C/abbr\u003E during the one engine hover before the flip and this is the first draft of it.\u003Cbr\u003E\nOriginally I thought that no \u003Cabbr title=\u0022Reaction Control System\u0022\u003E\u003Cabbr title=\u0022Reaction Control System\u0022\u003Ercs\u003C/abbr\u003E\u003C/abbr\u003E will suffice because the roll rate would be very low. Turns out it is not low \u003Cspan\u003E\u003Cimg alt=\u0022:(\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_sad.gif\u0022 title=\u0022:(\u0022\u003E\u003Cbr\u003E\n\u003Cbr\u003E\nThe \u0022\u003Cabbr title=\u0022Reaction Control System\u0022\u003E\u003Cabbr title=\u0022Reaction Control System\u0022\u003Ercs\u003C/abbr\u003E\u003C/abbr\u003E\u0022 are spider engines, individually and automatically throttled when a defined threshold is reached (to not run them on the slightest deviation).\u003Cbr\u003E\n\u003Cbr\u003E\nReal updates will continue shortly, I swear. Coding on this project is just so much fun.\u003C/span\u003E\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222022-11-27T20:21:22Z\u0022 title=\u002211/27/2022 08:21  PM\u0022 data-short=\u00221 yr\u0022\u003ENovember 27, 2022\u003C/time\u003E by Ferranis\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Ferranis","CreatedById":222049,"CreatedDateTime":"2022-11-27T20:23:50Z","Content":"\n\u003Cp\u003E\nAnd done (only took 1.5 years...)! Full SN10 inspired flight. Code can be found here: \u003Ca href=\u0022https://github.com/xgleich1/starship\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/xgleich1/starship \u003C/a\u003E\n\u003C/p\u003E\n\u003Cdiv class=\u0022ipsEmbeddedVideo\u0022\u003E\n\u003Cdiv\u003E\n\u003Ciframe allowfullscreen=\u0022\u0022 frameborder=\u00220\u0022 height=\u0022150\u0022 src=\u0022https://www.youtube-nocookie.com/embed/Q9ieh0XYfLY?feature=oembed\u0022 title=\u0022Step 12, Control The Ascent And Landing On One Engine - Back View\u0022 width=\u0022200\u0022\u003E\u003C/iframe\u003E\n\u003C/div\u003E\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsEmbeddedVideo\u0022\u003E\n\u003Cdiv\u003E\n\u003Ciframe allowfullscreen=\u0022\u0022 frameborder=\u00220\u0022 height=\u0022150\u0022 src=\u0022https://www.youtube-nocookie.com/embed/EAb7ADYKW0Y?feature=oembed\u0022 title=\u0022Step 12, Control The Ascent And Landing On One Engine - Bottom View\u0022 width=\u0022200\u0022\u003E\u003C/iframe\u003E\n\u003C/div\u003E\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsEmbeddedVideo\u0022\u003E\n\u003Cdiv\u003E\n\u003Ciframe allowfullscreen=\u0022\u0022 frameborder=\u00220\u0022 height=\u0022150\u0022 src=\u0022https://www.youtube-nocookie.com/embed/qYHi9Qwzplk?feature=oembed\u0022 title=\u0022Step 12, Control The Ascent And Landing On One Engine - Top View\u0022 width=\u0022200\u0022\u003E\u003C/iframe\u003E\n\u003C/div\u003E\n\u003C/div\u003E\n"},{"CreatedByName":"Rutabaga22","CreatedById":221143,"CreatedDateTime":"2022-11-27T20:36:48Z","Content":"\n\u003Cp\u003E\nIs it capable of precise landing?\n\u003C/p\u003E\n"},{"CreatedByName":"Ferranis","CreatedById":222049,"CreatedDateTime":"2022-11-28T18:22:05Z","Content":"\n\u003Cp\u003E\nThank you for your comment!\u003Cbr\u003E\n\u003Cbr\u003E\nCurrently it can only indirectly hit a target. The flight-path is defined in an xml file and depending on it you get a different landing location.\u003Cbr\u003E\n\u003Cbr\u003E\nWhat I (intentionally, since I am too dumb for it) not did was the capability to land on a coordinate.\n\u003C/p\u003E\n"},{"CreatedByName":"wreckreation","CreatedById":114933,"CreatedDateTime":"2022-11-29T06:31:00Z","Content":"\n\u003Cp\u003E\nStill, quite impressive.\n\u003C/p\u003E\n"}]}