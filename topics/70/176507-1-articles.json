{"TopicId":176507,"ForumId":70,"TopicTitle":"CommNet.CommNetVessel.InPlasma causing a StackOverflow","CreatedByName":"PiezPiedPy","CreatedById":171747,"CreatedDateTime":"2018-07-05T17:31:43Z","PageNum":1,"Articles":[{"CreatedByName":"PiezPiedPy","CreatedById":171747,"CreatedDateTime":"2018-07-05T17:31:43Z","Content":"\n\u003Cp style=\u0022background-color:transparent;color:rgb(53,60,65);font-size:14px;font-style:normal;font-variant:normal;font-weight:400;letter-spacing:normal;margin-top:0px;text-align:left;text-decoration:none;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;\u0022\u003E\nWhen calling CommNet.CommNetVessel.InPlasma I get a StackOverflowException\n\u003C/p\u003E\n\u003Cp style=\u0022background-color:transparent;color:rgb(53,60,65);font-size:14px;font-style:normal;font-variant:normal;font-weight:400;letter-spacing:normal;text-align:left;text-decoration:none;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;\u0022\u003E\nin C# with just a simple if statement\n\u003C/p\u003E\n\u003Cp style=\u0022background-color:transparent;color:rgb(53,60,65);font-size:14px;font-style:normal;font-variant:normal;font-weight:400;letter-spacing:normal;text-align:left;text-decoration:none;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;\u0022\u003E\nvariable v is a reference to a Vessel and all access to v.connection works as expected until the if (v.connection.InPlasma) statement. \u003Cspan\u003E\uFEFF\u003C/span\u003E\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022 style=\u0022background-attachment:scroll;background-color:rgb(250,250,250);background-image:none;background-repeat:repeat;border-bottom-color:rgb(53,60,65);border-bottom-style:none;border-bottom-width:0px;border-left-color:rgb(224,224,224);border-left-style:solid;border-left-width:4px;border-right-color:rgb(53,60,65);border-right-style:none;border-right-width:0px;border-top-color:rgb(53,60,65);border-top-style:none;border-top-width:0px;clear:both;color:rgb(53,60,65);font-family:monospace, monospace;font-size:14px;font-style:normal;font-variant:normal;font-weight:400;letter-spacing:normal;max-height:400px;padding-bottom:15px;padding-left:15px;padding-right:15px;padding-top:15px;text-align:left;text-decoration:none;text-indent:0px;text-transform:none;white-space:pre-wrap;word-spacing:0px;\u0022\u003E\n\u003Cspan class=\u0022pln\u0022 style=\u0022color:rgb(0,0,0);\u0022\u003E// are we connected to DSN\nif (v.connection.IsConnected)\n{\n  return new ConnectionInfo(v.connection.ControlPath.First.hopType == HopType.Home ? LinkStatus.direct_link : LinkStatus.indirect_link,\n    ext_rate * v.connection.SignalStrength, v.connection.SignalStrength, ext_cost,\n    Lib.Ellipsis(Localizer.Format(v.connection.ControlPath.First.end.displayName).Replace(\u0022Kerbin\u0022, \u0022DSN\u0022), 20));\n}\n// is loss of connection due to plasma blackout\nelse if (v.connection.InPlasma)  // calling InPlasma causes a StackOverflow :(\n  return new ConnectionInfo(LinkStatus.blackout);\u003C/span\u003E\u003C/pre\u003E\n\u003Cp style=\u0022background-color:transparent;color:rgb(53,60,65);font-size:14px;font-style:normal;font-variant:normal;font-weight:400;letter-spacing:normal;text-align:left;text-decoration:none;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;\u0022\u003E\nLog output is:\n\u003C/p\u003E\n\u003Cp style=\u0022background-color:transparent;color:rgb(53,60,65);font-size:14px;font-style:normal;font-variant:normal;font-weight:400;letter-spacing:normal;text-align:left;text-decoration:none;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;\u0022\u003E\n[EXC 12:26:21.322] StackOverflowException: The requested operation caused a stack overflow. \u00A0\u00A0 \u00A0CommNet.CommNetVessel.get_InPlasma ()\n\u003C/p\u003E\n\u003Cp style=\u0022background-color:transparent;color:rgb(53,60,65);font-size:14px;font-style:normal;font-variant:normal;font-weight:400;letter-spacing:normal;text-align:left;text-decoration:none;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;\u0022\u003E\nwith none of the usual debug info like the filename and line number etc you usually get with exceptions.\n\u003C/p\u003E\n\u003Cp style=\u0022background-color:transparent;color:rgb(53,60,65);font-size:14px;font-style:normal;font-variant:normal;font-weight:400;letter-spacing:normal;text-align:left;text-decoration:none;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;\u0022\u003E\nI suspect this is an error in KSP\u0027s code.\n\u003C/p\u003E\n\u003Cp style=\u0022background-color:transparent;color:rgb(53,60,65);font-size:14px;font-style:normal;font-variant:normal;font-weight:400;letter-spacing:normal;margin-bottom:0px;text-align:left;text-decoration:none;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;\u0022\u003E\nUsing reflection to access the private field inPlasma gives a correct value.\n\u003C/p\u003E\n\u003Cp style=\u0022background-color:transparent;color:rgb(53,60,65);font-size:14px;font-style:normal;font-variant:normal;font-weight:400;letter-spacing:normal;margin-bottom:0px;text-align:left;text-decoration:none;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;\u0022\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp style=\u0022background-color:transparent;color:rgb(53,60,65);font-size:14px;font-style:normal;font-variant:normal;font-weight:400;letter-spacing:normal;margin-bottom:0px;text-align:left;text-decoration:none;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;\u0022\u003E\nAlso posted here:\u00A0\n\u003C/p\u003E\n\u003Ciframe allowfullscreen=\u0022\u0022 data-controller=\u0022core.front.core.autosizeiframe\u0022 data-embedcontent=\u0022\u0022 data-embedid=\u0022embed1517484754\u0022 scrolling=\u0022no\u0022 src=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/175708-commnetcommnetvesselinplasma-causing-a-stackoverflow/\u0026amp;do=embed\u0022 style=\u0022height:226px;max-width:502px;\u0022\u003E\u003C/iframe\u003E\n\u003Cp style=\u0022background-color:transparent;color:rgb(53,60,65);font-size:14px;font-style:normal;font-variant:normal;font-weight:400;letter-spacing:normal;margin-bottom:0px;text-align:left;text-decoration:none;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;\u0022\u003E\n\u00A0\n\u003C/p\u003E\n"}]}