{"TopicId":160612,"ForumId":70,"TopicTitle":"Atmospheric Pe Changes on Flight Scene Load","CreatedByName":"Drew Kerman","CreatedById":103177,"CreatedDateTime":"2017-05-14T05:55:50Z","PageNum":1,"Articles":[{"CreatedByName":"Drew Kerman","CreatedById":103177,"CreatedDateTime":"2017-05-14T05:55:50Z","Content":"\n\u003Cp\u003E\nThis could be a stock issue, but I\u0027m filing this report with a lot of mods so placing it here for now.\n\u003C/p\u003E\n\u003Cp\u003E\nI have an asteroid that was spawned on a Kerbin intercept trajectory that takes it 16.97972km (as reported by \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/33568-winmac-ksp-trajectory-optimization-tool-v156-ksp-v12x-compatibility/\u0022 rel=\u0022\u0022\u003EKSPTOT\u003C/a\u003E) into Kerbin\u0027s atmosphere. This shows up in the tracking station properly as 16.980km when I check its Periapse. However when I load the asteroid in the flight scene the \u003Cabbr title=\u0022Periapsis\u0022\u003EPe\u003C/abbr\u003E is now 16.977km - consistently. I ran the following steps three times (requires \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/22809-12x-kerbal-alarm-clock-v3840-january-15/\u0022 rel=\u0022\u0022\u003EKerbal Alarm Clock\u003C/a\u003E to visit the asteroid):\n\u003C/p\u003E\n\u003Col\u003E\u003Cli\u003E\nLoad \u003Ca href=\u0022http://www.blade-edge.com/misc/asteroid.zip\u0022 rel=\u0022external nofollow\u0022\u003Ethis save file\u003C/a\u003E\n\u003C/li\u003E\n\u003Cli\u003E\nGo to the Tracking Station\n\u003C/li\u003E\n\u003Cli\u003E\nSelect the asteroid and confirm \u003Cabbr title=\u0022Periapsis\u0022\u003EPe\u003C/abbr\u003E 16,980m\n\u003C/li\u003E\n\u003Cli\u003E\nTimewarp to the alarm\n\u003C/li\u003E\n\u003Cli\u003E\nSelect the option to jump to the asteroid\n\u003C/li\u003E\n\u003Cli\u003E\nAfter loading is finished, enter the map view and check \u003Cabbr title=\u0022Periapsis\u0022\u003EPe\u003C/abbr\u003E is 16,977m\n\u003C/li\u003E\n\u003Cli\u003E\nPress Esc \u0026amp; return to Space Center\n\u003C/li\u003E\n\u003Cli\u003E\nRepeat from #1\n\u003C/li\u003E\n\u003C/ol\u003E\u003Cp\u003E\nNow, I\u0027m using a mod to get to the asteroid - Kerbal Alarm Clock lets you get to an asteroid when the game doesn\u0027t - so that could be the cause of the issue. To help rule this out, I transferred the orbital properties of the asteroid to a piece of debris and repeated the process with that. Its \u003Cabbr title=\u0022Periapsis\u0022\u003EPe\u003C/abbr\u003E did not change:\n\u003C/p\u003E\n\u003Col\u003E\u003Cli\u003E\nLoad \u003Ca href=\u0022http://www.blade-edge.com/misc/debris.zip\u0022 rel=\u0022external nofollow\u0022\u003Ethis save file\u003C/a\u003E\n\u003C/li\u003E\n\u003Cli\u003E\nGo to the Tracking Station\n\u003C/li\u003E\n\u003Cli\u003E\nSelect the debris and confirm \u003Cabbr title=\u0022Periapsis\u0022\u003EPe\u003C/abbr\u003E 16.980m\n\u003C/li\u003E\n\u003Cli\u003E\nTimewarp to the alarm\n\u003C/li\u003E\n\u003Cli\u003E\nClose the alarm notification\n\u003C/li\u003E\n\u003Cli\u003E\nSelect the debris\n\u003C/li\u003E\n\u003Cli\u003E\nClick \u0022Add\u0022 to create a new alarm in \u003Cabbr title=\u0022Kerbal Alarm Clock (mod)\u0022\u003EKAC\u003C/abbr\u003E\n\u003C/li\u003E\n\u003Cli\u003E\nSelect \u0022Raw TIme Alarm\u0022\n\u003C/li\u003E\n\u003Cli\u003E\nSet all fields to 0 \u0026amp; create the alarm, which will instantly ask you to jump to the vessel\n\u003C/li\u003E\n\u003Cli\u003E\nJump to vessel, switch to map view and \u003Cabbr title=\u0022Periapsis\u0022\u003EPe\u003C/abbr\u003E should still be 16,980m\n\u003C/li\u003E\n\u003C/ol\u003E\u003Cp\u003E\nThis still isn\u0027t a 100% guarantee that \u003Cabbr title=\u0022Kerbal Alarm Clock (mod)\u0022\u003EKAC\u003C/abbr\u003E isn\u0027t doing something different when it loads an asteroid, but if we consider an asteroid to be a generic game object there\u0027s no reason why \u003Cabbr title=\u0022Kerbal Alarm Clock (mod)\u0022\u003EKAC\u003C/abbr\u003E should be loading it differently than an object that is identified as type \u0022Debris\u0022.\n\u003C/p\u003E\n\u003Cp\u003E\nThis issue of the \u003Cabbr title=\u0022Periapsis\u0022\u003EPe\u003C/abbr\u003E changing on load has a different effect depending on what mods are installed. Here are the results of my investigations - each instance has been loaded \u0026amp; test 3 times in a row :\n\u003C/p\u003E\n\u003Cp\u003E\nin ALL instances: 16.980km \u003Cabbr title=\u0022Periapsis\u0022\u003EPe\u003C/abbr\u003E in Tracking Station\n\u003C/p\u003E\n\u003Cp\u003E\nStock \u002B \u003Cabbr title=\u0022Kerbal Alarm Clock (mod)\u0022\u003EKAC\u003C/abbr\u003E: 16.977km |\u00A016.977km |\u00A016.977km \u003Cabbr title=\u0022Periapsis\u0022\u003EPe\u003C/abbr\u003E in flight\u003Cbr\u003E\nStock \u002B \u003Cabbr title=\u0022Kerbal Alarm Clock (mod)\u0022\u003EKAC\u003C/abbr\u003E \u002B Module Manager \u002B Persistent Rotation: 17.395km | 17.398km | 17.397km \u003Cabbr title=\u0022Periapsis\u0022\u003EPe\u003C/abbr\u003E in flight\u003Cbr\u003E\nStock \u002B \u003Cabbr title=\u0022Kerbal Alarm Clock (mod)\u0022\u003EKAC\u003C/abbr\u003E \u002B Module Manager \u002B Asteroid Recycling Technologies: 16.973km | 16.973km | 16.973km \u003Cabbr title=\u0022Periapsis\u0022\u003EPe\u003C/abbr\u003E in flight\u003Cbr\u003E\nStock \u002B \u003Cabbr title=\u0022Kerbal Alarm Clock (mod)\u0022\u003EKAC\u003C/abbr\u003E \u002B Module Manager \u002B Kopernicus \u002B Modular Flight Integrator: 16.977km | 16.977km | 16.977km \u003Cabbr title=\u0022Periapsis\u0022\u003EPe\u003C/abbr\u003E in flight\n\u003C/p\u003E\n\u003Cp\u003E\nNow here is something interesting. Using the last configuration above with Kopernicus, if I include this patch:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode\u0022\u003E\n@Body[Kerbin]\n{\n  @Properties\n  {\n    // return Kerbin to old pre-v1.0.5 rotation period\n    %rotationPeriod = 21651\n  }\n}\u003C/pre\u003E\n\u003Cp\u003E\nThen all three times I loaded into the flight scene the \u003Cabbr title=\u0022Periapsis\u0022\u003EPe\u003C/abbr\u003E was 16.979km. When I also installed Vessel Orbital Information Display I can see the \u003Cabbr title=\u0022Periapsis\u0022\u003EPe\u003C/abbr\u003E flip after the asteroid finishes loading:\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u0022Pe2bMFY.gif\u0022 class=\u0022ipsImage\u0022 src=\u0022http://i.imgur.com/Pe2bMFY.gif\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nIt does this for all instances I tested.\n\u003C/p\u003E\n\u003Cp\u003E\nSo, that\u0027s it for now. I don\u0027t really know what conclusions to draw from all this right now, maybe because it\u0027s 2am and I\u0027ve been looking into this for the past few hours now. And I just said \u0022now\u0022 in the last three sentences. Maybe I should go to bed now. (But of course I\u0027m not gunna cause I wanna see if this rock gets captured after aerobraking!)\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222017-05-14T06:25:22Z\u0022 title=\u002205/14/2017 06:25  AM\u0022 data-short=\u00227 yr\u0022\u003EMay 14, 2017\u003C/time\u003E by Drew Kerman\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"diomedea","CreatedById":93700,"CreatedDateTime":"2017-05-14T13:52:08Z","Content":"\n\u003Cp\u003E\nThe orbital data with the asteroid in that savegame (SMA = -62370614.5606016, ECC = 1.00989215399152) allow to compute \u003Cabbr title=\u0022Periapsis\u0022\u003EPe\u003C/abbr\u003E = SMA*(1-ECC) = 616979.723778947, or (given Kerbin\u0027s radius = 600,000 m) a \u003Cabbr title=\u0022Periapsis\u0022\u003EPe\u003C/abbr\u003E altitude ASL = 16979.723778947. Which is totally consistent with KSPTOT and (rounded) with the Tracking station (unmodded) and VOID. The rotation period of Kerbin doesn\u0027t change the above (would only if \u003Cabbr title=\u0022Periapsis\u0022\u003EPe\u003C/abbr\u003E altitude was measured AGL instead of ASL, and terrain altitude changed at the \u003Cabbr title=\u0022Periapsis\u0022\u003EPe\u003C/abbr\u003E because of the different rotation).\n\u003C/p\u003E\n\u003Cp\u003E\nHowever, when a vessel goes off rails (loaded in the scene) its positional data is updated based on time and velocity vector. The process may easily bring to differences just because of the accuracy of the data. Can only guess at what may happen with add-ons, but should those affect any of the data required (positional vector, velocity vector, frame timing interval) the difference would come evident.\n\u003C/p\u003E\n\u003Cp\u003E\nAnyway, would be best to check with a saved game after having switched scene to the asteroid. SMA and ECC shouldn\u0027t change at all while off-rails when no external forces act on a vessel; but if they did then it would be a confirmation the orbit changed.\n\u003C/p\u003E\n\u003Cp\u003E\nThe only thing that could actually bring to a difference of \u003Cabbr title=\u0022Periapsis\u0022\u003EPe\u003C/abbr\u003E altitude in reality would be to compute atmospheric drag (though believe none of the add-ons you mentioned do). And when atmospheric drag is considered, a difference could be due to the rotation of the asteroid itself because of the \u003Ca href=\u0022https://en.wikipedia.org/wiki/Magnus_effect\u0022 rel=\u0022external nofollow\u0022\u003EMagnus effect\u003C/a\u003E.\n\u003C/p\u003E\n"},{"CreatedByName":"Drew Kerman","CreatedById":103177,"CreatedDateTime":"2017-05-18T21:27:56Z","Content":"\n\u003Cp\u003E\nthx \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/93700-diomedea/\u0026amp;do=hovercard\u0022 data-mentionid=\u002293700\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/93700-diomedea/\u0022 rel=\u0022\u0022\u003E@diomedea\u003C/a\u003E it looks like Persistent Rotation was the major culprit and an update today made things much better, I still see a small change on the order of meters even when Persistent Rotation is not installed, but nothing on the order of several Km or Mm of change anymore, so I can chalk that up to precision problems\n\u003C/p\u003E\n"}]}