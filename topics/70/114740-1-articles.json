{"TopicId":114740,"ForumId":70,"TopicTitle":"[v1.0.4] Gamebreaking Gimbal Bug with Video","CreatedByName":"OddFunction","CreatedById":143805,"CreatedDateTime":"2015-07-01T07:54:55Z","PageNum":1,"Articles":[{"CreatedByName":"OddFunction","CreatedById":143805,"CreatedDateTime":"2015-07-01T07:54:55Z","Content":"-------------------------------------------------------------------------------------\n\n**Workaround: Remove FAR Mod**\n\n-------------------------------------------------------------------------------------\n\nWhen leaving Kerbins sphere of influence the craft will freak out, SAS \u002B RCS will become meaningless, and engines will accelerate in random directions making the craft unusable.\n\nCurrent reproduction steps:\n\n-Make a 2 stage rocket. Stage one gets you into orbit. Stage two will transfer you to Minmus. Make sure stage 2 uses a terrier.\n\n-Make sure you are on course with Minmus, I usually put my low orbit around 20km. \n\n-When you get to Minmus and are about to burn retrograde in order to establish a good orbit then very soon after burning retrograde the craft will spin out of control rapidly.\n\nThis occurs with both manned and unmanned craft. I seem to have gotten to the Mun fine but I cannot do anything except fly past Minmus because of this glitch.\n\nKSP.Log\n\n[https://mega.co.nz/#!cF0RBQBS!VG8TwTAGAzWSmBz5wG4qejKcPOP4y9st7uqe1yvVn2I](https://mega.co.nz/#!cF0RBQBS!VG8TwTAGAzWSmBz5wG4qejKcPOP4y9st7uqe1yvVn2I)\n\nOutput log\n\n[https://mega.co.nz/#!QV1HUBbJ!q7lqpAaWcaUwZcgvOyUU8h9N8yhZDjD4hOkYs-Q5YLw](https://mega.co.nz/#!QV1HUBbJ!q7lqpAaWcaUwZcgvOyUU8h9N8yhZDjD4hOkYs-Q5YLw)\n\nI had to use Mega because pastebin has rediculous file size limits.\n\nLinux Mint 64bit\n\nKSP 1.0.4 64bit\n\nNew gamesave as of today\n\nList of my mods:\n\n[http://i.imgur.com/clo63be.png](http://i.imgur.com/clo63be.png)\n\n[http://i.imgur.com/KuUyve7.png](http://i.imgur.com/KuUyve7.png)\n\n[http://i.imgur.com/ZZOtSBz.png](http://i.imgur.com/ZZOtSBz.png)\n\nI can provide more info if needed.\n\n- - - Updated - - -\n\nHere is a video. I tried twice to upload it to youtube, but apparently it is \u0027too long\u0027 (even though its only 20 mins). So I uploaded the video to Mega. You can view it with VLC player... or really any video player made this decade.\n\n**Link to Video:**\n\n[https://mega.co.nz/#!5MkxxIaI!gGtbYem6oDgBQ9ltpsNC2s1x1YLPmE0E6cS1ExNA5so](https://mega.co.nz/#%215MkxxIaI%21gGtbYem6oDgBQ9ltpsNC2s1x1YLPmE0E6cS1ExNA5so)\n\n*Video is MKV format coming in at 150mb*\n\n**Key:**\n\n@ 18:15 I start my Minmus orbital burn\n\n@ 18:23 you see the glitch for the first time\n\n@ 19:13 you can see that SRS does nothing\n\n@ 20:00 youll see a gimbal test\n\nGimbal Locked = No glitch\n\nProven @ 20:15\n\nGimbal Free = Glitch\n\nProven @ 20:30\n\n**Edited \u003Ctime datetime=\u00222015-07-02T03:12:20Z\u0022 title=\u002207/02/2015 03:12  AM\u0022 data-short=\u00229 yr\u0022\u003EJuly 2, 2015\u003C/time\u003E by OddFunction**"},{"CreatedByName":"c4stor","CreatedById":147285,"CreatedDateTime":"2015-07-01T13:24:15Z","Content":"Hi, i can confirm this bug. Experienced it with the Terrier like you while landing on the Mun but also while slowing down final descent on Kerbin. Seems like the gimbal deflects the oppossing way as the pod-internal gyro torque while heading retrograde which spins the vessel out of control above a certain thrustlevel. Locking the gimbal helps.\n\nKSP 1.0.4 32bit on Win7\n\nAlso using some mods, but none which alter the engines."},{"CreatedByName":"Torih","CreatedById":144304,"CreatedDateTime":"2015-07-01T18:52:39Z","Content":"I was getting this and removing FAR seems to have stopped it. However it wasn\u0027t occurring all the time, so its hard to tell if its definitely fixed.."},{"CreatedByName":"OddFunction","CreatedById":143805,"CreatedDateTime":"2015-07-02T03:01:42Z","Content":"\u003E \n\u003E Hi, i can confirm this bug. Experienced it with the Terrier like you while landing on the Mun but also while slowing down final descent on Kerbin. Seems like the gimbal deflects the oppossing way as the pod-internal gyro torque while heading retrograde which spins the vessel out of control above a certain thrustlevel. Locking the gimbal helps.\n\u003E KSP 1.0.4 32bit on Win7\n\u003E \n\u003E Also using some mods, but none which alter the engines.\n\nAre you using FAR? I\u0027m going to test removing FAR in a bit.\n\nEDIT: Seems to be confirmed by other people in the FAR thread.\n\n**Edited \u003Ctime datetime=\u00222015-07-02T03:06:10Z\u0022 title=\u002207/02/2015 03:06  AM\u0022 data-short=\u00229 yr\u0022\u003EJuly 2, 2015\u003C/time\u003E by OddFunction**"},{"CreatedByName":"ferram4","CreatedById":21328,"CreatedDateTime":"2015-07-02T03:48:55Z","Content":"I think I have a possible mechanism for this.\n\nSo, we\u0027re looking at ModuleGimbal PartModules, that determine how they should react based on the vessel CoM, which is set in the FlightIntegrator (for stock) or ModularFlightIntegrator (for FAR and other mods that require it) VesselModule. The code between the two for setting CoM is identical, but the results affecting gimbaling but not control surfaces, reaction wheels, or control inputs indicates a CoM error. Further, that the error requires velocities \u003C 750 m/s indicates that a relatively high world velocity is needed.\n\nSo, let\u0027s consider what happens if the VesselModule runs first: it calculates the CoM of the vessel, and then the PartModules come along to make use of the CoM calculated *that frame*; everything works as it should.\n\nWhat happens if the PartModules run first? The CoM location used by the gimbal PartModules is the CoM location *from the previous frame*; below 750 m/s, when Krakensbane isn\u0027t active, that can be as much as 750 m/s \\* 0.02s per frame = 15 m away, which could be enough to cause issues on short vehicles. It should also vary with vehicle orientation, and tests in the FAR thread seem to indicate that.\n\nAlright, so if this *is* the mechanism, it\u0027s an order of operations issue. Why would that happen? VesselModules and PartModules are both derived from Unity\u0027s MonoBehaviour class, which execute most of the code in the game. MonoBehaviours have each of their functions executed in the order that they were created, so if you get PartModules that exist before VesselModules, then the PartModules should run first.\n\nIf this is an issue, it should actually be reproducible in stock as well; undock a short vehicle from a station (read: create a new vessel and new VesselModule, but with old parts and PartModules) and then bring it below 750 m/s and the issue should appear. If that shows the problem, then ultimately this is just an exacerbated stock issue of relying too heavily on order of operations to get things done.\n\nAt the moment I\u0027m not sure why ModularFlightintegrator is being added late though. It should be added in the same mechanism that FlightIntegrator is, so I\u0027m a little stumped right now as to how to solve it. I should be able to get something together though."},{"CreatedByName":"GorillaZilla","CreatedById":100625,"CreatedDateTime":"2015-07-02T07:30:39Z","Content":"I can confirm after watching the video, this is Exactly the problem I\u0027m having also.... Burning retrograde, soon as speed goes under 750ish the gimbals start vectoring in exactly the wrong way. You can see this by turning off sas, and drifting around to retrograde, Firing the engine then using reversed controls to steer left to go right, up to go down ect.... And it will then steer where you want. Another thing is the speed has to be above about 200.\n\nAlso, in all my testing it never happens in stock. Quick loading back, quitting game removing FAR and doing the exact same braking manouver as before without FAR installed and the bug won\u0027t ever happen. But will definately test undocking a ship then testing in stock...\n\nRe install FAR, come back and bug will happen every time again.\n\nFunny thing is, if you launch the ship and don\u0027t leave it and return, or quicksave and quickload at any point, and fly all the way to where the bug would normally happen in one take. Then the bug won\u0027t happen.\n\nBut as soon as you leave and return, or quickload it enables the bug.\n\nSomething changes in the save file when you load the ship back in, and it\u0027s per ship rather than the whole save.\n\nAnd it\u0027s this change that enables the bug.\n\nHeres more detailed information in the FAR thread, tests and test results ect...\n\n[http://forum.kerbalspaceprogram.com/threads/20451-1-0-4-Ferram-Aerospace-Research-v0-15-3-1-Garabedian-6-22-15/page1043](https://forum.kerbalspaceprogram.com/threads/20451-1-0-4-Ferram-Aerospace-Research-v0-15-3-1-Garabedian-6-22-15/page1043)\n\n**Edited \u003Ctime datetime=\u00222015-07-02T07:42:43Z\u0022 title=\u002207/02/2015 07:42  AM\u0022 data-short=\u00229 yr\u0022\u003EJuly 2, 2015\u003C/time\u003E by GorillaZilla**"},{"CreatedByName":"WeirdCulture","CreatedById":76591,"CreatedDateTime":"2015-07-08T14:11:00Z","Content":"FAR has nothing to do with this... ![:(](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_sad.gif) i had this too and I am not using FAR"},{"CreatedByName":"OddFunction","CreatedById":143805,"CreatedDateTime":"2015-07-08T19:23:59Z","Content":"\u003E \n\u003E FAR has nothing to do with this... ![:(](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_sad.gif) i had this too and I am not using FAR\n\nI think what ferram was trying to say is that the problem does indeed exist in stock but using FAR will exacerbate the problem. \n\nSo, you had the same problem as us only without far? How similar was your encounter to ours? For example, does your engine start bugging out around 750m/s or another speed? If you post some information such a OS/Modlist/reproduction steps etc it would be interesting to have your case logged as well."},{"CreatedByName":"ferram4","CreatedById":21328,"CreatedDateTime":"2015-07-08T23:48:40Z","Content":"Depending on whether Modular Flight Integrator 1.1.1 works with the current FAR, this issue should be fixed. If it doesn\u0027t that\u0027ll be fixed with the next FAR release."},{"CreatedByName":"OddFunction","CreatedById":143805,"CreatedDateTime":"2015-07-09T00:04:02Z","Content":"\u003E \n\u003E Depending on whether Modular Flight Integrator 1.1.1 works with the current FAR, this issue should be fixed. If it doesn\u0027t that\u0027ll be fixed with the next FAR release.\n\nThanks for the update and the effort!"}]}