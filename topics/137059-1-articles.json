{"TopicId":137059,"ForumId":29,"TopicTitle":"Changes to IPartMassModifier, IPartCostModifier, and IPartSizeModifier in build 1209","CreatedByName":"blowfish","CreatedById":119688,"CreatedDateTime":"2016-04-16T08:22:31Z","PageNum":1,"Articles":[{"CreatedByName":"blowfish","CreatedById":119688,"CreatedDateTime":"2016-04-16T08:22:31Z","Content":"\n\u003Cp\u003E\nThese interfaces (used by many mods to set mass and cost) underwent some major changes in build 1209 (quite possibly what caused so many mods to stop working). \u00A0This is the result of\u00A0\u003Ca href=\u0022http://bugs.kerbalspaceprogram.com/issues/8908\u0022 rel=\u0022external nofollow\u0022\u003Ethis thread\u003C/a\u003E\u00A0in the issue tracker. \u00A0The basic idea is that it allows mods which do delta-v or other flight simulations to know how a module\u0027s mass might change in flight. \u00A0As best I can tell, KSP doesn\u0027t do anything with these changes directly. \u00A0In this post, I will try to document these changes, but keep in mind that what\u0027s presented here is a best guess based on available metadata, the issue mentioned above, and a couple of conversations on IRC. \u00A0Will try to update as more information becomes available.\n\u003C/p\u003E\n\u003Cp\u003E\nThe new interfaced definitions are as follows:\n\u003C/p\u003E\n\u003Cp\u003E\n(definitions generated by Visual Studio from DLL metadata)\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint prettyprinted\u0022\u003E\n\u003Cspan\u003Epublic\u003C/span\u003E\u003Cspan\u003E interface \u003C/span\u003E\u003Cspan\u003EIPartMassModifier\u003C/span\u003E\u003Cspan\u003E\n\u003C/span\u003E\u003Cspan\u003E{\u003C/span\u003E\u003Cspan\u003E\n    \u003C/span\u003E\u003Cspan\u003Efloat\u003C/span\u003E\u003Cspan\u003E \u003C/span\u003E\u003Cspan\u003EGetModuleMass\u003C/span\u003E\u003Cspan\u003E(\u003C/span\u003E\u003Cspan\u003Efloat\u003C/span\u003E\u003Cspan\u003E defaultMass\u003C/span\u003E\u003Cspan\u003E,\u003C/span\u003E\u003Cspan\u003E \u003C/span\u003E\u003Cspan\u003EModifierStagingSituation\u003C/span\u003E\u003Cspan\u003E sit\u003C/span\u003E\u003Cspan\u003E);\u003C/span\u003E\u003Cspan\u003E\n    \u003C/span\u003E\u003Cspan\u003EModifierChangeWhen\u003C/span\u003E\u003Cspan\u003E \u003C/span\u003E\u003Cspan\u003EGetModuleMassChangeWhen\u003C/span\u003E\u003Cspan\u003E();\u003C/span\u003E\u003Cspan\u003E\n\u003C/span\u003E\u003Cspan\u003E}\u003C/span\u003E\u003Cspan\u003E\n\n\u003C/span\u003E\u003Cspan\u003Epublic\u003C/span\u003E\u003Cspan\u003E interface \u003C/span\u003E\u003Cspan\u003EIPartCostModifier\u003C/span\u003E\u003Cspan\u003E\n\u003C/span\u003E\u003Cspan\u003E{\u003C/span\u003E\u003Cspan\u003E\n    \u003C/span\u003E\u003Cspan\u003Efloat\u003C/span\u003E\u003Cspan\u003E \u003C/span\u003E\u003Cspan\u003EGetModuleCost\u003C/span\u003E\u003Cspan\u003E(\u003C/span\u003E\u003Cspan\u003Efloat\u003C/span\u003E\u003Cspan\u003E defaultCost\u003C/span\u003E\u003Cspan\u003E,\u003C/span\u003E\u003Cspan\u003E \u003C/span\u003E\u003Cspan\u003EModifierStagingSituation\u003C/span\u003E\u003Cspan\u003E sit\u003C/span\u003E\u003Cspan\u003E);\u003C/span\u003E\u003Cspan\u003E\n    \u003C/span\u003E\u003Cspan\u003EModifierChangeWhen\u003C/span\u003E\u003Cspan\u003E \u003C/span\u003E\u003Cspan\u003EGetModuleCostChangeWhen\u003C/span\u003E\u003Cspan\u003E();\u003C/span\u003E\u003Cspan\u003E\n\u003C/span\u003E\u003Cspan\u003E}\u003C/span\u003E\u003Cspan\u003E\n\n\u003C/span\u003E\u003Cspan\u003Epublic\u003C/span\u003E\u003Cspan\u003E interface \u003C/span\u003E\u003Cspan\u003EIPartSizeModifier\u003C/span\u003E\u003Cspan\u003E\n\u003C/span\u003E\u003Cspan\u003E{\u003C/span\u003E\u003Cspan\u003E\n    \u003C/span\u003E\u003Cspan\u003EVector3\u003C/span\u003E\u003Cspan\u003E \u003C/span\u003E\u003Cspan\u003EGetModuleSize\u003C/span\u003E\u003Cspan\u003E(\u003C/span\u003E\u003Cspan\u003EVector3\u003C/span\u003E\u003Cspan\u003E defaultSize\u003C/span\u003E\u003Cspan\u003E,\u003C/span\u003E\u003Cspan\u003E \u003C/span\u003E\u003Cspan\u003EModifierStagingSituation\u003C/span\u003E\u003Cspan\u003E sit\u003C/span\u003E\u003Cspan\u003E);\u003C/span\u003E\u003Cspan\u003E\n    \u003C/span\u003E\u003Cspan\u003EModifierChangeWhen\u003C/span\u003E\u003Cspan\u003E \u003C/span\u003E\u003Cspan\u003EGetModuleSizeChangeWhen\u003C/span\u003E\u003Cspan\u003E();\u003C/span\u003E\u003Cspan\u003E\n\u003C/span\u003E\u003Cspan\u003E}\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nThe new method \u003Cspan style=\u0022font-family:\u0027courier new\u0027, courier, monospace;\u0022\u003EGetModuleXXXChangedWhen()\u003C/span\u003E informs KSP (or some mod) of how the modifier will change (see enum definitions below with comments added by me)\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cspan style=\u0022font-family:\u0027courier new\u0027, courier, monospace;\u0022\u003EGetModuleMass/Cost/Size()\u003C/span\u003E work as before unless the part\u0027s mass is supposed to change on staging (i.e. if \u003Cspan style=\u0022font-family:\u0027courier new\u0027, courier, monospace;\u0022\u003EGetModuleXXXChangedWhen()\u003C/span\u003E returns \u003Cspan style=\u0022font-family:\u0027courier new\u0027, courier, monospace;\u0022\u003EModifierChangedWhen.STAGED\u003C/span\u003E). \u00A0In that case, it should change based on the staging situation, so that simulations know the correct mass before and after staging. \u00A0I think that KSP will always pass \u003Cspan style=\u0022font-family:\u0027courier new\u0027, courier, monospace;\u0022\u003EModifierStagingSituation.CURRENT\u003C/span\u003E when trying to get the correct physics mass in flight (and this is still done every frame regardless).\n\u003C/p\u003E\n\u003Cp\u003E\nThe two enums are as follows\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint prettyprinted\u0022\u003E\n\u003Cspan\u003Epublic\u003C/span\u003E\u003Cspan\u003E \u003C/span\u003E\u003Cspan\u003Eenum\u003C/span\u003E\u003Cspan\u003E \u003C/span\u003E\u003Cspan\u003EModifierStagingSituation\u003C/span\u003E\u003Cspan\u003E\n\u003C/span\u003E\u003Cspan\u003E{\u003C/span\u003E\u003Cspan\u003E\n    CURRENT \u003C/span\u003E\u003Cspan\u003E=\u003C/span\u003E\u003Cspan\u003E \u003C/span\u003E\u003Cspan\u003E0\u003C/span\u003E\u003Cspan\u003E,\u003C/span\u003E\u003Cspan\u003E\t\t\u003C/span\u003E\u003Cspan\u003E// Current mass\u003C/span\u003E\u003Cspan\u003E\n    UNSTAGED \u003C/span\u003E\u003Cspan\u003E=\u003C/span\u003E\u003Cspan\u003E \u003C/span\u003E\u003Cspan\u003E1\u003C/span\u003E\u003Cspan\u003E,\u003C/span\u003E\u003Cspan\u003E\t\u003C/span\u003E\u003Cspan\u003E// Mass before staging, for sims ... may not be guaranteed to give correct mass after the part has actually been staged\u003C/span\u003E\u003Cspan\u003E\n    STAGED \u003C/span\u003E\u003Cspan\u003E=\u003C/span\u003E\u003Cspan\u003E \u003C/span\u003E\u003Cspan\u003E2\u003C/span\u003E\u003Cspan\u003E\t\t\u003C/span\u003E\u003Cspan\u003E// Mass after staging, for sims\u003C/span\u003E\u003Cspan\u003E\n\u003C/span\u003E\u003Cspan\u003E}\u003C/span\u003E\u003Cspan\u003E\n\n\u003C/span\u003E\u003Cspan\u003Epublic\u003C/span\u003E\u003Cspan\u003E \u003C/span\u003E\u003Cspan\u003Eenum\u003C/span\u003E\u003Cspan\u003E \u003C/span\u003E\u003Cspan\u003EModifierChangeWhen\u003C/span\u003E\u003Cspan\u003E\n\u003C/span\u003E\u003Cspan\u003E{\u003C/span\u003E\u003Cspan\u003E\n    FIXED \u003C/span\u003E\u003Cspan\u003E=\u003C/span\u003E\u003Cspan\u003E \u003C/span\u003E\u003Cspan\u003E0\u003C/span\u003E\u003Cspan\u003E,\u003C/span\u003E\u003Cspan\u003E\t\t\u003C/span\u003E\u003Cspan\u003E// Mass will be set once and never changed\u003C/span\u003E\u003Cspan\u003E\n    STAGED \u003C/span\u003E\u003Cspan\u003E=\u003C/span\u003E\u003Cspan\u003E \u003C/span\u003E\u003Cspan\u003E1\u003C/span\u003E\u003Cspan\u003E,\u003C/span\u003E\u003Cspan\u003E\t\t\u003C/span\u003E\u003Cspan\u003E// Mass will change when staged\u003C/span\u003E\u003Cspan\u003E\n    CONSTANTLY \u003C/span\u003E\u003Cspan\u003E=\u003C/span\u003E\u003Cspan\u003E \u003C/span\u003E\u003Cspan\u003E2\u003C/span\u003E\u003Cspan\u003E\t\u003C/span\u003E\u003Cspan\u003E// Mass changes constantly\u003C/span\u003E\u003Cspan\u003E\n\u003C/span\u003E\u003Cspan\u003E}\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nHope that helps a bit...\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-04-16T08:27:03Z\u0022 title=\u002204/16/2016 08:27  AM\u0022 data-short=\u00228 yr\u0022\u003EApril 16, 2016\u003C/time\u003E by blowfish\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"pellinor","CreatedById":85299,"CreatedDateTime":"2016-04-16T11:32:45Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222516500\u0022 data-ipsquote-contentid=\u0022137059\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221460794951\u0022 data-ipsquote-userid=\u0022119688\u0022 data-ipsquote-username=\u0022blowfish\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n3 hours ago, blowfish said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\n\u003Cspan\u003Epublic\u003C/span\u003E\u003Cspan\u003E interface \u003C/span\u003E\u003Cspan\u003EIPartSizeModifier\u003C/span\u003E\u003Cspan\u003E \u003C/span\u003E\u003Cspan\u003E{\u003C/span\u003E\u003Cspan\u003E \u003C/span\u003E\u003Cspan\u003EVector3\u003C/span\u003E\u003Cspan\u003E \u003C/span\u003E\u003Cspan\u003EGetModuleSize\u003C/span\u003E\u003Cspan\u003E(\u003C/span\u003E\u003Cspan\u003EVector3\u003C/span\u003E\u003Cspan\u003E defaultSize\u003C/span\u003E\u003Cspan\u003E,\u003C/span\u003E\u003Cspan\u003E \u003C/span\u003E\u003Cspan\u003EModifierStagingSituation\u003C/span\u003E\u003Cspan\u003E sit\u003C/span\u003E\u003Cspan\u003E);\u003C/span\u003E\u003Cspan\u003E \u003C/span\u003E\u003Cspan\u003EModifierChangeWhen\u003C/span\u003E\u003Cspan\u003E \u003C/span\u003E\u003Cspan\u003EGetModuleSizeChangeWhen\u003C/span\u003E\u003Cspan\u003E();\u003C/span\u003E\u003Cspan\u003E \u003C/span\u003E\u003Cspan\u003E}\u003C/span\u003E\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nAny idea how this is supposed to work, or what it is used for? 3 dimensional size does not simply add up like mass or cost.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-04-16T11:33:36Z\u0022 title=\u002204/16/2016 11:33  AM\u0022 data-short=\u00228 yr\u0022\u003EApril 16, 2016\u003C/time\u003E by pellinor\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"FreeThinker","CreatedById":117389,"CreatedDateTime":"2016-04-16T11:37:41Z","Content":"\n\u003Cp\u003E\nFor IFS I simply return dry mass and current cost\n\u003C/p\u003E\n"},{"CreatedByName":"blowfish","CreatedById":119688,"CreatedDateTime":"2016-04-16T18:10:38Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222516676\u0022 data-ipsquote-contentid=\u0022137059\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221460806365\u0022 data-ipsquote-userid=\u002285299\u0022 data-ipsquote-username=\u0022pellinor\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n6 hours ago, pellinor said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nAny idea how this is supposed to work, or what it is used for? 3 dimensional size does not simply add up like mass or cost.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nNo idea really. \u00A0I think it might add them to determine the ship\u0027s size (for runway/launchpad limitations), but I\u0027m not really sure. \u00A0I just saw that this was one of the interfaces that changed.\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222516682\u0022 data-ipsquote-contentid=\u0022137059\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221460806661\u0022 data-ipsquote-userid=\u0022117389\u0022 data-ipsquote-username=\u0022FreeThinker\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n6 hours ago, FreeThinker said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nFor IFS I simply return dry mass and current cost\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nYup. \u00A0These advanced features really only matter if the mass changes on staging, which in this case it doesn\u0027t. \u00A0Should be safe to ignore\u00A0ModifierStagingSituation and return\u00A0ModifierChangeWhen.FIXED for these.\n\u003C/p\u003E\n"},{"CreatedByName":"NathanKell","CreatedById":75006,"CreatedDateTime":"2016-04-17T02:35:58Z","Content":"\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022http://forum.kerbalspaceprogram.com/index.php?/profile/117389-freethinker/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022117389\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/117389-freethinker/\u0022 id=\u0022ips_uid_4799_5\u0022\u003E@FreeThinker\u003C/a\u003E I hope you mean you return the delta between prefab mass and dry mass, and prefab cost and dry cost, or you will be implementing the interface incorrectly and leaving the user with more mass and cost than you wish.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022http://forum.kerbalspaceprogram.com/index.php?/profile/85299-pellinor/\u0026amp;do=hovercard\u0022 data-mentionid=\u002285299\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/85299-pellinor/\u0022\u003E@pellinor\u003C/a\u003E it works just like the others: you report the delta from the prefab.\n\u003C/p\u003E\n\u003Cp\u003E\nIf the prefab\u0027s bounds are 5,6,7 and the current object\u0027s bounds are 10,11,5 (and you caused that change) then you should report 5,5,-2.\n\u003C/p\u003E\n"},{"CreatedByName":"NathanKell","CreatedById":75006,"CreatedDateTime":"2016-04-18T02:09:51Z","Content":"\n\u003Cp\u003E\nTurns out the way IPartSizeModifier was used was...nuts.\n\u003C/p\u003E\n\u003Cp\u003E\nI have now fixed it for the next build. \u003Cstrong\u003EHowever\u003C/strong\u003E that necessitates a change in what it should return. Since the bounds calculated for an object apart from that modifier are based on the renderer bounds, when the situation passed to GetModuleSize() is CURRENT, you should return 0, \u003Cstrong\u003Eunless\u003C/strong\u003E you want to specify a size different from your actual rendered size. STAGED and UNSTAGED should report as normal. Further, the size passed to the modifier will always be zero.\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cstrong\u003ENote this is a departure from the other modifiers\u0027 behavior, which report the prefab value and expect delta from the prefab.\u003C/strong\u003E\n\u003C/p\u003E\n"},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2016-04-18T07:51:13Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222519614\u0022 data-ipsquote-contentid=\u0022137059\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221460945391\u0022 data-ipsquote-userid=\u002275006\u0022 data-ipsquote-username=\u0022NathanKell\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n5 hours ago, NathanKell said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nTurns out the way IPartSizeModifier was used was...nuts\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nDon\u0027t suppose that would be related to how it was being called with atleast two different input values over 4 calls each resize in 1.0.x (? Probably..., can\u0027t remember exactly which version I looked at it and then decided it was bonkers)\u003Cspan style=\u0022font-size:14px;\u0022\u003E and/or the negative vessel sizes...\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nAnyway just to make sure I understand this, can you confirm when you say rendered size that is the actual size of the visible mesh for that part instance. Then the (un)staged responses are still the prefab diffs?\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-04-18T07:52:33Z\u0022 title=\u002204/18/2016 07:52  AM\u0022 data-short=\u00228 yr\u0022\u003EApril 18, 2016\u003C/time\u003E by Crzyrndm\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"NathanKell","CreatedById":75006,"CreatedDateTime":"2016-04-18T07:58:06Z","Content":"\n\u003Cp\u003E\nCurrently nothing in our code will check size except for the engineer report or for determining launch constraints (same call). That call will pass 0 as the size input. That call will pass CURRENT as the regime.\n\u003C/p\u003E\n\u003Cp\u003E\nOh, crap, also, when saving a Ship Construct we call it to record it in the protopartsnapshot. There, CURRENT is used but the ship size is passed as the size.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nThe bounds reported by the bounding method, prior to PartSizeModifier, are based on the renderer bounds of the given renderer. There used to be multiple calls because there are multiple renderers for some parts. I\u0027d like to say the renderer bounds are correct, but the inflatable heat shield has proved that that is not always the case with skinned meshrenderers. For this reason we support the new field Part.boundsMultiplier to correct for such problems.\n\u003C/p\u003E\n"},{"CreatedByName":"NathanKell","CreatedById":75006,"CreatedDateTime":"2016-04-18T16:53:47Z","Content":"\n\u003Cp\u003E\nModified the IPartSizeModifier again based on those points.\n\u003C/p\u003E\n\u003Cp\u003E\nNew behavior:\n\u003C/p\u003E\n\u003Cp\u003E\nDuring ship bounds calculation it will be called once per renderer bounds now, passed the bounds size. You should report the delta from those bounds (if they are incorrect). In addition, when a ship is saved, it will be called once again, with the last stored base bounds where you should again report offset from those bounds.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nWhat remains is that unlike the other modifiers, it is passed data regarding the part\u0027s current state, and should report a delta from that state, rather than from prefab.\n\u003C/p\u003E\n"},{"CreatedByName":"Warezcrawler","CreatedById":145377,"CreatedDateTime":"2017-01-28T21:58:04Z","Content":"\n\u003Cp\u003E\nI\u0027ve been trying to implement, that cost of parts with my module changes when the mode of the module is changed in the \u003Cabbr title=\u0022Vehicle Assembly Building\u0022\u003EVAB\u003C/abbr\u003E/\u003Cabbr title=\u0022SpacePlane Hangar\u0022\u003ESPH\u003C/abbr\u003E. As far as I can figure, the \u0022GetModuleCost\u0022 is the thing I need to achieve this. However, every time I put that into my plugin, KSP will not load... So I\u0027m definitely doing it wrong.\n\u003C/p\u003E\n\u003Cp\u003E\nWhat I try to do is something like the following (highlights)\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003Epartial class GTI_MultiModeEngineFX : PartModule, IPartCostModifier     //So I\u0027ve added the IPartCostModifier to the class\n{\n\n  private void updatePropulsion()          //This is the update method I call when the mode of the module is triggered\n  {\n      ...\t\t\t//Do I need to call GetModuleCost from here?\n  }\n\n  public float UpdateCost()\n  {\n      return 1000f;\t\t\t//Placeholder for actually calculating the added cost\n  }\n\n  public float GetModuleCost(float defaultCost, ModifierStagingSituation sit)\t\t//How I think this should be...\n  {\n\treturn UpdateCost();\t\t//Calling a function for dynamic updating of the costs\n  }\n  public ModifierChangeWhen GetModuleCostChangeWhen()\n  {\n\treturn ModifierChangeWhen.FIXED;\n  }\n\n}\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nDoes anyone have some advise on how to proceed with modifying costs of part by code?\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222017-01-28T22:12:21Z\u0022 title=\u002201/28/2017 10:12  PM\u0022 data-short=\u00227 yr\u0022\u003EJanuary 28, 2017\u003C/time\u003E by Warezcrawler\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"blowfish","CreatedById":119688,"CreatedDateTime":"2017-01-28T22:10:20Z","Content":"\n\u003Cp\u003E\nKSP not loading points to something more serious going on. \u00A0Logs, as usual, probably hold the answer.\n\u003C/p\u003E\n\u003Cp\u003E\nYou shouldn\u0027t need to call GetModuleCost yourself. \u00A0KSP will call it automatically when the ship updates in the editor to recalculate the cost.\n\u003C/p\u003E\n\u003Cp\u003E\nAlso in your code\u00A0UpdateCost has no return type. \u00A0That won\u0027t compile...\n\u003C/p\u003E\n"},{"CreatedByName":"Warezcrawler","CreatedById":145377,"CreatedDateTime":"2017-01-28T22:16:34Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222937595\u0022 data-ipsquote-contentid=\u0022137059\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221485641420\u0022 data-ipsquote-userid=\u0022119688\u0022 data-ipsquote-username=\u0022blowfish\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n2 minutes ago, blowfish said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nKSP not loading points to something more serious going on. \u00A0Logs, as usual, probably hold the answer.\n\u003C/p\u003E\n\u003Cp\u003E\nYou shouldn\u0027t need to call GetModuleCost yourself. \u00A0KSP will call it automatically when the ship updates in the editor to recalculate the cost.\n\u003C/p\u003E\n\u003Cp\u003E\nAlso in your code\u00A0UpdateCost has no return type. \u00A0That won\u0027t compile...\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nYou are right about the return type thing, that was a copy-paste error on my part. Sorry.\n\u003C/p\u003E\n\u003Cp\u003E\nI yes it does point to something more severe, which is why I was asking and giving this highlights example. If the example itself is not missing a key part, and therefore in theory should work, then I at least know that it should work. That info would be great.\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222937595\u0022 data-ipsquote-contentid=\u0022137059\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221485641420\u0022 data-ipsquote-userid=\u0022119688\u0022 data-ipsquote-username=\u0022blowfish\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n5 minutes ago, blowfish said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nKSP will call it automatically when the ship updates in the editor to recalculate the cost.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nHow will it know when to recalculate? My module does something similar to tank switching, and on that user input it needs to update the costs.\n\u003C/p\u003E\n"},{"CreatedByName":"blowfish","CreatedById":119688,"CreatedDateTime":"2017-01-28T22:24:22Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222937602\u0022 data-ipsquote-contentid=\u0022137059\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221485641794\u0022 data-ipsquote-userid=\u0022145377\u0022 data-ipsquote-username=\u0022Warezcrawler\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n8 minutes ago, Warezcrawler said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nHow will it know when to recalculate? My module does something similar to tank switching, and on that user input it needs to update the costs.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nI think it listens for the \u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003EonEditorShipModified \u003C/span\u003Egame event. \u00A0Most UI events will trigger that automatically.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222017-01-28T22:25:28Z\u0022 title=\u002201/28/2017 10:25  PM\u0022 data-short=\u00227 yr\u0022\u003EJanuary 28, 2017\u003C/time\u003E by blowfish\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Warezcrawler","CreatedById":145377,"CreatedDateTime":"2017-01-29T16:54:35Z","Content":"\n\u003Cp\u003E\nThanks for the answers\u00A0\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/119688-blowfish/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022119688\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/119688-blowfish/\u0022 rel=\u0022\u0022\u003E@blowfish\u003C/a\u003E.\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222937595\u0022 data-ipsquote-contentid=\u0022137059\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221485641420\u0022 data-ipsquote-userid=\u0022119688\u0022 data-ipsquote-username=\u0022blowfish\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n18 hours ago, blowfish said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nYou shouldn\u0027t need to call GetModuleCost yourself. \u00A0KSP will call it automatically when the ship updates in the editor to recalculate the cost.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nWell after messing around a lot, I got it to work somewhat. I don\u0027t know why KSP wasn\u0027t loading. But I removed this entirely and implemented from the top once more. Apparently the error I made the first couple of time was avoided this time around \u003Cimg alt=\u0022:confused:\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_huh.gif\u0022 title=\u0022:confused:\u0022\u003E....\n\u003C/p\u003E\n\u003Cp\u003E\nHowever, the calculation is firing all the time, both in editor and in flight.\n\u003C/p\u003E\n\u003Cp\u003E\nIt tried\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003Epublic float GetModuleCost(float defaultCost, ModifierStagingSituation sit)\n{\n  return UpdateCost();\n}\n\npublic float UpdateCost()\n{\n  Debug.Log(\u0022UpdateCost()\u0022);\n  return 100000f \u002B selectedPropulsion;\n}\n\npublic ModifierChangeWhen GetModuleCostChangeWhen()\n{\n  Debug.Log(\u0022GetModuleCostChangeWhen()\u0022);\n  return ModifierChangeWhen.FIXED;\n}\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nBut it seem that GetModuleCostChangeWhen()\u00A0is not firing at all. And my log is being spammed with \u0022UpdateCost()\u0022....\n\u003C/p\u003E\n\u003Cp\u003E\nBasically I do not understand why I would have it fire in flight at all. In the editor I can live with it firing. However, I do not see the point in recalculating unless something is changed. Is there some way of doing this calculation thing manually? Like only calling it manually?\n\u003C/p\u003E\n"},{"CreatedByName":"blowfish","CreatedById":119688,"CreatedDateTime":"2017-01-29T19:35:50Z","Content":"\n\u003Cp\u003E\nGetModuleCost should not be called every frame. \u00A0If it is, something is unnecessarily triggering updates (verified this). \u00A0You might be able to figure out by printing \u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003ESystem.Environment.StackTrace\u003C/span\u003E\n\u003C/p\u003E\n"},{"CreatedByName":"Warezcrawler","CreatedById":145377,"CreatedDateTime":"2017-01-29T21:11:40Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222938383\u0022 data-ipsquote-contentid=\u0022137059\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221485718550\u0022 data-ipsquote-userid=\u0022119688\u0022 data-ipsquote-username=\u0022blowfish\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n1 hour ago, blowfish said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nIf it is, something is unnecessarily triggering updates (verified this)\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nOk. When you say varified, is that that you recreated the behavior?\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222938383\u0022 data-ipsquote-contentid=\u0022137059\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221485718550\u0022 data-ipsquote-userid=\u0022119688\u0022 data-ipsquote-username=\u0022blowfish\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n1 hour ago, blowfish said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nYou might be able to figure out by printing \u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003ESystem.Environment.StackTrace\u003C/span\u003E\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nNever tried this before. So I guess a Debug.Log() with \u0022\u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003ESystem.Environment.StackTrace\u003C/span\u003E\u0022 in it. I will try that.\u00A0\u003Cimg alt=\u0022:cool:\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cool.gif\u0022 title=\u0022:cool:\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Warezcrawler","CreatedById":145377,"CreatedDateTime":"2017-01-29T21:28:41Z","Content":"\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/119688-blowfish/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022119688\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/119688-blowfish/\u0022 rel=\u0022\u0022\u003E@blowfish\u003C/a\u003E whooaaa..... I got some log from that... Think it might be Kerbal Engineer that is triggering it.....\n\u003C/p\u003E\n\u003Cdiv class=\u0022ipsSpoiler\u0022 data-ipsspoiler=\u0022\u0022\u003E\n\u003Cdiv class=\u0022ipsSpoiler_header\u0022\u003E\n\u003Cspan\u003ESpoiler\u003C/span\u003E\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsSpoiler_contents\u0022\u003E\n\u003Cp\u003E\n[LOG 22:20:39.107] UpdateCost() in LoadedSceneIsEditor\n\u003C/p\u003E\n\u003Cp\u003E\n[LOG 22:20:39.285] System.Environment.StackTrace\u003Cbr\u003E\n\u00A0 \u00A0at System.Environment.get_StackTrace()\u003Cbr\u003E\n\u00A0 \u00A0at GTI.GTI_MultiModeEngineFX.GetModuleCost(Single defaultCost, ModifierStagingSituation sit)\u003Cbr\u003E\n\u00A0 \u00A0at Part.GetModuleCosts(Single defaultCost, ModifierStagingSituation sit)\u003Cbr\u003E\n\u00A0 \u00A0at KerbalEngineer.Extensions.PartExtensions.GetCostDry(.Part part)\u003Cbr\u003E\n\u00A0 \u00A0at KerbalEngineer.VesselSimulator.PartSim.New(.Part p, Int32 id, Double atmosphere, KerbalEngineer.LogMsg log)\u003Cbr\u003E\n\u00A0 \u00A0at KerbalEngineer.VesselSimulator.Simulation.PrepareSimulation(KerbalEngineer.LogMsg _log, System.Collections.Generic.List\u00601 parts, Double theGravity, Double theAtmosphere, Double theMach, Boolean dumpTree, Boolean vectoredThrust, Boolean fullThrust)\u003Cbr\u003E\n\u00A0 \u00A0at KerbalEngineer.VesselSimulator.SimManager.StartSimulation()\u003Cbr\u003E\n\u00A0 \u00A0at KerbalEngineer.VesselSimulator.SimManager.TryStartSimulation()\u003Cbr\u003E\n\u00A0 \u00A0at KerbalEngineer.Editor.BuildAdvanced.Update()\n\u003C/p\u003E\n\u003Cp\u003E\n[LOG 22:20:39.287] UnityEngine.StackTraceUtility.ExtractStackTrace()\u003Cbr\u003E\nGTI.GTI_MultiModeEngineFX:GetModuleCost(Single, ModifierStagingSituation)\u003Cbr\u003E\nPart:GetModuleCosts(Single, ModifierStagingSituation)\u003Cbr\u003E\nKerbalEngineer.Extensions.PartExtensions:GetCostDry(Part)\u003Cbr\u003E\nKerbalEngineer.VesselSimulator.PartSim:New(Part, Int32, Double, LogMsg)\u003Cbr\u003E\nKerbalEngineer.VesselSimulator.Simulation:PrepareSimulation(LogMsg, List\u00601, Double, Double, Double, Boolean, Boolean, Boolean)\u003Cbr\u003E\nKerbalEngineer.VesselSimulator.SimManager:StartSimulation()\u003Cbr\u003E\nKerbalEngineer.VesselSimulator.SimManager:TryStartSimulation()\u003Cbr\u003E\nKerbalEngineer.Editor.BuildAdvanced:Update()\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/div\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://drive.google.com/open?id=0B8MQtxvD6CVRTEtfbGR6WTdsZGM\u0022 rel=\u0022external nofollow\u0022\u003EFull log file\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nSo where do I go from here. It does at least not seem like my mod is doing it....\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"blowfish","CreatedById":119688,"CreatedDateTime":"2017-01-29T22:25:30Z","Content":"\n\u003Cp\u003E\nYou could try to talk to the author of that mod about it. \u00A0Hard to say where that would go there since \u003Cabbr title=\u0022Kerbal Engineer Redux (mod)\u0022\u003EKER\u003C/abbr\u003E has been around for a while and I doubt that behavior has changed any time recently.\n\u003C/p\u003E\n\u003Cp\u003E\nBut if that fails, having it run every frame isn\u0027t the end of the world. \u00A0Mass updates run every frame both in the editor and flight even without mods. \u00A0A simple calculation running every frame will now impact performance. \u00A0You can memoize the value (store the result and just return that) if you want, but that\u0027s probably not even worth it. \u00A0I think the important part is to make sure that whatever you do there doesn\u0027t allocate any memory, since that can very quickly add up if you do it every frame.\n\u003C/p\u003E\n"},{"CreatedByName":"Warezcrawler","CreatedById":145377,"CreatedDateTime":"2017-01-30T19:46:59Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222938539\u0022 data-ipsquote-contentid=\u0022137059\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221485728730\u0022 data-ipsquote-userid=\u0022119688\u0022 data-ipsquote-username=\u0022blowfish\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n21 hours ago, blowfish said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nYou could try to talk to the author of that mod about it. \u00A0Hard to say where that would go there since \u003Cabbr title=\u0022Kerbal Engineer Redux (mod)\u0022\u003EKER\u003C/abbr\u003E has been around for a while and I doubt that behavior has changed any time recently.\n\u003C/p\u003E\n\u003Cp\u003E\nBut if that fails, having it run every frame isn\u0027t the end of the world. \u00A0Mass updates run every frame both in the editor and flight even without mods. \u00A0A simple calculation running every frame will now impact performance. \u00A0You can memoize the value (store the result and just return that) if you want, but that\u0027s probably not even worth it. \u00A0I think the important part is to make sure that whatever you do there doesn\u0027t allocate any memory, since that can very quickly add up if you do it every frame.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThanks. I will try out the \u003Cabbr title=\u0022Kerbal Engineer Redux (mod)\u0022\u003EKER\u003C/abbr\u003E thread. Maybe this has been overlooked, or KSP behavior changed since implementation.\n\u003C/p\u003E\n\u003Cp\u003E\nOtherwise I will consider storing the value and not calculating unless some boolean have changed... Subsidiary not having cost changes as a feature.\n\u003C/p\u003E\n\u003Cp\u003E\nThanks a lot for advise! I learned something, which makes this great\u00A0\u003Cimg alt=\u0022:cool:\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cool.gif\u0022 title=\u0022:cool:\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\n\u0022 \u003Cspan style=\u0022color:rgb(39,42,52);font-family:\u0027Courier New\u0027, Courier, monospace;font-size:14px;font-style:normal;font-weight:normal;letter-spacing:normal;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(251,251,251);float:none;\u0022\u003ESystem.Environment.StackTrace\u003C/span\u003E\u0022 is very helpful indeed.\n\u003C/p\u003E\n"}]}