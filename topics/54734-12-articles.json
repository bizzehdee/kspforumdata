{"TopicId":54734,"ForumId":36,"TopicTitle":"[1.2.0] Toolbar 1.7.13 - Common API for draggable/resizable buttons toolbar","CreatedByName":"blizzy78","CreatedById":68543,"CreatedDateTime":"2013-11-29T22:39:58Z","PageNum":12,"Articles":[{"CreatedByName":"akherber","CreatedById":101253,"CreatedDateTime":"2014-04-25T01:26:19Z","Content":"\n\u003Cp\u003Eblizzy.de correct? And is there an alternate mirror? Because your page won\u0027t hit here. The interwebs are being odd.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-04-25T01:28:50Z\u0022 title=\u002204/25/2014 01:28  AM\u0022 data-short=\u002210 yr\u0022\u003EApril 25, 2014\u003C/time\u003E by akherber\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"philotical","CreatedById":109390,"CreatedDateTime":"2014-05-02T19:00:33Z","Content":"\n\u003Cp\u003EHi Blizzy78\u003C/p\u003E\u003Cp\u003EI\u0027m working on two different plugins - both are near release without toolbar.\u003C/p\u003E\u003Cp\u003ENow I tried to add toolbar but no matter what I do, I get this error..\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003ECA0058 [B]Error Running Code Analysis[/B]\u003Cbr\u003ECA0058 : The referenced assembly \u0027aaa_Toolbar, Version=1.0.0.0, Culture=neutral\u0027 could not be found. This assembly is required for analysis and was referenced by: C:\\Users\\[...]Reloaded.dll.\u003Cbr\u003E[B][Errors and Warnings][/B] - (Global)\u003Cbr\u003E\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003ETo clarify: It happens in all cases as soon as IButton is used. It happens in both projects independently\u003C/p\u003E\u003Cp\u003EI tried using-dependency, only referencing and toolbarWrapper..\u003C/p\u003E\u003Cp\u003EWith depency and/or reference I get the above on the failed build - with the wrapper it builds, but the above is printed in the KSP.log\u003C/p\u003E\u003Cp\u003EI\u0027ve tried to reference different versions of the toolbar DLL - no change..\u003C/p\u003E\u003Cp\u003EAlso Google showed me clearly - I\u0027m the only one with this problem! lol\u003C/p\u003E\u003Cp\u003ESo as a C# noob with limited debug abilities, I am at a loss..\u003C/p\u003E\u003Cp\u003EWould you consider pointing me in a direction that helps? If you have one..\u003C/p\u003E\u003Cp\u003EEdit: Additional info..\u003C/p\u003E\u003Cp\u003EI am using your example codes from github..\u003C/p\u003E\u003Cp\u003Edefault button.. (including the onDestroy stuff)\u003C/p\u003E\u003Cp\u003EHowever - I\u0027ve tried to copy/paste implementations from other plugins with the same result..\u003C/p\u003E\u003Cp\u003ESo I doubt it\u0027s a code problem on my end.. - but who knows..\u003C/p\u003E\n"},{"CreatedByName":"blizzy78","CreatedById":68543,"CreatedDateTime":"2014-05-02T19:05:31Z","Content":"\n\u003Cp\u003EI\u0027m using Visual Studio Express here, and I just add the necessary DLLs as references to the project. This usually works fine without having to do anything else.\u003C/p\u003E\n"},{"CreatedByName":"philotical","CreatedById":109390,"CreatedDateTime":"2014-05-02T19:06:28Z","Content":"\n\u003Cp\u003Eyup - that\u0027s what I figured..\u003C/p\u003E\u003Cp\u003EHowever - here it does not..\u003C/p\u003E\u003Cp\u003EWhat could cause this problem?\u003C/p\u003E\n"},{"CreatedByName":"blizzy78","CreatedById":68543,"CreatedDateTime":"2014-05-02T19:07:56Z","Content":"\n\u003Cp\u003EPerhaps it\u0027s the \u0022code analysis\u0022 you\u0027re running? I *think* I have never used that, I just compile stuff.\u003C/p\u003E\n"},{"CreatedByName":"philotical","CreatedById":109390,"CreatedDateTime":"2014-05-02T19:24:34Z","Content":"\n\u003Cp\u003Ewill try right away..\u003C/p\u003E\u003Cp\u003ELOL it worked..\u003C/p\u003E\u003Cp\u003EMan that took me the whole day.. :-)\u003C/p\u003E\u003Cp\u003EOne never stops learning.. - I\u0027ve started with c# yesterday.. - so.. as noobs can be..\u003C/p\u003E\u003Cp\u003EThank\u0027s - I owe you one..\u003C/p\u003E\n"},{"CreatedByName":"MarkZero","CreatedById":104427,"CreatedDateTime":"2014-05-07T11:29:32Z","Content":"\n\u003Cp\u003EHello,\u003C/p\u003E\u003Cp\u003EI am trying to add support for the toolbar to my plugin as instructed under \u0022Use the Toolbar Plugin wrapper to provide optional Toolbar Plugin support\u0022.\u003C/p\u003E\u003Cp\u003EHowever if I have the ToolbarWrapper.cs in my project (don\u0027t even need to try to use the toolbar), my plugin won\u0027t load and I get this error in KSP.log:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E[ERR 14:26:15.363] AssemblyLoader: Exception loading \u0027MyPlugin\u0027: System.Reflection.ReflectionTypeLoadException: The classes in the module cannot be loaded.\u003Cbr\u003E  at (wrapper managed-to-native) System.Reflection.Assembly:GetTypes (bool)\u003Cbr\u003E  at System.Reflection.Assembly.GetTypes () [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003Cbr\u003E  at AssemblyLoader.LoadAssemblies () [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003Cbr\u003E\u003Cbr\u003EAdditional information about this exception:\u003Cbr\u003E\u003Cbr\u003E System.TypeLoadException: Could not load type \u0027MyPlugin.ToolbarTypes\u0027 from assembly \u0027MyPlugin, Version=1.0.5240.24185, Culture=neutral, PublicKeyToken=null\u0027.\u003Cbr\u003E\u003Cbr\u003E System.TypeLoadException: Could not load type \u0027\u0026lt;\u0026gt;c__DisplayClass3\u0027 from assembly \u0027MyPlugin, Version=1.0.5240.24185, Culture=neutral, PublicKeyToken=null\u0027.\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EAny idea what could cause this?\u003C/p\u003E\n"},{"CreatedByName":"blizzy78","CreatedById":68543,"CreatedDateTime":"2014-05-07T11:39:12Z","Content":"\n\u003Cp\u003E.NET target version must be set to 3.5.\u003C/p\u003E\n"},{"CreatedByName":"MarkZero","CreatedById":104427,"CreatedDateTime":"2014-05-08T11:26:26Z","Content":"\n\u003Cp\u003EThank you, works now.\u003C/p\u003E\n"},{"CreatedByName":"SirAtomBrysicle","CreatedById":98852,"CreatedDateTime":"2014-05-11T00:36:45Z","Content":"\n\u003Cp\u003EHey I really love your toolbar but after I got the 23.5 ARM update it won\u0027t work alongside MechJeb. MJ is updated to the most recent 23.5 path (2.2.1) I can place the part but the MJ UI will not show up. I removed all mods and tried each one after the other with MJ and this was the only one that caused the issue. I\u0027m not all that great at math so the MJ is almost essential for me to get past the learning curve, but it has become a big deal to me that I can\u0027t use the toolbar as well. I must sort this out! I will post there as well, I\u0027m just reaching out seeing if someone more familiar with modding has dealt with this?\u003C/p\u003E\n"},{"CreatedByName":"blizzy78","CreatedById":68543,"CreatedDateTime":"2014-05-11T00:37:54Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022SirAtomBrysicle\u0022 data-cite=\u0022SirAtomBrysicle\u0022\u003E\u003Cdiv\u003EI can place the part but the MJ UI will not show up.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI think you need to enable MJ\u0027s Toolbar support in MJ\u0027s settings.\u003C/p\u003E\n"},{"CreatedByName":"blizzy78","CreatedById":68543,"CreatedDateTime":"2014-06-22T01:52:02Z","Content":"\n\u003Cp\u003EToolbar Plugin 1.7.2 is now available for download.\u003C/p\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2014-06-26T01:21:18Z","Content":"\n\u003Cp\u003EThere seem to be some issues related to IDrawable and the latest update. I have users reporting incorrect toolbar positions and in some cases the GUI becomes nearly non-interactive if the toolbar is positioned such that the auto positioning code fails (typically when at the top of the screen, positioned between the altimeter and sides of the screen).\u003C/p\u003E\u003Cp\u003EHere is an example:\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://puu.sh/9KhOh/a9eb1f5c4c.jpg\u0022 alt=\u0022a9eb1f5c4c.jpg\u0022\u003E\u003Cimg src=\u0022http://puu.sh/9KhRl/d50f4e2a3d.jpg\u0022 alt=\u0022d50f4e2a3d.jpg\u0022\u003E\u003C/p\u003E\u003Cp\u003EThe exact position will alternate on every right-click-open and in both cases something strange is going on because clicking buttons does nothing or (if the positioning is as the second picture) the drawable will suddenly snap to the wrong place. I want to say that the actual location checked for mouse input is lagging behind the displayed position, since you can sometimes manage to click buttons if you twitch your mouse fast enough to the right spot.\u003C/p\u003E\u003Cp\u003E1.7.1 works fine though\u003C/p\u003E\n"},{"CreatedByName":"blizzy78","CreatedById":68543,"CreatedDateTime":"2014-06-26T08:40:42Z","Content":"\n\u003Cp\u003EI\u0027ll look into it.\u003C/p\u003E\n"},{"CreatedByName":"blizzy78","CreatedById":68543,"CreatedDateTime":"2014-06-26T20:04:01Z","Content":"\n\u003Cp\u003EToolbar Plugin 1.7.3 is now available for download.\u003C/p\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2014-06-26T20:43:12Z","Content":"\n\u003Cp\u003EThat was fast, thanks!\u003C/p\u003E\n"},{"CreatedByName":"blizzy78","CreatedById":68543,"CreatedDateTime":"2014-06-26T20:45:06Z","Content":"\n\u003Cp\u003EIt could have been sooner, weren\u0027t it for my daytime work.\u003C/p\u003E\n"},{"CreatedByName":"diomedea","CreatedById":93700,"CreatedDateTime":"2014-06-27T11:03:22Z","Content":"\n\u003Cp\u003EJust a very minor thing, but believe you may find useful: with the 1.7.3 version, Toolbar.dll still shows version 1.7.2.0 from the file properties.\u003C/p\u003E\n"},{"CreatedByName":"blizzy78","CreatedById":68543,"CreatedDateTime":"2014-06-27T11:07:43Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022diomedea\u0022 data-cite=\u0022diomedea\u0022\u003E\u003Cdiv\u003EJust a very minor thing, but believe you may find useful: with the 1.7.3 version, Toolbar.dll still shows version 1.7.2.0 from the file properties.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EAh great. Thanks for letting me know!\u003C/p\u003E\n"},{"CreatedByName":"Felger","CreatedById":76828,"CreatedDateTime":"2014-07-06T18:06:18Z","Content":"\n\u003Cp\u003EHopefully this is the right place to post this, but I\u0027m running into odd behaviour trying to implement the ToolbarWrapper into my plugin.\u003C/p\u003E\u003Cp\u003EI\u0027m building my plugin to interface with Infernal Robotics (which also uses the Toolbar Wrapper). Mirroring the implementation in the \u003Ca href=\u0022https://github.com/blizzy78/ksp_toolbar/blob/master/TestButtons/TestButtons.cs\u0022 rel=\u0022external nofollow\u0022\u003ETestButtons.cs\u003C/a\u003E into my code (without the direct dependency on Toolbar, instead using the wrapper and testing for the existence of the toolbar in much the same way sirkut does \u003Ca href=\u0022https://github.com/sirkut/InfernalRobotics/blob/master/InfernalRobotics/InfernalRobotics/GUI.cs#L283-L296\u0022 rel=\u0022external nofollow\u0022\u003Ehere\u003C/a\u003E)\u003C/p\u003E\u003Cp\u003EI instantiated the IButton for my plugin, and added the appropriate code to my Awake() function to tie my plugin into the toolbar. All seemed to go well, until I compiled and launched the game.\u003C/p\u003E\u003Cp\u003EOnce in-game, the plugin no longer loaded, claiming an object wasn\u0027t being assigned. (Or being assigned to a null reference). Removing all references to the toolbar from my code resolved the problem.\u003C/p\u003E\u003Cp\u003EFor context, here\u0027s the relevant lines of code in the plugin:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E        IButton AutoGimbalButton;\u003Cbr\u003E        void Awake()\u003Cbr\u003E        {\u003Cbr\u003E            Debug.Log(\u0022[AutoGimbalManager] awake\u0022);\u003Cbr\u003E            guiEnabled = false;\u003Cbr\u003E            var scene = HighLogic.LoadedScene;\u003Cbr\u003E            if (scene == GameScenes.FLIGHT)\u003Cbr\u003E            {//Need to check at some point if we need to reload groups from vessel\u003Cbr\u003E            }\u003Cbr\u003E            if (ToolbarManager.ToolbarAvailable)\u003Cbr\u003E            {\u003Cbr\u003E                AutoGimbalButton = ToolbarManager.Instance.add(\u0022Felger\u0022, \u0022AutoGimbalButton\u0022);\u003Cbr\u003E                AutoGimbalButton.TexturePath = \u0022AutoGimbal/Textures/icon_button\u0022;\u003Cbr\u003E                AutoGimbalButton.ToolTip = \u0022AutoGimbal Manager\u0022;\u003Cbr\u003E                AutoGimbalButton.Visibility = new GameScenesVisibility(GameScenes.EDITOR, GameScenes.SPH, GameScenes.FLIGHT);\u003Cbr\u003E                AutoGimbalButton.OnClick \u002B= (e) =\u0026gt; guiEnabled = !guiEnabled;\u003Cbr\u003E                AutoGimbalButton.Visible = true;\u003Cbr\u003E            }\u003Cbr\u003E            else\u003Cbr\u003E            {\u003Cbr\u003E                guiEnabled = true;\u003Cbr\u003E            }\u003Cbr\u003E        }\u003Cbr\u003E        void OnGUI()\u003Cbr\u003E        {\u003Cbr\u003E            //Define the default window position, if no changes have been made:\u003Cbr\u003E            if(windowPosn.x == 0 \u0026amp;\u0026amp; windowPosn.y == 0)\u003Cbr\u003E            {\u003Cbr\u003E                windowPosn = new Rect(Screen.width - 300, 50, 10, 10);\u003Cbr\u003E            }\u003Cbr\u003E            var scene = HighLogic.LoadedScene;\u003Cbr\u003E            if (scene == GameScenes.FLIGHT)\u003Cbr\u003E            {\u003Cbr\u003E                //Creates a new box, specifying the position to follow the defined position above.\u003Cbr\u003E                if (guiEnabled)\u003Cbr\u003E                {\u003Cbr\u003E                    windowPosn = GUILayout.Window(0, windowPosn, WindowMaker, \u0022AutoGimbal\u0022);\u003Cbr\u003E                }\u003Cbr\u003E            }\u003Cbr\u003E        }\u003Cbr\u003E        void OnDestroy()\u003Cbr\u003E        {\u003Cbr\u003E            if (ToolbarManager.ToolbarAvailable)\u003Cbr\u003E            {\u003Cbr\u003E                AutoGimbalButton.Destroy();\u003Cbr\u003E            }\u003Cbr\u003E        }\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EAs far as I can tell from following your and sirkut\u0027s code through, I shouldn\u0027t expect a problem, using the wrapper. However, in-game Infernal Robotics shows up on the toolbar, and my plugin crashes when it attempts to load.\u003C/p\u003E\u003Cp\u003ERemoving the toolbar from my plugin, it loads just fine.\u003C/p\u003E\n"},{"CreatedByName":"blizzy78","CreatedById":68543,"CreatedDateTime":"2014-07-06T18:16:26Z","Content":"\n\u003Cp\u003EIf you\u0027re getting an exception, there should be a stack trace in your output_log.txt.\u003C/p\u003E\n"},{"CreatedByName":"Felger","CreatedById":76828,"CreatedDateTime":"2014-07-06T18:34:14Z","Content":"\n\u003Cp\u003EThe actual log message, going back and looking for it is:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E[EXC 13:25:57.696] NullReferenceException: Object reference not set to an instance of an object\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EIn the output_log.txt:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003EAssemblyLoader: Exception loading \u0027AutoGimbal\u0027: System.Reflection.ReflectionTypeLoadException: The classes in the module cannot be loaded.\u003Cbr\u003E\u003Cbr\u003E  at (wrapper managed-to-native) System.Reflection.Assembly:GetTypes (bool)\u003Cbr\u003E\u003Cbr\u003E  at System.Reflection.Assembly.GetTypes () [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003Cbr\u003E\u003Cbr\u003E  at AssemblyLoader.LoadAssemblies () [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003Cbr\u003E\u003Cbr\u003EAdditional information about this exception:\u003Cbr\u003E\u003Cbr\u003E System.TypeLoadException: Could not load type \u0027AutoGimbal.ToolbarTypes\u0027 from assembly \u0027AutoGimbal, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null\u0027.\u003Cbr\u003E\u003Cbr\u003E System.TypeLoadException: Could not load type \u0027\u0026lt;\u0026gt;c__DisplayClass3\u0027 from assembly \u0027AutoGimbal, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null\u0027.\u003Cbr\u003E\u003Cbr\u003E(Filename: C:/BuildAgent/work/d3d49558e4d408f4/artifacts/StandalonePlayerGenerated/UnityEngineDebug.cpp Line: 53)\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EI\u0027m pretty inexperienced with object-oriented programming, so I\u0027m not really sure what to make of all this.\u003C/p\u003E\n"},{"CreatedByName":"blizzy78","CreatedById":68543,"CreatedDateTime":"2014-07-06T18:37:10Z","Content":"\n\u003Cp\u003EI think you need to set your .NET target version to 3.5.\u003C/p\u003E\n"},{"CreatedByName":"Felger","CreatedById":76828,"CreatedDateTime":"2014-07-06T18:43:46Z","Content":"\n\u003Cp\u003EAnd of course I completely missed step 3 in the setup, thanks for setting me straight Blizzy!\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2014-07-13T14:19:50Z","Content":"\n\u003Cp\u003Eedit: Nevermind, PEBKAC error.\u003C/p\u003E\u003Cp\u003EI had the state of my window state boolean backwards so when I was trying to open the window, I was closing it.\u003C/p\u003E\u003Cp\u003EOff to actually make some progress now.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-07-14T02:36:47Z\u0022 title=\u002207/14/2014 02:36  AM\u0022 data-short=\u00229 yr\u0022\u003EJuly 14, 2014\u003C/time\u003E by Diazo\u003C/strong\u003E\n\u003C/span\u003E\n"}]}