{"TopicId":207101,"ForumId":104,"TopicTitle":"Question on Krakensbane","CreatedByName":"Xavier513","CreatedById":103114,"CreatedDateTime":"2022-03-02T03:47:32Z","PageNum":1,"Articles":[{"CreatedByName":"Xavier513","CreatedById":103114,"CreatedDateTime":"2022-03-02T03:47:32Z","Content":"\n\u003Cp\u003E\nI\u0027m working on a mod, related with things like rendezvous and some orbit calculation.\u003Cbr\u003E\nI keep hearing about \u0022Krakensbane\u0022, and I know it\u0027s for dealing with issues caused by high velocity, it\u0027s repositioning the whole universe.\u003Cbr\u003E\nI\u0027m curious on some details, so I searched the forum and found a link:\u00A0\u003Ca href=\u0022https://forum.kerbalspaceprogram.com/entries/12-Krakensbane\u0022 rel=\u0022\u0022 style=\u0022background-color:#f9f9f9;font-size:15px;\u0022\u003Ehttp://forum.kerbalspaceprogram.com/entries/12-Krakensbane\u003C/a\u003E\u003Cbr\u003E\nUnfortunately, it\u0027s not available anymore. Does anyone have a backup to that page?\n\u003C/p\u003E\n\u003Cp\u003E\nThese are the questions I\u0027m curious about:\n\u003C/p\u003E\n\u003Cp\u003E\n1, When player vessel is coasting along orbit (at high speed, no timewarp), is the whole universe repositioning itself along player vessel\u0027s orbit, in \u0022on rails\u0022 mode?\n\u003C/p\u003E\n\u003Cp\u003E\n2, As the orbit is not a straight line, orbit velocity is changing all the time(both direction and speed), is the velocity absorbed by\u00A0Krakensbane actually changing all the time?\n\u003C/p\u003E\n\u003Cp\u003E\n3, If player vessel is accelerating, how often is the extra velocity absorbed by\u00A0Krakensbane? Every FixedUpdate?\n\u003C/p\u003E\n\u003Cp\u003E\n4, If another vessel is now very close to player(say, 100m), how is the vessel\u0027s position determined? By \u0022on rail\u0022 mode(Deterministic Physics) or \u0022off rail\u0022 mode(Physics engine)?\n\u003C/p\u003E\n\u003Cp\u003E\nThanks!\n\u003C/p\u003E\n"},{"CreatedByName":"Xavier513","CreatedById":103114,"CreatedDateTime":"2022-03-02T04:55:30Z","Content":"\n\u003Cp\u003E\nOK, after some tests, observing:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\u003Cspan class=\u0022pln\u0022\u003EDebug.LogWarning(Krakensbane.GetFrameVelocity() \u002B \u0022,\u0022 \u002B Krakensbane.GetLastCorrection());\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nthese two values seems changing every Update.\n\u003C/p\u003E\n"},{"CreatedByName":"Gargamel","CreatedById":64714,"CreatedDateTime":"2022-03-04T04:03:40Z","Content":"\n\u003Cp\u003E\nMoved to mod help\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"Gotmachine","CreatedById":163039,"CreatedDateTime":"2022-03-04T12:33:09Z","Content":"\n\u003Cp\u003E\nKrakensbane isn\u0027t about velocity, it\u0027s about making sure the world origin stays centered on the active vessel to avoid FP precision issues.\u003Cbr\u003E\nAll that component does is to periodically reposition all objects in the world to ensure that.\u003Cbr\u003E\nBut it\u0027s a \u0022low level\u0022 component, and any higher level data you usually have to deal with (orbit, velocities, etc) usually abstract that effect away.\u003Cbr\u003E\nThe only major consequence is that you can\u0027t compare positions between two points in time, but this is something that you shouldn\u0027t be doing anyway.\n\u003C/p\u003E\n"},{"CreatedByName":"Xavier513","CreatedById":103114,"CreatedDateTime":"2022-03-07T04:20:47Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00224099326\u0022 data-ipsquote-contentid=\u0022207101\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221646397189\u0022 data-ipsquote-userid=\u0022163039\u0022 data-ipsquote-username=\u0022Gotmachine\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nOn 3/4/2022 at 8:33 PM, Gotmachine said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nKrakensbane isn\u0027t about velocity, it\u0027s about making sure the world origin stays centered on the active vessel to avoid FP precision issues.\u003Cbr\u003E\nAll that component does is to periodically reposition all objects in the world to ensure that.\u003Cbr\u003E\nBut it\u0027s a \u0022low level\u0022 component, and any higher level data you usually have to deal with (orbit, velocities, etc) usually abstract that effect away.\u003Cbr\u003E\nThe only major consequence is that you can\u0027t compare positions between two points in time, but this is something that you shouldn\u0027t be doing anyway.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThanks! A further question: what happens when target vessel is \u003Cstrong\u003Every close to player vessel\u003C/strong\u003E?\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nIf target vessel\u0027s position is determined by SetPosition (or \u0022on-rails\u0022), when player vessel collides with target, the target vessel would behave like a kinematic object, and it\u0027s orbit wouldn\u0027t change, which is not correct.\n\u003C/p\u003E\n\u003Cp\u003E\nBut if target vessel is \u0022off-rails\u0022 and throwed back to physics engine, I think it\u0027s not an easy thing to make target vessel to exactly move along it\u0027s orbit. When target vessel is far away and goes \u0022on-rails\u0022 again, this inaccuracy will result in an orbit change, even if target vessel is not touched at all.\n\u003C/p\u003E\n\u003Cp\u003E\nHow does KSP deal with this situation?\n\u003C/p\u003E\n\u003Cp\u003E\nHere is my thoughts:\n\u003C/p\u003E\n\u003Cp\u003E\n1, When target vessel is near, target vessel goes \u0022off-rails\u0022 and is throwed back to physics simulation.\n\u003C/p\u003E\n\u003Cp\u003E\n2, If target vessel does not collide with any object, it finally moves far away enough and goes \u0022on-rails\u0022, it\u0027s orbit would not change. The inaccuracy in physics simulation takes no effects to actual orbit.\n\u003C/p\u003E\n\u003Cp\u003E\n3, If target vessel collides with something, from this moment on,\u00A0 its current physics state would result in an orbit change accordingly, until it moves far away and goes \u0022on-rails\u0022 again.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"Gotmachine","CreatedById":163039,"CreatedDateTime":"2022-03-07T09:35:36Z","Content":"\n\u003Cp\u003E\nPoint 1 is correct, there is a \u0022physics bubble\u0022 centered on the active vessel. Any other vessel entering that range (about ~2.5km in space, but depends on the situation) goes from the unloaded/packed (on-rails) state to the in-physics state.\u003Cbr\u003E\nYour points 2 and 3 are wrong.\u003Cbr\u003E\nWhen a vessel in \u0022on rails\u0022 (unloaded or packed), its orbit is fixed and the vessel position is computed from the orbit parameters.\u003Cbr\u003E\nWhen a vessel is in physics (loaded and not packed), it\u0027s the other way around, the vessel position and velocity is determined by the physic engine, and the orbit is computed from those parameters.\n\u003C/p\u003E\n\u003Cp\u003E\nSo to answer your question, KSP doesn\u0027t \u0022deal\u0022 with that situation. As long as a vessel is in physics, its orbit will be slightly unstable, as the physics simulation is it a result of is itself always slightly unstable.\n\u003C/p\u003E\n\u003Cp\u003E\nOn a side note, inter-vessel collisions aren\u0027t guaranteed to happen.\u003Cbr\u003E\nIf the relative velocity between two in-physics vessels is too high, there is a decent chance the collision won\u0027t be detected at all.\u003Cbr\u003E\nMoreover, collisions are entirely ignored when (non-physics) timewarp is engaged, as all vessels are put in the packed state during timewarp.\u003Cbr\u003E\nAnd finally, collisions between unloaded vessels are ignored too.\n\u003C/p\u003E\n"}]}