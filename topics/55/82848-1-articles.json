{"TopicId":82848,"ForumId":55,"TopicTitle":"\u0022On-The-Rails\u0022 Time Warp with Thrust","CreatedByName":"arkie87","CreatedById":103434,"CreatedDateTime":"2014-08-25T19:22:12Z","PageNum":1,"Articles":[{"CreatedByName":"arkie87","CreatedById":103434,"CreatedDateTime":"2014-08-25T19:22:12Z","Content":"\n\u003Cp\u003EI think it is possible to have a \u0022non-physical\u0022 on-the-rails time warp while thrusting using the fact that an analytical solution for this case exists. For a constant thrust (over a frame or time-step), the differential equation for mass is: \u003C/p\u003E\u003Cp\u003EEq. (1): dm(t)/dt = -k \u003C/p\u003E\u003Cp\u003Ewhere k is a constant (though its value can change from frame to frame or time-step to time-step).\u003C/p\u003E\u003Cp\u003EIn space (or the absence of drag), conservation of momentum takes the form:\u003C/p\u003E\u003Cp\u003EEq. (2): m(t)*dv(t)/dt \u002B ISP*dm(t)/dt = 0\u003C/p\u003E\u003Cp\u003Ewhere ISP*dm/dt is the thrust term. \u003C/p\u003E\u003Cp\u003EFinally, by definition, velocity is related to position by: \u003C/p\u003E\u003Cp\u003EEq. (3): dx(t)/dt = v\u003C/p\u003E\u003Cp\u003EThus, Eqs. (1)-(3) form a system of linear ordinary differential equations, the analytical solutions of which are:\u003C/p\u003E\u003Cp\u003EEq. (4): m(t) = m0 - k*t = m0*c1\u003C/p\u003E\u003Cp\u003EEq. (5): v(t) = v0 \u002B ISP*ln(1/c1)\u003C/p\u003E\u003Cp\u003EEq. (6): x(t) = x0 \u002B v0*t \u002B ISP*(1 \u002B c1/(1-c1)*ln(c1))*t\u003C/p\u003E\u003Cp\u003Ewhere c1 is a convenient parameter defined as the ratio of the mass at time t to total mass:\u003C/p\u003E\u003Cp\u003EEq. (7): c1 = (m0-k*t)/m0 = m(t)/m0\u003C/p\u003E\u003Cp\u003EIt is worth noting that Eq. 6 for position includes an additional term beyond simple Euler integration, namely, ISP*(1 \u002B c1/(1-c1)*ln(c1))*t. This term accounts for the known way that the ship accelerates during a constant burn, and calculates the extra distance the ship has traveled. Similarly, Eq. (5) for velocity includes an analytical acceleration term, and Eq. (4) for mass is linear. Thus, even large time steps will exactly match the correct (analytical) solution, enabling time-warping with thrust. \u003C/p\u003E\u003Cp\u003EHowever, a small correction will have to be added to make sure the craft has enough fuel (and if an ion engine-- enough electricity) to burn for the whole time-step, if the time-step is large enough. There are two options:\u003C/p\u003E\u003Cp\u003E(1) Time warp is automatically killed until the time-step is small enough that all the fuel/electricity will not be consumed.\u003C/p\u003E\u003Cp\u003E(2) The value of k can be changed such that m(t) = m0 - k*t = 0 i.e. k = m0/t, so that conservation of mass is not violated. \u003C/p\u003E\u003Cp\u003EWhat do you guys think? Can this be implemented in KSP via a plugin or would it have to be hacked into PhysX/Unity?\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-08-25T19:24:55Z\u0022 title=\u002208/25/2014 07:24  PM\u0022 data-short=\u00229 yr\u0022\u003EAugust 25, 2014\u003C/time\u003E by arkie87\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Murph","CreatedById":90837,"CreatedDateTime":"2014-08-25T19:39:08Z","Content":"\n\u003Cp\u003EThe problem isn\u0027t really the maths, it\u0027s the other stuff. If the craft has the structural integrity or stability of soggy tissue paper, you can\u0027t just apply the numbers and move forward. That then leaves you with determining craft which behave close enough to theoretical perfection and can be thrust-warped, and craft that need active physics simulation. In the case of ion engines, you\u0027d need to figure out when any panels would be providing charge, and how much charge they would be providing over the entire burn, and whether there would be any brown/black-out periods to consider.\u003C/p\u003E\n"},{"CreatedByName":"Master Tao","CreatedById":110410,"CreatedDateTime":"2014-08-25T19:42:18Z","Content":"\n\u003Cp\u003EI would like to see this implemented in some form for KSP, though it\u0027s more helpful for ion engines than anything else.\u003C/p\u003E\u003Cp\u003ETwo plugins alread implement this using the same approach (changing the orbit): KSP Interstellar for the solar sail and the \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/70881-0-24-Orbit-Manipulator-Series-%28Updated-March-12-2014%29\u0022 rel=\u0022external nofollow\u0022\u003EOrbit Manipulator Series\u003C/a\u003E for ion engines. Both add quite a lot of other changes to the game, though.\u003C/p\u003E\n"},{"CreatedByName":"arkie87","CreatedById":103434,"CreatedDateTime":"2014-08-25T19:45:24Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Murph\u0022 data-cite=\u0022Murph\u0022\u003E\u003Cdiv\u003EThe problem isn\u0027t really the maths, it\u0027s the other stuff. If the craft has the structural integrity or stability of soggy tissue paper, you can\u0027t just apply the numbers and move forward. That then leaves you with determining craft which behave close enough to theoretical perfection and can be thrust-warped, and craft that need active physics simulation. \u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI agree that there are other issues to consider, such as wibble-wobble. However, time warping with thrust would only be allowed if the acceleration is low, such that no wibble-wobble would be encountered, such as usually the case with nuclear engines, and almost always the case with ion engines. Alternatively, time warping with thrust would just assume the body is rigid i.e. infinite struts (which are massless anyway). \u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Murph\u0022 data-cite=\u0022Murph\u0022\u003E\u003Cdiv\u003E In the case of ion engines, you\u0027d need to figure out when any panels would be providing charge, and how much charge they would be providing over the entire burn, and whether there would be any brown/black-out periods to consider.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThe game already calculates energy flux on solar panels and battery charging during time warp, so i dont think that will be a problem. Furthermore, since charging/discharging/thrusting is always linear, these effects would not be difficult to incorporate.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-08-25T19:55:41Z\u0022 title=\u002208/25/2014 07:55  PM\u0022 data-short=\u00229 yr\u0022\u003EAugust 25, 2014\u003C/time\u003E by arkie87\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"arkie87","CreatedById":103434,"CreatedDateTime":"2014-08-25T19:57:26Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022GeneCash\u0022 data-cite=\u0022GeneCash\u0022\u003E\u003Cdiv\u003EYou\u0027ve completely neglected any sort of gravitational pull. If you aren\u0027t in a planetary/moon SOI, you\u0027ll still be in the Kerbol SOI.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYes, but its possible to get around this issue, as Master Tao explained.\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022font-size:8px;\u0022\u003E\u003Cspan style=\u0022color:#C0C0C0;\u0022\u003E- - - Updated - - -\u003C/span\u003E\u003C/span\u003E\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Master Tao\u0022 data-cite=\u0022Master Tao\u0022\u003E\u003Cdiv\u003EI would like to see this implemented in some form for KSP, though it\u0027s more helpful for ion engines than anything else.\u003Cp\u003ETwo plugins alread implement this using the same approach (changing the orbit): KSP Interstellar for the solar sail and the \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/70881-0-24-Orbit-Manipulator-Series-%28Updated-March-12-2014%29\u0022 rel=\u0022external nofollow\u0022\u003EOrbit Manipulator Series\u003C/a\u003E for ion engines. Both add quite a lot of other changes to the game, though.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EAre you saying orbit manipulator series uses the same method/equations i provided?\u003C/p\u003E\n"},{"CreatedByName":"Murph","CreatedById":90837,"CreatedDateTime":"2014-08-25T21:13:08Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022arkie87\u0022 data-cite=\u0022arkie87\u0022\u003E\u003Cdiv\u003EI agree that there are other issues to consider, such as wibble-wobble. However, time warping with thrust would only be allowed if the acceleration is low, such that no wibble-wobble would be encountered, such as usually the case with nuclear engines, and almost always the case with ion engines. Alternatively, time warping with thrust would just assume the body is rigid i.e. infinite struts (which are massless anyway).\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI disagree that rockets using LV-N power are usually stable. For me, the long LV-N burns (where this could be relevant) are usually for something like a 4*LV-N tug transferring a chunk of station or fuel drop, and it\u0027s common to have stability issues with them (not always, just it happens often enough to be an issue, and it happens even with a very low TWR, such as 0.2-ish). That\u0027s not me saying that this is a bad idea, or that LV-N should necessarily be excluded. Ultimately it comes down to how accurate or correct you want the warp to be, relative to a standard 1x physics burn.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022arkie87\u0022 data-cite=\u0022arkie87\u0022\u003E\u003Cdiv\u003EThe game already calculates energy flux on solar panels and battery charging during time warp, so i dont think that will be a problem. Furthermore, since charging/discharging/thrusting is always linear, these effects would not be difficult to incorporate.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EIt depends what you mean, but I wouldn\u0027t regard the solar panel charging as linear. They are instantaneously linear, but highly variable over time, based on the angle to the sun, even for the rotating panel arrays. It\u0027s a problem that has a solution, i.e. the energy supply over time is predictable if the path and behaviour of the craft is known, just a complication which should be considered in this context.\u003C/p\u003E\n"},{"CreatedByName":"arkie87","CreatedById":103434,"CreatedDateTime":"2014-08-25T21:27:36Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Murph\u0022 data-cite=\u0022Murph\u0022\u003E\u003Cdiv\u003EI disagree that rockets using LV-N power are usually stable. For me, the long LV-N burns (where this could be relevant) are usually for something like a 4*LV-N tug transferring a chunk of station or fuel drop, and it\u0027s common to have stability issues with them (not always, just it happens often enough to be an issue, and it happens even with a very low TWR, such as 0.2-ish). That\u0027s not me saying that this is a bad idea, or that LV-N should necessarily be excluded. Ultimately it comes down to how accurate or correct you want the warp to be, relative to a standard 1x physics burn. \u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ETrue, for large ships driven by LV-N, there still might be wibble-wobble. Personally, i think wibble-wobble is stupid, since struts will fix the problem, and are massless, so you could just overload on struts. In the end, it makes the most sense to treat the vehicle like a rigid body when thrusting in time warp, and it might just be a necessary sacrifice to make certain burns possible. If you think about it though, most wibble-wobble could be dealt with simply by reducing throttle or turning throttle on, then off, damping wobble and/or correcting aim, then turning back on etc... and so, this feature would just save the player the hassle of doing this. However, the only problem i see is that this would enable engines with CoT misaligned with CoM to fly straight, which would be a problem in my book. To fix this, a simple check could be conducted to determine if too much rotation is being experienced, and if so, refuse time warp (sort of like it already does).\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Murph\u0022 data-cite=\u0022Murph\u0022\u003E\u003Cdiv\u003EIt depends what you mean, but I wouldn\u0027t regard the solar panel charging as linear. They are instantaneously linear, but highly variable over time, based on the angle to the sun, even for the rotating panel arrays. It\u0027s a problem that has a solution, i.e. the energy supply over time is predictable if the path and behaviour of the craft is known, just a complication which should be considered in this context.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ESolar charging is a function of angle, distance from kerbol, and shading etc... but the game already calculates this during time warp (not sure how; its probably inaccurate or uses forward time-stepping allowing you to receive charge for the whole time step if you start the time-step with a view of kerbol). Thus, this problem is already dealt with (somehow).\u003C/p\u003E\n"},{"CreatedByName":"Kasuha","CreatedById":81781,"CreatedDateTime":"2014-08-25T22:50:51Z","Content":"\n\u003Cp\u003EOn-warp thrust has been suggested number of times, the devs\u0027 answer was so far that ion engines got a boost.\u003C/p\u003E\n"},{"CreatedByName":"arkie87","CreatedById":103434,"CreatedDateTime":"2014-08-26T02:29:17Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Kasuha\u0022 data-cite=\u0022Kasuha\u0022\u003E\u003Cdiv\u003EOn-warp thrust has been suggested number of times, the devs\u0027 answer was so far that ion engines got a boost.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EIt\u0027s one thing to suggest an idea, its another to present in detail how it can be implemented.\u003C/p\u003E\n"},{"CreatedByName":"r4pt0r","CreatedById":90471,"CreatedDateTime":"2014-08-26T02:40:55Z","Content":"\n\u003Cp\u003Ei think a times 8 phys warp wouldnt be too bad.\u003C/p\u003E\n"},{"CreatedByName":"einsteiner","CreatedById":71000,"CreatedDateTime":"2014-08-26T03:10:32Z","Content":"\n\u003Cp\u003EYou would probably need numerical integration to account for the non-uniform gravity during the burn. It could easily be integrated into a scheme like the one discussed \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/49121-On-Newtonian-trajectories-vs-patched-conics\u0022 rel=\u0022external nofollow\u0022\u003Ehere\u003C/a\u003E.\u003C/p\u003E\n"},{"CreatedByName":"Master Tao","CreatedById":110410,"CreatedDateTime":"2014-08-26T03:21:58Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022arkie87\u0022 data-cite=\u0022arkie87\u0022\u003E\u003Cdiv\u003EAre you saying orbit manipulator series uses the same method/equations i provided?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ENo, they use the same approach as each other. In non-physical timewarp, both mods edit the orbit rather than using the typical acceleration physics.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022arkie87\u0022 data-cite=\u0022arkie87\u0022\u003E\u003Cdiv\u003EHowever, the only problem i see is that this would enable engines with CoT misaligned with CoM to fly straight, which would be a problem in my book.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EAnother solution might be to add some very limited physics simulation during non-physical timewarp. Treat the whole craft as a rigid body, but still apply thrust and momentum so it will rotate appropriately, but that also opens the door for SAS input during timewarp to keep the craft steady.\u003C/p\u003E\n"},{"CreatedByName":"treejoe4","CreatedById":113762,"CreatedDateTime":"2014-08-26T09:33:31Z","Content":"\n\u003Cp\u003EI think a faster timewarp would useful, anything else would not punish the user for having a poorly built craft that wobbles, or lacks fuel, electricity etc. Someone could do a burn, timewarp, see there wasn\u0027t enough fuel, then go back to a quicksave in a much quicker time. And while they do that, they avoid that annoying small wobble and that nervous waiting time, and that fear of having to rebuild and/or relaunch the mission.\u003C/p\u003E\u003Cp\u003EIt simply isn\u0027t the kerbal way of flying.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-08-26T09:42:53Z\u0022 title=\u002208/26/2014 09:42  AM\u0022 data-short=\u00229 yr\u0022\u003EAugust 26, 2014\u003C/time\u003E by treejoe4\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"arkie87","CreatedById":103434,"CreatedDateTime":"2014-08-26T14:13:48Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022einsteiner\u0022 data-cite=\u0022einsteiner\u0022\u003E\u003Cdiv\u003EYou would probably need numerical integration to account for the non-uniform gravity during the burn. It could easily be integrated into a scheme like the one discussed \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/49121-On-Newtonian-trajectories-vs-patched-conics\u0022 rel=\u0022external nofollow\u0022\u003Ehere\u003C/a\u003E.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThanks for the link. Very interesting. Though i dont support implementation of n-body physics, i do support use of higher-order integration schemes so that 100x physical time warp is possible. In particular, the equations ive provided can be used to obtain higher order accuracy even under numerical integration, though they are not necessary.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-08-26T15:19:30Z\u0022 title=\u002208/26/2014 03:19  PM\u0022 data-short=\u00229 yr\u0022\u003EAugust 26, 2014\u003C/time\u003E by arkie87\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Kasuha","CreatedById":81781,"CreatedDateTime":"2014-08-26T16:39:05Z","Content":"\n\u003Cp\u003EThe problem with 100x physics warp is that physics runs in nVidia PhysX engine (or its Unity port). I don\u0027t think it is feasible to get any different integration implemented to that.\u003C/p\u003E\n"}]}