{"TopicId":100201,"ForumId":55,"TopicTitle":"Memory leak","CreatedByName":"Ethanadams","CreatedById":136913,"CreatedDateTime":"2015-02-20T12:58:42Z","PageNum":1,"Articles":[{"CreatedByName":"Ethanadams","CreatedById":136913,"CreatedDateTime":"2015-02-20T12:58:42Z","Content":"Does anyone know what the memory leak is and what it does because it sound bad"},{"CreatedByName":"Redhaze","CreatedById":137633,"CreatedDateTime":"2015-02-20T13:11:58Z","Content":"Pardon my curtness, but that could have been answered with just a tiny bit of effort."},{"CreatedByName":"sal_vager","CreatedById":16426,"CreatedDateTime":"2015-02-20T13:23:26Z","Content":"I\u0027m not convinced there\u0027s a leak, if it were a memory leak in the stock game the memory used would keep rising until it crashed, and for players with insufficient RAM that can happen (time to upgrade!) and a lot of people are going to say this is exactly what happens but high memory use is not the same as a memory leak.\n\nA leak is when memory set aside for something is never freed for use again.\n\nThe terrain system does use a lot of RAM to store the terrain (and the water) you fly over and the objects on it, this is unloaded as you fly around though and when you leave a planet, as long as you have enough memory it\u0027s usually able to handle it.\n\nThings get tricky when you have addons however, sorry modders!\n\nFly around with addon parts, you now have extra stuff in RAM with the game (mostly it\u0027s the textures of those parts) and the terrain filling the cache, you get to the point where there\u0027s no memory left KSP can use and it crashes.\n\nSo what can you do?\n\nYou can try reducing the texture size (settings), or convert them to a more compact type (ATM).\n\nYou can remove parts you aren\u0027t using, that could be a problem when you approach craft that are using those parts though.\n\nTurning off terrain scatters can help too ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)"},{"CreatedByName":"Renegrade","CreatedById":96629,"CreatedDateTime":"2015-02-20T13:49:27Z","Content":"\u003E \n\u003E I\u0027m not convinced there\u0027s a leak, if it were a memory leak in the stock game the memory used would keep rising until it crashed, and for players with insufficient RAM that can happen (time to upgrade!) and a lot of people are going to say this is exactly what happens but high memory use is not the same as a memory leak.\n\nThere\u0027s definitely something going on. I had a pure stock game get close to the memory ceiling - it was rather alarming. Nathan said it can actually hit critical levels, and I have strong faith in his diagnostic skills and such.\n\nLightly modded games can easily crawl over the limit - my current modded game starts around 2.4 but climbs quickly to ~3.0 and slowly inches towards 3.5 eventually, at which point I restart manually as I know the next launch is going to blow it up...\n\nIt could just be some really heinous memory fragmentation, but if it\u0027s that bad, it should really be considered a leak.\n\n(I\u0027m not saying it\u0027s Squad\u0027s fault, it could very well be something within Unity that isn\u0027t releasing references or whatever)"},{"CreatedByName":"Guest","CreatedById":-1,"CreatedDateTime":"2015-02-20T14:27:15Z","Content":"I do not fear the dreaded \u0022memory leak\u0022. I\u0027ve been running KSP .90 32 bit version on my old Dell dinosaur(2Gb ram \u002B 1GB video card) with no crashes and decent framerates. I am actually quite impressed with how good KSP runs considering the scope of the game, simulating space flight through an entire fictional solar system. We\u0027ve come a long way since the coin op Space Invader and Asteroid machines.\n\n![15OldArcadeMachines.jpg](http://www.pebbleversion.com/html/COPics/15OldArcadeMachines.jpg)"},{"CreatedByName":"metalmouth7","CreatedById":72211,"CreatedDateTime":"2015-02-20T15:10:33Z","Content":"\u003E \n\u003E I\u0027m not convinced there\u0027s a leak, if it were a memory leak in the stock game the memory used would keep rising until it crashed\n\nThis is normally the case, but thanks to the way Unity loads things, this isn\u0027t allowed to happen in a lot of circumstances. Since Unity unloads all assets at scene change, the \u0022leaky\u0022 code is unloaded and ignored by the game - this means that in a lot of circumstances the leaky code is unloaded and RAM freed before the game simply crashes from reaching it\u0027s memory limit. \n\nAs well, you\u0027re referring to simply one type of \u0022leak.\u0022 Memory leaks can also simply be when the software eats up a small amount of memory whenever it does a task, and then never frees it again - this can be demonstrated by simply watching KSP\u0027s RAM usage whilst opening tweakable menus in the editor. However, the type you refer to, a constant leak, can also be found in KSP - simply sitting on the runway at the KSC will result in the game continuously increasing it\u0027s RAM usage over time, and flying off into space won\u0027t free a chunk of that RAM back up (it\u0027s rather noticeable when you leave it for around a half hour.) However, returning to the Space Center through the pause menu will free the RAM back up - this strongly suggests that this is a memory leak, and not an intended feature.\n\n**Edited \u003Ctime datetime=\u00222015-02-20T18:03:13Z\u0022 title=\u002202/20/2015 06:03  PM\u0022 data-short=\u00229 yr\u0022\u003EFebruary 20, 2015\u003C/time\u003E by metalmouth7**"},{"CreatedByName":"r4pt0r","CreatedById":90471,"CreatedDateTime":"2015-02-20T16:07:17Z","Content":"\u003E \n\u003E This is normally the case, but thanks to the way Unity loads things, this isn\u0027t allowed to happen in a lot of circumstances. Since Unity unloads all assets at scene change, the \u0022leaky\u0022 code is unloaded and ignored by the game - this means that in a lot of circumstances the leaky data is un-allocated and RAM freed before the game simply crashes from reaching it\u0027s memory limit. \n\u003E As well, you\u0027re referring to simply one type of \u0022leak.\u0022 Memory leaks can also simply be when the software eats up a small amount of memory whenever it does a task, and then never frees it again - this can be demonstrated by simply watching KSP\u0027s RAM usage whilst opening tweakable menus in the editor. However, the type you refer to, a constant leak, can also be found in KSP - simply sitting on the runway at the KSC will result in the game continuously increasing it\u0027s RAM usage over time, and flying off into space won\u0027t free a chunk of that RAM back up (it\u0027s rather noticeable when you leave it for around a half hour.) However, returning to the Space Center through the pause menu will free the RAM back up - this strongly suggests that this is a memory leak, and not an intended feature.\n\nIs there any validation to this? tweakables seems to run up the ram usage or something.\n\n![SPJnuU0.gif](http://i.imgur.com/SPJnuU0.gif)"},{"CreatedByName":"sal_vager","CreatedById":16426,"CreatedDateTime":"2015-02-20T18:36:04Z","Content":"Actually Renegrade and metalmouth7 do make a lot of sense, it\u0027s easy to miss memory leaks if that memory is reallocated with a scene change, if there is a leak and you are in one scene long enough it will eventually consume all your RAM.\n\nSarbian has made an in-game memory tool we can use to watch KSP\u0027s RAM use and garbage collection that would be very useful for tracking down such leaks, [**you can find it here**](https://forum.kerbalspaceprogram.com/threads/92907-GCMonitor-1-2-A-graphic-Memory-monitor-%28Feb-19th%29).\n\nOf course, the less memory you have free the sooner you\u0027ll run out, so anything that maximises free RAM will help to avoid a crash, that\u0027s probably why most games suggest you run them without other programs in the background ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\nOh this is off-topic but I was on a site the other day where the moderators would just instaban you for disagreeing with them, luckily we don\u0027t do that here, thanks for the info metalmouth7, It\u0027s true you can learn something new every day ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\n**Edited \u003Ctime datetime=\u00222015-02-20T18:38:54Z\u0022 title=\u002202/20/2015 06:38  PM\u0022 data-short=\u00229 yr\u0022\u003EFebruary 20, 2015\u003C/time\u003E by sal\\_vager**"},{"CreatedByName":"SpaceHips","CreatedById":176006,"CreatedDateTime":"2015-02-20T18:56:37Z","Content":"Ready for 1.0!\n\n![LSGfNIX.gif](http://i.imgur.com/LSGfNIX.gif)"},{"CreatedByName":"RobotsAndSpaceships","CreatedById":122975,"CreatedDateTime":"2015-02-20T19:35:24Z","Content":"\u003E \n\u003E Ready for 1.0!\n\u003E [http://i.imgur.com/LSGfNIX.gif](http://i.imgur.com/LSGfNIX.gif)\n\nThat\u0027s a lot worse than I thought. ba9 actually circumvented it by making his own tweakable system, which is a lot nicer looking than stock too. Theres also the memory leak that involves flying close to the ground."},{"CreatedByName":"smjjames","CreatedById":134004,"CreatedDateTime":"2015-02-20T21:09:58Z","Content":"\u003E \n\u003E Someone needs to learn how to use valgrind.\n\nHuh?\n\nAlso, say that your computer suddenly got a major slowdown and stuttering, for absolutely no reason, closing the game doesn\u0027t help, only a restart fixes it, what would you call this problem?"},{"CreatedByName":"smjjames","CreatedById":134004,"CreatedDateTime":"2015-02-20T21:36:16Z","Content":"\u003E \n\u003E I mean someone is SQUAD. Or makers of that damn game engine, forgot it\u0027s name.\n\u003E Sudden slowdown is usually caused by malware or automatic update of some sort. I usually try to setup software to \u0022Only notify\u0022 instead of \u0022Suddenly download 1GB patch and ruin my DDO run\u0022\n\nExcept it happens after a long while, and I\u0027m pretty sure it\u0027s not malware or a download."},{"CreatedByName":"NathanKell","CreatedById":75006,"CreatedDateTime":"2015-02-20T22:53:43Z","Content":"Yeah, the way Unity GC appears to work, \\*most\\* of the leaks get unleaked on scene change. That doesn\u0027t help if you leak enough to go over limit, but if you (say) regularly remember to exit and reenter the VAB it\u0027ll help."},{"CreatedByName":"sal_vager","CreatedById":16426,"CreatedDateTime":"2015-02-20T22:58:10Z","Content":"Also don\u0027t forget that the state of 0.90.0 isn\u0027t indicative of the state of 1.0, memory leaks will be fixed if found, so don\u0027t forget to report them on the tracker rather than just writing them off ![;)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif)\n\n**Edited \u003Ctime datetime=\u00222015-02-20T23:06:06Z\u0022 title=\u002202/20/2015 11:06  PM\u0022 data-short=\u00229 yr\u0022\u003EFebruary 20, 2015\u003C/time\u003E by sal\\_vager**"},{"CreatedByName":"MartGonzo","CreatedById":65764,"CreatedDateTime":"2015-02-20T23:05:44Z","Content":"\u003E \n\u003E Also don\u0027t forget that the state of 0.90.0 isn\u0027t indicative of the state of 1.0, memory leaks will be fix if found, so don\u0027t forget to report them on the tracker rather than just writing them off ![;)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif)\n\nHmmm...I\u0027ve come across a few games with memory leaks over the years, I don\u0027t think I ever remember one that got completely fixed, just tinkered with to reduce the problem.\n\nMemory leaks are the sort of thing that needs to be identified and squashed during engine development, which doesn\u0027t apply to Squad of course as it isn\u0027t their engine."},{"CreatedByName":"sal_vager","CreatedById":16426,"CreatedDateTime":"2015-02-20T23:07:09Z","Content":"Very true, Squad will try and fix their leaks, but engine leaks depend on Unity."},{"CreatedByName":"cpast","CreatedById":112846,"CreatedDateTime":"2015-02-20T23:09:52Z","Content":"\u003E \n\u003E Huh?\n\u003E Also, say that your computer suddenly got a major slowdown and stuttering, for absolutely no reason, closing the game doesn\u0027t help, only a restart fixes it, what would you call this problem?\n\nValgrind is a tool to let you hunt memory leaks (and more generally to track memory usage in your programs); it\u0027s used by developers to try to eliminate them."},{"CreatedByName":"Renegrade","CreatedById":96629,"CreatedDateTime":"2015-02-21T14:38:52Z","Content":"\u003E \n\u003E Is there any validation to this? tweakables seems to run up the ram usage or something.\n\u003E [http://i.imgur.com/SPJnuU0.gif](http://i.imgur.com/SPJnuU0.gif)\n\n\u003E \n\u003E Ready for 1.0!\n\u003E [http://i.imgur.com/LSGfNIX.gif](http://i.imgur.com/LSGfNIX.gif)\n\nI am highly alarmed by these two gifs.\n\nA) That\u0027s.. a stupendous amount of memory for a tweakable. You could probably screenshot the tweakables, store \u0027em as bitmaps, and they\u0027d STILL not use that much memory.. what the heck is going on???\n\n![B)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_cool.png) If you\u0027re using commas for the radix point, shouldn\u0027t it be spaces or periods for the thousands separator? :S"},{"CreatedByName":"TMS","CreatedById":57134,"CreatedDateTime":"2015-02-21T15:58:38Z","Content":"My crashes usually occur when testing plane designs and moving repeatedly between the SPH and the runway."},{"CreatedByName":"Renegrade","CreatedById":96629,"CreatedDateTime":"2015-02-26T19:34:45Z","Content":"Just want to add that I left a somewhat-modded KSP open on a tweakable interface, having done literally nothing else (and it\u0027s a tiny sanbox save with nothing going on in it), and KSP only took 15-30 minutes to fill up it\u0027s memory and crash:\n\n![FAR-Tweakables.jpg](http://alpha.renegrade.net/images/NEAR/FAR-Tweakables.jpg)\n\n(I opened it just for this screenshot and left it running in the background - basically negligence there ![;)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif) )\n\nLogs reported out memory problem, and the process usage was north of 3.8 gigs at that point, having started at 2.5 gigs.\n\nThere\u0027s *definitely* something to this tweakable stuff."},{"CreatedByName":"Laie","CreatedById":110461,"CreatedDateTime":"2015-02-26T20:48:01Z","Content":"The trouble I\u0027m having is that after some time, KSP becomes stall-ish: every two or three seconds there will be a short break where the game effectively stops and is unresponsive for a moment; works fine in the time between, though, and we\u0027re really only taking about moment-long stalls. If they wouldn\u0027t repeat so often, I might not notice them. Anyhoo, at that point I know that if I don\u0027t restart KSP on my own terms, a restart will soon be forced on me.\n\nI\u0027m under the impression that the condition becomes especially bad when switching between vessels a lot, or when doing the revert-launch cycle over and over again."},{"CreatedByName":"Renegrade","CreatedById":96629,"CreatedDateTime":"2015-02-26T21:50:19Z","Content":"\u003E \n\u003E The trouble I\u0027m having is that after some time, KSP becomes stall-ish: every two or three seconds there will be a short break where the game effectively stops and is unresponsive for a moment; works fine in the time between, though, and we\u0027re really only taking about moment-long stalls. If they wouldn\u0027t repeat so often, I might not notice them. Anyhoo, at that point I know that if I don\u0027t restart KSP on my own terms, a restart will soon be forced on me.\n\nI\u0027ve seen that stuff too, and I saw something in a log once on a game on the verge of a memory crash - the GC was doing emergency cleanups, and it was taking \u003E500ms - that\u0027s over a half second, or thirty frames, and is definitely a rather long pause. Way too long for a video game."},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2015-02-26T22:45:42Z","Content":"\u003E \n\u003E A) That\u0027s.. a stupendous amount of memory for a tweakable. You could probably screenshot the tweakables, store \u0027em as bitmaps, and they\u0027d STILL not use that much memory.. what the heck is going on???\n\nThis looks very similar to a leak I accidentally caused in the past through some GUI code (Sane Strategies, that little bit of extra text on the strategies window was doing a few MB/s initially). What happened with me was that every time the element was redrawn, the old version was overwritten but not erased. Now, this doesn\u0027t happen with the base Unity Gui code, but that piece of text was written on a custom Squad class. It still leaks like mad when you switch strategies or change commitment , but it only does it when parameters change now(ie. you can force it, but thats not on me any more).\n\nI have a feeling the tweakables suffer from something similar. Instead of drawing the same object, they are updating the object even when no changes are made and the old object is not being discarded properly.\n\n**Edited \u003Ctime datetime=\u00222015-02-26T23:01:02Z\u0022 title=\u002202/26/2015 11:01  PM\u0022 data-short=\u00229 yr\u0022\u003EFebruary 26, 2015\u003C/time\u003E by Crzyrndm**"},{"CreatedByName":"Brotoro","CreatedById":57674,"CreatedDateTime":"2015-02-26T22:54:30Z","Content":"Not convinced that there are memory leaks? Well, WHATEVER causes my lightly-modded game to freeze up (almost always this happens during scene changes) is really sucking the fun out of the game for me. I hope it gets fixed. I have plenty of memory for KSP to use."},{"CreatedByName":"Renegrade","CreatedById":96629,"CreatedDateTime":"2015-02-27T05:56:25Z","Content":"\u003E \n\u003E This looks very similar to a leak I accidentally caused in the past through some GUI code (Sane Strategies, that little bit of extra text on the strategies window was doing a few MB/s initially). What happened with me was that every time the element was redrawn, the old version was overwritten but not erased. Now, this doesn\u0027t happen with the base Unity Gui code, but that piece of text was written on a custom Squad class. It still leaks like mad when you switch strategies or change commitment , but it only does it when parameters change now(ie. you can force it, but thats not on me any more).\n\u003E I have a feeling the tweakables suffer from something similar. Instead of drawing the same object, they are updating the object even when no changes are made and the old object is not being discarded properly.\n\nThat DOES sound like it could be related - similar aspects, and similar memory loss rates. Good find!\n\n(it could just be a coincidence, but it\u0027s just *too* suspiciously similar in my mind - got a good lead here I say)."}]}