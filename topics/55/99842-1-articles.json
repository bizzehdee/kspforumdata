{"TopicId":99842,"ForumId":55,"TopicTitle":"What is stopping Squad from loading textures on demand?","CreatedByName":"theend3r","CreatedById":97560,"CreatedDateTime":"2015-02-16T19:12:22Z","PageNum":1,"Articles":[{"CreatedByName":"theend3r","CreatedById":97560,"CreatedDateTime":"2015-02-16T19:12:22Z","Content":"\n\u003Cp\u003EOne of the largest problems, if not \u003Cem\u003Ethe\u003C/em\u003E largest problem, of the current KSP is the memory problem which makes the loading times long and prevents large scale modding.\u003C/p\u003E\u003Cp\u003EThe solution to this is to either use the 64 bit .exe which is no longer supported, use the -force-opengl option which has some quirks and magically takes up a lot of ram \u003C/p\u003E\u003Cblockquote\u003E\u003Cimg src=\u0022http://i.imgur.com/bLaWFV1.jpg\u0022 alt=\u0022bLaWFV1.jpg\u0022\u003E\u003C/blockquote\u003E\u003Cblockquote\u003E or downscale the textures and make the game look horrible.\u003C/blockquote\u003E\u003Cp\u003EThis could all be solved by loading the textures on demand like most other games do and the loading times would be far shorter too. You\u0027d still probably need most of them in the editor but that could easily be solved by using thumbnails. There was even a mod (that is unfortunately no longer developed) that did this so it should definitely be possible. Why doesn\u0027t squad do it?\u003C/p\u003E\n"},{"CreatedByName":"Red Iron Crown","CreatedById":12858,"CreatedDateTime":"2015-02-16T19:18:58Z","Content":"\n\u003Cp\u003EThat\u0027s a good question. I suspect that their focus has been on improving the stock game, and such a change would have a minimal effect on a stock install.\u003C/p\u003E\n"},{"CreatedByName":"Superfluous J","CreatedById":73725,"CreatedDateTime":"2015-02-16T19:20:59Z","Content":"\n\u003Cp\u003ECurrently, the biggest thing stopping them is this huge project they\u0027ve undertaken, and possibly a fairly new and aggressive release timetable they\u0027re under to release that project. Maybe you\u0027ve heard of it \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif\u0022 alt=\u0022;)\u0022\u003E\u003C/p\u003E\u003Cp\u003EAfter 1.0 comes out, then I hope the only thing stopping them is the front door to the office. Which will hopefully be unlocked and have a coffee machine right behind it.\u003C/p\u003E\n"},{"CreatedByName":"theend3r","CreatedById":97560,"CreatedDateTime":"2015-02-16T19:23:02Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Red Iron Crown\u0022 data-cite=\u0022Red Iron Crown\u0022\u003E\u003Cdiv\u003EThat\u0027s a good question. I suspect that their focus has been on improving the stock game, and such a change would have a minimal effect on a stock install.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EIt would significantly reduce the loading time at least.\u003C/p\u003E\n"},{"CreatedByName":"Red Iron Crown","CreatedById":12858,"CreatedDateTime":"2015-02-16T19:28:43Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022theend3r\u0022 data-cite=\u0022theend3r\u0022\u003E\u003Cdiv\u003EIt would significantly reduce the loading time at least.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EIt would, for sure. I was merely suggesting what I think the reasoning might be, that they have much bigger things to do in the stock game before getting to this.\u003C/p\u003E\n"},{"CreatedByName":"Yakuzi","CreatedById":85181,"CreatedDateTime":"2015-02-16T19:58:52Z","Content":"\n\u003Cp\u003EIt will be interesting to see how 1.0 will run in 32 bit with the vast multitude of new parts and features planned (e.g. new landing gear, bigger wings, IVAs for all crew compartments, heatshields, resource exploitation equipment, procedural fairings, new space center buildings and several GUI overlays). Particularly since some players were already struggling with memory issues in stock 0.90 and will further reduce the memory available for installing mods. \u003C/p\u003E\u003Cp\u003EIf Squad doesn\u0027t optimise memory usage in 1.0, they should definitely address it in their first patch (or second, the first will likely be \u0022the squashing of *more-than-one* bugs patch\u0022)\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-02-16T20:00:06Z\u0022 title=\u002202/16/2015 08:00  PM\u0022 data-short=\u00229 yr\u0022\u003EFebruary 16, 2015\u003C/time\u003E by Yakuzi\u003C/strong\u003E\n\u003Cbr\u003Elanguage\n\u003C/span\u003E\n"},{"CreatedByName":"NathanKell","CreatedById":75006,"CreatedDateTime":"2015-02-16T22:24:01Z","Content":"\n\u003Cp\u003EQ: What\u0027s stopping them?\u003C/p\u003E\u003Cp\u003EA: Time.\u003C/p\u003E\u003Cp\u003EWhat would reduce loading time is converting *.mbm to *.dds, though, and that doesn\u0027t actually take coding time really (the DDSLoader is perhaps the simplest, shortest plugin ever written); Load-On-Demand will actually slow loading time, because the textures have to be read and then low-rez placeholders made from them (one load step) and then each time a texture is actually needed at high rez it has to be loaded again.\u003C/p\u003E\n"},{"CreatedByName":"Beduino","CreatedById":81326,"CreatedDateTime":"2015-04-02T19:45:46Z","Content":"\n\u003Cp\u003E\u002B1 to this I\u0027m upvoting they fix it as soon as possible as described in this thread. They can probably do a better job than any mod by improving the base code. \u003C/p\u003E\u003Cp\u003EThen we have:\u003C/p\u003E\u003Cp\u003ELower memory footprint\u003C/p\u003E\u003Cp\u003EReduced loading times\u003C/p\u003E\u003Cp\u003EMore mods\u002Bmore parts\u002Bmore fun\u003C/p\u003E\u003Cp\u003EMaybe optimize the planets so we can have more, maybe even another star with little memory/performance hit.\u003C/p\u003E\u003Cp\u003EMaybe they could even figure out a way to improve performance with increasing part count so we can use even more parts to build larger bases/ships.\u003C/p\u003E\n"},{"CreatedByName":"bv1","CreatedById":127982,"CreatedDateTime":"2015-04-03T21:27:51Z","Content":"\n\u003Cp\u003EI\u0027ve always wondered this too. It seems ridiculous to have to have every single part texture loaded into memory at all time, when there are parts I never use at all.\u003C/p\u003E\n"},{"CreatedByName":"Robotengineer","CreatedById":104525,"CreatedDateTime":"2015-04-03T21:52:03Z","Content":"\n\u003Cp\u003ELoad-On-Demand would be a pain. Converting all textures to .dds, and adding a DDSloader would be better IMO.\u003C/p\u003E\n"},{"CreatedByName":"Damien_The_Unbeliever","CreatedById":129715,"CreatedDateTime":"2015-04-04T00:31:13Z","Content":"\n\u003Cp\u003EWell, there\u0027s a possibility that the DDS thing has already been \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/113382-Devnote-Tuesday-Experimenting-and-Researching\u0022 rel=\u0022external nofollow\u0022\u003Edone\u003C/a\u003E:\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003E\u003Cspan style=\u0022color:#333333;\u0022\u003EAdditionally, that branch also contained a tentative implementation of DDS formatted textures for KSP, so far cutting the initial asset loading of KSP by 1/3rd if not more in some cases.\u003C/span\u003E\u003C/div\u003E\u003C/blockquote\u003E\n"},{"CreatedByName":"Beduino","CreatedById":81326,"CreatedDateTime":"2015-04-04T01:14:56Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Robotengineer\u0022 data-cite=\u0022Robotengineer\u0022\u003E\u003Cdiv\u003ELoad-On-Demand would be a pain. Converting all textures to .dds, and adding a DDSloader would be better IMO.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EActually it\u0027s not a pain, it\u0027s the sane thing to do. Can you imagine half-life loading all the textures and maps into memory?\u003C/p\u003E\u003Cp\u003EIt should be something available in Unity actually. Judging from the fact that Cities Skyline also uses Unity and suffers the same fate of having mods and is loading everything into memory. \u003C/p\u003E\u003Cp\u003EMaybe it\u0027s something they improved in Unity5 but im not certain.\u003C/p\u003E\n"},{"CreatedByName":"Robotengineer","CreatedById":104525,"CreatedDateTime":"2015-04-04T03:27:59Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Beduino\u0022 data-cite=\u0022Beduino\u0022\u003E\u003Cdiv\u003EActually it\u0027s not a pain, it\u0027s the sane thing to do. Can you imagine half-life loading all the textures and maps into memory?\u003Cp\u003EIt should be something available in Unity actually. Judging from the fact that Cities Skyline also uses Unity and suffers the same fate of having mods and is loading everything into memory. \u003C/p\u003E\u003Cp\u003EMaybe it\u0027s something they improved in Unity5 but im not certain.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThe issue is that when you load large crafts, such as bases or stations, you have a huge loading time whenever you switch crafts.\u003C/p\u003E\n"},{"CreatedByName":"Van Disaster","CreatedById":58876,"CreatedDateTime":"2015-04-04T05:07:38Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Robotengineer\u0022 data-cite=\u0022Robotengineer\u0022\u003E\u003Cdiv\u003EThe issue is that when you load large crafts, such as bases or stations, you have a huge loading time whenever you switch crafts.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EEven if you preloaded every asset used by every ship in your current persistence file you\u0027re still unlikely to load \u003Cstrong\u003Eevery asset in the game\u003C/strong\u003E. You can stream textures in a seperate thread \u0026amp; gracefully insert them into the scene - might get the odd missing or blurred texture for a tiny bit but you could do it without pausing the game.\u003C/p\u003E\n"},{"CreatedByName":"klgraham1013","CreatedById":105132,"CreatedDateTime":"2015-04-04T13:17:44Z","Content":"\n\u003Cp\u003EI\u0027d also like to add that, even if there may be down sides to not loading part textures, having all the HD planet textures in memory all the time is unnecessary.\u003C/p\u003E\n"},{"CreatedByName":"Eric S","CreatedById":57117,"CreatedDateTime":"2015-04-04T22:02:52Z","Content":"\n\u003Cp\u003EI\u0027ve heard (but not confirmed) that one of the memory leaks in KSP has to do with the fact that the memory it loads the on-disk textures into doesn\u0027t get released after conversion to the graphics card\u0027s (or is it Unity\u0027s?) preferred texture format. If that\u0027s one of the memory leaks that have been fixed, then this becomes a non-issue. I\u0027m not sure if converting to DDS textures on disk will eliminate this or reduce it, and I\u0027m not even sure that that change is going live with 1.0, but if it is, it will reduce the memory leak even if the memory leak itself isn\u0027t fixed.\u003C/p\u003E\u003Cp\u003EWhy is that memory leak important? Because if you\u0027ve got a memory leak, you\u0027re better off only doing it once, not repeatedly. A load-once and then keep resident method would get around this, but could still cause problems, say you do a grand tour in a single session, you\u0027d then have all the HD planet textures in memory regardless of which one you\u0027re in orbit at the end of the tour. \u003C/p\u003E\u003Cp\u003EIt\u0027s possible that the reason that KSP doesn\u0027t do dynamic loading/unloading is because of the memory leaks. It\u0027s also possible that they just haven\u0027t gotten around to it. And yes, it\u0027s also possible that they don\u0027t consider it important. I can understand the first two as long as there\u0027s progress being made, but I\u0027d disagree with the third, though how strongly I\u0027d disagree would depend on how much fixing 0.90s memory leaks and DDS conversion help vs how much the new 1.0 assets hurt. \u003C/p\u003E\u003Cp\u003EI haven\u0027t run into memory problems with 0.90 even modded, but I\u0027ve heard that if you\u0027re running on an actual 32-bit version of windows your margin for leakage is smaller so even stock crashes after a few scene changes or a few hours. I\u0027d like to see KSP reach the point that you could heavily mod it even on 32-bit windows, but I don\u0027t see that as a critical priority for 1.0. Being able to run stock or even lightly modded KSP for hours on a 32-bit OS would be more critical for 1.0, and at this time, I don\u0027t think we have enough information to know how close to any of these goals 1.0 will be.\u003C/p\u003E\n"},{"CreatedByName":"Eric S","CreatedById":57117,"CreatedDateTime":"2015-04-04T22:41:47Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Beduino\u0022 data-cite=\u0022Beduino\u0022\u003E\u003Cdiv\u003EIt should be something available in Unity actually. Judging from the fact that Cities Skyline also uses Unity and suffers the same fate of having mods and is loading everything into memory.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EFrom reading the online documentation, Unity 4 does have the ability to dynamically load and unload assets. I\u0027ll admit that there may be catches that I\u0027m unaware of. On the other hand, KSP texture loading has memory leak issues as of 0.90, so dynamic loading/unloading of assets could actually make the situation worse as the memory could get leaked multiple times. \u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Van Disaster\u0022 data-cite=\u0022Van Disaster\u0022\u003E\u003Cdiv\u003EYou can stream textures in a seperate thread \u0026amp; gracefully insert them into the scene\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ENot in Unity 4. This should be possible in Unity 5, but as I understand it, much of the Unity 4 API isn\u0027t thread safe and in fact there are safeguards within Unity 4 to ensure that only the proper thread accesses the API. You might be able to bypass Unity\u0027s texture file loading, load from the file in a separate thread, then have the main thread load the texture from the memory that the other thread loaded it into, but I\u0027m not sure you\u0027re really gaining anything there.\u003C/p\u003E\u003Cp\u003EEDIT: ugh, thought there was two similar threads, sorry for two similar posts.\u003C/p\u003E\n"},{"CreatedByName":"Gkirmathal","CreatedById":135480,"CreatedDateTime":"2015-04-05T01:01:06Z","Content":"\n\u003Cp\u003EIn my opinion \u003Cem\u003Eload-on-demand\u003C/em\u003E wont do much if the game does not properly \u003Cem\u003E\u003Cstrong\u003Eunload data\u003C/strong\u003E\u003C/em\u003E it doesn\u0027t need anymore. This not unloading of data, being automated (GC) or manually thru code, in my book is called a memory leak. \u003C/p\u003E\u003Cp\u003EIn my opinion if Squad \u003Cem\u003Efixes\u003C/em\u003E the not properly unloading of non used data, via GC optimizations or manually culling it, a lot of memory related problems will be solved. And all data can still be loaded in memory on start.\u003C/p\u003E\u003Cp\u003EOne of my personal main annoyances is when often switching scenes: 1) an hour editing \u0026gt; lauchpad \u0026gt; editor, or 2) KSC \u0026gt; craft \u0026gt; KCS. The ram profile steadily climbs, sometimes it lowers GC at work, but on re entering the editor it adds more memory back than the GC cleared. \u003C/p\u003E\u003Cp\u003ESeen this on stock KSP and this issue is even more magnified when using several part packs. \u003C/p\u003E\u003Cp\u003EI read in the DevNotes or comments there (coupleweeks ago?), the current GC implementation causes issues when the client over time starts to run high on memory, which causes stuttering and low fps as the GC starts to struggle.\u003C/p\u003E\u003Cp\u003EI\u0027m no coder, but this made me think doing it manually might be better than letting U4 handle unloading.\u003C/p\u003E\u003Cp\u003E@Eric S, you say you never noticed \u003Cem\u003Eany\u003C/em\u003E memory leak issues? Not even when switching scenes countless times between the editor \u0026gt; launchpad/KCS\u003C/p\u003E\u003Cp\u003EIf I may ask you for a favor. Could you log an hour or so of: editor \u0026gt; launching \u0026gt; reverting to editor \u0026gt; repeat? Stock or modded, I\u0027d like to know your start and end memory footprint of the KSP process.\u003C/p\u003E\u003Cp\u003Eninja edit: load-on-demand would be initially perfect for planets/bodies. It will make it possible to have more bodies in KSP.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-04-05T01:05:09Z\u0022 title=\u002204/05/2015 01:05  AM\u0022 data-short=\u00229 yr\u0022\u003EApril 5, 2015\u003C/time\u003E by Gkirmathal\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"NathanKell","CreatedById":75006,"CreatedDateTime":"2015-04-05T02:39:39Z","Content":"\n\u003Cp\u003EMy understanding is this: the \u003Cem\u003EUnity\u003C/em\u003E 4.x DX9 client will keep shadow copies of textures in system RAM even after they have been uploaded to VRAM and made unreadable-by-software (i.e. told not to keep the shadow copy). This bug does not exist in Unity\u0027s OpenGL client, which is why OpenGL mode uses so much less RAM.\u003C/p\u003E\u003Cp\u003EThis has literally nothing to do with loading and unloading of assets; if you unload a texture, it does indeed unload.\u003C/p\u003E\u003Cp\u003EWhat is relevant to streaming assets is that stock KSP 0.90 has issues with PNG and TGA loading, and even MBMs still have to be compressed. However, in 1.0 there\u0027s DDS support, which should make streaming assets much easier (in terms of lacking loader or leak issues with png/tga, and in terms of not having a \u0027compress\u0027 step or, for PNG, a prior \u0027decompress\u0027 step, so there won\u0027t even be a performance hit).\u003C/p\u003E\u003Cp\u003ENote that all KSP\u0027s assets in the \u0022assets\u0022 files are \u003Cem\u003Ealready DDS\u003C/em\u003E--that\u0027s why you don\u0027t see a delay while KSP loads them at startup, they load so fast.\u003C/p\u003E\u003Cp\u003EIt is entirely, entirely technically possible to write a streaming loader for KSP, it has been since 0.20, it just has not been a priority for the devs. Speculating about mysterious issues that might technically prevent it is a fool\u0027s errand: there \u003Cem\u003Eare\u003C/em\u003E none, as the \u003Cem\u003Emod that does this \u003C/em\u003Eproved.\u003C/p\u003E\n"},{"CreatedByName":"Fel","CreatedById":57121,"CreatedDateTime":"2015-04-05T03:16:12Z","Content":"\n\u003Cp\u003EAren\u0027t there several posts where SQUAD members directly talked about this very issue? I remember HarvesteR talking as if this was due to limitations within Unity.\u003C/p\u003E\n"},{"CreatedByName":"rkman","CreatedById":15721,"CreatedDateTime":"2015-04-05T09:19:13Z","Content":"\n\u003Cp\u003ELoading textures on demand would only make sense if textures are also unloaded when not needed. That means part textures would have to be loaded every time you switch to another parts tab in the editor. Not doing that would mean eventually all (or at least a large number) of part textures end up and remain in memory. \u003C/p\u003E\u003Cp\u003EI could be mistaken but i think planet/moon textures already are loaded an unloaded as needed. \u003C/p\u003E\u003Cp\u003EDDS loader demonstrates that just using DDS instead of other image formats saves a ton of loading time and memory. The one thing i don\u0027t understand is why Squad has not moved to DDS much sooner in development. It\u0027s not the sort of change that might cause problems later in development, and would over the past years collectively have saved us a whole lot of time waiting for the game to load.\u003C/p\u003E\n"},{"CreatedByName":"comham","CreatedById":43245,"CreatedDateTime":"2015-04-05T10:00:56Z","Content":"\n\u003Cp\u003EKSP was designed and built as a game where you stack (a limited selection of stock) rocket parts in stages. Planes are a kludgy afterthought. Dealing with 20 times the assets that squad made wasn\u0027t even considered.\u003C/p\u003E\n"},{"CreatedByName":"Eric S","CreatedById":57117,"CreatedDateTime":"2015-04-06T01:06:05Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Gkirmathal\u0022 data-cite=\u0022Gkirmathal\u0022\u003E\u003Cdiv\u003E@Eric S, you say you never noticed \u003Cem\u003Eany\u003C/em\u003E memory leak issues?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThat came out wrong, even though technically correct. I haven\u0027t crashed in 0.90 due to memory leaks. In fact, I can\u0027t remember crashing at all in 0.90. Because I haven\u0027t crashed, I haven\u0027t paid attention to memory usage. I am in no way denying that 0.90 suffers from memory leaks.\u003C/p\u003E\u003Cp\u003EI\u0027m not too worried about the memory leak in the VAB-\u0026gt;Launchpad scene change because that\u0027s one of the few memory leaks that they confirmed that they fixed already. Max said that they\u0027ve probably fixed 8-12 memory leaks if I remember right, but wouldn\u0027t state what any of them were, but one of the devs mentioned that specific one in the dev notes.\u003C/p\u003E\n"}]}