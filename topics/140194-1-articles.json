{"TopicId":140194,"ForumId":29,"TopicTitle":"Rigidbody physics in KSP","CreatedByName":"Ser","CreatedById":104207,"CreatedDateTime":"2016-05-20T20:45:15Z","PageNum":1,"Articles":[{"CreatedByName":"Ser","CreatedById":104207,"CreatedDateTime":"2016-05-20T20:45:15Z","Content":"\n\u003Cp\u003E\nI\u0027m trying to make a vessel jump with the given velocity on ground contact by using \u003Cspan style=\u0022color:#191970;font-weight:bold;\u0022\u003ErigidBody.AddForce\u003C/span\u003E(force,\u00A0ForceMode.VelocityChange).\n\u003C/p\u003E\n\u003Cp\u003E\nBriefly, the problem is that the vessel reacts to the approximately same vertically applied force differently when it is on the ground or when it just touches the surface after falling down.\n\u003C/p\u003E\n\u003Cp\u003E\nWhat I\u0027ve tried:\n\u003C/p\u003E\n\u003Cp\u003E\nWhen a vessel is landed and settled on the ground, applying a force straight up with a magnitude of 0.5 .. 1 has no significant effect instead of making the vessel change it vertical velocity. Even changing to ForceMode.Acceleration that should apply a constant force does nothing. But if I change to \u003Cem\u003EForceMode.Impulse\u003C/em\u003E the magnitude of 0.01, it is engough to have a minimal significant effect on the vessel.\n\u003C/p\u003E\n\u003Cp\u003E\nSo my thoughts are: When I use \u003Cspan style=\u0022color:#191970;font-weight:bold;\u0022\u003EAddForce\u003C/span\u003E(force,\u00A0ForceMode.VelocityChange), in fact it tells the physics to apply force to the rigidbody to make equivalent velocity change. But there\u0027s another force in the opposite direction that counters it - the gravity, that\u0027s why it has no effect. ForceMode.Impulse uses impulse, i.e. \u003Cem\u003Emass * velocity\u003C/em\u003E. So having magnitude of 0.01 m/s and mass around 1000 kg I have impulse equal to 10 that is just above the 9,8 m/s^2 of gravity and that let\u0027s the vessel feel the punch. Is that right?\n\u003C/p\u003E\n\u003Cp\u003E\nSo I add -g vector to my force to overcome gravity and have the desired effect. Unless when the vessel is not settled on the ground but falls down, the effect is that it bounces back up at excessive velocity every time it touches the surface and it starts to feel like the added -g is redundant. EVAs also seem to be overpushed, being Kraken-ejected to the sky and vaporized at 243 m/s.\n\u003C/p\u003E\n\u003Cp\u003E\nThe question: how to properly manage both landed and fallen down vessels to react to the vertical force in the same and proper way? In both cases the vessels have landed = true state and their parts have GroundContact = true.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-05-21T06:54:18Z\u0022 title=\u002205/21/2016 06:54  AM\u0022 data-short=\u00228 yr\u0022\u003EMay 21, 2016\u003C/time\u003E by Ser\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Ziw","CreatedById":135292,"CreatedDateTime":"2016-05-21T06:55:11Z","Content":"\n\u003Cp\u003E\nDo you apply force in every update or only once? If its the latter then ofc it would not work as expected. AddForce is meant to be maintained in each FixedUpdate to be meaningful, with the exception of Impulse type\n\u003C/p\u003E\n"},{"CreatedByName":"Ser","CreatedById":104207,"CreatedDateTime":"2016-05-21T07:00:43Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222593890\u0022 data-ipsquote-contentid=\u0022140194\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221463813711\u0022 data-ipsquote-userid=\u0022135292\u0022 data-ipsquote-username=\u0022Ziw\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n1 minute ago, Ziw said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nDo you apply force in every update or only once? If its the latter then ofc it would not work as expected. AddForce is meant to be maintained in each FixedUpdate to be meaningful, with the exception of Impulse type\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nI apply it only once. In fact it should simulate a momentary impulse disregarding the vessel\u0027s mass, so I have no idea how long should I maintain it. Should I use the Impulse type with magnitude divided by mass instead?\n\u003C/p\u003E\n"},{"CreatedByName":"Ziw","CreatedById":135292,"CreatedDateTime":"2016-05-21T08:08:50Z","Content":"\n\u003Cp\u003E\nLooks like it, from what I see in the docs\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022http://docs.unity3d.com/ScriptReference/ForceMode.Impulse.html\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://docs.unity3d.com/ScriptReference/ForceMode.Impulse.html\u003C/a\u003E\n\u003C/p\u003E\n"},{"CreatedByName":"Ser","CreatedById":104207,"CreatedDateTime":"2016-05-21T13:12:13Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222593952\u0022 data-ipsquote-contentid=\u0022140194\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221463818130\u0022 data-ipsquote-userid=\u0022135292\u0022 data-ipsquote-username=\u0022Ziw\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n4 hours ago, Ziw said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nLooks like it, from what I see in the docs\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022http://docs.unity3d.com/ScriptReference/ForceMode.Impulse.html\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://docs.unity3d.com/ScriptReference/ForceMode.Impulse.html\u003C/a\u003E\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThanks.\n\u003C/p\u003E\n\u003Cp\u003E\nDividing by mass doesn\u0027t work well for massive vessels, so using just Impulse type seems to suite my needs best although I don\u0027t fully understand the math behind it.\n\u003C/p\u003E\n"},{"CreatedByName":"MrHappyFace","CreatedById":76365,"CreatedDateTime":"2016-05-23T16:21:57Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222594155\u0022 data-ipsquote-contentid=\u0022140194\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221463836333\u0022 data-ipsquote-userid=\u0022104207\u0022 data-ipsquote-username=\u0022Ser\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nOn 5/21/2016 at 8:12 AM, Ser said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nThanks.\n\u003C/p\u003E\n\u003Cp\u003E\nDividing by mass doesn\u0027t work well for massive vessels, so using just Impulse type seems to suite my needs best although I don\u0027t fully understand the math behind it.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nYou multiply by mass.\n\u003C/p\u003E\n\u003Cp\u003E\nNewtons 2nd law states F = MA\n\u003C/p\u003E\n\u003Cp\u003E\nYou want to increase your\u00A0upwards velocity\u00A0by 0.01 \u002B g m/s, which is an acceleration of 0.01 \u002B g.\n\u003C/p\u003E\n\u003Cp\u003E\nTo get the correct Force, you multiply Mass by Acceleration. F = MA.\n\u003C/p\u003E\n\u003Cp\u003E\nAlternatively you could use the VelocityChange ForceMode, and just use 0.01 \u002B g as the magnitude, without mucking about with masses.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nSide note:\u003Cbr\u003E\nThe difference between the ForceModes are as follows:\n\u003C/p\u003E\n\u003Cp\u003E\nForce - A regular force. Applying a force of 1kN for 1 second on a 1kg object speeds it up to 1m/s.\n\u003C/p\u003E\n\u003Cp\u003E\nAcceleration - An acceleration. Applying an\u00A0acceleration of 1kN for 1 second speeds the object up to 1m/s regardless of mass.\n\u003C/p\u003E\n\u003Cp\u003E\nImpulse - An impulse force. Applying an impulse of 1kN for 1 frame on a 1kg object speeds it\u00A0up to 1m/s.\n\u003C/p\u003E\n\u003Cp\u003E\nVelocityChange - A change in velocity. Applying a velocity change of 1kN for 1 frame speeds the object up to 1m/s regardless of mass.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nSide note 2:\u003Cbr\u003E\nYou can get the vector for gravity (gravity is not always down because of round planets) by using the following code:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003Evar gravityVector = FlightGlobals.getGeeForceAtPosition (vessel.GetWorldPos3D ());\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nThe vessel.GetWorldPos3D() function gets the worldspace position of the vessel.\n\u003C/p\u003E\n\u003Cp\u003E\nFor your purposes, you\u0027d do this to apply an upwards impulse of 0.01m/s:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003Evar impulseVector = gravityVector.normalized * (gravityVector.magnitude * -(1 \u002B impulseSpeed)); //impulseSpeed is 0.01m/s in this case\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nYou\u0027d take the impulseVector and use it in the rigidbody.AddForce function.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-05-23T16:33:51Z\u0022 title=\u002205/23/2016 04:33  PM\u0022 data-short=\u00228 yr\u0022\u003EMay 23, 2016\u003C/time\u003E by MrHappyFace\u003C/strong\u003E\n\u003Cbr\u003Eside note 2\n\u003C/span\u003E\n"},{"CreatedByName":"Ser","CreatedById":104207,"CreatedDateTime":"2016-05-24T10:13:17Z","Content":"\n\u003Cp\u003E\nThanks, \u003Cstrong\u003E\u003Ca data-ipshover=\u0022\u0022 data-ipshover-target=\u0022http://forum.kerbalspaceprogram.com/index.php?/profile/76365-mrhappyface/\u0026amp;do=hovercard\u0026amp;referrer=http%253A%252F%252Fforum.kerbalspaceprogram.com%252Findex.php%253F%252Ftopic%252F140194-rigidbody-physics-in-ksp%252F%2526_fromLogin%253D1\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/76365-mrhappyface/\u0022 title=\u0022Go to MrHappyFace\u0027s profile\u0022 rel=\u0022\u0022\u003EMrHappyFace\u003C/a\u003E\u003C/strong\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nI know the basic physics but something was useful.\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222597374\u0022 data-ipsquote-contentid=\u0022140194\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221464020517\u0022 data-ipsquote-userid=\u002276365\u0022 data-ipsquote-username=\u0022MrHappyFace\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n17 hours ago, MrHappyFace said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nAlternatively you could use the VelocityChange ForceMode, and just use 0.01 \u002B g as the magnitude, without mucking about with masses.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nAs I\u0027ve said in the OP, the problem is when I do so, it behaves differently under various conditions in KSP. As if when a vessel stands on the ground it is pulled down with gravity, but if it falls and touches the surface then it isn\u0027t. So I\u0027ve tried to use the Impulse mode to change velocity as its effect is more predictable. As impulse is v * m, I\u0027ve tried to divide it by mass to get the plain velocity but it seems like using just Impulse without modifications suits well.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-05-24T10:13:35Z\u0022 title=\u002205/24/2016 10:13  AM\u0022 data-short=\u00228 yr\u0022\u003EMay 24, 2016\u003C/time\u003E by Ser\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"MrHappyFace","CreatedById":76365,"CreatedDateTime":"2016-05-24T14:25:39Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222598567\u0022 data-ipsquote-contentid=\u0022140194\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221464084797\u0022 data-ipsquote-userid=\u0022104207\u0022 data-ipsquote-username=\u0022Ser\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n4 hours ago, Ser said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nThanks, \u003Cstrong\u003E\u003Ca data-ipshover=\u0022\u0022 data-ipshover-target=\u0022http://forum.kerbalspaceprogram.com/index.php?/profile/76365-mrhappyface/\u0026amp;do=hovercard\u0026amp;referrer=http%253A%252F%252Fforum.kerbalspaceprogram.com%252Findex.php%253F%252Ftopic%252F140194-rigidbody-physics-in-ksp%252F%2526_fromLogin%253D1\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/76365-mrhappyface/\u0022 rel=\u0022\u0022 title=\u0022Go to MrHappyFace\u0027s profile\u0022\u003EMrHappyFace\u003C/a\u003E\u003C/strong\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nI know the basic physics but something was useful.\n\u003C/p\u003E\n\u003Cp\u003E\n....\n\u003C/p\u003E\n\u003Cp\u003E\nAs impulse is v * m, I\u0027ve tried to divide it by mass to get the plain velocity but it seems like using just Impulse without modifications suits well.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nImpulse is not v * m.\n\u003C/p\u003E\n\u003Cp\u003E\n(Note that acceleration is change in velocity and\u00A0velocity is change in position.)\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cspan style=\u0022line-height:1.6;\u0022\u003EIn unity, you pass a vector\u00A0into the AddForce function, which is used as a force when it\u0027s in Force or Impulse mode, and an acceleration when it\u0027s in Acceleration or VelocityChange mode.\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nThat means that the resulting change in velocity (acceleration), in Force and Impulse mode\u00A0can be calculated easily by solving for A in the equation F = MA.\n\u003C/p\u003E\n\u003Cp\u003E\nF = MA\n\u003C/p\u003E\n\u003Cp\u003E\n(input of AddForce function) = (mass of rigidbody) * A\n\u003C/p\u003E\n\u003Cp\u003E\n(input of AddForce function) /\u00A0(mass of rigidbody) = A\n\u003C/p\u003E\n\u003Cp\u003E\nNow, assuming you input a force of 1kN with a mass of 10kg, you get this acceleration:\n\u003C/p\u003E\n\u003Cp\u003E\nF = MA\n\u003C/p\u003E\n\u003Cp\u003E\n1kN = 10kg * A\n\u003C/p\u003E\n\u003Cp\u003E\n1kN / 10kg = A\n\u003C/p\u003E\n\u003Cp\u003E\nA = 1/10m/s or 0.1m/s\n\u003C/p\u003E\n\u003Cp\u003E\nIf you add a 10kN force to a mass of 1kg, you get this:\n\u003C/p\u003E\n\u003Cp\u003E\nF = MA\n\u003C/p\u003E\n\u003Cp\u003E\n10kN = 1kg * A\n\u003C/p\u003E\n\u003Cp\u003E\n10kN / 1kg = A\n\u003C/p\u003E\n\u003Cp\u003E\nA = 10m/s\n\u003C/p\u003E\n\u003Cp\u003E\nFrom this, we can see that (in force or impuse mode) it\u00A0requires a greater force to accelerate\u00A0more massive objects by the same amount, so we increase the force by multiplying it by the mass,\u00A0NOT dividing it by the mass like (I think) you were doing.\n\u003C/p\u003E\n\u003Cp\u003E\nOf course you can bypass masses and forces entirely by just using Acceleration or VelocityChange modes, and just pass the desired acceleration in directly.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nEDIT: I reread your first post, and now\u00A0I\u0027m not entirely sure I know what the problem is. I though it was that the AddForce was behaving differently in different conditions, but that doesn\u0027t seem logical. Are you applying the force upwards as in (0, 1, 0), or upwards as in negative gravity. The gravity in KSP isn\u0027t always down, or even consistent for different positions, so you need to use the function getGeeForceAtPosition I explained in my first post. Also, are you using AddForce or AddRelativeForce, because if you\u0027re using AddRelativeForce, then the force would be applied in different directions based on the orientation of the rigidbody. Some source code would be immensely helpful.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-05-24T14:40:04Z\u0022 title=\u002205/24/2016 02:40  PM\u0022 data-short=\u00228 yr\u0022\u003EMay 24, 2016\u003C/time\u003E by MrHappyFace\u003C/strong\u003E\n\u003Cbr\u003Eadded EDIT\n\u003C/span\u003E\n"},{"CreatedByName":"Ser","CreatedById":104207,"CreatedDateTime":"2016-05-24T16:05:58Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222598851\u0022 data-ipsquote-contentid=\u0022140194\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221464099939\u0022 data-ipsquote-userid=\u002276365\u0022 data-ipsquote-username=\u0022MrHappyFace\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n1 hour ago, MrHappyFace said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nEDIT: I reread your first post, and now\u00A0I\u0027m not entirely sure I know what the problem is. I though it was that the AddForce was behaving differently in different conditions, but that doesn\u0027t seem logical. Are you applying the force upwards as in (0, 1, 0), or upwards as in negative gravity. The gravity in KSP isn\u0027t always down, or even consistent for different positions, so you need to use the function getGeeForceAtPosition I explained in my first post. Also, are you using AddForce or AddRelativeForce, because if you\u0027re using AddRelativeForce, then the force would be applied in different directions based on the orientation of the rigidbody. Some source code would be immensely helpful.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThe source code is different now because I decided to rely on Impulse instead of VelocityChange with -g vector.\n\u003C/p\u003E\n\u003Cp\u003E\nAnd I calculate the gravity vector slightly different. It looked as something like this:\u003Cbr\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003EVector3 straightDown = (vessel.mainBody.position - vessel.GetWorldPos3D()).normalized;\n\ndouble gAtAltitude = 6.67408f / Math.Pow(10, 11) * vessel.mainBody.Mass / Math.Pow(vessel.mainBody.Radius \u002B vessel.altitude, 2); // just g calculation\n\nvessel.parts.ForEach( part -\u0026gt; \n\t{\n\t\tif (part.GroundContact) {\n\t\t\tpart.rigidBody.AddForce(deltaVelocity - gAtAltitude * straightDown, ForceMode.VelocityChange);\n\t\t}\n\t});\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\ndeltaVelocity was a vector pointing straight up with magnitudes 0.01 - 1.0.\n\u003C/p\u003E\n\u003Cp\u003E\nThis had the effect I\u0027ve described earlier: a vessel standing on the ground received a tiny punch. But if the vessel was falling down and touched the ground it bounced up pretty high. If the vessel was a standing EVA kerbal, he was thrown even higher being teared apart by Kraken forces.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-05-24T16:16:52Z\u0022 title=\u002205/24/2016 04:16  PM\u0022 data-short=\u00228 yr\u0022\u003EMay 24, 2016\u003C/time\u003E by Ser\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Padishar","CreatedById":97386,"CreatedDateTime":"2016-05-24T16:16:27Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222598851\u0022 data-ipsquote-contentid=\u0022140194\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221464099939\u0022 data-ipsquote-userid=\u002276365\u0022 data-ipsquote-username=\u0022MrHappyFace\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n1 hour ago, MrHappyFace said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nNow, assuming you input a force of 1kN with a mass of 10kg, you get this acceleration:\n\u003C/p\u003E\n\u003Cp\u003E\nF = MA\n\u003C/p\u003E\n\u003Cp\u003E\n1kN = 10kg * A\n\u003C/p\u003E\n\u003Cp\u003E\n1kN / 10kg = A\n\u003C/p\u003E\n\u003Cp\u003E\nA = 1/10m/s or 0.1m/s\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nI think you\u0027ve made a mistake with your units here:\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nQuote\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nDefinition. A newton (N) is the international unit of measure for force. One newton is equal to 1 kilogram meter per second squared. In plain English, 1 newton of force is the force required to accelerate an object with a mass of 1 kilogram 1 meter per second per second.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\n...so your results\u00A0are 1000 times too small and the units should be m/s\u00B2.\n\u003C/p\u003E\n"},{"CreatedByName":"MrHappyFace","CreatedById":76365,"CreatedDateTime":"2016-05-24T16:35:03Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222599000\u0022 data-ipsquote-contentid=\u0022140194\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221464105958\u0022 data-ipsquote-userid=\u0022104207\u0022 data-ipsquote-username=\u0022Ser\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n29 minutes ago, Ser said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nThe source code is different now because I decided to rely on Impulse instead of VelocityChange with -g vector.\n\u003C/p\u003E\n\u003Cp\u003E\nAnd I calculate the gravity vector slightly different. It looked as something like this:\u003Cbr\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\n\u003Cspan class=\u0022pln\u0022\u003EVector3 straightDown = (vessel.mainBody.position - vessel.GetWorldPos3D()).normalized;\n\ndouble gAtAltitude = 6.67408f / Math.Pow(10, 11) * vessel.mainBody.Mass / Math.Pow(vessel.mainBody.Radius \u002B vessel.altitude, 2); // just g calculation\n\nvessel.parts.ForEach( part -\u0026gt; \n\t{\n\t\tif (part.GroundContact) {\n\t\t\tpart.rigidBody.AddForce(deltaVelocity - gAtAltitude * straightDown, ForceMode.VelocityChange);\n\t\t}\n\t});\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nThis had the effect I\u0027ve described earlier: a vessel standing on the ground received a tiny punch. But if the vessel was falling down and touched the ground it bounced up pretty high. If the vessel was a standing EVA kerbal, he was thrown even higher being teared apart by Kraken forces.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nWhy not do this:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode\u0022\u003E\npublic float impulseSpeed = 0.01;\n\n//...\n\nvar gravityVector = FlightGlobals.getGeeForceAtPosition (vessel.GetWorldPos3D ());\nvar impulseVector = gravityVector.normalized * (gravityVector.magnitude * -(1 \u002B impulseSpeed));\n\nvessel.parts.ForEach( part -\u0026gt; \n\t{\n\t\tif (part.GroundContact) {\n\t\t\tpart.rigidBody.AddForce(impulseVector, ForceMode.VelocityChange);\n\t\t}\n\t});\u003C/pre\u003E\n\u003Cp\u003E\nThe function getGeeForceAtPosition is the standard way to calculate gravity, used by stock code and\u00A0all the mods I\u0027ve seen, and it\u0027s probably more optimized\u00A0than yours is. Math.Pow function calls are relatively expensive too.\n\u003C/p\u003E\n\u003Cp\u003E\nAlso, I\u0027m pretty sure the EVA thing was because EVA kerbals don\u0027t take kindly to odd forces. I\u0027ve had a kerbal fly into to the air at 100m/s for hitting the ground in ragdoll mode.\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222599016\u0022 data-ipsquote-contentid=\u0022140194\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221464106587\u0022 data-ipsquote-userid=\u002297386\u0022 data-ipsquote-username=\u0022Padishar\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n19 minutes ago, Padishar said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nI think you\u0027ve made a mistake with your units here:\n\u003C/p\u003E\n\u003Cp\u003E\n...so your results\u00A0are 1000 times too small and the units should be m/s\u00B2.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nYup, you\u0027re right. I was in the mindset of KSP where everything is listed as kilonewtons and tonnes. \u003Cimg alt=\u0022:P\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif\u0022 title=\u0022:P\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nI meant m/s as in that\u0027s how much the velocity was increased in that frame. It doesn\u0027t make much sense to use m/s\u003Csup\u003E2\u003C/sup\u003E\u00A0when we\u0027re dealing with instantaneous\u00A0impulses. Impulses last one frame, and frames are of variable length, although\u00A0meters per frame squared\u00A0might work.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-05-24T16:36:08Z\u0022 title=\u002205/24/2016 04:36  PM\u0022 data-short=\u00228 yr\u0022\u003EMay 24, 2016\u003C/time\u003E by MrHappyFace\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Ser","CreatedById":104207,"CreatedDateTime":"2016-05-24T16:47:30Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222599053\u0022 data-ipsquote-contentid=\u0022140194\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221464107703\u0022 data-ipsquote-userid=\u002276365\u0022 data-ipsquote-username=\u0022MrHappyFace\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n4 minutes ago, MrHappyFace said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nWhy not do this:\n\u003C/p\u003E\n\u003Cp\u003E\nThe function getGeeForceAtPosition is the standard way to calculate gravity, used by stock code and\u00A0all the mods I\u0027ve seen, and it\u0027s probably more optimized\u00A0than yours is. Math.Pow function calls are relatively expensive too.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nI\u0027ll try that of course, thanks for pointing me out the getGeeForceAtPosition. But doesn\u0027t your code do exactly the same job? I don\u0027t see anything that could solve the bouncing vessels mystery. I\u0027ve logged and visualized the forces every time they were applied and saw no significant difference in directions and magnitudes that could give any clues to understand that weird behavior.\n\u003C/p\u003E\n"},{"CreatedByName":"MrHappyFace","CreatedById":76365,"CreatedDateTime":"2016-05-24T17:01:08Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222599066\u0022 data-ipsquote-contentid=\u0022140194\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221464108450\u0022 data-ipsquote-userid=\u0022104207\u0022 data-ipsquote-username=\u0022Ser\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n9 minutes ago, Ser said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nI\u0027ll try that of course, thanks for pointing me out the getGeeForceAtPosition. But doesn\u0027t your code do exactly the same job? I don\u0027t see anything that could solve the bouncing vessels mystery. I\u0027ve logged and visualized the forces every time they were applied and saw no significant difference in directions and magnitudes that could give any clues to understand that weird behavior.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nI have no idea what could be causing the bouncing. Maybe it\u0027s got something to do with some parts still falling\u00A0while others have already settled on the surface. Does this happen with 1-part (non-EVA) vessels?\n\u003C/p\u003E\n"},{"CreatedByName":"Padishar","CreatedById":97386,"CreatedDateTime":"2016-05-24T17:07:38Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222599053\u0022 data-ipsquote-contentid=\u0022140194\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221464107703\u0022 data-ipsquote-userid=\u002276365\u0022 data-ipsquote-username=\u0022MrHappyFace\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n4 minutes ago, MrHappyFace said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nIt doesn\u0027t make much sense to use m/s\u003Csup\u003E2\u003C/sup\u003E\u00A0when we\u0027re dealing with instantaneous\u00A0impulses. Impulses last one frame, and frames are of variable length, although\u00A0meters per frame squared\u00A0might work.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nYeah, I was being a bit picky with that part, the 1000x was the main point of my post.\n\u003C/p\u003E\n\u003Cp\u003E\nA bit more pickiness, \u0022frames\u0022 (FixedUpdate) are actually a fixed length of 20ms (except in physics warp). \u00A0Impulse is the integration of the force with respect to time, which, assuming a constant force over the period of a frame, is simply the force multiplied by the time. \u00A0The units of this are Ns or kgm/s (as impulse is equivalent to momentum). \u00A0I\u0027d need to read the Unity docs to be certain (well, as certain as I could be)\u00A0of how the value passed to AddForce is treated for the different force types but I think I would correct what you wrote above to say:\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222597374\u0022 data-ipsquote-contentid=\u0022140194\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221464020517\u0022 data-ipsquote-userid=\u002276365\u0022 data-ipsquote-username=\u0022MrHappyFace\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nOn 5/23/2016 at 5:21 PM, MrHappyFace said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nForce - A regular force. Applying a force of 1kN for 1 second on a 1kg object speeds it up \u003Cstrong\u003Eby\u003C/strong\u003E\u00A01m/s.\n\u003C/p\u003E\n\u003Cp\u003E\nAcceleration - An acceleration. Applying an\u00A0acceleration of \u003Cstrong\u003E1m/s\u003Csup\u003E2\u003C/sup\u003E\u003C/strong\u003E for 1 second speeds the object up \u003Cstrong\u003Eby\u003C/strong\u003E\u00A01m/s regardless of mass.\n\u003C/p\u003E\n\u003Cp\u003E\nImpulse - An impulse force. Applying an impulse of \u003Cstrong\u003E1kNs\u003C/strong\u003E for 1 frame on a 1kg object speeds it\u00A0up \u003Cstrong\u003Eby\u003C/strong\u003E\u00A01m/s.\n\u003C/p\u003E\n\u003Cp\u003E\nVelocityChange - A change in velocity. Applying a velocity change of \u003Cstrong\u003E1m/s\u003C/strong\u003E\u00A0for 1 frame speeds the object up \u003Cstrong\u003Eby\u003C/strong\u003E\u00A01m/s regardless of mass.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222599066\u0022 data-ipsquote-contentid=\u0022140194\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221464108450\u0022 data-ipsquote-userid=\u0022104207\u0022 data-ipsquote-username=\u0022Ser\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n17 minutes ago, Ser said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nI don\u0027t see anything that could solve the bouncing vessels mystery. I\u0027ve logged and visualized the forces every time they were applied and saw no significant difference in directions and magnitudes that could give any clues to understand that weird behavior.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nIt does sound very strange. \u00A0Do your vessels have landing legs or wheels? \u00A0Given their somewhat unstable behaviour in 1.1.2 I would avoid using them in your tests to rule out any possibility of an odd interaction...\n\u003C/p\u003E\n"},{"CreatedByName":"Ser","CreatedById":104207,"CreatedDateTime":"2016-05-24T17:20:55Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222599084\u0022 data-ipsquote-contentid=\u0022140194\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221464109268\u0022 data-ipsquote-userid=\u002276365\u0022 data-ipsquote-username=\u0022MrHappyFace\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n13 minutes ago, MrHappyFace said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nI have no idea what could be causing the bouncing. Maybe it\u0027s got something to do with some parts still falling\u00A0while others have already settled on the surface. Does this happen with 1-part (non-EVA) vessels?\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nI haven\u0027t try that.I\u0027ll try and see what happens.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222599092\u0022 data-ipsquote-contentid=\u0022140194\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221464109658\u0022 data-ipsquote-userid=\u002297386\u0022 data-ipsquote-username=\u0022Padishar\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n7 minutes ago, Padishar said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nIt does sound very strange. \u00A0Do your vessels have landing legs or wheels? \u00A0Given their somewhat unstable behaviour in 1.1.2 I would avoid using them in your tests to rule out any possibility of an odd interaction...\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nExactly. They have wheels. But when they fall down they touch the ground by different parts. I\u0027ll try to exclude wheels.\n\u003C/p\u003E\n"}]}