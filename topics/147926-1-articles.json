{"TopicId":147926,"ForumId":20,"TopicTitle":"Mod to identify slow mods?","CreatedByName":"Fwiffo","CreatedById":148084,"CreatedDateTime":"2016-09-17T07:01:11Z","PageNum":1,"Articles":[{"CreatedByName":"Fwiffo","CreatedById":148084,"CreatedDateTime":"2016-09-17T07:01:11Z","Content":"\n\u003Cp\u003E\nHas anyone taken a shot at a \u0022profiling\u0022 mod for KSP to help track down slow or even buggy mods? \u00A0I\u0027m thinking\u00A0one might measure total time spent in functions owned by each mod (particularly during scene changes), and even intercept exceptions out of them to roughly track each mod\u0027s peak error rate. \u00A0I know this is a fairly advanced topic, but\u00A0considering some of the crazy stuff other mods here have achieved (e.g. AssemblyReloader) I\u0027m wondering if it\u0027s feasible and/or if anyone\u0027s tried. \u00A0And I\u0027m thinking there must be some profiling scaffolding built into mono (to avoid having to go and manually hook each function).\n\u003C/p\u003E\n\u003Cp\u003E\nAlso what existing tools do you use to track this stuff down? \u00A0(e.g. Are there mono tools that would help?)\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-09-17T07:12:04Z\u0022 title=\u002209/17/2016 07:12  AM\u0022 data-short=\u00227 yr\u0022\u003ESeptember 17, 2016\u003C/time\u003E by Fwiffo\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2016-09-17T08:12:30Z","Content":"\n\u003Cp\u003E\nWhen 5.2 came out, we finally got access to Unity\u0027s profiler. If you\u0027ve followed the plugin debugging guide (at least insofar as creating the PlayerConnectionConfigFile and using a dev version of the player) then you\u0027re already set up, just start up Unity, open the profiler window, make sure it\u0027s connected to the right thing and it\u0027ll work. This is very handy for both locating GC problems as well as performance bottlenecks. My only addition to that process is a little tool that inserts Profiler.BeginSample/EndSample into every method on a target assembly to find GC issues more easily.\n\u003C/p\u003E\n\u003Cp\u003E\nWith 5.4, there\u0027s an actual memory profiler \u002B API available. I\u0027ve been working on getting it to work but no luck so far\n\u003C/p\u003E\n\u003Cp\u003E\nThere\u0027s also a low-level API available in mono. I tried to make this work but all the timing and GC-watching code would have to exist in a native plugin, and with 5.2 being right around the corner at the time I ultimately abandoned that project\n\u003C/p\u003E\n"},{"CreatedByName":"Fwiffo","CreatedById":148084,"CreatedDateTime":"2016-09-17T08:16:14Z","Content":"\n\u003Cp\u003E\nCool! \u00A0It\u0027s great to know the tooling and infrastructure are there. \u00A0It would be phenomenal for someone to release a mod that wraps all this up in a shiny, easy-to-use interface (or even plaintext log file) that makes it really easy to pinpoint slow or\u00A0misbehaving mods at a glance (\u0022ModStats...\u0022).\n\u003C/p\u003E\n\u003Cp\u003E\nGoing \u003Cem\u003Etotally\u003C/em\u003E pie-in-the-sky, one could even normalize and crowdsource that data to create a global mod performance ranking list (thus gaming the system and subtly incentivizing\u00A0developers to compete for high performance and stability rankings - or more realistically, helping them detect trends in their mods\u0027\u00A0performance and stability over time as codechanges are made).\u00A0 Yeah, I know... way easier said than done :-).\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cs\u003EThis is above my head but I wonder if \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/139128-113-memgraph-10010-with-stutter-reduction/\u0026amp;page=1\u0022 rel=\u0022\u0022\u003EMemGraph\u003C/a\u003E already has some of the GC-watching code you mentioned.\u003C/s\u003E\u00A0 Er, on second thought nevermind that last bit, I\u00A0just noticed you said \u003Cem\u003Enative\u003C/em\u003E\u00A0plugin.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-09-17T08:25:14Z\u0022 title=\u002209/17/2016 08:25  AM\u0022 data-short=\u00227 yr\u0022\u003ESeptember 17, 2016\u003C/time\u003E by Fwiffo\u003C/strong\u003E\n\u003C/span\u003E\n"}]}