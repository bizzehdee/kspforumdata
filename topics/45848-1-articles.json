{"TopicId":45848,"ForumId":69,"TopicTitle":"How to enable shadows on Linux for Intel Ivy Bridge graphics","CreatedByName":"GeneCash","CreatedById":81605,"CreatedDateTime":"2013-09-13T20:14:17Z","PageNum":1,"Articles":[{"CreatedByName":"GeneCash","CreatedById":81605,"CreatedDateTime":"2013-09-13T20:14:17Z","Content":"\n\u003Cp\u003ESo I noticed that some of the YouTube videos had shadows! And I don\u0027t! That\u0027s not right. This is a big issue for trying to land as it makes it really difficult to judge height. It also makes EVAs harder, at least for me.\u003C/p\u003E\u003Cp\u003ENow this is for people running Linux on Ivy Bridge, so I hope I can help both you guys out there.\u003C/p\u003E\u003Cp\u003EDISCLAIMER:\u003C/p\u003E\u003Cp\u003EI\u0027m running 64-bit Debian Testing (Jessie) on a Core i7 CPU. This may help other folks that don\u0027t have the exact same setup, like people using 32-bit or Ubuntu, etc. but I can\u0027t make any guarantees. If it breaks, you get to keep both pieces. It\u0027s only changing 1 byte, but hand-editing an executable is life on the edge. This is a nasty hack and I\u0027m a bit surprised that such a simple fix worked. Your mileage may vary. Stunts performed by professional driver on closed course.\u003C/p\u003E\u003Cp\u003ETHE ISSUE:\u003C/p\u003E\u003Cp\u003EI\u0027m assuming you can run KSP fine, you just don\u0027t get shadows. The problem is the Intel graphics hardware is blacklisted by Unity3D, so in your Player.log file you end up seeing this line:\u003C/p\u003E\u003Cp\u003EGL: disabling shadows on Intel 9xx (buggy)\u003C/p\u003E\u003Cp\u003EAs far as I can tell, you can\u0027t make Mesa/OpenGL lie about the graphics cards, so what I do is edit the KSP.x86_64 binary to no longer match the \u0022Intel\u0022 name.\u003C/p\u003E\u003Cp\u003EI tried the \u0022hexedit\u0022 mode in emacs, and that corrupted the file, so I used a program called \u0022wxHexEditor\u0022, from the wxhexeditor package (do \u0022apt-get install wxhexeditor\u0022)\u003C/p\u003E\u003Cp\u003ETHE FIX:\u003C/p\u003E\u003Cp\u003EGo to where ever you have KSP installed and copy your binary to a backup:\u003C/p\u003E\u003Cp\u003E~/KSP_linux # cp KSP.x86_64 KSP.x86_64.old\u003C/p\u003E\u003Cp\u003EEdit your binary:\u003C/p\u003E\u003Cp\u003E~/KSP_linux # wxHexEditor KSP.x86_64 \u0026amp;\u003C/p\u003E\u003Cp\u003EClick the spyglass search icon, and click the \u0022search as text\u0022 setting, then type \u0022intel\u0022 as the search string. You should hit an area mentioning graphics card brand names like Nvidia, Radeon, ATI, and Intel.\u003C/p\u003E\u003Cp\u003EThere should be an \u0022Intel\u0022 string. Ignore the one in all uppercase. Click the right hand part of the screen and change this to \u0022Intxl\u0022 or something else that won\u0027t match.\u003C/p\u003E\u003Cp\u003E0e8e180: 61be 993f 3baa b83f 2f73 7973 2f64 6576 a..?;..?/sys/dev\u003C/p\u003E\u003Cp\u003E0e8e190: 6963 6573 2f00 7063 6900 2573 2f25 7300 ices/.pci.%s/%s.\u003C/p\u003E\u003Cp\u003E0e8e1a0: 2f63 6c61 7373 0030 7830 3300 2f64 6576 /class.0x03./dev\u003C/p\u003E\u003Cp\u003E0e8e1b0: 6963 6500 2f76 656e 646f 7200 2f72 6573 ice./vendor./res\u003C/p\u003E\u003Cp\u003E0e8e1c0: 6f75 7263 6500 5369 5300 436f 6d70 6174 ource.SiS.Compat\u003C/p\u003E\u003Cp\u003E0e8e1d0: 6962 6c65 2056 4741 0036 3330 2f37 3330 ible VGA.630/730\u003C/p\u003E\u003Cp\u003E0e8e1e0: 004e 5649 4449 4100 4e76 6964 6961 0052 .NVIDIA.Nvidia.R\u003C/p\u003E\u003Cp\u003E0e8e1f0: 4144 454f 4e00 5261 6465 6f6e 0049 4e54 ADEON.Radeon.INT\u003C/p\u003E\u003Cp\u003E0e8e200: 454c 0049 6e74 656c 0025 692e 2569 2e25 EL.Intel.%i.%i.% \u0026lt;---- this one here\u003C/p\u003E\u003Cp\u003E0e8e210: 6920 4e56 4944 4941 2025 692e 2569 0025 i NVIDIA %i.%i.%\u003C/p\u003E\u003Cp\u003E0e8e220: 7320 5261 6465 6f6e 2048 4420 2569 2025 s Radeon HD %i %\u003C/p\u003E\u003Cp\u003E0e8e230: 2a00 4154 4920 5261 6465 6f6e 2037 3030 *.ATI Radeon 700\u003C/p\u003E\u003Cp\u003E0e8e240: 3020 4f70 656e 474c 2045 6e67 696e 6500 0 OpenGL Engine.\u003C/p\u003E\u003Cp\u003E0e8e250: 4154 4920 5261 6465 6f6e 2037 3530 3020 ATI Radeon 7500 \u003C/p\u003E\u003Cp\u003E0e8e260: 4f70 656e 474c 2045 6e67 696e 6500 5333 OpenGL Engine.S3\u003C/p\u003E\u003Cp\u003E0e8e270: 2000 474c 5f45 5854 5f74 6578 7475 7265 .GL_EXT_texture\u003C/p\u003E\u003Cp\u003EClick the save icon, exit wxHexEditor, and you should be done.\u003C/p\u003E\u003Cp\u003ETESTING:\u003C/p\u003E\u003Cp\u003ENow in the loading screen where Jeb is standing on the Mun, you should see an immediate difference. There should be a long shadow behind Jeb and a shadow behind the rock on the left side of the screen. If you go to the launch pad and load up a rocket, it should cast a shadow. In the loading screen with the 3 Kerbals on EVA, you should now see shadows inside the helmets.\u003C/p\u003E\u003Cp\u003EIf you get \u0022segmentation fault\u0022 then you corrupted your binary. Restore it from the copy and try again. You can check the binaries to see if your hex-editor did something bad:\u003C/p\u003E\u003Cp\u003E~/KSP_linux # xxd KSP.x86_64. \u0026gt;KSP.x86_64.dump\u003C/p\u003E\u003Cp\u003E~/KSP_linux # xxd KSP.x86_64.old \u0026gt;KSP.x86_64.old.dump\u003C/p\u003E\u003Cp\u003E~/KSP_linux # diff *.dump\u003C/p\u003E\u003Cp\u003E953889c953889\u003C/p\u003E\u003Cp\u003E\u0026lt; 0e8e200: 454c 0049 6e74 786c 0025 692e 2569 2e25 EL.Intxl.%i.%i.%\u003C/p\u003E\u003Cp\u003E---\u003C/p\u003E\u003Cp\u003E\u0026gt; 0e8e200: 454c 0049 6e74 656c 0025 692e 2569 2e25 EL.Intel.%i.%i.%\u003C/p\u003E\u003Cp\u003EIf you get any other output, then yeah, it did...\u003C/p\u003E\u003Cp\u003EOTHER ISSUES:\u003C/p\u003E\u003Cp\u003EI started off without rocks, trees, and other terrain features. To enable these, go to the graphics settings and set \u0022Fallback part shaders\u0022 to false, and enable \u0022SM3 Terrain Shaders\u0022 and \u0022Terrain Scatters (WIP)\u0022 - this is probably already known, but I went for a while without knowing it myself.\u003C/p\u003E\n"},{"CreatedByName":"gerner","CreatedById":80041,"CreatedDateTime":"2014-01-25T22:42:54Z","Content":"\n\u003Cp\u003EFYI, I just gave this a try and it seems to work!\u003C/p\u003E\u003Cp\u003EMore specifically, my steps were:\u003C/p\u003E\u003Cp\u003E0) make a backup!\u003C/p\u003E\u003Cp\u003E$ cp KSP.x86_64 KSP.x86_64.bak\u003C/p\u003E\u003Cp\u003E1) figure out the byte offset where the particular Intel string shows up:\u003C/p\u003E\u003Cp\u003E$ cat KSP.x86_64 | xxd | grep \u0022Intel\u0022\u003C/p\u003E\u003Cp\u003E0f01f00: 454c 0049 6e66 6f6f 0025 692e 2569 2e25 EL.Intel.%i.%i.%\u003C/p\u003E\u003Cp\u003E0f024f0: 2049 6e74 656c 2039 7878 2028 6275 6767 Intel 9xx (bugg\u003C/p\u003E\u003Cp\u003EThat first line is the one you want (as GeneCash points out), figure out what that is:\u003C/p\u003E\u003Cp\u003E$ printf \u0022%d\u0022 0x0f01f00\u003C/p\u003E\u003Cp\u003E15736576\u003C/p\u003E\u003Cp\u003Ethen add a few bytes to get exactly into that \u0022Intel\u0022 string, in this case about 5 bytes should do it\u003C/p\u003E\u003Cp\u003E2) replace those bytes (thanks to StackOverflow: \u003Ca href=\u0022http://stackoverflow.com/questions/4783657/cli-write-byte-at-address-hexedit-modify-binary-from-the-command-line\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://stackoverflow.com/questions/4783657/cli-write-byte-at-address-hexedit-modify-binary-from-the-command-line\u003C/a\u003E)\u003C/p\u003E\u003Cp\u003Eprintf \u0027foo\u0027 | dd of=KSP.x86_64 bs=1 seek=15736581 count=3 conv=notrunc\u003C/p\u003E\u003Cp\u003E3) profit! as GeneCash points out, you should see a shadow behind the kerbal on the Mun at startup.\u003C/p\u003E\n"},{"CreatedByName":"koen.db","CreatedById":109974,"CreatedDateTime":"2014-04-30T14:52:19Z","Content":"\n\u003Cp\u003EThis is an ugly hack, but it works! \u003C/p\u003E\u003Cp\u003EHaven\u0027t found any \u0027buggy\u0027 behaviour on the shadows though.\u003C/p\u003E\n"},{"CreatedByName":"GeneCash","CreatedById":81605,"CreatedDateTime":"2014-05-01T06:01:22Z","Content":"\n\u003Cp\u003EHorribly HORRIBLY ugly indeed! \u003C/p\u003E\u003Cp\u003EI\u0027ve since discovered a less ugly hack is to install an nVidia GTX 750Ti card... \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E No more yellow MET numbers.\u003C/p\u003E\n"},{"CreatedByName":"Eleven","CreatedById":60502,"CreatedDateTime":"2014-05-08T01:23:54Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022gerner\u0022 data-cite=\u0022gerner\u0022\u003E\u003Cdiv\u003EFYI, I just gave this a try and it seems to work!\u003Cp\u003EMore specifically, my steps were:\u003C/p\u003E\u003Cp\u003E0) make a backup!\u003C/p\u003E\u003Cp\u003E$ cp KSP.x86_64 KSP.x86_64.bak\u003C/p\u003E\u003Cp\u003E1) figure out the byte offset where the particular Intel string shows up:\u003C/p\u003E\u003Cp\u003E$ cat KSP.x86_64 | xxd | grep \u0022Intel\u0022\u003C/p\u003E\u003Cp\u003E0f01f00: 454c 0049 6e66 6f6f 0025 692e 2569 2e25 EL.Intel.%i.%i.%\u003C/p\u003E\u003Cp\u003E0f024f0: 2049 6e74 656c 2039 7878 2028 6275 6767 Intel 9xx (bugg\u003C/p\u003E\u003Cp\u003EThat first line is the one you want (as GeneCash points out), figure out what that is:\u003C/p\u003E\u003Cp\u003E$ printf \u0022%d\u0022 0x0f01f00\u003C/p\u003E\u003Cp\u003E15736576\u003C/p\u003E\u003Cp\u003Ethen add a few bytes to get exactly into that \u0022Intel\u0022 string, in this case about 5 bytes should do it\u003C/p\u003E\u003Cp\u003E2) replace those bytes (thanks to StackOverflow: \u003Ca href=\u0022http://stackoverflow.com/questions/4783657/cli-write-byte-at-address-hexedit-modify-binary-from-the-command-line\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://stackoverflow.com/questions/4783657/cli-write-byte-at-address-hexedit-modify-binary-from-the-command-line\u003C/a\u003E)\u003C/p\u003E\u003Cp\u003Eprintf \u0027foo\u0027 | dd of=KSP.x86_64 bs=1 seek=15736581 count=3 conv=notrunc\u003C/p\u003E\u003Cp\u003E3) profit! as GeneCash points out, you should see a shadow behind the kerbal on the Mun at startup.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI just downloaded a fresh copy of 0.23.5 and trying this now does not result in the same output. Just making a change of 5 bytes does not work with this different output. Any help?\u003C/p\u003E\n"},{"CreatedByName":"gerner","CreatedById":80041,"CreatedDateTime":"2014-07-27T15:44:29Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Eleven\u0022 data-cite=\u0022Eleven\u0022\u003E\u003Cdiv\u003EI just downloaded a fresh copy of 0.23.5 and trying this now does not result in the same output. Just making a change of 5 bytes does not work with this different output. Any help?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EStrange. I just downloaded 0.24.2 did the steps above and it worked. The byte offset is different, but the steps above (with the xxd and the grep for Intel) gave me the right spot. You need to change the instance of Intel that looks like \u0022EL.Intel.\u0022 above.\u003C/p\u003E\n"},{"CreatedByName":"sal_vager","CreatedById":16426,"CreatedDateTime":"2014-07-27T15:49:40Z","Content":"\n\u003Cp\u003EDifferent offsets is not surprising, as not only has Unity changed since this was first posted, more lines of Squad code have also been added so the offsets have moved.\u003C/p\u003E\u003Cp\u003EWhat offsets did you use gerner?\u003C/p\u003E\n"}]}