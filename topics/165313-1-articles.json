{"TopicId":165313,"ForumId":36,"TopicTitle":"Random System Generator app - Textures/Configuration issuses","CreatedByName":"Bill2462","CreatedById":169547,"CreatedDateTime":"2017-09-08T21:03:49Z","PageNum":1,"Articles":[{"CreatedByName":"Bill2462","CreatedById":169547,"CreatedDateTime":"2017-09-08T21:03:49Z","Content":"\n\u003Cp\u003E\nHi!\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027m not quite sure if this is the right place to ask\u00A0this questions but anyway (:\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027m writing a\u00A0random planetary system generator for KSP. It is an app written in C\u002B\u002B and designed to randomly generate a whole solar system with all necessary configuration and textures. For importing everything into a game, it uses\u00A0Copernicus.\n\u003C/p\u003E\n\u003Cp\u003E\nThe whole idea is to make it as simple as writing configuration for a generator, \u00A0launching an\u00A0app\u00A0and copying results into\u00A0gameData.\n\u003C/p\u003E\n\u003Cp\u003E\nSo obviously I can\u0027t use any external editor to generate textures for the system.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nSo far I\u0027ve managed to generate random properties and terrain without major problems.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nBut I\u0027ve encountered two major issues with :\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n1. Normal map generation.\n\u003C/p\u003E\n\u003Cp\u003E\n2. Creating simple Copernicus configuration that just adds planets with all necessary properties and PQS mods.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nProblem with normalmap is quite weird :\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nMy generator uses LibNoise library to create random terrain and then lodePNG library to convert results (BMP file) into PNG.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nExample generator output :\n\u003C/p\u003E\n\u003Cp\u003E\nHeightmap :\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u0022CWTxnem.png\u0022 class=\u0022ipsImage\u0022 src=\u0022https://i.imgur.com/CWTxnem.png\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nColormap :\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u002212wMgP2.png\u0022 class=\u0022ipsImage\u0022 src=\u0022https://i.imgur.com/12wMgP2.png\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nNormalmap :\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u002284IHxSd.png\u0022 class=\u0022ipsImage\u0022 src=\u0022https://i.imgur.com/84IHxSd.png\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nUnfortunately, the map view is broken \u00A0(Planet looks like ideal sphere without any mesh) :\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u00226PMRFzp.png\u0022 class=\u0022ipsImage\u0022 src=\u0022https://i.imgur.com/6PMRFzp.png\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nAlso, something is not right with the planet shadow :\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u0022Z1aYC7G.png\u0022 class=\u0022ipsImage\u0022 src=\u0022https://i.imgur.com/Z1aYC7G.png\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nIt is probably caused by a wrong normal map.\n\u003C/p\u003E\n\u003Cp\u003E\nBut I have no idea how to fix that.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nThe second problem is connected with Copernicus configuration .\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nGenerated copernicus cfg looks like this:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode\u0022\u003E\n\uFEFF@Kopernicus:AFTER[KOPERNICUS]\n{\n Body\n {\n     name = Cyran\n\n     Template\n     {\n         name = Moho\n         removeAllPQSMods = true\n     }\n\n     Properties\n     {\n         description = This planet was randomly generated\n         radius = 370000\n         geeASL = 0.6\n         rotationPeriod = 525178.380846\n         rotates = true\n         tidallyLocked = true\n         initialRotation = 0\n         isHomeWorld = false\n         timewarpAltitudeLimits = 0 30000 30000 60000 300000 300000 400000 700000\n\n         ScienceValues\n         {\n             landedDataValue = 2.484671\n             splashedDataValue = 2.757956\n             flyingLowDataValue = 2.402657\n             flyingHighDataValue = 2.481151\n             inSpaceLowDataValue = 2.797260\n             inSpaceHighDataValue = 2.140740\n             recoveryValue = 2.842828\n             flyingAltitudeThreshold = 12000\n             spaceAltitudeThreshold = 2.289556\n         }\n     }\n\n     Orbit\n     {\n            referenceBody = Sun\n            color = 0.415686,0.352941,0.803922,1\n            inclination = 1.27\n            eccentricity = 0.0127567\n            semiMajorAxis = 409355191706\n            longitudeOfAscendingNode = 259\n            argumentOfPeriapsis = 0\n            meanAnomalyAtEpoch = 2.27167344093323\n            epoch = 99.6799999999973\n     }\n\n     ScaledVersion\n     {\n         Material\n         {\n             texture = randomSystem/Cyran/Cyran_color.png\n             normals = randomSystem/Cyran/Cyran_normal.png\n         }\n     }\n     PQS\n     {\n         Mods\n         {\n             VertexHeightMap\n             {\n                 map = randomSystem/Cyran/Cyran_height.png\n                 offset = 0\n                 deformity = 12000\n                 scaleDeformityByRadius = false\n                 order = 20\n                 enabled = true\n             }\n             VertexColorMap\n             {\n                 map = randomSystem/Cyran/Cyran_color.png\n                 order = 20\n                 enabled = true\n             }\n         }\n     }\n }\n}\u003C/pre\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nConfiguration structure is defined in generator source code. Only parameters are changing (they are randomly generated).\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nProblem is that heightmap looks quite nice but resulting terrain does not.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nIt is surprisingly boring and flat.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nMy question is: What kind of Copernicus configuration structure I should use to get nice terrain out of heightmap?\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cspan style=\u0022font-size:11px;\u0022\u003EPlease excuse bad english (:\u00A0\u003C/span\u003E\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222017-09-08T21:26:30Z\u0022 title=\u002209/08/2017 09:26  PM\u0022 data-short=\u00226 yr\u0022\u003ESeptember 8, 2017\u003C/time\u003E by Bill2462\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Poodmund","CreatedById":128643,"CreatedDateTime":"2017-09-08T21:55:02Z","Content":"\n\u003Cp\u003E\nUnity handles normals a bit funky, this thread has some great info though:\u00A0\n\u003C/p\u003E\n\u003Ciframe allowfullscreen=\u0022\u0022 data-controller=\u0022core.front.core.autosizeiframe\u0022 data-embedcontent=\u0022\u0022 data-embedid=\u0022embed2950957887\u0022 scrolling=\u0022no\u0022 src=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/89163-how-are-squad-generating-their-normal-maps/\u0026amp;do=embed\u0022\u003E\u003C/iframe\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"Bill2462","CreatedById":169547,"CreatedDateTime":"2017-09-09T09:09:41Z","Content":"\n\u003Cp\u003E\nThank you for your help (:\n\u003C/p\u003E\n\u003Cp\u003E\nI found some more information about it in :\u00A0\u00A0\u003Ca href=\u0022https://github.com/ducakar/TextureReplacer\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/ducakar/TextureReplacer\u003C/a\u003E\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nQuote\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Ch3 style=\u0022color:#24292e;font-size:1.25em;\u0022\u003E\nNormal Maps\n\u003C/h3\u003E\n\u003Cp style=\u0022color:#24292e;font-size:16px;\u0022\u003E\nUnity uses \u0022grey\u0022 normal maps (RGBA = YYYX) to minimise artefacts when applying DXT5 texture compression on them. When a normal map has a \u0022NRM\u0022 suffix Unity converts it from RGB = XYZ (\u0022blue\u0022) to RGBA = YYYX (\u0022grey\u0022) normal map unless it is in DDS format.\n\u003C/p\u003E\n\u003Cp style=\u0022color:#24292e;font-size:16px;\u0022\u003E\nIn short: you should supply \u0022blue\u0022 normal maps when a texture has \u0022NRM\u0022 suffix and is in PNG format (JPEGs and TGAs are not recommended for normal maps) and \u0022grey\u0022 normal map for textures in DDS format or without \u0022NRM\u0022 suffix.\n\u003C/p\u003E\n\u003Cp style=\u0022color:#24292e;font-size:16px;\u0022\u003E\n\u0022Grey\u0022 normal maps can be created by saving the standard \u0022blue\u0022 normal map as a DDS with DXT5nm compression or by manually shuffling its channels RGBA -\u0026gt; GGGR.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nI will try to shuffle\u00A0RGBA -\u0026gt; GGGR in gimp and hopefully this\u00A0will work.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222017-09-09T09:12:09Z\u0022 title=\u002209/09/2017 09:12  AM\u0022 data-short=\u00226 yr\u0022\u003ESeptember 9, 2017\u003C/time\u003E by Bill2462\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Poodmund","CreatedById":128643,"CreatedDateTime":"2017-09-09T09:47:31Z","Content":"\n\u003Cp\u003E\nThe whole \u0022Grey\u0022 moniker doesn\u0027t really make sense though as you can have any information in the Red and Blue channels when using DXT5, typically\u00A0solid white or black, giving the normal map a very pink or very green look respectively. It will still function exactly the same. Saving an image as DXTnm does this automatically as it blanks the Red and Blue channels.\n\u003C/p\u003E\n\u003Cp\u003E\nIt should also be noted that KSP renders the ScaleSpace maps on the sphere from inside, like a 1st angle projection, which is why the planets look to be flipped horizontally in KSP to how they appear in your imaging program. Due to this, inverting the X Axis Tangent Space may be required.\n\u003C/p\u003E\n\u003Cp\u003E\nTheres a good couple of articles here:\u00A0\u003Ca href=\u0022http://wiki.polycount.com/wiki/Normal_Map_Compression\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://wiki.polycount.com/wiki/Normal_Map_Compression\u003C/a\u003E\u00A0\u0026amp;\u00A0\u003Ca href=\u0022http://wiki.polycount.com/wiki/ChannelPacking#Swizzle\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://wiki.polycount.com/wiki/ChannelPacking#Swizzle\u003C/a\u003E\n\u003C/p\u003E\n"},{"CreatedByName":"Bill2462","CreatedById":169547,"CreatedDateTime":"2017-09-09T11:18:03Z","Content":"\n\u003Cp\u003E\nProblem with normalmap solved!\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u0022HrQix6T.png\u0022 class=\u0022ipsImage\u0022 src=\u0022https://i.imgur.com/HrQix6T.png\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nSo far I did it in Gimp but adding this steps to generator source code shouldn\u0027t be too complicated.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nSimple instructions how to convert \u0027blue\u0027 normalmap to\u00A0normalmap that can be loaded into KSP :\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n1. Load\u00A0normalmap into gimp.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n2. Decompose image into Red Blue and Green layers (using Colours -\u0026gt;Components -\u0026gt;Decompose).\n\u003C/p\u003E\n\u003Cp\u003E\n3. Duplicate\u00A0Red layer.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n4. Rename\u00A0duplicated red layer to \u0027alpha\u0027.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n5. Delete\u00A0Red layer.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n6. Delete\u00A0Blue layer.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n7. Create\u00A0two duplicates of Green layer.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n8. Rename\u00A0them to \u0027red\u0027 and \u0027blue\u0027.\n\u003C/p\u003E\n\u003Cp\u003E\n9. Compose\u00A0 all layers into RGBA (using Colours -\u0026gt; Components -\u0026gt; Compose).\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n10. Export final image. 4\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nNo X axis inversion was needed. Look\u0027s like libnoise map exporter does this by default.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nBut I still can\u0027t solve issues\u00A0with copernicus configuration.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nPlanet terrain look\u0027s like this :\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u0022yVv7vvV.png\u0022 class=\u0022ipsImage\u0022 src=\u0022https://i.imgur.com/yVv7vvV.png\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nIt is almost flat, but according to heightmap it shouldn\u0027t.\n\u003C/p\u003E\n\u003Cp\u003E\nWhat I\u0027m doing wrong?\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222017-09-09T12:06:26Z\u0022 title=\u002209/09/2017 12:06  PM\u0022 data-short=\u00226 yr\u0022\u003ESeptember 9, 2017\u003C/time\u003E by Bill2462\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"danielboro","CreatedById":166078,"CreatedDateTime":"2017-09-09T21:12:03Z","Content":"\n\u003Cp\u003E\nperhaps you can find relevent code in this\n\u003C/p\u003E\n\u003Ciframe allowfullscreen=\u0022\u0022 data-controller=\u0022core.front.core.autosizeiframe\u0022 data-embedcontent=\u0022\u0022 data-embedid=\u0022embed1604689577\u0022 scrolling=\u0022no\u0022 src=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/151998-indev-13-to-boldly-go-an-external-application-designed-to-procedurally-generate-an-entire-galaxy-for-ksp/\u0026amp;\u0026amp;do=embed\u0022 style=\u0022height:214px;max-width:502px;\u0022\u003E\u003C/iframe\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"Bill2462","CreatedById":169547,"CreatedDateTime":"2017-09-10T10:41:21Z","Content":"\n\u003Cp\u003E\nI think I found a solution to Copernicus problem.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nInstead of hard coding Copernicus file structure into the code, I will write\u00A0a parser that reads a template file and replaces specified keywords with generated values.\u00A0\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nThis will allow users to easily modified Copernicus file structure without modifying the code.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nThis also means that I don\u0027t have to care about Copernicus configuration\u00A0 anymore.\u00A0\u00A0\u00A0\u003Cimg alt=\u0022:D\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 title=\u0022:D\u0022\u003E\u003Cbr\u003E\nI only need to provide some example templates.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nI think I will use the configuration from outer planets mod as an example.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n"}]}