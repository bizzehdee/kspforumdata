{"TopicId":109166,"ForumId":29,"TopicTitle":"Need help getting started","CreatedByName":"cvod","CreatedById":110540,"CreatedDateTime":"2015-05-14T09:00:32Z","PageNum":1,"Articles":[{"CreatedByName":"cvod","CreatedById":110540,"CreatedDateTime":"2015-05-14T09:00:32Z","Content":"\n\u003Cp\u003EI\u0027ve got Visual Studio set up and I\u0027ve looked through all the \u0022tutorials\u0022 and getting started material, but I still have can\u0027t figure out what should be a relatively simple task. I also looked through other people\u0027s source code, but given that I\u0027m completely new to C# I\u0027m not sure what I should be looking for. Could anyone post some example code of making a GUI window appear whenever at the space center or whenever at the RnD building?\u003C/p\u003E\n"},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2015-05-14T10:39:32Z","Content":"\n\u003Cp\u003ETo get something started in the space center, you\u0027re looking at a KSP Addon type plugin (rather than a Part Module). This means inheriting from Monobehaviour and having the class tagged with the KSPAddon attribute.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E[KSPAddon (KSPAddon.Startup.SpaceCentre, false)]\u003Cbr\u003Epublic class YourClass : MonoBehaviour\u003Cbr\u003E{}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EThis gives you a class for which the methods Awake, Start, Update, FixedUpdate (NOTE: not particularly useful outside the Flight scene), OnGUI and OnDestroy. There are (a lot) more, but those are the ones you will use the most.\u003C/p\u003E\u003Cp\u003ETo draw a window, you want OnGUI\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Epublic void OnGUI()\u003Cbr\u003E{\u003Cbr\u003E    GUI.Window(/*some number*/, new Rect(300,500,300,300), windowFunc, \u0022This is a window Title\u0022); // draws a 300x300 window 300 in and 500 down from the top left of the screen.\u003Cbr\u003E// You have a choice of GUI or GUILayout for most UI objects. GUI you specify the size explictly using a Rect for each object, GUILayout you have formatting functions to shape your layout. Both work, what you use is up to you.\u003Cbr\u003E}\u003Cbr\u003E\u003Cbr\u003Evoid windowFunc(int id)\u003Cbr\u003E{\u003Cbr\u003E    // the contents of your window go here.\u003Cbr\u003E    // NOTE: if using GUI functions, the (x,y) coordinates are relative to the top left of the window, not the screen (ie. (0,0) in this function is the top left corner of the window)\u003Cbr\u003E}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EThe R\u0026amp;D window is an overlay on the space center scene so if you want a window in both there is no special considerations (although you will have to block it for the other buildings that aren\u0027t the VAB/SPH if you don\u0027t want them showing up). To detect entry to these facilities, we add callbacks to functions for various \u0022OnEnter\u0022 and \u0022OnLeaving\u0022 events\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Epublic void Start()\u003Cbr\u003E{\u003Cbr\u003E    GameEvents.onGUIRnDComplexSpawn.Add(RnDEnteredFunc);\u003Cbr\u003E     GameEvents.onGUIRnDComplexDespawn.Add(RnDLeavingFunc);\u003Cbr\u003E}\u003Cbr\u003Epublic void OnDestroy() //You don\u0027t want to leave event subscriptions lying around\u003Cbr\u003E{\u003Cbr\u003E    GameEvents.onGUIRnDComplexSpawn.Remove(RnDEnteredFunc);\u003Cbr\u003E    GameEvents.onGUIRnDComplexDespawn.Remove(RnDLeavingFunc);\u003Cbr\u003E}\u003Cbr\u003E\u003Cbr\u003Evoid RnDEnteredFunc()\u003Cbr\u003E{}\u003Cbr\u003E\u003Cbr\u003Evoid RnDLeavingFunc()\u003Cbr\u003E{}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003Eset a boolean value in those callbacks and gate your OnGUI code behind that check if you only want to show in the RnD complex\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Ebool bRnDOverlayVisible = false;\u003Cbr\u003Evoid OnGUI()\u003Cbr\u003E{\u003Cbr\u003E    if (!bRnDOverlayVisible)\u003Cbr\u003E        return; // I prefer return statements for gating as it reduces the level of nesting but you can also wrap everything inside the if statement. Whatever works for you\u003Cbr\u003E}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-05-14T10:43:31Z\u0022 title=\u002205/14/2015 10:43  AM\u0022 data-short=\u00229 yr\u0022\u003EMay 14, 2015\u003C/time\u003E by Crzyrndm\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"cvod","CreatedById":110540,"CreatedDateTime":"2015-05-14T11:20:17Z","Content":"\n\u003Cp\u003EWow, thanks so much for the help!\u003C/p\u003E\n"},{"CreatedByName":"cvod","CreatedById":110540,"CreatedDateTime":"2015-05-15T01:12:32Z","Content":"\n\u003Cp\u003EHow would I make the window drag-able? I tried the following code, but it doesn\u0027t seem to do anything. Also one thing I don\u0027t understand about the code is why \u0022int id\u0022 is needed for the \u0022windowFunc\u0022 method. If I remove it, then Visual Studio shows an error with \u0022GUI.Window\u0022\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Enamespace Testing\u003Cbr\u003E{\u003Cbr\u003E    [KSPAddon(KSPAddon.Startup.SpaceCentre, false)]\u003Cbr\u003E\u003Cbr\u003E    public class Testing : MonoBehaviour\u003Cbr\u003E    {\u003Cbr\u003E        public void OnGUI()\u003Cbr\u003E        {\u003Cbr\u003E            GUI.Window(1, new Rect(10, 10, 300, 700), windowFunc, \u0022Title\u0022);\u003Cbr\u003E        }\u003Cbr\u003E\u003Cbr\u003E         void windowFunc(int id)\u003Cbr\u003E        {\u003Cbr\u003E            GUI.DragWindow();\u003Cbr\u003E        }\u003Cbr\u003E    }\u003Cbr\u003E}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n"},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2015-05-15T01:17:07Z","Content":"\n\u003Cp\u003ETo make it draggable, you need a persistent Rect instead of creating one each time.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Enamespace Testing\u003Cbr\u003E{\u003Cbr\u003E    [KSPAddon(KSPAddon.Startup.SpaceCentre, false)]\u003Cbr\u003E\u003Cbr\u003E    public class Testing : MonoBehaviour\u003Cbr\u003E    {\u003Cbr\u003E        Rect windowRect = new Rect(10,10,300,700);\u003Cbr\u003E        public void OnGUI()\u003Cbr\u003E        {\u003Cbr\u003E            windowRect = GUI.Window(1, windowRect, windowFunc, \u0022Title\u0022);\u003Cbr\u003E        }\u003Cbr\u003E\u003Cbr\u003E         void windowFunc(int id)\u003Cbr\u003E        {\u003Cbr\u003E            GUI.DragWindow();\u003Cbr\u003E        }\u003Cbr\u003E    }\u003Cbr\u003E}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EThe window id I don\u0027t understand too well myself, expect that two windows with the same id cannot both be drawn at the same time (you can draw one or the other, but not both). I just give them a large arbitrary random number\u003C/p\u003E\n"},{"CreatedByName":"cvod","CreatedById":110540,"CreatedDateTime":"2015-05-15T01:57:28Z","Content":"\n\u003Cp\u003ESweet, thanks for your help. Looks like I should have read up on classes and methods a bit more before jumping in.\u003C/p\u003E\n"},{"CreatedByName":"cvod","CreatedById":110540,"CreatedDateTime":"2015-05-16T06:34:40Z","Content":"\n\u003Cp\u003EI\u0027m asking a lot of questions so I\u0027ll just put them all in this thread instead of making new ones.\u003C/p\u003E\u003Cp\u003EI\u0027m trying to get information on the node that is currently clicked such as it\u0027s name and the parts assigned to it. I found the class \u0022RDNode\u0022 which has a \u0022OnNodeSelected()\u0022 method, but I can\u0027t figure out how to use it. Looking at the old Treeloader source, it makes use of the \u0022ConfigNode\u0022 class. I\u0027m not really sure how to use either or what I should be looking for to get the info of the clicked node.\u003C/p\u003E\n"},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2015-05-16T07:20:44Z","Content":"\n\u003Cp\u003EConfigNode is the class which KSP uses to read/write/store the majority of data in .cfg files (eg. PART { ... } is initially read into a ConfigNode)\u003C/p\u003E\u003Cp\u003EThis is probably the one you want\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003ERDController.Instance.node_selected\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n"},{"CreatedByName":"cvod","CreatedById":110540,"CreatedDateTime":"2015-05-18T04:41:52Z","Content":"\n\u003Cp\u003EWhat does the template parameter do for file IO commands? I\u0027m trying to check that a file exists, but I\u0027m not sure what to put for \u0022T\u0022. Also, does the directory for the file not need specified?\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003EKSP.IO.File.Exists\u0026lt;T\u0026gt;(\u0022filename\u0022)\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2015-05-18T09:25:14Z","Content":"\n\u003Cp\u003EIt\u0027s used by KSP to define the patch where you file is stored. Say you mod is in GameData/myMod/myMod.dll and it contains a class called MyModule. \u003C/p\u003E\u003Cp\u003EKSP.IO.File.Exists\u0026lt;MyModule\u0026gt;(\u0022filename\u0022) will check for a file relative to the position of the dll that contains MyModule. From memory it should be GameData/myMod/pluginData/myMod/filename.cfg\u003C/p\u003E\u003Cp\u003EThe path are quite long since it was designed when all the plugins lived in the same dir.\u003C/p\u003E\n"},{"CreatedByName":"cvod","CreatedById":110540,"CreatedDateTime":"2015-05-21T20:46:34Z","Content":"\n\u003Cp\u003EI\u0027m not sure if this is doing what I think it\u0027s doing. There\u0027s probably a better way to do this. I\u0027m trying to load the tech tree data using ConfigNode. Is this the correct way to do it?\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003EConfigNode allNodes = GameDatabase.Instance.GetConfigNode(\u0022RDNode\u0022);\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EIf it is, for some reason my plugin stops working when I try to get the RnD node position data.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Estring[] allNodePos = allNodes.GetValues(\u0022pos\u0022);\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EWhat am I doing wrong?\u003C/p\u003E\u003Cp\u003EAlso, does the GetConfigNode method get sub structures in the config files? So will it get the Parent structures within the RDNode structure?\u003C/p\u003E\n"},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2015-05-21T21:34:32Z","Content":"\n\u003Cp\u003EYou probably want something like\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Estring[] allNodePos = new string[allNodes.Length];\u003Cbr\u003Efor (int i = 0; i \u0026lt; allNodes.Length; i\u002B\u002B)\u003Cbr\u003E    allNodePos[i] = allNodes[i].GetValue(\u0022pos\u0022);\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003Eor even\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Estring[][] allNodePos = new string[allNodes.Length][];\u003Cbr\u003Efor (int i = 0; i \u0026lt; allNodes.Length; i\u002B\u002B)\u003Cbr\u003E    allNodePos[i] = allNodes[i].GetValue(\u0022pos\u0022).Split(\u0027,\u0027);\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003Ewhich will give you each of the pos numbers in individual cells (eg. allNodePos[0][0] is the first number in the first node)\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-05-21T21:38:11Z\u0022 title=\u002205/21/2015 09:38  PM\u0022 data-short=\u00229 yr\u0022\u003EMay 21, 2015\u003C/time\u003E by Crzyrndm\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"cvod","CreatedById":110540,"CreatedDateTime":"2015-05-22T01:13:08Z","Content":"\n\u003Cp\u003EI\u0027m still having trouble with this part\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E[COLOR=#333333]ConfigNode allNodes = GameDatabase.Instance.GetConfigNodes(\u0022RDNode\u0022);[/COLOR]\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EThis produces a list of length zero. And if I replace \u0022RDNode\u0022 with \u0022TechTree\u0022 it produces a list of length two. Neither are results I would have expected.\u003C/p\u003E\n"},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2015-05-22T01:29:05Z","Content":"\n\u003Cp\u003Eif the root node is techTree, that\u0027s the one you need to check GameDatabase for. You can then get the RDNodes using techTreeNode.GetNodes(\u0022RDNode\u0022).\u003C/p\u003E\u003Cp\u003EAs for why there is two, I don\u0027t know. print them both to the log and see what they look like (the node.toString method will show values just as they would appear in a .cfg)\u003C/p\u003E\n"}]}