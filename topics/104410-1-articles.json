{"TopicId":104410,"ForumId":29,"TopicTitle":"Tried to make a GUI text area and now there are no parts in the game","CreatedByName":"Greendolph","CreatedById":131208,"CreatedDateTime":"2015-04-19T00:45:47Z","PageNum":1,"Articles":[{"CreatedByName":"Greendolph","CreatedById":131208,"CreatedDateTime":"2015-04-19T00:45:47Z","Content":"\n\u003Cp\u003EI was following the tutorial \u003Ca href=\u0022https://youtu.be/_qruuunMpHA\u0022 rel=\u0022external nofollow\u0022\u003Ehere\u003C/a\u003E and decided I wanted to add a TextArea object and a Button. When I added them KSP could no longer find any of the parts in the game and the vessel I had been testing the PartModule part on failed to load because no parts existed anymore. What could possibly have caused that? I\u0027ve checked the KSP folder and everything still exists and no directory names have been changed...\u003C/p\u003E\n"},{"CreatedByName":"stupid_chris","CreatedById":62017,"CreatedDateTime":"2015-04-19T01:10:13Z","Content":"\n\u003Cp\u003ECan\u0027t help you without seeing the code.\u003C/p\u003E\n"},{"CreatedByName":"Greendolph","CreatedById":131208,"CreatedDateTime":"2015-04-19T01:20:17Z","Content":"\n\u003Cp\u003EIf you want a sea of text, here you go mate \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E In the future it may be more practical to start form the perspective of common causes of such errors in order to provide context that would allow me to share code specific to the issue.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Eusing UnityEngine;\u003Cbr\u003Eusing GuiWindowPlugin.Extentions;\u003Cbr\u003Eusing KSP.IO;\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003Enamespace GuiWindowPlugin\u003Cbr\u003E{\u003Cbr\u003E    public class GuiWindowPlugin : PartModule\u003Cbr\u003E    {\u003Cbr\u003E        private Rect _windowPosition = new Rect();\u003Cbr\u003E        private GUIStyle _windowStyle, _textAreaStyle, _buttonStyle;\u003Cbr\u003E        private bool _hasInitStyles = false;\u003Cbr\u003E        private int _drawCall = 0;\u003Cbr\u003E        private string _textAreaText = \u0022\u0022;\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E        public override void OnStart(StartState state)\u003Cbr\u003E        {\u003Cbr\u003E            if (state != StartState.Editor)\u003Cbr\u003E            {\u003Cbr\u003E                if (!_hasInitStyles)\u003Cbr\u003E                {\u003Cbr\u003E                    InitStyles();\u003Cbr\u003E                }\u003Cbr\u003E                RenderingManager.AddToPostDrawQueue(0, OnDraw);\u003Cbr\u003E            }\u003Cbr\u003E        }\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E        public override void OnSave(ConfigNode node)\u003Cbr\u003E        {\u003Cbr\u003E            PluginConfiguration config = PluginConfiguration.CreateForType\u0026lt;GuiWindowPlugin\u0026gt;();\u003Cbr\u003E            config.SetValue(\u0022Window Position\u0022, _windowPosition);\u003Cbr\u003E            config.SetValue(\u0022Draw Call\u0022, _drawCall);\u003Cbr\u003E            config.SetValue(\u0022Text Area Text\u0022, _textAreaText);\u003Cbr\u003E            config.save();\u003Cbr\u003E        }\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E        public override void OnLoad(ConfigNode node)\u003Cbr\u003E        {\u003Cbr\u003E            PluginConfiguration config = PluginConfiguration.CreateForType\u0026lt;GuiWindowPlugin\u0026gt;();\u003Cbr\u003E            config.load();\u003Cbr\u003E            _windowPosition = config.GetValue\u0026lt;Rect\u0026gt;(\u0022Window Position\u0022);\u003Cbr\u003E            _drawCall = config.GetValue\u0026lt;int\u0026gt;(\u0022Draw Call\u0022);\u003Cbr\u003E            _textAreaText = config.GetValue\u0026lt;string\u0026gt;(\u0022Text Area Text\u0022);\u003Cbr\u003E        }\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E        private void OnDraw()\u003Cbr\u003E        {\u003Cbr\u003E            _drawCall\u002B\u002B;\u003Cbr\u003E            if (this.vessel == FlightGlobals.ActiveVessel \u0026amp;\u0026amp; this.part.IsPrimary(this.vessel.parts, this.ClassID))\u003Cbr\u003E            {\u003Cbr\u003E                _windowPosition = GUILayout.Window(10, _windowPosition, OnWindow, \u0022Draw Call #\u0022 \u002B _drawCall.ToString(), _windowStyle);\u003Cbr\u003E                if (_windowPosition.x == 0f \u0026amp;\u0026amp; _windowPosition.y == 0f)\u003Cbr\u003E                {\u003Cbr\u003E                    _windowPosition = _windowPosition.CenterScreen();\u003Cbr\u003E                }\u003Cbr\u003E            }\u003Cbr\u003E        }\u003Cbr\u003E        private void OnWindow(int windowId)\u003Cbr\u003E        {\u003Cbr\u003E            GUILayout.BeginVertical();\u003Cbr\u003E            GUILayout.TextArea(_textAreaText, _textAreaStyle);\u003Cbr\u003E            GUILayout.Button(\u0022Run\u0022, _buttonStyle);\u003Cbr\u003E            GUILayout.EndVertical();\u003Cbr\u003E\u003Cbr\u003E            GUI.DragWindow();\u003Cbr\u003E        }\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E        private void InitStyles()\u003Cbr\u003E        {\u003Cbr\u003E            _windowStyle = new GUIStyle(HighLogic.Skin.window);\u003Cbr\u003E            _windowStyle.fixedWidth = 250f;\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E            _textAreaStyle = new GUIStyle(HighLogic.Skin.textArea);\u003Cbr\u003E            _textAreaStyle.stretchWidth = true;\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E            _buttonStyle = new GUIStyle(HighLogic.Skin.button);\u003Cbr\u003E            _buttonStyle.fixedWidth = 100f;\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E            _hasInitStyles = true;\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E        }\u003Cbr\u003E    }\u003Cbr\u003E}\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Eusing System.Collections.Generic;\u003Cbr\u003Eusing UnityEngine;\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003Enamespace GuiWindowPlugin.Extentions\u003Cbr\u003E{\u003Cbr\u003E    public static class PartExtentions\u003Cbr\u003E    {\u003Cbr\u003E        public static bool IsPrimary(this Part thisPart, List\u0026lt;Part\u0026gt; partsList, int moduleClassID)\u003Cbr\u003E        {\u003Cbr\u003E            foreach (Part part in partsList){\u003Cbr\u003E                if (part.Modules.Contains(moduleClassID))\u003Cbr\u003E                {\u003Cbr\u003E                    if (part == thisPart)\u003Cbr\u003E                    {\u003Cbr\u003E                        return true;\u003Cbr\u003E                    }\u003Cbr\u003E                    else\u003Cbr\u003E                    {\u003Cbr\u003E                        break;\u003Cbr\u003E                    }\u003Cbr\u003E                }\u003Cbr\u003E            }\u003Cbr\u003E            return false;\u003Cbr\u003E        }\u003Cbr\u003E    }\u003Cbr\u003E}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Eusing UnityEngine;\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003Enamespace GuiWindowPlugin.Extentions\u003Cbr\u003E{\u003Cbr\u003E    public static class RectExtentions\u003Cbr\u003E    {\u003Cbr\u003E        public static Rect CenterScreen(this Rect thisRect)\u003Cbr\u003E        {\u003Cbr\u003E            if (Screen.width \u0026gt; 0f \u0026amp;\u0026amp; Screen.height \u0026gt; 0f \u0026amp;\u0026amp; thisRect.width \u0026gt; 0f \u0026amp;\u0026amp; thisRect.height \u0026gt; 0f)\u003Cbr\u003E            {\u003Cbr\u003E                thisRect.x = (Screen.width / 2) - (thisRect.width / 2);\u003Cbr\u003E                thisRect.y = (Screen.height / 2) - (thisRect.height / 2);\u003Cbr\u003E            }\u003Cbr\u003E            return thisRect;\u003Cbr\u003E        }\u003Cbr\u003E    }\u003Cbr\u003E}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n"},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2015-04-19T02:02:45Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Greendolph\u0022 data-cite=\u0022Greendolph\u0022\u003E\u003Cdiv\u003EIf you want a sea of text, here you go mate \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E In the future it may be more practical to start form the perspective of common causes of such errors in order to provide context that would allow me to share code specific to the issue.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ESections of code are generally worthless unless you know what all the inputs/outputs are (and that they are valid). You also haven\u0027t mentioned any exceptions being logged that you could follow the stack trace for to narrow it down. My bet would be that it\u0027s throwing a lot of errors during the initial loading process, but it\u0027s impossible to tell without any information from the logs\u003C/p\u003E\u003Cp\u003EPS\u003C/p\u003E\u003Cp\u003EAn easier way to handle default window positions\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E_windowPosition = config.GetValue\u0026lt;Rect\u0026gt;(\u0022Window Position\u0022); // defaults to 0,0,0,0 if no value is found (current implementation)\u003Cbr\u003E_windowPosition = config.GetValue(\u0022Window Position\u0022, new Rect(10,10,0,0)); // defaults to 10,10,0,0 if no value can be found\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EEDIT\u003C/p\u003E\u003Cp\u003EYour problem is probably going to be OnStart. It could get called during the part compilation process and the != editor check wont catch that (HighLogic.LoadedSceneIsFlight is probably the check you want)\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-04-19T02:24:53Z\u0022 title=\u002204/19/2015 02:24  AM\u0022 data-short=\u00229 yr\u0022\u003EApril 19, 2015\u003C/time\u003E by Crzyrndm\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"stupid_chris","CreatedById":62017,"CreatedDateTime":"2015-04-19T02:12:03Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Greendolph\u0022 data-cite=\u0022Greendolph\u0022\u003E\u003Cdiv\u003EIf you want a sea of text, here you go mate \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E In the future it may be more practical to start form the perspective of common causes of such errors in order to provide context that would allow me to share code specific to the issue.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EIf you don\u0027t want help, don\u0027t ask for help. You procided no info except \u0022it doesn\u0027t work\u0022. Based on that, the only guess I could make is that something screws up during the loading process, and your code is a very good indiction to *what* might be screwing up. The two basic things to provide is logs and code.\u003C/p\u003E\u003Cp\u003ECrzyrndm has a good point. Other than that, I\u0027m not sure if OnStart runs in the Loading Sequence, but if it does I can guarantee it will fail, beause this.vessel will be null. You\u0027re also not nullchecking FlightGlobals.ActiveVessel, which can be null a few frames while the vessel is being loaded in flight. To figure out more, logs will be needed.\u003C/p\u003E\n"},{"CreatedByName":"Greendolph","CreatedById":131208,"CreatedDateTime":"2015-04-19T02:33:01Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Crzyrndm\u0022 data-cite=\u0022Crzyrndm\u0022\u003E\u003Cdiv\u003E\u003Cp\u003EYour problem is probably going to be OnStart. It could get called during the part compilation process and the != editor check wont catch that\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI changed it to \u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Eif (state == StartState.Flying)\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003Eand I have the same issue. \u003C/p\u003E\u003Cp\u003EI tried removing all references to the TextArea control on the _textAreaText string and nothing changed.\u003C/p\u003E\u003Cp\u003EIs there a way I can see debug output from the part compilation?\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022font-size:8px;\u0022\u003E\u003Cspan style=\u0022color:#C0C0C0;\u0022\u003E- - - Updated - - -\u003C/span\u003E\u003C/span\u003E\u003C/p\u003E\u003Cp\u003EI found this, not sure exactly how to interpret it. From KSP.txt\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E[EXC 19:29:32.749] XmlException: Document element did not appear. file:///C:/TestEnvironments/KSP/Kerbal Space Program/Plugins/PluginData/GuiWindowPlugin/config.xml Line 1, position 1.\tMono.Xml2.XmlTextReader.Read ()\u003Cbr\u003E\tSystem.Xml.XmlTextReader.Read ()\u003Cbr\u003E\tMono.Xml.EntityResolvingXmlReader.Read ()\u003Cbr\u003E\tMono.Xml.DTDValidatingReader.ReadContent ()\u003Cbr\u003E\tMono.Xml.DTDValidatingReader.Read ()\u003Cbr\u003E\tMono.Xml.Schema.XsdValidatingReader.Read ()\u003Cbr\u003E\tSystem.Xml.XmlValidatingReader.Read ()\u003Cbr\u003E\tSystem.Xml.XmlDocument.ReadNodeCore (System.Xml.XmlReader reader)\u003Cbr\u003E\tSystem.Xml.XmlDocument.ReadNode (System.Xml.XmlReader reader)\u003Cbr\u003E\tSystem.Xml.XmlDocument.Load (System.Xml.XmlReader xmlReader)\u003Cbr\u003E\tSystem.Xml.XmlDocument.Load (System.String filename)\u003Cbr\u003E\tKSP.IO.PluginConfiguration.load ()\u003Cbr\u003E\tGuiWindowPlugin.GuiWindowPlugin.OnLoad (.ConfigNode node)\u003Cbr\u003E\tPartModule.Load (.ConfigNode node)\u003Cbr\u003E\tPart.AddModule (.ConfigNode node)\u003Cbr\u003E\tPartLoader.ParsePart (.UrlConfig urlConfig, .ConfigNode node)\u003Cbr\u003E\tPartLoader\u002B.MoveNext ()\u003Cbr\u003E\tUnityEngine.MonoBehaviour:StartCoroutine(IEnumerator)\u003Cbr\u003E\t:MoveNext()\u003Cbr\u003E\tUnityEngine.MonoBehaviour:StartCoroutine(IEnumerator)\u003Cbr\u003E\tPartLoader:StartLoad()\u003Cbr\u003E\t:MoveNext()\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n"},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2015-04-19T02:35:21Z","Content":"\n\u003Cp\u003E\u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/92230-!!!-PLEASE-READ-BEFORE-POSTING-!!!-Stock-Support-Bug-Reporting-Guide\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://forum.kerbalspaceprogram.com/threads/92230-!!!-PLEASE-READ-BEFORE-POSTING-!!!-Stock-Support-Bug-Reporting-Guide\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EScroll down to the bit about output logs. Search that file for exception and you\u0027ll find what you need\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022font-size:8px;\u0022\u003E\u003Cspan style=\u0022color:#C0C0C0;\u0022\u003E- - - Updated - - -\u003C/span\u003E\u003C/span\u003E\u003C/p\u003E\u003Cp\u003EIt\u0027s onload that\u0027s running\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003EGuiWindowPlugin.GuiWindowPlugin.OnLoad (.ConfigNode node)\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003ESomething wrong with the config read\u003C/p\u003E\n"},{"CreatedByName":"Greendolph","CreatedById":131208,"CreatedDateTime":"2015-04-19T20:05:42Z","Content":"\n\u003Cp\u003EWhen I comment out the save/load methods everything works again. Is there a way I can check the config node for validity when I load it?\u003C/p\u003E\n"},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2015-04-19T21:20:08Z","Content":"\n\u003Cp\u003EThe config node that\u0027s passed to OnLoad isn\u0027t invalid (or atleast, it has nothing to do with the error). It errors when you call:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003EKSP.IO.PluginConfiguration.load ()\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003Ewhich is the second line of OnLoad (config.load(); )\u003C/p\u003E\u003Cp\u003EThere\u0027s nothing out of the ordinary with your method, so that leaves either a corrupt file (delete this file: C:/TestEnvironments/KSP/Kerbal Space Program/Plugins/PluginData/GuiWindowPlugin/config.xml and see if things get resolved), or maybe a permission error.\u003C/p\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2015-04-19T22:34:12Z","Content":"\n\u003Cp\u003ENote that one issue with a ConfigNode file is that it can\u0027t be empty.\u003C/p\u003E\u003Cp\u003EIf you have a \u0022no data\u0022 ConfigNode.cfg file with nothing in it, KSP does not initialize the node correctly.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003EConfigNode myNode = ConfigNode.Load(fileOnDisk.cfg);\u003C/pre\u003E\u003Cp\u003E will result in a myNode that is null if fileOnDisk.cfg is empty, or a valid config node if fileOnDisk.cfg has data.\u003C/p\u003E\u003Cp\u003ENote that KSP will happily \u003Cem\u003Esave\u003C/em\u003E an empty confignode file without issue, it just can\u0027t load it. Took me forever to figure that twist out when I ran into it.\u003C/p\u003E\u003Cp\u003ENote that this is from my experience with ConfigNode.Save/Load with .cfg files on disk, I assume the same holds true for the XML files you are using.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-04-19T22:39:37Z\u0022 title=\u002204/19/2015 10:39  PM\u0022 data-short=\u00229 yr\u0022\u003EApril 19, 2015\u003C/time\u003E by Diazo\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"stupid_chris","CreatedById":62017,"CreatedDateTime":"2015-04-20T09:12:16Z","Content":"\n\u003Cp\u003EHonestly, just dont use PluginConfiguration. Itll be much easier for you to save/load manually and isnt really more work.\u003C/p\u003E\n"}]}