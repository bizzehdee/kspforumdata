{"TopicId":104410,"ForumId":29,"TopicTitle":"Tried to make a GUI text area and now there are no parts in the game","CreatedByName":"Greendolph","CreatedById":131208,"CreatedDateTime":"2015-04-19T00:45:47Z","PageNum":1,"Articles":[{"CreatedByName":"Greendolph","CreatedById":131208,"CreatedDateTime":"2015-04-19T00:45:47Z","Content":"I was following the tutorial [here](https://youtu.be/_qruuunMpHA) and decided I wanted to add a TextArea object and a Button. When I added them KSP could no longer find any of the parts in the game and the vessel I had been testing the PartModule part on failed to load because no parts existed anymore. What could possibly have caused that? I\u0027ve checked the KSP folder and everything still exists and no directory names have been changed..."},{"CreatedByName":"stupid_chris","CreatedById":62017,"CreatedDateTime":"2015-04-19T01:10:13Z","Content":"Can\u0027t help you without seeing the code."},{"CreatedByName":"Greendolph","CreatedById":131208,"CreatedDateTime":"2015-04-19T01:20:17Z","Content":"If you want a sea of text, here you go mate ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif) In the future it may be more practical to start form the perspective of common causes of such errors in order to provide context that would allow me to share code specific to the issue.\n\n    using UnityEngine;using GuiWindowPlugin.Extentions;using KSP.IO;namespace GuiWindowPlugin{    public class GuiWindowPlugin : PartModule    {        private Rect _windowPosition = new Rect();        private GUIStyle _windowStyle, _textAreaStyle, _buttonStyle;        private bool _hasInitStyles = false;        private int _drawCall = 0;        private string _textAreaText = \u0022\u0022;        public override void OnStart(StartState state)        {            if (state != StartState.Editor)            {                if (!_hasInitStyles)                {                    InitStyles();                }                RenderingManager.AddToPostDrawQueue(0, OnDraw);            }        }        public override void OnSave(ConfigNode node)        {            PluginConfiguration config = PluginConfiguration.CreateForType();            config.SetValue(\u0022Window Position\u0022, _windowPosition);            config.SetValue(\u0022Draw Call\u0022, _drawCall);            config.SetValue(\u0022Text Area Text\u0022, _textAreaText);            config.save();        }        public override void OnLoad(ConfigNode node)        {            PluginConfiguration config = PluginConfiguration.CreateForType();            config.load();            _windowPosition = config.GetValue(\u0022Window Position\u0022);            _drawCall = config.GetValue(\u0022Draw Call\u0022);            _textAreaText = config.GetValue(\u0022Text Area Text\u0022);        }        private void OnDraw()        {            _drawCall\u002B\u002B;            if (this.vessel == FlightGlobals.ActiveVessel \u0026\u0026 this.part.IsPrimary(this.vessel.parts, this.ClassID))            {                _windowPosition = GUILayout.Window(10, _windowPosition, OnWindow, \u0022Draw Call #\u0022 \u002B _drawCall.ToString(), _windowStyle);                if (_windowPosition.x == 0f \u0026\u0026 _windowPosition.y == 0f)                {                    _windowPosition = _windowPosition.CenterScreen();                }            }        }        private void OnWindow(int windowId)        {            GUILayout.BeginVertical();            GUILayout.TextArea(_textAreaText, _textAreaStyle);            GUILayout.Button(\u0022Run\u0022, _buttonStyle);            GUILayout.EndVertical();            GUI.DragWindow();        }        private void InitStyles()        {            _windowStyle = new GUIStyle(HighLogic.Skin.window);            _windowStyle.fixedWidth = 250f;            _textAreaStyle = new GUIStyle(HighLogic.Skin.textArea);            _textAreaStyle.stretchWidth = true;            _buttonStyle = new GUIStyle(HighLogic.Skin.button);            _buttonStyle.fixedWidth = 100f;            _hasInitStyles = true;        }    }}\n\n    using System.Collections.Generic;using UnityEngine;namespace GuiWindowPlugin.Extentions{    public static class PartExtentions    {        public static bool IsPrimary(this Part thisPart, List partsList, int moduleClassID)        {            foreach (Part part in partsList){                if (part.Modules.Contains(moduleClassID))                {                    if (part == thisPart)                    {                        return true;                    }                    else                    {                        break;                    }                }            }            return false;        }    }}\n\n    using UnityEngine;namespace GuiWindowPlugin.Extentions{    public static class RectExtentions    {        public static Rect CenterScreen(this Rect thisRect)        {            if (Screen.width \u003E 0f \u0026\u0026 Screen.height \u003E 0f \u0026\u0026 thisRect.width \u003E 0f \u0026\u0026 thisRect.height \u003E 0f)            {                thisRect.x = (Screen.width / 2) - (thisRect.width / 2);                thisRect.y = (Screen.height / 2) - (thisRect.height / 2);            }            return thisRect;        }    }}"},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2015-04-19T02:02:45Z","Content":"\u003E \n\u003E If you want a sea of text, here you go mate ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif) In the future it may be more practical to start form the perspective of common causes of such errors in order to provide context that would allow me to share code specific to the issue.\n\nSections of code are generally worthless unless you know what all the inputs/outputs are (and that they are valid). You also haven\u0027t mentioned any exceptions being logged that you could follow the stack trace for to narrow it down. My bet would be that it\u0027s throwing a lot of errors during the initial loading process, but it\u0027s impossible to tell without any information from the logs\n\nPS\n\nAn easier way to handle default window positions\n\n    _windowPosition = config.GetValue(\u0022Window Position\u0022); // defaults to 0,0,0,0 if no value is found (current implementation)_windowPosition = config.GetValue(\u0022Window Position\u0022, new Rect(10,10,0,0)); // defaults to 10,10,0,0 if no value can be found\n\nEDIT\n\nYour problem is probably going to be OnStart. It could get called during the part compilation process and the != editor check wont catch that (HighLogic.LoadedSceneIsFlight is probably the check you want)\n\n**Edited \u003Ctime datetime=\u00222015-04-19T02:24:53Z\u0022 title=\u002204/19/2015 02:24  AM\u0022 data-short=\u00229 yr\u0022\u003EApril 19, 2015\u003C/time\u003E by Crzyrndm**"},{"CreatedByName":"stupid_chris","CreatedById":62017,"CreatedDateTime":"2015-04-19T02:12:03Z","Content":"\u003E \n\u003E If you want a sea of text, here you go mate ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif) In the future it may be more practical to start form the perspective of common causes of such errors in order to provide context that would allow me to share code specific to the issue.\n\nIf you don\u0027t want help, don\u0027t ask for help. You procided no info except \u0022it doesn\u0027t work\u0022. Based on that, the only guess I could make is that something screws up during the loading process, and your code is a very good indiction to \\*what\\* might be screwing up. The two basic things to provide is logs and code.\n\nCrzyrndm has a good point. Other than that, I\u0027m not sure if OnStart runs in the Loading Sequence, but if it does I can guarantee it will fail, beause this.vessel will be null. You\u0027re also not nullchecking FlightGlobals.ActiveVessel, which can be null a few frames while the vessel is being loaded in flight. To figure out more, logs will be needed."},{"CreatedByName":"Greendolph","CreatedById":131208,"CreatedDateTime":"2015-04-19T02:33:01Z","Content":"\u003E Your problem is probably going to be OnStart. It could get called during the part compilation process and the != editor check wont catch that\n\nI changed it to \n\n    if (state == StartState.Flying)\n\nand I have the same issue. \n\nI tried removing all references to the TextArea control on the \\_textAreaText string and nothing changed.\n\nIs there a way I can see debug output from the part compilation?\n\n- - - Updated - - -\n\nI found this, not sure exactly how to interpret it. From KSP.txt\n\n    [EXC 19:29:32.749] XmlException: Document element did not appear. file:///C:/TestEnvironments/KSP/Kerbal Space Program/Plugins/PluginData/GuiWindowPlugin/config.xml Line 1, position 1.\tMono.Xml2.XmlTextReader.Read ()\tSystem.Xml.XmlTextReader.Read ()\tMono.Xml.EntityResolvingXmlReader.Read ()\tMono.Xml.DTDValidatingReader.ReadContent ()\tMono.Xml.DTDValidatingReader.Read ()\tMono.Xml.Schema.XsdValidatingReader.Read ()\tSystem.Xml.XmlValidatingReader.Read ()\tSystem.Xml.XmlDocument.ReadNodeCore (System.Xml.XmlReader reader)\tSystem.Xml.XmlDocument.ReadNode (System.Xml.XmlReader reader)\tSystem.Xml.XmlDocument.Load (System.Xml.XmlReader xmlReader)\tSystem.Xml.XmlDocument.Load (System.String filename)\tKSP.IO.PluginConfiguration.load ()\tGuiWindowPlugin.GuiWindowPlugin.OnLoad (.ConfigNode node)\tPartModule.Load (.ConfigNode node)\tPart.AddModule (.ConfigNode node)\tPartLoader.ParsePart (.UrlConfig urlConfig, .ConfigNode node)\tPartLoader\u002B.MoveNext ()\tUnityEngine.MonoBehaviour:StartCoroutine(IEnumerator)\t:MoveNext()\tUnityEngine.MonoBehaviour:StartCoroutine(IEnumerator)\tPartLoader:StartLoad()\t:MoveNext()"},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2015-04-19T02:35:21Z","Content":"[http://forum.kerbalspaceprogram.com/threads/92230-!!!-PLEASE-READ-BEFORE-POSTING-!!!-Stock-Support-Bug-Reporting-Guide](https://forum.kerbalspaceprogram.com/threads/92230-!!!-PLEASE-READ-BEFORE-POSTING-!!!-Stock-Support-Bug-Reporting-Guide)\n\nScroll down to the bit about output logs. Search that file for exception and you\u0027ll find what you need\n\n- - - Updated - - -\n\nIt\u0027s onload that\u0027s running\n\n    GuiWindowPlugin.GuiWindowPlugin.OnLoad (.ConfigNode node)\n\nSomething wrong with the config read"},{"CreatedByName":"Greendolph","CreatedById":131208,"CreatedDateTime":"2015-04-19T20:05:42Z","Content":"When I comment out the save/load methods everything works again. Is there a way I can check the config node for validity when I load it?"},{"CreatedByName":"Crzyrndm","CreatedById":92871,"CreatedDateTime":"2015-04-19T21:20:08Z","Content":"The config node that\u0027s passed to OnLoad isn\u0027t invalid (or atleast, it has nothing to do with the error). It errors when you call:\n\n    KSP.IO.PluginConfiguration.load ()\n\nwhich is the second line of OnLoad (config.load(); )\n\nThere\u0027s nothing out of the ordinary with your method, so that leaves either a corrupt file (delete this file: C:/TestEnvironments/KSP/Kerbal Space Program/Plugins/PluginData/GuiWindowPlugin/config.xml and see if things get resolved), or maybe a permission error."},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2015-04-19T22:34:12Z","Content":"Note that one issue with a ConfigNode file is that it can\u0027t be empty.\n\nIf you have a \u0022no data\u0022 ConfigNode.cfg file with nothing in it, KSP does not initialize the node correctly.\n\n    ConfigNode myNode = ConfigNode.Load(fileOnDisk.cfg);\n\n will result in a myNode that is null if fileOnDisk.cfg is empty, or a valid config node if fileOnDisk.cfg has data.\n\nNote that KSP will happily *save* an empty confignode file without issue, it just can\u0027t load it. Took me forever to figure that twist out when I ran into it.\n\nNote that this is from my experience with ConfigNode.Save/Load with .cfg files on disk, I assume the same holds true for the XML files you are using.\n\nD.\n\n**Edited \u003Ctime datetime=\u00222015-04-19T22:39:37Z\u0022 title=\u002204/19/2015 10:39  PM\u0022 data-short=\u00229 yr\u0022\u003EApril 19, 2015\u003C/time\u003E by Diazo**"},{"CreatedByName":"stupid_chris","CreatedById":62017,"CreatedDateTime":"2015-04-20T09:12:16Z","Content":"Honestly, just dont use PluginConfiguration. Itll be much easier for you to save/load manually and isnt really more work."}]}