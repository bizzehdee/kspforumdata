{"TopicId":104258,"ForumId":15,"TopicTitle":"Light Animation works in VAB but not when launched","CreatedByName":"Shadowmage","CreatedById":138730,"CreatedDateTime":"2015-04-16T14:49:07Z","PageNum":1,"Articles":[{"CreatedByName":"Shadowmage","CreatedById":138730,"CreatedDateTime":"2015-04-16T14:49:07Z","Content":"Hi all,\n\nI have a few parts (multiple parts with the same problem...) where I have set up animations to control a spotlight. These animations work fine in Unity, -and- when the pieces are tested in the VAB when played through a ModuleLight. However, whenever the vessel is launched I lose control over those animations -- the \u0027lights on\u0027 toggle does not function any longer for that part, and the animation does not play at all; in fact the light is stuck at whatever the default animation state is (I can toggle it between default on/off during unity export). On these same animations, the emissive portion of the animation does not play either (which is why I think the animations are not playing properly outside the VAB). \n\n~~However, I have other parts with -just- emissives in their animation that are using the ModuleLight without problem. ~~ Scratch that, the other anims are using Module Animate Generic\n\nStranger still -- If I change the ModuleLight to ModuleAnimateGeneric, the light works fine (both spot and emissive) (for the same animation!). Also, if I change the config setting of \u0027useAnimDim\u0027 (or w/e it is) to \u0027false\u0027, then the spotlight activates properly, but the emissive part of the animation is still not played.\n\nThe animations were created by cycling the \u0027enabled\u0027 property of a spotlight component for the chosen keyframes. I also tried by changing the RGBA values of the light. Neither way resulted in the animations playing properly outside of the VAB.\n\nSounds like I\u0027m not setting up something properly in my Unity export or config for those animations... probably something simple I\u0027ve missed in my reading or setup incorrectly...but it was a long night and I was a bit stumped. Any clues?\n\nOn a second note; is it possible to control the \u0027enabled\u0027 flag of multiple spotlights in Unity in the same animation (or some other way to control multiple spotlight sources on the same part through the same animation)? I could only get the first one added to the animation to cycle properly in Unity... and I don\u0027t think they worked properly at all once exported to KSP.\n\n**Edited \u003Ctime datetime=\u00222015-04-16T23:48:54Z\u0022 title=\u002204/16/2015 11:48  PM\u0022 data-short=\u00229 yr\u0022\u003EApril 16, 2015\u003C/time\u003E by Shadowmage**"},{"CreatedByName":"CaptainKipard","CreatedById":70516,"CreatedDateTime":"2015-04-17T00:18:58Z","Content":"\u003E \n\u003E On a second note; is it possible to control the \u0027enabled\u0027 flag of multiple spotlights in Unity in the same animation (or some other way to control multiple spotlight sources on the same part through the same animation)? I could only get the first one added to the animation to cycle properly in Unity... and I don\u0027t think they worked properly at all once exported to KSP.\n\nYes I think the way to do that would be to make the animation apply to a mutual parent of all three lights (btw don\u0027t go overboard with lights. They\u0027re expensive) and animate each light under that parent.\n\nBesides that what\u0027s the problem? It looks like you have it sorted."},{"CreatedByName":"Shadowmage","CreatedById":138730,"CreatedDateTime":"2015-04-17T14:33:51Z","Content":"The real problem that I\u0027m facing is that the light animations will not play properly outside of the VAB when called through a ModuleLight. They will be stuck with whatever the default animation state is for those objects (lit or unlit depending upon how it was setup when exported). However the animation plays without issue when played through a ModuleAnimateGeneric.\n\nFor now, I\u0027ve just swapped over to using the ModuleAnimateGeneric for all of my lighting animations. They work exactly as animated when played through there. I would like to get the resource cost included in the lights and auto key to the \u0027Lights\u0027 action group, which is why I was attempting to use ModuleLight for those functions, but I suppose I can live without it. I will continue investigating, and post any fix that I can find.\n\nYes, lights are expensive to render; I originally had a pair of spotlights for front landing lights, but swapped one of them to a rear light, each on individual controls. So, for this part, it is only as expensive as the user tells it to be (by clicking the \u0027light on\u0027 button). ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)"},{"CreatedByName":"CaptainKipard","CreatedById":70516,"CreatedDateTime":"2015-04-17T21:30:06Z","Content":"Did you create an animation in Unity and refer to it in the cfg under ModuleLight?\n\nIs that animation animating both the emissive and the light?\n\nWhat does your MODULE look like?"},{"CreatedByName":"Shadowmage","CreatedById":138730,"CreatedDateTime":"2015-04-17T22:17:15Z","Content":"Animation created in unity: Yes\n\nReferenced animation name and light name in ModuleLight: Yes\n\nThe same animation controls both the emissive and light source.\n\nAt work at the moment... will post up the pertinent modules (and screenshots) shortly after I get home.\n\nThe animation plays properly when using ModuleAnimateGeneric, but not using ModuleLight. -- this is the part that has me completely baffled. As the part I\u0027m working on is pretty complex (function wise), I\u0027ll likely try and create some simpler parts and see if I can get it working on part with a single module.\n\nI am fairly new at working with Unity/animations though, so it may well be something simple that I am missing.\n\nThanks for time and help, I\u0027m sure it\u0027ll get sorted out eventually."},{"CreatedByName":"Shadowmage","CreatedById":138730,"CreatedDateTime":"2015-04-18T00:55:00Z","Content":"The light module, that works just fine in the VAB, but not when launched.\n\nMODULE\n\n{\n\n name = ModuleLight\n\n lightName = LMD-Light1Transform\n\n animationName = SCA-LMD-LightsOn\n\n useAnimationDim = true //setting this to false allowed the light source to be toggleable, but no emissive animation played; I have a feeling this tells the module to take manual control of the light source rather than use any animation\n\n lightBrightenSpeed = 2.5\n\n lightDimSpeed = 2.5\n\n resourceAmount = 0.04\n\n useResources = true\n\n}\n\nAnd here is the ModuleAnimateGeneric that plays the -same- animation just fine, with both the light source and emissive animating/lighting up properly, in or out of the VAB\n\nMODULE\n\n{\n\n name = ModuleAnimateGeneric\n\n animationName = SCA-LMD-LightsOn\n\n isOneShot = false \n\n startEventGUIName = Landing Light On\n\n endEventGUIName = Landing Light Off\n\n actionGUIName = Toggle Landing Light\n\n}\n\nGoing to try out a few more random ideas, I\u0027m pretty sure there is something silly that I\u0027m missing or that is conflicting in my overly-complex part."},{"CreatedByName":"CaptainKipard","CreatedById":70516,"CreatedDateTime":"2015-04-18T02:32:48Z","Content":"That all looks fine, provided the lightName is correct. I doubt this will make a difference but you can try without hyphens.\n\nCan you show a screenshot of the animation keyframes and hierarchy?"},{"CreatedByName":"Shadowmage","CreatedById":138730,"CreatedDateTime":"2015-04-18T18:00:34Z","Content":"Tried changing hyphens to underscores with no luck, will try with no special characters shortly, though I\u0027ve not had any problems with those before. Edit: By \u0027no luck\u0027 I mean to say that there was no change; the animation still plays properly in the VAB, but not when launched.\n\nSS of the animation keyframes / hierarchy\n\n![o3KPLe6.png](http://i.imgur.com/o3KPLe6.png)\n\n- - - Updated - - -\n\nFurther update -- on a random idea, I tried removing -all- other modules/etc from my part, leaving on the EC resource and ModuleLight; and now the animation plays fine when launched.\n\nSo... there must be some conflict between one of the modules in my part. Will do further testing to eliminate what the conflict is, though it is likely related to either ModuleEngines, ModuleGimball, or ModuleAnimateHeat (as I have a second part with the same problem, and those are the modules that they share).\n\nFor reference, these are the parts that I am working on... specifically the lander descent stage, and main service module: [https://github.com/shadowmage45/KSPMods/wiki/Ship-Core:-Series-A](https://github.com/shadowmage45/KSPMods/wiki/Ship-Core:-Series-A) (descent stage does not have the lamp in the renders on that page, was a late addition to the model and needs to be re-rendered).\n\nAnyhow, thanks again for your help, you have at least motivated me to investigate further, and I think I am close to tracking it down now.\n\n**Edited \u003Ctime datetime=\u00222015-04-18T17:47:03Z\u0022 title=\u002204/18/2015 05:47  PM\u0022 data-short=\u00229 yr\u0022\u003EApril 18, 2015\u003C/time\u003E by Shadowmage**"},{"CreatedByName":"sumghai","CreatedById":66272,"CreatedDateTime":"2015-04-18T22:53:25Z","Content":"Yeah, ModuleLight\u0027s animated state conflicts with a number of other modules.\n\nWhen I made the parachute-equipped docking ports for SDHI SMS, my docking ports had built-in lights as well. The lights can be toggled most of the time, but if the lights are on when the parachute is deployed, the lights remain on even when toggled."},{"CreatedByName":"Shadowmage","CreatedById":138730,"CreatedDateTime":"2015-04-19T16:09:25Z","Content":"Good to know. I\u0027ll play around with it a bit more and see what I can sort out; it might still be name related, as I remembered some of the .cfg node definition/references have problems with underscores and hyphens (docking node, decoupler)."}]}