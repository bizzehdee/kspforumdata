{"TopicId":173577,"ForumId":15,"TopicTitle":"Animated Meshes (Blendshapes / Shapekeys) - KEAM Inside Look","CreatedByName":"bcink","CreatedById":181027,"CreatedDateTime":"2018-04-07T02:43:17Z","PageNum":1,"Articles":[{"CreatedByName":"bcink","CreatedById":181027,"CreatedDateTime":"2018-04-07T02:43:18Z","Content":"\n\u003Cp\u003E\n\u003Cstrong\u003EThis thread will instruct you on how to create Kerbal parts using animated meshes, known in Blender as Shape Keys and known in Unity as Blend Shapes.\u003C/strong\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cstrong\u003EDisclaimer: This guide assumes you already have a basic understanding of modeling, animation and creating simple Kerbal parts.\u003C/strong\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cstrong\u003EWhy??? \u003C/strong\u003EThe benefit of using animated meshes over regular scaling or rotating of a part allows you to yield complex animations from a single object, regardless of its shape.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nIn the Kerbalverse, these parts are most noticeable with inflatable habitats. To my understanding, the only few on the market are those created by myself. With that said, I am hoping this will encourage others to take advantage of our new ability to use Blendshapes in Kerbal thanks to the hard work of \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/138730-shadowmage/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022138730\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/138730-shadowmage/\u0022 rel=\u0022\u0022\u003E@Shadowmage\u003C/a\u003E and his Textures Unlimited plugin, which allows for the loading of Asset Bundle-based models. Asset bundle based model loading is currently the only way to accomplish having these parts in Kerbal.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nFor example, it would not be possible to create the egg-shape of the KEAM (BEAM module recreation) if I were to just scale a cylinder. The end resulting animation and shape would not be appropriate.\n\u003C/p\u003E\n\u003Cp\u003E\nSee wireframe example of the KEAM\u0027s expansion using a single object:\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u0022NWPQfjB.gif\u0022 class=\u0022ipsImage\u0022 height=\u0022635\u0022 src=\u0022https://imgur.com/NWPQfjB.gif\u0022 width=\u0022824\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nTo start, create your model as normal. Create your desired animation with your object using Shape Keys (if Blender) (please Google for simple tutorials on this if you are unsure about animating with Shape Keys. The idea is very similar to animating a regular object. Where you would hit the I key for keyframe over the timeline, you instead do it over a new Shape Key on the side menu).\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u0022YIIlxOH.png\u0022 class=\u0022ipsImage\u0022 height=\u0022768\u0022 src=\u0022https://imgur.com/YIIlxOH.png\u0022 width=\u0022466\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nIf using Blender, it\u0027s best to save the .blend file within your Unity project location and work from that file within Unity. If you prefer or require FBX format for any various reason, ensure you have the \u0022Baked Animation\u0022 option checked under the Animation tab in your export options. Check \u0022Key All Bones\u0022 if using bones for anything.\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u0022gPCL2WP.png\u0022 class=\u0022ipsImage\u0022 height=\u0022436\u0022 src=\u0022https://imgur.com/gPCL2WP.png\u0022 width=\u0022308\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nInside Unity, you only need to verify your BlendShapes numbers under the Skinnded Mesh Render component of the animated object match the numbers in Blender. Warning: I noticed some issues above 9 Shape Keys where it seems that Unity only recognizes a total of 10. Avoid going above 9.\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u0022wQvUEBd.png\u0022 class=\u0022ipsImage\u0022 height=\u0022596\u0022 src=\u0022https://imgur.com/wQvUEBd.png\u0022 width=\u00221024\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nIt is very important to note, if you are using a model that contains any sort of part triggers, layers, or tags, like an Airlock or a Ladder, is is \u003Cstrong\u003EMANDATORY\u003C/strong\u003E that you set up your part tags EXACTLY as shown in the following picture or they \u003Cstrong\u003EWILL NOT WORK \u003C/strong\u003Ewhen loaded in Kerbal:\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u0022GWfut1D.png\u0022 class=\u0022ipsImage\u0022 height=\u0022657\u0022 src=\u0022https://imgur.com/GWfut1D.png\u0022 width=\u00221024\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nThe final result on your model must still contain the proper tags and layers, for example with an airlock / hatch:\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u0022fsPGX9P.png\u0022 class=\u0022ipsImage\u0022 height=\u0022618\u0022 src=\u0022https://imgur.com/fsPGX9P.png\u0022 width=\u00221024\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nTo create the prefab (\u0022Asset Bundle object file,\u0022 as I call it), simply drag the ROOT part of your model FROM the hierarchy into the project folder window below. This action will create a prefab file.\n\u003C/p\u003E\n\u003Cp\u003E\nSelect this prefab file so that you are viewing the preview of it in preview window. There is an AssetBundle \u0022tag\u0022 location on the bottom of this window. Select the dropdown and create a new name for your asset bundle.\n\u003C/p\u003E\n\u003Cp\u003E\nClick KSPAssets on the top toolbar of Unity and select Asset Compiler.\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u00223mhCfx0.png\u0022 class=\u0022ipsImage\u0022 height=\u0022591\u0022 src=\u0022https://imgur.com/3mhCfx0.png\u0022 width=\u00221024\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nClick \u0022Create\u0022 for your asset bundle, followed by Update and then Build. This outputs an assetbundlename.ksp file to your Unity project\u0027s \u0022Asset Bundle\u0022 folder, one directory up from your Assets folder.\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u0022yekrNgj.png\u0022 class=\u0022ipsImage\u0022 height=\u0022394\u0022 src=\u0022https://imgur.com/yekrNgj.png\u0022 width=\u0022813\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nThe final step is to rename your finished asset bundle file to have an extension of \u003Cstrong\u003E.smf instead of .ksp\u003C/strong\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cstrong\u003EFinally, drop your .smf file into your Kerbal addon folder inside GameData along with its textures and config file and as long as you have Textures Unlimited installed, the .smf file will be loaded like a normal part.\u003C/strong\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nI hope this can be of great help to the community or even just one person as I would love to see more complex animations in the Kerbal universe!\n\u003C/p\u003E\n\u003Cp\u003E\nThanks!!!\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222018-04-07T04:34:36Z\u0022 title=\u002204/07/2018 04:34  AM\u0022 data-short=\u00226 yr\u0022\u003EApril 7, 2018\u003C/time\u003E by bcink\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"CobaltWolf","CreatedById":105588,"CreatedDateTime":"2018-04-09T18:04:28Z","Content":"\n\u003Cp\u003E\nThanks for writing this! \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"bcink","CreatedById":181027,"CreatedDateTime":"2018-04-09T22:48:19Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223349922\u0022 data-ipsquote-contentid=\u0022173577\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221523297068\u0022 data-ipsquote-userid=\u0022105588\u0022 data-ipsquote-username=\u0022CobaltWolf\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n4 hours ago, CobaltWolf said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nThanks for writing this! \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nAbsolutely. Now we just need some folks to take advantage of it \u003Cimg alt=\u0022:D\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 title=\u0022:D\u0022\u003E\u003Cimg alt=\u0022:D\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 title=\u0022:D\u0022\u003E\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"DMagic","CreatedById":57416,"CreatedDateTime":"2018-04-11T12:53:52Z","Content":"\n\u003Cp\u003E\nWhat\u0027s the difference between\u00A0blend shapes and using an armature animation? Or maybe a better question is what can you do with one that can\u0027t do with the other?\n\u003C/p\u003E\n"},{"CreatedByName":"bcink","CreatedById":181027,"CreatedDateTime":"2018-04-11T13:26:55Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223351528\u0022 data-ipsquote-contentid=\u0022173577\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221523451232\u0022 data-ipsquote-userid=\u002257416\u0022 data-ipsquote-username=\u0022DMagic\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n21 minutes ago, DMagic said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nWhat\u0027s the difference between\u00A0blend shapes and using an armature animation? Or maybe a better question is what can you do with one that can\u0027t do with the other?\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nMy understanding of armatures is such that they work with bones and allow you to \u0022join\u0022 multiple objects in an animation to reach a desired rotation / location with the parts as shown here:\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u0022of4L0d3.png\u0022 class=\u0022ipsImage\u0022 height=\u0022727\u0022 src=\u0022https://imgur.com/of4L0d3.png\u0022 width=\u0022836\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nIn the above example the objects themselves do not change in any fashion, only their location and rotation. The objects are parented to the armatures / bones and perform the rotations based on the joint locations.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nBlend shapes would allow the objects themselves to change. It wouldn\u0027t make much sense in the above example to use shape keys. The below example is another demonstration of the shape keys being used on a single shape (from the double-stack hab with inflatable top from new M.A.H. lander pack). Notice the original shape of the expanding top is both a concave and convex single object. With the shape key animations, you are able to morph the actual mesh through animation to reach it\u0027s desired final shape. I don\u0027t believe something is possible like this with the use of armatures / bones.\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u0022vqB5Qfu.png\u0022 class=\u0022ipsImage\u0022 height=\u0022503\u0022 src=\u0022https://imgur.com/vqB5Qfu.png\u0022 width=\u0022824\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nI hope that helps a bit? Let me know otherwise.\n\u003C/p\u003E\n\u003Cp\u003E\nThanks!\n\u003C/p\u003E\n"},{"CreatedByName":"CobaltWolf","CreatedById":105588,"CreatedDateTime":"2018-04-11T13:31:07Z","Content":"\n\u003Cp\u003E\nThey are two different ways of achieving the same thing - that is, changing the shape of something. I know that for character rigging, specifically facial rigging, people usually decide whether they want to accomplish it through bones or blend shapes or both.\n\u003C/p\u003E\n\u003Cp\u003E\nIt\u0027s worth noting that for things like engine gimballing, etc where the animation is dynamic then bones are the way to go. Blend shapes are better for things like these inflatables where the shape and deformation don\u0027t lend themselves to creating an armature.\n\u003C/p\u003E\n"},{"CreatedByName":"DMagic","CreatedById":57416,"CreatedDateTime":"2018-04-11T14:49:05Z","Content":"\n\u003Cp\u003E\nArmatures aren\u0027t usually used for separate objects like that landing leg, assuming those are separate meshes (the little extending foot-pad cylinder definitely is, but the others don\u0027t necessarily have to be). That example is using an Inverse Kinematics rig (that yellow bone has an IK constraint) to make all of the joints move together in a way that makes sense. Unity doesn\u0027t understand those bone constraints, but this type of animation can just be baked (the location, rotation and scale of all the deform bones keyed at each frame) and it will load into Unity and KSP just fine as a SkinnedMeshRenderer.\n\u003C/p\u003E\n\u003Cp\u003E\nNormally you would rig a single mesh to an armature, then assign weights at each vertex to determine which bone alters the position of which vertex (this can be mostly done automatically, or in groups of vertices at a time). You can blend together multiple bones at each vertex, but Unity limits it to the four with the highest weights.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nThe reason I\u0027m asking is that I think a similar effect might be possible using only bones. It isn\u0027t necessary to have bones be linked together as part of a single chain like you see in that leg example. In the bone properties you can uncheck the \u0022Connected\u0022 option which will allow a bone to move freely, it will still inherit the parent bone\u0027s rotation and scale (you can uncheck those in Blender, too, but Unity doesn\u0027t accept that and will always inherit parent bone rotation and scale).\n\u003C/p\u003E\n\u003Cp\u003E\nSo you might be able to make that inflation animation by (assuming the y axis goes to the right in your example) translating the bones to the right\u00A0and scaling them up in their x and z axes. Scaling can be tricky to work with in bones, so you might need to make the bones siblings in the hierarchy,\u00A0rather than a chain of unconnected bones.\n\u003C/p\u003E\n\u003Cp\u003E\nThat might be more trouble for this example, but for anyone not wanting to rely on outside dependencies it could be helpful.\n\u003C/p\u003E\n"},{"CreatedByName":"bcink","CreatedById":181027,"CreatedDateTime":"2018-04-11T14:54:22Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223351606\u0022 data-ipsquote-contentid=\u0022173577\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221523458145\u0022 data-ipsquote-userid=\u002257416\u0022 data-ipsquote-username=\u0022DMagic\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n3 minutes ago, DMagic said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nThat might be more trouble for this example, but for anyone not wanting to rely on outside dependencies it could be helpful.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nGreat insight. Had no idea about weights (my skills are not very advanced).\n\u003C/p\u003E\n\u003Cp\u003E\nTrue on that example as well. The final release had no bones even and just used constraints in this case as well. \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"DMagic","CreatedById":57416,"CreatedDateTime":"2018-04-11T15:32:36Z","Content":"\n\u003Cp\u003E\nI whipped up a quick example:\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u0022rRMhNDp.gif\u0022 class=\u0022ipsImage\u0022 height=\u0022511\u0022 src=\u0022https://i.imgur.com/rRMhNDp.gif\u0022 width=\u0022600\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nEach double ring on the cylinder is weighted for the bone that starts at that ring (so the first double ring on the left is weighted to the second bone). Then I uncheck \u0022connected\u0022 for each bone in the chain and just translate and scale in the X and Z axes. I also unchecked inherit scale, so this would not strictly work in Unity, but as I said above, there are workarounds.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nObviously, if you are going to use a dependency anyway then you should use what is easiest. But if you or someone else wants to, you can make similar inflation animations with just bones.\n\u003C/p\u003E\n\u003Cp\u003E\nWhen you select one of the vertices in the cylinder the setup looks like this:\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u0022cxhrfHe.png\u0022 class=\u0022ipsImage\u0022 height=\u0022768\u0022 src=\u0022https://i.imgur.com/cxhrfHe.png\u0022 width=\u0022811\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nOn the left, in the properties tab, you can see the Vertex Weights category, this vertex is set to Bone.002 with full weight, you can mix other bones with values between 0-1 (if only a single bone is selected then any value \u0026gt; 0 will be full weight).\n\u003C/p\u003E\n\u003Cp\u003E\nThe Vertex Groups window on the right shows the available weight groups, these can be generated automatically when you parent a mesh to an armature, or you can just add them. The names of the groups match the names of the bones. You can select a group of vertices then use the \u0022Assign\u0022 button to assign vertex weights to multiple vertices at the same time. You can also paint on vertex weights by changing the mesh from Edit Mode to Weight Mode.\n\u003C/p\u003E\n"}]}