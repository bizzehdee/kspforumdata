{"TopicId":153418,"ForumId":15,"TopicTitle":"Procedural Planet Textures using Adobe After Effects","CreatedByName":"Poodmund","CreatedById":128643,"CreatedDateTime":"2016-12-12T21:07:03Z","PageNum":1,"Articles":[{"CreatedByName":"Poodmund","CreatedById":128643,"CreatedDateTime":"2016-12-12T21:07:03Z","Content":"\n\u003Cp\u003E\n\u003Cspan style=\u0022font-size:20px;\u0022\u003E\u003Cu\u003E\u003Cstrong\u003ECreating Procedural Planet Textures (Heightmap \u0026amp; Colour) using Adobe After Effects\u003C/strong\u003E\u003C/u\u003E\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cu\u003E\u003Cstrong\u003EAbstract\u003C/strong\u003E\u003C/u\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nTo create\u00A0an Adobe After Effects template that will allow for the generation of Planet/Moon\u00A0Heightmap and Colour Maps for use with KSP by utilizing\u00A0fractal noise layering to allow for ease of use by those that may not understand noise generation or subsequently, PQSMods/libnoise functions.\n\u003C/p\u003E\n\u003Cp\u003E\nThe Adobe After Effects project can be download and used from here:\u00A0\u003Ca href=\u0022https://www.dropbox.com/s/zss8ydp80zm6h7b/Planet%20Textures.aep?dl=0\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://www.dropbox.com/s/zss8ydp80zm6h7b/Planet Textures.aep?dl=0\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n-----\n\u003C/p\u003E\n\u003Cp\u003E\nI recently rediscovered the power and effectiveness of After Effect\u0027s Fractal Noise libraries whilst working on unrelated projects and considered that it would be a powerful tool when used to create base textures for planetoids in KSP; if utilised correctly.\n\u003C/p\u003E\n\u003Cp\u003E\nDue to the way After Effects generates the noise, most noise created would be generated outside of the -180 to 180 degrees phase and therefore would not be seamless in the workspace and also the noise is created in a rectangular image space and therefore there would be significant \u0027pinching\u0027 distortion at the poles. To rectify this, the noise image space can be distorted using polar deformation to remove this issue and finally some manual seam blending can be introduced using a small mask to cover any inconsistencies that blends in with its surrounding environment.\n\u003C/p\u003E\n\u003Cp\u003E\nFinally, the resulting greyscale heightmap can be colourized depending on the lightness using a custom\u00A0gradient scale to create a coloured ScaledSpace texture that varies with colour proportional to altitude. These textures can be rendered out of After Effects (at 8192x4096 in the attached project) for further use within KSP or for additional image manipulation work. The greyscale heightmap can be passed through a normal map generator to give you the bump map to be used in-game (remember that KSP uses inverted Red to the Alpha channel and the Green channel duplicated to RGB).\n\u003C/p\u003E\n\u003Cp\u003E\nAnyway, I have done some quick and dirty previews as to what can be achieved with not a terrible amount of effort, as you can see, bodies with complex and noisy terrain can be generated alongside those with mostly flat, rounded slopes:\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u0022nyP1JBW.gif\u0022 class=\u0022ipsImage\u0022 src=\u0022http://i.imgur.com/nyP1JBW.gif\u0022\u003E\u003Cimg alt=\u0022Xrubzac.gif\u0022 class=\u0022ipsImage\u0022 src=\u0022http://i.imgur.com/Xrubzac.gif\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u0022V5ZrmHx.gif\u0022 class=\u0022ipsImage\u0022 src=\u0022http://i.imgur.com/V5ZrmHx.gif\u0022\u003E\u003Cimg alt=\u0022nQcS0u2.gif\u0022 class=\u0022ipsImage\u0022 src=\u0022http://i.imgur.com/nQcS0u2.gif\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nThe above planetoids have all been generated using textures rendered straight from After Effects with the normal maps used being from the \u003Ca href=\u0022http://cpetry.github.io/NormalMap-Online/\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://cpetry.github.io/NormalMap-Online/\u003C/a\u003E\u00A0tool by utilizing the greyscale heightmap.\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u0022KbroFCl.png\u0022 class=\u0022ipsImage\u0022 height=\u0022666\u0022 src=\u0022http://i.imgur.com/KbroFCl.png\u0022 width=\u00221000\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nAbove is a preview of one of the example bodies shown from Front, Left, Back, Right, Top \u0026amp; Bottom respectively to show the total lack of polar \u0027pinching\u0027.\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cu\u003E\u003Cstrong\u003EMini-guide\u003C/strong\u003E\u003C/u\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nBelow I will list the respective stages of the process within After Effects to allow for the easy use of the attached project above.\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cstrong\u003EPanel 1: Noise Layers\u003C/strong\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nIn this panel, you are required to generate the main features of the terrain by using multiple layers of fractal noise to build up a greyscale, rectangular base for your heightmap.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u0022QTK7eg4.png\u0022 class=\u0022ipsImage\u0022 height=\u0022562\u0022 src=\u0022http://i.imgur.com/QTK7eg4.png\u0022 width=\u00221000\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nAs you can see, in the example above I have layered 6 noise layers to create the shown effect. The parameters listed against the Fractal Noise effect can be changed to alter the generated noise to your liking with a dynamic preview being shown in the composition work space. Ensure to layer blend your multiple noise layers to obtain the result you desire.\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cstrong\u003EPanel 2: Polar Distortion\u003C/strong\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nThis panel requires no input by the user and simply takes the generated image from Panel 1 and applies the polar distortion required to create an even and consistent terrain distribution at the poles.\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cstrong\u003EPanel 3: Seam Blend for Heightmap\u003C/strong\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nThe source image from Panel 2 is shifted horizontally by half a phase to show the seam error in the center of the image space. The mask in this composition can be resized, the feather adjusted and the opacity altered etc. to try and completely remove the seam whilst maintaining a good transition in the terrain on either side. This process can be seen below:\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u0022BbSkt3Y.png\u0022 class=\u0022ipsImage\u0022 height=\u0022562\u0022 src=\u0022http://i.imgur.com/BbSkt3Y.png\u0022 width=\u00221000\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u0022OtPSVcT.png\u0022 class=\u0022ipsImage\u0022 height=\u0022562\u0022 src=\u0022http://i.imgur.com/OtPSVcT.png\u0022 width=\u00221000\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nThis finalizes the greyscale heightmap for your body.\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cstrong\u003EPanel 4: Colourization\u003C/strong\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nThe Colorama effect is applied to the source image from Panel 3 that allows you to create a gradient map that is directly proportional to the brightness of the texture. Many effects can be created here in the way that LUTs are used to colour terrain maps, realistically or not and even to reflect habitable Earth-like worlds.\n\u003C/p\u003E\n\u003Cp\u003E\nIn the example below a simple rocky style gradient has been applied.\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u0022en6LR0A.png\u0022 class=\u0022ipsImage\u0022 height=\u0022562\u0022 src=\u0022http://i.imgur.com/en6LR0A.png\u0022 width=\u00221000\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\n\u003Cstrong\u003EPanel 5: Spherical Preview\u003C/strong\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nIn this panel, you can rotate the colour map on the X, Y and Z axis (Y axis being the most useful) to give a real time preview of the body as a sphere.\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u0022Dd5QxY3.png\u0022 class=\u0022ipsImage\u0022 height=\u0022562\u0022 src=\u0022http://i.imgur.com/Dd5QxY3.png\u0022 width=\u00221000\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\n----------\n\u003C/p\u003E\n\u003Cp\u003E\nOnce you are happy with your terrain maps, simply\u00A0add Panel 3 and 4\u0027s composition frame to the render queue and generate your heightmap and colour map textures respectively. Ultimately, a Kopernicus config will be required to be written to use your textures to create the body within KSP.\n\u003C/p\u003E\n\u003Cp\u003E\n----------\n\u003C/p\u003E\n\u003Cp\u003E\nDisclaimer: I appreciate the fact this may not be a desirable way to generate terrain for use within KSP as basing your terrain of a heightmap texture can cause some rough, pixel\u0027y terrain at the pixel boundaries... especially on larger bodies. Nonetheless, PQSMods still remain a confusing matter to many people and this method may be \u0022good enough\u0022 for some to achieve the results they require. I post this up as a fleshed out proof of concept and nothing more.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222017-02-09T19:16:24Z\u0022 title=\u002202/09/2017 07:16  PM\u0022 data-short=\u00227 yr\u0022\u003EFebruary 9, 2017\u003C/time\u003E by Poodmund\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Poodmund","CreatedById":128643,"CreatedDateTime":"2017-01-21T16:21:53Z","Content":"\n\u003Cp\u003E\nUpon further interest I thought I would post the following:\n\u003C/p\u003E\n\u003Cp\u003E\nUsing the base heightmap texture for the terrain altitude generation is probably not sufficient for how you want your body to be in-game. Adjust the deformity value in the required Kopernicus config (tutorials can be found elsewhere on this forum, search \u0022Kopernicus Tutorial\u0022) to change the intensity of the difference in terrain altitude i.e.\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003EKopernicus\n{\n\tBody\n\tname = *body name*\n\t{\n\t\tPQS\n\t\t{\n\t\t\tMods\n\t\t\t{\n\t\t\t\tVertexHeightMap\n\t\t\t\t{\n\t\t\t\t\tmap = *texture path*\n\t\t\t\t\tdeformity = *value in meters*\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nI have posted below in the spoiler, the template config for the body as shown in the tutorial posted above for reference.\n\u003C/p\u003E\n\u003Cdiv class=\u0022ipsSpoiler\u0022 data-ipsspoiler=\u0022\u0022\u003E\n\u003Cdiv class=\u0022ipsSpoiler_header\u0022\u003E\n\u003Cspan\u003ESpoiler\u003C/span\u003E\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsSpoiler_contents\u0022\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\n\u003Cspan class=\u0022pln\u0022\u003E@Kopernicus:FOR[Test] \n{\n\tuseOnDemand = false\n\tBody\n\t{\n\t\tname = Test4\n\t\tfinalizeOrbit = true\n\t\tflightGlobalsIndex = 63614\n\t\tcacheFile = Test/Test4/Cache/test.bin\n\t\tTemplate\n\t\t{\n\t\t\tname = Moho\n\t\t\tremoveAllPQSMods = true\n\t\t}\n\t\tProperties\n\t\t{\n\t\t\tdescription = Test4\n\t\t\tradius = 150000   \n\t\t\tgeeASL = 0.5\n\t\t\trotates = true\n\t\t\trotationPeriod = 43200\n\t\t\ttidallyLocked = false\n\t\t\tinitialRotation = 0\n\t\t\talbedo = 0.2\n\t\t\temissivity = 0.9\n\t\t\tisHomeWorld = false\n\t\t\ttimewarpAltitudeLimits = 0 17000 34000 51000 85000 170000 340000 510000\n\t\t\tScienceValues\n\t\t\t{\n\t\t\t\tlandedDataValue = 8\n\t\t\t\tsplashedDataValue = 8\n\t\t\t\tflyingLowDataValue = 6\n\t\t\t\tflyingHighDataValue = 6\n\t\t\t\tinSpaceLowDataValue = 6\n\t\t\t\tinSpaceHighDataValue = 5\n\t\t\t\trecoveryValue = 5\n\t\t\t\tflyingAltitudeThreshold = 15000\n\t\t\t\tspaceAltitudeThreshold = 200000\n\t\t\t}\n\t\t\tbiomeMap = Test/Test4/PluginData/biome.png\n\t\t\tBiomes\n\t\t\t{\n\t\t\t\tBiome\n\t\t\t\t{\n\t\t\t\t\tname = Test4\n\t\t\t\t\tvalue = 1\n\t\t\t\t\tcolor = 0,0,0,1\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tOrbit\n\t\t{\n\t\t\treferenceBody = Sun\n\t\t\tcolor = 1,0.8,0.25,1\n\t\t\tinclination = 1\n\t\t\teccentricity = 0.03\n\t\t\tsemiMajorAxis = 6288300000\n\t\t\tlongitudeOfAscendingNode = 60\n\t\t\targumentOfPeriapsis = 0\n\t\t\tmeanAnomalyAtEpoch = 0\n\t\t\tepoch = 0\n\t\t}\n\t\tScaledVersion\n\t\t{\n\t\t\ttype = Vacuum\n\t\t\tfadeStart = 10000\n\t\t\tfadeEnd = 15000\n\t\t\tsphericalModel = False\n\t\t\tdeferMesh = False\n\t\t\tMaterial\n\t\t\t{\n\t\t\t\ttexture = Test/Test4/PluginData/test4_00.dds\n\t\t\t\tnormals = Test/Test4/PluginData/test4_01.png\n\t\t\t\tshininess = 0.0\n\t\t\t\tspecular = 0.0,0.0,0.0,1\n\t\t\t}\n\t\t}\n\t\tPQS\n\t\t{\n\t\t\tminLevel = 2\n\t\t\tmaxLevel = 6\n\t\t\tminDetailDistance = 6\n\t\t\tmaxQuadLengthsPerFrame = 0.03\n\t\t\tfadeStart = 15000\n\t\t\tfadeEnd = 20000\n\t\t\tdeactivateAltitude = 25000\n\t\t\tdeactivateAltitude = 115000\n\t\t\tMods\n\t\t\t{\n\t\t\t\tVertexHeightMap\n\t\t\t\t{\n\t\t\t\t\tmap = Test/Test4/PluginData/test4_heightmap.png\n\t\t\t\t\toffset = 0\n\t\t\t\t\tdeformity = 7000\n\t\t\t\t\tscaleDeformityByRadius = False\n\t\t\t\t\torder = 1524\n\t\t\t\t\tenabled = True\n\t\t\t\t}\n\t\t\t\tVertexColorMap\n\t\t\t\t{\n\t\t\t\t\tmap = Test/Test4/PluginData/test4_00.dds\n\t\t\t\t\torder = 60456\n\t\t\t\t\tenabled = True\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/div\u003E\n\u003Cp\u003E\nFinally, if you are having issues creating the normal map correctly, the mod \u003Cstrong\u003E\u003Ca href=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/140581-12-kopernicus-kittopiatech-a-kopernicus-visual-editor-23-october/\u0022 rel=\u0022\u0022\u003EKittopiaTech\u003C/a\u003E\u003C/strong\u003E can be used to generate the normal maps for you in-game. You can also adjust all the values and regenerate PQS mesh on the fly in-game which makes it a very handy and powerful tool to use when \u0027sculpting\u0027 your bodies.\n\u003C/p\u003E\n"},{"CreatedByName":"SmashingKirby148","CreatedById":130193,"CreatedDateTime":"2017-01-24T18:52:10Z","Content":"\n\u003Cp\u003E\nWoah! This is awesome!\n\u003C/p\u003E\n\u003Cp\u003E\nCalling \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/148627-the-white-guardian/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022148627\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/148627-the-white-guardian/\u0022 rel=\u0022\u0022\u003E@The White Guardian\u003C/a\u003E ! \u003Cimg alt=\u0022:D\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 title=\u0022:D\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"The White Guardian","CreatedById":148627,"CreatedDateTime":"2017-01-24T20:30:16Z","Content":"\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/130193-smashingkirby148/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022130193\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/130193-smashingkirby148/\u0022 rel=\u0022\u0022\u003E@SmashingKirby148\u003C/a\u003E while I do not have Adobe After Effects, I can easily replicate this in GIMP. Thank you \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/128643-poodmund/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022128643\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/128643-poodmund/\u0022 rel=\u0022\u0022\u003E@Poodmund\u003C/a\u003E for the creativity! \u003Cimg alt=\u0022:D\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 title=\u0022:D\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Gameslinx","CreatedById":144828,"CreatedDateTime":"2017-01-28T16:06:16Z","Content":"\n\u003Cp\u003E\nI can\u0027t work out how to do the polar inversion - you say it\u0027s easy and requires little input but google isn\u0027t returning anything useful for me apart from polar coordinates, which distorts the image differently to what yours looks like. If you could say how you managed to do this to your image, I would be greatful\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222017-01-28T17:34:57Z\u0022 title=\u002201/28/2017 05:34  PM\u0022 data-short=\u00227 yr\u0022\u003EJanuary 28, 2017\u003C/time\u003E by Gamel0rd1\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Poodmund","CreatedById":128643,"CreatedDateTime":"2017-02-09T19:56:35Z","Content":"\n\u003Cp\u003E\nThe Polar Distortion panel requires no input. It literally takes the composition from the Noise Layers panel, does a Polar Coordinates distortion twice (top and bottom), linearly wipes them towards the center to transparent and fudges it around a little to get a spherically wrappable image. i.e. take a look at a grid... its goes from this:\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u0022heG1bzd.png\u0022 class=\u0022ipsImage\u0022 height=\u0022500\u0022 src=\u0022http://i.imgur.com/heG1bzd.png\u0022 width=\u00221000\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\n... to this:\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u00223mli27T.png\u0022 class=\u0022ipsImage\u0022 height=\u0022500\u0022 src=\u0022http://i.imgur.com/3mli27T.png\u0022 width=\u00221000\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nLets take a look at a real example going through this process. Flat noise image:\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u0022tkCZNgf.png\u0022 class=\u0022ipsImage\u0022 height=\u0022500\u0022 src=\u0022http://i.imgur.com/tkCZNgf.png\u0022 width=\u00221000\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nPolar Distorted image:\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u0022dhpZ0tQ.png\u0022 class=\u0022ipsImage\u0022 height=\u0022500\u0022 src=\u0022http://i.imgur.com/dhpZ0tQ.png\u0022 width=\u00221000\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nThis Polar Distortion 2nd Panel should need no user input. It does this process automatically. Does this help?\n\u003C/p\u003E\n\u003Cp\u003E\nEDIT: In the uploaded After Effects file, I think I may have had the central region rotated to 180 degrees in the Polar Distortion panel... it shouldn\u0027t really matter but if you want to reset it back to 0, look in the image below as to how to do this:\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u0022lz6Q2LA.png\u0022 class=\u0022ipsImage\u0022 height=\u0022562\u0022 src=\u0022http://i.imgur.com/lz6Q2LA.png\u0022 width=\u00221000\u0022\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222017-02-09T20:04:50Z\u0022 title=\u002202/09/2017 08:04  PM\u0022 data-short=\u00227 yr\u0022\u003EFebruary 9, 2017\u003C/time\u003E by Poodmund\u003C/strong\u003E\n\u003C/span\u003E\n"}]}