{"TopicId":140794,"ForumId":15,"TopicTitle":"Adding Fog/Smoke/Clouds","CreatedByName":"jmbon","CreatedById":87472,"CreatedDateTime":"2016-05-30T03:22:51Z","PageNum":1,"Articles":[{"CreatedByName":"jmbon","CreatedById":87472,"CreatedDateTime":"2016-05-30T03:22:51Z","Content":"\n\u003Cp\u003E\nHello,\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0 \u00A0I\u0027m rather new to modding KSP and Unity in general. I am attempting to add fog and clouds to KSP and I have really no clue where to begin. I\u0027ve searched Google high and low as well as the forums and all I could find is incomplete code snippets so small that they really don\u0027t help much. If someone has the time and knowledge, would you lend me a hand. Below is my code so far. I think I am on the right track with making a gameobject, assigning it\u0027s .maintexture to be my texture I choose, adding a mesh, creating vertices, triangles, etc. but I really have no idea if this is correct and if it is, where do I go now.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003Eusing System;\nusing System.IO;\nusing System.Collections;\n\nusing UnityEngine;\nusing KSP;\n\nnamespace Clouds\n{\n    public class Clouds_Main : MonoBehaviour\n    {\n        bool debug_output = false;\n        Texture2D white_clouds = null, storm_clouds = null;\n        private float lastFixedUpdate = 0.0f, logInterval = 2.5f;\n\n        Mesh light_cloud_mesh = new Mesh();\n        Mesh dark_cloud_mesh = new Mesh();\n\n        public Material light_cloud_material;\n        public Material dark_cloud_material;\n\n        GameObject dark_cloud_gameObject;\n        GameObject light_cloud_gameObject;\n\n\n\n        /* Caution: as it says here: http://docs.unity3d.com/Documentation/ScriptReference/MonoBehaviour.Awake.html,\n         use the Awake() method instead of the constructor for initializing data because Unity uses\n        Serialization a lot. */   \n\n        /* Called after the scene is loaded. */\n        void Awake()\n        {\n            if (white_clouds == null)\n                white_clouds = LoadPNG(@\u0022C:\\Program Files (x86)\\Steam\\SteamApps\\common\\Kerbal Space Program\\GameData\\Wind Mod\\S_Cloud4.png\u0022); // Load the S_Cloud4.png Icon image into memory\n            if (storm_clouds == null)\n                storm_clouds = LoadPNG(@\u0022C:\\Program Files (x86)\\Steam\\SteamApps\\common\\Kerbal Space Program\\GameData\\Wind Mod\\D_Cloud1.png\u0022); // Load the D_Cloud1.png Icon image into memory\n\n            light_cloud_material.SetTexture(0, white_clouds);\n            dark_cloud_material.SetTexture(1, storm_clouds);\n\n        }\n\n        /* Called next. */\n        void Start()\n        {\n            dark_cloud_gameObject.AddComponent\u003C/span\u003E\u003Cspan class=\u0022tag\u0022\u003E\u0026lt;MeshRenderer\u0026gt;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E().material.mainTexture = dark_cloud_material.GetTexture(1);\n            dark_cloud_mesh = dark_cloud_gameObject.AddComponent\u003C/span\u003E\u003Cspan class=\u0022tag\u0022\u003E\u0026lt;MeshFilter\u0026gt;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E().mesh;\n            dark_cloud_mesh.Clear();\n            dark_cloud_mesh.vertices = new Vector3[] { new Vector3(-0.5f, 0, -0.5f), new Vector3(0.5f, 0, -0.5f), new Vector3(0.5f, 0, 0.5f), new Vector3(-0.5f, 0, 0.5f) };\n            dark_cloud_mesh.uv = new Vector2[] { new Vector2(0, 0), new Vector2(0, 1), new Vector2(1, 1), new Vector2(1, 0) };\n            dark_cloud_mesh.triangles = new int[] { 0, 1, 2, 2, 3, 0 };\n\n\n            light_cloud_gameObject.AddComponent\u003C/span\u003E\u003Cspan class=\u0022tag\u0022\u003E\u0026lt;MeshRenderer\u0026gt;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E().material.mainTexture = light_cloud_material.GetTexture(0);\n            light_cloud_mesh = light_cloud_gameObject.AddComponent\u003C/span\u003E\u003Cspan class=\u0022tag\u0022\u003E\u0026lt;MeshFilter\u0026gt;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E().mesh;\n            light_cloud_mesh.Clear();\n            light_cloud_mesh.vertices = new Vector3[] { new Vector3(-0.5f, 0, -0.5f), new Vector3(0.5f, 0, -0.5f), new Vector3(0.5f, 0, 0.5f), new Vector3(-0.5f, 0, 0.5f) };\n            light_cloud_mesh.uv = new Vector2[] { new Vector2(0, 0), new Vector2(0, 1), new Vector2(1, 1), new Vector2(1, 0) };\n            light_cloud_mesh.triangles = new int[] { 0, 1, 2, 2, 3, 0 };\n\n\n\n        }\n\n        /*  Called every frame */\n        void Update()\n        { \n        \n        \n        }\n\n        /* Called at a fixed time interval determined by the physics time step. */\n        void FixedUpdate()\n        {\n            if ((Time.time - lastFixedUpdate) \u0026gt; logInterval)\n            {\n\n            }\n        }\n\n        /* Called when the game is leaving the scene (or exiting). Perform any clean up work here. */\n        void OnDestroy()\n        { }\n\n\n        Texture2D LoadPNG(string filePath) // Converts a .png image into a BYTE array that Unity needs in order to display as a GUI image\n        {\n            Texture2D temp_texture = null; // Ensure the texture is always reset\n            byte[] fileData;\n\n            if (File.Exists(filePath))\n            {\n                fileData = File.ReadAllBytes(filePath);\n                temp_texture = new Texture2D(2, 2);\n                temp_texture.LoadImage(fileData); //..this will auto-resize the texture dimensions.\n            }\n            else\n            {\n                if (debug_output)\n                    Debug.Log(\u0022[WIND MOD : Gui Draw] Icon file does not exist in location: \u0022 \u002B filePath);\n            }\n            return temp_texture;\n        }\n    }\n}\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nI would greatly appreciate any help you can give. Thanks in advance.\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"SpannerMonkey(smce)","CreatedById":50907,"CreatedDateTime":"2016-05-30T23:52:27Z","Content":"\n\u003Cp\u003E\n\u003Cimg class=\u0022ipsImage\u0022 src=\u0022http://i.imgur.com/TqOVxRN.png\u0022 alt=\u0022TqOVxRN.png\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nHi it\u0027s already been done of course , I\u0027d imagine that looking through the source for this mod will tell you all you need to know\n\u003C/p\u003E\n\u003Ciframe data-embedcontent=\u0022\u0022 frameborder=\u00220\u0022 src=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/51142-1121-1-2-may-13-2016-environmentalvisualenhancements/\u0026amp;do=embed\u0022\u003E\u003C/iframe\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n"}]}