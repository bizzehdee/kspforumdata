{"TopicId":100533,"ForumId":15,"TopicTitle":"Query on Center of Mass and thrustTransforms in Unity","CreatedByName":"MLWostal","CreatedById":134330,"CreatedDateTime":"2015-02-23T17:36:47Z","PageNum":1,"Articles":[{"CreatedByName":"MLWostal","CreatedById":134330,"CreatedDateTime":"2015-02-23T17:36:47Z","Content":"Silly question most likely but...\n\nIs the Center of Mass in KSP calculated by model shape or is it pulled from the mesh that was setup in Unity?\n\nTo clarify, if needed, if I have just a bar and set the CoM of it to one end \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_ ^ with the Y pointing up like in the silly text, will it fly straight or spin out of control? The CoM is perfectly inline with the thrustTransform.\n\nAsking because I have a model that does that but not sure where the error lies. CoM of the model is close (I thought). Unity is set correctly about 0 for thrustTransform, yet the ship spins out of control with even the slightest acceleration."},{"CreatedByName":"CaptainKipard","CreatedById":70516,"CreatedDateTime":"2015-02-23T19:06:40Z","Content":"The center of mass is located at the root game object, so it\u0027s done in Unity. You can, if you know how to, calculate the center of mass of an object in Blender, and then place the root object at that location relative to the mesh, but IIR that function treats models as solid objects. It\u0027s a good enough approximation though.\n\nThe bar in your example is likely to spin around in weird ways, a bit like the stock landing legs do.\n\nI usually set my mesh origin to be at the center of mass of the object in Blender so I can place the mesh at 0,0,0 of the root game object in unity."},{"CreatedByName":"MLWostal","CreatedById":134330,"CreatedDateTime":"2015-02-23T22:44:52Z","Content":"Trouble is, I\u0027ve always set the CoM at 0,0,0 in Blender. The models are oddly shaped so I create a box, move to 0,0,0. Join the meshes to it and them break the connection. \n\nThat assinine \u0027click here to set the cursor\u0027 (a million miles away sometimes) is useless (to me at least). Why the heck is there no \u0027Set origin to 0\u0027 feature. \n\n/rant off\n\nBut it seems not to matter what the heck I do in Blender. Unity moves the centers and, when creating a new \u0027gameobject\u0027 for say, thrustTransforms, it\u0027s not at Zero or close to the parent objects coords. Moving it to 0,0,0 sets it at odd locations.\n\nAbout to give up and stick to a simple cylinder. Seems that\u0027s all I\u0027m getting correct lately.\n\n**Edited \u003Ctime datetime=\u00222015-02-23T22:49:24Z\u0022 title=\u002202/23/2015 10:49  PM\u0022 data-short=\u00229 yr\u0022\u003EFebruary 23, 2015\u003C/time\u003E by MLWostal**"},{"CreatedByName":"CaptainKipard","CreatedById":70516,"CreatedDateTime":"2015-02-23T23:22:51Z","Content":"\u003E \n\u003E Trouble is, I\u0027ve always set the CoM at 0,0,0 in Blender. The models are oddly shaped so I create a box, move to 0,0,0. Join the meshes to it and them break the connection.\n\nI don\u0027t know what this means.\n\n\u003E \n\u003E That assinine \u0027click here to set the cursor\u0027 (a million miles away sometimes) is useless (to me at least). Why the heck is there no \u0027Set origin to 0\u0027 feature. \n\u003E /rant off\n\nAgain I\u0027m not sure what you\u0027re getting at here. The tool shelf has a number of options for setting the origin and the cursor dialogue can, among other things, move the cursor to 0,0,0 in global space.\n\n\u003E \n\u003E But it seems not to matter what the heck I do in Blender. Unity moves the centers and, when creating a new \u0027gameobject\u0027 for say, thrustTransforms, it\u0027s not at Zero or close to the parent objects coords. Moving it to 0,0,0 sets it at odd locations.\n\u003E About to give up and stick to a simple cylinder. Seems that\u0027s all I\u0027m getting correct lately.\n\nEach object in the hierarchy has a position in relation to its parent. The root empty game object (the one where you add parttools) can be anywhere, but the child objects of it have to be in specific places. If you set the origin of your mesh objects correctly in Blender, then childing them in Unity and moving their relative position to 0,0,0 will put them in the right place."},{"CreatedByName":"MLWostal","CreatedById":134330,"CreatedDateTime":"2015-02-24T07:42:03Z","Content":"I do apologize. My frustration level with learning Blender and Unity is showing and I should not have let it slip through my question.\n\nI created a object composed of a number of meshes. They are individual to keep the poly count down for collision boxes in Unity, but share a only a few textures. That also means that there are a lot of Center of Masses. I\u0027ve tried to use the cursor object and set CoM at cursor location but is difficult to me. If I\u0027m not clicking on an object, the cursor object (forget what it\u0027s called, sorry) seems to never be where I want it. Usually, it\u0027s meters below and to the side of the actual 0,0,0 location.\n\nTo deal with that, I create a box, move it to 0,0,0 for CoM and then join the object I\u0027ve created to it. This effectively sets its CoM to 0,0,0 as well. Or, so I though.\n\nWhen I load my object into Unity, it puts the CoM within the individual objects again and forces me to \u0027quess\u0027 as to the correct location to balance thrust. On top of that, when I create a \u0027gameobject\u0027 empty container and child it to anything, it is not inheriting the parents location. It is offset by some amount and moving it, either by mouse or by pasting numbers, it does not seem to line up correctly. Under thrust in KSP, the objects spin uncontrollably.\n\nI know the issue is with me. How I\u0027m doing it, that is. I just don\u0027t know where I\u0027m going wrong. Blender is new to me, just about a month or so using it but I\u0027m not new to 3d modeling, started in 1985 ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif) I\u0027m just looking for ideas or thoughts from the more experienced Blender users and did not mean to confuse or irritate anyone. trueSpace, the last 3d software I used, had a simple \u0027Set Axis\u0027 command. You just clicked the option and moved/set the objects origin to where ever you wanted it. I have not found that option in Blender and I have looked. But, I am not perfect and may have missed it."},{"CreatedByName":"CaptainKipard","CreatedById":70516,"CreatedDateTime":"2015-02-24T19:21:34Z","Content":"\u003E \n\u003E I created a object composed of a number of meshes. They are individual to keep the poly count down for collision boxes in Unity, but share a only a few textures. That also means that there are a lot of Center of Masses.\n\nI can\u0027t help you if you don\u0027t use correct terms. This statement doesn\u0027t make sense. I think you\u0027re confused about what objects are."},{"CreatedByName":"MLWostal","CreatedById":134330,"CreatedDateTime":"2015-02-24T20:54:15Z","Content":"Stupidity and childishness is no reason to insult anyone. \n\nI was both.\n\n**Edited \u003Ctime datetime=\u00222015-02-26T00:42:44Z\u0022 title=\u002202/26/2015 12:42  AM\u0022 data-short=\u00229 yr\u0022\u003EFebruary 26, 2015\u003C/time\u003E by MLWostal**"},{"CreatedByName":"CaptainKipard","CreatedById":70516,"CreatedDateTime":"2015-02-25T13:43:34Z","Content":"I\u0027m more interested in helping you than I am in thinly veiled insults. If you want to convey meaning, then use correct words. I\u0027m not a mind reader and spending time trying to interpret what you\u0027re saying is beyond acceptable to me. I\u0027m doing all of this for free and not asking for anything except a little clarity in your only method of communication."},{"CreatedByName":"MLWostal","CreatedById":134330,"CreatedDateTime":"2015-02-25T21:40:49Z","Content":"Hopefully, the following pic will clear up my terms.\n\n![i225qs.jpg](%5Bimg%5Dhttp%3A//i62.tinypic.com/i225qs.jpg)\n\nIf I group all the individual meshes (my term) into just one and load into Unity, it works but it is a static file. No animations will work this way or at least none that I can make.\n\nIn Unity 4.6.., the version I was using until recently due to my need for emissives, adding a gameobject always put the empty structure below the currently selected object. Say for example in the pic above, adding a thrustTransform to the engine nozzle. The thrustTransform would be centered exactly where the parent \u0027nozzle\u0027 was.\n\nNow, using Unity 4.2.2, again, for emissives, the gameobject does not take the parents information. Instead, it is created at the root of the hierarchy structure and I must move it down manually to the correct location to be a child of the parent structure. This moving seems to be causing an issue as now, the gameobject must be changed to match the parent and in doing so, seems to offset the gameobject. In the case above (forgive the bad textures and subject matter please) the thrustTransform I would create just behind the Nozzle would infact cause the ship to spin uncontrollably. This is after setting every object not animated to have a \u00270,0,0\u0027 location. \n\nI am at a loss as to what I am doing wrong and any help would be greatly appreciated. I also hope this clears up at least some of the\n\n**Edited \u003Ctime datetime=\u00222015-02-25T21:45:36Z\u0022 title=\u002202/25/2015 09:45  PM\u0022 data-short=\u00229 yr\u0022\u003EFebruary 25, 2015\u003C/time\u003E by MLWostal**"},{"CreatedByName":"sumghai","CreatedById":66272,"CreatedDateTime":"2015-02-25T22:42:40Z","Content":"Is the spaceship meant to be available in the VAB as a single, combined \u0022part\u0022? If so, you can define multiple animations in Blender, configure them in Unity, and then use a plugin like Firespitter to toggle each animation independently (the stock animation module can only support one persistent animation per part).\n\nAssuming you\u0027re going for the \u0022ship as one part\u0022 route, I suggest making the entire ship\u0027s CoM at 0,0,0 and aligning the thrust transforms along the appropriate axis:\n\n**1) Press Shift-S to open up the snap menu, and Select Cursor to Center**\n\n**2) For each mesh, move it to the desired position, and then permanently afix it relative to 0,0,0 (Crtl-A \u003E Location -and- Ctrl-A \u003E Rotation \u0026 Scale)**\n\nWhen you re-import your one-piece spaceship into Unity, all the meshes will be in the correct position relative to the new CoM of 0,0,0 and you should be able to add the thrustTransform without worrying about off-center thrust."},{"CreatedByName":"MLWostal","CreatedById":134330,"CreatedDateTime":"2015-02-25T23:38:29Z","Content":"Thank you for the information. I had no idea that \u0027Select cursor to Center\u0027 even existed. Much to learn about Blender. It\u0027s VERY different from the program (called Caligari and trueSpace) I have used for almost 20 years. Solid modeler and useless now-a-days.\n\nSo, Select cursor to Center and then Object, transform, then Origin to 3d Cursor will do what I have been fighting with. \n\nThe ship does have animations and I want to do emissives. Have not figured out how to do both on the same model/object/mesh/really not sure what it\u0027s called. So I can\u0027t just group all. There needs to be separate parts (I think) and because of that, Unity throws the center of mass off and the darned ship tumbles stern over bow, even on the lowest settings.\n\nAs a single entity in Unity, then the CoM stays and the ship works but not the way it should.\n\nAnimation for the Landing leg in the rear, animation for the thrust vector change and an emissive for the large nozzle on the stern. Am I asking one item (ship loaded as one part in the VAB) to do too much?"},{"CreatedByName":"sumghai","CreatedById":66272,"CreatedDateTime":"2015-02-25T23:56:38Z","Content":"\u003E \n\u003E As a single entity in Unity, then the CoM stays and the ship works but not the way it should.\n\u003E Animation for the Landing leg in the rear, animation for the thrust vector change and an emissive for the large nozzle on the stern. Am I asking one item (ship loaded as one part in the VAB) to do too much?\n\nPersonally, not at all.\n\nMy FusTek Station Parts has a set of IACBM docking ports, each of which have *three* animations per part that can be controlled independently:\n\n - One animation to rotate the docking fins between passive (X) and active (\u002B) positions\n\n - One animation to turn on/off the red \u0026 white docking lights (emissives plus actual light sources)\n\n - One animation to show/hide a FusTek standard yellow-rimmed hatch (the IACBM usually fits directly over existing hatches on FusTek modules, but stock crew tanks don\u0027t have hatches on their ends, so a retrofit option is provided)\n\nIn your case, you can import each animation from Blender into Unity separately, save it as separate .anim files, and add each to the exported part\u0027s list of animations:\n\n - The landing gear animation can use the stock ModuleLandingGear (if it has wheels) or ModuleLandingLeg (if not)\n\n - Is the emissive for lighted windows, the engine glow, or a headlight?\n\n - Is the thrust vector change a simple gimbal (in which case an animation is not even needed), or is it for VTOL?"},{"CreatedByName":"MLWostal","CreatedById":134330,"CreatedDateTime":"2015-02-26T00:40:25Z","Content":"Export each animation as a separate animation...... um.... Lost me there. If the animation is created in blender, it\u0027s still exportable in Unity as an animation file?\n\nThe landing leg is just that. A simple landing pad that, if I ever figure out the way to do it, will be a hinged leg and spring to dampen the landing. But that can wait right now as I can\u0027t even get to a point where landing is feasible. :/\n\nThis is a steampunk ship I saw and wanted to try recreating it for KSP so it needs VTOL to actually work. I\u0027ve gotten VTOL to work, barely, but crashing every time is getting old. ![:(](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_sad.gif) The ship cartwheels no matter what I do to the thrustTransforms. That is why I asked how the CoM is set. If it\u0027s a single body in KSP, is it still using CoMs from all the individual parts in Unity/Blender or will the CoM for thrust be centerline to the engine.\n\nThe main engine is centerline and almost all of the ship can be joined in Blender as one but the landing leg cannot due to the animation. So, is Unity/KSP averaging the CoM of the entire ship between the main ship and the landing leg or will it take just the CoM I\u0027ve set?\n\nThe VTOL will rotate slowly and line up with the main nozzle but Unity seem to keep throwing it off. Since the lineup for main thrust is at the end of the animation sequence, it\u0027s rather difficult to get to that stage to set it. I run the animation in the scene window and when it stops, then I set the thrustTransform for the main engine. Am I being an idiot and doing it all wrong?"},{"CreatedByName":"sumghai","CreatedById":66272,"CreatedDateTime":"2015-02-26T01:11:00Z","Content":"\u003E \n\u003E Export each animation as a separate animation...... um.... Lost me there. If the animation is created in blender, it\u0027s still exportable in Unity as an animation file?\n\nUnity has an Animation editor to allow you to edit/save individual animation clips, which are stored as .anim files. \n\nYou would then add an Animation component to the root level of your one-part spaceship, and within it you list the .anim files that you want to later export to .MU along with the model itself.\n\n\u003E \n\u003E This is a steampunk ship I saw and wanted to try recreating it for KSP so it needs VTOL to actually work.\n\nI see.\n\nVTOLs are IMHO tricky to make with stock parts, so I\u0027d imagine it to be even worse for an integrated mod part.\n\n\u003E \n\u003E I\u0027ve gotten VTOL to work, barely, but crashing every time is getting old. ![:(](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_sad.gif) The ship cartwheels no matter what I do to the thrustTransforms. That is why I asked how the CoM is set. If it\u0027s a single body in KSP, is it still using CoMs from all the individual parts in Unity/Blender or will the CoM for thrust be centerline to the engine.\n\u003E The main engine is centerline and almost all of the ship can be joined in Blender as one but the landing leg cannot due to the animation. So, is Unity/KSP averaging the CoM of the entire ship between the main ship and the landing leg or will it take just the CoM I\u0027ve set?\n\u003E \n\u003E The VTOL will rotate slowly and line up with the main nozzle but Unity seem to keep throwing it off. Since the lineup for main thrust is at the end of the animation sequence, it\u0027s rather difficult to get to that stage to set it. I run the animation in the scene window and when it stops, then I set the thrustTransform for the main engine. Am I being an idiot and doing it all wrong?\n\nBasically, for a single part (or in your case, your single part ship) KSP ***doesn\u0027t care*** how many submeshes you have or where they are located - it will ***always*** use Blender\u0027s global 0,0,0 as the CoM of the entire part (unless you fiddle with CoMOffset in the CFG, but that\u0027s another story).\n\nYour off-center thrust issue has two possible causes:\n\n - If the cartwheeling occurs during level flight, you haven\u0027t aligned the thrustTransform along the appropriate global axis\n\n - If the cartwheeling occurs during takeoff, where you\u0027re rotating the thrustTransform via animation while the engine is throttled up, then of course it will flip over because of unbalanced thrust:\n\n    \u002B is craft CoM\u003C and ^ are thrustTransform / rocket nozzle orientations(          )(          )\u002B-------\u003C(          )Nozzle is pointing at in line with CoM, spaceship flies level and forward(          )(          )\u002B-------^(          )Nozzle is not pointing at or in line with CoM, a moment is created around CoM, about which the spaceship will rotate and cartwheel\n\nIf the above is the case, then you will need to redesign your spaceship to have a front engine to offset the rotational moment caused by case 2."},{"CreatedByName":"MLWostal","CreatedById":134330,"CreatedDateTime":"2015-02-26T01:53:11Z","Content":"Oh, I expect it to pitch a little bit during the thrust rotation. But the silly thing does it at liftoff. \n\nYour explanation of the anim files helps me a great deal. I have another ship, a Jupiter 2 model that I\u0027ve made in 4 parts due to the animation needs. I used the 2 engine setup on it to prevent the pitch, one for lift the other for forward flight, but it can be cumbersome to fly. Now, I can go back and even correct that thing though it does work perfectly as is, a simpler design would be nice. ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif) Thank you for that.\n\nI\u0027ve not even seen anyway to create a true VTOL using stock parts but yeah, VTOLs are tricky to balance.\n\nThe issue I\u0027m having MUST be coming from Unity and some screwup I\u0027ve done. Going to try again, starting from scratch, and see if works correctly or at least better, this time."},{"CreatedByName":"CaptainKipard","CreatedById":70516,"CreatedDateTime":"2015-02-26T05:57:37Z","Content":"If you want all your legs to have suspensions they will need to be separate parts. It\u0027s a KSP limitation.\n\nAbout \u0022Objects\u0022. Everything you can select separately in Blender in object mode is an object. Meshes in edit mode are called meshes even if they\u0027re not connected. An object can have one or more separate meshes. Other things like empties and lights and cameras are also objects. The same terminology applies in Unity\n\n**Edited \u003Ctime datetime=\u00222015-02-26T06:01:42Z\u0022 title=\u002202/26/2015 06:01  AM\u0022 data-short=\u00229 yr\u0022\u003EFebruary 26, 2015\u003C/time\u003E by Cpt. Kipard**"},{"CreatedByName":"MLWostal","CreatedById":134330,"CreatedDateTime":"2015-02-26T07:48:29Z","Content":"Ah, I see the confusion. I always thought the full output, the entire finished model, was the Object. The individual parts in the modeling software was just a mesh and nothing more. Self-taught has some major disadvantages.\n\nThe landing leg, for the present, will be static. Just sitting there until all the other issues are sorted out. The reference pic I\u0027m using to create the model appears to have 2 types of springs, no pistons. One on the geared section and on on the actual foot pad. Hope that\u0027s doable. If not, then just a single spring will have to do.\n\nAnd thanks for not calling me a total idiot. I\u0027m only mostly there so there is hope for me. :/"},{"CreatedByName":"MLWostal","CreatedById":134330,"CreatedDateTime":"2015-02-28T04:42:50Z","Content":"Okay, you were right. VTOL is NOT easy, especially for a novice like myself with Unity.\n\nBack to the drawing boards but, if anything, this has all taught me much more about Blender and Unity.\n\nNow, if I could just understand groups in blender, animations might be easier. Oh well, back to the Blender app ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\nDoes KSP and or Unity support Parent/child and Groups? \n\nAnimating each individual component is rather bothersome at times. trueSpace had a hierarchical setup to joined items. IE, you could join as one but still access all submeshes. Seems parent/child does the same thing (kinda) and wonder how KSP likes it.\n\n**Edited \u003Ctime datetime=\u00222015-02-28T06:10:44Z\u0022 title=\u002202/28/2015 06:10  AM\u0022 data-short=\u00229 yr\u0022\u003EFebruary 28, 2015\u003C/time\u003E by MLWostal**"},{"CreatedByName":"CaptainKipard","CreatedById":70516,"CreatedDateTime":"2015-02-28T09:12:06Z","Content":"I\u0027ve never had to use or even encountered \u0022groups\u0022. Blender supports hierarchical relationships too, and you can even import them into Unity but I do all of that in Unity unless an animation is involved.\n\nI\u0027m assuming you want an object to animate a set of other objects? If that\u0027s it then select the object you want as the child, then select the one you want as the parent and press Ctrl\u002BP and choose an option. I tend to go with \u0022keep transform\u0022. You do that for each individual relationship.\n\nThere\u0027s no grouping of which I\u0027m aware but you can select more then one potential child, one by one, and finally the potential parent, and press Ctrl\u002BP. Those relationships are still individual, it\u0027s just that you made them all at once."},{"CreatedByName":"MLWostal","CreatedById":134330,"CreatedDateTime":"2015-02-28T16:40:26Z","Content":"Thanks. The more I use Blender, the more I find in common with trueSpace, just it\u0027s done/called differently. That is most of my issue. As you pointed out earlier, proper names, and Blender changed them all on me. ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\nThe animation is rather complicated and parent/child seems the way to go for now."}]}