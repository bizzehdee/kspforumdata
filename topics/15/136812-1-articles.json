{"TopicId":136812,"ForumId":15,"TopicTitle":"Importing animations","CreatedByName":"v1per","CreatedById":115406,"CreatedDateTime":"2016-04-13T02:07:08Z","PageNum":1,"Articles":[{"CreatedByName":"v1per","CreatedById":115406,"CreatedDateTime":"2016-04-13T02:07:08Z","Content":"\n\u003Cp\u003E\nI\u0027m stumped on this one and hoping someone can shed some light on this. First of all, let me start by saying that my Unity knowledge is limited to just importing models, setting up materials and exporting to Kerbal. This is the first time that I\u0027m trying something a bit more advanced so maybe I\u0027m missing a step. So here\u0027s my issue:\n\u003C/p\u003E\n\u003Cp\u003E\nI create a model with an animation. I import it into Unity via FBX and set up the animation to Legacy. Give it a name, set up part tools, add materials, colliders and export. So far it all works.\n\u003C/p\u003E\n\u003Cp\u003E\nBut then, when I start the game, it just hangs loading the part. Here\u0027s the error log:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode\u0022\u003E\n[LOG 22:51:42.801] DragCubeSystem: Creating drag cubes for part \u0027im.test\u0027\n[EXC 22:51:42.858] NullReferenceException: Object reference not set to an instance of an object\n\tModuleDeployableSolarPanel.AssumeDragCubePosition (System.String name)\n\tDragCubeSystem\u002B\u0026lt;RenderDragCubes\u0026gt;c__IteratorC.MoveNext ()\n[EXC 22:52:30.082] InvalidOperationException: Steamworks is not initialized.\n\tSteamworks.InteropHelp.TestIfAvailableClient ()\n\tSteamworks.SteamController.Shutdown ()\n\tSteamController.KSPSteamController.OnDestroy ()\u003C/pre\u003E\n\u003Cp\u003E\nI tried this with Unity 5.3, 5.2 and with 4.2 as well. All with the same result. I\u0027m trying this with the 1.1 Pre Release of Kerbal.\n\u003C/p\u003E\n\u003Cp\u003E\nAny help is appreciated. If there\u0027s any more info needed, let me know and I\u0027ll post ASAP.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-04-13T02:08:10Z\u0022 title=\u002204/13/2016 02:08  AM\u0022 data-short=\u00228 yr\u0022\u003EApril 13, 2016\u003C/time\u003E by v1per\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"nli2work","CreatedById":106805,"CreatedDateTime":"2016-04-13T02:35:01Z","Content":"\n\u003Cp\u003E\ndoesn\u0027t look related to animation... but problem with valid dragCube for the part.\n\u003C/p\u003E\n"},{"CreatedByName":"v1per","CreatedById":115406,"CreatedDateTime":"2016-04-13T03:00:27Z","Content":"\n\u003Cp\u003E\nA quick search on dragCubes didn\u0027t shed much light on this. If I export the same part without the animation it loads fine.\n\u003C/p\u003E\n"},{"CreatedByName":"nli2work","CreatedById":106805,"CreatedDateTime":"2016-04-13T04:46:56Z","Content":"\n\u003Cp\u003E\nlooks like the MU couldn\u0027t load, you\u0027ll have to find the relevant error messages, either in KSP.log or in Unity Console. Since it\u0027s animation related, I\u0027d start checking in Unity Console. CTRL-SHIFT-C in Unity, then export your model and see if any error messages come up. If not, load up KSP and search KSP.log for any errors related to your MU file.\n\u003C/p\u003E\n\u003Cp\u003E\nthis thread may help if you find error messages\n\u003C/p\u003E\n\u003Ciframe data-embedcontent=\u0022\u0022 frameborder=\u00220\u0022 src=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/97715-trouble-shooting-thread/\u0026amp;do=embed\u0022\u003E\u003C/iframe\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"v1per","CreatedById":115406,"CreatedDateTime":"2016-04-13T14:55:22Z","Content":"\n\u003Cp\u003E\nThe only error I can find is the one that I already posted. Unity is compiling the model just fine without errors on console. The animation even works inside Unity if I hit play and click on the part.\n\u003C/p\u003E\n\u003Cp\u003E\nI thought maybe it was something to do with the bones that I used to animate the part, but I tried exporting a simple cube with an animation and I hit the same issue with it.\n\u003C/p\u003E\n"},{"CreatedByName":"nli2work","CreatedById":106805,"CreatedDateTime":"2016-04-13T15:05:33Z","Content":"\n\u003Cp\u003E\nthere\u0027s an error message if KSP hangs loading your part, you just haven\u0027t looked in the right place.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nif you\u0027re attempting to load\u00A0\u0022im.test\u0022 as the part model I expect that would be prolematic. all KSP models are *.MU. your error message in OP is NullRef when attempting to create dragCube for \u0022im.test\u0022. that means whatever \u0022im.test\u0022 is, it isn\u0027t in memory when KSP is generating dragCubes. The relevant error is likely earlier in the load process when KSP is loading the actual models.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-04-13T15:36:03Z\u0022 title=\u002204/13/2016 03:36  PM\u0022 data-short=\u00228 yr\u0022\u003EApril 13, 2016\u003C/time\u003E by nli2work\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"v1per","CreatedById":115406,"CreatedDateTime":"2016-04-13T20:21:17Z","Content":"\n\u003Cp\u003E\nAs I understand it, im.test is the name of the dragcube object that KSP creates when loading the part. The name of the actual file is test.mu.\n\u003C/p\u003E\n\u003Cp\u003E\nAnd if there\u0027s somewhere else that I could look for an error, I\u0027m all ears. I lost the better part of a day trying to find what the issue is. All I know so far is that if I export an object without animation, everything works fine. The moment I add some kind of animation, the game hangs on load. Maybe it\u0027s 3ds max that is exporting it with something that\u0027s not supposed to, but I doubt it.\n\u003C/p\u003E\n"},{"CreatedByName":"nli2work","CreatedById":106805,"CreatedDateTime":"2016-04-13T22:09:13Z","Content":"\n\u003Cp\u003E\nyou have to post your logs then. I have no idea where and how you\u0027re looking. The error message in the OP simply means \u0022im.test\u0022 isn\u0027t in memory when KSP is attempting to generate dragCube for that part.\u00A0Delete KSP.log in the root, then run KSP till it hangs. ALT-F4, then search KSP.log for test.mu; there should be at least 4~6\u00A0entries. one of them would likely contain the error message you need to figure out what\u0027s wrong.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-04-14T00:41:12Z\u0022 title=\u002204/14/2016 12:41  AM\u0022 data-short=\u00228 yr\u0022\u003EApril 14, 2016\u003C/time\u003E by nli2work\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"v1per","CreatedById":115406,"CreatedDateTime":"2016-04-15T17:31:08Z","Content":"\n\u003Cp\u003E\nI don\u0027t know what to tell you, heh. I already did that. No other issue comes up in the log file, except the one I already posted. Here\u0027s the log:\u00A0\u003Ca href=\u0022https://www.dropbox.com/s/sqqs0w8zbbkwke1/KSP.zip?dl=0\u0022 rel=\u0022external nofollow\u0022\u003EKSP Log\u003C/a\u003E\n\u003C/p\u003E\n"},{"CreatedByName":"nli2work","CreatedById":106805,"CreatedDateTime":"2016-04-15T19:32:13Z","Content":"\n\u003Cp\u003E\nOk. The issue isn\u0027t related to animation then, not directly at any rate. all the assets loaded fine, there\u0027s nothing wrong with the animation or part export. \u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nlook in PartsDatabase.cfg, and search for your solarpanel part and see what turns up... probably something not quite right. All the stock retractable solar panels have 3 dragCubes. Copy one of those (most similar to your solarpanel)\u00A0and paste it into your part\u0027s config see if that will get it to load. If it does, then you have to either redesign the animation, the way the panel folds up, so it works with the dragCube generation process; or tweak an existing dragCube set to fit your solar panel part.\u003Cbr\u003E\u003Cbr\u003E\ncan you show how the part animates? is it using skinned mesh?\u00A0\u003Cbr\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-04-15T19:36:53Z\u0022 title=\u002204/15/2016 07:36  PM\u0022 data-short=\u00228 yr\u0022\u003EApril 15, 2016\u003C/time\u003E by nli2work\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2016-04-15T20:04:35Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222510893\u0022 data-ipsquote-contentid=\u0022136812\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221460513228\u0022 data-ipsquote-userid=\u0022115406\u0022 data-ipsquote-username=\u0022v1per\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nOn 4/13/2016 at 7:07 PM, v1per said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nBut then, when I start the game, it just hangs loading the part. Here\u0027s the error log:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode\u0022\u003E\n\n[LOG 22:51:42.801] DragCubeSystem: Creating drag cubes for part \u0027im.test\u0027\n[EXC 22:51:42.858] NullReferenceException: Object reference not set to an instance of an object\n\tModuleDeployableSolarPanel.AssumeDragCubePosition (System.String name)\n\tDragCubeSystem\u002B\u0026lt;RenderDragCubes\u0026gt;c__IteratorC.MoveNext ()\u003C/pre\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nModuleDeployableSolarPanel.animationName isn\u0027t among the AnimationStates the part model\u0027s first Animation component has. Make sure that the animationName defined in your part\u0027s ConfigNode for the solar panel module actually exists in the Animation\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-04-15T20:14:40Z\u0022 title=\u002204/15/2016 08:14  PM\u0022 data-short=\u00228 yr\u0022\u003EApril 15, 2016\u003C/time\u003E by xEvilReeperx\u003C/strong\u003E\n\u003Cbr\u003ERealized portion was incorrect; no NRE thrown if part model does not have Animation component\n\u003C/span\u003E\n"},{"CreatedByName":"v1per","CreatedById":115406,"CreatedDateTime":"2016-04-15T20:44:16Z","Content":"\n\u003Cp\u003E\nSo, I tried adding the drag cube definitions suggested. It all worked after that. So it\u0027s definitely something in the animation that makes the game not able to produce the drag cube definitions. Once I added the drag cubes myself, the animation played perfectly in game. And no, I did not use skinning. Only connected parts to bones to make it all easier to animate.\n\u003C/p\u003E\n\u003Cp\u003E\nHere\u0027s the animation:\u00A0\u003Ca href=\u0022https://gfycat.com/ThoseSnarlingAztecant\u0022 rel=\u0022external nofollow\u0022\u003ESolar Panel animation\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nAnd here\u0027s a screenshot in Unity:\u00A0\u003Ca href=\u0022http://i.imgur.com/kHcjtG3.jpg\u0022 rel=\u0022external nofollow\u0022\u003EScreenshot\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nPart CFG:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode\u0022\u003E\nPART\n{\n\tname = asimov_retractablesolarpanel\n\tmodule = Part\n\tauthor = Viper\n\tmesh = retractableSolarPanel.mu\n\trescaleFactor = 1\n\tnode_attach = 0.0, 0.0, 0.0, 1.0, 0.0, 0.0\n\tTechRequired = advElectrics\n\tentryCost = 3800\n\tcost = 380\n\tcategory = Utility\n\tsubcategory = 0\n\ttitle = Retractable Solar Panel\n\tmanufacturer = Incredible Machines\n\tdescription = The OX-4 is similar in design to the SP series solar panels, but without the heavy casing.  Includes passive radiators on the reverse side for better heat dissipation. WARNING: Not retractable once deployed!\n\tattachRules = 0,1,0,0,1\n\tmass = 0.0175\n\tdragModelType = default\n\tmaximum_drag = 0.2\n\tminimum_drag = 0.2\n\tangularDrag = 1\n\tcrashTolerance = 8\n\tmaxTemp = 1200 // = 3200\n\tbulkheadProfiles = srf\n\tthermalMassModifier = 2.0\n\temissiveConstant = 0.95\n\theatConductivity = 0.04 // 1/3 the default\n\ttags = array charge deploy e/c elect energ extend generat (light photo power solar sun track unfold volt watt\t\n\tMODULE\n\t{\n\t\tname = ModuleDeployableSolarPanel\n\t\tanimationName = expand\n\t\tresourceName = ElectricCharge\n\t\tchargeRate = 1.64\n\t\tretractable = false\n\t}\n\tDRAG_CUBE\n\t{\n\t\tcube = RETRACTED, 0.1949,0.9924,0.2973, 0.1949,0.957,0.2458, 0.05804,0.8956,0.6314, 0.05805,0.8728,0.5185, 0.0635,0.9513,0.433, 0.0635,0.952,0.4847, -0.03427,-0.1231,-1.851E-05, 0.2383,0.5386,0.4\n\t\tcube = EXTENDED_A, 0.07375,0.9495,2.717, 0.07375,0.7225,2.651, 1.017,0.9919,0.2336, 1.017,0.9895,0.2723, 0.07369,0.9554,0.2871, 0.07061,0.9542,0.2871, -1.235,0,5.469E-06, 2.64,0.2924,0.4\n\t\tcube = EXTENDED_B, 0.07172,0.9664,2.706, 0.07172,0.7061,2.651, 0.06274,0.9534,0.2918, 0.06274,0.9534,0.2918, 1.028,0.9916,0.2324, 1.025,0.988,0.2121, -1.235,0.02947,-7.451E-09, 2.64,0.4,0.2326\n\t}\n}\u003C/pre\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-04-15T20:55:37Z\u0022 title=\u002204/15/2016 08:55  PM\u0022 data-short=\u00228 yr\u0022\u003EApril 15, 2016\u003C/time\u003E by v1per\u003C/strong\u003E\n\u003Cbr\u003EAdding part config\n\u003C/span\u003E\n"},{"CreatedByName":"nli2work","CreatedById":106805,"CreatedDateTime":"2016-04-15T21:00:06Z","Content":"\n\u003Cp\u003E\nI asked about skinned mesh because I think RoverDude had a similar problem involve dragCubes\u00A0when making the new depolyable heatshield. Nothing in your part\u0027s animation seems problematic, very stock like.\u00A0very strange... everything seems to\u00A0add up. At least the part\u0027s working and there\u0027s a workaround. :/\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-04-15T21:03:18Z\u0022 title=\u002204/15/2016 09:03  PM\u0022 data-short=\u00228 yr\u0022\u003EApril 15, 2016\u003C/time\u003E by nli2work\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"v1per","CreatedById":115406,"CreatedDateTime":"2016-04-15T21:02:34Z","Content":"\n\u003Cp\u003E\nYeah, I\u0027m going to try a few more things here, but if it keeps giving me trouble, I\u0027ll just study up on the drag cubes definitions, make my own and move on to another part. I\u0027ve basically spent a week on this, and there are more things I want to do for my mod before 1.1 releases.\n\u003C/p\u003E\n"},{"CreatedByName":"nli2work","CreatedById":106805,"CreatedDateTime":"2016-04-15T21:11:57Z","Content":"\n\u003Cp\u003E\nI think I figured out what it was... actually not directly related to animation nor dragCubes at all.\n\u003C/p\u003E\n\u003Cp\u003E\nDeployableSolarPanel requires a gameobject for pivotName value, default name is sunPivot.\u00A0All\u00A0stock solar panels\u00A0use the default name so the setting isn\u0027t specified in the part configs. Apparently this object is required to generate proper dragCube for the solar panel parts.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nIf you add an object to the part in Unity and name it sunPivot, everything loads in KSP fine without explicit dragCube definition in the part config.\u003Cbr\u003E\nIf you rename one of your exisitng\u00A0objects (other than the object hosting Animation component) in the part to sunPivot, everything loads in KSP fine without explicit dragCube definition in the part config.\u003Cbr\u003E\nif you don\u0027t have an object called sunPivot, KSP will hang when loading the part, same exact error as in the OP.\u003Cbr\u003E\nif you don\u0027t have an object called sunPivot, but have dragCube definition in the part config, part will load fine.\u003Cbr\u003E\nif you have a sunPivot initially and load the game once, then remove sunPivot, game will load fine since proper dragCube definition is stored in PartDatabase already\n\u003C/p\u003E\n\u003Cp\u003E\nyou can assign a specific object using pivotName =; but it cannot be the same object hosting the Animation component. the generated dragCube differs depending on what you use as sunPivot object.\u00A0\u003Cbr\u003E\u003Cbr\u003E\nlesson learned, deployable solar panels are complex creatures.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-04-16T00:18:24Z\u0022 title=\u002204/16/2016 12:18  AM\u0022 data-short=\u00228 yr\u0022\u003EApril 16, 2016\u003C/time\u003E by nli2work\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"v1per","CreatedById":115406,"CreatedDateTime":"2016-04-16T01:38:34Z","Content":"\n\u003Cp\u003E\nIt seems you are correct. After adding the sunPivot object everything works without drag cubes being added in manually.\u00A0Since this was the first time doing a solar panel, I thought I\u0027d do things in parts. I figured I\u0027d import the animation first and see it working before bothering to actually set up all the solar panel parts needed. Silly me. Sorry for bothering you guys. At least now we know that if things aren\u0027t set up exactly, it all goes to crap.\n\u003C/p\u003E\n\u003Cp\u003E\nI might do an actual tutorial on all this later. This is nothing but trivial. I\u0027m now trying to set up the sun tracking and that\u00A0is a nightmare in of it self.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-04-16T01:38:57Z\u0022 title=\u002204/16/2016 01:38  AM\u0022 data-short=\u00228 yr\u0022\u003EApril 16, 2016\u003C/time\u003E by v1per\u003C/strong\u003E\n\u003C/span\u003E\n"}]}