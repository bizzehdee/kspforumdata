{"TopicId":127450,"ForumId":15,"TopicTitle":"How To: Fix Extruded/Cut Cylinder/Cone Shading in Blender (Command pods, etc)","CreatedByName":"Shadowmage","CreatedById":138730,"CreatedDateTime":"2015-12-10T16:21:16Z","PageNum":1,"Articles":[{"CreatedByName":"Shadowmage","CreatedById":138730,"CreatedDateTime":"2015-12-10T16:21:16Z","Content":"\n\u003Cp\u003E\nOkay, so, I\u0027ve spent like the last 6 months being constantly aggravated over the terrible shading artifacts brought onto smooth-shaded low-poly shapes with any kind of non-exact mesh-flow (extrusions, cuts, whatever).\u00A0 Over the past day or two, I have discovered a newer feature added to blender in the last few months, the \u0027Transfer Data\u0027 modifier.\n\u003C/p\u003E\n\u003Cp\u003E\nNow, you might be thinking... how does transferring data between objects help solve normal shading?\u00A0 Yah, I thought that too.\u00A0 But when you realize that edge/face/vertex (shading) normal data is merely another pre-computed part of the model, it makes sense.\u00A0 Integral to this feature actually being useful though, is blenders capability to not only transfer the normals from one object to another, but also to interpolate the vertex and edge normals properly from a vastly different donor mesh.\n\u003C/p\u003E\n\u003Cp\u003E\nSo, without wasting too much time on the \u0027why\u0027 -- here is the \u0027how\u0027.\n\u003C/p\u003E\n\u003Cp\u003E\n1. Get yourself a mesh with messed up shading due to edge flow.\u00A0 Generally easy enough to find these (make a conical command pod and cut a window in it.. instant shading artifacts).\n\u003C/p\u003E\n\u003Cp\u003E\n2. Split off the mesh that needs to be \u0027corrected\u0027.\u00A0 So far I have only determined how to do this technique for cylinders and cones, but it might be applicable to other shapes and layouts with some adaptation.\n\u003C/p\u003E\n\u003Cp\u003E\n3. Create an un-distorted \u0027donor\u0027 mesh that will supply your clean normals.\u00A0 This mesh should match the to-be-fixed mesh as close as possible, and should be a multiple of the face count of the to-be-fixed mesh.\u00A0 For normal 24-side KSP cylinders, I use a 384-side cylinder as the normal donor.\u00A0 Apply smooth shading to this donor mesh.\u00A0 Apply Auto-smoothing if needed (you want proper normals on your donor mesh).\u00A0 Delete any un-needed faces (e.g. top/bottom for most cylinders and cones), as these -may- interfere with the process (unknown, did not test).\n\u003C/p\u003E\n\u003Cp\u003E\n4.\u00A0 Select your to-be-fixed mesh, enable \u0027Auto-Smoothing\u0027.\n\u003C/p\u003E\n\u003Cp\u003E\n5.\u00A0 Add the \u0027Data Transfer\u0027 modifier to your to-be-fixed mesh.\n\u003C/p\u003E\n\u003Cp\u003E\n6.\u00A0 Set data transfer modifier to \u0027Nearest Corner and best matching Face Normal\u0027 mode, and click the \u0027custom normals\u0027 button that appears below the checkbox.\u00A0 Enter your donor object name in the \u0027Source Object\u0027 box.\n\u003C/p\u003E\n\u003Cp\u003E\n7. Apply the modifier, and your normal are fixed!\u00A0 You can merge this mesh back into the base mesh it came from -- just do not alter edge-sharpness modifiers or \u0027recalc normals\u0027, or you will need to re-fix your shading again.\u00A0 Preliminary tests have shown that it exports through .fbx properly, and handles the fixed normal/shading once exported through Unity into KSP.\n\u003C/p\u003E\n\u003Cp\u003E\n8.\u00A0 Unkown if this can be applied to inside-facing normals for stuff like IVAs, but it seems likely (as long as source and donor mesh normals are facing the same way, it -should- logically work; but blender is not always logical)\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ciframe class=\u0022imgur-album\u0022 frameborder=\u00220\u0022 height=\u0022550\u0022 src=\u0022//imgur.com/a/I0XGO/embed?background=ffffff\u0026amp;text=1a1a1a\u0026amp;link=4e76c9\u0022 width=\u0022100%\u0022\u003E\u003C/iframe\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nHope someone finds this information helpful -- I\u0027ve been pretty excited about it after 6\u002B months of trying to find a solution (finally, proper shaded command pods!).\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-12-10T17:07:24Z\u0022 title=\u002212/10/2015 05:07  PM\u0022 data-short=\u00228 yr\u0022\u003EDecember 10, 2015\u003C/time\u003E by Shadowmage\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"martinezfg11","CreatedById":59995,"CreatedDateTime":"2015-12-10T19:37:57Z","Content":"\n\u003Cp\u003E\nNice! I haven\u0027t used Blender in a while but I saw some info\u00A0on people using the Data Transfer modifier\u00A0over on the Polycount forums.\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027ve been experimenting with Face Weighted Vertex normals in MODO after reading some documentation online through the polycount forums and our very own bac9.\n\u003C/p\u003E\n"},{"CreatedByName":"artwhaley","CreatedById":118388,"CreatedDateTime":"2015-12-10T19:44:28Z","Content":"\n\u003Cp\u003E\nThis is a great hint.. \u00A0but I just gave it a shot and wasn\u0027t in love with the results? \u00A0With a simple hole cut like your example, it did in fact clean the mesh up a lot! \u00A0But when I went to extrude that edge to turn the simple hole into a window, for example... things to weird\n\u003C/p\u003E\n\u003Cp\u003E\n. \u00A0If I extruded and made the inset face before doing the data transfer, there was no way to get sharp edges around the window... \u00A0it made the window into a sort of organically sunk in abscess in the cylinder with lumpy and unclear edges, even when I tried marking them sharp or applying an edge split.\u00A0\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nif I extruded AFTER applying the data transfer, the shading artifacts came back worse than ever? \u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nDid you have any luck taking a next step on the demo mesh you\u0027re showing it and putting additional geometry attached to that hole?\u003Cbr\u003E\u003Cbr\u003E\nMy go-to \u0027sometimes fix\u0027 for the\u00A0normal artifacting problem has been marking the cut out edges as \u0027sharp\u0027 and applying an edge split, by the way, but those results aren\u0027t perfect! \u00A0This looks much better, if I can get it to work!\u00A0\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nEDIT: \u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nI tried making IDENTICAL extrudes to both models before applying the data transfer modifier, and it worked beautifully! \u00A0It\u0027s a bit of a pain to work on a high and low poly model at the same time and have to do identical operations, but if you think ahead and start with all of the required inset cuts... \u00A0it could be awesome!\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-12-10T19:58:15Z\u0022 title=\u002212/10/2015 07:58  PM\u0022 data-short=\u00228 yr\u0022\u003EDecember 10, 2015\u003C/time\u003E by artwhaley\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"NecroBones","CreatedById":105424,"CreatedDateTime":"2015-12-10T20:24:08Z","Content":"\n\u003Cp\u003E\nAnother option might be to make the exterior (that\u0027s being adjusted with the data transfer) its own mesh object, and make the windows with a new mesh object. It adds a draw call, but there shouldn\u0027t be any cross-talk. This also has the virtue of allowing you to make the window use its own smaller texture, so that if you want to use an emissive to light it up, the emissive map can be pretty small.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"hoojiwana","CreatedById":57079,"CreatedDateTime":"2015-12-10T21:44:30Z","Content":"\n\u003Cp\u003E\nHow well does this transfer in-game? Does the mu converter in Part Tools strip this data or does it show up alright?\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022http://forum.kerbalspaceprogram.com/index.php?/profile/70533-beale/\u0026amp;do=hovercard\u0022 data-mentionid=\u002270533\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/70533-beale/\u0022\u003E@Beale\u003C/a\u003E made a \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/122500-window-geometry/\u0022\u003Ethread\u003C/a\u003E recently on a similar topic, there are some other options available there for those interested.\n\u003C/p\u003E\n"},{"CreatedByName":"Beale","CreatedById":70533,"CreatedDateTime":"2015-12-10T22:22:36Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222317078\u0022 data-ipsquote-contentid=\u0022127450\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221449783870\u0022 data-ipsquote-userid=\u002257079\u0022 data-ipsquote-username=\u0022hoojiwana\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n37 minutes ago, hoojiwana said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nHow well does this transfer in-game? Does the mu converter in Part Tools strip this data or does it show up alright?\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022http://forum.kerbalspaceprogram.com/index.php?/profile/70533-beale/\u0026amp;do=hovercard\u0022 data-mentionid=\u002270533\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/70533-beale/\u0022\u003E@Beale\u003C/a\u003E made a \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/122500-window-geometry/\u0022\u003Ethread\u003C/a\u003E recently on a similar topic, there are some other options available there for those interested.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nYes, this is one of the biggest pains I have ever come across while modelling. (And it still defeats me).\n\u003C/p\u003E\n\u003Cp\u003E\nI think the best solution I saw was the \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/122500-window-geometry/\u0026amp;page=2\u0022\u003Emanual face-normal control.\u003C/a\u003E\n\u003C/p\u003E\n"},{"CreatedByName":"Shadowmage","CreatedById":138730,"CreatedDateTime":"2015-12-10T22:47:41Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222317078\u0022 data-ipsquote-contentid=\u0022127450\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221449783870\u0022 data-ipsquote-userid=\u002257079\u0022 data-ipsquote-username=\u0022hoojiwana\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n1 hour ago, hoojiwana said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nHow well does this transfer in-game? Does the mu converter in Part Tools strip this data or does it show up alright?\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022http://forum.kerbalspaceprogram.com/index.php?/profile/70533-beale/\u0026amp;do=hovercard\u0022 data-mentionid=\u002270533\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/70533-beale/\u0022\u003E@Beale\u003C/a\u003E made a \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/122500-window-geometry/\u0022\u003Ethread\u003C/a\u003E recently on a similar topic, there are some other options available there for those interested.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nFrom my brief experiments, it transfers 100% through fbx, into unity, and into KSP, without error.\u00A0 As long as it looks right in blender when you export, it -should- be right in Unity (as long as you have Unity set for \u0027Import Normals = true\u0027).\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nEdit: Was looking for that thread, but did not spot it in the top 2-3 pages of threads, so ended up starting a new one.\u00A0 Had not seen it since it was a \u0027new\u0027 thread with only a few posts in it... had I been able to find it I probably would not have posted at all, as it appears that the \u0027Data Transfer\u0027 modifier was already known and posted there.\u00A0 Sorry for the semi-duplicate threads...\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222317150\u0022 data-ipsquote-contentid=\u0022127450\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221449786156\u0022 data-ipsquote-userid=\u002270533\u0022 data-ipsquote-username=\u0022Beale\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n29 minutes ago, Beale said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nYes, this is one of the biggest pains I have ever come across while modelling. (And it still defeats me).\n\u003C/p\u003E\n\u003Cp\u003E\nI think the best solution I saw was the \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/122500-window-geometry/\u0026amp;page=2\u0022\u003Emanual face-normal control.\u003C/a\u003E\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nWould love that option, sadly, it is not available in Blender (that I\u0027m aware of), and I have not $$$ for 3dsMax.\n\u003C/p\u003E\n\u003Cp\u003E\nThere is a plugin for blender that -kind-of- allows such manual manipulation (Blend4Web), but was... painful to work with, and inconsistent (any changes to a mesh after fixing the normals would revert -all- of the work), nor did it export properly into Unity/KSP.\n\u003C/p\u003E\n\u003Cp\u003E\nNot to mention that manually fixing every vertex normal for a 1000\u002B vertex mesh is... ughh.. I would die of boredom before I got it done \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022true\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-12-10T22:53:54Z\u0022 title=\u002212/10/2015 10:53  PM\u0022 data-short=\u00228 yr\u0022\u003EDecember 10, 2015\u003C/time\u003E by Shadowmage\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Shadowmage","CreatedById":138730,"CreatedDateTime":"2015-12-11T00:05:12Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222316913\u0022 data-ipsquote-contentid=\u0022127450\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221449776668\u0022 data-ipsquote-userid=\u0022118388\u0022 data-ipsquote-username=\u0022artwhaley\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n4 hours ago, artwhaley said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nThis is a great hint.. \u00A0but I just gave it a shot and wasn\u0027t in love with the results? \u00A0With a simple hole cut like your example, it did in fact clean the mesh up a lot! \u00A0But when I went to extrude that edge to turn the simple hole into a window, for example... things to weird\n\u003C/p\u003E\n\u003Cp\u003E\n. \u00A0If I extruded and made the inset face before doing the data transfer, there was no way to get sharp edges around the window... \u00A0it made the window into a sort of organically sunk in abscess in the cylinder with lumpy and unclear edges, even when I tried marking them sharp or applying an edge split.\u00A0\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nif I extruded AFTER applying the data transfer, the shading artifacts came back worse than ever? \u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nDid you have any luck taking a next step on the demo mesh you\u0027re showing it and putting additional geometry attached to that hole?\u003Cbr\u003E\u003Cbr\u003E\nMy go-to \u0027sometimes fix\u0027 for the\u00A0normal artifacting problem has been marking the cut out edges as \u0027sharp\u0027 and applying an edge split, by the way, but those results aren\u0027t perfect! \u00A0This looks much better, if I can get it to work!\u00A0\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nEDIT: \u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nI tried making IDENTICAL extrudes to both models before applying the data transfer modifier, and it worked beautifully! \u00A0It\u0027s a bit of a pain to work on a high and low poly model at the same time and have to do identical operations, but if you think ahead and start with all of the required inset cuts... \u00A0it could be awesome!\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nYah, you have to make it so that the normal-data-transfer is the -last- thing you do to the mesh.\u00A0 If you do any more cuts, extrusions, or even just move a single vert around, it will likely revert to \u0027auto calculated normals\u0027, and you\u0027ll need to re-fix the shading.\u00A0 So model \u002B cut first, fix normals last.\u00A0 Might require breaking your base mesh into separate meshes, one for each bit that needs normals fixed, and re-joining them once it is all corrected.\n\u003C/p\u003E\n\u003Cp\u003E\nBut, for my test-case (an apollo-styled CM), I was able to pull the cylinder and hatch sides out of the master mesh, move them to a new layer, fix their shading, and re-join them into the master mesh without problem.\u00A0 It then exported to fbx, into and out of unity, and into KSP with nice smooth-shiny, non-artifacty shading.\n\u003C/p\u003E\n\u003Cp\u003E\nMost notable is the shading on the hatch, rather the lack of artifacts in the \u0027fixed\u0027 hatch shading. (as I -just- learned this technique yesterday, but did the initial model a few weeks back, I had already mangled the edge-flow of the rest of the mesh to minimize artifacts, so the hatch is the most visible fixed area).\n\u003C/p\u003E\n\u003Cp\u003E\nPre-fix:\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u0022KkuOhJv.png\u0022 class=\u0022ipsImage\u0022 height=\u0022750\u0022 src=\u0022http://i.imgur.com/KkuOhJv.png\u0022 width=\u0022422\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nPost-fix\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u0022kcfPwzn.png\u0022 class=\u0022ipsImage\u0022 height=\u0022750\u0022 src=\u0022http://i.imgur.com/kcfPwzn.png\u0022 width=\u0022422\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nFor me, it is going into my workfow right before the AO bake step, where I already have the model split into various meshes for clean bakes, but where I know there are no more geometry changes to be done.\n\u003C/p\u003E\n\u003Cp\u003E\nIt is nowhere near a perfect solution, but I was pretty excited to be able to cut some windows in a command pod without it looking like mud \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022true\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E (and combined with the upcoming 1.1 reflective shaders, I\u0027ll likely put it to good use on the rest of the pod as well).\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nEdit:\u00A0 I will revise the \u0027tutorial\u0027 with a bit more information and pictures regarding how to use it with an actual model.\u00A0 I\u0027ll be doing another CM soon, so can hopefully use a real example for it.\u00A0 And now that I know what it is all about, I can likely use it to cheat some better looking normals on a lot of other low-poly details as well -- will see about adding some examples for that stuff too as I figure it out (piping, manifolds, I\u0027m sure I\u0027ll find more places).\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-12-11T00:21:35Z\u0022 title=\u002212/11/2015 12:21  AM\u0022 data-short=\u00228 yr\u0022\u003EDecember 11, 2015\u003C/time\u003E by Shadowmage\u003C/strong\u003E\n\u003C/span\u003E\n"}]}