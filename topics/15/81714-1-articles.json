{"TopicId":81714,"ForumId":15,"TopicTitle":"Compressing .MBM textures","CreatedByName":"Nsomnia","CreatedById":77129,"CreatedDateTime":"2014-08-14T16:25:05Z","PageNum":1,"Articles":[{"CreatedByName":"Nsomnia","CreatedById":77129,"CreatedDateTime":"2014-08-14T16:25:05Z","Content":"\n\u003Cp\u003EAll of my mods that used .pngs and .tga formats for their textures I opened in photoshop and enabled compression with no loss in quality BUT a reducion on average of about 15% filesize (sometimes up to 50% on heavily detailed textures). This has made starting KSP that slight bit faster and RAM usage slightly less and we all know how long it takes to load with mods.\u003C/p\u003E\u003Cp\u003EThe problem I\u0027ve encountered is a ton of mods use .mbm textures these are not editable in photoshop. Is there a way to either \u003C/p\u003E\u003Cp\u003Ea) open .mbm textures, compress, and save back to original directory with file size savings. \u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_cool.png\u0022 alt=\u0022B)\u0022\u003E convert .mbm to .png or .tga and compress them, then back to .mbm with file size savings.\u003C/p\u003E\u003Cp\u003Ec) convert .mbm to .png or .tga and have the mod use these textures instead, which begs my noob question where is the texture file loaded, in the part.cfg?\u003C/p\u003E\u003Cp\u003E.mbms make up over 50% of the total size of textures in my gamedata directory. So this could decrease loading times and RAM usage significantly, as well mods with the right fair use policys I could release the compressed textures for those with older computers or laptops (like myself).\u003C/p\u003E\u003Cp\u003EThank you.\u003C/p\u003E\u003Cp\u003EEdit: Found this in some research, if I could convert the .mbms to .pngs or .tgas then I just edit the model.mu to use the new texture \u0022Using a hex editor, I edited the file \u0022model.mu\u0022 and near the bottom, changed all the texture filenames from \u0022modelxxx.mbm\u0022 to \u0022modelxxx.png\u0022. Here\u0027s what the text editor looks like after the edit: \u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E0002B7F0   00 08 66 61  69 72 69 6E  67 31 03 00  00 00 00 00  ..fairing1......\u003Cbr\u003E0002B800   00 00 00 00  80 3F 00 00  80 3F 00 00  00 00 00 00  .....?...?......\u003Cbr\u003E0002B810   00 00 01 00  00 00 00 00  80 3F 00 00  80 3F 00 00  .........?...?..\u003Cbr\u003E0002B820   00 00 00 00  00 00 06 65  6E 67 69 6E  65 07 00 00  .......engine...\u003Cbr\u003E0002B830   00 02 00 00  00 00 00 80  3F 00 00 80  3F 00 00 00  ........?...?...\u003Cbr\u003E0002B840   00 00 00 00  00 03 00 00  00 00 00 80  3F 00 00 80  ............?...\u003Cbr\u003E0002B850   3F 00 00 00  00 00 00 00  00 C0 AF C6  3D C0 AF C6  ?...........=...\u003Cbr\u003E0002B860   3D C0 AF C6  3D 00 00 80  3F BF CC EB  3E 04 00 00  =...=...?...\u0026gt;...\u003Cbr\u003E0002B870   00 00 00 80  3F 00 00 80  3F 00 00 00  00 00 00 00  ....?...?.......\u003Cbr\u003E0002B880   00 00 00 00  00 00 00 00  00 00 00 00  00 00 00 80  ................\u003Cbr\u003E0002B890   3F 0C 00 00  00 05 00 00  00 0C 6D 6F  64 65 6C 30  ?.........model0\u003Cbr\u003E0002B8A0   30 30 2E 70  6E 67 00 00  00 00 0C 6D  6F 64 65 6C  00.png.....model\u003Cbr\u003E0002B8B0   30 30 31 2E  70 6E 67 01  00 00 00 0C  6D 6F 64 65  001.png.....mode\u003Cbr\u003E0002B8C0   6C 30 30 32  2E 70 6E 67  00 00 00 00  0C 6D 6F 64  l002.png.....mod\u003Cbr\u003E0002B8D0   65 6C 30 30  33 2E 70 6E  67 01 00 00  00 0C 6D 6F  el003.png.....mo\u003Cbr\u003E0002B8E0   64 65 6C 30  30 34 2E 70  6E 67 00 00  00 00        del004.png....\u003Cbr\u003E0002B8F0\u003Cbr\u003E---  model.mu       --0x2B780/0x2B8EE------------------------------------------\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003ECould theses tools be of use IE. use MBM2PNG, compress the .PNG in photoshop then use PNG2MBM to convert it back to the origonal texture file called for. Better yet use MBM2PNG (either this online tool or the one posted on the forums I have a copy of) then change the model.mu to use the .png instead of the .mbm for memory, and loading time savings?\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022http://ziin.pl/en/utilities/convert/mbm2png\u0022 rel=\u0022external nofollow\u0022\u003EMBM2PNG\u003C/a\u003E\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022http://ziin.pl/en/utilities/convert/png2mbm\u0022 rel=\u0022external nofollow\u0022\u003EPNG2MBM\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EThe physical MBM2PNG exe file does this \u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003EThis program converts Kerbal Space Program texture files (i.e. \u0022model000.mbm\u0022)\u003Cbr\u003Einto PNG files suitable for editing and use in the KSP game.\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EI also have muedit.exe which is useful \u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003EThis program converts modifies \u0022model.mu\u0022 files by changing the internal\u003Cbr\u003Etexture filenames from (typically) \u0022modelxxx.mbm\u0022 to \u0022modelxxx.png\u0022. This\u003Cbr\u003Echange allows KSP to utilize PNG texture image files instead of the original\u003Cbr\u003EMBM files. This program is used in conjunction with \u0022mbm2png\u0022.\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EBasically am I going to see memory reduction and loading time savings by using compressed .pngs instead of .mbms? Being that Squad, KW Rocketry, and Kethane use .mbms this could be significant file size savings, does this lead to loading time and memory savings?\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-08-14T16:46:51Z\u0022 title=\u002208/14/2014 04:46  PM\u0022 data-short=\u00229 yr\u0022\u003EAugust 14, 2014\u003C/time\u003E by Nsomnia\u003C/strong\u003E\n\u003Cbr\u003Emore info\n\u003C/span\u003E\n"},{"CreatedByName":"NathanKell","CreatedById":75006,"CreatedDateTime":"2014-08-15T03:01:07Z","Content":"\n\u003Cp\u003ESize on disk is not directly related to size in memory.\u003C/p\u003E\u003Cp\u003EOn load, KSP will load *all* textures, uncompress them, and then recompress them to DXT1 or 5 (5 if the texture has an alpha channel). There is one exception: mbms which have a \u0022do not compress ingame\u0022 flag will be left uncompressed.\u003C/p\u003E\u003Cp\u003EThere are some loader bugs, which it\u0027s unclear if they are still in KSP, namely that some PNGs do not get mipmaps generated for them on load, and that TGAs are left as RGB or RGBA (i.e. uncompressed) rather than compressed to DXT (note that of course this still has nothing to do with whether your TGA was compressed on disk; as I said, *all* files are uncompressed on load first, before *anything* else happens.)\u003C/p\u003E\u003Cp\u003EIf you see differences in memory ingame from converting files, that\u0027s due to the various loaders using more memory and garbage collection not freeing it yet. It will all even out in the end, unless the loaders have memory leaks.\u003C/p\u003E\u003Cp\u003EFinally, as of version 0.20 of KSP, since all textures are the same formats ingame, the extension of a texture doesn\u0027t matter at all. In fact, models and textures are read in *before* anything else, and *all* models and textures in GameData are loaded, regardless of whether they will be used for anything. Since models are only \u0022tied\u0022 to textures after both have been loaded, KSP will look for a texture in the same folder as the mu with the same name-before-extension as is requested by the mu. This is because it\u0027s requested from the GameDatabase. If you have multiple files of the same name (but different extension) only one will ever be referenced by models (but both will be loaded and take up space. So don\u0027t do this); and if you have a model000.png and the model requests model000.mbm that doesn\u0027t matter, because the extension isn\u0027t used; what it\u0027s actually requesting is \u0022a texture in GameDatabase with the URI /path/to/model/requestedTextureName\u003C/p\u003E\u003Cp\u003EThat\u0027s also so that in a cfg in a MODEL node you can replace textures (i.e. you could do texture = model000, path/to/some/other/texture)\u003C/p\u003E\u003Cp\u003EThe long and short is, you\u0027re pretty much on a fool\u0027s errand. Convert away from mbm only if you have limited *disk* space, or if you want to edit the image; if you do convert away from mbm, delete the mbm so that there is only one file.\u003C/p\u003E\u003Cp\u003EAs you say, because disk read is slower than decompression, it may make sense to speed things up by converting to PNG so KSP has to read less data from the disk (even though it then takes some CPU time to decompress, whereas it takes 0 CPU time to decompress a mbm since mbms aren\u0027t compressed).\u003C/p\u003E\n"},{"CreatedByName":"CaptainKipard","CreatedById":70516,"CreatedDateTime":"2014-08-15T08:12:46Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022NathanKell\u0022 data-cite=\u0022NathanKell\u0022\u003E\u003Cdiv\u003E... and that TGAs are left as RGB or RGBA (i.e. uncompressed) rather than compressed to DXT...\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ECould someone please confirm or deny this? I\u0027ve been using TGAs exclusively.\u003C/p\u003E\n"},{"CreatedByName":"Nsomnia","CreatedById":77129,"CreatedDateTime":"2014-08-20T16:59:24Z","Content":"\n\u003Cp\u003ESo basically, by compressing say model000.TGA (32 bit/channel, no RLE compression=4MB) to model000.TGA to 24 bit/channel w/ RLE compression in Photoshop (which brings it down to 393KB) it doesnt matter anyway because KSP is going to decompress (to no RLE @ 24bit/channel=3MB) the textures anyway and switch them back to 32bit/channel (back to 4MB no gains). \u003C/p\u003E\u003Cp\u003ESo im wasting my time? \u003C/p\u003E\u003Cp\u003EEven though it reduces B9\u0027s disk space usage by 1/4, ingame memory usage will still be the same no matter how many bits per channel or RLE compression I use on the textures in Photoshop?\u003C/p\u003E\n"},{"CreatedByName":"Justin Kerbice","CreatedById":101695,"CreatedDateTime":"2014-08-20T17:13:06Z","Content":"\n\u003Cp\u003EIt would be great to have some inputs from someone who is really deep into GPU stuff and their drivers but AFAIK, GPU can\u0027t afford to loose time in compressing/decompressing, and that\u0027s explain why the strongest a Gfx card is, the more fast memory it include on board. Think of modern Nvidia card with 4GB inside. Do you really think those 4GB are just there to increase the sell price ? Give money to memory chips manufacturers ?\u003C/p\u003E\u003Cp\u003EGPU need to be feed as fast as possible, so models and texture are push into the tube like high pressured gas in the most usable form: uncompressed (and/or converted into some internal, unusable outside, format).\u003C/p\u003E\u003Cp\u003EIt\u0027s not a waste of time to compress them as disk space \u002B reading file from disk are still valuable eve with SSD or fast hard drives.\u003C/p\u003E\n"},{"CreatedByName":"NathanKell","CreatedById":75006,"CreatedDateTime":"2014-08-21T00:01:58Z","Content":"\n\u003Cp\u003ENsomnia, correct, with the exception Justin Kerbice points out: because disk IO is much more expensive than CPU time decompressing, pngs may load slightly faster than MBMs. But they\u0027ll have the same memory usage in the end.\u003C/p\u003E\u003Cp\u003EIt\u0027s not that GPUs can\u0027t afford to lose time per se, it\u0027s that the *bandwidth* is at a premium and thus you want to compress files such that bandwidth is minimized, while using a compression format that is short-and-constant-time for accessing a given pixel.\u003C/p\u003E\n"},{"CreatedByName":"Nsomnia","CreatedById":77129,"CreatedDateTime":"2014-08-24T03:38:58Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022NathanKell\u0022 data-cite=\u0022NathanKell\u0022\u003E\u003Cdiv\u003ENsomnia, correct, with the exception Justin Kerbice points out: because disk IO is much more expensive than CPU time decompressing, pngs may load slightly faster than MBMs. But they\u0027ll have the same memory usage in the end.\u003Cp\u003EIt\u0027s not that GPUs can\u0027t afford to lose time per se, it\u0027s that the *bandwidth* is at a premium and thus you want to compress files such that bandwidth is minimized, while using a compression format that is short-and-constant-time for accessing a given pixel.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThanks for saving me time ill stick with ATM for now, \u002Brep\u003C/p\u003E\n"}]}