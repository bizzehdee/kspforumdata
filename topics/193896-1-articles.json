{"TopicId":193896,"ForumId":29,"TopicTitle":"Strange issue with Vessel.GetWorldPos3D()","CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2020-05-15T13:36:38Z","PageNum":1,"Articles":[{"CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2020-05-15T13:36:38Z","Content":"\n\u003Cp\u003E\nI\u0027m hitting a strange issue with this method.\n\u003C/p\u003E\n\u003Cp\u003E\nFirst, a bit of background:\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027m updating the old NeatherdyneMassDriver mod.\u00A0 Now, one of the things it does when being armed (using a manual event) is to look at the entire FlightGlobals.Vessels list using this:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003E            for (int i = 0; i \u0026lt; FlightGlobals.Vessels.Count; i\u002B\u002B)\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nThe code only looks at vessels which are loaded.\n\u003C/p\u003E\n\u003Cp\u003E\nThe strange thing is that upon first runthrough of this after launching a vessel, the GetWorldPos3D returns wrong information, it\u0027s actually off by about 18m or so.\u00A0 I have to either do a Revert to Launch, or change scenes (not Mapview) and return, and then, when I try it again, the values are correct.\n\u003C/p\u003E\n\u003Cp\u003E\nEdit:\u00A0 a few other pieces of info:\n\u003C/p\u003E\n\u003Cul\u003E\u003Cli\u003E\nThe vessel is landed\n\u003C/li\u003E\n\u003Cli\u003E\nIt\u0027s been staged\n\u003C/li\u003E\n\u003Cli\u003E\nIt\u0027s still attached to the ground via Launch Clamps\n\u003C/li\u003E\n\u003Cli\u003E\nCycling through all the vessels in range doesn\u0027t change this\n\u003C/li\u003E\n\u003Cli\u003E\nIn at least one case (a Kerbal on EVA), the initial reported position is only about 3.7m from the vessel which is on the launch pad, but this kerbal is standing on top of the \u003Cabbr title=\u0022SpacePlane Hangar\u0022\u003ESPH\u003C/abbr\u003E\n\u003C/li\u003E\n\u003C/ul\u003E\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nSo, either I shouldn\u0027t be calling it when I do, which begs the question of what I should be using to get the current position, or there is something mildly wrong.\n\u003C/p\u003E\n\u003Cp\u003E\nAnybody have any ideas about this?\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nEdit 2:\u00A0 More info:\n\u003C/p\u003E\n\u003Cp\u003E\nI added this event to the module:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003E        [KSPEvent(guiName = \u0022Dump 3dWorldPos\u0022, guiActive = true)]\n        void DumpAllWorldPos()\n        {\n            for (int i = 0; i \u0026lt; FlightGlobals.Vessels.Count; i\u002B\u002B)\n            {\n                Log.Info(\u0022 vessel: \u0022 \u002B FlightGlobals.Vessels[i].GetDisplayName() \u002B \u0022, GetWorldPos3D: \u0022 \u002B FlightGlobals.Vessels[i].GetWorldPos3D());\n            }\n        }\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nThen I ran it\n\u003C/p\u003E\n\u003Cp\u003E\nThis first data is right after\u00A0scene entry (via Launch in \u003Cabbr title=\u0022Vehicle Assembly Building\u0022\u003EVAB\u003C/abbr\u003E):\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003ENeatherdyneMassDriver:  vessel: Ast. HSJ-227, GetWorldPos3D: [-1124879303.97714, -733815128.549169, -575230659.152941]\nNeatherdyneMassDriver:  vessel: Bug-E Buggy, GetWorldPos3D: [985.913289922824, 591.861797130415, 1415.44591948658]\nNeatherdyneMassDriver:  vessel: Ast. RGM-917, GetWorldPos3D: [-293479531.735809, 431907041.770186, 454418748.74671]\nNeatherdyneMassDriver:  vessel: Ast. TMB-379, GetWorldPos3D: [-1023536652.28846, 218600335.368253, 403709979.216618]\nNeatherdyneMassDriver:  vessel: Ast. HCD-748, GetWorldPos3D: [-152570086.523338, -127737266.158059, -60279170.0043015]\nNeatherdyneMassDriver:  vessel: Ast. OER-301, GetWorldPos3D: [186115770.605457, 51428147.3947904, -5342574886.78443]\nNeatherdyneMassDriver:  vessel: Ast. SFB-334, GetWorldPos3D: [-896989968.552023, 153602818.648187, -931489546.981206]\nNeatherdyneMassDriver:  vessel: Ast. KNE-432, GetWorldPos3D: [-156166998.831367, -147138502.919713, -1135450874.30196]\nNeatherdyneMassDriver:  vessel: Bug-E Buggy, GetWorldPos3D: [972.820820344182, 591.748435160849, 1396.5951393447]\nNeatherdyneMassDriver:  vessel: #autoLOC_501174, GetWorldPos3D: [990.145519455868, 508.822024835369, 1430.04441930554]\nNeatherdyneMassDriver:  vessel: Bob Kerman, GetWorldPos3D: [436.497802734375, 208.381652832031, 684.302307128906]\nNeatherdyneMassDriver:  vessel: m1 Ship, GetWorldPos3D: [493338.263559453, 601047.624391597, -341130.058751659]\nNeatherdyneMassDriver:  vessel: M3, GetWorldPos3D: [-11.8811203269019, -0.298791598763315, 8.25047809103551]\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nThen I reverted to launch, and did it again:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003ENeatherdyneMassDriver:  vessel: Ast. HSJ-227, GetWorldPos3D: [-1140276075.97325, -733812912.308787, -544015357.766437]\nNeatherdyneMassDriver:  vessel: Bug-E Buggy, GetWorldPos3D: [1031.74545127409, 592.166583143299, 1382.56478619274]\nNeatherdyneMassDriver:  vessel: Ast. RGM-917, GetWorldPos3D: [-280847806.280659, 431904672.499405, 462329954.84738]\nNeatherdyneMassDriver:  vessel: Ast. TMB-379, GetWorldPos3D: [-1012009919.0946, 218597987.064976, 431751248.705451]\nNeatherdyneMassDriver:  vessel: Ast. HCD-748, GetWorldPos3D: [-154168133.004789, -127736440.106006, -56050102.0961084]\nNeatherdyneMassDriver:  vessel: Ast. OER-301, GetWorldPos3D: [38935875.9285049, 51428088.1133079, -5345635726.95092]\nNeatherdyneMassDriver:  vessel: Ast. SFB-334, GetWorldPos3D: [-922286462.306923, 153601919.06607, -906414492.983304]\nNeatherdyneMassDriver:  vessel: Ast. KNE-432, GetWorldPos3D: [-187369986.391262, -147141138.537524, -1130708600.31984]\nNeatherdyneMassDriver:  vessel: Bug-E Buggy, GetWorldPos3D: [1018.23721994056, 592.053217722987, 1364.00967907606]\nNeatherdyneMassDriver:  vessel: #autoLOC_501174, GetWorldPos3D: [1036.30101758615, 509.126778534616, 1397.06556526787]\nNeatherdyneMassDriver:  vessel: Bob Kerman, GetWorldPos3D: [466.214141845703, 208.686447143555, 663.813903808594]\nNeatherdyneMassDriver:  vessel: m1 Ship, GetWorldPos3D: [485648.511977542, 601047.929163854, -352022.088823108]\nNeatherdyneMassDriver:  vessel: M3, GetWorldPos3D: [2.91912340327718, 0.0061136586090001, -2.10437255929283\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nNothing else was happening.\u00A0 You can see the differences.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222020-05-15T14:33:43Z\u0022 title=\u002205/15/2020 02:33  PM\u0022 data-short=\u00224 yr\u0022\u003EMay 15, 2020\u003C/time\u003E by linuxgurugamer\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"linuxgurugamer","CreatedById":129964,"CreatedDateTime":"2020-05-17T01:32:10Z","Content":"\n\u003Cp\u003E\nMore strange data.\u00A0 I also dumped the rootPart.transform.position and localPosition:\n\u003C/p\u003E\n\u003Cp\u003E\nAfter initial launch:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003ENeatherdyneMassDriver:  vessel: Bug-E Buggy, GetWorldPos3D: [1086.77102203531, 592.044072977757, 1309.96491621492]\nNeatherdyneMassDriver: rootPart.transform.position: (1086.3, 592.9, 1309.7), localPosition: (1086.3, 592.9, 1309.7)\n\nNeatherdyneMassDriver:  vessel: Bob Kerman, GetWorldPos3D: [499.578002929688, 208.686447143555, 638.983093261719]\nNeatherdyneMassDriver: rootPart.transform.position: (499.7, 208.7, 638.8), localPosition: (499.7, 208.7, 638.8)\n\nNeatherdyneMassDriver:  vessel: m1 Ship, GetWorldPos3D: [466983.310392697, 601047.929188322, -376431.481721794]\nNeatherdyneMassDriver: FlightGlobals.Vessels[i].rootPart is null\n\nNeatherdyneMassDriver:  vessel: M3, GetWorldPos3D: [0.44120117035064, 0.000965883546492917, -0.362673875655871]\nNeatherdyneMassDriver: rootPart.transform.position: (0.0, 0.0, 0.0), localPosition: (0.0, 0.0, 0.0)\n\nNeatherdyneMassDriver:  vessel: M3 Ship, GetWorldPos3D: [11.8329111559249, 0.0257798374724112, -9.52662166945031]\nNeatherdyneMassDriver: rootPart.transform.position: (9.1, 0.0, -7.4), localPosition: (9.1, 0.0, -7.4)\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nStage to drop a rover, did dump:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003ENeatherdyneMassDriver:  vessel: Bug-E Buggy, GetWorldPos3D: [1120.83791006944, 591.739257621672, 1280.74852505534]\nNeatherdyneMassDriver: rootPart.transform.position: (1120.4, 592.6, 1280.5), localPosition: (1120.4, 592.6, 1280.5)\n\nNeatherdyneMassDriver:  vessel: Bob Kerman, GetWorldPos3D: [509.252349853516, 208.381591796875, 631.922424316406]\nNeatherdyneMassDriver: rootPart.transform.position: (509.4, 208.4, 631.8), localPosition: (509.4, 208.4, 631.8)\n\nNeatherdyneMassDriver:  vessel: m1 Ship, GetWorldPos3D: [452741.237589635, 601047.624378752, -393418.124642584]\nNeatherdyneMassDriver: FlightGlobals.Vessels[i].rootPart is null\n\nNeatherdyneMassDriver:  vessel: M3, GetWorldPos3D: [-13.1975449720675, -0.30380933305704, 11.4401824400219]\nNeatherdyneMassDriver: rootPart.transform.position: (-13.6, -0.3, 11.8), localPosition: (-13.6, -0.3, 11.8)\n\nNeatherdyneMassDriver:  vessel: M3 Ship, GetWorldPos3D: [-2.13696753375828, -0.278870520863944, 1.84792338724525]\nNeatherdyneMassDriver: rootPart.transform.position: (-4.8, -0.3, 4.1), localPosition: (-4.8, -0.3, 4.1)\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nNow, Revert to Launch, data dump:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003E\nNeatherdyneMassDriver:  vessel: Bug-E Buggy, GetWorldPos3D: [1198.35686397526, 592.044047439737, 1208.78288220479] \nNeatherdyneMassDriver: rootPart.transform.position: (1197.9, 592.9, 1208.5), localPosition: (1197.9, 592.9, 1208.5)\n\nNeatherdyneMassDriver:  vessel: Bob Kerman, GetWorldPos3D: [554.14453125, 208.686431884766, 592.339294433594]\nNeatherdyneMassDriver: rootPart.transform.position: (554.3, 208.7, 592.2), localPosition: (554.3, 208.7, 592.2)\n\nNeatherdyneMassDriver:  vessel: m1 Ship, GetWorldPos3D: [431876.346159911, 601047.929157477, -416241.400248739]\nNeatherdyneMassDriver: FlightGlobals.Vessels[i].rootPart is null\n \nNeatherdyneMassDriver:  vessel: M3, GetWorldPos3D: [5.14173325152179, 0.0120963886386356, -4.9437057897468]\nNeatherdyneMassDriver: rootPart.transform.position: (0.0, 0.0, 0.0), localPosition: (0.0, 0.0, 0.0)\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nand after the stage:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003ENeatherdyneMassDriver:  vessel: Bug-E Buggy, GetWorldPos3D: [1198.35686397526, 592.044047439737, 1208.78288220479]\nNeatherdyneMassDriver: rootPart.transform.position: (1197.9, 592.9, 1208.5), localPosition: (1197.9, 592.9, 1208.5)\n\nNeatherdyneMassDriver:  vessel: Bob Kerman, GetWorldPos3D: [554.14453125, 208.686431884766, 592.339294433594]\nNeatherdyneMassDriver: rootPart.transform.position: (554.3, 208.7, 592.2), localPosition: (554.3, 208.7, 592.2)\n\nNeatherdyneMassDriver:  vessel: m1 Ship, GetWorldPos3D: [431876.346159911, 601047.929157477, -416241.400248739]\nNeatherdyneMassDriver: FlightGlobals.Vessels[i].rootPart is null\n\nNeatherdyneMassDriver:  vessel: M3, GetWorldPos3D: [0.409642573143623, 0.000956518032801253, -0.391522816661819]\nNeatherdyneMassDriver: rootPart.transform.position: (0.0, 0.0, 0.0), localPosition: (0.0, 0.0, 0.0)\n\nNeatherdyneMassDriver:  vessel: M3 Ship, GetWorldPos3D: [10.9532604016493, 0.0258284093342764, -10.5336008646836]\nNeatherdyneMassDriver: rootPart.transform.position: (8.5, 0.0, -8.1), localPosition: (8.5, 0.0, -8.1)\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nSo, things are wonky after the launch, the values change from before the staging to after.\n\u003C/p\u003E\n\u003Cp\u003E\nAfter the Revert to Launch, the values (which are different from the first set) stay the same between the pre-stage and post-stage\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"CBase","CreatedById":189476,"CreatedDateTime":"2020-05-17T21:50:19Z","Content":"\n\u003Cp\u003E\nI would guess that load and revert do set up the universe differently, and since any choice of origin is arbitrary, does it matter ?\n\u003C/p\u003E\n\u003Cp\u003E\nCompare rootPart.rb.worldCenterOfMass and vessel.mainBody.position with vessel getWorldPos3D: If all change, simply the origin was choosen different.\n\u003C/p\u003E\n"},{"CreatedByName":"Gotmachine","CreatedById":163039,"CreatedDateTime":"2020-05-20T14:46:00Z","Content":"\n\u003Cp\u003E\nGetWorldPos3D() return the position of the vessel \u003Cabbr title=\u0022Center of Mass\u0022\u003ECoM\u003C/abbr\u003E (it just return the Vessel.CoMD field), not the position of the vessel GO transform.\u003Cbr\u003E\nAs for the differences in various states, that is quite normal due to the floating origin system, the rotating/non rotating frame, the physics easing, etc\u003Cbr\u003E\nThere is zero guarantee that the absolute position of things will be the same for a given point in time.\u003Cbr\u003E\nNot sure what you are trying to do in the first place, but as a general rule you can only compare relative positions.\n\u003C/p\u003E\n"},{"CreatedByName":"archer1572","CreatedById":196855,"CreatedDateTime":"2020-06-20T00:38:01Z","Content":"\n\u003Cp\u003E\nEDITED:\u00A0 I had to revisit my old work and I made a few mistakes on my original post.\u00A0 Changes are underlined, corrections are in bold.\n\u003C/p\u003E\n\u003Cp\u003E\nWhen you first load a vessel the world origin is the center of the launch pad (or runway).\u00A0 Once you launch the origin stays stationary for a bit.\u00A0 \u003Cu\u003EWhen the ship is 500 m away\u003C/u\u003E the world origin\u00A0jumps to the current position of the \u003Cu\u003E\u003Cstrong\u003Eroot part\u003C/strong\u003E\u003C/u\u003E, but stays stationary in world space. When \u003Cu\u003Eyou are 500 m away\u003C/u\u003E, it repeats. If you revert to the launchpad the origin begins at the root part\u003Cu\u003E\u00A0\u003C/u\u003Einstead of on the launch pad, but all else stays the same.\u00A0 In either case the process repeats until the ship is \u003Cu\u003E150 m above the ground\u003C/u\u003E, at which point the world origin moves the the position of the \u003Cu\u003E\u003Cstrong\u003Eroot parts\u003C/strong\u003E\u003C/u\u003E and stays there.\u00A0 The position of the ship is the location of the \u003Cu\u003Ecenter of mass\u003C/u\u003E.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nI had originally said it was the command node and center of mass and had which was origin and which was position backwards. I was also able to determine when the switching happens. I have screen shots but I can\u0027t them to upload.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222020-08-26T21:12:16Z\u0022 title=\u002208/26/2020 09:12  PM\u0022 data-short=\u00223 yr\u0022\u003EAugust 26, 2020\u003C/time\u003E by archer1572\u003C/strong\u003E\n\u003Cbr\u003ECorrections and additions\n\u003C/span\u003E\n"}]}