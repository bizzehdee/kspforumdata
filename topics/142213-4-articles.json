{"TopicId":142213,"ForumId":34,"TopicTitle":"PEGAS - Powered Explicit Guidance Ascent System - devlog","CreatedByName":"Reddy","CreatedById":124298,"CreatedDateTime":"2016-06-22T01:03:11Z","PageNum":4,"Articles":[{"CreatedByName":"Jim DiGriz","CreatedById":92465,"CreatedDateTime":"2017-08-22T04:40:33Z","Content":"\n\u003Cp\u003E\nSo the problem is not that bad. \u00A0The typical values vessel.obt_velocity, vessel.body.position, and vessel.\u003Cabbr title=\u0022Center of Mass\u0022\u003ECoM\u003C/abbr\u003E and such are in normal inertal non-rotating worldspace. \u00A0As long as you translate from worldspace to body-centered coordinates it all works out and can be run through PEG.\n\u003C/p\u003E\n\u003Cp\u003E\nWhere it gets weird seems to be isolated to the Orbit class. \u00A0In addition to getting xzy \u0022swizzled\u0022 the velocity values there need to be offset by the frame rotation. \u00A0I think the issue here is that internally KSP is doing things in the rotating reference frame and it is handing those values off to the Orbit class and expecting to get them back in the same rotating frame. \u00A0But most of the values that are exposed on Vessel and CelestialBody are fine.\n\u003C/p\u003E\n\u003Cp\u003E\nWhere I ran into this was that I cheated with my CSE routine by using the Orbit class in KSP directly (which you can\u0027t do in KoS at all). \u00A0Swapping in the CSESimple routine fixed the 145km wobble in my ascents. \u00A0Where I\u0027m winding up now looks something like this:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-c prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003E        \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Eprivate\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Evoid\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E CSEKSP\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan\u003EVector3d\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E r0\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E,\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan\u003EVector3d\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E v0\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E,\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Edouble\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E t\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E,\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E out \u003C/span\u003E\u003Cspan\u003EVector3d\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E rf\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E,\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E out \u003C/span\u003E\u003Cspan\u003EVector3d\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E vf\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E)\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n        \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E{\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n            \u003C/span\u003E\u003Cspan\u003EVector3d\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E rot\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n\n            \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Eif\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E vessel\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Ealtitude \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E\u0026lt;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E mainBody\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003EinverseRotThresholdAltitude \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E)\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n                rot \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E=\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E mainBody\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003EgetRFrmVel\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Er0 \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E\u002B\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E mainBody\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Eposition\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E);\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n            \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Eelse\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n                rot \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E=\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Enew\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan\u003EVector3d\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan class=\u0022lit\u0022\u003E0\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E,\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022lit\u0022\u003E0\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E,\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022lit\u0022\u003E0\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E);\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n\n            \u003C/span\u003E\u003Cspan\u003ECSEorbit\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan\u003EUpdateFromStateVectors\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Er0\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Exzy\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E,\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Ev0 \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E\u002B\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E rot\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E).\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Exzy\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E,\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E mainBody\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E,\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E vesselState\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Etime\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E);\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n            \u003C/span\u003E\u003Cspan\u003ECSEorbit\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan\u003EGetOrbitalStateVectorsAtUT\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003EvesselState\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Etime \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E\u002B\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E t\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E,\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E out rf\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E,\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E out vf\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E);\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n\n            \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Eif\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E vessel\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Ealtitude \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E\u0026lt;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E mainBody\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003EinverseRotThresholdAltitude \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E)\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n                rot \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E=\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E mainBody\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003EgetRFrmVel\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Erf \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E\u002B\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E mainBody\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Eposition\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E);\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n            \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Eelse\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n                rot \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E=\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Enew\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan\u003EVector3d\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan class=\u0022lit\u0022\u003E0\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E,\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022lit\u0022\u003E0\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E,\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022lit\u0022\u003E0\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E);\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n\n            rf \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E=\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E rf\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Exzy\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n            vf \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E=\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E vf\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E.\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Exzy \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E-\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E rot\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n        \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E}\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nI\u0027ve still got a little bit of a wiggle now, but its of the order of 5 degrees and not 30.\n\u003C/p\u003E\n\u003Cp\u003E\nThe only person I know of that really knows this stuff though is \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/57176-taniwha/\u0026amp;do=hovercard\u0022 data-mentionid=\u002257176\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/57176-taniwha/\u0022 rel=\u0022\u0022\u003E@taniwha\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nEDIT: so what i suspect is missing here is that the Earth needs to rotate around the ship and probably rf and mainBody.position are off.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222017-08-22T06:13:08Z\u0022 title=\u002208/22/2017 06:13  AM\u0022 data-short=\u00226 yr\u0022\u003EAugust 22, 2017\u003C/time\u003E by Jim DiGriz\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Pand5461","CreatedById":172084,"CreatedDateTime":"2017-08-22T09:04:56Z","Content":"\n\u003Cp\u003E\nHa! Looks like my \u0022corrections\u0022 increased the rotation instead of compensating it.\n\u003C/p\u003E\n\u003Cp\u003E\nThis is what happens when you adapt formulas written in right-handed inertial frame for left-handed rotating one. (Alleged violation of 2.2g)\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027ll just go brute-force and recompute coordinates like this:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003Efunction chFrame {\n  parameter Vec, oldIx, newIx.\n//changes vector from frame with ix = oldIx, iy = V(0,1,0) to frame with ix = newIx, iy = V(0,1,0)\n//this works under the assumption that all planetary axes are V(0,1,0) in KSP\n//Assumed that oldIx and newIx are Solar Prime Vectors at different moments of time\n  local oldIz to V(-oldIx:z, 0, oldIx:x).\n  local newIz to V(-newIx:z, 0, newIx:x). \n  return vdot(Vec, oldIx)*newIx \u002B vdot(Vec, oldIz)*newIz \u002B Vec:y * V(0,1,0).\n}\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"Jim DiGriz","CreatedById":92465,"CreatedDateTime":"2017-08-22T17:43:10Z","Content":"\n\u003Cp\u003E\nif you avoid using positionat and velocityat in kos you should be able to avoid having to mess with the inverse rotation issues.\n\u003C/p\u003E\n"},{"CreatedByName":"Pand5461","CreatedById":172084,"CreatedDateTime":"2017-08-24T09:12:45Z","Content":"\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/92465-jim-digriz/\u0026amp;do=hovercard\u0022 data-mentionid=\u002292465\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/92465-jim-digriz/\u0022 rel=\u0022\u0022\u003E@Jim DiGriz\u003C/a\u003E I clearly remember that even without state prediction, dVorbit/dt was not mu/R^2. The offset was exactly what\u0027s expected from the rotating coordinate axes.\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027m trying to rewrite PEG for maneuver execution now. Instead of burning the specified deltaV, it takes the trajectory after node as the reference and tries to put the ship onto it. The unbound orbital element in this case is the anomaly, i.e. where on that trajectory ship completes the burn. Compare with the unbound AoP for ascent, i.e. how the SMA is aligned relative to \u003Cabbr title=\u0022Descending Node\u0022\u003EDN\u003C/abbr\u003E-\u003Cabbr title=\u0022Ascending Node\u0022\u003EAN\u003C/abbr\u003E\u00A0 line.\n\u003C/p\u003E\n\u003Cp\u003E\nSo far the result does not seem as much improvement over burning specified \u003Cabbr title=\u0022Delta-V\u0022\u003EdV\u003C/abbr\u003E vector, but the main goal is to test my implementation of the core functions.\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/124298-reddy/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022124298\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/124298-reddy/\u0022 rel=\u0022\u0022\u003E@Reddy\u003C/a\u003E can you explain your logic of control loop convergence? Do you iterate until both Vgo and tgo converged and then update the steering command? I saw in the russian source that new steering vector can be issued right after tgo has converged and Vgo convergence is the condition to start next loop. But that produces side effects when tgo \u0022converges\u0022 to the total fuel burnout time. On the other hand, setting convergence time threshold as absolute value (say, 0.1s) leads to too many iterations initially, while the actual steering direction does not change much between them.\n\u003C/p\u003E\n\u003Cp\u003E\nOn the fun side: tried to understand why my numerical integration-based CSE is off by a few km on 30-second timescale. Realized I just skipped the last integration step.\n\u003C/p\u003E\n"},{"CreatedByName":"Jim DiGriz","CreatedById":92465,"CreatedDateTime":"2017-08-24T17:07:08Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223156048\u0022 data-ipsquote-contentid=\u0022142213\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221503565965\u0022 data-ipsquote-userid=\u0022172084\u0022 data-ipsquote-username=\u0022Pand5461\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n7 hours ago, Pand5461 said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/92465-jim-digriz/\u0026amp;do=hovercard\u0022 data-mentionid=\u002292465\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/92465-jim-digriz/\u0022 rel=\u0022\u0022\u003E@Jim DiGriz\u003C/a\u003E I clearly remember that even without state prediction, dVorbit/dt was not mu/R^2. The offset was exactly what\u0027s expected from the rotating coordinate axes.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nWell, I\u0027ve got a very good replication case of the inverse rotation issue. \u00A0I\u0027ve also debugged nearly all the relevant vectors that I\u0027m using and the only wonkiness I see is isolated to the Orbit class. \u00A0The only place I was using that was in the CSE routine. \u00A0And this makes sense because if the vessel position and velocity or mainbody position, etc were wonky then there would be substantially more issues around players not being able write plane autopilots, hoverslam scripts and other endoatmospheric routines.\n\u003C/p\u003E\n"},{"CreatedByName":"Jim DiGriz","CreatedById":92465,"CreatedDateTime":"2017-08-25T05:37:12Z","Content":"\n\u003Cp\u003E\nWhen it comes to node execution there\u0027s a characteristic time of tlambda = J/L -- the \u0022burn centroid time\u0022 according to 19760024151 -- which i suspect is (close?) to what you should lead the node by to start the burn. \u00A0I haven\u0027t gotten there yet though.\n\u003C/p\u003E\n"},{"CreatedByName":"Pand5461","CreatedById":172084,"CreatedDateTime":"2017-08-26T12:15:14Z","Content":"\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/92465-jim-digriz/\u0026amp;do=hovercard\u0022 data-mentionid=\u002292465\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/92465-jim-digriz/\u0022 rel=\u0022\u0022\u003E@Jim DiGriz\u003C/a\u003E Setting the lead time to J/L actually improved the convergence \u003Cstrong\u003Ea lot\u003C/strong\u003E. Now ship does not try somersaulting from the very beginning. Still wants to misbehave by the end of the burn, but I just restrict magnitude of (lambda dot) * J/L.\n\u003C/p\u003E\n\u003Cp\u003E\nThe accuracy of apses for a stock 6-minute 850 m/s prograde burn is now \u003Cabbr title=\u0022Apoapsis\u0022\u003EAp\u003C/abbr\u003E 10320 km (target 10217), \u003Cabbr title=\u0022Periapsis\u0022\u003EPe\u003C/abbr\u003E 94 km (target 86.75). SMA is rotated by a few degrees unfortunately. I\u0027m trying to find out whether I need to restrict steering a bit more or allow more aggressive steering.\n\u003C/p\u003E\n\u003Cp\u003E\nUPD: restricted magnitude of (lambda dot) * J/L to 0.15, that improved accuracy of maneuver. Test case: cheat craft to 686750m orbit (min available from cheat menu), maneuver node 850m/s with equal NRM and PRG components. Initial \u003Cabbr title=\u0022Thrust-to-weight ratio\u0022\u003ETWR\u003C/abbr\u003E 0.23, \u0022nominal\u0022 burn time 5m35s. Result: plane difference 0.15 degrees, AoP difference about 0.5 degrees, SMA difference about 0.5% (didn\u0027t check eccentricity). \u003Cabbr title=\u0022Apoapsis\u0022\u003EAp\u003C/abbr\u003E accuracy is about 50 km, much better than burning straight along node prograde. However, the maneuver took extra 65-70 m/s.\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027ve noticed also a small error in kOS update procedure. d\u003Cstrong\u003EV\u003C/strong\u003E\u003Csub\u003Esensed\u003C/sub\u003E is the velocity gain measured by accelerometers, so it does not include effect of gravity IRL. So, setting d\u003Cstrong\u003EV\u003C/strong\u003E\u003Csub\u003Esensed\u003C/sub\u003E = \u003Cstrong\u003EV\u003C/strong\u003E\u003Csub\u003Ecurrent\u003C/sub\u003E - \u003Cstrong\u003EV\u003C/strong\u003E\u003Csub\u003Eprevious\u003C/sub\u003E introduces a bias to the initial guess of \u003Cstrong\u003EV\u003C/strong\u003E\u003Csub\u003Ego\u003C/sub\u003E at the start of PEG loop. This gets corrected after one or two iterations of course but convergence is faster if gravity effects are subtracted at loop update routine.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222017-08-26T15:46:37Z\u0022 title=\u002208/26/2017 03:46  PM\u0022 data-short=\u00226 yr\u0022\u003EAugust 26, 2017\u003C/time\u003E by Pand5461\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Jim DiGriz","CreatedById":92465,"CreatedDateTime":"2017-08-26T21:03:07Z","Content":"\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/124298-reddy/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022124298\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/124298-reddy/\u0022 rel=\u0022\u0022\u003E@Reddy\u003C/a\u003E\u00A0is this a bug in your CSE routine? \u00A0\u003Ca href=\u0022https://github.com/Noiredd/PEGAS-MATLAB/blob/master/MATLAB/CSEroutine.m#L98-L99\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/Noiredd/PEGAS-MATLAB/blob/master/MATLAB/CSEroutine.m#L98-L99\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nIt seems like the if should be dropped, and the if prevents the while loop from ever executing... \u00A0(EDIT: and the conditional in the while loop needs reversing)\n\u003C/p\u003E\n\u003Cp\u003E\nAlso in USS the loop is supposed to always execute once, but the k = k \u002B 2 line needs to happen after the check, so I started with your code:\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://github.com/Noiredd/PEGAS-MATLAB/blob/master/MATLAB/CSEroutine.m#L185-L192\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/Noiredd/PEGAS-MATLAB/blob/master/MATLAB/CSEroutine.m#L185-L192\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nBut mine wound up looking like this in c#:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-c prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003E        \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Estatic\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Edouble\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E USS\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Edouble\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E xarg\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E,\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Edouble\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E a\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E,\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan\u003Eint\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E kmax\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E)\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n        \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E{\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n            \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Edouble\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E du1 \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E=\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E xarg\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E/\u003C/span\u003E\u003Cspan class=\u0022lit\u0022\u003E4\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n            \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Edouble\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E u1 \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E=\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E du1\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n            \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Edouble\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E f7 \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E=\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E-\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Ea\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E*\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Edu1\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E*\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Edu1\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n            \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Edouble\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E k\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E=\u003C/span\u003E\u003Cspan class=\u0022lit\u0022\u003E3\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n            \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Ewhile\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Etrue\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E)\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n            \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E{\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n                du1 \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E=\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E f7\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E*\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Edu1 \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E/\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Ek\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E*(\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Ek\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E-\u003C/span\u003E\u003Cspan class=\u0022lit\u0022\u003E1\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E));\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n                \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Edouble\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E u1old \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E=\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E u1\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n                u1 \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E=\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E u1\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E\u002B\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Edu1\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n                \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Eif\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E u1 \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E==\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E u1old \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E)\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n                    \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Ebreak\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n                \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Eif\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E k \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E\u0026gt;=\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E kmax \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E)\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n                    \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Ebreak\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n                k\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E=\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Ek\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E\u002B\u003C/span\u003E\u003Cspan class=\u0022lit\u0022\u003E2\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n            \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E}\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n            \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Ereturn\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E k\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n        \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E}\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222017-08-27T20:11:51Z\u0022 title=\u002208/27/2017 08:11  PM\u0022 data-short=\u00226 yr\u0022\u003EAugust 27, 2017\u003C/time\u003E by Jim DiGriz\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Jim DiGriz","CreatedById":92465,"CreatedDateTime":"2017-08-26T21:15:48Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223157780\u0022 data-ipsquote-contentid=\u0022142213\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221503749714\u0022 data-ipsquote-userid=\u0022172084\u0022 data-ipsquote-username=\u0022Pand5461\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n8 hours ago, Pand5461 said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/92465-jim-digriz/\u0026amp;do=hovercard\u0022 data-mentionid=\u002292465\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/92465-jim-digriz/\u0022 rel=\u0022\u0022\u003E@Jim DiGriz\u003C/a\u003E Setting the lead time to J/L actually improved the convergence \u003Cstrong\u003Ea lot\u003C/strong\u003E. Now ship does not try somersaulting from the very beginning. Still wants to misbehave by the end of the burn, but I just restrict magnitude of (lambda dot) * J/L.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nExcellent. \u00A0I\u0027m still working on getting the CSE routine working fast \u002B in the atmosphere and getting ascents working.\n\u003C/p\u003E\n"},{"CreatedByName":"Jim DiGriz","CreatedById":92465,"CreatedDateTime":"2017-08-26T22:47:42Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223157780\u0022 data-ipsquote-contentid=\u0022142213\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221503749714\u0022 data-ipsquote-userid=\u0022172084\u0022 data-ipsquote-username=\u0022Pand5461\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n10 hours ago, Pand5461 said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/92465-jim-digriz/\u0026amp;do=hovercard\u0022 data-mentionid=\u002292465\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/92465-jim-digriz/\u0022 rel=\u0022\u0022\u003E@Jim DiGriz\u003C/a\u003E Still wants to misbehave by the end of the burn\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nYou need to freeze guidance.\n\u003C/p\u003E\n\u003Cp\u003E\nlambda and lambdaDot should be frozen and you should stop iterating PEG something like 10 seconds before the end of the burn.\n\u003C/p\u003E\n\u003Cp\u003E\nThen you can do something like this:\n\u003C/p\u003E\n\u003Cp\u003E\ndt =\u00A0vesselState.time - last_PEG\n\u003C/p\u003E\n\u003Cp\u003E\niF =\u00A0( lambda \u002B lambdaDot * ( dt\u00A0- J/L\u00A0) ).normalized\n\u003C/p\u003E\n\u003Cp\u003E\nYou can also use that to reduce the frequency you run PEG to reconverge to 1 Hz. \u00A0You can also update tgo and vgo, and can cut the burn when tgo \u0026lt; 0, but practically I find its better to use something like the orbital angular momentum to cut the burn, since bugs in staging/\u003Cabbr title=\u0022Delta-V\u0022\u003EdV\u003C/abbr\u003E/thrust/isp calculations can throw that off.\n\u003C/p\u003E\n\u003Cp\u003E\nDunno what to do yet if the initial time of the burn is less than 10 seconds...\n\u003C/p\u003E\n"},{"CreatedByName":"Pand5461","CreatedById":172084,"CreatedDateTime":"2017-08-27T17:43:59Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223158139\u0022 data-ipsquote-contentid=\u0022142213\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221503787662\u0022 data-ipsquote-userid=\u002292465\u0022 data-ipsquote-username=\u0022Jim DiGriz\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n18 hours ago, Jim DiGriz said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nYou need to freeze guidance.\n\u003C/p\u003E\n\u003Cp\u003E\nlambda and lambdaDot should be frozen and you should stop iterating PEG something like 10 seconds before the end of the burn.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThat\u0027s what I did. Thing is, lambdaDot goes crazy way before 10 seconds to finish. At t\u003Csub\u003Ego\u003C/sub\u003E = 120 sec it has magnitude of over unity, so I need to scale it down. The constraint for \u003Cstrong\u003Er\u003C/strong\u003E\u003Csub\u003Ed\u003C/sub\u003E being on a very specific trajectory is too harsh, I guess. Here\u0027s about as close as I can get:\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cimg alt=\u0022ax3nS0x.png\u0022 class=\u0022ipsImage\u0022 src=\u0022http://i.imgur.com/ax3nS0x.png\u0022\u003E\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223158139\u0022 data-ipsquote-contentid=\u0022142213\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221503787662\u0022 data-ipsquote-userid=\u002292465\u0022 data-ipsquote-username=\u0022Jim DiGriz\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n18 hours ago, Jim DiGriz said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nDunno what to do yet if the initial time of the burn is less than 10 seconds...\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nJust burn maneuver prograde / \u003Cstrong\u003EV\u003C/strong\u003E\u003Csub\u003Ego\u003C/sub\u003E vector, it must be just fine.\n\u003C/p\u003E\n"},{"CreatedByName":"gsarducci","CreatedById":98639,"CreatedDateTime":"2017-08-27T20:35:04Z","Content":"\n\u003Cp\u003E\nI hate to barge in on all this heady math speak, but I\u0027ve got a bit of a question. Well, two actually, which are somewhat related.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nOkay. So First is, I know that I have to have inclination and LAN specified to make things work. Great. I know what inclination is, that\u0027s easy. I have a general understanding of the concept of LAN once in orbit, but that as a function of when to launch I\u0027m a bit confused about. In short, sitting stationary on the ground, I have no idea where I am in relation to a given LAN. So if I want to launch from the Cape at say 0500Z, how do I translate that into a LAN that will launch into that orbit?\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nOr, how do I tell PEGAS to launch into an inclination upon activation of the script? In other words, \u0022I don\u0027t care what my LAN is going to be, let\u0027s light this candle.\u0022\n\u003C/p\u003E\n"},{"CreatedByName":"Pand5461","CreatedById":172084,"CreatedDateTime":"2017-08-27T20:51:49Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223158768\u0022 data-ipsquote-contentid=\u0022142213\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221503866104\u0022 data-ipsquote-userid=\u002298639\u0022 data-ipsquote-username=\u0022gsarducci\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n21 minutes ago, gsarducci said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nOr, how do I tell PEGAS to launch into an inclination upon activation of the script? In other words, \u0022I don\u0027t care what my LAN is going to be, let\u0027s light this candle.\u0022\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThat\u0027s easier. Let\u0027s say you have the inclination \u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003Ei\u003C/span\u003E. Then, the trajectory crosses the meridian at the angle \u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003Exi = arcsin( cos(i)/cos(latitude) )\u003C/span\u003E Then, if you are instantaneously at that orbit, its \u0022virtual\u0022 LAN is given by the following function:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003Efunction azlan {\n  parameter xi.\n  \n  local Vvirt to heading(xi, 0):vector.\n  local nvirt to vcrs(body:position, Vvirt).\n  local ANvirt to vcrs(nvirt, V(0,1,0)).\n  local vlan to arctan2( vdot( V(0,1,0), vcrs(ANvirt, solarprimevector) ), vdot(ANvirt, solarprimevector) ).\n  if vlan\u0026lt;0 set vlan to vlan\u002B360.\n  return vlan.\n}\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nAs \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/124298-reddy/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022124298\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/124298-reddy/\u0022 rel=\u0022\u0022\u003E@Reddy\u003C/a\u003E mentioned, he planned launches 8 minutes before orbit passes over launch site, which translates into Earth rotation by 2 degrees. Therefore, adding 2 degrees (maybe 2.5, to be on the safe side) to the calculated value is more or less what you want.\n\u003C/p\u003E\n\u003Cp\u003E\nEDIT: if you want to launch at other time than \u0022now\u0022, just calculate angle of rotation as 360*(ETA to launch)/body:rotationperiod and add that to previous calculation.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222017-08-27T20:58:46Z\u0022 title=\u002208/27/2017 08:58  PM\u0022 data-short=\u00226 yr\u0022\u003EAugust 27, 2017\u003C/time\u003E by Pand5461\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"gsarducci","CreatedById":98639,"CreatedDateTime":"2017-08-27T22:12:25Z","Content":"\n\u003Cp\u003E\nIs there any way to have PEGAS launch to an inclination regardless of LAN?\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nEDIT the edit:\n\u003C/p\u003E\n\u003Cp\u003E\nDerp. Imadork. Would help if I solved for degrees and not rads.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222017-08-27T22:27:17Z\u0022 title=\u002208/27/2017 10:27  PM\u0022 data-short=\u00226 yr\u0022\u003EAugust 27, 2017\u003C/time\u003E by gsarducci\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"gsarducci","CreatedById":98639,"CreatedDateTime":"2017-08-28T19:34:43Z","Content":"\n\u003Cp\u003E\nI think I missed something here. How can I see the value of \u0022vlan\u0022 or practically apply it to my solution? Running that program that you gave to me doesn\u0027t display a solution, it just simply runs and ends. I assume the value went somewhere, just not into my brain. \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u00A0Is this something intended to drop into my mission.ks script in lieu of an actual LAN entry?\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nEDIT: Also, when applying your equation to solve for value xi, how then do I apply that solution to the program cited? Simply replacing xi with an integer value breaks the program. My assumption is that the program takes the solution for xi and outputs the LAN for an instantaneous launch, thus I would need to add some \u0022slop\u0022 to it considering rate of rotation for a launch time using the equation you put in your edit?\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nThanks for your patience with this Pand5461. I am learning a lot with this!\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222017-08-28T19:42:21Z\u0022 title=\u002208/28/2017 07:42  PM\u0022 data-short=\u00226 yr\u0022\u003EAugust 28, 2017\u003C/time\u003E by gsarducci\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Pand5461","CreatedById":172084,"CreatedDateTime":"2017-08-29T09:51:45Z","Content":"\n\u003Cp\u003E\nThis should print vlan out:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003Eset xi to arcsin( cos(incl)/cos(latitude) ).\nset vlan to azlan(xi).\nset launch_now_lan to vlan \u002B 2.5.\nprint launch_now_lan.\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nInclination must be higher than latitude of course and azlan function must be loaded to work of course.\n\u003C/p\u003E\n"},{"CreatedByName":"gsarducci","CreatedById":98639,"CreatedDateTime":"2017-08-29T22:31:53Z","Content":"\n\u003Cp\u003E\nExcellent. Thanks for that. I think I can see how this all fits together now. Hopefully I can give it a shot tonight when I get home.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nSince I\u0027ve got your ear I have two unrelated questions.\u00A0First, I am curious if there is a way to impart a spin on a stage prior to stage/ignition. I am launching a Thor-Delta with a Telstar type satellite. The third solid fueled stage is spin stabilized but I don\u0027t see a way to command the program to \u0022spin up\u0022 the second stage prior to release.\n\u003C/p\u003E\n\u003Cp\u003E\nSecond is a roll program. Given that the spacecraft is pointing directly up, I believe the best solution for a roll while heading vertical would be a directional roll without regard to heading, so say roll left 24 degrees and stabilize, followed by a specific roll lock of \u00220\u0022 (or whatever is appropriate) once pitchover is initiated and a horizon is established.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nBoth of these questions aren\u0027t so much \u0022how do I do it\u0022, but more \u0022how or can I do it within the confines of the PEGAS routine?\u0022\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nAlso, I\u0027m gonna need to know where to send your bottle of 14 year old scotch when you\u0027re done educating me!\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222017-08-29T22:43:50Z\u0022 title=\u002208/29/2017 10:43  PM\u0022 data-short=\u00226 yr\u0022\u003EAugust 29, 2017\u003C/time\u003E by gsarducci\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Jim DiGriz","CreatedById":92465,"CreatedDateTime":"2017-09-01T00:05:22Z","Content":"\n\u003Cp\u003E\nChallenge: \u00A0can anyone get this craft file into orbit with PEGAS?\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://gist.github.com/cb281f07dd7b4d4da0ac970d69ed13e7\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://gist.github.com/cb281f07dd7b4d4da0ac970d69ed13e7\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nYou\u0027ll need \u003Cabbr title=\u0022Real Solar System (mod)\u0022\u003ERSS\u003C/abbr\u003E/\u003Cabbr title=\u0022Realism Overhaul (mod)\u0022\u003ERO\u003C/abbr\u003E and RealScaleBoosters. \u00A0That is the RSB Atlas V HLV with enough payload on it to push the SLT of the first stage down to 1.05 so that it only crawls off the launchpad. \u00A0I get PEG convergence, but it never makes orbit, once it gets to the upper stage it needs a pitch of 40 degrees and the vgo starts continually increasing and it falls back into the atmosphere. \u00A0Wondering if its my implementation of PEG, or if I\u0027ve simply built a rocket that will never make orbit, or if it takes a particular launch profile to make it, or if the PEG algorithm itself has limitations. \u00A0Squinting at it, perhaps the 1.05 SLT costs so much in gravity losses that there\u0027s not enough \u003Cabbr title=\u0022Delta-V\u0022\u003EdV\u003C/abbr\u003E in the higher \u003Cabbr title=\u0022Thrust-to-weight ratio\u0022\u003ETWR\u003C/abbr\u003E stages to get it \u0027lofted\u0027 enough for the 0.60 \u003Cabbr title=\u0022Thrust-to-weight ratio\u0022\u003ETWR\u003C/abbr\u003E upper stage to ever make orbit.\n\u003C/p\u003E\n\u003Cp\u003E\nAnd it should have a 1.13 starting vac \u003Cabbr title=\u0022Thrust-to-weight ratio\u0022\u003ETWR\u003C/abbr\u003E, 1.05 starting SLT 2814 \u003Cabbr title=\u0022Delta-V\u0022\u003EdV\u003C/abbr\u003E first stage, a 0.98 starting \u003Cabbr title=\u0022Thrust-to-weight ratio\u0022\u003ETWR\u003C/abbr\u003E 2261 \u003Cabbr title=\u0022Delta-V\u0022\u003EdV\u003C/abbr\u003E \u0022sustainer\u0022, and 0.61 starting \u003Cabbr title=\u0022Thrust-to-weight ratio\u0022\u003ETWR\u003C/abbr\u003E 8763 \u003Cabbr title=\u0022Delta-V\u0022\u003EdV\u003C/abbr\u003E upper stage for 13838 vac \u003Cabbr title=\u0022Delta-V\u0022\u003EDV\u003C/abbr\u003E total.\n\u003C/p\u003E\n\u003Cp\u003E\n(and i understand this is a faintly ridiculous rocket, but i\u0027m trying to figure out how to determine more analytically why it is ridiculous...)\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222017-09-01T00:17:00Z\u0022 title=\u002209/01/2017 12:17  AM\u0022 data-short=\u00226 yr\u0022\u003ESeptember 1, 2017\u003C/time\u003E by Jim DiGriz\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"ubik2","CreatedById":180586,"CreatedDateTime":"2017-09-01T05:01:55Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223158067\u0022 data-ipsquote-contentid=\u0022142213\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221503781387\u0022 data-ipsquote-userid=\u002292465\u0022 data-ipsquote-username=\u0022Jim DiGriz\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nOn 8/26/2017 at 2:03 PM, Jim DiGriz said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nBut mine wound up looking like this in c#:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-c prettyprinted\u0022\u003E\n\n\u003Cspan class=\u0022pln\u0022\u003E        \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Estatic\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Edouble\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E USS\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Edouble\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E xarg\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E,\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Edouble\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E a\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E,\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan\u003Eint\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E kmax\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E)\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n        \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E{\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n            \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Edouble\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E du1 \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E=\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E xarg\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E/\u003C/span\u003E\u003Cspan class=\u0022lit\u0022\u003E4\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n            \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Edouble\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E u1 \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E=\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E du1\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n            \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Edouble\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E f7 \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E=\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E-\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Ea\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E*\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Edu1\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E*\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Edu1\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n            \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Edouble\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E k\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E=\u003C/span\u003E\u003Cspan class=\u0022lit\u0022\u003E3\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n            \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Ewhile\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Etrue\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E)\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n            \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E{\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n                du1 \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E=\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E f7\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E*\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Edu1 \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E/\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Ek\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E*(\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Ek\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E-\u003C/span\u003E\u003Cspan class=\u0022lit\u0022\u003E1\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E));\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n                \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Edouble\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E u1old \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E=\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E u1\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n                u1 \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E=\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E u1\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E\u002B\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Edu1\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n                \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Eif\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E u1 \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E==\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E u1old \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E)\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n                    \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Ebreak\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n                \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Eif\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E(\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E k \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E\u0026gt;=\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E kmax \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E)\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n                    \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Ebreak\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n                k\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E=\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003Ek\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E\u002B\u003C/span\u003E\u003Cspan class=\u0022lit\u0022\u003E2\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n            \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E}\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n            \u003C/span\u003E\u003Cspan class=\u0022kwd\u0022\u003Ereturn\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E k\u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E;\u003C/span\u003E\u003Cspan class=\u0022pln\u0022\u003E\n        \u003C/span\u003E\u003Cspan class=\u0022pun\u0022\u003E}\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nI\u0027m guessing this was just in the forum version, but I figured I\u0027d point out that you probably want to return u1, rather than k.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"Starwaster","CreatedById":71262,"CreatedDateTime":"2017-09-01T06:02:15Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223162048\u0022 data-ipsquote-contentid=\u0022142213\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221504224322\u0022 data-ipsquote-userid=\u002292465\u0022 data-ipsquote-username=\u0022Jim DiGriz\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n16 hours ago, Jim DiGriz said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nChallenge: \u00A0can anyone get this craft file into orbit with PEGAS?\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://gist.github.com/cb281f07dd7b4d4da0ac970d69ed13e7\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://gist.github.com/cb281f07dd7b4d4da0ac970d69ed13e7\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nYou\u0027ll need \u003Cabbr title=\u0022Real Solar System (mod)\u0022\u003ERSS\u003C/abbr\u003E/\u003Cabbr title=\u0022Realism Overhaul (mod)\u0022\u003ERO\u003C/abbr\u003E and RealScaleBoosters. \u00A0That is the RSB Atlas V HLV with enough payload on it to push the SLT of the first stage down to 1.05 so that it only crawls off the launchpad. \u00A0I get PEG convergence, but it never makes orbit, once it gets to the upper stage it needs a pitch of 40 degrees and the vgo starts continually increasing and it falls back into the atmosphere. \u00A0Wondering if its my implementation of PEG, or if I\u0027ve simply built a rocket that will never make orbit, or if it takes a particular launch profile to make it, or if the PEG algorithm itself has limitations. \u00A0Squinting at it, perhaps the 1.05 SLT costs so much in gravity losses that there\u0027s not enough \u003Cabbr title=\u0022Delta-V\u0022\u003EdV\u003C/abbr\u003E in the higher \u003Cabbr title=\u0022Thrust-to-weight ratio\u0022\u003ETWR\u003C/abbr\u003E stages to get it \u0027lofted\u0027 enough for the 0.60 \u003Cabbr title=\u0022Thrust-to-weight ratio\u0022\u003ETWR\u003C/abbr\u003E upper stage to ever make orbit.\n\u003C/p\u003E\n\u003Cp\u003E\nAnd it should have a 1.13 starting vac \u003Cabbr title=\u0022Thrust-to-weight ratio\u0022\u003ETWR\u003C/abbr\u003E, 1.05 starting SLT 2814 \u003Cabbr title=\u0022Delta-V\u0022\u003EdV\u003C/abbr\u003E first stage, a 0.98 starting \u003Cabbr title=\u0022Thrust-to-weight ratio\u0022\u003ETWR\u003C/abbr\u003E 2261 \u003Cabbr title=\u0022Delta-V\u0022\u003EdV\u003C/abbr\u003E \u0022sustainer\u0022, and 0.61 starting \u003Cabbr title=\u0022Thrust-to-weight ratio\u0022\u003ETWR\u003C/abbr\u003E 8763 \u003Cabbr title=\u0022Delta-V\u0022\u003EdV\u003C/abbr\u003E upper stage for 13838 vac \u003Cabbr title=\u0022Delta-V\u0022\u003EDV\u003C/abbr\u003E total.\n\u003C/p\u003E\n\u003Cp\u003E\n(and i understand this is a faintly ridiculous rocket, but i\u0027m trying to figure out how to determine more analytically why it is ridiculous...)\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nNot going to happen, not on that rocket and you\u0027ve already touched on the reasons why. Your payload of 170 tons means that you\u0027re only going to get about 3000m/s \u003Cabbr title=\u0022Delta-V\u0022\u003EDV\u003C/abbr\u003E\u00A0 before the Centaur stage starts up\u00A0and whether it goes shallow or steep, most of that is eaten up by gravity losses. The Atlas V Heavy only had a hypothetical payload capacity of 30 tons. 170 is just not going to happen, not even to LEO\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222017-09-01T16:17:36Z\u0022 title=\u002209/01/2017 04:17  PM\u0022 data-short=\u00226 yr\u0022\u003ESeptember 1, 2017\u003C/time\u003E by Starwaster\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Jim DiGriz","CreatedById":92465,"CreatedDateTime":"2017-09-01T17:35:39Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223162210\u0022 data-ipsquote-contentid=\u0022142213\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221504242115\u0022 data-ipsquote-userid=\u0022180586\u0022 data-ipsquote-username=\u0022ubik2\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n12 hours ago, ubik2 said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cblockquote data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223158067\u0022 data-ipsquote-contentid=\u0022142213\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221503781387\u0022 data-ipsquote-userid=\u002292465\u0022 data-ipsquote-username=\u0022Jim DiGriz\u0022 style=\u0022border-color:#ededed #e8e8e8 #dbdbdb #666666;border-style:solid;border-width:1px 1px 1px 2px;color:#353c41;font-size:14px;padding:0px 15px;\u0022\u003E\n\u003Cdiv\u003E\n\u003Cp\u003E\nI\u0027m guessing this was just in the forum version, but I figured I\u0027d point out that you probably want to return u1, rather than k.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nnope, it wasn\u0027t, although i figured that out as well.\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223162231\u0022 data-ipsquote-contentid=\u0022142213\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221504245735\u0022 data-ipsquote-userid=\u002271262\u0022 data-ipsquote-username=\u0022Starwaster\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n11 hours ago, Starwaster said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nNot going to happen, not on that rocket and you\u0027ve already touched on the reasons why. Your payload of 170 tons means that you\u0027re only going to get about 3000m/s \u003Cabbr title=\u0022Delta-V\u0022\u003EDV\u003C/abbr\u003E\u00A0 before the Centaur stage starts up\u00A0and whether it goes shallow or steep, most of that is eaten up by gravity losses. The Atlas V Heavy only had a hypothetical payload capacity of 30 tons. 170 is just not going to happen, not even to LEO\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nYeah, although if I back it off to 22t to LEO it wigs out completely as well so its both that i\u0027ve got bugs and that rocket never would have made it to orbit.\n\u003C/p\u003E\n"},{"CreatedByName":"Jim DiGriz","CreatedById":92465,"CreatedDateTime":"2017-09-02T22:33:06Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223158631\u0022 data-ipsquote-contentid=\u0022142213\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221503855839\u0022 data-ipsquote-userid=\u0022172084\u0022 data-ipsquote-username=\u0022Pand5461\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nOn 8/27/2017 at 10:43 AM, Pand5461 said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nThat\u0027s what I did. Thing is, lambdaDot goes crazy way before 10 seconds to finish. At t\u003Csub\u003Ego\u003C/sub\u003E = 120 sec it has magnitude of over unity, so I need to scale it down. The constraint for \u003Cstrong\u003Er\u003C/strong\u003E\u003Csub\u003Ed\u003C/sub\u003E being on a very specific trajectory is too harsh, I guess. Here\u0027s about as close as I can get:\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nI think I\u0027m seeing something like this on ascents as well. \u00A0With that Atlas V HLV with the payload tweaked to need a few hundred \u003Cabbr title=\u0022Delta-V\u0022\u003EdV\u003C/abbr\u003E out of the upper centaur stage it has all kinds of difficulties, and behaves similarly to what you describe with lambdaDot freaking out, and the craft starts to spin. \u00A0Trying to constrain lambdaDot doesn\u0027t seem to help either. \u00A0I\u0027m wondering if the PEG predictor needs to be replaced by a proper 4th order RK integrator with proper transversality constraints between the stages.\n\u003C/p\u003E\n"},{"CreatedByName":"Jim DiGriz","CreatedById":92465,"CreatedDateTime":"2017-09-05T17:52:53Z","Content":"\n\u003Cp\u003E\nOkay, I think I\u0027ve got PEGAS more or less working in MechJeb now, although, its a mix of PEGAS and PEG-4 code (PEGAS steering and corrector, with PEG-4 thrust integrals and rthrust/vthrust integration).\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027m still seeing odd effects in the case of having burnout use a bit of a low-\u003Cabbr title=\u0022Thrust-to-weight ratio\u0022\u003ETWR\u003C/abbr\u003E \u0022TLI\u0022 stage after a high-\u003Cabbr title=\u0022Thrust-to-weight ratio\u0022\u003ETWR\u003C/abbr\u003E upper stage. \u00A0I suspect the problem is the rthrust/vthrust expansion and that higher order terms need to be kept.\n\u003C/p\u003E\n\u003Cp\u003E\nThere\u0027s an updated approach to PEG in these references which has some good background:\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://arc.aiaa.org/doi/10.2514/3.25350\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://arc.aiaa.org/doi/10.2514/3.25350\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022http://www.sciencedirect.com/science/article/pii/0094576589900969\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://www.sciencedirect.com/science/article/pii/0094576589900969\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nMost of the launch I\u0027m seeing the tangent angle at 45 degrees which produces a lot of errors and as a result the arc is too high and it wants to burn to too high of a periapsis and then pitch down and burn at high thrust, and the error created by the high \u003Cabbr title=\u0022Thrust-to-weight ratio\u0022\u003ETWR\u003C/abbr\u003E booster produces a bit crazy need to burn straight down in the low-\u003Cabbr title=\u0022Thrust-to-weight ratio\u0022\u003ETWR\u003C/abbr\u003E centaur to make up the difference. \u00A0And at 45 degrees of tangent angle the error estimate in the pitch angle is about 30% according to those authors, with a lot of improvement from keeping the 2nd or 3rd order terms in the expansion. \u00A0I haven\u0027t validated if PEGAS\u0027s kOS or MATLAB code sees this same behavior.\n\u003C/p\u003E\n\u003Cp\u003E\nAlso the best paper I\u0027ve found so far on PEG\u0027s mathematical background is:\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://arc.aiaa.org/doi/abs/10.2514/6.1977-1051\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://arc.aiaa.org/doi/abs/10.2514/6.1977-1051\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nThat covers a lot of ground that the Journal of the Astronautical Sciences paper glosses over a bit (\u003Ca href=\u0022https://ntrs.nasa.gov/search.jsp?R=19790048206\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://ntrs.nasa.gov/search.jsp?R=19790048206\u003C/a\u003E)\n\u003C/p\u003E\n"},{"CreatedByName":"ubik2","CreatedById":180586,"CreatedDateTime":"2017-09-06T05:41:36Z","Content":"\n\u003Cp\u003E\nI\u0027ve been using kRPC to automate my rockets, and wanted to get this system integrated.\n\u003C/p\u003E\n\u003Cp\u003E\nI ended up porting Noiredd\u0027s\u00A0MATLAB repository to python, and made it available, in case it\u0027s useful to others\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://github.com/ubik2/PEGAS-kRPC\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/ubik2/PEGAS-kRPC\u003C/a\u003E\n\u003C/p\u003E\n"},{"CreatedByName":"Reddy","CreatedById":124298,"CreatedDateTime":"2017-10-08T17:48:44Z","Content":"\n\u003Cp\u003E\nI am sorry I was absent for a while. As some of you might know, I am a PhD student - there are periods where I simply don\u0027t have time to pay attention to PEGAS and this thread.\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027ve just pushed some updates to the main repository, here\u0027s the list of new features:\n\u003C/p\u003E\n\u003Cul\u003E\u003Cli\u003E\nroll control - you can define initial roll (vehicle will roll to that angle during the initial pitchover maneuver) via \u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003Econtrols[\u0022initialRoll\u0022]\u003C/span\u003E, and then control the vehicle\u0027s attitude using \u003Ca href=\u0022https://github.com/Noiredd/PEGAS/blob/master/docs/reference.md#sequence\u0022 rel=\u0022external nofollow\u0022\u003Eevents\u003C/a\u003E,\n\u003C/li\u003E\n\u003Cli\u003E\nbetter throttle handling - \u003Cabbr title=\u0022Realism Overhaul (mod)\u0022\u003ERO\u003C/abbr\u003E does not treat the throttle slider in an absolute way: 50% slider does not correspond to 50% throttle, but 50% of\u00A0\u003Cem\u003Ethrottle range that an engine allows\u003C/em\u003E. PEGAS can now handle this (fixing issues with g-limited stages), at the expense of users having to input an additional key (\u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003E\u0022minThrottle\u0022\u003C/span\u003E) along the \u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003E\u0022gLim\u0022\u003C/span\u003E in their stage definitions,\n\u003C/li\u003E\n\u003Cli\u003E\nnew event type: jettison - allows user to inform the system of the amount of mass lost in a staging event, which is also important in acceleration-limited stages (eg. if a stage\u0027s dry mass included fairings, and then these were jettisoned, the vehicle will weigh less than PEGAS planned for - as a consequence, throttle will be lowered at a slower than expected rate, consuming fuel slower, causing the engine shutdown later than PEGAS scheduled the next stage ignition: as an effect, the constant-acceleration stage could smash into the next stage),\n\u003C/li\u003E\n\u003Cli\u003E\nseveral minor tweaks: PEGAS will change the control part to the currently running terminal on boot, lack of \u003Cspan style=\u0022font-family:\u0027Courier New\u0027, Courier, monospace;\u0022\u003E\u0022message\u0022\u003C/span\u003E key in user event will no longer cause it to crash, etc.\n\u003C/li\u003E\n\u003C/ul\u003E\u003Cp\u003E\nWe\u0027re almost halfway to the 1.1 release, which will include also the following features:\n\u003C/p\u003E\n\u003Cul\u003E\u003Cli\u003E\nlaunch with no LAN constraint (something like a \u0022launch now\u0022 function - LAN will still be constrained, but it will be hidden from user and dynamically calculated),\n\u003C/li\u003E\n\u003Cli\u003E\nlaunch opportunities (ability to pick northerly or southerly launch, together with the option \u0022nearest from now\u0022),\n\u003C/li\u003E\n\u003Cli\u003E\nbetter atmospheric ascent control (I\u0027m thinking of something akin to aim points for optional, additional control over pitch during early ascent).\n\u003C/li\u003E\n\u003C/ul\u003E\u003Cp\u003E\nI\u0027ll read up on that thread later and try to reply you guys \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u003C/p\u003E\n"}]}