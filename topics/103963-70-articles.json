{"TopicId":103963,"ForumId":36,"TopicTitle":"[WIP][1.9.x-1.12.x] Scatterer-atmospheric scattering (0.0838 - 14/08/2022) Scattering improvements, in-game atmo generation and multi-sun support","CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-04-12T08:37:35Z","PageNum":70,"Articles":[{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-10-27T21:13:01Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Gaalidas\u0022 data-cite=\u0022Gaalidas\u0022\u003E\u003Cdiv\u003ERight, more stuff to work with \u003Cem\u003Eand\u003C/em\u003E more stuff to cause you to pull your hair out from. Looking awesome though. Wish I wasn\u0027t on a non-gaming laptop computer, or I\u0027d install this stuff in a heartbeat. As it is, if I tried to compress the process into a heartbeat, I\u0027d be dead.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EIt could be a lot of fun actually, I think SQUAD could enable physically based rendering and HDR for everything.\u003C/p\u003E\n"},{"CreatedByName":"sDaZe","CreatedById":111181,"CreatedDateTime":"2015-10-28T00:59:09Z","Content":"\n\u003Cp\u003EHey Blackrack, have you worked on that duna sunrise and sunset yet? Or do you plan to soon\u003C/p\u003E\n"},{"CreatedByName":"pingopete","CreatedById":74168,"CreatedDateTime":"2015-10-28T07:10:48Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022blackrack\u0022 data-cite=\u0022blackrack\u0022\u003E\u003Cdiv\u003EI was working on this but didn\u0027t release it.\u003Cp\u003EMy internship ends soon and I\u0027m going to have loads and loads of free time while I figure out what to do next/obtain a new visa. Basically, expect daily updates in december and lots of the good stuff I\u0027ve been promising for a while around christmas and in January.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EAwesome! Thanks for your work!\u003C/p\u003E\n"},{"CreatedByName":"RandomRyan","CreatedById":142844,"CreatedDateTime":"2015-11-01T10:19:22Z","Content":"\n\u003Cp\u003Edoes this add clouds?\u003C/p\u003E\n"},{"CreatedByName":"Red Iron Crown","CreatedById":12858,"CreatedDateTime":"2015-11-01T11:40:28Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022RandomRyan\u0022 data-cite=\u0022RandomRyan\u0022\u003E\u003Cdiv\u003Edoes this add clouds?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ENo. Environmental Visual Enhancements is the mod for that.\u003C/p\u003E\n"},{"CreatedByName":"cobbman11","CreatedById":76711,"CreatedDateTime":"2015-11-03T04:17:12Z","Content":"\n\u003Cp\u003EAll I want for Christmas are Scatterer updates.\u003C/p\u003E\n"},{"CreatedByName":"rbray89","CreatedById":48847,"CreatedDateTime":"2015-11-04T22:04:18Z","Content":"\n\u003Cp\u003EThought of a way to get the moon to show clearly through the sky... My plan is to add another material on-top of the scaled space terrain material that will be a multiplicative shader to enhance the terminator and illuminate the body more. Then we just put the shader on the Transparent-1 queue. Should show up before the clouds, but after the atmosphere \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"sashan","CreatedById":98897,"CreatedDateTime":"2015-11-05T12:17:00Z","Content":"\n\u003Cp\u003EOne question - why doesn\u0027t Scatterer effect show up on top of EVE clouds? CLouds all the way up to horison look weird, especially when there are some mountains on the horizon.\u003C/p\u003E\u003Cp\u003EI use old .25 EVE. New one is too buggy for me.\u003C/p\u003E\n"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-11-05T13:32:17Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022rbray89\u0022 data-cite=\u0022rbray89\u0022\u003E\u003Cdiv\u003EThought of a way to get the moon to show clearly through the sky... My plan is to add another material on-top of the scaled space terrain material that will be a multiplicative shader to enhance the terminator and illuminate the body more. Then we just put the shader on the Transparent-1 queue. Should show up before the clouds, but after the atmosphere \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ESo basically it\u0027s a multiplicative shader, would it cover all of the body or only the illuminated parts? Also, probably this would require HDR for correct rendering but no problem with that, HDR works fine in scaled space however I couldn\u0027t think of a way to make the terrain scaled space shaders render in higher intensities so HDR would really mask the dark areas of a body.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022sashan\u0022 data-cite=\u0022sashan\u0022\u003E\u003Cdiv\u003EOne question - why doesn\u0027t Scatterer effect show up on top of EVE clouds? CLouds all the way up to horison look weird, especially when there are some mountains on the horizon.\u003Cp\u003EI use old .25 EVE. New one is too buggy for me.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EBecause the clouds don\u0027t write to the depth buffer. I actually thought clouds all the way to the horizon look weird also. I thought about this a bit a while ago and I think the easiest way to simulate this would be to modifiy the EVE clouds shader and make the clouds fade out towards the horizon/depending on viewing angle, distance to clouds and camera altitude.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-11-05T13:46:34Z\u0022 title=\u002211/05/2015 01:46  PM\u0022 data-short=\u00228 yr\u0022\u003ENovember 5, 2015\u003C/time\u003E by blackrack\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"rbray89","CreatedById":48847,"CreatedDateTime":"2015-11-05T15:18:35Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022blackrack\u0022 data-cite=\u0022blackrack\u0022\u003E\u003Cdiv\u003ESo basically it\u0027s a multiplicative shader, would it cover all of the body or only the illuminated parts? Also, probably this would require HDR for correct rendering but no problem with that, HDR works fine in scaled space however I couldn\u0027t think of a way to make the terrain scaled space shaders render in higher intensities so HDR would really mask the dark areas of a body.\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EExactly. It would cover everything basically, as it goes into the materials list. This is how I\u0027m doing city lights now so I am not forced to replace the terrain shader. It wouldn\u0027t require HDR, but I think it would make it look better. I\u0027m excited, this should work really well \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022blackrack\u0022 data-cite=\u0022blackrack\u0022\u003E\u003Cdiv\u003EBecause the clouds don\u0027t write to the depth buffer. I actually thought clouds all the way to the horizon look weird also. I thought about this a bit a while ago and I think the easiest way to simulate this would be to modifiy the EVE clouds shader and make the clouds fade out towards the horizon/depending on viewing angle, distance to clouds and camera altitude.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EEVE does some basic stuff around this (View.Normal), but I always wanted to go back and improve it.\u003C/p\u003E\n"},{"CreatedByName":"HerrGeneral","CreatedById":63453,"CreatedDateTime":"2015-11-05T17:40:04Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022rbray89\u0022 data-cite=\u0022rbray89\u0022\u003E\u003Cdiv\u003EThought of a way to get the moon to show clearly through the sky... My plan is to add another material on-top of the scaled space terrain material that will be a multiplicative shader to enhance the terminator and illuminate the body more. Then we just put the shader on the Transparent-1 queue. Should show up before the clouds, but after the atmosphere \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI think if you enhance it too much it\u0027d look weird, though. Look at the Moon in the daytime sky sometime- it\u0027s very low contrast with respect to the scattered background, and blends in fairly well if you\u0027re not looking for it. I would really like to see an enhanced, sharper terminator though- the current one on airless bodies is very diffuse and undefined, although this is kind of a side effect of how small Kerbal celestial bodies are.\u003C/p\u003E\n"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-11-05T17:55:16Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022HerrGeneral\u0022 data-cite=\u0022HerrGeneral\u0022\u003E\u003Cdiv\u003EI think if you enhance it too much it\u0027d look weird, though. Look at the Moon in the daytime sky sometime- it\u0027s very low contrast with respect to the scattered background, and blends in fairly well if you\u0027re not looking for it. I would really like to see an enhanced, sharper terminator though- the current one on airless bodies is very diffuse and undefined, although this is kind of a side effect of how small Kerbal celestial bodies are.\u003C/div\u003E\u003C/blockquote\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022rbray89\u0022 data-cite=\u0022rbray89\u0022\u003E\u003Cdiv\u003EExactly. It would cover everything basically, as it goes into the materials list. This is how I\u0027m doing city lights now so I am not forced to replace the terrain shader. It wouldn\u0027t require HDR, but I think it would make it look better. I\u0027m excited, this should work really well \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI think in the end it\u0027s all about trial and error and playing with the settings until it looks right. What I\u0027m concerned about is making the dark parts of the moon invisible from the atmosphere, I\u0027m not sure if your method would help with this, even with HDR, as everything (dark and light areas) will get multiplied by the same amount. Though I can imagine making a quick approximation that lights the light areas and leaves the rest as is (based on direction of the sun), or does the opposite.\u003C/p\u003E\n"},{"CreatedByName":"sashan","CreatedById":98897,"CreatedDateTime":"2015-11-05T18:32:35Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022HerrGeneral\u0022 data-cite=\u0022HerrGeneral\u0022\u003E\u003Cdiv\u003EI think if you enhance it too much it\u0027d look weird, though. Look at the Moon in the daytime sky sometime- it\u0027s very low contrast with respect to the scattered background, and blends in fairly well if you\u0027re not looking for it. I would really like to see an enhanced, sharper terminator though- the current one on airless bodies is very diffuse and undefined, although this is kind of a side effect of how small Kerbal celestial bodies are.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ENo, current terminator is the effect of terrain not casting shadows.\u003C/p\u003E\n"},{"CreatedByName":"rbray89","CreatedById":48847,"CreatedDateTime":"2015-11-05T18:41:56Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022blackrack\u0022 data-cite=\u0022blackrack\u0022\u003E\u003Cdiv\u003EI think in the end it\u0027s all about trial and error and playing with the settings until it looks right. What I\u0027m concerned about is making the dark parts of the moon invisible from the atmosphere, I\u0027m not sure if your method would help with this, even with HDR, as everything (dark and light areas) will get multiplied by the same amount. Though I can imagine making a quick approximation that lights the light areas and leaves the rest as is (based on direction of the sun), or does the opposite.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThat\u0027s the beauty of it though... we could do all sorts of funny things with it. I\u0027ve been messing around with blending (I finally understand how it works now! ) One thought I had, was encoding an \u0022Visibility\u0022 metric into the alpha channel of rendered stuff for Scatterer to use (This doesn\u0027t seem to affect rendering otherwise). Then scaterer could use the DestAlpha multiplier with blending instead of OneMinusSourceAlpha. BTW, the \u0022OneMinusSourceAlpha\u0022 helps ensures lerp-like blending. If you want, you can use \u0022One\u0022 there to allow more background through, thought it may overpower things to white.\u003C/p\u003E\n"},{"CreatedByName":"sashan","CreatedById":98897,"CreatedDateTime":"2015-11-05T19:02:42Z","Content":"\n\u003Cp\u003EWell, I like the mun we now have. But IMO of you somehow make terrain cast shadows it would instantly solve the problem of terminator and a few more.\u003C/p\u003E\n"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-11-05T19:12:44Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022rbray89\u0022 data-cite=\u0022rbray89\u0022\u003E\u003Cdiv\u003EThat\u0027s the beauty of it though... we could do all sorts of funny things with it. I\u0027ve been messing around with blending (I finally understand how it works now! ) One thought I had, was encoding an \u0022Visibility\u0022 metric into the alpha channel of rendered stuff for Scatterer to use (This doesn\u0027t seem to affect rendering otherwise). Then scaterer could use the DestAlpha multiplier with blending instead of OneMinusSourceAlpha. BTW, the \u0022OneMinusSourceAlpha\u0022 helps ensures lerp-like blending. If you want, you can use \u0022One\u0022 there to allow more background through, thought it may overpower things to white.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI\u0027m not sure I understand all the blending modes well, but for the view from orbit scatterer uses additive blending (Blend One One) right now and for the ground view (haze/postprocessing) regular alpha blending (Blend SrcAlpha OneMinusSrcAlpha).\u003C/p\u003E\u003Cp\u003ENot sure I understand how your idea works, so basically everything will have alpha values but won\u0027t use alpha blending itself? Then scatterer just uses these alpha values for itself? If I\u0027m getting it right, I think this is a great idea, and would definitely work, let me just think about this a bit more.\u003C/p\u003E\u003Cp\u003EMy current idea was to just use HDR and use high brightness values for the scaledSpace objects and the atmosphere, and then finding a way to make the bright areas much brighter than the dark ones on the terrain, this would automatically produce all the desired effects, but also some glare/bloom can be simulated from high luminosity objects if needed simple postprocessing shaders. All other simulators use this approach too (Proland, Space engine, outerra). We could try with your multiplicative shader, or we could also contact SQUAD and ask them for their shader source code (not sure if they\u0027d be open to this).\u003C/p\u003E\u003Cp\u003EBut yeah, your approach seems like a good idea. Also, what is lerp-like blending?\u003C/p\u003E\n"},{"CreatedByName":"rbray89","CreatedById":48847,"CreatedDateTime":"2015-11-05T19:47:38Z","Content":"\n\u003Cp\u003EBingo. We would just adjust the ground view to be \u0022Blend SrcAlpha DstAlpha\u0022 Everything should already be writing 1 if it is opaque ( should is the operative factor. I am not certain about things like water.) and we could adjust it for things like clouds (distance) and the luminosity of bodies.\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022font-size:8px;\u0022\u003E\u003Cspan style=\u0022color:#C0C0C0;\u0022\u003E- - - Updated - - -\u003C/span\u003E\u003C/span\u003E\u003C/p\u003E\u003Cp\u003EBingo. For the ground view we would use alpha additive \u0022Blend SrcAlpha DstAlpha\u0022, and this should let us write in a value for alpha that would let us fade it out. Would work perfectly for celestial bodies, writing 1 with lots of light, 0 for none. Should work for clouds too if I encode a \u0022distance\u0022 metric to the clouds... though I guess I could probably just make the clouds fade out...\u003C/p\u003E\u003Cp\u003EConcerns:\u003C/p\u003E\u003Cp\u003E1) Not sure if all shaders write to alpha (they should though) or if the values are as we would expect them to be.\u003C/p\u003E\u003Cp\u003E2) Not sure for certain that cameras share a universal frame buffer (but I think this is how it works)\u003C/p\u003E\u003Cp\u003EThe HDR method might work, but I think you\u0027d still have issues with the sky-body interaction.Either the \u003Cspan style=\u0022text-decoration:line-through;\u0022\u003Ebody is above it (don\u0027t see blue) or\u003C/span\u003E below it(don\u0027t see Mun), and neither would exactly produce the results you\u0027d like. Does Mun show through right now in scatterer or is it hidden? I would expect it to be hidden unless the proland stuff includes some mechanism to render moons.\u003C/p\u003E\u003Cp\u003EEDIT: Realized that bodies are rendered in scaled space and therefor can\u0027t show above scatterer render.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-11-05T19:50:19Z\u0022 title=\u002211/05/2015 07:50  PM\u0022 data-short=\u00228 yr\u0022\u003ENovember 5, 2015\u003C/time\u003E by rbray89\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-11-05T21:48:44Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022rbray89\u0022 data-cite=\u0022rbray89\u0022\u003E\u003Cdiv\u003EBingo. We would just adjust the ground view to be \u0022Blend SrcAlpha DstAlpha\u0022 Everything should already be writing 1 if it is opaque ( should is the operative factor. I am not certain about things like water.) and we could adjust it for things like clouds (distance) and the luminosity of bodies.\u003Cp\u003E\u003Cspan style=\u0022font-size:8px;\u0022\u003E\u003Cspan style=\u0022color:#C0C0C0;\u0022\u003E- - - Updated - - -\u003C/span\u003E\u003C/span\u003E\u003C/p\u003E\u003Cp\u003EBingo. For the ground view we would use alpha additive \u0022Blend SrcAlpha DstAlpha\u0022, and this should let us write in a value for alpha that would let us fade it out. Would work perfectly for celestial bodies, writing 1 with lots of light, 0 for none. Should work for clouds too if I encode a \u0022distance\u0022 metric to the clouds... though I guess I could probably just make the clouds fade out...\u003C/p\u003E\u003Cp\u003EConcerns:\u003C/p\u003E\u003Cp\u003E1) Not sure if all shaders write to alpha (they should though) or if the values are as we would expect them to be.\u003C/p\u003E\u003Cp\u003E2) Not sure for certain that cameras share a universal frame buffer (but I think this is how it works)\u003C/p\u003E\u003Cp\u003EThe HDR method might work, but I think you\u0027d still have issues with the sky-body interaction.Either the \u003Cspan style=\u0022text-decoration:line-through;\u0022\u003Ebody is above it (don\u0027t see blue) or\u003C/span\u003E below it(don\u0027t see Mun), and neither would exactly produce the results you\u0027d like. Does Mun show through right now in scatterer or is it hidden? I would expect it to be hidden unless the proland stuff includes some mechanism to render moons.\u003C/p\u003E\u003Cp\u003EEDIT: Realized that bodies are rendered in scaled space and therefor can\u0027t show above scatterer render.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThe mun currently shows through the scatterer effects. What I call the \u0022sky shader\u0022 uses additive blending, is rendered to scaled space, and renders on top of it\u0027s parent celestial object, also in top of other celestial bodies but I control on top of which one or under which one it renders using draw orders, so when the mun passes in front of kerbin it\u0027s not occluded. The same shader is also used for the planet\u0027s atmosphere when viewed from a high orbit. The postprocessing shader is only used on top of terrain and is rendered to the far camera, it uses alpha blending. So basically, the terrain itself renders on top of the sky, and the postprocessing shader renders on top of the terrain. An additional \u0022extinction\u0022 layer is also used:\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://i.imgur.com/dTt3d7l.jpg\u0022 alt=\u0022dTt3d7l.jpg\u0022\u003E\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://i.imgur.com/zB8SC7P.jpg\u0022 alt=\u0022zB8SC7P.jpg\u0022\u003E\u003C/p\u003E\u003Cp\u003EEdited: Also I know this is pretty random, but I felt like saying this here: Scatterer is one of the things I\u0027m proudest of in my life, and I aim to see it through to the end.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-11-05T23:22:50Z\u0022 title=\u002211/05/2015 11:22  PM\u0022 data-short=\u00228 yr\u0022\u003ENovember 5, 2015\u003C/time\u003E by blackrack\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"rbray89","CreatedById":48847,"CreatedDateTime":"2015-11-05T23:27:11Z","Content":"\n\u003Cp\u003EAh, I see... So if we had something that wrote the alpha value as an indicator of how visible through atmosphere it should be, the extinction and sky (and possibly haze) shader should be able to use that to blend. You may even be able to remove the extinction shader and just rely on the sky shader. You also wouldn\u0027t have to fiddle with queue order. I assume you do that with the material render queue?\u003C/p\u003E\n"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-11-05T23:42:16Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022rbray89\u0022 data-cite=\u0022rbray89\u0022\u003E\u003Cdiv\u003EAh, I see... So if we had something that wrote the alpha value as an indicator of how visible through atmosphere it should be, the extinction and sky (and possibly haze) shader should be able to use that to blend. You may even be able to remove the extinction shader and just rely on the sky shader. You also wouldn\u0027t have to fiddle with queue order. I assume you do that with the material render queue?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EProbably but I\u0027m not sure yet, I need to have the sky on additive blending, else the blending looks weird as hell near the edge of the atmosphere. Like this \u003Ca href=\u0022http://i.imgur.com/yA9XJGW.jpg\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://i.imgur.com/yA9XJGW.jpg\u003C/a\u003E.\u003C/p\u003E\u003Cp\u003EAlso, the extinction shader does tint the colors in a realistic manner (it uses the same calculations as those that give the sun it\u0027s reddish tint on sunsets/sunrise, though it may still need some tweaking), so probably I won\u0027t get rid of it.\u003C/p\u003E\u003Cp\u003EYes indeed, I do that with the material render queue, I check the nearby planets to see if they are between the camera and the parent planet or farther away and adjust accordingly.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-11-05T23:46:46Z\u0022 title=\u002211/05/2015 11:46  PM\u0022 data-short=\u00228 yr\u0022\u003ENovember 5, 2015\u003C/time\u003E by blackrack\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"rbray89","CreatedById":48847,"CreatedDateTime":"2015-11-05T23:55:13Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022blackrack\u0022 data-cite=\u0022blackrack\u0022\u003E\u003Cdiv\u003EProbably but I\u0027m not sure yet, I need to have the sky on additive blending, else the blending looks weird as hell near the edge of the atmosphere. Like this \u003Ca href=\u0022http://i.imgur.com/yA9XJGW.jpg\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://i.imgur.com/yA9XJGW.jpg\u003C/a\u003E.\u003Cp\u003EAlso, the extinction shader does tint the colors in a realistic manner (it uses the same calculations as those that give the sun it\u0027s reddish tint on sunsets/sunrise, though it may still need some tweaking), so probably I won\u0027t get rid of it.\u003C/p\u003E\u003Cp\u003EYes indeed, I do that with the material render queue, I check the nearby planets to see if they are between the camera and the parent planet or farther away and adjust accordingly.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThe sky can still be additive, it would just be additive based on the alpha value of whatever is behind it (more or less alpha would affect it in some way)\u003C/p\u003E\u003Cp\u003EEDIT: Info on blend modes here: \u003Ca href=\u0022http://elringus.me/blend-modes-in-unity/\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://elringus.me/blend-modes-in-unity/\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EBasically, Blending can have multiple opps, and the first parameter is what to multiply the source color with (generated by shader) and the second parameter is what to multiply the destination color (frame buffer) with. These to resulting values are added (or other operation based on BlendOp) to produce the final value. You can also specify separate blending for alpha if that is what you want.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-11-05T23:59:45Z\u0022 title=\u002211/05/2015 11:59  PM\u0022 data-short=\u00228 yr\u0022\u003ENovember 5, 2015\u003C/time\u003E by rbray89\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-11-06T00:12:27Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022rbray89\u0022 data-cite=\u0022rbray89\u0022\u003E\u003Cdiv\u003EThe sky can still be additive, it would just be additive based on the alpha value of whatever is behind it (more or less alpha would affect it in some way)\u003Cp\u003EEDIT: Info on blend modes here: \u003Ca href=\u0022http://elringus.me/blend-modes-in-unity/\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://elringus.me/blend-modes-in-unity/\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EBasically, Blending can have multiple opps, and the first parameter is what to multiply the source color with (generated by shader) and the second parameter is what to multiply the destination color (frame buffer) with. These to resulting values are added (or other operation based on BlendOp) to produce the final value. You can also specify separate blending for alpha if that is what you want.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ECool, then in this case I could create some sort of additive alpha blending and it would work.\u003C/p\u003E\n"},{"CreatedByName":"rbray89","CreatedById":48847,"CreatedDateTime":"2015-11-06T00:16:05Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022blackrack\u0022 data-cite=\u0022blackrack\u0022\u003E\u003Cdiv\u003ECool, then in this case I could create some sort of additive alpha blending and it would work.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EBingo. At least, that\u0027s the theory. I\u0027m probably going to be trying this out soon...\u003C/p\u003E\n"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-11-06T00:35:45Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022rbray89\u0022 data-cite=\u0022rbray89\u0022\u003E\u003Cdiv\u003EBingo. At least, that\u0027s the theory. I\u0027m probably going to be trying this out soon...\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ELooking forward to it.\u003C/p\u003E\u003Cp\u003EAlso, up there you mentioned \u00222) Not sure for certain that cameras share a universal frame buffer (but I think this is how it works)\u0022, not sure what you mean here, but when I tried applying multiplicative blending effects to the far camera they also applied to what the scaledspace camera has already rendered so I think it may be the case.\u003C/p\u003E\n"},{"CreatedByName":"rbray89","CreatedById":48847,"CreatedDateTime":"2015-11-06T00:57:09Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022blackrack\u0022 data-cite=\u0022blackrack\u0022\u003E\u003Cdiv\u003ELooking forward to it.\u003Cp\u003EAlso, up there you mentioned \u00222) Not sure for certain that cameras share a universal frame buffer (but I think this is how it works)\u0022, not sure what you mean here, but when I tried applying multiplicative blending effects to the far camera they also applied to what the scaledspace camera has already rendered so I think it may be the case.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EAh, perfect! That\u0027s what I want to hear!\u003C/p\u003E\n"}]}