{"TopicId":68838,"ForumId":29,"TopicTitle":"I want to draw holographic lines in space to aid in debugging vectors.","CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2014-04-09T23:53:18Z","PageNum":1,"Articles":[{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2014-04-09T23:53:18Z","Content":"\n\u003Cp\u003EI\u0027ve just started helping out in small bits contributing code to the kOS mod ( \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/68089-0-23-kOS-Scriptable-Autopilot-System-v0-11-2-13/\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://forum.kerbalspaceprogram.com/threads/68089-0-23-kOS-Scriptable-Autopilot-System-v0-11-2-13/\u003C/a\u003E ), and I\u0027ve come across an idea that would be very handy to help me (and maybe others) to debug problems in their kOS scripts. Before I consider it, I\u0027d like to ask if what I outline below is feasible and easy to do:\u003C/p\u003E\u003Cp\u003ESome math problems in kOS involve doing a bit of vector math. But the XYZ axes in KSP can be hard to visualize and most players are playing \u0022blind\u0022 as to what those axes are, and therefore have a hard time trying to work out what way a vector is actually pointing, given it\u0027s definition.\u003C/p\u003E\u003Cp\u003EIf you see that a vector contains the following parts:\u003C/p\u003E\u003Cp\u003Ex=103.1\u003C/p\u003E\u003Cp\u003Ey=2.10\u003C/p\u003E\u003Cp\u003Ez=912.12\u003C/p\u003E\u003Cp\u003EMost players have no clue which way that\u0027s pointing in the space you\u0027re viewing at in the game.\u003C/p\u003E\u003Cp\u003EWhat I\u0027m wondering is this: is there a good way via the Unity engine or KSP API to make a holographic representation of the vectors in the 3D space view so a player can look at them, but they have zero effect on anything in the game and as far as KSP cares they may as well not be there? I\u0027m picturing drawing a vector as a type of very narrow cylinder with a \u0022hat\u0022 on the tip end, so it looks vaguely like this mockup:\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://i.imgur.com/eObALEG.png\u0022 alt=\u0022eObALEG.png\u0022\u003E\u003C/p\u003E\u003Cp\u003EThese would be 3D objects (you could spin the camera around to get a better view of them) that the ship can just pass straight through with no effect (like the scatter rocks on the Mun).\u003C/p\u003E\u003Cp\u003EIf someone can guide me to what would be the needed API calls to put such an object into space (and then remove it later) that would be awesome. I\u0027ve got experience with graphics and programming, but not specifically with the implementation of them that uses Unity, or KSP, or C#.\u003C/p\u003E\n"},{"CreatedByName":"Starstrider42","CreatedById":104043,"CreatedDateTime":"2014-04-10T00:30:44Z","Content":"\n\u003Cp\u003EI don\u0027t know much about the API for this, but both RemoteTech and Persistent Trails use 3D overlays (the former in map view, the latter in flight view). You might try looking at the source code for those mods.\u003C/p\u003E\n"},{"CreatedByName":"JDP","CreatedById":30775,"CreatedDateTime":"2014-04-10T02:29:58Z","Content":"\n\u003Cp\u003Eto just make a quick and dirty line, you can use a \u003Ca href=\u0022http://docs.unity3d.com/Documentation/ScriptReference/LineRenderer.html\u0022 rel=\u0022external nofollow\u0022\u003ELineRenderer\u003C/a\u003E from the unity API.\u003C/p\u003E\u003Cp\u003EFor how to implement the line within the game, you can take a look at the old RT1 source. Secifically the \u003Ca href=\u0022https://github.com/JDPKSP/RemoteTech/blob/master/RemoteCore.cs\u0022 rel=\u0022external nofollow\u0022\u003ERemoteCore\u003C/a\u003E class.\u003C/p\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2014-04-10T03:30:03Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022JDP\u0022 data-cite=\u0022JDP\u0022\u003E\u003Cdiv\u003Eto just make a quick and dirty line, you can use a \u003Ca href=\u0022http://docs.unity3d.com/Documentation/ScriptReference/LineRenderer.html\u0022 rel=\u0022external nofollow\u0022\u003ELineRenderer\u003C/a\u003E from the unity API.\u003Cp\u003EFor how to implement the line within the game, you can take a look at the old RT1 source. Secifically the \u003Ca href=\u0022https://github.com/JDPKSP/RemoteTech/blob/master/RemoteCore.cs\u0022 rel=\u0022external nofollow\u0022\u003ERemoteCore\u003C/a\u003E class.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThank you. That example is being most constructive to me.\u003C/p\u003E\n"},{"CreatedByName":"pizzaoverhead","CreatedById":26349,"CreatedDateTime":"2014-04-10T10:08:24Z","Content":"\n\u003Cp\u003ELineRenderer is the right tool for the job here. You can create an arrowhead by creating a segment with a large starting width and zero ending width.\u003C/p\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2014-04-11T05:29:17Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022pizzaoverhead\u0022 data-cite=\u0022pizzaoverhead\u0022\u003E\u003Cdiv\u003ELineRenderer is the right tool for the job here. You can create an arrowhead by creating a segment with a large starting width and zero ending width.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYeah this is definitely easier than I thought it would be. The class already has everything I need for this. Technically it should be called coneRenderer, because it makes cylinders and cones where I specify the width, not just lines, and it also makes the object a thing that can be shifted and moved after placement by moving vertices - so it\u0027s got everything I need for this.\u003C/p\u003E\u003Cp\u003EThanks for the advice, both of you.\u003C/p\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2014-05-02T07:55:12Z","Content":"\n\u003Cp\u003EOkay, so I\u0027ve gotten quite a long ways along with this but I\u0027m still running into a problem. When I\u0027m on the flight view, then this seems to work as a way to show the vector centered on the ship\u0027s center of mass:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E                    GameObject lineObj = new GameObject(\u0022Line\u0022);\u003Cbr\u003E                    GameObject hatObj  = new GameObject(\u0022Line\u0022);\u003Cbr\u003E\u003Cbr\u003E                    if (onMap)\u003Cbr\u003E                    {\u003Cbr\u003E                        lineObj.layer = 9;\u003Cbr\u003E                        hatObj.layer = 9;\u003Cbr\u003E                    }\u003Cbr\u003E\u003Cbr\u003E                    _line = lineObj.AddComponent\u0026lt;LineRenderer\u0026gt;();\u003Cbr\u003E                    _hat  = hatObj.AddComponent\u0026lt;LineRenderer\u0026gt;();\u003Cbr\u003E\u003Cbr\u003E                    _line.useWorldSpace = false;\u003Cbr\u003E                    _hat.useWorldSpace  = false;\u003Cbr\u003E\u003Cbr\u003E                    // Default the vector\u0027s origin to the current ship.\u003Cbr\u003E                    // (user can modify this using VECTOR:SHOWSTART)\u003Cbr\u003E                    Vector3d shipPosFromOrigin = FlightGlobals.ActiveVessel.findWorldCenterOfMass();\u003Cbr\u003E                    _line.transform.localPosition = shipPosFromOrigin;\u003Cbr\u003E                    _hat.transform.localPosition  = shipPosFromOrigin;\u003Cbr\u003E\u003Cbr\u003E                    _line.material = new Material(Shader.Find(\u0022Particles/Additive\u0022));\u003Cbr\u003E                    _hat.material  = new Material(Shader.Find(\u0022Particles/Additive\u0022));\u003Cbr\u003E\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EWhen I do that, I cause the _line and the _hat objects to be LineRenderers who\u0027s frame of reference matches the ship\u0027s position in its local XYZ space, If I for example use them to draw a line from (0,0,0) to (10,0,0) then I\u0027ll get a 10 meter line along the x axis sticking out of the ship. That\u0027s great. \u003C/p\u003E\u003Cp\u003EBut now I want to do the same thing in map view, but the map view uses some other sort of coordinate system in which the XYZ space moves with the camera. When I use the same code then the origin is wherever the camera is, not wherever the ship is.\u003C/p\u003E\u003Cp\u003EHow do I get the vector to be drawn with its origin at the current vessel instead of where the camera is in map view?\u003C/p\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2014-05-02T08:26:38Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Steven Mading\u0022 data-cite=\u0022Steven Mading\u0022\u003E\u003Cdiv\u003EBut now I want to do the same thing in map view, but the map view uses some other sort of coordinate system\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYep. Convert the ship\u0027s local space world position into scaled space world position.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Evar vesselPos = ScaledSpace.LocalToScaledSpace(FlightGlobals.ActiveVessel.findWorldCenterOfMass())\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2014-05-02T09:05:32Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022xEvilReeperx\u0022 data-cite=\u0022xEvilReeperx\u0022\u003E\u003Cdiv\u003EYep. Convert the ship\u0027s local space world position into scaled space world position.\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Evar vesselPos = ScaledSpace.LocalToScaledSpace(FlightGlobals.ActiveVessel.findWorldCenterOfMass())\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThank you that works great.\u003C/p\u003E\u003Cp\u003EAnother question is - how do I query the scale of the map view? For example in the in-flight view a line that is exactly 1.0 units long appears as 1 meter long. But how long is a \u0022unit\u0022 of 3-D space in the map view? 10 kilometers? 100? etc.\u003C/p\u003E\u003Cp\u003E(Also, is there any sort of API documentation SQUAD provides for modders for things like this?)\u003C/p\u003E\n"},{"CreatedByName":"blizzy78","CreatedById":68543,"CreatedDateTime":"2014-05-02T09:34:37Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Steven Mading\u0022 data-cite=\u0022Steven Mading\u0022\u003E\u003Cdiv\u003EAlso, is there any sort of API documentation SQUAD provides for modders for things like this?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThey don\u0027t, sadly.\u003C/p\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2014-05-02T11:09:40Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Steven Mading\u0022 data-cite=\u0022Steven Mading\u0022\u003E\u003Cdiv\u003EAnother question is - how do I query the scale of the map view? For example in the in-flight view a line that is exactly 1.0 units long appears as 1 meter long. But how long is a \u0022unit\u0022 of 3-D space in the map view? 10 kilometers? 100? etc.\u003Cp\u003E(Also, is there any sort of API documentation SQUAD provides for modders for things like this?)\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003E1:6000 (ScaledSpace.Instance.scaleFactor, or ScaledSpace.InverseScaledFactor for the inve-well, you get it). So a line 10,000 units long in local space would be 1.67 units long in scaled space. Kerbin\u0027s radius is about 1,000 units for comparison. It might be better to have two different scales else you might have to zoom in pretty close to your mapview vessel to even see the lines\u003C/p\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2014-05-03T13:08:42Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022xEvilReeperx\u0022 data-cite=\u0022xEvilReeperx\u0022\u003E\u003Cdiv\u003E1:6000 (ScaledSpace.Instance.scaleFactor, or ScaledSpace.InverseScaledFactor for the inve-well, you get it). So a line 10,000 units long in local space would be 1.67 units long in scaled space. Kerbin\u0027s radius is about 1,000 units for comparison. It might be better to have two different scales else you might have to zoom in pretty close to your mapview vessel to even see the lines\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EWell the intent is to show the user the same scale in both so it looks clear and obvious (so small vectors don\u0027t show on the map view, deliberately. switching to map view is for seeing things like \u0022is this position vector really pointing all the way to the Mun from my ship like I thought it was?\u0022 Since the vectors are sometimes used as positional coordinates it\u0027s vital that people be able to see them in the right scale so that where it looks like the vector\u0027s tip is in the map view is really where it is in the world.\u003C/p\u003E\u003Cp\u003EAny idea why ScaledSpace.LocalToScaledSpace() isn\u0027t giving the right scale? I\u0027m using that to ensure the right orientation and translation, but it dosn\u0027t seem to be getting the right scale.\u003C/p\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2014-05-03T19:27:41Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Steven Mading\u0022 data-cite=\u0022Steven Mading\u0022\u003E\u003Cdiv\u003EAny idea why ScaledSpace.LocalToScaledSpace() isn\u0027t giving the right scale? I\u0027m using that to ensure the right orientation and translation, but it dosn\u0027t seem to be getting the right scale.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EWhat do you mean, scale? ScaledSpace.LocalToScaledSpace() merely converts one coordinate point to a different coordinate point; it doesn\u0027t worry about any kind of scale or rotation.\u003C/p\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2014-05-04T06:07:32Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022xEvilReeperx\u0022 data-cite=\u0022xEvilReeperx\u0022\u003E\u003Cdiv\u003EWhat do you mean, scale? ScaledSpace.LocalToScaledSpace() merely converts one coordinate point to a different coordinate point; it doesn\u0027t worry about any kind of scale or rotation.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EOkay thanks. Hey I\u0027m just guessing what these things do since the API is undocumented. I was just guessing from the name that it might be a full-blown matrix transform with all the things in it - translate, rotate, scale.\u003C/p\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2014-05-04T15:33:50Z","Content":"\n\u003Cp\u003E[ never mind, answered in another thread - post deleted here.]\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-05-04T19:57:28Z\u0022 title=\u002205/04/2014 07:57  PM\u0022 data-short=\u002210 yr\u0022\u003EMay 4, 2014\u003C/time\u003E by Steven Mading\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Dunbaratu","CreatedById":63481,"CreatedDateTime":"2014-05-15T19:37:02Z","Content":"\n\u003Cp\u003EThanks for all the help on this.\u003C/p\u003E\u003Cp\u003EI\u0027ve got it done now, and here\u0027s the demo of what it looks like:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E\n\u003C/p\u003E\u003Cdiv class=\u0022ipsEmbeddedVideo\u0022 contenteditable=\u0022false\u0022\u003E\u003Cdiv\u003E\u003Ciframe width=\u0022480\u0022 height=\u0022270\u0022 src=\u0022https://www.youtube.com/embed/Vn6lUozVUHA?feature=oembed\u0022 frameborder=\u00220\u0022 allowfullscreen=\u0022true\u0022\u003E\u003C/iframe\u003E\u003C/div\u003E\u003C/div\u003E\n"}]}