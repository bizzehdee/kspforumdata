{"TopicId":103963,"ForumId":36,"TopicTitle":"[WIP][1.9.x-1.12.x] Scatterer-atmospheric scattering (0.0838 - 14/08/2022) Scattering improvements, in-game atmo generation and multi-sun support","CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2015-04-12T08:37:35Z","PageNum":272,"Articles":[{"CreatedByName":"tater","CreatedById":119411,"CreatedDateTime":"2017-11-16T13:00:30Z","Content":"\u003E \n\u003E \n\u003E 3 hours ago, Epoxid said:\n\u003E \n\u003E \n\u003E According to my testing, you can trade it for the floating tiles bug by going back to an older version and then turn off the ocean shader to remove the floating tiles :S See my previous post:\n\u003E \n\u003E \n\u003E \n\u003E - 320b (1st download link on SpaceDock): Sqrt-fix not working, always halo\n\u003E - 315 preview (2nd download from top on SpaceDock): Halo is always there, fix is not doing anything on or off\n\u003E - 275 preview (3rd download from top on SpaceDock): Fix Works: Halo is gone with alternate sqrt \u0022off\u0022. This is the latest version where I can remove the halo using the sqrt-option.\n\u003E \n\nWow, thanks. I\u0027ll probably just keep it off, it\u0027s not all that critical, I\u0027m only in the atmosphere briefly, anyway."},{"CreatedByName":"scuderiacab","CreatedById":182914,"CreatedDateTime":"2017-11-18T12:48:46Z","Content":"\u003E \n\u003E \n\u003E On 11.11.2017 at 12:29 AM, blackrack said:\n\u003E \n\u003E \n\u003E No one commented on whether or not my new dll fixes it so far\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E [https://forum.kerbalspaceprogram.com/index.php?/topic/103963-wip12213-scatterer-atmospheric-scattering-v00320-0320b-06072017-water-refraction/\u0026do=findComment\u0026comment=3210887](https://forum.kerbalspaceprogram.com/index.php?/topic/103963-wip12213-scatterer-atmospheric-scattering-v00320-0320b-06072017-water-refraction/\u0026do=findComment\u0026comment=3210887)\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E Anyway, me I haven\u0027t been able to reproduce this bug myself in like a year.\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E Edited: I guess I should just release this as an update and watch if the daily \u0022global warming xD\u0022 threads on the KSP subreddit disappear.\n\u003E \n\nHey @blackrack,\n\nI tried it with my game with eve and \u003Cabbr title=\u0022Real Solar System (mod)\u0022\u003Erss\u003C/abbr\u003E installed and scatterer basically stops working and it goes back to the weird atmosphere before it. Before this I had the halo bug and I fixed it but this time the atmosphere started going black whenever I was viewing the \u003Cabbr title=\u0022Kerbal Space Center\u0022\u003EKSC\u003C/abbr\u003E or launching a ship. Also this black \u0022void\u0022 would absorb the entire screen at certain angles. The ship and the hud is still visible and so is the Sun and I still can fly the ship. But the background goes completely dark. I am using KSP for my physics essay which I need to be able to graduate, and it needs to be appealing. I would be extremely glad if you could look into it.\n\nThanks from now ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif \u0022:)\u0022)\n\n**Edited \u003Ctime datetime=\u00222017-11-18T15:31:27Z\u0022 title=\u002211/18/2017 03:31  PM\u0022 data-short=\u00226 yr\u0022\u003ENovember 18, 2017\u003C/time\u003E by scuderiacab**"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2017-11-19T14:29:44Z","Content":"\u003E \n\u003E \n\u003E On 15/11/2017 at 7:29 PM, Drew Kerman said:\n\u003E \n\u003E \n\u003E [@blackrack](https://forum.kerbalspaceprogram.com/index.php?/profile/104258-blackrack/) not sure how applicable this is, but it does mention unity and shaders so figured I\u0027d share it here: [https://www.alanzucconi.com/2017/10/10/shader-atmospheric-sphere/](https://www.alanzucconi.com/2017/10/10/shader-atmospheric-sphere/)\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E original credit goes to Scott Manley, he retweeted this earlier today\n\u003E \n\nI believe what we have npw in scatterer is more advanced than this.\n\n\u003E \n\u003E \n\u003E On 16/11/2017 at 11:11 AM, Namelesswonder said:\n\u003E \n\u003E \n\u003E I\u0027m currently having a problem with oceans right now. It looks like the shoreline for some reason starts out in the ocean, and then when you move the camera or get closer the shoreline will then move into the position it should be in.\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E [https://imgur.com/a/ja26J](https://imgur.com/a/ja26J)\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E I\u0027ve tried increasing and decreasing the grid size and disabling refractions but it doesn\u0027t fix it, only completely disabling the ocean shader gets rid of the problem.\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E I show my mod list but it still happens even with scatterer being the only mod. Also have my graphics settings shown too. Scatterer settings are the stock configs.\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E Happens on 320b, as well as 321dev.\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E Not sure what to do to fix it.\n\u003E \n\nThis happens because of the new \u0022water transparency\u0022 feature but I deemed it not very distracting or critical. i will fix it when I can however.\n\n\u003E \n\u003E \n\u003E On 18/11/2017 at 1:48 PM, scuderiacab said:\n\u003E \n\u003E \n\u003E Hey @blackrack,\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E I tried it with my game with eve and \u003Cabbr title=\u0022Real Solar System (mod)\u0022\u003Erss\u003C/abbr\u003E installed and scatterer basically stops working and it goes back to the weird atmosphere before it. Before this I had the halo bug and I fixed it but this time the atmosphere started going black whenever I was viewing the \u003Cabbr title=\u0022Kerbal Space Center\u0022\u003EKSC\u003C/abbr\u003E or launching a ship. Also this black \u0022void\u0022 would absorb the entire screen at certain angles. The ship and the hud is still visible and so is the Sun and I still can fly the ship. But the background goes completely dark. I am using KSP for my physics essay which I need to be able to graduate, and it needs to be appealing. I would be extremely glad if you could look into it.\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E Thanks from now ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif \u0022:)\u0022)\n\u003E \n\nWell probably look at the log because something bad broke. it\u0027s probably not finding a specific file or something like a messed up config."},{"CreatedByName":"scuderiacab","CreatedById":182914,"CreatedDateTime":"2017-11-19T20:34:52Z","Content":"\u003E \n\u003E \n\u003E 6 hours ago, blackrack said:\n\u003E \n\u003E \n\u003E I believe what we have npw in scatterer is more advanced than this.\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E This happens because of the new \u0022water transparency\u0022 feature but I deemed it not very distracting or critical. i will fix it when I can however.\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E Well probably look at the log because something bad broke. it\u0027s probably not finding a specific file or something like a messed up config.\n\u003E \n\nHere is my player.log file. This time the bug was a little bit different. Scatterer was partially working in the \u003Cabbr title=\u0022Kerbal Space Center\u0022\u003EKSC\u003C/abbr\u003E rather than not at all, but it was absent while viewing Earth from the tracking station.\n\n[https://drive.google.com/open?id=1iU3imEBuh7HN6zButwN6YzcVMKiaRaH-](https://drive.google.com/open?id=1iU3imEBuh7HN6zButwN6YzcVMKiaRaH-)"},{"CreatedByName":"selfish_meme","CreatedById":125899,"CreatedDateTime":"2017-11-20T22:31:55Z","Content":"Hi [@blackrack](https://forum.kerbalspaceprogram.com/index.php?/profile/104258-blackrack/) I used the new DLL last night during my stream, I was not having a lot of issues with the old one, and did not encounter any problems so far with the new one, I did not spend long out of the editor but it looked ok\n\n\u003Ciframe allowfullscreen=\u0022\u0022 data-controller=\u0022core.front.core.autosizeiframe\u0022 data-embedid=\u0022embed948744366\u0022 scrolling=\u0022no\u0022 src=\u0022https://forum.kerbalspaceprogram.com/index.php?app=core\u0026module=system\u0026controller=embed\u0026url=https://gfycat.com/gifs/detail/BestBruisedHeron\u0022 style=\u0022height:2460px;\u0022\u003E\u003C/iframe\u003E\n\nI have stuff like ground shadows, eclipses and god rays turned off, the gifs seem to be displaying weird on the forum\n\n**Edited \u003Ctime datetime=\u00222017-11-20T22:40:19Z\u0022 title=\u002211/20/2017 10:40  PM\u0022 data-short=\u00226 yr\u0022\u003ENovember 20, 2017\u003C/time\u003E by selfish\\_meme**"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2017-11-21T17:41:26Z","Content":"\u003E \n\u003E \n\u003E On 19/11/2017 at 9:34 PM, scuderiacab said:\n\u003E \n\u003E \n\u003E Here is my player.log file. This time the bug was a little bit different. Scatterer was partially working in the \u003Cabbr title=\u0022Kerbal Space Center\u0022\u003EKSC\u003C/abbr\u003E rather than not at all, but it was absent while viewing Earth from the tracking station.\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E [https://drive.google.com/open?id=1iU3imEBuh7HN6zButwN6YzcVMKiaRaH-](https://drive.google.com/open?id=1iU3imEBuh7HN6zButwN6YzcVMKiaRaH-)\n\u003E \n\nFrom your log:\n\n    [Scatterer] No config file found, check your install"},{"CreatedByName":"scuderiacab","CreatedById":182914,"CreatedDateTime":"2017-11-21T20:19:24Z","Content":"\u003E \n\u003E \n\u003E 2 hours ago, blackrack said:\n\u003E \n\u003E \n\u003E From your log:\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E     \n\u003E     \n\u003E     [Scatterer] No config file found, check your install\n\u003E \n\nMy install seems complete. It has one config, one shader file and the dll. Do I have to install something else? There is this scatterer-master download on GitHub that supposedly fixes the \u0022black sky issue\u0022 but I couldn\u0027t get it to work either. I\u0027m on Mac, would it change something? I downloaded the scatterer file from spacedock     (which says it\u0027s outdated btw) and changed the dll. with the one you have shared a while back to fix the halo issue. I know it\u0027s just more work for you but I would really appreciate it if you could help me out.![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif \u0022:)\u0022)\n\nThanks again [@blackrack](https://forum.kerbalspaceprogram.com/index.php?/profile/104258-blackrack/)"},{"CreatedByName":"Galileo","CreatedById":150430,"CreatedDateTime":"2017-11-21T20:30:39Z","Content":"\u003E \n\u003E \n\u003E 10 minutes ago, scuderiacab said:\n\u003E \n\u003E \n\u003E My install seems complete. It has one config, one shader file and the dll. Do I have to install something else? There is this scatterer-master download on GitHub that supposedly fixes the \u0022black sky issue\u0022 but I couldn\u0027t get it to work either. I\u0027m on Mac, would it change something? I downloaded the scatterer file from spacedock     (which says it\u0027s outdated btw) and changed the dll. with the one you have shared a while back to fix the halo issue. I know it\u0027s just more work for you but I would really appreciate it if you could help me out.![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif \u0022:)\u0022)\n\u003E \n\u003E \n\u003E \n\u003E Thanks again [@blackrack](https://forum.kerbalspaceprogram.com/index.php?/profile/104258-blackrack/)\n\u003E \n\nYou should have multiple planet cfgs. Kerbin,Eve, etc..I would reinstall"},{"CreatedByName":"scuderiacab","CreatedById":182914,"CreatedDateTime":"2017-11-21T20:34:24Z","Content":"\u003E \n\u003E \n\u003E 2 minutes ago, Galileo said:\n\u003E \n\u003E \n\u003E You should have multiple planet cfgs. Kerbin,Eve, etc..I would reinstall\n\u003E \n\noh boy I have reinstalled it so many times my trash bin is full of scatterer files![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif \u0022:)\u0022) also i am using real solar system, if that changes anything"},{"CreatedByName":"Galileo","CreatedById":150430,"CreatedDateTime":"2017-11-21T22:24:36Z","Content":"\u003E \n\u003E \n\u003E 1 hour ago, scuderiacab said:\n\u003E \n\u003E \n\u003E oh boy I have reinstalled it so many times my trash bin is full of scatterer files![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif \u0022:)\u0022) also i am using real solar system, if that changes anything\n\u003E \n\nIt makes a big difference. That some important info to leave out lol. Scatterer does not support \u003Cabbr title=\u0022Real Solar System (mod)\u0022\u003ERSS\u003C/abbr\u003E by default, only the stock system. You have to use a visual pack that has custom scatterer cfgs for \u003Cabbr title=\u0022Real Solar System (mod)\u0022\u003ERSS\u003C/abbr\u003E. Unfortunately, there aren\u2019t any updated for the latest scatterer, so you would have to roll back to KSP 1.2.2 for them to work properly. \n\n**Edited \u003Ctime datetime=\u00222017-11-21T22:26:06Z\u0022 title=\u002211/21/2017 10:26  PM\u0022 data-short=\u00226 yr\u0022\u003ENovember 21, 2017\u003C/time\u003E by Galileo**"},{"CreatedByName":"John341","CreatedById":183008,"CreatedDateTime":"2017-11-22T18:26:37Z","Content":"Hi to all,\n\nI am new to this one...Its a wonderfull mod but it kills my framerate .. i have installed from scratch KSP, \u003Cabbr title=\u0022Environmental Visual Enhancement (mod)\u0022\u003EEVE\u003C/abbr\u003E,SVE,PlanetShine,DistantObject,RentryParticleEffect and scatterer..\n\n When i am on Kerbin or near kerbin i am taking 10-11fps!!! If i remove the scatterer folder from gamedata i am back to my normal 60fps....\n\nHere is my ksp.log...[https://drive.google.com/file/d/1OYUx-5sYQj_iTOaPpTaIiiibRJLWxqbs/view?usp=sharing](https://drive.google.com/file/d/1OYUx-5sYQj_iTOaPpTaIiiibRJLWxqbs/view?usp=sharing)\n\nIf anyone can help i will be grateful\n\n**Edited \u003Ctime datetime=\u00222017-11-22T18:27:07Z\u0022 title=\u002211/22/2017 06:27  PM\u0022 data-short=\u00226 yr\u0022\u003ENovember 22, 2017\u003C/time\u003E by John341**"},{"CreatedByName":"Epoxid","CreatedById":170132,"CreatedDateTime":"2017-11-23T22:48:24Z","Content":"\u003E \n\u003E \n\u003E On 16.11.2017 at 11:11 AM, Namelesswonder said:\n\u003E \n\u003E \n\u003E I\u0027m currently having a problem with oceans right now. It looks like the shoreline for some reason starts out in the ocean, and then when you move the camera or get closer the shoreline will then move into the position it should be in.\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E [https://imgur.com/a/ja26J](https://imgur.com/a/ja26J)\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E I\u0027ve tried increasing and decreasing the grid size and disabling refractions but it doesn\u0027t fix it, only completely disabling the ocean shader gets rid of the problem.\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E I show my mod list but it still happens even with scatterer being the only mod. Also have my graphics settings shown too. Scatterer settings are the stock configs.\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E Happens on 320b, as well as 321dev.\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E Not sure what to do to fix it.\n\u003E \n\nHi, where did you find the 321dev? I would very much like to give that a test..."},{"CreatedByName":"Epoxid","CreatedById":170132,"CreatedDateTime":"2017-11-23T23:27:18Z","Content":"Sorry to maybe mingle too much into the issue of the halo bug, but from studying the sources, I think the bug is solely contained within \u0022AtmosphereScatterer.cginc\u0022?\n\nFrom line 171\n\n#if (!defined(SHADER\\_API\\_D3D9) \u0026\u0026 !defined(DEFAULT\\_SQRT\\_ON))\n\n\u003Cfont color=\u0022#24292e\u0022\u003EI suppose that the fix is only doing something for non-DirectX 9 users and that there was a problem with a negative number being passed into the sqrt routine?\u003C/font\u003E\n\n\u003Cfont color=\u0022#24292e\u0022\u003EI noticed there are many instances in that file, where the custom SQRT function is not called, but still the system sqrt standard one. Would it be unwise to just redefine sqrt(x) as sqrt(abs(x)) globally?\u003C/font\u003E\n\nI also noticed at some point you seem to have been using\n\nreturn 1 / rsqrt (f);\n\nas a fix? Did this not work either?\n\n\u003Cfont color=\u0022#24292e\u0022\u003EIf you could kindly point me to a \u0022how-to\u0022 on compiling the shaders, I would be very much willing to help debugging this...\u003C/font\u003E\n\n**Edited \u003Ctime datetime=\u00222017-11-23T23:36:34Z\u0022 title=\u002211/23/2017 11:36  PM\u0022 data-short=\u00226 yr\u0022\u003ENovember 23, 2017\u003C/time\u003E by Epoxid**"},{"CreatedByName":"Poodmund","CreatedById":128643,"CreatedDateTime":"2017-11-23T23:48:01Z","Content":"\u003E \n\u003E \n\u003E 18 minutes ago, Epoxid said:\n\u003E \n\u003E \n\u003E \\*snip\\*\n\u003E \n\nAs you\u0027re making a concerted effort and willingness to resolve this issue, I\u0027ll ping [@blackrack](https://forum.kerbalspaceprogram.com/index.php?/profile/104258-blackrack/) here just to ensure that you get his attention. ![:wink:](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif \u0022;)\u0022) \n\nAlso the latest dev build can be found here: [https://forum.kerbalspaceprogram.com/index.php?/topic/103963-wip12213-scatterer-atmospheric-scattering-v00320-0320b-06072017-water-refraction/\u0026page=270\u0026tab=comments#comment-3210887](https://forum.kerbalspaceprogram.com/index.php?/topic/103963-wip12213-scatterer-atmospheric-scattering-v00320-0320b-06072017-water-refraction/\u0026page=270\u0026tab=comments#comment-3210887)"},{"CreatedByName":"jinks","CreatedById":69693,"CreatedDateTime":"2017-11-25T04:27:25Z","Content":"Just to add a data point:\n\nI\u0027ve tried the experimental .dll and still get NullRef spam on\n\n    scatterer.RefractionCamera.OnPreCull ()\n\nwhen switched to a craft on Minmus.\n\nFrom the mods I\u0027m running i think the relevant ones are \u003Cabbr title=\u0022Environmental Visual Enhancement (mod)\u0022\u003EEVE\u003C/abbr\u003E, Galileo\u0027s OPM and SVE."},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2017-11-25T10:27:54Z","Content":"\u003E \n\u003E \n\u003E On 22/11/2017 at 7:26 PM, John341 said:\n\u003E \n\u003E \n\u003E Hi to all,\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E I am new to this one...Its a wonderfull mod but it kills my framerate .. i have installed from scratch KSP, \u003Cabbr title=\u0022Environmental Visual Enhancement (mod)\u0022\u003EEVE\u003C/abbr\u003E,SVE,PlanetShine,DistantObject,RentryParticleEffect and scatterer..\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E  When i am on Kerbin or near kerbin i am taking 10-11fps!!! If i remove the scatterer folder from gamedata i am back to my normal 60fps....\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E Here is my ksp.log...[https://drive.google.com/file/d/1OYUx-5sYQj_iTOaPpTaIiiibRJLWxqbs/view?usp=sharing](https://drive.google.com/file/d/1OYUx-5sYQj_iTOaPpTaIiiibRJLWxqbs/view?usp=sharing)\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E If anyone can help i will be grateful\n\u003E \n\nI don\u0027t see anything wrong in the logs, what are your system specs?\n\n\u003E \n\u003E \n\u003E 7 hours ago, jinks said:\n\u003E \n\u003E \n\u003E Just to add a data point:\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E  \n\u003E \n\u003E \n\u003E \n\u003E \n\u003E I\u0027ve tried the experimental .dll and still get NullRef spam on\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E     \n\u003E     \n\u003E     scatterer.RefractionCamera.OnPreCull ()\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E when switched to a craft on Minmus.\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E From the mods I\u0027m running i think the relevant ones are \u003Cabbr title=\u0022Environmental Visual Enhancement (mod)\u0022\u003EEVE\u003C/abbr\u003E, Galileo\u0027s OPM and SVE.\n\u003E \n\nThis is with v0.0321dev?\n\n\u003E \n\u003E \n\u003E On 24/11/2017 at 12:27 AM, Epoxid said:\n\u003E \n\u003E \n\u003E Sorry to maybe mingle too much into the issue of the halo bug, but from studying the sources, I think the bug is solely contained within \u0022AtmosphereScatterer.cginc\u0022?\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E From line 171\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E #if (!defined(SHADER\\_API\\_D3D9) \u0026\u0026 !defined(DEFAULT\\_SQRT\\_ON))\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E \u003Cfont color=\u0022#24292e\u0022\u003EI suppose that the fix is only doing something for non-DirectX 9 users and that there was a problem with a negative number being passed into the sqrt routine?\u003C/font\u003E\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E \u003Cfont color=\u0022#24292e\u0022\u003EI noticed there are many instances in that file, where the custom SQRT function is not called, but still the system sqrt standard one. Would it be unwise to just redefine sqrt(x) as sqrt(abs(x)) globally?\u003C/font\u003E\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E I also noticed at some point you seem to have been using\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E return 1 / rsqrt (f);\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E as a fix? Did this not work either?\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E \u003Cfont color=\u0022#24292e\u0022\u003EIf you could kindly point me to a \u0022how-to\u0022 on compiling the shaders, I would be very much willing to help debugging this...\u003C/font\u003E\n\u003E \n\nFor how to complie the shaders: [https://github.com/LGhassen/Scatterer/blob/master/scatterer/Shaders/readme.md.txt](https://github.com/LGhassen/Scatterer/blob/master/scatterer/Shaders/readme.md.txt)\n\nThe issue seems to happen for non-d3d9 users, at first I thought the issue was a negative value being passed but sqrt(abs(x)) didn\u0027t seem to fix anything. Then it seems if the value is close enough to zero the issue will happen anyway.\n\n1/rsqrt(f) fixed it for some platforms but not others, I don\u0027t remember the exact details but I will try to test it again.\n\nFrom my testing it is only an issue with deltaSq calculation, all the other calculations can use normal and sqrt and work fine.\n\n**Edited:** On my system this doesn\u0027t seem to be reproducible on dx9, dx11 or openGl, with or without the SQRT fix, I\u0027ll fire up my old laptop and see if it\u0027s reproducible there.\n\n**Edited again:** Seems like alternate shader SQRT is actually disabled in the shaders themselves at the moment (multi-compile line was commented out), re-enabling and re-investigating the issue.\n\n**Edited \u003Ctime datetime=\u00222017-11-25T12:19:22Z\u0022 title=\u002211/25/2017 12:19  PM\u0022 data-short=\u00226 yr\u0022\u003ENovember 25, 2017\u003C/time\u003E by blackrack**"},{"CreatedByName":"maja","CreatedById":168379,"CreatedDateTime":"2017-11-25T13:18:16Z","Content":"\u003E \n\u003E \n\u003E 2 hours ago, blackrack said:\n\u003E \n\u003E \n\u003E This is with v0.0321dev?\n\u003E \n\nI\u0027m getting null ref around Mun and on every scene change with dev version from November 4 and Ocean shaders enabled (see screenshot of my settings bellow) too.\n\n![Twr12YIl.png](https://i.imgur.com/Twr12YIl.png)"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2017-11-25T13:25:53Z","Content":"\u003E \n\u003E \n\u003E 7 minutes ago, maja said:\n\u003E \n\u003E \n\u003E I\u0027m getting null ref around Mun and on every scene change with dev version from November 4 and Ocean shaders enabled (see screenshot of my settings bellow) too.\n\u003E \n\nExact reproduction steps? Do you load a craft around mun? Do you fly it there?"},{"CreatedByName":"maja","CreatedById":168379,"CreatedDateTime":"2017-11-25T13:39:59Z","Content":"\u003E \n\u003E \n\u003E 10 minutes ago, blackrack said:\n\u003E \n\u003E \n\u003E Exact reproduction steps? Do you load a craft around mun? Do you fly it there?\n\u003E \n\nIt\u0027s weird. I\u0027m getting full spam around and on the Mun in my main install with a lot of mods, but not in a clean install with SVE and scatterer only. In clean install it\u0027s only exception when switching scenes (tested right now)."},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2017-11-25T13:47:58Z","Content":"\u003E \n\u003E \n\u003E 7 minutes ago, maja said:\n\u003E \n\u003E \n\u003E It\u0027s weird. I\u0027m getting full spam around and on the Mun in my main install with a lot of mods, but not in a clean install with SVE and scatterer only. In clean install it\u0027s only exception when switching scenes (tested right now).\n\u003E \n\nMod list then? Or maybe try to slowly narrow it down?"},{"CreatedByName":"maja","CreatedById":168379,"CreatedDateTime":"2017-11-25T14:14:57Z","Content":"\u003E \n\u003E \n\u003E On 25. 11. 2017 at 2:47 PM, blackrack said:\n\u003E \n\u003E \n\u003E Mod list then? Or maybe try to slowly narrow it down?\n\u003E \n\nIt seems, that I have steps to reproduce it in KSP 1.3.1.\n\nMods:\n\n- SVE 1.2.7\n- \u003Cabbr title=\u0022Environmental Visual Enhancement (mod)\u0022\u003EEVE\u003C/abbr\u003E 1.2.2.1\n- scatterer - dev version from November 4 or version 0.0320b (it\u0027s the same with both versions)\n- Module Manager 2.8.1\n\nSteps:\n\n- Ocean shaders on\n- Put simple craft into orbit of the Mun (for example. Mark1-2Pod)\n- Go back to Space Center\n- Return to the craft via Tracking Station\n- OnPreCull null ref spam\n\nHope this helps. If you need more info, let me know.\n\n**Edited \u003Ctime datetime=\u00222017-11-26T21:40:18Z\u0022 title=\u002211/26/2017 09:40  PM\u0022 data-short=\u00226 yr\u0022\u003ENovember 26, 2017\u003C/time\u003E by maja**"},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2017-11-25T17:16:18Z","Content":"I think I may have fixed the **halo** issue for good, can you guys confirm?\n\n[https://mega.nz/#!nN4EGRQB!Vi_QanmE9XdOQ2IBPQn6UZExvXL_xAEUBCZx6gPZ9mM](https://mega.nz/#!nN4EGRQB!Vi_QanmE9XdOQ2IBPQn6UZExvXL_xAEUBCZx6gPZ9mM)\n\npaging [@Epoxid](https://forum.kerbalspaceprogram.com/index.php?/profile/170132-epoxid/)"},{"CreatedByName":"John341","CreatedById":183008,"CreatedDateTime":"2017-11-25T21:39:52Z","Content":"\u003E \n\u003E \n\u003E 11 hours ago, blackrack said:\n\u003E \n\u003E \n\u003E I don\u0027t see anything wrong in the logs, what are your system specs?\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E This is with v0.0321dev?\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E For how to complie the shaders: [https://github.com/LGhassen/Scatterer/blob/master/scatterer/Shaders/readme.md.txt](https://github.com/LGhassen/Scatterer/blob/master/scatterer/Shaders/readme.md.txt)\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E The issue seems to happen for non-d3d9 users, at first I thought the issue was a negative value being passed but sqrt(abs(x)) didn\u0027t seem to fix anything. Then it seems if the value is close enough to zero the issue will happen anyway.\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E 1/rsqrt(f) fixed it for some platforms but not others, I don\u0027t remember the exact details but I will try to test it again.\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E From my testing it is only an issue with deltaSq calculation, all the other calculations can use normal and sqrt and work fine.\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E **Edited:** On my system this doesn\u0027t seem to be reproducible on dx9, dx11 or openGl, with or without the SQRT fix, I\u0027ll fire up my old laptop and see if it\u0027s reproducible there.\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E **Edited again:** Seems like alternate shader SQRT is actually disabled in the shaders themselves at the moment (multi-compile line was commented out), re-enabling and re-investigating the issue.\n\u003E \n\nThank you blackrack for your time...\n\nMy pc specs are\n\nOS: Windows 7 Service Pack 1 (6.1.7601) 64bit  \n\nCPU: Intel(R) Core(TM) i7-4770 CPU @ 3.40GHz (8)  \n\nRAM: 16336  \n\nGPU: AMD Radeon R9 200 Series (3049MB)  \n\nSM: 30 (Direct3D 9.0c [aticfx64.dll 22.19.662.4])\n\nI have try it in different resolutions but always i am taking 9-12 frames...even if i change the samples to 64 or 256 i am still taking the same framerate...if i remove scatterer i am at 60 fps....."},{"CreatedByName":"blackrack","CreatedById":104258,"CreatedDateTime":"2017-11-25T21:57:32Z","Content":"\u003E \n\u003E \n\u003E 14 minutes ago, John341 said:\n\u003E \n\u003E \n\u003E Thank you blackrack for your time...\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E My pc specs are\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E OS: Windows 7 Service Pack 1 (6.1.7601) 64bit  \n\u003E \n\u003E CPU: Intel(R) Core(TM) i7-4770 CPU @ 3.40GHz (8)  \n\u003E \n\u003E RAM: 16336  \n\u003E \n\u003E GPU: AMD Radeon R9 200 Series (3049MB)  \n\u003E \n\u003E SM: 30 (Direct3D 9.0c [aticfx64.dll 22.19.662.4])\n\u003E \n\u003E \n\u003E \n\u003E \n\u003E I have try it in different resolutions but always i am taking 9-12 frames...even if i change the samples to 64 or 256 i am still taking the same framerate...if i remove scatterer i am at 60 fps.....\n\u003E \n\nTry to keep the game running for a bit longer, change scenes a few times then send me a new log file. Also disable ocean refraction and see if it goes away."},{"CreatedByName":"Mr. Quark","CreatedById":156334,"CreatedDateTime":"2017-11-25T23:43:35Z","Content":"Has anyone checked if this works for 1.3.1? It doesn\u0027t for me but I want to know if anyone else has it where it doesn\u0027t either."}]}