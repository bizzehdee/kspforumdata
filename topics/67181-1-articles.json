{"TopicId":67181,"ForumId":29,"TopicTitle":"[Solved] Odd DLL interactions - where do I go next?","CreatedByName":"MOARdV","CreatedById":60950,"CreatedDateTime":"2014-03-30T01:42:31Z","PageNum":1,"Articles":[{"CreatedByName":"MOARdV","CreatedById":60950,"CreatedDateTime":"2014-03-30T01:42:31Z","Content":"\n\u003Cp\u003ESome players on the MechJeb thread reported that RasterPropMonitor was breaking MJ. After quite a bit of fiddling around, I found out that the DLL RPM uses to interface with SCANsat was the culprit - but only if SCANsat is \u003Cstrong\u003Enot\u003C/strong\u003E installed. I have no idea why this stopped working - players report that MJ dev build 182 or thereabouts works, but the most recent dev builds do not.\u003C/p\u003E\u003Cp\u003EWhen I look at KSP_Data/output_log.txt (with only MJ and RPM installed), I see this:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003EPartLoader: Compiling Part \u0027MechJeb2/Parts/MechJeb2_AR202/part/mumech_MJ2_AR202\u0027\u003Cbr\u003E\u003Cbr\u003E(Filename: C:/BuildAgent/work/ea95e74f6e5f192d/Runtime/ExportGenerated/StandalonePlayer/UnityEngineDebug.cpp Line: 54)\u003Cbr\u003E\u003Cbr\u003EMechJeb caught exception in core OnLoad: System.Reflection.ReflectionTypeLoadException: The classes in the module cannot be loaded.\u003Cbr\u003E  at (wrapper managed-to-native) System.Reflection.Assembly:GetTypes (bool)\u003Cbr\u003E  at System.Reflection.Assembly.GetTypes () [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003Cbr\u003E  at MuMech.MechJebCore.LoadComputerModules () [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003Cbr\u003E  at MuMech.MechJebCore.OnLoad (.ConfigNode sfsNode) [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003Cbr\u003E\u003Cbr\u003E(Filename: C:/BuildAgent/work/ea95e74f6e5f192d/Runtime/ExportGenerated/StandalonePlayer/UnityEngineDebug.cpp Line: 54)\u003Cbr\u003E\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003Eand, of course, early in the file is\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003ENon platform assembly: D:\\Games\\KSP-modtest\\GameData\\SCANsatRPM\\SCANsatRPM.dll (this message is harmless)\u003Cbr\u003EAssemblyLoader: Exception loading \u0027SCANsatRPM\u0027: System.Reflection.ReflectionTypeLoadException: The classes in the module cannot be loaded.\u003Cbr\u003E  at (wrapper managed-to-native) System.Reflection.Assembly:GetTypes (bool)\u003Cbr\u003E  at System.Reflection.Assembly.GetTypes () [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003Cbr\u003E  at AssemblyLoader.LoadAssemblies () [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003Cbr\u003E\u003Cbr\u003EAdditional information about this exception:\u003Cbr\u003E\u003Cbr\u003E System.TypeLoadException: Could not load type \u0027SCANsatRPM.JSISCANsatRPM\u0027 from assembly \u0027SCANsatRPM, Version=0.15.5201.30201, Culture=neutral, PublicKeyToken=null\u0027.\u003Cbr\u003E\u003Cbr\u003E System.TypeLoadException: Could not load type \u0027MapMarkupLine\u0027 from assembly \u0027SCANsatRPM, Version=0.15.5201.30201, Culture=neutral, PublicKeyToken=null\u0027.\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EIf I remove SCANsatRPM.dll, the AR202 loading section looks like this:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003EPartLoader: Compiling Part \u0027MechJeb2/Parts/MechJeb2_AR202/part/mumech_MJ2_AR202\u0027\u003Cbr\u003E\u003Cbr\u003E(Filename: C:/BuildAgent/work/ea95e74f6e5f192d/Runtime/ExportGenerated/StandalonePlayer/UnityEngineDebug.cpp Line: 54)\u003Cbr\u003E\u003Cbr\u003EPlatform assembly: D:\\Games\\KSP-modtest\\KSP_Data\\Managed\\Mono.Security.dll (this message is harmless)\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003ESo, it appears that when SCANsatRPM.dll fails to load (since the SCANsat assemblies it uses are missing), it somehow causes MechJeb to fail to load later. Again, this used to work, but something changed in MechJeb (apparently) and it doesn\u0027t now. While I could be a lazy engineer and say \u0022Well, MechJeb changed, so it\u0027s not my problem\u0022, I\u0027d really like to understand what happened and why, and change the RPM code if appropriate.\u003C/p\u003E\u003Cp\u003EHowever, I don\u0027t know what to even start looking for - nothing in the RPM code jumps out as obviously a problem, but I\u0027m also not a C# guy natively, so I may not see it if it\u0027s not screamingly obvious, anyway.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-03-30T14:57:20Z\u0022 title=\u002203/30/2014 02:57  PM\u0022 data-short=\u002210 yr\u0022\u003EMarch 30, 2014\u003C/time\u003E by MOARdV\u003C/strong\u003E\n\u003Cbr\u003EFound the solution\n\u003C/span\u003E\n"},{"CreatedByName":"Faark","CreatedById":69775,"CreatedDateTime":"2014-03-30T13:42:34Z","Content":"\n\u003Cp\u003EIts a MechJeb bug, caused by \u003Ca href=\u0022https://github.com/MuMech/MechJeb2/commit/d5cb827560c4856571ec48147aa7e197e4a840fc#diff-76b2c1f51af9f5ae7999e69e71e7233a\u0022 rel=\u0022external nofollow\u0022\u003Ethis\u003C/a\u003E change to MechJebCore.cs. He shouldn\u0027t have [re]moved the old try/catch but instead added another one...\u003C/p\u003E\n"},{"CreatedByName":"MOARdV","CreatedById":60950,"CreatedDateTime":"2014-03-30T14:56:38Z","Content":"\n\u003Cp\u003EThanks for the reply. Mihara suggested I look in that area this morning, as well. I pushed a change moving the try/catch block up a level to include the entire for/each loop.\u003C/p\u003E\n"}]}