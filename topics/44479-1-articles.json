{"TopicId":44479,"ForumId":32,"TopicTitle":"Can someone tell me why I am wrong? (single threaded physx?)","CreatedByName":"Cannibal","CreatedById":77789,"CreatedDateTime":"2013-08-31T12:23:05Z","PageNum":1,"Articles":[{"CreatedByName":"Cannibal","CreatedById":77789,"CreatedDateTime":"2013-08-31T12:23:05Z","Content":"\n\u003Cp\u003EHi there,\u003C/p\u003E\u003Cp\u003EI have been greatly enjoying KSP in general but found the large designs get pretty slow/laggy to get into orbit. I also noticed only one core was being used and that started me reading on why ksp is single threaded.\u003C/p\u003E\u003Cp\u003EFrom what I have read the limitation is that PhysX is used for physics simulation, and that PhysX is single threaded. \u003C/p\u003E\u003Cp\u003EA quick search led me to this page \u003Ca href=\u0022http://physxinfo.com/news/11327/multithreaded-performance-scaling-in-physx-sdk/\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://physxinfo.com/news/11327/multithreaded-performance-scaling-in-physx-sdk/\u003C/a\u003E\u003C/p\u003E\u003Cp\u003ESo as far as I can tell the 3.x releases of PhysX are multithreaded (go look for yourself).\u003C/p\u003E\u003Cp\u003EI am hoping that this means that the barrier to multi-threaded physics in KSP is gone, but don\u0027t want to get too wildly optimistic, so please tell me why I should not get my hopes up \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Tiron","CreatedById":51836,"CreatedDateTime":"2013-08-31T12:24:58Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Cannibal\u0022 data-cite=\u0022Cannibal\u0022\u003E\u003Cdiv\u003EHi there,\u003Cp\u003EI have been greatly enjoying KSP in general but found the large designs get pretty slow/laggy to get into orbit. I also noticed only one core was being used and that started me reading on why ksp is single threaded.\u003C/p\u003E\u003Cp\u003EFrom what I have read the limitation is that PhysX is used for physics simulation, and that PhysX is single threaded. \u003C/p\u003E\u003Cp\u003EA quick search led me to this page \u003Ca href=\u0022http://physxinfo.com/news/11327/multithreaded-performance-scaling-in-physx-sdk/\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://physxinfo.com/news/11327/multithreaded-performance-scaling-in-physx-sdk/\u003C/a\u003E\u003C/p\u003E\u003Cp\u003ESo as far as I can tell the 3.x releases of PhysX are multithreaded (go look for yourself).\u003C/p\u003E\u003Cp\u003EI am hoping that this means that the barrier to multi-threaded physics in KSP is gone, but don\u0027t want to get too wildly optimistic, so please tell me why I should not get my hopes up \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EBecause Unity uses an old 2.x release of PhysX, heavily integrated into the engine itself, and I\u0027ve yet to hear so much as a peep that they plan to upgrade it.\u003C/p\u003E\n"},{"CreatedByName":"Cannibal","CreatedById":77789,"CreatedDateTime":"2013-08-31T12:55:53Z","Content":"\n\u003Cp\u003EThank you for the quick response. I looked into it and found people on the unity engine forums clamouring for a PhysX version newer than 2009 \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 alt=\u0022:D\u0022\u003E\u003C/p\u003E\u003Cp\u003EI hope they get it as I would love to have it here too.\u003C/p\u003E\n"},{"CreatedByName":"alioth","CreatedById":80036,"CreatedDateTime":"2013-08-31T13:10:15Z","Content":"\n\u003Cp\u003EWithout knowing the internals of unity (and given it\u0027s closed source and proprietary, we can\u0027t) I\u0027m guessing you shouldn\u0027t hold your breath for it to be multithreaded. Unless you design your software to be multithreaded from the get-go, in the majority of cases you can\u0027t just bolt it on later, it often requires a complete rewrite. I wouldn\u0027t be surprised if 3 years from now, Unity remains single threaded. This seems like a particularly poor choice in this day and age (given that the writing was on the wall for single core performance ten years ago).\u003C/p\u003E\n"},{"CreatedByName":"lajoswinkler","CreatedById":79159,"CreatedDateTime":"2013-08-31T13:33:02Z","Content":"\n\u003Cp\u003EOrient your camera (right click drag, mouse wheel click drag) away from Kerbin when launching rockets. It helps \u003Cstrong\u003Ea lot\u003C/strong\u003E.\u003C/p\u003E\n"},{"CreatedByName":"NGTOne","CreatedById":55972,"CreatedDateTime":"2013-08-31T13:49:09Z","Content":"\n\u003Cp\u003EI\u0027ve heard that having a dedicated PhysX card helps, though nobody\u0027s actually done any research on this (I suppose they\u0027re rare enough that nobody cares to?).\u003C/p\u003E\u003Cp\u003EDoes anyone have a dediated PhysX card, to settle this question?\u003C/p\u003E\n"},{"CreatedByName":"AmpsterMan","CreatedById":32671,"CreatedDateTime":"2013-08-31T14:13:53Z","Content":"\n\u003Cp\u003EI\u0027m starting to feel like this Physx being single threaeded thing as being the main stopper on making KSP any more than it is. As it stands, anything above 200 parts lags for me and that is just barely enough to do anything imaginative and creative that is still sleek and functional.\u003C/p\u003E\n"},{"CreatedByName":"Tiron","CreatedById":51836,"CreatedDateTime":"2013-08-31T16:08:25Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022NGTOne\u0022 data-cite=\u0022NGTOne\u0022\u003E\u003Cdiv\u003EI\u0027ve heard that having a dedicated PhysX card helps, though nobody\u0027s actually done any research on this (I suppose they\u0027re rare enough that nobody cares to?).\u003Cp\u003EDoes anyone have a dediated PhysX card, to settle this question?\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ELast I heard it doesn\u0027t use that feature either. I\u0027ve read things indicating that both the multitheading and the hardware acceleration are options that can be enabled or disabled, but that might only be applicable to PhysX 3.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022AmpsterMan\u0022 data-cite=\u0022AmpsterMan\u0022\u003E\u003Cdiv\u003EI\u0027m starting to feel like this Physx being single threaeded thing as being the main stopper on making KSP any more than it is. As it stands, anything above 200 parts lags for me and that is just barely enough to do anything imaginative and creative that is still sleek and functional.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EIt really, really is, because you\u0027re entirely limited to what a single core on your system can handle.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022alioth\u0022 data-cite=\u0022alioth\u0022\u003E\u003Cdiv\u003EWithout knowing the internals of unity (and given it\u0027s closed source and proprietary, we can\u0027t) I\u0027m guessing you shouldn\u0027t hold your breath for it to be multithreaded. Unless you design your software to be multithreaded from the get-go, in the majority of cases you can\u0027t just bolt it on later, it often requires a complete rewrite. I wouldn\u0027t be surprised if 3 years from now, Unity remains single threaded. This seems like a particularly poor choice in this day and age (given that the writing was on the wall for single core performance ten years ago).\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI\u0027m told that KSP actually *is* multi-threaded, the catch being that the threads are basically entire specific subsystems. The problem is that the threads themselves can\u0027t be split among different cores, and the Physics thread uses far more resources than any of the other threads. So everything else *is* running on different cores, but are so small compared to the Physics it\u0027s not even noticeable.\u003C/p\u003E\n"},{"CreatedByName":"_Aramchek_","CreatedById":12588,"CreatedDateTime":"2013-08-31T16:11:26Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022NGTOne\u0022 data-cite=\u0022NGTOne\u0022\u003E\u003Cdiv\u003EI\u0027ve heard that having a dedicated PhysX card helps, though nobody\u0027s actually done any research on this (I suppose they\u0027re rare enough that nobody cares to?).\u003Cp\u003EDoes anyone have a dediated PhysX card, to settle this question?\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EUnity\u0027s version of PhysX is not gpu or ppu accelerated, it\u0027s done on the cpu on one thread/core.\u003C/p\u003E\u003Cp\u003EHaving a dedicated ppu shouldn\u0027t have any affect at all.\u003C/p\u003E\n"},{"CreatedByName":"Dedjal","CreatedById":57220,"CreatedDateTime":"2013-08-31T16:52:57Z","Content":"\n\u003Cp\u003Ephysx is single threaded, yes. But!\u003C/p\u003E\u003Cp\u003EIt runs single threaded, separated from the game.\u003C/p\u003E\u003Cp\u003ELook at World of Tanks. Single core game. But the game is run as one thread and physx is run as another thread.\u003C/p\u003E\n"},{"CreatedByName":"pxi","CreatedById":78711,"CreatedDateTime":"2013-08-31T19:18:36Z","Content":"\n\u003Cp\u003EWorld of Tanks uses the BigWorld engine, not Unity. \u003Ca href=\u0022http://www.bigworldtech.com/\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://www.bigworldtech.com/\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EIt\u0027s not really a fair comparison.\u003C/p\u003E\n"},{"CreatedByName":"Spyritdragon","CreatedById":70515,"CreatedDateTime":"2013-08-31T19:22:59Z","Content":"\n\u003Cp\u003EIf KSP would use all 8 of my i7 processors, does that mean i would be able to use 8 times as many parts, as long as my RAM can comply?\u003C/p\u003E\u003Cp\u003EAlso, yes, if you look around the forums you\u0027re bound to run into a guy with username Whackjob. He has launched vehicles well over 1000 parts successfully, with a reasonably unremarkable processor, but i believe he has a dedicated PhysX card.\u003C/p\u003E\u003Cp\u003EFrom what i\u0027ve seen around the forums here, yes, a dedicated card will help alot.\u003C/p\u003E\n"},{"CreatedByName":"FITorion","CreatedById":7606,"CreatedDateTime":"2013-08-31T20:22:37Z","Content":"\n\u003Cp\u003EI don\u0027t have a dedicated card... I do have an i7 and 32 GB RAM and a nvidia 680...\u003C/p\u003E\u003Cp\u003Eat around 900-1000 parts it starts to get laggy. I have not yet found the limit where the lag makes it unplayable. I play all stock. I think mods taking up RAM reduces part count as well.\u003C/p\u003E\n"},{"CreatedByName":"Whackjob","CreatedById":71402,"CreatedDateTime":"2013-08-31T20:37:58Z","Content":"\n\u003Cp\u003EI should threaten to bite the Unity developers.\u003C/p\u003E\n"},{"CreatedByName":"Cannibal","CreatedById":77789,"CreatedDateTime":"2013-08-31T22:34:16Z","Content":"\n\u003Cp\u003EI have managed to launch ~1500 part monstrosities, but it takes so long and the controls are so unresponsive that mechjeb is necessary to even get it off the ground \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EMy question was more aimed at understanding what is stopping the program from running better than it does currently. It sounds like they are boxed in unless unity decides to upgrade.\u003C/p\u003E\u003Cp\u003EI hope they will work around this by introducing some \u0027very large\u0027 scale parts and increase the strength of the existing ones so we can build things like the Saturn V without needing several hundred struts \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Whackjob","CreatedById":71402,"CreatedDateTime":"2013-08-31T22:37:11Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Cannibal\u0022 data-cite=\u0022Cannibal\u0022\u003E\u003Cdiv\u003EI have managed to launch ~1500 part monstrosities, but it takes so long and the controls are so unresponsive that mechjeb is necessary to even get it off the ground \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ENot really necessary, but maybe convenient.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Cannibal\u0022 data-cite=\u0022Cannibal\u0022\u003E\u003Cdiv\u003EMy question was more aimed at understanding what is stopping the program from running better than it does currently. It sounds like they are boxed in unless unity decides to upgrade.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EAn accurate assesment.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Cannibal\u0022 data-cite=\u0022Cannibal\u0022\u003E\u003Cdiv\u003EI hope they will work around this by introducing some \u0027very large\u0027 scale parts and increase the strength of the existing ones so we can build things like the Saturn V without needing several hundred struts \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI\u0027m split on this one. On one hand, I like big builds. On the other hand, I like the challenge of building big builds.\u003C/p\u003E\n"},{"CreatedByName":"Temstar","CreatedById":24430,"CreatedDateTime":"2013-08-31T22:48:47Z","Content":"\n\u003Cp\u003ESince by Moore\u0027s Law number of transisters on CPU doubles every 18 month, if the only limitation is maximum operations per second per core then we could potentually have KSP double the number of parts it can simulate comfortably just by brutal force.\u003C/p\u003E\n"},{"CreatedByName":"arq","CreatedById":71084,"CreatedDateTime":"2013-08-31T22:58:08Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Temstar\u0022 data-cite=\u0022Temstar\u0022\u003E\u003Cdiv\u003ESince by Moore\u0027s Law number of transisters on CPU doubles every 18 month, if the only limitation is maximum operations per second per core then we could potentually have KSP double the number of parts it can simulate comfortably just by brutal force.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EUnfortunately, Moore won\u0027t be much help to KSP. Moore\u0027s Law suggests than we could double the number of transistors on a chip every 18ish months. Clock speeds haven\u0027t increased significantly in almost a decade. There have been architectural improvements that let the processor do more with each clock, but improvements there are *much* slower than Moore\u0027s law and generally limited to specific scenarios.\u003C/p\u003E\u003Cp\u003EProcessors aren\u0027t getting faster nowadays (except for breaking some aforementioned bottlenecks - mostly memory-related), they\u0027re using less power (which can allow them to be marginally faster) and we\u0027re getting more of them. But for single-threaded programs like the physics in KSP, the improvements will come at a crawl.\u003C/p\u003E\n"},{"CreatedByName":"Cannibal","CreatedById":77789,"CreatedDateTime":"2013-08-31T23:21:29Z","Content":"\n\u003Cp\u003EI agree with arq... while the number of transistors is still sticking close to moore\u0027s law (which is the definition of the law), clock rates are stagnant and individual cores are not speeding up more than a few percent per generation now. Amusingly Bob Colwell who helped design the P6/pentium pro saw this coming back in 2003, but intel execs ignored him \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022https://www.youtube.com/watch?v=fuLKluXs1iA\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://www.youtube.com/watch?v=fuLKluXs1iA\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EThis video is an excellent watch.\u003C/p\u003E\n"},{"CreatedByName":"jtyotJOTJIPAEFVJ","CreatedById":67842,"CreatedDateTime":"2013-09-01T00:21:38Z","Content":"\n\u003Cp\u003ELooking at KSP with process explorer, it does indeed seem to run on 20-something threads. Although it\u0027s not a very significant increase in performance compared to what a single-thread program would be. Only one of the threads uses a core fully, while a few others combined use around a third of another core. The highest I got my CPU usage to go with a 600-part craft was 17% with 8 logical cores on an i7. Below is a screenshot showing the CPU usage of each thread. As you can see, only one of the threads does any real work while the rest run some minor tasks. This is most likely caused by Unity disliking multi-threading as mentioned above. \u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022https://vxpv0g.bay.livefilestore.com/y2pWpYVEVtnVFhB4IM7ZQ0pIJzlmsdDUIjSvX3yUkqzgwJHu-iL6A8sAGGUIY204HgAA8Bb-yW5SBESNkRYdWj3VrxAtb2EuwZsd9LZWW1b6dg/kspthreads.png?psid=1\u0022 alt=\u0022kspthreads.png?psid=1\u0022\u003E\u003C/p\u003E\u003Cp\u003EEdit: Rendering doesn\u0027t seem to be a bottleneck at least on my system. The same test that screenshot is from had GPU usage rise no higher than 33%. This is not so surprising, seeing how KSP doesn\u0027t have many fancy graphical effects.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-09-01T00:25:01Z\u0022 title=\u002209/01/2013 12:25  AM\u0022 data-short=\u002210 yr\u0022\u003ESeptember 1, 2013\u003C/time\u003E by jtyotJOTJIPAEFVJ\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Whackjob","CreatedById":71402,"CreatedDateTime":"2013-09-01T01:17:26Z","Content":"\n\u003Cp\u003EIf Unity Engine were a physical thing, I\u0027d bite it until it was pieces.\u003C/p\u003E\u003Cp\u003EGrr.\u003C/p\u003E\n"},{"CreatedByName":"Torminator","CreatedById":78617,"CreatedDateTime":"2013-09-01T03:11:27Z","Content":"\n\u003Cp\u003EI\u0027ve really come to dislike Unity.\u003C/p\u003E\u003Cp\u003EOne question I had, and maybe I\u0027m just the dumb, but why can\u0027t KSP compress a ship into a single physics object? \u003C/p\u003E\u003Cp\u003ELet\u0027s say it looks at your rocket, and says \u0022It has this much mass centered here, this much moment of intertia about that point, lift here, drag here, thrust here.\u0022 and then take a 200 part rocket and treat it as a single part outside a certain distance from other physical objects. As for things breaking, it shouldn\u0027t be difficult to say \u0022the first piece to break will be this, and it will occur at this acceleration.\u0022 and then, once you get near that threshold, that part is calculated as its own physics object until it either breaks off and continues being its own, or you go below the threshold again and it re-integrates. This could cause some slowdown when you near another ship (which happens anyway) or when pieces are about to break, but this might, especially if its optional, help to make performance around things like space stations much, much better. \u003C/p\u003E\u003Cp\u003ENow that I think about it, you could avoid a lot of the complications by only consolidating the physics like this when a craft is out of atmosphere, or otherwise physically static. Even further, only simplify when there are no forces on the object (in other words, situations where quicksave works).\u003C/p\u003E\u003Cp\u003EIt just rustles my jimmies somethin\u0027 fierce when I\u0027ve got a moon outpost with 3 ships at ~100 pieces each, and I\u0027m getting ~5fps when trying to walk around in EVA. There\u0027s really no need to simulate the physics of those parts in this situation, is there?\u003C/p\u003E\u003Cp\u003EKeep in mind, I have no idea what I\u0027m talking about.\u003C/p\u003E\n"},{"CreatedByName":"Tripzter","CreatedById":75335,"CreatedDateTime":"2013-09-01T04:22:57Z","Content":"\n\u003Cp\u003EThey simply need a mode that turns off physics for large stations until they figure out a better way to deal with the lag. Say over 500 parts the physics within the station components get turned off.\u003C/p\u003E\u003Cp\u003EI dont care if its inside the cheat menu.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-09-01T04:27:07Z\u0022 title=\u002209/01/2013 04:27  AM\u0022 data-short=\u002210 yr\u0022\u003ESeptember 1, 2013\u003C/time\u003E by Tripzter\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"OrbitusII","CreatedById":57305,"CreatedDateTime":"2013-09-01T04:53:54Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Torminator\u0022 data-cite=\u0022Torminator\u0022\u003E\u003Cdiv\u003Ewhy can\u0027t KSP compress a ship into a single physics object?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThe reason we have multiple physics objects comprising a single ship is because HarvesteR set it up that way. It\u0027s a ridiculously simple task to make everything in the vessel combined into one part (in fact, we can probably make entire vessels using part.cfg), but that would defeat the purpose of the system that Harv set up from the beginning.\u003C/p\u003E\u003Cp\u003EI agree, there are some times when a combined physics object for stationary objects like surface bases would be very helpful, especially with the lag-inducing terrain. However, if you have something like a floating base using Hooligan Labs or a base on the ocean, physics will need to be turned on to accurately maintain it.\u003C/p\u003E\n"},{"CreatedByName":"Whackjob","CreatedById":71402,"CreatedDateTime":"2013-09-01T05:55:25Z","Content":"\n\u003Cp\u003ENot to mention to better model collisions. I\u0027d rather bump a rover into a landing leg and maybe tear that off than have the whole ship detonate with the crew still inside.\u003C/p\u003E\n"}]}