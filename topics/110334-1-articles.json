{"TopicId":110334,"ForumId":29,"TopicTitle":"No method override for Astronaut Complex?","CreatedByName":"TheReadPanda","CreatedById":142617,"CreatedDateTime":"2015-05-22T03:28:54Z","PageNum":1,"Articles":[{"CreatedByName":"TheReadPanda","CreatedById":142617,"CreatedDateTime":"2015-05-22T03:28:54Z","Content":"\n\u003Cp\u003EI noticed that the GUI for several of the buildings seems to prevent override methods. So I can\u0027t re-do part of the astronaut complex for my hiring kerbals mod I am working on. I\u0027m working from the C# angle from the limited documentation from the assembly-CSharp.dll, as best as I can. Perhaps I am not finding the right hook? I can\u0027t see much about the astronaut complex at all to be honest. Is there a better place for looking for such information that does not involve trying to decompile things? (edit to clarify this last part).\u003C/p\u003E\u003Cp\u003EAnyone know if I am missing something? Or if there is any chance that Squad might remove that so that one might use an override method on some of the methods for the sub-buildings?\u003C/p\u003E\u003Cp\u003EI suspect the answer (From my search so far) is no to at least the first part. I think I will stick with just a button to pull up my new hiring interface but I thought it best to ask here before I gave up entirely on the idea.\u003C/p\u003E\u003Cp\u003EThanks in advance for any answers any of you may have, even if it is just to say \u0027no there isn\u0027t a way\u0027. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 alt=\u0022:D\u0022\u003E\u003C/p\u003E\u003Cp\u003E-OakTree42\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022http://www.twitch.tv/oaktree42/\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://www.twitch.tv/oaktree42/\u003C/a\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-05-22T03:45:20Z\u0022 title=\u002205/22/2015 03:45  AM\u0022 data-short=\u00229 yr\u0022\u003EMay 22, 2015\u003C/time\u003E by OakTree42\u003C/strong\u003E\n\u003Cbr\u003EClarify first part of the question\n\u003C/span\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2015-05-22T08:06:48Z","Content":"\n\u003Cp\u003ECan you be more specific as to what you\u0027re trying to do?\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Col style=\u0022list-style-type:decimal;\u0022\u003E\u003Cli\u003EPrevent player from opening astronaut complex? (and/or open your custom window instead)\u003Cbr\u003E\u003C/li\u003E\u003Cli\u003EDetect when the player is viewing (has entered) the AC?\u003Cbr\u003E\u003C/li\u003E\u003Cli\u003EEdit text on AC building description when left/right-clicked?\u003Cbr\u003E\u003C/li\u003E\u003Cli\u003EModify GUI of AC itself (change button conditions etc)?\u003Cbr\u003E\u003C/li\u003E\u003C/ol\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EThe first three are straightforward, the last item can be done but is somewhat tedious\u003C/p\u003E\n"},{"CreatedByName":"TheReadPanda","CreatedById":142617,"CreatedDateTime":"2015-05-22T20:19:26Z","Content":"\n\u003Cp\u003ESorry if I wasn\u0027t clear enough! My first attempt on this forum to ask questions about my mod efforts. I want to do 4. I want to take the left hand area where it shows kerbals you can hire and replace it with a hiring API that allows you to hire kerbals based on career, gender, courage, stupidity, fearless attribute and level. I would then have level limited on both the max level of kerbal of that career who is available currently on kerban at minus one to their level. And limited by the level of the building, meaning a hard limit of level 3. It would dynamically display how much said kerbal would cost and when you hit \u0027hire\u0027 it would randomly generate a name for that career type and create the kerbal, deduct the money and put him in your roster.\u003C/p\u003E\u003Cp\u003EAnd that\u0027s pretty much all of it. So the goal would be to take the left hand side of the AC interface and remove the current window and replace it with one of my own design.\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022color:#333333;\u0022\u003E-OakTree42\u003C/span\u003E\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022http://www.twitch.tv/oaktree42/\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://www.twitch.tv/oaktree42/\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EIs this doable? I can handle tedious if it is doable and you can point me in the right direction.\u003C/p\u003E\u003Cp\u003EMuch appreciated for your speedy reply by the way! Thanks!!\u003C/p\u003E\u003Cp\u003E-\u003C/p\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2015-05-23T02:06:28Z","Content":"\n\u003Cp\u003EReplacing the panel with your own is a lot easier than trying to modify the existing one, which I can tell you from experience is a maintenance nightmare. Here\u0027s a rough mockup that should get you started:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E[KSPAddon(KSPAddon.Startup.SpaceCentre, false)]\u003Cbr\u003Epublic class ReprogramAstronautComplex : MonoBehaviour\u003Cbr\u003E{\u003Cbr\u003E    private readonly ILog _log = new DebugLog(\u0022Reprogrammer\u0022);\u003Cbr\u003E    private Rect _windowRect = default(Rect);\u003Cbr\u003E    private AstronautComplexApplicantPanel _applicantPanel;\u003Cbr\u003E\u003Cbr\u003E    private void Start()\u003Cbr\u003E    {\u003Cbr\u003E        try\u003Cbr\u003E        {\u003Cbr\u003E            SetupSkin();\u003Cbr\u003E\u003Cbr\u003E            var complex = UIManager.instance.transform.Find(\u0022panel_AstronautComplex\u0022);\u003Cbr\u003E\u003Cbr\u003E#if DEBUG\u003Cbr\u003E            //DumpAssetBaseTextures();\u003Cbr\u003E            //complex.gameObject.PrintComponents(new DebugLog(\u0022Complex\u0022));\u003Cbr\u003E#endif\u003Cbr\u003E\u003Cbr\u003E            _applicantPanel = new AstronautComplexApplicantPanel(complex);\u003Cbr\u003E\u003Cbr\u003E            _windowRect = _applicantPanel.PanelArea;\u003Cbr\u003E            _applicantPanel.Hide();\u003Cbr\u003E\u003Cbr\u003E            GameEvents.onGUIAstronautComplexSpawn.Add(AstronautComplexShown);\u003Cbr\u003E            GameEvents.onGUIAstronautComplexDespawn.Add(AstronautComplexHidden);\u003Cbr\u003E\u003Cbr\u003E            enabled = false;\u003Cbr\u003E        }\u003Cbr\u003E        catch (Exception e)\u003Cbr\u003E        {\u003Cbr\u003E            _log.Error(\u0022Error: Encountered unhandled exception: \u0022 \u002B e);\u003Cbr\u003E            Destroy(this);\u003Cbr\u003E        }\u003Cbr\u003E\u003Cbr\u003E    }\u003Cbr\u003E\u003Cbr\u003E    private void AstronautComplexShown()\u003Cbr\u003E    {\u003Cbr\u003E        enabled = true;\u003Cbr\u003E    }\u003Cbr\u003E\u003Cbr\u003E    private void AstronautComplexHidden()\u003Cbr\u003E    {\u003Cbr\u003E        enabled = false;\u003Cbr\u003E    }\u003Cbr\u003E\u003Cbr\u003E    private void OnDestroy()\u003Cbr\u003E    {\u003Cbr\u003E        GameEvents.onGUIAstronautComplexDespawn.Remove(AstronautComplexHidden);\u003Cbr\u003E        GameEvents.onGUIAstronautComplexSpawn.Remove(AstronautComplexShown);\u003Cbr\u003E    }\u003Cbr\u003E\u003Cbr\u003E    private void SetupSkin()\u003Cbr\u003E    {\u003Cbr\u003E        _customWindowSkin = new GUIStyle(HighLogic.Skin.window)\u003Cbr\u003E        {\u003Cbr\u003E            contentOffset = Vector2.zero,\u003Cbr\u003E            padding = new RectOffset() { left = 0, right = HighLogic.Skin.window.padding.right, top = 0, bottom = 0}\u003Cbr\u003E        };\u003Cbr\u003E    }\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E    private void DumpAssetBaseTextures()\u003Cbr\u003E    {\u003Cbr\u003E        // note: there are apparently null entries in this list for some reason, hence the check\u003Cbr\u003E        FindObjectOfType\u0026lt;AssetBase\u0026gt;().textures.Where(t =\u0026gt; t != null).ToList().ForEach(t =\u0026gt; _log.Debug(\u0022AssetBase: \u0022 \u002B t.name));\u003Cbr\u003E    }\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E    private Vector2 _scroll = default(Vector2);\u003Cbr\u003E    private GUIStyle _customWindowSkin;\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E    private readonly Texture2D _portraitMale = AssetBase.GetTexture(\u0022kerbalicon_recruit\u0022);\u003Cbr\u003E    private readonly Texture2D _portraitFemale = AssetBase.GetTexture(\u0022kerbalicon_recruit_female\u0022);\u003Cbr\u003E\u003Cbr\u003E    private void OnGUI()\u003Cbr\u003E    {\u003Cbr\u003E        GUI.skin = HighLogic.Skin;\u003Cbr\u003E        var roster = HighLogic.CurrentGame.CrewRoster;\u003Cbr\u003E\u003Cbr\u003E        GUILayout.BeginArea(_windowRect, _customWindowSkin);\u003Cbr\u003E        {\u003Cbr\u003E            GUILayout.Label(\u0022Candidates\u0022);\u003Cbr\u003E            _scroll = GUILayout.BeginScrollView(_scroll, _customWindowSkin);\u003Cbr\u003E            {\u003Cbr\u003E                foreach (var applicant in roster.Applicants)\u003Cbr\u003E                    DrawListItem(applicant);\u003Cbr\u003E            }\u003Cbr\u003E            GUILayout.EndScrollView();\u003Cbr\u003E        }\u003Cbr\u003E        GUILayout.EndArea();\u003Cbr\u003E    }\u003Cbr\u003E\u003Cbr\u003E    private void DrawListItem(ProtoCrewMember crew)\u003Cbr\u003E    {\u003Cbr\u003E        GUILayout.BeginVertical(_customWindowSkin, GUILayout.ExpandHeight(false));\u003Cbr\u003E        {\u003Cbr\u003E            GUILayout.BeginHorizontal(GUILayout.ExpandHeight(true), GUILayout.MaxHeight(_portraitMale.height),\u003Cbr\u003E                GUILayout.ExpandWidth(true));\u003Cbr\u003E            {\u003Cbr\u003E                GUILayout.Label(crew.gender == ProtoCrewMember.Gender.Male ? _portraitMale : _portraitFemale);\u003Cbr\u003E\u003Cbr\u003E                GUILayout.BeginVertical(GUILayout.ExpandHeight(false), GUILayout.ExpandWidth(true));\u003Cbr\u003E                {\u003Cbr\u003E                    GUILayout.BeginHorizontal();\u003Cbr\u003E                    GUILayout.Label(crew.name);\u003Cbr\u003E                    GUILayout.FlexibleSpace();\u003Cbr\u003E                    GUILayout.Label(\u0022Trained \u0022 \u002B crew.experienceTrait.Title);\u003Cbr\u003E                    GUILayout.EndHorizontal();\u003Cbr\u003E\u003Cbr\u003E                    GUILayout.Label(\u0022More info here\u0022);\u003Cbr\u003E\u003Cbr\u003E                    GUILayout.BeginHorizontal();\u003Cbr\u003E                    GUILayout.FlexibleSpace();\u003Cbr\u003E                    GUILayout.Button(\u0022Hire Applicant\u0022, GUILayout.MaxWidth(100f)); // todo: hire logic \u003Cbr\u003E                    GUILayout.EndHorizontal();\u003Cbr\u003E                }\u003Cbr\u003E                GUILayout.EndVertical();\u003Cbr\u003E            }\u003Cbr\u003E            GUILayout.EndHorizontal();\u003Cbr\u003E        }\u003Cbr\u003E        GUILayout.EndVertical();\u003Cbr\u003E    }\u003Cbr\u003E}\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003Epublic class AstronautComplexApplicantPanel\u003Cbr\u003E{\u003Cbr\u003E    private readonly Transform _applicantPanel;\u003Cbr\u003E\u003Cbr\u003E    public AstronautComplexApplicantPanel(Transform astronautComplex)\u003Cbr\u003E    {\u003Cbr\u003E        if (astronautComplex == null) throw new ArgumentNullException(\u0022astronautComplex\u0022);\u003Cbr\u003E        _applicantPanel = astronautComplex.Find(\u0022CrewPanels/panel_applicants\u0022);\u003Cbr\u003E\u003Cbr\u003E        if (_applicantPanel == null)\u003Cbr\u003E            throw new ArgumentException(\u0022No applicant panel found on \u0022 \u002B astronautComplex.name);\u003Cbr\u003E    }\u003Cbr\u003E\u003Cbr\u003E    public void Hide(bool tf = true)\u003Cbr\u003E    {\u003Cbr\u003E        _applicantPanel.gameObject.SetActive(!tf);\u003Cbr\u003E    }\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E    public Rect PanelArea\u003Cbr\u003E    {\u003Cbr\u003E        get\u003Cbr\u003E        {\u003Cbr\u003E            // whole panel is an EzGUI BTButton and we\u0027ll be needing to know about its renderer to come up\u003Cbr\u003E            // with screen coordinates\u003Cbr\u003E            var button = _applicantPanel.GetComponent\u0026lt;BTButton\u0026gt;() as SpriteRoot;\u003Cbr\u003E\u003Cbr\u003E            if (button == null)\u003Cbr\u003E                throw new Exception(\u0022AstronautComplexApplicantPanel: Couldn\u0027t find BTButton on \u0022 \u002B\u003Cbr\u003E                                    _applicantPanel.name);\u003Cbr\u003E\u003Cbr\u003E            var uiCam = UIManager.instance.uiCameras.FirstOrDefault(uic =\u0026gt; (uic.mask \u0026amp; (1 \u0026lt;\u0026lt; _applicantPanel.gameObject.layer)) != 0);\u003Cbr\u003E            if (uiCam == null)\u003Cbr\u003E                throw new Exception(\u0022AstronautComplexApplicantPanel: Couldn\u0027t find a UICamera for panel\u0022);\u003Cbr\u003E\u003Cbr\u003E            var screenPos = uiCam.camera.WorldToScreenPoint(_applicantPanel.position);\u003Cbr\u003E\u003Cbr\u003E            return new Rect(screenPos.x, Screen.height - screenPos.y, button.PixelSize.x, button.PixelSize.y);\u003Cbr\u003E        }\u003Cbr\u003E    }\u003Cbr\u003E}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cblockquote\u003E\u003Cimg src=\u0022http://puu.sh/hX5Lb/8fa0f47e1d.png\u0022 alt=\u00228fa0f47e1d.png\u0022\u003E\u003C/blockquote\u003E\n"},{"CreatedByName":"TheReadPanda","CreatedById":142617,"CreatedDateTime":"2015-05-29T21:08:17Z","Content":"\n\u003Cp\u003EI have used this code to great effect but have a sort of problem here. My hire system works now, but I have to leave and return to the complex to get the right side to refresh. Is there something here that I could call upon hiring? I tried the game event for onhire but that just seems to deduct cash and not actually do what I want.\u003C/p\u003E\u003Cp\u003EI thought I had a hiring code issue but when I found it was working by leaving after I checked the save game file...\u003C/p\u003E\u003Cp\u003EAlso this does not seem to over-write the astronaut complex if it is entered via the vab/sph crew option. Is there a way to make that work?\u003C/p\u003E\u003Cp\u003EYour help has been EXTREMELY helpful and I can not thank you enough for the help you have already given!\u003C/p\u003E\n"},{"CreatedByName":"TheReadPanda","CreatedById":142617,"CreatedDateTime":"2015-05-29T22:24:51Z","Content":"\n\u003Cp\u003EBy Firing the \u003C/p\u003E\u003Cp\u003E GameEvents.onGUIAstronautComplexSpawn.Fire();\u003C/p\u003E\u003Cp\u003EI was able to get the screen to refresh upon hiring a kerbal!\u003C/p\u003E\u003Cp\u003EYAY!\u003C/p\u003E\n"}]}