{"TopicId":156638,"ForumId":29,"TopicTitle":"Can .invoke be delayed until the game isn\u0026#039;t busy?","CreatedByName":"Rodhern","CreatedById":144074,"CreatedDateTime":"2017-02-18T15:40:22Z","PageNum":1,"Articles":[{"CreatedByName":"Rodhern","CreatedById":144074,"CreatedDateTime":"2017-02-18T15:40:22Z","Content":"\n\u003Cp\u003E\nIs there an easy way to tell how busy Unity is?\n\u003C/p\u003E\n\u003Cp\u003E\nOver at \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/151769-how-to-know-when-settings-are-accepted/\u0022 rel=\u0022\u0022\u003Ethis thread\u003C/a\u003E I was told about a good idea, that if I monitor when the game unpauses, I can check for changes in the difficulty settings (e.g. to enable and disable an add-on).\n\u003C/p\u003E\n\u003Cp\u003E\nThe unpause thing also happens (sometimes) when the scene changes e.g. the transition from Space Center scene to Main Menu scene. I thought I would like to delay the processing until the scene change was done, so I did a Unity \u0027.Invoke (\u0022name\u0022, 1.0)\u0027 to postpone my handler code for a second.\n\u003C/p\u003E\n\u003Cp\u003E\nTo my surprise Unity is quite keen on doing a good job timing-wise and one second later, (less than) halfway through the scene change, my handler is invoked. Ok, so it sounds silly to complain that I got what it said on the tin! Still, what I was aiming for wasn\u0027t quite to delay execution for only half a scene change.\n\u003C/p\u003E\n\u003Cp\u003E\nI guess I could explicitly monitor say \u0027GameEvents.onGameSceneLoadRequested\u0027 and \u0027GameEvents.onLevelWasLoaded\u0027. Is that a terrible idea? Is there a better way?\n\u003C/p\u003E\n"},{"CreatedByName":"Warezcrawler","CreatedById":145377,"CreatedDateTime":"2017-02-18T22:04:26Z","Content":"\n\u003Cp\u003E\nI\u0027m sorry, what exactly are you trying to achieve? Are you running some heavy calculations? or are you more looking for some specific event to occur?\n\u003C/p\u003E\n"},{"CreatedByName":"Rodhern","CreatedById":144074,"CreatedDateTime":"2017-02-19T10:10:20Z","Content":"\n\u003Cp\u003E\nI was wondering how best to do stuff that is \u003Cu\u003Enot\u003C/u\u003E time critical. Maybe I got a bit carried away. I haven\u0027t got any code yet.\n\u003C/p\u003E\n\u003Cp\u003E\nThe example that I was playing with was to detect when difficulty settings are changed, and then update some mod variables (or maybe disable the mod). If the player changes settings and it takes a few seconds before it is detected that is just fine. So I imagined some sort of loop (or more specifically to the above case, monitor every game unpause), and then the trick would be to run the loop when the rest of the game is least busy.\n\u003C/p\u003E\n\u003Cp\u003E\nA more useful scenario may be to check if some contract is fulfilled yet. Let us say the contract is to make sure you have 6 satellites in a particular constellation relative to each other. Let us say to determine if the condition is satisfied requires \u0027heavy calculation\u0027. Let us also assume that it is not important to detect contract success right away, if we can mange to check once a minute that is fine.\n\u003C/p\u003E\n\u003Cp\u003E\nSince the last post I peeked at the \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/91625-12x-contract-configurator-v1222-2016-12-16/\u0022 rel=\u0022\u0022\u003EContract Configurator\u003C/a\u003E code, and there it seemed some of the trick is to run a bit of code in Update, but only every 20th frame. (if I read it correctly).\n\u003C/p\u003E\n\u003Cp\u003E\nIs that how you would do it? Count frames?\n\u003C/p\u003E\n"},{"CreatedByName":"Warezcrawler","CreatedById":145377,"CreatedDateTime":"2017-02-22T22:35:52Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222960388\u0022 data-ipsquote-contentid=\u0022156638\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221487499020\u0022 data-ipsquote-userid=\u0022144074\u0022 data-ipsquote-username=\u0022Rodhern\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nOn 19/2/2017 at 11:10 AM, Rodhern said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nI was wondering how best to do stuff that is \u003Cu\u003Enot\u003C/u\u003E time critical. Maybe I got a bit carried away. I haven\u0027t got any code yet.\n\u003C/p\u003E\n\u003Cp\u003E\nThe example that I was playing with was to detect when difficulty settings are changed, and then update some mod variables (or maybe disable the mod). If the player changes settings and it takes a few seconds before it is detected that is just fine. So I imagined some sort of loop (or more specifically to the above case, monitor every game unpause), and then the trick would be to run the loop when the rest of the game is least busy.\n\u003C/p\u003E\n\u003Cp\u003E\nA more useful scenario may be to check if some contract is fulfilled yet. Let us say the contract is to make sure you have 6 satellites in a particular constellation relative to each other. Let us say to determine if the condition is satisfied requires \u0027heavy calculation\u0027. Let us also assume that it is not important to detect contract success right away, if we can mange to check once a minute that is fine.\n\u003C/p\u003E\n\u003Cp\u003E\nSince the last post I peeked at the \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/91625-12x-contract-configurator-v1222-2016-12-16/\u0022 rel=\u0022\u0022\u003EContract Configurator\u003C/a\u003E code, and there it seemed some of the trick is to run a bit of code in Update, but only every 20th frame. (if I read it correctly).\n\u003C/p\u003E\n\u003Cp\u003E\nIs that how you would do it? Count frames?\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nWell, I think that if you do heavy calculations, then creating a new thread would be the way to go (example can be found in the linked GitHub code below).\n\u003C/p\u003E\n\u003Cp\u003E\nIf the calculation is light using update() could be fine, many modders use this approach where they check for simply criteria.\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222959529\u0022 data-ipsquote-contentid=\u0022156638\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221487432422\u0022 data-ipsquote-userid=\u0022144074\u0022 data-ipsquote-username=\u0022Rodhern\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nOn 18/2/2017 at 4:40 PM, Rodhern said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nI guess I could explicitly monitor say \u0027GameEvents.onGameSceneLoadRequested\u0027 and \u0027GameEvents.onLevelWasLoaded\u0027. Is that a terrible idea? Is there a better way?\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nYou can easily subscribe to an event like the above ones which is a great way of having you code only run on demand. And if a suitable event already exists then that would be my recommendation.\n\u003C/p\u003E\n\u003Cp\u003E\nCoroutines can be used if you want some code to run much less that e.g. the update() or fixedupdate(). Coroutines are apparently much less demanding than using \u0022Invoke\u0022, according to the research I\u0027ve done on related topics. You can have the coroutine only run e.g. every 5 seconds if that is what is needed. I do think that could be more efficient that counting frames, though both should be quite light.\n\u003C/p\u003E\n\u003Cp\u003E\nIf you need a custom event, I would recommend reading this thread\n\u003C/p\u003E\n\u003Ciframe data-embedcontent=\u0022\u0022 frameborder=\u00220\u0022 src=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/153112-ksp-122-gameevents-extension/\u0026amp;do=embed\u0022\u003E\u003C/iframe\u003E\n\u003Cp\u003E\nI also posted some question regarding throttle event, where there might be some interesting facts.\n\u003C/p\u003E\n\u003Ciframe data-embedcontent=\u0022\u0022 frameborder=\u00220\u0022 src=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/155741-answered-throttle-event/\u0026amp;do=embed\u0022\u003E\u003C/iframe\u003E\n\u003Cp\u003E\nFurthermore, I created the onThrottleChange event, which you can look at if you go for a custom event\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://github.com/WarezCrawler/Guybrush101/blob/master/GTI_Utilities/GTI_Events.cs\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/WarezCrawler/Guybrush101/blob/master/GTI_Utilities/GTI_Events.cs\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nThe code also have an example on subscribing to an event.\n\u003C/p\u003E\n\u003Cp\u003E\nSubscribe:\u00A0\u003Ca href=\u0022https://github.com/WarezCrawler/Guybrush101/blob/master/GTI_Utilities/GTI_Events.cs#L58-L63\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/WarezCrawler/Guybrush101/blob/master/GTI_Utilities/GTI_Events.cs#L58-L63\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nSubsciber:\u00A0\u003Ca href=\u0022https://github.com/WarezCrawler/Guybrush101/blob/master/GTI_Utilities/GTI_Events.cs#L195-L204\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/WarezCrawler/Guybrush101/blob/master/GTI_Utilities/GTI_Events.cs#L195-L204\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nI know the code is commented out, but that is only because it was not for the final release, only for testing purposes.\n\u003C/p\u003E\n"}]}