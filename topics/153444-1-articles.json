{"TopicId":153444,"ForumId":70,"TopicTitle":"Slow memory leak, 3\u002B GB over a period of 2 hrs","CreatedByName":"The Destroyer","CreatedById":36109,"CreatedDateTime":"2016-12-13T05:37:38Z","PageNum":1,"Articles":[{"CreatedByName":"The Destroyer","CreatedById":36109,"CreatedDateTime":"2016-12-13T05:37:38Z","Content":"\n\u003Cp\u003E\nSo, the game works fine. It loads at around ~3GB of RAM, and in game it\u0027s 3.5 GB. Totally normal, even in 32 bit that would be the case. I\u0027m using 64 bit, and over time of playing KSP, the memory usage slowly but surely creeps up, 4GB, 5GB, up to 6GB before I had to terminate and relaunch KSP as it would either crash the game or my system. (8GB of RAM). No idea what is causing it, I\u0027m using SVE...\n\u003C/p\u003E\n\u003Cp\u003E\nMod list:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan class=\u0022pln\u0022\u003EKSP: 1.2.2 (Win64) - Unity: 5.4.0p4 - OS: Windows 7 Service Pack 1 (6.1.7601) 64bit\nFilter Extensions - 2.7.4.2\nToolbar - 1.7.13\n\u003Cabbr title=\u0022Umbra Space Industries (a collection of mods)\u0022\u003EUSI\u003C/abbr\u003E Tools - 0.8.6\nB9 Part Switch - 1.5.3\nBon Voyage - 0.11.1\nCommunity Category Kit - 1.2.1\nCommunity Resource Pack - 0.6.3\nCommunityTechTree - 3.0.2\nContract Configurator - 1.21\nCustomBarnKit - 1.1.10\nDistantObjectEnhancement - 1.8.1\nFirespitter - 7.4.2\nFlexible Docking - 1.0.4\nInterstellar Fuel Switch - 2.3\nKerbal Attachment System - 0.6.1\nKerbal Engineer Redux - 1.1.2.8\nKerbal Joint Reinforcement - 3.3.1\nKerbNet Controller - 1.0.2\nKerbal Inventory System - 1.4\nKSP-AVC Plugin - 1.1.6.2\nModularFlightIntegrator - 1.2.2\nNearFutureConstruction - 0.7.2\nNearFutureElectrical - 0.8.2\nNearFuturePropulsion - 0.8.2\nNearFutureSolar - 0.7.1\nNearFutureSpacecraft - 0.5.4\nPlay Your Way - 1.0.1\nScience Relay - 1.0.3\nSSTULabs - 0.5.34.130\nStageRecovery - 1.6.5\nStock Visual Enhancements - 1.1.4\nStrategia - 1.5\nTweakScale - 2.3.2\n\u003Cabbr title=\u0022Umbra Space Industries (a collection of mods)\u0022\u003EUSI\u003C/abbr\u003E Core - 0.3.4\nKarbonite - 0.8.3\nKarbonite Plus - 0.7.3\nKonstruction - 0.1.2\n\u003Cabbr title=\u0022Umbra Space Industries (a collection of mods)\u0022\u003EUSI\u003C/abbr\u003E-LS - 0.5.13\nMalemute Rover - 0.2.3\nUKS - 0.50.7\nKSP Interstellar Extended - 1.11.7\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nHere is KSP.log and output_log. (not sure how to do attachments on the forum, too used to the old vbulletin\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://www.dropbox.com/s/w6o5n03prgl0kw0/KSP.zip?dl=0\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://www.dropbox.com/s/w6o5n03prgl0kw0/KSP.zip?dl=0\u003C/a\u003E\n\u003C/p\u003E\n"},{"CreatedByName":"The Destroyer","CreatedById":36109,"CreatedDateTime":"2016-12-14T05:11:31Z","Content":"\n\u003Cp\u003E\nIf it helps, it appears that RAM fluctuates wildly during a scene change, and the more I scene change, the more of a leak it\u0027ll get\n\u003C/p\u003E\n"},{"CreatedByName":"Gianni1122","CreatedById":170752,"CreatedDateTime":"2016-12-14T15:55:57Z","Content":"\n\u003Ciframe data-embedcontent=\u0022\u0022 frameborder=\u00220\u0022 src=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/130132-memory-leak/\u0026amp;do=embed\u0022\u003E\u003C/iframe\u003E\u003Ciframe data-embedcontent=\u0022\u0022 frameborder=\u00220\u0022 src=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/152346-determining-a-memory-leak-culprit/\u0026amp;do=embed\u0022\u003E\u003C/iframe\u003E\u003Ciframe data-embedcontent=\u0022\u0022 frameborder=\u00220\u0022 src=\u0022https://forum.kerbalspaceprogram.com/index.php?/topic/153309-ram-usage-difference-win7win10/\u0026amp;do=embed\u0026amp;comment=2886469\u0026amp;embedComment=2886469\u0026amp;embedDo=findComment#comment-2886469\u0022\u003E\u003C/iframe\u003E\n\u003Cp\u003E\nVery recently,\u00A0I saw a post about heavy RAM usage that seemed similar (EDIT: It\u0027s the 3rd one above). If I find it ill add it too. Hope these help\u00A0\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-12-14T15:58:59Z\u0022 title=\u002212/14/2016 03:58  PM\u0022 data-short=\u00227 yr\u0022\u003EDecember 14, 2016\u003C/time\u003E by Gianni1122\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"The Destroyer","CreatedById":36109,"CreatedDateTime":"2016-12-14T21:07:02Z","Content":"\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/170752-gianni1122/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022170752\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/170752-gianni1122/\u0022 rel=\u0022\u0022\u003E@Gianni1122\u003C/a\u003E\u00A0Yeah, I think it\u0027s just a stock memory leak. I guess it isn\u0027t solvable, except with using less mods so that KSP needs to restart less often\n\u003C/p\u003E\n"},{"CreatedByName":"Vicis","CreatedById":120624,"CreatedDateTime":"2016-12-17T19:39:05Z","Content":"\n\u003Cp\u003E\nBeen having the same issue. Had it in 1.2.1 and still have it in 1.2.2. My game doesn\u0027t crash, but I\u0027ve seen it go up to over 7gb.\n\u003C/p\u003E\n"},{"CreatedByName":"diomedea","CreatedById":93700,"CreatedDateTime":"2016-12-17T22:54:31Z","Content":"\n\u003Cp\u003E\nI have RAM usage increase in a highly modded 1.2.1 KSP install (got virtual memory size to around 16 GB for just KSP in a few hours, then I generally unload/restart to avoid the worst). Nothing that serious in a stock KSP 1.2.2. install; however can still see a slight increase if I keep changing scenes (did a number of tests to be sure), even if nothing else changes. That alone brings to consider the possibility a leak may actually exist in stock (and probably many more with add-ons). Thanks to a specialized tool by \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/57146-sarbian/\u0026amp;do=hovercard\u0022 data-mentionid=\u002257146\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/57146-sarbian/\u0022 rel=\u0022\u0022\u003E@sarbian\u003C/a\u003E I could now check results based on number of objects dynamically used by KSP 1.2.2, and effectively seems a leak is present\u00A0 related to PQ objects (procedural quadtree) used to render the planetary surface.\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027m going to report this evidence, hopefully it may help the dev team to fix at least the issue in stock. No promise....\n\u003C/p\u003E\n"},{"CreatedByName":"Anth","CreatedById":161238,"CreatedDateTime":"2017-01-09T02:43:54Z","Content":"\n\u003Cp\u003E\nInteresting. I reported this bug in the prerelease....\n\u003C/p\u003E\n"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2017-01-10T12:11:07Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222891611\u0022 data-ipsquote-contentid=\u0022153444\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221482015271\u0022 data-ipsquote-userid=\u002293700\u0022 data-ipsquote-username=\u0022diomedea\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nOn 17/12/2016 at 11:54 PM, diomedea said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nand effectively seems a leak is present\u00A0 related to PQ objects (procedural quadtree) used to render the planetary surface.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nI am a bit late to the party but you fell in the same trap than me last year \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nThe game has a PQ cache that it fills up slowly until it reach a set amount (from memory 1500). Once it reach that you should find that there is no more new PQ object created (in stock).\n\u003C/p\u003E\n\u003Cp\u003E\nThe last time I checked I could not find a obvious leak in stock after that cache is filled. The current size of the cache is available somewhere and I think I have a bit of code to check it laying somewhere at home.\n\u003C/p\u003E\n\u003Cp\u003E\nNow with mod there may be other source of leaks. From my own experience with my code (and some others) one of the common culprit is mods creating texture when they load but never destroying them. One would have to run my \u003Cem\u003Esecretz\u003C/em\u003E to find out that. Maybe I should open a thread with it but I am a bit afraid of unleashing a tool that require a good knowledge of Unity to interpret its results...\n\u003C/p\u003E\n"},{"CreatedByName":"diomedea","CreatedById":93700,"CreatedDateTime":"2017-01-10T12:25:15Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222916712\u0022 data-ipsquote-contentid=\u0022153444\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221484050267\u0022 data-ipsquote-userid=\u002257146\u0022 data-ipsquote-username=\u0022sarbian\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n2 minutes ago, sarbian said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nI am a bit late to the party but you fell in the same trap than me last year \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nThe game has a PQ cache that it fills up slowly until it reach a set amount (from memory 1500). Once it reach that you should find that there is no more new PQ object created (in stock).\n\u003C/p\u003E\n\u003Cp\u003E\nThe last time I checked I could not find a obvious leak in stock after that cache is filled. The current size of the cache is available somewhere and I think I have a bit of code to check it laying somewhere at home.\n\u003C/p\u003E\n\u003Cp\u003E\n....\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nOh, glad to learn the above \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E. Pity such features aren\u0027t so well documented, it takes very good modders to unveil them.\n\u003C/p\u003E\n"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2017-01-10T12:36:22Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222916733\u0022 data-ipsquote-contentid=\u0022153444\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221484051115\u0022 data-ipsquote-userid=\u002293700\u0022 data-ipsquote-username=\u0022diomedea\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n10 minutes ago, diomedea said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nOh, glad to learn the above \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E. Pity such features aren\u0027t so well documented, it takes very good modders to unveil them.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nAnd lengthy exchange with the dev who wrote it \u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nI found the counters :\n\u003C/p\u003E\n\u003Cp\u003E\nPQSCache.Instance.cachePQAssignedCount\u003Cbr\u003E\nPQSCache.Instance.cachePQUnassignedCount\u003Cbr\u003E\nPQSCache.Instance.cachePQTotalCount\n\u003C/p\u003E\n"}]}