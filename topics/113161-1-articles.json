{"TopicId":113161,"ForumId":15,"TopicTitle":"Undesired lighting effects","CreatedByName":"Randazzo","CreatedById":136468,"CreatedDateTime":"2015-06-17T01:23:20Z","PageNum":1,"Articles":[{"CreatedByName":"Randazzo","CreatedById":136468,"CreatedDateTime":"2015-06-17T01:23:20Z","Content":"For some reason, I have two models that are being bisected horizontally by shadow in certain orientations:\n\n![qYTiGVY.png](http://i.imgur.com/qYTiGVY.png)\n\n![s8O0Elb.png](http://i.imgur.com/s8O0Elb.png)\n\nBut if I turn them on their side, the shading is uniformly shadowed:\n\n![MVE2Bhi.png](http://i.imgur.com/MVE2Bhi.png)![pv5yhrl.png](http://i.imgur.com/pv5yhrl.png)\n\nAny idea what bizarro-world magic is doing this? Do I need to use a lightmap or something? I\u0027ve not encountered this on any of the larger stuff I have (and I even made one of them from scratch):\n\n![7gOOgMl.png](http://i.imgur.com/7gOOgMl.png)"},{"CreatedByName":"sumghai","CreatedById":66272,"CreatedDateTime":"2015-06-17T01:49:20Z","Content":"Looks like mesh smoothing issues.\n\nAre you using Blender?"},{"CreatedByName":"Randazzo","CreatedById":136468,"CreatedDateTime":"2015-06-17T01:55:04Z","Content":"\u003E \n\u003E Looks like mesh smoothing issues.\n\u003E Are you using Blender?\n\nI am indeed.\n\nedit: And I notice in the heatsink picture, it appears to be happening to the edges of the mounting plates, but that\u0027s actually a black line in the texture."},{"CreatedByName":"sumghai","CreatedById":66272,"CreatedDateTime":"2015-06-17T03:57:44Z","Content":"Since you\u0027re using Blender:\n\n - [Enable smoothing](http://www.blender.org/manual/modeling/meshes/smoothing.html) for your mesh(es)\n\n - Add (**but do NOT apply**) a Edge Split modifier, and set the angle to 30~45 degrees\n\nThis will make the sides of the cylinder smooth, while the ends of the cylinder will remain crisp. \n\nAlso, by not actually applying the Edge Split modifier, you allow the cylinder to be edited normally (Applying Edge Split for realz literally doubles the number of vertices between edges, which makes life harder for you later no when you try to resize/modify the cylinder)"},{"CreatedByName":"Randazzo","CreatedById":136468,"CreatedDateTime":"2015-06-17T04:00:44Z","Content":"\u003E \n\u003E Since you\u0027re using Blender:\n\u003E  - [Enable smoothing](http://www.blender.org/manual/modeling/meshes/smoothing.html) for your mesh(es)\n\u003E \n\u003E  - Add (**but do NOT apply**) a Edge Split modifier, and set the angle to 30~45 degrees\n\u003E \n\u003E This will make the sides of the cylinder smooth, while the ends of the cylinder will remain crisp. \n\u003E \n\u003E Also, by not actually applying the Edge Split modifier, you allow the cylinder to be edited normally (Applying Edge Split for realz literally doubles the number of vertices between edges, which makes life harder for you later no when you try to resize/modify the cylinder)\n\nExcellent info, thanks!"},{"CreatedByName":"cxg2827","CreatedById":57380,"CreatedDateTime":"2015-06-17T05:30:37Z","Content":"\u003E Also, by not actually applying the Edge Split modifier, you allow the cylinder to be edited normally (Applying Edge Split for realz literally doubles the number of vertices between edges, which makes life harder for you later no when you try to resize/modify the cylinder)\n\nI never knew you didn\u0027t have to apply the modifier to get it to stick. One way to deal with modifying it later is just to remove doubles, then re apply the edge split modifier afterwards."},{"CreatedByName":"NecroBones","CreatedById":105424,"CreatedDateTime":"2015-06-17T17:32:14Z","Content":"Also worth noting is that even with a sensible edge-split angle, Blender sometimes still gets confused with normals when you have a truly \u0022manifold\u0022 mesh. I found this out the hard way. Cylinders with rims and/or protrusions (inward or outward) can mess with it. So I\u0027ll usually take the outer, truly cylindrical surfaces, and hit \u0022Y\u0022 to detach them as their own islands. Just be careful not to \u0022remove doubles\u0022 on it again later. If you\u0027re editing in \u0022solid\u0022 viewport shading, you may see the shading change as soon as you hit \u0022Y\u0022. If so, it was altering your normals, and now it will look better.\n\nUntil I figured this out, some of my tanks had *impossible* shadow orientations:\n\n![cMyxYNd.png](http://i.imgur.com/cMyxYNd.png)\n\n\u003E \n\u003E I never knew you didn\u0027t have to apply the modifier to get it to stick. One way to deal with modifying it later is just to remove doubles, then re apply the edge split modifier afterwards.\n\nYep, what I usually do is export as Collada/DAE for importing to Unity, and make sure the \u0022apply modifiers\u0022 checkbox is checked. That way it gets applied during the export.\n\n**Edited \u003Ctime datetime=\u00222015-06-17T18:17:11Z\u0022 title=\u002206/17/2015 06:17  PM\u0022 data-short=\u00229 yr\u0022\u003EJune 17, 2015\u003C/time\u003E by NecroBones**"},{"CreatedByName":"sumghai","CreatedById":66272,"CreatedDateTime":"2015-06-17T20:53:53Z","Content":"\u003E \n\u003E I never knew you didn\u0027t have to apply the modifier to get it to stick. One way to deal with modifying it later is just to remove doubles, then re apply the edge split modifier afterwards.\n\n\u003E \n\u003E Yep, what I usually do is export as Collada/DAE for importing to Unity, and make sure the \u0022apply modifiers\u0022 checkbox is checked. That way it gets applied during the export.\n\nLots of Blender modifiers can simply be present in the .blend file, not permanently applied to their respective meshes, and still propagate to Unity.\n\nI\u0027m also using Blender prefabs for Unity, so Unity automatically accepts .blend files without the need for intermediate file formats like Collada/DAE - I can save my Blender file, and Unity will automatically reload the model in the 3D view / GameObject hierarchy."},{"CreatedByName":"Randazzo","CreatedById":136468,"CreatedDateTime":"2015-06-19T04:38:23Z","Content":"This edge split thing has made every model look so much better. Thanks again sumghai.\n\n\u003E \n\u003E Also worth noting is that even with a sensible edge-split angle, Blender sometimes still gets confused with normals when you have a truly \u0022manifold\u0022 mesh. I found this out the hard way. Cylinders with rims and/or protrusions (inward or outward) can mess with it. So I\u0027ll usually take the outer, truly cylindrical surfaces, and hit \u0022Y\u0022 to detach them as their own islands. Just be careful not to \u0022remove doubles\u0022 on it again later. If you\u0027re editing in \u0022solid\u0022 viewport shading, you may see the shading change as soon as you hit \u0022Y\u0022. If so, it was altering your normals, and now it will look better.\n\u003E Until I figured this out, some of my tanks had *impossible* shadow orientations:\n\u003E \n\u003E [http://i.imgur.com/cMyxYNd.png](http://i.imgur.com/cMyxYNd.png)\n\nBlender/Unity are now conspiring to raise my blood pressure by shading along the triangle edges instead of the original poly edges on some of my stuff. I\u0027ve tried splitting them into islands and it fixes the vast majority of it, but there are still some stubborn faces.\n\n![axMrP9i.png](http://i.imgur.com/axMrP9i.png)\n\n**Edited \u003Ctime datetime=\u00222015-06-19T04:41:28Z\u0022 title=\u002206/19/2015 04:41  AM\u0022 data-short=\u00229 yr\u0022\u003EJune 19, 2015\u003C/time\u003E by Randazzo**"},{"CreatedByName":"NecroBones","CreatedById":105424,"CreatedDateTime":"2015-06-19T13:31:17Z","Content":"\u003E \n\u003E This edge split thing has made every model look so much better. Thanks again sumghai.\n\u003E Blender/Unity are now conspiring to raise my blood pressure by shading along the triangle edges instead of the original poly edges on some of my stuff. I\u0027ve tried splitting them into islands and it fixes the vast majority of it, but there are still some stubborn faces.\n\u003E \n\u003E [http://i.imgur.com/axMrP9i.png](http://i.imgur.com/axMrP9i.png)\n\nUgh, that\u0027s a pain. Where do you have the separations? I probably would make those outer rims separate islands from the large flat faces, if you haven\u0027t tried that yet. Those diagonal shadows worry me. Are there any diagonal edges there? (technically there probably would be edges since quads get divided into triangles anyway)"},{"CreatedByName":"Randazzo","CreatedById":136468,"CreatedDateTime":"2015-06-19T13:53:15Z","Content":"\u003E \n\u003E Ugh, that\u0027s a pain. Where do you have the separations? I probably would make those outer rims separate islands from the large flat faces, if you haven\u0027t tried that yet. Those diagonal shadows worry me. Are there any diagonal edges there? (technically there probably would be edges since quads get divided into triangles anyway)\n\nI did make those outer edges islands, and it corrected it on the faces above and below the center face. I tried then making the center face an island of it\u0027s own, and it had no effect. \n\nIt doesn\u0027t actually show up on my \u0022working model\u0022, but when I save and import to Unity it\u0027s there. I know either Blender or Unity turns everything into triangles, and for some reason it\u0027s shading along the triangle edge, even though it\u0027s flat."},{"CreatedByName":"cxg2827","CreatedById":57380,"CreatedDateTime":"2015-06-19T14:13:59Z","Content":"\u003E \n\u003E I did make those outer edges islands, and it corrected it on the faces above and below the center face. I tried then making the center face an island of it\u0027s own, and it had no effect.\n\nI think I\u0027ve had a similar issue before. The face count for the curved section might be too low to look correct with the smoothing(looks like those have 3 faces). Try experimenting making those radiator fins to have 4 or 5 faces for the curved outer edge.\n\notherwise, another thought is that the smoothing is showing a diagonal line on the middle surface. you might need to select those 2 triangle faces and remove any doubles, as it could be considering that diagonal line as a sharp."},{"CreatedByName":"NecroBones","CreatedById":105424,"CreatedDateTime":"2015-06-19T14:25:51Z","Content":"\u003E \n\u003E I think I\u0027ve had a similar issue before. The face count for the curved section might be too low to look correct with the smoothing(looks like those have 3 faces). Try experimenting making those radiator fins to have 4 or 5 faces for the curved outer edge.\n\u003E otherwise, another thought is that the smoothing is showing a diagonal line on the middle surface. you might need to select those 2 triangle faces and remove any doubles, as it could be considering that diagonal line as a sharp.\n\nYeah, I was going to say, within that island you might want to remove doubles. I had some anomalous shading once that was caused by an extra set of polygons that I didn\u0027t realize was present. That\u0027s partly why I was asking if there was an actual edge there, because it might be two edges sharing the same space, or even a full-blown zero-sized quad hiding in there. \n\nSometimes I\u0027lll also go and use the knife tool to split quads into triangles myself, so I can control where that division happens, rather than relying on Blender to choose for me. This is more useful in complex curvatures though, rather than a strip that\u0027s only curved in one direction."},{"CreatedByName":"Randazzo","CreatedById":136468,"CreatedDateTime":"2015-06-19T16:42:50Z","Content":"Thanks for the tips! I\u0027ll try them out ASAP."},{"CreatedByName":"Randazzo","CreatedById":136468,"CreatedDateTime":"2015-06-19T23:36:44Z","Content":"No luck, unfortunately. Nothing gets rid of the stupid triangle shading. I removed the faces, created new ones, remapped them, triangulated them myself, split them as islands, removed doubles, set the outer edges as sharp and smoothed the inner edges, tried the inverse, it always comes out the same once imported to Unity. \n\n![XoIB1qp.png](http://i.imgur.com/XoIB1qp.png)\n\nI guess I\u0027m going to have to abandon this model and go back to the flat edges."},{"CreatedByName":"cxg2827","CreatedById":57380,"CreatedDateTime":"2015-06-20T00:43:02Z","Content":"\u003E \n\u003E No luck, unfortunately. Nothing gets rid of the stupid triangle shading.\n\n Did you try my suggestion of increasing the curved surface from three to four or five sides?"},{"CreatedByName":"Randazzo","CreatedById":136468,"CreatedDateTime":"2015-06-20T10:09:07Z","Content":"\u003E \n\u003E Did you try my suggestion of increasing the curved surface from three to four or five sides?\n\nI did. Every extra face had the same problems.\n\nAnd whatever this is, it\u0027s not happening in Blender, even when I triangulate the faces myself. The shading occurs in a straight vertical line UNTIL I open the blend file in Unity. Then it gets broken, every time.\n\n**Edited \u003Ctime datetime=\u00222015-06-20T13:39:26Z\u0022 title=\u002206/20/2015 01:39  PM\u0022 data-short=\u00229 yr\u0022\u003EJune 20, 2015\u003C/time\u003E by Randazzo**"},{"CreatedByName":"cxg2827","CreatedById":57380,"CreatedDateTime":"2015-06-20T14:01:51Z","Content":"Maybe you\u0027re unity install is borked? Or you need to delete the object fron the unity scene and re- drag it in?"},{"CreatedByName":"Randazzo","CreatedById":136468,"CreatedDateTime":"2015-06-20T14:08:04Z","Content":"\u003E \n\u003E Maybe you\u0027re unity install is borked? Or you need to delete the object fron the unity scene and re- drag it in?\n\nI tried both a new scene and a new project. Same results. I don\u0027t think Unity is broken, it handles everything else fine, It has to be something I have done (or not done), I just have no idea what."},{"CreatedByName":"NecroBones","CreatedById":105424,"CreatedDateTime":"2015-06-20T14:56:52Z","Content":"Have you tried importing in a different file format? I usually convert to Collada/DAE (for non-animated parts) and import those, and if I see a problem, it\u0027s always been on the Blender side. The imports themselves have always gone smoothly. If it\u0027s an animated part, or overly complex, I\u0027ve found Autodesk/FBX to be more reliable. DAE files seem to either work great or are totally borked, with no middle ground.\n\nWhen exporting, you just have to remember to click \u0022Apply Modifiers\u0022. Also, either click \u0022Selection Only\u0022 and select all of your mesh objects, or otherwise turn off the camera, lamp, etc.\n\n**Edited \u003Ctime datetime=\u00222015-06-20T14:58:57Z\u0022 title=\u002206/20/2015 02:58  PM\u0022 data-short=\u00229 yr\u0022\u003EJune 20, 2015\u003C/time\u003E by NecroBones**"},{"CreatedByName":"Randazzo","CreatedById":136468,"CreatedDateTime":"2015-06-20T15:15:56Z","Content":"\u003E \n\u003E Have you tried importing in a different file format? I usually convert to Collada/DAE (for non-animated parts) and import those, and if I see a problem, it\u0027s always been on the Blender side. The imports themselves have always gone smoothly. If it\u0027s an animated part, or overly complex, I\u0027ve found Autodesk/FBX to be more reliable. DAE files seem to either work great or are totally borked, with no middle ground.\n\u003E When exporting, you just have to remember to click \u0022Apply Modifiers\u0022. Also, either click \u0022Selection Only\u0022 and select all of your mesh objects, or otherwise turn off the camera, lamp, etc.\n\nI have not tried this, I might give it a go before throwing it out the window."},{"CreatedByName":"Randazzo","CreatedById":136468,"CreatedDateTime":"2015-06-20T22:26:30Z","Content":"Finally got it! Exporting in different formats didn\u0027t resolve it, so I was about ready to give it up, but I decided to recreate the faces one more time. Apparently, they needed to be created in the proper order. I was just creating each face horizontally across from one edge to the other, this time I did that only with the center face and then linked the center faces edges to the upper and lower edges, and here we have it. I think the shading is backwards, actually, since the parts under the mounting plate are bright, but at this point, I\u0027ll take it. \n\n![xorpmTFh.png](http://i.imgur.com/xorpmTFh.png)"},{"CreatedByName":"NecroBones","CreatedById":105424,"CreatedDateTime":"2015-06-21T13:06:38Z","Content":"\u003E \n\u003E Finally got it! Exporting in different formats didn\u0027t resolve it, so I was about ready to give it up, but I decided to recreate the faces one more time. Apparently, they needed to be created in the proper order. I was just creating each face horizontally across from one edge to the other, this time I did that only with the center face and then linked the center faces edges to the upper and lower edges, and here we have it. I think the shading is backwards, actually, since the parts under the mounting plate are bright, but at this point, I\u0027ll take it. \n\u003E [http://i.imgur.com/xorpmTFh.png](http://i.imgur.com/xorpmTFh.png)\n\nGreat! Yeah, I do most of my modeling with primitives and extrusions, rather than fills, but theoretically it shouldn\u0027t matter. Just glad it\u0027s working for you now. ![:)](//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif)\n\nAs to how it looks in the VAB-- The VAB uses different lighting rules than out in the world. Things look VERY bright on their top surfaces there. You\u0027ll also want to put it out on the pad with the sun at about 45 degrees, and see how it looks there too.\n\nOften I\u0027ll mitigate that sort of thing by adding some \u0022fake\u0022 interactive shading. That is, I\u0027ll texture in some shadows, and make recessed parts a lot darker than exposed areas. I figured out the value of this with my first complex part that had concave areas, which was my Quad-Nuke:\n\nVAB view:\n\n![Ze4S14w.jpg](http://i.imgur.com/Ze4S14w.jpg)\n\nTexture:\n\n![rh9Je77.jpg](http://i.imgur.com/rh9Je77.jpg)\n\nIf you look at the texture, you\u0027ll see that the upper-right area, the main cylinder for the engine, is heavily shaded toward the sides, which is the rear of it facing inward on the engine. Also, on the left, the copper-colored rectangle has a big shadow splotch where it just about touches the \u0022ceiling\u0022 in the engine assembly. In the VAB, it looks pretty good and you can\u0027t tell that the texture is helping the shadowing."},{"CreatedByName":"cxg2827","CreatedById":57380,"CreatedDateTime":"2015-06-21T13:16:41Z","Content":"NecroBones, so you are manually create your own ambient occlusion then instead of using a program to make the shading?"},{"CreatedByName":"NecroBones","CreatedById":105424,"CreatedDateTime":"2015-06-21T16:39:57Z","Content":"\u003E \n\u003E NecroBones, so you are manually create your own ambient occlusion then instead of using a program to make the shading?\n\nYup, I just add some gradients in the texture. A lot of the stock parts are painted that way too (and they look hand-done to me)."}]}