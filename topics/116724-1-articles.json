{"TopicId":116724,"ForumId":29,"TopicTitle":"Showing a Kerbal portrait in a GUI.Window","CreatedByName":"simon56modder","CreatedById":119640,"CreatedDateTime":"2015-07-24T13:51:20Z","PageNum":1,"Articles":[{"CreatedByName":"simon56modder","CreatedById":119640,"CreatedDateTime":"2015-07-24T13:51:20Z","Content":"\n\u003Cp\u003EHi,\u003C/p\u003E\u003Cp\u003EHow can I create a kerbal portrait to show in a window ?\u003C/p\u003E\u003Cp\u003E(portraits like in tutorials/scenarios or at the beginning of a new game)\u003C/p\u003E\u003Cp\u003EI want a Wernher portrait and I want to be able to play emotes.\u003C/p\u003E\u003Cp\u003EI\u0027ve tried using KerbalInstructor but I can\u0027t find a way to make it work.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u00C3\u00A2\u00E2\u20AC\u00A0\u00E2\u20AC\u2122 \u003C/div\u003E\u003Cem\u003E\u003C/em\u003E\u003Cdiv\u003E\u003Cem\u003EGo to Answer\u003C/em\u003E\u003C/div\u003E\u003Cem\u003E\u003C/em\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-08-31T12:19:17Z\u0022 title=\u002208/31/2015 12:19  PM\u0022 data-short=\u00228 yr\u0022\u003EAugust 31, 2015\u003C/time\u003E by simon56modder\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"simon56modder","CreatedById":119640,"CreatedDateTime":"2015-07-31T09:04:03Z","Content":"\n\u003Cp\u003EIs this so hard ? I hope someone can answer \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"xEvilReeperx","CreatedById":75857,"CreatedDateTime":"2015-07-31T10:41:06Z","Content":"\n\u003Cp\u003EThis should get you there:\u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://puu.sh/jjYr4/7c58c30317.png\u0022 alt=\u00227c58c30317.png\u0022\u003E\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E[KSPAddon(KSPAddon.Startup.MainMenu, false)]\u003Cbr\u003Epublic class WindowInstructor : MonoBehaviour\u003Cbr\u003E{\u003Cbr\u003E    private const int PortraitWidth = 128;\u003Cbr\u003E    private const int PortraitHeight = 128;\u003Cbr\u003E\u003Cbr\u003E    private KerbalInstructor _instructor;\u003Cbr\u003E    private RenderTexture _portrait;\u003Cbr\u003E    private Rect _windowRect = new Rect(250f, 250f, 128f, 128f);\u003Cbr\u003E    private Dictionary\u0026lt;GUIContent, CharacterAnimationState\u0026gt; _responses;\u003Cbr\u003E    private int _selectedResponse = 0;\u003Cbr\u003E\u003Cbr\u003E    private void Start()\u003Cbr\u003E    {\u003Cbr\u003E        Resources.FindObjectsOfTypeAll\u0026lt;KerbalInstructor\u0026gt;()\u003Cbr\u003E            .ToList()\u003Cbr\u003E            .ForEach(instructor =\u0026gt; print(\u0022Instructor: \u0022 \u002B instructor.CharacterName \u002B \u0022, prefab: \u0022 \u002B instructor.name));\u003Cbr\u003E\u003Cbr\u003E        _instructor = Create(\u0022Instructor_Gene\u0022);\u003Cbr\u003E\u003Cbr\u003E    }\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E    private void OnDestroy()\u003Cbr\u003E    {\u003Cbr\u003E        if (_portrait != null)\u003Cbr\u003E            _portrait.Release();\u003Cbr\u003E\u003Cbr\u003E        if (_instructor != null)\u003Cbr\u003E            Destroy(_instructor.gameObject);\u003Cbr\u003E    }\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E    private void OnGUI()\u003Cbr\u003E    {\u003Cbr\u003E        _windowRect = KSPUtil.ClampRectToScreen(GUILayout.Window(GetInstanceID(), _windowRect, DrawWindow, \u0022Window Title\u0022,\u003Cbr\u003E            HighLogic.Skin.window));\u003Cbr\u003E    }\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E    private void DrawWindow(int winid)\u003Cbr\u003E    {\u003Cbr\u003E        GUI.skin = HighLogic.Skin;\u003Cbr\u003E\u003Cbr\u003E        GUILayout.BeginHorizontal();\u003Cbr\u003E        {\u003Cbr\u003E            GUILayout.FlexibleSpace(); // to center portrait in case window stretches beyond portrait width\u003Cbr\u003E            GUILayoutUtility.GetRect(PortraitWidth, PortraitHeight);\u003Cbr\u003E\u003Cbr\u003E            if (Event.current.type == EventType.Repaint)\u003Cbr\u003E                Graphics.DrawTexture(GUILayoutUtility.GetLastRect(), _portrait);\u003Cbr\u003E\u003Cbr\u003E            GUILayout.FlexibleSpace();\u003Cbr\u003E        }\u003Cbr\u003E        GUILayout.EndHorizontal();\u003Cbr\u003E\u003Cbr\u003E        _selectedResponse = GUILayout.SelectionGrid(_selectedResponse, _responses.Keys.ToArray(), 4);\u003Cbr\u003E\u003Cbr\u003E        if (GUI.changed)\u003Cbr\u003E            _instructor.PlayEmoteRepeating(_responses[_responses.Keys.ToArray()[_selectedResponse]], 1f);\u003Cbr\u003E\u003Cbr\u003E        GUI.DragWindow();\u003Cbr\u003E    }\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E    private KerbalInstructor Create(string instructorName)\u003Cbr\u003E    {\u003Cbr\u003E        var prefab = AssetBase.GetPrefab(instructorName);\u003Cbr\u003E        if (prefab == null)\u003Cbr\u003E            throw new ArgumentException(\u0022Could not find instructor named \u0027\u0022 \u002B instructorName \u002B \u0022\u0027\u0022);\u003Cbr\u003E\u003Cbr\u003E        var prefabInstance = (GameObject)Instantiate(prefab);\u003Cbr\u003E        var instructor = prefabInstance.GetComponent\u0026lt;KerbalInstructor\u0026gt;();\u003Cbr\u003E\u003Cbr\u003E        _portrait = new RenderTexture(PortraitWidth, PortraitWidth, 8);\u003Cbr\u003E        instructor.instructorCamera.targetTexture = _portrait;\u003Cbr\u003E\u003Cbr\u003E        _responses = instructor.GetType().GetFields(BindingFlags.Public | BindingFlags.Instance)\u003Cbr\u003E            .Where(fi =\u0026gt; fi.FieldType == typeof (CharacterAnimationState))\u003Cbr\u003E            .Where(fi =\u0026gt; fi.GetValue(instructor) != null)\u003Cbr\u003E            .ToDictionary(fi =\u0026gt; new GUIContent(fi.Name), fi =\u0026gt; fi.GetValue(instructor) as CharacterAnimationState);\u003Cbr\u003E\u003Cbr\u003E        return instructor;\u003Cbr\u003E    }\u003Cbr\u003E}\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n"},{"CreatedByName":"Darren9","CreatedById":58062,"CreatedDateTime":"2015-07-31T11:19:57Z","Content":"\n\u003Cp\u003EUnfortunately I can\u0027t code at all, is there any possibility you could make available what you have in the screenshot, it could be used to green-screen a live instructor commentary onto a video.\u003C/p\u003E\n"},{"CreatedByName":"simon56modder","CreatedById":119640,"CreatedDateTime":"2015-07-31T14:13:32Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022xEvilReeperx\u0022 data-cite=\u0022xEvilReeperx\u0022\u003E\u003Cdiv\u003EThis should get you there:\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI have issues with System.Reflection :\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E[ERR 16:10:03.151] AssemblyLoader: Exception loading \u0027ResearchBodies\u0027: System.Reflection.ReflectionTypeLoadException: The classes in the module cannot be loaded.\u003Cbr\u003E  at (wrapper managed-to-native) System.Reflection.Assembly:GetTypes (bool)\u003Cbr\u003E  at System.Reflection.Assembly.GetTypes () [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003Cbr\u003E  at AssemblyLoader.LoadAssemblies () [0x00000] in \u0026lt;filename unknown\u0026gt;:0 \u003Cbr\u003EAdditional information about this exception:\u003Cbr\u003E System.TypeLoadException: Could not load type \u0027ResearchBodies.WindowInstructor\u0027 from assembly \u0027ResearchBodies, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null\u0027.\u003Cbr\u003E System.TypeLoadException: Could not load type \u0027\u0026lt;\u0026gt;c__DisplayClass8\u0027 from assembly \u0027ResearchBodies, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null\u0027.\u003Cbr\u003E\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-07-31T14:21:50Z\u0022 title=\u002207/31/2015 02:21  PM\u0022 data-short=\u00228 yr\u0022\u003EJuly 31, 2015\u003C/time\u003E by simon56modder\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"MrHappyFace","CreatedById":76365,"CreatedDateTime":"2015-07-31T18:34:47Z","Content":"\n\u003Cp\u003EIs your project using .NET v3.5? Unity, and by extension, KSP, uses .NET v3.5, and if your plugin doesn\u0027t also use 3.5, then the assembly loader will screw up.\u003C/p\u003E\n"}]}