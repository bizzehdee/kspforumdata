{"TopicId":29305,"ForumId":29,"TopicTitle":"Is there a way to change stock shader for the celestials in map view?","CreatedByName":"asmi","CreatedById":59068,"CreatedDateTime":"2013-05-26T14:07:53Z","PageNum":1,"Articles":[{"CreatedByName":"asmi","CreatedById":59068,"CreatedDateTime":"2013-05-26T14:07:53Z","Content":"\n\u003Cp\u003EBasically the title says it all. I\u0027m thinking about embarking on resources implementation since it\u0027s unlikely that we\u0027ll see it done by devs for at least several months (my guesstimate), and in order to implement resource maps that would overlay planets, I figured the best way to do that is to modify pixel shader for the planet rendering so it would read my resource map mask and color areas where resources are. Does anyone have anything in this regard? Thank you!\u003C/p\u003E\n"},{"CreatedByName":"asmi","CreatedById":59068,"CreatedDateTime":"2013-05-28T03:36:36Z","Content":"\n\u003Cp\u003EProblem solved: \u003C/p\u003E\u003Cp\u003E\u003Cimg src=\u0022http://www.asmitech.com/Stuff/KSP/KSP_Resources.png\u0022 alt=\u0022KSP_Resources.png\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"lyndonguitar","CreatedById":61194,"CreatedDateTime":"2013-05-28T03:39:09Z","Content":"\n\u003Cp\u003EAwesome!, are you planning on making this into something? like Kethane?\u003C/p\u003E\n"},{"CreatedByName":"asmi","CreatedById":59068,"CreatedDateTime":"2013-05-28T03:44:07Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022lyndonguitar\u0022 data-cite=\u0022lyndonguitar\u0022\u003E\u003Cdiv\u003EAwesome!, are you planning on making this into something? like Kethane?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI\u0027m planning something much more complex - multiple resources, mining bases with ground structures, etc. I\u0027m still thinking it through and doing some proof-of-concept things, like the one above. Once I have this more of less finalized and all technical implementation concepts nailed down, I\u0027ll create a topic here so everyone will have a chance to provide input.\u003C/p\u003E\n"},{"CreatedByName":"lyndonguitar","CreatedById":61194,"CreatedDateTime":"2013-05-28T17:52:44Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022asmi\u0022 data-cite=\u0022asmi\u0022\u003E\u003Cdiv\u003EI\u0027m planning something much more complex - multiple resources, mining bases with ground structures, etc. I\u0027m still thinking it through and doing some proof-of-concept things, like the one above. Once I have this more of less finalized and all technical implementation concepts nailed down, I\u0027ll create a topic here so everyone will have a chance to provide input.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EWish you the best, I hope to one day see this idea turn into reality, a great mod in the making, I can already see in the shader map you made, nobody has made one of these yet!\u003C/p\u003E\n"},{"CreatedByName":"nobody44","CreatedById":66369,"CreatedDateTime":"2013-05-30T13:24:52Z","Content":"\n\u003Cp\u003EWould you mind telling me how you did the overlay in the above picture?\u003C/p\u003E\n"},{"CreatedByName":"asmi","CreatedById":59068,"CreatedDateTime":"2013-05-30T14:03:00Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022nobody44\u0022 data-cite=\u0022nobody44\u0022\u003E\u003Cdiv\u003EWould you mind telling me how you did the overlay in the above picture?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ESure, once I reach home I\u0027ll post code sample. It actually uses current (VERY rudimentary but still) support of resources in stock game. Basically you need to provide a texture that will be alpha-blended with terrain texture during rendering (it\u0027s classic alpha-blending mechanism result_color = resource_texture.rgb * resource_texture.a \u002B main_texture.rgb * (1 - resource_texture.a)). So you can start working on building this texture, and this evening I\u0027ll show you how to \u0022connect\u0022 it to renderer.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-05-30T14:05:06Z\u0022 title=\u002205/30/2013 02:05  PM\u0022 data-short=\u002211 yr\u0022\u003EMay 30, 2013\u003C/time\u003E by asmi\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"asmi","CreatedById":59068,"CreatedDateTime":"2013-05-31T02:28:38Z","Content":"\n\u003Cp\u003EAs promised, here is the code:\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003E\u003Cp\u003Epublic static class ResourceTextureSetter\u003C/p\u003E\u003Cp\u003E {\u003C/p\u003E\u003Cp\u003E private static FieldInfo textureField = typeof(CelestialBody).GetField(\u0022\\u000A\\u0006\u0022, BindingFlags.NonPublic | BindingFlags.Instance);\u003C/p\u003E\u003Cp\u003E public static void SetResourceTexture(CelestialBody body, Texture2D resourceTexture)\u003C/p\u003E\u003Cp\u003E {\u003C/p\u003E\u003Cp\u003E textureField.SetValue(body, resourceTexture);\u003C/p\u003E\u003Cp\u003E }\u003C/p\u003E\u003Cp\u003E }\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EJust call this method and pass celestial and texture to display it, or pass null instead of texture to hide resource.\u003C/p\u003E\n"},{"CreatedByName":"nobody44","CreatedById":66369,"CreatedDateTime":"2013-05-31T12:56:30Z","Content":"\n\u003Cp\u003EErmmm... what???\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003EGetField(\u0022\\u000A\\u0006\u0022, BindingFlags.NonPublic | BindingFlags.Instance);\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ENo offense, but that doesn\u0027t look \u0022healthy\u0022.\u003C/p\u003E\n"},{"CreatedByName":"asmi","CreatedById":59068,"CreatedDateTime":"2013-05-31T13:08:24Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022nobody44\u0022 data-cite=\u0022nobody44\u0022\u003E\u003Cdiv\u003EErmmm... what???\u003Cp\u003ENo offense, but that doesn\u0027t look \u0022healthy\u0022.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EDo you want the code that works, or one that looks \u0022healthy\u0022 (btw what is it?), but doesn\u0027t work? You\u0027ve asked me how did I do that - I\u0027ve told you, if you don\u0027t like it feel free to find the other way. I\u0027ve spent almost a full day in dotPeek \u002B debugger trying to find the way, I\u0027ve found it, it works, so it\u0027s good enough for me.\u003C/p\u003E\n"},{"CreatedByName":"Moon Goddess","CreatedById":57446,"CreatedDateTime":"2013-05-31T13:52:32Z","Content":"\n\u003Cp\u003EI\u0027m not sure either what healthy looking code means.\u003C/p\u003E\u003Cp\u003EBut I\u0027m not one to talk, most of my code could best be described as italian pasta product. Hey, it works.\u003C/p\u003E\u003Cp\u003EThanks for the code, I\u0027m unlikely to do anything with it but it\u0027s nice to think I could.\u003C/p\u003E\n"},{"CreatedByName":"asmi","CreatedById":59068,"CreatedDateTime":"2013-05-31T13:57:26Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Moon Goddess\u0022 data-cite=\u0022Moon Goddess\u0022\u003E\u003Cdiv\u003EI\u0027m not sure either what healthy looking code means.\u003Cp\u003EBut I\u0027m not one to talk, most of my code could best be described as italian pasta product. Hey, it works.\u003C/p\u003E\u003Cp\u003EThanks for the code, I\u0027m unlikely to do anything with it but it\u0027s nice to think I could.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYou\u0027ve got to keep in mind, that in absence of documentation we\u0027re bound to use such ways - I don\u0027t like it either to be honest, but we\u0027ve gotta deal with what we have. I\u0027ve isolated this code into separate class for that exact reason - if it would become broken in future versions (BTW it\u0027s confirmed to work in 0.20.2), it could be fixed in one place, and not scattered across the codebase making such a fix a nightmare.\u003C/p\u003E\n"},{"CreatedByName":"nobody44","CreatedById":66369,"CreatedDateTime":"2013-05-31T15:56:18Z","Content":"\n\u003Cp\u003EDon\u0027t take this the wrong way please:\u003C/p\u003E\u003Cp\u003EYour code accesses a private field. This might work in this case, but it is not a good idea in general. Besides that: The field has a weird name. Obfuscators?\u003C/p\u003E\n"},{"CreatedByName":"asmi","CreatedById":59068,"CreatedDateTime":"2013-05-31T16:04:33Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022nobody44\u0022 data-cite=\u0022nobody44\u0022\u003E\u003Cdiv\u003EDon\u0027t take this the wrong way please:\u003Cp\u003EYour code accesses a private field. This might work in this case, but it is not a good idea in general. Besides that: The field has a weird name. Obfuscators?\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EField name most likely is obfuscator\u0027s work. Yea, in general I agree, but this feature itself is incomplete, so for now it\u0027s acceptable. As I\u0027ve said above, I\u0027ve isolated this inside a class so if/when this part is changed, the codebase can easily be fixed.\u003C/p\u003E\n"},{"CreatedByName":"nobody44","CreatedById":66369,"CreatedDateTime":"2013-05-31T17:53:41Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022asmi\u0022 data-cite=\u0022asmi\u0022\u003E\u003Cdiv\u003EField name most likely is obfuscator\u0027s work. Yea, in general I agree, but this feature itself is incomplete, so for now it\u0027s acceptable. As I\u0027ve said above, I\u0027ve isolated this inside a class so if/when this part is changed, the codebase can easily be fixed.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI agree. A good KSP API documentation would be so helpful. But it is hard to maintain, so I don\u0027t blame Squad for not doing it...\u003C/p\u003E\u003Cp\u003EThanks for sharing :-). I might need it in my new plugin to mark a specific spot (latitude and longitude are known) on a planet.\u003C/p\u003E\n"},{"CreatedByName":"jheriko","CreatedById":67666,"CreatedDateTime":"2013-06-04T21:37:46Z","Content":"\n\u003Cp\u003EThat\u0027s all well and good, but how (if at all) did you modify the shader? Or are you replacing an existing texture? I\u0027m curious...\u003C/p\u003E\u003Cp\u003ERe being healthy - everything is C# - we have already thrown healthy out the window when we made that decision. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cp\u003EI\u0027d like to add some better shaders - the silly half-angle specular makes my eyes bleed everytime it pokes through something, and every other shader looks stock and boring... i\u0027m betting there is room for optimisation and visual improvement at the same time. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif\u0022 alt=\u0022:P\u0022\u003E\u003C/p\u003E\u003Cp\u003EAlso, IMO, a good API documents itself. e.g. by not having one class called Part and one called PartModule and an obvious legacy of indecisive early work still being present because its an alpha release... when its finished we might not need any documentation. Most code I\u0027ve ever had to work with is completely undocumented - the best you get is maybe the guy who wrote it did so in the last 3 months and is still employed. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif\u0022 alt=\u0022:P\u0022\u003E\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-06-04T21:40:11Z\u0022 title=\u002206/04/2013 09:40  PM\u0022 data-short=\u002211 yr\u0022\u003EJune 4, 2013\u003C/time\u003E by jheriko\u003C/strong\u003E\n\u003Cbr\u003Eadding based on further posts\n\u003C/span\u003E\n"},{"CreatedByName":"asmi","CreatedById":59068,"CreatedDateTime":"2013-06-05T16:40:42Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022jheriko\u0022 data-cite=\u0022jheriko\u0022\u003E\u003Cdiv\u003EThat\u0027s all well and good, but how (if at all) did you modify the shader? Or are you replacing an existing texture? I\u0027m curious...\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ENo, I use existing (VERY preliminary) support for resources, or some part of it that allows one to specify second texture that will then be alpha-blended with terrain during rendering pass.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022jheriko\u0022 data-cite=\u0022jheriko\u0022\u003E\u003Cdiv\u003ERe being healthy - everything is C# - we have already thrown healthy out the window when we made that decision. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EWhat?\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022jheriko\u0022 data-cite=\u0022jheriko\u0022\u003E\u003Cdiv\u003EI\u0027d like to add some better shaders - the silly half-angle specular makes my eyes bleed everytime it pokes through something, and every other shader looks stock and boring... i\u0027m betting there is room for optimisation and visual improvement at the same time. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif\u0022 alt=\u0022:P\u0022\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003E\u003Cstrong\u003ETheoretically\u003C/strong\u003E Unity allows you to set whatever shader you want to anything, but there is one caveat - since OpenGL doesn\u0027t support Cg for shaders directly (unlike Direct3D that supports HLSL), you can\u0027t create Cg shaders dynamically. I didn\u0027t pursue this way since I\u0027ve found easier way to solve my problem \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022jheriko\u0022 data-cite=\u0022jheriko\u0022\u003E\u003Cdiv\u003EAlso, IMO, a good API documents itself. e.g. by not having one class called Part and one called PartModule and an obvious legacy of indecisive early work still being present because its an alpha release... when its finished we might not need any documentation. Most code I\u0027ve ever had to work with is completely undocumented - the best you get is maybe the guy who wrote it did so in the last 3 months and is still employed. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif\u0022 alt=\u0022:P\u0022\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EYea I\u0027m used to using decompilers at work as it\u0027s the best way to figure out how exactly some third-party component works.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222013-06-05T16:43:27Z\u0022 title=\u002206/05/2013 04:43  PM\u0022 data-short=\u002211 yr\u0022\u003EJune 5, 2013\u003C/time\u003E by asmi\u003C/strong\u003E\n\u003C/span\u003E\n"}]}