{"TopicId":11199,"ForumId":29,"TopicTitle":"Module and Resource example","CreatedByName":"kellven","CreatedById":16971,"CreatedDateTime":"2012-05-22T14:51:14Z","PageNum":1,"Articles":[{"CreatedByName":"kellven","CreatedById":16971,"CreatedDateTime":"2012-05-22T14:51:14Z","Content":"\n\u003Cp\u003E Trying to work through the mechanics of the new plugin system. I built something resembling Mu\\\u0027s example of a generic rocket module, and resource tank. The code to make the tank display like an actual FuelTank isn\\\u0027t working yet, but it does appear to be actually doing what it\\\u0027s supposed to. This is built as 2 \u0027Part\u0027 Parts, one as a dual chamber LOX/LH2 tank, the other as a LOX/LH2 rocket, both are using C7\\\u0027s structural fuselage as a base.\u003C/p\u003E\u003Cp\u003E I\\\u0027m posting this here in case anyone is having problems just getting the new system setup into something that works, and want\\\u0027s a concrete example to examine.\u003C/p\u003E\u003Cp\u003E \u003Ca href=\u0022https://dl.dropbox.com/u/74137297/KISModuleDemoV0.zip\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://dl.dropbox.com/u/74137297/KISModuleDemoV0.zip\u003C/a\u003E\u003C/p\u003E\u003Cp\u003E There\\\u0027s also an OOO spreadsheet I made for calculating all the fiddly conversions. May or may not be horribly inaccurate.\u003C/p\u003E\u003Cp\u003E-24May12-\u003C/p\u003E\u003Cp\u003E Newer code with tons of debug.logs for your parsing pleasure. Think the fuel tank at least works as it, but can\\\u0027t test it without the engine running properly.\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022https://dl.dropbox.com/u/74137297/KFuelTank.cs\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://dl.dropbox.com/u/74137297/KFuelTank.cs\u003C/a\u003E\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022https://dl.dropbox.com/u/74137297/KPropulsionBase.cs\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://dl.dropbox.com/u/74137297/KPropulsionBase.cs\u003C/a\u003E\u003C/p\u003E\u003Cp\u003E-11Jun12-\u003C/p\u003E\u003Cp\u003E I accidentally fed the code after midnight, then spilled water on it, and it\\\u0027s grown into a horde of angry gremlins. This is in no way suitable for public consumption yet, but I did manage to get several more things working in game, and it\\\u0027s actually flyable atm.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cblockquote\u003E\u003Cimg src=\u0022http://img805.imageshack.us/img805/7353/screenshot173d.jpg\u0022 alt=\u0022screenshot173d.jpg\u0022\u003E\u003C/blockquote\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022https://dl.dropbox.com/u/74137297/KISModuleDemoV2.zip\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://dl.dropbox.com/u/74137297/KISModuleDemoV2.zip\u003C/a\u003E\u003C/p\u003E\n"},{"CreatedByName":"Tosh","CreatedById":11055,"CreatedDateTime":"2012-05-22T15:09:57Z","Content":"\n\u003Cp\u003EThanks for sorting out PartModule\\\u0027s mechanics. Example is useful indeed :thumbup:\u003C/p\u003E\n"},{"CreatedByName":"Corax","CreatedById":11311,"CreatedDateTime":"2012-05-22T15:14:41Z","Content":"\n\u003Cp\u003EJust a quick question, so far I\\\u0027ve only glanced over the example:\u003C/p\u003E\u003Cp\u003EWhy the conversion from kg to kerbogram? Shouldn\\\u0027t mass be the same everywhere, and only the weight force require adjustment?\u003C/p\u003E\u003Cp\u003EOr am I missing something obvious?\u003C/p\u003E\n"},{"CreatedByName":"kellven","CreatedById":16971,"CreatedDateTime":"2012-05-23T02:33:20Z","Content":"\n\u003Cp\u003E I\\\u0027m actually using real Earth values in everything still.\u003C/p\u003E\u003Cp\u003E The conversion was just from the density of 6:1 LOX:LH2 to the density of \u0027fuel\u0027 in the default KSP rocket tanks. I was worried that the \u0027amount\u0027 values in my fuel tanks were so small(the net thrust per tank is equal assuming you\\\u0027re using this engine/tank, and LiquidEngine1/FuelTank), and the fuel consumption in the engines is also tiny.\u003C/p\u003E\u003Cp\u003E The real problem with conversions is that Kerbin g is almost identical to Earth g, which would suggest a 1:1 ratio, but the actual planet, and all the rocket parts are smaller than Earth counterparts. And the metrics used to measure non-distance stuff is also out of scale.\u003C/p\u003E\u003Cp\u003E In other words, using the kg:KG conversion factor should give you something more like the 500 \u0027amount\u0027 of fuel in a tank, instead of 4.45 total in my tank. Also should bring the engine consumption from 0.0713/s closer to LiquidEngine\\\u0027s 8/s. The tiny values from direct conversion don\\\u0027t seem to cause noticeable problems yet, so I just left the KerboGram/KerboLiter in to make it clear what\\\u0027s an earth measurement, and what\\\u0027s a KSP measure.\u003C/p\u003E\n"},{"CreatedByName":"kellven","CreatedById":16971,"CreatedDateTime":"2012-05-23T08:55:27Z","Content":"\n\u003Cp\u003E Been working on this still. Wanted to let anyone who was dissecting this know that it looks like the engine is loading it\\\u0027s required propellants correctly when the part cfg file is parsed, but then somehow loses that data by the time the ship actually gets to the runway. So while the engine appeared to be working, it wasn\\\u0027t actually burning (or even checking) any of the resources it was supposed to.\u003C/p\u003E\u003Cp\u003E I also managed to make the stack icon update to a fueltank icon if it\\\u0027s left at mysterybox, and I think the only thing stopping the fuel bars showing now is that the fuel level is never actually adjusted by the engines.\u003C/p\u003E\u003Cp\u003E I\\\u0027ll re-upload it once I get the propellant persistence problem sorted out.\u003C/p\u003E\n"},{"CreatedByName":"Corax","CreatedById":11311,"CreatedDateTime":"2012-05-23T16:31:21Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022kellven\u0022 data-cite=\u0022kellven\u0022\u003E\u003Cdiv\u003E\u003Cp\u003E In other words, using the kg:KG conversion factor should give you something more like the 500 \u0027amount\u0027 of fuel in a tank, instead of 4.45 total in my tank. Also should bring the engine consumption from 0.0713/s closer to LiquidEngine\\\u0027s 8/s. The tiny values from direct conversion don\\\u0027t seem to cause noticeable problems yet, so I just left the KerboGram/KerboLiter in to make it clear what\\\u0027s an earth measurement, and what\\\u0027s a KSP measure.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThanks for explaining, I see now what you are doing there and why.\u003C/p\u003E\n"},{"CreatedByName":"Maraz","CreatedById":22308,"CreatedDateTime":"2012-05-24T07:28:58Z","Content":"\n\u003Cp\u003EHi, following your example, I tried to build a very simple part, an advanced command pod that also has the ASAS and MechJeb functionalities.\u003C/p\u003E\u003Cp\u003EUnfortunately it did not work \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_sad.gif\u0022 alt=\u0022:(\u0022\u003E the part is loaded, but it is not displayed among command pods, it is displayed as a common part and has no function (no MechJeb, and, it seems, no ASAS).\u003C/p\u003E\u003Cp\u003EWhat did I do wrong? Is what I wanted to do possible at all?\u003C/p\u003E\u003Cp\u003E(cfg file follows)\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E// --- general parameters ---\u003Cbr\u003Ename = advancedmk1pod\u003Cbr\u003Emodule = Part\u003Cbr\u003Eauthor = Maraz | Mrbrownce\u003Cbr\u003E\u003Cbr\u003E// --- asset parameters ---\u003Cbr\u003Emesh = mk1pod.DAE\u003Cbr\u003Escale = 0.1\u003Cbr\u003Etexture = mk1podtexture.png\u003Cbr\u003EspecPower = 0.1\u003Cbr\u003ErimFalloff = 3\u003Cbr\u003EalphaCutoff = 0.0\u003Cbr\u003E\u003Cbr\u003E// --- node definitions ---\u003Cbr\u003E// definition format is Position X, Position Y, Position Z, Up X, Up Y, Up Z\u003Cbr\u003Enode_stack_bottom = 0.0, -3.02662, 0.0, 0.0, 1.0, 0.0, 1\u003Cbr\u003Enode_stack_top = 0.0, 3.93121, 0.0, 0.0, 1.0, 0.0, 0\u003Cbr\u003E\u003Cbr\u003E\u003Cbr\u003E// --- editor parameters ---\u003Cbr\u003Ecost = 1600\u003Cbr\u003Ecategory = 1\u003Cbr\u003Esubcategory = 0\u003Cbr\u003Etitle = Advenced Command Pod Mk1\u003Cbr\u003Emanufacturer = Kerlington Model Rockets and Paper Products Inc.\u003Cbr\u003Edescription = Originally built as a placeholder for a demonstration mock-up of a rocket, the Mk1 Command Pod was heralded as a far safer and more reliable option than it\\\u0027s predecessors by rocket scientists throughout the world. It is now commonly seen in active service.\u003Cbr\u003E\u003Cbr\u003E// attachment rules: stack, srfAttach, allowStack, allowSrfAttach, allowCollision\u003Cbr\u003EattachRules = 1,0,1,0,0\u003Cbr\u003E\u003Cbr\u003E// --- standard part parameters ---\u003Cbr\u003Emass = 1\u003Cbr\u003EdragModelType = default\u003Cbr\u003Emaximum_drag = 0.2\u003Cbr\u003Eminimum_drag = 0.15\u003Cbr\u003EangularDrag = 2\u003Cbr\u003EcrashTolerance = 14\u003Cbr\u003EmaxTemp = 3400\u003Cbr\u003E\u003Cbr\u003EMODULE\u003Cbr\u003E{\u003Cbr\u003E\tname = CommandPod\u003Cbr\u003E\trotPower = 5\u003Cbr\u003E\tlinPower = 10\u003Cbr\u003E\u003Cbr\u003E\tKp = 1.0\u003Cbr\u003E\tKd = 1.0\u003Cbr\u003E}\u003Cbr\u003E\u003Cbr\u003EMODULE\u003Cbr\u003E{\u003Cbr\u003E\tname = AdvSASModule\u003Cbr\u003E\u003Cbr\u003E\tKi = 0.5\u003Cbr\u003E\tKp = 1.0\u003Cbr\u003E\tKd = 1.5\u003Cbr\u003E}\t\u003Cbr\u003E\u003Cbr\u003EMODULE\u003Cbr\u003E{\u003Cbr\u003E\tname = MuMechJeb\u003Cbr\u003E\u003Cbr\u003E}\t\u003Cbr\u003E\u003Cbr\u003E// ----- DO NOT EDIT BELOW THIS POINT ------\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EMaraz\u003C/p\u003E\n"},{"CreatedByName":"kellven","CreatedById":16971,"CreatedDateTime":"2012-05-24T11:14:26Z","Content":"\n\u003Cp\u003E If you want it to show up as in the \u0027pick a pod\u0027 list, you need to set it as:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E// --- general parameters ---\u003Cbr\u003Ename = advancedmk1pod\u003Cbr\u003Emodule = CommandPod\u003Cbr\u003Eauthor = Maraz | Mrbrownce\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E AFAIK, there are no \u0027modularized\u0027 versions of the CommandPod, ASAS, or MechJeb as of yet, so no you can\\\u0027t do that so far without writing your own versions of them.\u003C/p\u003E\u003Cp\u003E The problem is that they haven\\\u0027t been updated to the new PartModule system yet, the classes CommandPod, AdvSASModule, MuMechJeb are still setup as being their own parts, not to work as assignable PartModule(s).\u003C/p\u003E\u003Cp\u003E Once we get versions of them that are set up as PartModules, that should work like you had it.\u003C/p\u003E\n"},{"CreatedByName":"Kreuzung","CreatedById":21035,"CreatedDateTime":"2012-05-24T11:22:51Z","Content":"\n\u003Cp\u003EI found\u003C/p\u003E\u003Cp\u003EModuleAerodynamicLift \u003C/p\u003E\u003Cp\u003EModuleAnimateHeat \u003C/p\u003E\u003Cp\u003EModuleAnimatorLandingGear \u003C/p\u003E\u003Cp\u003EModuleCommand \u003C/p\u003E\u003Cp\u003EModuleEngineRocketLiquid \u003C/p\u003E\u003Cp\u003EModuleResource \u003C/p\u003E\u003Cp\u003Eand ModuleResourceIntake\u003C/p\u003E\u003Cp\u003Ein the object explorer. They seem to be the only stock part modules for now. Whould suffice for integrated planes ;D\u003C/p\u003E\u003Cp\u003EI also found something called StackIcon.partModule. What could that be for?\u003C/p\u003E\n"},{"CreatedByName":"kellven","CreatedById":16971,"CreatedDateTime":"2012-05-24T12:00:09Z","Content":"\n\u003Cp\u003EI believe those Module classes are just the examples from Mu\\\u0027s thread.\u003C/p\u003E\u003Cp\u003EStackIcon.partModule is very interesting, have to take a look when I get through fixing whatever is fubar with my joint fixer plugin. I\\\u0027m thinking it might possibly be an extension to the normal stack icons, as they\\\u0027re generally tied to the Part, not the PartModule. I had to cheat to get my fuel tank part to show a fuel tank icon.\u003C/p\u003E\n"},{"CreatedByName":"Maraz","CreatedById":22308,"CreatedDateTime":"2012-05-24T12:07:15Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022kellven\u0022 data-cite=\u0022kellven\u0022\u003E\u003Cdiv\u003E\u003Cp\u003E If you want it to show up as in the \u0027pick a pod\u0027 list, you need to set it as:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E// --- general parameters ---\u003Cbr\u003Ename = advancedmk1pod\u003Cbr\u003Emodule = CommandPod\u003Cbr\u003Eauthor = Maraz | Mrbrownce\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E AFAIK, there are no \u0027modularized\u0027 versions of the CommandPod, ASAS, or MechJeb as of yet, so no you can\\\u0027t do that so far without writing your own versions of them.\u003C/p\u003E\u003Cp\u003E The problem is that they haven\\\u0027t been updated to the new PartModule system yet, the classes CommandPod, AdvSASModule, MuMechJeb are still setup as being their own parts, not to work as assignable PartModule(s).\u003C/p\u003E\u003Cp\u003E Once we get versions of them that are set up as PartModules, that should work like you had it.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThanks for clarification. So I\\\u0027ll have to wait....\u003C/p\u003E\u003Cp\u003EMaraz\u003C/p\u003E\n"},{"CreatedByName":"kellven","CreatedById":16971,"CreatedDateTime":"2012-06-02T07:22:53Z","Content":"\n\u003Cp\u003E Mu say: \u0027So you can\\\u0027t use constructors on classes derived from MonoBehaviour (Part, PartModule, etc). To do your constructor stuff in a PartModule you need to the override OnAwake method.\u0027\u003C/p\u003E\u003Cp\u003E Which explains quite a lot of the bugs I\\\u0027ve been having. I think I have the C# thing mostly nailed down, but learning Unity is still troublesome.\u003C/p\u003E\u003Cp\u003E Not going to update my code here right now, as I\\\u0027m almost done with a larger system this is a prototype for, but in short:\u003C/p\u003E\u003Cp\u003E Do Not\u003C/p\u003E\u003Cp\u003E -use class constructors for Unity stuff\u003C/p\u003E\u003Cp\u003E Do\u003C/p\u003E\u003Cp\u003E -use OnAwake to do constructor stuff\u003C/p\u003E\u003Cp\u003E Also Do from Mu\u003C/p\u003E\u003Cp\u003E \u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Epublic string classdata = \u0027\u0027;\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E As in provide default values for stuff that defaults to null, but don\\\u0027t do it in a constructor. Also, check for null in OnAwake, before just assigning new:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Eif(DumDumList == null)\u003Cbr\u003E{\u003Cbr\u003E  DumDumList = new List\u0026lt;DumDums\u0026gt;();\u003Cbr\u003E}\u003Cbr\u003E//instead of\u003Cbr\u003EDumDumList = new List\u0026lt;DumDums\u0026gt;();\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EEDIT: Also, if you open a part.cfg that uses ConfigNode stuff in NotePad\u002B\u002B, and set the Language to Batch, it handles the structure very well.\u003C/p\u003E\n"},{"CreatedByName":"kellven","CreatedById":16971,"CreatedDateTime":"2012-06-11T08:26:46Z","Content":"\n\u003Cp\u003E Added link to more functional version. Really needs cleaning up, but lots of low level stuff is working now. It also pulls fuel properly, and evenly, though I couldn\\\u0027t get the actual KSP resource request system to work right, and made my own.\u003C/p\u003E\n"}]}