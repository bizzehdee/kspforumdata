{"TopicId":130152,"ForumId":29,"TopicTitle":"Thread starts but does not run","CreatedByName":"FewCode","CreatedById":141097,"CreatedDateTime":"2016-01-18T01:18:15Z","PageNum":1,"Articles":[{"CreatedByName":"FewCode","CreatedById":141097,"CreatedDateTime":"2016-01-18T01:18:15Z","Content":"\n\u003Cp\u003E\nHello,\n\u003C/p\u003E\n\u003Cp\u003E\nI am currently trying to develop a plugin that will allow me to connect to an external application (located on an computer) and send data back and forth. Currently I have mostly done this with sockets. I send a handshake signal to my external program written in java, it sends a handshake signal back and all is well.\n\u003C/p\u003E\n\u003Cp\u003E\nBut when I wanted a dedicated thread to listen to the java application i ran into some problems. The problem is on the plugin side.\n\u003C/p\u003E\n\u003Cp\u003E\nI currently have this code:\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan\u003EDebug.Log(\u0022KSPArduinoBridge: Beginning...\u0022);\n//must wait for arduino connection signal from program\nvar handShakeInformation = new Dictionary\u003C/span\u003E\u003Cspan\u003E\u0026lt;string\u003C/span\u003E\u003Cspan\u003E, \u003C/span\u003E\u003Cspan\u003Edouble\u003C/span\u003E\u003Cspan\u003E\u0026gt;\u003C/span\u003E\u003Cspan\u003E();\nhandShakeInformation[\u0022id\u0022] = 0;\nhandShakeInformation[\u0022M1\u0022] = 1;\nhandShakeInformation[\u0022M2\u0022] = 2;\nhandShakeInformation[\u0022M3\u0022] = 3;\nsendPacketToKSPMiddleMan(ConvertDictionaryToSend(handShakeInformation));\n\nDebug.Log(\u0022KSPArduinoBridge: waiting\u0022);\nThread.Sleep(1000);\n\nDebug.Log(\u0022KSPArduinoBridge: Making new thread for listening\u0022);\n//MiddleManListener mml = new MiddleManListener();\nThread oThread = new Thread(ListenToMiddleMan);\n\nDebug.Log(\u0022KSPArduinoBridge: Starting thread: \u0022);\noThread.IsBackground = true;\noThread.Start();\n            \nDebug.Log(\u0022KSPArduinoBridge: past thread: \u0022);\nThread.Sleep(5000);\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nI have gone through many iterations on this with different orders and ways of calling the thread. (so It may look a little messy and has lots of sleeps). The thread code is this:\u00A0\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan\u003Epublic void ListenToMiddleMan()\n{\n  Debug.Log(\u0022KSPArduinoBridge: thread started\u0022);\n  Socket javaProgram = KSPArduinoBridge.javaprogram;\n\n  Debug.Log(\u0022KSPArduinoBridge: java propgram grabbed\u0022);\n  while (true)\n  {\n    if (javaProgram.Available \u0026gt; 0)\n    {\n      byte[] rcvLenBytes = new byte[4];\n      javaProgram.Receive(rcvLenBytes);\n      int rcvLen = System.BitConverter.ToInt32(rcvLenBytes, 0);\n      byte[] rcvBytes = new byte[rcvLen];\n      javaProgram.Receive(rcvBytes);\n      String rcv = System.Text.Encoding.ASCII.GetString(rcvBytes);\n\n      Debug.Log(\u0022KSPArduinoBridge: Received input: \u0022 \u002B rcv);\n\n      interpretInput(rcv);\n    }\n  }\n}\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nIt outputs all the debug logs outside of the ListenToMiddleMan thread, but never seems to enter the method itself.\n\u003C/p\u003E\n\u003Cp\u003E\nAm I doing something wrong? I spent a few hours on this last night that I will never get back, so I thought I might ask for help since google wont help me either.\u00A0Should I rethink even having a thread? Maybe just go with checking for items to read from the socket on update?\n\u003C/p\u003E\n\u003Cp\u003E\nSource:\u00A0\u003Ca href=\u0022https://github.com/FewCode/KSPArduinoBridge-KSP\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/FewCode/KSPArduinoBridge-KSP\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2016-01-18T09:39:12Z","Content":"\n\u003Cp\u003E\nDebug.Log (and nearly anything in\u00A0UnityEngine) won\u0027t work in a thread (it may log in the \u003Cspan style=\u0022color:rgb(39,42,52);font-family:\u0027Helvetica Neue\u0027, Helvetica, Arial, sans-serif;font-size:14px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:22.4px;text-align:left;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;float:none;background-color:rgb(255,255,255);\u0022\u003EKSP_Data\\output_log.txt\u003C/span\u003E , I have a doubt). An easy alternative is to put your log in a\u00A0shared object and print them from the main thread.\n\u003C/p\u003E\n"},{"CreatedByName":"FewCode","CreatedById":141097,"CreatedDateTime":"2016-01-18T21:58:51Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222367946\u0022 data-ipsquote-contentid=\u0022130152\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221453109952\u0022 data-ipsquote-userid=\u002257146\u0022 data-ipsquote-username=\u0022sarbian\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n12 hours ago, sarbian said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nDebug.Log (and nearly anything in\u00A0UnityEngine) won\u0027t work in a thread (it may log in the \u003Cspan style=\u0022color:rgb(39,42,52);font-family:\u0027Helvetica Neue\u0027, Helvetica, Arial, sans-serif;font-size:14px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:22.4px;text-align:left;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;float:none;background-color:rgb(255,255,255);\u0022\u003EKSP_Data\\output_log.txt\u003C/span\u003E , I have a doubt). An easy alternative is to put your log in a\u00A0shared object and print them from the main thread.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThank you very much. I didn\u0027t even think that could be the case.\n\u003C/p\u003E\n"},{"CreatedByName":"artwhaley","CreatedById":118388,"CreatedDateTime":"2016-01-18T22:59:48Z","Content":"\n\u003Cp\u003E\nI don\u0027t KNOW if it makes what you\u0027re doing easier or harder... \u00A0but have you looked at kRPC? \u00A0 It uses google protocol buffers to push data in and out. \u00A0If it does everything you need, or can be made to do what you need, it might save you some effort and help you make something that others would use too! \u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nAll you\u0027d need to do is implement the external java side of things, using the other language versions as an example (python, ruby, lua and C\u002B\u002B at the moment, I think?)) \u00A0A quick search makes it look like protocol buffers has been ported to work with java already, so there\u0027s a step in the right direction!\n\u003C/p\u003E\n"}]}