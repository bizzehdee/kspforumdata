{"TopicId":95095,"ForumId":69,"TopicTitle":"[BUG] Memory Leak Flying Near Ground","CreatedByName":"Superfluous J","CreatedById":73725,"CreatedDateTime":"2014-12-31T05:44:44Z","PageNum":1,"Articles":[{"CreatedByName":"Superfluous J","CreatedById":73725,"CreatedDateTime":"2014-12-31T05:44:44Z","Content":"\n\u003Cp\u003E\u003Cstrong\u003EKSP Version: \u003C/strong\u003Ev0.90.0.705 Beta Windows 32-bit\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003EWhat Happens: \u003C/strong\u003EKSP.EXE continues to take more and more memory when flying very close to the ground.\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003EMods / Add-Ons: \u003C/strong\u003EAll Stock\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003ESteps to Replicate:\u003C/strong\u003E\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cul\u003E\u003Cli\u003EBring up Taskmgr.exe and set it to always be on top (in options).\u003Cbr\u003E\u003C/li\u003E\u003Cli\u003EIn Taskmgr, sort by memory, and KSP.exe will be at the top.\u003Cbr\u003E\u003C/li\u003E\u003Cli\u003EIn KSP, Create a simple plane with enough fuel to fly long distances at low altitudes.\u003Cbr\u003E\u003C/li\u003E\u003Cli\u003ETake off and fly within a km of the ground for a while.\u003Cbr\u003E\u003C/li\u003E\u003Cli\u003EWatch the memory climb in Taskmgr and never go down.\u003Cbr\u003E\u003C/li\u003E\u003Cli\u003EClimb up above 10km\u003Cbr\u003E\u003C/li\u003E\u003Cli\u003EWatch memory usage rise slow, then stop, but not go back down.\u003Cbr\u003E\u003C/li\u003E\u003Cli\u003EGo back down to 1km - Note memory use begins to rise again.\u003Cbr\u003E\u003C/li\u003E\u003C/ul\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003EFixes/Workarounds:\u003C/strong\u003E\u003C/p\u003E\u003Cp\u003E- None, other than don\u0027t fly close to the ground.\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003EOther Notes/Pictures/Log Files: \u003C/strong\u003E\u003C/p\u003E\u003Cp\u003E- Seems to hold the memory even when leaving the save and loading a new one.\u003C/p\u003E\n"},{"CreatedByName":"Claw","CreatedById":100668,"CreatedDateTime":"2014-12-31T07:23:17Z","Content":"\n\u003Cp\u003EHmm. Good observation. This probably has something to do with the terrain loader, but I don\u0027t know any of the specifics. I\u0027ll see if I can point this out to someone who knows a bit more about it.\u003C/p\u003E\u003Cp\u003ECheers,\u003C/p\u003E\u003Cp\u003E~Claw\u003C/p\u003E\n"},{"CreatedByName":"Superfluous J","CreatedById":73725,"CreatedDateTime":"2014-12-31T07:53:39Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Claw\u0022 data-cite=\u0022Claw\u0022\u003E\u003Cdiv\u003EHmm. Good observation. This probably has something to do with the terrain loader, but I don\u0027t know any of the specifics. I\u0027ll see if I can point this out to someone who knows a bit more about it.\u003Cp\u003ECheers,\u003C/p\u003E\u003Cp\u003E~Claw\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThanks, though I can\u0027t take full credit. One of my viewers (Liowen) noticed it when I was having crashing issues because I was running out of memory (I have lots of mods installed in that instance of the game, which makes reaching the memory limit with this memory leak easier). He thought it was due to terrain scatter, and so I ran two tests in a fully stock game. Memory usage went up with both tests. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"VideoRyan","CreatedById":133650,"CreatedDateTime":"2015-01-02T01:24:42Z","Content":"\n\u003Cp\u003EI have this issue too now, except in a rover. I landed my rover from orbit on Kerbin, as I had just done 15 minutes earlier, and my frame rate plummeted. If I looked in one direction I got 15-20, another direction got 30, and looking straight up or straight down got me 60. I noticed my memory usage was also growing quite fast for just being at Kerbin not moving at all. Then it just crashed... Does anyone have any fix for this?\u003C/p\u003E\n"},{"CreatedByName":"Skalou","CreatedById":133496,"CreatedDateTime":"2015-01-04T14:42:00Z","Content":"\n\u003Cp\u003Eyou are right, i have the same issue: i can play hours in orbi,t changing spaceraft,... without crash the program (2GO of memory use) but when i fly on kerbin the memory increasing slowly without going down and finaly it crash (time to go to south pole: 3GO\u0026gt;crash). \u003Ca href=\u0022https://forum.kerbalspaceprogram.com/members/75676-5thHorseman\u0022 rel=\u0022external nofollow\u0022\u003E\u003Cstrong\u003E5thHorseman\u003C/strong\u003E\u003C/a\u003E, i think u did a good and important observation.\u003C/p\u003E\n"},{"CreatedByName":"NathanKell","CreatedById":75006,"CreatedDateTime":"2015-01-05T03:05:17Z","Content":"\n\u003Cp\u003EI recall this being an issue for quite some time; asmi reported it back in .23 or so IIRC. It does look like something involved with PQS leaks, or (since it appears to occur even just on revert to VAB/relaunch) like the cache is being expanded rather than reused.\u003C/p\u003E\n"},{"CreatedByName":"Superfluous J","CreatedById":73725,"CreatedDateTime":"2015-01-05T03:31:02Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022NathanKell\u0022 data-cite=\u0022NathanKell\u0022\u003E\u003Cdiv\u003EI recall this being an issue for quite some time; asmi reported it back in .23 or so IIRC. It does look like something involved with PQS leaks, or (since it appears to occur even just on revert to VAB/relaunch) like the cache is being expanded rather than reused.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThat is very possible. I think the last time I flew anywhere on Kerbin that wasn\u0027t within sight of KSC was well over a year ago. It\u0027s just more important it gets fixed now because of all those survey contracts.\u003C/p\u003E\n"},{"CreatedByName":"D3voreur","CreatedById":133631,"CreatedDateTime":"2015-01-06T08:29:31Z","Content":"\n\u003Cp\u003Every annoying since I landed a rover on the mun... nice spotting that\u003C/p\u003E\n"},{"CreatedByName":"Thanny","CreatedById":110623,"CreatedDateTime":"2015-01-06T23:43:44Z","Content":"\n\u003Cp\u003EJust got bit by this one doing a long recon mission, but only after going halfway around the world then turning north for a bit. With a mid-flight save, I can see the memory usage going from ~2GB on game load to ~2.5GB on save load, then steadily increasing during flight until the game crashes at ~3.5GB.\u003C/p\u003E\u003Cp\u003EWith the 64-bit executable, memory usage follows the same pattern, and has so far increased to ~5GB. I\u0027ll have to finish these contracts in 64-bit, hoping it doesn\u0027t crash too often.\u003C/p\u003E\u003Cp\u003EThere was no real difference between stock and modded (\u0026lt;10 mods), either.\u003C/p\u003E\n"},{"CreatedByName":"AccidentalDisassembly","CreatedById":110936,"CreatedDateTime":"2015-01-07T08:09:23Z","Content":"\n\u003Cp\u003EI\u0027m fairly certain there is at least one more memory leak in KSP: just load stuff into the VAB/SPH a lot, switch scenes a lot, and you\u0027ll notice an upward trend in memory usage (in stock as well as modded). Sure, occasionally it will go back down \u003Cem\u003Esome\u003C/em\u003E, but the trend is upward an out-of-memory crash is inevitable if you play long enough. Very irritating.\u003C/p\u003E\n"},{"CreatedByName":"Superfluous J","CreatedById":73725,"CreatedDateTime":"2015-01-07T10:18:15Z","Content":"\n\u003Cp\u003EYeah I\u0027ve started hard limiting myself about an hour of play before exiting out and restarting. I\u0027m thinking of setting up a batch file that alerts me when KSP\u0027s memory usage gets past a certain point.\u003C/p\u003E\n"},{"CreatedByName":"Skalou","CreatedById":133496,"CreatedDateTime":"2015-01-07T21:54:27Z","Content":"\n\u003Cp\u003Ei seen this plugin and thinking to u: it display the memory usage on screen:\u003C/p\u003E\u003Cp\u003E\u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/99494-0-90-MemoryUsage-v1-11-2014-11-19\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://forum.kerbalspaceprogram.com/threads/99494-0-90-MemoryUsage-v1-11-2014-11-19\u003C/a\u003E\u003C/p\u003E\u003Cp\u003Edoes this mod increase the memory himself? \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif\u0022 alt=\u0022:P\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Thanny","CreatedById":110623,"CreatedDateTime":"2015-01-08T19:55:37Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Skalou\u0022 data-cite=\u0022Skalou\u0022\u003E\u003Cdiv\u003Ei seen this plugin and thinking to u: it display the memory usage on screen:\u003Cp\u003E\u003Ca href=\u0022https://forum.kerbalspaceprogram.com/threads/99494-0-90-MemoryUsage-v1-11-2014-11-19\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://forum.kerbalspaceprogram.com/threads/99494-0-90-MemoryUsage-v1-11-2014-11-19\u003C/a\u003E\u003C/p\u003E\u003Cp\u003Edoes this mod increase the memory himself? \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue.gif\u0022 alt=\u0022:P\u0022\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThat mod uses very little memory. It just shows you information available with a program like Process Explorer on a HUD. The only benefit to the mod is if you have only one monitor, and can\u0027t watch process stats real time on a second screen.\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022font-size:8px;\u0022\u003E\u003Cspan style=\u0022color:#C0C0C0;\u0022\u003E- - - Updated - - -\u003C/span\u003E\u003C/span\u003E\u003C/p\u003E\u003Cp\u003EIt does seem to be related to terrain scatter. After disabling it and restarting, I no longer see uncontrolled memory usage when flying low.\u003C/p\u003E\n"},{"CreatedByName":"klesh","CreatedById":110814,"CreatedDateTime":"2015-01-08T21:01:22Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Thanny\u0022 data-cite=\u0022Thanny\u0022\u003E\u003Cdiv\u003EThat mod uses very little memory. It just shows you information available with a program like Process Explorer on a HUD. The only benefit to the mod is if you have only one monitor, and can\u0027t watch process stats real time on a second screen.\u003Cp\u003E\u003Cspan style=\u0022font-size:8px;\u0022\u003E\u003Cspan style=\u0022color:#C0C0C0;\u0022\u003E- - - Updated - - -\u003C/span\u003E\u003C/span\u003E\u003C/p\u003E\u003Cp\u003EIt does seem to be related to terrain scatter. After disabling it and restarting, I no longer see uncontrolled memory usage when flying low.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EInteresting! I recently turned my scatter density up to 100 and was getting lots of crashes too. I\u0027ll roll it back and see what happens. Good show, lads.\u003C/p\u003E\n"},{"CreatedByName":"vexx32","CreatedById":12283,"CreatedDateTime":"2015-01-09T00:09:28Z","Content":"\n\u003Cp\u003ETerrain scatter has been buggy since... forever. I can\u0027t say I\u0027m entirely surprised it\u0027s causing some kind of memory leak... but I \u003Cem\u003Edo\u003C/em\u003E wish they\u0027d fix it. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 alt=\u0022:D\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Superfluous J","CreatedById":73725,"CreatedDateTime":"2015-01-09T00:22:04Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022vexx32\u0022 data-cite=\u0022vexx32\u0022\u003E\u003Cdiv\u003ETerrain scatter has been buggy since... forever. I can\u0027t say I\u0027m entirely surprised it\u0027s causing some kind of memory leak... but I \u003Cem\u003Edo\u003C/em\u003E wish they\u0027d fix it. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 alt=\u0022:D\u0022\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ENote: This happens with terrain scatter turned off, though it happens much faster with it on and turned up. I note that there is still some scatter in the game with it off (grass only, I think) which for all I know is what\u0027s causing it.\u003C/p\u003E\n"},{"CreatedByName":"Jovzin","CreatedById":105152,"CreatedDateTime":"2015-01-26T17:30:40Z","Content":"\n\u003Cp\u003EAny update on this ? \u003C/p\u003E\u003Cp\u003EI really hope they will fix this in new version. I am fed up that I can do only 5-6 times a switch between VAB and launch pad.\u003C/p\u003E\n"},{"CreatedByName":"Dermeister","CreatedById":41487,"CreatedDateTime":"2015-01-29T03:53:56Z","Content":"\n\u003Cp\u003EI also have this issue except me it happens in the VAB and SPH. Seems that As I move parts around on the craft the game CTD\u0027s over time....\u003C/p\u003E\n"},{"CreatedByName":"ghimb2000","CreatedById":74996,"CreatedDateTime":"2015-02-08T05:01:48Z","Content":"\n\u003Cp\u003EI sure hope they fix this before they launch 1.0. If not, KSP can only be played at most an hour before it crashes for me.\u003C/p\u003E\n"},{"CreatedByName":"Sakata","CreatedById":95648,"CreatedDateTime":"2015-02-16T10:58:54Z","Content":"\n\u003Cp\u003EFrankly it shoudln\u0027t even hit 1.0 until the leaks are fixed. 1.0 means stable, which ksp right now is not\u003C/p\u003E\n"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2015-02-16T12:46:19Z","Content":"\n\u003Cp\u003EI had a look at that this weekend. I left a ship flying on a low orbit around the Mun for 40 minutes. Terrain scatter was active and visible.\u003C/p\u003E\u003Cp\u003EAfter a while the memory stop going up, so my guess is that there is some kind of large cache that fills up, not a real leak.\u003C/p\u003E\n"},{"CreatedByName":"Superfluous J","CreatedById":73725,"CreatedDateTime":"2015-02-16T12:55:28Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022sarbian\u0022 data-cite=\u0022sarbian\u0022\u003E\u003Cdiv\u003EI had a look at that this weekend. I left a ship flying on a low orbit around the Mun for 40 minutes. Terrain scatter was active and visible.\u003Cp\u003EAfter a while the memory stop going up, so my guess is that there is some kind of large cache that fills up, not a real leak.\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI wonder if you loaded every piece of terrain scatter on your orbit (was it equatorial?) so when it had to load it again it was referenced. This would make it not a leak, though still able to easily crash a machine if you have mods installed or jump to several planets in a single session.\u003C/p\u003E\n"},{"CreatedByName":"sarbian","CreatedById":57146,"CreatedDateTime":"2015-02-16T13:07:33Z","Content":"\n\u003Cp\u003ENo, I truly think there is some kind of large cache that gets properly reused. The problem is that the Mun does not allow for a nice test (not flat enough, I kept hinting things while trying to find an alt where I saw the scatter and allowed for a full orbit). \u003C/p\u003E\u003Cp\u003EI think I\u0027ll add some code to MJ plane AP to fly at a fixed ground, send the plane with infinite fuel and see if I can graph the memory.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-02-16T13:10:13Z\u0022 title=\u002202/16/2015 01:10  PM\u0022 data-short=\u00229 yr\u0022\u003EFebruary 16, 2015\u003C/time\u003E by sarbian\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Superfluous J","CreatedById":73725,"CreatedDateTime":"2015-02-16T19:47:19Z","Content":"\n\u003Cp\u003EThen the bug is that that cache can exceed the total available (To Unity 4) memory supply. \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 alt=\u0022:D\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"Merlin4711","CreatedById":104060,"CreatedDateTime":"2015-02-25T10:21:54Z","Content":"\n\u003Cp\u003EUh, I was going to report the same stuff. Good that I had enough patience to look up some of the bugs reported already.\u003C/p\u003E\u003Cp\u003EI receive the same issue, with some additional behaviors. \u003C/p\u003E\u003Cp\u003E - the memory goes up even if I\u0027m not within viewing-distance of the ground-scutter, but much more slowly. \u003C/p\u003E\u003Cp\u003E - I think it reload all of the scutter arond the KSP everytime I switch from a building to the overview, or even try to launch... something (that KSP, so expect all kinds of launches)\u003C/p\u003E\u003Cp\u003E - Speaking of the KSP - somehow it will recreate its geografic appeareance every time I switch back. Might be another bug, but I can see how it will add about 100MB RAM\u003C/p\u003E\u003Cp\u003E - The whole game slows down while it keeps stuffing stuff in its RAM. Sometimes, when memory allocation exceed 3GB, it stats to get a pain in the youknow to build a vehilce, because you get a slight click-lag\u003C/p\u003E\u003Cp\u003E - So, I did a visual survey of a area and all left is doing a EVA. Usually my planes \u0022land\u0022 using parachutes, the Kerbal jumps out and it reches maximum memory allocation and crashes. If I reload, the whole area, which was a plain field before, is full of trees\u003C/p\u003E\u003Cp\u003EWell... lets say, this is someting, Unity does cause. Maybe hard to fix. And so on. But I wonder, if there would be a possibillity to flush that clutter-cash when you hit the game\u0027s main-menu. Being forced to leave your game might be worse, but its way more favourable compared to a plain crash and beeing forced to reload again (which may take some time if you using mods).\u003C/p\u003E\u003Cp\u003EHopefully this will be adressed in future bug-fixing \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E Until then, I will try to minimize the scutter.\u003C/p\u003E\u003Cp\u003EGreetings, someone who just bombed his KSP into ground accidently using the biggest Fuel-Tank available.\u003C/p\u003E\n"}]}