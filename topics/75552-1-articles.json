{"TopicId":75552,"ForumId":29,"TopicTitle":"[Fixed] Stopping click through a GUI window. (Part menu in flight and Editor)","CreatedByName":"Yilmas","CreatedById":83246,"CreatedDateTime":"2014-06-20T12:36:29Z","PageNum":1,"Articles":[{"CreatedByName":"Yilmas","CreatedById":83246,"CreatedDateTime":"2014-06-20T12:36:29Z","Content":"\n\u003Cp\u003EMany modders know of the very annoying issue where a user clicks on a part underneath their mod\u0027s windows, and end up activating something. Personal worst event was a decouple, ending in my carrier releasing its main engine, while on intercept with Moho...\u003C/p\u003E\u003Cp\u003EThe following have been tested to work in 0.23.5\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Chr\u003E\u003Cp\u003E\u003Cstrong\u003E\u003Cspan style=\u0022font-size:14px;\u0022\u003EFlight click through: \u003C/span\u003E\u003C/strong\u003E\u003Cem\u003E\u003Cspan style=\u0022font-size:12px;\u0022\u003E\u003Cspan style=\u0022font-size:14px;\u0022\u003E(Part menu)\u003C/span\u003E\u003C/span\u003E\u003C/em\u003E\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022font-size:10px;\u0022\u003E\u003Cspan style=\u0022font-size:12px;\u0022\u003E\u003Cspan style=\u0022font-size:14px;\u0022\u003EPut this snippet at the end of your OnGUI()\u003C/span\u003E\u003C/span\u003E\u003C/span\u003E\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E// Hide part rightclick menu.\u003Cbr\u003Eif (!GUIUtility.hotControl.IsNull())\u003Cbr\u003E{\u003Cbr\u003E        if (windowPosition.Contains(Input.mousePosition) \u0026amp;\u0026amp; GUIUtility.hotControl == 0)\u003Cbr\u003E        {\u003Cbr\u003E                foreach (var window in GameObject.FindObjectsOfType(typeof(UIPartActionWindow))\u003Cbr\u003E                              .OfType\u0026lt;UIPartActionWindow\u0026gt;().Where(p =\u0026gt; p.Display == UIPartActionWindow.DisplayType.Selected))\u003Cbr\u003E                {\u003Cbr\u003E                         window.enabled = false;\u003Cbr\u003E                         window.displayDirty = true;\u003Cbr\u003E                }\u003Cbr\u003E        }\u003Cbr\u003E}\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EThe way it works is by first determining if the mouse\u0027 current position is within the bounds of the window and that the mouse is not currently clicking. If true, it will cycle through all active UIPartActionWindows and set each to disabled and refresh it.\u003C/p\u003E\u003Cp\u003ENotes: \u003C/p\u003E\u003Cp\u003EIf you don\u0027t destroy your windows when closing them, you will need an if statement before this, to return. ie: if(windowIsHidden) return;\u003C/p\u003E\u003Cp\u003EThere can seem to be some flickering on the parts window, however it is only cosmetic. This happens because the part\u0027s window is rendered before the mod\u0027s, therefor it will open, and then the mod will tell it to close again.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003Eif (windowPosition.Contains(Input.mousePosition) \u0026amp;\u0026amp; GUIUtility.hotControl == 0 \u0026amp;\u0026amp; Input.GetMouseButton(0))\u003Cbr\u003E{\u003Cbr\u003E         ...\u003Cbr\u003E}\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EIf you dont like the flickering, you can change the initial if statement with the code above to change the behaviour of the code. Instead of hiding the window, it will simply not allow the user to left click on any part window buttons. However, they will still open.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Chr\u003E\u003Cp\u003E\u003Cstrong\u003E\u003Cspan style=\u0022font-size:14px;\u0022\u003EEditor Click through:\u003C/span\u003E\u003C/strong\u003E\u003C/p\u003E\u003Cp\u003EPut this snippet in your OnGUI()\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E// Lock editor while mouse is over the window.\u003Cbr\u003Eif (windowPosition.Contains(Input.mousePosition))\u003Cbr\u003E{\u003Cbr\u003E    EditorTooltip.Instance.HideToolTip();\u003Cbr\u003E    EditorLogic.fetch.Lock(false, false, false, \u0022UniqueLock\u0022);\u003Cbr\u003E}\u003Cbr\u003Eelse if (!windowPosition.Contains(Input.mousePosition))\u003Cbr\u003E{\u003Cbr\u003E    EditorLogic.fetch.Unlock(\u0022UniqueLock\u0022);\u003Cbr\u003E}\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EThis basically locks the editor when the mouse moves over the window, and unlocks it again when the cursor leaves the window. However, this can at times be carried over into the Flight view, and so you must use the code below to make sure that parts are unlocked when the window is destroyed.\u003C/p\u003E\u003Cp\u003EPut this snippet in your OnDestroy()\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003EEditorLogic.fetch.Unlock(\u0022UniqueLock\u0022);\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EFinally, put this snippet in your Awake()\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003EInputLockManager.RemoveControlLock(\u0022UniqueLock\u0022);\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003EImportant!\u003C/strong\u003E: Change the string \u0022UniqueLock\u0022 to something unique of your mod. This is to prevent other mods from messing with yours. If they happen to use the same approach.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Chr\u003E\u003Cp\u003EAny comments, bugs or alternative scripts are welcome.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222014-06-20T12:42:12Z\u0022 title=\u002206/20/2014 12:42  PM\u0022 data-short=\u002210 yr\u0022\u003EJune 20, 2014\u003C/time\u003E by Yilmas\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"blizzy78","CreatedById":68543,"CreatedDateTime":"2014-06-20T13:11:30Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022Yilmas\u0022 data-cite=\u0022Yilmas\u0022\u003E\u003Cdiv\u003E\u003Cstrong\u003EImportant!\u003C/strong\u003E: Change the string \u0022UniqueLock\u0022 to something unique of your mod. This is to prevent other mods from messing with yours. If they happen to use the same approach.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EAlso, it helps to identify stray input locks in the debug window (Alt\u002BF12.)\u003C/p\u003E\n"},{"CreatedByName":"Yilmas","CreatedById":83246,"CreatedDateTime":"2014-06-20T13:19:32Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022blizzy78\u0022 data-cite=\u0022blizzy78\u0022\u003E\u003Cdiv\u003EAlso, it helps to identify stray input locks in the debug window (Alt\u002BF12.)\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EIndeed \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 alt=\u0022:)\u0022\u003E Personally, I do (\u0022modnameLOCK\u0022\u002BwindowID)\u003C/p\u003E\n"}]}