{"TopicId":6663,"ForumId":25,"TopicTitle":"Mini-challenge: max altitude with this supplied spacecraft","CreatedByName":"closette","CreatedById":11773,"CreatedDateTime":"2012-02-14T18:26:41Z","PageNum":8,"Articles":[{"CreatedByName":"PakledHostage","CreatedById":8059,"CreatedDateTime":"2012-05-22T19:33:07Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022DayBlur\u0022 data-cite=\u0022DayBlur\u0022\u003E\u003Cdiv\u003E\u003Cp\u003EI\\\u0027m certainly looking forward to tackling the 2D orbit launch problem. The equations of motion aren\\\u0027t much more complicated, especially if I assume a non-rotating Kerbin (but still include the initial tangential velocity). I\\\u0027m guessing the most useful formulation would be to minimize the fuel to some target circular orbit. Is there an existing challenge along these lines?\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003ENot directly, but there was the \u003Ca href=\u0022http://kerbalspaceprogram.com/forum/index.php?topic=555.msg105107#msg105107\u0022 rel=\u0022external nofollow\u0022\u003EEconomy of Design\u003C/a\u003E challenge. Through a combination of calculations to predict when to start my pre-landing burn and a lot of luck, I managed to get a\u003C/p\u003E\u003Cp\u003E(1) Pod-2LFT-LFE stack into orbit and safely back down again (total of 2 tanks). \u003C/p\u003E\u003Cp\u003EI also recall reading about Kosmo-not managing to get a \u003C/p\u003E\u003Cp\u003E(2) two stage Pod-small LFT-small LFE-decoupler-LFT-LFE stack (total of 1-1/2 tanks) into orbit. \u003C/p\u003E\u003Cp\u003EAnd I seem to remember that there was a group who worked to get a \u003C/p\u003E\u003Cp\u003E(3) Pod-small LFT, LFT, small LFE stack (total of 1-1/2 tanks) into orbit using MechJeb. \u003C/p\u003E\u003Cp\u003EBy my figures, stack (1) has a Delta-V of 4537 m/s, stack (2) has a Delta-V of 4716 m/s and stack (3) has a Delta-V of 5627 m/s. (If I\\\u0027m wrong about any of this, I\\\u0027m sure someone will be quick to correct me...) \u003C/p\u003E\u003Cp\u003EMaybe your optimisation efforts could be applied to a new challenge to get the lowest Delta-V rocket into orbit? Adding a parachute to stack (1) decreases the Delta-V to 4291 m/s. I have always wondered if it would be possible to get that stack into orbit but I haven\\\u0027t managed it. Maybe you can do it? \u003C/p\u003E\n"},{"CreatedByName":"DayBlur","CreatedById":25558,"CreatedDateTime":"2012-05-24T22:08:55Z","Content":"\n\u003Cp\u003E@PakledHostage Thanks for the link and info, that looks like a good place to start. I think I\\\u0027ll try to see how efficiently I can get your 4537m/s stack into orbit, and then see if I can add the parachute.\u003C/p\u003E\u003Cp\u003ESo, I found time to play around with the equations a little more last night and have re-derived a feedback control law taking into account centripetal acceleration and the drag force equation\\\u0027s explicit dependence on mass.\u003C/p\u003E\u003Cp\u003EThis time, I tried approaching the problem from the point of view of trying to track the terminal velocity. Taking the partial derivative of the terminal velocity with respect to time gives me the following equations for the \\\u0027terminal acceleration\\\u0027, i.e. the rate at which the terminal velocity is increasing:\u003C/p\u003E\u003Cp\u003Eneglecting centripetal acceleration: v^2*sqrt(m*g/D)*( -1/(h0\u002Bh) \u002B 1/(2*\u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_cool.png\u0022 alt=\u0022B)\u0022\u003E ) g = mu/r^2\u003C/p\u003E\u003Cp\u003Eincluding centripetal acceleration: v^2*sqrt(m*g/D)*( -1/(h0\u002Bh) - 3*w^2/(2*g) \u002B 1/(2*\u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_cool.png\u0022 alt=\u0022B)\u0022\u003E ) g = mu/r^2 - w^2*r\u003C/p\u003E\u003Cp\u003E(Note: I included the centripetal acceleration in the gravity term)\u003C/p\u003E\u003Cp\u003EThis is essentially the \\\u0027a\\\u0027 in the T - D - W = m*a equation. Typically the latter gives me a ~10 meters of improvement, so that\\\u0027s what I\\\u0027m using. Note that the m*g/D ratio *should* be 1.0 and can be eliminated from a purely analytical standpoint, but I kept it in there to act as a sort of feedback for any numerical inaccuracies that occur during the integration. Implementing the latter control law in MechJeb\\\u0027s ascent autopilot (exactly as above - no other \\\u0027fudge factors\\\u0027), I can get as high as 33,658m:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cblockquote\u003E\u003Cimg src=\u0022http://i.imgur.com/g5rcW.png\u0022 alt=\u0022g5rcW.png\u0022\u003E\u003C/blockquote\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EHere are some plots of the actual flight data for the above flight:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cblockquote\u003E\u003Cimg src=\u0022http://i.imgur.com/g3IDf.png\u0022 alt=\u0022g3IDf.png\u0022\u003E\u003C/blockquote\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cblockquote\u003E\u003Cimg src=\u0022http://i.imgur.com/QG9Dn.png\u0022 alt=\u0022QG9Dn.png\u0022\u003E\u003C/blockquote\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cblockquote\u003E\u003Cimg src=\u0022http://i.imgur.com/e8won.png\u0022 alt=\u0022e8won.png\u0022\u003E\u003C/blockquote\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003ESome things to note:\u003C/p\u003E\u003Cp\u003E1) W and D stay close through the controller part, which is the \\\u0027singular surface\\\u0027 in the optimal control problem and corresponds to the standard free-fall terminal velocity equation.\u003C/p\u003E\u003Cp\u003E2) The TWR starts a bit above 2 and increases. The excess above 2 is used to track the ever-increasing terminal velocity. See also the difference between T and W\u002BD.\u003C/p\u003E\u003Cp\u003E3) The thrust actually decreases at first and flattens out before finally shooting up. Holding thrust constant around 45% until around 10km is a pretty good approximation, and I think that matches pretty closely with the strategies I\\\u0027ve seen people use here.\u003C/p\u003E\u003Cp\u003EI made about 5 attempts at following my profile *manually* and was able to get up to 33,560m, which I believe is a new record:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cblockquote\u003E\u003Cimg src=\u0022http://i.imgur.com/rDIHa.png\u0022 alt=\u0022rDIHa.png\u0022\u003E\u003C/blockquote\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cblockquote\u003E\u003Cimg src=\u0022http://i.imgur.com/glYbs.png\u0022 alt=\u0022glYbs.png\u0022\u003E\u003C/blockquote\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EI\\\u0027m also attaching an Excel file with the log of my data straight from the program and the above plots. I should point out that the altitude displayed in the game differs by a few meters from the internal values I\\\u0027m logging (maybe command pod vs center of mass?). There are also a couple more plots of throttle settings (in units of the ticks on the UI) vs both velocity and altitude, which may help if trying to fly manually. I\\\u0027ll be interested to see if this allows some even higher manual records to be set by the experienced pilots here. Or by Jeb getting lucky.\u003C/p\u003E\u003Cp\u003E[edit] clarified the definition of g for the two cases\u003C/p\u003E\n"},{"CreatedByName":"antbin","CreatedById":22389,"CreatedDateTime":"2012-05-24T23:08:34Z","Content":"\n\u003Cp\u003EDayBlur for President! \u003Cimg src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_ohmy.png\u0022 alt=\u0022:o\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"closette","CreatedById":11773,"CreatedDateTime":"2012-05-25T00:05:52Z","Content":"\n\u003Cp\u003E@DayBlur,\u003C/p\u003E\u003Cp\u003E Sorry you had trouble reading my PDFs - not that you need them - but I had a friend process them through a PC and have attached the results below.\u003C/p\u003E\u003Cp\u003EFrom experiment with numerically chasing the termnal speed, it looks like the resulting optimal TWR ends up being what you found, i.e. TWR = 2 \u002B a/g where the acceleration a is that required to keep up with the changing terminal speed with height. (i.e. a = dv\u003Csub\u003ET\u003C/sub\u003E/dt = v\u003Csub\u003ET\u003C/sub\u003E dv\u003Csub\u003ET\u003C/sub\u003E/dy).\u003C/p\u003E\u003Cp\u003EThis is what my code and MechJeb does, but your higher record altitude tells me that your code is doing \u0027something\u0027 differently. I\\\u0027ll have to take a look at the detailed profiles you kindly provided and report back. I LOVE data!\u003C/p\u003E\u003Cp\u003EJust a quick note on the small centrifugal terms, which jebbe worked on in detail. An unresolved question is whether one should use constant rotational velocity during ascent (= the velocity of Kerbin\\\u0027s equator), or alternatively a \u0027constant angular velocity\u0027 where Kerbin\\\u0027s atmosphere causes the rocket to co-rotate with Kerbin all the way up. Differences between these two are, for this rocket at least, too small to tell.\u003C/p\u003E\u003Cp\u003EYou\\\u0027ve revitalized this thread and the investgation as a whole. You also explain what you\\\u0027ve done very clearly. Could I prevail upon you to provide a bit more detail on how you derived the optimal control feedback equations?\u003C/p\u003E\n"},{"CreatedByName":"DayBlur","CreatedById":25558,"CreatedDateTime":"2012-05-25T01:36:49Z","Content":"\n\u003Cp\u003E@closette - Thanks for the PDFs, they came through fine this time (and are very well written!) I\\\u0027ll try to familiarize myself with all the work you\\\u0027ve done thus far.\u003C/p\u003E\u003Cp\u003EFor the latest, highest results, I just implemented the \\\u0027terminal acceleration\\\u0027 as you have calculated in your papers, with the additional terms for gravity and centripetal force variation in height in addition to that of the atmospheric density. Also, as mentioned earlier, I left in the sqrt(W/D) term I had to help correct for numerical divergence. I tried to get to the same point from an optimal control standpoint, but had some small discrepancies - probably an error in my derivation somewhere along the line.\u003C/p\u003E\u003Cp\u003EI\\\u0027d be happy to write something basic up on the optimal control solution I derived earlier. Basically, I used an indirect method where you define an augmented Hamiltonian system and solve the boundary value problem. I would recommend \u0027Applied Optimal Control\u0027 by Bryson and Ho as it has a fairly simple treatment of the Goddard problem. I can put together some brief optimal control background information along with the derivation of the solution to the simplified problem (constant gravity, no centripetal acceleration) with modifications for Kerbin\\\u0027s drag model. It might take me a few days to find time, so if you have any specific questions in the meantime, feel free to ask.\u003C/p\u003E\u003Cp\u003EThe MechJeb code currently does this (pseudocode):\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003EtargetRatio = 1.0\u003Cbr\u003Efalloff = 15.0\u003Cbr\u003EvelocityRatio = ascentVelocity / terminalVelocity\u003Cbr\u003Eif (velocityRatio \u0026lt; targetRatio)\u003Cbr\u003E throttleRatio = 1.0\u003Cbr\u003Eelse\u003Cbr\u003E throttleRatio = 1.0 - falloff * (velocityRatio - targetRatio)\u003Cbr\u003Eend\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EWhich seems to be trying to track the terminal velocity rather than utilize the acceleration term that comes from the rate of change of the terminal velocity. This gives a best of 33,594m (or 99.8% of my best), which is close. I\\\u0027ve noticed that it applies slightly (~4%) more thrust than me after that initial throttle-back, but I haven\\\u0027t looked at it very closely.\u003C/p\u003E\u003Cp\u003EThis problem is very sensitive at these small differences we\\\u0027re tracking. If it was the real world, I\\\u0027d round it off to 33,500m and call it done! The fact that I get altitudes that can vary by almost \u002B/-10m in different runs using the same autopilot code makes me question the extent that we can rely upon our models. (My current MATLAB model tells me I should be getting almost 1km higher than I am).\u003C/p\u003E\u003Cp\u003EGlancing over your papers, the only differences that I see between your derivations and mine is that I take into account the variation of gravity (and centripetal acceleration) with height. This gravity term is a couple of orders of magnitude less than the variation due to the exponential atmosphere, but maybe that\\\u0027s enough to make a difference?\u003C/p\u003E\u003Cp\u003ERegarding the centripetal terms, I think the correct solution will be somewhere in the middle. As the rocket increases in altitude, its lateral velocity is less than the \\\u0027air up there\\\u0027, so it would have its lateral velocity accelerated by that side force, but will never actually catch up and co-rotate. I\\\u0027m hoping this will all be accounted for nicely in the 2D derivation I started working on for the orbital launch.\u003C/p\u003E\u003Cp\u003EI\\\u0027ll try to log some comparison flights between my control law and what MechJeb is currently using. If you\\\u0027d like to post some code or equations for the force to apply given all other states, I can try that out in the autopilot as well.\u003C/p\u003E\n"},{"CreatedByName":"closette","CreatedById":11773,"CreatedDateTime":"2012-06-25T22:46:56Z","Content":"\n\u003Cp\u003EHi DayBlur,\u003C/p\u003E\u003Cp\u003E I finally managed to look at your flight data (thanks!) to see how your optimal ascent strategy differs. As you predicted \u0027not by much\u0027 is the answer. \u003C/p\u003E\u003Cp\u003EThe C\u002B\u002B code I was using to predict the maximum altitude is designed to \u0027chase\u0027 the terminal velocity (i.e. provide enough thrust to reach the terminal speed). Yes, I do include the changing gravity, and maximum_drag factor as fuel is used up, and a rudimentary centripetal term, as does the MechJeb implementation I believe. (Although Mechjeb does so using an arbitrary \u0027falloff\u0027 factor which I don\\\u0027t quite understand).\u003C/p\u003E\u003Cp\u003Eit sounds like your method explicitly calculated the acceleration required \u0027right now\u0027 (= v dv/dy) assuming that your ship is already going at the terminal speed. This means that your thrust profile is slightly more aggressive, resulting in a higher speed at burnout (which also happens a little earlier than for mine since you burn fuel a bit faster).\u003C/p\u003E\u003Cp\u003EAs you say, the differences are only just above the \u0027simulation noise\u0027 of time-steps, time warps etc. but they worked well in your favor!\u003C/p\u003E\u003Cp\u003EI do hope you can work on the 2-D ascent problem - there are a couple of related Challenges going on right now (just follow my posts).\u003C/p\u003E\u003Cp\u003EI have attached a line-by-line comparison of our ascent methods. Columns beginning with a \u0027C\u0027 are for the \u0027Closette\u0027 model ascent. Those beginning with a \u0027D\u0027 are the \u0027DayBlur\u0027 measured profile.\u003C/p\u003E\n"},{"CreatedByName":"KevinTMC","CreatedById":28909,"CreatedDateTime":"2012-07-27T01:10:50Z","Content":"\n\u003Cp\u003EI hadn\\\u0027t run across this challenge until just now, and thought I\\\u0027d give it a try in 0.16. I replicated the craft based on the screenshot, added a radial-mount MechJeb (for the ascent statistics) and a parachute and coupler (because I\\\u0027m soft-hearted), gave it a go...and was amazed at how much more dramatic the results were.\u003C/p\u003E\u003Cp\u003EGunning it at 100% the whole way, straight up, resulted in an apokerb of around 8850m.\u003C/p\u003E\u003Cp\u003EThrusting at 100% for 5 seconds (to approximately 600m altitude), then at 1/3rd throttle the rest of the way--and again, straight up the whole way--yielded an apokerb of over \u003Cem\u003E345,000m\u003C/em\u003E.\u003C/p\u003E\u003Cp\u003EThe physics model has been tinkered with a bit between 0.15 and 0.16, perhaps?\u003C/p\u003E\u003Cp\u003EEDIT: I took the extra pieces off and took a shot at manually piloting the craft into orbit. I succeeded in establishing an equatorial orbit, and pushed it out to 738km apokerb/602km perikerb before running out of fuel.\u003C/p\u003E\u003Cp\u003EI\\\u0027ve installed a handful of plugins...I don\\\u0027t *think* any of the parts used on this craft were affected by that, but I\\\u0027m double-checking that now.\u003C/p\u003E\u003Cp\u003E.craft file (the one without any stuff added) has been attached.\u003C/p\u003E\n"},{"CreatedByName":"Kosmo-not","CreatedById":14082,"CreatedDateTime":"2012-07-27T02:02:44Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022KevinTMC\u0022 data-cite=\u0022KevinTMC\u0022\u003E\u003Cdiv\u003E\u003Cp\u003EThe physics model has been tinkered with a bit between 0.15 and 0.16, perhaps?\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThere is currently a bug in how fuel consumption is related to throttle setting. For full throttle, things are fine. For half throttle, actual fuel consumption is half as much as reported by the engine. This has led to someone getting to the Mun and back on one of the small half tanks.\u003C/p\u003E\u003Cp\u003EHere is a link to the bug report: \u003Ca href=\u0022http://kerbalspaceprogram.com/forum/index.php?topic=17006.0\u0022 rel=\u0022external nofollow\u0022\u003E[0.16] [MAJOR] Fuel consumption is wrong at low throttle\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EHarvester has already fixed this issue for the next update, whenever that may be. Until then, 0.16 should not be used for this challenge.\u003C/p\u003E\n"},{"CreatedByName":"KevinTMC","CreatedById":28909,"CreatedDateTime":"2012-07-27T02:31:29Z","Content":"\n\u003Cp\u003EAha. That would explain it. Thanks for the info.\u003C/p\u003E\u003Cp\u003EOnce this is fixed, perhaps a new round of this challenge would be in order? Just reading the thread has opened my eyes to a number of things...and there\\\u0027s still ever so much more to learn. (Also, any activity like this that prompts super-smart people like closette to reverse-engineer the physics seems to lead to improvement in the game engine in the end.)\u003C/p\u003E\n"},{"CreatedByName":"tvizz","CreatedById":9265,"CreatedDateTime":"2012-07-27T02:55:56Z","Content":"\n\u003Cp\u003ELol yeah with the bug you can get 10k\u002B Delta-V\u003C/p\u003E\n"},{"CreatedByName":"closette","CreatedById":11773,"CreatedDateTime":"2012-07-27T05:58:31Z","Content":"\n\u003Cp\u003EThanks for the kind words (this challenge was a team effort) and for revisiting the challenge - it\\\u0027s been ongoing in some form since 1919! \u003Ca href=\u0022https://en.wikipedia.org/wiki/Goddard_problem\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://en.wikipedia.org/wiki/Goddard_problem\u003C/a\u003E.\u003C/p\u003E\u003Cp\u003EI\\\u0027ve only just installed 0.16 (Mac users had to wait) but it certainly sounds like a fuel problem, and not a change to the atmospheric drag model which I would be very interested in! I\\\u0027ll check it out later on but it sounds like a 0.16.1 revision should bring the challenge back to \u0027normal\u0027 and restore honor and dignity to the leaderboard...\u003C/p\u003E\n"},{"CreatedByName":"Vector","CreatedById":80152,"CreatedDateTime":"2013-09-11T00:03:36Z","Content":"\n\u003Cp\u003ESorry to revive such an old thread (though I think this one is worthy) but is the physics model similar enough for 0.21 for results to be comparable? I am trying to use a different method of optimization and I am unsure of whether to expect the optimum to be the same. I am also having trouble downloading the craft file (if the parts still exist) so if anyone can help out with that it would be much appreciated.\u003C/p\u003E\u003Cp\u003EIf not then maybe there needs to be a new 1D Goddard challenge (my program is not yet able to handle the 2D case... just a simple extension haha).\u003C/p\u003E\n"},{"CreatedByName":"astropapi1","CreatedById":57507,"CreatedDateTime":"2013-09-11T00:27:37Z","Content":"\n\u003Cp\u003EVector.\u003C/p\u003E\u003Cp\u003EFor God\u0027s sake, just create a new thread.\u003C/p\u003E\n"},{"CreatedByName":"stupid_chris","CreatedById":62017,"CreatedDateTime":"2013-09-11T00:45:38Z","Content":"\n\u003Cp\u003EThe above is right. This challenge dates from .16, it\u0027s 100% sure that whatever craft use there is incompatible now. If you want to make a new challenge like this one, feel free to do so Vector, but don\u0027t revive old threads like this.\u003C/p\u003E\u003Cp\u003E/thread\u003C/p\u003E\n"}]}