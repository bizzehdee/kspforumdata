{"TopicId":123912,"ForumId":29,"TopicTitle":"Can I get a definitive answer for the *un*dock event in KSP 1.04?","CreatedByName":"SixHourDays","CreatedById":140711,"CreatedDateTime":"2015-10-28T04:45:51Z","PageNum":1,"Articles":[{"CreatedByName":"SixHourDays","CreatedById":140711,"CreatedDateTime":"2015-10-28T04:45:51Z","Content":"\n\u003Cp\u003EHi. I\u0027m SixHourDays, and I\u0027m a few months into my first plugin. This forum has been a goldmine of answers for SO MUCH of what I needed. \u003Cstrong\u003ESo thank you!\u003C/strong\u003E\u003C/p\u003E\u003Cp\u003EI\u0027m \u003Cstrong\u003Elooking for the specific GameEvents event for undocking\u003C/strong\u003E\u003Cstrong\u003E\u003Cem\u003E.\u003C/em\u003E\u003C/strong\u003E\u003C/p\u003E\u003Cp\u003E\u003Cstrong\u003EANSWERED:\u003C/strong\u003E onPartUndock fires for all undocking, \u003Cem\u003Eexcept\u003C/em\u003E the first undock of something attached to them in VAB (including another docking port). Subsequent undockings of these ports will fire onPartUndock like usual.\u003C/p\u003E\u003Cp\u003EonPartJointBreak will fire for all undockings, even the aforementioned special case, on every try.\u003C/p\u003E\u003Cp\u003E------------\u003C/p\u003E\u003Cp\u003EThe onPartUndock and onUndock events don\u0027t fire for me.\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E//inside my plugin\u0027s Awake()\u003Cbr\u003EGameEvents.onPartCouple.Add( MyDockEventHandler ); //this works fine for docking\u003Cbr\u003EGameEvents.???.Add( MyUndockEventHandler ); //what do I subscribe my handler to?\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EFor the curious, I am unsubscribing from these same handlers in OnDestroy. Even more peculiar is most other events work. I readily get events for OnPartDie, OnExperimentDeployed, OnCrewTransferred, OnStageSeparate, etc.\u003C/p\u003E\u003Cp\u003EFrom the assembly info on GameEvents.cs, I see only these that I could use...\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003E\u003Cbr\u003E    public static EventData\u0026lt;Part\u0026gt; onPartUndock; //tried it, didn\u0027t fire\u003Cbr\u003E    public static EventData\u0026lt;GameEvents.FromToAction\u0026lt;ModuleDockingNode, ModuleDockingNode\u0026gt;\u0026gt; onSameVesselDock; //wrong (docking), and I want the two ship case\u003Cbr\u003E    public static EventData\u0026lt;GameEvents.FromToAction\u0026lt;ModuleDockingNode, ModuleDockingNode\u0026gt;\u0026gt; onSameVesselUndock; //I want the two ship case\u003Cbr\u003E    public static EventData\u0026lt;EventReport\u0026gt; onUndock; //tried it, didn\u0027t fire\u003Cbr\u003E\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EThanks for anyone\u0027s help in this.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-10-29T01:54:44Z\u0022 title=\u002210/29/2015 01:54  AM\u0022 data-short=\u00228 yr\u0022\u003EOctober 29, 2015\u003C/time\u003E by SixHourDays\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Diazo","CreatedById":81549,"CreatedDateTime":"2015-10-28T05:22:38Z","Content":"\n\u003Cp\u003EI have looked for this myself but was also unable to find one. The closest I found was an event that fired when a part\u0027s connection to another part was deleted. But as this included such things as crashes, explosions, etc. and so it didn\u0027t work for me.\u003C/p\u003E\u003Cp\u003EI thought that was the onPartUndock event, but you say you\u0027ve checked it so I\u0027m not sure what\u0027s happening there. (I\u0027m also going back to the KSP 0.90 days here, maybe something changed.)\u003C/p\u003E\u003Cp\u003ENow, it sounds like you need the actual Undock event for what you are doing so my this probably won\u0027t work for you, but my workaround was to monitor the Vessel.rootPart and Vessel.parts.count properties and trigger my code when either of those things changed. Note this triggers a lot more often then on just undocking.\u003C/p\u003E\u003Cp\u003ED.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-10-28T15:14:57Z\u0022 title=\u002210/28/2015 03:14  PM\u0022 data-short=\u00228 yr\u0022\u003EOctober 28, 2015\u003C/time\u003E by Diazo\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"SixHourDays","CreatedById":140711,"CreatedDateTime":"2015-10-28T16:44:10Z","Content":"\n\u003Cp\u003EUpdate!\u003C/p\u003E\u003Cp\u003EHere\u0027s a \u003Ca href=\u0022http://i.imgur.com/TydTOy9.png\u0022 rel=\u0022external nofollow\u0022\u003Epic of the test ship\u003C/a\u003E\u003C/p\u003E\u003Cp\u003EI\u0027ve registered for these events:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003EGameEvents.onVesselWasModified.Add(OnVesselModified);\u003Cbr\u003EGameEvents.onPartCouple.Add(OnPartCouple);\u003Cbr\u003EGameEvents.onPartUndock.Add(OnPartUndock);\u003Cbr\u003EGameEvents.onSameVesselDock.Add(OnSameVesselDock);\u003Cbr\u003EGameEvents.onSameVesselUndock.Add(OnSameVesselUndock);\u003Cbr\u003EGameEvents.onUndock.Add(OnUndock);\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EI\u0027ve discovered the following sequence of events occur:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003EUndock the capsules:\u003C/div\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E - OnVesselModified event x2\u003C/div\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003ERedock the capsules:\u003C/div\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E - OnPartCouple event\u003C/div\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E - OnVesselModified event x2\u003C/div\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003EUndock capsules \u003C/div\u003E\u003Cem\u003E\u003C/em\u003E\u003Cdiv\u003E\u003Cem\u003Eagain:\u003C/em\u003E\u003C/div\u003E\u003Cem\u003E\u003C/em\u003E\u003Cp\u003E\u003Cstrong\u003E\u003C/strong\u003E\u003C/p\u003E\u003Cdiv\u003E\u003Cstrong\u003E - OnPartUndock event\u003C/strong\u003E\u003C/div\u003E\u003Cstrong\u003E\u003C/strong\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E - OnVesselModified event x2\u003C/div\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003ERedock the capsules \u003C/div\u003E\u003Cem\u003E\u003C/em\u003E\u003Cdiv\u003E\u003Cem\u003Eagain\u003C/em\u003E\u003C/div\u003E\u003Cem\u003E\u003C/em\u003E\u003Cdiv\u003E:\u003C/div\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E - OnPartCouple event\u003C/div\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E - OnVesselModified event x2\u003C/div\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003ESo, why doesn\u0027t OnPartUndock or OnSameVesselUndock fire during the \u003Cem\u003Efirst \u003C/em\u003Eundock event? Why only on 2nd docking forward? I\u0027m betting something about launching the ship with the two capsules docked counts as it all being one ship, until I split it with the first undock. But then I\u0027d expect OnSameVesselUndock to cover that case...\u003C/p\u003E\u003Cp\u003EAs always, any help is appreciated.\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-10-28T16:47:45Z\u0022 title=\u002210/28/2015 04:47  PM\u0022 data-short=\u00228 yr\u0022\u003EOctober 28, 2015\u003C/time\u003E by SixHourDays\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"DMagic","CreatedById":57416,"CreatedDateTime":"2015-10-28T17:14:40Z","Content":"\n\u003Cp\u003EHow are you undocking the first time? It doesn\u0027t fire when you use the decouple option from the docking port. Or, it might be as you said, that it doesn\u0027t count for parts \u0022docked\u0022 together in the VAB.\u003C/p\u003E\u003Cp\u003EYou can use onVesselCreate if you want something that works every time. Of course, it also gets called for \u003Ca href=\u0022http://anatid.github.io/XML-Documentation-for-the-KSP-API/class_game_events.html#ab6e626cdf2b04fa27f185823b2ebb50e\u0022 rel=\u0022external nofollow\u0022\u003Elots of other things\u003C/a\u003E. \u003C/p\u003E\u003Cp\u003EBut any undock or decouple event triggers it; you would just have to do lots of checking to make sure that the event is triggered by the vessel you are looking for.\u003C/p\u003E\n"},{"CreatedByName":"blowfish","CreatedById":119688,"CreatedDateTime":"2015-10-28T17:15:08Z","Content":"\n\u003Cp\u003EI\u0027m guessing that when you place two docking ports together in the editor, they don\u0027t count as docked to start with. Notice that the event is called \u0022decouple\u0022 rather than \u0022undock\u0022 the first time. It\u0027s probably behaving like a decoupler in this case.\u003C/p\u003E\n"},{"CreatedByName":"SixHourDays","CreatedById":140711,"CreatedDateTime":"2015-10-28T18:09:32Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003EHow are you undocking the first time? It doesn\u0027t fire when you use the decouple option from the docking port.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThe only way I know of undocking is to right click the docking port, and select \u0022Decouple Node\u0022 (or use an action group). Is there another way I\u0027m oblivious to? If you mean code-undocking, that\u0027s not what I\u0027m doing. This is all meant to capture normal-user-gameplay undocks.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003EI\u0027m guessing that when you place two docking ports together in the editor, they don\u0027t count as docked to start with.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI agree with you, it seems that the VAB created docked ports behave different.\u003C/p\u003E\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022\u003E\u003Cdiv\u003E Notice that the event is called \u0022decouple\u0022 rather than \u0022undock\u0022 the first time. It\u0027s probably behaving like a decoupler in this case.\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EThe only GameEvent with \u0022couple\u0022 anywhere in the name is\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Epublic static EventData\u0026lt;GameEvents.FromToAction\u0026lt;Part, Part\u0026gt;\u0026gt; onPartCouple;\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003Ewhich I have subscribed to, and am listening for. It fires during docking/redocking.\u003C/p\u003E\u003Cp\u003EI don\u0027t see a \u0027decouple\u0027 event anywhere in GameEvents.cs.\u003C/p\u003E\u003Cp\u003EDoes anyone understand the nature of docking ports which were built docked to one another in VAB?\u003C/p\u003E\n"},{"CreatedByName":"blowfish","CreatedById":119688,"CreatedDateTime":"2015-10-28T18:34:25Z","Content":"\n\u003Cp\u003EonPartJointBreak, onStageSeparation, onVesselCreate, and onVesselWasModified should all be triggered.\u003C/p\u003E\u003Cp\u003EMy understanding is that docking ports which are docked in the VAB behave like decouplers.\u003C/p\u003E\n"},{"CreatedByName":"SixHourDays","CreatedById":140711,"CreatedDateTime":"2015-10-28T18:56:28Z","Content":"\n\u003Cp\u003E\u003Cspan style=\u0022color:#333333;\u0022\u003EI can tell you that onStageSeparation does \u003C/span\u003E\u003Cstrong\u003E\u003Cspan style=\u0022color:#333333;\u0022\u003Enot\u003C/span\u003E\u003C/strong\u003E\u003Cspan style=\u0022color:#333333;\u0022\u003E fire, and that \u003C/span\u003E\u003Cspan style=\u0022color:#333333;\u0022\u003EonVesselWasModified \u003C/span\u003E\u003Cstrong\u003E\u003Cspan style=\u0022color:#333333;\u0022\u003Edoes\u003C/span\u003E\u003C/strong\u003E\u003Cspan style=\u0022color:#333333;\u0022\u003E fire.\u003C/span\u003E\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022color:#333333;\u0022\u003EWhen I get home I\u0027ll try out \u003C/span\u003E\u003Cspan style=\u0022color:#333333;\u0022\u003EonPartJointBreak, and \u003C/span\u003E\u003Cspan style=\u0022color:#333333;\u0022\u003EonVesselCreate. Can I ask what the \u0027normal\u0027 intention of onPartJoinBreak is? Struts snapping, parts cracking off others?\u003C/span\u003E\u003C/p\u003E\u003Cp\u003E\u003Cspan style=\u0022color:#333333;\u0022\u003ERegardless, thanks for the suggestion :-)\u003C/span\u003E\u003C/p\u003E\n"},{"CreatedByName":"blowfish","CreatedById":119688,"CreatedDateTime":"2015-10-28T18:59:04Z","Content":"\n\u003Cblockquote data-ipsquote=\u0022\u0022 class=\u0022ipsQuote\u0022 data-ipsquote-username=\u0022SixHourDays\u0022 data-cite=\u0022SixHourDays\u0022\u003E\u003Cdiv\u003EStruts snapping, parts cracking off others?\u003C/div\u003E\u003C/blockquote\u003E\u003Cp\u003EI believe it\u0027s any time a joint between two parts breaks. Parts breaking off and struts snapping should qualify, decouple and undock events should as well.\u003C/p\u003E\n"},{"CreatedByName":"SixHourDays","CreatedById":140711,"CreatedDateTime":"2015-10-28T20:06:58Z","Content":"\n\u003Cp\u003EA side thought: in the VAB, you can attach any part to a docking port, and then undocking in game is a one way trip, releasing that stack permanently, and exposing the docking port for normal use. I wonder if that\u0027s the reasoning for this: easier to assume anything attached to the docking port is just a normal part being discarded, even if that part happens to be another docking port, appearing to be docked.\u003C/p\u003E\n"},{"CreatedByName":"SixHourDays","CreatedById":140711,"CreatedDateTime":"2015-10-28T22:45:25Z","Content":"\n\u003Cp\u003EYou were right! OnPartJointBreak fires even for the VAB dockingport undock case, first time, and every time after. Thank you. I\u0027ll edit the main post to answered.\u003C/p\u003E\n"}]}