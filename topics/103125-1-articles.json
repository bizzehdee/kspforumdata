{"TopicId":103125,"ForumId":29,"TopicTitle":"How to get science experiments use resources ? And restrict their execution to duna?","CreatedByName":"ManuxKerb","CreatedById":139441,"CreatedDateTime":"2015-04-01T09:50:56Z","PageNum":1,"Articles":[{"CreatedByName":"ManuxKerb","CreatedById":139441,"CreatedDateTime":"2015-04-01T09:50:56Z","Content":"Hi fellow KSP players and enhanchers :-)\n\nI recently got into modding, to replace some textures. Things grew and i now work on my own science experiment.\n\nHowever i now have some questions:\n\n1. How do i make the experiment use resources by execution (press of the button) like elctrical charge, or others, and how to detect if enough of this resource is there, if not dont execute the exeriment. For now nothing has worked i tried. (like putting RESOURCES into the Sciene Module)\n\n2. How can i restrict a experiment that it only is carried out for eg. on Dunas surface in all Duna Biomes ? Like how to know that the landed surface is duna?\n\n3. Is it possible to detect in what part the sciene part is attached ? Like, the part is attached a a Propulsion part or Structural Part?\n\nThanks for your help!\n\nManuxKerb\n\n**Edited \u003Ctime datetime=\u00222015-04-01T10:45:04Z\u0022 title=\u002204/01/2015 10:45  AM\u0022 data-short=\u00229 yr\u0022\u003EApril 1, 2015\u003C/time\u003E by ManuxKerb**\n  \nneed help!"},{"CreatedByName":"DMagic","CreatedById":57416,"CreatedDateTime":"2015-04-01T14:52:17Z","Content":"You can do all of these things, but it will require a new part module.\n\nYou can find the bit about using resources here: [https://github.com/DMagic1/Orbital-Science/blob/master/Source/Part%20Modules/DMModuleScienceAnimate.cs#L214-L224](https://github.com/DMagic1/Orbital-Science/blob/master/Source/Part%20Modules/DMModuleScienceAnimate.cs#L214-L224), it\u0027s just a matter of activating that when your experiment gets turned on.\n\nThe others are also pretty simple, but require dedicated code. There are a few solar observation experiments that only allow for data collection while in orbit around the sun, those should give you an idea of how to handle being restricted to a certain planet/situation."},{"CreatedByName":"ManuxKerb","CreatedById":139441,"CreatedDateTime":"2015-04-01T15:27:03Z","Content":"\u003E \n\u003E You can do all of these things, but it will require a new part module.\n\u003E You can find the bit about using resources here: [https://github.com/DMagic1/Orbital-Science/blob/master/Source/Part%20Modules/DMModuleScienceAnimate.cs#L214-L224](https://github.com/DMagic1/Orbital-Science/blob/master/Source/Part%20Modules/DMModuleScienceAnimate.cs#L214-L224), it\u0027s just a matter of activating that when your experiment gets turned on.\n\u003E \n\u003E The others are also pretty simple, but require dedicated code. There are a few solar observation experiments that only allow for data collection while in orbit around the sun, those should give you an idea of how to handle being restricted to a certain planet/situation.\n\nHello dmagic, \n\nThanks for answering. I already have a science part. What do you mean with part module? Do you mean like a sub in the module? \n\nI will try to use your animate module when I get back home. \n\nDoes it work with Karbonite as a Ressource? I want to make a science part that uses karbonite as a resource.\n\nDo I need to code in c# for the restriction to one planet? I never did that before Or can it be achieved only in the science part?\n\nI assume that I would need to code in c# for the structural part detection right? \n\nAlso i saw in your DMModuleScienceAnimateGeneric there is a planetaryMask = 524287. Could you provide a bit more insight how the bitmask represents every planet ?\n\nI have no animation for my part. So i tried it without it, but i get an exception:\n\n\u003E \n\u003E [LOG 21:45:48.488] ScienceAlert, Experiment ProbeAlive22@KerbinSrfLanded just became available! Total potential science onboard currently: 0 (Cap is 151.2, threshold is Unresearched, current sci is 0, expected next report value: 0.63)\n\u003E \n\u003E [EXC 21:46:57.625] MissingFieldException: Field \u0027.CelestialBody.BiomeMap\u0027 not found.\n\u003E \n\u003E  DMModuleScienceAnimateGeneric.DMModuleScienceAnimateGeneric.makeScience ()\n\u003E \n\u003E  DMModuleScienceAnimateGeneric.DMModuleScienceAnimateGeneric.runExperiment ()\n\u003E \n\u003E  DMModuleScienceAnimateGeneric.DMModuleScienceAnimateGeneric\u002B\u003Cwaitforanimation\u003Ed__3.MoveNext ()\u003C/waitforanimation\u003E\n\u003E \n\u003E [ERR 21:48:15.526] ScienceAlert, Failed to invoke \u0022DeployExperiment\u0022 using GetType(), falling back to base type after encountering exception System.Reflection.TargetInvocationException: Exception has been thrown by the target of an invocation. ---\u003E System.NullReferenceException: Object reference not set to an instance of an object\n\u003E \n\u003E  at DMModuleScienceAnimateGeneric.DMModuleScienceAnimateGeneric.canConduct () [0x00000] in \u003Cfilename unknown=\u0022\u0022\u003E:0 \u003C/filename\u003E\n\u003E \n\u003E  at DMModuleScienceAnimateGeneric.DMModuleScienceAnimateGeneric.DeployExperiment () [0x00000] in \u003Cfilename unknown=\u0022\u0022\u003E:0 \u003C/filename\u003E\n\u003E \n\u003E  at (wrapper managed-to-native) System.Reflection.MonoMethod:InternalInvoke (object,object[],System.Exception\u0026)\n\u003E \n\u003E  at System.Reflection.MonoMethod.Invoke (System.Object obj, BindingFlags invokeAttr, System.Reflection.Binder binder, System.Object[] parameters, System.Globalization.CultureInfo culture) [0x00000] in \u003Cfilename unknown=\u0022\u0022\u003E:0 \u003C/filename\u003E\n\u003E \n\u003E  --- End of inner exception stack trace ---\n\u003E \n\u003E  at System.Reflection.MonoMethod.Invoke (System.Object obj, BindingFlags invokeAttr, System.Reflection.Binder binder, System.Object[] parameters, System.Globalization.CultureInfo culture) [0x00000] in \u003Cfilename unknown=\u0022\u0022\u003E:0 \u003C/filename\u003E\n\u003E \n\u003E  at System.MonoType.InvokeMember (System.String name, BindingFlags invokeAttr, System.Reflection.Binder binder, System.Object target, System.Object[] args, System.Reflection.ParameterModifier[] modifiers, System.Globalization.CultureInfo culture, System.String[] namedParameters) [0x00000] in \u003Cfilename unknown=\u0022\u0022\u003E:0 \u003C/filename\u003E\n\u003E \n\u003E  at System.Type.InvokeMember (System.String name, BindingFlags invokeAttr, System.Reflection.Binder binder, System.Object target, System.Object[] args) [0x00000] in \u003Cfilename unknown=\u0022\u0022\u003E:0 \u003C/filename\u003E\n\u003E \n\u003E  at ScienceAlert.Experiments.Observers.ExperimentObserver.Deploy () [0x00000] in \u003Cfilename unknown=\u0022\u0022\u003E:0 \u003C/filename\u003E\n\u003E \n\u003E [LOG 21:48:15.526] [Experiments]: Setting FX Modules to 1...\n\u003E \n\u003E [LOG 21:48:15.526] [Experiments]: FX Modules set: 1\n\u003E \n\u003E [EXC 21:48:27.252] NullReferenceException: Object reference not set to an instance of an object\n\u003E \n\u003E  DMModuleScienceAnimateGeneric.DMModuleScienceAnimateGeneric.canConduct ()\n\u003E \n\u003E  DMModuleScienceAnimateGeneric.DMModuleScienceAnimateGeneric.DeployExperiment ()\n\u003E \n\u003E  BaseEvent.Invoke ()\n\u003E \n\u003E  UIPartActionButton.OnClick ()\n\u003E \n\u003E [EXC 21:48:31.133] NullReferenceException: Object reference not set to an instance of an object\n\u003E \n\u003E  DMModuleScienceAnimateGeneric.DMModuleScienceAnimateGeneric.canConduct ()\n\u003E \n\u003E  DMModuleScienceAnimateGeneric.DMModuleScienceAnimateGeneric.DeployExperiment ()\n\u003E \n\u003E  BaseEvent.Invoke ()\n\u003E \n\u003E  UIPartActionButton.OnClick ()\n\u003E \n\u003E [EXC 21:48:38.474] MissingFieldException: Field \u0027.CelestialBody.BiomeMap\u0027 not found.\n\u003E \n\u003E  DMModuleScienceAnimateGeneric.DMModuleScienceAnimateGeneric.makeScience ()\n\u003E \n\u003E  DMModuleScienceAnimateGeneric.DMModuleScienceAnimateGeneric.runExperiment ()\n\u003E \n\u003E  DMModuleScienceAnimateGeneric.DMModuleScienceAnimateGeneric\u002B\u003Cwaitforanimation\u003Ed__3.MoveNext ()\u003C/waitforanimation\u003E\n\nI tried to copy from [Real Simple Science](https://forum.kerbalspaceprogram.com/threads/77555), then there is no error, but then the \u0022science collect\u0022 box does not appear :-( So something seems to be wrong there as well and makes it useless...\n\nThanks again\n\n**Edited \u003Ctime datetime=\u00222015-04-01T20:03:26Z\u0022 title=\u002204/01/2015 08:03  PM\u0022 data-short=\u00229 yr\u0022\u003EApril 1, 2015\u003C/time\u003E by ManuxKerb**"},{"CreatedByName":"ManuxKerb","CreatedById":139441,"CreatedDateTime":"2015-04-01T21:31:24Z","Content":"Hello\n\nI wanted to post an update.\n\nI found a solution to the restriction to one planet thing, but my c# skills are non existent so i will test this before i post the solution here.\n\nI fixed the Nullpointer Exeption by adding the binomes and sit. things into the module but it did not work. See below\n\nAs for the resource use of the experiment, i was not able to implement that. As it seems that your plugin needs a animation to work correctly. As i don\u0027t have one, (i think an empty one who does nothing would be sufficent tho ??) and i don\u0027t plan to create one it would be good to get some more help here. It is just a simple part like the thermometer.\n\nAs stated above i tried to use the example from Real Simple Sciene and it worked in that way that it is indeed using el. Charge, but as the original after using the charge it does not display the science Information window. So you can\u0027t collect the science and it is kind of useless... \n\nThanks\n\nManuxKerb\n\n**Edited \u003Ctime datetime=\u00222015-04-01T21:34:21Z\u0022 title=\u002204/01/2015 09:34  PM\u0022 data-short=\u00229 yr\u0022\u003EApril 1, 2015\u003C/time\u003E by ManuxKerb**"},{"CreatedByName":"ManuxKerb","CreatedById":139441,"CreatedDateTime":"2015-04-02T16:49:06Z","Content":"Hello guys,\n\nAs it turns out, i propably used an old DMModuleScienceAnimateGeneric.dll (from dec 2014) and the source in github might have fixed the problem with the animation. However i stuck at compiling it. As i dont use Vidual Studio (Linux :-)) the project file is of no help...\n\nAs i dont even know the compile order i tried this one:\n\n\u003E \n\u003E kspComp Properties/AssemblyInfo.cs (worked)\n\u003E kspComp /r: Properties/AssemblyInfo.dll DMAsteroidScienceGen.cs (worked)\n\u003E \n\u003E kspComp /r: Properties/AssemblyInfo.dll /r:MAsteroidScienceGen.dll DMPlanetaryIndicesGen.cs\n\u003E \n\u003E DMPlanetaryIndicesGen.cs(112,34): error CS0103: The name \u0060DMAsteroidScienceGen\u0027 does not exist in the current context\n\u003E \n\u003E Compilation failed: 1 error(s), 0 warnings\n\nSo i dont know how to fix this. Any ideas from the coders around here ?\n\nMany thanks!\n\nManuxKerb\n\n**Edited \u003Ctime datetime=\u00222015-04-02T17:07:10Z\u0022 title=\u002204/02/2015 05:07  PM\u0022 data-short=\u00229 yr\u0022\u003EApril 2, 2015\u003C/time\u003E by ManuxKerb**"},{"CreatedByName":"DMagic","CreatedById":57416,"CreatedDateTime":"2015-04-02T19:35:23Z","Content":"There\u0027s no need to recompile the code as it is, there is already an [thread=72466]updated version available[/thread]. \n\nIf you want to make changes to that and your still having problems compiling it then I\u0027ll need to see your code.\n\nAlso, check this post for some instructions on resource usage with and without animations.\n\n**Edited \u003Ctime datetime=\u00222015-04-02T19:38:35Z\u0022 title=\u002204/02/2015 07:38  PM\u0022 data-short=\u00229 yr\u0022\u003EApril 2, 2015\u003C/time\u003E by DMagic**"},{"CreatedByName":"ManuxKerb","CreatedById":139441,"CreatedDateTime":"2015-04-02T19:40:34Z","Content":"Hello Dmagic.\n\nThanks for helping :-)\n\nOk i will try the updated version. As decribed, i did not code any c# code for the science part who uses only energy. I did only build a part.cfg file for my part and it worked that it would drain resources but did not show the science collect window afterward. I guess it is waiting for the animation.\n\nIf it does not work, i will post my part file here. :-)\n\nGreetings"},{"CreatedByName":"ManuxKerb","CreatedById":139441,"CreatedDateTime":"2015-04-02T23:26:28Z","Content":"Hello Dmagic.\n\nI tried it with the new dll. Same result. Energy is drained but there is no science window popping up to collect the science.\n\nHere is my code:\n\n\u003E \n\u003E PART\n\u003E \n\u003E {\n\u003E \n\u003E name = sensorBeep\n\u003E \n\u003E module = Part\n\u003E \n\u003E author = MKerb\n\u003E \n\u003E mesh = model.mu\n\u003E \n\u003E texture = sensorBeep256.png\n\u003E \n\u003E scale = 1\n\u003E \n\u003E rescaleFactor = 1.0\n\u003E \n\u003E node\\_stack\\_bottom = 0.0, -0.6, 0.0, 0.0, 1.0, 0.0, 0\n\u003E \n\u003E node\\_stack\\_top = 0.0, 0.6, 0.0, 0.0, 1.0, 0.0, 0\n\u003E \n\u003E TechRequired = advScienceTech\n\u003E \n\u003E entryCost = 14000\n\u003E \n\u003E cost = 4500\n\u003E \n\u003E category = Science\n\u003E \n\u003E subcategory = 0\n\u003E \n\u003E title = A.B.S. device\n\u003E \n\u003E manufacturer = DMagic Orbital Science\n\u003E \n\u003E description = This orbital sensor deploys a large L-band microwave detector comprised of 82 individual antenna elements. It can be used to study the water content of the upper soil layers and the salinity levels of large water features. Can only be used in low orbit.\n\u003E \n\u003E attachRules = 1,0,1,1,0\n\u003E \n\u003E // --- standard part parameters ---\n\u003E \n\u003E mass = 0.05\n\u003E \n\u003E dragModelType = default\n\u003E \n\u003E maximum\\_drag = 0.2\n\u003E \n\u003E minimum\\_drag = 0.2\n\u003E \n\u003E angularDrag = 2\n\u003E \n\u003E crashTolerance = 7\n\u003E \n\u003E maxTemp = 3000\n\u003E \n\u003E MODULE\n\u003E \n\u003E {\n\u003E \n\u003E  name = DMModuleScienceAnimateGeneric\n\u003E \n\u003E  customFailMessage = Can\u0027t be testet right now, some temp. glitch.\n\u003E \n\u003E  animSpeed = 1\n\u003E \n\u003E  experimentAnimation = false \n\u003E \n\u003E  experimentWaitForAnimation = false \n\u003E \n\u003E  waitForAnimationTime = 1\n\u003E \n\u003E  keepDeployedMode = 2\n\u003E \n\u003E  startEventGUIName = Deploy Array\n\u003E \n\u003E  showStartEvent = false\n\u003E \n\u003E  endEventGUIName = Retract Array\n\u003E \n\u003E  showEndEvent = false\n\u003E \n\u003E  showEditorEvents = true\n\u003E \n\u003E  showToggleEvent = false\n\u003E \n\u003E  toggleEventGUIName = Toggle Array\n\u003E \n\u003E  experimentID = ProbeAlive22\n\u003E \n\u003E  sitMask = 63\n\u003E \n\u003E  bioMask = 63\n\u003E \n\u003E  experimentLimit = 1\n\u003E \n\u003E  xmitDataScalar = 1\n\u003E \n\u003E  experimentActionName = Test ALIVE device\n\u003E \n\u003E  deployingMessage = Beep Beep TT ... \n\u003E \n\u003E  resourceExperiment = ElectricCharge \n\u003E \n\u003E  resourceExpCost = 10\n\u003E \n\u003E  useStaging = False \n\u003E \n\u003E  useActionGroups = True\n\u003E \n\u003E  hideUIwhenUnavailable = True\n\u003E \n\u003E  rerunnable = True\n\u003E \n\u003E  dataIsCollectable = True\n\u003E \n\u003E  collectActionName = Collect Data\n\u003E \n\u003E  interactionRange = 1.2\n\u003E \n\u003E  externalDeploy = True\n\u003E \n\u003E  asteroidReports = True\n\u003E \n\u003E  asteroidTypeDependent = True\n\u003E \n\u003E  xmitDataScalar = 0.94\n\u003E \n\u003E }\n\u003E \n\u003E }\n\nthe model.mu is just the model from the stock gravimax.\n\nSensorBeep256.png is just another texture.\n\nThe DMagic Science Animate.dll is in the DMagic Science Animate/ folder of the gamedata.\n\nAlso i noted, that the last modified date of the new dll is still June 2014.\n\nthanks for looking into this :-)\n\nHave a nice easter"},{"CreatedByName":"DMagic","CreatedById":57416,"CreatedDateTime":"2015-04-03T17:29:43Z","Content":"Don\u0027t copy the config from a DMOS part, the modules are different and have different fields. Use the template provided in the DM Module Science Animate thread.\n\nIf the dll says that it hasn\u0027t been modified since 2014 then you still have the old version. Completely delete it and download the latest version from the GitHub release."}]}