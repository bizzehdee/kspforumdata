{"TopicId":193082,"ForumId":32,"TopicTitle":"Coordinate System","CreatedByName":"arthur106","CreatedById":203096,"CreatedDateTime":"2020-04-12T10:29:14Z","PageNum":1,"Articles":[{"CreatedByName":"arthur106","CreatedById":203096,"CreatedDateTime":"2020-04-12T10:29:14Z","Content":"\n\u003Cp\u003E\nI\u0027ve been playing around with kos and have started running into some issues with the coordinate system, specifically the locations of the x and z axes.\u00A0 I would like to be able to determine my ship\u0027s position in a coordinate system that is centered about kerbin\u0027s \u003Cabbr title=\u0022Center of Mass\u0022\u003ECoM\u003C/abbr\u003E and use this vector along with other inputs to more precisely control my craft on its ascent.\u00A0 My current program works OK but vastly simplifies things; working with vectors would greatly expand my capabilities.\n\u003C/p\u003E\n\u003Cp\u003E\nThe problem is that I can\u0027t find any rhyme or reason to the orientation of the x and z axes.\u00A0 When I first logged in, i plotted my position with \u0022print -kerbin:position\u0022 and got an interesting result.\u00A0 I had expected that one of the axes would pass through the prime meridian.\u00A0 What I found is that the x axis passed through 0N 10.791321E.\u00A0 Odd as this is, it would be doable so long as it remains fixed exactly there.\u00A0 When I logged back in later, I realized I was getting funny results.\u00A0 Turns out the x axis was located at 0N ~20E.\u00A0 What I\u0027ve found is every time I start a new flight, the x and z axes move to a new, random location.\u00A0 I haven\u0027t done enough testing to see if they move during a flight, but they certainly do every time I start a new one.\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027ve read the documentation on kos and even it says \u003Cspan style=\u0022font-size:12px;\u0022\u003E\u0022\u003Cspan style=\u0022background-color:rgb(252,252,252);color:rgb(64,64,64);\u0022\u003EHowever, it\u2019s hard to predict exactly where the X and Z axes will be. They keep moving depending on where you are, to the point where it\u2019s impossible to get a fix on just which direction they\u2019ll point.\u0022\u003C/span\u003E\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cstrong\u003ECan anyone shed some light on this?\u003C/strong\u003E\u00A0 Worst case scenario, I can get clever and come up with a work-around to find my coordinates, but I\u0027d rather not fool with unnecessary vector addition/rotations just to simply get my position.\n\u003C/p\u003E\n"},{"CreatedByName":"Xyphos","CreatedById":139010,"CreatedDateTime":"2020-04-13T04:08:51Z","Content":"\n\u003Cp\u003E\nx is horizontal (left \u0026amp; right)\u003Cbr\u003E\ny is vertical, height, altitude, etc.\u003Cbr\u003E\nz is depth, distance, etc\n\u003C/p\u003E\n"},{"CreatedByName":"Rhomphaia","CreatedById":2440,"CreatedDateTime":"2020-04-13T04:36:42Z","Content":"\n\u003Cp\u003E\nnot really in my wheelhouse, but from what i can understand, it seems like the axes will always be parallel to those of the arbitrary reference frame.\u00A0 since planets rotate and orbit this will cause the drift you see.\n\u003C/p\u003E\n"},{"CreatedByName":"Laie","CreatedById":110461,"CreatedDateTime":"2020-04-13T08:47:31Z","Content":"\n\u003Cp\u003E\nI\u0027m not all that familiar with kOS, but the first thing that comes to mind: are you perhaps in a reference frame where X points to a certain position along the celestial equator, while Kerbin rotates underneath it?\n\u003C/p\u003E\n\u003Cp\u003E\nThat should be easy to check for: will the value of 10.791321E change over the course of a few seconds/minutes?\n\u003C/p\u003E\n"},{"CreatedByName":"arthur106","CreatedById":203096,"CreatedDateTime":"2020-04-14T08:06:32Z","Content":"\n\u003Cp\u003E\nThanks for the responses.\u00A0 I\u0027ve been looking into this and here\u0027s what I\u0027ve found:\n\u003C/p\u003E\n\u003Cp\u003E\nOnce set, the orientation of the X and Z axes in relation to Kerbin remains stationary...kind of.\u00A0 The problem is that they\u00A0can start moving again if you change your focus (go back to \u003Cabbr title=\u0022Kerbal Space Center\u0022\u003EKSC\u003C/abbr\u003E or focus on another craft).\u00A0 I tested this by launching a craft and printing its coordinates at several time intervals while on the pad; they didn\u0027t move at all.\u00A0 I then went back to \u003Cabbr title=\u0022Kerbal Space Center\u0022\u003EKSC\u003C/abbr\u003E for a few minutes and re-launched my craft.\u00A0 When I returned and printed the coordinates again, they were different.\u00A0 I did the same test, but switched focus to a probe orbiting Eve for a while; when i returned focus to my craft on the launchpad, the coordinates had drifted.\u00A0 In this test, I measured the coordinates and mission time both times so I could find the rotation rate.\u00A0 The coordinates were [537282.21 -973.52 267226.53] and then [540072.76 -973.52\u00A0261540.82] ~36 seconds later.\u00A0 If you do the math on this, the coordinate system is rotating 360deg/kerbin day.\u00A0 \u003Cstrong\u003EThe weird thing is that I moved WEST!\u003C/strong\u003E\u00A0 This is backwards from my intuition.\u00A0 If the coordinate system were to suddenly \u0022freeze\u0022 when I switch focus while the planet continues to\u00A0rotate\u00A0around it, the I should be moving East.\u00A0\u00A0\u003Cstrong\u003EKeep in mind that KSP has a left-handed coordinate system\u003C/strong\u003E--it\u0027s worth me mentioning this before anyone \u0022reminds\u0022 me\u00A0\u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u00A0 It\u0027s late and I\u0027m tired, so maybe I\u0027m hallucinating, but could someone check me on that?\u00A0 It IS weird, right?\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027ve read somewhere that under certain conditions, the game calculates physics as if your focus\u00A0planet/moon is stationary and everything around it is moving (i.e. sun orbits around earth).\u00A0 I\u0027m not sure at the moment how to test this..\n\u003C/p\u003E\n\u003Cp\u003E\nMy temporary (or maybe permanent) solution:\n\u003C/p\u003E\n\u003Cp\u003E\nWhen my ship boots up, I\u00A0load\u00A0a position initialization program.\u00A0 One of the KOS functions lets you draw a vector from your present position to any point on the planet\u0027s surface based on latitude and longitude.\u00A0 You can also find the vector from your present position to the planet\u0027s center.\u00A0 All of these are in terms of the \u0022arbitrary\u0022 coordinate system\u00A0 In this \u0022arbitrary\u0022 coordinate system, I\u00A0calculate vectors representing \u0022Standard\u0022 X Y Z axes by performing vector subtraction (X axis = Vector to LatLon(0,-90) - Vector to center of planet).\u00A0 Once I normalize each of these vectors, I\u00A0have unit vectors representing \u0022standard\u0022 XYZ in terms of \u0022arbitrary\u0022 coordinates and\u00A0I can then calculate a rotation matrix to go from \u0022arbitrary\u0022 to \u0022standard\u0022.\u00A0 I proceed to fly my mission normally, using and logging the \u0022arbitrary\u0022 coordinates.\u00A0 My telemetry log is set up to paste directly into MatLab where the rotation matrix is used to convert everything into the \u0022standard\u0022 coordinates.\u00A0 If I\u0027m creating a flight plan in matlab to be loaded onto my ship, the math is done in terms of \u0022standard\u0022 coordinates, loaded onto the ship, and then converted to the current \u0022arbitrary\u0022 coordinates using the inverse of the aforementioned rotation matrix.\u00A0 Unfortunately, using the KOS CPU for vector algebra is very very slow; I can\u0027t find a way around this, however, as I don\u0027t know the inverse rotation matrix until I\u0027ve loaded my ship on the launch pad and performed the position initialization.\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027ll be posting my code on another thread in the near future to ask for some suggestions to make it run quicker.\u00A0 Just thought I\u0027d give ya\u0027ll a heads up \u003Cimg alt=\u0022;)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif\u0022 title=\u0022;)\u0022\u003E\u003C/p\u003E\n"},{"CreatedByName":"CBase","CreatedById":189476,"CreatedDateTime":"2020-04-14T10:42:05Z","Content":"\n\u003Cp\u003E\nI do not know about kOS, but coming from Addon coding, the KSP coordinate system is strange.\n\u003C/p\u003E\n\u003Cp\u003E\nProbably for historic reason rockets in KSP do fly UP, not Forward by the Unity definitions. However Planes and Rockets in Orbit still fly UP to be consistent, not forward. \u003Cimg alt=\u0022:confused:\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_huh.gif\u0022 title=\u0022:confused:\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nSome Addons tried to \u0022fix\u0022 this by swapping Y and Z components, but every time they exchange with KSP code of course they need to use KSP conventions, so they can only be partially consistent. \u003Cimg alt=\u0022:sticktongue:\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_tongue2.gif\u0022 title=\u0022:sticktongue:\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nReference Frames is another Topic: Rockets fly around Moons, which fly around Planets, which circle Kerbol and all of these Bodies rotate. And intersolar suns move in a galaxy and galaxys around....\n\u003C/p\u003E\n\u003Cp\u003E\nSeriously: Get comfortable to always think in terms of a reference. There is no \u0022right\u0022 coordinate system and even if you define any as this, movement equations would be too complicated, so just get the reference right. Oh and one caveat about rotating coordinate systems: If you do calculate the movement equations when changing from one to the other\u00A0\u00A0\u003Ca href=\u0022https://en.wikipedia.org/wiki/Coriolis_force\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://en.wikipedia.org/wiki/Coriolis_force\u003C/a\u003E and\u00A0\u003Ca href=\u0022https://en.wikipedia.org/wiki/Centrifugal_force\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://en.wikipedia.org/wiki/Centrifugal_force\u003C/a\u003E appear. They are small enough to be neglected if you fly around Kerbin and think about the Kerbol rotation once a year. However they get way bigger if you transfer into the rotating Kerbin system and to get fixed Latitude / Longitude. So better keep bodies rotating and just stay in a center of momentum frame.\n\u003C/p\u003E\n\u003Cp\u003E\nFinally one advice: There are already tons of conversion systems, try to find a solution before solving something yourself: Unity has Quaternions and Transforms, KSP has Transforms and CelestialFrames. These are battle proven, handling corner conditions etc. Your life will be easier with finding the right reference transformation than coding it yourself. Since KSP is already pretty mature, someone will have had the same problem before and there is propably a solution out there. Somewhere.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222020-04-14T10:54:19Z\u0022 title=\u002204/14/2020 10:54  AM\u0022 data-short=\u00224 yr\u0022\u003EApril 14, 2020\u003C/time\u003E by CBase\u003C/strong\u003E\n\u003Cbr\u003EAdded some information about rotating frames\n\u003C/span\u003E\n"},{"CreatedByName":"arthur106","CreatedById":203096,"CreatedDateTime":"2020-04-15T05:29:36Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223770688\u0022 data-ipsquote-contentid=\u0022193082\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221586860925\u0022 data-ipsquote-userid=\u0022189476\u0022 data-ipsquote-username=\u0022CBase\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n18 hours ago, CBase said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nFinally one advice: There are already tons of conversion systems, try to find a solution before solving something yourself: Unity has Quaternions and Transforms, KSP has Transforms and CelestialFrames. These are battle proven, handling corner conditions etc. Your life will be easier with finding the right reference transformation than coding it yourself. Since KSP is already pretty mature, someone will have had the same problem before and there is propably a solution out there. Somewhere.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nI haven\u0027t found anything yet, but as you say, I would be surprised if someone hasn\u0027t already dealt with this.\u00A0 It seems too elementary of a problem for no one to have touched yet.\u00A0 In the meantime, this little \u0022project\u0022 is a great way of distracting me from the whole Wuhan Virus situation.. Using the method outlined above, I\u0027ve managed to make things work out quite nicely and even managed to speed up the maths performed in the kOS CPU by a factor of 5 by streamlining a few of my user-functions.\u00A0 It can crunch through the entire ascent profile (data covering about 6 minutes of flight) in about 40 seconds now.\u00A0 Not great, but it will do.\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nQuote\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\n\u003Cspan style=\u0022background-color:#ffffff;color:#353c41;font-size:14px;\u0022\u003E\u003Cspan\u003E\u00A0\u003C/span\u003EOh and one caveat about rotating coordinate systems: If you do calculate the movement equations when changing from one to the other\u00A0\u00A0\u003C/span\u003E\u003Ca href=\u0022https://en.wikipedia.org/wiki/Coriolis_force\u0022 rel=\u0022external nofollow\u0022 style=\u0022background-color:#ffffff;color:#3d6594;font-size:14px;\u0022\u003Ehttps://en.wikipedia.org/wiki/Coriolis_force\u003C/a\u003E\u003Cspan style=\u0022background-color:#ffffff;color:#353c41;font-size:14px;\u0022\u003E\u003Cspan\u003E\u00A0\u003C/span\u003Eand\u00A0\u003C/span\u003E\u003Ca href=\u0022https://en.wikipedia.org/wiki/Centrifugal_force\u0022 rel=\u0022external nofollow\u0022 style=\u0022background-color:#ffffff;color:#3d6594;font-size:14px;\u0022\u003Ehttps://en.wikipedia.org/wiki/Centrifugal_force\u003C/a\u003E\u003Cspan style=\u0022background-color:#ffffff;color:#353c41;font-size:14px;\u0022\u003E\u003Cspan\u003E\u00A0\u003C/span\u003Eappear\u003C/span\u003E\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nYes sir!...(or ma\u0027am...)\u00A0 That\u0027s the whole reason behind this.\u00A0 I\u0027m trying to take the coordinates from kOS and transform them into a non-rotating coordinate system in MatLab that I can do some math in.\u00A0 Likewise, when I use MatLab to create an ascent profile, I need to convert it to coordinates that correspond to ksp\u0027s.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222020-04-15T05:30:04Z\u0022 title=\u002204/15/2020 05:30  AM\u0022 data-short=\u00224 yr\u0022\u003EApril 15, 2020\u003C/time\u003E by arthur106\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"CBase","CreatedById":189476,"CreatedDateTime":"2020-04-15T06:57:12Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223771089\u0022 data-ipsquote-contentid=\u0022193082\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221586928576\u0022 data-ipsquote-userid=\u0022203096\u0022 data-ipsquote-username=\u0022arthur106\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n1 hour ago, arthur106 said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nYes sir!\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nUps sorry, I didn\u0027t intent to sound like a teacher \u003Cimg alt=\u0022:sealed:\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_lipssealed.gif\u0022 title=\u0022:sealed:\u0022\u003E. Just as you were suprised that a coordinate of Kerbin changed gave me the impression that you expected that it is constant. Actually I do think once you change to a vessel or the vessel changes \u003Cabbr title=\u0022Sphere of Influence\u0022\u003ESOI\u003C/abbr\u003E, the frame is choosen by some comfortable transformation and then simply stays as it is.\n\u003C/p\u003E\n"},{"CreatedByName":"arthur106","CreatedById":203096,"CreatedDateTime":"2020-04-15T23:57:31Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223771110\u0022 data-ipsquote-contentid=\u0022193082\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221586933832\u0022 data-ipsquote-userid=\u0022189476\u0022 data-ipsquote-username=\u0022CBase\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n16 hours ago, CBase said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nUps sorry, I didn\u0027t intent to sound like a teacher \u003Cimg alt=\u0022:sealed:\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_lipssealed.gif\u0022 title=\u0022:sealed:\u0022\u003E. Just as you were suprised that a coordinate of Kerbin changed gave me the impression that you expected that it is constant. Actually I do think once you change to a vessel or the vessel changes \u003Cabbr title=\u0022Sphere of Influence\u0022\u003ESOI\u003C/abbr\u003E, the frame is choosen by some comfortable transformation and then simply stays as it is.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nNo worries.\u00A0 I\u0027m wrong more often than right and just don\u0027t know it.\u00A0 Won\u0027t turn down free advice or info ever.\u00A0\u00A0\u003Cspan\u003E\u003Cspan\u003E\u003Cimg alt=\u0022:)\u0022 data-emoticon=\u0022\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_smiley.gif\u0022 title=\u0022:)\u0022\u003E\u003C/span\u003E\u003C/span\u003E\n\u003C/p\u003E\n"}]}