{"TopicId":177646,"ForumId":29,"TopicTitle":"[Solved] Removing ModuleGimbal lag in 1.4.5","CreatedByName":"Boris-Barboris","CreatedById":133181,"CreatedDateTime":"2018-08-18T14:28:31Z","PageNum":1,"Articles":[{"CreatedByName":"Boris-Barboris","CreatedById":133181,"CreatedDateTime":"2018-08-18T14:28:31Z","Content":"\n\u003Cp\u003E\nGentlemen, my old nemesis is haunting me again after a couple of KSP patches.\n\u003C/p\u003E\n\u003Cp\u003E\nModuleGimbal was tap-delayed in KSP at least as long as I can remember. That happens because it is a separate module and not part of the ModuleEngine(FX).\n\u003C/p\u003E\n\u003Cp\u003E\nStandard situation for engines: physx update -\u0026gt; user alters joystick position -\u0026gt; vessel control state updated -\u0026gt; engines FixedUpdate() (thrust applied) -\u0026gt; gimbal FixedUpdate() (here thrust is rotated, but it\u0027s too late, so it goes to the next frame) -\u0026gt; physx update\u003Cbr\u003E\nCompare it to control surfaces that do not suffer from this: physx update -\u0026gt; user alters joystick position -\u0026gt; vessel control state updated -\u0026gt; controlSurface FixedUpdate() that first reacts to control state and then applies aero forces -\u0026gt; physx update\n\u003C/p\u003E\n\u003Cp\u003E\nThanks to the advice of The One I circumvented this in previous versions of KSP by moving ModuleGimbal to the very beginning of part config node. This way gimbal\u0027s FixedUpdate was called before engine\u0027s. How exactly did that work is still unknown to me, but it worked.\n\u003C/p\u003E\n\u003Cp\u003E\nOld code that did reordering: \u003Ca href=\u0022https://github.com/Boris-Barboris/AtmosphereAutopilot/blob/master/AtmosphereAutopilot/GimbalRearranger.cs#L52\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/Boris-Barboris/AtmosphereAutopilot/blob/master/AtmosphereAutopilot/GimbalRearranger.cs#L52\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nNow it does not. Rearrangement of nodes does complete, but it is not reflected in the actual module instantiation order or module node order in save or craft files. I can only assume that the config I\u0027m modifying is no longer the source of truth.\n\u003C/p\u003E\n\u003Cp\u003E\nI am once again seeking public council. Remember that the end goal is to make ModuleGimbal FixedUpdate be called strictly before ModuleEngine. I would gladly throw config node manipulation out of the window if there is a more elegant way.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222018-08-18T21:47:24Z\u0022 title=\u002208/18/2018 09:47  PM\u0022 data-short=\u00225 yr\u0022\u003EAugust 18, 2018\u003C/time\u003E by Boris-Barboris\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"Boris-Barboris","CreatedById":133181,"CreatedDateTime":"2018-08-18T21:47:08Z","Content":"\n\u003Cp\u003E\nOk, solved it. DLC added new LoadingSystem - Expansions.ExpansionsLoader.\n\u003C/p\u003E\n\u003Cp\u003E\nThat\u0027s why I had to properly inject my loaders right before PartLoader, and not in the second from the tail position in loader list.\n\u003C/p\u003E\n"},{"CreatedByName":"FreeThinker","CreatedById":117389,"CreatedDateTime":"2018-09-21T12:59:02Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223436181\u0022 data-ipsquote-contentid=\u0022177646\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221534628828\u0022 data-ipsquote-userid=\u0022133181\u0022 data-ipsquote-username=\u0022Boris-Barboris\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\nOn 8/18/2018 at 11:47 PM, Boris-Barboris said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nOk, solved it. DLC added new LoadingSystem - Expansions.ExpansionsLoader.\n\u003C/p\u003E\n\u003Cp\u003E\nThat\u0027s why I had to properly inject my loaders right before PartLoader, and not in the second from the tail position in loader list.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nCould you please provide a link to the source code containing the fix?\n\u003C/p\u003E\n"},{"CreatedByName":"Boris-Barboris","CreatedById":133181,"CreatedDateTime":"2018-09-21T13:08:07Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00223455233\u0022 data-ipsquote-contentid=\u0022177646\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221537534742\u0022 data-ipsquote-userid=\u0022117389\u0022 data-ipsquote-username=\u0022FreeThinker\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n8 minutes ago, FreeThinker said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nCould you please provide a link to the source code containing the fix?\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://github.com/Boris-Barboris/AtmosphereAutopilot/commit/686c0bb18db6b474517b6394b4a2c15eca6f5f14#diff-575ab59de22989b9d040dace3c57e006\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://github.com/Boris-Barboris/AtmosphereAutopilot/commit/686c0bb18db6b474517b6394b4a2c15eca6f5f14#diff-575ab59de22989b9d040dace3c57e006\u003C/a\u003E\n\u003C/p\u003E\n"}]}