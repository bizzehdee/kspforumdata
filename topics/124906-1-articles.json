{"TopicId":124906,"ForumId":19,"TopicTitle":"Frage: kOS autolaunch script mit heading. Schon mal gemacht?","CreatedByName":"inoculator","CreatedById":141432,"CreatedDateTime":"2015-11-10T07:30:20Z","PageNum":1,"Articles":[{"CreatedByName":"inoculator","CreatedById":141432,"CreatedDateTime":"2015-11-10T07:30:20Z","Content":"\n\u003Cp\u003ETach zusammen,\u003C/p\u003E\u003Cp\u003Eich habe mal ganz grob durch das deutsche Forum gesucht, aber nichts Passendes gefunden und auch die englisch sprachigen Teile sind mir da nicht wirklich hilfreich.\u003C/p\u003E\u003Cp\u003EWie wahrscheinlich schon Tausende ;-) vor mir, versuche ich mich an kOS.\u003C/p\u003E\u003Cp\u003EIch habe ein Grundger\u00C3\u0192\u00C2\u00BCst f\u00C3\u0192\u00C2\u00BCr ein Autolaunch Script soweit erfolgreich fertig.\u003C/p\u003E\u003Cp\u003EEs \u00C3\u0192\u00C2\u00BCbernimmt die Geschwindigkeit in Relation zur H\u00C3\u0192\u00C2\u00B6he, kann unterschiedliche Orbith\u00C3\u0192\u00C2\u00B6hen anfliegen und zirkulieren, und das Staging ist ebenfalls dabei.\u003C/p\u003E\u003Cp\u003EAngefangen habe ich mit einem einfachen 90\u00C3\u201A\u00C2\u00B0 Script, welches nur \u00C3\u0192\u00C2\u00A4quatorial fliegt.\u003C/p\u003E\u003Cp\u003EDann kam eine Kopie des Scriptes f\u00C3\u0192\u00C2\u00BCr den polaren Orbit.\u003C/p\u003E\u003Cp\u003EJetzt m\u00C3\u0192\u00C2\u00B6chte ich diese Beiden vereinen und eine variable Lage des Orbits erm\u00C3\u0192\u00C2\u00B6glichen.\u003C/p\u003E\u003Cp\u003EAlso in etwa so:\u003C/p\u003E\u003Cp\u003E\u003C/p\u003E\u003Cdiv\u003E\u003C/div\u003E\u003Cpre class=\u0022ipsCode\u0022\u003Erun autolaunch(650000,56)\u003C/pre\u003E\u003Cp\u003E\u003C/p\u003E\u003Cp\u003EWas einen Orbit in 650km H\u00C3\u0192\u00C2\u00B6he und einer Neigung von 56\u00C3\u201A\u00C2\u00B0N relativ zum KSC (Startpunkt) bringen soll.\u003C/p\u003E\u003Cp\u003EUnd damit begannen meine Probleme.\u003C/p\u003E\u003Cp\u003EWer den Kompass im Verlaufe eines geneigten Orbits verfolgt, sieht, da\u00C3\u0192\u00C5\u00B8 sich das Heading dabei st\u00C3\u0192\u00C2\u00A4ndig \u00C3\u0192\u00C2\u00A4ndert.\u003C/p\u003E\u003Cp\u003EIch kann also im Verlaufe des Scriptes nicht von einem einmal festen Wert ausgehen, sondern muss das Heading dynamisch und permanent neu berechnen.\u003C/p\u003E\u003Cp\u003ENachdem ich mir dann auch ein paar Lekt\u00C3\u0192\u00C2\u00BCren zu Quaternionen angetan habe, komme ich dennoch keinen Schritt weiter.\u003C/p\u003E\u003Cp\u003EDie Dokumentation des Variablen und Vectoren zu diesem Thema ist grottenschlecht.\u003C/p\u003E\u003Cp\u003EIch hoffe einigerma\u00C3\u0192\u00C5\u00B8en verst\u00C3\u0192\u00C2\u00A4ndlich mein Problem beschrieben zu haben.\u003C/p\u003E\u003Cp\u003EWer kann mich hier mal in die richtige Richtung schubsen?\u003C/p\u003E\u003Cp\u003EGruss\u003C/p\u003E\u003Cp\u003ECarsten\u003C/p\u003E\n"},{"CreatedByName":"TJ179","CreatedById":147898,"CreatedDateTime":"2015-12-18T22:41:49Z","Content":"\n\u003Cp\u003E\nHey ich hab mir das mal eben angeschaut \u003Cimg alt=\u0022:D\u0022 data-emoticon=\u0022true\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_cheesy.gif\u0022 title=\u0022:D\u0022\u003E\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\neine relativ einfach M\u00F6glichkeit w\u00E4re ein Script schrieben was als erste mit den werten ein Orbit macht.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nHab mir das so \u00FCberlegt das du beim Start deiner Rakete eine Neigung vorgibst.\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nZ.B: LOCK STEERING TO HEADING(56,90).\n\u003C/p\u003E\n\u003Cp\u003E\nDie 90\u00B0 m\u00FCssen durch das Script immer wieder angepasst werden so das du dein Orbit ja schaffst.\n\u003C/p\u003E\n\u003Cp\u003E\nsomit bekommst du schonmal eine gew\u00FCnschte Richtung hin.\n\u003C/p\u003E\n\u003Cp\u003E\nbei mir waren es 30\u00B0 Inclination am ende. Wenn du deinen Orbit dann hast mit einer gewissen Neigung kannst du im nach gang schauen ob die Inclination der Flugbahn die 56\u00B0 hat oder nicht. Wenn nicht musst du ein Manuver ansteuern was die restlichen 26\u00B0 absolviert. Getestet hab ich das alles leider nicht aber ist von mir mal ein Gedanken ansto\u00DF\u00A0\u003Cimg alt=\u0022:wink:\u0022 data-emoticon=\u0022true\u0022 src=\u0022//kerbal-forum-uploads.s3.us-west-2.amazonaws.com/emoticons/default_k_wink.gif\u0022 title=\u0022:wink:\u0022\u003E\u003C/p\u003E\n\u003Cp\u003E\nvlt hilft er dir weiter\u00A0\n\u003C/p\u003E\n"},{"CreatedByName":"swjr-swis","CreatedById":152460,"CreatedDateTime":"2015-12-19T23:51:35Z","Content":"\n\u003Cp\u003E\nI can read German a lot better than I can write it, so I understand what you are talking about, but I will not subject you to my (or Google\u0027s) bad German. Forgive my response in English.\n\u003C/p\u003E\n\u003Cp\u003E\ntl;dr: \u003Cstrong\u003Etc1=mod(atan2(sin(lon1-lon2)*cos(lat2), cos(lat1)*sin(lat2)-sin(lat1)*cos(lat2)*cos(lon1-lon2)), 2*pi)\u003C/strong\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nLonger answer:\n\u003C/p\u003E\n\u003Cp\u003E\nWhat you need to search for is navigation on a \u0027great circle\u0027 or Riemann circle (Gro\u00DFkreis): a circle created by intersecting a plane with a sphere that crosses the sphere center - which if you think about it, is just another way of saying \u0027an orbital path around a sphere with a set inclination with the sphere\u0027s ecliptical\u0027 (if you calculate with a virtual sphere that is planet radius\u002Borbital altitude).\n\u003C/p\u003E\n\u003Cp\u003E\nThe problem is that a compass heading will not stay constant while navigating such a circle. If you follow the circle you will notice that the heading will vary: the greater the orbit inclination away from the ecliptic, the more the heading changes along the orbit. The easiest to notice this is at the most northern/southern points of the orbit, where the heading will be parallel to the ecliptic (ie. either 90 degrees, or 270 for retrograde orbits).\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022http://forum.kerbalspaceprogram.com/index.php?/profile/147898-tj179/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022147898\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/147898-tj179/\u0022\u003E@TJ179\u003C/a\u003E Notice that he is not talking about the pitch, which I think is what you are referring to... how much \u0027up\u0027 into the sky your nose is pointing. You are correct that this too changes if you follow a gravity turn, but it is not what \u003Ca contenteditable=\u0022false\u0022 data-ipshover=\u0022\u0022 data-ipshover-target=\u0022http://forum.kerbalspaceprogram.com/index.php?/profile/141432-inoculator/\u0026amp;do=hovercard\u0022 data-mentionid=\u0022141432\u0022 href=\u0022https://forum.kerbalspaceprogram.com/index.php?/profile/141432-inoculator/\u0022\u003E@inoculator\u003C/a\u003E is asking about. Even during a gravity turn, on an inclined orbit path the \u003Cu\u003Ecompass heading\u003C/u\u003E will not stay the same - the 56 will slowly start to move towards 90 then up to 124 when crossing the ecliptical, then back to 90 and finally 56 when flying over the KSC again.\n\u003C/p\u003E\n\u003Cp\u003E\nThe trick to calculating this constantly changing heading is understanding that the compass heading on a great circle/inclined orbit is basically a wave function, of which the wave amplitude becomes greater as the inclination of the orbit increases.\n\u003C/p\u003E\n\u003Cp\u003E\nThe formula for calculating the heading/bearing/course (depending the page they use different words for this) would be as follows:\n\u003C/p\u003E\n\u003Cp\u003E\ntc1=mod(atan2(sin(lon1-lon2)*cos(lat2), cos(lat1)*sin(lat2)-sin(lat1)*cos(lat2)*cos(lon1-lon2)), 2*pi)\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nInstead of trying to explain the math behind it myself (I\u0027m not that good at math), I\u0027ll give you a few links (some in German) that give a better explanation than I could.\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nGreat circle explained:\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://de.wikipedia.org/wiki/Gro%C3%9Fkreis\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://de.wikipedia.org/wiki/Gro%C3%9Fkreis\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nSome formulas to calculate great circle navigation (should be possible to make this into kOS code):\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022http://astrosail.de/de/static/tutorial/best5.php?cat=42\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://astrosail.de/de/static/tutorial/best5.php?cat=42\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nMore in English:\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022http://williams.best.vwh.net/avform.htm\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://williams.best.vwh.net/avform.htm\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022http://mathforum.org/library/drmath/view/55417.html\u0022 rel=\u0022external nofollow\u0022\u003Ehttp://mathforum.org/library/drmath/view/55417.html\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\nHopefully if the above is not directly helpful, at least searching for these terms may find you more useful documentation of how to code a function that maintains the correct compass heading on an inclined orbit.\n\u003C/p\u003E\n\u003Cp\u003E\nP.S.: I would be very interested to see your finished kOS script, if you are inclined to share it once you have it working as desired.\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222015-12-19T23:56:47Z\u0022 title=\u002212/19/2015 11:56  PM\u0022 data-short=\u00228 yr\u0022\u003EDecember 19, 2015\u003C/time\u003E by swjr-swis\u003C/strong\u003E\n\u003Cbr\u003EPS\n\u003C/span\u003E\n"},{"CreatedByName":"inoculator","CreatedById":141432,"CreatedDateTime":"2016-03-01T13:30:27Z","Content":"\n\u003Cp\u003E\nHi\u00A0swjr-swis,\u003Cbr\u003E\u003Cbr\u003E\nit has lasted a while since I hit the forum again. sorry for the delay.\n\u003C/p\u003E\n\u003Cp\u003E\nAt the moment I have a lack of performance on my PC to get a propper developement running on KOS.\u003Cbr\u003E\nNevertheless I have read the links and You really hit the point that I was missing.\n\u003C/p\u003E\n\u003Cp\u003E\nThanks for this.\u003Cbr\u003E\nAs\u00A0soon as I got my environment back in bussines, I will return and post some results.\u003Cbr\u003E\u003Cbr\u003E\nMany thanks \u0027till now\u003Cbr\u003E\nCarsten\n\u003C/p\u003E\n"},{"CreatedByName":"swjr-swis","CreatedById":152460,"CreatedDateTime":"2016-03-06T18:26:16Z","Content":"\n\u003Cp\u003E\nNo problem, I\u0027m glad I understood and could give some helpful information.\n\u003C/p\u003E\n"},{"CreatedByName":"inoculator","CreatedById":141432,"CreatedDateTime":"2016-03-25T09:43:20Z","Content":"\n\u003Cp\u003E\nHi again.\n\u003C/p\u003E\n\u003Cp\u003E\nAs promised a short status.\n\u003C/p\u003E\n\u003Cp\u003E\nI took a more or less deep dive into navigation regarding the great circle (GC). I did some tests applying the formula and ended up in more misunderstanding, than before ;-)\n\u003C/p\u003E\n\u003Cp\u003E\nI think, the formula You provided is only step 1 out of 3 or more steps.\n\u003C/p\u003E\n\u003Cp\u003E\n1. The angle calculated is the angle between two point, relative to the center of the GC.\u003Cbr\u003E\n2. To get the steering course I need to calculate the \u0022Kurswinkel\u0022 which is written on the wiki below Your quotation. It calculates the angle relative to north (0\u00B0).\u003Cbr\u003E\n3. Nevertheless I get the issue, that the navigation is bound to the ground, and as soon, as I lift off, I have to compensate two further parameters:\u003Cbr\u003E\n3.a. Coriolis effect if inclination is not 90 or 270\u00B0\u003Cbr\u003E\n3.b. The rotation of the body.\n\u003C/p\u003E\n\u003Cp\u003E\nI put in here the current scripts sniplets of the calculation I have done up to now. This does not include (3a \u002B b).\u003Cbr\u003E\n\u00A0\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan\u003E//main script\n//Runmode contains the step of the launch phase the ship is currently in.\n//0 is waiting to launch\n//1 is lift off and clear launchpad\n//\u0026gt;1 are 2: Rollmanuever 3: gravity turn 4: coast to AP 5:orbital burn 6:cleanup and ready to load next phase.\n\nif runmode \u0026gt;1 {\n[...]\n\t\n//Kursrechner\n\tset my_prograde to get_prograde().\n\tset my_bearing to get_bearing(my_prograde, my_orb).\n}\u003C/span\u003E\u003C/pre\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan\u003E// Prograde rechner\n//Es muss ermittelt werden,\n//welchen relativen Kurs wir zwischen der letzten und der\n// aktuellen position gehabt haben\n// dieser muss dann mit dem soll-kurs basierend auf der my_orb vorgabe \n// verglichen werden und ggfls. ein korrekturfaktor \n// eingerechnet werden\n\n// deklaration der variablen\n\nset bit_func_getprograde_rm to 0. //funktions laufmodus\nset int_last_lat to 0.\nset int_last_lon to 0.\nset int_cur_lat to 0.\nset int_cur_lon to 0.\nset this_Kurswinkel to 0.\nset this_GKANG to 0.\n\ndeclare function get_prograde {\n\nset my_position to ship:geoposition.\nset int_last_lat to int_cur_lat.\nset int_last_lon to int_cur_lon.\nset int_cur_lat to my_position:lat.\nset int_cur_lon to my_position:lng.\n\nif bit_func_getprograde_rm = 1 {\n\t//init ist gelaufen\n\t//Aus dem Forum:\n\t//tl;dr: tc1=mod(atan2(sin(lon1-lon2)*cos(lat2), cos(lat1)*sin(lat2)-sin(lat1)*cos(lat2)*cos(lon1-lon2)), 2*pi)\n\tset this_GKANG to mod(arctan2(sin(int_last_lon-int_cur_lon)*cos(int_cur_lat), cos(int_last_lat)*sin(int_cur_lat)-sin(int_last_lat)*cos(int_cur_lat)*cos(int_last_lon-int_cur_lon)), 2*constant:pi).\n\tset this_Kurswinkel to arccos((sin(int_cur_lon)-sin(int_last_lon)* cos(this_GKANG))/(cos(int_last_lat)*sin(this_GKANG))).\n}\nset bit_func_getprograde_rm to 1.\nreturn this_Kurswinkel.\n\n}\u003C/span\u003E\u003C/pre\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan\u003E// Prograde rechner\n// this one calculates the needed corretive course by given is-value and -shouldbe-value\ndeclare function get_Bearing {\n\tparameter int_prograde. //this is the course\n\tparameter int_orb. //this shouldbe the course\n\t\n\tset my_heading to (int_orb - int_prograde) \u002B int_orb.\n\t\n\treturn my_heading. //this needs to be the course to compensate\n}\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nI expect, that these sniplets might get more questions than answers, but I just wanted to show up, that I don\u0027t forget about this thread ;-)\u003Cbr\u003E\nI don\u0027t think, that the script quotes are usable for any other by c\u0026amp;p. There are a lot of further lines and functions.\n\u003C/p\u003E\n\u003Cp\u003E\nI hope to get some steps further today\n\u003C/p\u003E\n\u003Cp\u003E\nbr\n\u003C/p\u003E\n\u003Cp\u003E\nCarsten\n\u003C/p\u003E\n"},{"CreatedByName":"inoculator","CreatedById":141432,"CreatedDateTime":"2016-03-27T23:18:23Z","Content":"\n\u003Cp\u003E\nFinaly..... I think I got it.\n\u003C/p\u003E\n\u003Cp\u003E\nMaybe, someone can try it, I he likes, maybe it helps somebody.\n\u003C/p\u003E\n\u003Cp\u003E\nI went 3 days though all that navigation stuff and finally ended up in a totally simple solution:\n\u003C/p\u003E\n\u003Cp\u003E\n\u0022orbit:inclination\u0022.\n\u003C/p\u003E\n\u003Cp\u003E\nI really don\u0027t know, why I haven\u0027t seen this command before.\n\u003C/p\u003E\n\u003Cp\u003E\nThe final script gets an inclination of \u002B/- 0.5\u00B0 off.\n\u003C/p\u003E\n\u003Cpre class=\u0022ipsCode prettyprint lang-html prettyprinted\u0022\u003E\n\u003Cspan\u003E// Inclination correction\n// my_orb is the given heading in the main script\n// the function is to be called at the beginning of every control loop.\n\n// deklaration der variablen\n\nset bit_func_getprograde_rm to 0. //funktions laufmodus\nset int_last_inc to 0.\nset int_cur_inc to 0.\nset this_inc to 0.\nset this_qad to 0.\nset this_Kurswinkel to 0.\nif my_orb\u0026lt;=90 {\n set this_inc to 90 - my_orb.\n set this_qad to 1.\n }\nif my_orb\u0026gt;90 and my_orb\u0026lt;=270 {\n set this_inc to my_orb - 90.\n set this_qad to 2.\n }\nif my_orb\u0026gt;270 {\n set this_inc to 450-my_orb.\n set this_qad to 3.\n }\ndeclare function get_prograde {\n\nset int_last_inc to int_cur_inc.\nset int_cur_inc to orbit:inclination.\n\nif bit_func_getprograde_rm = 1 {\n\t//init ist gelaufen\n\tif mod(this_qad,2)=1 {\n\tset this_kurswinkel to max(-8,min(8,orbit:inclination-this_inc)) *2 \u002Bmy_orb.\n\t} else {\n\tset this_kurswinkel to max(-8,min(8,this_inc-orbit:inclination)) *2 \u002Bmy_orb.\n\t}\n}\nset bit_func_getprograde_rm to 1.\nreturn this_kurswinkel.\n\n}\u003C/span\u003E\u003C/pre\u003E\n\u003Cp\u003E\nI have put the complete script library on to here:\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Ca href=\u0022https://drive.google.com/folderview?id=0BxyO38kgW4YuWmE4Qlp3RXJhSGs\u0026amp;usp=sharing\u0022 rel=\u0022external nofollow\u0022\u003Ehttps://drive.google.com/folderview?id=0BxyO38kgW4YuWmE4Qlp3RXJhSGs\u0026amp;usp=sharing\u003C/a\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nIt is very raw and not really cleaned up, so don\u0027t expect to much ;-)\n\u003C/p\u003E\n\u003Cp\u003E\nThanks for the help.\n\u003C/p\u003E\n\u003Cp\u003E\nCarsten\n\u003C/p\u003E\n"}]}