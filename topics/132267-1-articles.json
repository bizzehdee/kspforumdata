{"TopicId":132267,"ForumId":20,"TopicTitle":"[IDEA] Splitting vessels in 1.1 to utilize multiple CPU threads","CreatedByName":"KerbonautInTraining","CreatedById":145373,"CreatedDateTime":"2016-02-16T16:11:44Z","PageNum":1,"Articles":[{"CreatedByName":"KerbonautInTraining","CreatedById":145373,"CreatedDateTime":"2016-02-16T16:11:44Z","Content":"\n\u003Cp\u003E\nIn 1.1 each vessel will have 1 CPU thread to play with. In most cases, this won\u0027t load your CPU very heavily.\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cstrong\u003EI\u0027m gonna cut to the case here, what if you could have multiple vessels rigidly connected, but not considered a single merged vessel according to the physics engine? \u003C/strong\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027m proposing a type of decoupler or docking port. This could be used for:\n\u003C/p\u003E\n\u003Cp\u003E\n1. Dividing space stations\n\u003C/p\u003E\n\u003Cp\u003E\n2. Dividing large interplanetary ships (i.e. propulsion stage and lander)\n\u003C/p\u003E\n\u003Cp\u003E\n3. (My fav) Dividing payloads from their launch vehicles.\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cstrong\u003EProblems/solutions:\u003C/strong\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nP: Any time the ships are on rails they will drift apart.\n\u003C/p\u003E\n\u003Cp\u003E\nS: Don\u0027t allow time warp until the part re-connects all vessels. (This could be done in the background)\n\u003C/p\u003E\n\u003Cp\u003E\nP: Resource/crew transfer will be impossible\u00A0\n\u003C/p\u003E\n\u003Cp\u003E\n\u003Cspan style=\u0022font-size:16px;line-height:1.6;\u0022\u003ES: Allow the vessels to be connected temporarily through the part\u0027s right click menu, although framerates will plummet.\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nI have no idea how this would be coded\u003Cem\u003E,\u003C/em\u003E I do know it\u0027s possible to some extent through KAS\u0027s pipes, perhaps a variant of that could be used? Discuss!\n\u003C/p\u003E\n\u003Cp\u003E\n(I\u0027m writing this on my phone, later today I\u0027ll probably update this with more info)\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-02-16T16:19:41Z\u0022 title=\u002202/16/2016 04:19  PM\u0022 data-short=\u00228 yr\u0022\u003EFebruary 16, 2016\u003C/time\u003E by KerbonautInTraining\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"pellinor","CreatedById":85299,"CreatedDateTime":"2016-02-16T16:58:12Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222412905\u0022 data-ipsquote-contentid=\u0022132267\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221455639104\u0022 data-ipsquote-userid=\u0022145373\u0022 data-ipsquote-username=\u0022KerbonautInTraining\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n44 minutes ago, KerbonautInTraining said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nI have no idea how this would be coded\u003Cem\u003E,\u003C/em\u003E I do know it\u0027s possible to some extent through KAS\u0027s pipes, perhaps a variant of that could be used? Discuss!\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThe KAS winches allow vessels to be physically connected but not docked. Maybe that code helps.\n\u003C/p\u003E\n"},{"CreatedByName":"HebaruSan","CreatedById":156657,"CreatedDateTime":"2016-02-16T18:31:06Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222412905\u0022 data-ipsquote-contentid=\u0022132267\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221455639104\u0022 data-ipsquote-userid=\u0022145373\u0022 data-ipsquote-username=\u0022KerbonautInTraining\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n2 hours ago, KerbonautInTraining said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\n\u003Cstrong\u003Erigidly connected\u003C/strong\u003E\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nI suspect this part would kill it. To make them\u00A0rigidly connected, you need to have the motion\u00A0of one vessel exert forces on the other vessel, which means they can no longer be processed completely in parallel; one core would need to tell the other that it needs to do some extra processing and possibly wait for it to finish, at least partially serializing the physics pass. And if you\u0027re rotating or thrusting, those forces will happen continuously.\u00A0Which is pretty much exactly what happens between parts on a single vessel today, so the performance ought to be similar.\n\u003C/p\u003E\n\u003Cp\u003E\nNow, mini-fleets would make sense. Rather than a huge docked spaghetti noodle contraption, put five\u00A0separate specialized ships within 200m of one another and have them all burn for Jool. The load on rails is already minimal, and when you come out of time warp, you get to take advantage of multiple cores. I could see that working very well.\n\u003C/p\u003E\n\u003Cp\u003E\n(Disclaimer: Of course, 100% of the above is speculation till 1.1 ships.)\n\u003C/p\u003E\n"},{"CreatedByName":"KerbonautInTraining","CreatedById":145373,"CreatedDateTime":"2016-02-16T19:08:11Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222413162\u0022 data-ipsquote-contentid=\u0022132267\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221455647466\u0022 data-ipsquote-userid=\u0022156657\u0022 data-ipsquote-username=\u0022HebaruSan\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n37 minutes ago, HebaruSan said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nI suspect this part would kill it. To make them\u00A0rigidly connected, you need to have the motion\u00A0of one vessel exert forces on the other vessel, which means they can no longer be processed completely in parallel; one core would need to tell the other that it needs to do some extra processing and possibly wait for it to finish, at least partially serializing the physics pass. And if you\u0027re rotating or thrusting, those forces will happen continuously.\u00A0Which is pretty much exactly what happens between parts on a single vessel today, so the performance ought to be similar.\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nBut as of now, you could easily connect 2 vessels through, say, a lattice of trusses and they\u0027d still be 2 separate vessels. One would have to figure out how to connect the vessels reliably, thinking about it I\u0027m pretty sure a type of docking port would work best. (I.e. it uses some sort of \u00FCber magnet to hold them together)\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027m almost certain they would stay in separate threads, seeing as merging 2 vessels into one thread upon contact would be pretty clunky.\u00A0\n\u003C/p\u003E\n\u003Cspan class=\u0022ipsType_reset ipsType_medium ipsType_light\u0022 data-excludequote=\u0022\u0022\u003E\n\u003Cstrong\u003EEdited \u003Ctime datetime=\u00222016-02-16T19:10:33Z\u0022 title=\u002202/16/2016 07:10  PM\u0022 data-short=\u00228 yr\u0022\u003EFebruary 16, 2016\u003C/time\u003E by KerbonautInTraining\u003C/strong\u003E\n\u003C/span\u003E\n"},{"CreatedByName":"HebaruSan","CreatedById":156657,"CreatedDateTime":"2016-02-16T19:23:31Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222413220\u0022 data-ipsquote-contentid=\u0022132267\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221455649691\u0022 data-ipsquote-userid=\u0022145373\u0022 data-ipsquote-username=\u0022KerbonautInTraining\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n10 minutes ago, KerbonautInTraining said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nBut as of now, you could easily connect 2 vessels through, say, a lattice of trusses and they\u0027d still be 2 separate vessels. One would have to figure out how to connect the vessels reliably, thinking about it I\u0027m pretty sure a type of docking port would work best. (I.e. it uses some sort of \u00FCber magnet to hold them together)\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nTrue, but in current versions we\u0027re already accepting that all physics processing is serialized. There is currently zero difference between two smaller vessels and one big vessel made up of the same parts as those two. The question was how the two-vessel case will work in 1.1 if we try to rigidly connect them and whether it will be faster.\n\u003C/p\u003E\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n10 minutes ago, KerbonautInTraining said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nI\u0027m almost certain they would stay in separate threads, seeing as merging 2 vessels into one thread upon contact would be pretty clunky.\u00A0\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nThey don\u0027t have to be merged to see an equivalent performance degradation. All that\u0027s needed is for there to be a dependency where the two threads are signalling and reacting to each other due to interaction between the vessels.\n\u003C/p\u003E\n"},{"CreatedByName":"KerbonautInTraining","CreatedById":145373,"CreatedDateTime":"2016-02-18T14:39:13Z","Content":"\n\u003Cp\u003E\nWell, I think what I\u0027ll do is wait until 1.1.\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027ll \u003Cspan style=\u0022font-size:16px;line-height:1.6;\u0022\u003Erun a test with 2 large vessels docked, undocked, and undocked while touching, then compare performance throughout.\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nIf the results show equally high performance between undocked and undocked while touching then I\u0027ll revive the thread. If not, I\u0027ll let it dissolve into nothing\n\u003C/p\u003E\n"},{"CreatedByName":"HebaruSan","CreatedById":156657,"CreatedDateTime":"2016-02-18T17:44:35Z","Content":"\n\u003Cblockquote class=\u0022ipsQuote\u0022 data-ipsquote=\u0022\u0022 data-ipsquote-contentapp=\u0022forums\u0022 data-ipsquote-contentclass=\u0022forums_Topic\u0022 data-ipsquote-contentcommentid=\u00222416967\u0022 data-ipsquote-contentid=\u0022132267\u0022 data-ipsquote-contenttype=\u0022forums\u0022 data-ipsquote-timestamp=\u00221455806353\u0022 data-ipsquote-userid=\u0022145373\u0022 data-ipsquote-username=\u0022KerbonautInTraining\u0022\u003E\n\u003Cdiv class=\u0022ipsQuote_citation\u0022\u003E\n3 hours ago, KerbonautInTraining said:\n\u003C/div\u003E\n\u003Cdiv class=\u0022ipsQuote_contents\u0022\u003E\n\u003Cp\u003E\nWell, I think what I\u0027ll do is wait until 1.1.\n\u003C/p\u003E\n\u003Cp\u003E\nI\u0027ll \u003Cspan style=\u0022font-size:16px;line-height:1.6;\u0022\u003Erun a test with 2 large vessels docked, undocked, and undocked while touching, then compare performance throughout.\u003C/span\u003E\n\u003C/p\u003E\n\u003Cp\u003E\nIf the results show equally high performance between undocked and undocked while touching then I\u0027ll revive the thread. If not, I\u0027ll let it dissolve into nothing\n\u003C/p\u003E\n\u003C/div\u003E\n\u003C/blockquote\u003E\n\u003Cp\u003E\nOh, I\u0027d be interested in the results regardless of how they turn out. Please do share your findings!\n\u003C/p\u003E\n"}]}